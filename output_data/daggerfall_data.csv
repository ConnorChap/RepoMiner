id,title,author,created_at,closed_at,labels,body
2672204017,Allow creation of random custom items,TwelveEyes,2025-07-16 23:21:01+00:00,,{},Fixes #2763
2665608466,Use a snow emitter around the camera,petchema,2025-07-14 23:08:59+00:00,,{'refinement': 1},"Specially when going down hills, it's obvious that the snow emitter is above the player and snow particles can't keep up with player's movement.

Simplest fix is to use an emitter around the camera instead of above; It's not perfect but greatly improves the visual effect worse cases.

Test:

    set_weather 6
    location 3

(maybe use location 3 multiple times until you spawn on the sea side of Sentinel)
Then descend in the direction of the sea, preferably on horse

Source:
https://gamedev.stackexchange.com/questions/198424/in-a-top-down-3d-game-how-can-i-simulate-snow-without-actually-covering-entire"
2603237381,Hack for runtime loading of WAV files,TwelveEyes,2025-06-19 00:47:12+00:00,,{},"Loading loose WAV audio clip files is completely broken. On current Unity version (`2019.4`) it just falls back to the default DF audio files (presumably because the returned AudioClip is null), but on Unity `2022.3` it fails to fall back (presumably because the returned AudioClip is not null, just empty) so there is no sound at all. Loading of loose OGG music files works just fine though.

I don't know why, but setting WAV files to load streamed fixes this issue. :shrug: "
2593207620,Fix custom item type being lost upon splitting item stack,TwelveEyes,2025-06-15 03:45:21+00:00,,{},"Upon splitting a stack `new DaggerfallUnityItem()` is called instead of `ItemBuilder.CreateItem()`, so any custom items lose their custom class type as `(DaggerfallUnityItem)Activator.CreateInstance(itemClassType)` is not called. This fixes that so custom items properly retain their type upon split.

Fixes #2758"
2591880206,Null check ImageData for BlitCloakInterior,TwelveEyes,2025-06-14 03:38:57+00:00,2025-07-22 00:35:26+00:00,{},"Fixes the paperdoll throwing a null exception trying to blit a cloak interior for a custom item that goes into the cloak slot and doesn't count as one of the hard coded cloaks (`Formal_cloak` or `Casual_cloak`).

Addresses part of #2740."
2589356179,Push inventory window directly instead of through message queue,TwelveEyes,2025-06-13 07:19:25+00:00,,{},"Occasionally activating a loot container (e.g. a loot pile, a corpse, a store shelf, a quest reward, etc) would open the inventory and the `lootTarget` would somehow be null ‚Äî the inventory would open but the loot column on the right would just be the ground instead of the loot container. It seems to always happen upon the very first activation of a loot container after a load of a save game.

The cause may be a possible race condition between the `lootTarget` being set and the UI message queue being processed. Pushing the UI window directly instead of going through the UI message queue seems to solve this.

Dungeon wagon access prompts and knightly order armor reward prompts have been changed as well, just in case this bug affects them too."
2588329488,Fix loss of mage light dlight while spell is active,TwelveEyes,2025-06-12 19:39:20+00:00,,{},"While mage light is active, going through a terrain change (exterior <---> interior or using the teleport spell/mage guild service) would cause loss of the dynamic light. The only way to get it back is to wait until the spell expires (or dispel it manually) and recast ‚Äî a recast while the spell is active won't do it. This simply checks if the spell lost the light somehow and recreates it."
2588061607,Revert ImageReader frameCount check,TwelveEyes,2025-06-12 17:28:33+00:00,2025-07-21 12:57:54+00:00,{},Removing the `frameCount` check made some custom inventory items with custom textures appear as material silver. Reverting the change fixes this bug.
2582174698,Restore letter signoff macro expansion for names,TwelveEyes,2025-06-10 18:20:39+00:00,,{},"Restores macro expansions (except location name macros) in letter signoff inside the hover tooltip.

Interkarma [disabled](https://github.com/Interkarma/daggerfall-unity/commit/319e5c0ef0f286e243d7fef11e14e7541f335c69) macro expansion for letter signoffs because location data lookup could potentially cause serious performance degradation from world reloads ([dfworkshop thread source](https://forums.dfworkshop.net/viewtopic.php?p=66826#p66826)).

This restores letter signoff macro expansion for all macros _except_ location based ones, so it shouldn't impact performance."
2579576759,Moved absorb logic from EntityEffectManager to FormulaHelper,dakoller123,2025-06-09 22:07:07+00:00,,{},"Hey Guys!

I'd like to attempt another PR regarding spell absorb. 4 years ago it was closed due to feature freeze. Today I re-forked unity and re-did the whole change from scratch, I've also made an experimental dfumod that overrid the absorb effect.

What has changed: 
- Moved TryAbsorbtion method from EntityEffectManager to FormulaHelper, alongside it's helper methods
- TryAbsorption now returns the absorbed spell point count instead of a bool and an out variable
- TryAbsorption has the target caster entity and the absorb incumbent effects as function parameters now so its side effect-free
- Tiny refactor around the usage of TryAbsorb, the same 'if bundletype is spell' was reused 3 times

What was out of scope:
- Moving Reflection and Resistance to the FormulaHelper in a similar fashion. Once this PR is approved I might do that as well

How it was tested:
- I built my own binaries from my fork and used an experimental version of Mighty Magick mod where I overrid the formula. It all worked as expected.

Link to the old PR for reference:
https://github.com/Interkarma/daggerfall-unity/pull/2179

"
2579083186,Reopen of PR#2179: Moved absorb logic from EntityEffectManager to FormulaHelper #2179 ,dakoller123,2025-06-09 18:07:29+00:00,2025-06-09 18:09:02+00:00,{},"Hey guys!

I'd like to reopen a 4 year old PR about moving the absorb logic into formulas so they can be overridden. I'm working on a mod that would nerf absorb heavily and this would be helpful.

Link to the old PR:
https://github.com/Interkarma/daggerfall-unity/pull/2179

I've just merged main, seems like nothing much has changed here so this should be good. I've also compiled it at home."
2576278279,Add city wall automap display name,TwelveEyes,2025-06-08 04:11:25+00:00,,{},"Adds `Town23` to the building type switch within `GenerateBuildingName()`. After using info on or entering the building it will be marked as ""City Wall"".

This was a bit of a headache to PR, as the `Internal_Strings.csv` file is a horrible mix of `CRLF` and `LF` line endings. Had to fight git and my editor so the commit diff wasn't 500+ line changes.

Fixes #2649"
2576215688,"Allow looting from building types House5, House6, and Town23",TwelveEyes,2025-06-08 02:24:55+00:00,,{},"Adds `House5`, `House6`, and `Town23` to the private property loot byte arrays and expands the conditional check to include those building types.

Fixes #2648"
2574930828,Fix static NPCs in houses not being hidden at night,TwelveEyes,2025-06-07 03:34:43+00:00,,{},"Houses were being omitted from the conditional to disable NPCs at night. This adds building types `House1` to `House4` to the NPC disable/enable functions. Also includes new entries to the open/closed hours arrays for `House2` to `Ship`.

Fixes #2662"
2574247328,Fix leather weight formula for correct gauntlet weight,TwelveEyes,2025-06-06 19:00:40+00:00,,{},"Changes the formula (thanks @Erisceres!) for adjusting weight of leather material so leather gauntlets have the same weight as in classic DF.

Fixes #2744"
2574108377,Fix run speed not being reduced while crouched,TwelveEyes,2025-06-06 17:51:52+00:00,2025-07-16 22:43:30+00:00,{},"Addresses running while crouched being the same speed as running while standing.

Fixes #2670"
2571253237,Fix for possible zombie items from MakePermanent action,TwelveEyes,2025-06-05 18:59:05+00:00,,{},"This was somewhat [addressed](https://github.com/Interkarma/daggerfall-unity/issues/2262#issuecomment-1261602732) in the past, but it only resyncs permanency between the virtual quest item and the inventory item with item transfer (e.g. foe has quest items; those quest items are made permanent; foe is killed and player loots those quest items). It doesn't cover items already in the player inventory when a `MakePermanent` action happens, potentially leading to a desynced state ‚Äî the dreaded ""zombie"" item.

~~This workaround should fix the issue in a low impact way by resyncing permanency when the inventory window is setup and when it refreshes.~~

Changed to be much cleaner, though it won't fix bugged items already made permanent in saves retroactively.

Fixes #2720"
2569068756,Restore vampire player barks,TwelveEyes,2025-06-05 04:32:52+00:00,,{},"Restores missing vampire player bark sounds when attacking. I have no idea what the chance for them to play is in original Daggerfall, so I chose a value that seems somewhat reasonable.

Fixes #2716"
2568553711,Fix PlaceNpc action not serializing marker,TwelveEyes,2025-06-04 21:50:43+00:00,,{},"Marker indexes for the `PlaceNpc` quest action are not properly serialized, causing quest npcs to be placed at a random marker when the action is loaded. This is quite obvious in the quest `Lord K'avar Part III`, where the Lord K'avar flat could be located at a incorrect marker, and the foe at the correct one, causing K'avar to seemingly teleport across the dungeon.

Also edited `PlaceFoe`'s `AssignQuestResource` pattern to match that of `PlaceNpc`'s `AssignQuestResource` for consistency.

Fixes #2700"
2536160265,Fix fatigue bar vital,TwelveEyes,2025-05-22 06:29:20+00:00,,{},Fixes `fatigueBar.Amount` erroneously being set instead of `fatigueBarGain.Amount`. 
2449113387,Extends functionality for modders to modify horse riding speed.,tuncturel,2025-04-09 16:55:44+00:00,,{},"Hi, I've found out that it was not possible for modders to modify the horse riding speed in DFU. I took some liberty in refactoring this script and adding this exact functionality. I followed the same format with which walking and running speeds were modified to keep my addition predictable and in line with the existing material. I also took a bit of liberty in renaming a few things, removing some possibly redundant comments, rewriting missing/incorrect comments as well. I made sure none of my changes impacted existing mods by keeping everything backwards compatible. I did some light testing to see if things are working as intended and they seemed okay but would love it if someone took the time to test it thoroughly. I'm by no means a stranger to Unity or coding with C#. I got many years under my belt but this is my first contribution in a public repo ever so please let me know if something doesn't make sense or if you have any input. I'm just a guy who wants to mod his horse to ride faster. üê¥ "
2405369884,Upgrade to 2022.3.60f1 LTS,Z-Machine,2025-03-20 00:37:55+00:00,,{},"This PR supersedes the initial work done by Interkarma on his branch.

This upgrade fixes multiple breaking issues I've experienced under Wayland in the unity2019 editor and also fixes #2728 

Currently everything vanilla seems to work in the editor and in my local build on Linux. I haven't got around to testing mods yet but there doesn't seem to have been any apparent breaking changes.

I'd love to help get this tested and pushed through as I'm sorely lacking newer language features in C# and support for SourceGenerators. :pray: "
2392190301,Fix: ItemData_v1.GetSaveData() also saves className now.,AncientGrief,2025-03-13 23:04:06+00:00,2025-03-14 13:05:49+00:00,{},"I added a custom DaggerfallUnityItem to the game. Works fine until I load a savegame with the item in my inventory (or in store shelves)

It's because the className is not saved and upon deserialization it will become a regular DaggerfallUnityItem with the default `UseItem`-Method and no custom icon (it will have no icon at all)

A workaround would be this (on my custom item class)
```csharp
public override ItemData_v1 GetSaveData()
{
    ItemData_v1 saveData = base.GetSaveData();
    saveData.className = GetType().ToString();
    
    return saveData;
}
```
But maybe it doesn't hurt to let DFU take care of this, because while deserializing it's already checking for `className`."
2380351196,Restore fogColor during load,Z-Machine,2025-03-08 20:18:42+00:00,,{},Fixes the issue described in #2730
2340840458,Fix UI/popups background color to use the one set in settings.ini,themrleon,2025-02-18 01:21:49+00:00,2025-02-19 03:02:30+00:00,{},"Fix most of the UI/popups backdrop/dim that was supposed to be based on the `DimAlphaStrength` property from the `settings.ini` file, also fix the inconsistency with the ""Rest"" screen that has black background. Here some examples of **before and after based on the default 50% dim**:

![image1912](https://github.com/user-attachments/assets/216a344b-730f-4d1a-998b-81bef2abcd21)

This PR would also allow mods to expose this setting so players can choose between 0% and 100% dim via mod settings. 

This is specially useful when there are lots of text and buttons on UI stacked at same time like in the map travel scenario (2nd example)."
2332672539,Missed 2 UI classes,Jagget,2025-02-13 02:15:35+00:00,2025-02-13 02:32:42+00:00,{'UI': 1},Adding access to UI controls that I missed in https://github.com/Interkarma/daggerfall-unity/pull/2618
2318324051,Mergable building override automap data (take 2),ajrb,2025-02-05 18:59:27+00:00,2025-02-13 01:37:13+00:00,{},"This allows building overrides to only replace the automap data for the relevant area of the RMB for the specific building. This effectively enables merging of overridden map data. The picture below shows the town map, first is with the building override data being used (current functionality), second is without the building override (the modified RMB map data taken from Beautiful Cities), and the third is with functionality added by this PR where the building override only overwrites the part it needs to.

![autodataMerge](https://github.com/user-attachments/assets/483c7ed0-7726-480e-8332-2f60adb44ff0)

You can see it overwrites some of the nearby buildings, but after adjusting the amount of area it looks very good. (note Beautiful Cities map data doesn't include the random objects and flats that can be displayed using the red grid icon)

![autodataMerge2](https://github.com/user-attachments/assets/ff3ee8d6-70c0-4ad1-96bc-f32acc644176)

The unused value of '30' is used to signify no change for that pixel in a building override automap data byte array. See the attached modified building file for an example where the automap data has been changed to only affect the building area. It can be compared to the original from my [Archaeologists mod](https://github.com/ajrb/dfunity-mods/blob/master/Archaeologists/WorldData/PAWNAL03.RMB-857-building3.json).

[PAWNAL03.RMB-857-building3.json](https://github.com/user-attachments/files/18240766/PAWNAL03.RMB-857-building3.json)
"
2297561904,Allow Overwriting Map Note Marker Model,ArshvirGoraya,2025-01-24 20:21:29+00:00,,{},"Mod Support:

I want to replace 3D models. 
Currently, I'm just disabling the mesh renderer for models I want to replace and childing the new model to them.

### Problem:
- I can't do the above method for the map note model as well as I want: it renders the default model during the prompt for the notes message, and only after can the model be ""replaced"" with the above method. 
- See video of the problem: https://streamable.com/phfbu1


### Solution: 
- Add a way to overwrite the 3D model for notes, so it creates the desired one by default.
- Create `customGameObjectUserNoteMarker`: 
	- if is null, just does what it does now.
	- if not, uses the `customGameObjectUserNoteMarker` game object for the Notes model.
- See video of the solution working: https://streamable.com/3zm9nf

Example Usage:
```CS
void Start(){
	if (Automap.instance.CustomGameObjectUserNoteMarker == null){
		Automap.instance.CustomGameObjectUserNoteMarker = mod.GetAsset<GameObject>(PrefabName, false);
	}
}
```
### Code Explanations

There are other code changes in the script, so here is an explanation of them:
- Since we're using a prefab, it may have children, which needs to be handled.
	- For example, the parent of the prefab game object may just be an empty object containing all the children.
- The children must be named correctly with the ID and prefix that a raycast uses to edit or remove the note, otherwise it will not detect them.
	- A new function is created for this:  `SetNameRecursively`, which is just like the existing function `SetLayerRecursively`, but for naming.
	- Now that children can be detected with the raycast we can detect and edit the notes when the raycast hits any of the prefab's children.
- We still need to handle deleting the note. The raycast detects an object with a specific name and then deletes it. But if its a child of a larger object, it will delete just that child, not the entire object. So, this needs to be handled.
	- A new function is created for this: `GetHighestAncestorBelowAncestor`, which finds the highest gameobject/parent from the raycast hit gameobject, that is still below a specified gameobject: in this case ""UserMarkerNotes."" Since the object with the name ""UserMarkerNotes"" stores all the notes, we know the parent object of the Prefab will be placed right under it. So, this function will simply go upwards parent-to-parent from the hit raycast object and get that parent. Now that the parent of the prefab can be gotten, we can delete the entire object, not just the single child that the raycast hit.
	- Note: there is a way to just let the modder handle this. For example, they can create a script that deletes the parent on a child's OnDelete() event. But they would have to attach this script to all of the children, which may be annoying, especially if there are a lot of children."
2297111446,Fix Former Student part III reward not triggering ,JayH2971,2025-01-24 16:13:16+00:00,,{},"Had to do full surgery on this quest to understand it. The ending depended on a ""click item"" trigger that DFU didn't interpret the same as classic. Changed that mechanic (see ""_takemageitem_"" task), tested and it works properly now."
2272660350,Assign constant rather than dynamic blockIndices to modded RMBs,drcarademono,2025-01-12 19:24:51+00:00,,{},"This PR is aimed at fixing this rather severe issue with modded RMB files (those with non-vanilla blockNames) first described here: https://github.com/Interkarma/daggerfall-unity/issues/2703. Because modded RMBs are assigned their blockIndices dynamically rather than deterministically, their blockIndices change when the player restarts the game or loads a save. This breaks all interiors associated with modded RMBs. This means that saves within buildings in modded RMBs are corrupted and cannot be loaded. It also means that questors assigned to buildings in modded RMBs disappear, potentially preventing players from completing quests -- including the main quest. Unfortunately this issue affects some of the most widely used mods, including Fixed Desert Architecture, Finding My Religion, Beautiful Cities/Villages, and Cities Overhauled.

This PR fixes the issue in the simplest possible manner by allowing modders to assign a constant blockIndex to modded RMBs. I replaced the AssignNextIndex method with the AssignNewIndex method, which looks up the Index value from the RMB.json file:
```
{
    ""Position"": 14551075,
    ""Index"": 2012,
    ""Name"": ""TEMPASB0.RMB"",
    ""Type"": ""Rmb"",
    ""RmbBlock"": {
```
Here AssignNewIndex will always assign this non-vanilla RMB block, TEMPASB0.RMB, the constant index 2012, which is well above the highest vanilla blockIndex (1294). 

This PR will require RMB modders to change the Index values in all of their non-vanilla RMBs and to claim unique RMB blockIndices in the [Daggerfall Workshop Resource Register](https://forums.dfworkshop.net/viewtopic.php?t=3023). This will not require much adjustment since this is already standard practice for all other assets that require a unique, constant value, like LocationIds, FactionIds, and texture archives. To the best of my knowledge, only Cliffworms, Wayton, and I have made modded new RMBs so far, and coordinating between us will be easy.

I have tested this PR on modded new blocks in Beautiful Cities/Beautiful Villages and can affirm that saves inside modded RMB buildings successfully load and questors appear correctly.

I made this PR as a minimal change. One downside of my approach is that it requires deserializing modded RMB.jsons twice, once to get the Index value in AssignNewIndex and once to get the rest of the data in GetDFBlockReplacementData. While I don't find that this noticeably increases load time at startup, a more adept coder might be able to reorganize the WorldDataReplacements class or BlocksFiles so that it deserializes modded RMB.jsons only once. Alternately, the simplest and least intrusive way might be to move the blockIndex into the RMB.json filename, the way location jsons have their region and regional index in their filename. In this solution TEMPASB0.RMB-2012.json would be the filename for blockIndex 2012, and AssignNewIndex could simply parse the filename instead of deserializing the json. I can implement this if it seems preferable to reviewers.

Finally, please note that I made AssignNewIndex public. This is so that mods (and here I'm particularly thinking of World of Daggerfall) can add new modded RMBs as well. Therefore, this PR replaces [2709](https://github.com/Interkarma/daggerfall-unity/pull/2709)."
2251124215,Mergable building override automap data,ajrb,2024-12-24 16:05:06+00:00,2025-02-05 18:45:32+00:00,"{'enhancement': 1, 'mod system': 1}","This allows building overrides to only replace the automap data for the relevant area of the RMB for the specific building. This effectively enables merging of overridden map data. The picture below shows the town map, first is with the building override data being used (current functionality), second is without the building override (the modified RMB map data taken from Beautiful Cities), and the third is with functionality added by this PR where the building override only overwrites the part it needs to.

![autodataMerge](https://github.com/user-attachments/assets/483c7ed0-7726-480e-8332-2f60adb44ff0)

You can see it overwrites some of the nearby buildings, but after adjusting the amount of area it looks very good. (note Beautiful Cities map data doesn't include the random objects and flats that can be displayed using the red grid icon)

![autodataMerge2](https://github.com/user-attachments/assets/ff3ee8d6-70c0-4ad1-96bc-f32acc644176)

The unused value of '30' is used to signify no change for that pixel in a building override automap data byte array. See the attached modified building file for an example where the automap data has been changed to only affect the building area. It can be compared to the original from my [Archaeologists mod](https://github.com/ajrb/dfunity-mods/blob/master/Archaeologists/WorldData/PAWNAL03.RMB-857-building3.json).

[PAWNAL03.RMB-857-building3.json](https://github.com/user-attachments/files/18240766/PAWNAL03.RMB-857-building3.json)
"
2249909924,Fix for intended precedence of building overrides when RMB block overrides also present,ajrb,2024-12-23 17:53:55+00:00,2025-02-05 03:01:34+00:00,"{'bug': 1, 'mod system': 1}","When an RMB block is overridden, the block reading is shortcut and building overrides should be applied correctly. This was not happening, and this addition applies any applicable building overrides after loading the RMB override data.

This PR replaces #2699 submitted by carademono. That PR was a very good effort but it would only fixe it for a specific scenario and also breaks the block construction encapsulation.

This should be rigorously tested that it doesn't break any existing mods. 

One issue that has never been addressed is the automap data which is at the RMB block level but can be overridden by a building override. I intend to take a look at a way to have building overrides map data to be merged."
2235570875,Fix inconsistency in NPC answers about a person and their location,df-ferital,2024-12-15 08:00:50+00:00,,{},"This fixes an old and annoying issue present in both classic DF and DFU, where an NPC wouldn't know the location of a building, but would still give information about that building when asked about an NPC located there, as in the example below.

![ask-building-bug-2](https://github.com/user-attachments/assets/b8207afb-65eb-4a7b-9e5f-1001462f3ae4)


"
2207926526,Fix The Akatosh Chantry bug,drcarademono,2024-11-29 20:43:30+00:00,,{},"This fixes a bug in which temples of Akatosh are incorrectly named The Order of the Hour instead of The Akatosh Chantry, even though all NPCs inside refer to it as The Akatosh Chantry.

The bug was [noticed six years ago here](https://forums.dfworkshop.net/viewtopic.php?t=877) and likely replicates DOS Daggerfall behavior. The cause is a mistake in vanilla location data for Akatosh temples. Most location data sets the Temple FactionID as the relevant god (ie 33 for Stendarr) and then this method grabs the first child (106 for Temple of Stendarr). However, the location data for Akatosh temples refer directly to The Akatosh Chantry (FactionID 92) instead of the god (FactionID 26). The first child of The Akatosh Chantry is The Order of the Hour.

This PR makes the method first traverse to the top-level factionID and then takes its first child for temple names."
2173883477,Allow mods to add new RMB blocks,drcarademono,2024-11-12 01:54:43+00:00,2025-02-06 13:29:31+00:00,{},"Mods currently cannot access custom RMB blocks. New RMB blocks are only added to WorldDataReplacement's new block index when a player visits a regular Daggerfall location. This is a problem for mods like LocationLoader (in World of Daggerfall), which aims to add custom RMB blocks throughout the world, not just at regular locations. This PR simply sets WorldDataReplacement.AssignNextIndex to public, allowing LocationLoader to call it and add a new RMB block to the index."
2171850644,Add a button to copy modlist to the clipboard,petchema,2024-11-11 03:22:58+00:00,,"{'enhancement': 1, 'UI': 1}","Should help with exchanging mod lists, in forums or otherwise

![copy modlist to clipboard](https://github.com/user-attachments/assets/c0faa5d0-9176-423f-9030-06d7f2f353af)

Ctrl-V:
    Daggerfall Unity Release 1.1.1
    [x] Daggerfall OST on OPL-3 (0.2.1)
    [x] Project French Daggerfall pour Unity (1.0.1)
    [x] Distant Terrain (2.9.1)
    [x] Diverse Weapons (1.6.1)
    [x] Dynamic Skies (2.1.1)
    [x] Dynamic Skies - Pixel Edition (2.1.1)
    [x] Fixed Dungeon Exteriors (1.41)
    [x] Interesting Eroded Terrains (1.3)
    [x] TravelOptions (1.9)
"
2171745920,mods list search,petchema,2024-11-11 01:23:27+00:00,,"{'enhancement': 1, 'UI': 1}","Mod list search (#2705) implementation

At first I tried to implement view filtering (only display mods that matched), but that made the semantic of ""increase mod order"" and ""decrease mod order"" buttons... complicated. Also, the mod manager relies heavily on several arrays using the same indices, so it was almost intractable.

So I implemented a simpler search; Within the UI components limitations, I added a text field, and ""up"" and ""down"" arrow to find the previous and next match. It's serviceable."
2144593473,camera clamping fix,ArshvirGoraya,2024-10-24 21:54:02+00:00,,{},"# Fix Camera pitchMin and pitchMax Clamping
## Problem:
Expected behaviour of `pitchMin`: limits how far you can look down.
Expected behaviour of `pitchMax`: limits how far you can look up.

Current Behaviour: Whichever value is closer to 0, sets both the minimum and maximum of how far the camera can look up/down.

Example:
- `pitchMax = 10` and `pitchMin = -90`: look up to 10, but can only look down to -10 (even with pitchMin set to -90).
- `pitchMax = 90` and `pitchMin = -10`: look down to -10, but can only look up to 10 (even with pitchMax set to 90).
## Why its Happening:
This happens because the code clamps the pitch value **twice**. Inside the `update()` and in `Pitch`'s setter function.
This wouldn't be a problem if we weren't also switching the value's sign before the setter function, which results in the value being clamped in its sign-flipped state as well as its normal state.
### Examples
**Positive Value:**
```CS
lookTarget.y = 90
pitchMax = 90
pitchMin = -20
... // Update:
lookTarget.y = Mathf.Clamp(lookTarget.y, pitchMin, pitchMax) // lookTarget.y = 90
Pitch = -lookTarget.y // In actual code we use -lookCurrent.y, which is just lookTarget.y, after smoothing is applied
... // Setter:
public float Pitch
{ set {
    // value = -90: sent here after its sign is flipped
    value = Mathf.Clamp(value, pitchMin, pitchMax) // value = -20. Should be 90.
  }
}
```
**Negative Value:**
```CS
lookTarget.y = -90
pitchMax = 90
pitchMin = -20
... // Update:
lookTarget.y = Mathf.Clamp(lookTarget.y, pitchMin, pitchMax) // -20.
... // Setter:
// value = +20
value = Mathf.Clamp(value, pitchMin, pitchMax) // value = 20. Should be -20.
```
## Solution:
Remove the `Mathf.Clamp()` call inside the setter function. The update function clamps this value anyway, so the clamping is still working, but just on Update().

A problem with this solution is a mod may rely on the clamping in the setter function, not the Update(). So, an alternative solution may be better. Otherwise, those mods would have to update (e.g., clamp the value themselves before assigning to `Pitch`)."
2124304141,Add TextScale property to ToolTip,ArshvirGoraya,2024-10-15 04:24:09+00:00,,{},"I got a request for one of my mods to be able to scale the text of tool tips (specifically in the exterior automap).

I couldn't find an easy way of doing this so I created this property. This property is also in other files such as TextLabel.cs, and works the same way.

This lets me adjust the ToolTip scaling very easily for individual ToolTips."
2121499400,Add OnTransportModeChanged event to TransportManager,ajrb,2024-10-13 15:20:13+00:00,,{},"This is an simpler alternative way to add a OnTransportModeChanged event to the TransportManager which provides the new and old transport mode after all the changes have been made, providing mods with all of the info required to post-manipulate the mode as desired.

The only oddity is with ship as this isn't really a transport mode, just a toggle teleport that was added to the others. When moving to ship it will be to Foot and when returning it'll be to Ship.

This is intended as an alternative to both PR's #2692 and #2694 and I would appreciate if @ArshvirGoraya could check whether this meets their needs and report back if additional info is needed for some use case?
"
2092800954,Make building replacements compatible with RMB replacements,drcarademono,2024-09-26 05:22:59+00:00,2025-02-05 19:04:58+00:00,{},"Currently modded building replacements and modded RMB replacements are incompatible. Whenever a mod tries to change a building in a modded RMB, the building's metadata is changed but the exterior and interior remains unchanged. This is an especially big problem for unmaintained building replacement mods like Tavern's Redone and Soldier's Luxury, which are incompatible with newer RMB replacement mods like Cities Overhauled and Beautiful Cities.

This PR fixes these incompatibilities by applying building replacements in RMBLayout, after applying RMB replacements. It modifies the method GetLocationBuildingData, in which building replacements change metadata, so that it also changes RMBSubRecords.

Everything appears to be working as intended upon testing. Buildings are replaced in modded RMBs exactly as they would be were the building replacement affecting a vanilla block. Both interior and exterior data (as with Lively Cities) works correctly. Factions (like Archaeologists Guild) work correctly and appear in blue on the automap. Named buildings like taverns still get their metadata from the location data after the building replacements are applied, so their nameseeds and quality etc are correct. This PR also appears to be robust to modded RMBs with many buildings deleted (ie Beautiful Villages); no NullReferences or Index out of range occurred."
2067642034,"Add More Substantial Override Paths For Physical Combat, 9/11/2024",magicono43,2024-09-12 02:53:05+00:00,,{},"The idea behind these changes is to allow for much more of the vanilla behavior for the physical combat systems to be circumvented if a modder chooses to, the override methods in FormulaHelper being there so they can also do whatever actions they want to instead. In this instance hopefully with as little impact on other parts of the code and execution as possible, 9/11/2024.

My current desire for these is that just overriding the CalculateDamage method does not all suppression of vanilla stuff that happens regardless of what is changed in that damage calculation method, things such as sounds being played being the most notable one, and others as well.

Note: I don't know why in Github Desktop said CRLF was used instead of LF, my IDE said everything was in LF when I was doing these changes. Hopefully that is not an issue and can be corrected if necessary."
2059933316,"Removed the ""protected internal"" keywords from the DaggerfallTravelPopUp.EndPos setter.",RedRoryOTheGlen,2024-09-09 00:19:59+00:00,2025-01-02 20:58:28+00:00,{},"Allows mods to change the endPos of DaggerfallTravelPopUp.

[Video](https://streamable.com/o0a2f8) of proof-of-concept fast travel encounter mod I was working on. If it decides to roll an encounter, it will change the destination of the travel in the DaggerfallTravelPopUp.OnPreFastTravel event. Nothing fancy. This threw me for a loop because it pretty much worked flawlessly as a virtual mod and only caused an error when building the DFMOD."
2047396627,Transport Manager Events,ArshvirGoraya,2024-08-31 00:02:36+00:00,2024-10-23 22:38:54+00:00,{},"# Add Events for Transport Mode Changes

Adds events inside of ""TransportManager.cs"" and triggers them inside the UpdateMode method.

- OnTransportModeChanged 
  - Usage: `TransportManager.OnTransportModeChanged += TransportManager_OnTransportModeChanged;`
  - A simple event that is raised when the TransportMode changes. Has the new TransportMode value as a parameter.
- OnTransportModeShipChanged 
  - Usage: `TransportManager.OnTransportModeShipChanged += TransportManager_OnTransportModeShipChanged;`
  - An event that is raised when the transport mode is changed to or from ship. Has a ToShip or FromShip parameter to indicate if we are warping to the ship or out of it.

Why have a separate event for the ship?

- The code doesn't handle the ship mode like the others. It sets it to foot immediately after the ship is warped into or out of. This can be problematic if a developer makes some [mod](https://github.com/ArshvirGoraya/Remember-Transport-Mode) that sets the `TransportMode` to something right after warping to the ship. Whatever they set it to will be overwritten by the automatic ""foot"" transport mode set by the code. So an event specifically for the ship is better for those cases as those will only be raised when the ship has been warped to/from and after the foot transport mode has been automatically set. It ends up being much cleaner for any code that needs to run right after the TransportMode is set to the ship.

It may also be useful to have an event like ""ChangingFromTransportMode,"" to let developers know when the TransportMode is changing away from something. I haven't added this however, since a nice alternative is just creating an accessible variable called PreviousTransportMode, which they can check whenever the above `OnTransportModeChanged` is fired. This isn't needed for my mod specifically, but I thought it was worth mentioning as it may be useful for others. "
2040716225,Auto-Dismount After OnPreTransition,ArshvirGoraya,2024-08-28 00:19:25+00:00,2024-10-23 22:38:36+00:00,{},"# Auto Dismount AFTER OnPreTransition

For a mod, I wanted to use the `OnPreTransition` event listener defined in ""PlayerEnterExit.cs"" to know what the `TransportMode` was prior to transitioning into an interior. However, ""TransportManager.cs"" automatically sets the `TransportMode` to foot on this event. So, what the `TransportMode` was prior to the transition isn't able to be known by any `OnPreTransition` event listeners after that one has been triggered, and the workaround for this isn't as performant as just checking what the `TransportMode` is on this event.

In my opinion, it makes more sense semantically for the `OnPreTransition` event to be able to access what the `TransportMode` was pre the transition. 

Therefore, this PR simply sets the `TransportMode` to foot in the ""OnTransitionInterior"" events instead. 
 - The ""OnTransitionExterior"" events aren't added as we can't change the `TransportMode` inside, so when we exit, we will already be on foot and don't need to auto dismount.

The changes in this PR shouldn't change anything for the player and there doesn't seem to be any problems in my play testing. There is nothing in the code that relies on the `TransportMode` being set to foot on the `OnPreTransition` event, so nothing should break. 

Ultimately, it would be nice to allow developers and modders to know what the `TranportMode` is prior to transitioning into an interior using the `OnPreTransition` event, and not require a less performant workaround. "
2026653081,Fixed binary incompatibility introduced by #2632,KABoissonneault,2024-08-20 01:14:03+00:00,2025-01-04 23:33:11+00:00,{},"While the changes introduced by #2632 do not require users to change their source to work (API compatible), it does prevent mods compiled on another DFU version from working (ABI incompatible).

For example, Jagget tested current master on v1.1.1, and got the following error:
```
System.MissingMethodException: single DaggerfallWorkshop.Game.Banking.DaggerfallBankManager.get_goldUnitWeightInKg()
  at Game.Mods.UncannyUI.Scripts.UncannyInventoryWindow.UpdateLocalTargetIcon () [0x0001e] in <73871b0f6c3841c4ab7a9171904397a8>:0 
  at Game.Mods.UncannyUI.Scripts.UncannyInventoryWindow.Setup () [0x00614] in <73871b0f6c3841c4ab7a9171904397a8>:0 
  at DaggerfallWorkshop.Game.UserInterfaceWindows.DaggerfallBaseWindow.Update () [0x00069] in <10d69f57d88e45598ab36ac2d243732c>:0 
  at DaggerfallWorkshop.Game.UserInterfaceWindows.DaggerfallPopupWindow.Update () [0x00000] in <10d69f57d88e45598ab36ac2d243732c>:0 
  at DaggerfallWorkshop.Game.UserInterfaceWindows.DaggerfallInventoryWindow.Update () [0x00000] in <10d69f57d88e45598ab36ac2d243732c>:0 
  at Game.Mods.UncannyUI.Scripts.UncannyInventoryWindow.Update () [0x00000] in <73871b0f6c3841c4ab7a9171904397a8>:0 
  at DaggerfallWorkshop.Game.DaggerfallUI.Update () [0x000d8] in <10d69f57d88e45598ab36ac2d243732c>:0 
```
Without changing his code, the code now relied on the `get` from `goldUnitWeightInKg`, which did not exist in v1.1.1. This is not an issue, since mods don't have to support older versions. But it does show that the opposite problem would occur if a mod expected a `const` and found only a `get`.

See 44b829bb659f66374b7c301503 for reference. 

I reintroduced goldUnitWeightInKg as an obsolete constant (warns if users recompile their mods without changing to the new variable), and changed the new variable to 'goldItemWeightInKg'"
2024912016,"Removes totem delivery to foes during ""Who Gets the Totem""",JayH2971,2024-08-19 06:42:18+00:00,2025-01-02 20:54:56+00:00,{},"See bug report here: https://www.reddit.com/gallery/1evrwhg . Handing over a nonexistent totem is a separate problem, and will require a more complicated fix. Not as urgent."
2023715871,Fix game HUD too low on narrow (<16:9) resolutions,petchema,2024-08-16 23:09:04+00:00,,"{'bug': 1, 'UI': 1}","All the HUD expect NativePanel to be aligned on the top of the screen, which is not the case for resolutions narrower than 16:10 (the ratio of 320:200). Explicitly align it to the top.

Forums: https://forums.dfworkshop.net/viewtopic.php?t=6769"
2023592331,Allow guild quests to be dispensed by player level as well as rank,ajrb,2024-08-16 20:50:06+00:00,2024-12-23 19:13:13+00:00,{'classic variance': 1},"Guild quests can be dispensed by player level as well as rank if minReq is <10 depending on the guild implementation. Proposed alternative to #2678 .

Enabled for Mages Guild and Knightly Orders.

Will add for Witch Coverns if evidence from classic Daggerfall is provided that contradicts https://en.uesp.net/wiki/Daggerfall:Witch_Covens

Only other thought is whether this change should have a way to disable this for players who prefer how DFU 1.0 currently works. Happy to add a setting or ini file property if you think worthwhile, @KABoissonneault & @petchema ?"
2021988298,Allow to close console with Escape key,petchema,2024-08-15 23:52:51+00:00,2024-12-23 18:11:55+00:00,"{'UI': 1, 'refinement': 1}","Saw a streamer struggle twice because he opened the console unintentionally and had no idea how to close it, so closed and restarted the game instead.

Unless there's any inconvenience, I think it would be best to enable by default an already existing feature of the console: allow to close it with the Escape key in addition to the console toggle key.

(some additional fixes required because of bit rot)"
2021919634,Handle being silenced during casting animation,petchema,2024-08-15 22:23:46+00:00,2024-12-23 17:24:48+00:00,{'bug': 1},"If player is silenced, only readySpell is reset by SilenceCheck(): https://github.com/Interkarma/daggerfall-unity/blob/master/Assets/Scripts/Game/MagicAndEffects/EntityEffectManager.cs#L1941

If this happens during spellcasting animation, castInProgress is true, and stays at true after the animation is finished because the first thing PlayerSpellCasting_OnReleaseFrame() checks is whether readySpell is not null:
https://github.com/Interkarma/daggerfall-unity/blob/master/Assets/Scripts/Game/MagicAndEffects/EntityEffectManager.cs#L2101

Consequently, player cannot cast spells until (s)he reload a game.

This PR resets castInProgress unconditionally at the beginning of PlayerSpellCasting_OnReleaseFrame(), which is consistent with the animation being over.

Forums: https://forums.dfworkshop.net/viewtopic.php?t=6763"
2015952611,Allow for longer names in location picker,petchema,2024-08-12 22:10:03+00:00,2024-10-25 00:33:27+00:00,"{'UI': 1, 'refinement': 1}","Answer to request #2684

- set limit to 50 characters instead of 29 when SDF fonts (that are narrower) are enabled;
- make that limit more accessible to modding (did I get that part right? I'm not familiar with that aspect)
"
2006863623,Always display negociated prices,petchema,2024-08-06 21:58:41+00:00,2024-10-12 17:15:12+00:00,"{'enhancement': 1, 'UI': 1}","When trying to buy from a shop and not having enough gold to pay the negociated price,

In classic Daggerfall:
- displays the same dialog box as usual, with merchant negociated price message, and Yes/No buttons;
- if you click on No, dialog box just closes;
- if you click on Yes, a message box ""You don't have enough gold"" is displayed

In Daggerfall Unity:
- you get the message box ""You don't have enough gold""

So you never learn the negociated price, and how far you are from being able to afford buying what you are interested in.

This PR replaces the ""You don't have enough gold"" message with the merchant negociated price message."
2002304073,Remote dungeons type selection with fallbacks,petchema,2024-08-04 00:05:25+00:00,,"{'enhancement': 1, 'wip': 1}","Currently, for a dungeon required for a quest, a quest writer can either pick a dungeon type, or just any random dungeon. If a dungeon type is specified but no dungeon of that type can be found in the current region, the engine picks a random dungeon instead.

That fallback means sometimes the quest writer intentions are not followed, including some very bad cases in my opinion (reward map for a rare dungeon type that can be replaced by a map for a random dungeon).

So this PR removes the automatic fallback to ""any dungeon"". On the other hand, it introduces the possibility to provide more than one target dungeon type, as a list:

```
   Place _someplace_ remote dungeonA,dungeonB,..,dungeonC
```

The engine will pick in priority dungeons of type dungeonA, then dungeonB, etc, enlarging the pool of dungeons to select from until it reaches the new setting DungeonsPoolSizeTarget (default 3), or no more fallback types have been specified.

Of course, ""dungeon"" can be specified as a last fallback type to get the equivalent of current Daggerfall Unity behavior for some place.

DungeonsPoolSizeTarget=0 will totally disable the fallback mechanism 
DungeonsPoolSizeTarget=999 (or large values in general) will take all fallback dungeons into consideration no matter what, if player prefers randomization over quests consistency.

I also edited existing quests to benefit from this feature, but did not spend a lot of time carefully picking the best set of dungeon types for each one, so there's more likely room for improvement."
2001658941,Fix enemies sometimes hearing thru walls,petchema,2024-08-03 00:30:14+00:00,2024-10-06 22:15:14+00:00,{},"
Previous code checked that the first obstacle between an enemy and its target was an object tagged ""static"" to determine if the enemy could hear the target (followed by a distance check).
In some cases that allowed enemies to hear targets when they shouldn't (other static tagged objects along the ""line of hearing"" not checked), leading to enemies facing walls or still chasing enemies thru walls when you encounter them.

This PR first checks for distance to target (like CanSeeTarget() does), then checks if they're no object tagged static inbetween the enemy and its target.
As an optimization, only objects on layer ""Default"" are considered, and Physics.RaycastNonAlloc() API is used to lower memory allocations.

Forums: https://forums.dfworkshop.net/viewtopic.php?t=6759"
1995275766,Fix spell absorption capping,petchema,2024-07-30 22:35:55+00:00,2024-10-05 01:53:25+00:00,{'bug': 1},"When absorbing magicka from own spells, DFU explicitly ensures that magicka recovered is not larger than the magicka that was used. For this, it needs to track how much magicka was spent for the last spell: lastReadySpellCastingCost

A special case was not correctly handled though: when the last spell came from a magic item, lastReadySpellCastingCost should be set 0 so that next absorption of own spells is not capped.
That worked by luck when the game was just started because lastReadySpellCastingCost was still 0, but broke after first spell casting.

Forums: https://forums.dfworkshop.net/viewtopic.php?t=6755"
1985729591,Control-U during character class creation resets bonus pool,petchema,2024-07-24 15:36:25+00:00,2024-10-12 16:38:56+00:00,{'classic variance': 1},"Classic Daggerfall uses plain U key, but since in Daggerfall Unity the class name input field always has focus, that key would add an U character to the class name instead.

Remark: Under Linux, keyboard handling behaves a bit differently in the Unity Editor and in the Standalone Player: standalone player filters out control characters, while the editor does not, adding a ""?"" in the class name when Control-U is pressed. They could be filtered explicitly:

```diff
diff --git a/Assets/Scripts/Game/UserInterface/TextBox.cs b/Assets/Scripts/Game/UserInterface/TextBox.cs
index 9da458cef..6d660339f 100644
--- a/Assets/Scripts/Game/UserInterface/TextBox.cs +++ b/Assets/Scripts/Game/UserInterface/TextBox.cs @@ -453,6 +453,14 @@ namespace DaggerfallWorkshop.Game.UserInterface
                         }
                     }
                 }
+                else // !numeric
+                {
+                    // Filter control characters
+                    if ((int)character < 0x20)
+                    {
+                        return;
+                    }
+                }

                 // For upper only, force everything to caps
                 if (upperOnly)
```
but it seems less risky to just be aware of this small problem happening in the Editor only.
(just tested that the problem doesn't occur under Windows)."
1979632437,Receice quests from MG and Knights based on either rank or level,petchema,2024-07-20 20:31:04+00:00,2024-08-16 22:15:12+00:00,"{'classic variance': 1, 'wip': 1}","In classic Daggerfall, Mages guild and knightly orders can provide quests not only if the player's rank is sufficient, but also if his/her level is sufficient. This PR implements this behavior.

This uses a bit in FactionData's flags, so I think it could be set by mods too.

I provided stubs for mods backward compatibility, even if I don't know if any mod overrides QuestListManager.GetGuildQuest() or QuestListManager.GetGuildQuestPool()

Remark: FACTION.TXT is parsed then cached in FactionData.txt in saves, so you may have to edit or remove FactionData.txt to get updated faction data?

Forums:
https://forums.dfworkshop.net/viewtopic.php?p=68013#p68013
https://forums.dfworkshop.net/viewtopic.php?p=43591#p43591"
1956292462,Refactor FormulaHelper to read racial resistances,numidium,2024-07-07 03:12:37+00:00,2024-10-05 01:31:02+00:00,{},"FormulaHelper previously applied racial resistances by reading the player's race directly. With this change, the saving throw calculation will be modified by the contents of the player's RaceTemplate.

Addresses the following issue:
https://github.com/Interkarma/daggerfall-unity/issues/2660"
1955771739,Use magic items at range while silenced,petchema,2024-07-06 00:26:05+00:00,2024-08-11 00:43:57+00:00,{'classic variance': 1},"In classic you can use all magic items while silenced, but in Daggerfall Unity you couldn't use magic items at range, because while silence lets you ready magic items, it does not let you release their spells.
Most likely an overlook.
    
Also, SilenceCheck() can do side effets (display ""You are silenced"" and reset readied spell), so when used with short-circuited logic operators, order matters and it should be placed late/last.
    
Forums: https://forums.dfworkshop.net/viewtopic.php?t=6725"
1955384769,Reverse order of merchants selling quotes,petchema,2024-07-05 15:41:23+00:00,2024-07-20 22:24:14+00:00,{'bug': 1},"Buying and selling dialogs are in reverse order of ""success"" in the resources, fix how offset is computed.

Light testing with a character with low mercantile and personality skills, messages when selling stuff went from ""I'm losing my shirt"" to ""take it or leave it"", which felt more in line. More testing welcome. 

Forums: https://forums.dfworkshop.net/viewtopic.php?t=6723"
1952614751,Fixed error during GetCourtOfCurrentRegion query in Mournoth,KABoissonneault,2024-07-04 00:34:33+00:00,2024-08-09 20:38:22+00:00,{},"In FACTION.TXT, you can find 44 factions of the ""Court"" guild type. Out of these, 43 have the social group Nobility - we have only one exception, the Court of Mournoth.

```
    #567
    type: 14
    name: Court of Mournoth
    rep: 0
    summon: -1
    region: 53
    power: 51
    face: -1
    race: 2
    flat: 183 3
    flat: 183 9
>>> sgroup: 2
    ggroup: 15
    flags: 0
    minf: 20
    maxf: 80
```

As documented at the top of FACTION.TXT, 
```
; The field sgroup should be set to one of the following values:
; COMMONER	0
; MERCHANT	1
; SCHOLAR	2
; NOBILITY	3
; UNDERWORLD	4
```
sgroup of 2 is Scholar.

In DFU's search for the current region's Court, it specified that the faction it's looking *has* to be Nobility. This is an unnecessary restriction, and causes the Scholarly Court of Mournoth to fail to return here, causing an exception to be thrown. 

This PR simply allows all social groups to be considered a court, as long as it's of the regional guild group and the court faction type"
1945862328,Fix more one-way staircases,petchema,2024-06-30 09:00:09+00:00,2024-08-10 19:09:16+00:00,{'classic bug': 1},"Forums:
https://forums.dfworkshop.net/viewtopic.php?t=3482 (original) 
https://forums.dfworkshop.net/viewtopic.php?t=6720 (new)"
1932823867,Add the use of grammar processors,Daneel53,2024-06-21 16:54:27+00:00,,{},"Create two scripts with new classes into Game/Localization and add calls to grammar processor methods into nine existing scripts that display text to screen.
See issue #2656 for explanation."
1925268762,Preserve enemy orientation when hit by the Wabbajack,petchema,2024-06-17 23:27:03+00:00,2024-08-07 18:59:57+00:00,{'classic variance': 1},"A new gameObject is actually created for the transmuted enemy, facing north. Keep the orientation of the replaced gameObject instead.

Test: you can give yourself the Wabbajack by typing ""addArtifact 6"" in the console

Forums: https://forums.dfworkshop.net/viewtopic.php?t=6709&sid=e5aade01a84f5052bc8b32e13e7ee934
"
1903687320,Fixed the Mod Loader Interface Window's Extract Text in Portable Inst,KABoissonneault,2024-06-04 20:18:43+00:00,2024-08-07 17:49:28+00:00,{'bug': 1},"See issue at #2661.

I did a search for `Application.persistentDataPath`, it should be the last one"
1877339813,FPS Weapon Movement variable,RedRoryOTheGlen,2024-05-19 23:52:58+00:00,2024-08-09 20:39:34+00:00,{},"Adds an Offset variable that lets other scripts move the FPS Weapon sprite while preserving the original weaponPosition variable, mostly made to support mods that add weapon sway/bob.

 [SAMPLE](https://streamable.com/p2o26c) of Offset working with mod (not included)

If nothing tries to change the FPSWeapon Offset, it should behave entirely like usual. I hope. Suggestions for better implementation are always welcome."
1867693031,Update DFU version and addressables,KABoissonneault,2024-05-13 23:15:36+00:00,2024-05-14 02:03:46+00:00,{},Files for the v1.1.1 release
1855102665,Quest item resource mod support,ajrb,2024-05-05 17:43:13+00:00,2024-08-07 02:05:53+00:00,"{'enhancement': 1, 'mod system': 1}","This adds a new format for defining items in quest scripts enabling creation of modded items that have classes. The new form is:

`Item _thing_ item class 27 template 512`

The class specified is only used if the templateIndex isn't registered, otherwise it uses the item class.

Also fixed a code error that had not been spotted because it didn't cause any issues until I added this form."
1845864359,Sync To Head,Misunderstood-Wookiee,2024-04-29 14:25:09+00:00,2024-04-29 14:30:08+00:00,{},
1828556093,Fix for QuestListsManager.GetQuest,Jagget,2024-04-18 01:37:08+00:00,2024-05-08 15:48:40+00:00,"{'questing': 1, 'mod system': 1}","QuestListsManager.GetQuest() will check mods for quests as well.
I removed `if (File.Exists(questFile))` check, because `LoadQuest()` function also checks for that, and more importantly, checking mods for quest files included.
Then, if we didn't find any, we proceed as usual."
1824529664,Add %pg4 for missing pronoun His/Hers,Jagget,2024-04-16 04:16:07+00:00,2024-08-07 02:05:21+00:00,{},"This is part for player-realted pronoun. Other languages need that part.
Didn't address this in commit 83ce86660e39021e4682c0b8ff5ca730efa4b266
His/Her is represented by %pg3, but there was no equivalent for His/Hers.
This is now represented by %pg4.
""pronounHers"" text already available in localization tables."
1822018040,Improve custom door support for custom models,ajrb,2024-04-14 16:15:24+00:00,2024-06-27 00:13:23+00:00,"{'enhancement': 1, 'mod system': 1}","Improve custom door support for custom models, enabled for building exterior / interior and dungeon exterior doors. CustomDoor now creates its own StaticDoor data same as any DF model StaticDoor, allowing completely new custom models using non-classic model id's to be supported. 

Retained the existing copy mechanism that uses the boxcollider to test for a hit and the copied door data. This copy mechanism has been retained for backwards compatibility, code could be simplified if it were removed. I don't think it's that useful anymore. If any published mods use CustomDoor then they should continue to work identically as long as the copy index was set.

Player placement for both entering and exiting is now correct. The exception is when replacing a classic model with all building doors disabled in favour of custom doors all copying these classic doors.

Included 2 boxcollider presets for custom doors facing X or Z with standard DF door size 1.25, 2, 0.5. They're in Assets/Editor/ because Unity insisted they went in Assets folder and that seemed the most appropriate place. Will remove from PR if requested.

Ninelan will be testing this out to check my testing didn't miss anything. Instructions added to the wiki here: https://github.com/Interkarma/daggerfall-unity/wiki/Custom-Doors

Resolves #2643 "
1819980275,Enable variant custom guilds,ajrb,2024-04-12 11:29:02+00:00,2024-06-27 00:56:38+00:00,"{'enhancement': 1, 'mod system': 1}","Try creating guild using variant so that custom guilds can have sub-groups like Temples and Knight Orders do.

Also entended the guild groups enum so we have plenty of guild entries available. Pretty sure this has no detremental effect."
1819970307,Fix expiring equipped items not adjusting armorvalues,ajrb,2024-04-12 11:24:30+00:00,2024-04-12 17:10:18+00:00,{'bug': 1},"Fixes issue #2640.

I think this should go into 1.1 since it's a clear fix of broken functionality and the blast radius is miniscule."
1814714772,Add limited RMB Editor / World Data Editor integration ,drcarademono,2024-04-09 18:22:50+00:00,2024-08-06 23:02:48+00:00,{},"While the RMB and World Data Editors are both quite functional, in their current implementation they are poorly integrated. For example, if a modder is editing a temple RMB and wants to edit the temple's interior, the modder would first have to export the temple to a building file, which requires a number of clicks through file paths, assigning that temple a name, etc. Then the modder would open the temple building file in the WDE by once again clicking through file paths, then after modifying the building, the modder would have to save the building file, then import it again in the RMB Editor. In sum, modifying any building in the RMB Editor requires navigating _four_ separate Import/Export File dialogue boxes.

This PR would reduce that to zero. It adds two buttons the RMB Editor. The top right ""WDE"" one immediately opens the selected building in the World Data Editor. The bottom ""Import from WDE"" button imports the building right back from the World Data Editor. No need to mess with jsons or remember which filename is which.
![image](https://github.com/Interkarma/daggerfall-unity/assets/73616371/d6b4849d-1aef-4678-8ef3-90a74254a494)

Just click the building, click WDE, and it's open:
![image](https://github.com/Interkarma/daggerfall-unity/assets/73616371/278b3137-bdef-4323-a674-63d201164d35)

Make your changes in the WDE, go back to the RMB Editor, click the building again, click ""Import from WDE,"" and your changes to the building interior are now in the RMB:
![image](https://github.com/Interkarma/daggerfall-unity/assets/73616371/9c654062-b4cb-4b95-95f3-77e942f258d0)

This implementation is a little less direct than it perhaps could be, as I couldn't figure out how to pass the building interior data directly from the RMB Editor to the WDE Editor and back again. Instead the PR writes the building to a temporary json which the WDE opens, and the WDE likewise writes a temporary json that the RMB Editor opens. In each case the json is deleted immediately after being open so it shouldn't leave any clutter behind."
1813088408,Update DFU version and addressables,KABoissonneault,2024-04-08 23:03:41+00:00,2024-04-10 16:35:23+00:00,{},"Before, @Interkarma used to push these himself on each release. I suppose I have to do this through a PR now.

There's some extra files, ones that get generated or modified when making a DFU build. IK used to make the builds on Cloud machines, so those files would have ended up on those machine's repos. But I don't see why we shouldn't just include them for everyone. For example, we have BurstAotSettings_StandaloneWindows.json, but not the ones for OSX and Linux."
1812277670,Fixed book mapping contributes not being detected on Windows,KABoissonneault,2024-04-08 14:32:06+00:00,2024-04-08 21:24:08+00:00,{},"Fix for #2636.

Before #2580, we used to leave contributes untouched if no contributes were detected. Instead now, we always update contributes, removing files that are not detected by the function.

Detection of book mappings has always been broken on Windows. The path returned by `Path.GetDirectoryName` uses `\` to separate paths, but the check for Books/Mapping checked with a forward slash.

I instead changed this function to properly detect the path Books/Mapping on any platform. As a result, the books should now properly be detected on Windows, and updating the mapping should always give the correct result."
1810947632,Allow other transportation items to be added by mods,ajrb,2024-04-07 18:51:37+00:00,2024-06-18 01:36:25+00:00,"{'enhancement': 1, 'mod system': 1}","- Allows custom transportation items to be contributed by mods and actually have a chance to appear in shops.
- Allow new horses to enable the horse transportation option. (this could be done for carts as well if desired, but I don't think people really use this much so won't want to add any new ones)
- Allow custom items to have animated icons in inventory. (bugfix)"
1810765227,Add Contextual Macros for Capitalized Gender-Specific Pronouns,Mentill,2024-04-07 10:14:01+00:00,2024-08-06 19:53:11+00:00,{},"Some quest dialog and strings include GSP (gender-specific pronoun) macros (e.g. %g1). However, the macro handler always makes these lower-case, which is improper at the beginning of a sentence, in English at least.

Instead of making GSP macros always capitalized, and unnecessarily deifying characters, it makes more sense to capitalize only the ones at the beginning of a sentence. I found an earlier proposal which suggested code changes to detect when one is used at the beginning of a sentence. However, this detection becomes problematic when accounting for whitespace, unusual punctuation, and other languages whose sentences may end with different symbols.

Therefore, I added new macros which capitalize the first letter of the GSP, which can be placed in quest/string files as needed to replace GSPs found at the beginning of sentences. I plan on modifying - if this is merged - my upcoming quest dialog improvements, in order to utilize these new macros.
I tested all these new macros and they do work; macro names are case-sensitive."
1810494648,Move the hardcoding of items that don't encumber into templates,ajrb,2024-04-06 18:18:36+00:00,2024-04-07 15:04:06+00:00,{},"This allows mods to change arrows so that their weight counts towards encumbrance. A mod to do this would consist of a single file ItemTemplates.json with the following entry:

```
{
    {
        ""index"": 131,
        ""hasNoEncumbrance"": false
    }
}
```"
1810404534,Replace PC Gold Weight Literal With Loaded Value,Mentill,2024-04-06 13:28:30+00:00,2024-08-06 15:48:42+00:00,{},"The weight of Gold Pieces in the player's inventory is stored in DaggerfallBankManager.cs as a literal value. This change instead indirectly loads it in from the itemTemplates array set in ItemHelper.cs

The intended result is that it thus exposes to mods the weight of gold pieces in the player's inventory, which it does according to my tests. It also appropriately affects certain transfers of gold pieces."
1800244857,Added pet that follow you and give you hp potion when your HP < 25%,Daynero,2024-04-01 10:37:39+00:00,2024-04-01 12:41:24+00:00,{},
1798817990,Update Unity for Visual Studio Code support,petchema,2024-03-30 08:02:48+00:00,2024-04-06 17:40:35+00:00,{'editor': 1},"Just followed instructions given by the ""Unity for Visual Studio Code"" extension for Unity 2019 and Unity 2020:

- Remove the deprecated Visual Studio Code Editor package
- Update the Visual Studio Editor package to at least 2.0.20 (updated to current: 2.0.22)
(- set Visual Studio Code as Unity's External C# editor - was already the case)
- Regenerate project files

I kept the comments added manually in .vscode/settings.json

I think it should have no impact on the game, it's purely for developers' convenience"
1798508688,Switch RGB comments to match palette index colours,ajrb,2024-03-29 20:17:54+00:00,2024-03-30 11:38:38+00:00,{},"As discovered by GhostPutty on discord.

PR#1229 swapped palette colours around but didn't update the RGB comments accordingly."
1798320087,Move the live change warning outside of the settings panel,ajrb,2024-03-29 17:26:06+00:00,2024-03-30 11:38:23+00:00,{},"The warning for changing live settings being inside the panel messes up the careful formatting of the mod settings. I know that for my mods I spend a lot of time getting them looking good.

I also think the message is more obvious not being lost in all of the settings text."
1798015152,Fix drums in custom soundfonts,Kung-vr,2024-03-29 13:48:25+00:00,2024-07-05 02:14:15+00:00,{},"Many soundfonts will only provide percussion on patch 0 of bank 128. This fix allows attempting to fall back to the default percussion patch location when a drum patch is unavailable.

See this comment for an example of the common soundfont bank and patch setup for drums: https://github.com/LMMS/lmms/issues/323#issuecomment-40160617

To verify the problem, try loading this OPL3.SF2 soundfont [OPL3.zip](https://github.com/Interkarma/daggerfall-unity/files/14804912/OPL3.zip) with the current release version and notice the percussion during 5strong.mid is missing in the startup screen. When this fix is applied the percussion will work."
1796198815,No spinning coins on wagon while stealing from shelves,petchema,2024-03-28 14:19:48+00:00,2024-03-30 14:47:11+00:00,"{'bug': 1, 'UI': 1}","If, while stealing from a shelf (during a break in) you look at your wagon, the wagon items should not have the spinning coins animation.
[SAVE9.zip](https://github.com/Interkarma/daggerfall-unity/files/14790931/SAVE9.zip)
"
1789683458,"Daggerfall Proofreading Project, Part 1: String Files (Take Two)",Mentill,2024-03-25 15:30:12+00:00,,{},"This contains ~200 corrections to spelling & grammar errors/typos to the string files (excluding internal_locations.csv), all done by hand.

The Internal_Locations.csv file was copied to the Text folder so it can override the misspelled names normally loaded directly from MAPS.BSA. I didn't go through all ~15k entries, but rather a representative sample since they're procedurally-generated.

Some changes were made to improve consistency. In particular:

- the one message that refers to the Cart was changed to Wagon, to be consistent with every other message; the item name was left alone

- the Pickpocket skill was renamed to Pickpocketing to match the strings, and for consistency with Backstabbing and Lockpicking

- references to Critical Striking were changed to Critical Strike, as that's the skill's current name, which I feel sounds better despite being less-consistent with the other skill names

I wasn't sure how to edit the images in INVE00I0.IMG & INVE01I0.IMG, which contain the rendered 'Wagon' buttons for the inventory screen, or if it were allowable to include modified versions in DFU's loose texture folder. Otherwise, I would've changed every 'Wagon' reference to 'Cart', including that button. I left the Transport menu's 'Cart' button graphic unmodified for the same reason.

It was recommended that I split my project into parts submitted one at a time, so this first part is just the string files. Next will be the quests, of which I corrected typos in ~170 of them; if that's too many, I can split that, too.
I had improved the formatting of the books, but it seems another PR did a better job on that; I didn't proofread many of those, though.
Hopefully I did this all correctly this time, the file diffs all look good to me...

[strings notes.txt](https://github.com/Interkarma/daggerfall-unity/files/14745936/strings.notes.txt)"
1787922824,"Fixed ""PersistentDataPath"" usage in Editor context",KABoissonneault,2024-03-23 19:51:24+00:00,2024-03-29 23:38:34+00:00,{},"Fixed issue caused by #2607.

Before #2607, PersistentDataPath was lazily initialized whenever it was requested. In #2607, I made it get defined on application start. I failed to consider that PersistentDataPath was used in Editor code. Currently, if you open the editor on the latest code, it should throw a null reference exception.

This change turns it back into lazy initialization, so editor code still initializes it."
1787714006,"Daggerfall Proofreading Project, Part 1: String Files",Mentill,2024-03-23 08:04:24+00:00,2024-03-24 18:18:05+00:00,{},"This contains ~200 corrections to spelling & grammar errors/typos to the string files, all done by hand.

The Internal_Locations.csv file was copied to the Text folder so it can override the misspelled names normally loaded directly from MAPS.BSA. I didn't go through all ~15k entries, but rather a representative sample since they're procedurally-generated.

Some changes were made to improve consistency. In particular:

- the one message that refers to the Cart was changed to Wagon, to be consistent with every other message; the item name was left alone

- the Pickpocket skill was renamed to Pickpocketing to match the strings, and for consistency with Backstabbing and Lockpicking

- references to Critical Striking were changed to Critical Strike, as that's the skill's current name, which I feel sounds better despite being less-consistent with the other skill names

I wasn't sure how to edit the images in INVE00I0.IMG & INVE01I0.IMG, which contain the rendered 'Wagon' buttons for the inventory screen, or if it were allowable to include modified versions in DFU's loose texture folder. Otherwise, I would've changed every 'Wagon' reference to 'Cart', including that button. I left the Transport menu's 'Cart' button graphic unmodified for the same reason.

It was recommended that I split my project into parts submitted one at a time, so this first part is just the string files. Next will be the quests, of which I corrected typos in ~170 of them; if that's too many, I can split that, too.
I had improved the formatting of the books, but it seems another PR did a better job on that; I didn't proofread many of those, though.

[strings notes.txt](https://github.com/Interkarma/daggerfall-unity/files/14730803/strings.notes.txt)"
1787256540,Allow faction ruler type to be set by mods,ajrb,2024-03-22 20:19:54+00:00,2024-03-23 14:00:26+00:00,{'enhancement': 1},"This allows changes of rulers to have appropriate title when %rt macro is used. Without this new rulers must be a Lord which is the default. No one is clamouring for this, but I realised that Cliff's change to add a ruler luckily is okay because it's a Lord but in future this could be useful.

Tested this with a bare bones quest script that prints the %rt macro. Happy to supply this if any reviewers want it."
1786526365,"Daggerfall Proofreading Project, Fixing a Litany of Typos",Mentill,2024-03-22 12:54:24+00:00,2024-03-23 04:02:08+00:00,{},"This improves spelling/grammar/typos in 170 quest files, and for ~200 strings in the string files. All proofreading was done by hand.

It also substantially improves the formatting of 84 books, elevating them from illegible to readable. Most of them weren't proofread (but are clearly rife with typos; a project for another day.)

The Internal_Locations.csv file was copied to the Text folder so it can override the misspelled names normally loaded directly from MAPS.BSA. I didn't go through all ~15k entries, rather a representative sample since they're procedurally-generated.

Some changes were made to improve consistency. In particular:
- the one message that refers to the Cart was changed to Wagon, to be consistent with every other message; the item name was left alone
- the Pickpocket skill was renamed to Pickpocketing to match the strings, and for consistency with Backstabbing and Lockpicking
- similarly, the Dragon skill was renamed to Dragonish
- references to Critical Striking were changed to Critical Strike, as that's the skill's current name, which I feel sounds better despite being less-consistent with the other skill names
- Lhotun's dialog now refers to Direnni as living in a tower rather than a castle, given its name on the map screen, and appearance; this should help prevent players getting stuck

I wasn't sure how to edit the images in INVE00I0.IMG & INVE01I0.IMG, which contain the rendered 'Wagon' buttons for the inventory screen, or if it were allowable to include modified versions in DFU's loose texture folder; otherwise, I would've changed every 'Wagon' reference to 'Cart', including that button. I left the Transport menu's 'Cart' button graphic unmodified for the same reason.

[changelog](https://github.com/Interkarma/daggerfall-unity/files/14722631/notes.txt)"
1776134671,Relink children if any new custom factions with parents were added,ajrb,2024-03-17 17:26:30+00:00,2024-03-20 11:53:08+00:00,{'bug': 1},"Missed this back in 2018. If new custom factions are added by mods and they specify parent factions, this needs to be processed by the child linking code FactionFile.RelinkChildren() otherwise it does nothing.

Found this when Cliffworms added a named NPC to Betony - this should be used at the provinces ruler but it wasn't. Will confirm once this has been completely tested. 

Still doesn't help being able to modify existing faction data to, for example, set the ruler value for Betony. Tried some things for that but breakpoints stopped working and I just can't continue today."
1775861703,"Reformat books, use the built-in book formatting.",Jagget,2024-03-17 02:08:27+00:00,2024-07-05 00:42:15+00:00,{},"Working with English version of the DFU I noticed poorly formatted books. Well, most of them have some artifacts. 

Since SDF and non-SDF books in game respect book boundaries and hence could be auto formatted, I want to clean texts.

Nothing fancy, just
* One paragraph is one line
* No multi-spaces
* No extra empty lines.

Before (Broken Diamonds):

![Screenshot 2024-03-16 204922](https://github.com/Interkarma/daggerfall-unity/assets/1652113/088bc54f-05b2-468b-8f28-435c7acbea5a)

After (Broken Diamonds):

![Screenshot 2024-03-16 212352](https://github.com/Interkarma/daggerfall-unity/assets/1652113/86ad250f-ed55-43db-a4fe-39e83370545c)
"
1775226689,Added ability to move UI elements,Jagget,2024-03-16 02:38:26+00:00,2024-04-16 00:05:19+00:00,{},"Continue and expand work, started in https://github.com/Interkarma/daggerfall-unity/pull/2555

Some of the UI windows are already do expose `protected` UI elements, others are addressed here. "
1775210684,City generation stability improvements,KABoissonneault,2024-03-16 02:06:50+00:00,,{},"Throwing an exception during city generation generally has a massive effect on the player. Often, the entire city disappears, and if not, huge blocks are missing.

This PR tackles two city generation exceptions, with the intention of preventing one bad model from destroying the entire city. Instead, we just skip bad objects (but we keep errors in the logs).

# Bad model id

For the first issue, when a modded custom RMB tries to spawn a model (exterior block 3d object record) that doesn't exist, we get this exception

```
NullReferenceException: Object reference not set to an instance of an object
DaggerfallWorkshop.Utility.ModelCombiner.Add (DaggerfallWorkshop.ModelData& modelData, UnityEngine.Matrix4x4 matrix) (at Assets/Scripts/Utility/ModelCombiner.cs:137)
DaggerfallWorkshop.Utility.RMBLayout.AddModels (DaggerfallWorkshop.DaggerfallUnity dfUnity, ...)
DaggerfallWorkshop.Utility.RMBLayout.CreateBaseGameObject (DaggerfallConnect.DFBlock& blockData, ...) DaggerfallWorkshop.Utility.GameObjectHelper.CreateRMBBlockGameObject (DaggerfallConnect.DFBlock blockData, ....)
```

In `RMBLayout.AddModels`, we call `dfUnity.MeshReader.GetModelData(obj.ModelIdNum, out modelData)` with the provided model id num. but we don't check whether the call succeeded or not. If it fails, all the data in `modelData` will be null. This is fine if `MeshReplacement.ImportCustomGameobject(obj.ModelIdNum, parent, modelMatrix)` succeeds on the model id, but if not, we treat it like a classic model, except we don't actually have the data. Hence the NullReferenceException above.

I reproduced this by playing with Fixed Desert Architecture and an outdated ""Daggerfall Expanded Textures"" (the models FDA was using was in 0.6.3, I was on 0.5).

To fix this, I track whether importing the classic data succeeded. If we fail at importing a custom model _and_ we failed at getting the classic data, then I log the error and skip the object.

# Weird error in StaticNPC.SetLayoutData

I got two different callstacks from users where an entire city disappeared after a null access  in `StaticNPC.SetLayoutData(DFBlock.RmbBlockFlatObjectRecord obj, int mapId, int locationIndex)`. This function has three versions, one for dungeons, one for buildings, and one for ""custom"": this is modded static NPCs that exist outside in the city. This is called by `RMBLayout` in two functions: `AddMiscBlockFlats` and `AddExteriorBlockFlats`. We've had the same error occur in from both functions, looking like this.

```
NullReferenceException: Object reference not set to an instance of an object
  at DaggerfallWorkshop.Game.StaticNPC.SetLayoutData (DaggerfallConnect.DFBlock+RmbBlockFlatObjectRecord obj, System.Int32 mapId, System.Int32 locationIndex) [0x0004e] in <52ba1c52c60a4e479fd500dae43b0a6f>:0 
  at DaggerfallWorkshop.Utility.RMBLayout.AddExteriorBlockFlats (DaggerfallConnect.DFBlock& blockData, UnityEngine.Transform flatsParent, UnityEngine.Transform lightsParent, System.Int32 mapId, System.Int32 locationIndex, DaggerfallWorkshop.ClimateNatureSets climateNature, DaggerfallWorkshop.ClimateSeason climateSeason) [0x00194] in <52ba1c52c60a4e479fd500dae43b0a6f>:0 
```

`SetLayoutData` is not a big function. I've looked at it for at least an hour, and I'm confident that the only things that could be null in there are `DaggerfallUnity.Instance` or its `ContentReader` or its `FlatsFileReader`, or `flatCFG.gender`.
I've ruled out the first three, because both `AddMiscBlockFlats` and `AddExteriorBlockFlats` check that `DaggerfallUnity.Instance` is not null and ready before calling this code. 
So it has to be the FLATS.CFG data that has a null in it somehow. I have no idea how it happens, maybe there's a mod out there that uses reflection to slip its own custom data in there.

So I'm doing two things for this issue:
1. Added a null check for the `flatCFG.gender` in `StaticNPC.SetLayoutData`
2. Added a try-catch around this code

The change looks big, but it's really just indenting everything for the try-catch

If I failed to catch the real exception, then at least we avoid destroying the entire city. Generally, I would rather know where the bad data is and how it occurs, but I've never been able to reproduce it. However, two separate users got it with different setups, so I'm sure it's a real issue.

The error message in the logs looks like

```
Error creating exterior block flat obj '2952' of block 'ARMRAL02.RMB' 

NullReferenceException: Object reference not set to an instance of an object
  at DaggerfallWorkshop.Game.StaticNPC.SetLayoutData (DaggerfallConnect.DFBlock+RmbBlockFlatObjectRecord obj, System.Int32 mapId, System.Int32 locationIndex) [0x0004e] in <52ba1c52c60a4e479fd500dae43b0a6f>:0 
  at DaggerfallWorkshop.Utility.RMBLayout.AddExteriorBlockFlats (DaggerfallConnect.DFBlock& blockData, UnityEngine.Transform flatsParent, UnityEngine.Transform lightsParent, System.Int32 mapId, System.Int32 locationIndex, DaggerfallWorkshop.ClimateNatureSets climateNature, DaggerfallWorkshop.ClimateSeason climateSeason) [0x00194] in <52ba1c52c60a4e479fd500dae43b0a6f>:0 
UnityEngine.DebugLogHandler:Internal_LogException(Exception, Object)
UnityEngine.DebugLogHandler:LogException(Exception, Object)
UnityEngine.Logger:LogException(Exception, Object)
UnityEngine.Debug:LogException(Exception)
DaggerfallWorkshop.Utility.RMBLayout:AddExteriorBlockFlats(DFBlock&, Transform, Transform, Int32, Int32, ClimateNatureSets, ClimateSeason)
DaggerfallWorkshop.Utility.GameObjectHelper:CreateRMBBlockGameObject(DFBlock, Int32, Int32, Int32, Int32, Boolean, DaggerfallRMBBlock, DaggerfallBillboardBatch, DaggerfallBillboardBatch, DaggerfallBillboardBatch, TextureAtlasBuilder, DaggerfallBillboardBatch, ClimateNatureSets, ClimateSeason)
DaggerfallWorkshop.<UpdateLocation>d__81:MoveNext()
UnityEngine.SetupCoroutine:InvokeMoveNext(IEnumerator, IntPtr)
UnityEngine.MonoBehaviour:StartCoroutineManaged2(IEnumerator)
UnityEngine.MonoBehaviour:StartCoroutine(IEnumerator)
DaggerfallWorkshop.StreamingWorld:InitPlayerTerrain()
DaggerfallWorkshop.StreamingWorld:Update()
 ```"
1771206312,"Fixed ""Weakens Armor"" enchantment not being applied",KABoissonneault,2024-03-14 02:07:44+00:00,,{},"This PR has 3 changes related to ""Weakens Armor"", last one also including ""Strengthens Armor"".

Two uncontroversial fixes:

# Fixed ""Weakens Armor"" enchantment not being applied.

The ""Weakens Armor"" decreased armor value was just not applied by DFU. In DF, lower armor value is better: players start at 100, and armors reduce the armor value by 5 for each armor class. Therefore, a ""Decreased"" armor value is a +5 malus to Amor Value.

When checking which ""Decreased"" armor value is the worst, we take the bigger value, not the smaller one. Otherwise, the base ""DecreasedArmorValue"" of 0 is always smaller than the +5 of ""Weakens Armor"", and fails to apply the actual debuff.

# Properly apply ""Bad"" color for AC penalty in Paperdoll

The AC value shown in the paperdoll runs backward from the Armor Values used in formulas. AC starts at 0, and goes up when wearing better armors. +1 AC is equal to -5 Armor Value, or -5% chance to hit. So, an increased AC is a decreased armor value and is good. A decreased AC is an increased armor value and is bad.

DFU was not always like this. It used to get them backward until this issue:
https://github.com/Interkarma/daggerfall-unity/issues/1740

and this changelist inverted them.
https://github.com/Interkarma/daggerfall-unity/commit/baa983a83419b1ea1b8db7ac5105c060234331e9

So this old logic in `Paperdoll` was still accidentally thinking DecreasedArmorValue was a negative number - no, it's 0 or +5 (Weakens Armor). IncreasedArmorValue is 0 or -5. We instead add the two modifiers together, like in `FormulaHelper.CalculateArmorToHit`.

![image](https://github.com/Interkarma/daggerfall-unity/assets/5789925/74380052-0c3a-410f-8c25-64ee56762f0b)

The more controversial fix:

# #2342 

I initially reported that the bonus from ""Strengthens Armor"" and ""Weakens Armor"" are inconsistent between the shown AC and the effect on the formula. 
https://github.com/Interkarma/daggerfall-unity/issues/2342

In short, they both give ¬±5 to AC and ¬±5 to Armor Value (Hit). When it comes to the AC and armor value from armor, 1 AC is equal to -5 Armor Value (and therefore -5 Hit). This is inconsistent, either 5 AC should be -25 Armor Value, or -5 Armor Value should be +1 AC shown on the paperdoll.

Since I reported this issue, I tested in gameplay in DF, and this inconsistency is a classic issue. ""Strengthens Armor"" does not have as much of an impact on gameplay as a 25% difference would make.

When I reported this issue, we initially went with changing the effect to ¬±25 Armor Value, 
https://github.com/Interkarma/daggerfall-unity/commit/d0b3b2f7cdd9885b2b7ce8cf3f040407619e1beb

but IK reverted this here. And I now agree with reverting it.
https://github.com/Interkarma/daggerfall-unity/commit/7825c4effabf825cad850932bf64073451758f77

Note: There is a mistake in that changelist's explanation. Daedric's base Armor Value is -5 because 21 AC means -105 Armor Value, and `100 - 105 = -5`. The effect of ""Strengthens Armor"" is an extra -5, not an extra -105. So you go from `100` to `-10`, not `100` to `-110`. ""Strengthens Armor"" is nowhere near as impactful as wearing Daedric Armor, but it does add up.

I still agree with not changing the gameplay impact. However, I would rather we stop lying to players here, especially since it's not easy for mods to fix the Paperdoll display here.

**So instead, I show the AC change as ¬±1**. This does not visually match classic, but it matches it in gameplay, and has no impact on a playthrough otherwise. 
It does mean players will ask about it, and we'll need to send them the patch notes when that happens. Unlike the other DFU changes, this is purely visual.
"
1766992166,PcAt : ActionTemplate support dungeons,Jagget,2024-03-12 01:45:39+00:00,2024-06-18 01:23:42+00:00,{},"In `Quests-Places.txt` records with `p1 == 0` are dungeons but function Place.IsPlayerAtBuildingType() forbids using anything but buildings.
```cs
if (!playerEnterExit.IsPlayerInsideBuilding)
    return false;
```"
1759868873,Removed Deepfighter's localized BIOGs from the repo,KABoissonneault,2024-03-06 22:34:01+00:00,2024-03-07 12:58:10+00:00,{},"Daneel53 has localized DFU in French, and does not rely on DFU's ""Francais"" BIOGs. He says I should remove these. I also asked Deepfighter, and these should be safe to remove. DFU does not use them, localizations don't use them."
1758117998,Fixed TalkManager issue causing missing people,John-Leitch,2024-03-06 04:31:09+00:00,2024-06-14 01:21:35+00:00,{},"This PR covers the following issue: #2604 (1.0: Person fails to appear in ""where is"" talk UI for quest)

A few details related to the issue can be found in my comments on the bug. The appears to stem from `Person.GetAssignedPlaceSymbol` returning `null`. Diving a little deeper, apart from the serialization code, the assigned place symbol is only set via the `Person.SetAssignedPlaceSymbol` method. In turn, that method is called in two spots:

1. The `PlaceNpc` `ActionTemplate`, which handles `place npc` statements.
2. In `Person.PlaceAtHome`, which is itself called in two spots:
a. In `Person.Tick` when `home.IsPlayerHere` returns true. This explains the NPC begins resolving once the player enters its home.
b. The `CreateNpc` `ActionTemplate`, which handles `create npc` statements.

Both `T0C00Y00` and `10C00Y00` (and maybe others) lack `place npc` or `create npc` statements for the NPC in question, thus their assigned place is always `null`.

While this is apparently a regression, searching through the history, I was not able to easily identify the exact revision that introduced this behavior, so was not entirely sure how this case was meant to be handled. Reviewing the code, I noted that `Person.homePlaceSymbol` was set, despite the NPC not being created. As this value is not public, I added the `Person.GetAssignedOrHomePlaceSymbol` method, which `null` coalesces the values. I then updated the appropriate calls in `TalkManager`, replacing `Person.GetAssignedPlaceSymbol` with `Person.GetAssignedOrHomePlaceSymbol`. This appears to work as expected, with the NPC being resolved by map id."
1753517659,Use Redguard names in Redguard lands for named residences,Jagget,2024-03-03 18:42:19+00:00,2024-06-14 00:43:57+00:00,{},"So, most of the Daggerfall is Breton lands. But not all. But in quests, we always see the named residences of Bretons. Even in the Redguard lands. We should use Redguard names in Redguard lands.

Original DOS:
![image](https://github.com/Interkarma/daggerfall-unity/assets/1652113/ba2b03f4-1b23-4800-b5da-6670bc41d2df)

PR effect:
Sentinel
![Screenshot 2024-03-02 222339](https://github.com/Interkarma/daggerfall-unity/assets/1652113/b5b31b67-8a11-4d44-9551-9315027cee3f)

Wayrest
![Screenshot 2024-03-02 222558](https://github.com/Interkarma/daggerfall-unity/assets/1652113/c9e93f08-0bd5-485a-b968-c70c6eb1da55)
"
1753137868,Logs changes,KABoissonneault,2024-03-03 00:17:26+00:00,2024-03-20 21:50:11+00:00,{},"This is my last DFU 1.1 item and the more controversial one, and the one I'm most willing to budge on.

In addition to log reachability (addressed by #2606), I have determined three issues with the default Unity logs.

1. They are extremely noisy. Each line has this appended `(Filename: C:\buildslave\unity\build\Runtime/Export/Debug/Debug.bindings.h Line: 39)` and an extra newline, making logs extremely long and hard to get through
2. There is nothing indicating a normal log from a warning from an error, unless the message repeats that information
3. We cannot relocate the logs to a folder other than `Application.persistentDataPath`. This is an issue for https://github.com/Interkarma/daggerfall-unity/pull/2556

So this changelist aims to make going through user issues easier, and unblocking the Portable Install feature. But it is not without downsides unfortunately.

Concretely, what this changelist does is disable Unity's Player.log, and adds a log handler to the Debug class to create and manage this file ourselves. Doing so is mostly necessary for point 3, we could get the benefits of point 1 and 2 by simply creating a second log file, and leave the normal Unity Player.log untouched. We'll see the downsides of supporting point 3 below.

First, here's what the old logs look like
![image](https://github.com/Interkarma/daggerfall-unity/assets/5789925/0b391ef7-786f-4d25-af96-acb18073a4d2)

Here's what they look like now
![image](https://github.com/Interkarma/daggerfall-unity/assets/5789925/0dfa600c-34a5-48d3-a269-f8a24a380333)

Errors and warnings are shown with a little tag
![image](https://github.com/Interkarma/daggerfall-unity/assets/5789925/a33b0037-b839-470a-9704-36ef6054fe78)

This token is both searchable _and_ can be parsed by code. I saw someone claim they were working on a log viewer for DFU, and this could help them.

Now, for the differences in logs content. Unfortunately, we're losing all the Engine logs, logs of systems that come from the engine. They just don't go through the Debug log handler, and therefore do not appear in our new Player.log file.

I passed two logs through a diff software to show exactly which lines are missing.

We have this header at the top of every log file
![image](https://github.com/Interkarma/daggerfall-unity/assets/5789925/addecda2-e46e-4654-9511-587ff98989b7)

and we have some of the periodic Garbage Collection messages all over
![image](https://github.com/Interkarma/daggerfall-unity/assets/5789925/424b8c0c-6971-415e-88bb-0e1035b550d5)

Here's the warning and error tags again
![image](https://github.com/Interkarma/daggerfall-unity/assets/5789925/d9360929-775d-4654-8df0-8c522eedede6)

Exceptions look slightly different for some reason, but not really meaningfully
![image](https://github.com/Interkarma/daggerfall-unity/assets/5789925/a3851e79-1eb9-4e3d-892f-f6e6785596de)

There was also this message when I closed the game that was gone
![image](https://github.com/Interkarma/daggerfall-unity/assets/5789925/3a1b580c-b975-4bee-a636-527613b3eb06)

So this is what this changelist does for now. I personally don't care much for those Engine logs, so I'm comfortable with this change, but maybe other people might have a different idea.

I was to emphasize that I think supporting the Portable Install feature is good. Without being able to put the log feature in the portable install, the feature is a failure, in my opinion. Through Googling, I could not find anyone researching solutions for portable installs of a Unity game, just the Unity Editor itself. But users do desire it, if only to have different settings for the many DFU versions they run (1.0, test builds, multiplayer, etc). It also helps people who are on a computer they don't own, from a temporary folder that they can easily backup and move around.

So yeah, drop your feedback in the meantime. I'll probably make another test build with all the unmerged DFU 1.1 PRs to get user feedback on a candidate build for 1.1.

PS: I do think we can also get point 1 benefits in other ways than creating a second log file. There's a big thread on this problem here: https://forum.unity.com/threads/debug-log-stacktrace-spam.489858/ (I find it kind of funny)
I think we might have to replace all the calls to `Debug.Log` in the project with `Debug.LogFormat(...)` with the ""NoStackTrace"" option. Or maybe that Stack Trace setting here
![image](https://github.com/Interkarma/daggerfall-unity/assets/5789925/dfaf6d6b-ac72-433e-a617-0a14541565d2)
"
1752336658,"Make the ""Settings"" folder more obvious and clickable",KABoissonneault,2024-03-01 20:17:00+00:00,2024-03-07 01:48:12+00:00,{},"Trying to debug any user issue with DFU or a mod usually runs into this conversation.

""Hey, my game is broken.""
""Can you post logs?""
""Where?""
""... Wait a second"" _searches a bit_ ""Should be in `C:\<User>\AppData\LocalLow\Daggerfall Workshop\Daggerfall Unity`, replace `<User>` with your Windows username. Or you can try copy-pasting `%USERPROFILE%\AppData\LocalLow\Daggerfall Workshop\Daggerfall Unity` in your Explorer. Then...""
_user disappears_

With this change, I'm trying to reduce it to:
""Open DFU, double-click on your Settings Folder, copy-paste Player.log""

This would apply for all other settings and mod data concerns.

Current Title Screen for comparison:
![image](https://github.com/Interkarma/daggerfall-unity/assets/5789925/3cf73eda-fab8-4e4d-bcbd-8fe82b4be74e)

New Title Screen:
![image](https://github.com/Interkarma/daggerfall-unity/assets/5789925/91ec2452-307f-498b-8557-dcff192ed727)

New Title Screen, with Hide Login Name setting enabled:
![image-1](https://github.com/Interkarma/daggerfall-unity/assets/5789925/41462406-b3a2-4aaf-80b4-1bb038cf503f)

I wanted to add ""Settings Folder"" to emphasize what this path was. I couldn't put it on the left, because localization would make the alignment a mess for this screen (mods can't move labels on this screen). But I was running out of vertical space, so I move things around a bit.

The path has a tooltip telling you to double-click, and double-clicking opens the folder. I avoided going to single click, since it's in the middle of the screen and easy to misclick.

I tested on all aspect ratios on Unity, no issues."
1752171120,"Added ""ActiveGameObjectDatabase"" to replace FindObjectsOfType",KABoissonneault,2024-03-01 18:04:57+00:00,2024-04-06 17:41:18+00:00,{},"# Intro

My solution for https://github.com/Interkarma/daggerfall-unity/issues/2355 crashes.

I have personally observed some users struggling with DFU crashes multiple times a day. The callstacks are almost always somewhere in the middle of a specific Unity function: FindObjectsOfType. DFU uses these in many places, often on every frame, for each object in the scene (see EnemySenses).

From the Unity docs: https://docs.unity3d.com/ScriptReference/Object.FindObjectsOfType.html
> Note: This function is very slow. It is not recommended to use this function every frame. In most cases you can use the singleton pattern instead.

And this is precisely what this changelist does.

I have personally never reproduced these crashes. They seem to require extensive gameplay sessions on a very specific mod setup. Avoiding calls to FindObjectsOfType should for sure avoid crashes in that function - we'll see if it doesn't end up crashing somewhere else.

One thing is for sure, the performance should be better no matter what. Doing a lookup on a limited list of objects should always be faster than doing a lookup on the entire scene.

# The Database
`ActiveGameObjectDatabase` is the namespace where we store the GameObject caches for DFU objects. I have created a new utility class, `GameObjectCache`, which is designed with specific performance characteristics and safety concerns. I have made this class public, since mods might want to reuse it for similar lookups on their own objects (see the Mods section below).

## GameObjectCache

I don't actually suspect that the crashes we've been seeing are caused by multiple threads touching the scene at the same time. DFU does use parallel threads for jobs in the terrain system, for example, and while Unity does not actually support creating GameObjects from such parallel jobs, I have seen mods like Interesting Eroded Terrains try to do GameObject lookups from terrain jobs. Therefore, I decided to be safe and find the minimal overhead solution to make such lookups safe for any code.

`GameObjectCache` has two data members: a `List<WeakReference<GameObject>>`, and a `ReaderWriterLockSlim`. 

For the List part, the WeakReference is there to ensure that 1) the cache does not keep objects alive for longer than necessary 2) we can safely detect destroyed objects long after Unity has cleaned them. I suspect this is not actually necessary for Unity GameObjects, maybe I went overkill on this aspect, but I don't think the cost has been an issue so far.

For the Lock part, here's the C# documentation: https://learn.microsoft.com/en-us/dotnet/api/system.threading.readerwriterlockslim. 

The Cache is used in two ways: multiple systems do frequent reads to the cache, and a few system do infrequent additions to the cache. A ""Reader Writer Lock"" allows multiple readers to read at the same time without blocking each other, while a single writer can still claim exclusive ownership for actual modifications. This means that while we're not spawning objects, the cache has no interference.
The RWLockSlim also has an ""upgradable"" lock feature, which I somewhat used for reading whether an object was already there before committing to the write. I still kept this check only in Editor, we shouldn't have this in real code.

For Registration, I first experimented with having factory functions like GameObjectHelper handle registration. This is because registering multiple objects at once would be faster than doing it once per object. However, I could not find a way to do it in a way that would guarantee that mods that spawn objects are also covered. So I went with the per-object registration in one of their component's Awake.

One detail of note here is that I don't ""unregister"" objects. I could easily add an `OnDestroy` event on all components where I do the register on `Awake` and remove them from the cache there. However, I find that this would cause many unnecessary write locks, so I decided not to do that. Instead, whenever we write to the cache, we take the opportunity to remove any destroyed objects.

Whenever a gameplay system needs to lookup all the GameObjects of a certain type, the cache will not only avoid returning destroyed objects, but it will also not return inactive objects. Similarly, when trying to get a specific component type on the objects, objects where the component is disabled will also be skipped. Both of these behaviors reproduce how FindObjectsOfType works. 

## DFU's caches

In the end, `ActiveGameObjectCache` currently has 6 caches: Enemy, Civilian Mobile NPC, Loot, Foe Spawner, Action Door, and Static NPC. These correspond to six GameObject types where FindObjectsOfType lookups are frequently made, and happen to match six different prefabs in Assets/Prefabs/Scene.
For each of these GameObject types, we identify a primary component (where the registration is made) and some secondary components which are frequently used in lookups.

Enemy:
- Primary: `DaggerfallEnemy`
- Secondaries: `DaggerfallEntityBehaviour`, `QuestResourceBehaviour`
Civilian Mobile NPC:
- Primary: `MobilePersonNPC`
- Secondaries: `DaggerfallEntityBehaviour`
Loot:
- Primary: `DaggerfallLoot`
Foe Spawner
- Primary: `FoeSpawner`
Action Door:
- Primary: `DaggerfallActionDoor`
Static NPC:
- Primary: `StaticNPC`
- Secondaries; `QuestResourceBehaviour`

Two cases stand out here. Some `DaggerfallEntityBehaviour` lookups can be intended to grab more than one GameObject type. `EnemySenses` wants the behaviour from both other enemies and the player. `PlayerGPS` wants the behaviours of both enemies and static NPCs. Fortunately, it's pretty easy to concat two `IEnumerable<DaggerfallEntityBehaviour>` together, the changes were minimal. `QuestResourceBehaviour` can also be either for enemies or for static NPCs. 

Ultimately, the flow looks like one of two things.
Registration:
```diff
// ObjectComponent.cs
+ void Awake()
+ {
+   ActiveGameObjectDatabase.RegisterThing(gameObject);
+ }
```
Lookups:
```diff
// PlayerObjectComponentHandler.cs
- foreach(ObjectComponent component in FindObjectsOfType<ObjectComponent>())
+ foreach(ObjectComponent component in ActivateGameObjectDatabase.GetActiveThingObjectComponents())
{
  if(component.Type == ComponentType.Thing)
    ...
}
```

This is done all over for our 6 object types.

# Performance

I wanna update this PR with more specific benchmarks for key DFU cases of lookups and object registration. In practice, I'm pretty confident all lookups with be faster, though object creation has extra overhead. I estimate the impact to be minimal.

Anecdotally, I made a quest that spawns hundreds of harpies, and I found the performance better with my changes (due to the many EnemySenses lookups).

Key tests:
- Walking around town (PopulationManager spawning Civilian Mobile NPCs)
- Transition in and out of Interiors
- Transition in and out of Scourg Barrow
- Transition in and out of Daggerfall Palace
- Tedious Traveling with Travel Options on a World of Daggerfall save (lots of enemy and loot spawning from nearby bandit camps)

# Debugging

Such a change requires some form of debugging for when we suspect issues. Two primary tools I've implemented are:
- Editor-only check against double registration. If mods all follow the same ""Awake"" pattern on their objects, it should never be an issue, so I don't think we should add such a check in normal gameplay. 
- New visualizers in the `tdbg` console command (see `FPSDisplay.cs`). Whenever a user has an issue we suspect could be related, we can ask them to run `tdbg` and post a screenshot

![image](https://github.com/Interkarma/daggerfall-unity/assets/5789925/71068feb-3fd6-4a22-b5fb-44f431e1ead9)

Some more reference numbers from my tests running around:
Entering Scourg Barrow
![image](https://github.com/Interkarma/daggerfall-unity/assets/5789925/da57e40e-da65-4e8c-a565-7039b6a51a45)

Leaving Scourg Barrow
![image](https://github.com/Interkarma/daggerfall-unity/assets/5789925/cbfb8f50-0bc7-4fac-82eb-387d4dfd6807)

Running around Daggerfall City during the day
![image](https://github.com/Interkarma/daggerfall-unity/assets/5789925/1eabc75a-e7f7-4da3-8f25-15e716552172)

Inside a house
![image](https://github.com/Interkarma/daggerfall-unity/assets/5789925/0c154f18-d7f3-41c6-a5de-959a0d9bdf42)

Daggerfall City at night
![image](https://github.com/Interkarma/daggerfall-unity/assets/5789925/a956d17f-6d54-4f0c-bdd1-906800d24b93)

Daggerfall Palace
![image](https://github.com/Interkarma/daggerfall-unity/assets/5789925/ab739476-7c19-4568-9dc1-4165c78606df)

# Mod
Mod compatibility is always a concern in post 1.0. I had to reject my initial approach to object registration because mods can easily spawn DFU GameObjects in any way (Location Loader from WoD sure does). I believe the current solution should be safe from any sort of weird spawning patterns mods might have.

The crash and performance benefits on lookups will need be applied manually by mods. For example, I had users report crashes with Horrible Hordes when entering main quest dungeons, and this was due to a StaticNPC lookup. In 1.1, we will be able to use `ActiveGameObjectDatabase.GetActiveStaticNPCs()` instead.

One thing I did not take into account yet are DFU objects that mods might do lookups on but not DFU itself. RDBBlocks, Interiors, RMBBlocks, Lights... I did not want to overreach into object types that I couldn't test properly. Mods will have to manifest their interest if they need DFU to track more of its object types.

# Improvements

## Garbage collection

While I mentioned that I deliberately don't clear objects as they are destroyed, I do think we could use some points where we clear objects _before_ a new one is added. For example, leaving a large dungeon will leave lots of dead enemies, loot, action doors, and potentially static NPCs. Lookups in PlayerGPS will still traverse these big lists to check if the object is alive, which could be avoided if we cleared the list.

@numidium Do you have suggestions for clear places where we can ""collect garbage"" on this system? My current idea is to do it on dungeon transitions, but I'm not sure when GameObjects are all properly destroyed after a dungeon exit.

## Remaining FindObjectsOfType

I left a few FindObjectsOfType lookups. 

I ignored all the FindObjectOfType (singular) lookups for DaggerfallUnity scene objects. These are often just done once on scene load for one object and cached. We don't need a separate cache.

I did not cover `DaggerfallStaticDoors`, which is a component on Interior and RDB objects. I was mostly concerned with having to introduce two new caches for one lookup, but maybe the caches would be useful for certain mods.
I also did not cover `DaggerfallMarker`. It's an obscure object, I'm not sure how to test it.
There is one lookup for `QuestResourceBehaviour` that uses `Resources.FindObjectsOfTypeAll`, which covers inactive objects. It's a weird unique case, I did not cover it for now.
There is one lookup for `SongPlayer` in DefaultCommands. Commands run while the game is paused, not really an issue for crashes.

# Conclusion
This is a big change to DFU, but given that the crashes really ruin some users, I believe it is necessary to integrate as soon as possible. I will block version 1.1 on this. In addition, the earlier we deploy this, the more mods can benefit from the improvements.

I will probably deploy a test build with this change (and some others) before it gets approved. We can check for regressions, and see if users get other forms of weird crashes."
1744095294,More Retro Modes,DunnyOfPenwick,2024-02-26 19:17:34+00:00,,{},"Adds half-resolution widescreen graphics modes and a high-resolution 4:3 mode. 
Also corrects for texture stretching when using the widescreen modes."
1742281258,"Fixed ""work question"" sticking while moving from ""Where Is?""",KABoissonneault,2024-02-25 19:21:18+00:00,2024-02-26 23:22:23+00:00,{},"When transitioning from asking about ""Where Is? Work"" to ""Tell Me About"", the question at the top of the screen remains about work.

https://github.com/Interkarma/daggerfall-unity/assets/5789925/c38badb1-79e7-4b77-9f92-40d35bdebb7d

The ""Where Is?"" talk category is preserved when moving to ""Tell Me About"" so it can be restored when going back to ""Where Is?"". 
The problem is that `UpdateQuestion` only checks the talk category ""Work"", not if we're actually in the ""Where Is?"" talk option.

I fixed this to also check the talk option"
1742157184,RMB Block Editor bugfixing,Podleron,2024-02-25 12:51:16+00:00,2024-03-04 14:26:39+00:00,{},"Fixed a couple of bugs.
1. Fixed a problem where the position of MiscFlatObjectRecords billboards would be calculated incorrectly, when the billboard is duplicated through the editor.
2. MiscFlatObjectRecords and BlockFlatObjectRecords, BlockPeopleRecords and BlockDoorRecords in Interior and Exterior subrecords need to have unique ""position"" values. This ""position"" property is used to identify the objects."
1742021578,Added functionality to move deleted saves to DELETED dir,John-Leitch,2024-02-25 03:32:20+00:00,2024-06-13 02:08:33+00:00,{},"This PR fixes the following issue: #2594 (Deleting and creating new save can preserve old mod save data)

The update changes the logic of `SaveGameManager.DeleteSaveFolder` to move any folder to `DELETED` should it contain unexpected files or otherwise fail to delete. If a backup folder already exists with the same, a numbered suffix is appended beginning with `_2`.

![image](https://github.com/Interkarma/daggerfall-unity/assets/7999934/64c0dbc2-ddae-4ef8-8e75-245818fd0a70)
"
1741955800,Fixed VitalChangeDetector UI synchronization issue.,John-Leitch,2024-02-24 21:54:42+00:00,2024-06-09 18:04:06+00:00,{},"This PR fixes the following issue: #2593 (Changing Vitals while HUDVitals is not Active)

RCA can be found in my comment on the issue. This was the least hacky fix I could think of without resorting to updating `HUDVitals` every tick from `DaggerfallUI.Update`, or doing more complicated state tracking in `VitalsChangeDetector` to ensure `VitalsChangeDetector.HealthLost` wasn't missed. The latter approach would have been difficult to make generic to cover all of the states that can be missed e.g. `FatigueLost`, `MagickaLost`, etc., and may have involved modifications to referencing code as well.

Instead, I opted to modify `VitalsChangeDetector` to delay updates a single tick after each unpause. This should cover cases like those observed in #2593, where only a single tick passes between pauses, wherein a window is pushed to the front that causes `HUDVitals` to miss the `VitalsChangeDetector` update. This approach also has the added benefit of triggering the view bob, which probably wouldn't occur if side channels such as `HUDVitals.SynchronizeImmediately` were used instead.

In code review and testing, nothing seemed to stick out to me, and everything worked as expected. However, this probably warrants careful review of somebody more familiar with the code. If there's a better way of doing this that I missed, let me know and I will update appropriately."
1735736421,Fast travel gold fix,John-Leitch,2024-02-21 00:39:47+00:00,2024-02-26 22:40:07+00:00,{},"This PR fixes the following issue: #2591 (Fast Travel deducts gold even if travel is canceled)

Pretty straight forward. Moved the code to deduct the gold into a separate method, `DaggerfallTravelPopUp.DeductFastTravelGold`. Rather than invoking directly from update, I opted to do so in `DaggerfallTravelPopUp.performFastTravel`, as that method seemed to be where most of the other related changes to `GameManager.Instance.PlayerEntity` state occur. The only concern I have is related to the `DaggerfallTravelPopUp.OnPreFastTravel` and `DaggerfallTravelPopUp.OnPostFastTravel` events. Previously, the gold was deducted prior to either event being fired. In `performFastTravel`, I put it after `OnPreFastTravel`, as that seemed to make the most sense. Looking at the codebase, I did not see any subscribers to `OnPreFastTravel`, so I don't think this will break anything."
1733868382,Fixed Knightly_Guard faction resolve bug.,John-Leitch,2024-02-20 03:26:18+00:00,2024-06-05 22:57:33+00:00,{},"This PR (hopefully) fixes the following bug: #2510 (0.14.5: ""Generic Knightly Order"" used as faction in quest dialogue). The update makes `Knightly_Guard` resolve to a random knightly order, which should fix the faction resolution issue in `Q0C20Y02`. Since the knightly orders are already hardcoded in the `DaggerfallWorkshop.Game.Guilds.KnightlyOrder.Orders` `enum`, the `enum` values were used instead of adding another hardcoded set of knightly order ids."
1732086842,Fixed Q0C20Y02 faction type bug.,John-Leitch,2024-02-19 04:27:25+00:00,2024-02-19 17:47:43+00:00,{},"This PR fixes the following bug: #2510 (0.14.5: ""Generic Knightly Order"" used as faction in quest dialogue). The issue appears to be caused by the incorrect `factiontype` value for `_other_` in `Q0C20Y02.txt`. `factiontype` should be set to `Daedra`, not `Knightly_Guard`."
1732033174,Fixed messagebox painting scaling issue.,John-Leitch,2024-02-19 03:24:42+00:00,2024-05-30 02:07:42+00:00,{},"This PR fixes the following bug: #2511 (Painting info window scales improperly with higher resolution images). The issue appears to be caused because the messagebox size is being calculated using the texture height, rather than the actual image panel height. 

Before:
![image](https://github.com/Interkarma/daggerfall-unity/assets/7999934/6e924a7f-d52d-4a4e-8d52-56d505bace43)

After:
![image](https://github.com/Interkarma/daggerfall-unity/assets/7999934/289a11a4-02ca-47a8-bab0-703e02451d27)
"
1731367813,Set castInProgress to false when loading game (EntityEffectManager.cs),DunnyOfPenwick,2024-02-17 21:50:21+00:00,2024-02-18 18:57:49+00:00,{},"Original problem: If a game is loaded immediately after casting spell, spellcasting will be locked up.
Setting castInProgress to false when EntityEffectManager.ClearReadySpellHistory() is called.

"
1731065602,Fixed caching of new WorldData locations,KABoissonneault,2024-02-17 17:00:55+00:00,2024-02-19 00:29:16+00:00,{},"Before the change, the logic for whether to cache the result of `WorldDataReplacement.GetDFRegionAdditionalLocationData` was as follows:

```
bool success = false
foreach(asset in loose files)
  success = AddLocationToRegion(asset)
foreach(asset in packed mods)
  success &= AddLocationToRegion(asset)
...
if(success)
  cache result
```

`AddLocationToRegion` pretty much always returns true. Therefore, if we have any loose files, `success` is assigned true in the first loop, and the second loop will do `success = true & true`, and `success` will stay true.

If we do not have any loose files, `success` stays false, and the second loop will do `success = false & true`, making `success` false.

This means setups where a region has new locations in packed mods but not locations in loose files always fail to cache the result, resulting in poor performance and log spam. This process is called each time a map pixel is loaded.

How to repro:
- Install `betony restored.dfmod` in a release build (editor builds never cache results, so that doesn't change)
- Make sure your StreamingAssets/WorldData has no files named `locationnew-*-19.json` (new betony locations)
- Go to Betony

With this change, I changed the logic to
```
bool success = true
foreach(asset in loose files)
  success &= AddLocationToRegion(asset)
foreach(asset in packed mods)
  success &= AddLocationToRegion(asset)
...
if(success)
  cache result
```

We still only cache if no errors occur in the process, but at least we don't need to go through loose files to start as true."
1728612946,Pacified-Enemy-Not-Attack-Allies,DunnyOfPenwick,2024-02-15 23:03:25+00:00,2024-02-18 19:02:35+00:00,{},"In a previous PR I had added code to prevent allies from attacking pacified enemies but forgot to prevent pacified enemies from attacking player allies.

Added check to prevent pacified enemies from attacking player allies."
1726609428,Added checkbox to show hidden folders during Daggerfall setup,KABoissonneault,2024-02-14 23:11:22+00:00,2024-04-05 00:28:45+00:00,{},"Fixes #2487. Steam installs DF in a hidden folder by default on Linux, so it's pretty essential for these users.

![image](https://github.com/Interkarma/daggerfall-unity/assets/5789925/fbdff2a5-de71-4119-9c1f-95d24eed106c)

![image](https://github.com/Interkarma/daggerfall-unity/assets/5789925/2bab65c6-a98a-4a2d-aafd-152b45df8c20)

I can find a DF installation in AppData just fine :)

![image](https://github.com/Interkarma/daggerfall-unity/assets/5789925/c5e9bb5c-eb7f-4fed-880e-1fd07fab3cb4)

"
1721080537,Fix TextLabel metrics in 4:3 mode for MultiFormatTextLabel and ListBox.,DunnyOfPenwick,2024-02-11 20:34:23+00:00,2024-06-08 20:11:14+00:00,{},"Fix for MultiFormatTextLabel and ListBox TextLabel wrapping issues spotted in 4:3 mode.

I originally noticed an issue with wrapping TextLabels when constructing a MultiFormatTextLabel while running in 4:3 mode.
Wrapped text would overlap the following line. 
In the TextLabel.CreateNewLabelLayoutWrapped() method, the LocalScale was (1,1), causing some bad line metric calculations.

More recently I noticed the bottom line of the npc conversation window was often not shown in 4:3 mode.
This appears to be the same problem.

This fix calls GetRectangle() on the TextLabel early to establish the correct LocalScale prior to other operations."
1721003026,Fixed Temple music errors,KABoissonneault,2024-02-11 16:21:55+00:00,2024-04-05 00:29:04+00:00,{},"Temple music is handled differently from other playlists in SongManager. The selected song is based on the faction of the building (the manager checks for both the ""Temple"" faction id and the ""God"" faction id). The songs are as follows:

| God       | Song    |
|-----------|---------|
| Arkay     | Good    |
| Z'en      | Bad     |
| Mara      | Good    |
| Akatosh   | Neutral |
| Julianos  | Bad     |
| Dibella   | Good    |
| Stendarr  | Bad     |
| Kynareth  | Neutral |

I found two errors in how we handle this.

First, we use separate SongPlayer objects for Exterior and Interior. This means that when moving from an Interior to outside, the Interior SongPlayer is not updated until we enter a new interior. Therefore, if we move from one temple to outside to another temple, from the perspective of the Interior SongPlayer, the context never changed, and the music is not updated, even if the FactionID would cause a different song.

This can be tested in the Daggerfall region's Chesterwick Hamlet (not Chesterwick), which has both a Julianos and Kynareth temple. Both temples should have a different music, but if you enter one then directly enter the other, then the music is preserved from the first temple. The music is properly updated if you enter a non-temple interior then go to the temple.

So, I added ""factionID"" to the music context, which is only updated for temples since only that playlist actually checks it. When the playlist is the same as previously but the factionID changes, we update the song only if the playlist is Temples.

The second issue is what I initially investigated. DFU was throwing an exception if a Temple location did not have a proper Temple/God faction id, which occurs in DF data in those Fighter Trainers halls in Hammerfell. I checked in classic DF, and the music that plays is actually the ""unused"" Knight Order music - yes, that music is actually used. This can be checked in the Abibon-Gora capital. 

So, I fixed both the error handling in the Temple music selection, and added a new music context for FighterTrainers so its classic DF music plays. "
1720974496,Fix booleans returned when setting variants,ajrb,2024-02-11 14:53:21+00:00,2024-02-19 01:24:06+00:00,{'bug': 1},"The return values were all inverted erroneously, rather embarrassing. Not seen anyone using these return values yet, so should cause no issues."
1720814920,Add ability to declare QuestLists in .dfmod file.,Jagget,2024-02-11 03:08:41+00:00,2024-02-18 18:59:55+00:00,{},"Currently you can activate new Quest Pack (quest list) by adding the file to StreamingAssets\QuestPacks\ folder.

In case of packing quests in .dfmod file, you must call `QuestListsManager.RegisterQuestList(""MyQuests"")`.

It is not possible to ship quests in .dfmod without C# script.

I propose to register them in ""Contributes"" ModInfo section, the same way as BooksMappings 

Example:

```json

{
    ""ModTitle"": ""QuestPack"",
    ""ModVersion"": ""1.0.0"",
    ""Files"": [
        ""QUEST1.txt"",
        ""QUEST2.txt"",
        ""QUEST3.txt"",
        ""QuestList-MyQuests.txt""
    ],
    ""Contributes"": {
        ""QuestLists"": [
            ""MyQuests""
        ]
    }
}

```
![image](https://github.com/Interkarma/daggerfall-unity/assets/1652113/876ed8a1-2e75-4bda-8898-5f0bc29123a1)


![image](https://github.com/Interkarma/daggerfall-unity/assets/1652113/e514407f-c90b-45f7-858e-073865b90816)


![Screenshot 2024-02-10 212729](https://github.com/Interkarma/daggerfall-unity/assets/1652113/ee919e19-4c39-4725-86df-26aae8375096)
"
1720184118,Support loading font file from .dfmod,Jagget,2024-02-10 04:18:54+00:00,2024-05-10 17:05:11+00:00,{},"- I changed `ModManager` load priority, so now it initialized before `DaggerfallUI`.
- Init logic of the `ModManager` was moved from `Start()` to `Awake()`

![image](https://github.com/Interkarma/daggerfall-unity/assets/1652113/fac9eef8-516b-4a6b-b07d-d20fdc48df3d)
"
1719969106,"Updated DFU tutorial, minor quest fixes",JayH2971,2024-02-09 20:51:10+00:00,2024-03-23 22:09:24+00:00,{},"Warning: I don't know what ""multiple PRs"" look like. I am a github novice.

This contains very basic quest fixes, almost unnoticeable. It also has my updated DFU tutorial in file _TUTOR__.txt."
1714630152,Potion recipe weight localized,Jagget,2024-02-06 23:19:24+00:00,2024-02-11 16:22:28+00:00,{},Potion recipe weight localized
1713950243,"Fixed ""readOnly"" issue with GetMobileBillboardMaterial",KABoissonneault,2024-02-06 15:37:36+00:00,2024-02-11 03:13:35+00:00,{},"When using mods that provide lots of texture replacements and new textures, logs are filled with the message ""Texture {name} is not readable.""

![image](https://github.com/Interkarma/daggerfall-unity/assets/5789925/22147ad2-076c-4e82-9980-6a448b9943d8)

The root of this is a change I made in 2021 in this PR: https://github.com/Interkarma/daggerfall-unity/pull/2160/files#diff-19063ddd0d72895174af2f1e16dd67e9c31329b6c2b66995d076184724e2991dR550

Crucially, for `TextureReplacement.GetMobileBillboardMaterial`, we read textures in three points:
- `LoadFromCacheOrImport`, called when the billboard material is in cache, where `readOnly` was true
- `textureFile.Load`, called when the archive is a DF classic, where `readOnly` was true
- the `TryImportTexture` fallback, added by my above PR, called when the archive is outside DF classic, where `readOnly` was implicitly false

This issue therefore mostly hits mods like Daggerfall Enemy Expansion and Vanilla Enhanced and ""DEX - DREAM patch"", which provide textures for mobiles outside the classics. They generally don't need the mobile textures to be readable, but this new code path I added accidentally demanded it.

There is no reason for keeping this inconsistency, that was a mistake in my original PR from lack of understanding. There is no conceivable world where a mod relies on the mobile material being readable/writable only if it's a custom archive.

The fix is on line 628 and 634. The rest is either readability/documentation, or new overloads for mods to use."
1712843949,Fixed PlayerGPS loading ContentReader maps before mods ready,KABoissonneault,2024-02-06 03:05:43+00:00,2024-02-07 03:22:56+00:00,{},"Fixes #2573 . Most of the details should be on the issue, but in summary:

1. PlayerGPS updates the world info
2. This causes the ContentReader to fill its ""MapDict"" cache with all the regions
3. Loading a region also loads the WorldDataReplacement location data from mods

Before the fix, this could happen before disabled mods were removed (this occurs in ModManager.Init). Now, PlayerGPS waits for the ModManager to be Initialized before running.

As an aside, for performance reasons, I'd like if ContentReader did not read _all_ the regions on boot, since it slows down when mods try adding thousands of new locations (carademono has a vision, okay). But I'm not ready to change that yet - maybe I'll send cara a custom build to see if simply having independent caches per region works.

But this simple change fixes the issue, and increases performance when running disabled mods with WorldData."
1712302104,Seek localized book files and quest files from mods,Jagget,2024-02-05 18:50:07+00:00,2024-02-06 22:42:04+00:00,{},"Seek localized book files and quest files from mods

Loose files can be packed, and it will make installing new books mods and quest localizations easier and more straightforward."
1709631853,Fixed frame overflow in DaggerfallMobileUnit. ,KABoissonneault,2024-02-03 04:45:24+00:00,2024-02-07 03:56:31+00:00,{},"Fixes for #2569. 

I found an issue where archive 288 has 4 frames for record 0, 1, 2, and 4, but 8 frames for record 3. Record 3 is the ""back diagonal"" sprites (both left and right). Normally, all mobile archives have the same number of frames on each orientation, but the Ancient Lich is an exception. When changing orientation, the `currentFrame` is preserved so that the animation keeps playing from where it was. However, for the Ancient Lich, if you change orientation from the back diagonal while on frame 4, 5, 6, or 7 is playing, the `currentFrame` will now be past the allowed frames for the new orientation (back or side). On unmodded DFU, this reaches into a ""Casting spell"" frame in `summary.AtlasRect` (because `rectIndex` has enough room to overflow into the next records, rather than go out of bounds of the AtlasRect). When using texture replacements from mods (ex: Vanilla Enhanced), you get the exception shown in #2569 (because we don't use the atlas anymore).

The fix is on line 371 - I simply reset `currentFrame` to 0 if the frame is not valid for the new orientation. A bit jarring, but better than the current behavior.

The rest of the changes are more bounds checking and error logs for these issues. I find DaggerfallMobileUnit has lots of moving parts and lots of arrays to go out of bounds, so it helps to have better logs there.

The output looks like this:

![image](https://github.com/Interkarma/daggerfall-unity/assets/5789925/971e4326-9f36-4459-9de3-572ffa667146)

Hopefully this will help diagnose future issues with mobiles, if any remain. In any case, with mods like Daggerfall Enemy Expansion, it's easy to accidentally create invalid MobileEnemy data that creates random errors in DaggerfallMobileUnit, and this will help mod development."
1705220978,RmbBlockEditor file cleanup,KABoissonneault,2024-02-01 02:41:53+00:00,2024-02-06 22:42:31+00:00,{},"This is what appears in my Git status when I checkout master and open Unity now

![image](https://github.com/Interkarma/daggerfall-unity/assets/5789925/73f2abef-7bc2-40dd-b940-691ae0ebaa85)

I wish I'd caught this before merging the PR.

Just adding the meta files with default values - if anything else was intended, it should be fixed by whoever knows what these files should have.

I'm adding Editor settings to the .gitignore. I figure these files should be local to each repo"
1696634349,Fix typo that breaks 3d object scaling in RMBLayout.cs,drcarademono,2024-01-26 05:06:32+00:00,2024-01-28 00:09:18+00:00,{},"Modders working with RMBs have known for a long time that rescaling 3d objects will break them. Either the scale will be wrong or objects will disappear entirely when scaled. The screenshot below demonstrates this bug with a modded RMB but otherwise unmodded game:
![Screenshot from 2024-01-25 20-58-56](https://github.com/Interkarma/daggerfall-unity/assets/73616371/df91b506-2ddc-4464-a30d-c5eb994448ad)

This bug turns out to be caused by a typo in the GetModelScaleVector method, in which obj.ZScale is incorrectly set to obj.YScale on line 76. Correcting this typo fixes the scaling bug:
![Screenshot from 2024-01-25 20-57-23](https://github.com/Interkarma/daggerfall-unity/assets/73616371/afb46c02-18fd-4fb8-a06b-20616a896b8b)
"
1684006940,Fix exception thrown during Lycanthropy transition,KABoissonneault,2024-01-18 02:21:31+00:00,2024-01-25 01:41:38+00:00,{},"A user on Discord sent me this error during gameplay.

![image](https://github.com/Interkarma/daggerfall-unity/assets/5789925/ff5600c8-2ef5-47d5-97cb-b4bdd14805fa)

This error is easy to reproduce.

1. Load any save
2. Use console command `diseaseplayer werewolf` to get Lycanthropy Infection
3. Wait 1 day (ex: travel anywhere), get the dream sequence
4. Wait 2 another day (ex: travel anywhere 2+ days away)
5. See error in logs / console

So, during `EntityEffectManager.DoMagicRound()`, we have this loop
```
foreach (LiveEffectBundle bundle in instancedBundles)
{
    // Run effects for this bundle 
    bool hasRemainingEffectRounds = false;
    foreach (IEntityEffect effect in bundle.liveEffects)
    {
        // Update effects with remaining rounds, item effects are always ticked
        // All other effects with a duration will be ended at zero rounds remaining
        hasRemainingEffectRounds = hasRemainingEffectRounds || effect.RoundsRemaining > 0;
        if (effect.RoundsRemaining > 0 || bundle.fromEquippedItem != null)
            effect.MagicRound();
        else if (effect.Properties.SupportDuration)
            effect.End();
    }
   ...
```

For the `LycanthropyInfection` effect, `MagicRound` updates the disease progress, until 3 days have passed and the dream sequence has been watched. This will call `DeployFullBlownLycanthropy()`, which is implemented by `WereboarInfection` and `WerewolfInfection` as this
```
protected override void DeployFullBlownLycanthropy()
{
    // Start permanent wereboar lycanthropy effect stage two
    EntityEffectBundle bundle = GameManager.Instance.PlayerEffectManager.CreateLycanthropyCurse();
    GameManager.Instance.PlayerEffectManager.AssignBundle(bundle, AssignBundleFlags.BypassSavingThrows);
    LycanthropyEffect lycanthropyEffect = (LycanthropyEffect)GameManager.Instance.PlayerEffectManager.FindIncumbentEffect<LycanthropyEffect>();
    if (lycanthropyEffect != null)
        lycanthropyEffect.InfectionType = LycanthropyTypes.Wereboar;
}
```

This is all happening still in the middle of the foreach loop above. As you can see, we're assigning a new bundle to the player's effect manager, which modifies `instancedBundles` if the bundle has any ""live"" effects (which Lycanthropy curse does). Modifying collections during iteration is not supported, so the error occurs.

While the error does not break anything permanently as far as we know, it still prevents other effects from being processed for the rest of this magic round. This could happen more often with mods."
1677915743,Localize %dng macro,Jagget,2024-01-13 21:52:33+00:00,2024-01-24 00:27:00+00:00,{},"When revealing a dungeon in DB or TG rank up, the dungeon name is not translated"
1669151841,Enemy component access,DunnyOfPenwick,2024-01-08 15:34:45+00:00,2024-01-24 00:28:59+00:00,{},"Replaces some method calls in enemy components with delegates so mods can inject additional logic.

Also includes a change to prevent player allies from attacking pacified creatures. (EnemySenses)
Also changes ApplyGravity in EnemyMotor to allow enemies to slowfall.
Also adds option to base enemy spell cost on enemy skills rather than player skills. (EntityEffectManager)"
1669138235,Add shading mechanism to first-person graphics,DunnyOfPenwick,2024-01-08 15:26:45+00:00,2024-01-24 00:29:26+00:00,{},"Adds public Tint properties to first-person graphical components so that mods can manipulate the shading.
"
1665362707,Fix for Advanced Climbing bug #2560,KABoissonneault,2024-01-04 22:14:36+00:00,2024-01-25 01:42:08+00:00,{},"Issue at #2560 

Fixed ""overrideSkillCheck"" not being turned off after being done Climbing. 
overrideSkillCheck is used in the transition from wall to the floor above it, and should only be true during that automatic movement.

![image](https://github.com/Interkarma/daggerfall-unity/assets/5789925/6480092c-0699-4e0d-8096-f6a2d1fb89ce)

Moved ""ClearStateOnRestore"" to always run on restore, not just when climbing with Advanced.

The second fix is not strictly required, but seems cleaner. No risk of regression, since non-advanced climbing should have no expectation of state if saving/reloading during climbing (it's supposed to drop the moment you let the key go). 

"
1662145772,Fix SecondaryDisplayName localization,Jagget,2024-01-02 18:17:28+00:00,2024-01-24 00:31:38+00:00,{},"![Screenshot 2024-01-02 120542](https://github.com/Interkarma/daggerfall-unity/assets/1652113/89ece1d2-6cbe-446d-aaf0-16d16e08e23c)
![Screenshot 2024-01-02 120550](https://github.com/Interkarma/daggerfall-unity/assets/1652113/0d879408-0123-4a58-9a1a-0bb82d1c5a1f)
"
1660724616,Allow Portable Installs,RicardoLuis0,2023-12-31 20:03:51+00:00,2024-05-09 02:12:07+00:00,{},"This allows data to be stored in a `PortableAppdata` folder instead of in `persistentDataPath` if an empty `Portable.txt` file is in the same folder as the executable. If the install is portable, it also 
opens the browse window on the exe folder and stores paths as relative in the ini."
1649084985,Added ability to move text labels.,Jagget,2023-12-18 18:29:23+00:00,2024-01-24 00:32:33+00:00,{},"# Reason

It's not a secret that text in different languages have different lengths. Hence, we need the ability to move labels. At least through mods. But currently we cannot do that easily, because these fields are private. And instead of quick extension of the dialog class we must re-implement the whole window logic. 

To be able to do something simple like 
```cs
protected override void Setup()
{
    base.Setup();
    // Setup labels
    nameLabel.Position = new Vector2(34, 4);
    raceLabel.Position = new Vector2(40, 14);
    classLabel.Position = new Vector2(47, 24);
    levelLabel.Position = new Vector2(54, 34);
    goldLabel.Position = new Vector2(53, 44);
    fatigueLabel.Position = new Vector2(42, 54);
    healthLabel.Position = new Vector2(48, 64);
    encumbranceLabel.Position = new Vector2(68, 74);
}
```

or 
```cs
protected override void Setup()
{
    base.Setup();
    // Setup labels
    accountAmount.Position = new Vector2(126, 14);
    inventoryAmount.Position = new Vector2(141, 24);
    loanAmountDue.Position = new Vector2(71, 34);
    loanDueBy.Position = new Vector2(71, 44);
}
```

we need to change the protection level on these labels.


# Result
## Before:
![Screenshot 2023-12-18 124824](https://github.com/Interkarma/daggerfall-unity/assets/1652113/86bf0b5a-93da-49b5-bd35-917896c0de3e)
![Screenshot 2023-12-18 130222](https://github.com/Interkarma/daggerfall-unity/assets/1652113/e85906be-7580-4d04-b87f-6663db88c63d)

## After
![Screenshot 2023-12-18 124740](https://github.com/Interkarma/daggerfall-unity/assets/1652113/0f1d90ea-fb73-4a69-878b-6f42f704a3ed)
![Screenshot 2023-12-18 131827](https://github.com/Interkarma/daggerfall-unity/assets/1652113/2f4f5418-b81c-4fd5-a1d6-e5321aabc2bd)
"
1647145908,Fix for buildings names macro expand,Jagget,2023-12-17 00:37:34+00:00,2024-01-24 00:33:48+00:00,{},"Fix for `%cn` macro not expanded in all cases 

Before:

![Screenshot 2023-12-16 191130](https://github.com/Interkarma/daggerfall-unity/assets/1652113/2cbf97e9-aff0-42bb-9e35-e89e18694266)
![Screenshot 2023-12-16 191224](https://github.com/Interkarma/daggerfall-unity/assets/1652113/c337b5ec-b544-4c54-a2fd-a23838708c6e)
![Screenshot 2023-12-16 191246](https://github.com/Interkarma/daggerfall-unity/assets/1652113/83387307-6dfd-4a0b-a470-537cba1157ff)

<hr/>

After:
![Screenshot 2023-12-16 193256](https://github.com/Interkarma/daggerfall-unity/assets/1652113/a36dc5b5-5a74-4de0-98af-471278ea85fb)
![Screenshot 2023-12-16 193238](https://github.com/Interkarma/daggerfall-unity/assets/1652113/751dd5e5-4e24-4e5d-87da-cfe0875ae95b)
"
1646818937,Fix for region macro localization,Jagget,2023-12-16 05:24:11+00:00,2024-02-06 22:44:06+00:00,{},"The `____place_ ` macro was not fully localized.

Before:
![Screenshot 2023-12-16 001904](https://github.com/Interkarma/daggerfall-unity/assets/1652113/077a4160-db5c-4c01-95fc-338f15b077f4)

After:
![Screenshot 2023-12-16 001823](https://github.com/Interkarma/daggerfall-unity/assets/1652113/059f55e6-09c4-4f02-a0f6-fa9bc344ea2a)

The text of the letter that is on screenshot:
```txt
Message:  1011
  %pcf,
<ce>
  –ö–∞—Ä—Ç–æ–≥—Ä–∞—Ñ—ã –ø–æ—Ä—É—á–∏–ª–∏ –º–Ω–µ —Å–æ–ø—Ä–æ–≤–æ–∂–¥–∞—Ç—å –≤–∞—Å
  –≤ –ø–æ–∏—Å–∫–∞—Ö –ø—É—Ç–∏ –≤ ____place_.
  –î–∞–≤–∞–π—Ç–µ –≤—Å—Ç—Ä–µ—Ç–∏–º—Å—è –≤ ___place_, —á—Ç–æ–±—ã –º—ã –º–æ–≥–ª–∏ –ø–æ–π—Ç–∏
  –≤–º–µ—Å—Ç–µ. –ü—É–Ω–∫—Ç–æ–º –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –±—É–¥–µ—Ç __home_,
  –∏ —É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ –¥–æ–ª–∂–Ω–æ –±—ã—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–æ –Ω–µ –ø–æ–∑–∂–µ,
  —á–µ–º —á–µ—Ä–µ–∑ =timer_ –¥–Ω–µ–π, —á—Ç–æ–±—ã –ø–æ–¥–¥–µ—Ä–∂–∞—Ç—å
  –≤–∞—à—É —Ä–µ–ø—É—Ç–∞—Ü–∏—é –≤ –∞—Å—Å–æ—Ü–∏–∞—Ü–∏–∏.
<ce>
                _qg_
                –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å, –ø–æ–ª–µ–≤–æ–π –æ—Ñ–∏—Ü–µ—Ä
                –ê—Å—Å–æ—Ü–∏–∞—Ü–∏—è –ö–∞—Ä—Ç–æ–≥—Ä–∞—Ñ–æ–≤
                ___place_, ____place_
```"
1644662401,Added new terminator for macros that could be used for postfixes,Jagget,2023-12-14 18:01:48+00:00,2024-05-29 20:53:35+00:00,{},Added new terminator for macros that could be used for postfixes
1644662109,Building location in %fcn localized,Jagget,2023-12-14 18:01:35+00:00,2024-01-28 14:22:07+00:00,{},Building location in %fcn localized
1644661707,"God's name localized in the ""Donation"" dialog",Jagget,2023-12-14 18:01:14+00:00,2024-02-06 22:44:21+00:00,{},"God's name localized in the ""Donation"" dialog"
1641498091,"Fixed climate-swap changes in DaggerfallLocation not respecting the billboard's ""AlignToBase""",KABoissonneault,2023-12-12 22:37:24+00:00,2024-02-11 03:13:53+00:00,{},"Billboards always float in the air, so the bottom touches the ground. In `DaggerfallLocation.ApplyClimateSettings`, we have a procedure to apply climate swap on child billboards, but it fails to account for the change in billboard height.

This issue only affects nature used in RMB ""misc block flats"". In normal Daggerfall data, nature is in the ground scenery, which applies the climate swap directly in `RMBLayout.AddNatureFlats`, before the billboard's been aligned to base. However, ground scenery is bound to a 16x16 grid and has fixed elevation, so mods prefer to use ""misc flats"" for better control (like putting a tree on a hill).

This issue was reported by carademono here: https://github.com/Interkarma/daggerfall-unity/pull/2545#issuecomment-1820286381

Without climate swap:
![284473002-19c8ef5a-6cfd-403c-81ef-ab392fb65b4d](https://github.com/Interkarma/daggerfall-unity/assets/5789925/bab4dcc2-b5ce-41e2-a21a-1d299daeacdc)

With climate swap:
![284473016-fb1d70cc-6b7b-4956-9242-b76ba28c88f0](https://github.com/Interkarma/daggerfall-unity/assets/5789925/a16cb618-2618-4662-87c2-13aadb905c7d)

My suggested fix is to cancel out the ""AlignToBase"" in DaggerfallLocation using the original size, then realign to base using the new size.

Now, trees keep the correct elevation.
![image](https://github.com/Interkarma/daggerfall-unity/assets/5789925/d15a49e4-27e6-47b9-bab1-3d440d271b95)

Other potential solutions:
We could apply the climate swap in `RMBLayout.AddMiscBlockFlats` similarly to what we already have for the ground scenery. However, DaggerfallLocation is intended to have control of whether climate swap is applied, and I figured this might have side effects of forcing climate swaps in contexts where it's not intended."
1613947092,Add setter for StaticNPC.Data,numidium,2023-11-23 07:30:18+00:00,2024-02-06 22:45:09+00:00,{},Allows modders to edit static NPC data.
1607707746,Fix for RuntimeMaterials to pick the right ground texture in Woodland Hills,KABoissonneault,2023-11-18 21:12:23+00:00,2024-02-11 15:37:35+00:00,{},"A user was having a mismatch in RuntimeMaterials when replacing ground textures according to climate/season/weather.

In this example:
![image](https://github.com/Interkarma/daggerfall-unity/assets/5789925/16ddf733-6ecc-481a-9a92-aa0d499ec73c)

The bright green of the hill clashes with the dark green of the rest of the area. This is because the hill has been made to use archive 302-304, and Woodland Hills uses archive 102-104 for ground.

A concrete climate's ground archive is defined in `MapsFile.GetWorldClimateSettings`, along with its base climate setting. Without the concrete climate, we can get a default ground archive matching the base climate as defined in `ClimateSwaps` logic (either in `ApplyClimate` or `GetGroundArchive`).
In the latter case, we have for the ground:
- Desert = archive 2
- Mountain = archive 102
- Temperate = archive 302
- Swamp = archive 402
With winter variants at x03 and rain variants at x04.

For the most part, the climates in `MapsFile.GetWorldClimateSettings` have a ground archive matching the base climate's in `ClimateSwaps.GetGroundArchive`. We only have one exception: `Climates.MountainWoods` (aka ""Woodland Hills"") has a Temperate base climate (normally ground archive 302), but with a specific ground archive of 102 (the mountain one).
102 is the archive used by the terrain generator. Therefore, any ground generated in this climate needs to match 102, not 302.

This fix adds an explicit check in RuntimeMaterials for whether we're replacing a ground archive, and if so, use the climate settings' ground archive, not the naive climate-based swap.

And the result is a more natural hill
![image](https://github.com/Interkarma/daggerfall-unity/assets/5789925/c917f901-3725-4f35-a355-20603905f728)

Similarly, `DaggerfallMesh.SetClimate` uses `MaterialReader.ChangeClimate` which also relies on `ClimateSwaps` logic to customize by weather. However, I'm not sure whether a `DaggerfallMesh` ever uses the ground archive, so I did not insert this fix in this PR."
1605345865,Akorithi Painting clearclick,JayH2971,2023-11-16 22:25:10+00:00,2023-12-11 01:20:06+00:00,{},Reference topic: https://forums.dfworkshop.net/viewtopic.php?t=6452
1577992761,Add null check to inventory window,ajrb,2023-10-29 20:58:19+00:00,2023-11-01 00:46:07+00:00,{},Spotted this and figured it should be corrected before release.
1527795917,Synchronize char creation wizard screens,numidium,2023-09-24 19:21:45+00:00,2024-02-11 16:25:29+00:00,{},"Addresses a bug described here: https://forums.dfworkshop.net/viewtopic.php?p=66200

The skill bonus screen de-synchronizes with the summary screen when the user goes back and forth in the character creation wizard. My fix was to ensure either window is synced to the character document whenever they are pushed. I also made it so that changes made on the summary page are propagated backward in the wizard as far as makes sense. Skills bonuses will still be wiped if the user creates a new biography since that alters them."
1527778275,Allow extension to travel calculator for mods,ajrb,2023-09-24 18:08:46+00:00,2023-10-09 04:58:53+00:00,{},Required for new settings for Travel Options mod in DFU release 1.0
1518569988,Feature/pet helper,llillac,2023-09-17 19:04:12+00:00,2023-09-17 21:49:40+00:00,{},
1501860478,Update R0C11Y26.txt,JayH2971,2023-09-04 21:49:47+00:00,2023-09-12 23:46:27+00:00,{},Fix reference https://forums.dfworkshop.net/viewtopic.php?t=6374
1487916223,C0B00Y01 fix,JayH2971,2023-08-24 12:06:22+00:00,2023-08-25 00:35:44+00:00,{},"Dialogue fix for misplaced rumor, see https://forums.dfworkshop.net/viewtopic.php?t=6368"
1486633202,Changed save data in Questing Foe to allow for custom foe ids,KABoissonneault,2023-08-23 15:26:22+00:00,2024-02-11 16:25:51+00:00,{},"After looking into this issue: https://forums.dfworkshop.net/viewtopic.php?t=6357

Normally, we can store any `int` value in a `MobileTypes` enum, which occurs when using custom enemies with ids not defined in the `enum`. This works as long as we don't rely on features that require a field to be defined, such as serialization to and from string.

I found that in fsSerializer, enum values are serialized as strings, based on the matching enum field name.

In the `Foe.SaveData_v1` struct, we have `foeType` as a `MobileTypes` enum. This shows in the save like this
```
                    ""resourceSpecific"": {
                        ""spawnCount"": 3,
                        ""foeType"": ""Knight"",
                        ...
                    },
```
If a field is not defined for this value (ex: custom enemy ids), this gets saved as `""foeType"": null`, which will default to 0 when loaded back in (hence the rat mentioned in the linked thread). 

To work around this issue, I've used an `int` with the id value. I have considered using a string to retain legibility, but I was not sure if it would still work once people start localizing custom enemies (we only have the Career name to identify custom enemies, and that string is user facing).

With the new save data
```
                    ""resourceSpecific"": {
                        ""spawnCount"": 1,
                        ""foeId"": 277,
                        ""humanoidGender"": ""Male"",
                        ""injuredTrigger"": true,
                        ""restrained"": false,
                        ""killCount"": 1,
                        ""displayName"": ""Morkuchas"",
                        ""typeName"": ""Ghoul"",
                        ""spellQueue"": null,
                        ""itemQueue"": null,
                        ""$version"": ""v2"",
                        ""$type"": ""DaggerfallWorkshop.Game.Questing.Foe+SaveData_v2""
                    },
```

I have found one other place where a `MobileTypes` is serialized, in `ItemData_v1`, with the field `trappedSoulType`. I have not provided a fix for this one, because:
1) many structs and interface use `ItemData_v1` explicitly. Moving to `ItemData_v2` would require updating all save structures using items to v2 (big change) and the interfaces (breaks mods)
2) custom monsters cannot be soul trapped as of now. we can keep this fix for later if we ever implement it

"
1450852095,Ensure GetMerchantMagicItems preserves seed (alternative to #2529),ajrb,2023-07-26 19:57:42+00:00,2023-08-08 23:41:16+00:00,{},"GetMerchantMagicItems() sets the random seed based on the current day. Any activity reliant on random sequence which occurs after opening the mages item seller will always have the same set of outcomes. Preserve the seed to avoid this.

This is an alternative fix to the one contributed in PR #2529 to limit the effect the change may have on the rest of the codebase. I am pretty sure there would be no ill effects from the other approach, but it's possible and given how close to release of v1.0 I am very cautious.

All credit to @chloelcdev for finding the issue, and contributing a perfectly fine fix. "
1449795900,Fix regression caused by #1861,petchema,2023-07-26 08:46:39+00:00,2023-08-09 00:58:39+00:00,{'regression': 1},"PR #1861 was added to prevent caster enemies from nuking themselves with spells at range in the presence of low obstacles.

A side effect of this PR however, is that daedra lords in the ""crossbow room"" near the end of Mantellan Crux stopped shooting at the player altogether, making this room much less threatening.

This new PR checks for obstacles a bit in front of the enemies, so they can still cast from behind thin obstacles (rationale: spells start from arm's reach). It's a bit crude, for example it doesn't change from where the spells will be really cast. While some spells get thru, daedra lords sometimes nuke themselves."
1437812739,Dim backgound for DaggerfallEffectSettingsEditorWindow,DunnyOfPenwick,2023-07-17 18:11:20+00:00,2023-08-09 00:36:05+00:00,{},The background panel of the DaggerfallEffectSettingsEditorWindow should be dimmed like in the original DF.
1436396757,Fix painting description for paintingRecord #70,petchema,2023-07-16 22:31:08+00:00,2023-08-09 00:59:31+00:00,{},"PAINT.DAT's #70 paintingRecord alternatives list for %pp2 is empty, raising an exception.

Runtime patch a list for this macro, compatible with painting gfx. In case this paintingRecord is hardcoded to be used for Wayrest Painting, it will also be compatible with the ""fog over Cryngaine Fields"" event.

It is also possible that classic does not generate text (%pp2 expands to the empty string) instead.

Forums: https://forums.dfworkshop.net/viewtopic.php?t=6336"
1416353744,Reset seed to ensure magic item shop theft randomization,chloelcdev,2023-07-01 20:15:11+00:00,2023-08-08 23:39:36+00:00,{},DaggerfallGuildServicePopupWindow.cs line 231 (in the GetMerchantMagicItems function) sets a consistent seed when opening the magic items window. This means there is no randomization when you go to steal an item from the magic shop. This change re-randomizes the seed when you're about to steal so that quickload-stealing is possible from the magic shop as I have to assume it was in vanilla.
1405633148,Proactive asset cleaning,numidium,2023-06-23 20:28:58+00:00,2024-06-16 05:12:31+00:00,{},"The purpose of this PR is to prevent any allocated Unity assets from becoming orphaned so that we can be free of asset leaks in the DFU code base.

This is currently a work-in-progress. As of the creation of this PR I've eliminated most (if not all) asset leaks in the windowing system. I will make another pass at it after I work on the world streaming and anything else that might leak memory.

This will _not_ prevent mods from leaking memory. Therefore, we will probably still need to periodically call a global asset cleanup. However, I've noticed in my tests that the memory footprint is greatly decreased between cleanup calls. Whereas the editor would show memory usage exceeding 3 gb after opening and closing shelves in a shop in under a minute, it now never exceeds 2.45 gb as long as I don't travel around the world map and stream in new areas. I haven't tested this with high-definition texture mods but I can imagine the effect is even more dramatic."
1401713302,Spawn fix for Former Student part 2,JayH2971,2023-06-21 13:32:30+00:00,2023-06-21 23:52:00+00:00,{},"Players would suffer enemy spawns in Direnni Tower after completing Former Student 2, this will prevent that."
1383775204,Commit spelling errors fixes from #2503,hornc,2023-06-08 05:48:34+00:00,2023-06-18 23:41:35+00:00,{},"closes #2503

I hope this isn't stepping on anyone's toes, but I was trying to figure out the quest strings system and was looking at these files anyway. This PR simply extracts the corrected Quests.zip file from @Sappho20 to the correct location making the files a PR.

All changes authored by @Sappho20 

(I was trying to fix a duplicated word I noticed where Queen Aubk-i said something about 'king King Gothryd', but I can't find the string in Quests/ and didn't exactly record the text... so I'll have to go back and try to reproduce.) "
1369297020,Fix biography spurious questionmarks on empty lines,petchema,2023-05-29 15:21:33+00:00,2023-06-18 23:45:03+00:00,"{'bug': 1, 'UI': 1}","Only happens when:
- not using SDF
- character has been refreshly created (not saved/reloaded)

Forums: https://forums.dfworkshop.net/viewtopic.php?t=6298"
1363957192,"""IsShield"" Changed To Virtual So Custom Shields Can Be Added, 5/24/2023",magicono43,2023-05-25 01:09:30+00:00,2023-05-25 01:10:44+00:00,{},"""IsShield"" Changed To Virtual So Custom Shields Can Be Added, 5/24/2023.

So with this property being private there is no way afaik (without hacky stuff of course) to make a custom item be considered a shield just as the vanilla ones are.

So hopefully this is a small enough change to not be an issue, thanks."
1360192809,"Localize ""USE""d maps",petchema,2023-05-22 22:35:49+00:00,2023-06-18 23:47:21+00:00,"{'bug': 1, 'UI': 1}","Translate the location written on maps used from the inventory (usually maps found in loot).
Tested to translate correctly the dialog box, the notes, and the regional map.

Screenshot before PR:
![Capture d‚Äô√©cran du 2023-05-22 01-18-01](https://github.com/Interkarma/daggerfall-unity/assets/1211431/15f52c76-90ab-4bf9-b052-c8cc2443af47)
"
1358157284,Allow clicking on save thumbnail to open save directory on Linux,petchema,2023-05-21 09:18:05+00:00,2023-06-18 23:49:21+00:00,"{'linux': 1, 'UI': 1}","Tested that it works on Linux too, so lift the restriction for Windows and OSX only"
1358152786,Add an option to hide PersistentDataPath in launcher,petchema,2023-05-21 08:58:34+00:00,2023-06-18 23:50:03+00:00,"{'UI': 1, 'refinement': 1}","Some streamers would prefer not to show PersistentDataPath in the launcher because it reveals their login name.

This PR adds a (not published) setting to hide that path. I called the setting ""HideLoginName"" to match its true intent, it case it becomes necessary in other places.

(I kept this PR minimal given feature freeze)."
1358058740,Remove delay between asset unloads,numidium,2023-05-20 21:56:46+00:00,2023-06-23 20:12:45+00:00,{'wip': 1},The addition of incremental GC makes asset unloads less jarring in my experience. Waiting less time between asset unloads should give the GC less work to do when it is called. Incremental GC was enabled here: #2390
1351579949,[RFC] Use hamburger button instead of chevron for options,petchema,2023-05-15 23:13:49+00:00,2023-06-18 23:53:20+00:00,"{'UI': 1, 'refinement': 1}","Use a more recognizable (by contemporary players) hamburger button for options
![DFU hamburger button options](https://github.com/Interkarma/daggerfall-unity/assets/1211431/42acc1e2-ae7c-4d55-a9ab-0c01b58b1fcc)

Discord: https://discord.com/channels/559842137374457876/650507773389307935/1107786016007409714

(I actually learned this is an old symbol: https://en.wikipedia.org/wiki/Hamburger_button )"
1340901158,Remove ! prefix from spell bundles in Active Spells HUD tooltips,KABoissonneault,2023-05-06 21:29:42+00:00,2023-06-18 23:54:24+00:00,{},"I've recently learned that spell bundle names are user-facing

![image](https://user-images.githubusercontent.com/5789925/236647147-5b3be30a-8b1e-45b4-83bb-dca4047a5796.png)

There's an existing practice in DF data that spells that shouldn't be sold at the Mages Guild start with ! (ex: `!Lycanthropy`). Having one of these as an active effect is not really possible in classic. With mods, it's desirable to give enemies custom spell bundles without filling up the vendor.
So, this change just removes the ! prefix of spells in the active spells HUD, making the name look less like a debug placeholder"
1331178466,Allow custom sound indices in SoundReader.GetAudioClip. ,KABoissonneault,2023-04-28 01:25:59+00:00,2023-06-18 23:59:54+00:00,{},"This can be used for custom enemies to pass new sounds in EnemySounds (ex: by providing `1000.mp3` and using `1000` as the attack sound in its Mobile structure). The value is forwarded to `SoundReplacement`, which handles non-standard values just fine.

I added some extra sanitization for negative numbers in BsaFile, because `SoundClips.None` is `-1`, which is often used as a default."
1330052772,fix TextManager.GetLocalizedTextList returning spurious ^M characters,petchema,2023-04-27 09:32:19+00:00,2023-06-19 00:13:41+00:00,"{'bug': 1, 'mac': 1, 'linux': 1}","I noticed lines like that in Player.log when french localization is installed (notice the ^Ms):

```
Added Commoners questor: ns=233508 bk=196879 name=Vannanna Copperford building=The Toad and^M Wolf^M factionId=518
```

After some investigation, it comes from Internal_String.csv / TavernsA and TavernsB that are split on \n
https://github.com/Interkarma/daggerfall-unity/blob/master/Assets/Scripts/Game/TextManager.cs#L600

That issue may be specific to non-Windows operating systems that interpret \n in different ways?

Fix source:
https://ervinkosch.info/c-split-string-on-crlf-cr-or-lf/"
1329543378,Rewrite of CSV regex parsing to avoid exponential behavior,petchema,2023-04-27 00:12:08+00:00,2023-04-27 22:13:48+00:00,{'bug': 1},"Problem was discovered after DFU froze (busy-looping) while parsing a CSV with a faulty

    1554,""%it, Le Protecteur

(missing closing quotes) line in Text/Internal_MagicItems.csv

Nested star operators - like here, `(a*b*)*` - can take exponential time under the right conditions.
Minimal fix is to replace this pattern with `(a+|b+)*`, assuming a and b share no common prefix.

I did not stop there and removed the intermediate `matches` array by directly parsing key and value columns together in the regex.

Another potential bug fix, `.Trim(""\"""")` may remove more than the quotes surrounding quoted strings, ex.

    """"""Approach"""" said the King"" -> Approach"" said the King

so I replaced it with a more explicit removal of surrounding quotes."
1322493829,Embed AudioSynthesis code and remove DLL,Interkarma,2023-04-21 05:38:43+00:00,2023-04-21 05:39:08+00:00,{},"Originally ""C# Synth Project"" at site: http://csharpsynthproject.codeplex.com/ This is now gone, so wayback: https://web.archive.org/web/20151110123619/http://csharpsynthproject.codeplex.com/ I think some changes from below topic were used when adapting to Unity. https://forum.unity.com/threads/unitysynth-full-xplatform-midi-synth.130104/ Hard to recall exactly as AudioSynthesis.dll was last updated in 2015. I made some changes also. I no longer had the code for this on hand. I eventually located project on one of my old HDDs. Took some effort to find. Having this in code will allow fixing issue in Turkish language found by TheLacus and reported in below forum reply. Affecting code is in SoundFont.cs. https://forums.dfworkshop.net/viewtopic.php?p=52754#p52754 Removed AudioSynthesis DLL and music still plays OK. It's the same plugin, just not in DLL form. Still need to apply TheLacus' suggested fix for Turkish and test everything. Putting it all in a branch for now. It's all self-contained so can be merged at any time when ready."
1306557833,Force clickAnyWhereToClose behavior on message boxes with no buttons,DFIronman,2023-04-08 18:42:27+00:00,2023-04-08 19:18:32+00:00,{},"Currently, if you create a message box with `clickAnywhereToClose` set to `false` (the default), there's no way to get rid of the message box if it doesn't have a button that closes it. Unless there's a reason why this behavior is needed, here's a very small change that will allow the player to close buttonless message boxes that neglected to set `clickAnywhereToClose` to `true`."
1277717948,Use custom billboard gameobject for quest NPCs,KABoissonneault,2023-03-16 00:45:27+00:00,2023-06-21 23:51:16+00:00,{},"Unlike other static NPCs, quest NPCs didn't take custom flat gameobjects into account. So, no custom animation for Vanilla Enhanced, no 3d model.

With the fix:
![image](https://user-images.githubusercontent.com/5789925/225480065-16307335-9fa6-44a2-961b-cddb25ed112d.png)

"
1261936775,Update Q0C00Y03.txt,JayH2971,2023-03-03 11:33:43+00:00,2023-06-19 00:15:48+00:00,{},"Adds questor's location and name to quest log, as players had difficulty returning at quest end."
1237804622,Adds a world data RMB block editor to Unity DFU tools,Podleron,2023-02-11 17:59:13+00:00,2024-01-29 00:59:47+00:00,{},I created this modding tool to make editing RMB blocks easier. You can find more information on how it can be used here: https://forums.dfworkshop.net/viewtopic.php?t=6105
1237249116,Add time limit reminder to DB entrance quest,JayH2971,2023-02-10 20:52:18+00:00,2023-02-11 22:54:14+00:00,{},Another case with a time limit the game doesn't explain. Better declared than not.
1232859794,"Extended max ""terrain distance"" to 6",KABoissonneault,2023-02-08 02:00:33+00:00,2024-04-14 19:53:23+00:00,{},"I've seen players use a custom DFU build to run terrain distance at 6. Seems viable on some PCs. 
For a while, people have been running Distant Terrain, which adds an extra 4 low-quality tiles around the terrain, which kind of looks like a distance of 8.
However, users have reported memory and other issues with DT in recent versions. Running DFU with a higher terrain distance seems easier for them.

So, I don't think allowing this is harmful. Users can experiment and see what they prefer.

I could consider letting the max go to 8, not sure if that's something anyone would run."
1231336449,Moved EnemyEntity methods to FormulaHelper for mod override,KABoissonneault,2023-02-07 02:55:14+00:00,2023-04-22 01:55:54+00:00,{},"Added FormulaHelpers for EnemyEntity:

- GetEnemyGroup
- GetLanguageSkill
- GetWeightInClassicUnits

The first is necessary for the functioning of Pacify and Dispel spells effects to work on custom enemies. The second is for the language pacification feature.
![image](https://user-images.githubusercontent.com/5789925/217136027-5320b449-9ee5-49ea-b3b2-67eb9aa54732.png)

The third one, I don't plan on using just yet, but I felt I might as well add it for completion."
1229400139,Use uppercase ?PAINT.CIF filenames,petchema,2023-02-05 10:13:51+00:00,2023-02-07 22:32:05+00:00,{'bug': 1},"Matters for case-sensitive operating systems, like Linux or OS X

Fix for #2491 

I wonder if there could be other similar bugs hiding, because that one was almost silent (unless you keep an eye on the logs)"
1218164597,Typos in quest S00000003,petchema,2023-01-26 16:59:53+00:00,2023-01-26 17:01:21+00:00,{},"Reddit:
https://www.reddit.com/r/daggerfallunity/comments/10lv3gh/shedungent_not_shedugent/"
1218128358,S0000003 and M0B11Y18 fixes Jan 2023,JayH2971,2023-01-26 16:31:30+00:00,2023-02-07 22:45:52+00:00,{},
1200387001,Mod Organizer support in editor,domportera,2023-01-17 14:47:58+00:00,2023-01-18 18:59:52+00:00,{},"A simple tool for debugging mods and mod compatibility, and also profiling daggerfall engine functions that the mods rely on. Efforts were made to make this simple to use and largely non-destructive

I'm new to ModOrganizer (and this repo of course. and daggerfall) so I don't know if this will work with non-portable Mod Organizer data folders. I only have familiarity with a portable data folder. Though in theory it should."
1169919885,[C0B10Y15] The Relic does not give extra reputation,JorisVanEijden,2022-12-18 18:58:53+00:00,2023-01-17 22:28:52+00:00,{},"Move the ending of the quest to the end of the quest. This should give S.03 a chance to trigger without being stopped at S.01.

Fixes https://forums.dfworkshop.net/viewtopic.php?t=5679"
1169907825,Bug when giving the totem to Gothryd,JorisVanEijden,2022-12-18 17:59:27+00:00,2023-01-17 22:30:23+00:00,{},"Removes the requirement to be outside the castle (S.07) before Gothryd will ""thank"" and reward you for giving him the Totem.

Fix for https://forums.dfworkshop.net/viewtopic.php?t=4845"
1168817736,Always allow custom items to handle UseItem themselves.,JorisVanEijden,2022-12-16 18:48:20+00:00,2023-01-17 22:31:11+00:00,{},"`UseItem()` overrides on custom items would only trigger on `LocalItemListScroller_OnItemClick` and `RemoteItemListScroller_OnItemClick`. 

Moving the ""own usage handling"" to the `UseItem()` method allows overrides to trigger from `AccessoryItemsButton_OnMouseClick` and `PaperDoll_OnMouseClick` as well.

Fix for https://forums.dfworkshop.net/viewtopic.php?t=5936"
1167676848,Merge mouse-smoothing,Interkarma,2022-12-16 01:38:23+00:00,2022-12-16 02:05:50+00:00,{},
1167197167,2430 fix %god macro for fighters guild,JorisVanEijden,2022-12-15 18:21:09+00:00,2023-01-17 22:40:32+00:00,{},"This is a fix for using a %god macro in a quest when inside a Fighters Guild hall in a region where this is considered a temple.
It will pick a random deity name, rather than crashing the quest.

I also fixed the existing random deity name selection, which could pick non-existing factionIds 23, 30, 31, 32 and 34.
"
1159712748,Add prohibited action event for DaggerfallEntity and Callbacks in ItemEquip and ReadySpell,GoldenKaiju,2022-12-12 01:24:05+00:00,2023-01-17 22:35:59+00:00,{},"Mod extension for prohibited items and and spell silence/disabled check event

This creates a callback in DaggerfallEntity for ""prohibited actions"", and changes the bool checks within a few functions to be events with a bool return type. When a function is made to complete early due to a check failing, an OnProhibitedAction event is raised.

The main behavioral changes in the commit:
1. Any player equip OnDisableEquip events that fail now produce the prohibited message. Before this change, only the EquipItem method within DaggerfallInventoryWindow would display the prohibited message.
2. Check events which fail produce another callback, potentially creating 2 callbacks total if they fail. I believe the additional complexity and small computational cost for the callbacks are worth it in exchange for mod accessibility.

Minor differences are:
- UnequipItem now has a disabled check event. However, the current result of event always unequips the item like before.
- UnequipItem with 2 params slot EquipSlot and list, now returns a bool, which was previously void. Since this was only a helper function used within ItemsEquipTable, it seemed fine to do and it was necessary for prohibited unequips to work properly.


The reason for this change is exposing these prohibited checks to modders for custom behavior and a new event modders can use when prohibited action has occurred. I intend to use some of these myself in upcoming mods I am creating.

This commit opens:
- Prohibited weapons and armor equips and OnProhibitedAction callback for enemies and non-player classes inheriting DaggerfallEntity
- Prohibited spells based on any arbitrary condition
- More fine detail prohibited rules for item equips
- Prohibited unequips for weapons, cursed items
- Callback events when any prohibited action occurs

While there were more changes than I originally expected, a good chunk of these changes are cut and paste reorganization. The second commit with OnDisableReadySpell shows how few lines are needed when replacing an if statement and how simple the changes can be.

I think the prohibited action event for daggerfall entities is a useful extension. It can be expanded to include other types of behavior/systems in the future. I wouldn't know of another way to expose this functionality for modders without being mod incompatible. One thing I decided to not modify was the special weapon handling for arrows. Since arrows in EquipItem always return null, you could argue it's part of the OnDisabledEquip check. It wasn't necessary to modify as part these commits, although it could be added in the future."
1158230166,Increase Maximum Mouse Sensitivity to 20,ghost,2022-12-10 22:58:54+00:00,2022-12-11 00:44:39+00:00,{},"This will allow people like me to look around better, since i like my sensitivities REAL high!"
1157073409,Raise an event when a crime is committed,DFIronman,2022-12-10 03:17:55+00:00,2022-12-16 02:41:31+00:00,{},"Modding support.

This may be a useful event for a number of future mods - it's necessary for mine. I made a crime system overhaul the allows the player to accrue multiple counts of a single crime/multiple crimes, and they're all tracked by region.

An event wasn't necessary before, but a breaking change was added in a DFU commit since I last worked on my mods that de-spawns guards when the player's crime is set to ""None"" (this is probably for the best).

Unfortunately, I relied on setting the player's crime to ""None"" as soon as a crime was committed, as I kept track of all crimes committed via a dictionary. The reason why it was necessary to set the crime to ""None"" is because the counts will add up very quickly over Update() calls.

Storing the last time a crime was committed and keeping track that way will not work if a player commits the same crime twice in a row, as playerEntity.crimeCommitted's value doesn't change, so there's no way to tell if the player has committed the crime only once or ten times in a row.

Hopefully, this is low impact enough to be rolled in at this stage of DFU development. Alternately, I'm open to other suggestions if someone has a solution, but I feel like this event is something that has potential for others to find quite useful."
1154377723,Changes to support class overrides for some component classes.,DunnyOfPenwick,2022-12-08 16:00:15+00:00,2023-07-13 14:43:49+00:00,{},"Changing 'private' variables/methods to 'protected', making some methods 'virtual'. "
1145440346,Implement raycast lookahead collision for missiles,numidium,2022-12-04 23:24:22+00:00,,{},"I plan to test this some more before it gets integrated into master but so far everything seems to be working. I made this PR to address a few issues with missile collision I've noticed over the years:

1. Ranged spells can be sent through walls if the player is close enough to the wall.
2. Enemy arrows can sometimes push the player out of their path without causing damage.
3. Spell missiles will sometimes be mounted by their targets after collision as if they're solid objects.

I tried tweaking Unity's physics/collision classes many different ways to alleviate these problems before giving up and rolling my own collision system specifically for missiles. I implemented fixed-interval movement steps (i.e. ticks) for missiles that check for obstacles using raycasts before moving forward.
The advantage of using a fixed interval is that the missiles don't do a raycast on every call to Update. According to the docs, Update is called every frame so the raycasts-to-time ratio would scale to the frame rate which would cause unnecessary strain on the system. Instead, we can tweak the missiles' movement time step to meet our needs.
I assigned separate tick rates for arrows and spell missiles since the former uses rays and the latter uses spheres. I assumed that sphere casting is more expensive than ray casting so I made the tick rate somewhat lower both for that reason and that spheres probably don't need as many timesteps for precision as arrow rays.

Overall I feel this will give us more control over what happens to missiles and should make it impossible for them to go through walls.

EDIT: Per petchema's suggestion, I moved the logic to FixedUpdate so now it uses the global physics tick rate of 50."
1144767559,Adjust arrow position relative to camera rotation,numidium,2022-12-04 07:41:23+00:00,2022-12-16 05:09:07+00:00,{},"Prevents arrows spawning off-center from player perspective.

**Problem:**
When player aims the bow far enough up or down, arrows spawn noticeably off-center from the camera's perspective.

**Solution:**
Adjust the arrow origin ""down"" from the camera's perspective instead of moving it down the Y-axis."
1142233719,Travel Map: Discrepancy between Find results and discovered location ‚Ä¶,AverniteDF,2022-12-01 18:10:16+00:00,2022-12-02 03:33:21+00:00,{},"‚Ä¶dots

To reproduce issue:

1. Open Travel Map 'v'
2. Select Isle of Betony
3. Start location search 'f'
4. Type 'a' and press Enter
5. Select 'The Wickcroft Cabin' (fourth entry)
6. Notice that you can travel to 'The Wickcroft Cabin' even though its location dot is not being shown on the map

Why it's happening:

The Wickcroft Cabin has 'discovered' status but it also has a pixel color index of -1 which prevents it from being displayed on the region map.

The offered code gives parity between FindLocation() and UpdateMapLocationDotsTexture().

This may or may not be the correct solution as I am not sure why 'The Wickcroft Cabin' (and many other locations) are 'discovered' but have a color index of -1."
1136846867,Rectify lycanthrope guard spawning behavior ,nights192,2022-11-28 00:35:55+00:00,2023-01-17 23:16:03+00:00,{},Relatively simple change that prevents guards from despawning with player crime state when the player is a transformed lycanthrope.
1130844646,Quest fix Nov 2022,JayH2971,2022-11-22 01:06:07+00:00,2022-12-16 02:30:47+00:00,{},"r0c11y28, Mad Slayer: this one didn't have ""clearclick"" mechanisms in place. Also removing every element of the ""dead body,"" which appears for no reason and has no function. Am cutting it out as a presumed mistake."
1129032001,Allow commas in localization table values,AverniteDF,2022-11-20 04:07:12+00:00,2022-11-20 05:06:59+00:00,{},"If there's a way to do this already please let me know because it seems there ought to be.

Two options presented:

1) Allow alternative value separator (pipe) to be defined in schema
![schema_pipes](https://user-images.githubusercontent.com/115361770/202884871-e12a1313-3341-4326-98d2-42b7488edc85.png)

2) Parse escaped character values
![schema_escaped_values](https://user-images.githubusercontent.com/115361770/202884887-4b1ad551-7b85-4487-a6ad-2b7f176d5a8d.png)"
1126740966,Serialize PlayerTeleportedInsideDungeon,petchema,2022-11-17 23:46:08+00:00,2022-11-20 05:07:29+00:00,{'enhancement': 1},"Serialize PlayerTeleportedInsideDungeon so that dungeon doors can be opened from inside, even if player has saved/reloaded the game.

Problem of doors not always opening from inside after teleport mentioned by Aina the Khajiit on Discord:
https://discord.com/channels/559842137374457876/599345625569689620/1042632093072625845
Strictly speaking she couldn't tell if it stops working for her because of save/reload cycle.

PlayerTeleportedInsideDungeon flag and discussion about this very PR: 
see commit e81b2d7283cbc1d8c9ac56d6ad3d1e06d201af80"
1122338395,Update K0C00Y06.txt (A Mix-Up quest),JayH2971,2022-11-15 04:46:55+00:00,2022-11-20 05:07:57+00:00,{},"Typo and reputation fix. During the quest, the player could suffer Criminal Conspiracy charges that lower legal rep even more. A full refresh at the end of the quest is better."
1114028496,"re-work caching, de-couple gfx change from caching",numidium,2022-11-08 09:06:10+00:00,2022-12-16 02:42:10+00:00,{},"Had to work through multiple issues.
1. SpecificWeapon needed to be set right before the caching routine so proper cache keys can be referenced.
2. Used a pigeon-hole cache instead of a queue for the right/left hands. The queue couldn't cache for both hands in every case.
3. Modified GetWeaponTextureAtlas to not alter the screen weapon's current custom textures. The caching routine uses this method so I opted to put the newly loaded textures in an output parameter where it can be assigned to customTextures as needed.

I went through the steps to reproduce the bug outlined in https://forums.dfworkshop.net/viewtopic.php?t=5954. I do not have DREAM installed but I have another texture replacer (Diverse Weapons). I was seeing similar issues before while using it but they are now resolved with these changes."
1111444261,Scale sky panels according to current fov relative to start-up fov,AverniteDF,2022-11-05 03:05:08+00:00,2022-11-06 22:11:41+00:00,{},"The `DaggerfallSky.skyScale` member needs to be accessible for mods that would like to alter zoom level.

For example, if a modder wanted to apply zoom while bow is drawn and held the skywall backdrop needs to be scaled in addition to modifying the fov for proper zoom effect.

A more compete solution for this would be the addition of an FPSZoom class to provide an obvious API for zoom behavior.

I would be interested in implementing such a class just let me know if there's an interest.

**UPDATE:**

Actually, exposing that field probably isn't necessary.

DaggerfallSky can scale its panels according to fov in a way that doesn't change the way the backdrop looks when no fov modifiers are applied.

This can be done by scaling the panels by the following factor:

```
float relativeZoom = Mathf.Tan((DaggerfallUnity.Settings.FieldOfView * 0.50f) * Mathf.Deg2Rad) / Mathf.Tan((mainCamera.fieldOfView * 0.50f) * Mathf.Deg2Rad);

float width = (int)(Screen.width * skyScale * relativeZoom); // Panel width
float height = Screen.height * skyScale * relativeZoom; // Panel height

```
This works because when main camera fov is the same as game settings (initial) fov you get a `relativeZoom` of 1.0f (no change). The only limitation is on zooming out because the panels get smaller, but zooming in from initial pov is unlimited and accurate."
1110316739,SwingWeapon can be converted to ActivateCenterObject when weapon is sheathed,AverniteDF,2022-11-04 03:25:02+00:00,2022-11-06 22:24:04+00:00,{},"Either mouse button will then work for opening doors, etc. when weapon is sheathed."
1110169252,Taverns too dim at night when using Simplified Interior Lighting option,AverniteDF,2022-11-03 22:10:14+00:00,2022-11-03 23:54:22+00:00,{},"Taverns are lively places that should be well lit and welcoming all hours of the day.

![tavern_dim](https://user-images.githubusercontent.com/115361770/199843435-1ce73072-9e4e-4e0c-8db4-eed2a7c15a71.png)
Inside of tavern at night when Simplified Interior Lighting is enabled

![tavern_lit](https://user-images.githubusercontent.com/115361770/199843477-1ccc23e1-b4b2-4d88-bd00-cfd64b18274c.png)
How it should look (in my opinion) so players feel like taverns are a safe haven from the night"
1110139871,Fix 'unaccepted keys' not being allowed for bindings in control settings,jefetienne,2022-11-03 21:32:10+00:00,2022-11-20 05:09:10+00:00,"{'regression': 1, 'UI': 1}","From Pango's [comment](https://github.com/Interkarma/daggerfall-unity/issues/2428#issuecomment-1301489156).

My apologies for not checking this earlier! Since it does break binding things as simple as ""Shift"" back to sprint for example, I'm not sure if this warrants a hotfix release. I do know as a workaround, you can simply rebind in the Keybinds.txt file."
1109024904,Add missing fireplace audio (burning loop),AverniteDF,2022-11-03 02:26:06+00:00,2022-11-03 23:55:30+00:00,{},The code adding burning sound to torches is easily adapted for use with fireplaces too.
1108485439,`DaggerfallBillboardBatch` fix for an issue #2455,andrew-raphael-lukasik,2022-11-02 16:01:03+00:00,2022-12-16 02:40:16+00:00,{},"# What:
Calls `OnDestroy()` on `PlayModeStateChange.ExitingPlayMode` (editor only).

# Why:

> I haven't confirmed yet, but DunnyOfPenwick on forums has raised another warning about native collection not being disposed. This one happen when game closes from inside a building directly after load, so should only be a minor problem and not impact gameplay.
> 
> https://forums.dfworkshop.net/viewtopic.php?t=5937
_Originally posted by @Interkarma in https://github.com/Interkarma/daggerfall-unity/issues/2436#issuecomment-1297843900_

Also seen as https://github.com/Interkarma/daggerfall-unity/issues/2455

# Results:
Exceptions are gone. Builds unaffected."
1106172664,Immediate Ambient Light Updating To Prevent Flicker On Transition To ‚Ä¶,AverniteDF,2022-11-01 02:53:40+00:00,2024-07-04 22:28:29+00:00,{},"‚Ä¶Exterior

The purpose of this PR is to eliminate the glitchy flicker you sometimes get when exiting a building.

What the world outside looks like for a few frames before lighting gets updated:
![transition_to_exterior_first_few_frames](https://user-images.githubusercontent.com/115361770/199148073-e6ae9e3c-72d9-4377-9c57-43645da6eaae.png)

And after:
![transition_to_exterior_after](https://user-images.githubusercontent.com/115361770/199148103-6f4f540f-aa00-4a46-a75d-e23c9d591d7a.png)

Immediate calls to PlayerAmbientLight.UpdateAmbientLight solves this.

The proposed code calls that method twice: once in the current frame and again on the next. The combination of the two calls completely eliminates all flickering as far as I can tell (I disabled HUD fade in so I could see every frame)."
1104508288,"Crouch to Stand Eye-height Bug, Quick Fix",AverniteDF,2022-10-30 16:09:58+00:00,2022-12-16 04:39:49+00:00,{},"When character crouches then stands the camera is raised to full height instead of eye height.

A quick fix for this is to subtract eyeHeight * 2 from standingHeightAdjustment in PlayerHeightChanger.cs line 271:

standingHeightAdjustment = 0 - eyeHeight * 2;"
1098139814,Allow access to tagged spells even without a spellbook,petchema,2022-10-24 22:58:30+00:00,2022-10-27 02:10:07+00:00,{'enhancement': 1},"
Fix would be relatively simple if DaggerfallSpellBookWindow.spellListBox and PlayerEntity.spellbook didn't use the same indices.
To be able to only show a subset of the known spells, some index mapping (spellBookIndices list) has been added.

Forums: https://forums.dfworkshop.net/viewtopic.php?t=5924"
1092957362,added: `DaggerfallStaticDoors.OnDrawGizmosSelected()` to debug door trigger placements,andrew-raphael-lukasik,2022-10-19 22:55:16+00:00,2022-11-20 05:13:54+00:00,{},"# What

> This is small and unimportant PR. You can close it rn if you see it of no worth to the project.

Moves commented out ""Debug trigger placement at start"" code block from `Start()` and puts it into `OnDrawGizmosSelected()`

# Why

I needed to see where the door triggers were... the code was ready written already, so.

# Results

Door gizmos shows up when `DaggerfallStaticDoors` instance is selected only, so it wont pollute the screen nor slow down the editor everywhere. `#if UNITY_EDITOR` makes sure this won't ever end up in a build.

![Screenshot 2022-10-18 232154](https://user-images.githubusercontent.com/3066539/196818826-0cbe166c-2281-4c33-a8f7-d70b14d06827.png)

"
1088614097,Fix exceptions when bashing certain doors,numidium,2022-10-17 01:49:36+00:00,2024-04-06 17:42:46+00:00,{},"Leverages ActivateStaticDoor when bashing static doors so all door types are handled. Currently, only exterior doors in settlements are handled. This mimics classic behavior with the exception that dungeon exterior doors can be bashed too."
1086828361,Prevent missile collision from moving entity,numidium,2022-10-14 01:48:19+00:00,2022-10-17 02:51:06+00:00,{},In some cases spell or arrow missiles could cause their targets to bump over them as mentioned in the code comment. Setting the collider to trigger and the rigid body to kinematic at start seemed to fix this without causing any other issues in my tests.
1086745665,RAII compliance for all static events,andrew-raphael-lukasik,2022-10-13 23:31:48+00:00,2024-06-18 01:28:44+00:00,{},"# What

I scanned the entire codebase for classes that register `static event`s `+=` but never bother to unregister them `-=` once class is destroyed etc. and made sure they do that.

![Screenshot 2022-10-13 233742](https://user-images.githubusercontent.com/3066539/195726984-ce8d2bee-890c-47ba-b64b-e953e0d8e987.png)

# Why

1. I need this for #2442
2. I am 100% positive this caused errors in the past and will cause them in the future, if not fixed

At first I needed this for test setup only. But after digging into the codebase and realizing how prevalent this issue is I convinced myself that this is serious.

I am definitely no fan of programming dogma but RAII makes sense even if we call it differently or none at all. Making sure that resource is allocated (here: event registered) on object construction and then deallocated (here: event unregistered) makes sense on a very practical level - there are always errors somewhere eventually if we don't fancy doing that.

# Results

This PR spans across many files over different domains unfortunately so it will require some additional attention to make sure this wont break anything when merged. If you read the code changes you can see that these are not invasive changes, thankfully. All are either `OnDestroy` or destructor additions - so are vastly safer that most code changes as they won't break existing code execution loops (these calls are managed by Unity engine and CLR)."
1086728962,added: `ModManager.OnDestroy()` to unload loaded asset bundles,andrew-raphael-lukasik,2022-10-13 23:04:58+00:00,2024-06-18 01:27:19+00:00,{},"# What

 `OnDestroy()` added to unload asset bundles from `List<Mod> mods;`. That's all.

# Why
#2442, for better or worse, requires that all scripts clean up after themselves

# Results

Destroying a `ModManager` will unload asset bundles associated with loaded mods."
1086486446,added: `StreamingWorld` unregisters events on `OnDestroy()`,andrew-raphael-lukasik,2022-10-13 18:28:47+00:00,2022-10-14 10:06:17+00:00,{},"# What

`OnDestroy()` added so `StreamingWorld` can unregister it's events. That's all.

# Why

`StreamingWorld` registers events (`+=`) on `Awake` but was never unregistering them back (`-=`). This was probably never an issue until #2442 where `DaggerfallUnityGame` scene can be loaded and unloaded back and forth for testing purposes.

# Results

`StreamingWorld` cleans up after itself."
1085981593,better exception message for `SerializableStateManager.GetStatefulGameObjectType`,andrew-raphael-lukasik,2022-10-13 12:02:33+00:00,2022-12-16 02:29:29+00:00,{},"# What

More precise exception message for `SerializableStateManager.GetStatefulGameObjectType` method

# Why

Misleading `Exception: ISerializableGameObject type not implemented for DaggerfallWorkshop.Game.Serialization.SerializablePlayer` appeared while working on #2442

# Results

This PR does not resolve the underlying issue but fixes the messaging to clear out confusion first.

A new message is:
```
NotImplementedException: GetStatefulGameObjectType does not know what to do with DaggerfallWorkshop.Game.Serialization.SerializablePlayer
DaggerfallWorkshop.Game.Serialization.SerializableStateManager.GetStatefulGameObjectType (DaggerfallWorkshop.Game.Serialization.ISerializableGameObject sgObj) (at Assets/Scripts/Game/Serialization/SerializableStateManager.cs:495)
DaggerfallWorkshop.Game.Serialization.SerializableStateManager.DeregisterStatefulGameObject (DaggerfallWorkshop.Game.Serialization.ISerializableGameObject serializableObject) (at Assets/Scripts/Game/Serialization/SerializableStateManager.cs:263)
DaggerfallWorkshop.Game.Serialization.SaveLoadManager.DeregisterSerializableGameObject (DaggerfallWorkshop.Game.Serialization.ISerializableGameObject serializableObject) (at Assets/Scripts/Game/Serialization/SaveLoadManager.cs:553)
DaggerfallWorkshop.Game.Serialization.SerializablePlayer.OnDestroy () (at Assets/Scripts/Game/Serialization/SerializablePlayer.cs:88)
```

I am not familiar with this segment of the codebase atm to resolve this further on my own so I will leave that to the professionals to decide.
"
1085207235,"Revert ""Prevent ending on any key by default for video playback""",Interkarma,2022-10-12 20:46:16+00:00,2022-10-12 20:46:22+00:00,{},Reverts Interkarma/daggerfall-unity#2438
1083273248,Test around; find out,andrew-raphael-lukasik,2022-10-11 12:49:44+00:00,2023-10-18 18:19:57+00:00,{},"# What

A foundational setup to execute automated gameplay (play mode) tests. It includes few test examples to help everyone figure out how to write their own test cases.

Test will fail if an exception is thrown anywhere. So it won't catch all the types of errors by itself. For the exception-less cases place `Assert.IsTrue()` to make sure the code throws when some specific data is outside of valid range.

One important requirement of this setup is an [assembly definition](https://github.com/andrew-raphael-lukasik/daggerfall-unity/blob/CASE17_test-around-find-out/Assets/DFU.asmdef) that includes the game code. This means that the game code wont go into `GameAssembly.dll` (or something like that) but into `DFU.dll` now.

# Why

Merging a branch and then realizing it broke something that worked perfectly until now is not a productive way to merge branches (case of #2427 being an inspiration here). But there is a way to prevent that without sinking hours on testing everything manually every time - enter *Unit Tests*.

# Results

With a single click and bit of patience (<5min leaving Unity do it's thing) you can, for example, visit 100 locations now:

![Screenshot 2022-10-11 143526](https://user-images.githubusercontent.com/3066539/195091946-c3b7dfd1-3a5b-459f-90cd-c42d997c891d.png)
"
1081146336,Improved Mouse Look Camera Smoothing,AverniteDF,2022-10-09 01:27:19+00:00,2022-12-16 01:25:01+00:00,{},"This submission contains a reworking of the camera smoothing code located in PlayerMouseLook.cs. The purpose of this reworking is primarily to increase behavioral parity between the ""smoothing"" and ""no smoothing"" modes. Moving the mouse an inch in a certain direction should give identical yaw/pitch deltas (ultimately) for both modes, it's just that one mode is progressive and the other is immediate.

Note: To increase or decrease the camera smoothing effect you may edit the following value (located near top of class):

float smoothing = 0.5f;

For example, a value of 0.3f will give a very subtle smoothing effect and a value of 0.8f will give a very pronounced smoothing effect (at the cost of less responsiveness/higher latency). I have chosen a value of 0.5f because I feel it is suitable for production. It is possible that the ""Mouse Smoothing"" checkbox could be replaced with a slider ranged 0.0 to 0.9, in future releases."
1081044743,Update SerializablePlayer.cs,AverniteDF,2022-10-08 15:48:32+00:00,2022-10-09 01:14:20+00:00,{},Required change for proposed refactoring of PlayerMouseLook.cs
1081044040,Refactor PlayerMouseLook.cs,AverniteDF,2022-10-08 15:44:48+00:00,2022-10-09 01:13:03+00:00,{},"This submission contains a refactoring of the camera smoothing code located in PlayerMouseLook.cs. The purpose of this refactoring is two-fold:

1) To increase behavioral parity between ""smoothing"" and ""no smoothing"" modes. Moving the mouse an inch in a certain direction should give identical yaw/pitch deltas (ultimately) for both modes, it's just that one mode is progressive and the other is immediate.

2) To simplify the existing implementation by decreasing lines of code and variables involved while providing the same level of functionality. This wasn't really a goal from the outset but more a result of implementing the first point. Both ""smoothing"" and ""no smoothing"" modes are now handled with a single block of code instead of branching into two separate blocks of code.

Note: To increase or decrease the camera smoothing effect you may edit the following value (located at PlayerMouseLook.cs : line 196 at time of original submission):

float smoothing = enableSmoothing ? 0.5f : 0.0f;

For example, a value of 0.3f will give a very subtle smoothing effect and a value of 0.8f will give a very pronounced smoothing effect (at the cost of less responsiveness/higher latency). I have chosen a value of 0.5f because I feel it is suitable for production. It is possible that the ""Mouse Smoothing"" checkbox could be replaced with a slider ranged 0.0 to 0.9, in future releases.

Note: This submission also contains a small but necessary change in SerializablePlayer.cs (included in this branch)."
1080881730,Prevent ending on any key by default for video playback,jefetienne,2022-10-08 00:57:19+00:00,2022-10-11 22:09:17+00:00,{},"#2437

Set endOnAnyKey to false by default in DaggerfallVidPlayerWindow, but allow spacebar and Escape/back buttons."
1076251994,Exclude modifier keys from being used in AnyKey methods,jefetienne,2022-10-04 16:28:08+00:00,2022-10-12 20:47:12+00:00,{},"From the discussion of #2428.

Originally I was going to go with a whitelist of keys to be accepted, but since there isn't any formalized controller default buttons yet, I decided instead to create a list of unaccepted keys."
1073892479,DaggerfallBillboardBatch: mesh data creation process multi-threaded (take 2),andrew-raphael-lukasik,2022-10-02 16:59:55+00:00,2022-10-11 22:05:13+00:00,{},"#2427 re-uploaded for further consideration

> Hi! This PR is part of https://github.com/Interkarma/daggerfall-unity/pull/2416 saga.
> 
> # What
> 
> I refactored #2416 changes to the `DaggerfallBillboardBatch.cs` to make them more conservative, safe and limited to a single file. It delivers less benefits than original, but will serve as a good foundation for future improvements which has been identified so far.
> 
> I know you guys have other priorities now so no worries - take your time. I am posting this now while my mind is still familiar with this code.
> 
> # Results
> 
> - `CreateMesh` takes less time from the main thread. Before: about `266 ms` (left), after: about `34 [s]` (right):
> <p float=""center"">
>     <img src=""https://user-images.githubusercontent.com/3066539/189755528-f406d57f-0c53-4304-bf25-c43fca48e5c7.png"" width=""49%"">
>     <img src=""https://user-images.githubusercontent.com/3066539/189755532-fc8c4de2-d5e6-426b-8210-6f507ad65590.png"" width=""49%"">
> </p>
> 
> - `AddItemsAsync` were added to open the door for future decrease in the overhead from the thousands of separate  `AddItem` calls (about an `100 ms`, sometimes more)
> 
> - `ProfilerMarker` introduced, to make profiling much more granular and informative. My controversial proposal here is in it's naming convention ie. `____PascalCase` (for methods) and `____camelCase` (for generic markers). I tried different schemes and this was my conclusion as most consistent and readable, but you might have different conclusions. Prefix `___` especially helps with readability as it makes these markers * immediately * apparent and distinguishable from the rest of the code mid-all these busy methods.
> "
1073751353,"Revert ""DaggerfallBillboardBatch: mesh data creation process multi-threaded""",Interkarma,2022-10-02 05:41:09+00:00,2022-10-02 05:41:23+00:00,{},Reverts Interkarma/daggerfall-unity#2427
1065803110,Quest L0B30Y09 typo: mars -> marks,deepfighter,2022-09-23 22:20:00+00:00,2022-09-24 11:03:51+00:00,{},A small typo correction from classic.
1060457011,improvement: mod compilation error message,andrew-raphael-lukasik,2022-09-19 15:17:33+00:00,2022-10-11 22:07:32+00:00,{},"# What
A change in `DaggerfallWorkshop.Game.Utility.Compiler` to help fellow mod developers fix mod compilation errors more easily.

> edit: since [1911297](https://github.com/Interkarma/daggerfall-unity/pull/2432/commits/191129724181daa3a962435e2fcdec9f9d9d265b) this includes minimal changes in `Mod.cs` and `ModManager.cs` so compilation API can pass mod title+version as an optional parameter.

# Why
I compiled a mod, ran the game, mod failed to load. Saw this error message:
![Screenshot 2022-09-19 160736 b](https://user-images.githubusercontent.com/3066539/191048748-d716ec33-5f88-4654-af59-99f7f39cf130.png)

<p>
    <img src=""https://user-images.githubusercontent.com/3066539/191051095-5fd8197a-3272-436e-a8eb-cd13fc9b1d95.jpg"" height=""140px"">
</p>

# Results

Now I can see this:

![Screenshot 2022-09-20 162939](https://user-images.githubusercontent.com/3066539/191293130-d19352c4-c85d-4deb-b9c2-e6307b201f0d.png)

<p>
    <img src=""https://user-images.githubusercontent.com/3066539/191051193-4ed5cf08-23ee-4a21-ac6b-123fd11d9f34.jpg"" height=""140px"">
</p>
"
1059437877,Fix flying enemies fall damage,petchema,2022-09-18 02:04:44+00:00,2022-10-11 22:08:14+00:00,{'bug': 1},"Flying enemies hitting ground (recoil, under paralysis,...) were taking fall damage relative to their spawn location, because their lastGroundedY was never updated.

This can be fixed several ways, in this patch I extend lastGroundedY to flying enemies by updating it as long as flyingFalls is false; It could be renamed say lastAltitudeControlY, the last value of Y when the enemy had control over its altitude.

Forums: https://forums.dfworkshop.net/viewtopic.php?t=5874"
1053898757,DaggerfallBillboardBatch: mesh data creation process multi-threaded,andrew-raphael-lukasik,2022-09-12 21:24:58+00:00,2022-10-02 01:42:40+00:00,{},"Hi! This PR is part of https://github.com/Interkarma/daggerfall-unity/pull/2416 saga.

# What

I refactored #2416 changes to the `DaggerfallBillboardBatch.cs` to make them more conservative, safe and limited to a single file. It delivers less benefits than original, but will serve as a good foundation for future improvements which has been identified so far.

I know you guys have other priorities now so no worries - take your time. I am posting this now while my mind is still familiar with this code.

# Results

- `CreateMesh` takes less time from the main thread. Before: about `266 ms` (left), after: about `34 [s]` (right):
<p float=""center"">
    <img src=""https://user-images.githubusercontent.com/3066539/189755528-f406d57f-0c53-4304-bf25-c43fca48e5c7.png"" width=""49%"">
    <img src=""https://user-images.githubusercontent.com/3066539/189755532-fc8c4de2-d5e6-426b-8210-6f507ad65590.png"" width=""49%"">
</p>

- `AddItemsAsync` were added to open the door for future decrease in the overhead from the thousands of separate  `AddItem` calls (about an `100 ms`, sometimes more)

- `ProfilerMarker` introduced, to make profiling much more granular and informative. My controversial proposal here is in it's naming convention ie. `____PascalCase` (for methods) and `____camelCase` (for generic markers). I tried different schemes and this was my conclusion as most consistent and readable, but you might have different conclusions. Prefix `___` especially helps with readability as it makes these markers * immediately * apparent and distinguishable from the rest of the code mid-all these busy methods.
"
1053187244,.,xardasVB,2022-09-12 11:36:25+00:00,2022-09-12 11:36:39+00:00,{},.
1052625719,typo coven quest: in imprisoned -> imprisoned,breakfastitem,2022-09-11 23:38:47+00:00,2022-09-22 00:39:20+00:00,{},"![image](https://user-images.githubusercontent.com/57574604/189553771-9cbd4bde-cd6d-43cc-86af-1f5584d33358.png)
"
1052200867,fix S0000002 typo 'will have to' => 'will have to be',petchema,2022-09-10 09:10:55+00:00,2022-09-22 00:36:07+00:00,{'classic bug': 1},
1052044158,would go -> would you go,breakfastitem,2022-09-09 22:04:40+00:00,2022-09-22 00:35:50+00:00,{'classic bug': 1},"![image](https://user-images.githubusercontent.com/57574604/189451976-71f727b7-bfef-42e9-8557-0436de6ed579.png)
"
1051433685,Companion-pet,xardasVB,2022-09-09 11:02:01+00:00,2022-09-09 15:46:11+00:00,{},"## What?
I've added a companion-pet that follows the player and helps to fight enemies throughout the first dungeon. Companion will teleport if he is too far. Companion will spawn healing potion if palyer's HP is below 25%. Also created health bar pool system that works for any enemy in the game.

## Why?
These changes make game more begginer friendly by adding companion-pet, and more user friendly by showing health bars.

## How?
This includes an update to EnemySenses for follow target detection,  update to EnemyMotor to follow this target and teleport if too far, completely new HUD health bar pool system, and new behaviuor for potion spawning.

## Screenshots
![image_2022-09-09_13-52-09](https://user-images.githubusercontent.com/19412628/189334469-41a954ae-468f-4104-a048-347a712612cc.png)
"
1047691525,[BurstCompile] for all existing jobs,andrew-raphael-lukasik,2022-09-06 15:01:54+00:00,2022-09-22 00:36:36+00:00,{},"Hi! This PR is part of #2416 saga.

## What

Burst compilation enabled for all existing jobs. That's it, nothing else.

## Why

Burst is not a magical wand necessarily. It is powerful when there is a lot of math calculations but it won't fix a memory access-bound code (L2 cache misses).

## Results

It sped up these existing jobs by around a factor of 10x and nearly `*halves*` my loading time for exteriors (20-40% reduction)

- before: `5 seconds` total of work (left), after `[BurstCompile]`: `0.4 second` total of work (right)
<p float=""center"">
    <img src=""https://user-images.githubusercontent.com/3066539/188665859-a0959da7-a3c3-4472-886c-757efaa321bb.png"" width=""49%"">
    <img src=""https://user-images.githubusercontent.com/3066539/188665855-48ae549c-f0a7-40a6-bea7-036dd2f29c72.png"" width=""49%"">
</p>

> **I mean... optimization is *never* this easy, so merge while PR is still hot :T**
"
1046811788,performance and productivity utilities,andrew-raphael-lukasik,2022-09-05 19:45:15+00:00,2023-10-18 18:18:36+00:00,{},"Hi! This PR is part of #2416 saga.

## `UniversalJobs.sc`
contains jobs that can come useful anywhere:
- `DeallocateArrayJob`
- `FillJob`
- `CopyToJob`
- `ReleaseGCObjectJob` - more on what this does below

## `NativeArrayExtensionMethods.cs`
contains methods such as
- `CopyTo(this NativeArray<T> src, T[,] dst)`
- `CopyTo(this NativeArray<T> src, NativeArray<T> dst, JobHandle dependency)` - delayed copy
- `Fill(this NativeArray<T> Array, T value)`
- `AssertPtrScope(this NativeSlice<ARRAY_ITEM> array, POINTER* ptr)` - pointer safety assertion (mandatory before dereferencing any pointer)

## `NativeArrayExtensionMethodsTests.cs`
unit tests

## `ArrayExtensionMethods.cs`
contains:
- `AsNativeArray(this T[] array, out ulong gcHandle)` variants
Yes you red that right - this is not a pedestrian `ToNativeArray` (copy) but `AsNativeArray` and creates a `NativeArray` struct that represents any managed array. Im super exited for this as I finally figured how to do this and figured out the proper safe workflow (as seen in #2416)

## `JobHelpers.cs`

Hosts `JobUtility` as I couldn't find a more suitable place for this.

It allows to call `JobUtility.ReleaseGCObject(ulong gcHandle, JobHandle dependency)` which is a convenient way of releasing managed arrays (it schedules `ReleaseGCObjectJob`).

##"
1046755661,"Added a ""generator"" customization point for PopulationManager",KABoissonneault,2022-09-05 18:10:32+00:00,2022-10-12 08:24:12+00:00,{},"One of our mod plans is to expand the selection of mobile NPCs generated in towns.

Currently, the PopulationManager chooses the race of the mobile using the climate settings, then passes it on to `MobilePersonNPC.RandomiseNPC` which takes care of the rest. Other NPC settings like gender, outfit, face, guard, and name are determined internally.

We've previously worked around some of these limitations with `PopulationManager.OnMobileNPCEnable`, but all we can really do is call `RandomiseNPC` a second time with another race (we've put Redguards in Swamp and Subtropical climates, for example). This approach only works for Bretons, Redguards, and Nords, since other races aren't supported.
In addition to the limitations of this approach, this also had the issue of causing two calls to `MobilePersonAsset.SetPerson`, which cause two sets of textures to be loaded per NPC.

This PR thus does two things:
- give mods access to setting `MobilePersonNPC` properties from the outside
- Give `PopulationManager` a hook for mods to do their own thing instead of calling `.RandomiseNPC` (avoids the double call to `MobilePersonAsset.SetPerson` problem)

With this, we can generate NPCs of any race, with any outfit and face we want. Custom portrait records are already supported by `DaggerfallTalkWindow.SetNPCPortrait`.

Results (ignore sprite scale lol):
![image](https://user-images.githubusercontent.com/5789925/188498957-5d7c8d41-b3d7-4fa2-8ddc-b30761e96d87.png)
![image](https://user-images.githubusercontent.com/5789925/188498995-bd44bd5e-2fef-4dd6-9d73-e278e9ff64c4.png)
"
1045851255,add not noclipping stipulation before canceling levitate,breakfastitem,2022-09-05 02:06:08+00:00,2022-09-05 02:46:31+00:00,{},I'm still investigating no clip behaviors.
1045796757,optimizations: game load time about twice as fast,andrew-raphael-lukasik,2022-09-04 22:12:43+00:00,2022-09-05 12:54:53+00:00,{},"Hi guys, I am working on this for a few weeks now and wanted to get some feedback from you

# what
- a lots of different optimizations that all targets game one single issue: load time
- adds profiler markers (load time related code only)
- adds utility methods & jobs. **One is worth noting here**:`any_managed_array.AsNativeArray()` extension method.
- few unit tests to make sure those few parts aren't broken (will see, maybe I will write more of them)

# why
- load time on my machine was too high (up to 5-8 seconds)

# result
- it reduced load time to 2-4 seconds for initial load and to 1-2 for subsequent ones
- performance markers give some ideas where further optimizations can be made
- auxiliary cores work less now, which seems bad but this is the result of Burst compiling jobs that previously weren't AND general deficit of `IJob`-ified code to throw at them

- Old profiler view (left) - basically no useful info. New profiler view (right) - detailed insight on what cpu is doing
<p float=""center"">
    <img src=""https://user-images.githubusercontent.com/3066539/188334788-a6ec72ed-e56b-4d52-98bf-84f2e59fdf4b.png"" width=""49%"">
    <img src=""https://user-images.githubusercontent.com/3066539/188334630-5fbfd349-22aa-4373-a6f7-598e5a70942f.png"" width=""49%"">
</p>

- Unit tests. Low coverage but a good start.
<p float=""center"">
    <img src=""https://user-images.githubusercontent.com/3066539/188334493-6be39b0d-0943-429d-92ae-4827bc672810.png"" height=""100px"">
</p>

"
1045671243,Changes to allow randomized billboard scaling in billboard batches.,BadLuckBurt,2022-09-04 10:22:03+00:00,2022-09-13 17:12:59+00:00,{'enhancement': 1},"I've added three new properties and one method to facilitate randomized billboard scaling when applying a billboard batch. This allows batched flats to vary in size, making for a more natural looking canopy / skyline in case of the nature flats but it can be applied to any billboard batch.

I exaggerated the scaling values in the screenshot, min scale was 0.75, max scale was 2.75 but it does help to illustrate the effect. I've seen performance drops when I set max scale to 4.0, probably due to overlapping sprites, at some point they just become too big. 

![natureScaleExample](https://user-images.githubusercontent.com/4460167/188308592-db45ee5b-4c92-459c-92df-ec2fc1792043.png)
"
1045483742,typo quest exposition J0B00Y00,petchema,2022-09-03 14:03:47+00:00,2022-09-22 00:35:32+00:00,{'classic bug': 1},I may a job -> I may have a jpb
1045470647,Warlock promotion typo,petchema,2022-09-03 12:45:44+00:00,2022-09-22 00:36:56+00:00,{'classic bug': 1},my near unanimous vote -> by near unanimous vote
1040222044,Fixed regression where City watch lost its human sounds (HALT),KABoissonneault,2022-08-29 21:33:21+00:00,2022-09-22 00:37:29+00:00,{'regression': 1},"Fix for [https://forums.dfworkshop.net/viewtopic.php?t=5847](https://forums.dfworkshop.net/viewtopic.php?t=5847)

I also added an extra custom enemy id fix for Foe quest resources. Once we get quests targeting custom enemies, it would be nice if custom class enemies didn't have monster names."
1039882657,text fix,breakfastitem,2022-08-29 15:42:22+00:00,2022-09-22 00:35:11+00:00,{'classic bug': 1},"![image](https://user-images.githubusercontent.com/57574604/187240178-54f2be62-f24a-4339-b0b9-56a06e6a321b.png)
"
1033438715,Added Pet functionality,VenTuraa,2022-08-22 22:58:41+00:00,2022-08-22 23:09:10+00:00,{},
1032027041,Update set_jump and set_grav commands,petchema,2022-08-21 11:50:38+00:00,2022-10-02 01:31:51+00:00,{'refinement': 1},"Update set_jump and set_grav commands to display correct default values in help,
accept float arguments, and accept -1 for ""default value"".

Note: float argument format is currently localized (eg ""4,5"" on my system that has french localization)."
1029683504,Click to attack: swing from all directions,petchema,2022-08-18 08:37:32+00:00,2022-08-18 08:52:06+00:00,"{'bug': 1, 'wip': 1}","UpLeft and Up direction could not happen with click-to-attack

Reddit: https://www.reddit.com/r/daggerfallunity/comments/wqgt4d/comment/iko3rg9/?utm_source=reddit&utm_medium=web2x&context=3"
1024478634,"Add Joystick ""Back"" Button",jefetienne,2022-08-12 02:13:37+00:00,2022-10-02 01:31:02+00:00,{},"I have rebased #2367 to fix conflicts from upstream and also applied a couple other needed fixes for the pull request.

@argonius2 I assume you want to have credit as well which is why I have kept your commits!"
1022896294,Always consume teleportation anchor when recalling,petchema,2022-08-10 15:59:58+00:00,2022-08-13 00:05:56+00:00,"{'bug': 1, 'regression': 1}","When recalling, anchor was not consumed in all code paths

Regression since 239ad207661804c33d02a86ed9aa5e05db9a484e

Forums: https://forums.dfworkshop.net/viewtopic.php?t=5788"
1022279754,Keep levitating as long as NoClip is active,petchema,2022-08-10 06:19:38+00:00,2022-08-13 00:07:09+00:00,{'bug': 1},"
Levitation could stop under 2 conditions while NoClip status was still active:
- some levitation spell (on top of levitation caused by NoClip) expired;
- a game was (re)loaded; NoClip status was persistent, but not its associated flying effect.

It is still possible to disable it with ""levitation off"" in console, in case one absolutely wants NoClip with no levitation.

Another implementation could be to have LevitationMotor::IsLevitating() return playerLevitating || GameManager.Instance.PlayerEntity.NoClipMode if its entity is the player; It could be a little cleaner than spreading PlayerEntity.NoClipMode checks in several places, but a little more expensive at runtime.
"
1021556411,Using a public list instead of the hardcoded archive IDs allows mods to register custom texture archives that should be treated as NPCs,BadLuckBurt,2022-08-09 13:55:59+00:00,2022-08-14 06:50:55+00:00,{},"After this change, a mod can register its custom NPC archives by calling `RDBLayout.NPCFlatArchives.Add(textureArchiveID);`. This also opens up the way for custom NPC portraits by adding new FlatData to the FlatsFileReader.FlatsDict. I have tested this already and it works but I can provide the mod for testing if necessary.

Without this change, the billboard's collider is never added since the custom archive can't be identified as an NPC archive and just gets treated as a regular billboard.

Please let me know if anything more is needed"
1019226234,Classic player death sound option,petchema,2022-08-06 01:49:03+00:00,2022-08-14 06:48:43+00:00,{},"Ties classic player death sound to combats vocalization; No combats vocalization <=> classic player death sound.
Rationale:
- players bothered by ""non classic"" death gasp are more than likely also bothered by combats vocalization;
- on the other hand I see a possible case for players that don't want combats vocalization but like race and gender aware death sounds. Seems pretty niche case though."
1019224718,Fixed saves failing to load custom class enemies,KABoissonneault,2022-08-06 01:38:26+00:00,2022-08-13 00:03:55+00:00,{},"This is caused by an invalid careerIndex to mobileType conversion. For example, custom class enemy 384 would be converted to 512 (384+128), and the save would softlock if enemy id 512 didn't exist.

Sorry for the many PRs in recent weeks, our monster expansion mod is getting close to release, and so we're playtesting it a lot more."
1018989772,"Fixed ""MuteHumanSounds"" and ""CharmEffect"" for custom class enemies",KABoissonneault,2022-08-05 18:54:53+00:00,2022-08-13 00:03:00+00:00,{},"Replace ""id >= 128"" logic in DFU with a new helper, `DaggerfallEntity.IsClassEnemyId`, for better consistency in custom enemy support. Remember that for custom enemies, for every multiple of 256, the first 128 ids are monsters, and the last 128 ids are class enemies (this allows infinite extensibility while allowing mods to reserve an id space for themselves).

I made this change at first thinking MuteHumanSounds was an actual user-facing feature that players could turn off, and I wanted custom class enemies to properly support it. But I eventually realized only code can disable it. So that part of the change is not really necessary, I can just remove the sounds from my custom enemies. 

But the CharmEffect fix is useful, so I kept it all. It's not that big"
1014282919,latest-savegame-name-automated,Baleryom,2022-08-01 20:00:34+00:00,2022-08-13 00:01:07+00:00,{},Name of latest save game gets auto populated in the saveNameTextBox inside Save Game Window
1012929824,Disable doppler effect,numidium,2022-07-31 01:50:48+00:00,2022-08-13 00:00:43+00:00,{},"The Doppler effect implementation in Unity causes odd-sounding, and at times extreme, pitch shifts to occur during play. This is most noticeable to me when I run past an enemy as it plays its bark. It's a matter of preference but I believe it may be best to simply disable it since it was not something present in classic."
1010161351,Mods can provide a female corpse texture for classic or custom enemies,KABoissonneault,2022-07-27 22:01:08+00:00,2022-08-13 00:01:42+00:00,{},"Kamer would really like if we could have unique corpses for each enemy, but human enemies have uh, sexual dimorphism that's not reflected on their gender neutral corpse.

With this simple change, ladies can now turn to dust on death
![image](https://user-images.githubusercontent.com/5789925/181380098-62608610-eaec-446c-a779-b44fb98190b4.png)
"
1010151356,"Fixed missing call to ""TextManager.GetLocalizedEnemyName"" in EnemySenses",KABoissonneault,2022-07-27 21:45:51+00:00,2022-08-13 00:00:11+00:00,{},"Honestly I'm more interested in the custom enemy name support (see #2348), but I figure it's gonna help the localization efforts too.

I did a search for all calls to `.Replace` in the repo, and I think I got all enemy entities covered now."
1006442449,Remove stutter when switching between hands,numidium,2022-07-24 00:35:29+00:00,2022-10-02 01:28:47+00:00,{},"I get a stutter on my mid-tier PC whenever I switch between my right and left hand weapons in DFU. Unity profiler says it's ~200ms each time. After some analysis I found that the culprit, GetWeaponTextureAtlas, re-draws the entire weapon atlas each time the player switches weapons.

I opted to use a queue to implement this since I didn't want to clog the memory with atlases for every permutation of weapon type and metal dye. I settled on a cache size of 4 to accommodate lower-end systems while also allowing players to juggle a number of weapons without hitching.

Note that this currently only works for vanilla weapon atlases. I wanted to know if you think this optimization warrants a merge before continuing on.

EDIT: I refined the caching scheme a little further to only perform a texture load when equipping a weapon. This is normally done from the inventory menu unless you're using a mod so it should be less noticeable than a hitch occurring outside of a menu in my opinion. With this change applied, the player will never experience hitching when swapping hands.

The only drawback is the memory footprint. My cache holds 4 atlases at a time which comes out to about 64 MB of texture data. It would be much smaller if the textures could use a 256 color palette in memory but I don't know if Unity has any support for such a thing."
1001383505,"Two Artifacts HUD Color Inaccuracies Correction, 7/19/2022",magicono43,2022-07-19 23:29:38+00:00,2022-08-14 06:45:01+00:00,{},"Realized while doing some testing on my recent PR that some of the artifact weapons have unfitting or inaccurate material values set that make their HUD weapon colors not very fitting to what their actual Paper-doll sprite would suggest. This might be mostly up to opinion, but I figure I bring it up.

So it seems that Chrysamere was set to ""Elven"" which was making it look pretty stark white on the HUD, which I don't think looks right for it at all myself. The unofficial wiki says it is considered Adamantium, but I personally don't think that colors fits well either since it's basically as dark as ebony. So I decided that really the closest color imo was mithril, so I decided to change it to that. It's not perfect since it's a pretty dark-blue, rather than the sort of greenish teal that the paper-doll sprite looks like, here are just some comparison images:

In the code what it was previously:
![Seems Like Not Fitting Materials](https://user-images.githubusercontent.com/39843717/179864912-651c8220-346a-4897-b44a-0c1730dda1ba.PNG)

Paper-doll color:
![Capture3](https://user-images.githubusercontent.com/39843717/179864846-c5a2c041-2d6a-4e97-8121-5b4f3861fa14.PNG)

Before Change:
![Chrysamere Before Elven](https://user-images.githubusercontent.com/39843717/179864951-0c565b41-a01e-46b5-a895-eac5e65b32ba.jpg)

After Change:
![Chrysamere After Mithril](https://user-images.githubusercontent.com/39843717/179864958-886f801b-2207-4a38-951a-52ed9945676e.jpg)"
1000812322,"Weapon HUD Animations Mod Support 1, 7/19/2022",magicono43,2022-07-19 13:50:24+00:00,2022-08-14 06:40:40+00:00,{},"Very basic mod support for making it possible through a mod with texture replacements to add unique HUD animation frames for the various different vanilla weapons.

So instead of only being able to replace the entire group of the generic ""long-blade"" animations that most bladed weapons use, the modder can specify through texture naming if they want to replace the animations for say the Claymore and Katana so they look different from one another on the HUD. Or even adding unique HUD animations for the vanilla weapon artifacts and enchanted magic weapons, etc, 7/19/2022."
998507087,optimization: lets enable incremental garbage collector,andrew-raphael-lukasik,2022-07-16 22:07:13+00:00,2022-08-12 23:57:34+00:00,{},"# what:

This tiny PR enables an incremental garbage collector via `ProjectSetting.asset` file (a single line changed), nothing else.

# why:

As we know managed allocations pile-up leading to `GC.Collect` being called sooner or later. In 2018/2019 Unity introduced an incremental GC which is no longer an experimental feature for some time now. Here is an official article announcing it's introduction: https://blog.unity.com/technology/feature-preview-incremental-garbage-collection

`gcIncremental: 0` leads to sudden, very noticeable CPU spikes, freezing the game rendering for few frames. This is how it work now:

![Screenshot 2022-07-16 232340](https://user-images.githubusercontent.com/3066539/179372776-16ea3723-d361-4c2d-951f-a4205cddff8c.png)

`gcIncremental: 1`, spike is spread across few frames, framerate is maintained:

![Screenshot 2022-07-16 232929](https://user-images.githubusercontent.com/3066539/179372778-0450f3fd-5429-4e6a-8bfa-c70b50a0dc1d.png)
"
997816571,optimization: `DaggerfallBillboardSystem` increases performance of `DaggerfallBillboard` with `IJobParallelForTransform`-based multithreading,andrew-raphael-lukasik,2022-07-15 14:26:20+00:00,2022-09-05 12:53:58+00:00,{},"Hi guys,

This is my first attempt here at implementing something that #2316 enabled.
I picked billboards not because those were causing any mayor performance issues, **they weren't**, but because I knew how to optimize them already and it is pretty much an isolated system from many complexities of this project.

<br>

These are **very** rough (editor & debug) numbers how billboards performed
> **Before**: `0.6 ms` (main thread)

![Screenshot 2022-07-12 181808](https://user-images.githubusercontent.com/3066539/179237191-bc10e0d3-1f9f-4ad5-9d06-3fb52f8f01f8.png)

> **After**:  `0.03 ms` (main thread) + `0.06 ms` (different thread)

![Screenshot 2022-07-13 120343](https://user-images.githubusercontent.com/3066539/179237192-31d74c57-3529-4e3f-bb5f-f4613d93fcd5.png)

![Screenshot 2022-07-13 120516](https://user-images.githubusercontent.com/3066539/179237189-64fab5bc-fe4c-4878-8090-d1a5f61562a2.png)
> ‚òù different thread

We can see that raw computation cost decreased about 10x, but that is not even that important. The thing that matters here is that this `0.5 ms` disappeared from the main thread, so it will no longer affect the main gameplay/rendering loop from now on.

<br>

If you point me any cases which I should test and make sure it works, that would be great. It looks fine on my machine, but I want to make sure my changes won't break something that I didn't even consider.
"
996141683,K0C0XY01 fix,JayH2971,2022-07-14 02:36:10+00:00,2022-07-14 05:51:04+00:00,{},"K0C0XY01 is a harpy-slaying quest with several dummied-out items that still appear as dialogue choices. Not only that, the text is strange, like a description rather than dialogue. It makes more sense to remove them from the game, since they contribute nothing at all. The quest is still completable by delivering the leader's harpy feather to the questgiver, like vanilla."
993452073,Player companion,dythervin,2022-07-11 19:05:12+00:00,2022-07-11 19:23:52+00:00,{},"Added:

HealthChanged handler for the entity,
Player companion: 
- spawns on the game start/loaded, 
- not serialized,
- spawns a health potion when player health falls below a specific level
- follows the player, teleports when too far

"
988865629,Add model replacement NPC rotation component,ajrb,2022-07-06 14:13:54+00:00,2022-07-07 02:25:32+00:00,"{'enhancement': 1, 'mod system': 1}","Currently only acts on building interior NPC replacements, facing them toward the nearest internal door, preferring visible.

I would like to add this to 0.14.1 builds. It will get further development over time, this is just the first version. Has no effect on anything else, as it's simply a component resource for mod prefabs to use."
987042520,Micro map settings revision 7/5/2022,magicono43,2022-07-05 06:30:19+00:00,2022-07-07 02:24:54+00:00,{},This is a revised version of this PR from a few days ago. https://github.com/Interkarma/daggerfall-unity/pull/2374
987019326,"Revert ""Dungeon Micro-Map QoL Option, 7/1/2022""",magicono43,2022-07-05 05:51:17+00:00,2022-07-05 06:01:23+00:00,{},"Reverts Interkarma/daggerfall-unity#2374

I'm not sure if this is the proper way to do this. But I figure revert this PR so I can replace it with a new one with improvements/revisions?"
986783844,Fix editor warning I introduced,ajrb,2022-07-04 19:56:46+00:00,2022-07-04 19:56:52+00:00,{},WHen I made the location cache only for !editor I didn't do the same with the const. I am sick of seeing that warning.
986779735,Allow building greeting message boxes to be disabled by mods,ajrb,2022-07-04 19:47:09+00:00,2022-07-05 05:09:14+00:00,"{'enhancement': 1, 'mod system': 1}","Simple switch for the building greetings so mods can turn them off, and optionally replace using enter exit events"
986776687,Enable enhanced item lists by default,ajrb,2022-07-04 19:41:04+00:00,2022-07-04 23:42:53+00:00,{'refinement': 1},"When I originally implemented enhanced item lists (16 items instead of 4) DFU was more aiming at recreating the classic experience out of the box, so we made this switched off by default. I think things have evolved to the point where this is backwards. The majority of players want a modern Daggerfall experience, and any that are looking for the classic already need to change settings to get that. They will know the original game just had 4 visible items per list and can then switch it off, whereas new players have no idea they can get 16 unless they happen to see someone else's inventory window.

This is just a proposal, @Interkarma you can merge or close this as you prefer."
986067509,Update to Unity 2019.4.40f1 LTS,Interkarma,2022-07-04 06:50:10+00:00,2022-07-08 00:01:13+00:00,{},"Update 2019.4 LTS to latest point release for last year of engine bug fixes.
This specifically fixes problem of mouse deltas updating when cursor locked on Mac, causing mouselook to jerk off in some direction when closing UI windows.
Now is a good time to update engine while 0.14 still in preview.
This won't be merged until at least 0.14.2. Mod creators please acquire 2019.4.40f1 and pull down this PR to test your mods build OK. Hopefully impact will be low as this is a point update only.
Don't forget to close and reopen Unity and Unity Hub when pulling engine version changes from git. You might also need to manually set engine version in Hub to correct version."
985948076,Fix bright UI rendering on Mac,Interkarma,2022-07-04 03:48:08+00:00,2022-07-05 00:46:10+00:00,{},"Implemented DaggerfallUI.DrawTexture to handle separate UI rendering pathways for Mac and PC/Linux.
The PC/Linux pathway is still using GUI.DrawTexture as before. Mac pathway uses Graphics.DrawTexture and font shader customisations to yield correct colour space output.
This should be a low impact change for mods as only internal UI DrawTexture handling involved. Any mods using GUI.DrawTexture or GUI.DrawTextureWithTexCoords should use the equivalent method in DaggerfallUI to render textures in correct colour space on Mac.
Tested with and without DREAM in editor and builds across Mac/PC and working OK, so texture mods should not be impacted by this.
Tagging @ajrb and @KABoissonneault - please quickly test your mods build with the changes in this PR and it doesn't cause any problems you can see. I'd like to include this in 0.14.1 if no issues found."
985808905,Change key binds for left/right page in mod settings,ajrb,2022-07-03 20:26:14+00:00,2022-07-04 12:37:43+00:00,"{'mod system': 1, 'refinement': 1}","This is so they don't interfere with text entry on pages > 1. I was trying to add ""Mouse3"" to a text box on page 2 and it kept switching back to page 1 every time I pressed left shift... was very confused.

happy if someone can suggest better keys."
985722786,Typo Fix,spockthewok,2022-07-03 13:21:19+00:00,2022-07-07 02:31:18+00:00,{},'targetted' -> 'targeted'
985318490,Apply one time quest filtering to social group quests,ajrb,2022-07-01 20:26:55+00:00,2022-07-04 12:33:08+00:00,{'bug': 1},
985227337,"Dungeon Micro-Map QoL Option, 7/1/2022",magicono43,2022-07-01 18:10:14+00:00,2022-07-05 00:33:15+00:00,{},"Dungeon Micro-Map QoL Option, 7/1/2022.

Originally in relation to this forum thread: https://forums.dfworkshop.net/viewtopic.php?t=5242

This post is mostly related to the above forum thread that I made a good few months back, and finally decided to make a PR for it. I think the difference is fairly clear from the below attached screenshots. I set the option to be disabled by default. Also the purple background is not what occurs in practice, that is just a weird quirk when you try to take a screenshot with ""F8"" while in the map screen. 

Please do any edits you feel would make this better. I was considering for small possible performance reasons to put the settings check into another for-loop on it's own, but did not want to make the PR look to ugly by doing that, but up to whoever if they feel there is a better way to do this etc. Thanks as usual, I'm still quite the noob when it comes to using Git and pushing commits and such.

Default
![Dungeon_Mini-map_Example](https://user-images.githubusercontent.com/39843717/176947768-182b3203-0552-4eaa-aaeb-22a5543c9fa0.png)

Option On Example 1
![2022_01_20_20_31_28](https://user-images.githubusercontent.com/39843717/176947804-eafa8f0f-acdd-4a29-9bfe-614cca418e3f.jpg)

Option On Example 2
![2022_01_20_20_30_20](https://user-images.githubusercontent.com/39843717/176947851-0dba0147-891a-465b-bb89-01fbd3f8bfdf.jpg)"
985173296,Log FsSerializer Warnings with LogWarningFormat(),AncientGrief,2022-07-01 17:09:27+00:00,2022-07-04 12:30:36+00:00,{},I am getting a warning but it gets logged as an error. 
984800791,Quest fixes end June 2022,JayH2971,2022-07-01 10:27:26+00:00,2022-07-04 12:28:32+00:00,{},
984415271,WDE Object Data additions and organization,Cliffworms,2022-07-01 01:09:45+00:00,2022-07-03 18:43:49+00:00,{},"Added roughly 2200 models and a handful of billboards to the models and billboards data lists. Also reorganized some categories.
Full changes below : 

**New Models**

_Buildings_

Single Walls & windows
Single Floors
Single Ceilings
Single Pillars
Single half walls
Single entry ways & exits
Exterior walls and railings

_Other_

Water
Grass
Grates


**New Billboards**

Enemy Corpses
Additional skulls on pikes
Additional bucket
Additional shrub
Teleport Marker
Scarab
Religious item
Finger
Jewelry
Mantella
Alchemical ingredients

**Changes**

Added ""Unused"" to markers not used by DFU
Sorted the markers alphabetically
New subcategory : Religious
Cooks and serving girl NPCs are now in ""Inns"" with the Innkeepers
Added knights"
984355027,Null reference exception when mod enemies cast,KABoissonneault,2022-06-30 22:58:14+00:00,2022-07-04 12:27:19+00:00,{},"In mods that spawn enemies with a custom flow (ex: World of Daggerfall), a custom serialization component might be used (ex: for extra, mod-specific data).

Previously, `EntityEffectManager.GetCasterLoadID` explicitly checked for the component `SerializableEnemy`, when it really only needs a component that implements the `ISerializableGameObject`, for the LoadID.

I've loosened the `GetComponent` to work with custom `ISerializableGameObject` types.

I've also added a null check, to avoid the null reference exception in the future."
981836922,World Data Editor fixes,ajrb,2022-06-28 20:19:38+00:00,2022-06-29 22:16:23+00:00,"{'bug': 1, 'editor': 1}","Link flags, magnitude and action to rbd flat records correctly in WDE"
980947914,Allowing players to exit out of UI screens on a controller,argonius2,2022-06-28 05:58:58+00:00,2022-07-14 05:50:34+00:00,{},"Adding support so players can exit out of UI screens with a button on the controller, just like how the escape key is used to back out of UI screens with the keyboard. The key binding can be set in the joystick controller configuration screen.

![image](https://user-images.githubusercontent.com/108307224/176102938-08bb8978-cc8e-42a9-96a6-9bea23887fb3.png)

This also allows users to cancel rest with the controller by pressing the same UI back button, since now in code where it was previously hardcoded to check for the keyboard escape key are now checking both for the escape key and the UI exit controller button.

Also noticed that the pause binding was named Escape in code, which could be confused with this new UI exit binding, so that has been renamed to Pause."
980720808,Log exceptions that occur when importing a Classic save,XJDHDR,2022-06-27 23:12:07+00:00,2022-06-29 00:40:50+00:00,{},"While diagnosing an issue someone was having with my mod, I noticed that the SaveGame class' TrySave method checks for if an exception occurred while importing a Classic save, and reports that the save failed to load if this is the case. 

The problem is that this behaviour gives no indication why the exception occurred. This PR changes this behaviour so that the exception that occurred will be logged to the console and log file."
980655431,Update Jetbrains Rider Editor package to latest version.,XJDHDR,2022-06-27 21:59:50+00:00,2022-06-29 00:40:14+00:00,{},"The Jetbrains Rider Editor package that DFU currently uses is locked to v1.2.1. This package is not compatible with the current version of Rider, which causes a number of issues. Some of the ones I've noticed are:

- The External Script Editor option is labelled as ""Rider.exe"" rather than the program's name and version.
- Project files can't be regenerated from the Unity editor.
- Rider complains about missing Unity classes.
- Autocomplete doesn't suggest anything from the Unity API.

I haven't noticed any issues caused by telling the Editor to use the latest version of this package instead of the one recommended for this version of Unity."
980251209,Added public property for MobileAsset,AncientGrief,2022-06-27 16:06:04+00:00,2022-06-29 00:37:16+00:00,{},"I altered the code to only change one line as suggested in my other PR, which I closed.
Maybe using `public MobilePersonAsset MobileAsset { private get; set; }` would be an alternative without ""duplictating"" the member. 

Reason for the Change:
`MobilePersonMotor.FindMobilePersonAsset()` instantiates my custom MobilePersonAsset and calls `SetPerson()`. 
My implementations tries to find a 3d model prefab based on the race and gender etc. If it fails it falls back to Billboards.

I do it using this way:

```cs
    //Find parent and get billboard child
    Transform parent = transform.parent;
    GameObject goBillboard = parent.Find(""MobilePersonBillboard"").gameObject;
    MobilePersonBillboard billboard = goBillboard.GetComponent<MobilePersonBillboard>();

    //Activate billboard, reset correct asset to the motor, and destroy this instance
    goBillboard.SetActive(true);
    this.gameObject.SetActive(false);
--> parent.gameObject.GetComponent<MobilePersonMotor>().MobileAsset = billboard;
    billboard.SetPerson(race, gender, personVariant, isGuard, personFaceVariant, personFaceRecordId);

    Destroy(this.gameObject);
    return;
```

I want to prevent duplicating the whole code of  `MobilePersonBillboard` in my own implementation, which is based around 3D Models. 

(Also I had to close the previous PR, because I forgot to do it from within a custom branch)"
980078819,Custom enemy support in RDB,KABoissonneault,2022-06-27 13:36:15+00:00,2022-07-04 12:24:20+00:00,{},"It's something @ajrb and I discussed a while ago.

We have a conflicting situation when it comes to the `FactionOrMobileId` field of the `FlatResource` of a Monster marker (archive 199, record 16). 
- classic DF data needs to be masked with `& 0xFF` to get the correct mobile Id
- custom enemies need to support ids bigger than 255

My solution here is to add a bit flag to annotate a marker as ""custom"" (ie: not from DF data).

Flags usage is a bit hard to find in DFU code, but this is the assumptions I've relied on:
- In DF data, ""Monster"" marker uses Flags=0 for unspecified gender, Flags=1 for Female, Flags=2 for Male (source: `RDBLayout.AddEnemy`, with `useGenderFlag==true` only for FixedRDB Enemy)
- ""Random Monster"" marker uses Flags as a seed between 0 and 255 for indexing into the monster spawn table (source: `RDBLayout.AddRandomRDBEnemyClassic`)
- Static NPC flats use `.Flags & 32 == 32` to identify a Female character

To make sure ""Random Monster"" marker doesn't get affected, I've limited the use of this flag to only the fixed ""Monster"" marker. I've kept 1 as the Female flag, 2 as the Male flag. If neither are set, the gender is left Unspecified as before.

With this, I can make use of custom monster ids in the WorldData Editor. For example, I've added our mod's id 261 ""Medusa"" at the start of Privateer's Hold.

![image](https://user-images.githubusercontent.com/5789925/175954194-43b85219-0086-40e3-8cf4-0a002376a538.png)

and once I load in-game, I get one-shot by Kamer's nightmare fuel (might be a bit too dark lol)

![image](https://user-images.githubusercontent.com/5789925/175954379-7e3ba2cb-53b8-4fc3-90e6-6928d5acbd78.png)
"
979389590,Allow overriding temple and knightly orders,ajrb,2022-06-26 20:49:07+00:00,2022-06-29 00:28:17+00:00,"{'bug': 1, 'mod system': 1}",These guilds require a init parameter to set the variant
979211765,WorldDataEditor bugfix and QoL features (editor only),jonoser,2022-06-26 04:44:15+00:00,2022-06-30 20:47:04+00:00,{},"Fix for a bug where some billboards would be repositioned after saving due to their Summary.Size not being updated when cycling through the records.

Added additional quality of life features to the editor both of which function on all selected objects in the scene:
 - Added buttons that move an object (3d model, flat) in a direction based on that object's size
![image](https://user-images.githubusercontent.com/46614201/175799654-9e03540d-bef2-456e-ab74-8541607a0f95.png)
 - Added a button that exposes the helper function AlignBillboardToGround() to the editor.
![image](https://user-images.githubusercontent.com/46614201/175799658-07ff4539-50f6-46c2-b6e0-f56a22ec8d6f.png)


Though this isn't potentially the cleanest way to do it, I allow AlignBillboardToGround to be used for 3d objects within the editor since it contains no code specific to billboards."
979148857,Add fireplace animate check box to World Data Editor,ajrb,2022-06-25 21:58:50+00:00,2022-06-26 01:39:41+00:00,{},
979075115,Make MobilePersonMotor.MobilePersonAsset public,AncientGrief,2022-06-25 15:20:36+00:00,2022-06-27 15:38:52+00:00,{},"Maybe I am wrong, but as of now I have to do this in my custom implementation to fallback to BillboardAssets without breaking some behaviour like NPCs stopping and looking at you when close up:

```cs
public class MyPersonAsset : MobilePersonAsset
{
	//...
	
    public override void SetPerson(Races race, Genders gender, int personVariant, bool isGuard, int personFaceVariant, int personFaceRecordId)
    {
        // ...
		
        //fallback to billboard
        if (!useThisPersonAsset)
        {
            Transform parent = this.gameObject.transform.parent; //MobilePersonNPC 
			
            //Get the MobilePersonBillboard
            GameObject goBillboard = parent.Find(""MobilePersonBillboard"").gameObject;
            MobilePersonBillboard billboard = goBillboard.GetComponent<MobilePersonBillboard>();
            
            goBillboard.SetActive(true);
            this.gameObject.SetActive(false); 
            
            //Assign the billboard to the motor


            //THIS IS NEEDED
            parent.gameObject.GetComponent<MobilePersonMotor>().MobileAsset = billboard; 


            //setup the Billboard with correct Person data
            billboard.SetPerson(race, gender, personVariant, isGuard, personFaceVariant, personFaceRecordId);
            
            //Get rid of this Asset, since it's not needed
            Destroy(this.gameObject);
            
            return;
        }
	
	}
}
```"
978545028,"Fixed ""PayMoney"" quest action infinite money drain",KABoissonneault,2022-06-24 17:14:20+00:00,2022-06-24 23:24:33+00:00,{},"Issue reported here:
https://old.reddit.com/r/Daggerfall/comments/vjsdkn/disappearing_gold_glitch_unity_a_cohort_of_the/

Quest in question:
https://github.com/JayH2971/dfunity-questpacks/blob/master/QP1/QuestPacks/QP1/Temples/JHTP111.txt

The custom DFU quest action ""PayMoney"" was missing a call to `SetComplete()`. Therefore, the task would infinitely try to pay the specified amount, rather than only once as expected."
971133553,"Fixed ""has bow attack"" crash for custom enemy casters",KABoissonneault,2022-06-18 00:08:58+00:00,2022-06-23 02:00:35+00:00,{},"(could have sworn I'd fixed that in #2163 ...)

Previously, EnemyMotor's ""hasBowAttack"" check was hardcoded to be true for enemy ids above 129 and not equal to 132.
This is obviously a problem for custom enemies, which use IDs above 129 and not equal to 132. If they don't have ranged attack animations, their mobile crashes.

I changed the logic so that it stays the same for DF class enemies, while allowing the full logic to be accessible to custom enemies.

If an enemy uses neither spells nor bows:
- HasRangedAttack1 is false

If an enemy only casts spells:
- HasRangedAttack1 is true
- HasRangedAttack2 is not true
- CastsMagic is true

If an enemy only shoots bows:
- HasRangedAttack1 is true
- HasRangedAttack2 is not true
- CastsMagic is not true

If an enemy uses both spells and bows:
- HasRangedAttack1 is true
- HasRangedAttack2 is true
- CastsMagic is true

"
962270788,Displayname fixes for quests,JayH2971,2022-06-09 00:03:59+00:00,2022-06-23 01:57:05+00:00,{},Reference http://forums.dfworkshop.net/viewtopic.php?t=5651
962017866,Fix edge case for arrow generation which would still set the material properties,ajrb,2022-06-08 18:42:28+00:00,2022-06-23 01:49:12+00:00,{'bug': 1},Fixes remainder of issue #2349 
958530208,Per-enemy name for custom enemies,KABoissonneault,2022-06-05 23:56:05+00:00,2022-06-23 01:54:12+00:00,{},"Added ability for mods to provider per enemy name through a new TextProvider function. Previously, custom enemies could only be named after their career name.

This removes a TODO I left last year :)

Usage example: 
https://github.com/SquidKamer/DaggerfallBestiaryProject/blob/feat/enemy-name/Scripts/BestiaryTextProvider.cs#L16

For custom enemies, it makes sense to me that mods should be able to reuse the same DFCareer for multiple enemy ids. For example, a mod might have a Goblin Soldier, a Goblin Archer, and a Goblin Skirmisher, all using the same Goblin career. Before this change, however, info-clicking the goblin would always say ""You see a Goblin"" - you'd need a unique career for each to get their unique name.

This change allows the career reuse."
950245401,Allow overriding standard guild services,ajrb,2022-05-29 11:37:47+00:00,2022-06-23 01:48:11+00:00,"{'enhancement': 1, 'mod system': 1}","his allows standard service handling to be replaced by mods.

Examples:

```
// Override cure service without changing label or shortcut key
Services.RegisterGuildService(GuildServices.CureDisease, CustomCureService);

// Override cure service, changing label
Services.RegisterGuildService((int)GuildServices.CureDisease, CustomCureService, ""Custom Cure"");
```"
943505443,Start difficulty dagger trail in correct place,numidium,2022-05-21 19:34:56+00:00,2022-06-01 00:13:29+00:00,{},"When the custom class creator window appears, the difficulty dagger trail starts at the top left of the screen and fades out. This moves it to the correct position at the start."
941956499,Change for issue #2339,ajrb,2022-05-19 19:54:17+00:00,2022-06-01 00:12:46+00:00,{},Makes %pgX macros consistent with %gX set as agreed.
938878359,Fix to allow animals loaded in RDBs to make sounds,jeniferirwin,2022-05-17 14:15:41+00:00,2022-06-01 00:16:13+00:00,{},
936604462,Made ShowSkillsDialog() protected virtual to allow overriding by mods,nkrisztian89,2022-05-14 19:00:39+00:00,2022-06-23 01:46:38+00:00,{},"I changed the signature of `DaggerfallCharacterSheetWindow.ShowSkillsDialog()` to `protected virtual` to allow mods such as[ Viewable Skill Progress](https://www.nexusmods.com/daggerfallunity/mods/298) to override it and display a custom popup with the skills.

Right now this mod creates another set of buttons on top of the originals (primary, major, minor, misc skills) to add an extra popup showing the progress of the skills when clicked, because it does not have access to modify the behavior of the original buttons.

After applying this change, I could remove all that duplicated button and click handler code from that mod and display the skill progress together with the levels in a single popup.

Since the original behavior of this method just displays a popup and doesn't change anything persistently, I think it is safe to allow the override for it.

This is my first ever contribution attempt to this project, please excuse if I do not conform to some conventions or did something wrong, it was just my idea to improve this as I didn't like that double popup :)"
936578695,Do not attempt to list drives on unix,ahouts,2022-05-14 16:18:28+00:00,2022-05-31 23:26:22+00:00,{},resolves #2309
936454605,Update from v0.12.x to v0.13.x,doodayev,2022-05-14 04:54:27+00:00,2022-06-01 00:12:08+00:00,{},Latest version is v0.13.5 and v0.13.1 came out like a few months ago
935891677,Fixed multiple calls to Billboard.SetMaterial,KABoissonneault,2022-05-13 12:47:38+00:00,2022-06-23 01:44:04+00:00,{},"It was observed while using the World Data Editor that multiple calls to `SetMaterial` on NPC Billboards causes many Box Colliders to be added.

![image](https://user-images.githubusercontent.com/5789925/168285930-77f0b594-ed11-48cc-af69-7d564f75b60c.png)

This probably doesn't occur in gameplay, but I don't think my fix hurts gameplay either, so might as well be more robust here."
934534705,Quest fixes May 2022,JayH2971,2022-05-12 08:32:08+00:00,2022-05-31 23:21:24+00:00,{},"I tested The Possessed Child fix in live game, to be certain of it."
934371206,Fix accidentally closing multiple windows at once,jefetienne,2022-05-12 04:57:20+00:00,2022-07-14 05:43:14+00:00,{},"When multiple calls to `UserInterfaceWindow.CloseWindow()` are made in one frame, it will pop the current window from the UIManager each time and accidentally close other windows below it.

How to reproduce:
1. Bind ""Cast Spell"" to ""Escape""
2. Open Character Sheet Window
3. Click the ""Spellbook"" button within the Character Sheet Window
4. Press Escape
5. Observe that both windows closed instead of just the spellbook window

It was called twice because the Escape key to exit is already observed in the base class's `DaggerfallPopupWindow.Update()`, and the binding for `Escape` is also observed as the `toggleClosedBinding` in the Spellbook window.

This PR fixes the issue by peeking for an existing message to close the window, which should not appear if it was only called once.

While it would be unusual to bind the Escape key to something else, this fix is important for adding the escape key as a joystick keybind, where it could be bound as the ""B"" button which may be shared as a keybind for opening up a different window."
934171478,CreateCharClassQuestion: Allow scrolling with controller right stick,muttleyxd,2022-05-11 21:41:48+00:00,2022-05-30 01:14:56+00:00,{},"I tried playing this game on Steam Deck, but I was unable to scroll through questionnaire during character creation (it doesn't react to any input, apart from clicking first visible answer).

I have quickly hacked a solution for this - simulating mouse scroll down event when right stick is being used (though possibly actual scrolling code could have been moved to separate function [so we won't call function with misleading name when using controller input], but I decided to leave it as it is).

Also I made it react to both axes - I have tested this on controller emulator first (because I didn't have any to plug to my dev PC) and it apparently doesn't output proper vertical values. So this version works fine both on Deck and with controller emulator."
930330776,Quest can target Individual Static NPCs outside of dungeons,KABoissonneault,2022-05-07 18:26:46+00:00,2022-06-24 00:00:14+00:00,{},"For example, mods can add NPCs with unused faction IDs (ex: Lady Doryanna Flyte) to normal city Palaces. Unlike Daggerfall, Sentinel, and Wayrest Palace, the other palaces aren't dungeons, and previously no QuestResourceBehaviour would be allocated to Individual NPCs in RMBs (RDBLayout.AddFlat is what's handling that for vanilla Main Quest NPCs). This changelist adds the QuestResourceBehaviour component for Individuals NPCs in DaggerfallInteriors and RMB exteriors.

Impact:
- Classic NPCs with garbage faction ids corresponding to Individual factions (ex: Lord Kilbar) will now have an extra QuestResourceBehaviour component

Tested with:
- Famous Faces of the Iliac Bay (mod)
- Test quest here: [testface.txt](https://github.com/Interkarma/daggerfall-unity/files/8645740/testface.txt)
- Go to Anticlere Palace and `startquest testface`. Click on Lord Flyte (he's on the third floor) to start the quest.

Without the changes, `clicked npc _npc_` won't recognize Lord Flyte.


I also fixed an issue where non-God factions would check their child factions for guilds, which would break on Knight Order logic. For example, Lady Flyte has the Knights of the Flame as child faction, but 400 does not represent the Orders enum. This would cause GuildManager.GetGuild to throw an exception. This made quests involving custom Individual NPCs spam errors in the log, though DFU handles it gracefully, so this change is not necessary.

Impact:
- Hopefully this code path was really only used by deities..."
928164912,"Add ""Done"" button to GameEffectsConfigWindow",jefetienne,2022-05-04 23:06:42+00:00,2022-05-05 22:54:47+00:00,{},"- Menu could only be escaped by the ""Esc"" button which a controller is unable to do
- Added a ""buttonPanel"" to occupy the bottom part, so if settings pages were to scroll, other UI elements would cut off and not interfere with the button"
925081716,Prevent setting null values for setting text in TextBox and TextLabel with empty string,jefetienne,2022-05-02 00:24:34+00:00,2022-05-05 23:03:05+00:00,{},"Setting these values to null would create exceptions elsewhere in their respective classes, including in the `set` action for TextBox.Text and TextLabel.Text."
924807889,Make controller cursor and controller-look frame-independent,jefetienne,2022-05-01 04:20:32+00:00,2022-05-05 23:04:29+00:00,{},"Using the Steam Deck and capping the framerate, I noticed that if I set the game to 30 fps, the cursor and controller-look moved half as fast, 15 fps a quarter speed, and 60 the desired speed.

This commit fixes the issue by adding a multiplier with an inverse relationship where if the frames go down, the speed goes up and vice versa.

You can test the different speeds by adding an Awake function and comparing:

```cs
void Awake()
{
    Application.targetFrameRate = 30;
}
```"
924797522,QoL: Draw circle gizmo at the bottom of BillBoards,jonoser,2022-05-01 03:37:25+00:00,2022-05-30 00:02:37+00:00,{},"I was watching a stream by Cliffworms where he was using the world data editor to place items and I thought it might be helpful to have a bounding circle displayed at the bottom of billboards to make it easier to see how big they are. 

I tried to match the existing code style as closely as possible so hopefully it's not too bad.
![image](https://user-images.githubusercontent.com/46614201/166160696-3d98b648-ba4b-4955-afd2-dc02a93e8b66.png)
"
923476437,bugfix: DivideByZeroException at DaggerfallGuildServiceDonation.cs:68,andrew-raphael-lukasik,2022-04-29 10:42:40+00:00,2022-05-05 23:08:43+00:00,{},"Donating to a temple while at reputation `0` causes `DivideByZeroException`

> DivideByZeroException: Attempted to divide by zero.
> DaggerfallWorkshop.Game.UserInterfaceWindows.DaggerfallGuildServiceDonation.DonationMsgBox_OnGotUserInput (DaggerfallWorkshop.Game.UserInterfaceWindows.DaggerfallInputMessageBox sender, System.String input) (at Assets/Scripts/Game/UserInterfaceWindows/DaggerfallGuildServiceDonation.cs:68)
> DaggerfallWorkshop.Game.UserInterfaceWindows.DaggerfallInputMessageBox.ReturnPlayerInputEvent (DaggerfallWorkshop.Game.UserInterfaceWindows.DaggerfallInputMessageBox sender, System.String userInput) (at Assets/Scripts/Game/UserInterfaceWindows/DaggerfallInputMessageBox.cs:270)
> DaggerfallWorkshop.Game.UserInterfaceWindows.DaggerfallInputMessageBox.Update () (at Assets/Scripts/Game/UserInterfaceWindows/DaggerfallInputMessageBox.cs:172)
> DaggerfallWorkshop.Game.DaggerfallUI.Update () (at Assets/Scripts/Game/DaggerfallUI.cs:397)

Code at fault:
https://github.com/Interkarma/daggerfall-unity/blob/10881473e2e0e5c73d7f72dba996e8134d457a8b/Assets/Scripts/Game/UserInterfaceWindows/DaggerfallGuildServiceDonation.cs#L66-L69


This PR replaces `2 * amount / rep + 1` with `(2 * amount / Math.Max(rep, 1)) + 1`
"
922539449,"QoL: Replace ClickToAttack with WeaponSwingMode (Vanilla, Click, Hold)",Nattfarinn,2022-04-29 00:33:30+00:00,2022-05-29 23:05:29+00:00,{},"`ClickToAttack` option is awesome Quality of Life addition to the main game, but constant clicking may (and from my experience, is) be tiresome for player and for other family members. Also deadly to the mouse. The quality of life improvement proposed here is to allow ""Hold to Attack"" option without disabling ones previously available.

Unfortunately this change is not achievable from mod and has to touch the Core (`WeaponManager`), but in a surprisingly non-invasive manner.

The options are:
 - `Vanilla`: plain-old ""hold and swing"",
 - `Click`: DFU standard,
 - `Hold`: keeping the keybind pressed triggers new attack after another.

Startup settings:
![Screenshot 2022-04-29 at 02 10 36](https://user-images.githubusercontent.com/5822569/165867910-263765a1-df6b-4143-ada1-00cb5adbf157.png)
In-game Advanced settings:
![Screenshot 2022-04-29 at 02 31 06](https://user-images.githubusercontent.com/5822569/165868498-ebad003a-12c5-4a17-89fd-cc43bc3ec62e.png)

"
917576108,Fix ground seams on some hardware/drivers,petchema,2022-04-25 01:07:16+00:00,2022-05-29 22:51:46+00:00,{'bug': 1},"Attempt to fix ground seams to appear on some hardware/drivers (AMD, integrated Intel graphics), based on
https://forum.unity.com/threads/tiling-textures-within-an-atlas-by-wrapping-uvs-within-frag-shader-getting-artifacts.535793/

Again, I no longer have access to some hardware to test this issue, so I need feedback from developers with such hardware!

Forums: https://forums.dfworkshop.net/viewtopic.php?t=1464"
917453702,4 packages to unlock some future performance gains (for either vanilla release or for modders),andrew-raphael-lukasik,2022-04-24 14:49:36+00:00,2022-06-23 02:08:42+00:00,{},"Hi,

This is a small and basic PR. It adds:
- `com.unity.mathematics`
- `com.unity.collections`
- `com.unity.jobs`
- `com.unity.burst`
Hope you approve it.

### Reasons behind it

Adding these 4 packages won't change anything by virtue of just adding them but those can enable some worthwhile performance gains in few areas where the workload can be considerably high. There is probably not a lot of cases like that, but those few still impact the performance & gameplay experience and that is noticeable with older CPUs (my i3-4170 among them).

To give an example, a Burst compilation could make all existing `IJob`s about >=10x faster after adding `BurstCompile` attribute and few changes (removing managed objects and static code references). This won't make a noticeable difference in vanilla release but I saw that a popular terrain mod can stall the main thread for up to few dozen ms for like >1.5s - and this PR could help fix that in the future releases.
To give another example, not a big deal but I also saw a cpu-based billboards somewhere - this one can be flattened with super performant Burst-compiled `IJobParallelForTransform`. More small cases like that will appear in the future I'm sure.

![Screenshot 2022-04-24 164021](https://user-images.githubusercontent.com/3066539/164981871-ab72ef55-2e02-4e87-bac4-49a93d00e2f8.png)

"
917160442,bugfix: NullReferenceException at SaveExplorerWindow.cs:512,andrew-raphael-lukasik,2022-04-23 08:48:43+00:00,2022-05-29 22:23:14+00:00,{},"Tiny bugfix. Opening up a new `Daggerfall Tools/Save Explorer` caused a minor case of:

> NullReferenceException: Object reference not set to an instance of an object
> DaggerfallWorkshop.SaveExplorerWindow.IsReady () (at Assets/Scripts/Editor/SaveExplorerWindow.cs:512)
> DaggerfallWorkshop.SaveExplorerWindow.OnGUI () (at Assets/Scripts/Editor/SaveExplorerWindow.cs:72)
> System.Reflection.MonoMethod.Invoke (System.Object obj, System.Reflection.BindingFlags invokeAttr, System.Reflection.Binder binder, System.Object[] parameters, System.Globalization.CultureInfo culture) (at <eae584ce26bc40229c1b1aa476bfa589>:0)
> Rethrow as TargetInvocationException: Exception has been thrown by the target of an invocation.
> System.Reflection.MonoMethod.Invoke (System.Object obj, System.Reflection.BindingFlags invokeAttr, System.Reflection.Binder binder, System.Object[] parameters, System.Globalization.CultureInfo culture) (at <eae584ce26bc40229c1b1aa476bfa589>:0)
> System.Reflection.MethodBase.Invoke (System.Object obj, System.Object[] parameters) (at <eae584ce26bc40229c1b1aa476bfa589>:0)
> UnityEditor.HostView.Invoke (System.String methodName, System.Object obj) (at <bd70c40e01f641bdb7d836e1e97755bc>:0)
> UnityEditor.HostView.Invoke (System.String methodName) (at <bd70c40e01f641bdb7d836e1e97755bc>:0)
> UnityEditor.HostView.InvokeOnGUI (UnityEngine.Rect onGUIPosition, UnityEngine.Rect viewRect) (at <bd70c40e01f641bdb7d836e1e97755bc>:0)
> UnityEditor.DockArea.DrawView (UnityEngine.Rect viewRect, UnityEngine.Rect dockAreaRect) (at <bd70c40e01f641bdb7d836e1e97755bc>:0)
> UnityEditor.DockArea.OldOnGUI () (at <bd70c40e01f641bdb7d836e1e97755bc>:0)
> UnityEngine.UIElements.IMGUIContainer.DoOnGUI (UnityEngine.Event evt, UnityEngine.Matrix4x4 parentTransform, UnityEngine.Rect clippingRect, System.Boolean isComputingLayout, UnityEngine.Rect layoutSize, System.Action onGUIHandler, System.Boolean canAffectFocus) (at <a6a8a08b59d34373858eada2d852ad38>:0)
> UnityEngine.GUIUtility:ProcessEvent(Int32, IntPtr)
> "
916531619,Unit tests: The Bug Slayer,andrew-raphael-lukasik,2022-04-22 14:45:08+00:00,2022-05-10 19:12:04+00:00,{},"Hi!

I'm no advocate for unit testing but there are exceptions. I think that some limited amount of those will become useful here eventually. For example, when refactoring existing code  - it's **exceptionally** valuable to make sure the new code works the same as the old one, doesn't break the existing features.

And last but not least - unit testing can be a way to **inspect, learn & help in decision making** sometimes. I can write you a paragraph about what I speculate the performance characteristic of different random number generators are - OR - i can write a test case that neatly prints all of them for everyone to see for themselves:

![Screenshot 2022-04-22 163500](https://user-images.githubusercontent.com/3066539/164736427-a275dde9-fc8f-4e88-9b0a-4b16daac5938.png)

> TL;DR: ""TES: Buggerfall"" - never again :T

___

# DEPENDENCIES:
- #2316 

___"
915824352,QOL: see DaggerfallLoot items listed in an Inspector window (EditorOnly),andrew-raphael-lukasik,2022-04-21 22:04:49+00:00,2022-05-29 22:15:44+00:00,{},"Hi,

`DaggerfallLootEditor` adds ability to see `DaggerfallLoot`'s items listed in the Inspect window. Could be useful for casual in-editor debugging.

It displays ""`ItemName` x `stackCount`"", read-only, at the moment.

![j0reh32q4woer90gh34q 'rae0gvph;;4qgrjw6b](https://user-images.githubusercontent.com/3066539/164558026-e30a4703-2698-45ed-ada0-bc5974c2702c.gif)

___

e0c5ba26791323465fe1dc2bde71e0ef24b6217d introduces item icons:

![Screenshot 2022-04-24 123337](https://user-images.githubusercontent.com/3066539/164972526-e663dfc9-2dbf-4ec5-96de-f28ff0920075.png)
"
915669731,Changes in manifest.json,andrew-raphael-lukasik,2022-04-21 18:31:03+00:00,2022-04-24 10:45:21+00:00,{},"Hi guys!

This is my very first PR here. Something very simple to get me started. Looking forward to contribute some more in the future. My specialty is (cpu) optimization if you ever need something fixed in that department.

This PR is a suggestion to remove those unused packages from the `manifest.json` as those are pretty much useless for this project. Removing them is of no great consequence while lowering the RAM footprint for the Unity Editor a little bit:
- `com.unity.modules.xr`
- `com.unity.modules.vr`
- `com.unity.modules.vehicles`
- `com.unity.modules.umbra`// static lightmap baker
- `com.unity.modules.cloth`// cloth sim
- `com.unity.modules.ai`// nav mesh pathfinding
- `com.unity.xr.legacyinputhelpers`
- `com.unity.collab-proxy`
"
906521096,Localization continue,Interkarma,2022-04-11 21:51:33+00:00,2022-04-11 21:54:01+00:00,{},
876982704,K0C00Y03 reputation change,JayH2971,2022-03-11 01:08:38+00:00,2022-04-11 21:54:39+00:00,{},"""Smuggling"" quest originally gave you a -100 legal repute loss during quest duration, fixed by a +100 gain at quest end. There is some practical use in allowing a person to wipe their legal rep with this, but the danger of failing the quest and keeping the legal rep loss, along with the annoyance of massive Criminal Conspiracy charges, makes for bad questing.

I personally don't agree with having a ""reputation wipe"" quest, but it could be easily achieved by having a -100 and then +100 swap at the very end of the quest, without burdening the player with it while quest runs. Open to feedback."
876833558,Fix IsValueEqual for ColorKey's,ajrb,2022-03-10 21:02:26+00:00,2022-04-11 21:55:01+00:00,"{'bug': 1, 'mod system': 1}",This enables dynamically changing a colour setting for a mod using the recent menu option to work. The method was allowing any single element not being changed to indicate the colour as a whole had not changed.
875680962,Don't override faction id if the replacement id is zero,ajrb,2022-03-09 19:57:13+00:00,2022-03-09 22:29:21+00:00,"{'bug': 1, 'mod system': 1}",This was added to allow named buildings to be altered without affecting the pool matching. Unfortunately I missed this one when I made that change.
873990327,Changed the way rotations are applied on models / doors in RDBLayout,BadLuckBurt,2022-03-08 09:35:22+00:00,2022-03-08 20:51:01+00:00,{},"Changed the way rotation is applied to the models to avoid breaking orientation. All rotations are now set at once instead of being applied one after another.

Me and Ralzar both ran into the issue of certain rotation combinations not working, it will look fine in the editor but not when the RDB data is loaded in-game.

I linked to Imgur but I've added the images here now so that they won't go missing at some point. 

I compared the way rotation is handled in RMBLayout, there the model rotations are applied in one pass instead of applying each axis rotation separately. I have changed the code in RDBLayout to do the same and this solves the rotation issues. Most classic models only rotate around 1 axis so they won't exhibit this issue.

In the Unity Editor:
![UnityEditor1](https://user-images.githubusercontent.com/4460167/157247416-a0e710dc-2103-4a14-8c04-cee49e12e1ed.png)

In the live build:
![LiveBuild1](https://user-images.githubusercontent.com/4460167/157247428-bf3e0757-96bf-4fa3-a0c9-490516f8b6bb.png)

In my custom build:
![MyBuild1](https://user-images.githubusercontent.com/4460167/157247454-0dd3656c-801b-4df5-bbc6-61558eca4f19.png)

In the Unity Editor:
![UnityEditor2](https://user-images.githubusercontent.com/4460167/157247843-702e3978-c607-42d8-9866-327275599942.png)

In the live build:
![LiveBuild2](https://user-images.githubusercontent.com/4460167/157247856-b38a6922-d6ef-4523-8526-6a8e7b11988d.png)

In my custom build:
![MyBuild2](https://user-images.githubusercontent.com/4460167/157247877-7b09a4c1-d021-44e9-a888-cf4f60562adc.png)
)

I've also supplied Ralzar's RDB, go to the Bish Mines in Dragontail Mountains, when you enter you will be right beside the two beams that have the wrong orientation in the live build.

[N0000052.RDB.zip](https://github.com/Interkarma/daggerfall-unity/files/8204594/N0000052.RDB.zip"
855010234,PR #2284 mod compilation issue workaround,KABoissonneault,2022-02-17 02:30:38+00:00,2022-02-24 23:12:45+00:00,{},"As discussed with IK, the change from `DaggerfallBillboard.BillboardSummary` to `Billboard.BillboardSummary` can cause mods relying on `BillboardSummary` to fail to compile. To mitigate this, I moved the struct to the DaggerfallWorkshop namespace instead."
852583331,Fix bug with promptmulti action,ajrb,2022-02-14 22:14:08+00:00,2022-02-14 22:14:20+00:00,{},Don't check an int for zero when it's a valid button value. Checks task object instead.
848091351,Fix 2 usages of Clamp() that were not assigning the result,ajrb,2022-02-11 21:30:07+00:00,2022-02-16 04:53:48+00:00,{},
846206160,Fix bug where ally/enemy propagation is not performed for Knightly Orders,ajrb,2022-02-10 22:04:21+00:00,2022-02-16 04:53:04+00:00,{'bug': 1},Unintended bug in my code that i spotted.
841060640,New races & Cloning images,John-Doom,2022-02-06 12:31:41+00:00,2022-02-24 23:15:29+00:00,{},"Implements:
- support to register new races;
- JsonClone: a new json template to create new images from existing data and new textures.

You can use this mod to test the new features: [OrcRace.zip](https://github.com/Interkarma/daggerfall-unity/files/8010161/OrcRace.zip)"
839899053,6 methods changed to virtual to allow modding,Osorkon21,2022-02-04 04:00:00+00:00,2022-02-14 16:26:37+00:00,{},"Apologies for the last pull request I immediately closed - still a novice with GitHub.

This changes 6 methods to virtual so I can mod them. Reasons are:

EnemyEntity: To unlevel enemies, nerf knockback stunlocks
CreateCharCustomClass: To tweak character creation
EnemyDeath: To display custom death messages
PlayerActivate: To display enemy level when enemy activated
DaggerfallDungeon: To mod dungeon enemies (I would've changed RDBLayout but it's static so I went upstream to non-static class)"
839891582,6 methods changed to virtual to allow modding,Osorkon21,2022-02-04 03:34:01+00:00,2022-02-04 03:34:28+00:00,{},"Changes 6 methods to virtual so I can mod them. Reasons are:

EnemyEntity: To unlevel enemies, nerf knockback stunlocks
CreateCharCustomClass: To tweak character creation
EnemyDeath: To display custom death messages
PlayerActivate: To display enemy level when enemy activated
DaggerfallDungeon: To mod dungeon enemies (I would've changed RDBLayout but it's static so I went upstream to non-static class)"
836553778,"""Fixed"" armor values showing up in the Character Sheet paperdoll¬≠",KABoissonneault,2022-01-31 20:38:22+00:00,2022-02-16 04:52:26+00:00,{},"Request from a modder doing lots of paperdolls. The numbers are still in the Inventory window of course

EDIT: 
Images for comparison
![image](https://user-images.githubusercontent.com/5789925/151870719-e9655c4c-689a-49b4-980f-a2178f5c2b2f.png)
![image](https://user-images.githubusercontent.com/5789925/151870482-d76e06af-7d98-45bd-83bb-8db92d5043d7.png)

"
836162163,Only warn about non-optional missing dependencies,petchema,2022-01-31 13:51:31+00:00,2022-02-16 04:50:26+00:00,"{'mod system': 1, 'refinement': 1}",Forums: https://forums.dfworkshop.net/viewtopic.php?p=56707#p56707
835126944,Option to change interaction mode without notification,John-Doom,2022-01-29 13:29:51+00:00,2022-01-29 21:35:05+00:00,{},Necessary for my mod: https://forums.dfworkshop.net/viewtopic.php?t=5373.
834875574,Fixed PopulationManager's lag,John-Doom,2022-01-28 22:51:34+00:00,2022-01-29 20:26:14+00:00,{},Implements coroutines to fix PopulationManager's lag spikes when spawning new people.
834553426,"Fixed calendar showing ""23th of Sun's Dusk""",KABoissonneault,2022-01-28 15:23:14+00:00,2022-01-28 21:52:41+00:00,{},Fixes the second most offensive part of this screenshot: https://www.reddit.com/r/Daggerfall/comments/sdq1qx/wtf_daggerfall/
832660281,Add Pawn Shop to the Regional Topic,AsesinoBlade,2022-01-26 17:43:54+00:00,2022-01-29 20:42:03+00:00,{},"HI all,
I created this PR to add Pawn Shops as an option in Regional.   This code will only work after the addressable is rebuilt.   As per Internkarma's direction, I have not included that binary.

I understand from the Forums that Pawn Shop was also not available in Daggerfall Classic (although, I have not personally verified that), so if you would prefer not to include this code, I totally understand.   

Thank you for your consideration
a"
830896131,Extract abstract class from DaggerfallBillboard and move summary struct into MobileUnit base class,ajrb,2022-01-24 22:42:55+00:00,2022-02-16 04:49:58+00:00,{},"This is to allow mods contributing new MobileUnit or Billboard implementations to allow most DFU and other mod logic to continue to work. Billboard is based on the same base class structure as MobileUnit.

@Interkarma Would you like a different name for the base class, maybe AbstractBillboard or BillboardBase? I just followed the pattern already set. Apologies for the blast radius of this one. 

Pretty sure I did the refactoring correctly but could use some review in case I made a mistake somewhere. @KABoissonneault can you please review my work here?"
829772305,World Data Editor - Fix truncation of water level in start markers,ajrb,2022-01-23 15:27:30+00:00,2022-01-23 15:27:45+00:00,{'bug': 1},
823689130,Allow setting properties from override classes,ajrb,2022-01-15 16:42:16+00:00,2022-01-28 21:50:35+00:00,{'refinement': 1},Needed for next release of Travel Options mod
823672179,Update GetGroupIndex to simply return input for new items from mods,ajrb,2022-01-15 15:44:11+00:00,2022-01-28 21:50:10+00:00,"{'bug': 1, 'mod system': 1}","Update GetGroupIndex to simply return input for new items from mods since groupIndex == templateIndex

This fixes issue #2245 I think."
823668984,Make preset button in mod settings more obvious,ajrb,2022-01-15 15:29:07+00:00,2022-01-23 21:51:30+00:00,"{'mod system': 1, 'refinement': 1}","I think a lot of players miss the presets function for mod settings and I think the button should be made clearer. Here is my proposal. I used the same background colour as the save button since I am terrible at colour selection and I think it looks fine. See picture below for comparison:

![PresetButton](https://user-images.githubusercontent.com/2278830/149627363-b10c5ad8-d7f2-49a7-a55d-5bf036788a8b.png)

"
817102064,Add toggle noclip console command,extract,2022-01-09 20:03:02+00:00,2022-02-16 04:40:35+00:00,{},"This is the ""simplest"" method,
 but a bit hacky - hence experimental."
816854331,Prevent shops being treated like FG,ajrb,2022-01-08 12:38:15+00:00,2022-01-23 21:46:35+00:00,{'bug': 1},"See https://forums.dfworkshop.net/viewtopic.php?t=5200

Alternative would be to change line 5956 to read ""ggroup: -1"" but that will only affect new games I think as faction data is saved."
812074846,"Add Support For Jewelry Type Items To Be Rendered On Paper-doll If They Have Their Equip Slot Set To The Body, Mod Support.",magicono43,2021-12-30 17:13:08+00:00,2022-01-23 21:43:49+00:00,{},"Add Support For Jewelry Type Items To Be Rendered On Paper-doll If They Have Their Equip Slot Set To The Body, Mod Support.

Forum Post About ""Issue"": https://forums.dfworkshop.net/viewtopic.php?t=5323"
812029038,Fix Loop for FactionsAndBuildings.  It was looping through 28 items i‚Ä¶,AsesinoBlade,2021-12-30 15:19:02+00:00,2022-01-23 21:27:10+00:00,{},"Fix loop for FactionsAndBuildings.  It was looping through 28 items instead of 29 so it was missing Gem Stores

See reference: https://forums.dfworkshop.net/viewtopic.php?p=59155#p59155 for bug report"
808053723,Update/world data editor object data,Cliffworms,2021-12-22 04:01:08+00:00,2021-12-24 12:37:19+00:00,{},"Added all interior building parts, exterior buildings, several new clutter and re-organized NPCs lists. There are around 1000 models or more added.

The other models and billboards left to add are linked to the main quest. This update at least allows someone to use every single interior parts for buildings.

Cheers!"
805722819,Fix for switching back to original enemy Team,Macadaynu,2021-12-17 22:58:58+00:00,2022-01-23 21:26:46+00:00,{},"The EnemyBasics.Enemies array size is only 62, and the ids of the objects are not sequential in this array (It goes straight from Lamia id: 42 to Mage id: 128).

So just using the id as the array position would only work for enemies with an id of 42 or less. Better to check with Linq on the actual id of the object."
790010577,"Floating Origin change now also adjusts EnemyMotor's ""last grounded"" ",KABoissonneault,2021-11-28 01:06:13+00:00,2021-11-30 23:00:46+00:00,{},"The ""floating origin"" system can cause large position offsets for all entities in the scene over a single frame. For this reason, each time it occurs, the player's controllers are notified so that they can offset the fall damage values. But this isn't done for enemies.

In vanilla DFU, exterior enemies don't happen often, and it's usually in situations where the floating origin doesn't cause issues. With mods, it's another story. Many of them try spawning enemies near a fast travel target or a dungeon entrance, which causes all of them to die from fall damage during the transition. You get ""A bandit has died."" spam, and a whole bunch of corpses instead of the planned encounter.

This change fixes this issue, at the cost of a `FindObjectsOfType` call per floating origin change (which isn't that often, at least)."
788502744,KoW Totem Reputation fix,JayH2971,2021-11-25 04:54:35+00:00,2021-11-25 05:39:53+00:00,{},Fixes bug reported in http://forums.dfworkshop.net/viewtopic.php?f=5&t=5234&p=58362
785275117,"Fix StreamingWorld.TrackLooseObject ""mapPixelX"" and ""mapPixelY""",KABoissonneault,2021-11-20 20:52:26+00:00,2021-11-20 21:07:54+00:00,{},"Fix StreamingWorld.TrackLooseObject not setting ""mapPixelX"" and ""mapPixelY"" in the loose object description if specified to anything other than player position. 

All code in DFU uses `-1` for both the `mapPixelX` and `mapPixelY` arguments, so this issue is only for mods. 

My mod spawns objects on the terrain outside of the player's current map pixel, and needs the StreamingWorld to track them so they're destroyed in the right order in all cases. Without this fix, the moment the player moves from one map pixel to another, `CollectLooseObjects` is called (with `collectAll = false`), and my objects have (0, 0) as the mapPixelX and mapPixelY, so they're considered ""out of range"", and get destroyed. With this fix, they have the right mapPixelX and mapPixelY that I set, and only get destroyed if they're actually out of range.

I think this fix is minor, has no impact on DFU, and clearly reflects the intent of the function, so I would appreciate if this could be merged ASAP for the next release."
780149917,Adds a world data editor to Unity DFU tools,ajrb,2021-11-14 19:45:31+00:00,2021-11-25 01:36:37+00:00,{},"Developed from Uncanny Valley's building editor and extended to allow editing RDBs as well. The asset categories were completely redone by Cliffworms, and he has tested extensively.

Guide to use can be found on the forums: https://forums.dfworkshop.net/viewtopic.php?f=22&t=2857&p=55485#p55485

"
774204222,"Virtual ""Open"" effect for exterior doors",KABoissonneault,2021-11-05 12:34:32+00:00,2021-11-25 01:30:05+00:00,{},"I received a report that my ""unleveled"" Open spell didn't work on exterior doors. Indeed, that check is not made through the Open effect, and cannot be overriden by mods.

I simply moved the code to a virtual function inside `Open`. 

Not a blocker this time, so merge at your own leisure."
769752858,Tune player item based torch light,ajrb,2021-10-30 16:28:17+00:00,2021-11-01 00:00:35+00:00,{},
756717712,Scale item based torches after lighting update.,ajrb,2021-10-12 21:19:03+00:00,2021-10-13 16:48:22+00:00,{},"This gives approximately the same illumination as before 0.13.x when the player torch setting is set at 0.7 allowing a bit more configurability for players who want brighter torches.

This will need tuning again if we want to adjust the std non-item torchlight intensity. For info I found that setting dungeon ambient to 0.5 looked about the same as 0.3 before."
754806024,Fixed custom textures for NPC billboards not having a collider,KABoissonneault,2021-10-10 23:57:13+00:00,2021-11-25 01:29:33+00:00,{},"With #2242, mods can add static NPCs with new textures using world variants.

![image](https://user-images.githubusercontent.com/5789925/136717058-2ab32e6c-5a23-4e48-88ef-2ddc0f30fbba.png)
Pictured: Lady Flyte, in the Anticlere palace

However, there is an issue: they cannot be interacted with like a normal NPC.

`MaterialReader.GetFlatType` only handles textures between 0 and 511, so custom textures will not get detected as a `FlatTypes.NPC`. 

`DaggerfallBillboard.SetMaterial` uses this enum value to know whether to add a collider on it. Therefore, custom textures don't get that collider.

There were a few ways to go about fixing this, but I went, again, with something short that affects as few code as possible. Let me know if you think we could do with something cleaner."
754717846,Allow cast when held to be overridden and modified by mods.,ajrb,2021-10-10 14:40:04+00:00,2021-11-25 01:21:45+00:00,{},"This is so travel options can prevent ticking of damage when time accelerated travelling, since fast travel doesn't damage condition."
754594137,Randomize dye color for clothing items created by quests.,Ralzar81,2021-10-09 22:25:11+00:00,2021-11-25 01:21:26+00:00,{},"I just had a chat with Jehuty about how this code is used and the glaring problem for clothing item generation is that quest code has no way to check for gender, so it can only ask to generate male or female clothes with no way of knowing if that is correct for the current player character. So I avoid doing any gender checks and came up with this.
From the tests I did, this should produce the correct item each time but with a randomly picked dye."
754037867,Avoid all quest clothing using blue dye,Ralzar81,2021-10-08 13:22:47+00:00,2021-10-09 22:18:09+00:00,{},"(Aw jeez, here I go attempting a pull request again)
Not sure if this is intentional design to copy vanilla or not, but it seems all clothing produced by the quest system defaults to blue clothing.
This change should make sure clothing gets a randomized clothing dye instead."
748200093,Improve choice of loose texture format,rossipaolo,2021-10-02 21:26:06+00:00,2021-10-11 00:29:39+00:00,"{'mod system': 1, 'refinement': 1}",Checks width and height of png files directly from IHDR header and chooses appropriate texture format before data is loaded as Unity Texture2D. This avoids the need to reimport image if resolution is below threshold. @Interkarma let me know what you think of this approach.
748198380,added actions property to task class,Macadaynu,2021-10-02 21:11:28+00:00,2021-11-25 01:21:09+00:00,{},"Request to add a new ""Actions"" get property to the Task.cs class. This is to enable a mod to automatically add notes to the player's notebook with main story NPC quest dialogue, issue request [here](https://forums.dfworkshop.net/viewtopic.php?f=12&t=4942).
Also to help with the implementation of a hidden map location mod idea found [here](https://forums.dfworkshop.net/viewtopic.php?f=12&t=5117)."
742722337,Fix missing sound and StaticNPC for imported RMB gameobjects,rossipaolo,2021-09-25 16:37:28+00:00,2022-01-23 21:26:00+00:00,{},
740940477,Fix out-of-range error in FormulaHelper.CalculateCastingCost ,KABoissonneault,2021-09-22 23:41:22+00:00,2021-10-29 00:25:45+00:00,{},"The issue was reported on my mod here: https://forums.dfworkshop.net/viewtopic.php?p=57172#p57172
Save with repro steps included in the mod, Hotkey Bar mod probably not actually necessary for repro.

Basically, my custom spells don't always have 3 spell effects in them, and it makes the magic item cost formula throw an exception. 
I just made it use the actual size of the array, instead of assuming all spells have 3 effects (most spells had invalid effects for slot 2 and 3, of course).

I took the opportunity to add a formula override."
735878306,Color picker tweaks and fixes,rossipaolo,2021-09-16 22:20:07+00:00,2021-11-25 00:23:52+00:00,{'refinement': 1},"Made a few changes to the color picker used for mod settings (for example by RealGrass mod):

* Improved scaling (text labels were too small).
* Color is picked (`OnColorPicked` event) only if window is closed with OK button, otherwise is discarded.
* Fixed an issue that caused a color to be selected if the mouse button is still pressed after popup window is opened by clicking a button positioned under the popup."
733269674,Enemy corpse custom texture fix,KABoissonneault,2021-09-14 02:55:20+00:00,2021-11-25 00:02:09+00:00,{},"See issue #2230 

It seems lots of this code is older, back from 2019. For example, the Material code only checked loose files, not ""all locations"" (assets from the dfmod). 

Graphics isn't my area, and I don't know what are the users of these graphics settings. However, I tried to make my changes have no effects on people replacing texture 0 to 511 - there shouldn't be any users for textures outside of these in materials, as it didn't work before this PR.

I'm open to suggestions to make this cleaner.

Hopefully with this, Kamer can complete his mod.

EDIT: yes, this works for him :)
![image](https://user-images.githubusercontent.com/5789925/133497778-b3df5852-785d-4cab-8713-6fbc3ed54b03.png)
"
733146958,Merge linear lighting material changes to master,Interkarma,2021-09-13 21:53:20+00:00,2021-09-13 21:54:00+00:00,{},Will finalise changes and tuning in master branch.
731969776,Removes leftover elements of Baltham Greyman Pt2,JayH2971,2021-09-11 18:08:48+00:00,2021-11-24 23:21:33+00:00,{},Referenced in https://www.reddit.com/r/daggerfallunity/comments/plj9ah/quest_former_student_part_ii_broken/hcgdgj2/
729127183,Update linear lighting branch to current master,Interkarma,2021-09-08 01:35:12+00:00,2021-09-08 01:51:49+00:00,{},
728291991,Update postprocessing stack,Interkarma,2021-09-07 04:09:23+00:00,2021-09-07 04:09:29+00:00,{},
723957640,Added missing formula override for FormulaHelper.SavingThrow ,KABoissonneault,2021-09-01 02:31:54+00:00,2021-09-01 23:57:00+00:00,{},"While doing #2108, I intended to cover all the formulas required to modify how spells work. Technically, I did, but I realized spells go through another `SavingThrow` overload first that just has way more information for mods to use.

Note that I gave the override a name different from the function itself, since the function is overloaded."
722962430,Disable interactions during touch-range spell,KABoissonneault,2021-08-31 02:31:27+00:00,2021-09-01 23:56:43+00:00,{},"UX improvement for issue #2232.

I considered disabling all interactions except doors, ""action"" (ex: levers), ladders, and custom. Then, I decided that for most other interactions, if you're clicking on them, you probably meant to interact, not cast a spell on them.

Maybe loot markers might be accidentally misclicked in combat, and some may prefer disabling interactions with them while casting spells.
I decided not to, since players might be readying a spell from an auto-recast mod (ex: Hotkey Bar) and deliberately clicking a loot container. 

So, in the end, I only disabled mobiles, since you're most likely intending to fight them. It was already dangerous to talk to villagers with a spell ready since it would go off even when you could successfully interact with them."
721950332,Expose and virtualize members in Open and Lock magic effects,KABoissonneault,2021-08-29 13:16:40+00:00,2021-09-01 23:53:21+00:00,{},"Not really a fix, but it's small enough at least.

In my Unleveled Spells mod, I managed to remove level scaling from all the spells in the game, except for spells featuring the Open and Lock magic effects. My users would appreciate if I could fix this.

You can't replace those effects without inheriting from them and replacing `TriggerOpenEffect` / `TriggerLockEffect`, since the DFU code is hardcoded to search for them specifically, so a DFU code change was necessary.

"
719335204,A0C00Y16: show message popup before hiding NPC,df-ferital,2021-08-25 07:32:10+00:00,2021-09-01 23:53:00+00:00,{},Matched to classic: the message popup should be displayed before the NPC is actually hidden. Quest _Missing Person Case_ is the only quest where `add _npc_ face saying` is used.
719226923,Adds kill msg M0B00Y16,JayH2971,2021-08-25 03:46:28+00:00,2021-09-01 23:52:42+00:00,{},"Giant Killing can be a hectic quest, with multiple giants spawning when the first is injured. A player can lose track of the correct target and kill the wrong one with no notification. This commit adds a kill message."
719057030,Fixed custom enemies using ids above 145 not having any sounds,KABoissonneault,2021-08-24 20:51:49+00:00,2021-09-01 23:52:25+00:00,{},"Most people play with human sounds muted, but Kamer noticed that it made his custom goblins muted too.

Small fix so custom enemies don't get affected by this mute feature. If someone wants a mute custom enemy, they can just remove the sounds."
719006897,Change protection to allow mod overriding for court UI window,ajrb,2021-08-24 19:29:16+00:00,2021-09-01 23:52:08+00:00,{},This contains a slight refactoring of the main logic outside of the Update() method since this is called up the hierarchy. All other changes are protection only.
719000775,Change protection to allow mod overriding for save/load UI window,ajrb,2021-08-24 19:18:42+00:00,2021-09-01 23:51:11+00:00,{},"No functional changes, just permissions."
717426200,Allow Argonians to get random names in character creation,KABoissonneault,2021-08-23 01:31:04+00:00,2021-08-23 22:16:09+00:00,{},"The original code comment said:

>Disable random name button only for Argonians because their race id
>would give them Imperial names from namegen

but that's only true in games after Daggerfall. In both Arena and Daggerfall, Argonians get latin names, that's just how it works in those games. Imperials don't even exist. Even in Daggerfall Unity, an Argonian character will have named characters with latin names in their background History. 

There's no reason for this arbitrary exclusion in DFU. It's going to be a surprise to veterans of the series, but it's consistent with Daggerfall itself. Worst case, they can name their character Makes-Up-Names themselves."
717287998,Don't level up if already dead,petchema,2021-08-22 10:43:42+00:00,2021-08-23 22:18:28+00:00,{'bug': 1},"Corner case seen in a stream, player tried to sleep over some poisoning, but was also close to leveling up.

He died while resting, but had to level up before death scene could start."
716833092,Dehardcode sound effects,JaceySanders,2021-08-20 15:42:10+00:00,2021-08-20 23:41:34+00:00,{},"Moves the lists of sound effects found in AmbientEffectsPlayer.cs into text files in SteamingAssets/Tables, and modifies AmbientEffectsPlayer.cs to access them from there. This dehardcoding allows modders to change which sound effects are used (e.g. removing the door ambient sounds from dungeons.)

This is my first time contributing to a project on Github, so please be patient with me."
716394923,Pause Options Dropdown and ListBox changes,jefetienne,2021-08-20 02:49:34+00:00,2021-09-01 23:47:44+00:00,{},"Addresses #2184 

- Added ability for ListItems to be manually disabled, which prevents selecting or using them
- Made Mod settings dropdown option disabled with this new ability if no applicable mods found
- Switch to using custom textures again (this time of the chevron icon - made by myself. If anyone wants to improve on them let me know)
- Bugfix: Make the ListItems property return a shallow copy to prevent bypassing adding and removing items
- Improvement: Return registered dropdown items in alphabetical order (except for the Mod Settings option) to keep a consistent order regardless of mod load order"
716279634,A0C00Y16 minor fixes,JayH2971,2021-08-19 21:37:35+00:00,2021-08-19 22:12:22+00:00,{},
715999791,"Enables K0C00Y06, A0C00Y16",JayH2971,2021-08-19 14:42:22+00:00,2021-08-19 22:21:38+00:00,{},"Contingent on recent quest engine fixes getting merged, see issues 2190, 2191"
715959241,Add divide by zero protection to ConditionPercentage property,ajrb,2021-08-19 13:56:02+00:00,2021-08-19 22:19:46+00:00,{'bug': 1},Fixes an edge case for 2 vanilla items with 0 max condition defined (finger and dead body) - it was causing exceptions when the curse quest that gives the finger when used with a mod that repairs items as it checks all items in player inventory.
715488612,Check that dependencies of an enabled mod are enabled,petchema,2021-08-18 23:52:35+00:00,2021-08-19 22:16:59+00:00,{'bug': 1},"
Minimum fix: adds a warning when a dependency of an enabled mod is not enabled

Forums: https://forums.dfworkshop.net/viewtopic.php?f=22&t=5020"
712824331,Fix badly formed XML comment,rossipaolo,2021-08-14 18:56:46+00:00,2021-08-19 22:20:05+00:00,{},Fixes xml comment that couldn't be parsed by docfx.
709618715,Retrorendering in linear colorspace,petchema,2021-08-11 20:55:30+00:00,2021-08-12 05:51:30+00:00,{},"
Do palette transformations in gamma colorspace"
709431430,"Added PlayerSpeedChanger.ModifySpeedMod(), Includes Console Commands",l3lessed,2021-08-11 18:48:00+00:00,2022-07-07 02:37:04+00:00,{},"I've added ModifySpeedMod to PlayerSpeedChanger.cs. This object allows developers to modify an already injected walk or run speed modifier value. This helps resolve the issue of having to continually add and remove walk and run speed modifier values to update them by providing a method to update a current modifier value through its assigned UID value. Also, it will make lerping speed changes over time easier and less cycle expensive.

I also added commands to the set_walkspeed and set_runspeed commands for testing this out via console. To modify an already existing/inject speed modifier value merely call set_walkspeed or set_runspeed and after the wanted updated speed value put the UID you want to update. And you're done, value is updated."
704164335,Unity 2019.4.28f1 upgrade,Interkarma,2021-08-04 23:29:00+00:00,2021-08-04 23:29:10+00:00,{},
700651776,"Fix ""Tell Me About"" giving different person locations than ""Where Is""",mundifex,2021-07-31 04:33:22+00:00,2021-08-19 22:16:24+00:00,{},"ExpandMacro method in Person relied on GetHomePlace which only ever took into account a person's home place symbol. Switched to using new method GetDialogPlace which will use assigned place first, falling back to home place if needed.

""Where Is"" calls TalkManager::GetKeySubjectPersonHint which relies on GetPersonSiteDetails to check for an assigned place symbol, falling back to the person's home place symbol if no assignment exists. With this change, ""Tell Me About"" now employs similar logic, which works well for queries about questor and quest-related NPCs alike.

My test case was quest K0C00Y06 from #2191 wherein mobile NPCs reported two different locations for _witness_. They now report just one location, the correct one, which updates as the witness is moved from _inn_ to _withouse_."
700638223,Destroy extant NPC object when placing it somewhere player is not,mundifex,2021-07-31 02:12:09+00:00,2021-08-19 22:13:27+00:00,{},"In K0C00Y06, the _witness_ NPC is placed at _withouse_ immediately after calling for the guards.

The current implementation of a hot-remove in Place.cs tried to hide the NPC in such an instance but the Tick method of QuestResourceBehavior would un-hide the NPC immediately after. Destroying the NPC's gameobject instead allows for hiding the NPC in a manner that QuestResourceBehavior cannot revert. The NPC will re-instantiate when the player visits its new location.

The only instance in which I can see this causing an issue is if an NPC is placed at an alternate location via `place npc` and then placed back at its original location while the player is still there. If such an instance exists, it should be changed to use `hide npc` and `restore` instead."
700636263,Use _thiefhome_ symbol for rumor mill and anonymous tip,mundifex,2021-07-31 01:53:41+00:00,2021-08-19 21:13:57+00:00,{},"K0C00Y06 features two symbols with very similar names: _thiefhome_ and _thiefhouse_
_thiefhome_ is the location for the usual suspect _thief_ and where they can be found if not the guilty party.
_thiefhouse_ is the site where the incriminating evidence and/or guilty party can be found.

Rumors related to all other usual suspects use appropriate home symbols (e.g. _priesthome_ for _priest_) so rumors for _thief_ should use _thiefhome_.
The anonymous letter you receive when _thief_ is the culprit should similarly reference _thiefhome_  as all other anonymous letters do for their respective culprits.

This change should help reduce confusion in #2191 since now the only way to learn the location of _thiefhouse_ is through meeting the witness."
700634608,Fix questor NPC not hiding when using startquest via console,mundifex,2021-07-31 01:37:24+00:00,2021-08-19 21:13:19+00:00,{'questing': 1},"LastClickedNPC quest resource behavior fixup only occurred when starting quest via popup window. Moving it within StartQuest method of QuestMachine ensures it will take effect for any code path that starts a quest. AssignQuestResourceBehavior method already ignores non-questor NPCs and will only create a single behavior component per NPC so this should be a safe fix globally.

Quest K0C00Y06 hides its questor NPC shortly after quest start. Prior to this fix, this would only occur if starting the quest from a dialog popup. With fix in place, questor now also hides properly when invoking quest via `startquest` console command."
700378160,Improve presentation of quest A0C00Y16,mundifex,2021-07-30 15:22:11+00:00,2021-08-19 21:23:36+00:00,{},"Changes:
- only add dialog links to friends 3 and 4 for messages that reference them
- divulge missing person's location using _hidingplace_
- restore delay during quest reward so gold message displays after gratitude"
700274134,"Fix ""dialog links"" and ""create npc"" to behave as classic quest opcodes",df-ferital,2021-07-30 12:59:16+00:00,2024-07-11 17:01:21+00:00,{},"While working on A0C00Y16 to fix issue #2190, I noticed so-called ""dialog links"" were not working correctly. Furthermore, there were other issues, like the fact than all NPCs homes were available as topics under the ""Where Is > Locations > General"" list. That's not correct at all since these houses should only be available when mentioned by other NPCs, and none of the NPC houses are mentioned at start.

I also reverse engineered classic regarding the `dialog link` and `add dialog` opcodes and it appears that Tipton's documentation for these opcodes was inaccurate. In fact `dialog link` should have been named `remove dialog` as that's the only function it does. When several quest resources are mentioned in a `dialog link` command, this only means that all of these resources need to be hidden, nothing more. There is no ""link"" between any of the resources, which means than hearing about one does not necessarily reveal any of the other, except if the quest explicitly uses the `add dialog` command to do so.

I corrected all of this, and I now have a perfectly working version of A0C00Y16, which I will submit as another PR. Of course I tested other quests to be sure that my changes do not break any stuff and it appears to be working pretty well.

One other thing I corrected is the fact that quest journal entries should not reveal anything regarding quest resources, only speaking with other NPCs or reading letters and other written quest items should do so."
699942563,Fix assigned quest places getting re-assigned when setting up places,mundifex,2021-07-30 01:45:40+00:00,2021-08-19 21:06:21+00:00,{},"IsBuildingAssigned method was comparing site's mapId against location's ExteriorData but everywhere else site mapIds are derived from location's MapTableData instead. Change comparison to compare against proper value.

This PR represents another partial fix for #2190 that addresses errors such as:
* incorrect building names causing confusion on automap and in dialog messages
* created NPCs sometimes existing at the same location
* NPCs placed at locations sometimes reusing their home location (e.g. _missingperson_'s home and _hidingplace_ being the same physical location but having different names)

With this fix in place, all locations chosen for quest A0C00Y16 were unique (within scope of quest itself) in 10 separate tests."
699887469,Update to current master,Interkarma,2021-07-29 22:49:40+00:00,2021-07-29 22:50:00+00:00,{},
699717902,"Add console var ""talk_npcBehavior"" to override behavior in dialogs",mundifex,2021-07-29 17:33:27+00:00,2021-08-19 21:01:11+00:00,{},"Added new behavior ""AlwaysFriendly"" to force NPCs to respond helpfully even if they don't like you numerically. This is particularly helpful when debugging quests and you simply want answers from a mobile NPC instead of playing whack-a-mole to find one that likes you; `talk_npcBehavior 3` gets you omniscient, affable NPCs wherever you go.

Refactored ""talk_npcsKnowEverything"" and ""talk_npcsKnowUsual"" commands to drive a variant of new flags-based enum field for behavior states.

Finally, added a know-everything check to `GetAnswerWhereIs` method to fix an issue where extant mobile NPCs did not know answers to Where Is questions if they were not omniscient when spawned (i.e. developer changes behavior state to KnowEverything after NPC spawned)."
699606611,Fix placed NPCs reverting to home location,mundifex,2021-07-29 14:56:04+00:00,2021-08-19 21:00:55+00:00,{},"Partial fix for #2190, specifically ""NPCs who should appear in buildings where they don't.""

The Tick method in Person.cs contains logic that attempts to hot-place an NPC at its home location when the player arrives there. While this behavior only occurs once, it did not contain a check to see whether the NPC had already been placed, e.g. by a PlaceNpc action. This had the effect of permitting quantum NPCs that could exist in two places at the same time: both at their placed-at location and at their home location. Once the player visits the NPC's home location, however, the NPC will no longer appear at the placed-at location. These anomalies account for the strange NPC availability noted in the issue.

Test case: Quest A0C00Y16
* _missingperson_ is placed at _hidingplace_ but still has a home location defined
* player visits _hidingplace_ first, _missingperson_ is present until... 
* player visits _missingperson_home_, _missingperson_ auto-placed at home and stops being present at _hidingplace_
* _missingperson_ will only exist at home location for remainder of quest, soft-locking quest path _S.00_

Adding a check that `lastAssignedPlaceSymbol` has not already been assigned prevents NPCs being erroneously hot-placed back to their home locations when placed elsewhere."
699582190,Classic Quests : Suggested dungeon types changes,Cliffworms,2021-07-29 14:26:07+00:00,2021-09-01 23:19:01+00:00,{},"Suggested dungeon type changes for 15 quests according to their context.

For some of them, a dungeon type is implied in dialogue or the quest prompt, yet they use the ""_dungeon_"" place, which randomly selects a dungeon from every type. This can create the scenario of having to hunt down the leader of an orc band in a crypt, which would make the target the only orc in the dungeon.

I went through every quest that used ""_dungeon_"" as a place and examined the dialogue to see if it could use a specific dungeon type instead of a random one. Since there's already a fallback mechanic in place, regions that do not have these dungeon types will still parse by choosing a random dungeon instead. At least, a dungeon type that offers a theme and foe spawns more in line with the quests' context could be choosen first.

Here are my justifications for each of those changes, taken from [my thread](https://forums.dfworkshop.net/viewtopic.php?f=23&t=4966&p=55865#p55865) on the DFU forums : 


**Quest :** 60C00Y00
**Type :** Prison
_Justification :_
`Then go from ___mondung_ to a lunatic asylum called ___contactdung_`

**Quest :** A0C0XY04
**Type :** Coven
_Justification :_
`Some poor fool went into ___dungeon_. I hear the place is full of demons.`

**Quest :** B0B00Y00
**Type :** Vampire Haunt
_Justification :_
`[...]to rescue the fair Lady _lady_ from ___mondung_, where she has been captured and imprisoned by a (vampire).`

**Quest :** B0B10Y04
**Type :** Orc Stronghold
_Justification :_
`The orc lives in a hole called ___mondung_ with his troops.`

**Quest :** B0B40Y08
**Type :** Orc Stronghold
_Justification :_
`[...]the (orc warlord) of a powerful orc band in ___dungeon_.`

**Quest :** B0B40Y09
**Type :** Giant Stronghold
_Justification :_
`The giant has made a den out of ___dungeon_. Go there and kill him. You might find other giants there.`

**Quest :** B0B60Y12
**Type :**Crypt
_Justification :_
`[...]_nobleman_'s ancient ancestor is entombed in a mausoleum named ___dungeon_`

**Quest :** B0B70Y14
**Type :** Coven
_Justification :_
`All sorts of Daedric beings are entering into our world. [...]
Go quickly then to ___dungeon_. We have no way of knowing how many Daedra are wandering its halls.`
_Note : Both Covens and Desecrated Temples could fit as they have the most daedra spawns. Covens are present in more regions though._

**Quest :** B0B80Y17
**Type :** Crypt
_Justification :_
`[...]a lich is raising an army of undead.`

**Quest :** B0C00Y06
**Type :** Giant Stronghold
_Justification :_
`The giant has made its lair in ___dungeon_. Go there and kill it. There may be other giants there, but I don't care.`

**Quest :** C0B00Y03
**Type :** Desecrated Temple
_Justification :_
`[...]has disappeared while investigating an old ruined temple.`

**Quest :** E0B00Y00
**Type :** Desecrated Temple
_Justification :_
`Quest title : The desecrated temple.`

**Quest :** L0B10Y03
**Type :** Vampire Haunt
_Justification :_
`I haven't heard from =target_ since %g went off looking for that baron in ___mondung_. 
Weird character, that baron. Never came around during the day, lived in that creepy place.`

**Quest :** M0B1XY01
**Type :** Harpy Nest
_Justification :_
`[...]has hired me to exterminate a nest of harpies that has infested ___mondung_
`

**Quest :** M0B20Y02
**Type :** Giant Stronghold
_Justification :_
`Our client places the giants at their stronghold, ___mondung_.`"
699160944,Fix dialog not displaying when adding a face,mundifex,2021-07-29 02:48:30+00:00,2021-08-09 01:23:02+00:00,{},"Fixes issue where intended dialog was not displayed when adding an NPC face to player's HUD if player had saved and loaded their game prior to the AddFace action occurring. 

Error in RestoreSaveData method of AddFace.cs led to `sayingID` field remaining at zero value and ignoring the intended message ID."
696953145,Implements Baltham Greyman questline,JayH2971,2021-07-26 11:44:59+00:00,2021-08-09 01:22:43+00:00,{},"Thoroughly playtested... but I'm sure bugs will get reported. Bring on the reports!

I had to change the place symbols L.00 and L.01 to other ones I created. After that, the quest loaded fine! No idea why those symbols caused problems. But this is done."
696490582,Allow to ask about individual NPCs in some quests,df-ferital,2021-07-25 12:03:43+00:00,2021-08-08 07:19:05+00:00,{},"Fix all Daedra quests as well as Lhotun's part of the main quest to allow asking about Daedra princes and The Underking. The only exception is Namira who has no dialogue for anyInfo.

Also fixed some artifacts dialogue messages which where incorrectly associated with the `used` command instead of `anyInfo`."
696475461,Fix the placement of quest NPCs,df-ferital,2021-07-25 10:05:47+00:00,2021-08-08 07:13:37+00:00,{},"Fix two issues related to the placement of quest NPCs:

- Named NPCs (i.e. Individuals and Daedras) are not supposed to be placed by default as they can be present in a quest person list only for reputation change purpose. This is the case, for example, of quest A0C0XY04, where Gortwog is not supposed to be placed anywhere. Furthermore, for quests where an indivudal NPC is supposed to be placed somewhere, this is always done by the `place _person_ at` command.
 
- When getting a quest from a location where there is no building at all, always choose a remote scope when selecting the place of a quest NPC who has no assigned location scope. This is the case when getting quests from Witch Covens, but it could also happen from a static NPC placed in the wilderness by a mod, for example."
694687316,Fix code mistake in building variant getter,ajrb,2021-07-21 20:28:55+00:00,2021-07-21 23:30:15+00:00,{},"When I added the code in feb I made a small mistake. Doesn't affect most uses since lastLocationKey is usually the correct one anyway, but needs correcting for future uses.

So not essential for 0.11.5 release, but could go in."
693491538,"Fixed missing ""OnLootSpawned"" event for house/shop containers",KABoissonneault,2021-07-20 13:59:19+00:00,2021-07-20 23:25:57+00:00,{},"Sorry for breaking the 0 PR pending, but

#2087 was meant to cover all spawned loot, and Ralzar noticed that I missed containers, which are spawned from PlayerActivate.

PlayerActivate generates loot for containers, both for house/shop ""private property"" crates and shop shelves. Shop shelves do cover modded items in a more automatic manner, but I put the event anyway for consistency.

![image](https://user-images.githubusercontent.com/5789925/126336370-9f458a9d-22e6-4be6-91cf-f92c92f65cc6.png)

![image](https://user-images.githubusercontent.com/5789925/126336399-f2c809b7-5fe4-4d31-8dda-86cbe5b24072.png)
"
691981909,Fix a misaligned lever in N0000052.RDB,ajrb,2021-07-17 20:06:12+00:00,2021-07-17 20:06:26+00:00,{},
691275609,Moved absorb logic from EntityEffectManager to FormulaHelper,dakoller123,2021-07-16 07:55:15+00:00,2021-07-16 08:38:25+00:00,{},So it can be easily overriden by mods
691186726,Adds failsafe spawn to A0C01Y01,JayH2971,2021-07-16 04:27:37+00:00,2021-07-17 00:31:11+00:00,{},"Adds a new spawn mechanism after 11 PM to guarantee that the enemies will spawn during the quest. Spawning ""every 10 minutes 1 times with 25% success"" still gives a tiny dangling chance that the enemy will fail to spawn for no good reason."
689413534,Autorun fixes,jefetienne,2021-07-13 21:27:10+00:00,2021-07-17 00:48:22+00:00,{},"First fix from [this comment](https://forums.dfworkshop.net/viewtopic.php?p=55752#p55752)

 - Manually running and enabling AutoRun will now continue to let the player run
 - Prevent enabling Autorun while moving backwards, which causes unexpected behavior where the player is not moving forward, but is in a running state unless if they press the 'Run' button or move backwards again."
688197494,Fix a loading issue when EnumerateMaps() is run before mods enable/disable state is set.,ajrb,2021-07-12 21:38:46+00:00,2021-07-13 04:23:48+00:00,{},"As discussed on PR #2173, the EnumerateMaps() is running before the mod settings have been confirmed and thus partially loading new locations regardless of whether a mod containing them is enabled or disabled. (since that state is undefined at that point) New locations have to be included and checked for collisions when the map dictionary is created.

This PR moves the setting up of the map dictionary to happen the first time it needed rather than on construction of the ContentReader. I felt this was less intrusive code change wise, but it could be done differently if you don't like the check method calls."
688117473,Fix RDB door data in runtime patching,ajrb,2021-07-12 19:36:13+00:00,2021-07-12 19:37:17+00:00,{},"N22 + N23, remove bad door object entirely
N35, reposition door in doorframe"
687244971,Ensure only new locations are picked up from mods,ajrb,2021-07-10 22:21:56+00:00,2021-07-12 12:58:59+00:00,"{'bug': 1, 'mod system': 1}","This corrects an issue where a location override is also loaded and applied as a new location when in a mod package rather than loose files. Bad mistake on my part, but thankfully I found it while developing an update for my guild mod.

----
One other thing I noticed while investigating this issue is that disabling the mod didn't prevent this bug, which made me realise that the use of FindAssets is returning assets from and mod (as I expected) including mods that are disabled - which is not what I expected. I'd not noticed before now also causes my dungeon tester mod to put a location pixel dot on the travel map that has no name and you can't travel to, this is also because my World Data replacement code is finding the new location asset even though the mod is disabled.

@rossipaolo Could you take a look at FindAssets (line 449 of ModManager.cs) and say whether this is working as you expect please? I'm really not sure whether this is a bug in that code or if it's intended to return matching assets regardless of mod being enabled or disabled. If it's meant to work this way then I'll need to do a second pass and load each asset individually by name or something like that,
"
687235327,Restore dungeon types from classic,ajrb,2021-07-10 20:39:04+00:00,2021-07-10 20:39:30+00:00,{},"Restore dungeon types from classic that were removed before the fallback was implemented in 2019.

I made these changes originally in 061ca3ee because the quests were failing in major regions that don't have orc strongholds (like Daggerfall) not being able to find a suitable dungeon location. I'd forgotten about this until recently. Restored to classic and tested.

There are some quest candidates for refined dungeon type use that were not like that in classic being produced which will come in a separate PR for consideration. I was only prepared to do these to restore to classic."
686448784,Fix default binding accidental overrides,jefetienne,2021-07-09 02:50:51+00:00,2021-07-17 00:44:22+00:00,{},"[Fixes this forum post issue](https://forums.dfworkshop.net/viewtopic.php?f=5&t=4943)

Default bindings now only get set when the default KeyCode is no longer used in either binding page, and that it isn't used as a modifier. This fix also lead me to find another bug where not all modifiers were being found, which has also been resolved.

Also integrated idea from @KABoissonneault to have a list of primary bindings specifically removed by the player. While the primary fix should suffice, this idea will help keep the binding behavior expected."
686265507,Correct the faces used for archive 452 to match classic,ajrb,2021-07-08 19:19:52+00:00,2021-07-08 19:19:58+00:00,{},
683318846,Display warning label for runtime mod settings,jefetienne,2021-07-05 03:13:59+00:00,2021-07-17 00:30:02+00:00,{},"#2004 

Implemented starting point for a universal warning sign whenever a player changes a mod's settings while running the game, saying ""Note: Some changes may not be applied until you restart the game."" right above the save button.

In the future, we can add a flag to each mod setting that will instead prompt the warning when necessary."
682838304,Fix billboard animation so frame 0 is rendered first,ajrb,2021-07-02 19:16:55+00:00,2021-07-08 19:20:29+00:00,{'bug': 1},"Mostly important for one shot animations. Is there anywhere else than may have the increment before the first frame?

As reported here: https://forums.dfworkshop.net/viewtopic.php?f=5&p=55561"
681420622,Added dropdown options in pause menu,jefetienne,2021-07-01 03:49:51+00:00,2021-07-17 00:29:23+00:00,{},"(Very last minute but in EDT it isn't July yet! Hopefully I make it through the feature lock ;))

Implements #2004

Added a dropdown menu in the pause window that by default will include access to the mod settings menu. I simply took the same logic as the static class ChangeModSettings in DefaultCommands, so hopefully this should suffice. Shortcut to toggle it can can be used with 'D'.

Additional options (button text and button click event) can be easily added to the dropdown via a method from DaggerfallUI called RegisterPauseOptionToDropdown that takes in a string for the button text and an Action to implement the logic once it has been clicked.

I'm making this a draft because I have been having a hard time trying to get the dropdown toggle be [moved to the very edge of the screen](https://imgur.com/a/mNcSb6P). When I add it to ParentPanel, the controls become very tiny and I haven't figured out how to properly scale it with AutoSize, Scale = NativePanel.LocalScale, etc. I would appreciate any help to get this [working as I want it to](https://imgur.com/a/JiYlk75). Additionally, if there are any other improvements to what I have down, please feel free to let me know."
681419853,Added dropdown options in pause menu,jefetienne,2021-07-01 03:48:04+00:00,2021-07-01 03:48:34+00:00,{},"(Very last minute but in EDT it isn't July yet! Hopefully I make it through the feature lock ;))

Implements #2004

Added a dropdown menu in the pause window that by default will include access to the mod settings menu. I simply took the same logic as the static class `ChangeModSettings` in DefaultCommands, so hopefully this should suffice.  Shortcut to toggle it can can be used with 'D'.

Additional options (button text and button click event) can be easily added to the dropdown via a method from DaggerfallUI called `RegisterPauseOptionToDropdown` that takes in a string for the button text and a mouse click event handler to implement the logic once it has been clicked.

I'm making this a draft because I have been having a hard time trying to get the dropdown toggle be moved to the [very edge of the screen](https://imgur.com/a/mNcSb6P). When I add it to ParentPanel, the controls become very tiny and I haven't figured out how to properly scale it with AutoSize, Scale = NativePanel.LocalScale, etc. I would appreciate any help to get this [working as I want it to.](https://imgur.com/a/JiYlk75) Additionally, if there are any other improvements to what I have down, please feel free to let me know."
681371296,Modding new enemies,KABoissonneault,2021-07-01 02:00:45+00:00,2021-07-18 05:49:57+00:00,{},"This is the main part of my efforts to let mods add new enemies to DFU, as discussed here: https://forums.dfworkshop.net/viewtopic.php?f=23&t=4915

This is actually a draft PR, more for raising discussion to see if the solution is appropriate for this point in development.

What this PR does:
- SetupEnemyDemo now recognizes enemy IDs beyond those defined in MobileTypes. For every group of 256 IDs, the first 128 will be EnemyMonster, and the last 128 will be EnemyClass (0-127 Monster, 128-255 Class, 256-383 Monster, 384-511 Class, etc...)
- DaggerfallEntity now has ""custom"" DFCareer templates, created from mods. This can be used to create new or replace enemy careers for a given enemy ID 
- EnemyEntity will now use that ""custom"" career template if available, when a DFCareer is needed
- When issued a non-standard enemy ID, TextManager will return the custom career name if available

What this allows:
- With IDs outside the classic values (ie: 0-42 and 128-146), Mod scripts can add new MobileEnemy to `EnemyBasics.Enemies`, and a new DFCareer to `DaggerfallEntity.CustomCareerTemplates`
- Those new enemies can be spawned in three ways: by a quest (through adding the enemy to Quests-Foes), by random encounter (ie: `RandomEncounters.EncounterTables`), and possibly through a Locations editor (not tested)
- With #2160, new enemies would be able to use entirely new graphics

The Mobile will function like a normal enemy, with all the moves normally available to them (nothing special like the seducer transformation, of course). Their name appears when using the Info cursor, and they can be assigned normal equipment through the ""OnLootSpawned"" event.

A reference implementation for what a mod adding a new enemy type would look like can be found here: https://github.com/KABoissonneault/DFU-NewSprites/blob/main/Scripts/NewSprites.cs

While there is certainly more that could be done to improve this system, I think it works well enough for a first iteration, and I don't think the current limitations prevent future extensions (ex: letting mods change the encounter formula entirely).

I consider this a draft because I'm not too satisfied with some of the technical decisions. After all, I tried to make the code changes minimal, rather than ideal. For example, to decide whether or not the mod wants an EnemyMonster or an EnemyClass, I went with the ID mapping solution, in a way that doesn't break the classic IDs while allowing for virtually infinite expansion. Also, for `CustomCareerTemplate`, it might not be the best solution, though it may be just sufficient.

In conclusion: IK, don't delay your release for this if you want to think about it, but please consider it before the code freeze. I do believe being able to mod new enemies is a basic mod support feature one would expect from a Daggerfall Unity 1.0 release."
681348373,Greatly reduce Lord Kavar spawns,JayH2971,2021-07-01 01:11:47+00:00,2021-07-12 03:26:43+00:00,{},"At current, there is no event more complained of than the Lord K'avar quest. This PR greatly reduces the spawn rate for Lord K'avar's soldiers."
681199268,Add frame speed divisor to abstract class,ajrb,2021-06-30 20:07:17+00:00,2021-07-12 03:25:25+00:00,"{'bug': 1, 'mod system': 1}","Otherwise mods adding custom mobile units get log spammed with null pointer exceptions. Not sure if this is the best correction but figured I'd take a stab at it.

Was broken by the fix for slow spells commit 47e2c588"
680436114,Modding new mobile textures,KABoissonneault,2021-06-30 00:03:41+00:00,2021-07-17 00:29:03+00:00,"{'enhancement': 1, 'mod system': 1}","As part of a greater effort to allow mods to add new enemies to DFU, this PR allows mods to add new ""mobile"" textures, and use them for MobileEnemy's MaleTexture/FemaleTexture.

On its own, the only use case I see would be for mods to give Class enemies distinct textures. For example, Mage and Healer both use 486/485, and one could be changed to use a new texture id beyond the 512 original Textures. It is my hope that eventually, this will be useful to add new MobileEnemy types too.

Here's an example
![image](https://user-images.githubusercontent.com/5789925/123882356-a4a85280-d914-11eb-83c1-c8b3c08cf3e7.png)

I'm not familiar with all the graphics features, but I tried to keep the emission textures working at least. Tell me if I'm forgetting something that's usually supported in mobile textures.

The extent of my testing is just adding a bunch of palette swaps of TEXTURE.486 as PNGs in the Textures folder of my test mod. Tell me if you have ideas for test cases I should consider."
678549898,Apply the fix for custom item image size to accessory items,ajrb,2021-06-27 17:06:19+00:00,2021-06-27 17:06:41+00:00,{},
678400758,"Add colliders to custom dungeon models added using ""COL"" in the World Data Editor I'm working on.",ajrb,2021-06-26 19:06:28+00:00,2021-07-12 03:21:00+00:00,"{'enhancement': 1, 'mod system': 1}",This will enable custom models for new dungeons to automatically have colliders applied by unity via DFU RDB layout code.
678347449,Layout building exterior flats,ajrb,2021-06-26 14:50:58+00:00,2021-06-26 14:51:36+00:00,{},"This allows wold data building overrides to have exterior flats without needing to override the entire RMB. In classic data there only appears to be editor flats define, but have filtered these out as they're not used by any DFU systems."
677989604,Fix exterior npc bug,ajrb,2021-06-25 15:12:24+00:00,2021-06-26 14:27:27+00:00,{'bug': 1},See http://forums.dfworkshop.net/viewtopic.php?f=5&t=4768
677473409,Use FLATS.CFG to set gender of exterior NPCs,df-ferital,2021-06-24 22:22:36+00:00,2021-06-26 14:53:16+00:00,{},"Fix a game data related bug by using FLATS.CFG information to set exterior NPCs gender (mostly, if not only, witches). The issue was reported by @Ralzar81 [on the forum](http://forums.dfworkshop.net/viewtopic.php?f=5&t=4914&sid=d6db9aca862954531d2f267f04f01ff0)."
676788941,Use generic IEnumerables for 'AddItems' methods,jefetienne,2021-06-24 04:55:50+00:00,2021-07-12 03:18:36+00:00,{},"Small change to prevent using a needless ""ToArray()"" method when using a non-array[] collection for the 'AddItems' methods. Parameter takes in an IEnumerable instead, which are the superclass of all collections, including regular arrays[], Lists, HashSets, etc. Checking for its length is no longer needed when using a foreach loop after confirming that the collection is not null."
676784822,Allow Advanced Controls UI components open to modding,jefetienne,2021-06-24 04:43:26+00:00,2021-06-26 14:53:50+00:00,{},
675707126,Layout building exterior flats for RMBs,ajrb,2021-06-22 19:36:35+00:00,2021-06-26 14:50:43+00:00,{},"This allows world data building overrides to have exterior flats without needing to override the entire RMB. In classic data there only appears to be editor flats define, but have filtered these out as they're not used by any DFU systems.

This should change nothing unless world data overrides are being used."
673594786,Fixed guards accidentally not being above the player level,KABoissonneault,2021-06-18 16:18:40+00:00,2021-06-20 19:51:05+00:00,{'bug': 1},"`careerIndex` is `18` for the City watch, but `MobileTypes.Knight_CityWatch` is `146`.

See https://github.com/Interkarma/daggerfall-unity/blob/master/Assets/Scripts/Game/Entities/EnemyEntity.cs#L186"
673016695,Pass face record id into mobile person asset,ajrb,2021-06-17 21:50:41+00:00,2021-07-06 21:26:46+00:00,"{'bug': 1, 'enhancement': 1, 'mod system': 1}","This allows mods to use the assigned face to change the look of the mobile to match.

@rossipaolo If you want I will add backwards compatibility, but I haven't because I'm pretty sure no one has released a mod yet that uses the MobilePersonAsset override so it would feel like adding cruft for no reason. 
(BTW Kamers villager mod VIO overrides the PopulationManager as far as I can see)"
670773798,Fix interaction mode icon display at low resolutions,ajrb,2021-06-15 21:48:03+00:00,2021-06-15 21:49:22+00:00,{},Also change settings default to classic icons
670699468,Colorblind accessibility settings,KABoissonneault,2021-06-15 19:50:03+00:00,2021-07-12 03:17:46+00:00,{'enhancement': 1},"A player mentioned that they had trouble seeing taverns and shops in the exterior automap, due to red-green color blindness. Nothing else in the game seems to cause any issues.

There's many kinds of color blindness, and various degrees of it, so I thought letting each person tweak colors to their preferences is best. DFU already has a color picker UI used in the Settings.

This PR adds a new Settings tab, and 4 new color settings used by the ExteriorAutomap.
![image](https://user-images.githubusercontent.com/5789925/122113575-4b0e3700-cdf0-11eb-8721-a71ed63e5035.png)

For example, changing the taverns to yellow and brightening the residences looks like this:
![image](https://user-images.githubusercontent.com/5789925/122114012-cd96f680-cdf0-11eb-9320-a3770b5fe631.png)

Note how the caption at the bottom is updated with the selected colors.

I checked with the colorblind user, and this was much better for them. I hope others will find this useful too.

Side note, but perhaps DFU could use a ""restore defaults"" button for the settings. Right now, the only way to restore them is to delete `settings.ini`."
669750095,AI pathfinding issues when getting shot at,KABoissonneault,2021-06-14 17:33:07+00:00,2021-07-09 02:06:10+00:00,{'bug': 1},"Fixed enemy AIs treating arrows and spell projectiles as obstacles, causing them to shortly initiate a detour every time they get shot at.

I started investigating as part of https://forums.dfworkshop.net/viewtopic.php?f=5&t=4890. As mentioned in the thread, I noticed that the CapsuleCast detects triggers, and therefore arrows were detected but not handled as ""not an obstacle"" in the EnemyMotor, so the AI treated them as an obstacle. Even if the CapsulaCast didn't detect triggers, spell projectiles are solid, and would be detected as an obstacle anyway.

Pango suggested I use the layer mask, as used for detecting a clear path for shooting. This worked well enough in my tests. 

Here's the save I used for testing. It's just a level 1 Archer at the start of Privateer's Hold.
[SAVE29.zip](https://github.com/Interkarma/daggerfall-unity/files/6650169/SAVE29.zip)

I go up the stairs, get to the bat and imp, wait for either of them to start chasing me, then run backward down the corridor I just came from while shooting (the imp was easier to test with since it doesn't die from Iron arrows).

Without the fix, the imp constantly moves left or right for a short time after every shot. 
With the fix, the imp only gets a slight knockback from the attack, but keeps moving in a straight line otherwise."
669672496,Match quest NPCs location scopes and genders to classic,df-ferital,2021-06-14 15:38:21+00:00,2021-07-09 01:57:19+00:00,{},"Quest NPCs location scope and gender information is available from QBN data, however it was not correctly understood until now. After having reverse engineered classic original function used to setup a quest NPC, I made a small program to extract the information from QBN data and patch DFU quests. This PR is the result of this patch, which also required to modify `Person.cs` in order to parse the new location scope information.

This should fix all quests reported by Tamalak in this post: http://forums.dfworkshop.net/viewtopic.php?p=52023&sid=9dce69880ec5c26f698316ab5c0a47d6#p52023

I also took this occasion to fix some incorrect quest variables names and to restore quest S0000988 to its original state, where several NPCs should be able to send a letter regarding Numidium. The DFQFIX patch which was integrated in DFU was intended for classic but DFU does not have the same engine issue, so the original quest should work.

Some other modifications I made:
50C00Y00: Set `_qgfriend_` to `female` even if the gender is random in classic, as it matches the description.
80C0XY00: Set `_qgfriend_` to `male` for the same reason.
B0B50Y11: Remove `_nobleman_` gender as there is no reason to use a specific gender to this NPC.

@rossipaolo This adds the ""remote"" and ""local"" attribute to a quest Person, so you may need to update your VS Code template when this PR gets merged.



"
668533915,Ensure the gold variant is distinguishable from clicked npc,ajrb,2021-06-11 20:27:47+00:00,2021-06-11 20:27:53+00:00,{},
668502215,Clear location cache if world data variant is set,ajrb,2021-06-11 19:46:24+00:00,2021-06-17 15:25:54+00:00,{},Also don't cache at all when running in unity editor in the same way the world data caching is disabled in editor. This allows mod developers to see their world data changes without needing to restart the game. The downside to this is to debug issues with the cache the directive needs to be modified.
663063010,"Fixed ""pc at any <location>"" guildhall issue",KABoissonneault,2021-06-06 22:27:45+00:00,2021-07-09 01:46:10+00:00,{'bug': 1},"Fixed an issue where locations ""magery"" and ""fighters"" are treated the same as ""guildhall"" in ""pc at any <location>"".

I forgot guild halls have a ""p3"" parameter."
662693162,Exposed more functions and data in the Talk window ,KABoissonneault,2021-06-06 01:25:57+00:00,2021-07-12 02:30:47+00:00,{},"The Talk window is inside the UI window factory, and therefore can technically be overriden by mods, but there's not really anything useful they can change.

Changes minimized compared to the version in PR #2137. "
662690110,"Added new ""PrioritizeQuestRumors"" experimental setting",KABoissonneault,2021-06-06 01:17:37+00:00,2021-07-09 11:14:28+00:00,{},"Attempt at redoing PR #2137 but with less changes.

I removed the Talk window changes (I'll make a separate PR), and I changed the variable names to minimize the line count of the changes."
662558941,Add mod script asset template,rossipaolo,2021-06-05 18:59:30+00:00,2021-06-05 22:57:54+00:00,"{'enhancement': 1, 'mod system': 1, 'editor': 1}","Adds menu item ""Create > C# Mod Script"" to quickly create new mod scripts.

![createModScript](https://user-images.githubusercontent.com/24359151/120902437-bca3f380-c640-11eb-83c3-30788d258fd2.jpg)
"
661755292,Quest rumor experimental setting and DaggerfallTalkWindow mod support,KABoissonneault,2021-06-04 13:08:55+00:00,2021-06-05 22:44:00+00:00,{},"In light of issue #2136, I suggest two changes that would be more appropriate for this stage of development.

1) An experimental setting which makes quest rumors appear at least once (even if just one variant) before falling back to the normal rumor mill
2) Mod support for the DaggerfallTalkWindow

For the setting, there should be no changes when the setting is left to false. When enabled, new quest rumors are added to a separate ""quest rumor list"". When asking for ""Any News?"", if the ""quest rumor list"" is not empty, it grabs one (at random), removes it from the ""quest rumor list"", and shows that one. Note that quest rumors still exist in the normal rumor mill, and may appear again after the quest rumor list has been exhausted.

To be safe, I chose to only add quest rumors to that list when the setting is enabled, but to always try to remove them, even when the setting is off. Ideally, this list should never grow too large.

I believe just this setting might satisfy fans of quest rumors, and if not, well, it's just an experimental setting.

For the mod support, we're kind of fortunate that rumors have little to no impact on the rest of the gameplay. By changing the Talk window itself, mods can basically do whatever they want with all those topics and rumors. The TalkManager itself has no mod hooks, but the window doesn't really have to interact with it if it doesn't want to. 

My changes should only be two things: adding `protected` and `virtual` to existing code, and ""trivial refactors"" in order to make the code a bit cleaner. This not only helps future maintainers, but also, modders like copy-pasting the window code into their own window, so this should reduce noise for them.

I also changed the order of the Setup code a bit, and refactored it all into functions. Hopefully, this should reduce the amount of copy-paste derived windows need to do.

The DaggerfallTalkWindow changes might be easier to understand by reviewing individual changelists rather than the full review"
660403009,Preserve rumors line breaks on bulletin boards,petchema,2021-06-02 21:24:36+00:00,2021-06-05 22:55:27+00:00,{},"
Keep the line breaks from rumors for display on town bulletinboards; It's not guaranteed to be perfectly formatted, but is better than current concatenated text on one line. It's also most likely a step in the right direction for text adjustment to display width, since it preserves text as text tokens.

By the way I had a hard time testing to PR, I found few towns with rumors
![2021_06_02_11_22_50](https://user-images.githubusercontent.com/1211431/120554042-904a6600-c3f9-11eb-83e9-7148541f2e49.jpg)
![2021_06_02_10_34_13](https://user-images.githubusercontent.com/1211431/120554062-96404700-c3f9-11eb-8f6d-6a7578bf2647.jpg)

"
658194676,Allow water tile conversion to be handled by terrain texture mods,ajrb,2021-05-31 10:15:55+00:00,2021-05-31 10:28:04+00:00,{},"This does change the interface, but almost all implementation extend from the default and will inherit the new method. I will assist any that I've missed."
657769098,Add formula for bank loans,ajrb,2021-05-30 18:16:06+00:00,2021-06-03 20:24:13+00:00,{},Also exposes some for overriding that were not before.
651565589,Fix automap update not triggering on some occasions,df-ferital,2021-05-24 19:19:36+00:00,2021-05-29 00:16:26+00:00,{},"Fix a regression introduced in #2100 and fix a historical issue that could happen when fast travelling to a location with the same name as the current one (for example, from Ashford Manor, Anticlere to Ashford Manor, Dwynnen)."
650862125,Add a runtime method to fix invalid RDB blocks,df-ferital,2021-05-23 21:45:05+00:00,2021-05-30 23:19:35+00:00,{},"This fixes the following blocks:
N0000071.RDB: connect the lower western dead-end to the rest of the block, can be checked in Ruins of Kinghouse Grange, Glenpoint
W0000009.RDB: move the exit to another corner (classic applies another but less clean trick), can be checked in The Tower of Hearthhouse, Wrothgarian Mountains
W0000018.RDB: connect the upper rooms together and fix a wrong door model, can be checked in the The Roost of Grumerus, Wayrest
W0000020.RDB: connect the lower western dead-end to the rest of the block, can also be checked in The Roost of Grumerus, Wayrest

Supersedes #2125 and #2126"
650570661,Stack identical books together,petchema,2021-05-22 05:43:13+00:00,2021-05-29 00:14:54+00:00,{'enhancement': 1},"If you ever tried to collect all existing books, you probably know the pain of checking manually if you already have one book.
Having identical books stack together makes that easier.
"
650475878,Fixed ArgumentOutOfRangeException on loading game with new dungeon models,XJDHDR,2021-05-21 22:24:32+00:00,2021-05-29 00:15:44+00:00,{},"I have noticed that if you load a save that was made inside a dungeon after installing a modified dungeon block override that adds new models, you can get an `ArgumentOutOfRangeException` if the dungeon you are in uses any of those overrides. This exception also causes other issues. The most serious I've noticed is that if you try to load the same save again after getting that exception, another exception is triggered and the game loads to a black screen.

I believe that the cause of this is that after creating the dungeon's automap models, the game iterates through each model in the block's automap and checks it's status against the save game's `AutomapData.txt`. The problem is that if the block has had new models added to it, the game will try to load an entry in the TXT file that doesn't exist, triggering the exception.

You can reproduce this issue with the files I have attached. The W0000018.RDB.json adds a new corridor model to the dungeon and the attached save was made before this model was added. 


[Save.zip](https://github.com/Interkarma/daggerfall-unity/files/6525313/Save.zip)
[W0000018.RDB.zip](https://github.com/Interkarma/daggerfall-unity/files/6525315/W0000018.RDB.zip)

"
650469070,Connect N0000055.RDB disconnected parts,df-ferital,2021-05-21 22:18:16+00:00,2021-05-23 21:48:22+00:00,{},"Fix potential combination issues with this block, for example in Ruins of Kinghouse Grange, Glenpoint, as reported by @petchema 
: http://forums.dfworkshop.net/viewtopic.php?p=52821&sid=5a152a9109cc38760fd7b4ecb2b34853#p52821

I also moved a random monster to another corner.

Before the fix:
![n0000055-before](https://user-images.githubusercontent.com/46795115/119203271-f39bd600-ba92-11eb-8c34-ba274d0429e8.png)

After:
![n0000055-after](https://user-images.githubusercontent.com/46795115/119203282-f7c7f380-ba92-11eb-8bd7-fac59d3c1997.png)
"
649475008,Reposition W0000009.RDB exit,df-ferital,2021-05-20 21:13:33+00:00,2021-05-23 21:46:02+00:00,{},"Fix the exit by replacing a nearby corridor corner with one having an exit and moving the dungeon exit quad there. This is better than the dirty hack done by classic in my opinion. I also added a brick wall in case the block is not the starting block, which is what is done in similare cases like with W00000012.RDB.

Before the fix:
![w0000009-before](https://user-images.githubusercontent.com/46795115/119049464-df87a400-b9c0-11eb-8ed8-97601921f8d3.png)

After the fix:
![w0000009-after](https://user-images.githubusercontent.com/46795115/119049489-e6aeb200-b9c0-11eb-9e5d-dbeaaa7358eb.png)

The following dungeons use this block as a starting block and can be verified:
The Troglobith Web, Alik'r Desert
Ruins of The Citadel of Char, Dragontail Mountains
Ruins of The Slajrn Farmstead, Dragontail Mountains
Ruins of Tower Moorhouse, Dwynnen
Ruins of Old Lysyna's Farm, Dwynnen
Ruins of Castle Churg, Dak'fron
The Tower of Hearthhouse, Wrothgarian Mountains
Ruins of Greenhart Hall, Wrothgarian Mountains
The Andard Quarry, Wrothgarian Mountains
The Tower of Hearthhart, Wrothgarian Mountains
Ruins of The Old Wickham Shack, Wrothgarian Mountains
Tower Hearthton, Wrothgarian Mountains
The Tower of Mordyctor, Glenpoint
The Citadel of Wicksley, Glenpoint
The Laboratory of Gondastyr, Anticlere
Balex Hollow, Anticlere
The Abbey of Asmeusunah, Anticlere
Darkenaus Hall, Anticlere
The Hold of Gav'kern, Lainlyn
Castle Kingcroft, Orsinium Area
Ruins of Old Barbara's Hovel, Orsinium Area
Ruins of Yeomsley Court, Northmoor
The Web of Anirugoth, Northmoor
Morgyna Cultus, Northmoor
The Tower of Ashham, Alcaire
Ruins of Hawkston Hall, Kambria
The Hold of Woodfield, Kambria
The Citadel of Ashston, Phrygias
The Citadel of Woodfield, Urvaius
Ruins of Old Elyzanna's Place, Ykalon
The Stronghold of Hearthcroft, Ykalon
Hawkfield's Guard, Ykalon
The Laboratory of Tristywyr, Ykalon
Castle Garomyth, Abibon-Gora
Castle M'arhtem, Tigonus
The Tower of Nhorc, Totambu
Ruins of Castle Stullten, Totambu
Castle Shrertke, Totambu
The Citadel of T'irge, Totambu
The Stronghold of Sarg, Totambu
The Stronghold of Nesh, Ephesus
Castle Rauzun, Ephesus"
648303302,U0C00Y00 Fix,JayH2971,2021-05-20 01:33:22+00:00,2021-05-29 00:02:28+00:00,{},"Excuse the gloom.

Fixes #2099. I couldn't figure out how to make a short and long timer, so I just set one to start after the other. Could be better but it's functional. Quest works from covens. Removes text box 1013 since it tries to reference Beothiah but that isn't possible in DF or DFU. Tidies text box 1014. "
647998570,fix warning on trade window,ajrb,2021-05-19 19:55:52+00:00,2021-05-19 20:02:36+00:00,{},
647959628,Add new promptmulti action for 2-4 button message boxes in quests,ajrb,2021-05-19 19:01:24+00:00,2021-05-24 15:11:19+00:00,{},
647940922,Added a TextAssetReader Merge for SPELLS.STD spell records,KABoissonneault,2021-05-19 18:35:55+00:00,2021-07-09 00:39:29+00:00,{},"Summary:
- Added a TextAssetReader Merge for SPELLS.STD spell records through a ""SpellRecords.json"" file, similar to ""ItemTemplates.json"". 
- Ensured the DaggerfallSpellBookWindow uses the modded standard spells rather than reading SPELLS.STD directly.

So, as part of my magic modding, I started feeling the need to replace the ""classic"" (aka circinate) spells. Those spells are sold by spell vendors, and are part of potions and enchanted items. As one starts tweaking spell costs for spell effects, they suddenly find the need to tweak those spell bundles too.

I looked into the existing work, and I found only the ""custom bundle"" in EntityEffectBroker. However, this can only add new spells, and the work seems incomplete (ex: see TODO in CastWhenUsed.EnchantmentPayloadCallback).

I thought the TextAssetReader Merge used for ItemTemplates was simple enough and essentially only requires 1 line of code to work.

However, there's some points to consider:
- Changing the `effects` field is an all-or-nothing kind of deal. You can't just change the `magnitudeBaseLow` of one effect, you have to copy-paste the entire array of effects with all its relevant fields. However, few spells have more than one effect, so it's not that much of a problem for most spells
- EffectRecordData fields that aren't specified in the JSON are going to default to 0, rather than 1 or -1 as expected for certain fields. I had to go and ensure modders wouldn't accidentally cause issues in the code by leaving a field as 0. `descriptionTextIndex` and `spellMakerTextIndex` are unused, so not an issue, The effect attributes (duration, chance, magnitude) can be at 0 just fine, except I ensured the ""per level"" value sent to EffectSettings was at least 1 to avoid divisions by 0. The only one that concerns me is `subType` for effect types that don't have variants: for the most part, 0 should have the same effect as -1, but I hope I'm not forgetting anything
- Changing the length of `effects` from 3 to 1 or 2 does not cause any issues from my testing, as all places that use the effects of SpellRecordData use `spellRecordData.effects.Length` rather than assuming a size of 3.
- This approach ""accidentally"" lets users create new spells, by using an unused index. I'm only pointing this out because there's already a system to add new spells, the ""custom bundle"" I mentioned above. Spells created this way properly appear in the spell vendor, and don't appear in the item maker.
- A mod that changes a spell won't change a spell already written in the player's Spellbook. I'm not sure it's possible to fix this, since spellbook entries don't track the spell record they were created from, I believe?

Anyway, I believe letting mods tweak classic spells this way will be useful in general. For example, many players find poisons way too strong, and this change would allow a modder to change its effects.
"
646182930,"Added ""weather"", ""season"", and ""climate"" quest trigger conditions",KABoissonneault,2021-05-17 21:03:54+00:00,2021-05-24 15:13:13+00:00,{},"Added ""weather"", ""season"", and ""climate"" quest trigger conditions, and ""train pc"" quest action.

I was originally going to keep this as a mod since I made them for a modder, but after he shared his results, other people said they wanted those quest actions too, so might as well share it here.

The syntaxes are:
- weather sunny|cloudy|overcast|fog|rain|thunder|snow
- season fall|summer|spring|winter
- climate desert|desert2|mountain|mountainwoods|rainforest|ocean|swamp|subtropical|woodlands|hauntedwoodlands
- climate base desert|mountain|temperate|swamp
- train pc <skillName>

Note: ""train pc"" uses the same formula as the default training window, except it's free. It works like quest rewards, and therefore works after ending the quest (with the quest end message).

@rossipaolo Are you the one maintaining the VS Code plugin for quests? You might want to keep an eye on this "
645839166,Use classic hack to fix Orsinium overlapping blocks,df-ferital,2021-05-17 12:54:49+00:00,2021-05-30 23:15:17+00:00,{},"Instead of discarding one block as DFU does, classic simply moves one of the block south of the other."
645388653,Immediately interrupt resting if you die (RFC),petchema,2021-05-16 22:09:38+00:00,2021-05-28 23:51:28+00:00,{},"Currently if you die while resting (from disease or poisoning), game plays death moan but waits until you're fully rested before going on with the death video (which can take a while because healing has to overcome disease or poison effect).

With this change game immediately interrupts resting with ""You never awaken."" message. I would also be okay if no message was displayed (given it's not in classic), but currently preventedRestMessage = null and preventedRestMessage = """" show inappropriate messages instead.
"
645381019,Add OnItemHover to inventory window for mods,ajrb,2021-05-16 21:08:41+00:00,2021-05-24 15:10:30+00:00,{},"Includes an event for when the persistent windows have been instantiated so mods can easily register to listen to the UI window event. It's possible other events for other persistent windows would be useful, and the same technique can be used for them. However I am not going to try to divine what they are.

Using this from a mod looks like this:

```
DaggerfallUI.Instance.OnInstantiatePersistentWindowInstances += OnInstantiatePersistentWindowInstances_TestItemHover;

static void OnInstantiatePersistentWindowInstances_TestItemHover()
{
    DaggerfallUI.Instance.InventoryWindow.OnItemHover += TestItemHover;
}

static void TestItemHover(DaggerfallUnityItem item, DaggerfallInventoryWindow.ItemHoverLocation loc)
{
    Debug.LogFormat(""Hovered {0}  uid:(1)"", item.ItemName, item.UID);
}
```"
645287466,Prevent levitating and swimming diagonally from being 40% faster,petchema,2021-05-16 09:15:26+00:00,2021-05-28 23:34:03+00:00,{'bug': 1},"Also fix forward taking priority over backward, and right taking priority over left when pressing both controls simultaneously"
645127144,Open up spell book for mods,ajrb,2021-05-15 11:30:33+00:00,2021-05-17 19:29:12+00:00,{},As requested by forum user Macadaynu
645050725,Don't reset lastSpell when using magic missile items,petchema,2021-05-15 00:31:53+00:00,2021-05-20 00:15:42+00:00,{'bug': 1},For for issue #2111
645001980,Fix typo in DFU macro %pg1,ajrb,2021-05-14 21:41:46+00:00,2021-05-17 19:31:25+00:00,{'bug': 1},"It should have been this way when I committed it in 2017. Is now the same as pg3 since the hers plural was removed. Leaving both methods in, but added comment to make it clear they now function the same."
644393248,Added new time-related text macros,KABoissonneault,2021-05-14 02:16:23+00:00,2021-05-24 15:21:22+00:00,{},"- %day: Current day of the month as number
- %dayn: Name of the day of the week, in TES terminology (ex: Morndas)
- %days: Current day of the month as number, with suffix (ex: 1rst, 2nd, ..., 30th)
- %mon: Month as number
- %monn: Month as name, in TES terminology (ex: Hearthfire)
- %year: Year as number (ex: 405, not 3E405)
- %min: Current minute on the clock
- %hour: Current hour on the clock (24 hour mode)
- %sign: Sign of the current month. These aren't lore in TES2, but they're a staple of the series right after that, and it was already in the code...
- %sea: Current season name

Fixed an issue which prevented sequences of characters like ""%day/%mon/%year"" from properly expanding as 3 separate macros.

Before fix:
![image](https://user-images.githubusercontent.com/5789925/118210612-adae9480-b438-11eb-9806-f93fdfe1d72c.png)

After fix:
![image](https://user-images.githubusercontent.com/5789925/118210637-b606cf80-b438-11eb-9e1b-02b49bbc9688.png)

These macros were requested by a quest modder. I think they would be useful for many people"
643592119,Expose the SpellMaker and its subwindows to mods,KABoissonneault,2021-05-13 00:37:07+00:00,2021-05-24 15:21:02+00:00,{'UI': 1},"Sparkled some ""protected"" and ""virtual"" all over.

Added SpellEffectEditor and SpellIconPicker to UIWindowFactory."
637595689,"Added ""resistance"" formula overrides. ",KABoissonneault,2021-05-10 13:10:23+00:00,2021-05-29 00:21:47+00:00,{},"Added formula overrides for the following formulas:
- InflictPoison
- InflictDisease
- SavingThrow

Also fixed OnMonsterHit formula not returning after invoking the formula override.
For ""formulas"" that don't return a value, it's better to use Action than have a Func with an unused return value."
635966553,Reset ship ownership on new game start,ajrb,2021-05-09 15:11:26+00:00,2021-05-15 09:26:58+00:00,{'bug': 1},
635741781,Enable player torch shadows based on spell shadows setting,ajrb,2021-05-09 11:27:17+00:00,2021-05-24 12:57:49+00:00,{},Partially fixes issue #2052 
634572045,Re-fix riding sprint in mods,ajrb,2021-05-08 15:25:47+00:00,2021-05-17 19:30:45+00:00,{'bug': 1},"The previous fix (PR #1987) was removed in commit https://github.com/Interkarma/daggerfall-unity/commit/721522c0d032b8d23c510f38867fb6bb82694e6b from PR #2084 

@l3lessed: Unless there's a good reason not to I'd like to put my fix back so the galloping in my mod continues to work."
634549908,Refactor guild service window,ajrb,2021-05-08 15:03:43+00:00,2021-05-17 19:28:26+00:00,"{'mod system': 1, 'UI': 1}","Extract service UI implementations for: Training, CureDisease, and Donation.

This is to improve flexibility for modding."
633393026,Remove ModifyFoundLootItems formula,ajrb,2021-05-07 20:28:20+00:00,2021-06-15 17:19:11+00:00,{},"Formula is redundant now there are EnemyEntity and LootTables OnLootSpawned events, and it was never really a formula anyway.

Follows up PR #2087 "
632081700,"Added the ability for mods to specify an item type as ""noRepairs""",KABoissonneault,2021-05-07 00:15:45+00:00,2021-05-28 23:26:06+00:00,{},"As discussed in this thread: https://forums.dfworkshop.net/viewtopic.php?f=23&t=4794

Comment from IK:
>I'd like this to be done in a way that doesn't break if a mod adding these properties is removed later and the item remains

I tested my solution, and if the mod is removed, the item reverts to the default value (false). This means that if a mod makes ingredients noRepairs, when it is removed, those ingredients go back to the default behavior of allowing repairs (if damaged).

I added a new string, so that users aren't told their noRepairs damaged item ""does not need repairs""."
631455748,Cache RMB blocks,df-ferital,2021-05-06 13:45:50+00:00,2021-05-23 22:21:06+00:00,{},"While working on new PRs, I noticed again that `RMBLayout.GetLocationBuildingData` takes a long time for big cities when a replacement mod such as _Taverns Redone_ is used (around 1.5s for Daggerfall city on my computer, using a stopwatch). Furthermore, the method is called at least three times when loading a savegame. The more problematic issue is that it is also called in several places like when opening the talking window or selecting a random place for a quest.

Some time ago, I made a first attempt at fixing this issue in PR #1541, however, it was not satisfactory and since I didn't have time to work on it anymore, I closed it.

For this new attempt, I decided to cache RMB blocks as a static field in RMBLayout itself, with a size of 12 locations at most. This works quite well, reduces loading and travelling times a little bit and, most importantly, allow the dialogue window to be displayed almost immediately.

I also took the opportunity to use some very useful new features from C# 7.2 such as `in` and `ref readonly` in a few places, where big structures such as `DFBlock` or `DFLocation` are used."
626818281,Modding the character sheet's Skills dialog,KABoissonneault,2021-04-30 02:21:09+00:00,2021-05-21 00:11:24+00:00,"{'mod system': 1, 'UI': 1}","Mods may add new benefits to skills. For example, my [Skilled Spells](https://www.nexusmods.com/daggerfallunity/mods/186) mod bases the caster level for a magical effect on the skill associated with the effect.

This is currently hard to communicate to the player, without telling them to just enter console commands. 

I found that having a mod replacing the entire character sheet window just to change the skills dialog was too prone to conflicts, so I took another approach.

The skill summary code in DaggerfallCharacterSheetWindow.cs was simplified - without changing how it looks - and moved to TextProvider, in a new GetSkillSummary method. The text provider only has to handle the ""starting position"" for the tokens due to the Misc skills window's two columns. Otherwise, it can show whatever it wants.

Here's an example of a mod overriding the skill summary string with these changes: https://github.com/KABoissonneault/DFU-SkilledSpells/blob/feat/skill-summary-level/Scripts/SkillsSpellsTextProvider.cs

Which results in
![image](https://user-images.githubusercontent.com/5789925/116640517-cbf49a80-a938-11eb-8a30-65e902ebb14b.png)

Again, without any mods, the appearance does not change from the existing implementation.

As a bonus, while dealing with mods that replace text providers, I found having a ""fallback"" text provider base implementation useful for ensuring no conflicts between mods, and avoiding redundant work. I thought it would be better to provide this class in DFU itself, so all mods can use this approach. See the comments in the code itself, and consult the reference implementation linked above."
625622347,Resynchronize vital indicators after toggling large HUD,petchema,2021-04-28 21:51:59+00:00,2021-04-30 01:07:22+00:00,{'bug': 1},"Fix for issue #2096

Vital indicators logic is already split in two parts:
- update methods deal with the inertia/convergence usual behavior;
- events can force an immediate adjustment of indicators to current value

This PR add an event triggered right after the large HUD is toggled, and then subscribe to that event to force an immediate update of the indicators."
625581461,Fix: Show biography skill bonuses during character creation,KABoissonneault,2021-04-28 20:46:35+00:00,2021-05-21 00:07:59+00:00,{},"I noticed the original TES2 shows the Biography skill bonuses during the ""Add Bonus Skills"" and ""Summary"" phase of character creation. The bonuses themselves are bugged in TES2, but the ones you see during creation are the ones you get when you start the game.

So, I did this for consistency"
624926504,Quest and enchanted items exclusions,petchema,2021-04-28 07:26:05+00:00,2021-05-19 23:07:41+00:00,{'wip': 1},"Sometimes quest items and enchanted items deserve to not be used as standard items:
- (subreddit below) arrow quest item should not be picked as missile;
- enchanted ingredients should not be used to mix potions (regression in my refactoring of potion maker);
- I assume quest spell books could exist, and should be given a normal one as needed;
- I assume quest lanterns could exist, and should be excluded;
- I assume no quest or enchanted wagon/horse, sounds silly;
- I didn't consider quest or enchanted currency either. Currencies are hard enough (and a bit of a mess already), and also currencies are a good example of commodity so I don't think quest or enchanted money would make a great feature.

I also considered using a predicate parameter instead of flags to filter the result of GetItem() search, it'd be more general but it's also a matter of taste.

There may be other places where quest and enchanted items could benefit from exclusions, so I consider this a RFC for the moment.

Subreddit:
https://www.reddit.com/r/daggerfallunity/comments/n07718/til_that_if_your_quest_item_is_an_arrow_using/"
622631297,Add Large HUD offset logic to FPSSpellCasting like in FPSWeapon,jefetienne,2021-04-24 18:47:23+00:00,2021-04-27 22:49:50+00:00,{},"I received a [comment ](https://forums.dfworkshop.net/viewtopic.php?p=53906#p53906)on my Readied Spellcasting Hands mod to fix the offset for the Large HUD. When I went to investigate, I found out that the FPSSpellCasting class does not have the offset fix, either. While it seems unnoticeable because of how fast the animation is, it would probably be noticed if someone was using my mod with the fix but not DFU. The readied hands would be offset properly, but then the casting animation would suddenly move them downwards.

This PR resolves that issue by adding the offset logic like in FPSWeapon. It also will be affected by the ""LargeHUDUndockedOffsetWeapon"" option in the settings.ini, which I think is okay since hands and weapons are viewed in a similar vein."
622608436,Fix Castle Wayrest backroom door messages not showing up (issue #1974),petchema,2021-04-24 16:10:04+00:00,2021-04-27 22:44:28+00:00,{},"Some doors in Castle Wayrest do not show their ""warning"" messages on first click because their actions are flagged MultiTrigger and only Door and Direct flags were handled in DaggerfallActionDoor.Open().

However, I noticed that some MultiTrigger doors (like the large double doors of Castle Wayrest, no need to search very far) are flagged as having some DoorText yet have no text to display, so if I just add MultiTrigger to the handled cases, those doors suddenly require 2 clicks to open.
So, I also added an action.Index > 0 check to try to make sure the DoorText flag is legit (I assume there's no text with index TYPE_11_TEXT_INDEX aka 8600?)

Fixes issue #1974 "
622258428,Add %mn and %fn macros support to TalkManagerMCP,df-ferital,2021-04-23 18:39:51+00:00,2021-04-27 23:33:54+00:00,{},"This PR fixes this:

![bad_%fn_expansion](https://user-images.githubusercontent.com/46795115/115914441-3b1e4a80-a472-11eb-8e1d-b8101385e402.jpg)

The %mn macro is not used in conversations but I added it for the sake of consistency. Note that the random seed for an NPC is not fixed for now so what I do in `MaleName` to differentiate the male name random seed from the female name one is uselesss until PR #2085 is merged.

"
620557571,Added two event handlers for loot spawning,KABoissonneault,2021-04-21 21:06:40+00:00,2021-04-27 23:35:16+00:00,{},"There's currently many ways to modify what loot is found in enemy loot piles, and the loot piles found in dungeons and interiors.

When mods register custom items in a given category, it can replace the default loot of that category. 
Mods can replace the default loot tables found in LootTables.
Mods can use the ""ModifyFoundLootItems"" formula, now fixed for 0.11.3
Mods can also register to the EnemyDeath.OnEnemyDeath event handler and modify the entity's items just before it creates the loot pile.

For some situations, all these solutions have issues.

First, the loot tables in LootTables and the ""ModifyFoundLootItems"" formula can only be changed by one mod. If multiple mods take this approach, they will conflict.
Second, registering items in a category used by loot tables does not work if you want to add a new kind of drop entirely. For example, a hunting mod might want to add meat on beast enemies. 

For the EnemyDeath approach, it just doesn't feel right. You need to do a lot of work to access the data you need (ex: [Climate&Calories](https://github.com/Ralzar81/Climates-Calories/blob/034ca75f4a9ef9d2ebf23ff25d01d8aa6e4af1bc/Climates%20%26%20Calories/Hunting.cs#L41)). Also, unlike the rest of the loot, this is generated only when the enemy dies, and won't remain consistent if the player reloads the game and kills the same enemy.

This PR therefore adds two new event handlers for enemy loot piles and ""location"" piles, each with all the information a mod could need, and called as soon as loot is generated. Event handlers can be registered by multiple mods without issues.

I have an example of how this would be used [here](https://github.com/KABoissonneault/DFU-Mod_Repair-Tools/blob/feat/leveled-repairs/Scripts/RepairTools.cs#L222)."
618722772,Change NPC knowledge in Talk Manager to match classic,df-ferital,2021-04-19 23:40:53+00:00,2021-04-27 23:31:17+00:00,{},"Change made after having reverse engineered classic Daggerfall function used to check if an NPC is able to answer a question or not. NPCs will now use an array of modifiers corresponding to their social class and to the kind of question they are asked in order to get the roll to beat to check if they are able to answer or not.

This change also makes NPC keep their previous knowledge after closing the chat window, as in classic."
618385175,SpeedChanger Updates,l3lessed,2021-04-19 19:24:35+00:00,2021-04-30 01:00:23+00:00,{},"Developers can now hook into and update player walk and run speed using the player speed changer. This is done by sequentially adding the change values to a dictionary and tying them to a UID out string property. The developer stores the UID out so they can remove/manipulate their speed changes at a later time in code execution.

**Currently we have these public properties:**

- Bool walkSpeedOverride: turns on and off using walk modifier list to change player movement speed. Does not clear list, merely ignores it.
- Bool runSpeedOverride: turns on and off using run modifier list to change player movement speed. Does not clear list, merely ignores it.
- Bool updateWalkSpeed: turn true to recompute the walk speed; will flip false once done on next frame.
- Bool updateRunSpeed: turn true to recompute the run speed; will flip false once done on next frame.

**Currently we have these public routines:**

- Bool AddWalkSpeedMod(out string UID, float walkSpeedModifier = 0, bool refreshWalkSpeed = true): Add a percentage multiplier to the walk speed modifier list. Returns true if the unique ID is output as an out string value to refer to/manipulate modifier. Returns false if it couldn't add it.
- Bool AddRunSpeedMod(out string UID, float speedModifier = 0, bool refreshRunSpeed = true): Add a percentage multiplier to the runspeed modifier list. Returns true if the unique ID is output as an out string value to refer to/manipulate modifier. Returns false if it couldn't add it.
- Bool RemoveSpeedMod(string UID, bool removeRunSpeed = false, bool refresSpeed = true): Remove a speed modifier using previously generated unique ID string value. Allows you to select if your removing running or walking speed modifiers. Returns true or false based on if modifier was removed or not.
- Bool ResetSpeed(bool walkSpeedReset = true, bool runSpeedReset = true): Remove a speed modifier using previously generated unique ID string value. Allows you to select if your removing running or walking speed modifiers. Returns true or false based on if modifier was removed or not.
- Float RefreshWalkSpeed(): Updates the players walk speed using for loop and dictionary values to ensure proper sequential processing to get proper end speed and returns updated walk speed value. Processing of modifiers is processed by their addition order. First added by modder is multiplied first, and so on.
- Float RefreshRunSpeed(): Updates the players run speed using for loop and dictionary values to ensure proper sequential processing to get proper end speed and returns updated run speed value. Processing of modifiers is processed by their addition order. First added by modder is multiplied first, and so on.

**Current console command settings are. These apply the same to set_walkspeed console command:**

- Set_runspeed -1: Enable/Disable run speed sequential modifier. Does not clear modifier list, just ignores it and returns base run speed. Returns current run speed value based on if sequential modifier is enabled or not.
- Set_runspeed -2: Run speed modifiers cleared. Clears out current run speed modifier list. Returns run speed value after all modifers have been removed from modifier list.
- Set_runspeed #: Adds percentage multiplier to run speed modifier list for sequential calculation; tells user UID for added modifier so they can remove it without clearing list if they want. Users cannot insert negative numbers, other than -1 and -2. Returns run speed after addition of modifer value.
- Set_runspeed UID: Checks to see if dictionary modifier list contains UID modifer. If it does, will remove the added modifier. If not will return normal error message saying invalid input. Returns run speed after removal of modifier.
- Set_runspeed : Returns basic error and current updated run speed."
618291400,Update PlayerSpeedChanger,l3lessed,2021-04-19 18:20:18+00:00,2021-04-19 18:23:31+00:00,{},"- PlayerSpeedChanger: Added properties to add sequential speed modifiers for walk and run speed. These can be accessed and removed using the AddRunSpeed, AddWalkSpeed, RemoveSpeed properties. Individual speed modifications are stored using the output UID string for the Add properties.
- Console command updated to allow addition of speed modifications. Will output the custom UID string value into the console for player to reference when removing speed modification.
- Changed one line of code to reference the proper property for grabbing updated runspeed from PlayerSpeedChanger.
- Examples of how this works in actions can be found here: https://forums.dfworkshop.net/viewtopic.php?f=23&t=4633"
615558792,Do not draw TextBox defaultText if null,rossipaolo,2021-04-14 21:28:05+00:00,2021-04-15 01:44:21+00:00,{'UI': 1},
614784504,Fixed issues while parsing Deepfighter's BIOG files,KABoissonneault,2021-04-13 21:50:04+00:00,2021-04-15 01:50:41+00:00,{},"1) Some lines (mostly the ones with IT) use tabs instead of spaces to split token¬≠. This caused BiogFile.cs to fail parsing those lines, failing to give the character the intended item. BiogFile.cs now splits tokens with any whitespace
2) Almost all BIOG files had the same copy-pasted ""&"" line, which caused BiogFile.cs to throw an error on invalid command. Removed that line from all BIOG files, as this was likely not intended

Repro case:
1. Start DFU without any mods
2. Start New Game
3. Create a Warrior character, and answer ""Axe fighting"" to the first question. The rest can be answered randomly
4. Open Inventory

Expected:
In BIOG16T0.txt, ""Axe fighting"" to question 1 should give you IT 3 15 0, aka Iron War-axe

Actual result:
No axe in inventory

The error logs can be seen when creating the character from the Unity Editor"
613922584,Allow mods to add as well as modify loot items,ajrb,2021-04-12 20:17:01+00:00,2021-04-15 01:36:40+00:00,{},Unfortunately System.Func doesn't allow for passing by ref so returning the array allows new loot to be added by mods.
612873714,Fix regression in PR 2051,XJDHDR,2021-04-10 10:14:54+00:00,2021-04-15 01:32:49+00:00,{},"When I moved the InjectMeshAndMaterialProperties and UpdateMaterialsOfMeshRenderer functions into a separate script, the intention was for each of these scripts to do the same thing as the previous code. However, PR #2051 has a regression in it where this script is only added to vanilla models generated from Arch3D.bsa and is not applied to mod added models. This PR fixes this so that mod added models will now also receive the script and have the Automap shader and textures applied.

At the same time, I also removed some comments I accidentally left in RDBLayout in one of my other PRs. Unfortunately, Unity does not allow manipulating a Game Object's Transform from anything except the main thread."
608931272,"Added more ""protected"" and ""virtual"" in DaggerfallInventoryWindow",KABoissonneault,2021-04-05 12:43:37+00:00,2021-04-15 01:31:33+00:00,{},"- Every operation in Setup had ""protected"" access in case a derived class felt like overriding it entirely, except for SelectActionMode and the ""toggleClosedBinding"" part, which require private access. Added ""protected"" to SelectActionMode, and exposed the toggleClosedBinding operation as a protected method
- Added a virtual to ""UpdateItemInfoPanel(item)"" in case a derived window wants to change how an item's info is displayed without changing all the other functions
- Added a virtual to PaperDoll_OnMouseMove since the other ""OnMouseMove"" functions had it (I actually need this for my mod)"
604137727,Fix classic bug related to %ef macro,df-ferital,2021-03-30 17:32:16+00:00,2021-04-15 01:28:16+00:00,{},"After having reverse engineered DF classic function expanding the %ef macro, I decided to submit a patch which will change DFU behavior from classic. If this gets merged, all Hammerfell shops will use Redguard names instead of Breton ones. As an example,""Perynak's General Pawnshop"" in Sentinel would become ""Maevrn's General Pawnshop"".

The explanation, using the comment I put in fix:
```
In classic, the function expanding the %ef macro uses a global variable containing the current
region race. However, this variable is never updated when the character travels
and remains at 0. This explains why the Breton name bank is always used for shops.
This global variable is probably a leftover from Daggerfall early development as,
with the exception of %lp, which presents a similar issue and always returns
""High Rock"", all naming functions use a global array of 62 fixed race values, one for each region.
As with %lp, we choose to fix the original bug in DFU and use this array, meaning that
all shops in Hammerfell now use Redguard names.
```
"
601348325,Bugfix for PR 2053,XJDHDR,2021-03-26 06:40:40+00:00,2021-04-15 01:26:29+00:00,{},"This fixes a bug in PR #2053 where Runtime Materials only detected that it was being created for a dungeon's or castle's interior if attached to a Base Game Object and not if attached to anything else that is inside a dungeon, such as Action Doors. This meant that modded secret doors received the wrong textures. The script will now correctly detect a dungeon/castle interior creation if attached to other objects.

To test this PR, you can download my mod [Unofficial Block Location and Model fixes](https://www.nexusmods.com/daggerfallunity/mods/100?tab=files) then load the attached save game. Without this PR, the secret door in front of you will have the wrong texture. With this PR, the texture will be correct.
[Secret door test.zip](https://github.com/Interkarma/daggerfall-unity/files/6209795/Secret.door.test.zip)
"
601319685,ActionDoor: Add support for MeshCollider,XJDHDR,2021-03-26 05:38:17+00:00,2021-04-15 01:21:46+00:00,{},"This PR adds the option of using a MeshCollider to provide a door's collision instead of a BoxCollider. To do so, you have to disable the door's BoxCollider and add a MeshCollider.

This allows modders to design doors that are not box shaped yet have accurate collision. In fact, there are at least 2 such doors in the base game (specifically, 55007 and 55008)."
601097533,Change journal UI window permissions to allow overriding by mods,ajrb,2021-03-25 22:02:55+00:00,2021-04-15 01:16:01+00:00,{'mod system': 1},
597511374,I found a bug in the code that I had submitted as part of PR 2056.,AsesinoBlade,2021-03-21 15:50:30+00:00,2021-03-21 23:53:58+00:00,{},"I found an issue in the code that I had submitted in PR # 2056.

In DaggerfallUI, I check for uiManager.TopWindow.FocusControl not to be null but I just hit a situation where uiManager.TopWindow was null so this failed on nullException.
I added a check for TopWindow as well now to correct that issue.
Sorry for this, the issue.

Thanks 
A"
596136345,Added the ability for mods to add new Biography templates,KABoissonneault,2021-03-19 02:40:18+00:00,2021-04-15 01:13:31+00:00,{},"I felt like investigating the biography and History system in Daggerfall, and noticed that it wouldn't be too hard for DFU to give mods the ability to introduce alternative biographies for character.

With these changes, after choosing a class (ex: Mage aka 0), the game looks for all files that match BIOG00T([0-9]+).txt in the BIOG source folder. If multiple files are found, one is selected at random (note: could be extended later to offer a list to choose from).

In addition, an extension was added to the BIOG file format. Before the first question, if a line starts with #, the rest of the line will be interpreted as a string id, and will be used for the backstory. With a custom ITextProvider, mods can make use of unused string values to provide new backstory text.

For example, if a mod adds a BIOG00T1.txt file, when a player creates a Mage (or similar custom class), the game will randomly pick between BIOG00T0 and BIOG00T1, with possibility for a new set of questions and/or a different backstory.

I've asked around, and it seems like it would be a popular feature.
"
595906054,Fixed some editor warnings,XJDHDR,2021-03-18 20:20:38+00:00,2021-03-21 06:00:58+00:00,{},"This fixes three of the warnings that appear in the editor every time scripts are re-compiled by:

- Adding ""new"" keyword to ViewportChanger's Camera variable.
- Deleting line in DaggerfallTerrain that sets materialType as materialTemplate is now set directly.

The warnings related to WWW being obsolete are still present because, [as I discovered](https://forums.dfworkshop.net/viewtopic.php?p=52520#p52520), UnityWebRequest is not a straight drop-in replacement for DFU's current code."
594058779,Fixed %hpw being inconsistent with DF classic for Dunmer characters.,KABoissonneault,2021-03-16 16:24:43+00:00,2021-03-21 23:58:47+00:00,{},"Verified with:
1. Launch the original Daggerfall game
2. Create a new character
3. Make a Dark Elf Healer
4. Proceed to gameplay
5. Enter Character Sheet (F5), click History
6. Proceed to background history
7. See ""_Your father was the healer for a very small village deep in the mountains of Morrowind._""

DFU currently says ""rolling hills of Morrowind"".

All the other races have been verified and were already correct."
592404058,RuntimeMaterials: Ignore ApplyClimate if using dungeon table,rossipaolo,2021-03-13 18:18:54+00:00,2021-03-16 22:21:41+00:00,{},
590457801,"Prevent detecting accidental axis button ""presses"" from movement and camera axes",jefetienne,2021-03-11 03:45:12+00:00,2021-03-21 08:01:23+00:00,{},"If the player accidentally moves their movement or camera axis in a cutscene sequence, it will recognize it as a button press in the direction it went and skip the video, since it was looking for ""any key down"". Similarly, a player might accidentally bind either axis while the control window is waiting for a key press (especially when trying to bind the controller buttons commonly known as L3 and R3, where you press down on the joysticks.) Those axis buttons are not needed for any practical reason since they are already in use for moving the character and camera.

These changes will simply ignore those detected axis buttons if they are a part of the movement or camera axes. I also added two new boolean property getters `AnyKey(Down/Up)IgnoreAxisBinds` and four new public `KeyCode` methods to return the specific key of the `AnyKey` methods. Some of these might be unused in the codebase, but they can be helpful for modding."
586311837,Only interact with large HUD when cursor active on Linux,petchema,2021-03-07 19:28:21+00:00,2021-03-20 00:28:05+00:00,"{'bug': 1, 'linux': 1, 'UI': 1}","Doesn't prevent mouse cursor from moving while cursor is disabled though

Forums: https://forums.dfworkshop.net/viewtopic.php?f=31&t=4630"
586060447,Toggle large HUD with F10 like classic,petchema,2021-03-06 13:09:36+00:00,2021-03-21 08:02:35+00:00,"{'enhancement': 1, 'UI': 1}","
Minimum implementation.

By the way, while implementing this, I noticed what looks like an unrelated bug: https://forums.dfworkshop.net/viewtopic.php?f=5&t=4630"
585985975,Fixed spells with multiple effects ending too early,KABoissonneault,2021-03-06 03:00:01+00:00,2021-04-15 01:06:05+00:00,{},"If a spell has multiple effects, the entity effect manager will remove its bundle when the last effect expires, rather than when all effects expire.

To reproduce:
1. Create a spell with at least two effects. Make the first effect last at least 2 rounds, and make the last effect last 1 round (instant counts as 1)
2. Cast spell
3. Wait 1 round
4. See spell being immediately removed, even though the first effect still had another round

The bug still occurs even if the first effect has 10+ rounds remaining.

I'm not sure if this is a classic issue, but even if it is, it's worth fixing in my opinion. The bug can be worked around by having the longest effect be the last in the list."
585831222,Fix several issues with conjured arrows,petchema,2021-03-05 19:37:45+00:00,2021-04-17 01:32:13+00:00,{'bug': 1},"- don't stack conjured arrows with different TTLs;
- shoot conjured arrows first, starting with the ones with lowest TTL;
- change color of arrow counter to tell whether you're about to shoot a conjured or real arrow;
- prevent looting conjured arrows (currently they're converted to real arrows in enemies inventory).

Forums: https://forums.dfworkshop.net/viewtopic.php?f=5&t=4629"
585230850,Change HotKeySequenceProcessed From Bool To Enum,AsesinoBlade,2021-03-05 00:50:51+00:00,2021-03-21 08:04:10+00:00,{},"Hi all,
This PR is in response to a bug report from agris in Inventory Filter; the bug report can be found at https://forums.dfworkshop.net/viewtopic.php?f=27&t=3224&start=30

the approach used to resolve the issue was proposed by @petchema at https://forums.dfworkshop.net/viewtopic.php?f=23&t=4612

This approach is to change the data type of HotKeySequenceProcessed from a bool to an enum in order to support a third state: Disabled

If a window control has focus and is set to overrideHotKeys then HotKeySequenceProcessed = disabled.
If not, then if hotKeysequence recognized, HotKeySequenceProcessed = Handled
otherwise, HotKeySequenceProcessed = NotFound

@petchema, If you wouldn't mind taking a quick peek at the code, I would really appreciate it.  It seems to be working, but I just want to make sure. 

Thank you so much for you continued help!

thanks
a"
583086424,Fixed date lines in journal entries of quests,deepfighter,2021-03-02 14:42:32+00:00,2021-03-21 23:55:51+00:00,{},"In some quests the text of the journal entry starts directly after the variable _%qdt:_. 

I changed those entries and reformatted them, so that now all the text is on a new line, which is the preferred way, as seen in all the other instances.

(btw. first pull request (ever)! :))"
580568622,Fixed torch burning ticks progressing while the game is paused,KABoissonneault,2021-02-26 03:16:52+00:00,2021-03-22 00:02:45+00:00,{'bug': 1},"Every frame, if the game is not paused, the torch checks if more than 20 seconds has elapsed since the last tick, and if so, reduces condition. This check is based on real time¬≠. Therefore, if a tick occurs and the player pauses immediately for at least 20 seconds, once they come back to gameplay, the torch will burn again immediately. No game mechanic should progress while the game is paused.

This implementation instead uses a time buffer that increases in time only while the game is not paused (and the torch is active of course). One potential issue is that the timer does not reset when unequipping the torch, but it might be a good thing, since it prevents ""exploits"" based on unequipping the torch every 19 seconds."
580417987,Fix issues where dungeon Automap models are created using the wrong texture table,XJDHDR,2021-02-25 21:22:08+00:00,2021-03-21 05:36:36+00:00,{},"I noticed some issues with the way dungeon Automap models are created which caused them to use the wrong texture tables when creating their materials. Both the vanilla models and RuntimeMaterials had this problem.

For the vanilla models, the script was passing a null reference for the texture table, causing the CreateBaseGameObject method to just use the default table. For RuntimeMaterials, the script was getting the texture table from an event that never fired.

It has been reported in the forum [here](https://forums.dfworkshop.net/viewtopic.php?f=31&t=4412).

If merged, this PR will fix the second problem mentioned in issue #1990.

@TheLacus - Maybe you should review the RuntimeMaterials portion of this PR?

Edit: Merging this PR will fix #1990 as this is the last part of that issue that needs to be fixed."
579579903,Automap: Move Mesh and Material update to separate script,XJDHDR,2021-02-24 20:19:32+00:00,2021-03-21 05:26:42+00:00,{},"This moves the contents of the InjectMeshAndMaterialProperties and UpdateMaterialsOfMeshRenderer functions into the AutomapModel script. This script is attached to every model that is used to construct the Automap. Then, instead of the Automap script iterating through the Automap tree to run these function on every model it finds, it raises an event that causes each model to run it's copy of the AutomapModel script functions.

I also made one or two optimisations to the existing code, resulting in a 55-60% reduction in the time it takes. Here are some numbers I got for the time taken for the InjectMeshAndMaterialProperties loop/event to run on loading or entering these locations on my desktop PC. For some reason, the function appears to run twice for dungeons and once for castles. I included both times for the dungeons:

Current code:
- Daggerfall Castle:
	- 543.5694ms
- Privateers Hold:
	- 161.139ms and 160.9252ms
- Castle Buckington:
 	- 351.8485ms and 348.7866ms
	
My PR:
- Daggerfall Castle:
	- 226.1401ms
- Privateers Hold:
	- 65.6735ms and 66.3357ms
- Castle Buckington:
	- 146.2152ms and 143.3541ms

I'm not sure if you would be interested in this PR. I was working on this while doing some experiments with multithreading Automap creation. Unfortunately, Unity has blocked the ability to run any part of these functions in anything but the main thread. Maybe what did work will be useful though? I think this event format makes the code look a bit neater."
578901825,Adding formula overrides for spell effect cost formulas,KABoissonneault,2021-02-24 01:50:00+00:00,2021-04-15 00:56:19+00:00,{},"This pull request is for overriding CalculateTotalEffectCosts, CalculateEffectCosts, ApplyTargetCostMultiplier. Since C#'s `System.Func` does not handle `out` parameters, I've replaced the gold cost and spell point cost out parameters with a single return type containing both values, a struct inside `FormulaHelper` called `SpellCost`. I thought it would be preferable to having a generic `Tuple<int, int>`. Tell me if there's a better place to put this structure.

The branch has no impact on gameplay, but allows mods to change how spell effect costs are calculated. 
Example: https://github.com/KABoissonneault/DFU-BalancedSpellCosts/blob/main/Scripts/BalancedSpellCostsMod.cs#L41
This mod keeps the same overall formula, but removes the truncating in the ""Per-level"" cost calculate and in the average magnitude calculation

In the future, I plan to use this to plug new spell effect settings inside the formula to change spell costs without having to replace all the spell effects.

"
578893110,GameObjectHelper: Set static flags while tagging Static Geometry,XJDHDR,2021-02-24 01:24:19+00:00,2021-02-24 02:07:05+00:00,{},"In addition to adding the staticGeometryTag to any GameObject run through the TagStaticGeometry function, this PR makes it also enable all of the [StaticEditorFlags](https://docs.unity3d.com/Manual/StaticObjects.html) for that object. This might help with performance.
"
577884909,Allow non-member quests to have rep requirements,ajrb,2021-02-22 19:31:03+00:00,2021-02-22 19:32:26+00:00,{'bug': 1},"This is for the Witch Coven guild that is not joinable, and leaves all non-member quests with 0 rank/rep defined in the quest list still able to be given to players with negative rep."
577186163,Fixed misnamed formula overrides,KABoissonneault,2021-02-21 21:44:22+00:00,2021-02-22 19:32:14+00:00,{'bug': 1},"Fixed misnamed formula overrides for CalculateFatigueRecoveryRate and CalculateSpellPointsRecoveryRate

Every other formula in that file has an override named after the function name. These two seem to be a copy-paste error. The function signature is not even consistent, so it wouldn't work as intentional design."
575336015,"Adding a FormulaHelper hook ""CalculateCasterLevel""",KABoissonneault,2021-02-18 01:58:26+00:00,2021-04-15 00:47:14+00:00,{},"Caster level is a core feature of Daggerfall spell effects. The 3 ways effects change in effectiveness is in their duration, their cast chance, and their magnitude. All three properties scale based on caster level, and this is the main way a spell gets better as the player progresses (aside from casting cost). The SpellMaker interface deals with caster levels, and a spell's information will also feature this level scaling.

Therefore, a mod that wants to modify existing or add new spell effects to the game will also most likely deal in terms of caster level. Currently, the caster level is always equal to the entity's level. But what if mods wanted to change that?

In my research, I've found one mod that tries to change the caster level: Unleveled Spells (https://www.nexusmods.com/daggerfallunity/mods/84). This mod works by basically recreating every spell effect in MagicAndEffects, and simply using the new formula for determining the caster level. This approach has drawbacks

- It's a lot of work
- This will override or be overriden by other mods that touch spell effects
- This will not affect new spell effects (if that's even possible in the current code? It will happen eventually, though)

It is my opinion that everyone would benefit from a more orthogonal approach, where certain mods focus on tweaking formulas, and other mods modify or create new spell effects. This way, we ensure more mod compatibility and consistency at large.

This is why I've introduced a new FormulaHelper hook ""CalculateCasterLevel"". When a spell effect needs to know the caster level, it calls this formula with the caster and the effect itself as input. The formula, as usual, checks for a formula override and invokes it if existing. Otherwise, it simply falls back to the existing behavior of using the caster's level.

With Unleveled Spells as inspiration, I've determined that the most common immediate information that a mod override formula would want to know if what spell is being cast. For example, if caster is the player, Unleveled Spells uses the effect's Properties.MagicSkill to get the player's LiveSkillValue, and determines a caster level proportional to that value (actual formula more complicated, but irrelevant here).

I hope you can see value in my proposed solution. If you have any questions, I can be reached on the official Discord server @kaboissonneault"
574986111,Fix mod asset loading on turkish culture,rossipaolo,2021-02-17 15:06:36+00:00,2021-03-20 00:26:25+00:00,{'mod system': 1},"[Win 10 - When I set ""region format"" to Turkish (Turkey) 90% of the DREAM mod gets compromised](https://forums.dfworkshop.net/viewtopic.php?f=31&t=4526&p=52693#p52693)"
574924988,Fix mods window all on/off text color,rossipaolo,2021-02-17 13:39:56+00:00,2021-02-17 13:40:37+00:00,{'mod system': 1},"[[0.11.0] All On/Off buttons in mod management don't update mod name ""ghosting""](https://forums.dfworkshop.net/viewtopic.php?f=31&t=4556)"
574439431,Fix cache issue with climate/season model variants,rossipaolo,2021-02-16 19:58:00+00:00,2021-07-09 00:33:57+00:00,{'mod system': 1},Fixes #2042
574286616,Fix mod settings negative float values,rossipaolo,2021-02-16 15:43:41+00:00,2021-02-16 15:43:50+00:00,{'mod system': 1},Fixes #2034
574264099,Import mod settings after changes,rossipaolo,2021-02-16 15:10:30+00:00,2021-03-21 07:47:04+00:00,"{'mod system': 1, 'editor': 1}",Automatically import mod settings and presets files after creation or changes from editor window.
573748262,Move hardcoded info panel colour into DaggerfallUI,ajrb,2021-02-15 19:16:03+00:00,2021-02-15 19:16:11+00:00,{},
573596556,Don't restrict shields by plate or chain,ajrb,2021-02-15 14:21:32+00:00,2021-02-22 19:32:54+00:00,{'bug': 1},To match classic DF see https://forums.dfworkshop.net/viewtopic.php?f=31&t=4587
573378668,Automap: Check CombineRDB state before resetting,XJDHDR,2021-02-15 08:31:09+00:00,2021-02-16 00:12:07+00:00,{},"While building the dungeon's Automap, the script's CreateDungeonGeometryForAutomap function disables the CombineRDB option to create individual models in the map instead of a combined model. After generating these models, it then re-enables this option. The problem is that if the user has disabled this option through the Unity Editor, this script re-enables it after generating the automap, forcing the user to re-disable it every time they load or enter a dungeon.

This commit adds a check to the setting manipulation so that at the end of automap generation, the CombineRDB option will only be re-enabled if it was originally enabled at the start of generation."
573131036,Prevent player location being selected for remote place,ajrb,2021-02-14 18:19:49+00:00,2021-03-21 08:06:34+00:00,{'bug': 1},"It happens occasionally and breaks the rest of one of the Archs guild quests Jay wrote when it does occur.

Rather hard to reproduce as it's based on random number selecting the current location."
573022955,Add joystick middle-click keybind and set Joystick UI controls to protected,jefetienne,2021-02-14 01:41:51+00:00,2021-03-21 07:59:11+00:00,{},"Inserts a new middle-click keybind accessible through the Joystick controls window, defaulted to `JoystickButton2`. Added in part by #2032 but would also benefit existing in the first place for mods that might make use of the middle mouse button.

Set the UI controls to protected so they can be accessible to subclasses created by mods."
572989143,Implement right clicks as described in Daggerfall manual,ajrb,2021-02-13 20:21:05+00:00,2021-04-15 00:34:41+00:00,{'enhancement': 1},"See page 53 of the original Daggerfall manual. Variant changing was added to right clicks, this is now on middle mouse click.

As discussed here: https://forums.dfworkshop.net/viewtopic.php?p=52256#p52256

@Interkarma This is a candidate change which you can veto if you wish. 

Note that it may break mods that override inventory or trade UI windows until they are updated.

@petchema Would you mind casting your eye for detail over this one and test it to see if I missed any interactions."
572872998,BookFile: Added try-catch check to BinaryReader portion,XJDHDR,2021-02-13 03:12:36+00:00,2021-03-22 00:01:17+00:00,{},"On a few occassions, I've loaded a save only to get the HUD overlaying a black screen. The game still appeared to be running but the game didn't seem to react to my inputs. I couldn't open the main menu either and had to kill the game. On this occasion, I caught this happening in the editor which reported an `EndOfStreamException` in the line `header.PageOffsets[i] = reader.ReadUInt32()`. As a result, I added a try-catch check to gracefully handle this exception in future for any part of the BookFile's BinaryReader code."
572865541,Constant horse jumping capability,petchema,2021-02-13 02:05:43+00:00,2021-03-21 07:56:58+00:00,{'enhancement': 1},"Make horse jumping capability independant of player's capability, so you can always jump over hedges with the horse.
I used a jumpSpeedMultiplier value higher than strict minimum so horse doesn't ""stumble"" as much on hedges (unless you have perfect timing); But best value is debatable.

Forums: https://forums.dfworkshop.net/viewtopic.php?p=51147#p51147"
572785543,Fix dictionary access for non existant keys,ajrb,2021-02-12 21:24:05+00:00,2021-02-16 00:14:14+00:00,{'bug': 1},Just a silly oversight on my part.
571514420,PlayerEnterExit: Reduce delay filling Dungeon variable,XJDHDR,2021-02-11 01:31:33+00:00,2021-03-21 05:07:40+00:00,{},"Previously, GameObjectHelper ran the SetDungeon function in DaggerfallDungeon before returning it's results. Since PlayerEnterExit uses the value of this returned result to fill it's Dungeon variable, this meant that there was a short period where Dungeon was equal to Null even though the DaggerfallDungeon object existed. This moves the SetDungeon function so that it runs after the Dungeon variable is filled.

I encountered this problem while working on PR #2026 where I couldn't retrieve the value of the dungeon's ID because Dungeon was still Null while the ApplyMaterials function in RuntimeMaterials was running."
570122600,RuntimeMaterial: Take RandomDungeonTextures setting into account,XJDHDR,2021-02-09 08:41:16+00:00,2021-03-12 20:45:39+00:00,{},"RuntimeMaterials previously didn't take the game's RandomDungeonTextures setting into account when it decided to apply climate variations to dungeon models. This meant that dungeon models using RuntimeMaterials looked noticeably different next to vanilla models. This PR integrates the same logic that DaggerfallDungeon uses to decide what textures vanilla models use. 

The texture assignment abilities of RuntimeMaterials now ~almost~ matches that of the vanilla logic. The only thing I still need to sort out is that when the RandomDungeonTextures setting was set to ""Random"", I found a dungeon (Castle Buckington - Ilessan Hills in this case) where the vanilla models were using textures from the ""Swamp"" climate set whereas RuntimeMaterials used the ""Temperate"" set. Edit: This no longer applies.

In particular, I would like @TheLacus to take a look at this since RuntimeMaterials was his work.

If merged, this PR will ~mostly~ fix the third problem described in issue #1990. 

RuntimeMaterials - Temperate textures:
![RunMat - Temperate climate](https://user-images.githubusercontent.com/7355441/107337474-46bece00-6b1f-11eb-89ef-87d36a4a5b37.jpg)
Vanilla model - Swamp textures:
![DagMesh - Swamp climate](https://user-images.githubusercontent.com/7355441/107337479-47effb00-6b1f-11eb-913d-7358d02af3f7.jpg)
"
568716943,Add ability to bash doors placed by CustomDoors,XJDHDR,2021-02-06 04:19:19+00:00,2021-02-07 15:08:08+00:00,{'mod system': 1},
568052595,Automap: Add support for the discovery state of OBJ models to be saved and loaded,XJDHDR,2021-02-05 03:07:08+00:00,2021-03-20 00:21:50+00:00,{},"This does two things:
1. Makes the UpdateMeshRendererDungeonState() function be called on all components of all children of the current transform model instead of only the first component in it's root. This fixes an issue where already discovered models on the dungeon map are not revealed after loading a save game if an OBJ file has been used to replace the model.
2. Solves an issue where the SaveStateAutomapDungeon function doesn't properly save the discovery state of OBJ models because it only checked the MeshRenderer component attached to the model's root and not those attached to children.

This PR is identical to #2002, just with all of my changes moved to a new branch. This PR fixes #1995."
567123172,Add NameSeed to building overrides,ajrb,2021-02-03 20:28:47+00:00,2021-02-04 23:20:11+00:00,{'enhancement': 1},Missed this before because I was doing a guild and they don't use a seed for the name. Have already updated documentation accordingly here https://forums.dfworkshop.net/viewtopic.php?p=32886#p32886
566309477,"fix potion maker's stackCounts (take 2, alternative to #2011)",petchema,2021-02-02 21:30:36+00:00,2021-04-15 00:26:07+00:00,{'bug': 1},"- Replace ingredients with an ItemCollection of cloned ingredients, not shared with either player's inventory or wagon.
- Add/Remove ingredients to the cauldron using ItemCollection methods
- When the cauldron is mixed, find and remove ingredients from player's inventory first, and wagon as a fallback.

This is a more extensive rewrite than take 1, so I don't exclude bugs."
566254664,Adjust position of item based player torch to throw some visible shadows off static geometry,ajrb,2021-02-02 20:11:56+00:00,2021-02-04 23:20:29+00:00,{'enhancement': 1},For atmosphere. See https://forums.dfworkshop.net/viewtopic.php?f=12&p=52174
565864847,Fix %pcn macro written as %pfn and add missing apostrophes,df-ferital,2021-02-02 11:06:16+00:00,2021-02-04 23:19:38+00:00,{},"Fix a bug reported on the forums: http://forums.dfworkshop.net/viewtopic.php?f=5&p=52162&sid=a9eea9ca6a9b8d58b2ded2b973db6856

I choosed to use %pcn (player's full name) here rather than %pcf (player's first name), as it seems more appropriate for a hostile reaction.

I also took this occasion to add some missing apostrophes."
565409512,Added Forward Thrust as an option,AsesinoBlade,2021-02-01 19:02:07+00:00,2021-03-21 07:52:04+00:00,{},"Hi all,
I saw this as a bug, but it may have been intentional. If so, please reject this PR.
I noticed that the click to attack never selects Thrust forward. It turns out that the random selection doesn't have thrust as an option. I changed it to now include upRight (enum #3 instead of starting with Left Enum #4).

I did have to change FPSWeapon as OnAttackDirection was only looking for Up instead of also looking for UpLeft and UpRight.

Thanks
a"
565386944,Improve support of mod localization,rossipaolo,2021-02-01 18:21:09+00:00,2021-03-18 00:16:03+00:00,{},"I have been looking at improving support for localization of custom text used by mods. Ideally the process should be similar to core translation but it doesn't look like new databases can be discovered at runtime, so this is still based on old csv tables, at least until we find a better solution.

A mod with custom text should have a main table named **textdatabase.txt** for fallback (this was already supported), while built-in translations now can be provided with language identifiers (for example **[en]textdatabase.txt**, **[fr]textdatabase.txt**, ...). Other mods can supply missing translations via GUID (for example **[fr(7e0510a9-be7d-4fd4-9c89-ed2f2b2e5fb3)]textdatabase.txt**)."
565318441,Add thrust to click to attack,AsesinoBlade,2021-02-01 16:33:55+00:00,2021-02-01 18:46:46+00:00,{},"Hi all,
I saw this as a bug, but it may have been intentional.  If so, please reject this PR.
I noticed that the click to attack never selects Thrust forward.  It turns out that the random selection doesn't have thrust as an option.  I changed it to now include upRight (enum #3 instead of starting with Left Enum #4).

I did have to change FPSWeapon as OnAttackDirection was only looking for Up instead of also looking for UpLeft and UpRight.

Thanks 
a"
564714917,Change removal of Oghma to be handled by effect manager,ajrb,2021-01-31 19:35:44+00:00,2021-03-18 00:11:43+00:00,{'bug': 1},"Suggested fix only - untested, so will need testing first. I just figured this would be the correct way to fix the issue rather than adding remove from wagon into Oghma effect class. Feel free to close if you don't like it."
564711764,Update paymoney quest action to allow only gold to be accepted if desired,ajrb,2021-01-31 19:15:13+00:00,2021-02-04 23:19:15+00:00,{'enhancement': 1},"This action was added for my R&R quest Mountain Rumors. With the latest quest machine changes I needed pay money to be able to limit to just real gold pieces. SHould be backwards compatible with saves, and it worked for me."
564639658,fix potion maker's stackCounts,petchema,2021-01-31 11:39:08+00:00,2021-03-18 00:02:58+00:00,{'bug': 1},"Keep track of parent stack of splitted stacks;

Use it to enforce a new invariant: if a parent stack is in cauldron, none of its children must be in the ingredients 
(=> move parent to cauldron last, but also move parent to ingredients first).

Forums: https://forums.dfworkshop.net/viewtopic.php?f=31&t=4507"
564487412,Move Stealth skillcheck to FormulaHelper,Ralzar81,2021-01-30 18:29:54+00:00,2021-01-31 22:26:35+00:00,{},"I am working on a Thief overhaul mod and to make any headway I need the ability to override the stealth check.

As far as I can see, only EnemySenses.cs checks this, so I have made a PR that moves this calculation to FormulaHelper, making it possible for mods to easily change how stealth is checked."
564315395,Unused Face Data for Male Nord,SquidKamer,2021-01-29 23:54:09+00:00,2021-02-04 23:18:06+00:00,{},There is a bearded Nord who's face data goes unused. This changes the value from 264 to 168 to restore the NPC's proper face to the game. I will also need this for my VIO mod in the future.
563672585,Bugfix of wrong choice for Nature Billboards at Climate borders,Bl4ckh34d,2021-01-29 01:28:24+00:00,2021-02-16 10:10:47+00:00,{},"Solved a bug where the PlayerGPS climate was used when picking nature billboards for new terrains instead of the terrains climate itself. This solves the bug at climate transitions, where terrains got nature billboards assigned, that were based on the players current climate location, not their actual climate."
563631742,Create ITerrainMaterialProvider and allow overriding by mods,rossipaolo,2021-01-28 23:22:55+00:00,2021-05-19 22:59:46+00:00,{'enhancement': 1},
563023151,Extra features for the CustomDoor script,XJDHDR,2021-01-28 06:43:58+00:00,2021-05-14 20:25:58+00:00,{},"My changes here add two additional functions to the CustomDoor script:
- You can specify what DoorType the doors created by this script will be in the Editor's Inspector, giving a modder the ability to override the DoorType set by analysing the textures.
- ~~You can add multiple BoxColliders to the model and allow more than one of them to be treated as a door by this script.~~ Edit: Original code already did this.

I've marked this as a draft to get the opinions of the DFU devs and see if this is something you are willing to add to the base game. Especially @TheLacus since this was originally his work."
562824656,Ensure that the last location is set to current loc when entering a building.,ajrb,2021-01-27 22:10:57+00:00,2021-02-04 23:17:36+00:00,{'bug': 1},"Turns out that live builds can sometimes update locations in a different order leaving the last location set to someplace other than current which breaks building variants for first entry.

Also added some docs for the terrain nature interface.
"
561487450,Some fixes for Action Doors with child objects,XJDHDR,2021-01-26 02:33:51+00:00,2021-02-16 18:24:58+00:00,{},"This change fixes a bug I found where the Action Doors in a Block don't have their Starting Lock Level (and presumably other variables) set to the block's defined values if the Action Door script is attached to a child of the model's prefab. An example of this is if the door has been replaced by an OBJ model.

I reported this bug on the forum [here](https://forums.dfworkshop.net/viewtopic.php?p=51629#p51629)."
560719819,Call UpdateMeshRendererDungeonState() on all children of Transform Models,XJDHDR,2021-01-25 01:11:52+00:00,2021-02-05 02:46:30+00:00,{},"This change makes the UpdateMeshRendererDungeonState() function be called on all MeshRenderer components of all children of the current transform model instead of only the first one in it's root. 

This fixes an issue where already discovered models on the dungeon map are not revealed after loading a save game if an OBJ file has been used to replace the model. This change was adapted from pull request #1988 . Without my changes, the dungeon map looks like the first screenshot attached to the issue. With my changes, the same corridor after loading the attached save looks like this, as it should. Don't worry about the wrong textures on my models, that's a separate issue I've reported elsewhere:
![Undiscovered models fixed](https://user-images.githubusercontent.com/7355441/105647826-0ea77080-5f0d-11eb-9e1b-76a26ca9b329.jpg)

If this PR is merged, it will fix #1995 

I'm leaving this as a draft because I would like some comments from the devs. 
On the one hand, Nystul said that this is the wrong way to fix this issue because he believes that if the model hierarchy is different to when the game was saved, it will break stuff.
On the other hand, other changes have been made to DFU in response to other OBJ related issues I've reported. One example is [this pull request](https://github.com/Interkarma/daggerfall-unity/pull/1988) by Pango which fixes it's issue in a similar way to this PR. 
That said, in [this forum post](https://forums.dfworkshop.net/viewtopic.php?p=47664#p47664) - even though TheLacus did change his script to work with OBJ's model hierarchy - he specifically mentioned avoiding GetComponentInChildren() for performance reasons.

I also had to create a new variable to make this work (Unity complained that I can't use a ForEach iteration variable as a ref). Does anyone feel I could have given it a better name? 

Otherwise, it is ready to go."
557717601,Removing %pcnf typo in dialog file,InconsolableCellist,2021-01-19 20:59:03+00:00,2021-01-22 01:41:40+00:00,{},
557626516,Refresh cursor on game start,rossipaolo,2021-01-19 18:29:07+00:00,2021-01-22 01:41:06+00:00,{'mod system': 1},"Custom assets are tipically only seeked in the Game scene. Cursor is a special case because is also needed in the Startup scene, so there was an issue where a mod providing the cursor, initially enabled, was disabled resulting in a missing cursor, as well as an issue where a custom cursor was provided by a disabled mod.

Cursor is now also seeked on game launch to ensure changes to mod configuration during setup (i.e mod enabled or disabled) are applied."
557601914,Import mod manifest after changes,rossipaolo,2021-01-19 17:46:20+00:00,2021-01-22 01:39:10+00:00,"{'enhancement': 1, 'mod system': 1}",Automatically import mod manifest file after creation or changes from editor window.
556367580,Refactor nature layout to it's own class and interface,ajrb,2021-01-17 15:47:04+00:00,2021-01-22 01:38:56+00:00,{},"This allows new nature layout algorithms to be used by mods in the same way terrain height samples and textures can be replaced.

Example usage:
` DaggerfallUnity.Instance.TerrainNature = new BasicRoadsNature();
`"
556128942,Fix model 729 main entrance left door,df-ferital,2021-01-16 09:09:27+00:00,2021-01-22 01:34:54+00:00,{},Fix a bug reported of the forums: https://forums.dfworkshop.net/viewtopic.php?p=23940#p23940. Can be tested with the save provided by Pango.
555938894,Fix part of #1990,rossipaolo,2021-01-15 20:49:02+00:00,2021-01-22 01:34:28+00:00,{},"Dungeon models can also be used outside of a dungeon, so default material should always be applied even if ""Use Dungeon Texture Table"" option is enabled."
555847946,Fix some naming macros,df-ferital,2021-01-15 17:47:33+00:00,2021-01-22 01:34:02+00:00,{},"Fix an issue reported on the forums regarding the %fn macro: http://forums.dfworkshop.net/viewtopic.php?f=31&t=4447&sid=26748510f65c64d9c1d3237b74cb59cb

This issue can be seen on character biography when creating a Warrior. The same bug also affects the %mn macro when creating a Knight.

There is also one affected noble quest using both macros, R0C11Y28, where names on the autopsy report are always changing without this fix.

I also took the time to refactor the `MacroHelper.Name` method as its current state was not satisfying.
 "
555061541,Ensure that both Mages Guild songs can be played,df-ferital,2021-01-14 16:49:17+00:00,2021-01-22 01:28:45+00:00,{},"Fix the bug reported on the forums: http://forums.dfworkshop.net/viewtopic.php?f=5&t=4446&sid=1f23cb27abe1fc66bb5e39698055c153. This is similar to what classic does.

I also removed a temple song as there should be only 8 of them, corresponding to the 8 deities."
553604636,Made DoorModelIndex public,XJDHDR,2021-01-12 16:51:54+00:00,2021-01-19 13:00:17+00:00,{},"This solves an issue I discovered and reported which causes all doors inside the overridden block to use model 9000.

Fixes #1989 "
553073202,recursively update MeshRenderers in Automap,petchema,2021-01-11 23:03:53+00:00,2021-01-22 01:28:11+00:00,{},"For compatibility with modded models:

https://forums.dfworkshop.net/viewtopic.php?p=51357#p51357"
548255436,Return to using baseSpeed if riding,ajrb,2021-01-04 13:46:59+00:00,2021-01-22 01:26:54+00:00,{},"This makes no change to vanilla DFU, but allows mods to allow sprint riding. This will fix the Roleplay & Realism mod exhanced riding sprint function to be faster rather than slower as it currently is.

I can take a different approach if this change is a problem."
545726512,Mark method as obsolete,rossipaolo,2020-12-26 19:22:28+00:00,2021-01-22 01:25:11+00:00,{},
545709179,Fix dungeon FM songs (related to #1953),petchema,2020-12-26 15:57:48+00:00,2021-01-22 01:25:36+00:00,{'bug': 1},"Makes sure they're 15 dungeon FM songs, like the 15 dungeon GM songs, so that songs stay in sync.

In classic Daggerfall configured for SoundBlaster 16,  
- fm_dngn1 plays in The Convocation of Elona, Daggerfall
- 15fm plays in The Ruins of Copperhart Orchard, Daggerfall

Forums: https://forums.dfworkshop.net/viewtopic.php?f=5&t=4401"
545708835,Fix and improve a few xml docs,rossipaolo,2020-12-26 15:53:59+00:00,2021-01-22 01:24:27+00:00,{},Fixed some issues with xml syntax and improved docs.
545707681,Stores enabled mod build targets in editor,rossipaolo,2020-12-26 15:40:25+00:00,2021-01-22 01:23:21+00:00,"{'mod system': 1, 'editor': 1}",
543845651,Default binding fixes,jefetienne,2020-12-22 03:40:58+00:00,2021-01-22 01:22:53+00:00,{},"There were a couple of odd overlapping bugs I found. Here is one of them that I could reproduce:

1. Reset bindings to default
2. Remove `TurnLeft` and `TurnRight` in the primary bindings
3. Set `TurnLeft` and `TurnRight` as  ""Left Arrow"" and ""Right Arrow"", respectively, in the secondary bindings
4. Close windows, observe that TurnLeft has stopped working

Changes:
- Prevent binding `KeyCode` ""None"" to an action dictionary, so it won't get serialized in KeyBinds.txt
- Fix repopulating `existingKeyDict` when `actionKeyDict` did not contain every action by looping through the `Actions` enum list instead
- In `TestSetBinding`, do not set a default binding if the default `KeyCode` for it is already being used in the secondary bindings"
543766809,Set mod warning MessageBox's default button to 'yes',jefetienne,2020-12-21 22:53:40+00:00,2021-01-22 01:21:31+00:00,{},"Pressing the enter key while on the mod warning message will default to 'yes', meaning it will proceed to load the save. It feels more natural to press the enter key as a confirmation than a cancellation."
542990051,more skybox seam fixes,petchema,2020-12-19 23:05:09+00:00,2021-01-22 01:21:06+00:00,{'bug': 1},"I observed that one straight north and south of classic skybox with Distant Terrain, but I suppose it's not caused by it; However if I reload the save with another terrain generator my position is changed and the seam disappears.
![2020_12_19_11_12_15](https://user-images.githubusercontent.com/1211431/102701401-da2dfe00-4256-11eb-9eab-564a1c90d1d2.jpg)
[SAVE475.zip](https://github.com/Interkarma/daggerfall-unity/files/5720252/SAVE475.zip)
"
539914411,Fix regression introduced in #1965,petchema,2020-12-15 01:38:22+00:00,2021-01-22 01:16:35+00:00,"{'bug': 1, 'regression': 1}","Description of the bug:
https://github.com/Interkarma/daggerfall-unity/pull/1965#issuecomment-744803943"
538930732,"Fix spurious ""can't carry any more"" when picking maps",petchema,2020-12-13 10:47:47+00:00,2021-01-19 13:06:20+00:00,{'bug': 1},"If you encumbrance is maxed out, picking maps will work but be followed by a ""can't carry any more"" message that was stacked below by the call to CanCarryAmount().

This doesn't happen with arrows because their effective weight is 0.
Extend this to maps, which is the simplest fix."
532865967,only apply reputation drop once in case of bank default,petchema,2020-12-05 01:03:36+00:00,2020-12-05 22:52:50+00:00,{},"Forums: https://forums.dfworkshop.net/viewtopic.php?f=5&t=4346

Save less than 24h before default (but with enough on account to repay the loan). Neutral current reputation.
[SAVE867.zip](https://github.com/Interkarma/daggerfall-unity/files/5646217/SAVE867.zip)
"
532692488,Prevent backstabbing daedra seducers during transformations,petchema,2020-12-04 17:56:47+00:00,2020-12-05 22:54:56+00:00,{},"Note: Changes the signatures of CalculateAttackDamage and CalculateBackstabChance delegates.
It seemed weird to pass around a frame record number that's tied to current enemies animation.
"
529109231,Fix guild greetings for unique NPCs,df-ferital,2020-11-29 13:25:16+00:00,2020-11-29 22:29:26+00:00,{},"Fix greetings when talking to unique NPCs affiliated to guilds, like Karethys or Popudax.

Fix #1973"
528205586,Combine SetupDefaults and ResetDefaults as one method,jefetienne,2020-11-26 17:33:13+00:00,2020-11-28 23:44:24+00:00,{},"To remove code duplication and prevent binding inconsistencies in the future, this PR combined both functions by using a boolean parameter called `autofill` that will determine whether to forcefully reset the bindings or simply fill in what is missing."
527067826,Added Custom Sky Loading,joshcamas,2020-11-25 03:57:59+00:00,2021-01-22 01:16:06+00:00,{},"This adds support for custom day and night image loading from loose files and mods.

To load a custom sky texture, it would load this filename from the textures folder:
""SKY03_0-0.DAT""

This would replace sky 03 at frame 0 and east.

Nighttime is a bit more complex, since it has several options for it to scan:

1) NITE03I0.IMG --> This will act identically to the vanilla daggerfall, with a total of 4 night types being supported. No stars!

2) NITE03I0-0.IMG / NITE03I0-1.IMG --> This will act identically to the vanilla daggerfall, with a total of 4 night types being supported. HOWEVER: East and West will be supported by the final index. No stars!

3) NITEFULL28I0.IMG --> This will act more like the daytime skies, with a total of 32 night sky types being supported. No stars!

4) NITEFULL28I0-0.IMG / NITEFULL28I0-1.IMG --> This will act more like the daytime skies, with a total of 32 night sky types being supported, and east and west being supported by last index. No stars!

The system will go through 1-4, and if it successfully finds a file matching that name, it will use it. And of course if it fails all of them, it will load the vanilla files.

**A few other things to note:**

- As mentioned, stars are not supported in custom images. This is because there isn't much reason for it, especially since you can have east+west images separate, so you can manually paint stars and the moons or whatever. However, if stars are something that are wanted, I could make it so stars are default, then a filename with a ""_NOSTARS"" postfix would disable the stars.

- For custom images no night seam is fixed - the images are supposed to be mirrored, just like daytime. In my eyes, the seam fixer exists due to the malformed night sky images in vanilla.

- Any sky image size is supported, as long as the west+east variants are the same size."
526859329,Immediately apply volume changes in launcher,petchema,2020-11-24 23:45:19+00:00,2020-12-13 02:05:35+00:00,{'enhancement': 1},"Immediately apply volume changes in launcher.
Play door effect to check sound volume.

I had to create a temporary GameObject to get a separate
DaggerfallAudioSource. Not sure how I feel about that."
525282723,Fix exploit for Kightly Order armor service,ajrb,2020-11-22 13:19:43+00:00,2020-11-22 21:14:36+00:00,{'bug': 1},See: https://forums.dfworkshop.net/viewtopic.php?f=5&t=4306
524932831,Ensure models with registered actions are not combined for RMB and interiors,ajrb,2020-11-20 20:24:08+00:00,2020-11-20 22:16:08+00:00,{'bug': 1},As discussed here: https://forums.dfworkshop.net/viewtopic.php?f=22&t=4309
521343482,Publicize CurrentRestMode,jefetienne,2020-11-16 04:14:43+00:00,2020-11-20 22:09:11+00:00,{},"This is for issue #1962.

This PR essentially would replace the utility of `PlayerEntity.IsLoitering` and `PlayerEntity.IsResting`, but may be kept for mod compatibility reasons. I also have no problem with removing them if requested. :)

I publicized the `RestModes` enum and kept it in `DaggerfallRestWindow`, but I can move it elsewhere to `DaggerfallUnityEnums` if mod compatibility is also not an issue."
521069941,Handle interior guard spawns for taverns and houses,numidium,2020-11-14 22:40:22+00:00,2020-12-13 02:20:35+00:00,{},"Guards now spawn at the ground-level door in taverns and residences. The door farthest from the building's origin is chosen to prevent guards entering from the building's courtyard.
Note that guards can still spawn in an unreachable place in disconnected interiors. This PR does not cover that issue."
517102667,Correct Bhoriane spelling everywhere,df-ferital,2020-11-07 07:43:41+00:00,2020-11-20 22:11:19+00:00,{},"Fix Bhoriane county mispelled as Bhoraine in FACTION.TXT, which resulted in similar mistakes in DFU source files.
Discussion here: https://forums.dfworkshop.net/posting.php?mode=reply&f=5&t=4294."
514982837,Allow custom Renderer for ObjectPositioner,rossipaolo,2020-11-03 20:47:34+00:00,2020-12-13 02:02:17+00:00,{'mod system': 1},By default  a mesh renderer is seeked on gameobject to get bounds. Renderer field can be assigned from the inspector to override this behaviour and use a different renderer. For example this is useful when a lod group is used and root gameobject doesn't have a mesh renderer attached.
510122340,Fix several mistakes in Text.rsc,df-ferital,2020-10-26 15:42:38+00:00,2020-11-28 23:30:19+00:00,{},"This PR is a first attempt at correcting TEXT.RSC errors. The following ones were fixed:

- All directions given by NPCs should be fixed. No more _The best way to go The Green Hedgehog is southwest of here_. Now, the NPC will properly answer _The best way is to go southwest of here_. I tried to correct all of these historical mistakes, but a review would be greatly appreciated.
- Knightly order descriptions are now using proper guild names. No more Knights of the Dragon described as Order of the Dragon. Also, the Knights of the Hawk are properly assigned to Antiphyllos.
- Replaced the non-existent %pc macro (even in classic) with %fpc.
- Fixed the ""Freshly burried dead"" issue reported here: http://forums.dfworkshop.net/viewtopic.php?f=12&t=2692&sid=892c8fc88eac4bc46f06d9cdcf49eb78
- Replaced many flawed ""its"" and ""Its"" with ""it's"" and ""It's""."
510013329,Autoadjust micromap size,petchema,2020-10-26 13:02:34+00:00,2020-11-20 22:05:59+00:00,{},"
Adjust dungeon micro map resolution to dungeon size.
Fixes issues with some dungeons like The Ruins of Moorford Manor, Daggerfall.

This is an alternative to #1958 "
509453031,Increase micromap size,numidium,2020-10-24 16:01:23+00:00,2020-10-26 18:15:44+00:00,{},The micromap dimensions for Ruins of Moorford Manor in Daggerfall exceed the current boundaries. Hopefully this will be large enough for all dungeons.
505569691,make runInBackground a setting,petchema,2020-10-18 22:01:59+00:00,2020-11-20 22:02:26+00:00,{},"Some people seem to be annoyed by runInBackground being false now.
It's hard to tell what value satisfies the most people, however I suspect it's when runInBackground is enabled, and only a minority really prefers it to be disabled.
So, making it a hidden setting (.ini only), defaulting to true.

Original issue:
https://github.com/Interkarma/daggerfall-unity/issues/1942
Forums: https://forums.dfworkshop.net/viewtopic.php?f=5&t=4236"
505325248,Publicize parts of PlayerActivate and NativePanel for mod support,jefetienne,2020-10-17 18:14:26+00:00,2020-11-20 22:04:27+00:00,{},"I'm writing a mod for displaying tooltip information in the world and some of these methods need to be public in order to retrieve all of the information about it. Also publicized `ChangeInteractionMode` and `Pickpocket` as they would probably be useful for future mods.

`NativePanel` would be useful as a public property to get information about certain information about windows and adding components to them without overriding the class itself."
505137264,Use HUD text for light source depletion message,numidium,2020-10-16 22:52:27+00:00,2020-11-22 21:12:55+00:00,{},Currently uses a message box which stops the player in their tracks.
501214954,Create a setting to choose the FM soundtrack,numidium,2020-10-11 22:14:16+00:00,2020-12-13 02:01:22+00:00,{},"Adds a new checkbox to advanced settings under audio. If checked, the game will use the FM version of the soundtrack if an OPL3 soundfont is in use or custom music files that replace FM songs are loaded.

It works well with @petchema's mod here: https://www.nexusmods.com/daggerfallunity/mods/79/
The OPL3 soundfont found here: https://musical-artifacts.com/artifacts/15 doesn't make the songs sound quite the same as they do in classic, unfortunately. It's theoretically possible to mimic Classic's OPL3 soundtrack with a proper soundfont in conjunction with this PR, however."
498797261,Add protected virtual for extending potion window,ajrb,2020-10-06 19:49:40+00:00,2020-10-10 02:15:51+00:00,{},
498011220,fix lunar computations,petchema,2020-10-05 17:39:02+00:00,2020-10-10 02:15:28+00:00,{},"Make sure full moons happen on 21st and 25th of Morning Star, then
23rd and 27th of Sun Dawn, etc.

Forums: https://forums.dfworkshop.net/viewtopic.php?f=22&t=4203"
496423083,fix horse/cart sound stopping (regression in 0.10.23),petchema,2020-10-01 17:25:12+00:00,2020-10-10 02:09:42+00:00,{},"- reset flag so that new coroutines can be started
- And rename stoppedRidingAudio as pendingStopRidingAudio to better convey
its purpose.

Fixes a regression introduced in 0.10.23
Forums: https://forums.dfworkshop.net/viewtopic.php?f=5&t=4191"
496404969,Remove changes from PR#1808,ajrb,2020-10-01 16:55:09+00:00,2020-10-10 02:10:03+00:00,{},"The changes to improve horse jumping sounds broke the stopping of sounds when horse/cart stops. This commit removes those changes, as I think this is worse than clipped no sound if a player holds space to bunny hop the horse.

See: https://forums.dfworkshop.net/viewtopic.php?f=5&t=4191

I'd be happy to put in a change to prevent bunny hopping horses which would be a better approach to the issue than allowing the sound to play longer. TBH if players want to hold space, I care very little what it sounds like as it's a silly thing to do when playing, which is why preventing that action would be my preference here if something has to be changed."
495977617,"Change crouch action to ""key-down"" (ActionStarted)",jefetienne,2020-10-01 05:48:37+00:00,2020-10-10 02:05:38+00:00,{},"The sneak action either uses ActionStarted when in toggled mode, or HasAction when not. To keep a consistency for all physical actions, I believe the crouch action should be changed to ""ActionStarted"" as well."
495355880,Enemy + Mobile NPC Spawn Events,joshcamas,2020-09-30 08:53:27+00:00,2020-10-10 02:05:03+00:00,{},"Hooking into enemy / npc spawning isn't super doable currently, making modding a bit tough. This makes modifying enemies itself a lot harder than it should be! Adding spawn events is a major way to make this easier.

All cases I could find correctly trigger these events - dungeon enemies, quest spawns, sleeping encounters, etc."
493744012,"Regression fix for axis rebinding, no duplicate highlighting between left/right click",jefetienne,2020-09-27 16:27:48+00:00,2020-10-10 01:59:54+00:00,{},Caused the tooltip PR.
492708909,Ensure shrines are handled correctly,ajrb,2020-09-24 21:28:02+00:00,2020-09-24 22:08:50+00:00,{},"See bug report https://forums.dfworkshop.net/viewtopic.php?f=31&t=4117

I changed the localization table for internal strings to add:

temple = temple

but it doesn't seem to have got picked up in the commit and I don't know what to do."
489533892,Fix SearchItems method when no template index specified,ajrb,2020-09-18 20:48:17+00:00,2020-09-20 23:04:41+00:00,{'bug': 1},This has been around for a while undetected. Just added some code that uses this and was scratching my head for a while... hope this can go into .26 but not a big issue if not.
489136155,Made world borders non-sticky,SoullessHumanoid,2020-09-18 07:35:46+00:00,2020-12-13 01:55:29+00:00,{},"Fixed issue #1911 by changing world borders only affect the coordinate that goes out of bounds, and pushing the player slightly away from the border, to prevent getting stuck if `lastFramePosition` is somehow set outside allowed area."
487527359,fix Clocks that would return 0 days,petchema,2020-09-15 19:54:53+00:00,2020-09-16 00:30:24+00:00,{},"Clocks with
- both timerValue0 = timerValue1 = 0 and
- neither flag & 1 or flag & 16

Will have a final clockTimeInSeconds of 0, not overridden by a travel time.
![Capture d‚Äô√©cran du 2020-09-15 20-56-58](https://user-images.githubusercontent.com/1211431/93258027-ffb1f400-f79d-11ea-95ff-381f4c0c2a70.jpg)
(source https://www.twitch.tv/videos/741689738?t=4h16m16s )

Until Clock implementation is changed, a workaround for those cases is to modify flag to have either flag & 1 or flag & 16.
Fortunately, there's only 2 such instances."
486847706,Move material selection into overridable formulas,ajrb,2020-09-14 19:55:03+00:00,2020-09-16 00:29:29+00:00,{'mod system': 1},Feels like the calculation of random material for a given level should be exposed for mods
486837372,Allow TerrainSamplers to disable the default job and do their own location blending / flattening,ajrb,2020-09-14 19:33:38+00:00,2020-09-16 00:09:42+00:00,{'mod system': 1},
486477181,More accurate pursuit formula,petchema,2020-09-14 09:33:27+00:00,2020-09-16 00:08:31+00:00,{},"Current pursuit algorithm in EnemySenses compute how much time will be needed to reach the current position of the target, then computes by how much the target will have moved by then. This is only an approximation, because it does both the hypothesis that the target won't move and that it will move. The fastest the target, the less accurate it gets.

One can exploit that inaccuracy by rushing at enemies, that will turn their back, pursuing a position behind them. Hence current algorithm has an additional test to detect that condition, but it doesn't seem to work perfectly, the exploit still exists.

Accurate approach is to compute at what moment the target will be on a sphere centered at pursuer position, growing at its interception speed each second; Or, in 4 dimensions (x, y, z, t), compute the intersection of a cone and a line. This is slightly more expensive, solving a quadratic equation then taking its smallest positive solution, but doesn't seem to suffer from the previous exploit."
486245967,Apply bonuses and phobias to all attacks,numidium,2020-09-13 21:56:06+00:00,2020-09-16 20:31:52+00:00,{},"Addresses the bug discussed here: https://forums.dfworkshop.net/viewtopic.php?f=31&t=3923

Bonuses and phobias are now applied to player AND enemy armed/unarmed attacks.

Note: This will break any mods that override GetBonusOrPenaltyByEnemyType"
486187955,Add check for DaggerfallActionDoor on door prefab,rossipaolo,2020-09-13 14:13:06+00:00,2020-09-13 14:13:56+00:00,{},"When providing a replacement for _DaggerfallActionDoor_ prefab,  `DaggerfallActionDoor` component must be added by mod author. If component is missing an error message is now logged."
486185038,Remove GC in drawing Panels,jefetienne,2020-09-13 13:51:48+00:00,2020-09-15 23:54:44+00:00,{'UI': 1},"Using the Unity profiler, I found that using a foreach loop of a BaseScreenComponentCollection class allocates memory when getting the Enumerator, and Panel.Draw() is called every frame using that loop. The setup wizard alone took 0.7 KB before under DaggerfallUI.OnGUI(), now it is 0."
485626605,Change Automap toggle to GetKey method,jefetienne,2020-09-12 01:19:07+00:00,2020-09-15 23:43:37+00:00,{'UI': 1},For bindable combo keycodes to work properly when closing a window that has a binding using Shift/Ctrl/Alt.
485623688,Bindable KeyCode combinations,jefetienne,2020-09-12 01:14:19+00:00,2020-09-15 23:38:58+00:00,{},"Introduces a way for players to bind a combination to a single action in the controls window, e.g. ""LeftShift + K"", ""RightControl + K"", ""K + V"", ""[ + /"", ""Joy3B0 + JoyB2"".

Since KeyCodes are 32-bit integers, the max length of the KeyCode enum is around 300, and the axis KeyCodes are less than 16-bits long, I managed to store two KeyCodes into one as *15* bits each. (I chose 15 instead of 16 so the most significant bit isn't 1 and becomes a negative number.) You can create a combo by using `GetComboCode(key1, key2)`.

When binding in the controls window, it will make sure that:
 - There is no duplicate combo (e.g. two ""LeftShift + K""s)
 - The modifier is not used independently in any other binding (e.g ""LeftShift + K"" and ""LeftShift"")
 - The modifier is not used as a key (e.g. ""LeftShift + K"" and ""F + LeftShift"")

When pressing a combo, it will make sure that:
 - The modifier is ""held first"" - meaning it is being held solely without any other keys that are combo'd to that modifier (e.g. LeftShift+K jumps, LeftShift+L opens a menu. It checks to make sure that either 'K' or 'L' are not being held. It will ignore keys that are not combo'd to it, like 'W' for forward.)
- It will also check to make sure no other modifiers are being held.

If a modifier is being pressed, the system will ignore the combo'd key as being pressed independently (e.g. Shift+Space sheathes weapon, Space jumps. When holding Shift, `GetKey(KeyCode.Space)` will return false so it prevents jumping.)

In order to detect other non-independently binded keys as being held, the way input got handled had to be rewritten to a polling system that examines every `KeyCode`. It sounds expensive, but I managed to optimize it as best as possible and for it to be only 0.05-0.08 ms more time spent in the `Update()` function according to the Unity Profiler, which is unnoticeable (at least on my end). Also, because of the new system, I was able to remove much of the old joystick axis code.

`HotkeySequences` used the Unity `Event.current` system in `OnGUI()` for key detection, but couldn't sync to the polling system and detect any GetKey methods. I had to rewrite that part so `DaggerfallUI` has an event-driven `OnKeyPress` method and uses a custom `Event` that gets modified in order to get the `HotkeySequences` working again."
485446927,Add conversion methods between Tuple and ValueTuple,rossipaolo,2020-09-11 20:48:37+00:00,2020-09-15 10:31:33+00:00,{},
485161422,Discard virtual mods without a valid title,rossipaolo,2020-09-11 14:56:40+00:00,2020-09-13 19:11:52+00:00,{'mod system': 1},Title is a mandatory property of ModInfo manifest file. An empty or null title causes several issues so mods without a valid title are now ignored logging an error.
485131797,Minor improvements to mod loader UI,rossipaolo,2020-09-11 14:26:30+00:00,2020-09-15 10:31:13+00:00,{'mod system': 1},"- Remove characters limit to use all the available space with SDF font rendering.
- Use different text color for enabled/disabled mods.
- Use different background color for show description button if mod doesn't have a description.

![mod-loader](https://user-images.githubusercontent.com/24359151/92945568-bdaf4800-f455-11ea-86c4-9aeec1d2f30a.jpg)

"
484580865,Small fix and improvements to remove assignment message box,jefetienne,2020-09-11 03:07:48+00:00,2020-09-15 10:30:48+00:00,{},"- When right-clicking a button with hidden text (""...""), the remove assignment will actually display the Keybind and not ""...""
- Message box wraps text
- Regex-spaced out the Action name"
484426636,Quest fixes Sept 2020,JayH2971,2020-09-10 23:13:26+00:00,2020-09-15 10:29:41+00:00,{'questing': 1},
482354781,Improved keybind label text and tooltips,jefetienne,2020-09-08 22:58:26+00:00,2020-09-11 01:35:22+00:00,{},"https://imgur.com/a/rBGxQzS

- Changed the display of KeyCodes without altering the strings that are serialized in Keybinds.txt. Non-alphabetic keys are displayed as their true character, except for numbers. Joystick buttons are displayed as ""Joy BX"" and Joystick axis buttons are displayed as ""JoyX BY"".
- When in non-SDF rendering, it will display certain KeyCode strings in a Daggerfall DOS-inspired format (barring some such as ""SPCEBAR"", mouse buttons like ""M 1"" and ""M 2"", etc.)
- If the KeyCode string is too long (in preparation for custom combo codes), the label text will display `...` and you can hover over it to see its full name. The tooltip gets updated/disappears if a smaller-length KeyCode string is binded. If you would like to test this, change the `ControlsConfigManager.maxButtonTextLength` to a small number.

"
482255478,Move satiation check to a public accessor for mod access,ajrb,2020-09-08 19:39:34+00:00,2020-09-11 01:25:07+00:00,{},Regression tested by Ralzar
481778195,(Regression fix) Allow some hotkey sequences to look for secondary bindings,jefetienne,2020-09-08 05:08:09+00:00,2020-09-11 01:24:51+00:00,{},"The `toggle_close` hotkey sequences under the Automap windows must look for the secondary bindings so that way the menus can be toggled off with either button. Otherwise, by default `HotkeySequence`s will not."
481507261,Mod Dependencies Editor,rossipaolo,2020-09-07 15:57:04+00:00,2020-09-08 01:18:24+00:00,"{'mod system': 1, 'editor': 1}","Added an editor window to edit mod dependencies. It's available from Mod Builder window.

![mod_dependencies](https://user-images.githubusercontent.com/24359151/92404296-73675780-f133-11ea-8162-1b13cb5c8fb9.jpg)
"
480967017,Ignore secondary binding equivalents for GetMouse methods and HotkeySequences,jefetienne,2020-09-07 01:29:30+00:00,2020-09-08 01:17:13+00:00,{},"Small oversight when designing secondary keybinds allowed `GetMouse` methods and `HotkeySequences` to look for the secondary equivalents of a specific key when it wasn't supposed to. Created a default parameter for GetKey methods to look for the secondary by default, but set them to false instead for the `HotkeySequence` methods, and used the `GetSingleKey` methods for the `GetMouse` methods."
480936250,"Change default bindings of Run and Sneak to Left Shift and Left Alt, respectively",jefetienne,2020-09-06 23:54:32+00:00,2020-09-08 03:35:38+00:00,{},"It seems that it was intended to have both Shifts and Alts be able to work Run and Sneak but when written at the time, there wasn't any support for secondary bindings, thus the ""right"" versions of the keys accidentally overrode the ""left"" versions in the default bindings.

I think it's better to just default them to the ""left"" versions since they are closer to WASD, but leave it up to the player if they want to include the ""right"" versions in their secondary bindings.

I also fixed some space formatting issues made by earlier PRs."
477330529,Made NextObjectOffset and PreviousObjectOffset public to fix dungeon ‚Ä¶,BadLuckBurt,2020-09-01 20:56:46+00:00,2020-09-08 01:15:12+00:00,{},"‚Ä¶activators. Any dumps made before this change will need to be re-dumped for it to work.

"
475386771,"Replace mispelled ""sorceror"" with ""sorcerer"" in quests",df-ferital,2020-08-28 12:48:22+00:00,2020-09-08 01:14:37+00:00,{},"Fixes done to quest texts only, to avoid any potentially breaking change."
474956864,Allow mods to set extra blend space around locations for placing content,ajrb,2020-08-27 21:18:03+00:00,2020-09-08 01:13:38+00:00,{},Basically gives control over flattening a wider area based on location type. Requested by Kamer for his stables modding work.
473419855,Implemented cn2 macro for jokes,ajrb,2020-08-25 19:44:54+00:00,2020-09-08 01:10:12+00:00,{'bug': 1},Just grabs first city in region list since it's only used in one joke but appears twice so either needs context or deterministic behaviour... I chose the easy latter.
473392889,Don't show holiday text message unless HUD is top window,ajrb,2020-08-25 18:52:27+00:00,2020-09-08 01:08:55+00:00,{},"It can mess with non-modal UI's like those used by Tedious Travel etc.

I think this works well, but I would be interested in other devs opinions before this one gets merged. Motivated by holiday message boxes messing up the travel UI of my upcoming Travel Options mod when they pop up at the wrong time."
473202405,Set the race of static NPCs,df-ferital,2020-08-25 13:24:37+00:00,2020-09-08 01:08:21+00:00,{},"Static NPC race is now stored in its own dedicated field. If not available from faction data, fallback to race of current region.

This also fixes an issue reported by @petchema in #1902 where Aubki-i was using %oth in a quest before being assigned as questor. The previous workaround was a fallback to race of current region. Now, Aubk-i will properly use the Redguard pool of oathes."
472866184,Preprocessor definiton for separate development persistent path,jefetienne,2020-08-25 01:16:10+00:00,2020-09-08 01:07:01+00:00,{},"Added a commented-out preprocessor definition under `SettingsManager` called `SEPARATE_DEV_PERSISTENT_PATH`, which allows development under the Unity editor to use a separate data directory called ""DaggerfallUnity.devenv"", which is alongside the default path. This is useful for separating recreational saves and settings from the development side for organization, and to prevent wiping of settings not yet implemented in the stable release.

I grepped and replaced all instances of `Application.persistentDataPath` with `DaggerfallUnity.Settings.PersistentDataPath`."
472196034,Update joystick minimum force and acceleration,jefetienne,2020-08-24 00:00:27+00:00,2020-09-08 01:05:52+00:00,{},"After having unstick handling removed, there no longer needs to be an arbitrary float value in place that prevented it from going off. Additionally, the `JoystickMovementThreshold` (the ceiling value for maximum movement via joystick) is now used to scale with the distance of the joystick. So if the `JoystickMovementThreshold` is 0.5 and the user moved their joystick at 20% distance from the center, their force would be 0.2 / 0.5 = 40%. Compare this method to having 49% distance as 49% force, but 50% distance = 100% force."
471956061,Dungeon shallow water splash sound,petchema,2020-08-22 08:07:24+00:00,2020-09-08 01:03:50+00:00,{},"Make sure water splash sound plays when walking in dungeon shallow water
[SAVE646.zip](https://github.com/Interkarma/daggerfall-unity/files/5112087/SAVE646.zip)
"
471877011,Change screenshot capture to JPEG format,jefetienne,2020-08-21 22:15:23+00:00,2020-09-08 01:02:21+00:00,{},
471857812,Keybind right-click removals,jefetienne,2020-08-21 21:14:13+00:00,2020-09-08 00:36:14+00:00,{},"Added ability to right-click a keybind button which prompts if the player if they would like to set it to 'None'. This is useful for secondary keybinds where someone might accidentally bind the wrong button or no longer would like to use it. As of right now, they  would have to find an unused key to bind to it or set it to None in the Keybinds.txt file, but actually having an in-place removal would help with this issue.

One problem I encountered was the fact that DFU always assumed the primary keybinds (`InputManager.actionKeyDict`) to be non-`None` since there wasn't any need for them to be in the first place. This made finding secondary KeyCode equivalents based off of the primary KeyCode a problem if it was set to `None`, since there can always be duplicate `None`s. So I created an `existingKeyDict` that attempts to fill missing KeyCodes in primary binds with the secondary for the `FindKeyboardActions` and `GetKey` methods."
469140241,"More Disease info, can be charged with Breaking and Entering",DFIronman,2020-08-18 01:00:40+00:00,2020-09-08 00:33:05+00:00,{},"Currently, only ""Attempted Breaking and Entering"" is supported. This allows for the potential upgrade of the crime to full Breaking and Entering when you successfully break into the location. The check for Attempted Breaking and Entering is a Dice100.SuccessRoll(10). I did the same for Breaking and Entering (10% chance ""someone saw you"" breaking into the location). Guards are currently not being called for Breaking and Entering

Should guards ever be called for Breaking & Entering? I figure if this is implemented, being charged with Breaking and Entering in classic DFU is going to be a fairly edge case (probably: guards got summoned for Attempted B&E, you broke in, went back outside, and the guards arrested you).

Also, made IsDiseasePermanent() public instead of protected and added IsDiseaseCompleted() for modders."
468996352,Fix typo Sx01,JayH2971,2020-08-17 18:20:06+00:00,2020-09-08 00:32:04+00:00,{},
468489469,Remove static flags so they don't get shared,ajrb,2020-08-16 20:03:31+00:00,2020-08-16 23:51:50+00:00,{},
468464128,Log warning if texture is not readable but needs to be,rossipaolo,2020-08-16 16:15:05+00:00,2020-08-16 23:51:31+00:00,{},"Read/Write Enabled flag must be set by mod author if texture is to be edited at runtime (for example to cut a button out of window image).

![texture_not_readable](https://user-images.githubusercontent.com/24359151/90338947-82079680-dfed-11ea-939c-693d214cbb8c.png)
"
467964811,Add run quest action,rossipaolo,2020-08-14 12:46:45+00:00,2020-08-16 23:51:04+00:00,{'questing': 1},"Added an action that allows to start a quest and wait for it to end, setting task for success or failure. This is the syntax:

```
run quest QUESTNAME then _success_ or _failure_
```

and this is a simple test example:

```
Quest: __DEMORUN

QRC:

QBN:

Clock _clock_ 5

    start timer _clock_

_clock_ task:
    give pc nothing
    end quest
```

```
Quest: __DEMORUNMAIN

QRC:

QBN:

Clock _clock_ 5

    start timer _clock_

_clock_ task:
    run quest __DEMORUN then _success_ or _failure_

_success_ task:
    give pc nothing
    end quest

_failure_ task:
    end quest
```

The purpose of this action is to track progress in a chain of quests (and/or reusable subquests) with a more modern approach compared to global variables, at least when a single success flag is enough. Success state is scoped to the instance of the quest that started the other, so it forces a design that is easier to manage compared to a global flag that might be used in multiple locations and cause consequences that are harder to debug.
"
467538899,quests: remove extraneous empty messages,petchema,2020-08-13 17:38:51+00:00,2020-08-16 23:48:43+00:00,{'questing': 1},Forums: https://forums.dfworkshop.net/viewtopic.php?f=25&t=4035
467149221,Prevent intermittent enemy spawns on ship,petchema,2020-08-13 05:06:57+00:00,2020-08-16 23:48:16+00:00,{},"Didn't manage to get any in classic, so I assume this is classic behavior

Forums: https://forums.dfworkshop.net/viewtopic.php?f=5&t=3678
https://www.reddit.com/r/daggerfallunity/comments/i7xsm2/has_the_ship_bug_been_fixed/g17x6xd/"
465080335,Improve mod builder,rossipaolo,2020-08-08 22:17:45+00:00,2020-08-12 12:31:10+00:00,"{'enhancement': 1, 'mod system': 1}","A few improvements for the mod builder. These are the most significative changes:

- Do not allow to add an asset which is not saved on disk and would result in the inability to build mod. This can happen if asset is selected from scene hierarchy. A modal window with an error message explains to select assets from project window instead.
- Show a progress bar with information on current step. Most of the time is spent on API calls but is better than just showing an apparently stuck window.
- Prefabs and C# files need to be copied to temp location for edits before being added to assetbundle (rename to .txt and serialization of custom components). The import process is now performed only when all assets have been copied. Time spent on this step of building process is reduced from almost 15000 to 2000 milliseconds for Real Grass mod. It doesn't affect other kinds of assets.
- Improve handling of custom prefab serialization."
465064004,Added IsLoitering flag,jefetienne,2020-08-08 19:04:59+00:00,2020-08-16 23:45:22+00:00,{},"Added IsLoitering flag for modding purposes, without having to override the DaggerfallRestWindow (which can cause incompatibilities with other mods that do.)"
464845507,Make DefaultTerrainTexturer protected so can be extended,ajrb,2020-08-07 21:43:00+00:00,2020-08-07 21:43:08+00:00,{},
464790062,Made everything non-public protected,ajrb,2020-08-07 19:52:40+00:00,2020-08-07 19:52:46+00:00,{},Because I'm tired of finding new ones I need
464776344,Create ITerrainTexturing and allow overriding by mods,ajrb,2020-08-07 19:14:37+00:00,2020-08-07 19:56:54+00:00,{},Followed same pattern as TerrainSampler
464739637,Increase location extra clearance for cities,ajrb,2020-08-07 17:55:54+00:00,2020-08-08 03:02:57+00:00,{},"I think this is good change giving a wider area outside city walls before natures can get placed, and it incidentally also feeds into a mod I am making very nicely.

Please say if anyone objects."
464737785,Expose more of the travel map window for modding,ajrb,2020-08-07 17:51:11+00:00,2020-08-07 17:52:19+00:00,{},
463675080,Support for precompiled mods (experimental),rossipaolo,2020-08-05 22:27:27+00:00,2020-09-08 00:31:37+00:00,{'mod system': 1},Add option to Mod Builder to pre-compile C# scripts to a .dll file and add it to asset bundle as a binary asset.
459866038,remove unstick handling,petchema,2020-07-31 07:26:14+00:00,2020-08-08 03:03:21+00:00,{},Problematic cases seem now handled correctly by Unity 2019.4 capsule
459527299,Update item maker to use advanced item list,ajrb,2020-07-30 19:26:53+00:00,2020-08-16 23:37:11+00:00,{},Had to hide some of the UI due to different dimensions of a few pixels. Used panels for this as it was easier than manipulating the base image tex2D.
458663507,"Add motion limits for mods, and expose applying force publicly",ajrb,2020-07-29 20:03:34+00:00,2020-08-07 18:59:08+00:00,{},"@Interkarma - would like you to check you're okay with these changes. I can manage without them, they allow autowalking without using reflection and limiting horse strafe and backup speed."
458032796,Add water to dungeon automap,petchema,2020-07-28 20:18:48+00:00,2020-08-16 23:36:09+00:00,{},"Looks better than expected, given how simple is the shader modification.

![water3](https://user-images.githubusercontent.com/1211431/88716799-e7b7df80-d11f-11ea-9bbd-6de385fb6de3.jpg)

The MR can be squashed, I attempted another approach first on this branch that doesn't need to stay around...
"
457920042,Use faction race ID for oath,df-ferital,2020-07-28 16:28:07+00:00,2020-08-16 23:31:44+00:00,{},"This actually fixes a bug from classic to make NPCs use the correct oath from their respective races.

Oaths are declared by NPC race according to the race index used in FACTION.TXT. Unfortunately, classic never uses this faction race ID but, instead, uses the hardcoded index race of each region, which is not the same. In classic, this results in all NPCs from High Rock saying Nord oaths, while all NPCs in Hammerfell will say Khajiit oaths.

Instead, DFU uses the faction race ID to return the correct oath.

So now, when talking to Morgiah when she doesn't like you, be aware:

![Morgiah oath](https://user-images.githubusercontent.com/46795115/88693618-cc3cdc80-d0ff-11ea-9b7c-856dc1d4bb9a.png)

@deepfighter, finally, FACTION.TXT race ID has found its intended use :)"
457803846,Fix warning messages,rossipaolo,2020-07-28 13:19:09+00:00,2020-08-16 23:25:34+00:00,{},
457772853,UseDungeonTextureTable for RuntimeMaterials,rossipaolo,2020-07-28 12:20:16+00:00,2020-09-20 23:03:14+00:00,{},Added option for RuntimeMaterials to use the texture table of parent dungeon.
457417689,"Make getter public, keep setter internal",ajrb,2020-07-27 21:42:08+00:00,2020-07-27 21:42:30+00:00,{},
456338559,FACTION.TXT fixes,df-ferital,2020-07-24 15:05:43+00:00,2020-08-16 23:24:54+00:00,{},"This fixes a lot of errors in FACTION.TXT. My fix is built on top of DelphiSnake's one, which was itself built on top of PLRDLF's fix. To check the list of DelphiSnake's changes: http://slushpool.dfworkshop.net/fact-changes.txt

What I also changed:
- Lady Bridwell is now properly listed under the Daggerfall faction: doing quests for her will now also raise reputation with Daggerfall.
- The Knights of the Hawk are now properly listed under Antiphyllos: this fixes an issue in-game were a member of this order could't rent a room for free in the region taverns.
- King of Worms now appears on top of The Necromancers, as every other guild leader.
- King of Worms and The Necromancers race set to -1 (just for the sake of consistency, since this field is not used at all in classic nor in DFU).
- Necromancers male and female flats are set to ""174 3"" and ""174 5"" respectively, instead of using King of Worms' one.
- The Septim Empire's region is set to -1 and its guild group to 15 (Region).
- Isle of Balfiera ruler is set to 11 (Lady) and its race to 3 (Breton).
- Lord Khane is renamed to Lord Kain to remain consistent with lore.
- Added a female flat to the Court of Lainlyn.
- Changes in allies and enemies:
  - Baron Shrike is now the enemy of both Lord Kain and Lord Harth while the last two are allies.
  - The Host of the Horn and The Host of the True Horn are enemies.
  - Gortwog and Princess Elysana are now allied to Lord Woodborne.
  - Prince Helseth is now allied to Princess Morgiah and Karethys.
  - Princess Morgiah is now allied to the King of Worms.
  - King of Worms and The Underking are enemies.
  - Necromancers and Agents of the Underking are enemies.
  - The Temple of Stendarr is now the enemy of Boethiah instead of its ally (makes much more sense).
  - Lord Quistley is no longer allied to Lady Doryanna Flyte.
  - Charvek-si is no longer allied to Sentinel.
  - Br'itsa is no longer allied to Lord Harth.
  - The School of Julianos is no longer allied to Clavicus Vile.
  - The Temple of Kynareth and Lord Coulder are no longer allied to Daggerfall.

Concerning allies and enemies, there is probably more to do."
455927933,Relax permissions to allow window extension by mods,ajrb,2020-07-23 20:12:20+00:00,2020-07-27 20:00:53+00:00,{},"So here'a another of my messy grab bags of trivial changes. I am happy to merge myself unless anyone has a concern with any of this. Nothing controversial I think.

- Allow tavern window extension by mods, this is for Ralzars Calories mod so he can modify the tavern food & drink menu action.

- Allow travel map and popup extension by mods, for a new auto travel mod I'm making.

- Change horse animation to use unscaled time so it doesn't go mad at higher time acceleration - since it's in the players face, it doesn't look good.

- Expose the location type display name mapping from macros to public use."
455600261,"Fix %imp, %mn and %fn",df-ferital,2020-07-23 10:02:02+00:00,2020-08-16 23:20:19+00:00,{},"Based on classic reverse-engineering:
- %imp is only used to get a random name for the Emperor's son from a list of names extracted from FALL.EXE.
- %mn and %fn (male name and female name) are used in biographies and in a Noble quest to get a random full name, not first name.
- %mn2 and %fn2 do exactly the same, differing only from the above by using a different random seed."
454741015,Fix quest faction macro expansion,df-ferital,2020-07-21 20:54:17+00:00,2020-08-16 23:19:45+00:00,{},"Quest faction macro wasn't expanded correctly when referring to another NPC than the questor. Again, the issue was reported by our quest expert @JayH2971: https://forums.dfworkshop.net/viewtopic.php?f=31&t=2109 :)

I also fixed factions IDs of vampire involved in quests since I noticed they were wrong while I was checking my fix against quest `R0C60Y24`, which uses `==vampire_` in the same way quest `P0B10L08 ` uses `==daedra_`."
453834333,Upgrade support for providers of mobile person graphics,rossipaolo,2020-07-20 21:01:23+00:00,2020-08-16 23:18:46+00:00,{'mod system': 1},"Fixes some regressions:

- Unity 2019 doesn't allow to destroy or reparent gameobjects that are part of prefab instances. When a mod provides an override, the default gameobject is only deactivated instead.
- Custom providers of MobilePersonAsset that use colliders need to define a layermask to support functionality that checks for geometry in the way of npc path (regression introduced some time ago with `MobilePersonMotor.IsDirectionClear()`)."
453238025,Fix %god macro to match classic behavior,df-ferital,2020-07-20 09:19:32+00:00,2020-08-16 23:17:55+00:00,{},"This fixes %god macro expansion to match classic, see the issue reported by @JayH2971 here: https://forums.dfworkshop.net/viewtopic.php?f=31&p=45914#p45914. I fixed only `QuestMCP.God()` here, but the method could have been used globally.

While doing so, I moved an array extracted from FALL.EXE to `MapsFile` since it is also used in classic for the %god macro.

@ajrb "
451338655,fix parchment tearing,petchema,2020-07-17 18:21:52+00:00,2020-07-19 07:06:44+00:00,{},Simplest fix: fix parchment tearing by rounding coordinates where textures must meet
451269618,Fix parchment tearing,petchema,2020-07-17 16:54:12+00:00,2020-07-17 17:32:08+00:00,{},"Round all coordinates where textures need to rejoin
Simple fix, not a general solution for changed GUI.DrawTexture() behavior change"
450646543,Added support for secondary keybindings,jefetienne,2020-07-17 01:04:58+00:00,2020-08-15 03:25:44+00:00,{},"
[[Images](https://imgur.com/a/7wrMblw)]

Adds support for secondary keybinds, which can be accessed via a small toggle button at the top right of the controls window. By default, they are unpopulated, although later in the future I will create ControllerConfigs that will have loadout configurations specific to the controller type and OS.

Any cross-unary conflicts will be highlighted as blue (to help colorblind people distinguish it from yellow or red/""dark yellow""), and the player cannot ""Continue"" until resolving them, but can switch between primary and secondary. Any internal (red) conflicts made, and they cannot switch between primary and secondary until that gets resolved first.

To not bloat the controls window and avoid static code, I made a ControlsConfigManager that sets aside much of the cross-window logic from the main controls window. Also fixed a bug with unknown actions - if the player had an unknown action that was bound to a certain key, using that same key to rebind to an existent action would cause an exception and fail to update Keybinds.txt. Now, if it is rebinded, it will erase the unknown action (as it should be repopulated anyway if they switch to a newer version.)"
448711401,Early Localization Support,Interkarma,2020-07-14 07:51:55+00:00,2020-07-14 07:52:02+00:00,{},"Evaluation process completed in branch and satisfied with outcome.
Merging baseline changes to master and will continue incremental development from there."
448586211,Quest typo fixes,JayH2971,2020-07-14 01:17:04+00:00,2020-08-15 02:33:54+00:00,{},"Just used UESP as a guide to find typos in quests, to fix them. Also updates the quest list to show that everything enabled has passed testing."
448525744,Refactor TalkManager for More Readability,dyanikoglu,2020-07-13 22:15:29+00:00,2020-07-16 08:36:33+00:00,{},"I'm just playing around with the project, and decided to refactor a random class as a warming up while trying to understand how it works at the same time :)

I'm not sure if you have a coding standard for C# scripts, but I assume my changes adds some readability."
447958925,Prevent point blank spellcasting into low obstacles,petchema,2020-07-12 21:45:02+00:00,2020-08-15 02:30:25+00:00,{},"When enemy casters can see their target but are right behind some obstacle (say low obstacles like tables, fountains,...), the SphereCast used to check whether they're free to cast can miss the obstacle and allow them to cast, potentially damaging themselves (in classic lich style). An easily reproducible example of such behavior can be triggered in Orsinium entrance hall, if you agro the orc shaman but keep tables in his way.

Starting SphereCast from some position behind the caster could be a workaround, but since its radius is usually larger than caster's capsule radius, it's not very satisfactory (you don't start the SphereCast from inside a ""known empty space""; The right offset would also depend on enemy capsule radius).
So instead I prepend the SphereCast test with a SphereCheck at its origin, temporarily excluding caster's collider.

I do not check whether that SphereCheck hits the target (point blank shooting), so HasClearPathToShootProjectile() will return false in this case, favoring other attack types (melee, touch spells,...)"
447897600,Improve doorways pathfinding (again),petchema,2020-07-12 13:03:44+00:00,2020-08-15 02:27:12+00:00,{},"This is basically an improvement over #1733.

In #1733 is conservatively lowered pathfinding probe distance from 1 to 0.8f. After more testing, lowering this distance further improves AI performance.
The first thing to notice, is that because probing is done using a CapsureCast with half the player's capsule radius, everything in probing geometry is proportional to player's capsule radius.
Second, if you consider the cast of following a flat surface (typically a wall), there's some relation between the ratio of probe length to capsule radius and the angle of incidence of probing: sin a = r / 2l
![spherecast pathfinding](https://user-images.githubusercontent.com/1211431/87246784-b963b000-c44f-11ea-8ea9-0edd8cff65c4.png)
Very low incidence will make it hard to find doorways, very high would probably slow down progression along the wall, and a = 45¬∞ <=> l = r / sqrt(2) seems to give good results. The only other values I tried were a = 30¬∞ <=> l = r is worse (and so should be even higher values of l) and a = 60¬∞ <=> l = r / sqrt(3) that felt okay but somewhat slower.
The only bad side effect I could think of, and the reason I was conservative the first time around, is that enemies start avoiding obstacles from a shorter distance, however I have no evidence this is a real problem (the original probe length of 1 seems to have been chosen arbitrarily in retrospect).


I also slightly modified probe height from 1.75f to 1.65f (and factorized that height), since it has been modified since c282fc667a43f486be91e09fe77cafc351ad5e3f
By the way, it seems Unity 2019.4 seems to also help tall enemies not getting stuck into doors"
447722292,Update to current master,Interkarma,2020-07-11 05:25:56+00:00,2020-07-11 05:26:02+00:00,{},
447220864,Update to current master,Interkarma,2020-07-10 04:46:01+00:00,2020-07-10 04:46:08+00:00,{},
447158922,Minimum upgrade to 2019.4.2f1 LTS,Interkarma,2020-07-10 00:30:31+00:00,2020-07-10 00:30:45+00:00,{},"Same playbook as previous 2019.3 test branch. Keeping DaggerfallUnity Tuple for moment. Can be changed selectively later.
Also noticed some texture tiling cracks (e.g. on letter popups) at certain screen dimensions. Will need to investigate this."
445006445,Correct %lp macro implementation,df-ferital,2020-07-06 21:16:37+00:00,2020-07-19 13:46:36+00:00,{},"This macro is used to get the current province name (reverse-engineered from classic). It is only used in TEXT.RSC record 8375, which corresponds to Mid Year 16th celebration text."
444311256,prevent initating fast travel during day with damage-from-sunlight disadvantage,petchema,2020-07-04 17:49:21+00:00,2020-07-05 01:08:39+00:00,{'bug': 1},"(I did you try factorizing code with plain vampirism. Could probably be done using something similar to  #1847 but for fast travel?)

Forums: https://forums.dfworkshop.net/viewtopic.php?f=31&t=3710"
443811861,Update to current master,Interkarma,2020-07-03 01:56:21+00:00,2020-07-03 01:56:31+00:00,{},
443673858,Added BowDrawback and ToggleSneak settings to advanced controls window,jefetienne,2020-07-02 18:16:09+00:00,2020-07-02 23:36:41+00:00,{},"[[Image](https://imgur.com/a/emKM5QD)]

Requested by some people on Reddit a while back. Also reordered the settings to look neater."
443631005,Fix import of classic old guild records,df-ferital,2020-07-02 16:40:15+00:00,2020-07-03 22:36:46+00:00,{},"This fixes #1849 properly, by importing old guild membership records. @Interkarma I removed your exception handling code since it shouldn't be required anymore. However if you prefer that it remains, I will put it back.

@ajrb, could you review the changes as well? I provided a classic save with a character cured from vampirism in #1849, having a single old guild record (Kynareth at novice rank). I had to modify GuildMembership.RestoreMembershipData to avoid an importation bug where this old guild membership was overwriting the actual player membership in Kynareth at patriarch rank."
442706476,Fix proper refreshing of recorded previous axis input once per frame,jefetienne,2020-07-01 13:38:43+00:00,2020-07-01 22:31:41+00:00,{},"The `previousAxisRaw` dictionary could be set multiple times per frame, causing issues with GetKey methods if called sequentially:
```
if(InputManager.Instance.GetKeyUp((KeyCode)(5015))) //true
    Debug.Log(InputManager.Instance.GetKeyUp((KeyCode)(5015))); //false, should still be 'true'
```
This was found in the inability to close the automap window when binded to an axis button (e.g., D-pad, shoulder buttons) by #1810. This PR fixes the issue by queuing the previous input into a list, that will be merged and cleared once per frame in the Update method."
441716936,Mod support for custom resting prevention,jefetienne,2020-06-30 00:37:50+00:00,2020-07-01 22:26:52+00:00,{},Allows modders to register conditions and messages for preventing or interrupting a rest via `GameManager` with `RegisterPreventRestCondition`. The conditions can also be unregistered as well with `UnregisterPreventRestCondition`.
441104492,[RFC] make ghosts and wraiths highlights slightly emissive,petchema,2020-06-28 19:42:32+00:00,2020-06-28 22:41:07+00:00,{},"I do like the version of ghosts and wraiths in master, it's really close to classic in term of look and stealthiness, with just more details up close with some lighting. This PR is just an alternative that I find interesting.

It make ghosts and wraiths highlights slightly emissive (more focused on highlights than just a constant emissive value). Shouldn't make much difference under bright light, including classic high ambient light conditions.
In dark places however, it gives a hint of the baddies, as if they were slightly phosphorescent
![spectres highlights 3](https://user-images.githubusercontent.com/1211431/85956727-0d6a9100-b988-11ea-86c5-74d8158f7f70.jpg)
"
440954735,Implement vampire guild membership switching,ajrb,2020-06-27 19:53:20+00:00,2020-07-01 22:29:30+00:00,{},"Switches the guild memberships when player is a vampire, switching back when cured. Nothing else is changed, no reputations or TG/DB initiation processes. I implemented it differently from classic, instead of switching round two data structures I simply access the appropriate one. Trying to minimise the dependencies here and not rely on vampirism triggering the swap.

Classic imports should work too, but I don't have any classic vampire saves so unable to test this. Could someone else test that it works correctly please?

Also fixed a bug with finding region factions."
440863056,Added Joystick Controls Window,jefetienne,2020-06-27 05:18:49+00:00,2020-07-01 22:20:23+00:00,{},"[[Image](https://imgur.com/a/XouZv5R)]

Added the Joystick Controls Window, which allows players to:

- Enable/disable the controller in realtime, like the startup wizard
- Rebind their joystick axes, in case of controller or OS differences. It can also be used for preference, like using the D-pad for movement instead
- Invert axes, both horizontally and vertically. The ""Invert Mouse"" setting in the Advanced Controls Window can also coincide with the vertical camera axis, so it has been renamed to ""Invert Look-Y"".
- Rebind left- and right-click keybinds
- Adjust look sensitivity, cursor sensitivity, maximum movement threshold, and deadzone. Deadzone can only be set up to 0.9, as 1.0 is near impossible to reach consistently with most controllers

Except for the Enable Controller setting, all settings get applied and saved after clicking 'continue' in the main controls window. Resetting to default in the main controls window will also reset joystick bindings."
440309473,WIP: ghosts and wraiths shader,petchema,2020-06-25 23:40:46+00:00,2020-06-28 00:18:25+00:00,"{'enhancement': 1, 'wip': 1}","Use semi-transparent shader for ghosts and wraiths. This works quite well with modded textures, but SetSoectral() is lacking for
classic textures (not extracting emissive map for the eyes, nor extracting all the details of the original textures)
![ghost and wraith](https://user-images.githubusercontent.com/1211431/85805957-08220200-b74e-11ea-8eb7-321fbd686ff4.jpg)
modded (DREAM):
![modded ghosts](https://user-images.githubusercontent.com/1211431/85828897-a5e6f280-b789-11ea-9d93-e0465b1c8719.jpg)
"
438968702,Properly end resting when stopped prematurely,jefetienne,2020-06-24 05:22:43+00:00,2020-06-27 02:42:26+00:00,{},"Previously, if the player is currently resting, and they stop it prematurely via the 'Stop' GUI button, the toggle window key, or the escape key, the hours they slept for would not actually be accounted to raise skills, and neither would there be a popup saying ""you wake up"" or ""you are healed"" when done so.

This PR resolves this issue by isolating all exits to `EndRest()` when the player stopped while resting, or `CloseWindow()` if the player was on the selection menu. I also made a small change where if you choose to rest ""until fully healed"", but end it prematurely, the message will say ""You wake up"" instead of ""You are healed"", since the player wouldn't be fully healed. "
437440343,"Controller fixes, improvements and additional settings related to cursor issue",jefetienne,2020-06-20 17:43:46+00:00,2020-06-27 02:32:17+00:00,{},"- Added ""joystick deadzone"" setting, a value between 0 and 1.0 (0-100%) that is the minimum percentage of joystick movement required to be recognized by the game. This should help with joysticks that have issues such as drifting or are too sensitive and generate small amounts of movement that get captured in other ways.

- Added ""Enable Controller"" setting to the setup wizard that can disable the controller in realtime, and will have to be re-enabled by the use of a mouse.

- Improvements to the cursor flickering and clicking bug. _(**Note**: If you do not have the flickering issue and want to test this, just keep a joystick moved in one direction with one hand and move your mouse with the other.)_ The flickering is caused by a constant tug-of-war between the cursor going into ""mouse mode"" and ""controller mode"" if the controller is generating movement on its own. Even if the deadzone setting still doesn't help, now the mouse takes priority over the controller whenever the mouse is moving, minimizing the flickering. I also changed the logic of the `GetMouseButton()` so it can recognize both the mouse or controller button clicking better even while flickering.

- Joystick deadzone and cursor speed is now applied upon loading the setup wizard. If in the future these options get room to have their own sliders in the advanced settings menu, I think any adjustments also should be applied in realtime."
437359831,Update to current master,Interkarma,2020-06-20 03:47:54+00:00,2020-06-20 03:48:03+00:00,{},
434845963,Prompt warnings for modlist mismatches in saves,jefetienne,2020-06-15 22:12:27+00:00,2020-06-27 03:06:11+00:00,{},"[[Forum post](https://forums.dfworkshop.net/viewtopic.php?f=22&p=44732&sid=3c2b933a14b59a211a0b54c797f6cb4d#p44732)]

[[Images](https://imgur.com/a/sDN4tUb)]

SaveData.txt will now serialize information about mods used at the time of saving - `fileName`, `title`, `guid`, `version` and `loadPriority`. While this serialized information is mainly used for displaying mod incompatibilities when a player loads or quickloads a save, they can also be useful for mod creators to warn players about particular versions or incompatibilities with mods in their own way as well.

Loading a game will compare the saved `ModInfo_v1[]` in SaveData.txt by the currently enabled and loaded-in mods against its GUID. If it cannot find the a mod with the same GUID, then it will say ""Mod is either not loaded or has been altered."" If it has been found, then it will compare against their versions and warn if the loaded mod is older than the recorded one, or if the versions are incompatible (e.g. '1.0' vs 'banana').

There is an issue with the scrollbar getting in the way of the first line of text, but I think that should be resolved as a separate PR just to extend the message box width a bit more."
431619005,Typo fixes in quests part 1,JayH2971,2020-06-09 08:22:53+00:00,2020-06-09 08:49:06+00:00,{},"Mainly using UESP's suggestions as a guide. Order of fixing is random, not yet finished."
428047720,[RFC] Support all cursor sizes,petchema,2020-06-04 19:39:24+00:00,2020-08-15 01:52:05+00:00,{},"Hardware cursor on Windows only supports up to 32x32 pixels cursors; That has been detected because DREAM defines a 64x64 pixels cursor, but it could only be seen on other platforms (at least on Linux) whereas on Windows you only got a 32x32 downscaled version.

Another consequence is that tooltip text was not correctly positioned relative to the mouse pointer on Linux when using large custom pointers.
(Forums:
https://forums.dfworkshop.net/viewtopic.php?f=5&t=3805&sid=565b12db579c16e22326106c391d1ada )

This can be fixed in several ways:
- require custom cursors to be 32x32 pixels. No code change needed;
- forcefully downscale cursor textures to 32x32 pixels to get uniform results on all platforms. Getting good results is actually a difficult matter, I'm not sure what algorithm does Windows use, many classic algorithms don't handle transparency very well (edit: wrote one: https://github.com/Interkarma/daggerfall-unity/compare/master...petchema:downscale-cursors-larger-than-32x32 );
- try to stick with original cursor size, which may require to turn off hardware cursor depending on platform and cursor size. This is what this PR does. Tooltip text positioning is also adjusted to match.

The main drawback I've experienced with software cursor is that it feels a little less responsive than the hardware accelerated counterpart.

(if anyone has an idea how to make Tooltip.cs change more efficient, I'm interested)

DREAM with hardware cursor:
![hardware cursor](https://user-images.githubusercontent.com/1211431/83802301-cb14a380-a6aa-11ea-8fe6-5657dee3e0bc.jpg)

DREAM with software cursor:
![software cursor](https://user-images.githubusercontent.com/1211431/83802339-db2c8300-a6aa-11ea-8ab5-127d73c60211.jpg)

@HybOj any opinion on this, was larger cursors what you expected?"
427988858,fix for missing buildings bug (when doing round-trips between locations),Nystul-the-Magician,2020-06-04 17:40:31+00:00,2020-06-20 03:14:38+00:00,{},"see this forum-thread where the bug was reported:https://forums.dfworkshop.net/viewtopic.php?f=4&t=3391&start=10)

the reason was that StreamingWorld class can reuse terrain array elements when needed - it marks no longer needed terrains as ""Pooled"" and keeps them in memory until memory is needed for new terrains. If pc turns around and travels back the ""Pooled"" terrains can get reused. If the ""Pooled"" terrain  was a location map pixel buildings get destroyed as soon as terrain becomes ""Pooled"" - so this change enforces that buildings of reused ""Pooled"" terrains which contain a location are loaded again."
426814659,fix ComputeCanHoldAmount() rounding errors locally,petchema,2020-06-02 20:32:34+00:00,2020-06-20 02:32:50+00:00,{},"Round all inputs into multiples of a gold piece weight then use an integer division.
This works fine with classic weights, because beside gold pieces, all weights are multiple of ""classic unit"" (250g), which is also a multiple of gold piece weight.

Simplest alternative to #1830"
426499285,Set Montalion spell to Recall,df-ferital,2020-06-02 10:37:58+00:00,2020-06-20 02:22:57+00:00,{},"This fixes a classic issue where Montalion vampires are given the Free Action spell, which is completely useless for vampires since they are all immune to paralysis.

Instead, it gives them Recall, as was originally intended, since we can read from from ""Vampires of the Iliac Bay"":

_Montalion alone have the gift for teleportation, but the other eight have powers of their own._

This classic bug was originally mentionted by DelphiSnake: http://slushpool.dfworkshop.net/BUGS.html"
425702398,Targeted Changes To Access Modifiers For Some UI Windows,magicono43,2020-06-01 01:11:54+00:00,2020-06-20 02:22:22+00:00,{},"Changed access modifiers for UIWindows to allow for more simple modification and overriding of textures and already existing buttons, etc.

Please feel free to make changes if they don't seem necessary."
424806795,[Joystick Controls] Added bindings for UI mouse clicks and inversions of axes,jefetienne,2020-05-28 23:52:58+00:00,2020-06-20 03:06:28+00:00,{},#1817
422322623,Refactor CreateCharClassQuestions for greater readability,numidium,2020-05-23 20:22:35+00:00,2020-05-28 23:30:38+00:00,{},"My current iteration of the GetHeaderIndex method is messy and hard to understand. This is mainly because I manually translated it from assembly code that may have had compiler optimizations applied to it. 
I initially left it as is for fear of breaking it. However, now that I've run it through a driver program to compare results with every possible input on my old and new versions of the method, I'm confident that this won't change functionality."
422081689,fix encumbrance rounding errors,petchema,2020-05-22 18:29:11+00:00,2020-06-02 20:33:05+00:00,"{'wip': 1, 'refacto': 1}","Convert weight computations to integers using mulitples of gold piece weight.
This fixes possibles minor errors, the most visible being you can sometimes pick an additional item by trying again. Round weights may also be displayed in the interface with .00 decimals when they shouldn't.(and removes the warnings in the editor that this problem could happen).
I kept the getters for weights in Kg for mods compatibility.
"
421903439,Fix daedra summoning to match classic behavior,df-ferital,2020-05-22 12:55:13+00:00,2020-06-20 02:21:05+00:00,{},"I reverse-engineered classic function regarding daedra summoning. And as often, I noticed it somewhat contradicts the information found on the UESP. In particular, there is not such thing in classic code as a 95% maximum chance of summoning a dadrea (it's always a roll between 1 and 100), where the ""5 % chance"" left would be the chance for Sheogorath to replace the daedra.

In classic, it is as follows:
Sheogorath has a 5% chance of replacing the daedra (15% under thunderstorms), so he gets a dedicated roll for that, even with The Glenmoril Witches who usually summon Hircine (this is intentional).
Then, and only after Sheogorath has replaced or not the daedra to summon, the summoning chance is computed and the summoning success or failure roll is done.

I modified DFU's code accordingly."
421029158,New retro postprocessing setup with depthbuffer filtering for sky,Interkarma,2020-05-20 21:28:41+00:00,2020-05-27 23:04:50+00:00,{},@petchema I'm pretty happy with this one now. Promoting to a PR for final review.
420839273,Cast when held item condition lowering,df-ferital,2020-05-20 15:49:08+00:00,2020-06-20 02:10:10+00:00,{},"The behavior was reverse engineered on DF forums by Numidium and Elenwel and confirmed by my own reverse engineering, see here: https://forums.dfworkshop.net/viewtopic.php?f=23&t=3621

Since @Allofich did most of the job some time ago, there was very little to do there.

The only difference from classic is that DFU takes all item ""Cast when held"" effect costs to lower the item condition, where classic takes only the last one."
419069915,[RFC] Travel map dot outlines,petchema,2020-05-17 06:45:35+00:00,2020-06-20 02:48:33+00:00,"{'enhancement': 1, 'UI': 1}","Make region maps more accessible to color blinds by adding an outline to location pixels.
It actually makes it easier to point at locations, so it could be seen as a general improvement.

Forums: https://forums.dfworkshop.net/viewtopic.php?f=4&p=43718#p43717

The implementation uses Panels for the outlines, works well but may be too hackish?
Also, ir probably needs to be made an option or have a keyboard toggle.
![outlines 2 - 128](https://user-images.githubusercontent.com/1211431/82137710-c16ded80-981a-11ea-8c43-1461539ea6c6.jpg)

"
418361536,Lookup table palettization,petchema,2020-05-15 03:55:50+00:00,2020-05-20 23:17:02+00:00,{'enhancement': 1},"Very fast palettization (up to 280~300 fps on my hardware) using a Texture3D as lookup table.
I get results pretty close to my previous shader by dropping 1 bit from each color component (128x128x128 lookup table). Texture takes 8MB and requires ~~2.4s~~ 850ms (on my hardware, again) to initialize.
Other tradeoffs can be made by modifying lutShift in RetroRenderer.cs (that I haven't exposed as a setting... yet?)
I could also lower memory requirements to 1/4th by only storing palette indexes in the lookup table, at the price of an additional lookup in color palette..."
417742604,Update to current master,Interkarma,2020-05-14 04:26:58+00:00,2020-05-14 04:27:10+00:00,{},
417549357,Added City Bulletin Boards,GalacticChimp,2020-05-13 18:55:27+00:00,2020-09-08 00:28:56+00:00,{'wip': 1},"These work properly (i.e. very similar/same as Classic)

Additional info: https://forums.dfworkshop.net/viewtopic.php?f=23&t=3661"
415739464,"Fix GetKey usage for pausing, screenshots, and console",jefetienne,2020-05-10 15:44:09+00:00,2020-06-20 01:51:06+00:00,{},"They all used to use Input.GetKeyX, which would cause an exception if a user were to bind a an axis button to one of them. Also, the console controller did not properly update its binding - it would have to be opened with the old keybind first, then closed with the new keybind to update the change.

I made all of them InputManager.Instance.GetKeyX, as well as made the console listen for OnSavedKeyBinds to update its own keybind."
415670824,Added Autorun action and keybind,jefetienne,2020-05-10 05:19:51+00:00,2020-06-20 01:56:25+00:00,{},"Pressing the middle mouse button will toggle autorun mode, which defaults to sprinting forward without holding any keys. While in autorun mode, the run key also becomes togglable, so you can resort to simply pressing the run key once to toggle it between autowalking and autorunning.

Pressing the Autorun key again, or just moving backwards, will cancel it.

I rearranged the order of the advanced control keybinds so similar actions are grouped on top of each other."
415656593,Strengthens/Weakens Armor bug fix,dmirizzi,2020-05-10 02:04:12+00:00,2020-05-28 22:52:47+00:00,{},Fixed strengthen armor enchantment - armor modifier is now correctly applied to player entity and correctly reflected in paperdoll
415646058,[Joystick Controls] Added bindings for UI mouse clicks and inversions of axes,jefetienne,2020-05-09 23:51:35+00:00,2020-05-28 23:44:25+00:00,{},"Added new bindings to the game that for now can be modified in the Keybinds.txt file:
- UI mouse clicks, left-click (JoystickButton0, or 'A' by default) and right-click (JoystickButton1, or 'B by default'). I did not add the middle click to have a default since I don't believe it's used anywhere in the game, correct me if I am wrong.
- Inversions of movement (Axis1 horizontal, Axis2 vertical by default) and camera (Axis4 horizontal, Axis5 vertical by default), all ""False"" by default

These, along with the actual axes, will all be rebindable in the upcoming UI for the joystick controls window, once this and #1816 get merged, either order."
415617037,[Joystick Controls] Added and applied joystick INI settings,jefetienne,2020-05-09 19:04:40+00:00,2020-05-28 22:46:18+00:00,{},"- Decoupled the mouse sensitivity from the joystick camera movement with `JoystickLookSensitivity`
- Added `JoystickCursorSensitivity` (TODO: figure out how to apply ini setting to the setup wizard)
- Added `JoystickMovementThreshold`, which allows the player to set a threshold to reach maximum without moving the cursor all the way. Sometimes, worn controller joysticks might not reach the '1.0' maximum axis movement, which would hinder their movement speed.
- Force `MouseSmoothing` in `PlayerMouseLook` when using a controller

For now, adjusting these settings will have to be done in the settings.ini file. I will release the UI for the joystick controls window after this and another PR get merged."
415041564,Added ability to abort spell via Ready Weapon action,jefetienne,2020-05-08 04:40:47+00:00,2020-06-20 01:07:14+00:00,{},"Added functionality where pressing ""Ready Weapon"" when having a spell ready to cast will cancel it as an alternate way to abort a spell. The weapon will be unsheathed regardless if it was previously or not."
414864573,Early May 2020 quest fixes,JayH2971,2020-05-07 19:01:13+00:00,2020-05-28 22:36:12+00:00,{},"Baltham Greyman quests still not ready, but much progress so far. Also fixing some typos in quests."
414735954,Prevent leaving character recap screen with unassigned bonuses,petchema,2020-05-07 14:49:07+00:00,2020-05-07 23:52:23+00:00,{'bug': 1},Forums: https://forums.dfworkshop.net/viewtopic.php?f=24&t=3671
414076763,Improve handling of mod dependency issues,rossipaolo,2020-05-06 12:52:32+00:00,2020-05-07 23:53:07+00:00,"{'enhancement': 1, 'mod system': 1}","- All dependency issues are shown on message box with a scrollbar if needed.
- Prompt to auto sort mods is shown only if at least one issue can be solved by sorting.

![checkDependencies](https://user-images.githubusercontent.com/24359151/81178818-13a44880-8fa9-11ea-8d28-97bab1ea3d80.png)
"
414071080,In game shortcuts on keydown,petchema,2020-05-06 12:41:09+00:00,2020-12-13 02:08:40+00:00,"{'enhancement': 1, 'wip': 1}","
Open UI windows on KeyDown event, to make the UI feel snappier.
This requires UI to handle spurious KeyUp events, so is a PR on top of #1810
"
413530894,Add genuine keyboard event handlers to UI controls,petchema,2020-05-05 13:53:38+00:00,2020-05-27 22:51:39+00:00,{},"This is a fix for the issue discussed in #1783:
    
Keyboard events can leak from game to UI or from UI to game:
- to prevent leaks from UI to game, UI controls can be triggered on KeyUp, so that the key is released before the game takes control back. However if the player releases game keys after opening the UI, that can activate UI buttons (""W"" in inventory, ""S"" in spellbook,...);
- to prevent leaks from game to UI, UI controls can be triggered on KeyDown, so that keys have to be pressed again inside the UI to have an effect. However this means keys can still be pressed after the UI closed, leaking key events into the game.
    
It should be clear now that those two situations are symetric, and that none fixes all problems. UI controls need to be able to handle KeyDown and KeyUp explicitly.
    
With this PR, buttons can:
- (unchanged) have a OnMouseClick handler; They will only react to mouse events;
- (unchanged) also have a Hotkey hotkey sequence; When the sequence is pressed, the OnMouseClick handler receives the event as a faked click;
 - but now also have a OnKeyboardEvent handler; In that case no click will be faked, and the keyboard handler will receive both KeyDown and KeyUp events.
    
With that in place, controls should react to KeyDown events in general, but the buttons that close the UI, or maybe even yield control to another UI window, should use a keyboard handler. For safety, they should be armed by KeyDown events (possibly giving user feedback by emitting a sound), and activated by KeyUp events if previously armed.
    
I'm very pleased with this, feels like sound design.I even used it to fix #1805 and simplify fast travel popup code :)
It needs more testing, but I'm releasing it for public scrutiny."
412551442,Added option to toggle sneak,jefetienne,2020-05-03 05:24:19+00:00,2020-05-06 01:46:23+00:00,{},You can now enable the sneak action to be toggled rather than held. Running will break you out of the sneak mode.
412549245,Fix horse gallop sound clipping when repeatedly jumping,jefetienne,2020-05-03 05:02:09+00:00,2020-05-06 01:43:14+00:00,{},"Holding space while jumping makes an unpleasing clipped horse noise. This fix delays the stopping of the audio by 0.2 seconds, just enough to get at least one gallop noise in when colliding with the ground. It's not perfect, and sometimes it might fail to make a sound, but I think it's a step up from what it currently is at the moment.

(Also, I think my VSCode editor is automatically normalizing the line endings and I'm having trouble finding another editor that won't do this, sorry about that)"
412519554,Retro mode add palettization,petchema,2020-05-02 22:58:31+00:00,2020-05-06 01:40:18+00:00,{},"
Add nearest-color palettization shader using ART_PAL classic palette as an alternative to posterization shader.

The shader uses k-d tree based nearest neighbour search, with a cutoff below 32 color clusters.
Most of the source has been generated for extra efficiency.

Example of result already posted in a comment:
https://github.com/Interkarma/daggerfall-unity/pull/1789#issuecomment-623002019"
412508499,Improvements to joystick attack swinging,jefetienne,2020-05-02 21:07:23+00:00,2020-05-06 01:33:41+00:00,{},"(This is pertaining to having `ClickToAttack` disabled)

As of right now, the `WeaponAttackThreshold` is shared with both the mouse and the joystick. For gameplay experience, this threshold isn't really needed for a joystick since it does not move like a mouse, and makes it harder to attack. If the `WeaponAttackThreshold` is set very low (<0.001), the player can hold their joystick in one direction and the game will automatically constantly swing the weapon, giving an unfair advantage over the mouse.

This change removes the WeaponAttackThreshold from being calculated if the player is using a controller (via `InputManager.Instance.UsingController`), but also prevents automatic swinging by having the player let go of the joystick (or moving it close to the middle) in order to swing again."
412457283,Update support for mod manifest file,rossipaolo,2020-05-02 14:12:35+00:00,2020-05-06 01:31:30+00:00,{'mod system': 1},"- Updated json schema that is used by some text editors to validate file.
- Do not serialize null values."
412032923,Update to current master,Interkarma,2020-05-01 08:08:59+00:00,2020-05-01 08:09:17+00:00,{},
409101677,Disable head bobbing while in cursor mode,petchema,2020-04-26 15:21:21+00:00,2020-05-03 01:34:45+00:00,{},"While in cursor mode the player can't adjust his/her view direction with the mouse, but if head bobbing is on it will change view direction, making the view roll over as the player walks around.

This leads to embarrassing moments, because whether the mouse cursor is displayed or not becomes totally secondary to the player when (s)he starts looking at his/her feet, then the landscape upside-down, then the sky, and repeat. People get utterly confused, and the obvious conclusion is usually ""the game bugged out"", and fixed by restarting it.

I'm not sure whether cursor mode should be totally disabled until fully implemented, but at bare minimum the interaction between cursor mode and head bobbing has to be handled somehow; That's what this PR does.

Forums: https://forums.dfworkshop.net/viewtopic.php?f=5&t=2776"
409043669,Prevent saves while rappelling,petchema,2020-04-26 08:39:57+00:00,2020-05-06 01:31:02+00:00,{},"
Discussion in https://github.com/Interkarma/daggerfall-unity/commit/6a7ca24c52ec7c0cff684feab98a6c274b55b94e"
408995098,Apr 2020 Quest Fixes,JayH2971,2020-04-26 01:02:19+00:00,2020-05-03 01:37:46+00:00,{},"Related discussions:
https://forums.dfworkshop.net/viewtopic.php?f=25&t=3473#p40923
https://forums.dfworkshop.net/viewtopic.php?f=5&t=3651&p=42749#p42745
Spawning slowed in pest quests due to some forum discussion, can't find it but every 5 seconds is too quick for novice players"
408271711,Update to current master,Interkarma,2020-04-24 00:52:01+00:00,2020-04-24 00:52:12+00:00,{},
407484794,Fixed typo in usage handler and missed this reference.,ajrb,2020-04-22 19:13:55+00:00,2020-04-22 19:16:50+00:00,{},All tested and working now.
407468905,Removed accidentally merged changes from custom-dialog-buttons.,BadLuckBurt,2020-04-22 18:42:00+00:00,2020-04-22 18:53:50+00:00,{},"My most sincere apologies, I accidentally merged changes from custom-dialog-buttons into custom-flat-model-activation. While the changes don't interfere with DFU's normal operation, after consulting @ajrb who thankfully spotted this, I decided to remove them for now until they are properly implemented. "
407446782,Added ability to filter quests to Active Only in Quest Debugger,AsesinoBlade,2020-04-22 17:56:08+00:00,2020-04-24 02:07:26+00:00,{},"Hi, 
I had thought that the quest debugger only showed active quests, but it was always showing all quests for me.  I added some functionality to the quest debugger to allow you to show all quests or just active quests.  
You can flip between all quests and active quests by pressing ""A"".   
I default to all quests upon start so that it aligns with current functionality.'
Thanks 
a


Added Dialog Shortcut to select between all quests and active quests only (shortcut = letter A)
Defaults to all quests upon starting the quest debugger."
407267907,Fix typos in registration methods,ajrb,2020-04-22 12:47:46+00:00,2020-04-22 17:10:16+00:00,{},I will merge this later today unless anyone objects. Thanks to Burt for spotting my typo.
406413239,Added backup escape key method (Shift-Escape),jefetienne,2020-04-21 03:18:59+00:00,2020-04-23 23:59:36+00:00,{},"Working with the controller PR with the added advanced controls window, if someone were to rebind the pause button to the controller, then replayed the game without the controller, then they would be stuck and unable to change their keybinds without modifying Keybinds.txt.

This PR adds a hardcoded Shift-Escape keybind allowing the player to access the DaggerfallPauseOptionsWindow in case if they fall into this situation."
406232469,Advanced controls button,BadLuckBurt,2020-04-20 18:39:41+00:00,2020-04-20 23:10:15+00:00,{},"This just changes jefetienne's Advanced button to a classic styled Advanced button to not make the difference in presentation so jarring. It also works with texture replacers, if modders add an image named 'advanced_controls_button.png', it will replace this button but I have not tested this with upscaled textures.

His PR got merged before my commits on this branch could be merged with his changes. You can find the original discussion here: [Advanced controls image comment](https://github.com/Interkarma/daggerfall-unity/pull/1774#issuecomment-614727842)"
405799038,Update to current master,Interkarma,2020-04-20 03:17:49+00:00,2020-04-20 03:17:56+00:00,{},
405711424,Custom dialog buttons (WIP),BadLuckBurt,2020-04-19 18:30:21+00:00,2020-04-24 11:14:21+00:00,{},"This WIP has been built off the custom-flat-model-activation PR I submitted and allows custom dialog buttons to be used in message boxes. 

I didn't have to change much to get this to work but I consider this a prototype as I'm not too familiar with UI-related things in DFU and can probably use some advice on how to properly implement this.

I've added one method: **AddCustomButton** which is almost a straight copy of the **AddButton** method. The **messageBoxButton** argument isn't used at the moment since I'd prefer to get some input on proper implementation. 

Instead of a **MessageBoxButtons** enum, it takes a string as the **tag** parameter and uses that to set up the **Button** instance. The **tag** name is also used to load an image named _button<tag>_ which is then set as the background texture for the button.

I have also copied the event handler and delegate for button clicks to change the parameter from MessageBoxButtons enum to a string. Other than that, it still operates the same.

[Example](https://i.imgur.com/qUFVBFN.png)

I have created a custom image: [Letters / numbers](https://i.imgur.com/UwzgZ3H.png) and an empty button graphic: [Empty button](https://i.imgur.com/8oaI6Q8.png) to allow modders to create their own button labels. Right now, I'm using static images in the example but I do see a possibility to create these custom buttons dynamically if the code is expanded a bit.

I'm open to any suggestions / advice and criticism, I'm still new to this and welcome the opportunity to learn"
405597404,[Experimental] Add posterization postprocessing to retro mode,petchema,2020-04-19 03:26:38+00:00,2020-04-25 05:14:25+00:00,{},"Uses 4bits per color component instead of using a palette.
I added some non-linearity (gamma) to get more colors in dark places."
405493509,Remove unused assets from mod cache,rossipaolo,2020-04-18 12:38:10+00:00,2020-04-23 23:56:51+00:00,{},"#1671 introduced removal from cache of materials that have not been accessed for a fixed time. This is now extended to mod cache in order to improve memory management for unique assets used by mods.

Timestamp of last access is updated when an asset is requested with `GetAsset()`. As a compromise, assets loaded with `LoadAllAssetsFromBundle()` or `LoadAllAssetsFromBundleAsync()` are not removed before they are actually retrieved."
405487603,Do not call Resources.UnloadUnusedAssets() more than once every 3 mins,petchema,2020-04-18 11:47:01+00:00,2020-04-20 03:13:43+00:00,{},"Daggerfall Unity needs to explicitly call Resources.UnloadUnusedAssets() because it barely uses SceneManager.LoadScene() which is the way games usually indirectly call it.

This is currently done in two places, including while closing UI windows, a path taken often enough during normal gameplay to prevent unused assets to pile up too much.

However this can be a lengthy operation that blocks the whole environment as it calls GC.Collect() internally, and can make sound skip which can be pretty annoying once you noticed it (issue #1539).

This patch makes sure the call to UnloadUnusedAssets() does not happen more than once every 3 minutes, a tradeoff sufficient to make that issue much less noticeable, yet should prevent unused assets to stay around forever.

It should be noted that, while not required, for optimal efficiency all code using Resources.UnloadUnusedAssets() (say mods) should call either ThrottledUnloadUnusedAssets() or ForcedUnloadUnusedAssets() instead to prevent unnecessary collections."
405420615,Changed protection level of Affiliation method to allow for Mod overr‚Ä¶,AsesinoBlade,2020-04-18 00:59:46+00:00,2020-04-20 03:11:54+00:00,{},"I would like to override the ShowAffiliationDialog in a mod.  My mod simply shows the number of days until the next Guild Promotion evaluation.

To do so, i need to change the method from private to protected virtual.

That is the only change I made to the code.

Thanks 
a"
405358489,Remove invalid assets from cache,rossipaolo,2020-04-17 21:56:55+00:00,2020-04-20 03:11:29+00:00,{'mod system': 1},"If a mod loads an asset, unloads it and then requests it again, the invalid asset is removed from cache to allow it to be loaded again. Previously, the load operation would have failed.

Mods should not unload cached assets (of course additons to the API can be proposed  if actually needed) but this should handle the issue more graciously for the player."
402861766,Update to current master,Interkarma,2020-04-13 21:58:51+00:00,2020-04-13 21:59:01+00:00,{},
402409821,Require confirmation before spellbook sorting,petchema,2020-04-12 22:37:36+00:00,2020-04-20 03:10:55+00:00,{},"A drawback of adding keyboard shortcuts to form buttons is that sometimes people trigger actions by inadvertedly pressing game keys.

Most common I've seen is W (forward) key pressed in inventory. Either selects the wagon or displays a message if the player has no wagon, it's relatively harmless.

Another a more annoying I'm starting to see is people pressing S (backward) key in the spellbook, reordering their spellbook.

This patch adds a confirmation before spellbook sorting.
Alternatively, the player could be asked what sort order to use."
402374109,Reduce GC alloc of SongManager,jefetienne,2020-04-12 17:44:55+00:00,2020-04-20 03:08:15+00:00,{},"I was looking at #1539 and while I can't seem to reproduce the issue, I minimized GC allocation of SongManager in hopes that it might help with the sound issue. It reduced the GCAlloc from 284 B to 0 B.

Calling struct.Equals(object o) by default will ""call Object.Equals(Object) on each field of the current instance and obj and returns true if all fields are equal.""

https://docs.microsoft.com/en-us/dotnet/api/system.valuetype.equals?view=netframework-4.8#System_ValueType_Equals_System_Object_

Let me know if this fix was useful."
402338735,Prevent the use of weapon while climbing,petchema,2020-04-12 13:27:26+00:00,2020-04-20 03:06:38+00:00,{},"Seems to be what classic does according to my observations.

This is the simplest implementation, No weapon drawn sound is played when you're finished climbing.
"
402333105,Make NPCs present if you have HallAccessAnytime privilege,petchema,2020-04-12 12:39:35+00:00,2020-04-20 03:06:07+00:00,{},"Seems to work that way in classic, and makes that privilege actually useful.

Forums: https://forums.dfworkshop.net/viewtopic.php?t=3502"
402305056,restrict CastWhenStrikes enchantment to weapons,petchema,2020-04-12 08:17:56+00:00,2020-04-23 23:55:22+00:00,{},"
Forums: https://forums.dfworkshop.net/viewtopic.php?f=5&t=3593"
402183111,Ironman quest actions integrated into core,ajrb,2020-04-11 12:24:38+00:00,2020-04-20 02:59:15+00:00,{},"As previously discussed here: https://forums.dfworkshop.net/viewtopic.php?f=20&t=3019

Also has some fixes for the crimes unused by classic, so the set player crime action works properly for all defined crimes.

I migrated the action code and made it align with core. Kamer has been testing them for over 2 months as he's the one who wants them for his Warm Ashes mod."
400602330,Improved output of 'startquest' command,jefetienne,2020-04-08 03:05:04+00:00,2020-04-20 02:53:36+00:00,{}," The console command 'startquest' will now say ""Added quest {quest display name}"" if it is a valid ID and ""Quest ID '{id}' could not be found"" otherwise.

It used to only return ""Finished"", which seemed ambiguous if it meant I finished that quest or if it got completed it for me. It also didn't say if the player used a valid quest id or not."
398394070,Support for runtime materials,rossipaolo,2020-04-03 21:26:28+00:00,2020-04-20 02:53:01+00:00,{'mod system': 1},"# Summary
Added a component that holds a list of archives and records and uses them to assign materials when the prefab is instantiated at runtime. Materials are automatically applied on Awake but can also be manually reapplied.

It allows to ""reference"" a classic Daggerfall material from a prefab provided by a mod.

![runtime_mat_0](https://user-images.githubusercontent.com/24359151/78404508-e1e14000-75fe-11ea-9f5a-8f80701d32c0.png)

![runtime_mat_2](https://user-images.githubusercontent.com/24359151/78406042-11457c00-7602-11ea-9b33-e367fc3e1df1.png)

# More Informations

Mod authors can use this component to provide a list of archive-record tuples associated to a material index. This is a better alternative than including classic textures with the mod because it doesn't require texture duplicates for each mod and has full support for texture replacement with load order. 

The reason to specify material index (instead of using array order) is to allow the use of classic materials along with custom ones. As a convenience i added an entry in the context menu named ""Init from MeshRenderer"".

Materials can be manuallly reapplied with `void ApplyMaterials(RuntimeMaterial[] materials)` or from the inspector with the context menu entry ""Reapply Materials"".

![runtime_mat_1](https://user-images.githubusercontent.com/24359151/78404511-e279d680-75fe-11ea-8f12-18b241916392.png)

# How To Test

- Create a prefab and add component **Runtime Materials**.
- Set target archive-record (for example 23-0).
- Launch play mode, pause and drag the prefab inside the scene. Materials are assigned immediately from Awake().

![runtime_mat](https://user-images.githubusercontent.com/24359151/78453075-b0fd1b80-768f-11ea-89e0-cd9ed675a71a.gif)

"
397933782,Added Advanced controls window,jefetienne,2020-04-03 04:46:50+00:00,2020-04-20 02:47:30+00:00,{},"Advanced Controls Window:
https://i.imgur.com/rVtBFgf.png

Button to access it:
https://i.imgur.com/IuxBN6A.png

Alas, it is here. The advanced controls window contains keybinds for non-classic controls, which are pausing, toggling the console, screenshotting, quicksaving, and quickloading. It can be opened from where the 'MOUSE' button was, which is now an overlaid green button called ""ADVANCED"".

Like the main control window, it will detect duplicates and highlight them as red. However, _you will still be able to exit out of the advanced controls window_, so that way you can find which keybind you're conflicting with in the main window, but you won't be allowed click 'continue' in the main controls window until it's resolved.

Also, for ease of access, I've also added some settings from the setup wizard onto this window, so it's easier for the player to make adjustments to rather than having to exit and reload their game every time.

The only minor annoyance that you might find is that rebinding the 'Escape' key to an action will properly set it, but it will also close the window if there are no duplicates. I feel like this can be fixed in another pull request."
397801872,Relocate weather particles when world offset changes,petchema,2020-04-02 20:45:35+00:00,2020-04-02 23:50:57+00:00,{},"Fix for #1420

I implemented a fix, then noticed there was 5 years old code doing the same thing, just a bit better!"
397731822,Add a blinking cursor to daedra quest Y/N question,petchema,2020-04-02 17:58:48+00:00,2020-04-02 23:13:03+00:00,{'enhancement': 1},"Should convey that the player is supposed to type something, while having a minimal impact on visuals.

I put the cursor near the bottom right corner of the screen because I didn't manage to fully grasp the UI coordinates system, but it looks okay (and could be improved later)."
397160298,Don't (re)stack items during player deserialization,petchema,2020-04-01 18:27:20+00:00,2020-04-02 23:43:05+00:00,{'bug': 1},Simpler alternative to #1770
396671705,[RFC] Don't stack equipped items during player deserialization,petchema,2020-03-31 23:35:45+00:00,2020-04-01 18:30:05+00:00,{'bug': 1},"Equipped items are not stackable, but this check doesn't work during deserialization, because inventory items are deserialized first, then they're equipped while deserializing the equipTable.

Simplest fix is to disable stacking while deserializing the inventory: use AddItem(..., noStack: true) in ItemCollection.DeserializeItems().

However, if this was done on purpose (so that stacking ""self heals"" during game loading), this PR instead only prevents the stacking of equipped items.
It's not very satisfying, because equipTable serialized data is used twice, so I submit it as a RFC.

Forums: https://forums.dfworkshop.net/viewtopic.php?f=5&t=3560"
395729181,Made RdbResource.TriggerFlag_StartingLock public so it gets exported ‚Ä¶,BadLuckBurt,2020-03-30 15:32:37+00:00,2020-04-02 23:42:10+00:00,{},"‚Ä¶/ imported properly for WorldData overrides. Without it, it's not possible to assign the trigger type for classic activation behaviours of models / flats, making custom dungeons with classic activators impossible."
395302559,Custom flat / model activation,BadLuckBurt,2020-03-29 19:10:10+00:00,2020-04-20 02:41:26+00:00,"{'enhancement': 1, 'mod system': 1}","These changes extend the custom model activation registration to include flats which was previously not possible. Any flat with a custom activation assigned will have a collider added to it's GameObject to allow for raycasting to succeed. Also, models with custom activations are excluded from the combinedMesh during dungeon assembly.

This allows modders to create custom activations for any model / flat they choose and enables them to implement things like resting at campfires, dungeon beds, etc. 

I have created a custom test dungeon (just a simple room) with a classic model (broomstick cabinet) and flat (campfire) as well as a replacement for both cases (a scarecrow flat is substituted for a white cube and the empty bookshelf is replaced with a bookshelf model I quickly made). Upon activation the cabinet, scarecrow cube and bookshelf will display a text message. Activating the campfire will present you with the Resting UI. 

You can find the dungeon here: [https://github.com/BadLuckBurt/dfu-custom-flat-model-activation-demo/releases](url) and it's source code here: [https://github.com/BadLuckBurt/dfu-custom-flat-model-activation-demo](url)

I have also tested to see what happens when an object already has an action assigned from classic DF using the throne room lever in PH and both actions fire after PlayerActivate.Update() finishes.

I'm open to suggestions and willing to make any changes required for this request to be accepted."
395274904,"Add furniture category which are present, just rare",ajrb,2020-03-29 15:58:06+00:00,2020-04-02 23:40:30+00:00,{'bug': 1},"Players can never have anything that will be sellable, but this gives mods the chance to flesh out or repurpose furniture stores if they want to.

See https://forums.dfworkshop.net/viewtopic.php?f=5&t=3550"
395274173,Fix dungeon exit and other static door overlap,petchema,2020-03-29 15:53:11+00:00,2020-04-02 23:39:50+00:00,{'bug': 1},"I case they're several static door hits, give higher priority to dungeon exit
Alternate implementation would be to add static doors deduplication in RemoveOverlappingDoors(), but I'm not sure it's worth the extra complexity.

Forums: https://forums.dfworkshop.net/viewtopic.php?f=24&t=3390"
393800923,[RFC] Reset unstick handling when idle,petchema,2020-03-25 20:06:21+00:00,2020-04-20 02:35:16+00:00,{},"Reset unstick handling frame counter when not trying to go forward or backward. This should make it harder to trigger unsticking when moving by short bursts or using a mix of moves that doesn't make you progress forward or backward

Forums: https://forums.dfworkshop.net/viewtopic.php?f=5&t=3537

Also possibly
https://github.com/Interkarma/daggerfall-unity/pull/1759#issuecomment-602054807"
393178510,Support custom implementations of mobile units,rossipaolo,2020-03-24 18:17:44+00:00,2021-03-17 23:57:50+00:00,{'mod system': 1},"The same as  #1598, this time for enemies. 

[ExampleMobileUnit.zip](https://github.com/Interkarma/daggerfall-unity/files/5860569/ExampleMobileUnit.zip)
"
392028713,Enable custom items to be added by mods,ajrb,2020-03-22 16:02:14+00:00,2020-04-20 02:32:53+00:00,"{'enhancement': 1, 'mod system': 1}","Builds on the rudimentary support I added for the locator device 2 years ago. I have attempted to implement this with as light a touch on the codebase as possible.

Now uses the item templates file and defines a template index which for custom items is used for the group index as well.

Regarding paperdoll items, Weapons and armor are fully functional and tested. Clothing may need a bit more work which I will look at soon but I wanted to get this on the list of PRs so people can start to review the changes. Corresponding changes can be found in my Archs mod and Loot Realism on this branch: https://github.com/ajrb/dfunity-mods/tree/moderateWeaponMaterials

Loot realism now adds 2 new weapons: Archers Axe and Light Flail, and also a new lighter set of mail armor allowing players who can't wear plate to get high level material armor pieces.

NOTE: This PR builds on #1747 and as such contains all of those changes as well. (first 9 commits) Either review & merge this one and I'll close that one, or review & merge #1747 first and then this should lose all those changes to allow it to be reviewed separately."
391913002,Enable custom items to be added by mods,ajrb,2020-03-21 20:40:23+00:00,2020-03-22 15:53:12+00:00,"{'enhancement': 1, 'mod system': 1}","Builds on the rudimentary support I added for the locator device 2 years ago.

Now uses the item templates file and defines a template index which for custom items is used for the group index as well.

Regarding paperdoll items, Weapons and armor are fully functional and tested. Clothing may need a bit more work which I will look at soon but I wanted to get this on the list of PRs so people can start to review the changes. Corresponding changes can be found in my Archs mod and Loot Realism on this branch: https://github.com/ajrb/dfunity-mods/tree/moderateWeaponMaterials

Loot realism now adds 2 new weapons: Archers Axe and Light Flail, and also a new lighter set of mail armor allowing players who can't wear plate to get high level material armor pieces.

NOTE: This PR builds on #1747 and as such contains all of those changes as well. (first 9 commits) Either review & merge this one and I'll close that one, or review & merge #1747 first and then this should lose all those changes to allow it to be reviewed separately.

"
391900068,"Prevent the ""end quest"" action from firing twice",JorisVanEijden,2020-03-21 19:20:18+00:00,2020-03-21 21:46:10+00:00,{},"‚Ä¶ when the _oneday_ timer expires without having stolen the guarded item.

Forum post: https://forums.dfworkshop.net/posting.php?mode=reply&f=24&t=3422#pr40022"
391861691,Safer unstick handling using Physics.CapsuleCast()s,petchema,2020-03-21 13:56:49+00:00,2020-04-02 23:33:10+00:00,{},"Previous unstick handling used a SphereCast to check whether the player could be teleported forward across some geometry issue.
However the fact that the player controller shape is a capsule instead of a sphere could lead to an erroneous teleportation inside obstacles (shop banners, graveyard gate,...)

Just replacing one shape with another is not sufficient, because hte fact that a controller shaped capsule couldn't move forward is exactly why the player was stuck in the first place. To be safe, what should be checked is whether a capsule could freely follow a path to the place we want to teleport the player to.
Simplest path after the straight line is a step (go up, forward, then down), that's what this PR does.

Forums: https://forums.dfworkshop.net/viewtopic.php?f=24&t=3291"
391562432,Mod reserved layers,rossipaolo,2020-03-20 14:29:24+00:00,2020-04-02 23:25:42+00:00,{'mod system': 1},"Mods can request layers and release them using `ModReservedLayer`.

[Requested on forums.](https://forums.dfworkshop.net/viewtopic.php?f=23&p=41393#p41393)

Example:

```cs
var reservedLayer = ModReservedLayer.Request();
if (reservedLayer == null)
{
    Debug.LogError(""Failed to get layer"");
    return;
}

var go = GameObject.Instantiate(mod.GetAsset<GameObject>(""Cube""));
go.layer = reservedLayer.Layer;

// ---
 
Physics.IgnoreLayerCollision(reservedLayer.Layer, LayerMask.NameToLayer(""Enemies""), false); 

// ---

reservedLayer.Dispose()
```"
391311143,Fix windows not toggling closed after rebinding key,numidium,2020-03-20 01:31:36+00:00,2020-03-20 02:59:32+00:00,{},"If the user changes the key binding for the inventory, character sheet, journal, or travel map windows then the toggle bindings do not update."
391223056,"make frost daedra emissive, like in classic",petchema,2020-03-19 20:31:08+00:00,2020-03-21 21:47:13+00:00,{},"Noticed by KoW / @HybOj

Took me a while to understand that emission was wrong for some records because of IsExteriorWindow(). That predicate sure is not pretty."
391044557,ImportedComponentAttribute now supports dependencies,rossipaolo,2020-03-19 14:42:30+00:00,2020-04-02 23:23:36+00:00,"{'enhancement': 1, 'mod system': 1}","Added support for serialization of prefabs inside a mod with custom components defined by other mods.

How to use component from mod A for a prefab in mod B:

- [ImportedComponent](https://github.com/Interkarma/daggerfall-unity/blob/27e3e4668890b28cb26355a98e4bca08053805ec/Assets/Game/Addons/ModSupport/ImportedComponentAttribute.cs#L31) attribute must be placed on the component class definition in mod A.
- Component from mod A must be added to prefab included with mod B using the ""Add Component"" button from prefab inspector, like any other component. This means that component class type must be available in Editor when the mod is built. Raw .cs or .dll files are enough, is not needed to have the entire mod source code.
- Mod A must be defined as a [dependency](https://github.com/Interkarma/daggerfall-unity/blob/27e3e4668890b28cb26355a98e4bca08053805ec/Assets/Game/Addons/ModSupport/ModTypes.cs#L102) of mod B."
388299972,Improved robustness of ModManager.TryGetAsset(),rossipaolo,2020-03-14 13:11:21+00:00,2020-04-02 23:23:13+00:00,{'mod system': 1},"`ModManager.TryGetAsset()` now doesn't return null if the first asset found can't be loaded but it keep seeking for a valid result instead.

This fixes an issue where a texture could be retrieved properly if a mod contains both texture and xml configuration file (with the same name), while it failed if it contains only the xml file because our internal code only considers the filename (unlike Unity API that also checks type).

`Mod.LoadAsset()` returns null without logging errors if asset is not found, which is consistent with Unity API (i.e. `Resources.Load()`)."
387123329,Fix bug with breaking armor and enchanting unworn armor,ajrb,2020-03-12 09:11:54+00:00,2020-04-02 23:22:38+00:00,{'bug': 1},"Should fix the following issues:
https://forums.dfworkshop.net/viewtopic.php?f=5&t=3497
https://forums.dfworkshop.net/viewtopic.php?f=24&t=3491"
386911161,Fixes discrepancies in item stats from classic,ajrb,2020-03-11 20:43:18+00:00,2020-03-21 21:44:43+00:00,{'bug': 1},"I've just realised that the fix here for the enchantmentPoints is not getting used in the game. That's probably why it was not noticed up until now.

@Interkarma when you implemented item enchanting you created formula methods (GetItemEnchantmentPower etc) to calculate this from the base points value in the template instead of using the value calculated by Allofich code in ItemBuilder. I'm not sure if this was because of the bug that this PR fixes, or because you were not aware of its existance.

Having it in the item means it is easier for a custom item implementation to alter the points in a different way, which is useful in at least one case but not necessarily a reason to switch if there are good reasons not to.

Either way I think one or the other of these 2 implementation of enchantment point material scaling should be removed. I am happy to do that, but you should decide which we keep I think."
386440137,[Secondary Keybinds] Created Singleton out of StartGameBehaviour,jefetienne,2020-03-11 01:35:53+00:00,2020-03-11 13:51:15+00:00,{},"Used for the secondary keybind window.

Singleton code was copied and reworked from InputManager. `ApplyStartSettings()` needed to be public for saving additional settings in that window, such as mouse look sensitivity, weapon sensitivity, movement acceleration, inverting mouse Y axis, and for weapon attack threshold. "
386437969,[Secondary Keybinds] Reworked controls window,jefetienne,2020-03-11 01:25:23+00:00,2020-04-02 23:17:03+00:00,{},"(I already have the secondary keybind window finished, but I'm breaking into smaller PRs)

- Rewrote CheckDuplicates() to use a shared static helper method called GetDuplicates(), which will be used by the secondary keybind window. 
- All keybinds are shared in a static dictionary of unsaved keybinds, and updated upon save or reset to default.
- WaitForKeyPress is also static for it to be shared with the secondary keybind window.
- Fixed a bug where players could press the bottom buttons while the window is waiting for input"
386403188,Refactor combat formula to enable modding,ajrb,2020-03-10 22:57:13+00:00,2020-04-02 23:22:14+00:00,"{'enhancement': 1, 'mod system': 1}",Note these changes are also in #1762 as I had to build that work on top of this.
386381815,Implement %ln macro as it was seen on stream as unhandled,ajrb,2020-03-10 21:50:53+00:00,2020-03-21 21:45:32+00:00,{'enhancement': 1},Warm Ashes mod has used it I think.
385827930,Update branch to current master,Interkarma,2020-03-09 21:28:49+00:00,2020-03-09 21:28:58+00:00,{},
385717219,Fix left handed bow damage and condition lowering ,ajrb,2020-03-09 17:23:36+00:00,2020-04-02 23:18:40+00:00,{'bug': 1},The way bows are accessed for the formula differs from melee so it was using the weapon in right hand for damage calc.
385715587,Fix left handed bow damage and condition lowering,ajrb,2020-03-09 17:20:21+00:00,2020-03-09 17:21:18+00:00,{},The way bows are accessed for the formula differs from melee so it was using the weapon in right hand for damage calc.
385187323,Fix automap partial blocks wrong shaders,petchema,2020-03-07 20:01:03+00:00,2020-03-21 21:42:58+00:00,{'bug': 1},"When some gameObject without MeshRenderer is found in a dungeon block, shader of remaining gameObjects is left to Standard shader in the automap.

Forums: https://forums.dfworkshop.net/viewtopic.php?f=5&t=3476"
385170014,Fix add_all_equip command,ajrb,2020-03-07 16:49:24+00:00,2020-03-09 17:20:53+00:00,{},"Was skipping clothes with 0 variants in template.
Was not able to create the 2 different boots.

This is also reverting a change made by Allofich on14/8/2017 (4c81a7f) restricting the variants for chain+plate boots to just one. This may be as classic, but I suspect it's a bug that DFU can happily correct. Anyone disagree?"
385095008,Fixes + improvements for opening/closing UI windows and console,jefetienne,2020-03-07 02:57:51+00:00,2020-04-02 23:18:04+00:00,{},"Besides the map windows, if the player had previously opened a window and then changed the keybind for it, the window would not refresh the toggle button and would stick to the old keybinding. This was also true for the console window as well. I fixed it by refreshing the bindings in `OnPush()` and `ToggleConsole()` for the windows and console, respectively.

Also, in preparation for the secondary keybind window, I've made the pause window utilize a rebindable toggle like all of the other windows. Previously, it relied on a hardcoded `KeyCode.Escape` and `DaggerfallPopupWindow`'s default 'exitKey' to leave the window without actually using `InputManager.Actions.Escape`. Also, when making this change, I noticed that if the toggled key was held down for too long after exiting the window, that it would pop back up again. I saw that the problem was `DaggerfallPopupWindow` using `GetKeyDown(exitKey)`, so I changed it to `GetKeyUp(exitKey)` to resolve the issue.

EDIT: Added rebindability for PrintScreenManager (I can't believe I forgot about my own submitted feature for a second)"
383994376,Fix water footstep playing while jumping over water,jefetienne,2020-03-05 00:12:05+00:00,2020-03-21 21:42:02+00:00,{},Fixed from petchema's review #1718.
382652510,Added version label to setup wizard,jefetienne,2020-03-02 22:59:12+00:00,2020-03-04 22:27:51+00:00,{},"https://imgur.com/a/tdHhoRw

I felt like the setup wizard could use a small version label for users to notice which .exe they're opening. It's especially useful in case if a user uses multiple versions for mod compatibility, or if they're transitioning from one version to another and accidentally left the older version pinned to their taskbar, start menu, or on their desktop as a shortcut."
382005147,Change protection levels for inventory menu for modability,numidium,2020-03-01 06:22:02+00:00,2020-03-04 22:27:04+00:00,{},Previous PR was closed when I tried to squash my commits.
381970603,AI improve doorways finding,petchema,2020-03-01 01:16:20+00:00,2020-03-04 22:25:50+00:00,{},"This PR does not change the current doorway finding algorithm, that looks good, but tweaks 2 parameters so far:
- limit the height of the capsulecast used to find doorways to 1.75, to match the hack used to allow tall enemies to get thru doors. Without this, tall enemies could technically get thru doors, yet are very reluctant to do so;
- lower capsulecast distance from 1 to 0.8. Long casts was making it hard for enemies to find door openings coming from the sides. Now it's a bit better."
381939610,prevent collisions between all missiles,petchema,2020-02-29 20:16:25+00:00,2020-03-01 00:18:17+00:00,{'bug': 1},"Both arrows and spell missiles gameObjects didn't inherit SpellMissiles layer from their parent, so they would collide with one another.

Forums: https://forums.dfworkshop.net/viewtopic.php?f=23&t=3459"
381890010,Copy building array in block before modifying it,ajrb,2020-02-29 17:18:03+00:00,2020-03-01 00:44:20+00:00,{'bug': 1},"See https://forums.dfworkshop.net/viewtopic.php?f=24&t=3417

Only seems to be an issue when two identical blocks are next to each other in west-east direction."
381841978,fix rare mobile orientation blind spot,petchema,2020-02-29 12:11:05+00:00,2020-03-01 00:17:48+00:00,{'bug': 1},"Sometimes, when encountering an idle mobile, it look like it's facing you until you slightly move around.

The problem is that the choice of mobile orientation is based on cases using only strict inequalities, so boundary values did not match any case and orientation was left at its initial value of 0.

I replaced everything with formula, that could be extended more easily to any number of orientations."
381828025,Same as #1484 with EnableTextureArrays = False,petchema,2020-02-29 09:57:45+00:00,2020-03-01 00:19:25+00:00,{},"Same as #1484 but in DaggerfallTilemap.shader

No regression found on my hardware with EnableTextureArrays = False, but ideally it should be tested with hardware that require that setting...

Forums https://forums.dfworkshop.net/viewtopic.php?f=5&t=3456"
381660730,Make inventory window more accessible to mods,numidium,2020-02-29 00:35:18+00:00,2020-03-01 06:12:16+00:00,{},This is for myself and any future modders who want more customization for the inventory window.
381518961,Don't assume player is standing in PlayerActivate raycast,petchema,2020-02-28 17:57:00+00:00,2020-03-01 00:19:49+00:00,{'bug': 1},"WeaponManager uses camera position and direction, just do the same.

Forums: https://forums.dfworkshop.net/viewtopic.php?f=5&t=3454

There may be more to the problem discussed in the forums than this bug, but it's a start."
381110764,Need to allow replacement of potion recipes for mods,ajrb,2020-02-27 22:43:46+00:00,2020-03-04 22:25:20+00:00,{'bug': 1},"Just propagating the already passed flag to potion indexing method, pretty sure that it was just an oversight but it should be verified before merging. "
379916518,[RFC] More discreet create foe place freely ,petchema,2020-02-26 00:41:41+00:00,2020-03-04 22:24:38+00:00,{'enhancement': 1},"Previous algorithm to spawn foes freely would first find a direction slightly outside of player's field of view, check if there's any obstacle in that direction, and if so find a spawning point along the normal of collision point.

Using that normal helps finding a clear location (it should be at least clear from the obstacle just hit, but further tests are still needed), however it changes the direction of the spawning point, moving it away from field of view borders; Either inward (making the foe suddenly appear in front of the player) or outward (not as bad).
Also the code checks the distance of the hit point, not spawning point, making it possible for spawns to happen at a much lower distance than minDistance constraint.

Stream: https://www.twitch.tv/videos/556821863?t=27m40s
![lycanthrope spawn](https://user-images.githubusercontent.com/1211431/75301540-59bb8e00-583b-11ea-91ee-e49d87ece1bd.jpg)
(Lycanthrope appearing in a tavern right in the center of player's field of view, probably taking the normal off the fireplace on the right)

This patch:
- selects a spawn point along the direction selected at first, to be on the border of player's field of view, so foes should never ""appear"" in front of the player (even if sometimes in places that do not make much logical sense, exactly like before);
- assuming the obstacle is a plane, the new algorithm may choose a spawn point much closer than before as clear from the obstacle (can't beat using the normal here);
- however it will always check that spawn happens further than minDistance, and only add some randomness to the distance if there's enough room to do so in the first place.
"
379336191,Rudimentary Gamepad Support,jefetienne,2020-02-25 02:51:55+00:00,2020-04-28 04:08:59+00:00,{'enhancement': 1},"(This is a big pull request, I'm sorry! But it had to be in order to get the functionality working. Even though it shows 20+ files changed, only two of them contain actual business logic: _InputManager.cs_ and _DaggerfallControlsWindow.cs_. The rest are modified to replace Unity's ""Input"" static class methods with InputManager's new wrapper methods (e.g. `Input.mousePosition` to `InputManager.Instance.MousePosition`, or `Input.GetKeyDown(...)` to `InputManager.Instance.GetKeyDown(...)`).

I have spent a couple weeks working with support for controller input and it became a lot more complicated than I thought it was going to be:

- In Unity, the Left/Right Triggers and D-Pad (on Windows/Linux) are treated as axes, rather than as buttons like ABXY, L/R2 or L/R3. This is because they return a range of values from **-1.0f** to **1.0f**, rather than a boolean of 'pressed' and 'not pressed'. Because they are considered axes and not buttons, I had to implement functionality to treat them like buttons by creating 'fake' KeyCode enums starting at **5000**, with indexable string names like `""JoystickAxis7Button0""`, `""JoystickAxis7Button1""`, etc. Because those numbers don't actually exist in the KeyCode enum, I created a method for parsing them into their matching string names and vice versa.

- I also had implement my own versions of `GetKey`, `GetKeyDown`, and `GetKeyUp` for these ""axis buttons"" since there are no built-in Unity event handlers to detect a change in axis input. It was tricky at first, but essentially it uses three different dictionaries - one that holds an axis button's previous value in the last frame, one that will have it currently flagged as ""up"" for the current frame, and one that will have it currently flagged as ""down"" for the current frame. My `GetKeyDown` and `GetKeyUp` functions look at these dictionaries to see if a key at their corresponding dictionaries is flagged as true.

- I even found out that controllers and OS drivers can have different axis mappings. For example, the left and right triggers for an Xbox controller are marked as axes 9 and 10 on Windows, but on macOS, they are axes 5 and 6. (https://answers.unity.com/storage/temp/134371-xbox-one-controller-unity-windows-macos.jpg) 
Because there can be a lot of nuance and diversity of using different controllers and platforms, I've added twelve more axes in Unity's InputManager (""Edit > Project Settings > Input"", not _InputManager.cs_) to make a total of sixteen recognized axes (`""Axis1""`, `""Axis2""`, ... `""Axis16""`).

- Like `InputManager.Actions`, I also created an enum called `InputManager.AxisActions`:

```csharp
public enum AxisActions
{
      MovementHorizontal,
      MovementVertical,
      CameraHorizontal,
      CameraVertical,
}
```
- - They are also serialized in _Keybinds.txt_ and each correspond to an axis number. Eventually, the plan is to create a Joystick Controls window that will allow the user to bind these `AxisActions` to any of the sixteen axes, so a person with a PS4 or Logitech controller, or is on Linux/macOS, can still play.

- I'm also incredibly delighted to say that Unity provides no built-in method to control the in-game cursor with a joystick. So to navigate through the UI with a controller, DFU's `InputManager` will recognize when the user moves their joystick to switch to a ""controller mode"" by hiding the real mouse cursor and spawning a ""fake cursor"" in its place via `GUI.DrawTexture(...)`. If the user touches the mouse again, then the fake cursor disappears and the real cursor reappears (unfortunately the real cursor reappears where it last moved instead of where the joystick cursor was because Unity can't physically reposition the mouse, except when locking it to the center). 
`InputManager.MousePosition` is determined by what mode `InputManager` is in, and returns the position of either the real cursor or the joystick cursor. For now, I also hardcoded the left- and right-click buttons to `KeyCode.JoystickButton0` (*A* button for Xbox on Windows/Linux) and `KeyCode.JoystickButton1` (*B* button for Xbox on Windows/Linux), respectively. I also plan for these buttons to be rebindable when we create a future Joystick Controls window.

- To use my faux KeyCode enums but still have readability in _KeyBinds.txt_, I changed the serialized dictionary's key type to be Strings instead of KeyCodes, since the JSON serialization library can't parse a fake KeyCode number into an equivalent `ToString()`. I've tested to make sure it won't cause errors when transitioning from the old .txt format to the new one.

- I also created multiplier properties for joystick camera and mouse sensitivity. Right now, they can't be modified (set at **1.0f**), but in preparation for the secondary keybind window, we can use a slider to adjust the values.

- Accessing the pause menu must still be done via the `Escape` key. I've `grep`'d through the source code and found the `Escape` key hardcoded in many areas, and I figured this should be fixed in a future pull request for when we start creating the secondary keybind window.

- It's recommended that you have ""Click to attack"" enabled when using a controller. Maybe in a future pull request, you can have ""Click to attack"" still disabled but the engine will switch to click-to-attack  if the attack button is binded to a joystick control.

Right now, **I've only tested this game with a wired Xbox 360 controller and a wired PDP Xbox One controller for Windows 8.1 and Linux Mint 19.3 Cinnamon** (but I'd expect it to work for Windows 10). Unfortunately, macOS and possibly other Linux distros may have issues with the default Movement/Camera axes set because of the different axis mappings.

This pull request is basically the start of rudimentary controller support after rolling out the secondary keybind window. I'll also create a controller setting window, such as axis mappings, inverting the Y axis, setting the controller left/right click buttons, joystick sensitivity, deadzone, etc."
379177443,Add enhancement setting to use bows in left hand,ajrb,2020-02-24 19:31:47+00:00,2020-03-04 22:16:23+00:00,{'enhancement': 1},"This allows weapon switching between a melee and a bow without having to access the inventory. Think... sling the bow over shoulder and draw a blade. Introduces a switching delay for all weapon switches which is half the average weapon equip delay of the two weapons.

Playing a character who uses a mix of ranged and melee is a pain, and it seems reasonable to me for this to be a balanced tweak of the Daggerfall weapon system. If you would rather it goes in a mod, then I'll do that, but I feel it's a nice enough change for a core enhancement."
379118706,Texture fix strikes back,df-ferital,2020-02-24 17:41:08+00:00,2020-03-01 00:21:04+00:00,{},"More texture fixes, including the small ship (@HybOj will be happy), which was a real pain to fix, a lot of its planes UV coordinates were wrong, alongside a bunch of incorrect texture records. I also fixed a few other models reported on the forums, as well as a ruined tombstone which was in a very bad state (this one can be found in the cemetery of Aldingwall, Daggerfall)."
378728189,Ensure that the scaling vectors are not initialised with zeros. URGENT FIX!,ajrb,2020-02-23 17:08:55+00:00,2020-02-23 22:50:30+00:00,{},"Tried to use a fsSerializer post-processor but couldn't as the DFBlock is a struct and that means there's no way to adjust the values because the obj is passed by value.
This enables world data override files to continue to work without every single model requiring 3 new float values to be added."
378693350,Fix equipped monster enemies always using hand to hand,ajrb,2020-02-23 11:07:06+00:00,2020-02-23 22:51:26+00:00,{},Noticed this bug while looking though the code. Affects orcs and centaurs. No wonder they always felt so weak.
378645071,Additional fixes and improvements for footstep noises,jefetienne,2020-02-23 00:10:19+00:00,2020-02-23 04:54:47+00:00,{},"- Static geometry (such as buildings) now also make the hard dungeon footstep noise instead of the grassy terrain noise
- Improved detection for what tile the player is on by extending the raycasting distance
- Fixed an issue where sometimes jumping would make a grass noise, and also improved jumping by playing the tile's footstep noise upon landing

When I was designing the functionality for the landing noise, it also happened to get triggered when the player would load a save, or move into/out of an interior location, because the player would be floating in the air before being repositioned on the ground. To remedy this, I created a _StreamingWorld.IsRepositioning_ bool property that checks if the player is currently being repositioned so it can ignore that footstep noise."
378597055,Allow apostrophies in classic spell names for quest actions,ajrb,2020-02-22 14:50:02+00:00,2020-02-23 01:16:55+00:00,{},
378490506,Remove escorting faces more reliably,petchema,2020-02-21 21:58:55+00:00,2020-02-23 01:20:03+00:00,{},"In some cases faces creation involve some randomness (say, for children), so FaceDetails structural equality could mismatch.

Also disable face panels until placed, so they don't show up in screen top left corner for a frame.

Forums: https://forums.dfworkshop.net/viewtopic.php?f=5&t=3430"
378402213,Add ability to create specific books and random or specific potions in quest scripts,ajrb,2020-02-21 17:57:48+00:00,2020-02-23 01:28:03+00:00,{},
378385700,Fix covens offering different Daedra summons in the same day,ajrb,2020-02-21 17:14:31+00:00,2020-02-23 01:25:25+00:00,{},See https://forums.dfworkshop.net/viewtopic.php?f=24&t=2649
378008205,Animation fix for female spellswords apply to the texture archive rather than the class,ajrb,2020-02-20 22:31:40+00:00,2020-02-23 01:18:34+00:00,{},
377894129,More texture fixes,df-ferital,2020-02-20 17:51:14+00:00,2020-02-23 01:21:48+00:00,{},"I resumed my work on the texture runtime patch. I fixed all models referenced by @bansheexyz on the forums, most of @petchema ones as well as some other I discovered by myself.

@Interkarma If you want some saves to check all the patches, I can provide them."
375741937,"Allow mods to override allocating player starting equipment and spells, enemy equipment, and modify found items",ajrb,2020-02-15 18:01:04+00:00,2020-02-23 01:21:08+00:00,{},"- Introduced delegates for player starting equipment and spell assignment. (Moved them to be called after items from biog questions are added to player, so mods can adjust)
- Introduced delegate for assigning enemy starting equipment.
- Added a new formula that is called when loot items are generated for loot piles. This is for mods and LootRealism will use it to have found armor, weapons, and books be in a random condition.

You can see an example of usage here: https://github.com/ajrb/dfunity-mods/blob/startingStuff/LootRealism/Scripts/LootRealismMod.cs"
375646434,"Classic quest fixes, Mid-Feb 2020",JayH2971,2020-02-15 02:23:23+00:00,2020-02-20 00:01:56+00:00,{},"C0B00Y02 was complex enough to merit a whole variable/structure rewrite. Only a few quests remaining now: A0C00Y16, K0C00Y06, M0B11Y18, N0B11Y18, and S0000007."
374594982,Allow controls to override hotkey sequences,petchema,2020-02-12 23:35:51+00:00,2020-02-20 00:07:40+00:00,{},"Disable hotkey sequences when controls with overridesHotkeySequences flag have the focus

Part of fix for issue #1707 "
374416029,Added scale support for 3D objects,UncannyValley21,2020-02-12 16:50:33+00:00,2020-02-20 00:00:52+00:00,{},"Unmodified objects in unmodified locations will always spawn with a scale of  (1,1,1).
Works with mesh replacement.
Works with mesh combiner.
Replaced many calls for GameObjectHelper.QuaternionFromMatrix(matrix) to matrix.rotation, as the former would result in strange rotation in combination with below 1 and non-uniformed scaling."
373830689,MeleeDamage raycast fallback,petchema,2020-02-11 19:10:42+00:00,2020-03-01 00:40:49+00:00,{},"
One can't simply call WeaponDamage() again with a fallback raycast hit if no enemy was struck during a first call of WeaponDamage() with a spherecast, because environment damage may be done twice.
So the major refacto is to split WeaponDamage() into environment damage (WeaponEnvDamage) and enemy damage (WeaponDamage).
I also used that refacto to simplify missiles damage."
373305609,force UnityEngine.Random reseeding when parsing quests,petchema,2020-02-10 19:16:54+00:00,2020-02-20 03:42:35+00:00,{},"No optimisation attempt, QuestMachine.ParseQuest can be called several times during the same frame and is not in a hot path so I'm using System.Random as randomness source.
Generating a list of quests feels just as fast as before.

Forums: https://forums.dfworkshop.net/viewtopic.php?f=5&t=3399
https://forums.dfworkshop.net/viewtopic.php?f=27&t=924&p=39061#p39056"
372949142,Added screenshotting functionality,jefetienne,2020-02-10 05:36:55+00:00,2020-03-04 22:13:37+00:00,{},"Whether you are playing or paused on a DaggerfallWindow, pressing the _PrtScr/SysReq_ button will take a screenshot, display the PNG file's name through scrolling HUD text, and save it into a ""Screenshots"" folder, located in same path as where the ""Saves"" path is (e.g. ""AppData\LocalLow\Daggerfall Workshop\Daggerfall Unity\Screenshots"" for Windows).

The PrintScreenManager is added as a separate GameObject in the ""DaggerfallUnityGame"" scene.

**Notes**:

Because there is no ""Screenshot"" keybind shown on the classic keybind window texture, it means that  if a player used the _PrtScr/SysReq_ button for a different keybind, it would silently erase the ""Screenshot"" keybind. I figured then that it would be safe to restrict the _PrtScr_ button as rebindable in the DaggerfallControlsWindow (like the _Escape_ key), but I'm not sure if that is alright with you guys.

Also, if you screenshot while the game is paused, it will do so, but the scrolling HUD message won't display until it's unpaused. I tried looking into it and realized I couldn't get it to display without overhauling PopupText and preventing DaggerfallUI from disabling DaggerfallHUD upon pausing. It's a minor annoyance and I don't know if there are other ways I could display the screenshot message."
372877447,Cemetery ambient sounds,petchema,2020-02-09 21:43:36+00:00,2020-02-19 00:13:21+00:00,{},"Around cemeteries, classic plays creepy bird calls infrequently (once per minute on average), and howlings even less often (about 1/4th of the time).

During the day it happens on top of normal bird calls, so it's another layer of ambient sounds.
"
372812378,use nearClipPlane in 2D dungeon automap,petchema,2020-02-09 10:15:27+00:00,2020-02-18 23:56:57+00:00,{},"Use nearClipPlane to ""peel"" dungeon layers as you get closer.
This should makes the 2D automap more useful, and closer to classic behavior"
372065400,[RFC] DFUMessageBox.clickAnywhereToClose using any button but swing weapon one,petchema,2020-02-06 19:13:27+00:00,2020-02-08 02:13:52+00:00,{},Forums: https://forums.dfworkshop.net/viewtopic.php?f=12&t=3332
372054078,Fixes region update in $CUREWER,JayH2971,2020-02-06 18:45:43+00:00,2020-02-08 02:01:40+00:00,{},Region in letter would change when player moved. Now it'll be the region where letter is received only.
371542878,Do not update Magic Rounds when the game is loading,JorisVanEijden,2020-02-05 19:22:09+00:00,2020-02-08 03:40:09+00:00,{}," (or paused/inactive). This prevents issues where it would compare the worldtime of the previous game to the worldtime of the savegame. Which would run up to 2880 magic rounds when it should not.

See forum post https://forums.dfworkshop.net/viewtopic.php?f=5&t=3379"
371134820,fix spell casting female spellsword size,petchema,2020-02-05 01:04:50+00:00,2020-02-08 03:59:01+00:00,{},Forums: https://forums.dfworkshop.net/viewtopic.php?f=24&t=2961
371076987,adjust max loiter time message to setting,petchema,2020-02-04 22:14:10+00:00,2020-02-08 02:19:27+00:00,{},"
Is there a way to embed a line return in a message instead of having to use several messages to match classic text formatting?
"
370559873,Fix main quest questors issues,df-ferital,2020-02-03 22:44:46+00:00,2020-02-08 01:12:58+00:00,{},"This fixes issue #1688  which is related to my previous PR #1583.

Because main quest questors are added using the `add _NPC_ as questor` command, they are not always the last clicked NPCs, so we can't rely on this data to select quest related post success and post failure greetings. Instead, we can use faction IDs since all main quest questors are individual NPCs, having a unique faction ID. However to do that, we must also keep the `Person.isQuestor` flag as true, but this should not have any consequences since the `drop _NPC_ as questor` command effectively clears the NPC from the quest list of questors."
370505949,prevent mobile NPCs from entering stairs,petchema,2020-02-03 20:24:14+00:00,2020-02-08 04:16:50+00:00,{},"Use raycast as an additional check to localWeight == 0

Forums: https://forums.dfworkshop.net/viewtopic.php?f=24&t=792"
370070172,Set player race before generating backstory,numidium,2020-02-02 23:34:47+00:00,2020-02-08 01:13:26+00:00,{},"Addresses the bug described here: https://forums.dfworkshop.net/viewtopic.php?f=24&t=2220
The %ra macro, which uses the PlayerEntity's BirthRaceTemplate, is used while generating player backstory. Since BirthRaceTemplate is not set until after the player exits the new game wizard, %ra expands into the default race name i.e. Breton.
Setting the race template before generating backstory gives the macro helper the info it needs."
370035100,Improved outdoor footstep tile noises with shallow water and stone paths,jefetienne,2020-02-02 17:36:44+00:00,2020-02-18 23:35:11+00:00,{},"If a player is walking on shallow water, the PlayerMotor won't recognize it as a water tile and will make the PlayerFootsteps play regular grass terrain footstep noises. In my commit, I added additional index tiles that are corner pieces between ground and water to make splash noises, without actually being submerged in the water and set to ""swimming.""

I also added stone paths (indices 46, 47, 55) to use the dungeon tile floor noise, which I think fits nicely."
370002142,Add clearclick to S0000009,JorisVanEijden,2020-02-02 11:48:08+00:00,2020-02-08 01:57:24+00:00,{},"Clear _clickedElysana_ until the _giveLetter_ timer has expired. This prevents the quest prompt from popping up as soon as the _giveLetter_ timer expires when you clicked Elysana at any time after the quest started.
Forum post: https://forums.dfworkshop.net/viewtopic.php?f=5&t=3368"
369976637,Display current time on rest window,jefetienne,2020-02-02 06:10:41+00:00,2020-02-02 15:09:44+00:00,{},"This is a non-vanilla quality of life improvement that adds the current time to the left corner of the rest window. I felt like this would be a good addition to the UI because I personally found it a bit cumbersome to have to open up the status pop-up window first to read the time and then go back to the rest window if you needed to rest/loiter until a certain hour of the day for a quest or for a building to open. I also felt that displaying the time also made it more consistent with the resting windows in later TES games.

Screenshots (SDF and non-SDF):
https://imgur.com/a/48KpZil

Let me know if you feel like it needs a re-adjustment, or if you feel that it should be an optionally enabled feature by the launcher window settings."
369975113,Right-clicking clothing in inventory window changes its clothing variant,jefetienne,2020-02-02 05:45:35+00:00,2020-02-16 23:33:50+00:00,{'enhancement': 1},"This adjustment is both a quality of life improvement as well as a small bugfix.

Before this commit was made, if you click the ""Use"" button and then click an article of clothing, it will change its appearance. However, if you click an article of clothing that has a magical effect, it will not only change its variant but it will also incidentally cast the magic effect as well. This means it's only possible to change a magic clothing's appearance without casting only if you equip it and click it on the paper doll.

I made a nice little workaround and improvement to this by making it so if you right-click on the paper doll, or on the ""local"" and ""remote"" item panels, it will change its variant without casting a magic effect, and without having to click the ""Use"" button."
368818048,Allow to get UIWindowType enum value from type,AsesinoBlade,2020-01-29 23:30:48+00:00,2020-01-30 14:18:59+00:00,{'enhancement': 1},"I was looking for a method to return the type of window that is currently up.   I created GetType in UIWindowFactory to achieve this functionality.

An example of use would be 

            var manager = (UserInterfaceManager)sender;
            if (UIWindowFactory.GetType(manager.TopWindow.GetType()) == UIWindowType.Trade) {
‚Ä¶

thanks 
a"
368327762,Null check for list of effects when applying in the biog file,Aelthien,2020-01-29 01:22:26+00:00,2020-02-08 00:52:32+00:00,{},"If the list of effects is null the game will permanently lock up. So I simply added a check to see if the list is null and if so return the ""ApplyEffects"" function."
367279434,enemies fall damage,petchema,2020-01-27 00:37:22+00:00,2020-02-08 00:47:11+00:00,{},"While hard to reproduce, I've seen thieves bleed from a fall, so I assume fall damage exists for enemies too.

It's even harder to know what formula is used (beside decompilation maybe), for I've used the exact same formula as for player fall damage.

Forums: https://forums.dfworkshop.net/viewtopic.php?f=5&t=3353#p39126"
367254338,Make constant effects go into effect immediately on load,JorisVanEijden,2020-01-26 19:50:30+00:00,2020-02-08 02:07:25+00:00,{},"Start constant effects when they are resumed on load. Otherwise things like increased magicka are capped before the new max goes into effect.

Related forum post: https://forums.dfworkshop.net/viewtopic.php?f=24&t=3075"
367254260,Changing the magicka in the get method causes bugs during load.,JorisVanEijden,2020-01-26 19:49:30+00:00,2020-02-08 22:31:43+00:00,{},"Logically the cap should only need to be applied when the MaxMagicka changes.
This is the same logic used for health and fatigue.

This fixes forum bug https://forums.dfworkshop.net/viewtopic.php?f=24&t=3075

This reverts commit e1df2c3c2bd72c08f0b8f9d5b7c5b413cbad9eb0

"
367239286,Less stroboscopic fire walls,petchema,2020-01-26 17:04:27+00:00,2020-02-02 00:33:13+00:00,{},"
Lower the contrast of Fire god chamber fire walls, and slow down the animation, so it gets less aggressive on the eyes.

"
367206691,Move racial paralysis immunity from saving throw to immunity check.,JorisVanEijden,2020-01-26 11:07:52+00:00,2020-02-16 23:27:29+00:00,{},"Forum thread: https://forums.dfworkshop.net/viewtopic.php?f=24&t=3157

This makes High Elves 100% resistant to paralysis, regardless of the source of the paralysis or magic weaknesses.
"
367197573,Disable soultrap after capturing soul,JorisVanEijden,2020-01-26 08:58:05+00:00,2020-02-02 00:44:47+00:00,{}," to prevent capturing multiple souls when killing an enemy by multiple damage sources.

Related form thread: https://forums.dfworkshop.net/viewtopic.php?f=24&t=3187"
367119271,Prevent backward timetravel issues.,JorisVanEijden,2020-01-25 13:51:01+00:00,2020-02-02 00:37:17+00:00,{},"Fix for https://forums.dfworkshop.net/viewtopic.php?f=24&t=3309
0.10.17 - Vampire fast travel DFU hangs CUREVAM if target dungeon not present in region

The dungeon had nothing to do with it.
It was the fast travel going back 40 minutes in time. That made the unsigned integer calculation for how many minutes had passed return a huge number. (136 years) which triggered creating the vampire cure quest 591 times, which quickly runs out of random dungeons to assign.
"
367117802,Display launcher options if a key is pressed during startup,petchema,2020-01-25 13:30:20+00:00,2020-02-08 01:00:50+00:00,{},"Should make it easier for players to get the options back than find and edit settings.ini.

This does not automatically turn alwayShowOptions back on, so it can also be used for one-time display of options.

Forums: https://www.reddit.com/r/daggerfallunity/comments/etlqot/i_screwed_upwhere_do_i_go_from_here_to_make_it_so/"
366993587,fix static doors collider size,petchema,2020-01-24 20:01:43+00:00,2020-01-26 22:38:24+00:00,{},"In addition to using the max of width and depth as door thickness, swap Y and Z if Y size is less than Z size.

It seems to work fine (more testing welcome though), but I suspect the logic is not perfectly correct; I suspect Y and Z actually need to be swapped for grounded doors because you're actually entering by its top. As if door dimensions were considered _after_ rotations instead of before; They're really its X, Y and Z sizes, and not local width, height and depth. Or something like that. 
(and that could explain why width and depth can switch roles, probably depending on door orientation).

Forums: https://forums.dfworkshop.net/viewtopic.php?f=24&t=566"
366672771,Use correct indices for animations,numidium,2020-01-24 04:21:03+00:00,2020-02-02 00:33:52+00:00,{},Addresses the issue discussed in https://forums.dfworkshop.net/viewtopic.php?f=24&t=3316
365013905,Allow long unused textures to be unloaded,rossipaolo,2020-01-20 21:49:03+00:00,2020-02-02 00:41:45+00:00,{'enhancement': 1},"Added experimental setting ""AssetCacheThreshold"". If different than zero, this is the time in minutes from last access for which a texture can be stored in cache. During fast travels textures that exceed this value are removed to allow Unity to unload them if unused."
364575756,"Degrade equipped ""when held"" magic items over time",numidium,2020-01-19 20:28:36+00:00,2020-02-02 00:39:15+00:00,{},"I used @petchema 's findings here: https://forums.dfworkshop.net/viewtopic.php?f=24&t=2584&start=40

I tried using the ""%"" operator on the current game second but that was giving me race condition issues. I opted to use randomness since it wouldn't need to use the current game time. If introducing randomness to the mix doesn't feel right then I could rework the magic round loop.

Still need to find out how much to degrade on equip."
364570557,emissive maps: support more lights,petchema,2020-01-19 19:37:39+00:00,2020-02-02 00:32:26+00:00,{},"
Fix for forums: https://forums.dfworkshop.net/viewtopic.php?f=24&t=3289"
363914419,Speedchanger refinements,petchema,2020-01-17 00:49:15+00:00,2020-02-02 00:31:21+00:00,{},"FIx for #1588, and then some (like lowering player's noise volume when sneaking).

Note: 
playerMotor.speed is determined by both world conditions and player's input. While it's only required during FixedUpdate() for modifying movement(*), player's input can change with each Update() so that input must be recorded separately.
*. Except in LevitateMotor, that can adjust movement with each frame. If we care, we could update speed with each Update() too.
"
363722938,Stop headbobbing animation while player is not grounded,jefetienne,2020-01-16 16:04:19+00:00,2020-02-02 00:27:52+00:00,{'enhancement': 1},"One very small adjustment I wanted to make was the fact that the headbobbing animation, if enabled, would continue to play even if the player is in the air. I found it more noticeable if you are jumping while riding on a horse, and the camera still continues to shake. This simple added condition to check for if the player is grounded or not should fix this issue."
362480387,exclude player from weapon hit checks,petchema,2020-01-14 07:10:40+00:00,2020-02-02 00:25:56+00:00,{},"Seems to help hitting enemies at very close range

Forums: https://forums.dfworkshop.net/viewtopic.php?f=4&t=3172"
361748799,Set armor values correctly for shoes when loading equipment,ajrb,2020-01-11 17:32:00+00:00,2020-02-02 00:25:21+00:00,{},
359320062,fix quicksave overwriting save0 if used first,petchema,2020-01-05 17:21:59+00:00,2020-01-09 01:46:24+00:00,{'bug': 1},"Reading the list of existing save slots only happens when opening save window interface; So if quicksave is used first, it will see an empty list of slots and overwrite save0.

Fixed by reading folders once at initialization, alternative would be to check if it needs to be done in several places (QuickSave, HasQuickSave, QuickLoad, at least)

Forums: https://forums.dfworkshop.net/viewtopic.php?f=5&t=3303"
359171801,"complete all archives containing emissive textures, not only lights",petchema,2020-01-04 01:42:41+00:00,2020-01-04 22:42:03+00:00,{},"Had to replace test on isEmissive with resultEmissive l.285 because we can have one but not the other, I'm not sure it's to be expected.

Forums: https://forums.dfworkshop.net/viewtopic.php?f=24&t=2917
"
358531664,find revealed locations by a very common substring,petchema,2020-01-02 01:03:41+00:00,2020-01-02 01:04:07+00:00,{},"that's a consequence of search running in two passes: finding locations whose name best match the given string, then filter the list to only keep already revealed locations. And also the list produced by the first pass having a finite size.

They're screens upon screens of locations matching ""Ruins..."" (or ""Ruins of..."" for that matter) in the Wrothgarian Mountains, so only a subset of the names are kept by the first pass; And since the revealed dungeon name is not in the intermediate list (by pure bad luck), the second pass doesn't keep any names.

Simplest fix is just to increase the size of the intermediate list. The first pass creates the list using a priority queue, so it should stay very fast.
Other possibilities include swapping the two passes (search among the name of the locations that are revealed) but I don't know how fast we can create the list of all revealed locations; or add a predicate parameter to the function filtering names, so we can check if the location is revealed just before it's put in the intermediate list.

Forums: https://forums.dfworkshop.net/viewtopic.php?f=24&t=3292"
357284665,Year-end quest fixes,JayH2971,2019-12-27 17:14:47+00:00,2020-01-04 22:38:48+00:00,{},All witch quests tested and working
356857628,mod: npc health indicators,gnalvesteffer,2019-12-26 02:52:51+00:00,2019-12-26 02:53:07+00:00,{},Displays health indicators above NPCs.
356854338,Add several missing ui sounds (#1618 recovery),petchema,2019-12-26 02:23:19+00:00,2020-01-09 01:46:41+00:00,{},"I still think all this work done by @D0ct0r3d is interesting, so I'm recovering #1618 .

I didn't fix indentation myself before because of bad experience with committing directly into other people's repository, but now I have no excuses anymore...
"
356848932,adjust door thickness,petchema,2019-12-26 01:20:51+00:00,2020-01-04 22:33:01+00:00,{'bug': 1},"Improvement over 5b1d37a4b992f61cad1d2400fbca2ca0f218f312

It needs more testing, are there examples of cases that required the fix above?

Forums: https://forums.dfworkshop.net/viewtopic.php?f=27&p=37823#p37823"
356418978,Fix the addition of initial climbing skill check,ajrb,2019-12-23 18:40:58+00:00,2019-12-23 18:41:07+00:00,{},See https://forums.dfworkshop.net/viewtopic.php?f=5&t=3235
356088189,Don't suppress world when inside a building,df-ferital,2019-12-22 13:53:59+00:00,2019-12-22 23:16:01+00:00,{},Fix list of houses for sale not available when loading the game inside a bank: https://forums.dfworkshop.net/viewtopic.php?f=24&t=3034
356074966,<---> separator bug in S00000018,petchema,2019-12-22 10:45:12+00:00,2019-12-22 23:19:26+00:00,{'bug': 1},Makes reading the letter a 50% chance of reading one line
355768217,Shorten labels for rename and delete to fit using non-SDF fonts,ajrb,2019-12-20 15:05:45+00:00,2019-12-20 23:31:55+00:00,{},Also move all text into table file
355405450,Add location index to ensure nameseed is unique,ajrb,2019-12-19 22:49:01+00:00,2019-12-20 23:31:03+00:00,{},See https://forums.dfworkshop.net/viewtopic.php?f=5&t=3048
355327191,"Classic quest fixes, Dec 2019",JayH2971,2019-12-19 20:02:31+00:00,2019-12-20 23:29:23+00:00,{},"Much of this is enabling working quests and fixing the Questlist, which I left in a brutal state."
355225166,Corpse cleanup for player owned places,ajrb,2019-12-19 16:12:25+00:00,2019-12-20 23:27:15+00:00,{},"This was quite a mission doing this. See thread here for my journey: https://forums.dfworkshop.net/viewtopic.php?f=20&t=3213

The fix I made to StreamingWorld.InitPlayerTerrain() may break other stuff. I'm really not sure about it so would be good to have opinions from others."
354428817,Fix FPS display (tdbg) when game is paused,petchema,2019-12-18 05:12:36+00:00,2019-12-18 05:13:17+00:00,{},Forums: https://www.reddit.com/r/daggerfallunity/comments/ec7vsy/i_think_i_found_a_bug/
353820151,"For numeric input, accept numeric keys even without shifting",petchema,2019-12-16 22:44:02+00:00,2019-12-20 23:22:37+00:00,{},"In some locales, numeric keys normally require shifting to get digits.
Bypass this requirement for numeric inputs.

Added difficulty: on french keyboard, the 6 key is the shifted dash (-) key, so there's an ambiguity for relative numbers. So I restricted this to NATURAL numeric inputs.

Forums: https://forums.dfworkshop.net/viewtopic.php?f=5&t=3192"
353232885,bash-closing doors,petchema,2019-12-15 02:43:24+00:00,2019-12-20 23:22:01+00:00,{},"(Splitting #1645 in two separate PRs)

Sometimes enemies hide behind or ""inside"" opened doors, and player weapons miss them because they're bashing the door instead.

While trying to add door bashing sound in this case, I checked classic Daggerfall behavior and noticed that it does bash-closing of the door (usually; sometimes it gets confused and bash-opens already opened doors), and that attracts enemies attention just like bash-opening."
353225494,Weapon sounds when hitting walls,petchema,2019-12-15 00:20:43+00:00,2019-12-20 23:18:53+00:00,{'enhancement': 1},"Add clinging sound when you hit walls with a weapon
Limitations: 
- uses Parry6, I would have preferred a totally distinctive sound instead.
- works for all static objects, so hitting wooden furniture does a clinging sound too, even if one could expect the same sound as doors bashing.
- On the other hand non-static objects like elevators do no sound. I could have checked if the gameObject has a DaggerfallMesh component instead, but I don't know if that would have been okay

Forums: https://forums.dfworkshop.net/viewtopic.php?f=4&t=3172"
353191856,"Climbing skill check, item damage, and weapon anim time - migrated to formula and exposed to mods.",ajrb,2019-12-14 16:47:13+00:00,2019-12-20 23:15:28+00:00,{},"These formula use the new override system implemented by @TheLacus - it's brilliant!! :-)

* Added skill check when initiating climbing and tuned the default success percentages.

See https://forums.dfworkshop.net/viewtopic.php?f=5&p=36243 for discussion. Happy to tweak the numbers more before merging this one since I can always mod them in R&R. @Interkarma going to take your lead on this once you've tried out in game. You may want default to be more forgiving for that 'fun' factor!

* Moved frame time to formula and optimised FPSWeapon so it doesn't calculate constantly.

* Moved item condition damage calculations to formula.

* Moved the is item stackable checks into a formula.

Apologies for combining, but it's much easier for my mod development to have all these changes in the same branch rather than separated."
353184520,fix classic load by swapping free action and climbing effects,petchema,2019-12-14 15:20:03+00:00,2019-12-20 23:07:30+00:00,{'bug': 1},"Attachment: classic save with custom spells using all effects

Only other difference is missing effects (Shield, Dispell, Comprehend languages)

[SAVE4.zip](https://github.com/Interkarma/daggerfall-unity/files/3963960/SAVE4.zip)
"
353173787,Improved support for formula overriding,rossipaolo,2019-12-14 13:04:31+00:00,2019-12-14 16:06:54+00:00,{'enhancement': 1},"All formulas now are stored in a single dictionary and casted to appropriate type when retrieved. Also converted named delegates to generic `System.Func`, which allows to always use the exact signature without making compromises, and enforced load order.

```cs
FormulaHelper.RegisterOverride<Func<int, int, int>>(mod, ""CalculatePlayerLevel"", (startingLevelUpSkillsSum, currentLevelUpSkillsSum) =>
{
    return (int)Mathf.Floor((currentLevelUpSkillsSum - startingLevelUpSkillsSum + 28) / 15);
});
```"
352611759,Only iterate for location discovery within bounds of both arrays,ajrb,2019-12-12 21:09:40+00:00,2019-12-15 21:17:22+00:00,{},"Pretty sure this fixes the issue reported here: https://forums.dfworkshop.net/viewtopic.php?f=5&p=36523

Have not fully tested all discovery imports, but seemed to work okay with some classic saves I tried."
351633721,prevent 3d map from being rotated upside-down,petchema,2019-12-10 22:25:41+00:00,2019-12-15 00:16:38+00:00,{},"Can cause confusing with no benefits
![upside-down map](https://user-images.githubusercontent.com/1211431/70575558-08d6ba80-1ba7-11ea-92cb-e105707585bc.jpg)
"
351103401,Climbing skill check formula exposed to mods.,ajrb,2019-12-09 22:19:01+00:00,2019-12-14 16:42:02+00:00,{},"Added skill check when initiating climbing and tuned the default success percentages.

See https://forums.dfworkshop.net/viewtopic.php?f=5&p=36243 for discussion. Happy to tweak the numbers more before merging this one."
350985094,Show warning if mod is created on unsupported Editor version,rossipaolo,2019-12-09 20:04:24+00:00,2019-12-15 21:16:49+00:00,"{'mod system': 1, 'editor': 1}",A warning box is shown inside Mod Builder window if running on any version of Unity Editor which is not the supported one. It's still possible to ignore it and create mod anyway.
350352974,Add reset of drained stats to free temple healing,ajrb,2019-12-07 22:21:46+00:00,2019-12-08 01:46:28+00:00,{},The reset doesn't work correctly yet in this PR. Need Interkarma to take a look because I don't understand the effect system well enough to know why calling EndIncumbentEffect<DrainStrength>() for instance doesn't seem to work.
350342446,Sink nature flats slightly into ground on slopes,ajrb,2019-12-07 20:04:28+00:00,2019-12-08 01:48:50+00:00,{},"Sink nature flats slightly into ground as slope increases to hide floaty trees on sloped ground a bit. Sinks the flats proportional to angle of ground, with a max of 50/70 = 0.714 unity units on y axis.

Based on a suggestion from discord. Ratio seemed a good balance between no floating and buried sprites. Could be tuned more."
350305669,make mobileenemies noshadow flag explicit,petchema,2019-12-07 12:15:35+00:00,2019-12-07 12:15:58+00:00,{},"Should make life slightly easier for modders

Forums: https://forums.dfworkshop.net/viewtopic.php?f=27&t=2479&p=36052#p36052"
348010231,Remove replacement as not using format here,ajrb,2019-12-02 22:26:25+00:00,2019-12-02 22:26:48+00:00,{},
347933346,don't change footstep sounds during winter under snow-free climates,petchema,2019-12-02 19:20:38+00:00,2019-12-08 01:25:02+00:00,{'bug': 1},"
Forums: https://forums.dfworkshop.net/viewtopic.php?f=5&t=3108"
347327657,make sure dungeons's SongManager updates song with each dungeon,petchema,2019-12-01 13:10:49+00:00,2019-12-08 01:24:45+00:00,{'bug': 1},"Use OnTransitionDungeonInterior to update song based on dungeon.

I don't expect we'll switch to full event-driven SongManager immediately, as song selection depends on many factors...

Forums: https://forums.dfworkshop.net/viewtopic.php?f=24&t=3059"
347268632,World data dev,Interkarma,2019-11-30 23:22:27+00:00,2019-11-30 23:22:45+00:00,{},
347264351,Changes tabbing to spacing,JayH2971,2019-11-30 22:14:26+00:00,2019-11-30 22:15:49+00:00,{},"Fixes spacing in two quests, https://forums.dfworkshop.net/viewtopic.php?f=5&t=3095"
347264214,remove TAB characters from quest messages,petchema,2019-11-30 22:12:30+00:00,2019-12-08 01:25:16+00:00,{'bug': 1},"They display as (Unicode) garbage

Forums: https://forums.dfworkshop.net/viewtopic.php?f=5&t=3095"
347078748,Early customization of SaveGameWindow is now obsolete,rossipaolo,2019-11-29 14:54:27+00:00,2019-11-29 14:54:50+00:00,{'mod system': 1},"It was previously possible to make small changes to SaveGameWindow, like custom backgrounds and colors.
This is now made unnecessary by new UIWindowFactory which allows much more advanced customization to more than one window, so this feature is now obsolete and will be removed with a future update."
346838916,wrap AudioSource.PlayClipAtPoint,petchema,2019-11-28 21:43:38+00:00,2019-12-08 01:28:29+00:00,{'bug': 1},"Add volume setting and asynchronous loading

Forums: https://forums.dfworkshop.net/viewtopic.php?f=5&t=3078"
344958017,more standard fasttravel options selection,petchema,2019-11-24 22:39:25+00:00,2019-12-08 01:28:48+00:00,{'enhancement': 1},"The player must click on the alternatives he wants, instead of clicking on any alternative to toggle it.

Classic mode had a benefit though, you could test the effect of an alternative on cost and travel time without moving the mouse. So I moved the toggling behavior to the mouse wheel."
344922236,Use brighter green for selected fast travel options,petchema,2019-11-24 16:06:06+00:00,2019-12-08 01:29:05+00:00,{'enhancement': 1},"Many players seem to initially think the selected options are the ""red"" ones. Also, red vs green is an extremely poor choice for accessibility (color blindness).

Actually didn't use plain brighter green because it looks very ugly; Instead I added some relief using borders to make them appear more ""concrete"". Sadly I couldn't use thinner borders than 1 virtual pixel.

I also created another branch based on this one, that changes mouse click to select an option instead of toggling it, which also participates to new player's confusion; But that may be more controversial, so I kept that separate (interface modding material?): https://github.com/Interkarma/daggerfall-unity/compare/master...petchema:less-ambiguous-fasttravel-dialog
![FastTravelGreen](https://user-images.githubusercontent.com/1211431/69497432-4b2ca600-0edd-11ea-8156-4f61aa41784a.jpg)
"
344894354,Refactor quest system dependencies,JorisVanEijden,2019-11-24 10:48:07+00:00,2020-02-07 23:49:16+00:00,{},"Move creation of topics in the talkmanager from quest parsing to quest starting.
This allows parsing of quests without having to clean up the talkmanager afterwards.

See https://forums.dfworkshop.net/viewtopic.php?f=23&t=2995"
344811166,fix negative rented room time,petchema,2019-11-23 14:01:59+00:00,2019-11-24 22:07:56+00:00,{'bug': 1},"Also, I rewrote CheckRent() because it took me a while to understand that **-1** was a magic value for remainingHoursRented. The logic should be unchanged.

Forums: https://forums.dfworkshop.net/viewtopic.php?f=5&t=3043"
344702069,Add ability for mods to update the politic and climate for map pixels,ajrb,2019-11-22 21:15:54+00:00,2019-12-08 01:49:36+00:00,{},"This supports the ability to add new locations to the world data.

See https://forums.dfworkshop.net/viewtopic.php?f=22&t=3011 for more discussion."
344554036,Make previous position of difficulty dagger slowly fade away,petchema,2019-11-22 14:48:49+00:00,2019-12-08 01:36:20+00:00,{'enhancement': 1},"It can be difficult to assess by how much the difficulty dagger went up or down after adding an advantage or a disadvantage, specially since panels are being displayed on top of the dagger while it changes.

This adds a subtle animation that makes the previous position of the dagger fade away for a second.

It also gives a nice trail as you tweak your HPs per level"
344240015,Crosshair interaction icon options,ajrb,2019-11-21 21:23:20+00:00,2019-12-08 01:56:40+00:00,{},"Adds two options for the interaction icon to settings that replace the cursor with the icon, except for the general grab mode. This has been requested a few times to reduce the potential for mis-activations.
"
343326091,Adds several missing UI sounds,D0ct0r3d,2019-11-20 12:16:58+00:00,2019-12-26 00:37:31+00:00,{},"A large majority of all the sounds are now restored. There are still a few (approx 10%) buttons throughout that are still missing the sound to match classic. I'll add those as time permits and as I discover them. 

Everything i've added should be a 1:1 match for how classic did the sound. There are some buttons where you would think a clicksound would be appropriate for the feedback, but it wasn't in classic - so I didn't do it in the changes. I tried to replicate it exactly."
343302087,Added Missing Sounds to Inventory Window,D0ct0r3d,2019-11-20 11:17:09+00:00,2019-11-20 11:49:09+00:00,{},This adds some of the missing click sounds from classic throughout the game. 
343121049,fix: localized floating numbers handling,petchema,2019-11-20 05:17:20+00:00,2019-12-08 01:37:01+00:00,{'bug': 1},"Fixes two issues that only happen in some locales (like french) that do not use the dot as floating point separator:

- Join correctly writes lists of values with InvariantCulture, but TrySplit does not, leading to parse errors:

Failed to split values from 0.65,1.05
System.FormatException: Unknown char: .
  at System.Double.Parse (System.String s, NumberStyles style,
IFormatProvider provider) [0x00000] in <filename unknown>:0
  at System.Single.Parse (System.String s, IFormatProvider provider)
[0x00000] in <filename unknown>:0
  at System.Convert.ToSingle (System.String value, IFormatProvider
provider) [0x00000] in <filename unknown>:0
  at System.String.System.IConvertible.ToSingle (IFormatProvider
provider) [0x00000] in <filename unknown>:0
  at System.Convert.ToType (System.Object value, System.Type
conversionType, IFormatProvider provider, Boolean try_target_to_type)
[0x00000] in <filename unknown>:0
  at System.Convert.ChangeType (System.Object value, System.Type
conversionType) [0x00000] in <filename unknown>:0
  at
DaggerfallWorkshop.Game.Utility.ModSupport.ModSettings.Key.TrySplit[Single]
(System.String input, Int32 count, System.Single[]& items) [0x00000] in
<filename unknown>:0

(Filename: ./Runtime/Export/Debug.bindings.h Line: 43)

Failed to split values from 0.8,1
System.FormatException: Unknown char: .
  at System.Double.Parse (System.String s, NumberStyles style,
IFormatProvider provider) [0x00000] in <filename unknown>:0
  at System.Single.Parse (System.String s, IFormatProvider provider)
[0x00000] in <filename unknown>:0
  at System.Convert.ToSingle (System.String value, IFormatProvider
provider) [0x00000] in <filename unknown>:0
  at System.String.System.IConvertible.ToSingle (IFormatProvider
provider) [0x00000] in <filename unknown>:0
  at System.Convert.ToType (System.Object value, System.Type
conversionType, IFormatProvider provider, Boolean try_target_to_type)
[0x00000] in <filename unknown>:0
  at System.Convert.ChangeType (System.Object value, System.Type
conversionType) [0x00000] in <filename unknown>:0
  at
DaggerfallWorkshop.Game.Utility.ModSupport.ModSettings.Key.TrySplit[Single]
(System.String input, Int32 count, System.Single[]& items) [0x00000] in
<filename unknown>:0

(Filename: ./Runtime/Export/Debug.bindings.h Line: 43)

Failed to split values from 0.1,0.9
System.FormatException: Unknown char: .
  at System.Double.Parse (System.String s, NumberStyles style,
IFormatProvider provider) [0x00000] in <filename unknown>:0
  at System.Single.Parse (System.String s, IFormatProvider provider)
[0x00000] in <filename unknown>:0
  at System.Convert.ToSingle (System.String value, IFormatProvider
provider) [0x00000] in <filename unknown>:0
  at System.String.System.IConvertible.ToSingle (IFormatProvider
provider) [0x00000] in <filename unknown>:0
  at System.Convert.ToType (System.Object value, System.Type
conversionType, IFormatProvider provider, Boolean try_target_to_type)
[0x00000] in <filename unknown>:0
  at System.Convert.ChangeType (System.Object value, System.Type
conversionType) [0x00000] in <filename unknown>:0
  at
DaggerfallWorkshop.Game.Utility.ModSupport.ModSettings.Key.TrySplit[Single]
(System.String input, Int32 count, System.Single[]& items) [0x00000] in
<filename unknown>:0

(Filename: ./Runtime/Export/Debug.bindings.h Line: 43)

Failed to split values from 0.2,0.6
System.FormatException: Unknown char: .
  at System.Double.Parse (System.String s, NumberStyles style,
IFormatProvider provider) [0x00000] in <filename unknown>:0
  at System.Single.Parse (System.String s, IFormatProvider provider)
[0x00000] in <filename unknown>:0
  at System.Convert.ToSingle (System.String value, IFormatProvider
provider) [0x00000] in <filename unknown>:0
  at System.String.System.IConvertible.ToSingle (IFormatProvider
provider) [0x00000] in <filename unknown>:0
  at System.Convert.ToType (System.Object value, System.Type
conversionType, IFormatProvider provider, Boolean try_target_to_type)
[0x00000] in <filename unknown>:0
  at System.Convert.ChangeType (System.Object value, System.Type
conversionType) [0x00000] in <filename unknown>:0
  at
DaggerfallWorkshop.Game.Utility.ModSupport.ModSettings.Key.TrySplit[Single]
(System.String input, Int32 count, System.Single[]& items) [0x00000] in
<filename unknown>:0

(Filename: ./Runtime/Export/Debug.bindings.h Line: 43)

Failed to split values from 0.1,0.8
System.FormatException: Unknown char: .
  at System.Double.Parse (System.String s, NumberStyles style,
IFormatProvider provider) [0x00000] in <filename unknown>:0
  at System.Single.Parse (System.String s, IFormatProvider provider)
[0x00000] in <filename unknown>:0
  at System.Convert.ToSingle (System.String value, IFormatProvider
provider) [0x00000] in <filename unknown>:0
  at System.String.System.IConvertible.ToSingle (IFormatProvider
provider) [0x00000] in <filename unknown>:0
  at System.Convert.ToType (System.Object value, System.Type
conversionType, IFormatProvider provider, Boolean try_target_to_type)
[0x00000] in <filename unknown>:0
  at System.Convert.ChangeType (System.Object value, System.Type
conversionType) [0x00000] in <filename unknown>:0
  at
DaggerfallWorkshop.Game.Utility.ModSupport.ModSettings.Key.TrySplit[Single]
(System.String input, Int32 count, System.Single[]& items) [0x00000] in
<filename unknown>:0

(Filename: ./Runtime/Export/Debug.bindings.h Line: 43)

Failed to split values from 0,1.1
System.FormatException: Unknown char: .
  at System.Double.Parse (System.String s, NumberStyles style,
IFormatProvider provider) [0x00000] in <filename unknown>:0
  at System.Single.Parse (System.String s, IFormatProvider provider)
[0x00000] in <filename unknown>:0
  at System.Convert.ToSingle (System.String value, IFormatProvider
provider) [0x00000] in <filename unknown>:0
  at System.String.System.IConvertible.ToSingle (IFormatProvider
provider) [0x00000] in <filename unknown>:0
  at System.Convert.ToType (System.Object value, System.Type
conversionType, IFormatProvider provider, Boolean try_target_to_type)
[0x00000] in <filename unknown>:0
  at System.Convert.ChangeType (System.Object value, System.Type
conversionType) [0x00000] in <filename unknown>:0
  at
DaggerfallWorkshop.Game.Utility.ModSupport.ModSettings.Key.TrySplit[Single]
(System.String input, Int32 count, System.Single[]& items) [0x00000] in
<filename unknown>:0

- Other issue is related to float tuples deserialization; For example ConvenientClock allows to set clock scale, correctly write this setting in InvariantCulture format, but is not restored in game (clock stays at its nominal size)."
343057849,fix a NullReferenceException in DaggerfallVidPlayerWindow.IsPlaying,petchema,2019-11-20 04:21:52+00:00,2019-11-21 22:01:57+00:00,{'bug': 1},"LoadingScreen uses player.IsPlaying to poll when a video is finished
playing, but the video may have been cleared

NullReferenceException: Object reference not set to an instance of an
object
  at
DaggerfallWorkshop.Game.UserInterfaceWindows.DaggerfallVidPlayerWindow.get_IsPlaying
() [0x00000] in <filename unknown>:0
  at LoadingScreen.LoadingScreen+<DoDeathScreen>c__Iterator1.MoveNext ()
[0x00000] in <filename unknown>:0
  at UnityEngine.SetupCoroutine.InvokeMoveNext (IEnumerator enumerator,
IntPtr returnValueAddress) [0x00000] in <filename unknown>:0"
342762624,Quest fix Nov 2019,JayH2971,2019-11-19 16:11:44+00:00,2019-11-21 22:06:43+00:00,{},Fix text error C0C00Y10
342617121,prevent flying enemies from flying too low,petchema,2019-11-19 10:59:08+00:00,2019-12-08 01:39:20+00:00,{},"In frame 0 wings are in high position, assume body is the lower half

Forums: https://forums.dfworkshop.net/viewtopic.php?f=5&t=2898"
341771031,Add ability to spawn all magic weapons for testing mods,ajrb,2019-11-16 16:42:59+00:00,2019-11-24 22:10:02+00:00,{},Just a little update to the add_all_equip command
340202654,use .webm video format on Linux,petchema,2019-11-13 02:09:29+00:00,2019-11-14 04:06:07+00:00,{},".mp4 format is not supported by VideoPlayer on Linux:

https://docs.unity3d.com/Manual/VideoSources-FileCompatibility.html

Fix for #1550 "
339484387,fix facepicker aspect ratio,petchema,2019-11-11 15:19:27+00:00,2019-12-08 01:20:30+00:00,{},"Reuse code from EscortingNPCFacePanel
![faces](https://user-images.githubusercontent.com/1211431/68598388-01849a00-049f-11ea-9db6-6d5a715989c1.jpg)
"
339174740,Fix issues with replacement buildings,ajrb,2019-11-10 18:04:03+00:00,2019-11-24 22:09:35+00:00,{},"When altering named buildings, set factionId to zero and the building data pool items (from location) will be used as normal. Set factionId to >0 and pool items will not be used as it will be assumed this is a new named building.

This was the best way I could think of to fix the issues raised here https://forums.dfworkshop.net/viewtopic.php?f=5&p=34619#p34608

While also retaining the fix made by reverting in #1591 

@Interkarma I changed the pool items from a struct to a class so a ref is passed back and the pool item usage can be marked as unused if the replacement data is a new named building with a non zero faction id. Can you confirm this wont screw something else up? I couldn't see any potential issues with it."
339148337,skip climbing/rappel mode checks when not on foot,petchema,2019-11-10 13:02:00+00:00,2019-12-08 01:20:10+00:00,{},"Prevents trying to rappel down on horse or cart, for example.
Instead you'll just fall as per Newton's law; Should horses be unwilling to fall instead?
It seems falling off walls on horse is the way of classic too https://www.youtube.com/watch?v=1qco1jJmKu0

Also, is it the right place to check for transport mode?

Forums: https://forums.dfworkshop.net/viewtopic.php?f=5&t=2997"
339100331,Wagon weight modifiable,AsesinoBlade,2019-11-09 23:56:10+00:00,2019-11-11 18:55:55+00:00,{'enhancement': 1},"Hi, this is a simple change to modify wagonKGLimit from public const int to public static int to allow mods to change the value.  For my mod (Carry Weight Customizer) there was a request to also increase the limit on wagon weight.

thanks all
A "
338980209,"fix for bug: ""opening quest log can clear marked residences from map""",Nystul-the-Magician,2019-11-09 10:33:47+00:00,2019-11-14 03:59:30+00:00,{},"fix for bug described here: https://forums.dfworkshop.net/viewtopic.php?f=24&t=2994

info:
the line removed was the culprit causing the bug described, it was necessary before the discovery rework but is no longer needed (since named residences get correctly undiscovered once quest is handed in (I checked this) and when I reworked discovery system last time I changed it so that it deletes the discovery list of orphaned entries on load and save (function PlayerGPS.RemoveUnnamedResidencesFromDiscoveryData) - so no need to handle orphaned entries here"
338863434,Fix a bug when entering certain buildings riding a horse,ajrb,2019-11-08 21:21:31+00:00,2019-11-24 22:10:31+00:00,{},"Some extry doors are raised and cause issues when entered while on a horse since the controller height is larger so the raycast finds the streaming terrain somehow (I think) and the player is then moved under the floor by PlayerEnterExit.SetStanding()

This fix changes that method to always use the standing controller height rather than the dynamic value.

Reproduce the bug by entering the palace at Issaqumbaa  in Abibon-Gora while riding. Before this fix you fall though the world."
338220759,Implement option to partially parse a quest,ajrb,2019-11-07 20:12:41+00:00,2019-12-15 21:37:54+00:00,{},"This is what I considered doing when I originally implementing the quest lists option, but I was concerned about altering the quest parsing stuff so instead I decided to do full parse of every quest and have a 'please wait' message instead.

Since this is the root cause of the bugs we've seen with this feature, I've gone back to my original idea and added a boolean param that allows a partial quest parse to be requested. This doesn't parse the QRC or QBN sections, so the quest object returned is not startable.

This should fix #1536 and also speed up the list preparation. I've left the please wait message in there for now. It could be removed as it's quick enough with this change, but I would like to know that having this partial parse is acceptable by @Interkarma first. Also it's is nice flavor in a way, so I would be happy to keep it. Maybe just have a random delay as the quest giver goes to 'look' at availiable quests? :-)"
337559352,"Fix 1gp reward bug, properly this time!",ajrb,2019-11-06 20:23:35+00:00,2019-11-14 03:56:55+00:00,{},"Please someone check this before it goes out in a build. Ta.

Sorry for taking so long @Interkarma."
337057127,Add support for mod dependencies,rossipaolo,2019-11-05 22:56:56+00:00,2019-12-15 21:16:16+00:00,"{'enhancement': 1, 'mod system': 1}","Allows mods to define other mods as dependencies to enforce a minimum version to be installed and/or to be positioned above in the load order. Dependencies are also used for the creation of an automatic load order.

```json
""Dependencies"": [
    {
        ""Name"": ""dungeonexit"",
        ""IsOptional"": false,
        ""IsPeer"": false,
        ""Version"": ""1.0.2""
    }
]
```

![mods_dependencies](https://user-images.githubusercontent.com/24359151/68252696-76cb1780-0026-11ea-968f-0aa15f568820.png)
"
336318792,Show warning for incompatible mods when game is launched,rossipaolo,2019-11-04 14:52:11+00:00,2019-12-15 00:14:34+00:00,"{'enhancement': 1, 'mod system': 1}",A warning popup is shown if a mod is enabled and specifies a required game version that is higher than running build. It is possible to dismiss popup and launch the game anyway.
336085589,World data and quest action development for mods,ajrb,2019-11-04 00:06:36+00:00,2019-11-05 23:47:23+00:00,{},"Whew, this is a big one. I apologise in advance for the amount of effort this will take to review and check. It's going to allow some pretty cool stuff from modders though. I've been developing a new quest for the roleplay mod which has multiple paths, new npcs, new location, and dynamically changes the world providing a new service to successful players. These are all the changes I needed in core to make it possible. If anyone wants to test these changes with the new quest, let me know.

So here's a rundown of what's in this PR:

- Ability to override RMB blocks including ground data.
- World data variant system allowing dynamic changes to the game world. Variants can also be specific to a location, so just a single building in the whole world can be targetted for the changes.
- Allow multiple quest markers to be used when placing npcs and foes from quest scripts.
- Add new quest actions: worldupdate, clickedfoe (credit: DFIronman), enemies, killfoe, paymoney, journalnote.
- Allow new locations to be targetted as permanent quest sites.
- Enable adding data to quest tables from mods.
- Allow new individual npc's to use (almost) all of the faces in the game.
- Add a player lastname macro.
- Enable mods to add new merchant services.
- Various bugfixes.
"
334998562,Support providers of mobile person graphics,rossipaolo,2019-10-31 16:05:40+00:00,2019-12-15 21:15:55+00:00,"{'enhancement': 1, 'mod system': 1}","Allows mods to provide a gameobject that replaces mobile person prefab. An abstract component class is used to interact with the game, specifically to handle actual npc assignment and animation state.

This is a work in progress born from #1520


A basic example that replaces billboards with cubes:

```cs
using UnityEngine;
using DaggerfallWorkshop;
using DaggerfallWorkshop.Game.Entity;
using DaggerfallWorkshop.Game.Utility.ModSupport;

namespace MobilePersonCubeMod
{
    [ImportedComponent]
    public class MobilePersonCube : MobilePersonAsset
    {
        MeshRenderer meshRenderer;

        private void Awake()
        {
            meshRenderer = GetComponent<MeshRenderer>();
        }

        public override bool IsIdle
        {
            get; set;
        }

        public override void SetPerson(Races race, Genders gender, int personVariant, bool isGuard)
        {
            Vector3 size = GetSize();
            Trigger.height = size.y * 1.2f;
            Trigger.radius = size.x * 1.2f;
        }

        public override Vector3 GetSize()
        {
            return meshRenderer.bounds.size;
        }
    }
}
```"
334651602,Use correct formula for Masque of Clavicus,numidium,2019-10-31 03:57:59+00:00,2019-10-31 10:03:39+00:00,{},Thanks to @df-ferital for reverse-engineering the formula.
333991824,Increase accessibility of Trade Window for modding purposes,AsesinoBlade,2019-10-30 02:47:49+00:00,2019-11-01 20:00:20+00:00,"{'enhancement': 1, 'mod system': 1}","Hi all,
I am taking advantage of The UIFactory to add my inventory filter as a mod.  I need to have some variables and a method switched to protected in order to extend the window.

Thank you for your consideration.
A"
333784211,Add VS Code workspace settings and Json schemas,rossipaolo,2019-10-29 18:04:30+00:00,2019-12-15 00:10:54+00:00,"{'enhancement': 1, 'editor': 1}","Add _settings.json_ file for Visual Studio Code with the following options:

- `files.exclude` created automatically by Unity when the folder is opened for the first time.
- `files.associations` for TEMPLATE quest files (fall back to plaintext if TEMPLATE extension is not installed).
- `csharp` editor settings for space indent, with the value that is already used by all C# scripts.

This file can also be used to associate [json schemas](https://code.visualstudio.com/docs/languages/json#_json-schemas-and-settings), simplifying the creation of json files contributed by mods."
333688898,Fix NPCs factions and talk reactions,df-ferital,2019-10-29 15:24:56+00:00,2019-12-15 00:10:37+00:00,{},"This assigns correct factions to NPCs inside buildings, both to get the list of NPCs having work and to get a proper reaction when talking to such people. This also fixes the reaction value of all NPCs, including mobile ones.

Before, when talking to any NPC, his/her reaction value was always computed using the current region faction reputation. This corrects it by using the NPC faction or its parent one in case he's a member of a sub-faction (this matches what classic does).

Also, since I almost entirely decompiled classic talk system in C code, I saw how classic original code is a real mess in this case. For example, when talking to an NPC, its top parent faction of kind ""Group"", ""Province"" or ""Temple"" is used to get his reaction value. But then, the original NPC faction is also used to get the greeting number when the NPC belongs to ""People of"" or ""Court of"" current region... So I simplified this to always use the NPC parent group reputation in both cases, including ""People of"" and ""Court of"" in what I'm calling ""parent groups"". Well, except if the NPC is an Individual: if you are loved by Court of Daggerfall but hated by King Gothryd, there is absolutely no reason the latter would greet you warmly.

I also changed one last thing: NPCs belonging to Random Ruler, Random Noble and Random Knight factions now always use the ""Court of"" their current region faction. The above generic factions are useless and this makes much more sense. "
333392111,Use WoodlandHills flats in MountainWoods climate,jammerlich,2019-10-29 01:26:19+00:00,2019-10-29 03:22:09+00:00,{},Change only the climate from https://github.com/Interkarma/daggerfall-unity/pull/1592
333372648,"Use WoodlandHills flats in MountainWoods climate, set Swamp and SubTropical people to Redguard",jammerlich,2019-10-28 23:48:58+00:00,2019-10-29 01:20:42+00:00,{},"This fixes the issue with WoodlandHills flats being unused in MountainWoods climate regions as discussed in this thread: https://forums.dfworkshop.net/viewtopic.php?f=4&t=2927

It also sets the People faction to Redguard in Swamp and SubTropical regions as these are entirely within Hammerfell."
333287786,Revert change from PR#1557 to building matching,ajrb,2019-10-28 19:35:19+00:00,2019-10-28 21:33:08+00:00,{},"This change meant that replacement buildings e.g. new guilds could take a guild hall entry out of the pool, messing up the matching algorithm.
This does mean that replacement classic guild buildings probably won't work without futher changes, but this fixes an issue where classic guilds are broken with the Archaeologists mod in DFU 0.10.8 - 0.10.10"
333275537,Gold infopanel update,petchema,2019-10-28 19:03:57+00:00,2019-12-08 01:19:41+00:00,{'enhancement': 1},"Show amount of gold and gold weight in infopanel when the mouse hovers over the inventory GOLD button

I reify the gold pieces into a temporary DaggerfallUnityItem for the purpose of this feature; That may not be optimal, but this is not in a performance critical path and allows good code reuse...

Forums: https://forums.dfworkshop.net/viewtopic.php?f=23&t=2717"
333211203,Add the ability to rename saves from the main UI,df-ferital,2019-10-28 16:35:57+00:00,2019-12-14 23:59:33+00:00,{'enhancement': 1},"This adds a ""Rename save"" button on the left of the ""Delete save"" one to be able to rename saves from the UI.

![rename_save](https://user-images.githubusercontent.com/46795115/67698134-0d099880-f9aa-11e9-947c-9178ce569309.png)

"
332540084,"World data override system development (WIP, not ready for merge)",ajrb,2019-10-25 14:28:57+00:00,2019-10-30 23:45:53+00:00,{},"This is my continued development of the world data systems. Doesn't seem to break anything that I've noticed during my testing, but I will understand if you would rather hold off releasing.

- RMB blocks can now be replaced, have added a custom serializer for the ground data
- Added world data variants system so different overrides can be used based on triggers - works for locations, blocks and buildings.
- Variant blocks/buildings can be triggered just for a specific location or for every instance the block used
- Variants triggered are saved & loaded from a new file
- Adds a quest action 'worldupdate' so quests can trigger variants
- Fixed some issues with dump commands"
331882154,Small copy/paste mistake fix.,JorisVanEijden,2019-10-24 06:44:56+00:00,2019-10-24 20:45:27+00:00,{},"The ""named"" version of anyInfo is not used in any current quests but if we support it it should work correctly."
331211537,Fixes for DFU 0.10.8,ajrb,2019-10-22 21:16:46+00:00,2019-10-24 20:40:51+00:00,{},"Fix identify spell trade window construction call
Fix ship purchase popup window (fixes #1579)
Fix gold rewards for non-guild NPCs with faction ids - hopefully this will fix the 1gp bug, but I don't have a save to test this with"
330845427,Set main quest NPCs as questors,df-ferital,2019-10-22 07:29:58+00:00,2019-12-14 23:58:29+00:00,{},"Main quest questor NPCs were never flagged as questors, so they never said their post success or post failure greetings to the player.

Also fix quest S0000005 where Aubk-i post success and post failure greetings were inverted. And removed the word ""dead"" from post failure greeting as neither her husband nor her husband's grandmother are dead.

Edit: I'm not a native English speaker, but it seems to me that ""The %ra that refused visit my husband's grandmother"" should be changed to ""The %ra who refused to visit my husband's grandmother"". Could someone confirm?"
330478313,Fix %qdt macro expansion,df-ferital,2019-10-21 15:26:06+00:00,2019-10-24 21:08:25+00:00,{},"Correct macro %qdt expansion so each quest log entry now has its own time as in classic. Before that, it always resolved to quest start time.

Also fix quest K0C01Y00 message 1017 which always used the current time.

Note that this doesn't break current savegames as I added a check to ensure `LogEntry.dateTime` is not `null`. Else, it resolves to quest start time as before this fix."
330162712,fix minor typo,Arcane21,2019-10-20 21:58:35+00:00,2019-10-21 00:11:41+00:00,{},Fixes a stray typo missed in earlier pull request
330016511,Fixes for the upcoming build,ajrb,2019-10-19 12:42:02+00:00,2019-10-20 01:50:05+00:00,{},"Instantiate persistent windows only when needed and allow re-instantiation. Allows persistent windows to be replaced.

Made members protected on rest and pause windows during testing. All windows will require protections to be modified, but I suggest we do them as required. I certainly don't want to do them all en masse.

Fix loading new locations from dfmod's. Have to wait until mod manager is initialised before checking for new locations and filling cache

Move mod manager singleton creation."
329878864,Prevents holding on to dead body in two R quests,JayH2971,2019-10-18 18:48:13+00:00,2019-10-19 04:28:20+00:00,{},Fixes https://www.reddit.com/r/Daggerfall/comments/dje4ki/got_an_unremovable_200_kg_dead_body_in_my/
329711370,Remove house for sales from the list of questors locations,df-ferital,2019-10-18 12:22:34+00:00,2019-10-19 04:28:47+00:00,{},"No more potential questors in  ""House for sale"" when asking NPCs for available work."
329686369,Fix PC greeting text for the first question,df-ferital,2019-10-18 11:13:38+00:00,2019-10-19 04:29:31+00:00,{},"Fix the the first question greeting which was not updated when changing talking tone and also match classic behavior in using specific greeting names for NPCs (friend, mate, bud...) when NPC reaction is negative, see below:

Before:
![before](https://user-images.githubusercontent.com/46795115/67089885-fcd30b80-f1a8-11e9-9826-0dc624c62eba.png)

After:
![after](https://user-images.githubusercontent.com/46795115/67089891-00669280-f1a9-11e9-8320-e5989f05be0d.png)
"
329479185,Add UIWindowFactory,ajrb,2019-10-17 21:57:06+00:00,2019-10-19 04:32:30+00:00,{},Add a UIWindowFactory to allow mods to provide new implementations of UI windows
329239734,raise event on teleporting out of dungeons,petchema,2019-10-17 12:42:43+00:00,2019-10-19 04:25:48+00:00,{},"
raise transition event on teleporting out of dungeons so it can be handled by Persistent Dungeons mod.

/!\ It seems to work, but I won't pretend I understand all what's going  on.

Forums:
https://forums.dfworkshop.net/viewtopic.php?f=27&t=1667&p=29398#p29398"
329002834,Remove black background behind HUD active spells,petchema,2019-10-16 23:38:22+00:00,2019-10-16 23:39:03+00:00,{},Forums: https://forums.dfworkshop.net/viewtopic.php?f=23&t=2869
328982745,Fix gold rewards,ajrb,2019-10-16 22:19:09+00:00,2019-10-19 04:26:36+00:00,{},"Fix gold rewards for guild quests, following TODO notes with faith they are correct. 
Ensure faction id is availiable for gold calc and implement Fighters Guild benefit of increased rewards

"
328478662,Override world data for locations and dungeons,ajrb,2019-10-15 21:43:45+00:00,2019-10-19 06:33:55+00:00,"{'enhancement': 1, 'mod system': 1}","This extends the world data replacement system to handle:

- Adding new locations
- Changing existing locations
- Adding new dungeon blocks
- Changing existing dungeon blocks
- Updates to world data dump commands

Indexes are automatically assigned to any new locations or blocks added, and the system hooks into the content file readers to seamlessly layer new or altered world data into the DFU engine. New locations and blocks are fully integrated with all the Daggerfall game systems and should be able to be targets for quests, which I need to be able to exclude somehow in the future, and locations appear on the travel map and can be fast travelled to.

I will be documenting how to use this system on the forums over the coming days."
328427037,Support live changes to mod settings,rossipaolo,2019-10-15 19:25:08+00:00,2019-10-19 06:34:53+00:00,"{'enhancement': 1, 'mod system': 1}","Adds support for live changes to mod settings. Mods that whish to implement this feature need to set property `Mod.LoadSettingsCallback` when they are started.

The value is a callback that receives an instance of `ModSettings` and `ModSettingsChange`, the latter being an holder for informations on the change event. Specifically, mods can use `bool ModSettingsChange.HasChanged(string section, string key)` to retrieve if a specific setting has changed.

For the time being, this feature is provided experimentally with a console command that opens a UI window.

Here's a simple example where the callback is assigned and immediately used for first time init where all settings are ""changed"". From now on, this method is also called automatically when settings are changed by player in game.

```cs
public class Test : MonoBehaviour
{
    Mod mod;

    [Invoke(StateManager.StateTypes.Game)]
    public static void Init(InitParams initParams)
    {
        var test = new GameObject(""Test"").AddComponent<Test>();
        test.mod = initParams.Mod;
    }

    private void Awake()
    {
        mod.LoadSettingsCallback = LoadSettings;
        mod.LoadSettings();
        mod.IsReady = true;
    }

    private void LoadSettings(ModSettings settings, ModSettingsChange change)
    {
        if (change.HasChanged(""Foo""))
        {
            var number = settings.GetValue<int>(""Foo"", ""Number"");
            var color = settings.GetValue<Color32>(""Foo"", ""Color"");
        }

        if (change.HasChanged(""Bar"", ""Text""))
        {
            var text = settings.GetValue<string>(""Bar"", ""Text"");
        }
    }
}
```"
327848502,Boost Jumping for lycanthrope characters,df-ferital,2019-10-14 15:08:45+00:00,2019-10-19 04:24:34+00:00,{},"Add the missing bonus to Jumping skill for werewolf or wereboar characters. I also fixed the UESP page in the meantime, which lacked this information (https://en.uesp.net/wiki/Daggerfall:Lycanthropy#Advantages)."
327550226,Do not delay quest create foe by one spawnInterval,petchema,2019-10-13 12:15:13+00:00,2019-10-19 04:23:49+00:00,{},"Forums:
https://forums.dfworkshop.net/viewtopic.php?f=25&t=2556&p=32825#p32825"
327535022,(de)buff icons sizes and positions,petchema,2019-10-13 08:24:39+00:00,2019-12-08 01:18:48+00:00,{'enhancement': 1},Allow to select between different (de)buff icons layouts
327353990,Fix custom activations to work with replaced meshes,ajrb,2019-10-11 20:21:58+00:00,2019-10-12 18:09:49+00:00,{},
326970864,Enemies light effects [RFC],petchema,2019-10-10 23:36:22+00:00,2019-12-06 05:56:12+00:00,{},"This is my attempt to fix #1544, and also remove vampires and ghosts shadows.
Limitations:

- When using ""cm"" command, spawn enemies do not have light effects, that could mean I'm adding light effects at a too ""high"" in the code?
- Some parameters like light position is hardcoded, I think it looks good but maybe not compatible with future enemies modding? ( https://forums.dfworkshop.net/viewtopic.php?f=12&t=1983 )

So I'm mainly pushing it here to increase the visibility of this patch"
326304847,Enable guild modding,ajrb,2019-10-09 15:07:58+00:00,2019-10-16 21:39:04+00:00,"{'enhancement': 1, 'mod system': 1}","* **Extract IGuild interface and use it instead of Guild abstract class** - This will allow mods to be more easily created with guild implementations that deviate from default vanilla guild behaviour. Note there are still some constraints, like 9 rank based etc.

* **Allow vanilla guilds to be overridden** - by registering a new implementation extended from core or completely new implementations.

* **Move save/new event unregistering into guild classes** - This is so that GuildManager.ClearMembershipData() does not call Leave() to unregister the guild events. This is because the clear method is for clearing memberships while loading etc (happens twice) and is not for when the player is actually leaving the guild. If mods add behaviour for leaving, it should not be initiated when just saving/loading/new game etc. Now only RemoveMembership calls Leave() so this is the case. "
326227458,Don't attempt to create textures for non existant images with zero width/height,ajrb,2019-10-09 12:27:50+00:00,2019-10-12 19:31:55+00:00,{},"This allows virtual assets (i.e. don't exist in vanilla files) to be replaced by mods. I am using it to allow extra images for the horses neck to be contributed by other mods and used by R&R mod, even though none exist in vanilla DF."
325446038,Unregister events for TG and DB guild instances,ajrb,2019-10-07 18:59:21+00:00,2019-10-09 11:10:21+00:00,{},"So they are correctly garbage collected and guild halls are not erroneously revealed after load/new game.

Supercedes PR #1559.

-----
Previously, Thieves Guild or Dark Brotherhood instances were never garbage collected because PlayerGPS and StreamingWorld kept strong references to them through events OnEnterLocationRect and OnAvailableLocationGameObject. This, because unsubscribing to these events took place in both class destructors, so, to summarize, it never happened.

This resulted in the following behavior: if you loaded a savegame with a character who was a member of any of these guilds, then loaded another savegame from another character who wasn't, you would still discover the guild hideouts using the automap.

Unfortunately, any game saved prior to this fix may still have the guilds available on the automap, this because all discovered buildings are saved."
325365884,Fix some circular dependencies so TG and DB are proplerly GC'ed,df-ferital,2019-10-07 15:35:42+00:00,2019-10-09 11:09:49+00:00,{},"Previously, Thieves Guild or Dark Brotherhood instances were never garbage collected because `PlayerGPS` and `StreamingWorld` kept strong references to them through events `OnEnterLocationRect` and `OnAvailableLocationGameObject`. This, because unsubscribing to these events took place in both class destructors, so, to summarize, it never happened.

This resulted in the following behavior: if you loaded a savegame with a character who was a member of any of these guilds, then loaded another savegame from another character who wasn't, you would still discover the guild hideouts using the automap.

Unfortunately, any game saved prior to this fix may still have the guilds available on the automap, this because all discovered buildings are saved."
325075218,Add all equippable items command,ajrb,2019-10-06 21:14:07+00:00,2019-10-13 18:42:29+00:00,{},"Enable testing of paperdoll images as requested by #1543.

Adds all types of equippable items for the current character gender/race, but doesn't add variants.

Also extended dumpblock command to be able to dump dungeon blocks, and added a dumplocation command to dump location records."
325071944,Interior replacement core changes,UncannyValley21,2019-10-06 20:34:04+00:00,2019-10-17 23:36:57+00:00,{},"A clean commit with all changes to the existing core system

-3D props can now be rotated in X and Z. Default is set to 0 so it doesn't affect vanilla Assets
-Ladders will only be set to interactive if they are set uo as objectType 3 (propModel), all vanilla ladders are set up this way
-When replacing buildings, always use the original NameSeed, LocationID and Sector values"
325061439,Add gender filtering for social quests,ajrb,2019-10-06 18:38:14+00:00,2019-10-17 23:35:56+00:00,{},"Applied M (male) to all quests with ""group Questor male"" in quest list

Should fix #1542 to match classic. Needs some checking by ferital."
325057776,prevent clicking on EXIT while banking amount input in progress,petchema,2019-10-06 17:56:51+00:00,2019-10-08 21:37:02+00:00,{},"Seems to confuse some people, that input some amount, close the window and expect the transaction to have happened.

Another solution would be to open a dialog box to input transaction amounts; But it doesn't match classic screens."
324974355,Expose horse animations frame index for mods,ajrb,2019-10-05 20:37:24+00:00,2019-10-08 21:37:26+00:00,{},Needed for next version of enhanced horse riding to allow hi-res graphics
324933443,Don't display a message when entering a TG or DB,df-ferital,2019-10-05 11:55:34+00:00,2019-10-09 18:49:30+00:00,{},"Actually don't display the message if player is a member of the guild, as classic does. I wasn't able to test the case where player is not a member as in DFU, it seems Thieves Guild and Dark Brotherhood hideouts are always locked in this case.

Edit. @ajrb confirmed that contrary to what classic does, DFU behavior is to always lock Thieves Guild and Dark Brotherhood hideouts when player is not a guild member, so I simplified the check."
324367564,Add IPlayerActivable interface for custom activations,rossipaolo,2019-10-03 19:18:36+00:00,2019-10-17 23:34:12+00:00,{'enhancement': 1},"Added an interface which can be used to subscribe to custom player activations for any object. I'm personally going to use it for my harvesting mod where i need to detect when a crop is picked.

"
324055214,"Commoner Quests:  errors and inconsistencies in punctuation, grammar, spelling, spacing",bansheexyz,2019-10-03 05:44:50+00:00,2019-12-14 23:55:45+00:00,{},"Notes:
-lots of missing commas or apostrophes that are technically necessary, and many commas where a period should be. Proper punctuation helps readability.
-about 10% of the time, two spaces followed a period. This inconsistency has been removed in favor of one space everywhere. The two-space thing is an old style with monospaced typewriters that has fallen out of favor in modern text.
-ellipses did not have consistent spacing
-there is an awkward lack of contractions, but only in a few instances does it sound so bad that I thought it warranted a change. ""It is you!"" is one example.
-there are a few macro fixes of %g2 and %g3 being swapped
-I am a strong writer and have a BA in English. Please discuss or post links to grammar articles if you think there is an error here."
323903459,Inventory filter,AsesinoBlade,2019-10-02 19:16:15+00:00,2019-10-05 17:09:00+00:00,{'enhancement': 1},"Hi all, I created this pull request so that you can review my code changes regarding a filter on the inventory window.  When you enter a filter, and click on filter, it will perform a case-insensitve comparison of the filter against the long name and the item group name.  It also accepts ""-"" if you want to negate a filter.  For example, if you type ""-steel armor"", it will find all armor not made of steel.
This filter applies to both local and remote.
The filter is cleared when you switch tabs or close the inventory window.

Thanks all
a"
322547020,Optimize location loading,df-ferital,2019-09-29 22:28:42+00:00,2019-12-22 12:00:50+00:00,{},"Improve location loading by keeping the list of blocks related to a location inside `DFLocation`. I made this after I noticed `RMBLayout.GetLocationBuildingData` was called several times: when entering a town, when entering a building, when talking to a NPC, etc. Unfortunately, calling this method can be relatively heavy in large cities (around 0.150s on my computer). Furthermore, when loading a savegame or when travelling to a new location, the method can be called 4 or 5 times.

So, this PR improves performance while making a location buildings list accessible immediately, reducing code bloat and improving overall clarity. The only drawback comes from `Clock.GetTravelTimeInSeconds` which may become a little slower, since it does not require location buildings list, only location coordinates. However, this isn't really noticeable in game."
322506598,Fix precision issue with custom dungeon exit doors,rossipaolo,2019-09-29 13:47:37+00:00,2019-10-17 23:32:39+00:00,{'mod system': 1},
322481046,remove LegacyDeferred setting,petchema,2019-09-29 07:42:21+00:00,2019-10-17 23:32:14+00:00,{},"It seems to no longer work correctly with recent Unity, it's becoming a way for players to shoot themselves in the foot, so drop it altogether.

Are there anything to remove beside camera.renderingPath tweak?

Forums: https://forums.dfworkshop.net/viewtopic.php?f=5&t=2183"
322472428,Fix micromap size,numidium,2019-09-29 05:31:18+00:00,2019-10-17 23:31:48+00:00,{},My previous PR fixed the micromap for some dungeons but not all.  This increases the size of the micromap so that dungeon blocks won't run off the end of the texture.
322428917,Mod support for item usage and ship availiablity,ajrb,2019-09-28 16:59:00+00:00,2019-10-04 18:43:21+00:00,{},"Add ability to register custom item usage handlers for vanilla items.
Allow ship availiability to be defined by mods.

Will be used by next version of R&R modpack for bandage usage and only allowing ships to be boarded in port towns."
322403901,Fix mismatch between questPool and questPicker.ListBox.,JorisVanEijden,2019-09-28 10:47:50+00:00,2019-10-17 23:31:25+00:00,{},"Also prevent loading quests twice.
https://forums.dfworkshop.net/viewtopic.php?f=5&t=2790&sid=46b0dbc40ac30f112d73be0fefb16002"
322169461,Expand %g3 macro when asking for work,df-ferital,2019-09-27 13:38:28+00:00,2019-10-08 21:31:31+00:00,{},"While very rare, %g3 is also used when asking for work."
321823915,Guard against array index out of bounds.,JorisVanEijden,2019-09-26 17:15:58+00:00,2019-10-17 23:30:16+00:00,{},"And that's all this does.
It does not increase the label limits, it just doesn't show any labels above the limit.

Fix for https://forums.dfworkshop.net/viewtopic.php?f=25&t=2780"
321114046,fix for incorrect residence name resolving for quest person resources,Nystul-the-Magician,2019-09-25 08:05:54+00:00,2019-10-17 23:29:35+00:00,{},(fixes issue https://forums.dfworkshop.net/viewtopic.php?f=24&t=2730)
320472803,Disables k0c00y06,JayH2971,2019-09-23 20:43:03+00:00,2019-10-17 23:29:00+00:00,{},"Sorry, this PR has some junk (2a7c0c5 and 74eb689) based on my master branch and I don't know how to wipe them out. This is intended to only comment out k0c00y06 in QuestList-Classic. If I've done it badly you can reject it."
320115801,make sure videos play under best conditions,petchema,2019-09-23 03:20:26+00:00,2019-10-17 23:28:28+00:00,{},"- stop digitalized music (only MIDI synthesis was muted);
- stop ambient loop sounds
- videos played by quests can only be interrupted by Escape key. This should prevent mouse clicks from accidentally closing the video.
- implement HideCursor. This requires some cooperation with PlayerMouseLook that constantly updates mouse cursor visibility. I'm not sure how to best interact with it though"
320067249,Change nature 3d asset replacement to limit performance hit,ajrb,2019-09-22 17:46:17+00:00,2019-10-17 23:26:21+00:00,"{'enhancement': 1, 'mod system': 1}","Change 3d asset replacement for nature flats to only replace when terrain distance is <=1 for performance. At larger terrain distances, the standard DFU billboard system is still used since it's highly efficient and billboards are more than sufficient at this distance.

The nature flats used with standard DFU billboarding can still be replaced with high-res/different images.

- Update natures on terrains moving in/out of dist 1.
- Only do extra updates once any nature mesh replacement has been found.
- Ensure nature mesh replacement doesn't change nature placement. (bugfix)"
320064354,Ensure that player pitch is within limits,ajrb,2019-09-22 17:12:45+00:00,2019-09-23 19:55:42+00:00,{},Refinement of pitch limit setting for enhanced horseriding implementation.
319970244,player smoother movements,petchema,2019-09-21 15:53:42+00:00,2019-10-17 23:25:10+00:00,{},"- smooth follower could be reset very often at high FPS because speed threshold was computed based on framerate instead of fixed updates

- unstick handling could trigger during movements tangential to the (world) origin

Forums: https://forums.dfworkshop.net/viewtopic.php?f=5&t=2435&p=31737#p31728"
319879856,Import contributes to ItemTemplates from mods,rossipaolo,2019-09-20 21:04:15+00:00,2019-09-20 21:05:18+00:00,"{'enhancement': 1, 'mod system': 1}","Support changes to ItemTemplates data, requested by @ajrb."
319171675,Allow access to hide billboards for mods.,concarne000,2019-09-19 09:08:08+00:00,2019-11-29 14:52:50+00:00,"{'enhancement': 1, 'mod system': 1}","Here is a solution I've found to give public access to force hide a billboard, specifically with the intention of implementing 3D models, without impacting the engine or other mods, while also being able to access the engines concealment for magic effects."
318611282,Show loading text before loading game,numidium,2019-09-18 03:30:11+00:00,2019-12-14 23:54:26+00:00,{'enhancement': 1},"When playing on slower systems I've found myself wondering if the click registered after I selected ""Load"" in the Load Game window.  This gives the user simple visual feedback to assure them that the game is loading."
318605667,Grammar and typo fixes,Arcane21,2019-09-18 02:58:51+00:00,2019-10-17 23:17:44+00:00,{'enhancement': 1},"Fixed many improperly spelled items, capitalized many proper nouns, some consistency fixes"
318569739,Adds possibility of quest NPC infighting,JayH2971,2019-09-17 23:37:05+00:00,2019-10-17 23:29:05+00:00,{},"Requires a custom quest mod, which is not implemented in DFU core, to take advantage"
318470351,Quest person factions fix,JorisVanEijden,2019-09-17 18:32:25+00:00,2019-10-17 23:11:56+00:00,{},"Allow Daedra to be used as named NPC as per https://www.dfworkshop.net/static_files/questing-source-docs.html#permanentnpc

Also fix 2 broken quests that were using ""named"" to align an npc with a provice, which prevented them from loading.
"
317868303,Location Editor and and some related changes,UncannyValley21,2019-09-16 13:01:18+00:00,2019-10-06 19:22:23+00:00,"{'enhancement': 1, 'mod system': 1}","- Adds a Location Editor
- Extends x and y rotation for RmbBlock3dObjectRecord
- Added missing data on building export
- Fixed issue where overwritten buildings would not get a its name correctly from the generated name seed 
"
317687063,Fix typos in game settings,ghost,2019-09-16 00:51:55+00:00,2019-09-23 18:23:59+00:00,{},"Fix some random typos I noticed in the game settings. I'm new to github, please make sure that I'm editing the right file and didn't break anything."
317642901,Fix micro map rendering incorrectly in large dungeons,numidium,2019-09-15 14:34:01+00:00,2019-09-25 23:40:42+00:00,{},Wide dungeons such as Scourg Barrow and the Mantellan Crux were rendering incorrectly on the micro map when modules were offset by more than 3 down or to the right.  This simply moves the origin to give them more room.
317588476,Refactor ugly if statement,numidium,2019-09-14 20:34:34+00:00,2019-09-14 21:21:09+00:00,{},Another contributor pointed this out to me.  Honestly not sure what possessed me to write something this awful.
317556980,Improved keyboard support [RFC],petchema,2019-09-14 12:06:35+00:00,2020-01-04 22:35:01+00:00,{'enhancement': 1},"This adds keyboard support for standard dialog boxen (Y/N prompts, etc.), but also some special dialog boxen (Options menu, Resting, Traveling) and screens (Inventory, Trading). It also replaces hardcoded key bindings of daedra quests Y/N prompts and travel map.
I borrowed the HotkeySequence class from the automap then extended it to support virtual key modifiers (say, Shift that matches either LeftShift or RightShift), then after that changed the logic to AND modifiers together.
All bindings are configured in an external DialogShortcuts.txt file, so they can be localized.

Before going on I submit this patch in its current state for review.
For example its integration into UI code (Panel, Button) is superficial and must be called explicitly, that can probably be improved but I'm not sure how it was planned. It could also be that I'm going in a totally wrong direction, just let me know.

Forums: https://forums.dfworkshop.net/viewtopic.php?f=4&t=1448"
317016308,Update crosshair on travelmap,JorisVanEijden,2019-09-12 17:41:09+00:00,2019-09-23 18:24:35+00:00,{},"Fix for #1505 

Crosshair would stay at same position when moving the map below it with the on-screen arrows.
"
316167265,allow to cancel Recall spell (QoL),petchema,2019-09-10 20:38:35+00:00,2019-09-23 18:23:20+00:00,{},"In classic Daggerfall, if you cast Recall by mistake you have no way to cancel it and have to choose between losing your anchor or teleporting right away. This usually ends up in a game reload.

I suggest to allow to cancel it, unless there's some drawback for allowing that.

Magicka refund would be even more generous, but being able to cancel Recall is what really matters...

Forums: https://forums.dfworkshop.net/viewtopic.php?f=23&t=2690"
316108647,Prevent game load from restoring players breath underwater,JorisVanEijden,2019-09-10 17:51:39+00:00,2019-10-17 23:11:05+00:00,{},"Forum topic: https://forums.dfworkshop.net/viewtopic.php?f=24&t=2681

This is one approach to fixing the reported issue.
It seems to work fine on the saves I have, but this definitely needs thorough testing for side-effects."
315660789,Fix Malacath quest name,df-ferital,2019-09-09 18:33:44+00:00,2019-09-23 18:22:28+00:00,{},Malacath quest name was wrong as mentioned on the forums: https://forums.dfworkshop.net/viewtopic.php?f=25&t=2684
315305064,Fix inv behaviour near exit,ajrb,2019-09-08 20:29:33+00:00,2019-09-22 16:15:11+00:00,{},"Fix for first time inventory opens (again, in dungeons near exits thsi time)
Fix for clicking on loot containers near an exit"
315299049,Fix old ruler name being identical to new one,df-ferital,2019-09-08 19:05:47+00:00,2019-09-25 23:39:43+00:00,{},"In rumors involving a new ruler, when the old one was mentioned, he used the same name. Fixed this by matching classic: random old name uses the HIWORD part of the ruler name seed while new name uses the LOWORD.

FACTION.TXT was tweaked so the following factions always have the same ruler (as intended) and are therefore excluded from ""new ruler chance"":
Anticlere: Lady Doryanna Flyte
Isle of Balfiera: Medora
Lainlyn: Baron Shrike
Orsinium: Gortwog
"
315296069,Fix for A0C00Y16,JorisVanEijden,2019-09-08 18:20:47+00:00,2019-09-25 23:39:06+00:00,{},_yes_ was started by _S.22_ but being unset again by its when task
315295783,Rumor mill fixes,df-ferital,2019-09-08 18:17:01+00:00,2019-09-25 23:38:52+00:00,{},"In the case a rumor involves two factions, previous exclusions of generic factions made in PR #1479 were valid only for the first one. Now, same filters also applies to the second faction.

Also added a check to ensure both factions are not the same, so a faction cannot be its own enemy anymore: https://forums.dfworkshop.net/viewtopic.php?f=5&t=2676#p31098"
315223762,Fix interiors to use correct block data,df-ferital,2019-09-07 20:41:47+00:00,2019-09-25 23:38:24+00:00,{},"Interior were using raw block data, not block data processed through RMBLayout.GetLocationBuildingData.

This fixes this issue I discovered after entering the Order of the Raven building in Whitewold after the patch I made for it in PR #1489.
"
315223148,Expand houses offered for sale,ajrb,2019-09-07 20:31:36+00:00,2019-09-23 18:22:06+00:00,{},"Doesn't match classic exactly.
Fixed house ownership to work with new discovery system, at present if players buy a house it's not shown on the map."
315217224,Enemies shooting point-blank,JorisVanEijden,2019-09-07 18:52:22+00:00,2019-09-25 23:37:45+00:00,{},"Restored point-blank range in which enemies don't use ranged attacks but made it 6m rather than the original 9m.

Also changed the random checks which were using classic random for non-deterministic purposes."
315118621,Fix bug where no action mode selected first time inventory accessed,ajrb,2019-09-06 21:24:11+00:00,2019-09-06 23:08:15+00:00,{},"Only occurred the first time inventory used if not in a dungeon.

I also simplified the code for wagon access because I simply could not follow it with my tired old brain. I literally spent over an hour getting confused so I had to change the logic for my own sanity. Sorry Pango, my brain gets confused easily sometimes. I think it behaves the same unless I missed something in testing. Could you check you're happy with it please?"
314711119,"Adjust direct stat, skill and reaction mod mechanism",ajrb,2019-09-05 21:31:01+00:00,2019-09-05 23:10:36+00:00,{},"Allows the direct stat mods to be able to be used outside the effect bundle system. Without this fix any application of direct stat mod value will accumulate until the player has at least 1 effect bundle applied.

I looked at the prototype vampire class VampiricFortifyEffect and copied it's way of adjusting stats. Unfortunately it didn't work without this fix since the direct stat array is not cleared unless the entity has a bundle associated.

See https://github.com/ajrb/dfunity-mods/blob/encumbrance/RoleplayRealism/Scripts/_startupMod.cs and look at the EncumbranceEffects_OnNewMagicRound() method at the bottom. 

@Interkarma I separated this from the other mod support changes in case this is problematic. I can't see any issues. I did consider creating an effect bundle but since the effect was calculated and permanent I decided that the dynamic effect system was not right. This is not based on a spell or item, just whether that module of the mod is active."
314637501,Fix classic bug and clean up readability,JorisVanEijden,2019-09-05 18:21:22+00:00,2019-09-05 23:10:03+00:00,{},"Messages out-of-order bug fixed.
See https://en.uesp.net/wiki/Daggerfall:Elysana%27s_Betrayal#Bugs
and https://forums.dfworkshop.net/viewtopic.php?f=29&t=2192

Also fixed typo from classic.

Renamed some variables along the way to make working with the quest easier.


"
314630287,fall damage adjustments,petchema,2019-09-05 18:00:35+00:00,2019-09-05 23:09:16+00:00,{},"Tested using classic Daggerfall, falling from different platforms of Scourg Barrow and Daggerfall Castle.

I repeated some of the measures with a different encumbrance, with a totally different character (68 HP instead of 400 HP) and saw no difference in damage, so I assume the formula is only based on height. 
I got the exact same results with DOSBox's CPU cycles at 50k or 60k, but slightly less at 30k, so it's probably somewhat framerate dependant. Results below and patch match 50k and 60k cpu cycles measures, mainly because I tested the 30k cpu cycles at the last moment.

Threshold seems to be about 5 height units (no fall damage from the falling off the bottom of a crenel above Daggerfall Castle main entrance to the platform in front of the entrance, but small damage when falling slightly further away on the stairs. The difference in height in the first case being about 4.41 units, theshold is somewhere in the 4.5~5 units range.

By doing several falls (repeated 5 times at first, then only 3 times because the results were very consistent), including some from one of the high towers in Castle Daggerfall, damage seems to vary linearly with height above the threshold, and the slope nicely matches 5 HP/height unit.

location;height(unit);damage(HP)
Scourg Barrow external pillars;6.48;8
Scourg Barrow main, bottom of crenels;14.14;40
Scourg Barrow main, top of crenels;14.74;50
Daggerfall Castle, entrance tower bottom of crenels;10.91;24
Daggerfall Castle, entrance tower top of crenels;11.51;32
Daggerfall Castle, front gangway bottom of crenels;7.69;8
Daggerfall Castle, high tower bottom of crenels;17.36;60"
314455274,Fixes for #1374 and lack of max health restore on cure and feed.,JorisVanEijden,2019-09-05 11:31:20+00:00,2019-09-05 23:07:53+00:00,{},"I set it to reduce max health by 24 points per day, please adjust to taste ;)

I also added removal of the max health limit when feeding or being cured."
314415360,"A closed guild now display ""Guild is closed."" message.",df-ferital,2019-09-05 09:45:41+00:00,2019-09-05 23:05:33+00:00,{},A little cosmetic change. This does not match classic but guilds are not stores...
314394487,Implement classic tweak regarding some Order of the Raven buildings,df-ferital,2019-09-05 08:55:01+00:00,2019-09-05 23:05:15+00:00,{},"Found while reverse engineering FALL.EXE to understand map buildings to blocks building mapping process.

Classic uses this exact same runtime patch for some Order of the Raven buildings. These can be found  in Dwynnen or Whitewold for example, and aren't colored in blue on the map.

This is really hacky stuff but it works!"
314366895,"Fixed unsupported usage of ""until"" idiom",JorisVanEijden,2019-09-05 07:39:26+00:00,2019-09-05 23:04:40+00:00,{},"Fixed unsupported usages of ""until"" idiom where a condition should unset a variable.

See https://forums.dfworkshop.net/viewtopic.php?f=29&t=2628#p30745 for background.
"
314332687,Quest item dropping fixes,JorisVanEijden,2019-09-05 05:34:52+00:00,2019-09-05 23:04:05+00:00,{},"- Picking up previously dropped quest items would not unset the dropped state because they come from Loot, not Dropped.
- Moving quest Items to Loot piles or Merchants would not set the dropped state.
- Picking up quest items without AllowDrop would not unset the dropped state.
- Bitwise or in stead of logical or could cause null reference.

Test quest:
```
- Test quest for dropping and picking up quest items
Quest: __TEST001
QRC:
QBN:
Place _house_ local house2
Item _treasure_ portrait

	place item _treasure_ at _house_

_pickedup_ task:
	clicked item _treasure_
	clear _dropped_

_dropped_ task:
	dropped _treasure_ at _house_
	clear _pickedup_
```
"
313791229,Add mod facilities for horse riding mods,ajrb,2019-09-03 22:32:27+00:00,2019-09-05 23:17:57+00:00,{},"- Allow can-run delegate to be contributed
- Allow pitch limiting for mouse look
- Allow default horse graphics to be disabled"
313060748,Harden received armor,petchema,2019-09-01 20:01:28+00:00,2019-09-05 23:02:35+00:00,{},"3 modifications:
- wait for the weapon smith MessageBox to be closed before opening the inventory;
- make sure an item is picked from the list of proposed items (and, say, not from the wagon) before closing the inventory;
- close all transient windows before closing the inventory.

Use case for the latter: the player selects to EQUIP some item he cannot equip (forbidden material, for example). EquipItem() opens a MessageBox to tell it's not possible, chooseOne closes to top window which is the MessageBox, and the inventory stays open.

Another implementation would be to set a flag, and close the inventory in Update() when all transients have been closed by the player. The benefit is that the player would see that the item couldn't be equipped.
"
313051392,"workaround for ""water everywhere"" texture issue on low-end hardware",petchema,2019-09-01 17:29:54+00:00,2019-09-05 23:02:11+00:00,{},"It does not fix shadows issues or anything else, but still that's a noticeable improvement for people that have to run DFU on that hardware.

That looks like a very inexpensive workaround (most likely lost in the noise), and it seems to work fine on my regular hardware (from mathematical standpoint it also feels right to use rounding instead of floor() to make sure int -> float -> int conversions are robust), so maybe it can be added directly into the standard shader?

Otherwise, say if the risk of regression is deemed too high, it could be added to a variant of the shader, so it could be enabled at runtime; But I don't know how to do such things...

Tested on Intel HD-3000 by Siva Machina on Discord;
Tested on nVidia GTX-960 by myself (for lack of regression)

Forums:
https://forums.dfworkshop.net/viewtopic.php?f=5&t=2519&p=30610#p30610"
313035465,Only succeed the quest when both priest and betrothed have been clicked.,JorisVanEijden,2019-09-01 13:49:21+00:00,2019-09-05 23:01:53+00:00,{},"Fix for part of the issues reported at https://forums.dfworkshop.net/viewtopic.php?f=29&t=2134

It was another execution order issue in the template generated quest.
In classic the click on the priest would be cleared again unless the betrothed was also clicked, thus preventing the whole ""give pc gold, etc"" from executing.
"
313027997,Prevent vampire sun damage in prison.,JorisVanEijden,2019-09-01 12:02:01+00:00,2019-09-05 22:46:34+00:00,{},"Minimal code changes approach to prevent vampires burning up in prison.

A larger change would be to tie make the court window count as IsPlayerInside, but since the court window explicitly transitions to exterior and the player inside/outside is tightly coupled with the transitions I decided to go another route.

Source: https://www.reddit.com/r/daggerfallunity/comments/cwcsrb/is_going_to_prison_supposed_to_kill_vampires/
https://forums.dfworkshop.net/viewtopic.php?f=24&t=2605"
313019519,Don't end quest before revealing location if needed.,JorisVanEijden,2019-09-01 10:05:39+00:00,2019-09-05 22:46:09+00:00,{},"Fix for https://forums.dfworkshop.net/viewtopic.php?f=29&t=2411&start=10
"
313014667,Don't end quest when not done with escorting villager.,JorisVanEijden,2019-09-01 08:43:35+00:00,2019-09-05 22:45:48+00:00,{},"\_S.09\_ = there is no villager to escort.
\_victim\_ = there is a villager to escort.
\_yes\_ = you agreed to escort the villager.
\_S.13\_ = you completed the villager escort.
\_success\_ indicates you killed the giant and returned to the questgiver.

So the quest was ending when you killed the giant, returned to the questgiver, agreed to escort the villager but did not complete the escort yet.

Source: https://forums.dfworkshop.net/viewtopic.php?f=25&t=2557"
313012682,Remove some factions from rumor mill,df-ferital,2019-09-01 08:12:08+00:00,2019-09-05 22:44:47+00:00,{},Filter some factions which should not be included in rumor mill. Fix https://forums.dfworkshop.net/viewtopic.php?f=5&t=2629
312956316,Make more npc types local residents.,JorisVanEijden,2019-08-31 13:31:19+00:00,2019-09-01 00:08:15+00:00,{},"Testcase: quest K0C00Y04 has 2 Npcs in Group_7
Story and timer seem to indicate these have to be local and the quest itself doesn't place them anywhere.
PR makes not only -3 and -4 local, but also -5 and lower. (-8 is individual ans is already always local)

Original report: https://forums.dfworkshop.net/viewtopic.php?f=29&t=2331"
312946462,Missing book noises,petchema,2019-08-31 10:25:31+00:00,2019-09-05 22:44:28+00:00,{},"Complete the sonorisation of journal/notebook, spellbook and book reader:

Journal/notebook:
- OpenBook on open (like classic)
- PageTurn on page flip (like classic)
- OpenBook when switching between active quests, finished quests, etc. (like classic)
- PageTurn when editing the notebook (similar to classic spellbook editing)

Spellbook:
- PageTurn when editing the spellbook (like classic; except that in classic when you rename a spell the sound is played before you enter the name, and when the spell is renamed, it is immediately cast!)

Book reader:
- PageTurn on page flip (like classic)
Classic also plays ButtonClick on EXIT, but it doesn't seem to match Daggerfall Unity practice.

PageTurn are throttled, because they were easy to spam, specially with mouse wheel."
312936519,Allow magic item subclass definition in quests,JorisVanEijden,2019-08-31 07:15:18+00:00,2019-09-01 01:09:57+00:00,{},"Fix for https://forums.dfworkshop.net/viewtopic.php?f=25&t=1098&start=30#p28634

Implements subclasses for magic items (class 4) in quests.

Testcase:
`startquest S0000501`
That quest uses 
`Item _reward1_ item class 4 subclass 26`
which should generate a random ""Unrestrainable"" item as \_reward1\_
"
312476707,Fix for coin anim on inventory window,ajrb,2019-08-29 20:13:52+00:00,2019-08-31 23:54:02+00:00,{},"It was only being set when window was setup, and once set the anim was either there or not for the rest of the session.

See: https://forums.dfworkshop.net/viewtopic.php?f=5&t=2610"
312460107,Fix issues when activating Sheogorath,df-ferital,2019-08-29 19:24:43+00:00,2019-08-31 23:53:28+00:00,{},"Sheogorath should not be activated like a normal NPC, neither in information nor any other mode. As this is also the case for all static NPCs attached to ""ShowText"" or ""ShowTextWithInput"" action, I just moved the already available check from TalkManager to PlayerActivate and included ""ShowText"" action flag into it.

In information mode, this matches classic behavior where we never get any display name for this kind of NPC.

In other modes (steal, grab and talk), this fixes an exception which popups for Sheogorath due to the fact both his instances have an invalid faction ID.

Fix #1456"
312457744,Make cart move at correct slower speed,ajrb,2019-08-29 19:17:57+00:00,2019-08-31 23:51:40+00:00,{},I plan to adjust the horse sounds too as they're currently far too loud but I currently can't figure out why they're being set by unity... posted a cry for help on the forums.
311666018,Travel Map Refactor,Interkarma,2019-08-28 04:41:05+00:00,2019-08-28 04:41:16+00:00,{},"Reworks travel map to fix memory leaks and excessive texture creation. Now textures are created only when needed and cached for next use.
Animated elements such as identifying region and location crosshair are done with a single persistent pixel buffer and texture rather than rebuilding several new textures almost every frame.
Panning and zooming are now done with GPU cropping in Panel rather than creating new textures almost every frame.
Functionality and behaviour seems to match previous travel map interface (minus the memory problems). No obvious regressions found at this time. Tested both with classic and DREAM UI textures.
Merging to master so other developers can start playing with changes. Please let me know if any feedback @petchema, @ajrb, @Nystul-the-Magician, @df-ferital, @TheLacus. I'm going to delay new builds to first weekend of September so this has some time to break in. Thanks all!"
310884480,Update npc presence when rest dialog dismissed,ajrb,2019-08-26 11:48:08+00:00,2019-08-28 05:21:20+00:00,{},I get annoyed when resting in a guild for npcs to arrive and have to exit and reenter the building for them to show up. Added a check when rest dialog is dismissed.
310716564,Fix NPC talk reactions,df-ferital,2019-08-25 21:33:09+00:00,2019-08-28 05:20:29+00:00,{},"Fix NPC reactions issues mentioned on the forums, especially here: https://forums.dfworkshop.net/viewtopic.php?f=24&t=2410&start=10#p29493

This restores random seed based on current NPC guid so each NPC in the same town will now react differently as this was already the case before PR #1370.

I also lowered the difficulty level required to get a successfull answer when asking for people location with low personality characters, balancing this change by also lowering the bonus given to find a location (+5 instead of +10). Still, it's much more difficult than classic to find people, where we nearly always get a successful answer even with a very low personality, because of an incorrectly applied modifier (classic seems to always apply +10, regardless of the kind of question).

As with my previous PR #1370, Streetwise and Etiquette are more useful than in classic where one would always use Normal tone since it almost always gives better results. As an example, in DFU, I managed to get a positive answer from the same NPC by switching from Normal to Blunt tone (NPC was a commoner, for a Noble I would have used Etiquette of course).

And as requested on the forums (https://forums.dfworkshop.net/viewtopic.php?f=5&t=2404), tone now remains checked as it was during the last talk session. Since this does not match classic, I let you decide (@Interkarma and others) if you prefer to keep it that way or not."
310690446,Add exclusive fullscreen checkbox to advanced video options,FrozenFish24,2019-08-25 14:42:07+00:00,2019-08-31 04:17:05+00:00,{'enhancement': 1},"`-window-mode exclusive` arg wasn't working, so I added it as a proper option.

![exclusive](https://user-images.githubusercontent.com/12547453/63651649-9eca0f00-c789-11e9-9e77-1a536016edaa.png)"
310638202,only acknowledge received armor after one is picked,petchema,2019-08-24 20:20:34+00:00,2019-08-28 05:13:21+00:00,{},"Forums:
https://www.reddit.com/r/daggerfallunity/comments/cuvbks/bug_knights_of_dragon_clicked_receive_armor_didnt/

Game save for testing:
[SAVE361.zip](https://github.com/Interkarma/daggerfall-unity/files/3537545/SAVE361.zip)
"
310332038," %di macro improvements and bugfixes, code rework",Nystul-the-Magician,2019-08-23 10:41:32+00:00,2019-08-28 05:11:09+00:00,{},"fixes issue https://github.com/Interkarma/daggerfall-unity/issues/1449

- tell me about answers for persons with %di should work now (both indoors (buildings and castles) and outdoors), directions given should be correct
- ""where is"" answers for residences fixed (named residence instead of just ""residence"")
- tell me about entries are available everywhere, but only npcs in same region of place or person resource will know answers (TalkManager function CheckNPCcanNowAboutItem is used to check if npcs can know) - this will even apply to spymaster and console command talk_npcsKnowEverything
- %di in tell me about answers for persons in same region but different location will now correctly refer to the location name followed by compass direction to the remote location
- code improvements, cleanup and function renaming
- fix for npcs sometimes not giving the correct building name if it was undiscovered
- fixed %di resolving error when in same building as target npc
- npcs will now always know tell me about and where is answers if the person is in the same building
- functions renamed to better fit their purpose - name correctly reflects now if the functions is used for direction for locations or buildings (TalkManager has new function GetLocationCompassDirection (not to be confused with function GetBuildingCompassDirection) that resolves to compass direction to location of place resource)
- QuestMCP direction resolving now uses TalkManager functionality

tested with quests: R0C10Y12, S0000001, N0C00Y10"
310175551,"Classic quest fixes, Aug 2019",JayH2971,2019-08-22 23:07:20+00:00,2019-08-28 05:13:03+00:00,{'questing': 1},
310000949,adjust changed default keybindings in tutorial,petchema,2019-08-22 14:52:23+00:00,2019-08-28 05:11:48+00:00,{},"Not as good as having macros to use current keybindings instead, but I didn't manage to implement that.

Forums: https://forums.dfworkshop.net/viewtopic.php?f=4&t=429&p=27238#p27238"
309682217,Enchanted items should not be considered ingredients,ajrb,2019-08-21 20:50:40+00:00,2019-08-21 23:46:45+00:00,{},
309599076,"Add ""CAV"" to ActionDoor check for hidden cave doors",JorisVanEijden,2019-08-21 17:11:15+00:00,2019-08-22 00:27:19+00:00,{},"Tested and confirmed to solve issue #1421 
"
309508747,Show the author as unknown for broken/missing books.,JorisVanEijden,2019-08-21 13:44:15+00:00,2019-08-22 00:17:33+00:00,{},Fixes #1445 
309306146,Trimmed all songs to loop seamlessly.,nashmuhandes,2019-08-21 03:16:54+00:00,2019-09-27 02:47:11+00:00,{'enhancement': 1},
309045319,Faction rep fix & revert magic item restriction,ajrb,2019-08-20 13:15:52+00:00,2019-08-21 23:46:06+00:00,{},
308966778,Swap wagon access tests,petchema,2019-08-20 09:50:12+00:00,2019-08-21 23:45:33+00:00,{},"When clicking on WAGON button from inside a dungeon when you had no wagon it was not logical to display a message you couldn't access it because you were to far from an entrance.
So, check if you have a wagon first, whether it's reachable second.

Also, add a wagon ownership test that was missing in proximity access since #1343 or even earlier


ownership | in dungeon | proximity | ¬†
-- | -- | -- | --
F | F |   | wagon button not selected, ¬´¬†You don‚Äôt own a wagon¬†¬ª
F | F |   | --
F | T | F | wagon button not selected, ¬´¬†You don‚Äôt own a wagon¬†¬ª
F | T | T | wagon button not selected, ¬´¬†You don‚Äôt own a wagon¬†¬ª
T | F |   | wagon button not selected, but selectable
T | F |   | --
T | T | F | wagon button not selected, ¬´¬†The exit is too far away¬†¬ª
T | T | T | wagon button autoselected (#1416)

"
308778702,Merge automap cleanup to master,Interkarma,2019-08-19 20:53:35+00:00,2019-08-19 20:53:42+00:00,{},
308760671,Add journal message when getting a house,ajrb,2019-08-19 20:02:55+00:00,2019-08-19 21:31:01+00:00,{},So players can easily keep track of where their owned properties are.
308500935,"automap - fixed bug of user note markers disappearing after saving, code cleanup ",Nystul-the-Magician,2019-08-19 08:35:56+00:00,2019-08-19 20:48:21+00:00,{},"fixed bug of user note markers disappearing after saving (https://github.com/Interkarma/daggerfall-unity/issues/1431)
minor code cleanup and more comments"
308274974,1369 have item should not clear target,JorisVanEijden,2019-08-17 07:54:44+00:00,2019-08-19 21:20:07+00:00,{},"Fix for (among others probably) #1369 
`have _item_ set _state_` is only supposed to _enable_ `_state_`, not disable it.

As per 
https://en.uesp.net/wiki/Daggerfall:Quest_pseudo-codes#Pseudo-code_Type_0x46_.2F_70_.28PC_has_Items.29_.5B5_sub-records.5D
and 
https://www.dfworkshop.net/static_files/questing-source-docs.html#usingitems
"
308253463,Upgrade Daggerfall Unity project to 2019.2,CelestialAmber,2019-08-17 00:41:26+00:00,2019-08-17 09:33:27+00:00,{},"This would upgrade the project to Unity 2019.2, and fix issues with more recent versions of Unity such as Tuples, SDF font rendering with the latest version of Textmesh Pro, and make use of the new Post-Processing system."
308113853,no fog on automap,petchema,2019-08-16 15:11:35+00:00,2019-08-21 23:45:02+00:00,{},"Make sure markers are not foggy when looking at the automap underwater

I added a script to the camera's gameObject to temporarily disable RenderSettings' fog, I don't know if that's the simplest way to fix that.

Forums:
https://forums.dfworkshop.net/viewtopic.php?f=4&t=163&p=29038#p29038"
307534972,don't ground player when onboarding ship,petchema,2019-08-14 23:39:17+00:00,2019-08-19 21:22:10+00:00,{'bug': 1},"Third time the charm?

Tested:
- fast traveling to town
- going in and out of buildings (including out of elevated door)
- going in and out of dungeons
- going to and from ship
- teleported by mages guild service
- expelled from town by court
- ""location"" command

Forums: https://forums.dfworkshop.net/viewtopic.php?f=24&t=2521"
307408264,visually clamp difficulty dagger to gauge,petchema,2019-08-14 16:35:26+00:00,2019-08-19 21:17:42+00:00,{},Fixes issue #1427
307255404,"fix for answer rumors (answers to tell me about topic) being incorrectly added to ""any news"" rumors",Nystul-the-Magician,2019-08-14 09:59:14+00:00,2019-08-19 21:17:11+00:00,{},"fix for answer rumors (answers to tell me about topic) being incorrectly added to ""any news"" rumors

this issue leaded to some quests being easier to solve than intended (or in worst case trivial to solve)
tested with non-member mages guild quest with missing book (N0C00Y10)

answer rumors (given as answers to ""tell me about"" topics) defined in the quest source in the line a quest resource is defined, usually after ""anyInfo"" with the command ""rumors""
answer rumors should not be confused with ""any news"" rumors (can be populated with RumorsDuringQuest and RumorMill quest action)
answer rumors must not appear as answer to ""any news"" questions.
usually ""any news"" answers are the less informative ones, resource related anyInfo and rumors are more specific but anyInfo are meant to be correct and rumors may be wrong (that's why the spymaster always gives the anyInfo answers)

due to a mistake on my side in commit ec37210e12e9690d3eb5da731d83dfa133f7b424 those answer rumors got added to the ""any news"" answers

in quest N0C00Y10this issue resulted in npcs giving ""any news"" ansers like ""_thief_ lives at _house_ in __house_"" which made no sense: why would a random npc 1) know about the specific person, 2) why would he/she tell the pc as random rumor

after this change the correct way to get to the thief is: ask about the missing book name in tell me about and learn about the contact person, who then will give the name of the thief, this will make the name of the thief appear under ""tell me about"" - which will give the anyInfo answers (message 1014) - npcs of certain type like scholars will give these - or rumors answers (message 1015) by common passengers.
""any news"" will only give the unspecific answers from RumorsDuringQuest as intended (message 1005)

this pull request fixes this issue"
306993509,1383 Add quest location reference from Person,JorisVanEijden,2019-08-13 16:56:16+00:00,2019-08-19 21:10:04+00:00,{},"Fixes messages like `Some weird-acting =contact_ in __contact_, %di of here.`
__contact_ would be filled by Person but not added as Quest.LastPlaceReferenced, which %di uses.
"
306988400,1383 Fix crash with %di getting direction without location.,JorisVanEijden,2019-08-13 16:41:10+00:00,2019-08-19 20:59:10+00:00,{},Handle `DaggerfallWorkshop.Game.Questing.Quest.LastPlaceReferenced` returning null.
306957519,"Enable more classic quests, rebalance house cleaning quests",JayH2971,2019-08-13 15:21:40+00:00,2019-08-19 21:24:56+00:00,{'questing': 1},
306557485,1383 macro %di expansion can fail and crash the game,JorisVanEijden,2019-08-12 15:52:57+00:00,2019-08-19 21:12:18+00:00,{},Suggested fix for #1383 
306309518,always select EQUIP when opening inventory explicitly,petchema,2019-08-11 21:12:34+00:00,2019-08-19 08:36:12+00:00,{},"However, keep selecting the WAGON (instead of nothing) when opening the inventory explicitly near a dungeon entrance when DungeonExitWagonPrompt is off.

This is a trade-off @ajrb and I want to try concerning proximity wagon access,
Forums: https://forums.dfworkshop.net/viewtopic.php?f=4&t=2490"
306293936,Fix fast travel for characters with Damage from Sunlight disadvantage,EP-u-NW,2019-08-11 17:01:26+00:00,2019-08-19 08:34:36+00:00,{},I tested the behaviour in classic and it seems that fast travel for characters with `Damage from Sunlight` disadvantage behave just like fast travel for vampires (in terms of arrival).  
306280041,Bugfixes#2,ajrb,2019-08-11 13:15:27+00:00,2019-08-19 08:33:12+00:00,{},"Allow paintings to sell in pawn shops
Remove single ingredients from wagon as well"
306276163,don't display find button on world map upon first use,petchema,2019-08-11 12:09:54+00:00,2019-08-19 08:30:27+00:00,{},Forums: https://forums.dfworkshop.net/viewtopic.php?f=5&t=2499
306271114,Fix arrow blood splash position,JorisVanEijden,2019-08-11 10:27:59+00:00,2019-08-19 08:20:54+00:00,{},"Fix for bug https://forums.dfworkshop.net/viewtopic.php?f=24&t=2219

I stepped through it with a debugger and the splash for arrows against enemies was being spawned at 0,0,0.
So I copied the NPC arrow hitting logic and now it works again."
306239161,add console command to open the potion maker,petchema,2019-08-10 21:13:13+00:00,2019-08-18 05:37:21+00:00,{'enhancement': 1},"Having to go see a potion maker makes potions brewing very cumbersome, if not useless.
Players that don't mind bending classic rules can use that command to brew potions from any place.

(Requested by Shinino on Discord)"
306231608,update region name from notebook fast travel,petchema,2019-08-10 18:45:41+00:00,2019-08-10 21:49:00+00:00,{'bug': 1},"When initiating fast travel from notebook, update travel map title so that region name shows up correctly.

Screenshot of the problem:
![missing region name](https://user-images.githubusercontent.com/1211431/62825653-c2992c80-bbaf-11e9-8649-88401d931e2b.jpg)
"
306222982,allow character modifications in summary screen,petchema,2019-08-10 16:18:18+00:00,2019-08-10 21:49:21+00:00,{'bug': 1},"Allow last minute character modifications in the summary screen (last character creation screen):

- Name
- Face
- Rebalance status bonus points
- Rebalance skills bonus points
- Reflexes

Forums: https://forums.dfworkshop.net/viewtopic.php?f=24&t=2459"
306193426,bug fix for issue #1398,Nystul-the-Magician,2019-08-10 07:32:52+00:00,2019-08-10 21:48:39+00:00,{},"(https://github.com/Interkarma/daggerfall-unity/issues/1398)

also contains a small fix to a potential problem with teleporter markers - also remaining active in scene incorrectly

code clean up: added SetActivationStateOfMapObjects function which is now used instead of duplicate code"
306152354,Bugfixes,ajrb,2019-08-09 22:15:45+00:00,2019-08-10 22:51:37+00:00,{},"Add check to prevent errors with modded items. Not all magic items will use legacy enchantments. e.g. locators in Archs guild mod.
Allow wagon ingredient access consistently.
Stop magic items being sold at normal stores."
306150730,Quest dispense lists,ajrb,2019-08-09 22:07:20+00:00,2019-08-17 10:33:51+00:00,{},"See thread: https://forums.dfworkshop.net/viewtopic.php?f=22&p=28902
Thanks to Firebrand for doing the quest names!

The message box with OK button is to prepare player for a potentially long wait while all the availiable quests are parsed. This is to get the names and ensure no broken quests get offered. Seems like a lot of space below the button. This is the best I could get it to look, but happy if someone can improve it."
305720802,Fix Witches coven quests,ajrb,2019-08-08 19:43:15+00:00,2019-08-09 05:56:36+00:00,{},"Wrongly converted when quest dispensing for guilds was changed to match classic. Coven quests are all implemented as non-member since covens cannot be joined, and that means rank cannot be used. Switching back to reputation."
305716946, Add loiter limit setting,ajrb,2019-08-08 19:31:04+00:00,2019-08-09 05:56:11+00:00,{},"Also refined layout a little, moved both repair options to be adjacent and made layout more balanced"
305343058,Immediately adjust looping sounds volume,petchema,2019-08-07 22:28:48+00:00,2019-08-09 05:51:01+00:00,{},"Without that patch, looping sounds (crickets, rain) stay at the same volume until they're stopped.
(Effect sounds are less problematic because they don't last as long).

This adjust looping sounds immediately; Volume is adjusted with each frame, just like music in DaggerfallSongPlayer. A more elegant solution could involve AudioMixers...

Forums: https://forums.dfworkshop.net/viewtopic.php?f=14&t=1333&p=28652#p28648"
305095351,migrated remaining text in automap and exterior automap to text data base,Nystul-the-Magician,2019-08-07 11:01:22+00:00,2019-08-09 05:53:50+00:00,{},"changed schema in DaggerfallUI.txt to
schema: *key,$text

added quotes for all strings in the file"
304916383,make sure you're grounded after fast travel,petchema,2019-08-06 22:44:22+00:00,2019-08-09 05:50:24+00:00,{},"Replacement for PR #1359 
It adds a ""grounded"" boolean parameter tto RepositionPlayer() to force new position to be on the ground; That parameter is used when the player is relocated to a StartMarker using a cardinal direction, which include fast travel case but should always be a safe thing to do.

I'll keep testing it, but I'm releasing the PR so that more people can test it.

Forums: https://forums.dfworkshop.net/viewtopic.php?f=24&t=2307"
304472373,building discovery rework,Nystul-the-Magician,2019-08-05 21:45:38+00:00,2019-08-10 21:48:04+00:00,{},"First of all: PLEASE help me to test this out before merging - I tested quite a bit and it seems to work ok, but the devil does not sleep ;)

now regarding the changes:
reworked the building discovery system a bit - no fear - nothing too heavy.
just tried to split stuff a bit better between functions:
- DiscoverBuilding is now the only function that really changes discovery state (except one small exception about player house name which I plan to fix as well)
- GetDiscoveredBuilding only uses this data and does not compute any building names on its own (except player house name)
- GetBuildingDiscoveryData gets initial building information from current location (no building name expansion like quest-named residences, no thieves guild name, etc.) - this function is not used directly by other systems but used by DiscoverBuilding and GetAnyBuilding - so no code duplication anymore and thus less bugs hopefully
- GetAnyBuilding now uses the other two functions (GetDiscoveredBuilding and GetBuildingDiscoveryData) to get any building discovery data (undiscovered and discovered) - this is much cleaner now and fixes some incorrect answers to the ""Where am I?"" question, I tested to make sure this does not break dialog linked topics in quests (and my hardcore testing quest (the non-member mages guild quest with the missing book passed my tests)).

I would like to rename GetBuildingDiscoveryData into something that better reflects the fact that this function computes intermediate results without expanding quest named residences, special guildhalls etc. Would like to hear your suggestions, something like GetInitialBuildingDiscoveryData or GetRawBuildingDiscoveryData were my best ideas but they don't seem too good to me

some of the bugs that should be fixed now are:
- special guild halls should show up again
- named residence showing up on map but not telling the right name on info click should be fixed
- named residences not showing up on map in some cases should be fixed
- potential problem with the same residence used by 2 quests simultaneously should behave like this: info click when undiscovered will give one of the two, otherwise the name first marked on map (update: we can change this so it shows the last name that was marked by npcs on map - what do you think how it should behave?) 
- talk question ""Where am I?"" should now always give resolved names of residences etc.

"
304310015,Fix witches coven quest dispensing,ajrb,2019-08-05 13:47:15+00:00,2019-08-08 19:41:01+00:00,{},
304030864,FindClosestDoorToPlayer() to return false if all doors are filtered out,petchema,2019-08-03 23:12:55+00:00,2019-08-10 00:22:38+00:00,{},"DaggerfallStaticDoors.FindClosestDoorToPlayer() was returning true if all doors were filtered out by requiredDoorType.
When this happened, doorPosOut would still have its default value of playerPos, making DaggerfallInventoryWindow believe that indeed a door was found close to the player.

This only happens in some dungeons. The issue was first seen in a stream, in the Citadel of Hawking, Daggerfall:

https://www.twitch.tv/videos/461269349?t=01h50m27s"
303590238,fix for github issue 1381,Nystul-the-Magician,2019-08-01 23:33:40+00:00,2019-08-05 21:31:15+00:00,{},"(https://github.com/Interkarma/daggerfall-unity/issues/1381)

public function now only calls private function
all resolving is done there
if there is a building override name this name is taken otherwise further building name resolving is done"
303447743,Fix %loc macro expansion in castles,df-ferital,2019-08-01 15:49:25+00:00,2019-08-09 05:44:36+00:00,{},"Fix %loc expansion failures as reported here: https://forums.dfworkshop.net/viewtopic.php?f=5&p=27843#p27843

I also filtered NPC names in topics so you shouldn't be able to ask people anymore about themselves both in ""Where is people"" and ""Tell me about"" question categories. The filter is a little ugly at the moment but at least it's working."
303122487,Implement soulgem selling service,ajrb,2019-07-31 20:51:56+00:00,2019-07-31 21:09:38+00:00,{},"Addresses issue #1377 

Should be checked for DB and for Temple of Arkay by bug author @Hellmasker10."
302927860,Handle %nrn macro expansion,df-ferital,2019-07-31 12:23:23+00:00,2019-07-31 21:08:24+00:00,{},"Only used in Thieves Guild quest O0B00Y01. Return the name of current region ruler.

Edit: actually it's also used in some non quest rumors."
302545860,"Fix N0B00Y16 ""open chest""",JayH2971,2019-07-30 15:08:00+00:00,2019-07-31 21:07:55+00:00,{'questing': 1},"S.07 failed to fire, wasn't recognizing the condition. One-line fix. Quest has another problem regarding failure line: if you talk to the merchant without opening the chest, you'll never get a success message afterward. Have tried to fix that problem and can't."
302458590,NPC reactions enhancement,df-ferital,2019-07-30 11:41:03+00:00,2019-07-31 21:06:19+00:00,{'enhancement': 1},"Improve the way NPCs react to player questions.

I decided to give Streetwise and Etiquette more weight by setting reaction modifiers related to NPC social groups. For example, talking bluntly to a Noble or Scholar will now give a penalty, while doing the same with a Commoner or a member of the Underworld (Thieves Guild or Assassin) will give a bonus. Of course, using Etiquette through a polite tone will trigger the exact opposite. Merchants, as a sort of middle class, will be unaffected by this change. I gave them a default modifier of +5 when using both skills which makes them behave the same as before as I also changed skill check result: failing will give a penalty of -10 while succeeding will give +5.

I also lowered the required value to get the best NPC reaction, though it's still difficult to get, especially with a low personality and low Etiquette and Streetwise skills.

Finally, I also set default modifiers for ""Tell me about"" kind of questions the same as there ""Where is"" counterparts.

In my opinion, this is quite an improvement over classic.

While doing so, I also noticed and fixed a problem with the Talk Window: tone checkbox was not reset to Normal after modifying the tone, then closing the window and reopening it."
302223550,URGENT FOR ALPHA BUILD: Improve guttering effect on player torch,ajrb,2019-07-29 20:30:43+00:00,2019-07-29 22:54:34+00:00,{},"It has been reported that my lazy flickering guttering effect used to warn players (using player based torches) that a light source is running low on fuel is a potentially very serious epilepsy trigger. We must not release an alpha with that code, I would be pretty mortified if someone had a seizure because of it.

I've been less lazy now (but still pretty lazy) and implemented a very simple cosine based effect. Looks pretty decent actually for 1 extra variable and 2 lines of code!

Hopefully this will be fine, I will await feedback from the reporter, it's definitely not a fast stobe like flickery effect anymore anyway!"
301805241,Classic quest fixes part1,Interkarma,2019-07-28 05:08:49+00:00,2019-07-28 05:09:03+00:00,{},
301785281,"Restrict building interior loot piles to TG, DB and pubs",ajrb,2019-07-27 21:03:49+00:00,2019-07-28 07:14:01+00:00,{},"This is not exactly as classic but as close as I can get without reverse engineering why they appear is desert FGs but no where else.

I think this is close enough now having spent a few hours testing various buildings in classic."
301739804,Class questions,numidium,2019-07-27 07:07:23+00:00,2019-11-14 03:50:28+00:00,{},"The UI is very spartan at the moment.  It lacks the graphical effects of classic but it functions correctly as far as I can tell from my testing.  The question text can be scrolled up and down with a mouse wheel.

I had to do a fair bit of reverse-engineering for the class choice routine.  There's a method I called GetHeaderIndex that is structured a bit strangely (two separate loops) but I was trying to mimic what I saw in the disassembly as closely as I could.

What remains to be done is to reverse-engineer the GFX files that describe the scroll images and the CEL files that animate the lightning strikes and constellations that show when a question is answered.  I also haven't yet figured out how to mask out the text that goes beyond the bounds of the scroll."
301578827,Fix for non-temple guild greeting messages & provide reference to calling window to custom services,ajrb,2019-07-26 15:06:33+00:00,2019-07-28 22:29:02+00:00,{},"As discussed here:L

https://forums.dfworkshop.net/viewtopic.php?f=23&t=2336&p=27331#p27331"
301557379,Enable Khajiit random name generation on character creation.,df-ferital,2019-07-26 14:10:49+00:00,2019-07-28 22:28:40+00:00,{},"Enable Khajiit names to be randomly generated. However, #1361 should be tested and merged before this PR or Khajiit will be given default Breton names."
301539703,Handle %bn (biography name) macro expansion,df-ferital,2019-07-26 13:24:33+00:00,2019-07-28 22:28:09+00:00,{},"Macro %bn is used only for Nightblade biography history. It expands to a random name using player character race and a random gender.

But as the occupation of the corresponding individual is given by the %q8 macro which expands to a neutral or (mostly) masculine noun (priest, wizard, sorceror, revolutionary, anarchist, warlord, robber baron, assassin), I chose to differ from classic and force the gender to male.

I also fixed MacroHelper.GetNameBank to match classic so it now returns a Khajiit name for Khajiits and an Imperial name for Argonians."
300051808,DaggerfallTilemapTextureArray.shader cleanups,petchema,2019-07-22 21:48:07+00:00,2019-07-25 02:12:37+00:00,{},"(patch on top of #1350 )

Trying (unsuccessfully) to fix seams problem, I did lot of small cleanups on shader code:
    
- Remove commented code (that's what versioning is for);
- Added TEXCOORDn annotations on Input
- used UNITY_SAMPLE_TEX2DARRAY_SAMPLER_LOD to share SamplerState between albedo and normal texture lookups
- added inline annotation to GetMipLevel (but I suppose the compiler must have guessed that much already)
- replaced fmod(x, 1.0) with frac(x)
- replaced tile rotation branching with matrices. I could have replaced matrix product and vector addition with just a matrix product, but I would have to promote matrix to float3x3 because OpenGL ES 2.0 doesn't support non-square matrices:
    
      static float3x3 rotations[4] = {
          float3x3(1.0, 0.0, 0.0, 0.0, 1.0, 0.0, 0.0, 0.0, 0.0),
          float3x3(0.0, 1.0, 0.0, -1.0, 0.0, 1.0, 0.0, 0.0, 0.0),
          float3x3(-1.0, 0.0, 1.0, 0.0, -1.0, 1.0, 0.0, 0.0, 0.0),
          float3x3(0.0, -1.0, 1.0, 1.0, 0.0, 0.0, 0.0, 0.0, 0.0)
      };
    
      float2 uv = mul(rotations[index % 4], float3(frac(unwrappedUV), 1.0));
    
With all those modifications I have seen no change in FPS on my rig, maybe they're better tools to measure shaders performance? Maybe it's simply irrrelevant"
300037789,"Fast travel to ground level, always",petchema,2019-07-22 21:01:46+00:00,2019-07-25 01:56:45+00:00,{},"After some fast travel, player position could only be adjusted upward; When terrain was very steep downward it could result in fall damage (and death). 

(Maybe there's a use case I'm not aware of for this behavior?)

Make adjustment unconditional; Height formula adjusted to (slightly higher) PlayerMotor.FixStanding formula.

Forums: https://forums.dfworkshop.net/viewtopic.php?f=24&t=2307"
299931055,Fix AssetInjection setting save,rossipaolo,2019-07-22 15:25:00+00:00,2019-07-25 01:45:25+00:00,{},Changes to AssetInjection option from game UI weren't correctly saved to ini file.
299658978,Fix for closing windows when using magic items,ajrb,2019-07-21 19:23:03+00:00,2019-07-25 01:46:29+00:00,{},"Much easier to pop off the stack before pushing any subsequent windows. This fixes the issues I had with teleport item for archaeologists mod.
Also includes a fix so TG & BD membership to only occur if the joining quest is successful."
299582952,Import Texture Arrays as assets,rossipaolo,2019-07-20 18:37:28+00:00,2019-07-25 02:04:18+00:00,{},"Terrain texture arrays can now also be created inside the Unity Editor and
provided via mods as assets. This brings the following benefits:

* Minor improvements for memory management and initialization times. The individual source
textures don't need to exist at runtime, only the final texture array.
* Failure due to resolution, format or mipmaps mismatches are not possible at
runtime. A texture array is only rejected if slice count is incorrect.
* Runtime creation of texture arrays requires CopyTexture support or Read/Write flag
(with increased memory usage). Texture arrays shipped as assets works on any platform
that support this feature alone.

The disadvantage is the introduction of an additional step in mod creation
workflow. For this reason is introduced as an optional feature.

This commit adds a simple texture array creator but there are also more advanced
free alternatives on the Unity Asset Store, like [Texture Array Inspector](https://assetstore.unity.com/packages/tools/utilities/texture-array-inspector-109547)."
299210541,"Classic quests, second part",JayH2971,2019-07-19 07:01:38+00:00,2019-07-28 05:08:23+00:00,{},"I hope I'm doing this right? Never merged into anything other than Master. Feedback welcome if I'm ruining things.

Credit to pango for adding an edit I failed to notice."
297808590,Fix weapon image pixel bleeding,rossipaolo,2019-07-15 22:21:36+00:00,2019-07-25 01:49:05+00:00,{},"Repeat wrapmode causes lines to be visible on borders.
Using mirror instead of clamp to support left handed (mirrored) weapons."
297804783,Fix texture import for bow,rossipaolo,2019-07-15 22:06:53+00:00,2019-07-25 01:57:09+00:00,{},
297743150,DaggerfallDistance fix and small adjustments,petchema,2019-07-15 18:49:50+00:00,2019-07-25 01:45:11+00:00,{},"Prefix and suffix costs were totally dissymmetric if the match was a prefix or suffix of a word; Make those computations more symmetric, just taking into account costs of prefix/suffix letters and full words.

Also, overall make prefixing and suffixing cheaper relative to letter edits, so that the search behave slightly more like a substring search.

Forums: https://forums.dfworkshop.net/viewtopic.php?f=7&p=26334#p26333"
297634871,Update enumerated saves when a new savegame is created,df-ferital,2019-07-15 14:00:56+00:00,2019-07-25 01:44:41+00:00,{},"Enumerated saves were not updated when a new savegame was created. This made QuickLoad not working immediately after using QuickSave for the first time (QuickLoad worked, however, when restarting DFU)."
297387327,apply a -0.5 mipmap bias to DaggerfallTilemapTextureArray shader,petchema,2019-07-14 11:21:46+00:00,2019-07-25 01:48:45+00:00,{},"Seems still almost aliasing free according to visual tests.

Implementing mipmap bias by hand, does standard Texture.mipmapBias apply to custom surface shaders? And if so, where should it be set?

Forums: https://forums.dfworkshop.net/viewtopic.php?f=4&t=37&p=26322#p26322"
297362970,More null checks,petchema,2019-07-14 03:02:21+00:00,2019-07-25 01:37:21+00:00,{},"While removing items from my wagon:

NullReferenceException: Object reference not set to an instance of an object
  at DaggerfallWorkshop.Game.UserInterfaceWindows.DaggerfallInventoryWindow.RemoteItemListScroller_OnItemClick (DaggerfallWorkshop.Game.Items.DaggerfallUnityItem item) [0x00000] in <filename unknown>:0 
  at DaggerfallWorkshop.Game.UserInterface.ItemListScroller.ItemButton_OnMouseClick (DaggerfallWorkshop.Game.UserInterface.BaseScreenComponent sender, Vector2 position) [0x00000] in <filename unknown>:0 
  at (wrapper delegate-invoke) DaggerfallWorkshop.Game.UserInterface.BaseScreenComponent/OnMouseClickHandler:invoke_void__this___BaseScreenComponent_Vector2 (DaggerfallWorkshop.Game.UserInterface.BaseScreenComponent,UnityEngine.Vector2)
  at DaggerfallWorkshop.Game.UserInterface.BaseScreenComponent.MouseClick (Vector2 clickPosition) [0x00000] in <filename unknown>:0 
  at DaggerfallWorkshop.Game.UserInterface.BaseScreenComponent.Update () [0x00000] in <filename unknown>:0 
  at DaggerfallWorkshop.Game.UserInterface.Panel.Update () [0x00000] in <filename unknown>:0 
  at DaggerfallWorkshop.Game.UserInterface.Button.Update () [0x00000] in <filename unknown>:0 
  at DaggerfallWorkshop.Game.UserInterface.Panel.Update () [0x00000] in <filename unknown>:0 
  at DaggerfallWorkshop.Game.UserInterface.Panel.Update () [0x00000] in <filename unknown>:0 
  at DaggerfallWorkshop.Game.UserInterface.Panel.Update () [0x00000] in <filename unknown>:0 
  at DaggerfallWorkshop.Game.UserInterface.Panel.Update () [0x00000] in <filename unknown>:0 
  at DaggerfallWorkshop.Game.UserInterface.UserInterfaceWindow.Update () [0x00000] in <filename unknown>:0 
  at DaggerfallWorkshop.Game.UserInterfaceWindows.DaggerfallBaseWindow.Update () [0x00000] in <filename unknown>:0 
  at DaggerfallWorkshop.Game.UserInterfaceWindows.DaggerfallPopupWindow.Update () [0x00000] in <filename unknown>:0 
  at DaggerfallWorkshop.Game.UserInterfaceWindows.DaggerfallInventoryWindow.Update () [0x00000] in <filename unknown>:0 
  at DaggerfallWorkshop.Game.DaggerfallUI.Update () [0x00000] in <filename unknown>:0"
297280823,Extended World Data replacment and Level Editor,UncannyValley21,2019-07-13 05:06:31+00:00,2019-07-22 09:24:16+00:00,{},Extending the world data replacement and adding level editor
297232553,Experimental support for custom books,rossipaolo,2019-07-12 21:41:17+00:00,2019-07-28 23:58:51+00:00,{},"Preliminary support for import of custom books for bookshelves. 

## How it works
1. A book file is positioned inside _StreamingAssets\Books_. For example `StreamingAssets\Books\example-book.TXT`.
2. A map table is positioned inside _StreamingAssets\Books\Mapping_. For example:

```json
[
    {
        ""Name"": ""example-book"",
        ""Title"": ""An Example Book""
    }
]
```

This table has two purposes: distinguish classic books replacements from additional custom books (could also have done this with a separate folder) and announces book titles before importing the actual resources. Custom subfolders can potentially be supported in the future.

3.  Each book is associated to a numeric id (only valid for the session) starting from 112 and added to **bookIDNameMapping** in ItemHelper.

## How to test

1. Add files as explained above.
2. Edit DaggerfallBookshelf to skew chances of selecting custom books (or add a lot of custom books...).
3. Find a book shelf (or add component to any test prop). The title should be visible and book resource readable.

This feature is disabled by default for the moment, and should not affect core in any way if disabled."
297151820,Fixes for spell icons packs,rossipaolo,2019-07-12 17:04:25+00:00,2019-07-25 01:29:51+00:00,{},
296954242,fixed bug with broken exterior automap when starting from interior save,Nystul-the-Magician,2019-07-12 07:43:35+00:00,2019-07-25 01:26:52+00:00,{},
296233730,Extend interior replacement for locations that share the same blockdata,UncannyValley21,2019-07-10 15:42:09+00:00,2019-07-10 16:07:24+00:00,{},"
Allow you to replace interior location based on the shared block data, as well as the specific instance of that blockdata. The specific instance replacement takes priority.
"
295969174,Faster noprompt wagon access,petchema,2019-07-10 00:58:19+00:00,2019-07-28 05:09:27+00:00,{},"Patch on top of #1341 and #1342 

When opening the inventory by keypress near dungeon exit in no DungeonExitWagonPrompt mode, do not only allow access to the wagon but also auto-select it.
This makes this mode actually more convenient than prompt mode.

Forums: https://forums.dfworkshop.net/viewtopic.php?f=12&t=2098&start=10#p26151
"
295966005,Only allow wagon access on sight,petchema,2019-07-10 00:36:09+00:00,2019-07-23 11:29:26+00:00,{},"Patch on top of #1341

There's probably still some bug, but I need to find a dungeon to test it:
Some dungeons have more than one exit door, but DungeonWagonAccessProximityCheck() checks the proximity to the StartMarker, not from a dungeon exit. If my hypothesis is correct, when DungeonExitWagonPrompt is disabled you cannot use those secondary exit doors to access your wagon.
"
295948122,Fix dungeon exit wagon access upon first inventory use,petchema,2019-07-09 22:56:25+00:00,2019-07-25 01:24:20+00:00,{},"Forums;
https://forums.dfworkshop.net/viewtopic.php?f=12&t=2098&p=26161#p26161"
295500870,Ambient sounds spatialization,petchema,2019-07-08 21:18:54+00:00,2019-07-11 09:45:47+00:00,{},"use AudioSource's minDistance to play distant ambient sounds at correct volume

- Simplified thunder sound: instead of enforcing source direction using a coroutine, put the sound source much further and compensate with high minDistance.
- Sounds are not always located within minDistance, so there's some volume randomization that wasn't there before; That can be adjusted if you feel that volume so too often too low;
- Increase ambient AudioSource's 3D spread, so that the hear opposite to the sound source gets more input; Specially in dungeons, to simulate environment reverberation and increase perceived volume.

This is a minimal patch, for example only one ambient sound can be played at any moment (not that PlayOneShot cannot be used several times simultaneously on an AudioSource, but all sounds will share some parameters, like the 3D location). 
Unity has lots of untapped sound features, AudioMixerGroups, ReverbZones,..."
295382005,Import spell icon packs from mods,rossipaolo,2019-07-08 15:14:33+00:00,2019-07-11 09:44:58+00:00,{},"Spell icon packs can be imported from mods when files are added to a folder name **SpellIcons**. During mod building, directory of selected files are matched and results, if any, are automatically added to `SpellIcons` array of `Contributes` property inside mod manifest file.

This process allows to provide icon packs (and possibly other assets in the future) in the same way for both mods and loose files, doing all the work at build-time rather than run-time where it could affect performance.

This is an example of a result manifest file.

```json
{
    ""ModTitle"": ""Example Spell Icons pack"",
    ""ModVersion"": """",
    ""ModAuthor"": """",
    ""ContactInfo"": """",
    ""DFUnity_Version"": ""0.8"",
    ""ModDescription"": ""Adds a spell icons pack."",
    ""GUID"": ""2f923d7b-b8e5-4db6-a535-6655896b87fc"",
    ""Files"": [
        ""Assets/Game/Addons/TestMod/SpellIcons/vmblast-test.png"",
        ""Assets/Game/Addons/TestMod/SpellIcons/vmblast-test.json""
    ],
    ""Contributes"": {
        ""SpellIcons"": [
            ""vmblast-test""
        ]
    }
}
```"
295262864,fixed bug with named residence not being resolved correctly on info click,Nystul-the-Magician,2019-07-08 10:00:19+00:00,2019-07-11 09:44:19+00:00,{},"solves bug report mentioned in https://forums.dfworkshop.net/viewtopic.php?f=24&t=2227

moved player house name handling into function GetBuildingDiscoveryData
so all residence name resolving is done in this function now"
294811547, fixed town map positioning (player marker positioning) for custom 1x1 locations,Nystul-the-Magician,2019-07-05 09:52:36+00:00,2019-07-11 09:44:01+00:00,{},fixed this in exterior automap code - against my initial intuition it turned out to be the right place to make those changes
294504712,Fix macro %n gender generation in quests,df-ferital,2019-07-04 09:44:04+00:00,2019-07-11 09:43:20+00:00,{},Gender generated when expanding %n in quests was not kept. Fixed it by using DFRandom.
293751439,fixed bugs with user note markers and teleporter markers:,Nystul-the-Magician,2019-07-02 13:31:01+00:00,2019-07-03 00:30:48+00:00,{},"- markers are now correctly restored on dungeon exit and reentering
- markers are now correctly removed when exiting dungeons (no left-over artifacts from other dungeons)

I am sorry for these stupid oversights on my side
If it is possible to create new test builds with this fix that would be awesome ;)"
293292916,Retain commoners social group,df-ferital,2019-07-01 11:15:49+00:00,2019-07-03 00:30:23+00:00,{},"Matched to classic: NPCs whose faction is ""People of"" or ""Court of"" current region retain their original social group even if they use their parent region faction data to interract with the player.

This fixes the bug mentioned by @petchema here: https://forums.dfworkshop.net/viewtopic.php?f=24&p=25816#p25816"
293270044,Retain commoners social group,Baljak,2019-07-01 10:08:02+00:00,2019-07-01 10:08:49+00:00,{},"Matched to classic: NPCs whose faction is ""People of"" or ""Court of"" current region retain their original social group even if they use their parent region faction data to interract with the player.

This fixes the bug mentioned by @petchema here: https://forums.dfworkshop.net/viewtopic.php?f=24&p=25816#p25816"
293058379,Tilemap ddx ddy mipmap,petchema,2019-06-29 19:30:04+00:00,2019-07-03 00:28:53+00:00,{},"Hopefully I fixed the seams problem. The trick was to make ddx and ddy derive a function that varies similarly to UV * texturesize, but without its discontinuities: the function at the origin of UV value, but before tile index/tile UV coords mapping (I called it unwrappedUV in the code).

(it seems there has been a long story of trying similar stuff, so I hope I'm not hitting the same shaders bug as everyone else...)
"
292318252,Automap - teleporter connection is now shown on mouse hover over,Nystul-the-Magician,2019-06-27 08:13:07+00:00,2019-06-28 21:15:23+00:00,{},for now it is only a 3d-line (cylinder) between the two portals
291388307,Refine indoor guard spawns and private property theft,numidium,2019-06-25 05:20:01+00:00,2019-06-25 22:35:54+00:00,{},"1. When in a shop, guards will now spawn at the lowest entrance.
2. Stealing private property now tallies Pickpocket and does a check against it.  If the check fails, guards are spawned and PC is accused of stealing."
290898194,adjust TilemapTextureArray mipmap levels to remove most aliasing,petchema,2019-06-23 15:35:04+00:00,2019-06-25 22:45:44+00:00,{},"I did perceptual tests on modded terrain textures, then some analysis, using DREAM RC4 and no post processing mod on my screen (1080p).

First I checked that a mipmap level of 8.0 looked smooth in the distance: that works.
Then I checked how far the transition between level 7.0 and 8.0 could be pushed away before aliasing appears. In my tests, 50.0 was about right.
Then I checked how far the transition between level 0.0 and 7.0 could be pushed away before aliasing appears. In my tests, 4.5 was close to the max.

But what's the scale between the two? I assume the goal is to keep the angular diameter of pixels about constant. Pixel widths varies according to 1/d, but their height decreases faster because the surface also appears more and more tilted (from camera point of view).
I spare you the details, but height seems to vary in 1/d¬≤.

Mipmap scale is logarithmic (vs pixel size), so you end up with level = const - 2*log2(d)

In other words, you should gain one mipmap level each time the distance increases by a sqrt(2) factor.
And it matches almost perfectly with the two bounds found perceptually!

However I don't know how my perceptual tests are portable to other systems...

Forums: https://forums.dfworkshop.net/viewtopic.php?f=27&t=1168&p=25573#p25573"
288685499,Spawn guards after rifling through private property,numidium,2019-06-17 03:47:53+00:00,2019-06-23 03:46:10+00:00,{},"This triggers the guard spawner after the player says ""yes"" to the ""This looks like private property"" dialog box.  Shop interiors are relatively small so the spawner doesn't always find a minimum distance, especially in one-room shops.

I'm thinking of doing an overhaul of interior guard spawns so they are handled in a more reliable way that also makes more gameplay sense.  I'll do that in a separate PR unless you would like to have that in this one."
287550831,Fix scale of DAED00I0.IMG,rossipaolo,2019-06-12 15:02:49+00:00,2019-06-16 07:50:34+00:00,{},
286834991,"Automap - major overhaul - micro map, custom user notes (markers), portals, fixes",Nystul-the-Magician,2019-06-10 20:58:05+00:00,2019-06-23 03:44:58+00:00,{},"new features:
- micro map
- custom user notes (markers)
- user note text and beacon info on mouse hover over in status bar (bottom of automap window)
- rotation pivot axis now has indicator arrows to better indicate its purpose
- teleporters are marked on the map now once pc discovered them (travelled through them) - left double click on a portal will show the connected portal (this is done by a short 1sec camera movement animation that will end with the camera showing the other portal)
fixes:
- entrance beacon/position is now correctly set for interiors when loading a save game where pc is in building
- lighting fixes

map behavior changes:
- 3d view is now standard view (as requested by some forum users)"
286646276,Make NPC greetings selection match classic,df-ferital,2019-06-10 11:51:16+00:00,2019-06-23 03:44:42+00:00,{},"Make the greeting text selection process the same as in classic, with some improvements and a few bug fixes. To do this, I reverse engineered the 3 classic functions used to get the greeting text.

Now to explain the changes I made: in classic, a faction related (mostly guild related in fact) greeting is selected each time the player talks to an NPC which is not a member of a faction of type 14 or 15, i.e. ""Court of"" or ""People of"" current region. Then, the correct greeting text is given by checking all player guild affiliations, especially guild enemies and allies. I did the same in DFU, fixing two bugs of the original function.

I also improved the overall selection process in two ways:
- I decided to exclude unique NPCs whose first parent is a province, as this gave weird greetings in classic. Because these unique NPCs are not members of a guild or guild-like faction, in classic, they could greet the player with sentences beginning with ""As a member of Sentinel..."" and other inadequate text. Now in DFU, all NPCs belonging to province children factions (this includes children of children), apart from Knightly Orders, will greet the player like all common people would do.
- One other improvement over classic is also to filter the usual ""Well met, stranger"" greeting (record 8570), which is always fired when the faction of an NPC is unrelated to all player current guilds. This, even if player current reputation with the NPC faction (e.g. The Merchants or The Bards) is very good. So, I restricted this boring greeting to NPCs for which player reputation with their respective faction is below or equal to 5. So, when the player can really be considered a stranger to the NPC he is talking to. In other cases, NPCs of such factions will use common people greetings. I tested it in game and this is much better in my opinion."
286622496,Spell merchant consistency,petchema,2019-06-10 10:29:55+00:00,2019-06-21 00:32:02+00:00,{},"Thinking again about an old patch (#1063), I think it makes more sense to make spell merchant window behavior consistent with all others, and not close on double-click.
On the other hand, display available money since that's an important information for the player. It lands perfectly at the right of cost, just like in standard merchants interface.
"
286527278,[SaveLoadManager] Delete Notebook File,jbrod22,2019-06-10 03:14:22+00:00,2019-06-16 07:47:02+00:00,{},"PR adds the notebook to deleted files.

Noticed in unity that save folders were not being deleted because they weren't empty. Found they all had one NotebookData.txt file. Adding this line removed the folders and logging errors."
285980264,Improve KeyBind data handling,zpl-zak,2019-06-06 21:43:44+00:00,2019-06-21 01:14:00+00:00,{},"This PR tries to tackle issues mentioned by https://github.com/Interkarma/daggerfall-unity/pull/1320#issuecomment-499596177 by adding simple error resolution measurements to ensure backward and forward compatibility of the game.

Unknown actions will now be ignored by the `InputManager`, but kept in memory, so we can store them back to the settings file once we rebuild it."
285938343,TravelPopup: Added OnPreFastTravel event,rossipaolo,2019-06-06 19:27:42+00:00,2019-06-16 07:50:14+00:00,{},
285777034,Refactor TransportManager,zpl-zak,2019-06-06 12:18:53+00:00,2019-06-25 23:00:02+00:00,{},"Implementation of a horse mount (or dismount when already on a horse/cart) for G key. This required some changes to the `TransportManager` to make sure transportation change conditions are kept in sync via a public API. `ToggleMount()` can easily mount or dismount a horse if conditions are met.

I can optionally get rid of the G key shortcut, if wanted.

NOTE:
Call to `ToggleMount()` works even inside of buildings or dungeons. This behaviour was kept intentionally to allow mods to use mounts even inside interiors. Of course, the front-end logic defaults to classic behaviour and only allows you to toggle mount in the exterior.

Introduced an option in the Enhancements section called `HorseMountShortcut`."
284287332,Implement IEnumerable<BaseScreenComponent>,pcbeard,2019-06-01 17:51:26+00:00,2019-06-25 22:51:24+00:00,{},This allows foreach(var component in components) to properly infer the type.
284271483,generate OnEncounter event that mods can subscribe to,petchema,2019-06-01 13:23:59+00:00,2019-06-21 00:37:54+00:00,{},"First goal is to make Tedious Travel work more reliably at high time compressions, but future mods could also benefit from this event.

Also, make rest window subscribe to this event to remove some specific code."
284181708,Enable texture override for paperdoll,rossipaolo,2019-05-31 20:22:41+00:00,2019-06-21 00:27:41+00:00,{},Enabled injection of custom textures to new paperdoll renderer. Additional textures named `textureName_Mask` can provide masking defined on alpha channel. Maks provided via assetbundles should use texture type _Single Channel_ to automatically pick format with minimum amount of memory used.
283892043,Implement Masque of Clavicus effect,numidium,2019-05-31 04:21:23+00:00,2019-06-23 04:00:39+00:00,{},I made the reputation boost +20.  Please let me know if this should be higher for gameplay purposes or if there is a value that is more Classic-accurate.
283705303,Implement bow drawback option,ajrb,2019-05-30 15:42:12+00:00,2019-06-23 03:58:07+00:00,{},"Adds a 2 stage process for shooting arrows with a bow. Hold down right mouse to draw and release to fire. Uses 3 frames of animation which were previously unused due to single stage attack animation process.

1) Draw the bow. frames 0-3
2) Release the arrow. frames 4-6

Set BowDrawback true to enable. Left click releases without firing arrow, this will automatically happen after 10s anyway.

This came out of the discussion here https://forums.dfworkshop.net/viewtopic.php?f=12&t=1748. I had intended the whole thing to be in a mod, but after looking at the weapon handling and animation code, it feels like it would need a massive amount of re-factoring to achieve this. So, I've put this into the core DFU codebase as an option. 

I think it has as much value as click to attack, and is a nice updating of archery interaction for DFU. In fact I would quite like it to be the default, but that's up to the dev community to decide. I do intend to add some mod hooks / formulas so that this 2 stage process can be integrated with damage and hold limits in a mod. Would like to be sure you're okay with these changes first though @Interkarma ."
283645082,Automap lighting fix,Nystul-the-Magician,2019-05-30 13:00:38+00:00,2019-06-17 13:46:51+00:00,{},"minor fixes:

Automap.cs:
opening automap window will no longer affect scene lighting (automap lights now only affect gameobjects related to automap layer)
this caused background scene to brighten up for the time automap was open - this should be fixed now

DaggerfallAutomapWindow.cs:
shortended some button hint texts"
283212855,Ensure size of emission map for lights is the same as albedo,rossipaolo,2019-05-29 11:21:07+00:00,2019-06-21 00:23:38+00:00,{},Batched billboards must have the same size for albedo and emission maps because atlas rects are shared.
282982293,Implemented detail slider in pause window,rossipaolo,2019-05-28 20:21:41+00:00,2019-06-21 00:53:33+00:00,{},
282953014,Do not show the same resolution with multiple refresh rates,rossipaolo,2019-05-28 18:49:54+00:00,2019-06-16 06:12:07+00:00,{},"Fix issue reported [here](https://www.reddit.com/r/daggerfallunity/comments/bkb1hv/a_question_about_the_resolution_settings_from_the/):  Daggerfall Unity always uses the highest supported so there is no need to show multiple values on UI.
"
282951822,fix background behind some messageboxen,petchema,2019-05-28 18:46:05+00:00,2019-06-17 08:33:28+00:00,{},"Forums: https://forums.dfworkshop.net/viewtopic.php?f=24&t=2126

Git bisect points at commit 445a9a89

There's a lot of ways to create DaggerfallMessageBox objects, maybe there's another, existing,way that I missed..."
282605837,Add level progress dialog,ajrb,2019-05-27 20:15:31+00:00,2019-06-16 06:02:45+00:00,{},Note: will not be correct if CalculatePlayerLevel() formula is changed by mods.
282565364,Dungeon wagon prompt setting,ajrb,2019-05-27 16:12:04+00:00,2019-06-16 06:02:10+00:00,{},"Wagons can now be accessed when player is within 10m of a dungeon exit.
The access wagon prompt can be disabled in settings.
Added messages informing player why the wagon button does nothing in inventory window."
282314361,Mod System: Cleanup and improved documentation,rossipaolo,2019-05-26 18:34:22+00:00,2019-06-16 06:01:19+00:00,{},"# Cleanup
* Moved private methods to `Private Methods` regions.
* Default spacing.
* Removed empty lines.
* Use PascalCase for regions and public members.
* Use camelCase for private fields.
* Use AutoProperties.
* Use the same formatting for all properties.
* Use readonly.

# Other Improvements
* Reviewed documentation for public members.
* Setter of `Mod.LoadPriority` is now internal."
282232072,Fixes,ajrb,2019-05-25 14:05:01+00:00,2019-06-21 00:18:06+00:00,{},"* Ensure i'm at shows current location after searching 
* Implement name function for %n macro. (requires checking by @Nystul-the-Magician )
* Implement %vcn macro. (needs checking by @Interkarma)
* Implement %rn macro.
* Fix bug when loading a game when holding a bow that displayed no arrows message after loading.
* Fix unhandled null exception when no building discovered.
* Fix negative reaction message having black background.
* Fix potion recipes added to loot and shelves, they were all showing as unknown until saved.
* No materal should be applied to arrows in loot "
282145901,implement smarter location finder using edit distance,petchema,2019-05-24 20:14:03+00:00,2019-06-16 05:52:48+00:00,{},"This is a bit experimental; It gives interesting results, but there's no guarantee I didn't break anything (say, that all the places that could be found before can still be accessed?).
Also, costs have been set by hand, and are likely not optimal.


EditDistance contains a quite flexible edit distance function:

```
public EditDistance(Func<string, string> canonize_string,
                    Func<char, float> insert_cost,
                    Func<char, float> delete_cost,
                    Func<char, char, float> replace_cost,
                    Func<string, int, float> seek_cost,
                    Func<string, int, float> trim_cost)
```
- canonize_string(s) is the function that will be used to preprocess dictionary and search strings
- insert_cost(c) is the cost function for adding a specific character
- delete_cost(c) is the cost function for removing a specific character
- replace_cost(c1, c2) is the cost function for replacing a specific character with another
- seek_cost(s, start) is the cost function for seeking in the dictionary string s to the start-th character
- trim_cost(s, stop) is the cost function for seeking in the dictionary string s from the stop-th character to the end

Lowering the latter 2 costs (compared to insert_cost) allows to approximate a substring search.

```
float distance(string s1, string s2, float upperBound = float.PositiveInfinity)
```
This computes the edit distance to transform string s1 into string s2.
If an upperBound is provided, the function short-circuits and returns float.PositiveInfinity if it detects during computation that the final cost will be above upperBound. This requires all costs to be positive.

`void SetDictionary(List<String>)`
Set the dictionary that will be used to next searches. It canonizes all the dictionary strings, so it could be useful to only call it when the dictionary changes.

`MatchResult[] FindBestMatches(string needle, int ntop)`
Finds at most ntop dictionary entries that have the smallest distance to needle string.
MatchResult is a structure that contains the (non-canonized) matching string, its distance to needle, and a relevance. The results with the best relevance (hence smallest distances) are returned at the beginning of the list.


DaggerfallEditDistance is a static class that provides an EditDistance object pre-configured with useful parameters:
- trimmed/lowercased strings canonization;
- smaller cost for adding or removing separators (space and dash) compared to letters;
- smaller cost for replacing a separator with another;
- smaller cost for substring prefix search, and to a lesser extend beginning of word search;
- smaller cost for substring suffix search, and to a lesser extend ending of word search.

DaggerfallTravelMapWindow has been modified to use findBestMatches() of this object; In case of approximate matches, a location picker window will appear with name suggestions.
DaggerfallListPickerWindow was slightly modified to take keyboard focus in this case (it did not always take the focus on first use).

Search still feels instantaneous with the normal lists of locations of a Daggerfall region, and DaggerfallTravelMapWindow doesn't even optimize calls to SetDictionary() so it could still be made a bit faster."
280428835,Rework the UV unpacking method,df-ferital,2019-05-20 14:59:05+00:00,2019-05-22 06:33:49+00:00,{},"This fixes the UV processing method. Previous changes I made in PR #1299 were not as robust as they are now.

It now seems DFU even does a better job at processing some of classic UV coordinates. See Bargain Gear Store in Ephesus for an example.

I reworked the method after the following considerations:
- Until proven otherwise, models which require some processing on there UV coords are always exterior buildings, so we can easily filter these since buildings model ids are below 1000.
- Only coordinates above 14335 or below -14335 need to be 'unpacked' (as was already guessed by Interkarma years ago). The only noticeable exception seems to be -7168, which I found on several building planes: this one has always to be processed as well. 
- The correct texture coordinate is given by subtracting the nearest multiple of 8192.

So in the end, not only this new method fixes all regressions issued by pango and others on the forums (house roof, Daggerfall Castle treasury room), but also fixes new models without the need to alter original game data (Bargain Gear Store in Ephesus, Mages Guild in Dragontail)."
280193846,Loan improvements,petchema,2019-05-19 20:04:26+00:00,2019-05-23 07:24:43+00:00,{},"Loans are checked every night, so a default can occur while you're not interacting with the bank.
As a side effect, you can repay your loan anytime during the due day (well, before 15:00 at least ;) )

Reminders are sent to the HUD when due date becomes less than 6, 3, and 1 months away. It would be even better if banks could send letters someday...
Banking status (accounts, loans) for all active regions can be checked from the character sheet, by clicking on GOLD status.

When due date is reached, the bank will first try to pay the loan using your account money. If that works, the loan will just be cleared.
Otherwise, default occurs with the bank, and your regional legal rep will decrease. The bank will also reject any later loan request.

Currently, the legal rep loss is not so huge that the city guards will go after you just for that crime; However I wanted to keep the legal rep loss consistent with other crimes.
It seems to not have been the case back in the day either https://groups.google.com/forum/#!searchin/alt.games.daggerfall/loans%7Csort:date/alt.games.daggerfall/JjCGQXFyuew/Pf9HMApBxSoJ"
280183328,fix an ArgumentOutOfRangeException,petchema,2019-05-19 17:15:09+00:00,2019-05-22 06:33:07+00:00,{},"Happened while opening quest log:

ArgumentOutOfRangeException: Argument is out of range.
Parameter name: index
  at System.Collections.Generic.List`1[DaggerfallWorkshop.Game.UserInterface.ListBox+ListItem].get_Item (Int32 index) [0x00000] in <filename unknown>:0 
  at DaggerfallWorkshop.Game.UserInterface.ListBox.get_SelectedItem () [0x00000] in <filename unknown>:0 
  at DaggerfallWorkshop.Game.UserInterface.DaggerfallTalkWindow.UpdateListboxTopic () [0x00000] in <filename unknown>:0 
  at DaggerfallWorkshop.Game.TalkManager.AssembleTopicLists (Boolean isInstantRebuild) [0x00000] in <filename unknown>:0 
  at DaggerfallWorkshop.Game.TalkManager.AddDialogForQuestInfoResource (UInt64 questID, System.String resourceName, QuestInfoResourceType resourceType, Boolean instantRebuildTopicLists) [0x00000] in <filename unknown>:0 
  at DaggerfallWorkshop.Utility.QuestMacroHelper.ExpandQuestMessage (DaggerfallWorkshop.Game.Questing.Quest parentQuest, .Token[]& tokens, Boolean revealDialogLinks) [0x00000] in <filename unknown>:0 
  at DaggerfallWorkshop.Game.Questing.Message.GetTextTokens (Int32 variant, Boolean expandMacros) [0x00000] in <filename unknown>:0 
  at DaggerfallWorkshop.Game.UserInterfaceWindows.DaggerfallQuestJournalWindow.SetTextActiveQuests () [0x00000] in <filename unknown>:0 
  at DaggerfallWorkshop.Game.UserInterfaceWindows.DaggerfallQuestJournalWindow.Update () [0x00000] in <filename unknown>:0 
  at DaggerfallWorkshop.Game.DaggerfallUI.Update () [0x00000] in <filename unknown>:0 
"
280110370,Make random spymaster NPCs act like non-guild,ajrb,2019-05-18 16:08:48+00:00,2019-05-22 06:32:47+00:00,{},"There are some NPCs marked as TG spymasters in various houses, I had suppressed ones in House2 buildings already. I've changed this so all misplaced spymaster NPCs now have special case handling so they act just like regular NPCs instead of just making them disappear. Basically the same as I did for holy order NPCs that are not in a temple. (viewtopic.php?f=28&t=1238)

I also fixed it so the responses are now general ones for spymasters, left it alone for the priests since they already use a parent faction with no guild group.

Additionally the guild responses were getting random messages using strings when the msgs being used have formatting tags, so I fixed that too."
279685381,Spatialized spell missile hit sounds,petchema,2019-05-16 22:03:11+00:00,2019-05-17 02:30:26+00:00,{},"tweak minDistance and maxDistance instead of spatialBlend and volume

volume is never effectively amplified, so setting volume > 1f has no effect.
Instead, one can increase minDistance, so the the sounds stays at nominal volume at a larger range.
maxDistance sets at what distance the sound stops becoming quieter with distance. This is actually better than using spatialBlend, because the sound stays directional, which is important to know where are enemies fighting.

Forums: https://forums.dfworkshop.net/viewtopic.php?f=24&t=2089&p=24412#p24412"
279565094,Reworked the UV unpacking method,df-ferital,2019-05-16 15:42:24+00:00,2019-05-17 14:08:29+00:00,{},"After extensive experiments, I came to a better UV unpacking method. Actually, only the U texture coordinate needs to be processed.

This fixes some side effects of the previous method, like some house roofs or the Daggerfall Castle treasury room, as mentioned here https://forums.dfworkshop.net/viewtopic.php?f=5&t=1899&start=30."
279320676,Fix navigation in character creator,numidium,2019-05-16 02:01:16+00:00,2019-05-22 06:32:31+00:00,{},Addresses issues described in https://forums.dfworkshop.net/viewtopic.php?f=24&t=2075 and https://forums.dfworkshop.net/viewtopic.php?f=24&t=2051.
279206942,only dip head in front of static obstacles,petchema,2019-05-15 18:10:01+00:00,2019-05-22 06:32:09+00:00,{},"Do not automatically dip for moving obstacles, like missiles (including your own).

On the other hand, I wonder if enemies can't dodge missiles because of a similar mechanism (in EnemyMotor.HeightAdjst).
Maybe that's the missiles that should be handled differently? I don't know if that's even possible.

Forums: https://forums.dfworkshop.net/viewtopic.php?f=24&t=2089"
278358377,Fixed scale of MASK04I0,rossipaolo,2019-05-13 17:00:27+00:00,2019-05-17 02:20:54+00:00,{},
278032618,Weaken shadows under scattered light,petchema,2019-05-12 06:57:17+00:00,2019-05-17 02:20:34+00:00,{},"When light is scattered, there should be less hard shadows (only ambient occlusion shadows); This is most obvious during heavy fog.

So I modified the shadows to be
- slightly lighter during overcast weathers;
- very light during snowing weather;
- almost inexistant during fog."
278010806,Holiday effect implementation,ajrb,2019-05-11 21:47:34+00:00,2019-05-17 02:19:21+00:00,{},"- Enable holiday effect for closed shops on Suns Rest 

- Enable holiday effects for free & half price curing
** Free on: South_Winds_Prayer, First_Harvest, Second_Harvest
** Half price on: North_Winds_Festival (needs testing)

- Enable holiday effects for half price sales
** Merchants Festival, suns height 10th for normal shops
** Tales and Tallows hearth fire 3rd for mages guild (needs testing)
** Weapons on Warriors Festival suns dusk 20th (needs testing)"
278001548,Handle %kno macro for quests,ajrb,2019-05-11 18:41:33+00:00,2019-05-17 02:18:41+00:00,{},"I'm not sure if classic does this, but I removed the ""The "" prefix from the order names so the quest messages doesn't come up displaying ""The The "" - anyone have an issue with that?"
277993782,Fix unhandled map items,ajrb,2019-05-11 16:37:03+00:00,2019-05-17 02:18:00+00:00,{},"Hello, remember me? :-)"
277770131,Object Positioner: Improvements,rossipaolo,2019-05-10 13:28:15+00:00,2019-05-17 02:17:31+00:00,{},
276860272,loans to be repaid one year later,petchema,2019-05-08 05:40:26+00:00,2019-05-17 02:17:08+00:00,{},"Loans were due immediately
Bug was not obvious because displayed due date does not show the year

Forums: https://forums.dfworkshop.net/viewtopic.php?f=24&t=2072"
276019074,Implement Ring of Namira effect,numidium,2019-05-05 19:14:12+00:00,2019-05-22 06:31:31+00:00,{},
275957992,TextureReplacement: Fix animated billboard material,rossipaolo,2019-05-05 00:48:53+00:00,2019-05-05 23:57:20+00:00,{},
275928730,Randomize book quest rewards,Allofich,2019-05-04 15:29:35+00:00,2019-05-05 23:57:01+00:00,{},"Also read ""message"" from classic data as a ushort as that is what it is in classic


This should hopefully fix
https://forums.dfworkshop.net/viewtopic.php?f=24&t=1845&p=23954#p23954.

I can't reproduce the problem of getting ""The First Scroll of Baan Dar"" in random loot. Maybe it was fixed as Jay_H's comment suggests. But it does look like quest rewards were neglecting to randomize the book, so that is added in this PR.

I didn't have a save handy to test a book quest reward, but this is a pretty straightforward change so it should work."
275917500,TextureReplacement: Initial support for billboard animations with TextureArray,rossipaolo,2019-05-04 12:16:52+00:00,2019-05-17 07:18:56+00:00,{},
275901075,Add Skull of Corruption effect and Tweak Sanguine Rose,numidium,2019-05-04 06:48:29+00:00,2019-05-17 02:04:53+00:00,{},"I made it so both the Skull and Rose only spawn allies if the monsters nearby are not allied with the player.  I'm aware that the Skull in classic only clones non-human enemies in classic but I didn't feel the need to limit it in that way (I'm willing to change it if there are objections).  The behavior otherwise matches classic to the best of my knowledge.  Please let me know if I'm missing anything.

On a side note, I'm impressed at how simplified the process of adding new artifact effects is now.  Well done, Interkarma!"
275870375,Settings: Minor UI improvements,rossipaolo,2019-05-03 22:45:10+00:00,2019-05-03 22:52:45+00:00,{},
275866058,fix negative repair times when removing other repaired items,petchema,2019-05-03 22:19:22+00:00,2019-05-03 22:51:49+00:00,{},"**Background**

There's a base time for each item, proportional to the amount of damage it took. Then the time for the longest item to repair is increased by half the time taken by all the others (rationale, I assume, is that
while working on other items, work on this item is slowed down by half. On the other hand all other items are worked on in parallel, mmh). Anyway, it gives some incentive to repair several items at once, yet it's not totally for free.

Now what happens if you add items when some repairs are already ongoing? 
Implementation in DFU just reevaluates everything together; So old repair times may adjust if you add items to the mix (I've checked that classic does that too), and in the end you get the same times as if you put everything to repair at once, so it seems it's not possible to cheese the system that way.

**Issue**

Problems arise when some repairs complete, or worse if the repaired items are removed from the list: because if you keep reevaluating the repair times, suddenly the repair time for the longest repair goes down!

**Fix**

This patch just prevents repair times from decreasing; This should fix the problem at hand, should prevent most exploits (if you add your ""lesser damaged items"" in batches so that the same item always get the 50% penalty, you can still save some time), in some obscure cases it will be unfair (if you attempt the same trick and the 50% penalty goes to another item, some penalty may be accounted twice), but it stays relatively simple to implement...

Forums: https://forums.dfworkshop.net/viewtopic.php?f=24&t=2053"
275298659,Match enchantment reputation mods to classic,Allofich,2019-05-02 09:55:10+00:00,2019-05-03 22:52:29+00:00,{},"BTW, Interkarma, I didn't completely understand a couple of comments in `BadRepWith.cs`.

> Sources claim that effect persists even when item in wagon, but this is suspect and not consistent with other item effects.

Not completely sure what you meant but I think it may be true that good rep and bad rep enchantments take effect for any item in inventory in classic even if not equipped. But if so that seems like it may be a mistake as I don't think anything else works like that.

> Classic allows unusual stacking of variants, e.g. all is exclusive to groups but each group not exclusive with itself.
Changed this to work uniformly as per GoodRepWith, which does not allow self-stacking of groups.

Do you mean stacking vs. being exclusive when selecting enchantments in the item maker? I'm not sure about that but as for the actual applying of the enchantments, classic allows stacking as it will apply them for each one it encounters while iterating over the 10 enchantment slots. So if you hacked in an item with 4 enchantments on it of:
1) Good rep with commoners (+10)
2) Good rep with all  (+10)
3) Good rep with commoners  (+10)
4) Bad rep with commoners  (-10)

These would all be summed together, and you'd end with +20 for commoners and +10 for the 4 other groups."
275094220,Cleanup and fixes for EnemyMotor,Allofich,2019-05-01 17:26:52+00:00,2019-05-03 22:52:08+00:00,{},"-Cleanup-
Use auto properties
Divide long Move() function into smaller functions
Add/correct comments, renaming

-Fixes, improvements-
Allow backup for out-of-pitch target to move smoothly
Allow knock-back for paralyzed enemies
Knocked-back flyers will drop while being knocked back
Use direction, not movement, consistently with obstacle-check functions
Refined obstacle and fall detection
Smaller radius used when checking for arrow shot. Will shoot over tables
now.
Account for controller changing height when colliding with objects by
storing original height
Stop flyers from flying near floor during combat
Flyers/swimmers/levitating enemies check up and down when detouring"
275024068,Custom render mode for billboards,rossipaolo,2019-05-01 13:01:13+00:00,2019-05-03 22:50:46+00:00,{},
274604871,scrolling speed adjustments,petchema,2019-04-30 05:53:20+00:00,2019-05-01 04:36:48+00:00,{},"Exponential speedups did not work as well as the math suggested, with large lags the acceleration made all lines disappear from screen in a blink, including the most recent ones; Or get stuck because speedup overflows floats capacity!
Replaced with simple rubberbanding (proportional speedup) for now. I don't like that acceleration profile as much, but it fixes those issues. That may be improved later.
Added a ""addpopuptext"" console command to push n lines in the buffer for testing."
274204764,MeshReplacement: Ensure DaggerfallBilboard is found on loot,rossipaolo,2019-04-28 20:01:07+00:00,2019-04-28 21:50:50+00:00,{},"Fix one the two issues raised [here](https://forums.dfworkshop.net/viewtopic.php?p=23300#p23234), specifically the invisible loot containers.

I've not yet been able to replicate issue with loot content."
274199874,TextureReplacement: Fixed scale of TELE00I0.IMG,rossipaolo,2019-04-28 18:40:30+00:00,2019-04-28 22:05:03+00:00,{},
274187281,import enemies and loot on teleport in dungeon,petchema,2019-04-28 15:20:02+00:00,2019-04-29 00:51:37+00:00,{},"Everything's in the title, when teleporting into a dungeon from some
other place, import dungeon enemies (and loot).

Forums: https://forums.dfworkshop.net/viewtopic.php?f=24&t=1661"
274180962,fix for building-to-building teleport ending in the Void,petchema,2019-04-28 13:43:44+00:00,2019-04-28 22:12:17+00:00,{},"In case current and anchor buildings have the same buildingKey, map pixels must also be compared to be sure it's not the same building.

Discovered data doesn't look good, that may not be the best possible fix.

Forums: https://forums.dfworkshop.net/viewtopic.php?f=24&t=2018"
274161082,fix mobile town NPCs spawning in front of player,petchema,2019-04-28 08:02:04+00:00,2019-04-28 21:35:54+00:00,{},"distanceToPlayer was updated too late, for recycled npcs that can make a lot of difference!

Forums: https://forums.dfworkshop.net/viewtopic.php?f=24&t=1997"
274153181,fix city gates regression,petchema,2019-04-28 05:24:57+00:00,2019-04-28 21:35:20+00:00,{},"Broken in 94a2c78b

Forums: https://forums.dfworkshop.net/viewtopic.php?f=24&t=2002"
274141659,make sure wagon button is fully reset by buy window,petchema,2019-04-28 00:31:17+00:00,2019-04-29 00:50:42+00:00,{},"DaggerfallTradeWindow.OnPush() can be called before Setup() so wagonButton can be null in OnPush(), and its texture not settable there. 
So to cover all the bases the button background texture must also be set in Setup().

Forums: https://forums.dfworkshop.net/viewtopic.php?f=24&t=2040"
273094301,Make Texture Arrays with CopyTexture,rossipaolo,2019-04-24 11:46:59+00:00,2019-04-28 22:22:14+00:00,{},"Terrain Texture Arrays are now created with Graphics.CopyTexture on supported platforms, which is much faster than using Get/SetPixels.

1. Get/SetPixels
2. CopyTexture (DXT1)
3. CopyTexture (RGB)

![copyTexture](https://user-images.githubusercontent.com/24359151/56658353-ba69bf80-669a-11e9-88a0-630e21cdb4ee.png)

Beside the fact that the format is the one used by individual textures (which can be compressed), the improvement is that CopyTexture performs a GPU-side copy between textures, which is faster than uploading with Apply(). This also means that Read/Write flag can be unchecked, unless a mod wish to target older platforms with no support for this feature.
"
272509239,Paying spellmaker and spellbook check,petchema,2019-04-22 21:23:00+00:00,2019-04-28 22:25:29+00:00,{},"Supersedes #1252 (Deducts gold when buying spells from spellmaker)

Also, check for spellbook presence. In classic, when you have no spellbook:
 

- spell merchant does nothing, not explaining why;
- spell maker fails at the last minute (""you have no spellbook to inscribe this spell"")

I think that in both cases the player, even without a spellbook, could want to peruse available spells, so I implemented a preliminary warning that does not block the access to the spell merchant and the spell maker.
A second check is done if you try to buy a spell though.
    
Maybe that's overkill and confusing, and access could simply be denied with an error message?
The simplification I'm considering:

- remove spell merchant warning. The player can peruse the spells, but will be denied to buy any. There's not much effort investment from the player so that should be ok;
- display a blocking error message when trying to access the spell maker"
272235779,TextureReplacement: Emission maps for mobile billboards,rossipaolo,2019-04-21 19:27:45+00:00,2019-05-01 04:35:42+00:00,{},Added support for emission for mobile billboards. This can be used to provide emission maps for enemies such as Fire Atronach.
272210004,Fixes to AI spell casting/shooting,Allofich,2019-04-21 11:31:17+00:00,2019-04-28 22:30:17+00:00,{},"1. Main fix here is that the prediction counter is no longer reset whenever the AI checks for whether it can shoot a spell. This was causing the imp and others with ranged spells to get stuck. (In master branch create an imp with ""cm 1"" and they should get stuck almost immediately. With this PR they are fixed. This problem surfaced after one of my recent PRs)

2. Enemies can now cast any spell as long as they have at least 1 spell point left. This matches classic and should allow them to cast the same number of times. It's also relevant to the classic AI's spell decision, as it checks for whether it has any spell points left when deciding if it can still cast. (Otherwise, we'd need to check whether it has at least the spell points of its cheapest ranged spell or something like that)

3. Cleaned up logic and treasure loot/other spells are ignored when the AI checks if they can shoot. They can now shoot projectile spells more often. (Tested with the mage on the pedestal in the entrance room of Woodborne Hall. In master they just wander around trying to find a way to you without a fall, without shooting)

4. Minor cleanups

5. Added a fix for when an AI gets stuck falling. I've only had this happen once so I think it's pretty rare, but the AI could get stuck while falling if the `controller.SimpleMove(Vector3.zero);` that applies gravity failed to move it downward, as it would return without updating `lastPosition`. Changed the order of code so that `lastPosition` will update and it won't get stuck."
272159153,Fix typo in AreEnemiesNearby,numidium,2019-04-20 15:22:32+00:00,2019-04-28 22:13:21+00:00,{},@petchema brought this to my attention. Looks like I put an OR where an AND should have been.
271700930,Get a region vampire clan from factions.txt,df-ferital,2019-04-18 14:00:56+00:00,2019-04-29 00:36:16+00:00,{},"Classic uses the ""vam"" faction field of a region faction data to get its corresponding vampire clan. This makes DFU behave the same.

Also did a little refactoring of some methods I used there to avoid code duplication."
271399233,Added support for cursor override,rossipaolo,2019-04-17 17:21:14+00:00,2019-04-28 21:34:37+00:00,{},Allows mods to provide a custom cursor texture. This must use the 'Cursor' texture type and have Read/Write flag enabled. Import from loose files is not supported.
271043143,Sell horses and wagons,petchema,2019-04-16 19:27:39+00:00,2019-04-28 22:26:38+00:00,{},"Allow to sell horses and wagons.
If you have items in your wagon, one arbitrary wagon cannot be sold.

Forums: https://forums.dfworkshop.net/viewtopic.php?f=23&t=697
"
270976615,Reworked FaceWall as WallPropPositioner,rossipaolo,2019-04-16 16:05:08+00:00,2019-04-28 21:34:21+00:00,{},"* WallPropPositioner is derived from ObjectPositioner.
* WallPropPositioner allows to set a local space direction instead of expecting the model to be oriented along the Z axis.
* Added IObjectPositioner interface to toggle random flat rotation. Potentially allows mods to provide their own positioning mechanisms."
270730047,Classic quest fixes,JayH2971,2019-04-16 02:13:09+00:00,2019-07-18 23:29:22+00:00,{},"Mostly removing the instant win glitch and fixing timers to exact values when needed
EDIT: And a lot more stuff. Feature creep at work."
270494125,New ruler namegen fix,df-ferital,2019-04-15 12:26:18+00:00,2019-04-29 00:11:02+00:00,{},"This fixes the mapping between race numbers from FACTION.TXT and races used in game, when generating a random ruler name when asking a NPC for any news."
270329401,set *BarGain vital indicators in SynchronizeImmediately,petchema,2019-04-14 21:40:27+00:00,2019-04-28 21:34:01+00:00,{},"Fixes a bug when the effect of some healing was still animated at the time of resetting (say, you where trying to heal yourself when you got slain and reloaded a game).

Also, cleanups

PositionIndicators() side effects are unlikely to change from one Update() to the next, is it worth optimizing?

Forums: https://forums.dfworkshop.net/viewtopic.php?f=5&t=1880#p22163"
270324442,Townsfolk names now match classic,df-ferital,2019-04-14 20:23:08+00:00,2019-04-29 00:21:51+00:00,{},"Townsfolk names are not tied to climate settings in classic. Instead, they use an array of 62 byte values hardcoded in FALL.EXE with 0 for Breton and 1 for Redguard. Nord names are never used for town NPCs.

This makes DFU behave the same."
270295613,Implement AI pathing to target position,Allofich,2019-04-14 13:05:43+00:00,2019-04-15 17:10:40+00:00,{},"Implements actual AI pathing to targets. With this, enemies are quite a bit better (still far from perfect) at navigating complex areas like building interiors or moving up or down land bridges or chasing the player from room to room.

In master branch the AI basically takes a ""blindly feeling along the wall"" approach, but this only works for simple obstacles and is pretty useless when up and down is involved. With this PR a grid of 1-unit spaced points is created and searched, using 8-directions and aiming for the direction of the target's predicted position. Attempts are made to recognize climbable slopes and falls. The AI then follows the path it created, whether it successfully reached the target position within the allowed number of tries or not. It follows the path point to point, short-cutting a point ahead if it has a clear path to it and the y-difference is small. 

I've been working on this for a while now and I finally got it to where my test cases seem to all be working OK, but I'm sure problem situations still exist.

Also includes a fix for magic users caused by my last AI PR. I noticed imps could get easily stuck vibrating back and forth. This fixes that.

If you want to test, turn on the ""Gizmos"" in the upper right corner of the Unity editor to see the pathing. The red lines are the grid of searched points, the blue line is the path result, and the green lines point to the position the enemy is currently trying to get to.

There's a lot of sphere-casting going on, but I haven't really noticed a performance drop in my testing. If it does cause performance drops, we could limit the searching or make it less frequent, randomly space them out a little so AI's created at the same time don't all search at the same time, etc."
270260139,adjust scrolling speed to limit buffering,petchema,2019-04-13 23:16:15+00:00,2019-04-28 21:30:30+00:00,{},"When all popuptext buffer can be displayed on screen, behave just like before;

When more lines are buffered, adjust scrolling speed so lines appear within a fixed time (currently 1.5s, adjustable) after their insertion. This should prevent unbounded lag when a lot of text is generated (spells spamming, info-click on buildings,...)

Forums: https://forums.dfworkshop.net/viewtopic.php?f=24&t=1985"
270255327,TravelMap: Support for custom overlays,rossipaolo,2019-04-13 21:27:44+00:00,2019-04-28 21:29:44+00:00,{},"Allows to import overlays along with texture map, to avoid classic resolution overlay over high resolution map."
270252639,TextureReplacement: Allow readonly flag for billboards,rossipaolo,2019-04-13 20:36:03+00:00,2019-04-28 21:29:14+00:00,{},
269574708,Minor cleanup,Allofich,2019-04-11 13:31:21+00:00,2019-04-11 23:04:05+00:00,{},"Very minor cleanup of 2 things in `DaggerfallMissile`. `arrowCollider` could be made a local variable, and the `AssignBowDamageToTarget(other)` line wasn't indented and made it look a little unclear what was intended to fall under the if statement."
269536491,Everything using ClassicUpdate uses FixedUpdate,Allofich,2019-04-11 11:43:17+00:00,2019-04-11 23:02:49+00:00,{},"Should fix https://www.reddit.com/r/daggerfallunity/comments/bb5yu4/enemies_seem_floaty/.

When I merged all the classicUpdateTimers into one, I put it into the GameManager, and stuck it in its `Update()` along with all the rest of its update work. However, since `FixedUpdate()` and `Update()` are not in sync with each other, accesses to this from `FixedUpdate()` functions were not reliable. Everything needs to be either in `FixedUpdate()` or in `Update()`. Since https://docs.unity3d.com/Manual/ExecutionOrder.html says ""All physics calculations and updates occur immediately after FixedUpdate."", and enemy AI is closely related to movement, `FixedUpdate()` seems to be the right place. When frame rates are high `FixedUpdate()` runs quite a lot less than `Update()`. When frame rates are low, like when loading up a save in a city exterior, `FixedUpdate()` runs more frequently, but hopefully that won't be a problem.

~In addition to `EnemyMotor`, that poster on Reddit should have also been having problems with the melee timer in `EnemyAttack`, which should both be fixed by this.~"
269382130,Deducts gold when buying spells from spellmaker,pnikpour,2019-04-11 00:27:14+00:00,2019-04-28 22:25:30+00:00,{},The current state of spellmaking allows the player to make spells for free (for testing purposes). This was deemed no longer necessary and this commit will deduct gold from the player based on the cost of the spell.
268495979,Improvements and cleanup for FaceWall,rossipaolo,2019-04-08 20:57:02+00:00,2019-04-11 23:00:48+00:00,{},
268103231,Added ObjectPositioner,rossipaolo,2019-04-07 12:29:55+00:00,2019-04-11 23:00:30+00:00,{},"Moves an object next to the nearest collider. Can be used to fix bad classic game-data positions.

![ObjectPositioner](https://user-images.githubusercontent.com/24359151/55683532-0ac5eb00-5941-11e9-9b74-0c89bce06100.png)

This is available as a component to modders. If you agree i think we can make a list of classic assets that also benefits from it."
267982087,Added .vscode/ to .gitignore,rossipaolo,2019-04-05 22:23:14+00:00,2019-04-11 23:00:09+00:00,{},
267821465,BillboardBatch: Use IDs to access shader properties,rossipaolo,2019-04-05 13:21:21+00:00,2019-04-11 22:59:58+00:00,{},
267784757,Clean up Talkmanager,Allofich,2019-04-05 11:19:29+00:00,2019-04-11 22:59:33+00:00,{},"Not a complete cleanup, but just some tidying up that should hopefully not raise any objections.

Whitespace cleanup
Merge nested if-statements
Remove empty methods
Rename reactionToPlayer variable masking same-named variable
Remove unnecessary reactionToPlayer parameter
Inline variables where possible
Remove redundant parentheses and redundant else statement
Remove redundant ""== true"" for bools"
266185723,Remove redundant parent assignments,Allofich,2019-04-01 10:42:16+00:00,2019-04-11 22:59:05+00:00,{},"Removed parent assignments when creating city guards or using the ""CreateMobile"" command, as they are now redundant because of
https://github.com/Interkarma/daggerfall-unity/commit/88644c22c1063079d811b148c26b4628b3297600"
266001083,AI improvements,Allofich,2019-03-31 09:36:25+00:00,2019-04-11 22:58:49+00:00,{},"Make sure enemies don't get stuck with ""avoidObstaclesTimer"" > 0 if they
are somehow unable to point at the detour destination.
Raise avoidObstaclesTimer a bit now since it counts down regardless of
direction enemy is pointing, but set to 0 if got close enough to target
spot. 0.3 seems like a good distance for this check.
Make enemies aim at their own height for target when searching for
target, not just when approaching seen target.
Improve RayCheckForObstacle:
- Use a CapsuleCast. This does better at detecting things in the way.
- Adjust height of rays casted for checking for slope. Should still
detect climbable stairs while not treating large, unclimbable
differences in height as climbable."
265999853,Prevent rats being walked upon,Allofich,2019-03-31 09:13:41+00:00,2019-04-11 22:58:08+00:00,{},"https://forums.dfworkshop.net/viewtopic.php?f=24&t=1425

Should prevent both rats walking on each other and player walking over them."
265962787,Spell merchant improvements,petchema,2019-03-30 19:29:08+00:00,2019-03-31 02:34:32+00:00,{},"Sort spells by alphabetic order, display spells magicka costs.

I considered greying out spells from the merchant when the magicka cost is over your MaxMagicka; That is, you cannot casts them, even when fully rested.
But greying out usually means stuff you cannot do, and you can still buy those spells, so I finally decided against it (the code is ready for such change though).

Forums: https://forums.dfworkshop.net/viewtopic.php?f=5&t=1916
"
265735213,Reworked the way to patch a BSA file after it has been loaded,df-ferital,2019-03-29 14:22:34+00:00,2019-04-11 22:57:53+00:00,{},"A simple patch system has been put in place which allows to modify any BSA file at runtime. For now, it is only used to fix models from ARCH3D.BSA.

The patch includes all previous modifications as well as a complete fix for the dungeon sewer junction mentioned here: https://forums.dfworkshop.net/viewtopic.php?f=5&t=1899#p22261

I also fixed the sewer dead end whose floor and roof textures were stretched."
265286613,Use oghmaBonusPool,Allofich,2019-03-28 11:14:06+00:00,2019-03-31 02:23:08+00:00,{},"Addresses oversight pointed out in
https://github.com/Interkarma/daggerfall-unity/commit/12fda4e458b838b7d7bb0583169875ee6e2d00f9#r32910451"
265211913,remove a missed reference to old interface icons,petchema,2019-03-28 07:14:39+00:00,2019-03-31 02:22:50+00:00,{},Seen in a stream
264296792,fix regression in PlaySource.cs,petchema,2019-03-25 21:35:29+00:00,2019-03-27 23:55:49+00:00,{},Fix regression I made in a3479c7c that made Lysandus silent :(
263920705,Apply screen weapon dye overrides for artifacts,numidium,2019-03-24 17:07:19+00:00,2019-04-05 04:31:25+00:00,{},I altered a couple of them from classic so that they match their respective paper doll images better.  Let me know if I'm out of line in doing this.
263893675,Prevent non-guard spawns while in water,Allofich,2019-03-24 10:00:02+00:00,2019-03-27 23:57:47+00:00,{},"Prevent random encounter spawns as mentioned here https://forums.dfworkshop.net/viewtopic.php?f=24&t=1918&sid=b161443d647dd3d6ddfe6e86d3b194ed.

They are also prevented in this case in classic."
263891666,Fix Skull of Corruption and Hircine Ring appearing on paper doll,Allofich,2019-03-24 09:21:28+00:00,2019-03-27 23:57:09+00:00,{},"Looks like the Skull of Corruption and Hircine Ring were appearing where they did because of their images' x and y offset values. Other items that don't show on the paper doll like rings, etc. were also drawn but just not where you could see them.

Classic only draws items on the paper doll if they are of the clothing, armor or weapon groups. Using this same check for DFU fixes the Skull of Corruption and Hircine Ring.

The Hircine Ring's x and y offsets, appearance and text description seem to indicate it was going to be a shield at some point, and the graphic still looks like one. 

Bug report: https://forums.dfworkshop.net/viewtopic.php?f=24&t=1870&p=22543#p22543"
263809367,Sanguine Rose,numidium,2019-03-23 04:42:32+00:00,2019-04-05 04:03:03+00:00,{},Adds the artifact's effect and adds the necessary flag for monsters to be allied with the player.
263398029,prevent f5 from closing level up screen,petchema,2019-03-21 20:45:31+00:00,2019-03-24 00:14:56+00:00,{},"In classic Daggerfall, one cannot exit the level up screen until all
ability bonus points have been distributed.

In Daggerfall Unity, this is true when trying to use the EXIT button or
the Escape key, but it was possible to exit the character sheet window
and distribute remaining bonus points later by pressing the character
sheet keyboard shortcut (f5 by default).

This patch closes this loophole, and factorizes some code between the
different ways to close the character sheet.

Bug tracker:
https://github.com/Interkarma/daggerfall-unity/commit/b0f6f52bd3c7d99ff7e6873e18807f6c3f29be11"
263223991,Implement Oghma Infinium and Azura's Star,Allofich,2019-03-21 12:55:21+00:00,2019-03-24 00:13:42+00:00,{},"Implements the Oghma Infinium. It was harder than I expected because there were bugs to chase down to get the correct texture and inventory behavior. (Being assigned by the data in MAGIC.DEF to the books group was interfering with these things).

I noticed problems with the leveling screen. I think they are the result of a recent commit.
https://github.com/Interkarma/daggerfall-unity/commit/b0f6f52bd3c7d99ff7e6873e18807f6c3f29be11#r32858800

Use `addArtifact 5` at the console for easy testing."
262833101,Make classic update false when game is paused,Allofich,2019-03-20 11:56:01+00:00,2019-03-24 00:10:44+00:00,{},Fixes https://forums.dfworkshop.net/viewtopic.php?f=24&t=1913&sid=e75c962cc2258a847352de0187e7caf1
262083492,Implement 2 new commands for testing AI,Allofich,2019-03-18 14:37:24+00:00,2019-03-24 00:10:24+00:00,{},"2 console commands that will be useful for working on the AI, as well as for just messing around and having fun with AI battles. Also lays some groundwork for implementing the artifact effects that involve summoning an ally.

""CreateMobile"" = type ""cm"" followed by the numerical ID of the enemy type, then the number of the mobile team to spawn it in front of you.

Ex.) cm 0 1
Creates a rat (id 0) on the ""player ally"" team (team 1, won't attack player)

All teams are hostile to all other teams. Created a new ""player enemy"" (team 0) for general use in making enemies that are all allied with each other against the player.

Issues)
1: When created, mobiles are rotated to look in the direction the player was looking, but for some reason this seems a little finicky and they will at first briefly be looking at the player, or flicker back and forth a little before they settle on looking in the correct direction. Don't know why, as it's just a one-time ""transform.LookAt"" call, but the end result is correct, so I'm okay with it since it's just a test command. Might need to figure this out for the artifact effects, though.

2: Teams are not restored when loading a saved game. They get overwritten with the default teams. Since this is just a console command for testing I think that's okay for now. Will need to be solved when implementing the artifact effects.

""ToggleAI"" = type ""tai"" to toggle between disabling and enabling all mobileEnemy AI. Doesn't affect townspeople.

P.S.
On the subject of AI (not related to this PR), the pursuit AI, such as when guards are pursuing you in town, is messed up at the moment, with them tending to go wandering in the wrong direction. I'm aware of it and working on a fix."
261711032,Immediately get NatureSet and Season for location creation,rossipaolo,2019-03-15 21:59:13+00:00,2019-03-24 00:09:45+00:00,{},Billboard trees can swap material at any time but imported 3d trees must be loaded with the correct variation during location setup.
261242646,Invert towns and homes colors on the map,df-ferital,2019-03-14 16:21:58+00:00,2019-03-24 00:09:22+00:00,{},"This inverts the color used for home and town dots on the travel map. Towns are now brown while homes are purple, as suggested by their respective button.  One other solution would have been to invert button colors but I think people are so used to them that I prefer the first solution.

IMO it is a way clearer that way.

This patch came to me after reading King of Worms mentioning this issue in classic here: https://forums.dfworkshop.net/viewtopic.php?f=12&t=1898#p22186

@Interkarma and others: I think this corrects a bug in classic but I would not mind if you don't agree."
261170845,Fix some incorrect UV coordinates within the data files,df-ferital,2019-03-14 13:36:32+00:00,2019-03-24 00:07:57+00:00,{},"This provides a starting point to patch some wrong texture UV coordinates in ARCH3D.BSA at runtime.
For now, this fixes the following problems:
- Tavern pillars like in The King's Fairy, Daggerfall
- Compressed wall texture near the entrance of a weapon store like The Count's Arsenal, Newtale, Bhoriane (@petchema)
- Stretched dungeaon corridor floor (from model index 989)"
261127651,Start target search prediction iteration from 0,Allofich,2019-03-14 11:28:25+00:00,2019-03-24 00:07:06+00:00,{},"Minor tweak. I noticed that with the recent change to AI search behavior I made, starting the search with 1 movement prediction threw them off a little and could cause them to walk into the wall when trying to pursue.

Ex)
`e` = enemy
`p` = player
`-` = wall
`|` = where enemy goes to in pursuit

Master branch:
Player went through doorway and enemy last saw him moving to the right (""right"" as seen from top-down view). By starting at prediction iteration ""1"", enemy heads to first predicted spot (based on player movement rate/direction and last known position) and goes to ""|"", hitting wall.

```
     e
      
----  -|--
         p
```

This PR:
Iteration starts from ""0"", so enemy starts with no prediction, heading to the last known player position (doorway) first. If it still can't see the player after getting there, it will then start iterating through predicted spots.

I only tested this PR briefly, but the enemy did seem better able to pursue through the door in the above situation."
261117319,Assign flags from factions.txt with |=,Allofich,2019-03-14 10:57:33+00:00,2019-03-24 00:06:44+00:00,{},"A faction can have its flags value from `FACTION.TXT` be composed by multiple ""flags"" lines, and these should all be ORed together.

Fixes https://forums.dfworkshop.net/viewtopic.php?f=24&t=1887&p=22188#p22188. I wrote a description of the problem there."
261024200,Use saving throws and implement Mehrunes Razor effect,numidium,2019-03-14 04:51:57+00:00,2019-03-14 08:13:51+00:00,{},"I noticed that saving throws weren't being used for most spells. If this is the desired behavior for now then I don't mind changing it back. Having saving throws active prevents MR from killing targets on the first hit every time.

I also altered the Wabbajack effect. It bypasses saving throws in classic so I added a flag for effects that ignore them. Added a check to prevent Wabbajack from disabling enemies that are in use by a current quest."
260409373,quest popups now reveal dialog linked talk options,Nystul-the-Magician,2019-03-12 15:17:21+00:00,2019-03-12 21:49:11+00:00,{},"fix for bug reported by forum user Ferital in this thread: https://forums.dfworkshop.net/viewtopic.php?f=24&t=1678&p=22074#p22074

dialog linked resources are now only resolved if their macro type is NameMacro1 - 
only if their true name (_person) is resolved (not other types like __person)"
259882990,name of local residences is now correctly resolved via macro expansion,Nystul-the-Magician,2019-03-11 09:10:17+00:00,2019-03-12 21:47:53+00:00,{},"fix for bug described in https://forums.dfworkshop.net/viewtopic.php?f=24&t=1611
name of residences is now correctly resolved in macro expansion"
259774107,"fix ""floating"" house labels when free scale is enabled",petchema,2019-03-10 17:08:49+00:00,2019-03-12 21:46:24+00:00,{},".x vs .y buglet

Forums: https://forums.dfworkshop.net/viewtopic.php?f=5&t=1855"
259761376,show estimated repair times,petchema,2019-03-10 13:58:34+00:00,2019-03-12 21:46:08+00:00,{},"Display estimated repair times, so you can make better informed choices as to repairing items (and when).

Calling UpdateRepairTimes(false) from Refresh() seems sufficient; Other commented calls may be removed when we become confident it is."
259751661,check that the advancing dagger is not too high or too low,petchema,2019-03-10 11:06:21+00:00,2019-03-12 21:45:41+00:00,{},"Very low AdvancementMultiplier in particular is game breaking

Forums: https://forums.dfworkshop.net/viewtopic.php?f=24&t=1882"
259748144,AI fixes,Allofich,2019-03-10 09:57:25+00:00,2019-03-12 21:45:05+00:00,{},"Distance used in decision for doing melee attack used the value
in EnemySenses, which could differ from the distance value used in
EnemyMotor. Noticeable when classic AI, which only moves as close
as necessary to attack, could stand motionless due to being close
enough to satisfy EnemyMotor to no longer advance on target, but not
satisfy EnemyAttack to due melee attack.

Also melee decision should have been to attack if <= melee range, to
match classic.

Also implemented classic's differing melee range for vs. player and vs.
AI. This was probably done because the range used against player wouldn't
look right for AI vs. AI, because the sprites wouldn't appear to be physically touching.
But I guess the longer range looked better when attacking the player (attacking the screen)

Fixes issue 2 in https://forums.dfworkshop.net/viewtopic.php?f=24&t=1859&sid=bed84458b14ebae4f57363cdf767816f."
259603032,ModSettingsEditor: Fix exception thrown when no mod is loaded,rossipaolo,2019-03-08 20:49:16+00:00,2019-03-12 21:44:13+00:00,{},
259513525,Fix most remaining texture alignment problems,df-ferital,2019-03-08 15:33:35+00:00,2019-03-12 22:41:10+00:00,{},"I spent hours (if not days) on this one...
This fixes most of the texture UV coordinates problems uncovered on the forums:

https://forums.dfworkshop.net/viewtopic.php?f=24&t=328: I removed the special case @Interkarma put several years ago for the building window since it is not needed anymore. The weapon store used for The Count's Arsenal in Newtale (@petchema) is also fixed.
https://forums.dfworkshop.net/viewtopic.php?f=28&t=1588: the dungeon room is fixed but not the tavern pillars. @petchema, could you check that the dungeon corridor streched textures you saw are corrected?

To fix this, I used in particular a previously unused and unknown field from the mesh header. It is read as an integer but from my tests, the only values it can take are 0 and 65536, so I think it should actually be an unsigned int. But as it does not really matter since I do the check against 0, I didn't change the type.

The only known remaining issues are textures coordinates for tavern pillars like the ones in The King's Fairy, Daggerfall.
"
259262429,Fix invalid access to collider on custom ladder,rossipaolo,2019-03-07 20:41:05+00:00,2019-03-12 21:41:47+00:00,{},
259255089,"Log exception thrown when failing with ""nothing of value"" message",rossipaolo,2019-03-07 20:16:24+00:00,2019-03-12 21:41:29+00:00,{},I used **LogException()** which is quite handy when testing from the editor.
258894362,Travel Map: Fixed scale of some textures,rossipaolo,2019-03-06 21:54:56+00:00,2019-03-12 21:41:13+00:00,{},
258887311,MeshReplacement: Fixes for loot containers,rossipaolo,2019-03-06 21:31:42+00:00,2019-03-12 21:40:55+00:00,{},"* Fixed positioning issue with dungeon containers.
* Fixed issue which caused custom loot gameobjects to be instantiated twice at the same position."
258709633,Address warnings,Allofich,2019-03-06 13:00:19+00:00,2019-03-12 21:40:34+00:00,{},"Addressed the following warnings on startup:

1. Unused variable warnings. A lot of these showed up recently. These are commented out now.
2. Inconsistent line-ending warnings (mixture of Windows and UNIX). Some files had a few Windows-style line endings, and one file (`DaggerfallAutomapWindow.cs`) had mostly Windows-style line endings. These were made to have UNIX-style endings as the rest of the project does.
3. `ExteriorAutomap` looked for non-existent layer ""ExteriorAutomap"", issued a warning that erroneously said it couldn't find layer ""Automap"", then defaulted to layer 10, which actually is ""Automap"". Fixed to just look for ""Automap"" from the start.

Another warning that appears on startup if you start from `DaggerfallUnityStartup.unity` is ```Could not locate TextManager GameObject instance in scene!``` However it causes no problem. If you look at the trace, DaggerfallUI.Awake creates a DaggerfallInventoryWindow, which then tries to access the TextManager instance, which doesn't exist yet. The warning message is issued, then a TextManager instance is created and returned, so execution continues normally.

Seems like either the warning is incorrect and should be removed, or the order of execution should be changed so that a TextManager instance is created before any attempt to access the instance is made (as is the case in `DaggerfallUnityGame.unity`, which shows no warning). I'll leave it to how you would like to handle, Interkarma.

Also, I think there in general may be too many log messages at startup, for things like potion recipes, etc. They could bury warning messages and make them go unnoticed. Seems to me like those types of messages should be removed for any game mechanic that isn't under active development, but I'll leave the call to you."
257843821,Wabbajack,numidium,2019-03-04 07:53:00+00:00,2019-03-12 21:39:07+00:00,{},Implements Wabbajack's special effect and also adds a helper method for implementing artifact effects in the future.
257753531,fix shoplifting messages keys,petchema,2019-03-03 17:45:27+00:00,2019-03-12 21:38:34+00:00,{},Forums: https://forums.dfworkshop.net/viewtopic.php?f=5&t=1856&p=21577
257751428,fix typo in A0C00Y17 quest,petchema,2019-03-03 17:13:57+00:00,2019-03-12 21:38:12+00:00,{},Forums: https://forums.dfworkshop.net/viewtopic.php?f=5&t=1856
257748574,spellbook cleanup,petchema,2019-03-03 16:30:29+00:00,2019-03-12 21:37:53+00:00,{},"Put all the logic to display information about current spell (or nothing if none can be selected) to UpdateSelection()

Forums: https://forums.dfworkshop.net/viewtopic.php?f=24&t=1860"
257711163,Re-instantiate class creator when starting over,numidium,2019-03-03 04:19:55+00:00,2019-03-12 21:37:29+00:00,{},Resets the class creator to its original state when restarting character creation. Prevents bugs associated with persisting class creator window.
257700293,hide icons in empty spellbooks,petchema,2019-03-02 23:41:24+00:00,2019-03-03 01:48:09+00:00,{},"Cosmetic fix: currently when you open an empty spellbook, the different icons appear as black empty spaces, which does not look good (specially on a nicely modded spellbook background).

Simply remove the icons altogether in this case.

Forums: https://forums.dfworkshop.net/viewtopic.php?f=5&p=21577#p21577"
257408401,Prevent arrows from colliding more than once,Allofich,2019-03-01 11:19:04+00:00,2019-03-01 22:55:19+00:00,{},"With the latest code I noticed an exception when `AssignBowDamageToTarget` in `DaggerfallMissile.cs` tried to use the destroyed arrow gameObject in `attack.BowDamage(goModel.transform.forward);`.

I assumed that `DoCollision()` would only run once for arrows but it sometimes happens more than once. Now `DoCollision()` will only run once for arrows.

I don't know if spells are supposed to run `DoCollision()` more than once, but they do. Can you confirm, @Interkarma?"
255622287,Implement strafing for enhanced combat AI,Allofich,2019-02-23 16:01:00+00:00,2019-03-02 23:06:28+00:00,{},"Adds strafing to enhanced combat AI. I've tried to keep it somewhat subtle, so that it will look good and not too game-like. Used in both melee and ranged combat.

Also, this addresses an issue with enemies turning their back to their opponent too much in combat due to trying to path around an obstacle when backing up. Although it looked kind of good like they were ""running away"" after being backed against a wall it happened a bit too much and would only be appropriate for a weaker or more cowardly combatant, not for all cases. They can now get out of this situation by strafing, which allows them to keep facing their opponent."
255609585,random Random.Range() fixes,petchema,2019-02-23 11:55:15+00:00,2019-03-02 22:57:12+00:00,{},"Upper bound is exclusive for Random.Range(int, int), leading to a few off-by-one bugs.
Solution is often to increase upper bound by one, in a few place Random.Range(float, float) is used instead.
There's an obvious but mild risk of introducing or uncovering bugs, even if I tried to be careful and started testing those changes.

Also refacto (separate commit): as was the case in some places already, when the code really means to use an inclusive upper bound, rewrite as Random.random(lowerbound, upperbound + 1) even if upperbound + 1 is a constant.
Any compiler worth its salt will optimize that away, and it conveys programmers intent better.
"
255178568,"notebook page to log onscreen messages (popup, middle screen)",petchema,2019-02-21 20:55:11+00:00,2019-03-02 22:40:36+00:00,{},"This is just a log of recent onscreen messages; The number of messages is bounded, and they are not persisted. The goal is just to provide a way to read messages that went by too fast.

Any way to get a more dense display?
Once text density is fixed, it would be great to set the maximum number of messages to exactly one screen, or to open the messages log to the last page.
"
255142174,highlight recently increased skills,petchema,2019-02-21 18:53:48+00:00,2019-03-02 22:34:44+00:00,{},"When opening the character sheet, highlight all the skills that have
increased since the last time you opened the character sheet.

Exclude character sheet opening automatically triggered by level ups.

Forums: https://forums.dfworkshop.net/viewtopic.php?f=5&t=1834"
254818187,Prevent paying repair price several times,petchema,2019-02-20 22:27:18+00:00,2019-02-28 22:24:44+00:00,{},"cost only takes into account items that are not already being repaired
Forums: https://forums.dfworkshop.net/viewtopic.php?f=24&t=1828

If they're only already repaired items in the remote list, test L721 does not prevent a display a ""it will cost 0 gold"" trade window in you click on REPAIR button. The same situation happens with identification, so this test could be improved, but I don't understand that code well enough.

Also, I don't understand how repair price seems correct in game (equal to ""cost"", as computed by UpdateCostAndGold()), when the deduced amount L765 is the value of GetTradePrice() that does not handle the case windowMode == WindowModes.Repair
"
254278549,EnemySenses fixes and cleanup,Allofich,2019-02-19 14:40:09+00:00,2019-02-28 22:24:15+00:00,{},"Minor fixes and cleanup for `EnemySenses`. With enhanced combat on, enemies will now acquire a secondary target that they will switch to if the primary dies, to eliminate them standing still and looking foolish because they had ""tunnel vision"" and only focused on one target, ignoring everyone else around them. Now they will appear to have a little better situational awareness, since they will switch to another target immediately if they saw it while pursuing the primary target.

I had meant for a more basic version of this feature to already exist, but it wasn't working correctly. This replaces it.

List of fixes:

`lastTarget` was being used inconsistently. Created a new `targetLastUpdate`
variable for tracking whether current target is the same as last update.
`lastTarget` renamed to `secondaryTarget` and holds a secondary target the
AI can switch to if the current one dies, if enhanced combatAI is on.
Fixed `wouldBeSpawnedInClassic` being reset to false every update making only spawn distance values, never despawn values, be used for checking if enemies are in the classic existence range.
Lower frequency of target searches. Not necessary to do so frequently,
and a small delay may be better anyway because of the fade-in time when loading a saved game made while in combat.
If target is player, re-use `toPlayer` sight check results.
Move code using results of player LOS check to after check in execution order,
rather than coming later due to being conditioned on slower classic
update timing, for readability."
254198819,Mod settings: use InvariantCulture for serialization,rossipaolo,2019-02-19 10:34:34+00:00,2019-02-28 22:23:36+00:00,{},
254078834,Use cleaner solution to list picker item count issue,numidium,2019-02-19 00:25:14+00:00,2019-02-28 22:23:18+00:00,{},"Per @petchema 's suggestion, using handy constructor parameters that I previously didn't notice."
253928591,Make arrows use colliders for hit checks,Allofich,2019-02-18 14:07:52+00:00,2019-02-28 22:22:50+00:00,{},"Combined with https://github.com/Interkarma/daggerfall-unity/pull/1195, this fixes the other issue in https://forums.dfworkshop.net/viewtopic.php?f=24&t=1751 (about the bats).

1. Use colliders instead of ray casts for arrows.
- Enemies pushed around (""Jedi reflexes"" of the bug report) less
- Shooting enemies at point-blank range will register hits better now (will still go through them if they are right next to you, but that doesn't bother me too much as it is unrealistic to shoot from that close anyway)
- Maybe a little better performance?, since instead of doing raycasts the collider that existed on the arrows is used.
- Maybe more reliable hit detection, although the ray-cast solution seemed to be working for me except at point-blank ranges.

2. Moved arrow disabling and damage to be called immediately on collision instead of in the update loop
- Together with the above, seems to have (possibly) fixed completely the issue of enemies being pushed by the arrow

3. Can no longer bash doors with arrows, as it didn't make much sense"
253911836,Make enemy height change only temporary,Allofich,2019-02-18 13:17:17+00:00,2019-02-28 22:21:15+00:00,{},"The changes I made to enemy collider height to allow them to fit through doors caused an issue where the upper part of the enemy would no longer respond to collisions such as arrows or clicking on them for the ""You see a %s"" message. The taller the enemy the more noticeable the problem would be. It was particularly noticeable with dreughs.

The only solution that came to mind is an imperfect one, but better than what we have currently. That is to only temporarily change collider height for half a second when an enemy brushes up against something. It will then return to normal if after the half-second the enemy is no longer touching anything.

This fixes the dreugh part of
https://forums.dfworkshop.net/viewtopic.php?f=24&t=1751"
253614562,fix 2 typos in tutorial,petchema,2019-02-16 02:46:24+00:00,2019-02-17 22:14:30+00:00,{},
252900476,popup text smooth scrolling,petchema,2019-02-14 00:45:25+00:00,2019-02-17 22:21:42+00:00,{},Make popup text scroll up smoothly instead of line by line; The text stays easily readable while being removed from screen.
252869223,display letters of credit values in inventory lists,petchema,2019-02-13 22:22:21+00:00,2019-02-14 00:12:09+00:00,{},"This make letters of credit stand out compared to normal letters and recipes.
Since letters of credit management is automated, this is otherwise of little practical usefulness.

Forums: https://forums.dfworkshop.net/viewtopic.php?f=5&p=21119#p21119"
252860559,warn the player when paid with a letter of credit,petchema,2019-02-13 21:52:06+00:00,2019-02-17 22:14:08+00:00,{},"Players not familiar with the concept can be very confused
Forums: https://forums.dfworkshop.net/viewtopic.php?f=5&p=21119#p21119"
252565802,Adjust listbox row count for small font,numidium,2019-02-13 05:24:36+00:00,2019-02-17 22:13:13+00:00,{},Addresses the bug described in https://forums.dfworkshop.net/viewtopic.php?f=24&t=1792
252530837,Travel map update,Lypyl,2019-02-13 01:27:37+00:00,2019-03-24 00:06:31+00:00,{},"Minor bug fixes and functional improvements to the travel map & travel pop up window.

Travel popup window now shows travel option toggles correctly regardless of aspect ratio.  

Corrected a bug that was causing the find location routine from breaking the at button in the region view.  

The location list picker should now only displays locations known to the player.

Changed scrolling mode while zoomed in to be a toggle on/off."
252441677,warn the player before taking back an item not fully repaired,petchema,2019-02-12 19:27:39+00:00,2019-02-28 22:17:09+00:00,{},"Some people seem so used to instantaneous repairs that they get their items back before they're repaired; A warning seems appropriate.
Forums: https://forums.dfworkshop.net/viewtopic.php?f=5&t=1765&p=21086#p21086"
251886310,Implement addArtifact command,Allofich,2019-02-11 11:52:35+00:00,2019-02-17 22:00:58+00:00,{},"Implements an ""addArtifact"" command that can be used at the console to add any of the game's artifacts to the player's inventory.
Ex. ""addArtifact 0"" adds the artifact of ID 0, the Masque of Clavicus Vile

The reason is to help in implementing and testing artifact effects.

Also fixed a few issues with the existing function to create artifacts.
"
251763749,Fix guild expulsion to match classic.,ajrb,2019-02-10 20:33:40+00:00,2019-02-17 22:00:28+00:00,{},
251441288,Use a single timer for classic update simulation,Allofich,2019-02-08 11:59:25+00:00,2019-02-17 22:00:06+00:00,{},"Combines all the classic timer updating I had put into separate files into a single timer in GameManager, since only one is needed.

If GameManager isn't where you would want this, I can move it somewhere else.

Should merge cleanly with https://github.com/Interkarma/daggerfall-unity/pull/1184."
251121160,Clean up EnemyMotor,Allofich,2019-02-07 13:48:58+00:00,2019-02-17 21:59:14+00:00,{},"EnemyMotor, although generally working okay, had become somewhat of a mess as I've been adding and changing bits of it. I went back over the code execution and made several small cleanups, fixes and a few optimizations.

Fix up MakeEnemyHostileToAttacker()
Simplify rotating check
Use more accurate variable names
Don't do bow or spell attack checks when not available
Remove pointless variable assignments
Remove pointless normalizations
Remove pointless move() call
Move clockwiseCheck reset to FindDetour() so it's only done when needed
Correct assumed spell projectile speed
Use do-while loop in FindDetour so operations done in correct order
Fall check assumes obstacle check was just done, so do before fall check
Use wider angle for detecting doors to open so AI can open them more
easily"
250222204,Reset guild memberships and region reps upon becoming vamp,ajrb,2019-02-04 22:32:58+00:00,2019-02-10 15:54:19+00:00,{},"Also changed it so quests only get offered after completing initiation quest.

Sorry it took me so long to get around to this - penny hadn't dropped that it was ready.

I don't usually do this, but these changes are pretty simple and I'm tired so I've done zero testing. Need to figure out how to test this. Putting it up here in case someone else fancies testing it for me. (@petchema or @Interkarma) I will do it when I get a chance, but work has been quite intense recently so it's hard to predict when."
249904944,give more time for sound loops to load,petchema,2019-02-03 21:24:13+00:00,2019-02-07 00:55:28+00:00,{},"Modded loops can be heavier than sound effects to load, and we don't care as much that they start right on time;
So increase the time limit for playing them (hopefully 2s is plenty; I prefer some timeout to no timeout)
Forums: https://forums.dfworkshop.net/viewtopic.php?f=24&t=1776"
249878018,TextureReplacement: Support for FMAPXXXX.IMG,rossipaolo,2019-02-03 13:38:07+00:00,2019-02-17 21:57:00+00:00,{},"![2019 02 03-14 11_01](https://user-images.githubusercontent.com/24359151/52177431-e6268900-27c0-11e9-86a4-103b1772a8fd.png)
"
249730244,TextureReplacement: Support for TRAV0I00.IMG,rossipaolo,2019-02-01 20:44:37+00:00,2019-02-02 23:56:48+00:00,{},"![2019 02 01-21 07_04](https://user-images.githubusercontent.com/24359151/52147812-24f4fb80-2668-11e9-8c2b-70c86056cf24.png)

@Interkarma @Lypyl are you ok with this change? I moved the region overlay to its own panel to draw it above the map texture at any resolution. I think we will also need to allow high resolution overlays but the default one should be available as a fallback. It might even look fine as is with texture filter. Should i link it to `Settings.GUIFilterMode`?
"
249411701,Asset injection improvements,rossipaolo,2019-01-31 21:43:49+00:00,2019-02-02 23:57:50+00:00,{},
249404758, Fix temples selling spells to non-members ,ajrb,2019-01-31 21:18:39+00:00,2019-02-02 23:59:37+00:00,{},
249070696,don't freeze when you have no usable magic item,petchema,2019-01-30 23:49:52+00:00,2019-02-02 23:58:32+00:00,{},Forums: https://forums.dfworkshop.net/viewtopic.php?f=24&t=1755
248785262,Update to Mod Builder Window,Lypyl,2019-01-30 08:29:54+00:00,2019-02-02 23:46:54+00:00,{},"Added compression option selection,  collect dependencies button and improved appearance.  Also removed legacy code no longer used by the mod system."
248299466,Make journal notebook dialog boxes more compact (supercedes #1174),ajrb,2019-01-28 21:50:16+00:00,2019-01-29 20:58:11+00:00,{},"@petchema Sorry I didn't like the changes you made, so this PR is the way I would like to change it instead and supercedes #1174. I hope you don't mind, I mean no disrespect - your contributions are very valuable.

Anyway, you definitely demonstrated that I'm bloody awful at getting around to stuff I don't personally care about... :embarrassed: I honestly had meant to get around to this.. at some point before the heat death of the universe.

Anyway I've tested at 320x200 and up, but your feedback is welcome."
247964280,Compact notebook messageboxes,petchema,2019-01-27 16:23:48+00:00,2019-01-29 01:24:42+00:00,{},"Current fast-travel from notebook message box is very large, and requires high resolution to fix in the screen (i think 1280x720 is already too small, eg https://www.youtube.com/watch?v=1k0G_VEv-DM&t=769 ):
- both location and region names are in the same text line;
- the explanation that it won't fast-travel immediately is also very lengthy.

This patch puts location name and region name on two separate lines, and replaces the explanation with a different wording which should be (I hope) sufficient.
I'm not sure text wrapping would be preferable. Wording can be discussed.

I also removed one blank line from notebook edition message boxen."
247960594,do not always count pacified NPCs toward enemies,petchema,2019-01-27 15:25:16+00:00,2019-02-02 23:45:00+00:00,{},"Allows for fast travel, sleeping,... when only pacified NPCs are around

Forums: https://forums.dfworkshop.net/viewtopic.php?f=24&t=1752"
247926529,don't make sure the player has a spellbook,petchema,2019-01-27 01:58:38+00:00,2019-02-02 23:43:31+00:00,{},Forums: https://forums.dfworkshop.net/viewtopic.php?f=24&t=1738
247923439,Fix sky blind spot,petchema,2019-01-27 00:30:59+00:00,2019-02-02 23:31:48+00:00,{},"Forums: https://forums.dfworkshop.net/viewtopic.php?p=19983#p19983
The root issue seems to be that transform.eulerAngles.y can become slightly negative (not by much, I've seen up to -0,000563718)."
247921251,Prevent wagon access from inside dungeons during identification,petchema,2019-01-26 23:36:43+00:00,2019-02-02 23:32:23+00:00,{},Forums: https://forums.dfworkshop.net/viewtopic.php?f=24&t=1756
247914398,TextureReplacement: Support for Height Map,rossipaolo,2019-01-26 21:12:22+00:00,2019-01-29 20:55:09+00:00,{},This PR adds support for heightmaps as requested on forums. I used the name Height instead of Parallax because this is what's used for the inspector and Unity docs.
247911682,grey out unavailable spells in spellbook,petchema,2019-01-26 20:19:35+00:00,2019-02-02 23:25:45+00:00,{},"Grey out spells that require more magicka than currently available.

Colors are already used a lot in spells list (selection, highlight), so this can become only half satisfying.
I'm open to suggestions.
"
247911545,add tooltips to spellbook's spell icons,petchema,2019-01-26 20:17:14+00:00,2019-02-02 23:21:37+00:00,{},Explain spell icons in spellbook
247901271,Fix logic error,Allofich,2019-01-26 17:15:15+00:00,2019-01-29 20:54:14+00:00,{},Incorrect parentheses in my recent PR for enemy attacks. Could cause an exception when senses was null.
247900534,Improve AI pursuit,Allofich,2019-01-26 17:02:15+00:00,2019-02-02 23:20:11+00:00,{},"1. Adjusted enemy controller height limit down to 1.65f. I had to limit it to this for the enemy thief in Privateer's Hold to really be able to get through the doorway every time without hitching up for a second .

2. Fixed problem with enemies refusing to follow player down staircase corridors because the obstacle check would see the sloping wall in front of them as an obstacle and they would stop moving downwards.

3. Enemies will only try to get to Occasionally I saw enemies wandering off down a wall looking for a way to get to me. Also they would often not follow the player well around corners due to the prediction logic. They now use the last place they saw their target if they don't have a clear path to the predicted spot, which addresses both of these."
247889268,Non-quest classic rumor implementation,Allofich,2019-01-26 13:24:43+00:00,2019-02-02 23:18:22+00:00,{},"Features:
1. Imports non-quest rumors from classic, including their time limit, flags, etc. Quest rumors are not imported since this is pointless unless we also import quest status from classic saves.
Note that due to a mistake in classic (which I've mentioned before), non-quest rumors are very rarely updated in classic and you will often not have any in saved games where you have progressed in the game. You can be guaranteed to have non-quest rumors for import if you make a new character, for about the first game month until the rumors expire.

2. Non-quest rumors now have time limits, the same as those in classic. They last for about a month.

3. Flag data from classic data recreated. This has things set up for signboard messages, whenever clicking on signboards becomes supported.

4. Non-quest rumors are now created for the various background events that occur, same as classic. Several of these are signboard messages and can't be seen yet.

5. Some simplification and correction to macro resolution for rumors. Rumors store the relevant factions and region IDs at the time of their creation in classic, and this is recreated now.

6. Some rumors that are always created on every background events update in classic (about witches, daedra, vampires, thieves guild and dark brotherhood, artifacts, etc.) and were probably supposed to always be available, are created now.

When you first load a saved game, you may have to first do some fast traveling and get the background events update to fire before the new non-quest rumors are generated. Until then NPCs will just say ""I try not to spread rumors"", etc. This should only be an issue until new rumors are generated."
247432148,Update terrain using Unity jobs system,ajrb,2019-01-24 18:28:20+00:00,2019-02-02 23:09:39+00:00,{},"Presented so you can see what the changes are that will be made if this code is merged into mainline master code. The dual code path branch is still availiable at: https://github.com/ajrb/daggerfall-unity/tree/UpdateTerrain-Jobs so the original and new code results can be compared by switching UseJobSystem flag on streaming world.

See https://forums.dfworkshop.net/viewtopic.php?f=20&t=1710 for more discussions.
"
247122969,TextureReplacement: disable emission maps on non-emissive lights,rossipaolo,2019-01-23 21:32:13+00:00,2019-01-23 22:52:00+00:00,{},"The light archive contains emissive and non emissive textures. If we want to allow replacing individual textures, we need to load the atlas and override only the imported textures. This includes the emission atlas."
247068580,Fixes for ImportedComponentAttribute,rossipaolo,2019-01-23 18:18:59+00:00,2019-01-23 22:51:37+00:00,{},"* Fixed an issue where serialized data was unnecessarily created for prefab children.
* Added a null check for parent components when children need to be deserialized."
246125188,Initial implementation of custom doors for buildings,rossipaolo,2019-01-20 18:09:24+00:00,2019-02-17 21:56:27+00:00,{},"A pretty basic implementation, but should allow people interested in this field to experiment a bit with towns modding."
246055142,Match dialogue reactions close to classic,Allofich,2019-01-19 16:02:33+00:00,2019-01-23 22:46:07+00:00,{},"Although https://forums.dfworkshop.net/viewtopic.php?f=24&t=1500 seems that it may have already been fixed by numidum3rd, this also should fix it. It also implements formula and tallying of skill for etiquette and streetwise in dialogue, addresses some TODOs about when responses are used, and compacts the code significantly by cutting out unnecessary things and implementing directly as classic does.

Daggerfall Unity was using a single reaction value for dialogue, but classic calculates two different reactions. First there is a reaction when clicking an NPC that determines if the NPC will talk to you, and the initial greeting they give you, which is affected by the biography reaction roll. This one was basically already working right, and uses values like -20 through 30, with 0 being default.

For deciding the tone that NPCs answer the player and whether they refuse to give info or not, though, a separate value is calculated that is either 0 (dislike player, refuse info), 1 (neutral) or 2 (like player). This is affected by personality, speech tone (etiquette or streetwise), and type of question asked.

It is kind of strange how it's divided like this, with different factors influencing it, but at least it should fix the issue. We could always improve or have some alternate method of determining reaction to the player, but if we do so I think we should try to get classic's behavior in there and work on top of that."
246038669,Fix quest filtering to not apply rep unless minReq is >=10,ajrb,2019-01-19 10:17:13+00:00,2019-01-23 22:42:29+00:00,{},
246038046,Account for frost daedra melee hit frame,Allofich,2019-01-19 10:02:43+00:00,2019-01-23 22:41:53+00:00,{},"Fix for https://forums.dfworkshop.net/viewtopic.php?f=24&t=1720&sid=39928d1297b723ceeefe6d27d6644408.

I wasn't getting an exception but I was getting the messed up aspect ratio, and noticed what the problem was. The frost daedra is unique in having an attack animation sequence that starts with the hit frame. When I set up the animation sequences that I got from the original .ANC files, I used ""-1"" to represent the hit frame (in the actual .ANC files it's the sequence `02 01 00` for a melee animation's hit frame and `02 02 00` for a bow animation's frame to release the arrow). I account for the ""-1"" value in `AnimateEnemy()` (which in this case will initiate a melee hit and then skips over to the next value in the frame sequence) but in the setup where `UpdateOrientation()` is called, the value of ""-1"" was just used as it was and the program tried to access out of the animation range."
246033916,Match enemy melee detection to classic,Allofich,2019-01-19 08:25:40+00:00,2019-01-23 22:39:38+00:00,{},"For https://forums.dfworkshop.net/viewtopic.php?f=24&t=1531. (I'm going to say, fixes it)

Did this in 3 steps.

1. Matched enemy hit registration calculation to classic. Before you could be hit as long as you were in the enemy FOV, so essentially in a 180 degree arc. Now you have to be in about a 70 degree arc, same as classic (unless enemy is right on top of you (= less than .25f distance), then it hits regardless. This is also matched to classic)

2. After doing the above, I noticed that enemies still initiated the melee animation based on target being in the 180 degree arc. Now they do so with a 45 degree arc, same as classic. (The actual hit registration happens with a 70 degree arc as mentioned above)

3. After doing both of the above, I noticed that enemies pursuing the player could end up really close to the screen and would stay there (This became more evident, because they would no longer initiate an attack while close to the player and outside of the 45 degree arc, and would instead continue approaching the player) . They would get very close because they pursue based on the target's predicted location and use that predicted spot for the distance calculation, which will be behind the player or beside the player if the player is backing up, going sideways, etc. as I was in testing. At first I fixed this by using the actual distance to the target, and this worked to stop them from getting so close, but I wondered why enemies hadn't backed up when too close even though I already had a mechanism for this in EnemyMotor for some time now. I found that the existing mechanism was requiring the enemy to be excessively close before making the enemy back up, so I decided to instead fix this issue by starting back up behavior from a little farther away. This was a simpler fix and I also kind of like the effect of pursuing enemy's getting up in the screen and then backing up a step or two if you stop moving and they have gotten too close to you. Classic AI mode doesn't predict target location or do any backing up so it should be unaffected."
245735065,Rain and thunder,petchema,2019-01-18 05:46:37+00:00,2019-02-02 23:06:39+00:00,{},"Allows ambient sound effects and ambient sound loops to play at the same time.

Main issue I have with that code is that I needed to duplicate some of DaggerfallAudioSource features (to work correctly with modded sounds), so it'd better be factorized at some point...

(Lost a lot of time because the compiler was silently failing (Monodevelop added ""using System"" that made ""Random."" ambiguous) so I kept running the last version of the game that compiled, not understanding why my changes had no effect :( )"
245723890,Missed changed in new Spell Icons interface,Alyndiar,2019-01-18 04:16:02+00:00,2019-01-18 04:43:13+00:00,{},"The LoadPackIcons method is using the wrong variable for number of icons to load. Error shows as blank icons for all icons in the icon pack that exceed the number of icons in the classic icon pack. 
Changed the loop to use pack.IconCount instead of SpellIconCount"
245644821,Make town population textures from areas with 'MountainWoods' climate value match classic,df-ferital,2019-01-17 21:04:18+00:00,2019-01-18 20:50:06+00:00,{},"In classic, areas under climate value equal or above 230 (MountainWoods) use Breton race and names for town people.
This fixes DFU to match classic.
Actually, another difference with classic I couldn't fix yet is that town people names should not be generated according to climate values. E.g. in classic, Dragontail people use Nord textures (climate value 226, Mountain) with Redguard names, whereas Wrothgarian people (same climate value) use Nord textures with Breton names."
244970802,TextureReplacement: fix scale of TVRN00I0.IMG,rossipaolo,2019-01-15 23:14:54+00:00,2019-01-17 09:07:31+00:00,{},
244873037,Fix prev. target overriding non-hostile mode,Allofich,2019-01-15 17:15:10+00:00,2019-01-17 09:07:15+00:00,{},"Fixes https://forums.dfworkshop.net/viewtopic.php?f=24&t=1714&sid=93d4628dc960c2d72d6fa9689c231a6a.

Thanks Hazelnut and Pango for noticing it."
244735831,Optimise LayoutNatureBillboards loop,ajrb,2019-01-15 10:03:38+00:00,2019-01-18 20:42:32+00:00,{},"Only a tiny improvement but still worthwhile since it iterates a large number of times.
Also tidied the checks code in mesh replacement."
244298107,refacto: simplify control keys check in stack splitting,petchema,2019-01-13 19:02:07+00:00,2019-01-14 23:13:31+00:00,{},"Learned some Unity, nothing fancy"
244296093,Optimise applying climate settings for locations and asset injection checks,ajrb,2019-01-13 18:23:37+00:00,2019-01-14 23:12:57+00:00,{},"1)
If not yielding across frames, only apply climate settings once dfLocation is completely initialised instead of for every block. This needs to be verified as logically correct before merging. I'm pretty sure that it can be moved but I don't have a deep enough understanding of this code to be absolutely sure

Also improved layout times diagnostics.

This optimisation almost halves the time it takes to construct a city location when exiting buildings after loading an interior save. I stumbled across it when analysing the exterior world code to see how it might have parallelisation applied. 

2)
Only check for assets to be injected once by keeping a record of tried assets. This halves the time taken to layout terrain because of the sheer number (hundreds of thousands) of them. Most players will have asset injection switched on, and I think it's okay to check each asset once only.

Also I added a command to clear the cache of asset names, although you don't appear to be able to change assets and have them loaded by Unity without restarting the game so not sure it's particularly useful.

"
244154085,Fixes for tavern resting and selling horse& cart,ajrb,2019-01-11 21:27:09+00:00,2019-01-12 21:27:16+00:00,{},"Tavern resting when loading inside and when member of fighters guild.
Selling horse & cart is now prevented as intended."
243898499,Changes to SpellIconCollection for more and better icons,Alyndiar,2019-01-11 03:18:46+00:00,2019-01-14 08:39:29+00:00,{},"Modified GetSpellIcon method to allow for more than 69 icons
Modified LoadSpellTargetAndElementIcons method to calculate target and element icon sizes based on atlas size instead of hardcoding. May need more changes to allow for compressed textures as this atlas is currently forced to load as an ARGB32 texture. I need a little help to ensure that the current functions used to extract the icons for target and element are correct since the are different from those used in the spell icons extraction portion."
243846915,reuse CheckLocationDiscovered to allow notebook fast travel,petchema,2019-01-10 22:08:40+00:00,2019-01-11 23:12:13+00:00,{},"#1084 made notebook fast travel checks too strict, for instance not allowing to fast travel to a town you didn't visit before.
Forums: https://forums.dfworkshop.net/viewtopic.php?f=28&t=1578&p=19594#p19575
This patch reuses DaggerfallTravelMapWindow.CheckLocationDiscovered(), I hope that's the right thing to do.
"
243316591, optimization: GenerateSamples function now computes heights in several threads,Nystul-the-Magician,2019-01-09 12:30:16+00:00,2019-01-14 23:08:31+00:00,{},
242969189,Fix order of male robes vs. cloaks,Allofich,2019-01-08 13:07:29+00:00,2019-01-08 22:04:43+00:00,{},"Fixes https://forums.dfworkshop.net/viewtopic.php?f=24&t=1458.

The issue only existed for male robes with cloaks. For females the robes have a draw order value of 80 vs. 90 for the cloaks, but for males they are both 90. It seems like a minor oversight in the original data, so the best fix seemed to just be to correct the values in `ItemTemplates.txt.`

As for why it works in classic, I believe it's because in classic the items are effectively drawn by two orderings, the `drawOrder` value but also the `EquipSlot`, with smaller `EquipSlot` value items being drawn in front of items with larger `EquipSlot` values if the `drawOrder` of the two items is the same.

Modifying `PaperDoll.cs` from

```
            // Sort equipped items by draw order
            List<DaggerfallUnityItem> orderedItems = equippedItems.OrderBy(o => o.drawOrder).ToList();
```

to

```
            // Sort equipped items by equip slot and draw order
            List<DaggerfallUnityItem> orderedItems = equippedItems.OrderByDescending(o => o.EquipSlot)
                                                    .ThenBy(o => o.drawOrder).ToList();
```

fixes the robe vs. cloak issue. However, it also causes double cloaks to be drawn backwards (with the second-equipped cloak in front of the first, rather than the first in front as in classic and current master), so additional tinkering would probably be needed there. I think the cloaks work as they do in classic because the second-equipped cloak would be the larger-value slot `Cloak2` (16) compared to the first cloak, `Cloak1` (14), and as I said above items with a larger `EquipSlot` seem to be drawn behind items with smaller `EquipSlot` values if their `drawOrder` is the same.

It's possible that classic may just have coincidentally worked for the male robe + cloak combination, which hid the problem in the item template data. It's probably better to just fix the item templates.

Also fixed a description for an item flag in classic item records. That value is not just for edged weapons, but for all one-handed weapons.
"
242693035,Texture replacement: allow readonly flag for loose files,rossipaolo,2019-01-07 15:32:09+00:00,2019-01-08 07:55:32+00:00,{},This PR allows to specify readonly flag for individual textures used by UI when image data is imported from loose files. We have no control over asset bundles so this is still up to mod authors.
242527125,Use correct format for ICON00I0.IMG when compression is enabled,rossipaolo,2019-01-07 00:08:15+00:00,2019-01-08 07:54:32+00:00,{},"See discussion for  #1139.

I also disabled mipmaps, is this ok?"
242518675,fix item info panel discrepancy for stacks,petchema,2019-01-06 21:34:25+00:00,2019-01-08 07:53:12+00:00,{},"When describing a stack, weight is the total weight of the stack, but the price is unitary price; that's not consistent.
It can be fixed in several ways, that patch uses total price."
242515939,Spell icons modding fix (RFC),petchema,2019-01-06 20:39:52+00:00,2019-01-07 07:02:29+00:00,{},"This is a hack so that spell icons can be modded.
But more than anything this is a call for a cleaner fix.
Forums: https://forums.dfworkshop.net/viewtopic.php?f=22&t=1698#p19359"
242491066,Account for change in center of collider after height adjustment,Allofich,2019-01-06 12:13:31+00:00,2019-01-08 22:03:36+00:00,{},"https://github.com/Interkarma/daggerfall-unity/pull/1120 caused a problem because the adjusted center of the collider interfered with a few calculations that used transform.position and colliders. Specifically, I noticed a Thief and an Orc were no longer able to see each other to fight and would simply stand there looking at each other.

The change in center of the collider is now accounted for.

Also, I found that the player's collider is height 1.78. Enemies now use this value as well. I confirmed the Thief in Privateer's Hold can fit through the door with this value."
242490934,AI uses last target after current one dies + cleanup,Allofich,2019-01-06 12:10:22+00:00,2019-01-08 07:50:53+00:00,{},"New functionality is that AI will now switch to its last combat target if the current one dies. This addresses the following situation I noticed during testing:

1) Enemy A follows me into room with Enemy B
2) Enemy A switches target to Enemy B, kills it with back turned to me
3) Enemy A now stands there without target. Looks stupid because it should remember me, who it was pursuing mere seconds ago.

Also, moved the storage of enemy target from DaggerfallEntityBehaviour to EnemySenses, which is mainly what uses it. The previous combat target was already stored in EnemySenses."
242486327,Stop enemies attacking magically-concealed target,Allofich,2019-01-06 10:12:37+00:00,2019-01-08 07:50:17+00:00,{},"Fixes these problems:

- Melee attack completely ignored magical concealment, so enemies would still do a melee attack if you got close to them

- Ranged attacks and spells would still happen regardless of magical concealment as long as the enemy's ""give up timer"" for pursuing the target had not run out yet. If an enemy could see you (priming the give up timer to maximum), and you then cast Invisibility (can no longer see you so give up timer starts to run out), they would still do these attacks for the next several seconds until the timer reached 0."
242438251,fog color in interiors and dungeons is now black,Nystul-the-Magician,2019-01-05 12:39:42+00:00,2019-01-08 07:49:57+00:00,{},
242419945,Bash exterior doors,numidium,2019-01-05 04:32:36+00:00,2019-01-08 07:49:43+00:00,{},Currently uses the best open chance to determine a successful bash.  I used the same formula regardless of whether the door is locked since unlocked doors aren't automatically kicked open on the first try in classic.
242213415,Remove unused variable,Allofich,2019-01-04 09:37:14+00:00,2019-01-08 07:48:47+00:00,{},"https://github.com/Interkarma/daggerfall-unity/pull/1127 added an unused variable, making a warning come up in the Unity editor."
241957006,fix for issue with classic savegame import and exterior automap,Nystul-the-Magician,2019-01-03 10:34:59+00:00,2019-01-04 01:58:05+00:00,{},described in https://forums.dfworkshop.net/viewtopic.php?f=24&p=19244#p19244)
241953486,"interior/dungeon fog is now independent of weather, savegame restore mechanism fix",Nystul-the-Magician,2019-01-03 10:20:20+00:00,2019-01-04 01:42:23+00:00,{},"interior/dungeon fog is now independent of outdoor weather
fog from save games should be now restored correctly"
241640158,Fix problems with AI movement prediction,Allofich,2019-01-01 16:01:03+00:00,2019-01-03 00:15:09+00:00,{},"Fixes to AI movement prediction:
- Due to recent AI PR(s), AI weren't using prediction anymore when they didn't have LOS to the target
- Because of not accounting correctly for the lead on movement prediction (based on time to intercept the target), the iterative prediction when target isn't seen would make bogus predictions
- Enemies stop if their prediction takes them too far, helps with the issue of enemies wandering off during combat.
- Some cleanup"
241624458,Match armor dye colors to classic,Allofich,2019-01-01 09:14:56+00:00,2019-01-03 00:14:33+00:00,{},"Fixes the second part of https://forums.dfworkshop.net/viewtopic.php?f=24&t=1660&sid=5ee3de52dcc231329e59ee68733ff5e8

DF Unity was using ""Steel"" dye as the default, unchanged, color, but classic uses ""Silver"" dye. This is used for both leather and classic. Removed the LeatherHelm fix as it's no longer necessary.

Also, DF Unity displayed Silver and Elven dyes as the same color (both as Silver), but Elven is different. Elven/Silver items from existing DF Unity saves will still appear as Silver. Also, the Orcish dye differed from classic. Any intentional changes?

Color comparisons attached. Left = master branch. Right = this PR (same as classic)

Leather
![leather](https://user-images.githubusercontent.com/19624336/50571559-00033380-0df1-11e9-829e-8d2ca2b6079e.jpg)

Elven
![elven](https://user-images.githubusercontent.com/19624336/50571561-072a4180-0df1-11e9-9c0c-98ca5222d71e.jpg)

Orcish
![orcish](https://user-images.githubusercontent.com/19624336/50571565-21fcb600-0df1-11e9-944b-5cc6da4087e7.jpg)
"
241621225,Fix chain greaves graphic,Allofich,2019-01-01 07:24:37+00:00,2019-01-03 00:10:23+00:00,{},"Fixes first part of https://forums.dfworkshop.net/viewtopic.php?f=24&t=1660&sid=5ee3de52dcc231329e59ee68733ff5e8.

The issue is that chain greaves use greaves variant 6, but the `TotalVariants` gotten from `ItemTemplates.txt` is 6, and in `DaggerfallUnityItem.cs` the below code modifies the variant to 5:

```
        /// <summary>
        /// Sets current variant and clamps within valid range.
        /// </summary>
        void SetCurrentVariant(int variant)
        {
            if (variant < 0)
                currentVariant = 0;
            else if (variant >= TotalVariants)
                currentVariant = TotalVariants - 1;
            else
                currentVariant = variant;
        }
```

The reason why it works in classic, is that classic does not use the item templates data for armor variants, it only uses it for clothes variants. Armor variants are hard-coded. Changing the `(variant >= TotalVariants)` check to only apply to clothing also fixes this issue, but it might cause a problem elsewhere so I thought upping the greaves variant count by 1 was a safer and nicer-looking solution. Other than greaves all of the classic item template data for armor variants is correct anyway."
241613214,Fix NPCs to use parent factions for dialogue,Allofich,2019-01-01 02:06:33+00:00,2019-01-03 00:10:01+00:00,{},"Fixes https://forums.dfworkshop.net/viewtopic.php?f=24&t=1683.

The problem was the NPC in question is of the Order of the Lamp faction, which has a gguild of 10, or knightly order. The code would then try to look up a knightly order with the building faction of 40 (Mages Guild) and throw an exception.

When opening dialogue, for NPCs of a faction that is not of type 2, 7, or 9, classic will iterate up through their parents until it finds one that is of these factions (if there is one) and use that faction instead. With this behavior replicated, the NPC in the bug report will now use the parent faction of Mages Guild and give a Mages Guild greeting like in classic."
241487430,Fix going to prison for 0-day sentences,Allofich,2018-12-30 11:50:06+00:00,2019-01-03 00:08:47+00:00,{},Fixes https://forums.dfworkshop.net/viewtopic.php?f=24&t=1654&sid=0f15b83fe6a93233f16a469d58675e9e
241055274,Make NPC reaction rolls semi-random,numidium,2018-12-27 01:03:35+00:00,2019-01-03 00:08:15+00:00,{},"Addresses issue discussed in https://forums.dfworkshop.net/viewtopic.php?f=24&t=1500&start=10
Adds a random number (0-15 inclusive) to the reaction rating so that not all NPCs will refuse to give info if the base reaction number is below zero."
241006707,Minor tutorial content fixes,petchema,2018-12-26 16:40:42+00:00,2019-01-02 23:33:08+00:00,{},"The goal is to adjust the tutorial content to be less confusing and more
helpful for new (DFU) players:
- remove references to icons-based interface, cursor movements mode and
save slots;
- mention WASD, quicksaving/quickloading and controls customization.

I tried to keep the changes minimal to preserve the classic experience.
Pace will probably be too slow for 80% of even new players, but I didn't change it
either."
240989934,Make timers range upper bound exclusive,petchema,2018-12-26 14:33:38+00:00,2018-12-27 00:26:18+00:00,{},"This fixes tutorial delays
Bug report: https://forums.dfworkshop.net/viewtopic.php?f=24&t=1655"
240898321,"also set ""random name"" button visibility during Setup()",petchema,2018-12-26 00:25:23+00:00,2019-01-02 23:26:30+00:00,{},"... otherwise it seems to be visible for all races.
(I wonder if that's some kind of Unity regression or if that bug has always been around)"
240822324,Changes alignment for mod list & add Obsolete attribute,Lypyl,2018-12-25 02:12:02+00:00,2019-01-02 23:12:09+00:00,{},"Changing alignment from center to left for the mod list as requested on the forum.  

Also marks idfmod_serializable & SetupPrefabHelper() as obsolete so they can be removed in the future."
240689084,Adjust large colliders to fit through doors,Allofich,2018-12-23 16:06:59+00:00,2019-01-02 23:11:52+00:00,{},"Fixes https://forums.dfworkshop.net/viewtopic.php?f=24&t=329.

I just got this through trial and error, but it doesn't seem to cause any problems."
240683058,Fix enemies bouncing down inclines,Allofich,2018-12-23 13:51:30+00:00,2019-01-02 23:11:24+00:00,{},"This fixes the issue of enemies bouncing down inclines, which has existed for a long time. (I was sure I had made a bug report for it on the forums, but I can't find it now). This problem was also visually exacerbated by my recent AI update, since I put AI on hold while falling, so enemies could be bouncing down stairs while not even facing at the player, since their AI won't update while falling to turn toward the player.

I switched land-based enemies to use Move() with a downward element, similar to the player, rather than SimpleMove().

Also, for some reason, the SimpleMove(Vector3.zero) that I have been using for gravity sometimes will never get a mobile to have controller.isGrounded be true, and a mobile can get stuck.

I managed to fix this by comparing against the transform.position of the last frame and only aborting the rest of the AI update if the AI is actually being moved by SimpleMove(Vector3.zero) (i.e., is actually falling, and not just stuck). If the AI update is allowed to continue then a Move() will be attempted and the AI will get unstuck. Kind of hacky, but it works and its the best I could come up after lots of trial and error.

Also made sure knockback takes effect even if an enemy is hit while falling."
240680435,Only give vampire quests once initiation quest is finished,ajrb,2018-12-23 12:51:22+00:00,2019-01-02 23:10:56+00:00,{},NOTE: Untested.
240664261,Fixes missing streaming world locations,Lypyl,2018-12-23 04:09:03+00:00,2018-12-23 05:35:26+00:00,{},"
Relevant bug reports:

https://forums.dfworkshop.net/viewtopic.php?f=24&t=1628

https://forums.dfworkshop.net/viewtopic.php?f=24&t=1645

Issue occurs when terrain objects become pooled & their locations are cleaned up. Because updateLocation was being set to false the locations were not being recreated."
240658978,Add racial bonuses to character history popup,numidium,2018-12-23 00:12:02+00:00,2018-12-23 00:34:31+00:00,{},If my understanding of the RaceTemplate class is correct then this should include bonuses from being a vampire or lycanthrope.
240655126,Enable importing player owned ships from classic,ajrb,2018-12-22 21:55:31+00:00,2018-12-23 00:29:32+00:00,{},"Just the ship, not the contents."
240645327,Spellbook improvements,petchema,2018-12-22 17:23:44+00:00,2019-01-02 23:07:18+00:00,{},"Implements Up and Down buttons to rearrange spells, Sort button switching between alphabetic and increasing magicka cost orders, and spell renaming.
Forums: https://forums.dfworkshop.net/viewtopic.php?f=27&t=1168&start=230#p18576

They're still issues with scrolling not following selection when the list of spells grows longer than one screen, so this can be considered WIP (I'm not sure how to best implement that)
"
240623913,Guard improvements,Allofich,2018-12-22 08:37:11+00:00,2018-12-29 08:39:47+00:00,{},Fix for https://forums.dfworkshop.net/viewtopic.php?f=24&t=1637
240588214,Quest dispensing update,ajrb,2018-12-21 22:11:42+00:00,2018-12-23 00:30:39+00:00,{},"- Updated quest dispensing to follow updated rules on UESP (confirmed by Allofich the binary wizard) with a unavoidable change to quest list schema. This will break existing quest packs, so I will work with Jay to ensure his stuff isn't broken for too long.
- Kept the reputation based dispensing for mods, 10+ rep but without any wildcarding
- Adult quests are restricted if player nudity is turned off (nearest thing to childguard)
- Updated the code for vampire quests
- Tracks one time quest acceptance"
240523745,Adjust light source range and light height,ajrb,2018-12-21 16:44:57+00:00,2018-12-22 23:36:09+00:00,{},Still refining this feature. Feedback welcome. Largest issue is dungeons with large rooms and moving platforms. There's no way to see what's going on if ambient light is very low. (<0.2) But I suppose that's teh users error.
240474118,Add use magic items list picker,ajrb,2018-12-21 13:28:46+00:00,2018-12-22 23:35:09+00:00,{},"Using standard list picker window rather than implementing the small list from the old banner UI mode. I think this is better, and less work since it's reusing the existing component. We can revisit if there are many who want the UI as classic for this."
240292881,Fix casting spells with no spellbook,ajrb,2018-12-20 20:29:46+00:00,2018-12-20 22:55:40+00:00,{},Fixes: https://forums.dfworkshop.net/viewtopic.php?f=28&p=18606
240250859,Asset injection cleanup,rossipaolo,2018-12-20 17:42:29+00:00,2018-12-20 22:50:51+00:00,{},
240237818,Enable potion recipe use in potion maker,ajrb,2018-12-20 16:56:02+00:00,2018-12-20 22:50:03+00:00,{},Also updated all effects to have a static public effect key. I think I got them all.
240172345,ImportedComponentAttribute: ignore invalid components,rossipaolo,2018-12-20 13:34:31+00:00,2018-12-20 22:50:32+00:00,{},
240148329,Stop pending holiday text if location changes,Allofich,2018-12-20 12:06:35+00:00,2018-12-20 12:18:22+00:00,{},Fixes https://forums.dfworkshop.net/viewtopic.php?f=24&t=1630.
240132880,Add null check for dfLocation,Allofich,2018-12-20 11:09:30+00:00,2018-12-20 11:59:58+00:00,{},"Fixes https://forums.dfworkshop.net/viewtopic.php?f=24&t=1617.

Looks like the problem was that if you went far enough away from town and the current dfLocation became null, there would be a null reference."
240129364,Match triggered spell shot origin to classic,Allofich,2018-12-20 10:57:24+00:00,2018-12-20 12:00:26+00:00,{},"Implements what I mentioned here:
https://github.com/Interkarma/daggerfall-unity/commit/164d88312d6048f3be073094f1e8771fa3767329

I tested Direnni Tower and the spell seems to be coming from the same position as classic now."
239960326,TextureReplacement: Import textures for BillboardBatch atlas from mods ,rossipaolo,2018-12-19 20:10:50+00:00,2018-12-20 04:43:05+00:00,{},
239944549,Potions initial implementation,ajrb,2018-12-19 19:11:11+00:00,2018-12-20 04:42:45+00:00,{},"- All classic potions can be mixed.
- All classic potions can be drunk and the effects work.
- Failed potions are not created and a new message is displayed. (change from classic)
- We need to decide whether to restrict random potions in loot. Should they be restricted to classic ones only? I have a function for all and another for classic only - one could be used for mixing and purchasing, with the classic one used for loot. Opinions?
- Also added removeOne function to item collection which decrements stack and only removed item object when reaches 0. Please use it going forward where appropriate. Ta.
- Need to discuss mechanism for mult-effect potions @Interkarma - see the review comments.
"
239425641,"new experimental ini file setting ""TerrainHeightmapPixelError"" introduced",Nystul-the-Magician,2018-12-18 09:55:24+00:00,2018-12-20 04:37:53+00:00,{},"new experimental ini file setting ""TerrainHeightmapPixelError"" introduced
this setting can be used to prevent inaccuracies with location placement on terrain - lower values are better, 1 is best
default is 5 (as before) but we can try to lower it to 1"
239395313,hopefully fixes the issues with vanilla skybox for other weather types than sunny,Nystul-the-Magician,2018-12-18 08:00:23+00:00,2018-12-18 08:38:46+00:00,{},"introduced bool excludeSkybox to FogSettings struct
dfunity vanilla skybox should now work for all weather types"
239372356,Use DaggerfallAudioSource during race choice,petchema,2018-12-18 05:52:44+00:00,2018-12-18 05:57:56+00:00,{},"AudioSource don't handle asynchronous loading of modded sounds
https://forums.dfworkshop.net/viewtopic.php?f=14&p=18441#p18441"
239166319,"Identify classic vampire data, vampire quests",Allofich,2018-12-17 14:37:01+00:00,2018-12-20 23:37:08+00:00,{},"This provides functionality/information for vampire mechanics from classic. Interkarma, please feel free to refactor anything you like, or if this can't merge cleanly with local WIP code you have, just use it as a reference or something.

What's in here:

- Identify and import 3 vampire-related data pieces from classic saves.
1) Last time that need to kill was satiated
2) Vampire clan
3) Whether or not initial vampire quest has been initiated

This data is not serialized in PlayerEntity yet. 1) and 2) are commented out in PlayerEntity, but 3) is used for the quest logic.

- Uncommented Vampire race and temporarily using Breton graphics, to allow for opening classic vampire saves to aid in testing against classic.

(Note that if you load a classic vampire, they will gain several levels because their skill bonuses are imported as if they are the real skill levels. Classic temporarily undoes vampire/werecreature skill bonuses when calculating skill advances/level ups, then reapplies them. This is something we'll need to handle when importing classic vampires)

- Run vampire quests the same as classic + bug fixes.
Non-cure quests can appear every 38 days, as I think they were supposed to, instead of every 266 days which I think is how often they can happen in classic. This has been noted in a comment in PlayerEntity for a while now. Cure quests can appear every 84 days, same as classic. Quests can occur at the same chances as in classic. The initial quest only happens once, unlike classic. (If it's possible to re-become a vampire after being cured, probably the initial quest should happen again, haven't done that yet)

The initial quest and cure quest are always the same, but there are also other quests. Unfortunately, I've never touched the quest code in DF Unity before, so I'm not sure how to handle selecting a quest through it. I put together a simple function that calls one of the quests, but it's hard-coded. I'm sure we'll want to move that. Werecreatures only have the cure quest, and I put that in as well, commented out.

BTW, I think the current quest selection incorrectly treats the 4th and 5th characters of a quest name as the required faction reputation to get that quest. Actually the 4th char is either a level requirement or a rank requirement. The char's ASCII value - 48 is compared to the level/rank. (As I did in the function I added for the vampire quests).

Rank requirement:
Fighters Guild
Dark Brotherhood
Temple
Thieves Guild

Level requirement:
Knightly Order
Mages Guild
Royalty
Coven
Merchant
Vampire

The only purpose I know of the 5th char is that if it is 'X' or 'Y' it will not be selected when ChildGard is on. Ones with 'X' all either have Daedra Seducers or Harpies in them (maybe harpies had or were planned for a more explicit graphic before?). No classic quests use 'Y'.

Examples:
N0B40Y07 = Mages Guild, available to level 4 and higher.
O0B2XY04 = Thieves Guild quest that can have a daedra seducer. Censored in ChildGard mode.
"
238963967,fixed fog settings (WeatherManager class related),Nystul-the-Magician,2018-12-16 12:45:01+00:00,2018-12-18 05:57:12+00:00,{},"- WeatherManager class uses different fog settings for different weather types now (fog mode, density, etc. stored per weather type now)
- ""set_weather 3"" now works again"
238938576,TextureReplacement: Improvements for FPSWeapon,rossipaolo,2018-12-15 23:51:49+00:00,2018-12-18 05:55:42+00:00,{},"* Mirror texture rect when required.
* Use texture key instead of string for dictionary."
238933392,"Fix exception using ""Copy to logbook"" with no message selected",petchema,2018-12-15 21:30:40+00:00,2018-12-18 05:54:58+00:00,{},"Found that one because of clicks going thru (https://forums.dfworkshop.net/viewtopic.php?f=24&t=1153) but anybody can just click on the ""copy to log"" button and trigger it, too
When the talk window is closed, the whole interface freezes and the game must be killed

ArgumentOutOfRangeException: Argument is out of range.
Parameter name: index
  at System.Collections.Generic.List`1[DaggerfallWorkshop.Game.UserInterface.ListBox+ListItem].get_Item (Int32 index) [0x00000] in <filename unknown>:0
  at DaggerfallWorkshop.Game.UserInterface.ListBox.GetItem (Int32 index) [0x00000] in <filename unknown>:0
  at DaggerfallWorkshop.Game.UserInterface.DaggerfallTalkWindow.OnPop () [0x00000] in <filename unknown>:0
  at DaggerfallWorkshop.Game.UserInterface.UserInterfaceManager.RemoveWindow () [0x00000] in <filename unknown>:0
  at DaggerfallWorkshop.Game.UserInterface.UserInterfaceManager.PopWindow () [0x00000] in <filename unknown>:0
  at DaggerfallWorkshop.Game.UserInterface.UserInterfaceWindow.CloseWindow () [0x00000] in <filename unknown>:0
  at DaggerfallWorkshop.Game.UserInterface.DaggerfallTalkWindow.ButtonGoodbye_OnMouseClick (DaggerfallWorkshop.Game.UserInterface.BaseScreenComponent sender, Vector2 position) [0x00000] in <filename unknown>:0
  at (wrapper delegate-invoke) DaggerfallWorkshop.Game.UserInterface.BaseScreenComponent/OnMouseClickHandler:invoke_void__this___BaseScreenComponent_Vector2 (DaggerfallWorkshop.Game.UserInterface.BaseScreenComponent,UnityEngine.Vector2)
  at DaggerfallWorkshop.Game.UserInterface.BaseScreenComponent.MouseClick (Vector2 clickPosition) [0x00000] in <filename unknown>:0
  at DaggerfallWorkshop.Game.UserInterface.BaseScreenComponent.Update () [0x00000] in <filename unknown>:0
  at DaggerfallWorkshop.Game.UserInterface.Panel.Update () [0x00000] in <filename unknown>:0
  at DaggerfallWorkshop.Game.UserInterface.Button.Update () [0x00000] in <filename unknown>:0
  at DaggerfallWorkshop.Game.UserInterface.Panel.Update () [0x00000] in <filename unknown>:0
  at DaggerfallWorkshop.Game.UserInterface.Panel.Update () [0x00000] in <filename unknown>:0
  at DaggerfallWorkshop.Game.UserInterface.Panel.Update () [0x00000] in <filename unknown>:0
  at DaggerfallWorkshop.Game.UserInterface.UserInterfaceWindow.Update () [0x00000] in <filename unknown>:0
  at DaggerfallWorkshop.Game.UserInterfaceWindows.DaggerfallBaseWindow.Update () [0x00000] in <filename unknown>:0
  at DaggerfallWorkshop.Game.UserInterfaceWindows.DaggerfallPopupWindow.Update () [0x00000] in <filename unknown>:0
  at DaggerfallWorkshop.Game.UserInterface.DaggerfallTalkWindow.Update () [0x00000] in <filename unknown>:0
  at DaggerfallWorkshop.Game.DaggerfallUI.Update () [0x00000] in <filename unknown>:0"
238917225,"Updates RDBLayout to recognize models with the ""NEW"" tag as action doors",Lypyl,2018-12-15 15:33:11+00:00,2018-12-18 05:54:41+00:00,{},"Models 55007, 55024, 55018 have this tag and always seem to be action doors. 

There are 2 doors (55007) in Orsinium that also have rotation actions which causes them to operate strangely - original Daggerfall has the same problem.

Relevant bug report:

https://forums.dfworkshop.net/viewtopic.php?f=24&t=1597"
238898334,add mousewheel support to books,petchema,2018-12-15 08:13:54+00:00,2018-12-18 05:52:57+00:00,{},They were jealous
238894739,Only flash crosshair twice after selecting a location,numidium,2018-12-15 06:37:30+00:00,2018-12-18 05:52:35+00:00,{},In classic the yes/no popup which shows on the travel map does not wait for the full four flashes of the crosshair to appear. This change makes the travel UI faster and closer to classic.
238893636,Delay inventory scroll down,petchema,2018-12-15 06:07:09+00:00,2018-12-18 05:52:09+00:00,{},"Bottom items are shifted up when an item is removed from a list; But if the end of list is displayed, the whole list can also at the same time be scrolled down, which can become confusing, specially with enhanced lists.
This patch disables scrolling while removing items from enhanced lists; Scrolling is updated when the mouse pointer is moved away from the list.
They're no doubt ergonomic tradeoffs with that kind of change, so this is just a proposal"
238893318,Page by page scrolling using scrollbar's trough,petchema,2018-12-15 05:58:31+00:00,2018-12-18 05:51:31+00:00,{},"It could be a matter of taste, but it makes troughs provide an additional and
useful feature compared to scroll buttons."
238891884,fix IndexOutOfRangeException in inventory,petchema,2018-12-15 05:14:54+00:00,2018-12-18 05:51:00+00:00,{},"Sometimes made items blink when scrolling lists because the list was only partially refreshed (Draw() interrupted half way by the exception; This was self healing few frames later when animationFrame was back in valid range hence the flickering).

IndexOutOfRangeException: Array index is out of range.
  at DaggerfallWorkshop.Game.UserInterface.BaseScreenComponent.Draw ()
[0x00000] in <filename unknown>:0
  at DaggerfallWorkshop.Game.UserInterface.Panel.Draw () [0x00000] in
<filename unknown>:0
  at DaggerfallWorkshop.Game.UserInterface.Panel.Draw () [0x00000] in
<filename unknown>:0
  at DaggerfallWorkshop.Game.UserInterface.Button.Draw () [0x00000] in
<filename unknown>:0
  at DaggerfallWorkshop.Game.UserInterface.Panel.Draw () [0x00000] in
<filename unknown>:0
  at DaggerfallWorkshop.Game.UserInterface.Panel.Draw () [0x00000] in
<filename unknown>:0
  at DaggerfallWorkshop.Game.UserInterface.Panel.Draw () [0x00000] in
<filename unknown>:0
  at DaggerfallWorkshop.Game.UserInterface.Panel.Draw () [0x00000] in
<filename unknown>:0
  at DaggerfallWorkshop.Game.UserInterface.UserInterfaceWindow.Draw ()
[0x00000] in <filename unknown>:0
  at
DaggerfallWorkshop.Game.UserInterfaceWindows.DaggerfallBaseWindow.Draw
() [0x00000] in <filename unknown>:0
  at
DaggerfallWorkshop.Game.UserInterfaceWindows.DaggerfallPopupWindow.Draw
() [0x00000] in <filename unknown>:0
  at DaggerfallWorkshop.Game.DaggerfallUI.OnGUI () [0x00000] in
<filename unknown>:0"
238754075,Fix premature closing of message boxes in live builds,ajrb,2018-12-14 15:20:47+00:00,2018-12-14 22:23:13+00:00,{},Would like this backported to 0.5 otherwise players using the 0.5 stable build will not see any messages for guild promotions at all.
238546290,Merging 0.6 to master,Interkarma,2018-12-13 22:00:24+00:00,2018-12-13 22:01:42+00:00,{},I'm happy with where 0.5 stable is at right now. Time to start breaking stuff again. :)
238176496,Fix for arrows with material set when it should not be,ajrb,2018-12-12 20:45:31+00:00,2018-12-13 04:30:54+00:00,{},See https://forums.dfworkshop.net/viewtopic.php?f=24&t=1532
238139628,Fix trying to find undiscovered locations from notebook,ajrb,2018-12-12 18:35:10+00:00,2018-12-13 04:30:23+00:00,{},"Fixes issue raised in https://forums.dfworkshop.net/viewtopic.php?f=24&t=1578
"
237906672,LoadID collision fix for dungeons with repeating blocks,Lypyl,2018-12-12 04:09:50+00:00,2018-12-13 04:29:35+00:00,{},Currently in dungeons that have the same block 3 or more times will have colliding LoadIDs that result in some objects not being serialized for saving.  An example dungeon with this problem is The House of Baron Garulaus in Daggerfall.  This change simply increments the LoadID until it's unique.
237867043,Repairing items takes time,ajrb,2018-12-11 23:49:16+00:00,2018-12-13 04:28:02+00:00,{},"* Implements classic behaviour
* Utilised the OtherItems collection of PlayerEntity for items left for repair. Not sure what this was intended for, but it can still be used for other purposes as the repair items are filtered before being displayed to player.
* Settings option to switch back to instant repairs
* Note added to notebook for each item left for repair
* Moved remaining strings into DaggerfallUI.txt for localisation"
237851007,Update 0.6 to current master,Interkarma,2018-12-11 22:35:28+00:00,2018-12-11 22:37:04+00:00,{},
237493340,factorize capacity computations,petchema,2018-12-10 22:50:11+00:00,2018-12-11 20:54:04+00:00,{},"Factorize capacity computations (player carry capacity, wagon hold
capacity, gold dropping into wagon), using floats to avoid rounding down
bugs.
Code that makes horse, wagon and arrows weightless was also factorized.

Gold dropping message was left as-is to preserve Daggerfall classic
behavior; However, when dropping gold into wagon, a post capacity check
was added: if the wagon cannot accomodate the amount, only the gold that
fits is dropped and a message is displayed.

Bug report https://forums.dfworkshop.net/viewtopic.php?f=24&t=1587

I found another bug while factorizing: gold weight was counted twice in
wagon, because it was handled with a special case when the common case
was sufficient."
237481873,Update 0.6 to current master,Interkarma,2018-12-10 22:03:53+00:00,2018-12-10 22:04:04+00:00,{},
237141143,Fix importing classic save startingLevelUpSum,Allofich,2018-12-09 16:30:54+00:00,2018-12-10 21:41:06+00:00,{},"Classic save import has been incorrectly importing the startingLevelUpSum since
https://github.com/Interkarma/daggerfall-unity/commit/222c142625b37cb42d96d2c485461fa39da469ca,
messing up the leveling of imported characters. This should fix it."
237119843,Don't show lock messages for AI,Allofich,2018-12-09 09:46:33+00:00,2018-12-09 13:40:18+00:00,{},Messages would show when AI tried to open a locked door.
237099818,TextureReplacement: Support for spell casting animations,rossipaolo,2018-12-09 00:27:09+00:00,2018-12-10 21:40:10+00:00,{},
237097960,Add ability to add activations to models by registering custom actions,ajrb,2018-12-08 23:36:29+00:00,2018-12-10 22:02:28+00:00,{},"Also adds ability to ignore an allocated room for resting in bed clicked on.

See https://forums.dfworkshop.net/viewtopic.php?f=22&t=1581 for more discussion."
237093027,Calculate book values like classic,ajrb,2018-12-08 21:41:28+00:00,2018-12-10 21:39:28+00:00,{},"Also added book replacement check to the item MCP for author. I considered moving this check inside BookFile class so it didn't need to be done in every place the class is used, but there may be a good reason this wasn't done so I chose to leave it alone."
237077988, Do not use atlas for MobilePersonBillboard imported textures ,rossipaolo,2018-12-08 16:49:55+00:00,2018-12-10 21:36:30+00:00,{},
237075701,Loose objects cleanup fix,petchema,2018-12-08 16:05:47+00:00,2018-12-10 21:33:56+00:00,{},"Not sure it's the final word on that problem, but there's a bug in
CollectLooseObjects() because it uses RemoveAt(i) in a for loop, so if
two consecutive items need to be removed the second will be missed
because RemoveAt(i) will have shifted it down

Bug report https://forums.dfworkshop.net/viewtopic.php?f=28&p=18052#p18051"
237056247,fix afternoon billboards shadows,petchema,2018-12-08 08:58:22+00:00,2018-12-10 21:33:22+00:00,{},"Fixes afternoon billboards shadows, could it be that simple?
Bug report https://forums.dfworkshop.net/viewtopic.php?f=24&t=653"
236868222,Adjust running skill tally rate,Allofich,2018-12-07 13:29:09+00:00,2018-12-10 21:28:44+00:00,{},"Discussed in https://forums.dfworkshop.net/viewtopic.php?f=4&t=1296.

In general, I think we should try to avoid changing game content for things like rebalancing purposes, but the running skill tallies so quickly that it seems like it may actually be a bug or oversight (maybe even a DOSBox timing emulation issue or something). The tally in classic happens at the same rate as the main game update loop. Midknightprince there says all of his characters are at 100 running. My character from a regular playthrough of classic also has 100 running (no other skills maxed out), even though I didn't try to get it.

A suggestion on the forum of 1/4 the current rate seemed fine when I gave it a quick test."
236749888,Update 0.6 to current master,Interkarma,2018-12-07 04:12:54+00:00,2018-12-07 04:13:03+00:00,{},
236356543,Fix spurious horse sound in TediousTravel mod,petchema,2018-12-05 23:18:52+00:00,2018-12-06 22:58:55+00:00,{},"Bug introduced by 60d083e
See https://forums.dfworkshop.net/viewtopic.php?f=27&t=1293&p=17954#p17954"
235300324,Adds travel map settings to save state & sets travel map settings from load data,Lypyl,2018-12-03 00:51:28+00:00,2018-12-07 04:11:06+00:00,{},https://forums.dfworkshop.net/viewtopic.php?f=24&p=17866#p17866
235258480,Stop climbing when paralyzed,petchema,2018-12-02 13:19:46+00:00,2018-12-02 19:41:26+00:00,{},"Bug report https://forums.dfworkshop.net/viewtopic.php?f=24&t=1452

Tested to work, however I'm no motor specialist :) Please review"
235234604,Vital indicators fixes,petchema,2018-12-02 03:17:10+00:00,2018-12-06 23:01:49+00:00,{},"This patch fixes:
- reflecting relative health decrease when max health increase after a level up;
- gauges sometimes staying stuck with some highlighted change until stat really changes.

It detect, handle and propagate resets (discontinuities).
Standard code flow can then handle the continuous, normal case.

I checked that HUDVitals receives reset events correctly, other
VitalChangeDetector listeners may benefit from handling reset events
too."
235228023,Persist EnableModernConversationStyleInTalkWindow setting,petchema,2018-12-02 00:15:35+00:00,2018-12-07 04:10:18+00:00,{},Bug report https://forums.dfworkshop.net/viewtopic.php?f=24&t=1339
235225869,Close spell merchant interface upon spell double-click only,petchema,2018-12-01 23:28:24+00:00,2018-12-06 23:10:24+00:00,{},"Bug report https://forums.dfworkshop.net/viewtopic.php?f=24&t=1375

It seems classic behavior has not been consistent between releases or something; But it matches the version I used, what I've seen in several streams, seems useful and it looks more consistent with other shops.

The patch is short but I'm not confident in my UI understanding, so please review."
235186301,fix debuff blinking bug,petchema,2018-12-01 10:53:33+00:00,2018-12-06 23:00:39+00:00,{},"Fix attempt (947acf6) was necessary but not sufficient;
AlignIcons() must also make use of spells' poolIndex

Bug report
https://forums.dfworkshop.net/viewtopic.php?f=24&t=1517&p=17434"
235185837,Limits console output string from growing too large for TextMesh,Lypyl,2018-12-01 10:43:12+00:00,2018-12-06 23:11:02+00:00,{},"Bug report:

https://forums.dfworkshop.net/viewtopic.php?f=24&t=1544"
235132941,Fix bugs with lightsources,ajrb,2018-11-30 22:22:34+00:00,2018-12-06 23:06:57+00:00,{},
234959738,Make guard spawning closer to classic,Allofich,2018-11-30 11:38:25+00:00,2018-12-10 21:26:22+00:00,{},"Fixes https://forums.dfworkshop.net/viewtopic.php?f=24&t=1549.

This also makes guard spawning closer to classic. Now guards will be spawned from NPC locations out of player view with a 1/4 chance for each NPC, or the previous behavior if no such NPCs are found. Distances, chances, etc. are the same as classic.

Also implements non-immediate guard spawning from classic, which happens when guards appear for a low reputation player or banished player (and for werecreatures). LOS is needed from an NPC, then after a short countdown guards will appear."
234662780,Don't allow aquatic enemies to spawn out of water,Allofich,2018-11-29 14:42:25+00:00,2018-12-06 23:09:47+00:00,{},"Fixes https://forums.dfworkshop.net/viewtopic.php?f=24&t=1515.

The problem was that this particular slaughterfish is a fixed enemy, and no check was done in DF Unity for fixed enemies spawning out of water, only for random enemies.
Classic doesn't allow any aquatic enemies to spawn out of water, regardless if they are fixed or random."
234627543,Fix out-of-range exception when talking to NPCs,Allofich,2018-11-29 12:56:25+00:00,2018-12-07 04:09:54+00:00,{},"Was getting an exception when talking to guild NPCs, who had sGroup of 7. There was already a check, but it was not on the same value used for accessing the array, so the exception wasn't being stopped."
234563629,introduced param raisePromoteTerrainEvent in function PromoteTerrainData,Nystul-the-Magician,2018-11-29 09:27:07+00:00,2018-11-30 08:57:08+00:00,{},"default always true
with raisePromoteTerrainEvent set to false function can be called without raising the PromoteTerrainEvent - needed for mod to prevent a bug/issue related to event raising and consumption in different mods
discussed here: https://forums.dfworkshop.net/viewtopic.php?f=20&t=1554&p=17765#p17765"
234252728,Cleanup PlayerActivate.cs,Allofich,2018-11-28 12:07:47+00:00,2018-12-10 21:24:11+00:00,{},"Simple cleanup, no bug fixes.

Remove unused using statements
Add contributor
Match values in .cs file to those set in Unity editor
Merge if statements
Remove redundant return statement
Fix local variables hiding parameters
Simplify boolean returns
Clean up whitespace
Remove unneeded namespace references
Remove unused ActivateDistance value
Make all distance values consistently Unity values, instead of mixture of unity and classic values
Don't override ray distance value in code
Clarify comment"
234236691,"DaggerfallMissile cleanup, fix arrow spawn",Allofich,2018-11-28 11:12:07+00:00,2018-12-06 23:16:17+00:00,{},"Generally fixes the remaining issue for https://forums.dfworkshop.net/viewtopic.php?f=24&t=1235 of the arrows shot at extreme angles not looking like they come from the right spot. If you look completely up or down (probably very rare) it's still slightly off, but I think maybe that's an issue/limitation of the main camera or something as that is what I am using for positioning the arrow spawn now (rather than the player location).

Arrows do hit at extreme angles so that part of the bug report is not an issue, and I think it can be closed.

Also did a light cleanup of DaggerfallMissile.cs.

Add contributor
Add end of file newline
Fix variable shadowing
Remove whitespace
Remove unneeded boolean

Fix arrows to look correct when shot by player"
234098638,Arrive from expected direction after fast travelling,petchema,2018-11-27 23:35:11+00:00,2018-12-06 22:58:31+00:00,{},"Player can be relocated ""to a random marker"" in 6 cases:
- when entering/exiting buildings and dungeons;
- after fast travel;
- when going from/to ship;
- when teleported;
- when expelled by court;
- using ""location"" console command.

This patch implements start coordinates saving, and selection of facing
based on those coordinates as a new RelocationMethod; And then use this
method for fast travel case only.

There's some comment near entering/leaving buildings
(PlayerEnterExit.Respawner) that suggests that the closest start marker
should be chosen, but it's unclear if this new RelocationMethod could
help."
233718803,Updates TweenToStart & TweenToEnd methods in DaggerfallAction,Lypyl,2018-11-26 22:32:44+00:00,2018-12-06 22:49:24+00:00,{},Previously these methods were using the class member Duration instead of the function parameter duration for tweening.
233543523, fixed bug with fog settings being changed by UnderwaterFog script breaking mods,Nystul-the-Magician,2018-11-26 12:39:15+00:00,2018-12-06 22:46:04+00:00,{},"underwater fog script no longer changes fog settings when outside water or even worse when player is in an exterior location
underwater fog script now stores old fog values before entering water and restores them when leaving water
works with mods now"
233386765,Make triggered spells closer to classic,Allofich,2018-11-25 16:51:11+00:00,2018-12-06 22:45:16+00:00,{},"Partway fix for https://forums.dfworkshop.net/viewtopic.php?f=24&t=1545.

This fixes 2) and fixes 1) as far as only putting ""casterOnly"" spells on the player.

To complete the fix, we need to shoot non-casterOnly spells at the player from the triggering object, at the strength of the player's level. Interkarma I think you would know better how to do that. Would you like to finish out this fix by implementing that?

For 2), in classic a counter gets set to 1000 when triggering a spell trigger, then it is lowered by an amount on each trigger. After getting <= 0 the spell fires again. I think the amount may vary by FPS. I matched the amount so that the banner in Scourg Barrow triggers every 22 clicks, which is what I was getting in testing classic.

Attaching a video of Direnni Tower trap behavior from classic.
[Direnni Tower.zip](https://github.com/Interkarma/daggerfall-unity/files/2613259/Direnni.Tower.zip)
"
233339354,Apply proficiency flags to custom classes,numidium,2018-11-24 20:48:05+00:00,2018-12-06 22:42:09+00:00,{},"Addresses issue described here:
https://forums.dfworkshop.net/viewtopic.php?f=24&t=1535"
233256638,AI fixes,Allofich,2018-11-23 17:37:47+00:00,2018-12-10 21:23:20+00:00,{},"Flyers and swimmers now use obstacle avoidance
AI now checks for a clear path, not just LOS, before shooting spells"
233232371,Fixes,Allofich,2018-11-23 15:35:24+00:00,2018-12-06 22:41:17+00:00,{},"Two AI-related fixes:

1) Enemies were not reliably falling. This was because they didn't fall while in ""moving"" state, but now they do. Also not only enemies with combat targets but any nearby enemies (within classic spawning distance) will fall. (We could make all AI try to fall all the time, but previously when I tested that it hit the FPS pretty significantly, so I'm keeping it limited like this)

2) I got an error in DaggerfallMissile during testing. I don't know for sure but I think it was because the AI fetched the enemy position from EnemySenses for aiming, but the position had been reset due to the target becoming NULL (probably because it died). I added a fall-back if the enemy position returns the reset value which should fix this."
233225054,Swimming fixes,Allofich,2018-11-23 15:05:40+00:00,2018-12-06 22:40:43+00:00,{},"Mainly, this fixes that the player was able to cheat past the swimming encumbrance limit by looking up and moving forward while pressing jump or float up.

This is fixed by this PR by not allowing up/down movement from forward/reverse, which also matches classic.

GodMode now ignores the encumbrance limit since it can be a nuisance when testing.

Interkarma, if you'd prefer to be able to move up and down using forward/reverse, I can try to think up a solution that keeps that ability. In real life you kind of have to specifically aim for it to swim up or down (well I do anyway) so I don't mind float up/float down being a specific action here. Another idea is to use this float up/float down behavior for swimming, but allow forward/reverse for levitate. Right now this PR is following classic and doing float up/float down for both swimming and levitation.

Also swimming/levitate now uses the swimming/levitate speed for up/down, not fixed a fixed speed like classic. Classic's speed is still noted in a comment, but I can't see why, for example, a better swimming player character can swim faster horizontally but not vertically.

Another small difference from classic: In classic even when encumbered in water, you can stop the downward movement and stay at your current height by holding the float up key, although you can't go up. We can't know for sure, but I suspect this was probably not intended, considering the ""You are carrying too much to stay afloat"" message (although that message is from the demo and didn't make it to the release version) and that doing this trick allows you to ""stay afloat"" at your current height, so this PR doesn't allow it."
233206992,Ambient sound cleanup and made sounds 3D,Allofich,2018-11-23 13:53:29+00:00,2018-12-06 22:33:21+00:00,{},"Water sound now played 3D at a point on the water surface
Ambient sounds played 3D around the player

The water sound was already fake 3D but I had put a TODO for making it actual 3D.
The ambient sounds seem to have been 2D on purpose but I think 3D sounds better. It comes from a random direction around the player now. Let me know if you like it or you want them to stay 2D.

Cleanup:
Merge nested if statements
Remove redundant yield break
Remove unneeded variable for classic update loop
Use const keyword
Remove unused variable assignments
Add contributors
Add end-of-file newline"
233147787,fix for automap hotkey bugs (https://forums.dfworkshop.net/viewtopic.php?f=24&t=1494),Nystul-the-Magician,2018-11-23 09:47:05+00:00,2018-11-25 22:25:57+00:00,{},"fix for automap hotkey bugs (https://forums.dfworkshop.net/viewtopic.php?f=24&t=1494)
- hotkey collisions with global automap hotkey are now handled (fallback key is used - fallback button is the home button)
- global automap hotkey change now immediately gets applied to automaps
- button tooltips now show the current used hotkeys (fallback hotkey in case it is used)"
233111046,Clean up EnemySenses,Allofich,2018-11-23 05:48:02+00:00,2018-11-25 22:25:20+00:00,{},"Clean up for EnemySenses and fixes 2 regressions in classic AI from the recent changes.

Regressions:
1) Classic AI wasn't finding target's position anymore
2) Classic AI would stop at obstacles but not try to get around them (not even walking against them like before)

Both are fixed, with obstacle avoidance code used for classic AI as well now.

Regarding the cleanup, in addition to tidying things up, illusion spells (invisibility, chameleon, shade) now work for AI as well (meaning, AI will not see other AI with these effects).

Also, 2 questions for Interkarma.

1) Do you have a preference if private methods have the `private` keyword or omit it? I see it both ways in the files I've been looking at. I get the impression that it's been omitted more often, so I matched that for this cleanup, but if you would prefer it to be used, I can do it that way instead.

2) How do you feel about using auto-properties? If we use auto-properties, this PR will change from reducing line count by about 30 lines, to reducing it by about 100 lines.
See: https://github.com/Interkarma/daggerfall-unity/compare/master...Allofich:cleanup2
"
233077771,Fix some issues with purchasing interface,ajrb,2018-11-22 21:59:21+00:00,2018-11-25 22:20:49+00:00,{},"* Only try to equip non stacks from cart when purchasing.
* Only check player encumbrance for weight when retrieving from cart during purchasing.
* Prevent double can't carry messages. (same fix as PR #1015) 
* Move text string into textfile."
233049737,Can always put arrows into cart,petchema,2018-11-22 17:54:40+00:00,2018-11-25 22:20:07+00:00,{},"Since arrows weight is not accounted for, they can always be put back into cart
Bug report  https://forums.dfworkshop.net/viewtopic.php?f=24&t=1532"
232124388,Bugfixes,ajrb,2018-11-19 21:56:19+00:00,2018-11-21 09:03:13+00:00,{},"* Resetting lightsource and spellbook.
* Correcting Mages rank 8 level message.
* Fix teleporting to restore building data.
* Add torch to items list of add console command.
* Fix horseriding in dungeons bug.
* Fix map reading in Alik'r Desert bug. (possibly fixes other problems with this region)
* Allow light sources to be used or equipped."
231865321,Biography fixes,numidium,2018-11-19 06:23:43+00:00,2018-11-21 08:52:42+00:00,{},"This addresses a couple of issues discussed here: https://forums.dfworkshop.net/viewtopic.php?f=24&t=1500

1. The social group NPC reaction adjustments are fixed so that the correct adjustments are read when entering conversation.

2. Social group adjustments are now part of SerializablePlayer so that they persist on save/load."
231804255,Improvements for ImportedComponentAttribute ,rossipaolo,2018-11-18 18:15:50+00:00,2018-11-21 08:52:13+00:00,{},"Some improvements for the ImportedComponentAttribute introduced with #1021.

This introduces support for storing references to assets or other prefabs. Basically, it saves the name of the asset, then seek it from the mod when the prefab is loaded.

A remaining limitation is that a component field can't store a reference to a component from another prefab. References to components on the same prefab can also fail depending on serialization order, due to how Component instances are created. I don't think this is a big issue because you would normally use GetComponent() instead of storing it from the editor, anyway. What's important is that the actual instance is correctly recreated, then references can be easily retrieved from Start().

Something else to keep in mind is that FullSerializer serializes everything it can, including public class/struct fields initialized in line, which are not exposed to inspector. Not an issue, is just unnecessary."
231789154,TextureReplacement: Add missing .gitignore,rossipaolo,2018-11-18 13:43:39+00:00,2018-11-21 08:51:41+00:00,{},
231787981,ModSettings: Log type in KeyNotFound exception,rossipaolo,2018-11-18 13:22:39+00:00,2018-11-21 08:51:18+00:00,{},"This exception is also thrown if section and key names are correct but type is not.
Requested type is now also printed to log."
231780486,AI target movement prediction,Allofich,2018-11-18 10:34:50+00:00,2018-11-21 08:50:56+00:00,{},"With enhanced AI on, enemies now predict target movement.

This makes them a bit more active in combat, and makes guards a little harder to avoid.
This also allows enemies to lead their targets with arrows and spells.

Also fixed reversed check when AI was checking if other AI had back turned.

Prediction includes iterative prediction when the target is unseen. For example, if the player ducks moves behind a building, the AI assumes the player, while out of sight, is continuing to move in the last direction it saw the player move. Right now this feature doesn't work so great because of lack of obstacle avoidance, which is the next thing I'm working on.

Also, adding AI leading targets made the issue of the player riding on arrows more prominent, because arrows are more likely to hit the player at an angle now, rather than directly head-on. I added a hack to address this: arrows from AI will raycast in the direction of the target rather than directly forward (no change for the player's arrows). Seems to work well in testing. If we can use collision for the arrows this hack can be removed."
231764031,Prevent talk menu from becoming unresponsive,numidium,2018-11-18 02:24:04+00:00,2018-11-21 08:50:03+00:00,{},"If the ""okay"" button is clicked while ""things"" is selected or if the ""people"" list is empty then the talk menu no longer responds to double clicks/okay button clicks."
231706978,better stack splitting default value,petchema,2018-11-17 04:56:55+00:00,2018-11-17 22:37:47+00:00,{},"- Default input value is now the maximum allowed value if stack
splitting is called because of player encumbrance.

- Stack splitting itself checks that you don't try to remove more than
the size of the stack, but encumbrance may enforce an even lower limit;
This wasn't correctly checked after user input."
231676812,PresetPicker: fixed exception thrown when there are no presets,rossipaolo,2018-11-16 22:48:39+00:00,2018-11-17 22:37:08+00:00,{},An exception was thrown when an invalid preset index was selected after they are all deleted.
231673386,ModSettings: Remove support for obsolete features,rossipaolo,2018-11-16 22:30:06+00:00,2018-11-17 22:36:45+00:00,{},"Old settings files based on INI are now unsupported.
Mod developers are invited to upgrade with the Mod Settings Editor from ""Daggerfall Tools"" > ""Mod Settings"".
There is a button named ""Import Legacy INI"" which should help to provide a smooth transition."
231578652,Clean up EnemyMotor,Allofich,2018-11-16 16:05:48+00:00,2018-11-17 22:42:08+00:00,{},"Unlike the light cleanup I'm giving in the other PRs, this is a heavy clean of EnemyMotor.cs.

The reason is that I've been and continue to be experimenting with Enemy AI. The code is messy in parts, which gives me trouble when trying to implement new things. This is to set up EnemyMotor as a cleaner base for continued work.

Changes:
- Whitespace, formatting tidied
- Code duplication removed
- Better comments, renamed variables/functions to be more accurately descriptions
- Fix shadowed variables
- General solution for switching between standing and moving animations instead of trying to catch each individual case. Problem of enemies sliding around while appearing to be in the idle animation is fixed (maybe not 100%, but definitely better)
- For enhanced combat mode, don't stop while rotating to target if target is in view. Makes them a little better/more realistic at pursuing.
- Allow backing up while attacking
- Remove ""follow player while attacking"" logic as it isn't really needed anymore with recent AI behavior
- Applied paralysis gravity to not only swimming enemies, but flying enemies (but not levitating ones)

This merges fine with https://github.com/Interkarma/daggerfall-unity/pull/1026."
231499778,Allow standing on surfaces in water,Allofich,2018-11-16 11:29:18+00:00,2018-11-17 22:36:23+00:00,{},"Fix for https://forums.dfworkshop.net/viewtopic.php?f=24&t=1506&p=17372#p17372.

Also, not a priority or anything, but I think ideally the forced crouch on entering water should be optional, so that behavior closer to classic is still usable."
230901651,More cleanup,Allofich,2018-11-14 16:35:54+00:00,2018-11-17 22:40:47+00:00,{},"Covers Scripts/Game/Player, except for the files there being modified by 
https://github.com/Interkarma/daggerfall-unity/pull/976.

Remove unused using statements
Add end-of-file new lines
Tidy up whitespace
Inline returned variables
Add missing comment headers to beginning of files
Simplify boolean expressions
Comment out unused variables
Use readonly keyword
Use const keyword
Remove empty Update functions"
230847342,Give correct random magic item rewards,Allofich,2018-11-14 14:06:56+00:00,2018-11-17 22:35:00+00:00,{},"Fixes https://forums.dfworkshop.net/viewtopic.php?f=24&t=1454 and https://forums.dfworkshop.net/viewtopic.php?f=24&t=1476, which are both the same issue.

This isn't a fix for those existing items that players already got, it just fixes the quest action to properly give magic items."
230836303,Fix issues with AI fall detection,Allofich,2018-11-14 13:32:29+00:00,2018-11-17 22:34:16+00:00,{},"Fixes getting stuck at base of stairs
Fixes walking backwards off of ledges

I couldn't get AI to stop while walking against a wall as you mentioned Interkarma, but it should be fixed, too."
230745062,Update 0.6 to current master,Interkarma,2018-11-14 08:14:37+00:00,2018-11-14 08:14:44+00:00,{},
230273360,Fix for level up bug in enhanced vitals indicators,ajrb,2018-11-12 21:26:20+00:00,2018-11-14 08:04:34+00:00,{},@MeteoricDragon You should probably check this change and test that you're happy with the fix. Bug report https://forums.dfworkshop.net/viewtopic.php?f=24&t=1479
229991393,Stream ogg songs from disk,petchema,2018-11-12 00:39:52+00:00,2018-11-14 08:04:59+00:00,{},"MidnightPrince assembled a kickass soundscape for Daggerfall Unity
https://forums.dfworkshop.net/viewtopic.php?f=14&t=1347#p16078

All songs are replaced with OGG music, and there's a noticeable frames drop when songs (re)start.
This patch uses Unity audioClip streaming for digital songs."
229973317,Handle asynchronous loading of audioClips,petchema,2018-11-11 19:43:19+00:00,2018-11-14 08:06:24+00:00,{},"Currently we can skip the first use of audioclips loaded from discrete files, because they're loaded asynchronously and may not be ready at the time of AudioSource.PlayOneShot().
See bug report https://forums.dfworkshop.net/viewtopic.php?f=24&t=1414
This patch wraps calls to PlayOneShot() with a coroutine so sound is played when ready, with a delay up to 150ms.

There's some code duplication here, could DaggerfallWorkshop.Game.Questing.Actions.PlaySound use DaggerfallWorkshop.DaggerfallAudioSource?"
229967738,Implemented ImportedComponentAttribute,rossipaolo,2018-11-11 18:04:05+00:00,2018-11-14 08:08:01+00:00,{},"One of the big limitations of the Mod Sytem is that MonoBehaviours provided my a mod can't be serialized to a prefab, because their type is not known by Unity when they are loaded from the assetbundle. The solution is to add components at runtime with `AddComponent()` but this is quite bothersome, and also impossible when a gameobject is instatiated by Asset-Injection without mod intervention.

As a workaround Lypyl introduced an interface to serialize custom scripts and provide a simple way to deserialize them, but it still requires the mod intervention so it doesn't fully satisfy all needs. For this reason i decided to give it a try with my own take on this issue.

## Component

Imported Monobehaviours needs to be assigned the `ImportedComponentAttribute`. Thats's all.

```
[ImportedComponent]
public class ExampleComponent : MonoBehaviour
{
    public string Title;
    public int Number;
}
```

## Serialization

The mod builder checks prefabs for components with the attribute and remove them on the bundled clone (the original is left unaltered), not before saving the required data to a json file named **prefabName.imported.json**. This is similar to what Lypyl was doing.
The final result looks like this:

![examplecomponent](https://user-images.githubusercontent.com/24359151/48316429-ca597f80-e5e3-11e8-8a83-86630346cde6.png)

```
{
    ""Components"": [
        {
            ""Title"": ""Elephant"",
            ""Number"": 24,
            ""$type"": ""ExampleComponent""
        }
    ],
    ""Children"": {
        ""Sphere"": {
            ""Components"": [
                {
                    ""Title"": ""Dog"",
                    ""Number"": 234,
                    ""$type"": ""ExampleComponent""
                }
            ],
            ""Children"": null
        }
    }
}
```

There are two things to notice:
+ Components without the attribute are not saved here because they are already managed by Unity with the **.prefab**.
+ FullSerializer adds `$type` properties with the full type name.

## Deserialization

When a prefab is loaded with `Mod.GetAsset()`, the mod manager automatically look for the **imported.json** file. This is the tricky (and somewhat hacky) part:
Instead of giving the gameobject instance to FullSerializer (which wouldn't work), we traverse the `fsData` dictionary to read the `$type` properties and retrieve the actual type at runtime from the compiled mod assembly. At this point we can make a new instance with `AddComponent()` and let FullSerializer do its work on it.

## Conclusion

Manually using `AddComponent()` is always the fastest option but if this is not possible or is otherwise not desiderable, the `ImportedComponentAttribute` can automatize this process."
229949121,stack potions,petchema,2018-11-11 12:32:17+00:00,2018-11-11 23:11:42+00:00,{},"Requested in forums
https://forums.dfworkshop.net/viewtopic.php?f=12&t=807

Potions require an extra check on typeDependantData, I hope I got it right"
229925712,"""You cannot sleep now."" if player is levitating",petchema,2018-11-11 02:01:35+00:00,2018-11-14 08:05:48+00:00,{},"Daggerfall classic displays that message if player is swimming, but also if he's levitating."
229894709,Mod Settings cleanup and documentation,rossipaolo,2018-11-10 15:21:08+00:00,2018-11-14 08:08:22+00:00,{},"This is for master (0.5). Then i'm going to push another PR for 0.6 to remove support for obsolete features, such as ini settings."
229890223,Use fog from Post-Processing Stack,rossipaolo,2018-11-10 13:42:43+00:00,2018-11-14 08:13:41+00:00,{},"Fog component from Post Processing Stack is used, as a replacement of fog effect from old Standard Assets.
Other post processing effects are still disabled but can be enabled by mods, as it was before."
229548427,TextBox overwrite,petchema,2018-11-09 00:02:25+00:00,2018-11-09 19:07:03+00:00,{},"Sometimes you want to open an text input box with a default value, but do not want it to get in the way of user input; For example, when renting a room in a tavern, you want to suggest a default of 1 day, but if the user types 3 you want the number of days to become 3, not 13.
Most of the time the current system works well enough, because the most common default value (""0"") doesn't hurt as a prefix of integer input (except it's not very pretty). But in some cases like above, it really doesn't work so well.

This patches modifies TextBox so that if the user starts typing a new value, the previous value is first cleared; But if the user first starts with any kind of editing action (arrow keys, backspace,...) the value is modified instead, like before.
This is a cheap emulation of full fledged input text boxen, that have such behavior because the whole previous value is selected by default; But implementing text selection looks overkill for our purpose.

I also noticed DefaultText, that seems to have been envisioned for that purpose (given GetResultText logic), but
- DefaultText is used for a different purpose (put a ""Enter your character name here"" kind of filling text in empty input text boxes);
- GetResultText doesn't seem to be used;
- there's no option for textbox input validation callbacks to receive ResultText instead of Text as ""input"" parameter.
So maybe GetResultText could also be dropped along with this patch?"
229539094,"Fix spurious ""you cannot carry anymore stuff.""",petchema,2018-11-08 23:12:01+00:00,2018-11-25 22:19:41+00:00,{},"When, while you're selling items, you put items back into your open
wagon, you can sometimes get a ""you can't carry that much weight"" kind
of message and yet the items are correctly removed from the selling
selection.

The culpit is the seemingly harmless

    int canCarry = CanCarryAmount(item);
    if (usingWagon)
    {
        canCarry = Math.Max(canCarry, WagonCanHoldAmount(item));
    }

because CanCarryAmount() an WagonCanHoldAmount() not only return how
many instances of a given item still fit in character's inventory or
wagon, but they also display the above message if none fits; So they
cannot be freely composed, like above.

While I think I understand the intention behind that max() (""you can
pick the item if it fits in either your pack or your wagon""), I think it
currently has another bug, because the item is not put in your pack if
it doesn't fix in the wagon; So under the right conditions you can stack
pretty much everything in your wagon.

This patch remove that fallback logic entirely, which is the simplest
fix."
229252377,Disallow player from adding conflicting advantages and disadvantages,numidium,2018-11-08 05:13:57+00:00,2018-11-09 03:45:03+00:00,{},This implements behavior from classic for the class creator.
228217005,"Merge arrows to master, resolve conflicts",Interkarma,2018-11-05 00:55:17+00:00,2018-11-05 00:56:28+00:00,{},"This feature works well, although I might still tweak missile class changes later. Thanks @Allofich for all your work on this on this one. üëç "
228216658,"Update arrows to current master, resolve conflicts",Interkarma,2018-11-05 00:50:27+00:00,2018-11-05 00:53:13+00:00,{},
228174886,"AI: Don't walk off ledges, LOS check from eye level",Allofich,2018-11-04 12:50:48+00:00,2018-11-09 03:44:36+00:00,{},AI stops at ledges (unless they are very shallow) and does LOS check from around eye level.
228141785,Improvements to PresetPicker,rossipaolo,2018-11-03 21:16:39+00:00,2018-11-05 00:57:12+00:00,{},"Changed the preset picker window to follow a more consistent style and be more comfortable to use.

![presetpi cker](https://user-images.githubusercontent.com/24359151/47957437-083c1f80-dfb6-11e8-8d71-932bda2d76df.png)"
228128269,Fix overly fast video playback,Allofich,2018-11-03 16:47:42+00:00,2018-11-09 03:43:06+00:00,{},"Fixes https://forums.dfworkshop.net/viewtopic.php?f=24&t=507.

The problem was that `DaggerfallVideo` seemed to assume that there would always be an audio frame to use to update `nextEventTime`, but there are parts in several of Daggerfall's videos where there are stretches of only video frames. Another issue was that the audioBuffer length when the last audio frame played could be very small, leading to short `frameDelay`. Enforcing a minimum `frameDelay` and accounting for parts where there are no audio frames fixes the speed ups at the end of `ANIM0000.VID` (the book intro) and `ANIM0005.VID` (meeting Lysandus's ghost). It may also slightly improve the timing of the Bethesda logo intro (you can see the sparkle disappear at the end now) and the end frames of some endings.

I tested all the video files in the game with this PR and they all play fine."
228117989,Add missing paralysis resist logic,Allofich,2018-11-03 13:18:20+00:00,2018-11-09 03:42:51+00:00,{},"Fixes https://forums.dfworkshop.net/viewtopic.php?f=24&t=1443. Only way I saw to do it was to add special handling for paralysis in the effect manager. If the logic was within `Paralyze.cs`, I think the effect would have started and we'd have to undo the magic rounds that had been added, etc. If you have a better solution in mind, feel free to do it instead.

Also fixes saving throws. I was wondering why a custom class character with immunity to paralysis was not resisting paralysis from some Giant Scorpions I was testing with. Turned out the paralysis spell they use (Spider Touch) has both the paralysis and magic flags. I messed up with the saving throw logic before and made it only check for one and only one flag type, so it didn't work with 2 flag types. Now, like classic, it works with multiple flags.

Also made the player immune to paralysis in god mode, because it gets in the way of testing."
227981001,"map zoom behavior changed, ""Map"" section in ini-file contains map related entries now",Nystul-the-Magician,2018-11-02 15:52:13+00:00,2018-11-09 03:42:31+00:00,{},"Hi Interkarma, please especially take a look on the 3rd point (the changes to the ini file) - since this is territory I usually don't touch - especially moving the setting ""AutomapNumberOfDungeons"" to the new ""Map"" section - if this is done correctly

- zoom settings changed - zoom is now independent of location size

- there is now a flag to change zoom reset behavior on location change

- ini file now has a ""Map"" section with map related settings: moved ""AutomapNumberOfDungeons"" to this section, added 2 new settings to this section: ""ExteriorMapDefaultZoomLevel"" and ""ExteriorMapResetZoomLevelOnNewLocation"""
227887442,Implementation of in-game light sources,ajrb,2018-11-02 10:07:38+00:00,2018-11-09 03:41:53+00:00,{},"Switched by PlayerTorchFromItems setting
See: https://forums.dfworkshop.net/viewtopic.php?f=23&p=16825 for discussion"
227780620,Implementation of in-game light sources,ajrb,2018-11-01 22:35:52+00:00,2018-11-02 09:08:27+00:00,{},"Switched by PlayerTorchFromItems setting
See: https://forums.dfworkshop.net/viewtopic.php?f=23&p=16825 for discussion"
227615404,Fix cancellation of generation windows,Allofich,2018-11-01 13:16:41+00:00,2018-11-02 01:13:48+00:00,{},"Fixes
https://forums.dfworkshop.net/viewtopic.php?f=24&t=1420
and 
https://forums.dfworkshop.net/viewtopic.php?f=24&t=1418

Also fixes a new issue I found, which is that if you pressed ESC at the screen where you choose whether questions will be automatically answered or not, it would treat it as if you had selected automatic and proceed to the naming screen."
227607441,Fix enemy spell assignment,Allofich,2018-11-01 12:45:18+00:00,2018-11-02 01:13:21+00:00,{},I didn't realize that `careerIndex` for `EnemyClass` types would overlap with `EnemyMonster` types. This could cause an exception with city watch as they would be assigned spells and cast them and the program would try to access their non-existent spell frame animations.
227603858,Make post-pause input delay for 1/12 a second,Allofich,2018-11-01 12:30:30+00:00,2018-11-02 01:13:01+00:00,{},"Fixes https://forums.dfworkshop.net/viewtopic.php?f=24&t=1377&start=10 by changing from a frame-based solution to a time-based one. Based on my testing there that 5 frames worked with a 60 fps area (1/12 of a second) I made the wait be that long. The issue is fixed for me.

Feel free to reject if you had a different solution in mind, Interkarma."
227583178,More cleanup,Allofich,2018-11-01 11:03:08+00:00,2018-11-09 03:41:24+00:00,{},"More simple cleanup. This finishes out the `MagicAndEffects` folder.

Biggest change is that I commented out a chunk of code in `MagicCandleBehaviour.cs` that doesn't appear to do anything, as `myBillboard` doesn't seem to be used by anything. I didn't notice any difference in the candle in-game with or without the code, but please confirm, Interkarma, and let me know if you want me to restore, delete, or leave commented that code.

Remove unused using statements
Whitespace cleanup
Make abstract class constructor not public
Add readonly keyword where appropriate
Add end-of-file newline
Remove redundant return statement
Remove unused variable assignments
Fix local variables hiding class variables
Comment out code in MagicCandleBehaviour that does nothing
Match summary parameter names to function parameters"
227497177,Update 0.6 to current master,Interkarma,2018-11-01 02:46:46+00:00,2018-11-01 02:46:58+00:00,{},
227450468,Item Icon variants - books and LoC,ajrb,2018-10-31 21:39:16+00:00,2018-11-02 01:12:42+00:00,{},"* Fixed book display where they show using holy tome icon in old saves. Populating player tex archive + record and then changed GetRandomBook to select one of the 3 variants that are allowed instead of just using the same icon for every book. One of these is the spellbook icon... since classic only uses one icon for books (assuming a bug given variant number) and I think this will be confusing I have reduced variants to 2.

* Also changed the icon for LoC to an unused icon. (was going to be for deeds I think)"
227449713,Differentiate duplicate plants in long name (tooltips),ajrb,2018-10-31 21:36:11+00:00,2018-11-02 01:12:25+00:00,{},"Used the suffixes ""(northern)"" and ""(southern)"" based on Allofich's suggestion."
227092658,Fix caching of ship exteriors when fast travelling,ajrb,2018-10-30 21:47:03+00:00,2018-10-31 04:18:52+00:00,{},Had to make a separate branch for this due to mismatching sync with main repo
227082760,Fix for ship interior persistence and headings for finished quests,ajrb,2018-10-30 21:10:37+00:00,2018-10-31 04:19:48+00:00,{},See: https://forums.dfworkshop.net/viewtopic.php?f=24&t=1426
227081191,Use virtual size for Panel border textures,rossipaolo,2018-10-30 21:05:27+00:00,2018-10-31 04:15:14+00:00,{},Allow a virtual size to be provided for panel border textures. This brings support for override of SPOP.RCI.
226723226,Fix for ship interior persistence and headings for finished quests,ajrb,2018-10-29 21:42:12+00:00,2018-10-30 21:08:01+00:00,{},See: https://forums.dfworkshop.net/viewtopic.php?f=24&t=1426
226398166,Updating arrows branch to current master,Interkarma,2018-10-28 21:18:47+00:00,2018-10-28 21:18:54+00:00,{},
226377941,Fix travel from ship to use boarding location,ajrb,2018-10-28 16:09:34+00:00,2018-10-28 21:16:49+00:00,{},See https://forums.dfworkshop.net/viewtopic.php?f=28&t=1409
226368274,Temporary fix for saves with missing caster loadID,Allofich,2018-10-28 13:47:09+00:00,2018-10-28 21:16:13+00:00,{},"A temporary workaround for https://forums.dfworkshop.net/viewtopic.php?f=24&t=1374.

In my experience this happens _every_ time you save with a spell having been cast by an enemy, whether on the player or on another enemy. I'm kind of surprised this hasn't been brought up more on the forum.

I don't know what the underlying cause is, but this treats the symptom and at least allows for loading an affected saved game and continuing play.

By the way, a somewhat pedantic note, but the failure in `GetCasterReference` was throwing an exception. I changed it to `LogError` to indicate the same level of ""error"", but where this is used for resuming effects, a failure was just a `LogWarningFormat` so there I used a same level `LogWarning`, but unless I'm missing something it seems like these should either both be ""errors"" or both be ""warnings"".

Interkarma if you have a fix in the works, you can ignore this PR if you want.
 "
226355451,Fix parsing of character background questions,Allofich,2018-10-28 09:58:43+00:00,2018-10-28 21:17:13+00:00,{},Fix for https://forums.dfworkshop.net/viewtopic.php?f=24&t=1365.
226334422,Update 0.6 to current master,Interkarma,2018-10-28 00:36:06+00:00,2018-10-28 00:36:14+00:00,{},
226303187,Rename MeshAndTextureReplacement to AssetInjection,rossipaolo,2018-10-27 15:43:20+00:00,2018-10-28 00:22:33+00:00,{},_MeshAndTextureReplacement_ has been renamed to _AssetInjection_ and default value is now True.
226300921,Make all sound effects respect volume setting,Allofich,2018-10-27 15:06:50+00:00,2018-10-28 00:26:19+00:00,{},"Fixes https://forums.dfworkshop.net/viewtopic.php?f=24&t=1009.

I can't reproduce the issue there about music playing even when at 0 volume. For me it turns off completely. But the issues of sound effects ignoring the volume setting are fixed.

Was a bit tricky to figure out because sounds are played in several different ways:
1) Goes through a PlayOneShot function in DFAudioSource. In this case, DFAudioSource handles applying the volume setting and the call to PlayOneShot can ignore the volume setting. (No fixes needed here)
2) Goes through PlayOneShot in AudioSource. In this case, the volume setting needs to be applied in the call. (This needed to be done for enemies' PlayAttackSound() and for sounds in character creation)
3) Goes through Play() on an AudioSource. In this case, the Audiosource's ""volume"" needs to be set to match the volume setting. This had to be done in a few different places, and should fix weather sounds/crickets, DaggerfallAction sounds, quest sounds, and riding sounds.

I think the only sound that doesn't respect the sound volume setting now is .VID files. Not sure how their sound is handled."
226289911,Fix enum that messed up index order,Allofich,2018-10-27 12:08:08+00:00,2018-10-28 00:14:44+00:00,{},Fixes https://forums.dfworkshop.net/viewtopic.php?f=24&t=1407.
226289580,Fix travel cost being negative sometimes,Allofich,2018-10-27 12:01:55+00:00,2018-10-28 00:14:28+00:00,{},Fix for https://forums.dfworkshop.net/viewtopic.php?f=24&t=1410
226273616,Stack splitting,petchema,2018-10-27 06:28:14+00:00,2018-10-28 00:25:13+00:00,{},"(patch on top of stacking-and-equipping)
Allow user to pick or drop part of a stack by maintaining control key pressed while clicking on the stack.
The arrows now have a weight like in Daggerfall classic.

Message box can probably be improved."
226262914,Stack splitting,petchema,2018-10-27 02:18:11+00:00,2018-10-27 04:40:17+00:00,{},"(patch on top of stacking-and-equipping)
Allow user to pick or drop part of a stack by maintaining control key pressed while clicking on the stack.

Message box can probably be improved.
"
226196441,Book icons variants & LoC icon change.,ajrb,2018-10-26 19:03:56+00:00,2018-10-27 00:24:46+00:00,{},"These replace edits done by IC ages ago that got lost mid august when IK regenerated them. (56f4d2d4529a984984de16ebc9888b170b83d0f8)

Most edits were re-done, but two were missed:

* Unit weights all had .0 added to the end, which doesn't matter since this is handled by the macro handler so not changed this.

* Fixed book display where they show using holy tome icon. Populating player tex archive + record and then changed GetRandomBook to select one of the 3 variants that are allowed instead of just using the same icon for every book. One of these is the spellbook icon... since classic only uses one icon for books (assuming a bug given variant number) and I think this will be confusing I have reduced variants to 2.

* Also changed the icon for LoC to an unused icon. (was going to be for deeds I think)"
225895904,Implemented a Notebook tab and Finished Quests tab of Journal window,ajrb,2018-10-25 20:38:07+00:00,2018-10-28 00:31:34+00:00,{},"* Assume will go in 0.6, but didn't target that branch, is up to you to decide.

* Created a DaggerfallUI.txt strings table. Intending this to have messages for UI windows that only have a few strings. Heavy string UI windows like SpellMaker or Automap will still have their own. Let me know if you'd rather have one per window even if there's only a handful of messages. Seems that journal window now has quite a few, more than originally anticipated.

* Even though PlayerNotebook is a member of PlayerEntity it serialises to it's own file and controls this separate from the player serialisation.

* I added a message that pops up if player tries to travel while indoors like the one for transport changes. This isn't in classic but is both more consistent and helps a player clicking on a quest in the journal understand why it doesn't bring up the map. (bug report avoidance!)

* Enabled shadows for text in conversation panel on talk window. This is so I can change the shadow colour to indicate which text chunks will be copied. Hope you don't mind Nystul, it was the most elegant solution I could find.

"
225756443,Add 3d arrow projectiles,Allofich,2018-10-25 13:21:09+00:00,2018-10-31 04:11:42+00:00,{},"This replaces the temporary instant arrow hits with actual 3d projectiles.

This is probably messier than it should be, as I put it together with trial and error. For example, I couldn't use the existing collider used by `DaggerfallMissile`, because it won't work with the concave shape and I had to make the rigidBody kinematic. Instead I use a sphere ray cast for the arrows. Interkarma, please feel free to gut this implementation if you don't like it. Functionally, it works, though.

All existing arrow code was adapted to work with it. I had to account for various things, like getting the player weapon at the time of shooting, not the time of damage calculation, since they might unequip their bow before an arrow hits the target.

Known issues:
- The arrow hit sound plays without any doppler because the same code as it used for spell projectiles is used, and they aren't using doppler. (Seems to me like they should, even if classic doesn't)

- When looking up or down while shooting an arrow, the arrow spawns offset from the center of the screen where it should spawn from.

- There is a merge conflict with the Serializable enemy prefab in the AI combat PR, which will need to be fixed. I can update the PR as needed or you could do it yourself if you want to.

- The arrows can sometimes displace enemies or the player a little bit, I think because of collision with the 3d."
225502434,Stacking and equipping,petchema,2018-10-24 18:19:14+00:00,2018-10-28 00:13:31+00:00,{},"Don't stack equipped items with other items; and when asked to equip a stack, only equip one of the items.

Limitations:
- when unequipping an item, no attempt is done to stack it with other similar items;
- characters may have equipped stacked items already; Is it worth fixing while loading a gamesave?
"
225369266,Cleanup,Allofich,2018-10-24 11:42:41+00:00,2018-10-31 04:14:36+00:00,{},"Next one's in the list, going through the script files sequentially.
There isn't much to clean up in the magic effect files, so I went ahead and did all of the rest of them.

`Scripts/Game/MagicAndEffects/Effects/Diseases`
`Scripts/Game/MagicAndEffects/Effects/Illusion`
`Scripts/Game/MagicAndEffects/Effects/Mysticism`
`Scripts/Game/MagicAndEffects/Effects/Poisons`
`Scripts/Game/MagicAndEffects/Effects/Powers`
`Scripts/Game/MagicAndEffects/Effects/Restoration`
`Scripts/Game/MagicAndEffects/Effects/Thaumaturgy`

The changes are all straightforward, the most significant ones (still just simple cleanup) are in `Teleport.cs`. Just in case I tested the ""Recall"" spell after the changes and it worked fine, whether teleporting within the same area or to a different one. 

Remove unused using statements
Add end of file newlines
Revise comment
Merge nested if statements
Remove redundant array initializer
Remove redundant return
Remove redundant override method
Remove redundant fetching of SerializablePlayer and PlayerEnterExit in
Teleport.cs
Remove redundant boolean check
Use readonly keyword where appropriate
Simplify logic expression in PoisonEffect.cs
Comment out unused variables"
225334256,Geographic context backgrounds & HUD arrow count,ajrb,2018-10-24 09:45:45+00:00,2018-10-28 00:13:02+00:00,{},"Both are toggled by a new setting.
Arrow count position is centered because I could not figure out how to ensure it was just left of the compass where it looks brilliant. I found that it disappeared under the compass at different resolutions. It would be nice to move it if someone can help."
224887159,Climbing motor changes,MeteoricDragon,2018-10-23 03:53:08+00:00,2018-12-14 01:17:48+00:00,{},"This is Still a WIP.  I'm submitting this PR so you or anyone else can have a taste at what I'm doing so far.

Things you can do:

- Climb into the ceiling, and wait a second for hanging mode to activate.
- While hanging, press against a wall squarely to activate climbing mode and disengage hanging.
- Look and move while hanging in any direction on level ceilings.
- hang on the underside of small eaves.

Things you can't do... yet.

- climb over the eaves
- fail at hanging - (for now, I want to succeed at hanging until I fix some more bugs)
- Reset gravitational speed when recovering from slipping while climbing, or after grabbing the walls.
- Strafe into the wall while hanging without plummeting to your death.
"
224603951,fix for automap freeze (tooltip related),Nystul-the-Magician,2018-10-22 07:13:44+00:00,2018-10-22 10:34:15+00:00,{},
224522122,"Only show ""feel somewhat bad"" for player",Allofich,2018-10-21 06:51:12+00:00,2018-10-24 07:45:41+00:00,{},"I noticed this showed when an AI character poisoned another one.

No check is necessary right now for diseases as they only affect the player."
224484863,Don't stack enchanted ingredients,petchema,2018-10-20 16:25:45+00:00,2018-10-24 07:43:19+00:00,{},"Totally forgot about those!
https://forums.dfworkshop.net/viewtopic.php?f=28&t=1274&start=10#p16257"
224481182,Fix wrong text for Pacify effect,Allofich,2018-10-20 15:23:40+00:00,2018-10-24 07:48:24+00:00,{},https://forums.dfworkshop.net/viewtopic.php?f=24&t=1363
224480095,Stop fast travel countdown when canceling,Allofich,2018-10-20 15:03:17+00:00,2018-10-24 07:51:52+00:00,{},"Fixes https://forums.dfworkshop.net/viewtopic.php?f=24&t=742.

It's not realistic that you can cancel and ""turn back time"" after days have already supposedly passed, but it's good enough for now and is convenient, anyway.

As an aside, in classic, the background world events are actually being run for each day as the counter goes down, so it isn't just decorative like it is for us. And so of course, you can't cancel. We could do that, too, and it might speed up loading of a new location, although as I recall the background event processing doesn't really take up significant time. If we do that, we'd need to remove the ability to cancel, or store all changes to be undone when canceling (would probably be a pain to do that). Also it would be kind of cool if canceling just stopped the countdown where it was, leaving the player somewhere mid-way on the trip."
224474381,Fix incorrect starting skill values,Allofich,2018-10-20 13:20:32+00:00,2018-10-24 07:46:12+00:00,{},"Fix for https://forums.dfworkshop.net/viewtopic.php?f=24&t=1366.

The issue: `startingSkillSum`, used to compute when the character gains a level, was being set in DF Unity in `AssignCharacter()`, which was being computed before skills from biography bonuses were added. In classic, it isn't computer until after character creation finishes. This meant not only that the skill bonuses from the character background (if they were a primary, major or minor skill) were being considered as skills raised during active gameplay, getting you to levels 2 and 3 sooner, but it also meant the player would have a lower `startingSkillSum` than they should have, so they would always level up a bit sooner than they should have been."
224458067,Use FindIncumbentEffect for paralyze on hit,Allofich,2018-10-20 07:24:24+00:00,2018-10-24 07:42:56+00:00,{},Minor cleanup.
224457772,Re-enable sneaking while riding,Allofich,2018-10-20 07:18:28+00:00,2018-10-24 07:42:31+00:00,{},"Fixes a regression in which sneaking was disabled while riding a horse or cart. Midknightprince has been asking on the forums about this.

https://forums.dfworkshop.net/viewtopic.php?f=19&t=1288&p=16230#p16230

I think the change came when @MeteoricDragon moved player speed changing out to its own class. Perhaps he thought it was a mistake that you can sneak on the horse/cart, but it's possible in classic and there is even a specific sound effect that plays while sneaking on the horse. Or it may have just been an oversight, and not intentionally changed."
224034344,Improve enemy combat behavior,Allofich,2018-10-18 17:17:07+00:00,2018-10-31 04:26:32+00:00,{},"Main goal of this PR is to address melee combat in Daggerfall always being the enemy relentlessly advancing while the player backpedals and swings, and make combat a little more interesting.

- AI now sometimes backs off while in combat. This is influenced by level difference with the target, and whether the AI takes significant damage from a hit.  AI chooses to advance if the target is paralyzed or showing their back or it is the player with a bow or weapon sheathed.

- Added a timer to ""pad"" changes in AI movement behavior, so it doesn't react instantly to things like the player entering or leaving range.

- Slightly reduced touch-spell range, as AI seemed a little too eager to use them before really closing with the player

- Fixed (I think) a problem with enemies incorrectly determining distance to their targets due to comparing the distance to their old target to their new target after changing, when they should have been comparing the change in position of a single target. Symptom: AI suddenly swinging at the air while changing targets

- Improved AI response when target is out of 45 degree angle. They will now more reliably stop in this case (still with some timing variability) and will also back up now if the degree gets even tighter (out of 55 degree angle), if the target is above them.

- Tweaked AI evaluation of targets. They don't place quite as much value on seeing the target now (i.e., more emphasis on distance) and will only not switch targets when attacked if their current target is very close to them.

- Matched enemy attack range to player attack range. I had matched it to classic earlier, but the player's weapon range is shorter than that, so enemies hit from further away than the player. I think they match now, although I feel like the player's attack might be slightly longer? Might need more tweaking.

This stuff will probably still need tweaking, but I'm happy enough with it now to submit as a PR. I might also put an option to disable this stuff and stick to a simpler ""classic"" mode AI (as I still want a close-to-classic experience to be available), but I want to get this into a solid state and put it out for people for testing and feedback if that's alright with you Interkarma."
223810168,Custom class fixes,numidium,2018-10-18 02:52:59+00:00,2018-10-28 00:12:29+00:00,{},"This fixes the ""reputation change"" dialog which was previously not appearing. I also changed the StatsRollout on the class creator window to behave like it does in classic."
223735585,"Fixed temples, added name change function to char sheet, Fixed spinners",ajrb,2018-10-17 20:01:59+00:00,2018-10-24 07:36:50+00:00,{},"Fixed special handling of temple buildings - now can join Akatosh Chantry again by visiting Order of the Hour.
Added name change function to character sheet. Seems to work just fine with save system - just as I thought it would."
223722034,Import books from modding locations,rossipaolo,2018-10-17 19:12:30+00:00,2018-10-24 07:30:23+00:00,{},"BOK*.TXT files are seeked from StreamingAssets/Books and inside mod bundles.
This allows to provide overrides via the asset-injection framework without replacing core files on disk."
223554241,Cleanup,Allofich,2018-10-17 10:45:39+00:00,2018-10-24 07:30:00+00:00,{},"Next two in the list.

`Scripts/Game/MagicAndEffects/Alteration`
`Scripts/Game/MagicAndEffects/Destruction`

Very minor changes. Same type of fixes as in the earlier PRs. The only new one is that I changed one function, that had an `int` return value that is never used to a `void` function. The function, `IncreaseMagnitude`, is called 2 times within the class, `DrainEffect`.

No whitespace changes, they were already perfect in that regard.

`ElementalResistance.cs` and `VampiricFortifyEffect.cs` both had unused variables, now commented out. Maybe take a look at those if you like, Interkarma.

Remove unused using statements
Comment out unused variables
Add end of file newline
Add readonly keyword where appropriate
Use array initializers
Remove redundant conditionals
Remove int to int casts
Make function with unused return value void"
223382450,Catch exception in GetGuild method and just log it as it can happen due to bad faction data.,ajrb,2018-10-16 20:17:52+00:00,2018-10-16 20:45:05+00:00,{},Unfortunately faction data has some erroneous entries that are marked as guilds (Knightly Orders) and don't match a valid Deity. This was happening when trying to talk to anyone if the PlayerEnterExit.factionID got set to one of these factions.
223372645,Fix shop titles with %rt macro,ajrb,2018-10-16 19:42:39+00:00,2018-10-16 20:05:33+00:00,{},Removed the duplicate title generation method.
223367052,Update 0.6 to current master,Interkarma,2018-10-16 19:22:15+00:00,2018-10-16 19:22:22+00:00,{},
223295044,AI enemy fixes,Allofich,2018-10-16 15:26:09+00:00,2018-10-16 19:18:41+00:00,{},Must have accidentally removed this earlier.
223191227,Fix ResetWarDataForRegion using regionId - 1,Allofich,2018-10-16 10:13:03+00:00,2018-10-16 19:17:31+00:00,{},"The comparison against -1 keeps the function from running on ""Random Ruler"", which has region of -1. (Regions of -1 in FACTION.TXT are the one exception that doesn't get corrected down 1 to become 0-based. This is already accounted for in the import.)

The problem was the

`regionData[regionID - 1]`

statements, written back when the faction IDs were 1-based. I think I only looked for `regionID + 1` when fixing these and didn't think to check for `regionID - 1`."
223146805,Updating 0.6 to master,Interkarma,2018-10-16 07:48:22+00:00,2018-10-16 07:48:31+00:00,{},All previous cleanup changes in 0.6 are now in master. This is only recent changes such as enemy spell casting going back into 0.6. The two branches should be in alignment now.
223123047,Updating 0.6 to current master and reviewing conflicts,Interkarma,2018-10-16 05:53:17+00:00,2018-10-16 06:16:06+00:00,{},
223122801,Merge enemy-casting into master,Interkarma,2018-10-16 05:51:41+00:00,2018-10-16 05:51:49+00:00,{},
222722681,Refine enemy attack range,Allofich,2018-10-14 15:26:20+00:00,2018-10-16 01:31:17+00:00,{},"A while ago I set enemies to attack from somewhat beyond their actual range. I think I overdid it, though, and while watching a Youtube video I got the impression the player was learning to wait until the enemy swung, then run in and hit in the cooldown afterwards. That's not necessarily a bad thing, but I don't want enemies to be too easy to predict. This PR reduces the extra distance and also actually takes change of target position into consideration, so there shouldn't be enemies attacking from well out of range when the player is stationary, for example, something that I could see happen with the previous implementation (the one currently in master)."
222701940,First pass at enemy casting,Allofich,2018-10-14 08:53:32+00:00,2018-10-16 05:51:12+00:00,{},"Here is the start of enemy casting.

Implemented:
- Enemies assigned spells and spell points like in classic
- Enemies shoot a ranged spell like in classic

Not implemented:
- Spell casting animations
- Touch spells
- Some additional AI logic present in classic (don't cast a spell while it is still active on the target, intelligent enemies may stop casting when target has reflected a spell)

I'm sending a PR now because there is an issue maybe you can help with. For some reason enemies only cast a single spell, then stop. The logic in EnemyMotor.cs is correctly continuing to select spells for casting but something is stopping any more than 1 from shooting.

I had to make a few adjustments related to `EntityEffectManager.cs`:

- The `IsEnemyEntity` was always failing, because everything but the player is just type `None`.
- The  `EntityEffectManager` peered with enemies needed the missile prefabs assigned for instantiation."
222696901,File cleanup,Allofich,2018-10-14 06:48:35+00:00,2018-10-16 19:21:37+00:00,{},"Moving on in sequential order, this is cleanup on:
`Scripts/Game/Guilds`
`Scripts/Game/Items`

Use implicit array initializers
Merge nested if statements
Add end of file newlines
Fix variable shadowing
Add readonly keyword where appropriate
Clean up spacing, remove whitespace
Omit redundant comparison
Make sure foreach iteration is on expected type
Remove unused parameter in ReceiveHouse()
Remove unused using statements
Add missing `<summary>` tag
Change !(A == B) to (A != B)
Revise comments
Fix incorrect function summary params
Remove redundant variable assignment
Remove redundant textAsset to textAsset casts"
222690473,Update to current master,Interkarma,2018-10-14 03:27:35+00:00,2018-10-14 03:27:41+00:00,{},
222676278,Video import: Upgrade to VideoPlayer ,rossipaolo,2018-10-13 21:11:43+00:00,2018-10-13 21:52:56+00:00,{},
222635679,Updating to current master,Interkarma,2018-10-13 08:10:05+00:00,2018-10-13 08:10:12+00:00,{},
222311770,Give player starting spells,numidium,2018-10-11 23:47:39+00:00,2018-10-12 05:15:36+00:00,{},Implements the classic starting spell lists.
222132137,Fix free room for member of region knightly order,Allofich,2018-10-11 13:10:23+00:00,2018-10-11 22:38:09+00:00,{},"The knightly order code was still using +1 when checking the region ID, although the FactionData now subtracts 1 from the IDs from `FACTION.TXT` when importing (like classic does) and the +1 check is no longer necessary."
221798523,Clean more files,Allofich,2018-10-10 13:53:16+00:00,2018-10-14 03:29:53+00:00,{},"More file cleanup, this time it's

Scripts/External
Scripts/Game/Entities
Scripts/Game/Formulas

This includes a minor functional fix. I noticed while cleaning up the condition code in `PlayerEntity.cs` that the  alliance and rivalry changes, and the new ruler changes to regions were not taking effect (I wasn't properly updating the faction data dictionary). Only changes to power were taking effect. Of course we still need the rumors so this stuff is actually visible to the player.

Again, will pause here until you're OK with it. These files are more volatile than the API ones but if any merge conflicts do come up they shouldn't be hard to fix, as these are all very simple changes.

Question: I'm simplifying conditionals like

```
if (something == true)
```
and
```
return (something ? true : false)
```
to just be
```
if (something)
````
and
```
return (something)
```

and I think I prefer the shorter versions, but do you prefer having ""true"" and ""false"" written out?

Fixes:
Remove unused using statements
Fix incorrect function summary and param tags
Spacing clean up and whitespace removal
Remove deprecated DaggerfallDisease
Fix shadowed variables
Add newline at end of files
Simplify conditional expressions
Add readonly keyword where appropriate
Remove redundant return statement
Revise inaccurate comments and TODOs
Merge nested if statements
Remove redundant int to int casts
Make value const
A little safer null checking in damage calculation
Remove out-of-date comments and TODOs
Fix region alliances, rivalries, ruler data to actually update"
221654257,Fix anti-bump being applied while climbing and slipping,MeteoricDragon,2018-10-10 04:18:37+00:00,2018-10-11 00:13:34+00:00,{},"Anti- bump was being applied while climbing dungeon walls, and made the player zip to the ground when slipping and climbing."
221643473,Tally magic skills when player casts spells,numidium,2018-10-10 02:50:35+00:00,2018-10-10 05:35:24+00:00,{},This is my first time touching the effects system. If I'm doing something wrong then feel free to let me know.
221639043,Update to current master,Interkarma,2018-10-10 02:17:30+00:00,2018-10-10 02:17:38+00:00,{},
221504007,Fix St-st-st-stuttering bumps on gently rolling hills,MeteoricDragon,2018-10-09 16:22:43+00:00,2018-10-10 02:15:38+00:00,{},The minimum range for applying anti-bump gravity was too high and the max range is increased to 1.10f to compensate for adjusted minRange
221258131,Update to current master,Interkarma,2018-10-08 22:18:44+00:00,2018-10-08 22:18:53+00:00,{},
220961693,Faster flame animations,petchema,2018-10-07 17:35:03+00:00,2018-10-07 18:50:07+00:00,{},"The right speed is a bit subjective, but from memory, and watching flames on video,
it feels that torches and other flames are not fast enough.

(Unless gravity is lower in Tamriel, but from the look of physics in the
game it doesn't seem so).

I know we entered feature freeze for 0.5 (beside spells), but this is a one liner, and flames look painfully slow without this patch...
"
220947891,Allow to pay fast travel using letters of credit,petchema,2018-10-07 13:23:09+00:00,2018-10-10 02:22:56+00:00,{},"Bug report:
https://forums.dfworkshop.net/viewtopic.php?f=24&t=1332&p=15858#p15858

Behavior matches classic Daggerfall.
For improved consistency, money available includes letters of credit,
unlike classic."
220921180,Impose restriction on enemies approaching player,MeteoricDragon,2018-10-07 01:29:53+00:00,2018-10-10 02:22:38+00:00,{},"If a ground enemy sees the player at a greater pitch than 45 degrees up or down, they will wait before pursuing,  If it is a flying enemy, they will move straight up or down to get within pitch range before approaching the player.  Since all enemies are 2-dimensional, this prevents them from disappearing underneath or above the player.

I'd humbly appreciate anyone to test it and let me know what they think.  I tested ground enemies and they work,  I can't find a good situation with swimming or flying enemies to test it.  I can't cast levitate on guards to test it either."
220910850,QOL addition to auto-collect arrows,ajrb,2018-10-06 20:50:35+00:00,2018-10-06 21:25:52+00:00,{},"Archers have to collect arrows from every corpse which is, quite frankly, a serious RSI risk! This auto-collects arrows from corpses if thats the only item the corpse loot container contains.

Not sure if you want to put this in 0.6 or are happy to add to 0.5... targeted the 0.6 branch but I give you the choice. It's a very simple change done because this is a pain in the ass for archers. (i.e. my test char)"
220909934,Update to current master,Interkarma,2018-10-06 20:32:09+00:00,2018-10-06 20:32:34+00:00,{},
220904662,Show message box with special adv/disadv on history button click,numidium,2018-10-06 18:56:15+00:00,2018-10-06 20:31:12+00:00,{},This should finish giving the History button parity with classic.
220902564,Fix bug preventing items being shown for repair & identify,ajrb,2018-10-06 18:16:11+00:00,2018-10-06 20:31:36+00:00,{},Also fixed bug where identify spell initiated a trade
220751246,Added warning for staying afloat overencumbered,MeteoricDragon,2018-10-05 16:03:45+00:00,2018-10-05 21:26:34+00:00,{},I added a warning for staying afloat while overencumbered.  The duration of this message is 1.75 seconds.  I noticed that the default duration seemed a little too short. So I used 1.75 instead.
220668614,Fix reversed tolerance flags,Allofich,2018-10-05 11:22:26+00:00,2018-10-05 21:18:09+00:00,{},Noticed that these were reversed.
220550050,Bug fixes,MeteoricDragon,2018-10-04 23:56:55+00:00,2018-10-05 01:00:00+00:00,{},"Fix can't climb while sinking with overweight-ness.
Fix Anti-bump factor being too low.
Fix Rappel bug.

Discovered new bug.  When climbing onto a house with a gabled roof, the player will continue moving forward until they reach the top of the gable.  Harmless but quirky.  

I'm really unsure how to fix it...  The controller detects side collision with it, or a capsule cast detects it.  And the code is set to keep the player moving until they've stepped onto the ledge if they get past a certain height when climbing.  It does that to prevent teleporting into the sky."
220254623,Fixes bio text not reloading when loading a new game,numidium,2018-10-04 05:35:39+00:00,2018-10-05 00:59:37+00:00,{},Just a small bug fix.
220227012,ListBox quick tweaks,MeteoricDragon,2018-10-04 01:45:24+00:00,2018-10-04 02:42:41+00:00,{},"Now the highlight disappears when you aren't pointing at an entry.

Now the highlighted text on parchment background is slightly more readable through increased red value and the shadow of the text."
219884848,Highlight ListBox items with MouseOver events.,MeteoricDragon,2018-10-03 00:37:32+00:00,2018-10-03 22:18:27+00:00,{},"A graphical tweak that makes mouseover actions on list boxes highlight the text to help people see what they are clicking better, and worry less about if they're actually clicking on an item above the one they meant to point click.  It affects saved games list, spell list, talk topics, etc.  I think It turned out quite well.

I tested: Saved games list, spellbook list, Buy spells list, talk topics list."
219867488,TextureReplacement: Fix xml custom scale for UI items,rossipaolo,2018-10-02 22:43:25+00:00,2018-10-03 22:13:58+00:00,{},XMl files for scale of UI textures were only loaded from loose files location. Now they are also correctly loaded from dfmods.
219851262,Fix not deleting bio save file when deleting a save,ajrb,2018-10-02 21:28:29+00:00,2018-10-03 22:14:52+00:00,{},"@numidium Hope you don't mind me fixing this, I just happened to spot it while I was testing that new characters were initialised with mages guild as enemy of achaeologists."
219810600,fix: only stack stackable items,petchema,2018-10-02 19:00:35+00:00,2018-10-03 22:15:36+00:00,{},"Make IsStackable() even slightly more conservative about what can be
stacked, by not allowing quest items stacking;
That done, stacking no longer need quest items special handling (after a
FindExistingStack() fix, though).

I did allow stacking for ""quest"" money and standard money, because I
think some quests are paid that way in classic Daggerfall; But that may
be totally irrelevant in DFU.

It would be great to allow stacking potions, because non caster that
depend on potions can have quite a few in their inventory."
219685341,Cleaning up files,Allofich,2018-10-02 12:28:25+00:00,2018-10-10 02:22:08+00:00,{},"@Interkarma, you don't have to accept this if you want, this is just some basic cleaning up of files to try to bring them into a consistent and attractive look. I installed a refactoring tool and, while playing around with it, decided to also take the opportunity to give the various .cs files a lookover. Progress on DF Unity is so fast, with several different people working on this project, I feel like it we need to take some time to clean up the mess and get a reign on things. I think you also have been wanting to do so.

I also want to ask your opinion about various stylistic choices, to decide how to go forward. This is a bit long, just answer whichever ones you feel like.

For this PR, I went through the first .cs files, the ones in API/Save. These are also probably the cleanest files already, as they are very straightforward. They seem like a good testing ground for this.

I went through and fixed them according to some rules that I thought would be fairly uncontroversial.

- Remove unused using statements
- Remove trailing whitespace
- Add a trailing line (this is mainly to get rid of the little red icon on GitHub, but is also a convention that apparently is convenient for Unix. We could also go the other way and remove all trailing lines. But at the moment we have a mixture and should probably do one or the other)
- Fix non-uniform spacing. In general I'm using the results you get with Visual Studio's auto-format (CTRL-K and CTRL-F to format selection), which I think everything I've submitted has generally followed)
- Put declarations of same-type variables (put strings together, bools together, etc.) together, unless they are better organized some other way
- Fix other non-uniformities. For example, I found just one file that had the using statements within their own #region, so I removed that.

I wrote in each commit message the changes that were made.

Any objections to these? Is it OK to continue applying them to other files? I'm okay with whatever style rules are your preference. I don't intend to try to impose any style rule that you don't like. This is largely cosmetic, after all, but we may also uncover some bugs, or just feel better about the state of the project with cleaned up files, which I think is itself a worthwhile, motivational benefit to have.

In addition to the rules I applied above, can I ask your opinion about some other cases? If you aren't sure about any of them right now, we can just hold off on doing anything about them for now, or you could change your mind later, or whatever is good for you.

- Superfluous `else`, `this`, casts, etc. For example:

```
if (a)
   something;
   return;
else
   something
```

where the ""else"" is superfluous, but my guess is you want these for readability. I think you have already said you want to keep casts in things like ```(float) something / 4f``` for readability, and I'm guessing readability is also the reason for using ""this"" in, for example,  ```other.streamLength = this.streamLength; ```

So, my assumption is that you would like to keep these. Any comment?

- Using types like `System.Byte` instead of `byte`

In general, the files I went through use the `System.` versions, although Visual Studio offers the non-System ones as being simpler. There are a few cases, though, where non-System versions are used. Also, I don't recall seeing `System.String` used, just regular `string`. Do you have a rule or guidelines for which ones to use and why?

- Commented code. I've seen you often fix Unity warnings by commenting out code, but I think you do this for the convenience of the authors, so that they can quickly recover it (and I think that is considerate). But what about commented code that's not in actively being-worked-on code? Over at OpenMW their policy was to not leave in any uncommented code, but do you prefer to keep it? If I come across some old commented code that seems obsolete and has no comment saying it will eventually be restored, is it OK to remove it or shall we keep it?

- Default value assignments. Declared class members being assigned with values like bools to be false, integers to be 0, objects to be null, etc. that they would receive as defaults automatically. I expect this is for readability or completeness, but this is not done consistently. They are also values that are simply declared and allowed to take the defaults implicitly. What should the rule/guideline be?

Thanks. 
"
219576145,Motor fixes,MeteoricDragon,2018-10-02 03:33:01+00:00,2018-10-03 22:14:18+00:00,{},"Fixes 2 bugs

Rappelling no longer happens if you step back off short heighted walls or objects.
Anti-bump gravity now is used when going down slopes, but not when walking off cliffs

Does this by Creating a small component class for playerAdvanced called PlayerStepDetector whose value is accessed by AcrobaticMotor and ClimbingMotor.  The component class detects what the player is about to step onto by measuring the distance of RaycastHit by SphereCast downward.  The origin of this ray is offset by the player Movement vector so it detects the distance to the floor that the player is stepping onto instead of the floor directly beneath.  The component class is for efficiency and code reuse, Like VitalsChangeDetector.  Kills two birds with one stone.  Poor birdies.  Good stone.

PlayerAdvanced.prefab was auto generated with some code changes that I'm not certain are neccessary, @Interkarma please tell me if   This change is neccessary: 
```
systemTimerUpdatesPerSecond: 0.055
systemTimerUpdatesDivisor: 0.0549254
```"
219532571,Fix new custom class bug,numidium,2018-10-01 22:16:05+00:00,2018-10-01 23:16:06+00:00,{},It was a simple fix. I changed some stuff around when adding the player backstory and neglected the poor custom class.
219506904,Fix incorrect message accessor for temple rejection,ajrb,2018-10-01 20:33:45+00:00,2018-10-01 23:16:18+00:00,{},
219478753,TextureReplacement: Apply uvs flip to mobile unit,rossipaolo,2018-10-01 18:54:02+00:00,2018-10-01 23:16:45+00:00,{},
219226335,Settings window: fix free scaling,rossipaolo,2018-09-30 20:39:59+00:00,2018-09-30 22:12:41+00:00,{},
219206496,Prevent normal items from stacking with quest items,petchema,2018-09-30 14:03:49+00:00,2018-09-30 22:19:46+00:00,{},"Problem mentionned in
https://forums.dfworkshop.net/viewtopic.php?f=24&t=1274

I noticed that FindExistingStack() also makes use of a IsStackable flag, maybe quest items should not be stackable instead?"
219194919,Match name generation closer to classic,Allofich,2018-09-30 09:20:17+00:00,2018-09-30 22:17:36+00:00,{},"Changes:

1) Painting author generation matches classic.
2) Change to name generation
- Name sets re-identified to what they appear to be in classic
= Khajiit names supported
= Imperial names moved in order to ""Argonian"" index, as in classic
= ""Noble"" is a monster type
NameGen.txt edited to match above and match ordering of `NAMEGEN.DAT`
- Name generation rules matched to classic
= Changes to Redguard and Nord names (end in ""sen""), and monster names (including nobility titles)
- Should always be possible to get the same names as classic now as long as the same seed is provided to DFRandom.rand()

Notes:
- I'm not sure how classic picks monster names for quests. For now I set it to choose from Monster1 or Monster2, and not the nobility titles, which are in Monster3, since nobility titles obviously may not fit for all cases. I don't know if classic quests somehow specify the namebank, I'll try to look into that. I just tried checking the mummy wrapping quest in classic by repeatedly talking to the questgiver. It came up twice and both times it was a name with a nobility title.

- Also, the monster name code in classic includes taking gender into effect, which is replicated here. I think, though, classic just always passes in ""male"" for monster names, so the female name endings are never used. Would be a nice enhancement to support this in DF Unity.

- Names of NPCs in interiors still don't match yet."
219087526,Fix quest giver greeting context for guilds + new mod hooks,ajrb,2018-09-28 21:13:58+00:00,2018-09-30 22:16:07+00:00,{},"Nystul should check this and give his blessing before is merged, but I'm pretty sure this is correct."
218812163,Biography text,numidium,2018-09-27 23:02:11+00:00,2018-09-30 22:15:19+00:00,{},"This enables the ""History"" button on the character sheet and allows you to see your character's backstory."
218508234,Climb down from top2,MeteoricDragon,2018-09-27 02:44:46+00:00,2018-09-30 22:13:52+00:00,{},"Fixes climbing teleportation upon hitting the ground.  Also makes you dismount wall when close enough to the ground.

Fixed bugs where rappel and grasp wall in air would still work even if disabled in settings"
218035250,Climb down from top2,MeteoricDragon,2018-09-25 16:00:24+00:00,2018-09-26 01:40:31+00:00,{},Simply back up from any ledge at any angle and you'll automatically attach yourself to the wall below via a C-shaped movement
217984619,Misc. fixes,Allofich,2018-09-25 13:40:09+00:00,2018-09-26 01:53:03+00:00,{},"1) Quest AI will no longer target or be targeted by other AI. This solves the issue for now but I think we should ideally allow for spawning quest AI that can also fight each other.
2) Expanded AI to target if it can see player, as it could before, instead of limiting it to the classic spawn range. This is because the spawn is pretty small vertically, and sometimes there could be enemies in plain view that wouldn't react. I don't really like tying the AI ""activating"" it's target-seeking according to having the player in sight, but it works well enough. I also tried just using a wider radius around the player but then enemies were fighting a little too much and killing each other out of view of the player so I settled on player LOS for now, which is what the old behavior before the ""infighting"" PR was anyway.
3) Fixed issue with AI playing combat sounds, miss sounds at wrong timing.
4) Fixed referring to wrong gender value for doing AI voices, which caused mismatches between appearance and voice.
5) Fixed not playing AI hurt sounds when AI hit each other.
6) Classic only uses gender flag for fixed spawns. Doing same now for DF Unity."
217828860,Merging target branch into master,Interkarma,2018-09-25 01:03:37+00:00,2018-09-25 01:03:43+00:00,{},
217541028,Merge sdf_automap_new to master,Interkarma,2018-09-24 00:42:46+00:00,2018-09-24 00:42:53+00:00,{},"I'm happy with this to be in master now. I'll tackle the version text issue soon.

@Nystul-the-Magician Thanks for all the work on this, it looks great! üëç "
217539182,Merging RebuildMotors to master,Interkarma,2018-09-24 00:06:42+00:00,2018-09-24 00:06:53+00:00,{},
217523169,Main menu: reduce title size,rossipaolo,2018-09-23 18:19:35+00:00,2018-09-23 23:27:34+00:00,{},Reduced size of title added in #901.
217520234,Fix all enemy classes using female texture 483,Allofich,2018-09-23 17:16:19+00:00,2018-09-23 23:27:22+00:00,{},Previous fix for the small diagonal sprite was only fixing for the female thief. Other classes use the same textures and needed to be fixed as well. The check is now for the texture used and covers all the cases.
217517443,Implement AI target selection and infighting,Allofich,2018-09-23 16:15:50+00:00,2018-09-23 23:28:17+00:00,{},"This is one I was looking forward to doing, and although it could still do with improvement, mainly in enemy pathfinding, it works pretty well. Please give it some testing, though, as it touches a lot of things and could break something. I think I've fixed all the problems I encountered. There's a lot of raycasting going on but I've tried to avoid too much FPS drop.

I worked on this to prepare for the Sanguine Rose artifact, which allows the player to summon a Daedroth, but I ended up implementing an ""enemy infighting"" mode that I think is fun to play with.

What's in the PR:
1) Enemies now evaluate targets and choose one, instead of always targeting the player. (Unless ""enemy infighting"" is turned on, they reject all targets but the player. Later I intend to figure player allies into this, to allow the Sanguine Rose to work). Target selection is based on classic, then tweaked to get better results.
2) Optional ""enemy infighting"" mode (default on), where enemies of differing ""teams"" (don't really like that name, would like to call them ""factions"" but that has already has a different meaning) will attack each other if they see each other. They are grouped so similar enemies (if there are any) are on the same team.
3) Enemies can hit each other now, not just the player.
4) Pacified/guard types will ignore the player but, if ""enemy infighting"" is on, still fight any enemy teams.
5) Weapon-wielding AI will use hand-to-hand if enemy is immune to their weapon.
6) New console command ""nt"" activates ""NoTarget"" mode, where enemies will ignore player.
7) Fixed a mistake in the ""wouldBeSpawnedInClassic"" code that sometimes caused enemies to wrongly get a ""false""."
217481127,Daedra summoning completed,ajrb,2018-09-22 22:12:32+00:00,2018-09-23 23:27:03+00:00,{},
217467289,Handle custom class when doling out starting weapon,numidium,2018-09-22 17:01:03+00:00,2018-09-23 23:19:38+00:00,{},Also corrected the mage's starting weapon.
217447540,sdf font rendering support for exterior automap (hopefully with history now,Nystul-the-Magician,2018-09-22 09:04:44+00:00,2018-09-23 23:19:13+00:00,{},"sdf font rendering support for exterior automap (hopefully with working history now)

I fixed the tool tip issues mostly (except that I have this question (I use defaultToolTip for the moment): https://forums.dfworkshop.net/viewtopic.php?f=23&t=1281

**I would suggest to test and play around in a branch for now ;) at least until we are happy with the tooltip issues mentioned below **

worth noting are these 2 changes to ToolTip class:
line 157-160 was necessary to fix this issue: https://imgur.com/31aMknB
fixed it looks like expected: https://imgur.com/23eNChC

line 140-145 fixes this issue: https://imgur.com/tbvOsd4

I tested and it seems to work ok with tooltips in other windows
there is this issue: https://imgur.com/LiUTYs7 -
a leftover after tool tip hides again but tooltip was displayed outside its parent panel - I might need your help here - but I experience the issue also without the changes to ToolTip class
another problem is that when the automap is open the version string in the top right screen corner (or better said the part outside the automap panel) is sometimes drawn, sometimes not - see screenshots above - the ""flickering"" is coming from my changes, but before it was always cut (which is also suboptimal)"
217436803,Fix LevitateMotor Collisions via hack,MeteoricDragon,2018-09-22 03:30:00+00:00,2018-09-23 23:17:10+00:00,{},"Refactor IsStandngStill to a property.
make hitting head bounceback an acrobatic method.
Rename a couple local variables in PlayerGroundMotor

Hacks the inability of CharacterController to detect collisions while stationary by moving him a little tiny bit up, down, left, right, forward, back directions an imperceptible amount by calling the movement function in groundmotor.  Now a moving platform can come from any direction and push against the player and it will move the player appropriately."
217358936,Overhaul main menu,rossipaolo,2018-09-21 18:01:49+00:00,2018-09-22 03:54:39+00:00,{},As discussed on https://github.com/Interkarma/daggerfall-unity/pull/877#issuecomment-421826527. Tell me what you think :)
217318278,"sdf font rendering support for exterior automap (no rebase, just merge - still too much for diff how it seems)",Nystul-the-Magician,2018-09-21 15:19:17+00:00,2018-09-22 09:00:29+00:00,{},"sdf font rendering support for exterior automap
no rebase, just merge - still too much for diff how it seems
anyway I fixed the tool tip issues mostly (except that I have this question (I use defaultToolTip for the moment): https://forums.dfworkshop.net/viewtopic.php?f=23&t=1281

**I would suggest to test and play around in a branch for now ;) at least until we are happy with the tooltip issues mentioned below **

worth noting are these 2 changes to ToolTip class:
line 157-160 was necessary to fix this issue: https://imgur.com/31aMknB
fixed it looks like expected: https://imgur.com/23eNChC

line 140-145 fixes this issue: https://imgur.com/tbvOsd4

I tested and it seems to work ok with tooltips in other windows
there is this issue: https://imgur.com/LiUTYs7 -
a leftover after tool tip hides again but tooltip was displayed outside its parent panel - I might need your help here - but I experience the issue also without the changes to ToolTip class
another problem is that when the automap is open the version string in the top right screen corner (or better said the part outside the automap panel) is sometimes drawn, sometimes not - see screenshots above - the ""flickering"" is coming from my changes, but before it was always cut (which is also suboptimal)"
217130661,Merging in-progress PoisonEffect branch to master,Interkarma,2018-09-20 23:04:33+00:00,2018-09-20 23:04:40+00:00,{},I will progress this feature set soon.
217104126,Daedra summoning initial implementation ,ajrb,2018-09-20 20:55:19+00:00,2018-09-22 03:54:09+00:00,{},"Daedra summoning is working but doesn't play the vid files and uses normal message boxes instead for the time being. The new class DaggerfallDaedraSummonedWindow is currently unused. It's a stub which will play the video and display text and accept Y/N entry - this will replace the message boxes.

Also:
* Fixed all of the Daedra Lord/Lady quests.
* Added pickpocket skill tally for shoplifting.
* Tidied up macrosExpandedAlready mechanism.
* Added faction flags accessor methods and associated enum.
* Fixed static message box helper methods to use mcp's.
* Fixed quest completion macro expansion bug.
"
216887240,SDF support for exterior automap,Nystul-the-Magician,2018-09-20 08:36:11+00:00,2018-09-20 09:54:12+00:00,{},"implemented font rendering with textlabel class for exterior automap - supports SDF font rendering now
there is one bug with tooltips - their text is not rendered if tooltip is too big for automap window (background is rendered though) - I am looking into this but it is a bit tricky - related to restrictedRenderArea but could not find the reason for it

hopefully  this pull request works - I tried to rebase before issuing it - this is my first try to rebase and had to create a new local branch since git would not allow me to push it into existing local branch - I don't understand it quite right - but it looks like it should be ok with only one commit now"
216809499,Update to current master,Interkarma,2018-09-20 00:01:33+00:00,2018-09-20 00:01:39+00:00,{},
216808533,Merging ClimbingWrap,Interkarma,2018-09-19 23:54:32+00:00,2018-09-19 23:54:54+00:00,{},"@MeteoricDragon Hey mate, this is awesome. Having a blast playing around with this on my Khajiit with Climbing and Jumping spells. Haven't found any real bugs yet, it feels solid.

Have only found one very minor thing. When Advanced Climbing System is enabled, players can still jump and grab walls. Otherwise, the classic climbing feels great also."
216805100,Update to current master,Interkarma,2018-09-19 23:28:42+00:00,2018-09-19 23:28:49+00:00,{},
216793689,Update to current master,Interkarma,2018-09-19 22:19:56+00:00,2018-09-19 22:20:02+00:00,{},
216446784,Climbing speed refactor,MeteoricDragon,2018-09-18 21:16:01+00:00,2018-09-18 22:11:58+00:00,{},Quick refactor of climbing speed to PlayerSpeedChanger
216298098,Fix IndexOutOfRangeException,Allofich,2018-09-18 12:57:52+00:00,2018-09-18 22:11:27+00:00,{},Fixes https://forums.dfworkshop.net/viewtopic.php?f=24&t=1263. Also I must have accidentally added a few extra enemies onto the cemetery list earlier that aren't in there in classic.
216287803,Fixes,Allofich,2018-09-18 12:22:02+00:00,2018-09-18 22:11:47+00:00,{},"Fixes poison enum problems. Sorry about that.

Also fixes/adjustments to the combat voices. I had left off dark elf female in one part. Also I switched out male high elf on NPCs for male wood elf. The high elf sound sounds a little ""breathing into the mic""-ish and might be okay for 1st person but doesn't sound very good coming from third-person.

Adjusted the ""heavy damage"" female pain sound to play based on character's max health compared with damage instead of looking only at the damage amount.

I might later add sounds for civilians, some non-class enemies, etc. I'll have to check how it feels in-game."
216114068, Implement selling magic items at fence in TG ,ajrb,2018-09-17 21:02:55+00:00,2018-09-18 03:59:22+00:00,{},"Also disabled jumping with cart which I always intended to do.

@Allofich It currently re-uses the same calculation for cost. However UESP states ""Appraisers will buy magical items from any member who is at least a Filcher in the Guild. They offer higher base prices than other merchants. The final price for your items is affected by your reputation with the faction."" This implies that the function will need guild rank to be passed instead of building quality. If you give me the equation for the formula I'm happy to implement it... you do seem to have a few plates spinning right now. :-)"
216073021,Add race/gender attack and hit sounds,Allofich,2018-09-17 18:28:17+00:00,2018-09-18 04:01:20+00:00,{},"On by default, but can be turned off. Happens a percentage of the time when melee attacking or being hit, both for the player and for enemy classes.

Male sounds are pretty straight-forward, with unique sounds for each race.
Female sounds were a mixture. Some sounds are duplicates, and some races only seemed to have attack sounds or only pain sounds. I spent a fair bit of time listening to the sounds and working out a solution that ends up working pretty well. It basically works out to humans, elves, khajiit and argonians as 4 groups, with various bits of crossover.

Just for the purposes of sounds, each enemy class is randomly assigned a race (Breton through High Elf), to add some variety. This isn't saved or loaded at the moment, and is just intended to be for that character's voice, not to actually serve as the race."
215984727,Save and load poisons on weapons,Allofich,2018-09-17 13:37:56+00:00,2018-09-18 04:02:19+00:00,{},Uses an enum matched to the IDs that would be found from poisons on weapons in classic.
215856810,Biography quiz for new characters,numidium,2018-09-17 01:08:22+00:00,2018-09-19 22:19:29+00:00,{},"In classic, the quiz also generates the player's backstory that you can view with the History button but that's another PR's worth of work.

From the testing I've done I see that the granted starter items more or less work for all the classes' quizzes. I haven't tested it with custom quizzes so I don't know if artifacts will work.

I found one minor issue: selecting ""a pearl"" adds an emerald instead. The item enums match up with the arguments I'm passing to CreateItem but somehow the item that it fetches from the item template list ends up being an emerald."
215854566,Climbing wrap,MeteoricDragon,2018-09-17 00:28:00+00:00,2018-09-18 04:04:24+00:00,{},"Fix climbing teleportation bug by preventing the situation that causes it.  Force the player to finish climbing if almost done climbing, e.g. no mesh collider is in front of him.
Works nicely.

Implements a wrapping around corners system that allows the player to wrap around wall corners.

Debug Rays are still drawn because there may be errors left.  Please only comment them out and don't remove.

Implements luck into the climbing factor.

"
215835766,Framework for implementing poisons,Allofich,2018-09-16 17:43:15+00:00,2018-09-16 21:39:38+00:00,{},"This PR sets things up for you to implement poisons.

First, what this PR does:
1) Enemies have a chance to get poisoned weapons (matched to classic)
2) Poison inflicted on weapon hit, resistances and saving throws to sop it (matched to classic with bugs fixed)
3) Poison infliction by drugs (matched to classic)
4) Console command to add drugs
5) Includes code for setting up poison properties (minutes until start, damage)

No actual poison effect is in, just a debug message.

There are 12 poisons in the game. 0-7 are weapon poisons, 8 through 11 are the drugs. I just referred to them with an `int`, but you might want to use an enum. In addition to the drugs, I found names in `FALL.EXE` that appear to match for the poisons, so we have a name for all the poisons. See the pseudocode below.

The effect of a poison is very similar to a disease, so you should be able to pretty much re-use that code. The difference is a ""round"" of the poison effect is 1 game minute, rather than 1 game day. Also rather than starting at 0:00 of the next day, they start after a randomly chosen number of minutes.
If inflicted with a poison, textID 117 should show in the status window and when clicking `HEALTH` in the character sheet.

The effects of the 12 poisons are hard-coded (SPELLS.STD is unrelated, as far as I can see).
The function (called for every game minute) that applies poison effects looks like this:

```
  if ( poison.minutesUntilStartingPoison == 0 )
  {
    if ( poison.state == 0 )
      poison.state = 1; // State is no longer 0, can show ""You have been poisoned."" in status
    if ( poison.type <= 11 ) // 11 valid types
    {
      switch ( poison.type )
      {
        case 0: // Nux Vomica
          int damage = DFRandom(2, 12); // ""DFRandom"" means a random value between (min, max)  inclusive of both min and max
          ApplyHealthDamage(target, damage);
          break;
        case 1: // Arsenic
          ApplyHealthDamage(target, 2);
          target.Endurance--;
          if ( target.Endurance < 1 )
          {
            target.Endurance = 1;
          }
          poison.state = 2; // Can be cured as disease after finishing all rounds
          break;
        case 2: // Moonseed
          int damage = DFRandom(1, 10);
          ApplyHealthDamage(target, damage);
          break;
        case 3: // Drothweed
          int damage = DFRandom(5, 10);
          target.Strength  -= damage;
          if ( target.Strength < 1 )
          {
            target.Strength = 1;
          }
          damage = DFRandom(1, 5);
          target.Agility -= damage;
          if ( target.Agility < 1 )
          {
            target.Agility = 1;
          }
          damage = DFRandom(1, 5);
          target.Speed -= damage;
          if ( target.Speed < 1 )
          {
            target.Speed = 1;
          }
          poison.status = 2; // Can be cured as disease after finishing all rounds
          break;
        case 4: // Somnalius
          int damage = DFRandom(10, 100);
          ApplyFatigueDamage(target, damage); // remember to multiply by 64 for fatigue modifications
          break;
        case 5: // Pyrrhic Acid
          int damage = DFRandom(1, 30);
          ApplyHealthDamage(target, damage);
          break;
        case 6: // Magebane
          int damage = DFRandom(1, 5);
          target.Willpower -= damage;
          if ( target.Willpower < 1 )
          {
            target.Willpower = 1;
          }
          target.CurrentSpellPoints -= DFRandom(5, 15);
          if ( target.CurrentSpellPoints < 0 )
            target.CurrentSpellPoints = 0;
          poison.status = 2; // Can be cured as disease after finishing all rounds
          break;
        case 7: // Thyrwort
          int damage = DFRandom(5, 20);
          target.Willpower -= damage;
          if ( target.Willpower < 1 )
          {
            target.Willpower = 1;
          }
          damage = DFRandom(10, 20);
          target.Personality -= damage;
          if ( target.Personality < 1 )
          {
            target.Personality = 1;
          }
          poison.state = 2; // Can be cured as disease after finishing all rounds
          break;
        case 8: // Indulcet
          int damage = DFRandom(10, 100);
          ApplyFatigueDamage(target, damage);
          int bonus = DFRandom(4, 10);
          target.Luck += bonus;
          poison.status = 2; // Can be cured as disease after finishing all rounds
          break;
        case 9: // Sursum
          int damage = DFRandom(10, 30);
          target.Intelligence -= damage;
          if ( target.Intelligence < 1 )
          {
            target.Intelligence = 1;
          }
          int bonus = DFRandom(5, 20);
          target.Strength += bonus;
          poison.status = 2; // Can be cured as disease after finishing all rounds
          break;
        case 10: // Quaesto Vil
          int damage =  DFRandom(1, 4);
          target.Willpower -= damage;
          if ( target.Willpower < 1 )
          {
            target.Willpower = 1;
          }
          int bonus = DFRandom(5, 10);
          ApplyFatigueDamage(target, -bonus);
          poison.state = 2; // Can be cured as disease after finishing all rounds
          break;
        case 11: // Aegrotat
          int damage = DFRandom(1, 5);
          target.Endurance -= damage;
          if ( target.Endurance < 1 )
          {
             target.Endurance = 1;
          }
          int bonus = DFRandom(5, 10);
          target.CurrentSpellPoints += bonus;
          if ( target.CurrentSpellPoints > target.MaxSpellPoints )
            target.CurrentSpellPoints = target.MaxSpellPoints;
          poison.state = 2; // Can be cured as disease after finishing all rounds
          break;
      }
    }
    DaggerfallUI.AddHUDText(UserInterfaceWindows.HardStrings.youFeelSomewhatBad);
    if ( poison.RemainingRounds > 0 )
    {
      --poison.RemainingRounds;
    }
    else // All rounds done
    {
      if ( poison.State != 2 ) // If not curable as a disease (i.e., no attributes affected), stop here
        return;
      poison.curableAsDisease = true; // What actually happens here is classic sets the poisonType to 0. Poisons in classic are actually types 128 and up (diseases are below that). By setting the poisonType low, it should be recognized by the cure disease function (either at a temple service or through a potion/spell, which ignores the 128 and up poison types), allowing restoring of the lost attributes.
    }
  }
  --poison.MinutesUntilStartingPoison;

```

Note that classic is missing a check that there are poison rounds remaining before applying the effects. This makes the poison rounds only have a meaning for the types that are ""curable as diseases"" after finishing. http://en.uesp.net/wiki/Daggerfall:Poison also talks about poisons going indefinitely. I think this is probably an oversight and we should check that poison rounds remain before applying effects. If no attribute damage was done (not ""curable as a disease""), the poison could just be removed when it runs out of rounds (i.e. passed from the character's system), as curing it at that point would have no effect anyway."
215831687,Implement shoplifting,ajrb,2018-09-16 16:21:16+00:00,2018-09-16 21:38:53+00:00,{},"Guards currently spawn outside the shop due to min spawn distance I think. I like this in one respect that you can't simply flee to the exit and escape like you can in classic, but it does feel like you are getting away with stealing until you leave and see the dozens of guards waiting for you...

Allofich, can you check the formula I added please? I took it from chronicles.  PlayerEntity.SpawnCityGuards() needs more work, as you probably already know."
215820183,Mod localization: use string literals in exported table,rossipaolo,2018-09-16 12:23:05+00:00,2018-09-16 21:38:07+00:00,{},Continue #873 using string literals introduced in 9d1502c06a5f67f369bdebd01c0660c08e84dbb6.
215819492,Update game settings window / 2,rossipaolo,2018-09-16 12:06:32+00:00,2018-09-16 21:37:43+00:00,{},"This continues from #877.
Removed a duplicate key and added new light options as well as freescaling, which was missing.

Ps: @Interkarma do you get notifications for new messages in closed PRs? Just wanted to make sure you received my last post :)"
215776558,Painting info finished,ajrb,2018-09-15 16:12:43+00:00,2018-09-16 04:46:40+00:00,{},"Display painting images in info popup.
Filter painting titles for info panel."
215710821,Initial version of painting info construction,ajrb,2018-09-14 21:03:06+00:00,2018-09-14 21:33:29+00:00,{},"Painting titles match classic.
Artist names don't match classic. 
Image not displayed yet."
215606213,Implement classic music selection,Allofich,2018-09-14 14:07:47+00:00,2018-09-14 21:35:31+00:00,{},"This recreates classic music selection when playing with a General MIDI midi device, since we were so close to it already. I did notice one video on YouTube where someone remarked that the music in Privateer's Hold was different from classic, but it matches with this PR, as should all dungeons.

The music played when in exteriors or taverns is determined by the game day. So a particular date in the game always plays deterministic songs. Temples play a song determined by the faction of that temple. Dungeons play songs depending on a value only being referred to so far as ""Unknown2"", and the region number they are in. If you load a classic save and compare importing it to DF Unity, you should have the same music playing in all cases, except when it's snowing and possibly when at night or outside a dungeon.

The results aren't exactly the same because what seem to be a couple mistakes in classic are fixed (as they already are in master). One is that general MIDI in classic doesn't play 21.HMI at night or outside dungeons, that entry in the song list is just a duplicate of 10.HMI, even though when using FM MIDI it does use 21FM.HMI for that entry in the list.

The other is that classic does not use SNOWING.HMI, the 4th and last song in the snow music list. When choosing a snow song it only picks from the first 3. Considering that, as with other songs, the FM music list fills out that same slot (by using a duplicate FMOVER_C.HMI entry), and that SNOWING.HMI sounds fine, I think this might have been a mistake in classic. Because of using 4 songs instead of 3, though, the song selection for snowing at daytime doesn't match classic."
215594215,Update game settings window,rossipaolo,2018-09-14 13:27:34+00:00,2018-09-14 21:36:04+00:00,{},"Gameplay settings window was overflowing so i moved some settings to their own page. Took the occasion to add audio settings. There are some other settings from ini to add, but first i wanted to make sure this quick fix is in the next build."
215425540,Fix bank manager exception when no gold in wagon,ajrb,2018-09-13 21:46:34+00:00,2018-09-13 23:04:08+00:00,{},
215326783,Fix reading classic magic item names,Allofich,2018-09-13 15:38:50+00:00,2018-09-13 23:04:26+00:00,{},"Items in classic saves should only have their names read up until the null terminator. This is because when classic creates a magic item, it first creates the base, non-magic item, including its name, and then it overwrites the name with the magic item name. Since the magic item names use the %it macro in place of the original names, they can be shorter than the original names, leaving the tail of the original name after the null terminator.

In my case I have a save game with ""Cursing Champion straps"". The name in SAVETREE.DAT is ""Cursing %it(null)aps"", because ""Cursing %it(null)"" was written over the ""Champion str"" part of ""Champion straps"". It showed up in Daggerfall Unity as ""Cursing Champion straps aps"". With this PR it shows correctly."
215306498,Fix enemy animations,Allofich,2018-09-13 14:39:53+00:00,2018-09-13 23:04:44+00:00,{},"I noticed that there were still several issues with enemy animations, but I think (and hope) this should resolve all the problems.

1) Enemy female thief has a small animation frame in the idle animations when looking diagonally. There used to be a fix for this but I removed it in https://github.com/Interkarma/daggerfall-unity/pull/483 because I noticed the female thief being stretched too large when attacking diagonally. The old fix was for all diagonal animations but it's only the idle animations where the problem is. Also, better than stretching the sprite as the old fix did, there is a correct-size diagonal idle, misplaced among the hurt animations for some reason. Now that is used and it looks correct in-game.

2) In that PR I also removed a fix for the rat, because I noticed it being flipped when it shouldn't. On closer inspection it needed a more customized fix, because it's just the 3 mid-way frames between ""towards player"" and ""away from player"" that needed flipping.

 3) I also confirmed wrong-way animations for the werewolf, slaughterfish and scorpion. It also would have been wrongly flipped for other enemy types using ""move"" animations for their idle that we weren't specifically doing a correction flip on, meaning the wereboar and dragonling.

4) Fixed the ghost and wraith. Both needed the sideways animation for their move/idle and their attack to be flipped.

5) There was a logic error here:

            ```
            // Scorpion Idle and Move animations need to be inverted
            if (summary.Enemy.ID == (int)MobileTypes.GiantScorpion &&
                summary.EnemyState == MobileStates.Idle || summary.EnemyState == MobileStates.Move)
                flip = !flip;
            ```
     
      which was always being true for any moving enemy, which led to the moving animations being defined as needing to be flipped when they didn't really need to be. This is also why !HasIdle enemies using move animations for their idle were seemingly needing to be flipped (I had set giant bat, imp, dreughs and lamias to be flipped this way, because I had noticed them all being reversed, but it was actually all !HasIdle enemy types)
"
215293877,Support for mod localization,rossipaolo,2018-09-13 14:02:50+00:00,2018-09-13 23:05:02+00:00,{},"This PR aims to provide a standard localization interface for mods.

### Concept
A mod called **modname** is automatically linked to a file named **mod_modname.txt** in _StreamingAssets/Text_ and/or a file name **textdatabase.txt** inside the mod bundle. The table in _StreamingAssets_ takes precedence.

### Settings
The file **settings.json** bundled with a mod provides informations used by the mod manager to draw controls in the mod settings window and store values to a local file. This includes setting names and descriptions/tooltips. These text string are seked automatically in the language table using the following patterns:

```
Mod.Description
Settings.SectionName.Name
Settings.SectionName.Description
Settings.SectionName.KeyName.Name
Settings.SectionName.KeyName.Description
Presets.PresetTitle.Title
Presets.PresetTitle.Description
```
If a key is missing, the default value from **settings.json** is used. This means there is no need to provide an english table. No support is required from individual mods, this is all managed by the mod manager.

### Mod Strings
The Mod instance includes a method called `Localize()` which can be used to seek additional localized strings from the text table. The key can be a string or a succession of strings wich are concatenated.
```
string Localize(string key) // key, text
string Localize(params string[] keyParts) // a.b.c, text 
```

`Fountain.Drink, Press key to drink at the fountain.`
`string text = mod.Localize(""Fountain"", ""Drink"").`

If a key is not found in the table from the Text folder, is seeked in the fallback table inside the mod.  This means that no additional files other than the dfmod are required for a standard english version. Mod developers only need to export strings to a text file and build it as an asset.
"
214166372,4 Directional Climbing and jumping to and from walls.,MeteoricDragon,2018-09-09 21:39:35+00:00,2018-09-10 21:15:03+00:00,{},"Implements a toggleable, true by default advanced climbing system.

4 directional climbing, the ability to pause climbing, Look around in any direction.
The ability to jump off a wall when climbing, onto another wall (skill check required).  Can also initialize a climb by jumping from the ground onto a wall with a skill check.

Known issue:  The checkbox setting on the gameplay section of the advanced settings page is out of margin, but still clickable."
214095867,Fix legal reputation persisting into older saves,Allofich,2018-09-08 13:38:00+00:00,2018-09-08 21:18:04+00:00,{},Fixes https://forums.dfworkshop.net/viewtopic.php?f=24&t=1255.
214079977,Prevent classic spawn check result getting stuck,Allofich,2018-09-08 06:09:26+00:00,2018-09-08 21:18:26+00:00,{},"Always reset to false first in case the player teleports from being nearby
enemies to not being nearby enemies."
214046114,Merging Faction fix,Interkarma,2018-09-07 21:40:30+00:00,2018-09-07 21:40:36+00:00,{},
213749539,Remove support for obsolete modsettings format,rossipaolo,2018-09-06 21:02:53+00:00,2018-09-07 21:46:36+00:00,{},"Initially mod settings file was named _modfilename.ini.txt_, then was changed on Lypyl suggestion to _modsettings.ini.txt_ to avoid breaking if mod filename was changed. It's been a while since we moved from plain textboxes to a json-based window with typed controls, so i think it's time to remove support for the oldest one.

I'm confident no mod is using it but tell me if i'm wrong,  I want to be sure not to break any existing mod  :)

I'm not in a hurry to stop supporting _modsettings.ini.txt_, but i slightly changed the log message printed during the automatic local upgrade to reflect this change."
213471535,Climb update,MeteoricDragon,2018-09-06 01:32:19+00:00,2018-09-07 21:45:49+00:00,{},"Fixes all known bugs with climbing, including falling when climbing a long wall out of the water.  Slips are no longer meaningless.  Implements a skill check system like the system described in UESP for classic DF.

Player now has a chance to climb successfully, a chance to slip, and a lower chance to regain hold and continue climbing.  All chances can be offset by having a high skill in climbing.

70% base chance of success for continuing to climb per skill check.  A player with 50 climbing skill would boost this to 85% and 75 would boost to 92.5%

20% base chance of regaining hold (at 37% of climbing skill check's wait time).  a player with 50 skill would boost this chance to 60%, 75 skill boosts it to 80%

As an added bonus, once the player is climbing, they can swivel around and look in any direction as long as they hold the forward key and keep in mind when they reach the top they'll move in the direction they are facing!  They can also slip and catch and won't move away from the wall while looking elsewhere.

"
213404186,Allow gold stored in wagon to be deposited at a bank,ajrb,2018-09-05 19:34:33+00:00,2018-09-07 21:44:32+00:00,{},
213398691,Improvements for mod settings editor,rossipaolo,2018-09-05 19:12:31+00:00,2018-09-07 21:43:49+00:00,{},"* Store mod that is being edited for the next session.
* Make save on exit without confirmation optional.
* Fixed an issue which could cause new values to be stored incorrectly to presets if added to settings and immediately saved without a ""refresh""."
213338314,Match non-LOS sense of player to classic,Allofich,2018-09-05 15:33:43+00:00,2018-09-07 21:43:09+00:00,{},"Should fix https://forums.dfworkshop.net/viewtopic.php?f=24&t=1227, in as much as it generally matches the range to classic.

This could maybe be tidied up a little but I wanted to get it in before the release which is probably upcoming.

Background of the issue:
In classic, enemies can detect the player without having LOS, through walls, etc., depending on a roll against the player's stealth skill. This is why they sometimes open doors and come out of rooms at you, etc. I implemented this a while ago but not the correct range at which the check should happen. Enemies were approaching the player from a lot further than in classic, and enemies weren't being found in their expected spots in Privateer's Hold, etc. This may also have been making it more difficult to find a spot away from enemies to rest. In classic the stealth check itself has a big range but it's limited by the spawn/despawn range, because AI characters won't be active to do the check unless they are near the player. It turns out a byte in the spawn markers, from 0 through 6, determines the X-range and Y-range from the player at which an enemy spawns/despawns (the distances for spawning and despawning are a little different). That is recreated by this PR now, using these distances to limit the range of their stealth detection, effectively recreating classic behavior, but without actually spawning and despawning them.
"
212996290,Fix out-of-bounds array access in older saves,Allofich,2018-09-04 14:26:32+00:00,2018-09-04 21:47:08+00:00,{},"Seems that at some point we changed from storing region IDs of factions from 0-based to 1-based. Maybe I had something to do with that, I don't remember. This was causing an IndexOutOfRangeException in RegionPowerAndConditionsUpdate(), which subtracted 1 from the region ID because I wrote it assuming the newer, 1-based behavior.

This PR fixes this issue by returning to using 0-based, fixing 1-based saves to be this way. Alternatively we could make them all 1-based, but I prefer 0-based for a few reasons:

1) Classic also converts the 1-based region IDs in FACTION.TXT to 0-based internally, and saves them this way in SAVEVARS.DAT. If we decide to import those region IDs from SAVEVARS.DAT (we aren't now), it will be more straightforward to use the same values.

2) Using 0-based allows me to change a bunch of ugly `(region -1)` expressions to just `region`.

3) 0-based matches the region numbers on UESP. "
212808485,Fix issues with guild NPCs that have no/bad building faction data,ajrb,2018-09-03 19:14:30+00:00,2018-09-04 21:46:15+00:00,{},I'm back. :-)
212657147,"fix for merchants ""I am a member of unknown-guild"" bug",Nystul-the-Magician,2018-09-03 07:02:28+00:00,2018-09-04 21:45:40+00:00,{},"fix for merchants ""I am a member of unknown-guild"" bug
(see https://forums.dfworkshop.net/viewtopic.php?f=24&t=1240)"
212656443,Merging ClimbingSwimBreakthrough,Interkarma,2018-09-03 06:58:36+00:00,2018-09-03 06:58:51+00:00,{},
212617849,Fixes Falling in water when climbing,MeteoricDragon,2018-09-02 23:55:20+00:00,2018-09-03 04:23:44+00:00,{},"Fixes Falling in water while climbing by adding a buffer that the player cannot fail climbing above water level.

Allows the player to look left and right a little bit while climbing, but doesn't reduce the shallowness of the angle the player needs to look to start climbing.

Uses a CapsuleCast to tell if the player should stop climbing and start going forward, and gets the direction of the ledge the player will be climbing onto.  Forces the player's horizontal move direction towards the ledge directly.

This leaves the skill check open.  @Interkarma  what kind of number checks do you want for the skill check system?  I'm thinking the current skill check system is insufficient?  a player with 5 climbing skill should have terrible trouble climbing but with the current system, a player with 50 climbing skill would have a 50% chance of falling every skill check.  And falls have no real consequence, the player just slips a bit.

I'm thinking the likelihood of falling should scale with height climbed. as well as skill of course"
212609426,"fixed wrong npc portraits in daggerfall, wayrest and sentinel castle",Nystul-the-Magician,2018-09-02 20:08:45+00:00,2018-09-02 23:14:01+00:00,{},hope I got all of them ;)
212568535,Swim crouch climb,MeteoricDragon,2018-09-01 23:23:48+00:00,2018-09-01 23:38:32+00:00,{},A few fixes to climbing and swimming
212550362,Finish implementing reflexes,Allofich,2018-09-01 14:58:46+00:00,2018-09-01 21:30:50+00:00,{},As far as I know this should be it for reflexes.
211949205,Swimming climb up,MeteoricDragon,2018-08-30 04:02:04+00:00,2018-08-30 11:09:02+00:00,{},"The last commit in this PR has lots of experimental changes to the climbing system.  The others are the groundwork for a new climbing system mostly.

Things to try with this code:  

- Climbing outdoor buildings.
- Climbing dungeon walls.
- Climbing dungeon walls while aimed at doors. Curious results.
- Climbing onto dry land from water.
- Climbing starting from underwater if feeling adventurous."
211821901,Implement classic melee timer and reflexes,Allofich,2018-08-29 16:56:19+00:00,2018-08-30 11:07:41+00:00,{},"Things this does:

- Implements classic melee timer
- Fix what seems to be oversight in classic where higher speed enemies would instead attack less
- Implements reflexes as in classic. This is in classic, too, but like so many things does not seem to work correctly (I swear, it's like they purposely left the game with a random thing missing/reversed, etc. in every game mechanic so we'd have the fun of patching the holes), because the value it refers to in the enemy object data seems to always be 0 and is not ever set by anything, so no matter what reflexes setting you choose it seems enemies attack at ""very high"" reflexes in classic. Luckily, although having this correctly refer to the reflexes setting slows down attacks at, for example, the ""average"" setting of 2, I think the above fix more or less offsets this, as many enemies have high speed attributes. At any rate the resultant attack rates seemed OK in testing.

BTW reflex setting is also supposed to affect skill increases, but I don't think that's in yet. It may also have another effect on attacks that isn't in yet.

- Matched enemy melee range to classic (128 Daggerfall distance units). Doing this also automatically updated the enemy prefabs in other ways, although I'm not sure if those updates actually affect anything or not."
210930213,Merging SwimmingImprovements to master,Interkarma,2018-08-26 02:18:08+00:00,2018-08-26 02:18:15+00:00,{},
210900853,Recreate classic way of choosing random enemies,Allofich,2018-08-25 12:37:06+00:00,2018-08-26 02:14:55+00:00,{},"This implements the issue raised in https://forums.dfworkshop.net/viewtopic.php?f=24&t=560, which was closed as ""intended"". It should also address the issue raised here: https://www.reddit.com/r/daggerfallunity/comments/96pmzc/the_enemies_in_daggerfall_unity_are_way_off_and/

Classic selection is enabled by default. Previous random selection can be turned on by enabling ""Alternate Random Enemy Selection"" at the startup screen. (except the alternate, undead-heavy cemetery list for DF Unity is commented out and classic's list is being used now)

Basically how it works: As you know, there are `RANDOM MON` markers that make random enemies and `MONSTER` markers that make fixed enemies. Random enemies, though, are not completely random in classic. Most seem to have a value set in their ""flags"" part of the rdb resource data, and this is used to choose from a list of enemy types that is created for that dungeon (which is determined using dungeon ID as a seed for the random generator, with the player's level as an input that determines the result). There are some that don't have any value for the ""flags"" data, in which case it's a random choice from 1 to 6, without a set seed to use, so these vary every time you leave/enter the dungeon.

This doesn't affect ""random encounters"" that spawn intermittently in exteriors or that interrupt player rest. I might look at those later."
210635848,Exposed waterFogColor with get: set: public variable,MeteoricDragon,2018-08-24 04:25:11+00:00,2018-08-26 02:09:31+00:00,{},Simple change to allow modders to change the color of the underwater fog
210499298,Shorten enemy stealth check range,Allofich,2018-08-23 16:04:36+00:00,2018-08-26 02:09:22+00:00,{},"Since I allowed enemies to detect the player through walls with the stealth check (check between the player and the enemy's stealth stats), they are detecting from a little too far away. Someone who did a video on YouTube was wondering if the game was bugged. Adjusting it down to the value in this PR seems to help for now. In classic the actual stealth check uses a distance of 1024 but I think it's also limited by the distance of enemies before they are unloaded, which I don't fully understand but I think is around 768 in interiors (1024 in exteriors)."
210487359,Match enemy attack animations to classic,Allofich,2018-08-23 15:25:45+00:00,2018-08-26 02:09:07+00:00,{},"This one is a nice improvement. I figured out how to read the `.ANC` files in `MONSTER.BSA`, which define the frame sequences of animations and frames on which damage attempts or arrow shots occur, and probabilities for different frame sequences. I added this information in to the enemy definitions and use it now for enemy attack animations. This allowed me to remove the ""hit frame"" stopgap solution I put in earlier. In removing that I needed to adjust the calculation for attack timing, and that ended up with raising the distance from which enemies will attempt attacks. It could still use refinements but it makes enemy attacks less predictable and IMO more realistic, and makes it not so easy to just mow them down and never get hit by melee attacks. (Although the game may be tough in the beginning when your attacks are slow and missing a lot, I think in current master it may be too easy once you can start reliably hitting opponents. This should help with that.)

We could read in the  `.ANC` files but I don't see an advantage to doing so. Also if we used it exactly like classic we would inherit some animation bugs from classic, so it was easier to just re-create the data in the enemy definitions. The only data in those files that is of interest to us is the attack animations.

There are also sequences for each spell-casting enemy for their casting animations. I'll add those when enemy spells are in.

As a bit of a side-note, I'd like to get enemy classes and the player to start shooting 3d arrows (as in classic, although it's not easy to see them because of the lower resolution) instead of just doing instant hits. Has the progress on spells made it easy to create projectiles in the world? Are you interested in implementing 3d arrow projectiles yourself, Interkarma?

BTW, some mistakes in the classic files I found were:

1) The rat is unusual in having more than 4 animation frames in its walk, but it only uses 4 in classic. Since everything else uses 4, they probably forgot to configure the rat to use them all. You'll see in classic it has a jerky animation because of this, unlike in DF Unity.

2) The orc shaman has the most possible types of attack frame sequences at 5 types, but 2 of them aren't used in classic. For some reason when those 2 would be used, instead the spell casting or standing still animations are used. I configured DF Unity to use those 2 unused animation sequences as was probably intended.
"
209698146,Swimming improvements,MeteoricDragon,2018-08-21 03:21:52+00:00,2018-08-24 04:01:30+00:00,{},"- Implements a smooth underwater fog,  if the player is partially underwater, the fog fades partially in, until the camera is under.  This eliminates the blinking sensation that happens when exiting/entering water.

 - commented out a toggle for global fog because it was there to fix an issue with solid camera clear not working in Unity 5.5 because we're not unity 5.5 anymore, and it was preventing underwater fog from working.

- The player will no longer toggle crouch while using crouch key to swim down if player is in water.  Also, if player enters water and is crouching, will automatically stand.

- In some situations, the player could be stuck in the water while levitating.  This simple change allows the player to exit the water if they are levitating."
209368276,Handle used weapon hand for save/load,Allofich,2018-08-19 16:32:13+00:00,2018-08-24 01:50:12+00:00,{},"Fixes https://forums.dfworkshop.net/viewtopic.php?f=24&t=936.

Also imports used hand from classic saves.

Existing DF Unity saves will be loaded as if the right hand was being used. Saves made after this PR is applied will load with the correct hand."
209364857,Fill out rest of enemy weights,Allofich,2018-08-19 15:14:36+00:00,2018-08-24 01:49:42+00:00,{},
209335178,Class creator bug fixes,numidium,2018-08-18 23:37:47+00:00,2018-08-24 01:49:19+00:00,{},"Includes the special advantage/disadvantage UI issue, max HP not carrying over, and spell points always being zero. Also fixes oversight in classic that allows more than 1 spell point multiplier."
209300234,Fix Save Explorer not opening if game isn't running,Allofich,2018-08-18 07:45:51+00:00,2018-08-24 01:48:47+00:00,{},"My previous code to import MAPSAVE data from classic saves (https://github.com/Interkarma/daggerfall-unity/commit/fd988d9b12c4ae3cbae5e48ef30f85924f843d9f) is causing Save Explorer to fail with a null exception if you try to open it without the game running in the editor. This happens because `PlayerGPS.dfUnity` isn't instantiated.

We could instantiate it, but I noticed that the MAPSAVE import makes a noticeable delay in Save Explorer as all the up-to-six saves are processed. Since Save Explorer doesn't do anything with that data yet anyway, I just disabled the import for Save Explorer. Ideally the import should be optimized, but I don't know how complex of a fix that would be."
209032662,Swimming Head Bob,MeteoricDragon,2018-08-17 02:47:09+00:00,2018-08-24 01:48:31+00:00,{},"Now swimming will bob the player down slowly then up real quick to simulate a breast stroke keeping the player afloat.  Achieved by repurposing the landing bob code to make the player bob when landing on ground or swimming, at different speeds."
207821001,Fix doors incorrectly rotating on load,Allofich,2018-08-12 13:19:14+00:00,2018-08-15 23:54:51+00:00,{},"Fixes https://forums.dfworkshop.net/viewtopic.php?f=24&t=765.

Doors that were mid-open when a game was saved will not play the open sound again when that game is loaded, and they will only open as far as they are supposed to.

Currently in master the ""durationScale"" that is supposed to make doors only rotate for the remaining duration was only affecting the ""time"" of the rotation, meaning how fast the door rotated, but not how much it actually rotated."
207811381,Fix books from classic saves to open,Allofich,2018-08-12 08:48:37+00:00,2018-08-16 22:44:30+00:00,{},"Fixes https://forums.dfworkshop.net/viewtopic.php?f=24&t=678.

The only check classic does for whether to open the book screen when doing `USE` in the inventory on an item is whether it is in group 7, the books group. Changing DF Unity to also just check this solves this issue.

Also made various fixes to the item template enums that were mixed up and causing some issues. (For example, a book in classic can have group index 1 through 4, which I think is supposed to be for different quality books, but only one of these is ""book"" in master, causing the books imported from classic to fail)

The changes to the enums are all from data in the .EXE (I found where they are listed) so they should all be correct.

Also included latest ItemTemplates.txt and MagicItemTemplates.txt since these are out-of-date."
207798716,Merging customclasscreator to master,Interkarma,2018-08-12 00:34:33+00:00,2018-08-12 00:34:39+00:00,{},
207711282,Fix and clean flicker,MeteoricDragon,2018-08-10 20:12:06+00:00,2018-08-12 00:38:34+00:00,{},"When setting breakpoints during the flashing and flickering, the amount of alpha can go past the intended amount because of more time passing due to taking more time to process the breakpoint.  If someone had a slowdown in their computer, this could also happen.  Their player's screen can end up permanently red.  This update fixes that.  Also, fixed some redundancy in code logic and simplified it."
207474869,Implement class creator help button and add click sounds,numidium,2018-08-10 00:00:05+00:00,2018-08-11 01:54:48+00:00,{},Sorry for the third PR in a row. There were a couple of things that were trivial to implement so I added them for the sake of completeness.
206742781,Read classic rumor data,Allofich,2018-08-07 15:42:33+00:00,2018-08-12 00:40:22+00:00,{},"No functionality yet, just reads `RUMOR.DAT` when importing a classic save and stores the data in a list of rumors."
206553997,Vitals fixes,MeteoricDragon,2018-08-07 01:04:41+00:00,2018-08-12 00:37:57+00:00,{},"Overall better interaction between indicator bars and base bars.  If you heal after or before you take damage or heal damage, the bars appear where you'd expect, and won't hide each other except in special cases where you heal completely after losing, then the gain bar will cover the loss bar.  If the player heals while the gain is smoothing, the bar will make a briefer pause than initial pause before continuing to smooth again.  and same goes for loss bar when taking damage repeatedly.  Also refactored the code."
206227487,Match magic item merchant stock to classic,Allofich,2018-08-05 08:07:41+00:00,2018-08-06 04:35:24+00:00,{},"Also fixed up list of enemy soul points and added that to enemy definitions.

When magic merchants stock soul traps with souls in them, it's a random selection from 0 through 42.
As far as I can see, there is nothing stopping it from choosing the unused ""Horse"" or the dragonling with 0 enchantment points. Since other 0-value animals can also be chosen I added a ""Horse"" stub to the enemy list to allow for the soul to appear. Not sure if we should allow those or not.

However, when an item with a soul bound to it breaks, the stored enemy is supposed to spawn. I assume classic probably crashes or something if an item with a horse soul breaks, so if we allow horse souls we'll have to account for that. We should account for that anyway in event somebody imports a classic save with an item with a horse soul."
206223622,Class creator,numidium,2018-08-05 05:55:59+00:00,2018-08-06 04:36:01+00:00,{},"I'm happy to announce that the class creator is now in a usable state. This was a lot more work than I expected. It could probably use some refactoring in the future (hopefully fewer switch statements) but what I have currently works correctly as far as I can tell.

Edit: I totally forgot about the ""Help"" button. That isn't built out yet but it's not essential for usability so the class creator is still functional as promised."
206188971,Implement magic item gold value calculation,Allofich,2018-08-04 11:40:55+00:00,2018-08-04 23:33:52+00:00,{},"This PR calculates and assigns gold values to magic items in loot. Values should match classic.

This was kind of complicated because it also involved reversing the formula for how spell costs are calculated.

A problem here Interkarma is that I saw you already have code in place for calculating spell costs.

I looked at using your existing function but it didn't seem that it was going to be straightforward to do so, as it is built into your system and the data representations you are using for spells. Sorry I didn't do it that way but I didn't know how to convert over when the only data I had was a SPELLS.STD index (that's the only data specified by spell enchantments on items). Also I wanted to figure out how classic was doing things.

The stuff I added is self-contained and won't interfere with anything you've done, so it shouldn't harm anything by merging, but in FormulaHelper there will be both ""classic way"" and the way you've implemented for getting spell costs. Maybe you could merge over the classic method and data into your system similar to how you did for diseases, or just use it for reference if you want."
205597416,Swimming bug fixes,MeteoricDragon,2018-08-02 01:47:32+00:00,2018-08-04 23:35:01+00:00,{},"This one is a really important fix: Fixes bug introduced by the indicator bars.  Because the property call in DaggerfallHUD for updating the breath bar was discarded in favor of updating the breath bar in the vitals class (to be consistent with the other vitals updating in the class), the SetRemainingBreath method was overlooked, which does more than set the amount, it sets the color of the bar according to the percent left. **Which causes the breath bar not to appear.**  Now the code properly sets the color and the breath bar appears.

Also Fixes bug identified by @Allofich , namely, if you load a game from swimming in a dungeon, you continue at swim speed.  Now the code checks to make sure the player is not on a water tile before clearing the swimming flag.

Also refactors code in the HUDVitals class to make a little more sense.

update: fixes to the vitals bars prevent the bars from displaying more than is actually tallied by the playerEntity.  could be caused when the player gets struck immediately after healing.

Placed the loss indicators behind the gain indicators.  Looks better if healing immediately after taking damage.  and can see both indicators working simultaneously.

Multiple consecutive healing or damage actions will no longer reset the timer or add delay for the smoothing.  It will just update the target amount to smooth the bar to.

"
205368576,Fix ArgumentOutOfRangeException,lucianposton,2018-08-01 09:49:31+00:00,2018-08-16 01:53:09+00:00,{}," *Templatize BaseImageFile.Load*

- Templatize BaseImageFile.Load to encapsulate common behavior in base.
- Expose result of Load as property to clients. There are better ways to
  expose the result to clients, but it would require uncoupling a bunch
  of code not worth touching for the sake of fixing the exception in the
  next commit.

*Fix ArgumentOutOfRangeException when arena2 dir unset*

Note, it'd be better if arena2 resources were loaded after arena2 dir is
set by the player (including LoadSpellIcons specifically for this
exception), but I'll leave that as an excercise for someone more
familiar with how arena2 resources are loaded."
205258755,Merging vitals smoother to master,Interkarma,2018-07-31 22:20:16+00:00,2018-07-31 22:20:25+00:00,{},
204581520,Implement creation of magic items in loot,Allofich,2018-07-28 07:29:46+00:00,2018-07-31 22:30:22+00:00,{},"Creation of magic items in loot (treasure piles, enemy equipment, house containers). Everything should be the same as classic except for the gold value of the items, which I still need to figure out (they'll just have the value of the non-magic versions for now). The magic item stats use the data read from `MAGIC.DEF`.

Also still need to do stocking of magic items by magic item merchants. (would be a separate PR)"
203847764,Fix music not updating when loading interior saves,Allofich,2018-07-25 14:02:06+00:00,2018-07-31 22:25:15+00:00,{},"Fixes https://forums.dfworkshop.net/viewtopic.php?f=24&t=1039&hilit=music and https://forums.dfworkshop.net/viewtopic.php?f=24&t=860 (except for the holiday text part).

You can reproduce the problem by doing the following:
1) Start Daggerfall Unity and load a saved game in an exterior
2) Load another saved game in an interior (building or dungeon, doesn't matter)
3) Observe that outdoors music is playing

The problem occurs at the code deleted by this PR, in `Update()` in `SongManager`.

```
            if (StreamingWorld)	
            {	
                if (StreamingWorld.IsInit)	
                    return;	
            }
```

It seems to be that the order of how `StreamingWorld.suppressworld` and `StreamingWorld.init` (both booleans) have been set is involved with the problem. If you load straight into a dungeon save, `StreamingWorld.suppressworld` is true from the start, and `StreamingWorld.init` ends up as false, allowing the SongManager to update the song. But if you load an exterior save first, `StreamingWorld.suppressworld` becomes false, and in the process of loading the interior save `StreamingWorld.init` becomes stuck at true, staying true while you're in the interior, until you leave it.

It doesn't seem like `StreamingWorld.init` should be stuck at true like this, as according to the comments it's supposed to indicate that the streaming world is being initialized and would only be true momentarily. I experimented with trying to fix this, such as by setting `StreamingWorld.suppressworld` to true in the load process earlier, before teleporting the player (this also fixes the holiday text issue and outdoor music temporarily playing while in the loading process) but ran into problems with the player ending up way in the air after leaving an interior if before loading that save they had gone outside in a different part of the game world.

I tested but I couldn't find that the code removed by this PR ever triggered except when causing the problem, so it seems like it wasn't serving it's intended purpose anyway, at least on my system and when running from the editor."
203496445,Minor fixes,Allofich,2018-07-24 11:33:35+00:00,2018-07-31 22:20:55+00:00,{},A few fixes to the earlier PR.
203073182,Setup initial class creation window,numidium,2018-07-22 19:47:19+00:00,2018-07-31 22:33:35+00:00,{},"Not much functionality here, just setting up the navigation and background for the custom class creator. This is mainly to stake my claim, as it were, on this feature since it's what I'm focusing on currently. Others are welcome to add to it, of course.

I commented out the ""Custom"" option on the class select since there's no functionality on the window as of yet. You can test it out by uncommenting line 62 of CreateCharClassSelect.cs."
202546710,Identify classic magic item data,Allofich,2018-07-19 12:42:58+00:00,2018-07-24 00:51:25+00:00,{},"- Identifies/reads data from `MAGIC.DEF` that was unknown
- Organizes classic enchantments like classic, as two values, one that identifies the type of enchantment (on use, on equip, on hit, special artifact effects, etc.) and one that serves as a parameter for that type of enchantment (an spell ID for use with `SPELLS.STD`, an identifier for the particular type of special artifact effect, etc.)

Classic enchantments were being stored as an array of integers. The two parts of each effect were also being saved separately as two different integers. To keep compatibility with existing DF Unity saves they are still saved that way, and converted as necessary. I think it's all working OK. I had to add a check that the effect type is 65535 (0xFFFF) when the item power popup because those values have been read and saved as unsigned so far, but with this PR I'm reading 0xFFFF from `MAGIC.DEF` or magic items in classic saves -1 now to fit in nicely with an enum for effect types."
202363893,Gains in vitals bars added,MeteoricDragon,2018-07-18 20:02:10+00:00,2018-07-19 22:18:43+00:00,{},"Added bars to serve as gains indicators.  Renamed VerticalProgressIndicator to VerticalProgressSmoother, because that class is used to extend a VerticalProgress object so it can smoothly update its amount if needed.  Gains and loss bars work independently and simultaneously.

In the code you'll notice that the vitals gains bars are just VerticalProgress bars.  That's because they never need to be smoothed.  The vitals base bars needed to be changed to VerticalProgressSmoother.

Have not added a setting quite yet.  Will do that soon."
202362443,Added gain indicator,MeteoricDragon,2018-07-18 19:56:24+00:00,2018-07-18 19:58:30+00:00,{},"Added bars to serve as gains indicators.  Gains and loss bars work independently and simultaneously.
Have not added a setting quite yet.  Will do that soon.

um. that's weird, this was supposed to go to the vitalsSmoother branch on your repository, not the master... :-/  "
202094469,Vitals loss indicator,MeteoricDragon,2018-07-17 22:43:26+00:00,2018-07-18 00:48:05+00:00,{},"@Interkarma please review at your convenience and let me know what you think of this code.

The goal is to display feedback indicators that show how much health, fatigue, or magicka was lost in an action. I think it may be useful for new players to understand what is happening to their vitals.
"
201461004,Import and handle expiring items,Allofich,2018-07-14 17:23:22+00:00,2018-07-17 00:34:19+00:00,{},"This does a few things:

1. Identifies and imports time-limit data from items created with the ""Create Item"" spell in classic.
2. Items with a time limit will be removed when the time limit is reached. Note this doesn't happen in classic (items created with ""Create Item"" never disappear, despite the fact that you can set duration when creating a Create Item spell) due to a mismatch in the flag set and the flag checked. (Byte 43 of the itemRecord is ORed with 0x10, but what is checked for 0x10 is byte 21 of the base record. If you manually set that classic then will remove the item when the duration runs out.)
3. Fixed a bug with unequipping broken weapons. It relied on `GetEquipSlot()`, but for weapons that can be equipped in either slot (one-handed weapons), it would return the unequipped hand, as it was apparently written specifically for when looking for a free slot to equip to, not to check the slot for an already equipped weapon. I think I didn't realize this when I wrote the weapon breaking code. This is fixed now and the fixed way is also used for unequipping expiring items made with Create Item."
201451761,Move env log to persistent data path,lucianposton,2018-07-14 13:25:26+00:00,2018-07-17 00:30:41+00:00,{},"This will enable logs to be written even when the game dir is installed
in a system dir."
201401257,Bug fixes,ajrb,2018-07-13 21:10:50+00:00,2018-07-17 00:29:45+00:00,{},"* One of the repair messages showing ""%pct[srcDataUnknown]"" instead of name.
* Stack weight checking only for 1 item instead of whole stack"
200537912,Fix Crushing bugs,MeteoricDragon,2018-07-10 22:12:25+00:00,2018-07-17 00:29:06+00:00,{},"players can wedge themselves into a slanted wall and climb up and kill themselves by triggering the overhead player crush check.  This fixes it by doing the folllowing:

Disable player crouching while climbing.
Disable Climbing while player crouching"
200202521,Easier to mute sound or music volume,MeteoricDragon,2018-07-09 19:53:44+00:00,2018-07-10 01:07:02+00:00,{},
199899857,Implement illusion effect behavior and adjust stealth detection,Allofich,2018-07-07 14:41:24+00:00,2018-07-10 01:06:44+00:00,{},"This implements enemy AI behavior for when the player has the Invisibility, Shade or Chameleon effects active, in a manner similar to classic.

Spells for these, etc. are not added by this. But you can test the behavior by setting the flags `IsInvisible` `IsAShade` or `IsBlending` in `PlayerEntity`. The effects are dispelled if you do damage to an enemy, the same as in classic.

Invisibility should work identically to classic (except for the ""giveUpTimer"" as I explain below). For shade and chameleon, though, the behavior differs. This is because, if I understand correctly, these effects are pretty much useless in classic. This is because as soon as an enemy has detected the player during one of its constant updates, they then see the player for the remainder of their ""giveUpTimer"" (as it's being called in `EnemyMotor.cs`). When the timer runs out, because of how frequently AI updates happen they are almost sure to immediately detect the player again and set the timer again, allowing them to see the player for another run of the timer. Maybe classic's behavior was created with a slower AI update rate in mind? I tried a shade effect in classic and indeed it didn't seem to do anything to stop an enemy from seeing me.

So for this PR, instead Shade and Chameleon effects are rolled against every classic AI update, so they can see you for a moment, then they can't, then they can, etc. I'm pretty happy with the behavior, it gives a feeling that they are searching for you but can't see you well.

Some enemy types ignore these effects and can always see the player. This is recreated from classic.

Also the enemy detection was refactored some. and enemies can now get the player's location from the player failing a stealth roll. I think this also happens in classic, and it recreates enemies coming through doors for you, etc. as they do in that game, and generally makes them feel a little more alive since you won't always find them in their starting spots. I had previously not added this because I didn't want to get rid of DF Unity's superior pursuit behavior where AI will go to the last spot they saw the player rather than try to walk through walls, but I added a timer to account for this. If the enemy recently had LOS with the player they will not update the location from the stealth check (i.e. they will go to the last spot they saw the player and not try to walk through a wall).
"
198972369,Minor cleanups,Allofich,2018-07-03 13:56:54+00:00,2018-07-10 01:04:55+00:00,{},Minor cleanup of my last PR. Same functionality. Also removed some comments I accidentally added to ItemRecord.cs at one point.
198825740,Height changer adjustments and partial swim implementation,MeteoricDragon,2018-07-03 01:12:35+00:00,2018-07-10 01:08:55+00:00,{},"Go ahead and give a try.

Includes integration with swimming speed, skill usage, skill tally.

The horse can be mounted/unmounted while swimming. Slight boost to height when mounted.

Known bugs:

When loading a save game, the height is sometimes wrong but can be fixed by crouching once or twice.

Not done yet:

- No footstep change for swimming yet. 
- Will adjust headbobber to bob differently for swimming.  
- Need to adjust EnemyMotor to keep non-flying enemies from going on water tiles."
198524929,Import discovered locations from classic saves,Allofich,2018-07-01 13:42:01+00:00,2018-07-02 00:59:18+00:00,{},"This implements reading `MAPSAVE.SAV` from classic saves and discovering the locations marked within it as discovered.

Although it works correctly, unfortunately it is extremely slow and will take around 2 or 3 minutes to load a classic save. Interkarma, I'm hoping you will know where the bottleneck is."
197837078,DayNight: upgrade ColorUsage attribute,rossipaolo,2018-06-27 19:59:19+00:00,2018-06-28 03:51:41+00:00,{},Just some deprecated parameters.
196879359,Added an AddAction() option to the InputManager,InconsolableCellist,2018-06-23 03:47:32+00:00,2018-06-24 22:26:27+00:00,{},"This will be useful if other scripts or mods want to request that the
InputManager takes certain actions.

(cherry picked from commit 8b37ee307d765cb72c837ee8bc5257ac125e64bf)"
196604114,Sound global fixex,MeteoricDragon,2018-06-21 23:40:59+00:00,2018-06-24 22:26:05+00:00,{},"Horse riding sound now scales with global volume.

@Interkarma  do you know where I can find the command that plays audio for monsters?  I found the hit sound effects in EnemySounds but am looking for the code that plays the sounds that you hear the monster randomly making every so often.  Such as squeaks for rats, screams for skeletons, grunts for giants."
195655358,Sorceror Magicka restrictions and mages guild benefit.,MeteoricDragon,2018-06-18 21:35:09+00:00,2018-06-21 23:11:31+00:00,{},"If the player has the NoRegenSpellPoints career property set to true:

->Spell points no longer recover when resting.
->Rest until fully healed doesn't require full magicka.
->The player can recharge spell points at mages guild by clicking any service like in classic.

@Nystul-the-Magician The TextProvider ID is needed for following messages so they can be used in TextProvider.GetRandomTokens.  Do you know the ID?

-> I see your magicka is low. You sorcerors really need to be more careful. Here, let me recharge you.
-> It is customary for the guild to recharge the magicka of sorcerors.

msgbox.SetText is used as a makeshift solution until the GetRandomTokens approach is used."
195652614,Re-work classic DF rep propagation algorithm,ajrb,2018-06-18 21:23:50+00:00,2018-06-22 01:45:26+00:00,{},"- Simplify code, thanks to Allofich for implementing as classic and removing guesswork.
- Works from guild faction ids rather than questor npc id.
- Fixes classic bug with knightly orders where rep isn't propagated to children of generic order.
- Fixes classic bug with knightly orders where rep is doubled for generic order when performing non-member quests.
- Keeps classic behaviour of not propagating for a specific knightly order. I assume due to all affiliated nobles being aloof from such matters, but this is easily changed if we want."
195394266,Potion maker & Item enchanter basic implementation,ajrb,2018-06-17 20:39:35+00:00,2018-06-22 01:46:22+00:00,{},"- Upgraded ItemListScroller component to be flexible for use beyond inventory UI window.
- Fixes column swap issue when scrolling to end of lists with odd numbers of items.
- Implemented the basic buttons, item scrolling and movement for both potion and item maker UI screens. (You can't actually create potions or enchanted items yet)
- These are now prepared for when the effect system is ready to enable their functionality.

I'm really happy how the ItemListScroller handles item display, once I upgraded it the potion screen was really easy to do.
"
195355977,NPCs don't stop if weapon drawn,MeteoricDragon,2018-06-17 01:04:39+00:00,2018-06-21 23:11:00+00:00,{},"Mobile Town NPCs now won't stop if your weapon is drawn.  

Also makes TODO note for other NPC stop conditions:

**Conditions to do in future:**
Player is in beast form.
Player just got caught committing a crime
Player is invisible."
195350658,Near death experience simplified,MeteoricDragon,2018-06-16 21:53:57+00:00,2018-06-21 23:10:23+00:00,{},"This version is greatly simplified and cleaner.  Also includes a setting in Advanced Settings window to toggle the effects off.

When the player is reduced to < 40% health.  they will experience a flashing red flicker effect.  If < 20% health, the player fades in and out of darkness until their health is raised above 20% threshold."
195331988,Implement classic reputation propagation,Allofich,2018-06-16 13:14:00+00:00,2018-06-17 21:34:20+00:00,{},"Implements reputation propagation based on reversing classic code. This is a response to http://forums.dfworkshop.net/viewtopic.php?f=19&t=910 but.

This does not yet 100% replicate classic behavior for quest rewards, just the propagation part. I used http://en.uesp.net/wiki/Daggerfall:The_Infested_House as a test case. In classic the quest reputation reward seems to be given based on the faction ID of the NPC quester, in this case faction 846 (""Questers""), the ID for the NPC in a knightly order who gives quests. DF Unity appears to instead be using the faction ID of the knightly order. This causes a different propagation and different results.

Would it be an easy fix to assign the faction ID of the NPC clicked on rather than of the faction itself? I don't know if that is how it works for all quests in classic but I would assume so for now unless there is evidence otherwise. If that change is made I think we will have behavior equivalent to classic.

@ajrb Regarding the thread discussion above.
I think the difference on UESP might be because in one case whoever wrote it accidentally compared the before + after results after doing 2 quests or something. At any rate, the reputation reward will vary depending on the faction relationships with the region and knightly order (as well as any allies or enemies they may have randomly added for that game).


"
195324790, TerrainSampler implementation extended,Nystul-the-Magician,2018-06-16 09:18:40+00:00,2018-06-17 22:08:29+00:00,{},"TerrainSampler implementation extended - reason: mods may need terran height scale (e.g. Distant Terrain mod)

new property MeanTerrainHeightScale and new method TerrainHeightScale added

default use is fixed terrain height scale factor - set MeanTerrainHeightScale in constructor (SimpleTerrainSampler, NoiseTerrainSampler, DefaultTerrainSampler)

more sophisticated use: terrain height scale factor depends on map pixel position - override for method TerrainHeightScale(x,y) happens in this case (used by Distant Terrain Mod's Improved Terrain Sampler)"
195314896,Comment out failed quest,Interkarma,2018-06-16 03:22:11+00:00,2018-06-16 03:22:18+00:00,{},Missing required quest actions for normal completion.
195110676,"fix for bug report #116: NPC dialogue loops in Daggerfall, rumor mill creation fixed",Nystul-the-Magician,2018-06-15 08:40:29+00:00,2018-06-16 00:47:24+00:00,{},"fix for bug report #116: NPC dialogue loops in Daggerfall (fix for unhandled (new?) quest location type)
rumor mill creation fixed (it could happen in the past that only quest rumors got created without generic rumors)"
194996038,StreamingWorld: Add event OnUpdateLocationGameobject,rossipaolo,2018-06-14 19:36:28+00:00,2018-06-16 00:46:19+00:00,{},"This event is raised when location gameobject is created, after location components are added."
194737752,Abstracts HealthChangeDetector,MeteoricDragon,2018-06-13 22:56:22+00:00,2018-06-16 00:45:45+00:00,{},"This commit takes health change detection code from CameraRecoiler and abstracts it to a new class ""HealthChangeDetector"" and makes it a component of playerAdvanced.  No Functionality changes.

This will allow easier modding for mods related to changes in Player Health, and other future functions.

Also, one additional Entity property is added to DaggerfallEntity, which allows shorthand way to get the current percentage of max health left of that entity.

This will also be used by the Near Death Experience code.  I figured it's better to make the code available for re-use rather than retype the same code in any new code that requires it.  "
194624811,Near death experience simplified,MeteoricDragon,2018-06-13 15:22:00+00:00,2018-06-13 22:27:38+00:00,{},This code version is greatly simplified.  It removes the flash I created in favor of the flash you have. and simplifies the code so flicker code is done mostly inside flickerBase.  The FlickerFast and FlickerSlow just use different settings by initializing different values for the same fields inside Init().  Let me know what you think.
194245610,Fix .RMB name resolving,Allofich,2018-06-12 11:14:30+00:00,2018-06-12 22:36:51+00:00,{},Continued from https://github.com/Interkarma/daggerfall-unity/pull/792
194047872,TextureReplacement: Fix issue with emission maps on billboards,rossipaolo,2018-06-11 17:18:44+00:00,2018-06-12 22:36:36+00:00,{},
193877645,"Revert ""Merging mapsfile to master""",Interkarma,2018-06-11 05:31:20+00:00,2018-06-11 05:31:33+00:00,{},"Reverts Interkarma/daggerfall-unity#794.

Breaks key locations such as Direnni Tower."
193875811,Merging mapsfile to master,Interkarma,2018-06-11 05:13:49+00:00,2018-06-11 05:13:55+00:00,{},
193856803,Make death of player show red,MeteoricDragon,2018-06-11 01:15:22+00:00,2018-06-11 05:14:16+00:00,{},Edits FadeBehavior.FadeHUDToBlack() to have fadeStartColor = a blood red color and fade that to black instead of clear to black.  I tested it in the game and it looks better than the inconsistent behavior that occurs that when you get hit and no flash of any sort occurs and it just fades to black.  Try it out. 
193819769,"Load RMB blocks like classic, add ""not a port town"" popup",Allofich,2018-06-10 10:46:19+00:00,2018-06-10 22:14:14+00:00,{},"Changes RMB block loading to work in the same manner as classic. This shortens the code and removes the need for special cases for ""CUST"" blocks.

Along while doing this I identified 2 more bytes of the exterior data, including the one used for the message you get when you try to buy a ship in a location that is not by water."
193494185,Near death experience backup,MeteoricDragon,2018-06-08 02:32:17+00:00,2018-06-10 22:14:36+00:00,{},"@Interkarma I haven't put the settings in yet.  I was wondering if you can playtest this in a separate branch and share your opinion on what parts should be toggle-able.

There's a flash, a flicker, and a slow strobe.  Perhaps a single checkbox for both flicker and strobe.  Or a checkbox for each?"
193140485,Refactor CalculateAttackDamage and make more formula overridable,ajrb,2018-06-06 21:05:34+00:00,2018-06-08 05:29:58+00:00,{},"New overridable formula:
    CalculateAttackDamage
    CalculateSuccessfulHit
    CalculateStruckBodyPart
    CalculateBackstabChance
    CalculateBackstabDamage"
193105775,Extend start quest to load from quest packs,ajrb,2018-06-06 18:46:44+00:00,2018-06-08 05:30:10+00:00,{},"I've changed the start quest action to pick up quests in the following order

1) Any classic quests in /Quests folder.
2) Any init quests registered by quest list.
3) Any quests in same folder as an init quest.
4) Any guild quests registered by quest list.
5) Any social quests registered by quest list.
"
191580620,TextureReplacement: read scale from xml (MobilePersonBillboard),rossipaolo,2018-05-30 21:05:12+00:00,2018-05-30 21:58:55+00:00,{},"Allow custom scale for wandering npcs as discussed on forums.  Instead of using raycast as previosly said, i left position of parent gameobject with Motor as is, and moved child gameobject with billboard meshrender via transform. This doesn't affect small variations so behaviour with original graphics is unaltered."
191429911,Merging ui-rendering-test to master,Interkarma,2018-05-30 12:06:39+00:00,2018-05-30 12:08:06+00:00,{},"This change redirects the entire Daggerfall Unity UI into an offscreen RenderTexture target. There are also optimisations to how often UI was being redrawn. The offset render texture is presented to user through a RawImage on a Canvas during normal play.

The purpose of rendering the UI to an offscreen RenderTexture is to make the UI layer more flexible. For example, the same RenderTexture can be used as a non-diegetic overlay or as a diegetic panel inside the world for VR.

A few compromises had to be made for differences in how the RenderTexture handles alpha compared to the direct GUI.DrawTexture methods. The main change is the ""background dim"" is now gone for popup windows. This is closer to how classic works anyway. I've also removed the red flash when player injured for now. Otherwise everything is almost exactly the same.

I will continue tuning this, but I'm happy enough with changes to go into master for now."
191263006," implemented ""Where am I?"" question/answers,  special npc ""where is"" answer in same location",Nystul-the-Magician,2018-05-29 20:36:37+00:00,2018-05-30 21:59:37+00:00,{},"- implemented ""Where am I?"" question/answers 
- trimming castle names read from text.rsc when last character is '.' (change to Assets/Scripts/Utility/BuildingNames.cs - should be ok, but pls take a look - I did this because I think it is an improvement since palace name would often break sentences with this '.', discovery system discovers castles without problems after this change - nameplates no longer contain the '.' character as well)
- special npc ""where is"" answer about location/person topic if in location:
 -- for building asked about that is the same building where the npc talk partner is in: npc always knows he is in the very same building and gives special answer now
 -- for quest person ""where is"" answer if npcs knows about person there is also a specific answer if npc is in same building as person"
191009857,Update to current master,Interkarma,2018-05-29 00:16:26+00:00,2018-05-29 00:16:35+00:00,{},
191008607,Update to current master,Interkarma,2018-05-28 23:54:29+00:00,2018-05-28 23:54:36+00:00,{},
191008480,Merge pull request #782 from Interkarma/master,Interkarma,2018-05-28 23:52:45+00:00,2018-05-28 23:52:53+00:00,{},Just aligning before deleting branch.
191007842,Update to master,Interkarma,2018-05-28 23:41:11+00:00,2018-05-28 23:42:39+00:00,{},
190969804,Finish Stendarr avoid death perk,ajrb,2018-05-28 16:58:04+00:00,2018-05-28 23:39:22+00:00,{},
190828194,Finish creating transfer attributes,MeteoricDragon,2018-05-28 03:39:17+00:00,2018-05-28 05:35:45+00:00,{},
190749549,Mostly finish up region and faction conditions,Allofich,2018-05-26 16:37:55+00:00,2018-05-27 22:03:28+00:00,{},"I finally got through this massive function for handling the background events that set region flags for things like wars, etc., along with changes to faction power caused by this. This is also the basis for non-quest rumors and messages on the town sign boards, which are created by these events (I haven't implemented that).

This follows classic very closely, plus fixing the usual bugs/oversights.

There's one part that seems to be an oversight that I may visit again later. There's a section of data that I found was a list of the bordering regions of all the game's regions (including the ""Bjoulsae River"" region that isn't in the final game). It's used rather oddly in connection with the other regions that regions will go to war with, because the order doesn't match the region order from FACTION.TXT, so regions will go war with the border regions of what seem like unrelated regions. My best guess of what is supposed to happen is that regions go to war with their bordering regions, but due to some mix-up during development or something the index numbers for the data didn't match the final region numbers. I may revisit it later.

As usual the function is in the PlayerEntity. I'm fine with it being moved out to some other class if desired."
190451768,Update to current master,Interkarma,2018-05-25 00:06:49+00:00,2018-05-25 00:07:05+00:00,{},
189916868,Update to current master,Interkarma,2018-05-23 09:50:55+00:00,2018-05-23 09:51:25+00:00,{},
189857530,Add ability to get work inside castles,numidium,2018-05-23 05:04:40+00:00,2018-05-24 20:59:40+00:00,{},"This is a continuation of my work on the ""work"" functionality in TalkManager.

I used a separate dictionary because 1. The block structure for castles/dungeons is different than towns and 2. the process of looking for work in a castle is simpler. There's no ""work"" dialogue in classic for castle questors so an NPC list doesn't need to be pre-populated."
189793326,Add ability to init quest scripts when new game started,ajrb,2018-05-22 21:10:01+00:00,2018-05-23 05:04:01+00:00,{},
189518579,Update to current master,Interkarma,2018-05-22 00:14:15+00:00,2018-05-22 00:14:22+00:00,{},
189518523,Update to current master,Interkarma,2018-05-22 00:13:47+00:00,2018-05-22 00:13:53+00:00,{},
189490430,Fix for commoner quest handout closing HUD,ajrb,2018-05-21 21:16:37+00:00,2018-05-21 22:48:34+00:00,{},Needs to be reviewed and given green light by Nystul before merge.
189300111,Update to current master,Interkarma,2018-05-21 07:13:14+00:00,2018-05-21 07:13:22+00:00,{},
189292060,Merging crusher,Interkarma,2018-05-21 06:19:27+00:00,2018-05-21 06:20:10+00:00,{},
189255477,Crusher,MeteoricDragon,2018-05-20 22:11:00+00:00,2018-05-21 05:18:58+00:00,{},"Implements a functional crushing system.  Also fixes a bug that was introduced with the smooth crouching update.  When loading a game with a different crouching state than your previous, your game would be stuck in either crouching while walking full speed, or walking while crouching speed.

**There is a problem that prevents this from being Merge-ready.**  There is a SphereCollider I attached to the PlayerAdvanced components and set it as a trigger, and I call OnTriggerEnter and perform the crush logic in the PlayerCrush class.  Because of the position of the SphereCollider, many rays and projectiles are blocked if they are below a certain angle (because the trigger collider blocks them)  I am seeking advice how to work around this.  I can imagine some but was wondering the best solution."
189247053,Create LICENSE,Saibamen,2018-05-20 18:52:41+00:00,2018-05-20 22:31:23+00:00,{},
189243665,Refactor classic guild membership import and fix bug,ajrb,2018-05-20 17:34:05+00:00,2018-05-20 22:31:04+00:00,{},Bug was memberships adding to existing when loading classic saves.
189242395,Quests: minor fixes,KirillSmirnov,2018-05-20 17:02:30+00:00,2018-05-20 22:13:29+00:00,{},This PR fixes gender-related discrepancies between QRC and QBN blocks and updates quests status.
189229734,escape key now closes travel map window correctly,Nystul-the-Magician,2018-05-20 11:25:19+00:00,2018-05-20 22:30:29+00:00,{},"if wanted I will investigate if it is possible to only close regional window when in regional view - currently escape closes travel map window completely when in there
but this is more complex than thought at first glance"
189227946,ConversationData.txt - fixes for old savegame format issues - should fix most of the problems,Nystul-the-Magician,2018-05-20 10:27:41+00:00,2018-05-20 22:29:44+00:00,{},"RestoreConversationData now checks for quest resource entries and rumors of orphaned quests (that are no longer running) and removes them

additional checks should prevent some issues I found when above mechanism would not be in place (double net mechanism)"
189225389,Court screen updates,Allofich,2018-05-20 09:01:49+00:00,2018-05-20 22:12:37+00:00,{},"- Prison screen implemented
- Fix to not allow using ESC key to cancel court window or court message boxes, which would mess things up as it wasn't set up to handle it
- Fix to prevent camera recoil when leaving court screen

Also, although it's not in classic, I added a ""cheat"" key to speed up the day countdown by holding down ESC, which is nice to have while testing if nothing else. I don't know how hardcore people want to be about actually having to wait through the prison sentence.

Interkarma, is there a good way to change the color of text? The text on the prison screen should be different from the default color, as in this screenshot.
![prisonscreen](https://user-images.githubusercontent.com/19624336/40277306-d271e498-5c57-11e8-872c-f5f9dbcc60e1.png)
"
189211408,Merging player-motor,Interkarma,2018-05-19 23:30:12+00:00,2018-05-19 23:30:19+00:00,{},"This is the final part of @MeteoricDragon's PlayerMotor refactor. This not only makes the base motor class much smaller and neater, it separates all movement-related logic into their own class so the function of each is clearer and easier to maintain.
Thank you for your work on this @MeteoricDragon. It will make any future changes to the motor class much easier to manage."
189203994,Enable scrollwheel on journal,ajrb,2018-05-19 19:53:06+00:00,2018-05-19 23:31:22+00:00,{},"Another piddly little change from me. Still here guys o/

lol"
189192492,Import guild memberships from classic,Allofich,2018-05-19 15:16:46+00:00,2018-05-19 23:34:43+00:00,{},"Imports guilds from classic, including rank and time of last rank change.

The only used guild value I know of that is not imported is one that seems to be involved in guild promotions and rewards.

@ajrb I had to make a couple guild-related methods public so I could access them, I hope that's alright with you. Also I had to do some conversion work to match to the days-since-promotion that you're using. Classic goes by minutes. (As far as I have seen classic always uses minutes for game time related calculations)"
189188327,"status info messagebox fix, hotkey window toggling for remaining windows implemented",Nystul-the-Magician,2018-05-19 13:32:31+00:00,2018-05-19 23:33:00+00:00,{},"according to your example I implemented all remaining windows that benefit from toggle behavior, hope you find this better now ;)

furthermore I fixed status info messagebox bug, status hot-key proceeds messagebox now as implemented in vanilla daggerfall, enter key will proceed, escape key will close messagebox immediately
also status hotkey will now proceed messagebox as convenience feature

hotkey toggling implemented for remaining windows:
- character sheet
- log book
- automaps
- travel map
- rest window
- transportation window"
189178256,Update to current master,Interkarma,2018-05-19 08:42:41+00:00,2018-05-19 08:42:48+00:00,{},Will test branch and merge as soon as possible.
189134819, Add new quest action to check skill level ,ajrb,2018-05-18 21:05:06+00:00,2018-05-19 23:32:00+00:00,{},Been sitting on this code for 2 months... only needed a few fixes and testing.
189085050,Optionally allow TextBox to receive negative or floating point numbers,rossipaolo,2018-05-18 17:10:18+00:00,2018-05-19 08:38:05+00:00,{},"TextBox numeric mode only allows positive numbers (I assume this is what's required by classic) but mod settings have keys which allow user input for negative numbers and decimals (specifically _TupleFloatKey_ and _TupleIntKey_). 

So i added an enum property to texbox to safely receive also minus and decimal mark when required. Default option is _Natural_, which is current behaviour. Interkarma are you ok with this? If you prefer, i can replace entirely _isNumeric_ flag with a _None_ option."
188958982,Hotkey closing for several windows implemented (using global hotkeys),Nystul-the-Magician,2018-05-18 08:45:23+00:00,2018-05-18 22:34:12+00:00,{},
188604834,Finish Fortify Effects,MeteoricDragon,2018-05-17 01:59:51+00:00,2018-05-19 08:40:42+00:00,{},"Implements the remaining 5 fortify effects, first 3 originally authored by @Interkarma, Last 5 continued by the same example set by him.  This one was actually pretty easy, just compare what you did and continue the pattern. Tested and verified spells are available now in spellmaker."
188557656, Add guildjoin and guildrank commands for guild testing ,ajrb,2018-05-16 20:56:05+00:00,2018-05-16 23:10:39+00:00,{},"* Add guildjoin and guildrank commands for guild testing
* Remove temp testing features from guilds (i.e. no free resting and rank changes only every 28 days)
* Use faction id enum where appropriate
* Fix gdd macro for donations when not temple member"
188296761,Player motor,MeteoricDragon,2018-05-16 01:28:41+00:00,2018-05-19 08:35:02+00:00,{},"So, with these changes, I'm reasonably sure I'm done with PlayerMotor.  At least on a massive scale."
188071587,"talkmanager now can handle multiple resources with same name, fix remote quest locations talk stuff",Nystul-the-Magician,2018-05-15 09:48:45+00:00,2018-05-19 08:39:09+00:00,{},"talkmanager now can handle multiple resources with same name (e.g. named residence in local and remote town sharing the same name, persons with same name) - the residence case indeed happened

fixed a bug where place quest resource would not show up in ""Where Is""->""Location""->""General"" group in talk window when quest place was in remote town

Note: running quests from savegames are likely broken since dictionary key is now Symbol.Name instead of caption name"
187982112,Merge player-motor-changes,Interkarma,2018-05-15 00:04:26+00:00,2018-05-15 00:04:42+00:00,{},
187979818,Update to current master,Interkarma,2018-05-14 23:46:06+00:00,2018-05-14 23:46:12+00:00,{},
187938518,Classic quests janitorial,KirillSmirnov,2018-05-14 20:16:39+00:00,2018-05-15 00:05:07+00:00,{},
187917487,Fix RideHeight not initializing.,MeteoricDragon,2018-05-14 18:48:53+00:00,2018-05-14 21:42:32+00:00,{},
187836789,tg and dbh guild halls discovered when loading a interior savegame and getting promoted,Nystul-the-Magician,2018-05-14 14:00:09+00:00,2018-05-14 21:46:39+00:00,{},"tg and dbh guild halls are now also correctly discovered when loading a interior savegame and getting promotion in interior and then leaving building

had to introduce new event in StreamingWorld class:  OnAvailableLocationGameObject so that GameManager.Instance.StreamingWorld.GetCurrentBuildingDirectory() will return the building directory and not null
initially I though existing OnCreateLocationGameObject(dfLocation) event would work but it turned out that it is fired too early (inside the function creating the gameobject, but gameobject is assigned outside afterward)
not sure if OnCreateLocationGameObject should do what OnAvailableLocationGameObject does now but I didn't want to break existing stuff.
"
187698061,Player motor changes,MeteoricDragon,2018-05-14 00:13:49+00:00,2018-05-14 06:43:53+00:00,{},"Migrates code responsible for enabling input to move the player along the ground to PlayerGroundMotor. Also migrates the code enabling moving platforms to move the player to the same new class. 

Migrates a couple Height variables unused by PlayerMotor to PlayerHeightChanger.

Sorts PlayerMotor into Regions.

Adjusts access modifiers of classes I've created and adds XML documentation to several methods."
187675445,"Allow localization of Main menu, Mod and Settings windows",rossipaolo,2018-05-13 15:21:17+00:00,2018-05-14 05:10:21+00:00,{},
187662966,Fix quests repute,KirillSmirnov,2018-05-13 10:30:41+00:00,2018-05-14 05:09:20+00:00,{},Signed-off-by: Kirill K. Smirnov <kirill.k.smirnov@gmail.com>
187662585,"implemented SpyMaster pop-up message box like in classic, quest residence discovery behavior changed",Nystul-the-Magician,2018-05-13 10:20:43+00:00,2018-05-14 05:08:24+00:00,{},
187660560,nameplate filtering mechanism reworked,Nystul-the-Magician,2018-05-13 09:25:05+00:00,2018-05-13 09:57:31+00:00,{},"exterior automap nameplate filtering mechanism is now working as before when we checked for ""Residence"" string but now via ""isOverrideName"" field in DiscoveredBuilding struct (translation safe)

check is: 
`if (!RMBLayout.IsResidence(buildingSummary.BuildingType) || discoveredBuilding.isOverrideName)`

only thing to know is that player has to leave and enter town when loading an old savegame to make the new mechanism work with old savegames. no problem with newly created savegames though"
187642350,Merge acrobat-motor,Interkarma,2018-05-12 22:05:24+00:00,2018-05-12 22:05:30+00:00,{},
187628773,"Identify more classic data, prepare SavingThrow() to accept spells",Allofich,2018-05-12 16:26:16+00:00,2018-05-13 08:19:48+00:00,{},"With this, SavingThrow() is matched to classic. As soon as there is a way to store and access resist flags and resist amounts on an actor, it can be used."
187618833,Mark incomplete quests as broken,KirillSmirnov,2018-05-12 12:19:21+00:00,2018-05-13 09:56:21+00:00,{},"Several quests in vanilla DaggerFall are incomplete: only .QRC or
.QBN file is present and other is missing. Mark these quests as
broken explicitly.

Signed-off-by: Kirill K. Smirnov <kirill.k.smirnov@gmail.com>"
187612734," renamed automap classes/files, palace mark on map fix, organizationinfo impr., implemented spymaster",Nystul-the-Magician,2018-05-12 09:20:40+00:00,2018-05-12 21:59:03+00:00,{},"renamed DaggerfallAutomap and DaggerfallExternalAutomap into Automap and resp. ExternalAutomap
this might create some problems with mods, but since I really wanted to rename these 2 files/classes since half a year now I just did it. They are now more in line to all the other files in the folder (exception is the DaggerfallBankManager), palaces are now correctly revealed, progress with TalkManager"
187601594,Acrobatic motor,MeteoricDragon,2018-05-12 03:08:09+00:00,2018-05-12 22:00:29+00:00,{},"Migrates code that deals with Jumping, Falling, falling damage, and gravity to a class called AcrobatMotor.  Significantly reduces size of PlayerMotor.  No problems while testing it on my end."
187525172,Document and read classic effect flags,Allofich,2018-05-11 17:35:04+00:00,2018-05-11 22:09:12+00:00,{},"Just information, no functionality. It might be useful since you're building out effects."
187451894,thieves guild and dark brotherhood guild buildings are revealed again ,Nystul-the-Magician,2018-05-11 12:36:39+00:00,2018-05-11 22:06:07+00:00,{},"now filtering by factionId of building to show them when player is in guild and thus have them marked on the map
map marking also happens now directly when joining guild in same town - you don't have to reenter the city/town

only shows the tg, dbh guild nameplate when player has joined them
due to the new filtering this had to be handled specially"
187423485,"%hnr ""Ma'am"" instead of ""Madam"", work/merchant quest offers accept closes npc submenu",Nystul-the-Magician,2018-05-11 10:17:28+00:00,2018-05-11 22:05:46+00:00,{}," info clicking won't reveal quest place resources that are available for chat but were not revealed by npc
player now must get them revealed to show on the map
"
187342306,Friction motor updates,MeteoricDragon,2018-05-11 00:48:18+00:00,2018-05-11 22:05:01+00:00,{},
187235653,Talkwindow - progress and fixes,Nystul-the-Magician,2018-05-10 16:06:34+00:00,2018-05-11 00:48:49+00:00,{},"- rumors get removed correctly on quest decline now (one part of the bug report in http://forums.dfworkshop.net/viewtopic.php?f=24&t=1002&p=12092#p12092)
exception handling for the reported exception as well - TODO: still have to find out how ""tell me about"" entries could stay on the list after quest has finished
- npc reject message is now a random msg from text.rsc like in classic when first approaching npc, second time is ""you get no response""
- question's answers take into account reputation with the npc now (similar to greeting msg)
- implemented guild member greetings, added macro handlers for %fnpc, %fpc, %fpa and %hnr
- work/questor list is now saved with conversation data
- fixed merchant missing book quest"
187192940,Guard improvements,Allofich,2018-05-10 13:29:30+00:00,2018-05-11 00:48:08+00:00,{},"~1) Problem with player taking damage from guards if they surrendered while being hit nearly simultaneously by 2 or more guards should be fixed.~ (Removed, still seems to need work)
2) Implemented guards spawning for player with a low legal reputation or who has been banished. Behavior is the same as classic. (Actual spawning behavior of guards is still different, still need to implement LOS-check-based spawning)"
187165395,Use a few more faction enums,Allofich,2018-05-10 11:13:34+00:00,2018-05-10 11:29:57+00:00,{},"Very minor PR. Just fixes a spelling error and uses the faction enums in a few more spots.

I started to go through the code looking for anywhere that faction IDs were used as numbers, but I wasn't sure of an effective way to search for that, and I came across usage of faction IDs defined within guild files, such as the factionID defined within the `ThievesGuild` class. I just left that alone, but I'm using the enums for the code I write."
187012304,Modsettings window: Improvements,rossipaolo,2018-05-09 19:07:04+00:00,2018-05-09 23:25:03+00:00,{},
187001946,Spell costs code refinement,ifkopifko,2018-05-09 18:25:05+00:00,2018-05-10 08:15:13+00:00,{},It will spit out correct costs once offsetGold values are corrected. That is planned for the next pull request.
186879531,Use enums for faction IDs,Allofich,2018-05-09 10:25:41+00:00,2018-05-09 23:22:08+00:00,{},"In connection with https://github.com/Interkarma/daggerfall-unity/pull/725, I decided to pull this PR back out. I actually did this a while ago, but stopped midway because I wasn't sure if global faction enums were desired. It still seems like a good idea to me, though, because faction IDs are used in several places around the code. It also would have stopped me from mixing up the faction IDs in the court screen.

This replaces some but not all of the numbers used to refer to factions with enums. If you approve Interkarma, I can continue and do the rest of them (or you can if you feel like it).

I'll leave both this and https://github.com/Interkarma/daggerfall-unity/pull/725 up. This includes a fix for the wrong IDs in the court screen, so you can pick whichever you prefer."
186875181,Fix wrong faction IDs,Allofich,2018-05-09 10:07:00+00:00,2018-05-09 23:23:27+00:00,{},Fixes http://forums.dfworkshop.net/viewtopic.php?f=24&t=1000. I got the faction IDs reversed.
186563166,Talkwindow - fixes and improvements,Nystul-the-Magician,2018-05-08 08:36:30+00:00,2018-05-08 09:38:15+00:00,{},"fixed bug with remote place resources (http://forums.dfworkshop.net/viewtopic.php?f=24&t=997, http://forums.dfworkshop.net/viewtopic.php?f=24&t=996)

Location->General subgroup is now hidden if no entries are available

topic list creation is no longer done while accepting quest

hard strings are now loaded from ConversationText.txt "
186514209,Climbing motor,MeteoricDragon,2018-05-08 02:55:25+00:00,2018-05-09 23:26:26+00:00,{},"Like the other two PRs, this one Isolates climbing motor commands."
186480249,Merge player height speed handlers,Interkarma,2018-05-07 22:19:50+00:00,2018-05-07 22:19:58+00:00,{},
186253600,Migrate Speed Changes from PlayerMotor to PlayerSpeedChanger,MeteoricDragon,2018-05-07 04:35:19+00:00,2018-05-07 21:46:40+00:00,{},"In this commit, all the code related to changing the player's speed is migrated to a separate class PlayerSpeedChanger.  All references to the module-level variables, constants, properties, constants, and methods have been copied and pasted to the new class.   All classes that reference the speed-related members and methods of PlayerMotor.cs (including code within PlayerMotor itself) have been updated to use PlayerSpeedChanger.  I tested it and fixed all null references.

I didn't notice any difference in gameplay with this commit.  Was wondering if it will make your task of rewriting PlayerMotor simpler?

This commit doesn't include the changes from the HeightChanger.  I used Github to see if the branches could be automatically merged and it showed no conflicts so I assume this won't conflict with the changes in HeightChanger pull request.

EDIT: after switching to Unity, and then switching to Github Desktop, it appears to have generated a playerAdvanced.prefab.  I included that file in another commit to this PR."
186208880,Move guard level bonus to before health roll,Allofich,2018-05-06 14:38:18+00:00,2018-05-07 21:42:34+00:00,{},
186171833,Height changer,MeteoricDragon,2018-05-05 19:20:47+00:00,2018-05-07 21:48:23+00:00,{},"Changes:  

- Rename Croucher to PlayerHeightChanger

- Migrate code in PlayerMotor that adjusts the player height when mounting/dismounting horse to PlayerHeightChanger

- Fix bug where if mounting horse while crouched, would lock player into crouch speed, even on horse.

- Delete deprecated commented code

- Horse Mount/dismount now smoothly & quickly transitions like crouching."
185975261,"Talkwindow - progress with ""Where Is""->""Person"" talk topics, ""Where Is"" -> ""Location"" named Residences",Nystul-the-Magician,2018-05-04 12:53:40+00:00,2018-05-06 07:47:48+00:00,{},"- fixed quest N0C00Y10 (mages guild non-member missing book quest (my test quest))
- topic list generation strategy/policy update (only generated when talkwindow is opened (exception: if dialog link reveals new topics then it is immediately updated)
- questor dictionary is now only generated once (since it takes long and caused a pause which was noticable), we need to decide if we want to generate this on first talk window open after a location change/savegame load/etc.  or if we want to create it immediately on location change/savegame load/etc.
- asking for quest people outside now works (compass direction or map reveal)
- asking for quest people inside will point one to the building and compass direction (this is wrong when player is already in the same building and I will work on a different approach for such case - see forum post and tell me your opinions: http://forums.dfworkshop.net/viewtopic.php?f=23&t=672&p=11888#p11887)
- savegame support - there was a problem with loading conversation data regarding quest resources, quest data is restored first now and then the conversation data is loaded and data is relinked to loaded quests
- questor is hidden from topic list if it is the dialog partner
- quest place resources which are regional houses will now show up in list ""Where Is"" -> ""Location"" if pc learned about them through dialog or quest
- quest place houses are now revealed on map correctly (revisited after Interkarma's feedback - much cleaner now)
- update to ExteriorAutomap regarding quest named residence resolving after Interkarma's feedback"
185963695,Preparation for assigning enemy spell lists,Allofich,2018-05-04 12:00:35+00:00,2018-05-06 07:44:09+00:00,{},"Enemy spell lists and a setup for assigning spells to enemies, same method as classic. Nothing is actually assigned yet.

The spell lists are the same as in the executable (although they are each terminated by `0xFF` there), just arrays of bytes that are the spell IDs."
185951846,"Add TG and DB bribing judge, and fixes",Allofich,2018-05-04 10:59:46+00:00,2018-05-06 07:43:32+00:00,{},"- Adds Thieves Guild and Dark Brotherhood bribing judge.
- Fixes enemy-clearing method I added last time (it should have been destroying the game objects)
- Addressed a couple oversights in classic. The player should always be healed and get their reputation partly repaired if they are found not guilty now."
185041729,Fixed a talk window bug,TheExceptionist,2018-04-30 19:24:33+00:00,2018-04-30 22:55:19+00:00,{},"I noticed a dialogue bug when switching from the ""Where is -> Person"" to ""Where is -> Location"". The root cause the variable ""inListboxTopicContentUpdate"" remaining true after the player asked ""Where is -> Person"". I rearranged when the variable is set to true to solve this issue.

Relatively small fix, but I'm still getting used to the codebase :)"
185040925,Fixed a dialogue bug,TheExceptionist,2018-04-30 19:21:00+00:00,2018-04-30 19:23:39+00:00,{},Fixed a bug where the player could ask for a location after asking for a person.
185011383,Fix enemies shooting bow too much,Allofich,2018-04-30 17:08:42+00:00,2018-04-30 22:57:10+00:00,{},"My earlier fix in https://github.com/Interkarma/daggerfall-unity/pull/657 included removing a limiter on the AI decision code that timed it to classic's slower update rate, but doing so made bow attacks way too rapid. This fixes it by putting it back for the ranged attack (while also avoiding the earlier problem that was the reason I removed it)."
184934883,Talkwindow implementation: questor is added to talk options + fix,Nystul-the-Magician,2018-04-30 11:37:23+00:00,2018-04-30 22:57:59+00:00,{},"questor of current quest is added to list of persons in ""where is""->""person"" section of talk window
answers not implemented right now
fix: quest related talk topics now get correctly removed if quest is neglected"
184927922,Progress court screen,Allofich,2018-04-30 10:55:43+00:00,2018-04-30 23:00:11+00:00,{},"Player can now choose ""Not Guilty"" and try to debate or lie.
Time is now passed for prison sentence (still no prison screen).
Flags set for execution/banishment. (No effect yet. They are supposed to cause guards to spawn when player enters a settlement in that region from then on)
Messages positioned correctly.

Unfortunately, the pause at the end when returning the player from the court screen seems to be even longer now (perhaps because of raising time for the prison sentence). People will probably think the game has frozen so this needs to be fixed. Any ideas? "
184856028,Headnod,MeteoricDragon,2018-04-29 21:31:22+00:00,2018-04-30 23:00:48+00:00,{},"This upgrade to HeadBobber.cs adds a head nodding mechanic to the headbobbing movement.  A very subtle nod.  

@Interkarma  I was wondering if it would be acceptable to implement a three-stage toggle into the Daggerfall pause menu for those who prefer the original version.

First stage: box unchecked, Head bobbing turned off.
Second Stage: box lower half checked.  Head bobbing movement as it exists in latest build is turned on.
Third Stage: box completely checked.  Head bobbing movement includes the new nodding movement for increased detail.

Cycling these stages: Click the box to cycle between them much like the box is toggled between the two stages right now :)

the head bobbing option in the pre-launch menu would need to be changed to a slider."
184851484,ModSystem: Allow mods to take part of game load/save logic,rossipaolo,2018-04-29 19:57:34+00:00,2018-04-29 21:04:59+00:00,{},"Added interface which allows mods to store and retrieve custom data inside save folder.
Data package is automatically de/serialized as json like core save data."
184846027,Fix loading saves outside losing guild membership data,ajrb,2018-04-29 17:51:38+00:00,2018-04-29 21:04:20+00:00,{},Pretty stupid mistake on my part. :(
184649687,Refinements to court screen/arresting,Allofich,2018-04-27 15:08:23+00:00,2018-04-29 21:03:57+00:00,{},"Moved the message down and removed the background dimming. The court screen is already a dark screen and you can't see it clearly if it is dimmed.

Of course as I'm sure you know Interkarma there is no dimming for any pop-up messages in classic. I've been generally leaving it in place in DF Unity because I assume you put it in because you like it, but I don't know if you have anything decided about it. For this case at least I think it looks better without."
184635202,Minor adjustments to enemies,Allofich,2018-04-27 14:17:07+00:00,2018-04-29 21:02:36+00:00,{},"- Change silver damage bonus back to Skeletal Warrior.

Recently someone working on OpenTESArena found that original Arena gives silver weapon damage bonuses against undead, so I no longer think this was a mistake. However, it might be a mistake or oversight that it only applies to the Skeletal Warrior and not other undead types. Changing that might affect gameplay too much, though, if it made undead enemies too easy, so I just put it back on the Skeletal Warrior like in classic.

- Make enemies stop when turning while pursuing again (not needed because of the faster turning now). This will remove the odd-looking behavior of dashing off to the side when you approach enemies from behind, etc.

About the turning, though, I think it may be too fast at the moment. Specifically, if an enemy goes from facing sideways to looking towards you the turn looks instantaneous. I think it should be slow enough that you see all the in-between animation frames."
184288923,TextureReplacement: fix regression for loose files,rossipaolo,2018-04-26 10:06:22+00:00,2018-04-26 21:26:44+00:00,{},Fix for [bug with imported textures](http://forums.dfworkshop.net/viewtopic.php?f=24&t=966).
184019361,Material Reader: Use Shader.PropertyToID,rossipaolo,2018-04-25 12:29:59+00:00,2018-04-26 21:27:02+00:00,{},
184012416,Progress court screen,Allofich,2018-04-25 12:02:26+00:00,2018-04-26 21:28:47+00:00,{},Note that there seems to be an issue with the MIDI playback in DF Unity and the song used for the court screen (Song_11) where the instrument at the beginning of the song doesn't play. At first I thought the song wasn't playing at all but you wait a few seconds you'll hear music.
183607752,Framework for background questions,MeteoricDragon,2018-04-24 02:53:06+00:00,2018-04-26 14:39:19+00:00,{},"Lays some framework only.  Creates a class for background questions that are supposed to be able to keep track of which classes it is applicable to in the 12-question questionnaire for the character creation.  Has been tested somewhat

**Also not sure if this is the appropriate folder for the files**"
183526229,Asset injection: Import terrain textures from mods,rossipaolo,2018-04-23 18:56:58+00:00,2018-04-23 23:59:30+00:00,{},"* Terrain textures can be shipped in a single dfmod file.
* Removed some old methods for loose files import which are not needed anymore.

I'm using Shader.PropertyToID() because methods for access to shader properties have an int overload, which is faster than the string one (i believe the string method just call PropertyToID everytime).  I wrote a static class to holds all these values like the post processing stack does. What do you think of moving it to MaterialReader and use it project wide?"
183316189,Merging smooth-crouch,Interkarma,2018-04-23 03:12:30+00:00,2018-04-23 03:12:52+00:00,{},
183312724,Sound Scaling Fixes,MeteoricDragon,2018-04-23 02:34:28+00:00,2018-04-23 03:06:15+00:00,{},"Makes it easier to max out the volume bar on sound and music

I want to add more fixes to this branch before it gets merged to master, but I wanted to create it to discuss some potential fixes to making all the sounds scale with the audio volume setting.

PlayerFootsteps uses an AudioSource called customAudioSource and a DaggerfallAudioSource called dfAudioSource.  The former is used for default footsteps and the latter is used for other footsteps. 

TransportManager does something similar for keeping the horse whinny sound separate from riding sounds.

In addition to horse and footstep sounds, it seems like dungeon ambient sounds and enemy sounds aren't being affected."
183296009,Croucherfullbackup,MeteoricDragon,2018-04-22 21:42:59+00:00,2018-04-23 03:07:49+00:00,{},"Hey Interkarma.  Here is smooth croucher code, I have tested the code and haven't seen the player get stuck in any doorways, and it works well with HeadBobber and CameraRecoil.

This code makes the player smoothly (and quickly) crouches or stands up.  There is also a function that uses a Spherecast to check if the player has room to stand up.  If the player tries standing up when there's no room, the code waits until the player has moved out of the area and then stands him up.

When crouching, the code first lowers the camera, then crouches the playerController.  When standing, the opposite order happens.

Most of the code is in croucher.cs.   PlayerMotor is mostly untouched, I kept in mind what you said about PlayerMotor being due for a rewrite.  I felt that maybe if I reallocated crouching code from playerMotor into a separate class (croucher.cs) and include a variable for that class in PlayerMotor to access its functions, it would make the rewrite slightly easier as well as keep PlayerMotor less touched."
183212089,Crimes modify faction reputations,Allofich,2018-04-21 08:05:31+00:00,2018-04-23 03:04:06+00:00,{},"Crimes now modify player's reputation with ""people"" factions in the same manner as classic.

Also identified the parts of the faction records in `SAVEVARS.DAT` that were unidentified. If we wanted to it's probably possible to create the parent-child relationships of factions just by reading in and using the 3 pointers at the end of each faction data record from `SAVEVARS.DAT`, rather than creating them by reading `FACTION.TXT`, but of course what we have already works."
183061849,TextureReplacement: Import materials from mods,rossipaolo,2018-04-20 13:25:55+00:00,2018-04-23 03:03:06+00:00,{},Import materials from mods with load order.
182360457,Improve Headbobber support for other code,MeteoricDragon,2018-04-18 03:47:27+00:00,2018-04-19 22:11:03+00:00,{},"Changes the statement that assigns the mainCamera.transform.localposition so that it adds the difference between it's current position and new position to the current position.
This allows other code from other classes to modify the localPosition of the camera without the Headbobber dominating the position.
This commit is being made to incease compatibility with other code I'm working on, without changing the functionality of headbobber."
182170570,More work on guards and crime,Allofich,2018-04-17 13:42:51+00:00,2018-04-19 22:09:37+00:00,{},"- Added crime enum and variable to track player's crime to playerEntity, and import this value from classic saves.
- Set the crime variable for the easy cases (murder, pickpocketing, vagrancy). The others will take a little more work to get right.
- Guards spawn further away (max distance should be equal to classic). Enemy sight increased (also FOV, which hadn't been properly updated before. I think I only changed the prefab for the Standalone Enemy and not the Serializable one). I believe the FOV matches classic and the sight matches the maximum distance an enemy can exist in classic (in outdoors environments) before being despawned, which may or may not be the same as sight range. Regardless, pursuing by guards or other monsters works much better.

A couple notes:
- Using the foe spawner, when multiple enemies spawn at once they always seem to be at the same distance. Is this intended? This isn't necessarily a bad thing but I think when multiple guards spawn in classic they each get their own random distance. I tried creating multiple 1 enemy FoeSpawners in a loop but the result was the same.
- Classic only stores a single ""type of crime committed"" variable for the player. We should probably sum together all crimes instead, but that can come later. We'd have to figure out how to adjust the court screen to handle multiple crimes, though."
182142069,Minor fixups for classic record reading,Allofich,2018-04-17 11:59:22+00:00,2018-04-19 22:08:27+00:00,{},"Added back wagon check to ContainerRecord.

Revised some comments."
182026330,Stopping head smoothing improvement,MeteoricDragon,2018-04-17 01:06:37+00:00,2018-04-17 01:40:41+00:00,{},"In addition to the initial camera smoothing.  The script now also smooths camera movement to resting position when the player stops moving.

Also now executes less code using better if control structure, and doesn't execute while the game is paused."
181709825,Improve Headbobber,MeteoricDragon,2018-04-15 17:15:29+00:00,2018-04-16 21:50:07+00:00,{},"Improves the camera movement transition from stationary to moving.  It's now much smoother when starting to move, the camera won't jerk about suddenly.  Some people may not have noticed this since the head bob is very subtle, but it was especially noticeable when moving and crouching."
181679118,Sound music,MeteoricDragon,2018-04-15 03:43:33+00:00,2018-04-19 22:07:49+00:00,{},Implements Music volume control in DFU.  Sound volume control is implemented but not tied to anything because I'm not sure where the most appropriate place(s) to put the global sound multiplier is.  (do we want to scale *all* sound effects?
181659018,More classic data identified + Save Explorer improvements,Allofich,2018-04-14 17:48:47+00:00,2018-04-17 01:40:14+00:00,{},"Recently I found that FALL.EXE contained a collection of strings that matched to the object types, although it's incomplete. This updates the `RecordTypes` in `SaveTree.cs` (I believe these are referred to as ""Objects"" in classic), noting the names from classic and also information on them I have reversed.

I also improved Save Explorer a little.
- Do not start with the faction drop-down open. This was an annoyance as I had to close it every time.
- Identify all ""Container"" types, not just the wagon.

And of course the work on identifying record types carries over to Save Explorer."
181646063,Modsettings: Improvements,rossipaolo,2018-04-14 12:42:42+00:00,2018-04-16 22:00:34+00:00,{},"Commit descriptions explain in details, this is a short list of changes:
* Local values and local presets are serialized as json files like mod presets, and all implements the same interface. They are created and applied to an instance of ModSettingsData.
* Sections can have an optional description. Section description is shown below their name while individual keys description are still shown as tooltips.
* Sections can have a ""IsAdvanced"" flag for options which should not be changed by most users but for which is still worth not being hardcoded.
* Not strictly related to mod settings, but i've hadded a ui class which easily draws multiple textboxes in a rect. I'm using it for tuples, as a corrispective of EditorGUI.MultiFloatField."
180455284,Merge CameraRecoil to master,Interkarma,2018-04-09 23:40:09+00:00,2018-04-09 23:40:17+00:00,{},
180194789,Camera recoil,MeteoricDragon,2018-04-09 01:55:35+00:00,2018-04-09 02:05:40+00:00,{},"I added the new ""CameraRecoil"" script as a component to PlayerAdvanced in unity. but I didn't see it appear as a changed file in the commit I submitted.  I say this partially because unity told me that the script part of the component was missing. So I removed the component and added a new component to the CameraRecoiler script.  You may need to check it before running it.  It works on my side."
180152933,Implement blood splash for townspeople and basic guard spawning,Allofich,2018-04-08 10:39:33+00:00,2018-04-09 08:54:28+00:00,{},"This adds blood splashes for killing townspeople and basic guard spawning (only for killing townspeople for now).

I think that guard spawning behavior in classic involves LOS checking from townspeople, and nearby ""townsperson guards"" and regular townspeople (1/3 chance) are the first choices for spawning guards. The fallback behavior after that is what this PR uses. I may need some help from you Interkarma to do that. Basically I would want to be able to iterate through the townspeople, doing an LOS check from each of them to the player, and also to be able to use the location of a townsperson as a spawn point (not sure if we actually want to do that for regular townspeople, it may have been intended to simulate them ""clearing the streets"" but it may be more immersive to not do it that way, but for guards as townspeople at least we'll want the ability to spawn from their position)."
180149947,Implement normalization of reputations,Allofich,2018-04-08 09:25:43+00:00,2018-04-09 08:53:19+00:00,{},"Implements gradual return of reputations to 0, matched to classic.

Also some cleanup, comments, etc.

I removed the unused stuff for legal reputation in PersistentFactionData.cs, trying to keep the mess of all this WIP stuff under control a bit, since legal reputation all being done in the playerEntity's regionData array at the moment. If you want to refactor this stuff later, Interkarma, to make it all more tidy or fit some code organization you have in mind, that's OK with me.

I'm looking into guard spawning, btw, which ties into legal reputation work."
180138966,Camera Recoil,MeteoricDragon,2018-04-08 04:18:30+00:00,2018-04-08 22:25:50+00:00,{},Everything is done. I tried to make my commits more incremental this time to show what I changed.  Improved the formula too.
180112803,Progress on conditions,Allofich,2018-04-07 16:18:45+00:00,2018-04-07 21:47:37+00:00,{},Changes to faction power are disabled until power can be raised in some way.
180102071,"Add ""already defaulted"" bank behavior",Allofich,2018-04-07 11:45:42+00:00,2018-04-07 21:46:29+00:00,{},"Just a note, I started to add behavior for reading classic's bank records because it wasn't in what I thought was the ""usual"" spot, in ReadRecords() in SaveTree.cs. It seems like that should be consistent. But at least it meant the work of converting the read data to DF Unity was already done.

Maybe Interkarma though the same thing when he made this bug report?
http://forums.dfworkshop.net/viewtopic.php?f=24&t=788
Or maybe he made that before the code to read the data was added? Anyway the boolean that was being skipped is now read and used, so that report can be closed."
179850694,Add Camera Recoil to DFU,MeteoricDragon,2018-04-06 04:11:36+00:00,2018-04-07 21:50:00+00:00,{},"Adds head recoil (screen stagger) when taking damage.  ""Camera Recoil"" Toggle on the first page of settings.  Default is ON.  Camera sway is **increased per point of damage taken**. Formula is in GetRotationVector() in HeadRecoiler.cs."
179499752,Add two new interaction modes with icons,ajrb,2018-04-04 20:13:35+00:00,2018-04-05 10:44:24+00:00,{},"Using the icons posted on forums by Ravenborn here: http://forums.dfworkshop.net/viewtopic.php?f=19&t=884

Also moved icons into their own folders since there are now 16 files + meta."
179071425,ModSettings: fixes and tweaks,rossipaolo,2018-04-03 11:39:28+00:00,2018-04-04 02:43:43+00:00,{},
178967138,Fixes bug introduced by HeadBobber,MeteoricDragon,2018-04-03 00:44:01+00:00,2018-04-04 02:29:59+00:00,{},Fixes bug where the player appears to stand up after falling to death animation plays.
178735454,Fix loading issue with active commoner quests,ajrb,2018-04-01 16:01:17+00:00,2018-04-02 23:48:31+00:00,{},"Quest system is not designed for commoners who have no faction in DF data. We should discuss if the faction should be set to same as I use for work npc data, but I decided to leave it alone and simply allow faction id of 0 for questors.

Also fixed some guild quest macros by adding an external MCP to quest (tried keeping it external, but some messages are generated internally only - e.g. journal entries) so that any %abc macros not handled by quest MCP can be handled by an appropriate context MCP such as guild."
178734486,"ModSettings: Editor window, improvements",rossipaolo,2018-04-01 15:38:47+00:00,2018-04-02 23:45:02+00:00,{},"Settings are now serialized with 'ModSettingsData' class. This bring two advantages:
* Settings and presets are edited from a single editor window. Changes are automatically propagated to presets in a non-destructive way.
* Polymorphism allow a more flexible and future-proof layout.

For the moment i'm still using an enum to detect different controls for UI, maybe i'll move everything inside key classes with overrides. There is probably some other semplification or cleanup that could be done, so please do not merge this yet. Note that i made some breaking changes for a few of my mods but Nystul and Lypyl mods that rely on the old non type-safe ini file are still supported.

This is a pretty big change and i'm happy to receive any feedback on code as well as usability of the editor window before merging with master. You can open it from Daggerfall Tools>Mod Settings. Maybe we can integrate it with Mod Builder in the future.

![modsettings](https://user-images.githubusercontent.com/24359151/38174786-1bb40984-35d3-11e8-9dee-3639ba959d96.png)

```
{
    ""Version"": ""1.0"",
    ""Sections"": [
        {
            ""Name"": ""Section(1)"",
            ""Keys"": [
                {
                    ""Min"": 0.0,
                    ""Max"": 1.0,
                    ""Value"": 0.739000022411346,
                    ""Name"": ""Key"",
                    ""Description"": null,
                    ""$version"": ""v1"",
                    ""$type"": ""DaggerfallWorkshop.Game.Utility.ModSupport.ModSettings.SliderFloatKey""
                }
            ],
            ""$version"": ""v1""
        },
        {
            ""Name"": ""Section"",
            ""Keys"": [
                {
                    ""Value"": false,
                    ""Name"": ""Key"",
                    ""Description"": null,
                    ""$version"": ""v1"",
                    ""$type"": ""DaggerfallWorkshop.Game.Utility.ModSupport.ModSettings.ToggleKey""
                },
                {
                    ""Value"": ""This is a test text.\nNew line!"",
                    ""Name"": ""Key(1)"",
                    ""Description"": null,
                    ""$version"": ""v1"",
                    ""$type"": ""DaggerfallWorkshop.Game.Utility.ModSupport.ModSettings.TextKey""
                },
                {
                    ""Value"": {
                        ""r"": 4,
                        ""g"": 221,
                        ""b"": 15,
                        ""a"": 0
                    },
                    ""Name"": ""Key(2)"",
                    ""Description"": null,
                    ""$version"": ""v1"",
                    ""$type"": ""DaggerfallWorkshop.Game.Utility.ModSupport.ModSettings.ColorKey""
                }
            ],
            ""$version"": ""v1""
        }
    ]
}
```

"
178701246,Fix quests,ajrb,2018-03-31 21:28:40+00:00,2018-03-31 22:56:23+00:00,{},"Have gone through all guild quests and removed all changes Jay_H made to work around unimplemented quest system features. These will all start working once those features are finished.

Still a few work arounds in the TG + DB joining quests to allow players to join for now.

Updated all notes in quest list, and removed all the errors that were caused by testing using command line instead of a questor.

Fix commoner assigned quests by finding people of region faction id and allowing faction id 0 on static npc."
178656830,Merge head-bobbing,Interkarma,2018-03-31 00:28:19+00:00,2018-03-31 00:28:25+00:00,{},
178609080,Work on diseases,Allofich,2018-03-30 18:19:02+00:00,2018-03-30 23:49:56+00:00,{},"Does the following:

1 - Clean up, simplify disease code.
2 - Import diseases from classic, all data identified.
3 - Support for multiple diseases, as in classic. Can show multiple diseases in status window, also as in classic.
4 - Classic's ""incubation"" figured out. Diseases just go into effect as soon as the date changes. Put in an approximation of this for DF Unity. It's kind of mechanical for diseases to always take effect exactly at midnight, so made it a random value of 1 to 1440 minutes (full day), effectively the same  min and max values it could be in classic.
5 - Matched disease enums to classic"
178596013,TextureReplacement: some size fixes,rossipaolo,2018-03-30 16:57:56+00:00,2018-03-30 23:46:45+00:00,{},Fixed a few windows reported on forums. Also removed a workaround for paperdoll background which is not necessary anymore since we can cut imported textures now.
178479353,Head bobbing,MeteoricDragon,2018-03-30 01:57:06+00:00,2018-03-30 23:58:01+00:00,{},This implements Head Bobbing and the ability to toggle and save the setting.
178450080," Add TG + DB, make non-member quests availiable when rep less than 0 ",ajrb,2018-03-29 21:47:31+00:00,2018-03-30 23:48:08+00:00,{},"3 days ago I thought I would knock out the remaining two guilds that evening... yeah, there was a lot of extra stuff to do than I expected so that didn't happen. 

Here it is now though - all types of quests except for daedra are now availiable in game!"
178284571,"MeshReplacement: Improvements to trees, refactoring",rossipaolo,2018-03-29 10:12:38+00:00,2018-03-30 23:46:16+00:00,{},"* Use new generic methods from ModManager
* Expose trees settings to mods with callbacks"
177729578, Generalise the social quest work allocation system to cover commoners & nobles,ajrb,2018-03-27 12:51:11+00:00,2018-03-28 22:55:36+00:00,{},
177506198,Fix bug with resting in houses causing exception cant find guild for ‚Ä¶,ajrb,2018-03-26 16:52:13+00:00,2018-03-26 22:09:32+00:00,{},"‚Ä¶faction id 0

Thanks for finding this Allofich, and apologies if it got in your way or caused you any grief. When I changed the guild manager design while doing temples I missed that statement."
177464510,Start implementation of regional conditions,Allofich,2018-03-26 14:28:49+00:00,2018-03-28 22:54:39+00:00,{},"This is the start of implementing regional conditions. Only famine is handled now, and there are no in-game effects, only debug.log messages about the famine phases. As with randomEncounters, this is being handled in PlayerEntity for now but could be moved later. This is all matched to classic behavior."
177439886,Spawn random encounters,Allofich,2018-03-26 13:06:20+00:00,2018-03-28 22:53:41+00:00,{},"Random encounters spawn now. Thanks for the FoeSpawner, Interkarma.

I don't know if adding a FoeSpawner to the ""options"" part of DaggerfallUnity prefab is correct style-wise, I just followed the example of existing uses of InstantiatePrefab.

In game it works fine. While in the wilderness in classic enemies actually spawn from a little farther away, but currently at that distance enemies don't react to the player in DF Unity nor does the ""There are enemies nearby"" message appear, so for now I just have it using the default FoeSpawner distances."
177280021,"Modify Assets/Resources/Songs/sunnyday.mid , it was too damn long.",heilkitty,2018-03-25 09:11:48+00:00,2018-03-26 00:05:06+00:00,{},"Assets/Resources/Songs/sunnyday.mid had empty MIDI events at the end, so its length was 23:58 total, most of it just silence. Removed them in Muse, now it's 0:56, perfectly reasonable."
176936186,Handle exterior NPCs and add Witch Coven popup with quests,ajrb,2018-03-22 23:23:57+00:00,2018-03-26 00:04:34+00:00,{},"Also:
-Added social quests (merchants, nobles etc)
-Expanded utility of dumplocblocks command, the command can now take multiple block names.
-Added another shelf id"
176526267,Misc fixes,Allofich,2018-03-21 16:03:01+00:00,2018-03-26 00:04:12+00:00,{},"Implemented climbing fatigue penalty, which I forgot to do before.
Show warning for traveling with diseases when they are past incubation. I had mistakenly thought they only showed during incubation."
176278542,Lay groundwork for random enemy encounters,Allofich,2018-03-20 18:11:43+00:00,2018-03-26 00:03:55+00:00,{},"This adds the groundwork for random enemy encounters implemented like classic. Right now there is are no functional changes.

Adds:
- All enemy encounter lists from classic
- Classic function for choosing enemies (not being used for anything yet, and not tested)
- Incomplete classic function for spawning random enemy encounters

Interkarma, I hope maybe you can give some advice for filling out the remaining parts. These are the remaining issues:
- The main issue: How to spawn a nearby enemy? I know this is implemented for quests, but is it tightly wound up in that, or is there a convenient method available for spawning an enemy nearby, with the only parameter being the enemy type?
A couple of minor issues:
- Need to set and store a variable to disable monster spawning in some circumstances(fine to just add it to the PlayerEntity?)
- Need to somehow check whether in the rest menu. Classic has a global variable that stores the current popup window mode and just checks that from within this function. I wonder if we have a similar convenient way to handle it all just from within this one function.

Also this function, like the regional price adjustments and climate changes, should perhaps not be in the PlayerEntity. I've just been sticking everything in there from classic that is involved with updating the game world when the in-game time (minutes) changes."
176038844,Buy potions implementation,ajrb,2018-03-19 22:07:13+00:00,2018-03-19 22:09:37+00:00,{},
175776277,Texture replacement: Import billboard textures from mods,rossipaolo,2018-03-18 22:05:24+00:00,2018-03-19 22:08:13+00:00,{},"Textures for billboards can now also be imported from mods, in addition to loose files. This include xml files with optional scale and uv.

I was hesitant to do this at first because there is a possible issue of unwanted mixing of resources when a mod includes a texture with an xml, and another one in a lower position includes the same texture but without the xml. The same may happens for emission maps. If this became a problem we could fix this at a later time loading everything only from the last mod that include the first main texture frame. 

What's left now are textures for 3d meshes. I think it would be a pity not to benefit of Unity materials, so my idea is to load them directly. It's a bit of an hassle for the most simple texture packs with only the albedo, but i believe is the wisest idead in the long run. Textures from loose files would still be imported individually and set on the (default or imported) material. What do you think?"
175755382,Fix enemies without ranged attacks not pursuing,Allofich,2018-03-18 14:58:30+00:00,2018-03-19 22:06:24+00:00,{},"At some point I seem to have accidentally made it so that all enemies hold their ground at range, not just those with ranged attacks. This fixes it."
175745697,Bugfix: save factionId with quest,ajrb,2018-03-18 11:09:12+00:00,2018-03-19 22:05:46+00:00,{},"This was a pretty bad and stupid oversight on my part! This fix stores the faction id so that the rep is changed correctly when the quest finishes. Currently it only changes the faction rep if you don't save and reload between taking the quest and completion which is pretty rare.

Would you please create a new build and remove the #102 build once this bugfix is merged and validated. I consider it that serious. (as in it breaks the whole guild system since you can't get promotions)"
175705991,Implement classic cure disease cost (WIP),Allofich,2018-03-17 15:35:28+00:00,2018-03-19 22:02:45+00:00,{},"Implements classic cost for cure diseases.

Some additional work needs to be done. @ajrb, I need your help to figure out some stuff. The main thing, which I think should be fixed before this is merged, is displaying the correct cost amount in the dialogue. Temple healers use the same ""bartering dialogue"" as shopkeepers. However right now the amount given in the dialogue doesn't reflect the actual amount that curing the disease costs. These messages have a `%a` macro that is used in classic, but in DF Unity it looks like this macro is unimplemented. Why do the shopkeepers show the correct value? We need it for this dialogue, too, and the cure calculation will need to be figured out before the message shows, not after as it is now.

Otherwise, this doesn't have to be in right now, but the cure service gives a discount based on rank. It wasn't obvious to me where to get the player's rank in the temple."
175064705,Quest Packs implementation,ajrb,2018-03-14 19:42:07+00:00,2018-03-14 22:31:54+00:00,{},"Implemented the functionality to load new quests in DFU. It's still only for guild quests for now, but it will load lists and quests from mods as well as StreamingAssets/QuestPacks for people who may not want to have to build, maintain and release a full modpack just to add quests.

Also fixed error in the classic quest list and added a DFU quest list with the CUSTOM01 quest in it. I'm not sure if you wanted to ship DFU with some non-classic quests in, but this is where they should go if you do. 
"
174595023,Knightly orders done,ajrb,2018-03-13 09:06:57+00:00,2018-03-14 04:36:41+00:00,{},
174368040,Set player death sound by race and gender,Allofich,2018-03-12 13:30:52+00:00,2018-03-13 07:47:55+00:00,{},"This sets the death sound by race and gender.

Background:
There are 3 pain sounds for each race/gender combination in the sound files. Classic only uses one of these, the second in the Male Wood Elf set, for the player regardless of their race or gender in the original game.

By my judgment the sounds generally seem to sound like
1. Hurt/Exertion
2. Hurt/Exertion more
3. Dying

The ""hurt"" sounds might also be interpreted as exertion while attacking. For example the Breton Female ""Hurt 1"" is the same as the Nymph's attack. But generally across the board I think they sound more like being hurt than doing an attack. I think the 3rd one is pretty unambiguous across the board as a ""dying"" sound, so that's the only one I'm using for this so far. I'm thinking maybe the other two could be used as pain sounds for something like > 50% health and < 50% health.

I initially made this as a setting, and I still have that version locally, but this is pretty much going into the realm of bug fix I think, since you shouldn't get a male voice for a female character. If people are nostalgic for the voice used by classic, we could have the setting, but I think maybe we could just wait to see if anybody wants it first. 

"
174187262,Add donation and cure disease guild services,ajrb,2018-03-10 20:08:57+00:00,2018-03-13 07:48:42+00:00,{},"Cure is very skeleton for now, Allofich and I will flesh out soon."
174175981,JH classic quest fixes - first pass complete,ajrb,2018-03-10 15:51:34+00:00,2018-03-13 07:49:16+00:00,{},This is the work that Jay_H has been doing to fix classic quests. First pass complete for all the guild quests.
174171810,Progress on diseases,Allofich,2018-03-10 14:07:43+00:00,2018-03-13 07:47:27+00:00,{},"Implements:
- Classic diseases' stats (which attributes they affect, etc.)
- Diseases that endlessly lower stats vs. those that don't. When a non-endlessly-lowering disease finishes, it sets its number of days left to 254 (0xFE) in classic. Doing it the same way, which should aid in importing diseases from classic saves.
- Length of disease and damage values gotten like in classic.
- Diseases lower stats in the same manner as classic and can kill the player.

Diseases are disabled now until a way to cure them is implemented.

I haven't figured out how classic does the incubation period yet. Also there is no ""you may not survive"" message for traveling. Length of disease period will need to be saved and loaded. Poisons aren't implemented yet. Neither are imported from classic saves yet."
174070056, Add reputation change calls to quest end for guild quests,ajrb,2018-03-09 18:00:56+00:00,2018-03-09 23:44:50+00:00,{},
173874753,Initial version of manging quest tables,ajrb,2018-03-08 22:57:10+00:00,2018-03-08 23:25:23+00:00,{},Just Fighters and Mages so far.
173605695,Allow automap to be overridden by building replacements,ajrb,2018-03-07 23:40:34+00:00,2018-03-08 09:22:27+00:00,{},
173443008,Guild mods - new full PR with merged conflicts,ajrb,2018-03-07 12:52:50+00:00,2018-03-07 21:22:33+00:00,{},"Sorry for the delay, please merge this in with master. Has some minor extra bits for custom items."
173331940,Creating guildModHooks PR,Interkarma,2018-03-07 01:49:51+00:00,2018-03-07 21:21:54+00:00,{},Some conflicts will need to be resolved before merging.
173167523,"talk functionality: fixes and extended error handling, added demo quests",Nystul-the-Magician,2018-03-06 14:06:36+00:00,2018-03-07 21:24:24+00:00,{},"rumors property for resources now correctly generates rumor mill entries
minor fixes and some additional error handling added
demo quests added to demonstrate talk functionality:
__DEMO14: demonstrates dialog linked resources and add dialog command to reveals anyinfo message
__DEMO15: demonstrates dialog linked resources (one resource is revealed when mentioned in message answer of other resource)
__DEMO16: demonstrates rumors property of resource and dialog link
__DEMO17: demonstrates rumor mill and dialog link
__DEMO18: demonstrates RumorsDuringQuest and dialog link
__DEMO19: demonstrates direction hints for dungeon locations"
172908125,added demo quest showing off rumor mill in conjunction with dialog link,Nystul-the-Magician,2018-03-05 15:58:08+00:00,2018-03-05 18:40:19+00:00,{},"example quest to demonstrate rumor mill and dialog link:
get information after (and only after) hearing the correct rumor - this is extending vanilla daggerfall's behaviour - once an npc talked about the rumor the linked dialog option will be available in the tell me about section - rumor mill gives one of two possible answers (and you will have to try quite often, since these 2 answers only get added to the list of rumors) - only one of the two answers is revealing the person name in tell me about section (after getting the correct answer you still have to switch dialog option and then it will show up in the tell me about section) you can then ask peasants for the correct place where the person can be found (todo: seems like the quest person does not show up, not sure why, but this is not related to talk mechanics)"
172668558,Match disease infliction by enemy type to classic,Allofich,2018-03-03 14:03:11+00:00,2018-03-04 21:23:01+00:00,{},"@ajrb Here is the PR we discussed. Interkarma, could you let ajrb take a look before merging? I didn't change much of what he had implemented.

I also added some todos for various bits to add into the damage code."
172626788,Fix interaction mode icons to use new tex loading and add large option,ajrb,2018-03-02 23:08:09+00:00,2018-03-04 21:21:14+00:00,{},
172617264,Guild mod hooks,ajrb,2018-03-02 22:10:54+00:00,2018-03-04 21:23:26+00:00,{},"1. Fixes to guild foundations.
2. Guild mod hooks:
2.1 Building replacement functionality in WorldDataReplacement reads building json from loose files or mods (also caches it when not running in editor in a non-sparse cache so abort calls early since block data is loaded a LOT - please check the code here @Interkarma & @TheLacus )
2.2 Register new custom factions, guilds, and services from mods
3. Fix NPC nameseeds
4. Three dump data commands

To test this you will need to do the following (after checking it hasn't broken anything first) to add my custom guild mod:

1. Download the mod file from my mod repo (https://github.com/ajrb/dfunity-mods/raw/master/build/StandaloneWindows/archaeologists.dfmod)
2. Place in StreamingAssets/Mods and ensure is activated
3. Load game and travel to Oxbeth
4. Look at map and find the large irregularly shaped building (actually is 2 separate buildings) get close to one
5. Use info mode and click on building - should say Archaeologists guild
6. Enter both buildings and interact with NPCs
7 Grin! :-D

Let me know if you find any issues. Hope you have some time to look at it this weekend.

 "
172233398,Disease foundations,ajrb,2018-03-01 13:15:42+00:00,2018-03-01 22:34:13+00:00,{},Ready for Allofich to do the formula when he has time.
172084819,Merging guilds branch,Interkarma,2018-02-28 21:58:18+00:00,2018-02-28 21:58:25+00:00,{},
171512304,Guilds - initial implementation,ajrb,2018-02-26 22:37:53+00:00,2018-02-26 23:06:41+00:00,{},"I could use another pair of eyes to test what I've done so far if you fancy giving it a spin.

Fighters, Mages, and all Temples & Templars should work. Resting is allowed in all once you join, and rank update checks are every day - for testing purposes. Basically rest 24 hours, save, edit rep/skills, load and speak to a guild person to get promotion / demotion."
171242745,TextureReplacement: Support for inventory icons,rossipaolo,2018-02-25 18:03:03+00:00,2018-02-26 23:01:59+00:00,{},
171236614,TextureReplacement: fix size of a few images,rossipaolo,2018-02-25 15:55:23+00:00,2018-02-26 23:01:21+00:00,{},
171233681,Add GetSubTexture() overload for relative subrects,rossipaolo,2018-02-25 14:51:09+00:00,2018-02-26 23:01:00+00:00,{},"This follows #629. Native panel size is only used in inventory window, so i wrote a single method that accepts a DFSize argument. A few classic textures were off by one pixel (which is visible at classic resolution) so relative rect is used only when necessary. Tell me if you have any suggestions or requests :)"
171187812,"Settings window: ""Theme"" settings",rossipaolo,2018-02-24 17:18:59+00:00,2018-02-25 06:02:27+00:00,{},"Added a few settings which where not exposed on GUI
![screenshot 2018-02-24 17 58 37](https://user-images.githubusercontent.com/24359151/36633013-743fa812-198e-11e8-95c1-494835eea48e.png)

InteractionModeIcon was not present in SaveSettings(), i assumed this wasn't intended but let me know :)

"
171164542,Minimize repetition in work dialogue code,numidium,2018-02-24 06:30:13+00:00,2018-02-25 06:02:52+00:00,{},I merged SetMerchantQuestors into GetBuildingList and made it part of its loop. Also updated TalkToStaticNPC so it checks to see if the NPC is a potential questor.
171155937,Merging merchantquests,Interkarma,2018-02-24 02:28:55+00:00,2018-02-24 02:29:01+00:00,{},
171050583,Asset injection: Improvements for movies and images,rossipaolo,2018-02-23 15:59:13+00:00,2018-02-24 02:28:18+00:00,{},"* Import movies from loose files
* Import Img, Cif and Rci files from mods. I had to merge seeking and import in a single method to avoid iterating mods and locations twice, but i don't think we lost much."
170954961,Clear rented rooms for new games,ajrb,2018-02-23 08:12:41+00:00,2018-02-24 02:24:53+00:00,{},"Sorry about the multiple commits - I updated my fork after pushing the fix to it which causes Github to do this. I'm avoiding this most of the time now, but I forgot this morning."
170650518,"Add ability to get ""work"" from merchants",numidium,2018-02-22 03:48:14+00:00,2018-02-22 06:26:56+00:00,{},"NPCs can now give answers about ""work."" Added a generic window for quest offering that can be shared among all the NPC social groups whenever questing for those groups is implemented.

I added a merchant quest table with one quest that seems to work. A table for nobility is included as an example of extending functionality of the new questing window but those quests are not handled as of yet."
170317886,Merging interaction icons into master,Interkarma,2018-02-20 21:47:55+00:00,2018-02-20 21:48:03+00:00,{},
170290189,Add classic interaction mode icons as option,ajrb,2018-02-20 19:46:15+00:00,2018-02-20 21:14:06+00:00,{},
170056205,Implemented interaction mode icon for HUD ,ajrb,2018-02-19 21:31:56+00:00,2018-02-20 13:21:46+00:00,{},"This is something I thought would compliment the minimal HUD of DFU and show the interaction mode at a glance for players. Intended to avoid accidental pickpocketing etc.

Art took much longer than the code, but is placeholder only since I really suck at drawing. I hope I managed to make them good enough to demonstrate the idea and get it into the codebase. Then we can petition the forums to create some nice icons for us.

Chuck this on a branch and give it a go when you get a chance. It can be disabled in settings just like crosshair."
169856265,Climbing Control Changes,LorrMaster,2018-02-18 23:13:42+00:00,2018-02-20 13:18:52+00:00,{},"Made changes to the PlayerMotor script to give the player more control while climbing. However, these changes deviate from the original game's climbing mechanics.

Basically you can now let go of the movement controls in order to stop while climbing, press the key to move backwards in order to climb down, and cancel climbing by pressing the jump key."
169852341,"Added mage guild quests to table, mostly commented out",ajrb,2018-02-18 21:58:33+00:00,2018-02-19 03:43:13+00:00,{},Also a correct for dupe TG training skill 
169819507,Merge housePurchasing,Interkarma,2018-02-18 07:58:19+00:00,2018-02-18 07:58:26+00:00,{},
169791052,Improve usability of language skills,ajrb,2018-02-17 16:50:54+00:00,2018-02-18 07:55:34+00:00,{},"Can train language skills up to intelligence stat level
Increased skill tally on success to 3
Added BCHG tag to changes from classic"
169787055,House selling and lighting 3d models,ajrb,2018-02-17 15:08:19+00:00,2018-02-18 07:57:06+00:00,{},"Also enabled mesh replacement, but still needs testing by a moddy person.
Added location name into savefile in case people forget where they bought houses."
169751254,"House purchasing, ship models & player housing",ajrb,2018-02-16 23:43:19+00:00,2018-02-17 00:02:47+00:00,{},"Sorry, far too excited about this so I've just handled loading inside a bank by using the no houses for sale message. I'm happy to switch from using BuildingDirectory to datafiles, but not convinced it's worth it for this edge case. Turned out the radius was easy to get once I had model id. Didn't even need Allofich for the price multiplier.

TODO:
* Only listing buildings for sale - will need to add other houses in due course.
* Selling houses. (should be easy since the name is changed by overriding in PlayerGPS)

Anyway, this is so you can give it a spin when you need a break from magic! This was a while in the works as I gradually learned but it all came together today really nicely. Such a good feeling!

Oh, and you may want to check my changes to Place for preventing quests spawning in player houses."
169518779,Shop & building schedules,ajrb,2018-02-15 23:59:12+00:00,2018-02-16 21:19:46+00:00,{},Also reinstated tally crime guild calls and disabled the function instead.. much easier to enable in one place later.
169235803,Asset injection: Import sound files from asset bundles,rossipaolo,2018-02-14 22:09:31+00:00,2018-02-14 22:36:26+00:00,{},"* Added a generic method to ModManager class to seek and import an asset of given type and name from all mods.
* Added support for sound import from mods. It was already possible to import them from disk, now they are also loaded from assetbundles with load order, like we discussed on forum for textures.

I did the same with videos but i prefer to test them a bit more before pushing."
169223734,Implement language skills,ajrb,2018-02-14 21:14:34+00:00,2018-02-14 21:55:12+00:00,{},
168452543,Add model 41026 to shop shelves list,ajrb,2018-02-11 13:03:35+00:00,2018-02-13 00:18:17+00:00,{},Also fixed inventory info panel not getting updated when moving items around
168451520,Add treasure marker containers,ajrb,2018-02-11 12:35:57+00:00,2018-02-13 00:17:59+00:00,{},Using table entry 'O'
168448624,Merge quest dispensing into guild service code,ajrb,2018-02-11 11:11:27+00:00,2018-02-13 00:17:12+00:00,{},"Finish merging quest dispensing into guild service code now that we're onto 0.5. 
Should appear completely unchanged to players.
Disabled old code, but leaving in for now so can switch back if issues found.

One thing that that is changed is that in PlayerActivate lines 860-880 the trigger of quest resource behaviour and quest listener check are both now done before the quest dispensing is activated, rather than after. This doesn't seem to affect anything as far as I can see, but I may have missed something so please let me know if I need to preserve the ordering for any reason."
168420432,Save breath and last ate into savedata,ajrb,2018-02-10 20:54:20+00:00,2018-02-13 00:13:24+00:00,{},Also moved strings for later localisation
168411161,Implement climbing,Allofich,2018-02-10 17:22:07+00:00,2018-02-13 00:11:29+00:00,{},This implements climbing. It's a mix of stuff I was able to figure out from classic (skill-checking formulas) and trial and error to get something that worked decently. I'm sure this still needs work but I think it's working well enough as a first iteration.
168385106,Spelling changes for consistency and faction dialogue bug fix,numidium,2018-02-10 04:18:53+00:00,2018-02-13 00:11:49+00:00,{},
168294612,Holiday macros %nt and %lp,ajrb,2018-02-09 17:11:07+00:00,2018-02-10 13:04:35+00:00,{},"includes palace naming for the big 3 with dungeons
also moved strings for future localisation"
167980114,Implement classic tavern room costs,Allofich,2018-02-08 14:03:39+00:00,2018-02-10 13:06:48+00:00,{},"This implements the following, matched to classic:

1) Same cost formula, including free for Heart's Day
2) Commented out code for free lodging for knights, once we have guilds implemented
3) Different messages depending on how well player bargained
4) Limit on renting days into the future includes days already rented.

Regarding 3, @ajrb, this causes code duplication with the trade window. Classic uses the same function for the display of the Yes/No bartering window. Since you wrote both the trade and tavern windows, maybe you can look at combining them. I started to play with doing so but it looked like it could get messy and I think you'd have a better idea of how to do it.

Btw there's a bug/oversight here in classic. The way the bartering message works is that you get one depending on how low the price after bargaining is compared to the original cost, but it seems classic doesn't set the ""before bargaining"" cost for the tavern room dialog, so what message you get depends on what the original cost value of your last trade negotiation was (or is 0, I assume, if you're starting off of a freshly loaded game). For this PR I properly set the cost for the tavern dialog."
167954631,Fix enemies losing track of player at close range,Allofich,2018-02-08 12:10:45+00:00,2018-02-10 13:05:17+00:00,{},"This should fix enemies losing track of the player at close range, and also mitigates the problem of them turning too slow, not by making them turn faster but by having them turn more often to keep the player in sight. This behavior should also be a little closer to classic. It may need more tuning but it seemed to work fairly well in testing."
167819424,Fixes for loot icon customisation,ajrb,2018-02-07 21:53:22+00:00,2018-02-07 22:14:15+00:00,{},
167545949,Add model id 13 to shop shelves and move 808 from house containers,ajrb,2018-02-06 22:21:56+00:00,2018-02-07 00:12:43+00:00,{},"Also fix bug with drop icon code

Model 41808 should be in house containers but classic has that model work as shop shelves in the shop from the bug report (http://forums.dfworkshop.net/viewtopic.php?f=24&t=852) so I've moved to shelves list.

This may cause wierdness if this model is in any non-shop buildings.. so we'll need to keep a lookout for that and move it back if any occurances are found."
167265433,Fix tavern locations to be towns,ajrb,2018-02-05 21:56:53+00:00,2018-02-05 22:07:40+00:00,{},Fixes the resting issue in tavern/lodge/inn locations
167091619,Merge dropIcons to master,Interkarma,2018-02-05 09:20:28+00:00,2018-02-05 09:21:20+00:00,{},
167031872,Tavern room rental system fully implemented,ajrb,2018-02-04 21:46:10+00:00,2018-02-05 09:20:00+00:00,{},"It works really nicely, hope I've not missed anything.

Hope you don't mind using the serialization object to store these things in player entity. Nothing needs transforming."
166966327,"Implement customisation of dropped icons, and display loot container billboard textures in inventory window ",ajrb,2018-02-03 15:22:49+00:00,2018-02-04 03:38:37+00:00,{},"Inventory destination icon:
Left click = next icon
Right click = prev icon
Middle click = next archive of icons"
166955993,Factor player ship into travel costs,Allofich,2018-02-03 10:10:06+00:00,2018-02-03 12:03:44+00:00,{},
166916176,Ship purchasing,ajrb,2018-02-02 22:16:03+00:00,2018-02-02 22:40:57+00:00,{},Can now purchase either ship. 
166916169,Merge sceneCache to master,Interkarma,2018-02-02 22:15:59+00:00,2018-02-02 22:19:32+00:00,{},Opening PR for merging sceneCache branch to master. Will test branch and merge to master as soon as possible.
166813964,Scene cache implementation to handle stateful game objects - finished,ajrb,2018-02-02 14:21:54+00:00,2018-02-02 22:13:38+00:00,{},"This is all finished up now and house containers are dealt with correctly. I also added a special case for travelling to / from your ship so the scene cache is not cleared. This means when you pop onto your ship and return, the town will be as you left it. Sort of simulates the ship being docked at the port, although works for non-port towns as a player convenience."
166404132,Scene cache implementation to handle stateful game objects,ajrb,2018-01-31 23:22:58+00:00,2018-02-01 01:07:22+00:00,{},"This is just for you to test where I am at since probably can't do any more for a day or so. 

Looks like I will need to merge Allofich's PR once you have accepted it into master and then create a new PR for this work. I synchronised my fork before changing the shelf stocking code... but still got caught out! lol  Is no problem at all, but will be best if I do the merging I think."
166279170,Implement classic stock for private property,Allofich,2018-01-31 14:46:25+00:00,2018-02-01 01:04:42+00:00,{},Also has minor cleanup to store shelf stock code.
165540387,Add shelf model ID,ajrb,2018-01-27 22:38:47+00:00,2018-01-30 00:53:56+00:00,{},
165529476,Implement classic store inventories,Allofich,2018-01-27 18:15:32+00:00,2018-01-30 00:55:12+00:00,{},"@ajrb, I found a shelf in armorers that should open a buying screen but doesn't. Model ID is 41047.

House container inventories aren't done yet. I'll do a separate PR for them."
165515086,Minor fixes,Allofich,2018-01-27 11:55:21+00:00,2018-01-30 00:54:16+00:00,{},
164962885,Allow purchase and selling of horse and cart,ajrb,2018-01-24 21:08:06+00:00,2018-01-25 22:38:58+00:00,{},"Now shops are working you need to be able to buy and sell horses and carts
Removed free horse and cart for new characters as well as books and ingredients, they will have to earn and sell for money now"
164848740,Fix dying from fall damage when fast traveling,Allofich,2018-01-24 13:29:42+00:00,2018-01-25 22:39:44+00:00,{},"In master branch it's possible to die from fast traveling if you hit the fast travel key while you were in the air (jumping for example) and the destination is lower elevation than the place you traveled from.

This fix works by clearing fall damage when teleporting. We might end up needing a different fix, because the player is also teleported to the correct position when loading a saved game, and you should still get fall damage if you saved mid-fall. You don't get any fall damage in master branch either, though, so this isn't a regression.

Or, if we can change the loading code to not use a teleport, maybe we can continue to use this fix."
164836536,Refine temporary shop shelf stocking to be more sensible for next build,ajrb,2018-01-24 12:33:56+00:00,2018-01-24 12:36:00+00:00,{},"Since you're making a final 0.4 build in next day or so, I though the shelf stocking should be refined to be vaguely sensible so I threw together a quick algorithm to tide it over until Allofich implements the real one from classic. (@Allofich didn't want to pressure ya mate)

Should probly have done this from the start, was me being lazy."
164681034,Enable player interaction with shelves,ajrb,2018-01-23 20:26:57+00:00,2018-01-24 09:15:19+00:00,{},"Shop shelves have loot containers and initiate trade. (random items for now)
Libraries are not shops - reverted my previous 'correction' and corrected existing code instead
Library shelves are marked as bookshelves and implemented reading (temples & guilds too)
Moved shelf stocking to building interior layout to avoid restock when empty.
Added member message for guilds and temple bookshelves
Refactored loot container handling in PlayerActivate
Added house container handling
Shop shelves are serialized, so persist across save/load but are not persisted when leaving building"
164555560,Fix out-of-bounds array access,Allofich,2018-01-23 11:55:27+00:00,2018-01-24 09:13:38+00:00,{},Would happen if you went off the edge of the loaded dungeon blocks (happened to me while levitating around in the void).
164549557,Fix blocks without start markers having water,Allofich,2018-01-23 11:26:50+00:00,2018-01-24 09:12:53+00:00,{},
164433381,Enable player interaction with shelves,ajrb,2018-01-22 22:25:49+00:00,2018-01-23 19:49:35+00:00,{},"Shop shelves have loot containers and initiate trade. (random items for now)
Libraries are not shops - reverted my previous 'correction' and corrected existing code instead
Library shelves are marked as bookshelves and implemented reading (temples & guilds too)
Moved shelf stocking to building interior layout to avoid restock when empty. 
Added member message for guilds and temple bookshelves

TODO: Serialization"
164339868,Implement enemy turning,Allofich,2018-01-22 15:40:23+00:00,2018-01-23 01:31:44+00:00,{},"This implements enemy turning, modeled after classic.

In master branch right now enemies don't have to turn, they instantly move in the direction they want to move. With this PR they turn and then move."
164293918,Fix some reversed enemy walking animations,Allofich,2018-01-22 12:27:40+00:00,2018-01-23 01:29:07+00:00,{},"Enemy mobiles in the walking animation were reversed for the up-right, right and down-right animations. They showed as the left-looking versions."
164126142,Allow aquatic creatures to swim around in water,Allofich,2018-01-20 12:46:31+00:00,2018-01-22 06:03:49+00:00,{},"This lets aquatic creatures move around freely while in dungeon water.

Classic has odd behavior where aquatic creatures only move horizontally. (I think they might be able to move vertically by slight amounts, not sure) I think creatures being able to move around freely like the player is the expected behavior, though.

There's one known issue. If you lead an aquatic creature to a (not overly steep) slope leading out of the water, it will follow you and get stuck above the water, unable to move. I think this happens because even when it's near the water surface it can still move horizontally, and when it does this the sloping floor pushes it up out of the water.

It's probably a pretty rare case, so if there's a cheap and simple solution for it, that would be good. Similarly we need to stop enemies somehow from walking off of ledges like they do now.

Also, Interkarma, I'd like to play with the new water effects, but how do I enable them?
"
164102388,Merge Fake sky y shearing,Interkarma,2018-01-20 01:19:37+00:00,2018-01-20 01:19:46+00:00,{},
164053889,TextureReplacement: add option for compressed textures,rossipaolo,2018-01-19 19:51:12+00:00,2018-01-20 01:20:45+00:00,{},Imported textures use DXT5 if requested by user settings.
163344298,Calculate fake sky Y position with Y-shearing,afritz1,2018-01-17 03:41:18+00:00,2018-01-20 01:09:48+00:00,{},"With this method, the fake horizon now moves vertically at the same speed as the real horizon, so they should always appear ""glued"" together. Although having a 2D background against a 3D foreground might still make some people sick, it's about as good as it's going to get without stretching somehow (see the backgrounds in the original Doom).

Another idea I had for improving the fake sky was to have its scale be a function of field of view, because as it stands, the fake horizon has the same size on-screen regardless of what the field of view is."
162217191,Modsettings: Minor tweaks,rossipaolo,2018-01-10 20:03:55+00:00,2018-01-15 22:37:38+00:00,{},"No notable new features, just some little improvements. Editor UI in particular is now more confortable to use since i implemented ReorderableList, which allows keys to be dragged and change position without destroying the list. I'm going to provide more details on forum.

Changes:
* Add missing keys when reading file from disk.
* Improved usability of modsettings asset in inspector with ReorderableList, which allow keys to be dragged isnide a section.
* Import a ini file from inspector to create a basic settings asset. This is helpful when upgrading old mods to the new UI system.
* Graphical improvements in inspector view.
* Allow Copy/paste options for multiplechoices between keys.
* Use a red color for sections called ""Internal"" in inspector (keys hidden from gui).
* Reorganized fallbacks in ModSettings. Default value is always returned if serialized value is missing or can't be parsed to the correct type."
162184045,Implement backstabbing and rewrite damage formula,Allofich,2018-01-10 17:27:11+00:00,2018-01-15 22:32:40+00:00,{},"This implements backstabbing in the same manner as classic and also has a rewrite of the damage calculation function, including adding a part of the formula I had missed regarding the hit chances for enemies. This actually depends on the reflexes setting but this PR matches the default reflexes setting."
161486882,"TextureReplacement: Simplification of Image size methods (including XmlManager), other improvements ",rossipaolo,2018-01-06 16:54:58+00:00,2018-01-15 22:32:01+00:00,{},"* I simplified XmlManager as it was getting out of hand. Now TextureReplacement has all the methods that deals with size of UI images, which i refactored in the process.
There are a few lines which only differs for a method name, sorry for that.
* MipMaps is enabled for .XXX textures and disabled for img, cif and rci. Is this ok or there is something more specific i should consider?
* Size of MiscFlats atlas is 4096 instead of 2048 when asset import is enabled.
* Minor cleanup and optimization.
* Allow imported emission map to be tinted with window color."
161471739,Implement dialogue for getting faction info,numidium,2018-01-06 08:27:22+00:00,2018-01-15 22:30:57+00:00,{},"Hello everyone. I thought I'd take a crack at implementing the faction talk on the ""Tell me about..."" list. I made sure to list the factions in the order that they appear in vanilla. It doesn't yet handle cases in which the NPC doesn't know about/doesn't want to discuss the topic but this should help lay the groundwork for the dialogue system."
160713410,Implement stealth basics,Allofich,2018-01-02 11:47:15+00:00,2018-01-15 22:29:43+00:00,{},"Implements stealth basics, as well as general tweaking of enemy detection AI.

- The basics of the stealth check in classic are recreated (check every in-game minute, tally player skill, detection formula). There's a bit more that's involved but we need to implement the sneak key first.
- Enemy FOV matched to classic. Vision and hearing range (I don't think enemies have ""hearing"" in classic) matched to range of stealth check
- Hearing is only active when the player has been detected by that enemy, since otherwise it would interfere with stealth and not allow sneaking up on enemies. The stealth check in classic basically doubles as ""hearing"" simulation. Since I've increased the hearing range I also force a ""false"" hearing check when statics are between the enemy and the player, to try to reduce enemies walking against walls because they hear the player behind it.

Right now enemy AI behavior in general is a mixture of classic and DF Unity behavior. I'm trying to first get in classic behavior (this, the ranged attacks) while preserving the improvements of DF Unity. IMO things are working pretty well with this PR. Later maybe we can have a toggle between classic behavior and enhanced AI.

This PR should also open the way to implementing backstabbing.

"
160513228,Implement Teleportation service,ajrb,2017-12-29 12:57:51+00:00,2017-12-30 23:19:24+00:00,{},"A nice simple UI addition to ease myself back in gently. Can be used by everyone for now, until guilds are implemented."
160285124,"Move next/previous control from PresetPicker to its own class, implement also in ModSettingsWindow",rossipaolo,2017-12-27 18:16:50+00:00,2017-12-30 23:18:18+00:00,{},"I moved the left/right control used in PresetPicker window to its own class, so i could also implement it in ModSettingsWindow.  [picture](https://i.imgur.com/VOZiMBB.png)"
159973459,Fixes to FPS weapon animations,Allofich,2017-12-23 16:43:37+00:00,2017-12-30 23:17:38+00:00,{},Fixes a problem with the FPS weapon looking glitched when you change weapons because the old weapon's animation data remained. Also put in an optimization to not run UpdateWeapon() from the weapon animation subroutine when there is no reason to.
159898307,"Implement mastering skills, import more skill data",Allofich,2017-12-22 16:32:29+00:00,2017-12-30 23:17:02+00:00,{},"Implements:

- Identifies and imports skill raised flags from classic saves. In classic these are set when a skill is raised for the current player level and cause the skill to be rendered in blue when looking at skill levels. This PR just imports the flags but doesn't do anything with them, nor are they saved/loaded between Unity saves yet.

- Implemented mastering a primary skill (reaching 100). You get the fanfare sound and the congratulatory message as in classic.
- Implemented %ski macro, which is used in the congratulatory message.

This PR just does things as classic does, but mastering a skill is actually a bit of a restriction, because until you do so you can raise any skill to 100%, but after you master a skill, you can no longer raise any skill over 95%.

What seems like a natural fix to me is that no skills can get past 95% except primary skills, and once you've raised a primary skill to 96%, it becomes the only one that can be raised over 95%. This might have been what was intended in classic. But people might like being able to max out various skills to 100%, so I'm not really in a rush to change it."
159272585,TextureReplacement: fix and enable various UI images,rossipaolo,2017-12-19 21:10:38+00:00,2017-12-30 23:16:26+00:00,{},
158371685,Implement basics of enemy ranged attacks,Allofich,2017-12-14 14:30:49+00:00,2017-12-30 23:15:49+00:00,{},"Here's the basics of enemy ranged attacks. The timings and ranges used in the AI decisions should be the same or close to classic.

This still needs work but the basics are in and I think it's already functional enough for testing or playing around."
157402446,PresetPicker window,rossipaolo,2017-12-09 20:10:21+00:00,2017-12-18 03:33:48+00:00,{},"* Import presets from mod and disk with check on target version
* Create and update new presets on disk"
157396515,Match enemy door-opening ability to classic,Allofich,2017-12-09 17:39:56+00:00,2017-12-18 03:33:19+00:00,{},A number of enemies that can open doors in classic couldn't in DF Unity.
157381218,Implement animal sounds,Allofich,2017-12-09 09:36:53+00:00,2017-12-18 03:32:57+00:00,{},"Implements animal sounds. Range and frequency should match or be close to matching classic.

One thing though, is that I don't know exactly what's going on with the billboard batching. It looked like I needed to (or it at least be simplest to) remove animal flats from billboard batching so I could add audioSources to them, but maybe they can still be batched? If not, we could remove the animal batch code."
156775044,Implement regional building answers,Allofich,2017-12-06 16:24:12+00:00,2017-12-18 03:25:30+00:00,{},"Turns out there's keys in the mapTable records for which types of buildings exist in each location.

In classic asking for armorer is bugged and always returns 0, but there was a gap in the flags and it seems to match for armorer, so this PR uses it.

The question text is still unimplemented."
156021364,Implement classic weapon animation timing,Allofich,2017-12-02 17:01:35+00:00,2017-12-03 22:34:19+00:00,{},"This implements classic fps weapon animation timing that should be very close to classic. The speed attribute is used to determine weapon swing speed and cooldown between bow shots.

Also the special animation sequence for sideways left strikes with hand-to-hand/werecreature is implemented. After playing through normally it plays back the initial frames in reverse.

There is also a general cleanup of the weapon manager code. To me at least, it cleaner and makes more sense now. Its no longer possible to sheathe/unsheathe or switch hands mid-swing, although its possible in classic, because it looks weird and buggy.

Interkarma can I have your feedback on a few things?
1- The attack swing may seem too slow for characters without a high speed attribute. I'm a little worried it could give a poor impression to people who are playing DF Unity for the first time. This is how classic is and it doesn't bother me, but maybe we should have an option to play with faster swings?

2- Bow animations play like classic, with the idle at the arrow-knocked frame. Again, I am fine with this but I can see that people may not like it for covering up a lot of the screen. I think maybe this would include you Interkarma, since you don't like the original interface that covers part of the screen. Shall we have an option to idle the bow at frame 0?

If we have the options for 1 and 2, do you think they should be on by default, or should classic be the default?"
156010411,"Advanced Settings: apply video, added enhancements sections, minor reorganization",rossipaolo,2017-12-02 11:35:01+00:00,2017-12-03 22:34:52+00:00,{},"* Apply resolution, screen mode and quality
* Added console and mods settings (moved one of them from main menu and renamed since it includes also media files)
* Removed background (no point in changing it for one settings now that there are a few of them)
"
154680565,Implement weapon and shield equip/unequip delay,Allofich,2017-11-26 14:08:12+00:00,2017-11-29 02:02:07+00:00,{},
154674608,Implement magic weapon FPS graphics,Allofich,2017-11-26 11:20:41+00:00,2017-11-29 02:00:38+00:00,{},
154638503,Implement classic weather selection,Allofich,2017-11-25 13:46:38+00:00,2017-12-03 22:32:30+00:00,{},"This re-introduces weather changes, which are currently disabled, using something close to the way classic does it, and imports weather from classic saves.

- In classic weathers are stored in a 6-byte array, which can be found in SaveVars, with the weather for the player's current climate the one that is used. DF Unity just tracks one weather.
- Thunder (which can be chosen in classic but has no visual or audio effects) and snow have their enums reversed in classic and Unity. This PR switches them when importing from classic.
- Classic changes weather when the date changes, or when the player crosses climate zones. Because of the game's accelerated time versus the speed of real time, I feel this looks OK, even though weathers only change on at a minimum of 24-hour increments. Also, since the changes happen at midnight game-time, the abruptness of them should be less than if it happened during the day. Still, it would be nice to have the possibility for transitions at any time of day as an improvement in the future. The abrupt changes when crossing climate zones look bad and I haven't tried to recreate them.
- In addition to the 7 weather types, if the 0x80 bit is set, I think rain and snow can have fog added to them. However, fog doesn't seem to be very noticeable in DF Unity currently, at least it doesn't create the same type of thick fog as classic. These ""+fog"" weather types aren't implemented yet. The 0x80 bit in classic has a chance of being set whenever rain or snow is chosen.
- The ""MountainWoods"" climate gets mountain weather chances in Unity, but woodland chances in classic. I don't know if we should change this, but for this ""classic-like"" implementation, the woodland chances are used.

At the moment the array of weathers isn't stored in DF Unity saves, as it's not necessary. It might not be necessary to have it in PlayerWeather, either, but for simplicity of importing from classic saves, it's there now. Maybe we can remove it.

We could replace this with a better selection method later, including with more weather transitions, but maybe we can keep this as an option for classic behavior. Also it will allow people to experience and test the weathers again, which are disabled now."
154519287,Prevent exception in SmoothFollower,Allofich,2017-11-24 10:43:24+00:00,2017-11-25 00:35:10+00:00,{},"For quite a while now, probably ever since the SmoothFollower stuff was added, I've had a problem with an exception occurring on the line

`float maxPossibleDistanceByMotorVelocity = controller.velocity.magnitude * 2.0f * Time.deltaTime;`

in PlayerMotor.cs when I try to start the game from the editor. It seems like it always happens the first time I try to run the game from the editor after getting the latest update to the master branch.

Has anyone else had the same issue? This check should keep the exception from happening.

BTW, on the topic of fixing issues with the code...

I've noticed that when loading a game, ""OnMapPixelChanged"" happens twice. Nystul, in TalkManager.cs, AssembleTopicLists() is called 3 times when you load a game, twice from the OnMapPixelChanged event, then once for OnLoadEvent. I know it's a work in progress, but I'm letting you know in case you didn't already. It should only need to be called once, right?"
154420916,Add regional building talk options,Allofich,2017-11-23 16:56:38+00:00,2017-11-23 23:23:45+00:00,{},"You can't actually ask about them, but the list is populated now."
154106926,TalkWindow - implemented questor post quest messages,Nystul-the-Magician,2017-11-22 09:53:26+00:00,2017-11-23 23:22:27+00:00,{},"implemented questor post quest messages
furthermore multi-line textrecord for quest progress rumors are working correctly now"
153458971,Implement knocking back enemies,Allofich,2017-11-18 17:22:05+00:00,2017-11-23 23:22:14+00:00,{},"Implements knocking back enemies. Should be close to classic behavior.

This may give the player a bit of advantage for now. If we implement the player's view getting thrown off when they take a heavy hit, and also correct weapon speeds (the player swings fast now), it will hopefully even out.

I think having this in somewhat alleviates the ""enemy constantly pressing forward while you backpedal"" feeling of combat.

One thing that is happening in this PR that I don't understand is that sometimes an enemy will resume moving toward the player while still in the hurt animation. I can't see why this happens. The state should always have been reset to ""Move"" before an enemy gets out of being knocked back. Any idea?"
153309501,Potion generation and enemy inventory changes,Allofich,2017-11-17 14:25:38+00:00,2017-11-23 23:21:55+00:00,{},"Creates potions randomly from the 20 varieties, like in classic, with correct names and values. Also works with potions imported from classic."
153046213,Implement map item,Allofich,2017-11-16 13:52:57+00:00,2017-11-21 10:03:32+00:00,{},"Works basically like classic. Although UESP says that map items reveal a large undiscovered dungeon, it's actually any undiscovered location, including small dungeons and covens, which I confirmed through testing.

Since I found the flag in my earlier PR that determines whether a location starts the game discovered (not counting some of the graveyard locations which are still a mystery), we now have ""discovered"" data in two places, that flag in the map tables, and a discovered locations dictionary. Maybe we could get by just using the bit in the map tables? Also there's what feels like a little bit roundabout code in this PR in order to discover the location using the region and location names, which are the parameters for the to be the DiscoverLocation function, but it works fine. If you would like to reorganize anything, please go ahead.

"
152793318,Talkwindow - started rumor mill implementation,Nystul-the-Magician,2017-11-15 14:45:55+00:00,2017-11-21 10:03:11+00:00,{},"started rumor mill implementation, still very early work in progress
""rumor mill"" quest action added
fixes and bugfixes"
151744914,SettingsWindow: support for multiple pages,rossipaolo,2017-11-09 19:44:32+00:00,2017-11-13 07:13:30+00:00,{},"As showed on forums, settings are grouped in tabs or pages. You can move to the next one with the tab key or selecting a title in top bar."
151215785,SettingsWindow: inventory settings,rossipaolo,2017-11-07 20:14:15+00:00,2017-11-08 21:50:15+00:00,{},"* Merged tooltips modes in a slider.
* Added inventoryinfopanel and enhanceditemlists."
151160725,"Water movement, sounds",Allofich,2017-11-07 16:22:33+00:00,2017-11-13 07:14:21+00:00,{},"New water stuff.

- Sounds for walking in shallow water, swimming in deeper water, underwater ambient sound
- Swim movement, borrowing the FakeLevitate class, since levitation and swimming movement are pretty much the same thing in Daggerfall. Swim speed based off of classic formula.
- Swim fatigue and skill tallying, matching classic.
- ""You cannot sleep now."" message if you try to rest while swimming."
150878820,Remove no longer needed bit shifts,Allofich,2017-11-06 15:19:40+00:00,2017-11-06 23:39:51+00:00,{},I missed this in my PR on the map data. A leftover shift was causing all dungeons to have crypt monsters.
150872503,Dungeon water sound progress,Allofich,2017-11-06 14:55:17+00:00,2017-11-06 23:40:28+00:00,{},"See comments in https://github.com/Interkarma/daggerfall-unity/pull/543.

Makes water environmental sound 2D and distance-based. I tried to roughly match classic's sound dropoff. Also adds water splash when entering, according to same criteria as classic (player.y + 50 classic units is < dungeon water. It's opposite in classic actually, since negative y is up there), with unit conversion as needed."
150775136,Update to current master,Interkarma,2017-11-06 05:50:56+00:00,2017-11-06 05:51:08+00:00,{},
150676227,Get most pre-discovered locations like classic,Allofich,2017-11-04 13:15:50+00:00,2017-11-06 05:16:44+00:00,{},"Gets most pre-discovered locations in the same manner as classic.

Some DFRegion.LocationTypes.GraveyardForgotten type locations that start the game known in classic are not gotten yet, but this is the same in the current implementation in master. I haven't been able to find how these are gotten yet.

As far as I know this is functionally identical to master, but it's a step toward correctly reading the map files and could be helpful as reference in figuring out how to import discovered location data from classic saves or how to get the remaining locations that start the game known so I think it's worth merging, but I'll leave the call to you Interkarma.

I also removed what looked like a couple out-of-date TODO comments."
150456994,Identify dungeon water level and castle block data,Allofich,2017-11-03 05:21:39+00:00,2017-11-06 05:31:18+00:00,{},"This identifies the dungeon water level value, which is contained in the ""SoundIndex"" value of a block's start marker.

I don't know if I'm propagating the value up in a way you would like, Interkarma, so feel free to change that. I just poked around at it until I found a way to get it through the various data structures up to the PlayerEnterExit class, which is where I suppose it is wanted.

Start markers also contain the value that determines whether a dungeon block is a main story castle block with NPCs, initially non-hostile guards, etc. Since we can use that I put that in and removed the check based on block name, but functionally it should be the same. If you would prefer it continue to be done by block name that is fine."
150146256,Update to current master,Interkarma,2017-11-01 21:06:19+00:00,2017-11-01 21:06:33+00:00,{},
149796036,Fix player's left-hand weapon being ignored in damage calculation,Allofich,2017-10-31 14:09:42+00:00,2017-11-01 21:04:48+00:00,{},"The player's left-hand weapon was being ignored for damage calculation. Fixed now. Also did a little clean up in removing ""DaggerfallConnect"" in FormulaHelper where it wasn't needed, which shortens some of the longer lines."
149626645,ColorPicker,rossipaolo,2017-10-30 20:17:57+00:00,2017-11-01 21:04:32+00:00,{},
149358572,Update to current master,Interkarma,2017-10-28 22:38:26+00:00,2017-10-28 22:38:32+00:00,{},
149357876,Update to current master,Interkarma,2017-10-28 22:17:00+00:00,2017-10-28 22:17:06+00:00,{},
149350089,"Modsettings: graphic improvements, fixes",rossipaolo,2017-10-28 19:02:15+00:00,2017-10-28 22:09:46+00:00,{},"* Moved common code for slider TextLabel indicator inside HorizontalSlider class. By default it acts as a scrollbar but it can be set to be used as numeric slider or multiplechoices slider.
* Improved graphics in ModSettingsWindow.
* Minor fixes for mod settings."
149343071,Fix spellbook having magic swirl,Allofich,2017-10-28 16:24:04+00:00,2017-10-28 22:10:12+00:00,{},Fixes http://forums.dfworkshop.net/viewtopic.php?f=24&t=753.
149339050,Implement %t macro,Allofich,2017-10-28 14:50:57+00:00,2017-10-28 22:10:23+00:00,{},Used in holiday text and perhaps elsewhere.
149303761,"Talkwindow - progress, support for texture replacement talkwindow, interior and exterior automap ",Nystul-the-Magician,2017-10-27 23:14:35+00:00,2017-10-28 22:14:18+00:00,{},"progress:
%oath macro resolved
BaseScreenComponent now supports restricted render area

support for texture replacement (some stuff will not work right now):
what should work: background and topic/mode selection
what will not work right now: portrait and navigation stuff

support for interior automap texture replacement added
support for exterior automap texture replacement added"
149239321,Add dungeon texture options,Allofich,2017-10-27 17:00:53+00:00,2017-10-28 22:11:55+00:00,{},"Adds settings.ini options for dungeon textures.

0 = classic textures
1 = climate-based textures, using classic algorithm for picking among them. Main story dungeons have classic textures.
2 = climate-based textures for all dungeons
3 = Random selection from all textures (DF Unity implementation from before). Main story dungeons have classic textures. Sewer texture fix added so out-of-range textures shouldn't be used.
4 = Random selection from all textures (DF Unity implementation from before) for all dungeons. Sewer texture fix."
149206125,Optionally show material for helms/shields,Allofich,2017-10-27 14:36:53+00:00,2017-10-28 22:13:26+00:00,{},"Addresses request in http://forums.dfworkshop.net/viewtopic.php?f=4&p=9231&sid=a0d0a83058d2068e130a0061395aacb0#p9231.

Possible values are:
0 - Don't show material (like classic). Default.
1 - Show for non-leather and chain materials 
2 - Same as 1 but show chain
3 - Show all"
148941998,Skip incorrect door messages in Wayrest dungeon,Allofich,2017-10-26 13:55:53+00:00,2017-10-26 23:10:02+00:00,{},Skips over some incorrect door messages in Wayrest dungeon.
148772662,Modsettings,rossipaolo,2017-10-25 20:28:34+00:00,2017-10-26 03:36:23+00:00,{},"* Implemented MultipleChoices as sliders (take up a single line, not affected by number of items)
 Something like [this](http://support.amd.com/PublishingImages/Support/KB/Witcher4.png). Basically hides the index with the corresponding string set in scriptableobject config, no more need to write all possibilities in tooltip :)
* Organization in settingswindow and reader classes
* Added method Deserialize() in ModSettings which parse known settings values (int, float, tuple, color etc., the same that can be chosen in SO inspector to show in window) of a section in a class at once."
148705152,Talkwindow - progress and new actions implemented,Nystul-the-Magician,2017-10-25 15:40:35+00:00,2017-10-26 03:38:50+00:00,{},"new stuff:

- defaults.ini  entry EnableModernConversationStyleInTalkWindow can be set to true for improved conversation/dialog style
- added actions ""dialog link"" and ""add dialog"": first implementation pass (there will be cases where it does not work as vanilla, but we need a start)
- introduced TalkManagerMCP partial class for correct macro resolving for different quest topics
- save serialization of quest talk topics
- improvements with textlabel positioning
- answers do use message ""envelope"" like in vanilla
- answers use npc social group now to select answer ""envelope"""
148166047,"Fix Mantellan Crux textures, cleanup",Allofich,2017-10-23 15:36:57+00:00,2017-10-24 03:57:16+00:00,{},"Fixes Mantellan Crux textures. ""Ocean"" tiles, such as where the Mantellan Crux is located, are given a swamp climate value.

I thought sewer textures were off because they differed from the static tables that existed before, but actually I think they are correct now. This is from testing in Wayrest Castle, it should use archive 368, not 168 as it was doing in the table. Notice that all the dumped values were 168, except for Privateer's Hold, which is not a sewer texture and was probably just a mistake. 168 is the default value, but I think it then undergoes a climate swap for the final, actual used texture.

![wayrest](https://user-images.githubusercontent.com/19624336/31898115-416abe78-b853-11e7-97a7-7e774350fbba.jpg)

Also did cleanup. I removed duplicate enums in the travel calculator since they already existed in MapsFile.cs. I renamed TextureTables to DungeonTextureTables, since it's used for dungeons.

Also I don't pass in the climate value to the random texture function anymore, just the seed, like it was before I made any changes."
148023429,Merging dungeon textures,Interkarma,2017-10-23 01:05:02+00:00,2017-10-23 01:05:07+00:00,{},
148005439,Emulate classic selection of dungeon textures,Allofich,2017-10-22 18:01:22+00:00,2017-10-23 00:57:30+00:00,{},"I've got, hopefully, the correct selection of textures emulated on classic. Thanks for putting in the recreation of the Watcom random functions. That and also notes from the blog on DaggerXL helped me get this one together.

I'm not completely sure about the sewer textures, but I expect they are correct. At any rate
http://forums.dfworkshop.net/viewtopic.php?f=24&t=739, which was a problem with sewer textures being selected out of range, should be fixed,

Some reorganization should probably be done at some point. The same array that is used for getting indices in the travel calculator turned out to be used for the dungeon textures as well, but it's kind of weird to be using a value from the travel calculator class for dungeon textures. Also the name ""StaticTextureTables.cs"" is now a misnomer since I went ahead and removed the pre-defined texture tables."
147959629,Apply climate swap to dungeon door textures,Allofich,2017-10-21 19:46:07+00:00,2017-10-22 04:32:18+00:00,{},Should give correct dungeon door textures.
147950657,Get door lock value like classic,Allofich,2017-10-21 16:16:33+00:00,2017-10-22 04:37:29+00:00,{},"Gets the lock value for doors in the same manner as classic.

For regular locks the value will be the same, but apparently magical doors can have a few different values, which wouldn't be correct before this PR. Maybe those values matter when using lock-opening spells."
147900483,Modsettings config,rossipaolo,2017-10-20 21:36:20+00:00,2017-10-20 22:56:26+00:00,{},"* Create presets from inspector. Properties are cloned from main config file for creation and changes sync.
* MultipleChoice and Color support for inspector config."
146866678, Mod settings configuration with ScriptableObject,rossipaolo,2017-10-16 19:22:03+00:00,2017-10-16 23:45:47+00:00,{},
146618266,Implement castle guards going hostile,Allofich,2017-10-14 19:45:23+00:00,2017-10-16 23:45:35+00:00,{},"This implements castle guards going hostile. The main thing I was aiming for was finishing up the ""DoorText"" action I worked on earlier. Guards will go hostile now when you open the doors to restricted areas in the castles, like in classic. Also, guards will go hostile when you attack any one of them that was passive. All guards in the area will be set to hostile. I think in classic it might just be those that are within loaded range or something, but this behavior seems fine to me, rather than potentially having some guards standing around and ignoring the fight.

As for the DoorText trespassing action, the classic behavior is emulated, but it is somewhat broken IMO.
- The descriptive messages that warns you about areas being off limits are only seen if you click the doors in info mode, so they are easy to miss.
- If you click the door in info mode, it leads to an exploit, because the door opens but the trespassing check doesn't trigger.

You know I in general want to copy classic, but I think broken game mechanics like this should be fixed. What do you think about doing these:
- Always show the descriptive messages. This makes sense since they include things like guards issuing you warnings not to enter.
- On first click, the message is shown. After that, regardless of interaction mode, the door will be opened, and trespassing check performed.

I've gathered over the time watching your work, Interkarma, that you like avoiding extra clicks wherever possible, so maybe you won't like that second suggestion, since it would mean two clicks to open these doors. These doors aren't very common, but if you have another suggestion, maybe we could do that."
146592970,Temporarily ignore player ship for travel costs,Allofich,2017-10-14 08:16:55+00:00,2017-10-15 07:12:00+00:00,{},Forces ocean travel costs as if player didn't own a ship so that ocean travel costs can be tested for a while.
146481874,Fix getting High Rock sea coast region index,Allofich,2017-10-13 15:07:45+00:00,2017-10-13 23:47:10+00:00,{},"Fixes an out-of-bounds array error with legal reputation and the blank place names when using the status popup outside of a political region (in ""High Rock sea coast"")."
146469989,Implement classic travel time calculations,Allofich,2017-10-13 14:21:29+00:00,2017-10-14 07:22:55+00:00,{},"Fixes http://forums.dfworkshop.net/viewtopic.php?f=24&t=770.

Travel and cost calculations are reversed from classic. Travel that includes travel over ocean is slightly off due to TerrainHelper.DilateCoastalClimate changing the values read from CLIMATE.PAK. It's not a huge deal but we're so close to having the correct values from classic it would be nice to fix. What do you think, maybe keep a second, unaltered copy of the CLIMATE.PAK buffer for using in travel calculations? Or adjust the DilateCoastalClimate function so it doesn't alter the buffer?

Also, ocean-traveling costs are free currently because all players have ships. My suggestion is we disable ships until buying them is implemented, so that we can test for now with normal travel costs.

The call to the time calculation function from Clock.cs is using the same parameters as before. I don't know how quests are affected."
145988450,Cancel player movement when entering interior,Allofich,2017-10-11 15:43:51+00:00,2017-10-12 09:22:45+00:00,{},"Fixes a bug I found where if you enter a dungeon while jumping, you take falling damage when the dungeon loads."
145924369,Reorganize texture fix,Allofich,2017-10-11 11:34:52+00:00,2017-10-11 17:20:56+00:00,{},"Reorganized the texture fix from the other day to make it fit in better with the existing code. I put it where previously doors were being set to not support winter. I also removed setting winter support to false since it is false by default and doesn't need to be set to false, as is done for the interior textures."
145708826,Texture fix,Allofich,2017-10-10 14:28:45+00:00,2017-10-10 23:54:45+00:00,{},"2 Fixes.

1. Fixes http://forums.dfworkshop.net/viewtopic.php?f=24&t=376.

I found that classic omits and of the 3rd exterior door records from being climate-swapped. This fixes the dungeon door mentioned in the bug report and also the doors at Daggerfall Castle (out on the towers in the courtyard). In the bug report you mentioned that you had patched out some doors this way but I couldn't find the code for it, and without this PR there are tavern doors on the courtyard towers of Daggerfall Castle. Was that code removed or never applied to master? If it does exist in master maybe we should remove it.

2. Added the swamp temple interior textures. These were disabled as ""missing"" but they aren't missing. They exist under ""Swamp Temple Int."" and are used in classic. They do look pretty unusual (pinkish-purplish) so I can see if maybe you thought they were incorrect, but I don't think they are."
145436168,Fix for clicking on other regions from Cybiades,Allofich,2017-10-09 12:07:33+00:00,2017-10-09 23:14:45+00:00,{},"This is a very manually, trial-and-error type of fix (found that upper right corner of Cybiades in its zoomed-in view and the less zoomed-in view from Sentinel seemed to match, and went from there), but the results seem to work. Fixes http://forums.dfworkshop.net/viewtopic.php?f=24&t=764."
145409048,Add wandering NPCs to temple settlements,Allofich,2017-10-09 09:40:49+00:00,2017-10-09 23:14:27+00:00,{},Matches classic.
145292962,Fix prohibited armor material check,Allofich,2017-10-07 14:11:36+00:00,2017-10-07 22:32:10+00:00,{},"Fixes prohibited armor material checking. My earlier fix attempt by changing the shift direction was incorrect. First, I wasn't thinking straight -- if you have two bytes and want to shave off the right one and just use the left one, you can shift to the right, but if you do the same thing in the other direction to try to use only the right byte, you would need to again shift back after shaving off the left byte or the number would be too large.

Second, I didn't pay attention to the fact that the DF Unity material enum is a 4-byte int, so my shift didn't even shave off the left bit, it just made the number bigger.

For the fix this time I just cancel out everything but the rightmost byte. Tested on a character with prohibited leather, iron and steel equipping daedric armor (which Hazelnut said was wrongly prohibited from equipping), and it works now."
145291828,Fix classic save items being wrongly put in wagon,Allofich,2017-10-07 13:37:13+00:00,2017-10-07 22:31:52+00:00,{},Fixes http://forums.dfworkshop.net/viewtopic.php?f=24&t=371.
145290150,Development of guild training,ajrb,2017-10-07 12:43:52+00:00,2017-10-07 22:23:44+00:00,{},"Also fixes for
- Library booksellers
- Sale of religious items
- Black background on exit dungeon message"
145285367,Import and save region data structures from classic,Allofich,2017-10-07 10:01:17+00:00,2017-10-07 22:22:35+00:00,{},"Imports and saves region data structures from classic. A lot of the data is still unknown, but I've been able to determine the data size of them. I think a lot of them are flags for various region events, things like a ruler dying or some group becoming a public enemy, the stuff you see in rumors or on the signboards at city entrances.

Right now, the game play benefit is that regional price variations are saved and loaded, and so will no longer be re-randomized every time you open a DF Unity save.

The region data includes the legal reputation per region. I went ahead and hooked this up to the status pop-up (and fixed a problem that caused all legal reputations under 0 to be shown as ""undependable""), but I see that some groundwork has already been laid in place for storing legal reputation as a part of the persistent faction data, rather than in the regional data. Interkarma, I know you're busy with the quest stuff, but can you take a look and decide how to proceed here? We could just use the legal reputation in the region data records like classic does, and it will keep things simple. But maybe you have plans for managing the legal reputation from within the persistant faction data? In that case, should all the regional data stuff (just price adjustments, currently) be in there, too? "
145145925,Fixes for training,Allofich,2017-10-06 12:55:26+00:00,2017-10-07 02:14:23+00:00,{},"Fixes and adjustments to training to make it more like classic.

1. Fixed black screen background on message popups.
2. Added ""You don't have enough gold"" popup and prevent training if player doesn't have enough gold.
3. Fatigue loss is now defaultFatigueLoss per minute * 180 minutes, which I think is what it is in classic.
4. Number of skill tallies gained matches classic.
5. Time of last training is imported from classic saves.

Hazelnut, I think I can add in all of the trainers and their lists of offered skills pretty easily, too, unless you want to do it."
144942948,Implement tallying of running skill,Allofich,2017-10-05 15:06:51+00:00,2017-10-06 08:25:19+00:00,{},"Implements running skill tallying.

In classic, the function to tally the running skill is called by what seems to be a constant update loop, and because of this the rate at which it is tallied varies by how fast the game is running. I did a few tests and found that in both a town and dungeon environment, in my DosBox setup (running at 30000 cycles) the tally rate is about 16 per second that the run key is held down as long as you aren't riding a horse, even if you aren't moving. I set it so that PlayerMotor.isRunning has to be true for the tally to occur."
144751943,Initial implementation of training plus couple of fixes.,ajrb,2017-10-04 19:13:02+00:00,2017-10-05 05:52:05+00:00,{},"- Training offered by mages and fighters trainers.
- Fixes for when players have no wagon.
- Fix for showing str increase effect on encumbrance when leveling."
144444815,Add WindZone,rossipaolo,2017-10-03 14:55:14+00:00,2017-10-04 08:09:43+00:00,{},
144076067,MeshReplacement: trees position,rossipaolo,2017-10-01 15:49:35+00:00,2017-10-01 23:11:44+00:00,{},
144063932,Fix Daedra Seducer attack,Allofich,2017-10-01 09:58:59+00:00,2017-10-01 23:12:00+00:00,{},"I accidentally set the daedra seducer's to hit on frame 3 instead of 2, which is outside of the frame range."
144032194,Match identify cost formula to classic,Allofich,2017-09-30 15:20:04+00:00,2017-10-01 02:51:36+00:00,{},Also includes holiday enums.
144030723,Fix to close menu window when choosing talk option,ajrb,2017-09-30 14:37:00+00:00,2017-10-01 02:51:12+00:00,{},
144026223,Fix wrong shift direction for material check,Allofich,2017-09-30 12:04:47+00:00,2017-09-30 13:32:21+00:00,{},See discussion in https://github.com/Interkarma/daggerfall-unity/pull/498
144024590,Ensure feet are unequipped,ajrb,2017-09-30 11:02:02+00:00,2017-09-30 13:32:38+00:00,{},
144020980,Fix inventory window not being refreshed after trying to equip prohibited items,Allofich,2017-09-30 09:02:36+00:00,2017-09-30 11:23:10+00:00,{},For http://forums.dfworkshop.net/viewtopic.php?f=24&t=735&p=8659#p8659
143933574,Implement animated magic swirls and purchasable item coins ,ajrb,2017-09-29 16:54:45+00:00,2017-09-29 21:33:23+00:00,{},"Ensured that quest items are still highlighted correctly if magic.
Assumed quest items can never be purchased."
143734065,Purchase UI refinements & some bugfixes,ajrb,2017-09-28 19:23:42+00:00,2017-09-28 22:30:52+00:00,{},"- Fix race bug with createRandomClothing
- Fix weight handling when purchasing
- Correct equip behaviour when purchasing
- Fix for material weight calculation. (Was causing Dwarven and Ebony weapons and armour to weigh nothing)"
143536787,Merge guild-services,Interkarma,2017-09-28 01:34:15+00:00,2017-09-28 01:34:20+00:00,{},
143499974,Guild services - initial implementation (identification),ajrb,2017-09-27 21:03:54+00:00,2017-09-28 01:08:23+00:00,{},"- Can now identify things at mages guild. (Allofich, can you check the new formula please?)
- Can now purchase random items from magic items seller in mages guild. (Allofich, please check I used formulas correctly)
- Items to be purchased have a yellow highlight.
- All mage guild & fighters guild npcs have popups now.
- Two temple npcs have popups.
- Quest popup will be assimilated at some point. (once Gav is happy)"
143257552,Handle empty soul traps imported from classic saves,ajrb,2017-09-26 22:24:21+00:00,2017-09-27 09:47:41+00:00,{},
143220653,Trees: fixes and tweaks,rossipaolo,2017-09-26 19:20:25+00:00,2017-09-27 09:55:50+00:00,{},"It's still a bit off, don't know if due to terrain resolution or something i can fix.

![treeposition 1](https://user-images.githubusercontent.com/24359151/30879521-ebe6e624-a2ff-11e7-9cbd-73d9c676ce50.png)
![treeposition 2](https://user-images.githubusercontent.com/24359151/30879523-ec9b3b06-a2ff-11e7-834f-0929a890602c.png)
"
142996592,Add %ct macro and fixes for wagon dungeon access and scrolling reset,ajrb,2017-09-25 22:11:59+00:00,2017-09-26 05:42:56+00:00,{},
142983597,MeshReplacement: Early implementation of StreamingWorld trees,rossipaolo,2017-09-25 21:02:22+00:00,2017-09-26 05:43:16+00:00,{},"Instantiate trees from mods on streaming world. It needs some good optimization and i've yet to get the correct positions, but we're almost there.

![trees](https://user-images.githubusercontent.com/24359151/30830639-efc52276-a244-11e7-8128-f4f9a568e3c0.png)
"
142833616,fixes to MultiFormatTextLabel and TextLabel regarding TextScaling and Formatting,Nystul-the-Magician,2017-09-25 09:25:47+00:00,2017-09-25 20:45:19+00:00,{},"fixes to MultiFormatTextLabel (no unintended extra-line spacing is added anymore)
improvements for text scaling issues with small (one-lined) text


"
142777043,"Revert ""fixes to TextLabel and MultiFormatTextLabel - infopanel values updated""",Interkarma,2017-09-25 00:00:24+00:00,2017-09-25 00:00:41+00:00,{},"Reverts Interkarma/daggerfall-unity#487
This breaks line spacing in popups, sorry.
![line-spacing](https://user-images.githubusercontent.com/10426244/30788002-5651e42e-a1d8-11e7-952c-de713fbe8154.jpg)
"
142765727,fixes to TextLabel and MultiFormatTextLabel - infopanel values updated,Nystul-the-Magician,2017-09-24 18:49:49+00:00,2017-09-24 23:56:52+00:00,{},"sry hazelnut for screwing up things - hope this works now good enough
LineHeight in MultiFormatTextLabel fixed"
142726358,"fixed Textlabel size when TextScale is used, horizontal text alignment",Nystul-the-Magician,2017-09-23 19:27:39+00:00,2017-09-24 00:44:31+00:00,{},"fixed Textlabel size when TextScale is used (set background color and see correct textlabel size now)
there is a new Property HorizontalTextAlignment now which can be used to align text inside the textlabel"
142723837,SettingsWindow: visual improvements,rossipaolo,2017-09-23 18:14:56+00:00,2017-09-24 00:44:49+00:00,{},"Reduced font size to get space for more settings. @ajrb 

@Nystul-the-Magician 
Had to add a property to ListBox because label is not publicly accesible."
142719662,Fixes for inventory window,ajrb,2017-09-23 16:20:11+00:00,2017-09-24 00:45:13+00:00,{},"- Items can now be colour highlighted in enhanced mode
- Fixed broken acrtions when info panel disabled

Thanks for pointing out that last one. I forgot to test that."
142708079,Animation fixes and adjustments for enemies,Allofich,2017-09-23 09:49:58+00:00,2017-09-24 00:45:41+00:00,{},"Fixes and adjustments for enemy animations. I'll go through everything below.

1. (not animation related) Fixed an incorrect null assignment (from my earlier PR) that made a warning in Unity.
2. Fixed rat being flipped horizontally. For some reason there was specifically code to flip the rat. Instead, the same code was used to flip the giant bat and the imp, who both needed it. There is also existing code to flip the scorpion, but I haven't tested it yet to see if that is functioning properly.
3. Fixed enemies not playing the first frame of their attack animation. currentFrame was incremented immediately in AnimateEnemy() of DaggerfallMobileUnit, so the first frame didn't show.
4. Adjusted animation speeds. Slightly sped up enemy attacks, lowered enemy movement animation and added faster animation for flying enemies. The animations should be somewhat closer to classic, and I think they look better.
5. Added code for enemies to hit on a particular frame of their attack, rather than after finishing. I don't know how classic handles this, and I don't see myself figuring it out anytime soon. Instead I went through all the enemy animations (your Daggerfall Imaging 2 software is so helpful for this stuff) and set each enemy to hit on the frame that it looks like their attack should connect on.
6. Enemies can continue to move some (1/4 speed) while attacking. I'm not 100% sure about this because the animations for enemies do look like they should be standing still and not ""sliding"" along the floor, but the player can move while attacking and IMO it's too easy to defeat enemies in DF Unity currently because you can outmaneuver them. Since people are making quests now I think getting game difficulty problems under control is starting to take on some more importance. Enemies can also move while attacking in classic.

I experimented with them moving at 1/2 speed, but I felt like it would maybe be too difficult for new characters in privateer's hold, and I didn't like having the enemies constantly up in my face, so for now I settled on 1/4 speed as making it more difficult but still possible to dodge hits. I would like to alleviate the ""walking backwards while swinging your weapon"" playstyle somehow. Maybe we can improve the AI at some point to not rush the player so much.

6. Enemies have some randomness to the time between weapon swings, to make enemies a bit less predictable and robotic."
142693896,Merge item scroller component,Interkarma,2017-09-23 01:06:32+00:00,2017-09-23 01:06:37+00:00,{},
142611417,Inventory and Trade windows complete using new ItemListScroller component,ajrb,2017-09-22 15:48:49+00:00,2017-09-22 22:32:32+00:00,{},"I've been working on a major refactoring of the inventory window, extracting the item scrollers into a component. This is to:

-Reduce the ridiculous size of the inventory window class
-Allow same code to be reused twice in inv and once in item enchanter when we do that
-Enable me to create a version that displays 16 items and have it switchable by config

I wasnt going to submit PR until you released build due to the size of change - with another build so soon I think I will. Sooner it's tested by players the better I think. "
142561382,Identify gender flag from flats.cfg,Allofich,2017-09-22 11:53:43+00:00,2017-09-22 22:26:14+00:00,{},"Identified the gender flag in flats.cfg, which was marked as unknown. It's either 1 for male or 2 for female, but if it's preceded by a ?, this marks the flat to be censored (not displayed) in ChildGard mode.

I think this gender flag may be used for determining the gender of flats for quests and filling out some gender-based macros, like getting an appropriate name. I don't know if it might help you in any way for the quest system, Interkarma. "
142547431,Fix info panel scroll reaction,ajrb,2017-09-22 10:31:23+00:00,2017-09-22 10:52:28+00:00,{},Also fixed broken message & don't display for arrows
142420626,Make iventory info panel enabled by default,ajrb,2017-09-21 19:02:45+00:00,2017-09-21 23:14:23+00:00,{},Also ensured the info is cleared each time inventory accessed. Seems the on start event is not getting called.
142348106,Talkwindow - fixes: female faces derived from factions and faces defined in FLATS.CFG.txt,Nystul-the-Magician,2017-09-21 13:45:08+00:00,2017-09-21 23:08:46+00:00,{},"fix for common female faces derived from factions
fix for blue-cloaked woman at court wayrest using FLATS:CFG.txt in resources folder (gets loaded instead of FLATS.CFG in Arena2 folder)
one can add missing billboard to face mappings in there for npcs"
142223436,Implement inventory icon and move info panel,ajrb,2017-09-20 23:10:39+00:00,2017-09-21 04:46:04+00:00,{},"- Info panel now appears on trade windows as well.
- Inventory tooltops no longer suppressed if info panel enabled.
- Backpack icon & weight displayed for carried items, i.e. player inventory."
142140043,MeshReplacement: tweaks,rossipaolo,2017-09-20 16:03:52+00:00,2017-09-21 04:45:28+00:00,{},"* Avoid NullReferenceException on block/city viewer in editor
(ModManager is not present); import models from resources while in
editor instead.
* Print an error instead of throwing an exception when a
material is not assigned; do not print an error if maintexture is not
present (transparency etc.)
* Assign filtermode using sharedmaterials."
142086635,progress and fixes for talk functionality,Nystul-the-Magician,2017-09-20 12:31:14+00:00,2017-09-21 04:46:58+00:00,{},"in PlayerActivate.cs: put the hit test for quest npcs first and added return - so no need to check for attached script
changed SpecialNPCClickBehaviour.cs as suggested
added FlatsFile.cs class (flats file reader for file FLATS.CFG) and uses this information to derive correct common static npc resolving

"
141954585,Fix map windows bug with tooltips off and save souls,ajrb,2017-09-19 20:55:32+00:00,2017-09-20 05:22:24+00:00,{},"Both exterior and interior map windows locked up and broke when tooltips are turned off, so I fixed it. Just clumped all of the tooltip delay set statements in a conditional null check.

Also added the trapped soul variable set from importing classic to be saved in DFU."
141932959,Reimplement potion recipes and potion info,ajrb,2017-09-19 19:18:48+00:00,2017-09-20 05:21:48+00:00,{},"Also refined the info panel to wrap long lines, had to change MultiFormatTextLabel and the calculation is a bit of hack. Hope the changes don't break anything else. Would be great if someone else could look at TextLabel.LineHeight and check/fix it.

Removed old potion window class.

Added two new helper statics to TextFile for creating text and formatting tokens."
141841033,Talkwindow - implementation of talking to static npcs started,Nystul-the-Magician,2017-09-19 12:54:56+00:00,2017-09-20 05:12:36+00:00,{},"currently only a few portraits are in (e.g. quest giver of fighters guild of daggerfall)
portraits are matched to billboards texture archive and record index
for currently unknown combinations (almost all static npcs) the portrait image with the text ""oops! ..."" is chosen to make it easily recognizable that the mapping needs to be done for this npc's billboard"
141832357,Re-enable and fix price adjustments,Allofich,2017-09-19 12:14:04+00:00,2017-09-20 05:08:11+00:00,{},"Fixes the game freezing. Also moves player-specific code out of DaggerfallEntityBehaviour and into PlayerEntity.

The `lastGameMinutes` variable is also in PlayerEntity now and is set to the current game minute whether starting a new game, loading a Unity save or loading a classic save. Feel free to get rid of this variable and replace it with a more elegant solution if you like, it's just a simple way to handle events that are based on in-game minutes passing."
141729513,Item hover info panel in inventory,ajrb,2017-09-18 23:49:09+00:00,2017-09-19 00:47:54+00:00,{},"Enabled by a setting, disabled by default.
Thanks to Nystul for the text scaling."
141686357,TextLabel now supports text scaling (property TextScale),Nystul-the-Magician,2017-09-18 19:39:16+00:00,2017-09-18 22:46:59+00:00,{},"this can be used to set text scaling, e.g. 0.5 is half text size
text and word wrapping will adapt accordingly"
141668594,Implement correct greetings based on reaction,Allofich,2017-09-18 18:12:34+00:00,2017-09-18 22:45:31+00:00,{},"This should hopefully give correct greetings based on reputation. A few other things, (masque of clavicus, something to do with guilds) in classic can affect NPC reaction to player, which isn't in yet.

The reputation modifiers with the general social groups (commoners, merchants, etc.) are imported from classic saves. They aren't saved in DF Unity yet because I want to be sure that the manner I'm storing them in the player entity is OK, which is as an array, to make it simple to access using the sgroup values from faction.txt."
141591931,Implement daily price adjustments,Allofich,2017-09-18 12:40:00+00:00,2017-09-18 22:43:23+00:00,{},"Implemented mostly. There's still a little bit to figure out, perhaps related to adjusting regional power.

I've tried to keep there from being a noticeable pause when the function has to process for a lot of days. I think it's OK but Interkarma, can you test doing a long fast travel and see if there is a noticeable pause for your computer? If there is maybe the function can be streamlined further."
141500133,Talkwindow - location hints and revealing,Nystul-the-Magician,2017-09-17 20:00:02+00:00,2017-09-17 22:30:56+00:00,{},"new things:
text record viewer in unity editor (to have an easy way to show text records)
dialog macro expansion started
location hints implemented (direction and map reveal) - currently chances are hardcoded and not like in vanilla since this has to be found out, furthermore npcs always use the same hardcoded ""mood"" set for answers"
141499447,Read trapped souls from classic saves and display info,ajrb,2017-09-17 19:42:17+00:00,2017-09-17 22:30:11+00:00,{},"Not sure if the TrappedSoulRecord is right since the data with the soul monster id is at 0x1B which is part of the root record - SpriteIndex in fact.

All the records seem to have above the root record is a single byte, value = 150

Anyway after mapping to the corresponding MobileEnemy, the soul names are now displaying correctly. Guess there will be more to do once magic is implemented."
141491696,MeshReplacement: support for climate/season variants,rossipaolo,2017-09-17 16:00:03+00:00,2017-09-17 22:29:25+00:00,{},"1) try to import ID_ClimateSeason or ID_Desert.
2) try to import generic ID (interiors etc.)"
141486510,Correct the LoC commission to be 1% not 10,ajrb,2017-09-17 13:35:25+00:00,2017-09-17 19:42:46+00:00,{},It was set to 10% but should be 1%. Had to use Math.Round to stop it being 1gp off. 
141476787,Implement classic cost formula for selling,Allofich,2017-09-17 07:53:11+00:00,2017-09-17 22:26:41+00:00,{},"Implements classic cost formula for selling.

Prices in classic are influenced by a value, set for each region in the game, that changes every in-game day. This value is imported from classic saves now. It's in a big chunk of data I called RegionData, but I'm just assuming it's all region-related. Most of it is 0 in my saved game I was using for research, but a few other values are set. For now I'm storing the regional price adjustments in the player entity for convenience, but we might want to have some sort of storage for regional data in the future, so I didn't include it in DF Unity saves. When starting a new game or loading a DF Unity save the values will be randomized to the same range they are randomized to in a new game in classic.

I haven't implemented the daily change in the values (either up 2% or down 2%, depending on something to do with the merchants faction).

I also put in the buying formula, which isn't used being used yet and probably needs more work."
141460224,Banking window on bankers and letters of credit implemented,ajrb,2017-09-16 20:06:49+00:00,2017-09-17 06:33:34+00:00,{},
141445347,Handle building name macro & fix quest item stack combination,ajrb,2017-09-16 12:44:26+00:00,2017-09-17 02:47:21+00:00,{},Couple of fixes for items.
141413392,Talkwindow - improvements and fixes,Nystul-the-Magician,2017-09-15 22:27:22+00:00,2017-09-16 00:40:50+00:00,{},"namebank for mobile npc's names are now derived from climateSettings
""where is"" topic list added (news and placeholders for organizations)
bug in textlabel class fixed
some question and answer pairs implemented
first version of greeting messages implemented
re-selection of same topic category will no longer create a new question
"
141388053,Disallow wagon access in dungeons,ajrb,2017-09-15 19:48:33+00:00,2017-09-16 00:39:38+00:00,{},Implemented choice of accessing wagon when exiting dungeon.
141382426,TextureReplacement: support for cfa files,rossipaolo,2017-09-15 19:15:50+00:00,2017-09-16 00:38:18+00:00,{},"I changed an array of Texture2D to an array of ImageData in TransportManager in order to maintain the correct size on screen with different resolutions. This is often an issue with daggerfall hud images where texture size is used as rect. Width and Height of Imagedata always refers to Daggerfall file, while Texture2D properties are the actual resolution of texture."
141365664,Basic repair - instant,ajrb,2017-09-15 17:47:41+00:00,2017-09-16 00:36:23+00:00,{},"Cost calculation is rubbish
Fixed broken skills popup"
141285552,Boots & shoes count as leather armour,ajrb,2017-09-15 11:06:14+00:00,2017-09-16 00:11:22+00:00,{},Tiny little tweak I made last night - just had to give it a test before submitting
141233749,Merge Trading branch,Interkarma,2017-09-15 05:56:18+00:00,2017-09-15 05:56:24+00:00,{},
141199966,Add armour values to paperdoll,ajrb,2017-09-14 23:35:41+00:00,2017-09-15 05:57:05+00:00,{},"Well that was surprisingly easy... which is a first for any of the DFU tasks I've set myself.

Note I moved a couple of the values a little to improve on classic. Spent much more time on the positioning than the code!! lol"
141188145,Initial version of trade window,ajrb,2017-09-14 22:06:05+00:00,2017-09-14 23:19:59+00:00,{},"Finished initial version of trade window

- Cost & price calculations are rubbish
- Selling items only for now
- Building name macro needs doing


"
140942523,next stage of implementation of Talkwindow,Nystul-the-Magician,2017-09-13 22:15:09+00:00,2017-09-14 02:04:52+00:00,{},"@Interkarma: these things might be of particular interest for you:

added GameObject ""TalkManager"" with attached script to scene

extended TextLabel and Listbox (all existing functionality should still work as intended):
Listbox now has horizontal scroll modes entry-wise or pixel-wise now. Vertical scroll mode can be set to entry-wise (old mode) or pixel-wise as well. Pixel-wise scroll modes go hand in hand with a newly introduced restricted render area for listbox's content so that everything outside this Rect won't be drawn.

TextLabel also has the restricted render area so that listbox can propagate its restriction area to its child textboxes. TextLabel can now use a property WrapWords in conjunction with existing property WrapText to wrap text while respecting word wrapping (so words don't get teared apart if possible)

I had to change VerticalScrollBar class to allow for setting the scroll index without raising a scroll event - otherwise I had an infinite loop when I implemented scrollbar scrolling for listbox content and mouse up/down scrolling inside the listbox for listbox content (not on the scrollbar which works as well of course).
I did it so that existing code still works, hope this fulfills everyone's needs


"
140933262,Fix merge conflict with shield armour values,ajrb,2017-09-13 21:21:29+00:00,2017-09-14 21:48:22+00:00,{},"Caused by me changing Allofich's code while he was still working on it I think.

Needs Allofich to confirm I fixed this correctly, but basically removed the bit I added and was duplicated by his work."
140887390,Fix looking at lockpicks with 95 or better chance,Allofich,2017-09-13 17:39:15+00:00,2017-09-14 02:26:54+00:00,{},"Hazelnut noticed that looking at a lockpick with a 95% chance of success caused an out of bounds exception on  the array of descriptions. This fixes it.

I think this is pretty much of an edge case because you have to be very good at lockpicking and facing a level 1 lock (weakest possible), and classic doesn't handle this situation right. It shows the next entry in the array which is ""This is a magically held lock."" I made it continue to show the easiest difficulty message for any chance 95% or higher."
140877005,Switch to weapon materials for minMetalToHit,Allofich,2017-09-13 16:48:18+00:00,2017-09-14 02:28:12+00:00,{},"My earlier work on minimum metal to hit had a problem. I thought I could convert from `MetalTypes` in the enemy definitions to `WeaponMaterialTypes` by just subtracting 1, but `MetalTypes` also have ""chain,"" which meant all materials after chain were actually +2 compared to `WeaponMaterialTypes`.

This fixes the problem by switching enemies over to using `WeaponMaterialTypes`. Also I deleted an extraneous comment I left behind by mistake."
140839897,Implement holiday text,Allofich,2017-09-13 14:24:33+00:00,2017-09-14 02:28:51+00:00,{},"Holiday text implemented according to reversed function from classic.

I put in a timer to keep the text from immediately appearing upon game load or repeatedly happening every time you cross back and forth over a city border. Actually the city border (for when the ""You are entering"" text and holiday text appear) should be further out to match classic, which would also alleviate this problem, but that can come later. The timer is just something I hacked together and could be removed or adjusted.

The holiday text will need to have additional text macros filled out before it all looks correct."
140413425,Apply TerrainDistance at startup,rossipaolo,2017-09-11 19:15:31+00:00,2017-09-12 02:11:41+00:00,{},
140330401,"Reaction mod, serialize data, disable crime quests",Allofich,2017-09-11 13:09:52+00:00,2017-09-12 02:11:11+00:00,{},"Identifies and imports the biography reaction mod, serializes new player entity data (minMetalToHit, biography mods, thieves guild and dark brotherhood) and disables starting dark brotherhood and thieves guild quests or tallying their requirements.

The only piece of data I didn't serialize was that for the enemy entity in corpses. I gave it a quick go, just saving and loading the EnemyEntity in SerializableLootContainer, but not all the data was being saved, as it would just show ""You see a dead ."" after killing an enemy, saving, loading the save and clicking the corpse again. Interkarma, do you know what needs to be done there?"
140219690,Correct typo and add .vs to gitignore,ajrb,2017-09-10 18:34:04+00:00,2017-09-10 22:38:30+00:00,{},"I've gone back to visual studio because Unity crashes a lot when debugging with MonoDevelop, so have added .vs to gitignore because otherwise I will forget and commit it by accident at some point."
140210810,Implement prohibited equipment,Allofich,2017-09-10 14:25:22+00:00,2017-09-10 22:39:24+00:00,{},
140203967,Implement starting crime guild quests,Allofich,2017-09-10 10:43:55+00:00,2017-09-10 22:46:37+00:00,{},"This starts the thieves guild and dark brotherhood quests in the same manner as classic. The necessary data is also imported from classic saves.

Problems:
- I don't know Unity and its ""components"" and stuff very well and couldn't figure out how to make a blood splash appear when a citizen is killed. Copying the approach used in the file for hitting an enemyMobile didn't work. I guess that mobileNPCs need to have ""EnemyBlood"" assigned to them somehow.
- The population manager may need to be told when a mobileNPC is killed. I don't know much about it and haven't touched it.
- The thieves guild quest and dark brotherhood quest might not necessarily work. Are we only activating quests that are curated? Should these be commented out from starting for now?
- Variables aren't saved in Unity saves yet."
140201652,Implement clicking in info mode on dead mobiles.,Allofich,2017-09-10 09:23:00+00:00,2017-09-10 22:40:46+00:00,{},"Does as title says.

I think that classic still has a monster's stats within a corpse, so I did it the same way (adding an EnemyEntity field to the loot container) instead of just adding a name string and isEnemyClass bool.

Corpses EnemyEntity field isn't saved in DF Unity saves yet, so clicking on them after loading a DF Unity won't show anything."
140181696,Implement weight and encumbrance,ajrb,2017-09-09 19:21:14+00:00,2017-09-09 23:48:18+00:00,{},"Inventory, carry, wagon, gold.
Added message for gold too heavy from bank over classic.
Fixed skeletons key artifact popups."
140171859,Updates to activating objects,Allofich,2017-09-09 14:34:48+00:00,2017-09-09 23:42:40+00:00,{},"Changes:
1) Implements ""You are too far away..."" message, shown when player tries to activate various objects out of range.
2) Implements ""You see a/an %s."" when you click on an enemyMobile in info mode.
3) Activation ranges match classic. Buildings and enemy mobiles can be identified from far away like in classic.
4) Fixed being able to activate things through walls (ex. pickpocketing guards in Daggerfall castle through the wall)

To do this, I upped the raycast length when activating things to a long one. There was a problem with this though: I was able to click on things behind walls. There was a comment that RayCastAll was being used because when things block the raycast, it feels unresponsive to the player, but changing to RayCast fixed my problem and also fixed being able to activate through walls, and I don't notice any obvious unresponsiveness. Is there a particular case you were thinking of Interkarma? Could using a layer mask on the ray cast to filter out certain colliders solve the issue?"
140125304,"Change %reg to be same as %crn, new macro %hrg for home region",ajrb,2017-09-08 21:03:50+00:00,2017-09-09 00:14:34+00:00,{},
140106231,DayNight: Fix issue where status is not set after transition,rossipaolo,2017-09-08 19:11:45+00:00,2017-09-09 00:12:48+00:00,{},
140072645,MeshReplacement: Treasures,rossipaolo,2017-09-08 16:06:03+00:00,2017-09-09 00:17:42+00:00,{},"Imports 3d models for treasures and lootable corpses. 
I don't think this is the best way to deal with the fact that the treasure prefab is loaded from resources, but if I replace the entire gameobject (and add lootable script and sphere collider) i have troubles preserving serialization. I'm open for suggestions."
140051294,"Identify more save vars, use avoidHit mod",Allofich,2017-09-08 14:30:52+00:00,2017-09-09 00:16:45+00:00,{},"Identifies several values in savevars, and uses the mod to avoiding hits that can be set during character generation in the combat formula.

I also identified the other mods that can be set during character generation (you get one of these as the result of the ""You have the most trouble ___."" question.) The only one I haven't found yet is the reaction modifier, which I think affects how much NPCs like you. The modifiers I found were all next to each other but the reaction one didn't show up."
139923188,Artifact handling added,ajrb,2017-09-07 23:01:24+00:00,2017-09-08 06:59:12+00:00,{},"DFU now recognises artifacts, now correctly showing name and powers.
Also fixed item template hitpoints for some ingredients."
139881813,TextureReplacement: Mobile NPCs,rossipaolo,2017-09-07 19:05:15+00:00,2017-09-08 06:58:37+00:00,{},"* Support mobile npcs (4096 atlas like vegetation)
* Removed old checks in RMB I forgot to remove before"
139776694,talk window - first stage of implementation,Nystul-the-Magician,2017-09-07 11:04:46+00:00,2017-09-08 06:57:39+00:00,{},"I create this pull request now since important parts of the basic window functionality are working and I already touched a lot of files - so I want to do several ""smaller"" pull-request (in fact they are not that small) instead of one huge in the end...

things changed in other files than DaggerfallTalkWindow that are worth mentioning:

- MobilyPersonNPC now holds all npc data and its data is propagated to/consumed by MobilePersonMotor and MobilePersonBillboard class

- Found and fixed a bug in HorizontalSlider class preventing correct slider operation in many cases

- extended Listbox (and its dependency) TextLabel class to support labels starting from a character other than the first (if it is not clear what I mean check out talk window list box on the left - it can be scrolled to left/right to show entries that are longer than the list box's window frame size)



"
139776006,Pass down wrapText parameter,Allofich,2017-09-07 11:01:07+00:00,2017-09-08 13:19:59+00:00,{},"This just passes down the wrapText parameter from where pickpocketing happens. It ends up passing a bool through a bunch of functions, which might not be to your liking. Feel free to reject this if you have something better in mind.

I removed maxWidth as a parameter for now, since it's not currently used."
139666494,Add player gender macros,ajrb,2017-09-06 21:14:46+00:00,2017-09-06 22:55:18+00:00,{},
139549320,AdvancedSettingsWindow: reorganization of settings position,rossipaolo,2017-09-06 12:31:19+00:00,2017-09-06 22:55:06+00:00,{},Items are better subdivided in sections
139389491,Multi popups and item name fixes,ajrb,2017-09-05 18:24:36+00:00,2017-09-05 23:14:19+00:00,{},"- Added identified state to items. (first use of flags)
- Most item names now match classic, including unidentified magic items.
- Artifacts not currently identified by item system but names will be correct once that has been done.
- Tooltips also now match item titles on popups.
- Book title & author now shown on popups.
- DaggerfallMessageBox can now have a next message box added which will be displayed when user clicks. The last message box will close all of them. As far as I know Daggerfall only ever uses 2, but I wrote it so you can nest to any level. (of course) Actually found a couple of the artifacts do use 3! (skele key & mask)
- Add second info popup for health status.
- Implement magic item powers popup using multiline macros. Just displays ""Power number N"" for each power for now until magic systems implemented and a mapping for the DF spell effect numbers is availiable."
139204532,Removed length limit on popups.,ajrb,2017-09-04 19:46:17+00:00,2017-09-04 22:30:08+00:00,{},Also tidied comments on MacroHelper
139161388,Adjust monster speeds,Allofich,2017-09-04 13:45:23+00:00,2017-09-04 23:33:27+00:00,{},"Monster speed is the same formula as the player has when walking.

Also bumped up monster attack animation to be closer to classic. The speed of the swing in classic is not dependent on the monster's speed, and I think it may vary depending on the speed of the computer (or the ""cycles"" in DosBox), but I put it at what seems to me like a reasonable value that doesn't look overly fast.

I was also looking at adjusting the point in the animation swing where damage is applied. Interestingly, it seems like it varies by enemy in classic. Also I noticed, for example, that the imp plays its attack animation forward and then backward in classic. I don't know where this information is stored, though."
139063308,Merge Macro handler to master,Interkarma,2017-09-03 21:55:28+00:00,2017-09-04 00:38:23+00:00,{},Some conflicts to resolve.
139055487,Horizontal Slider,rossipaolo,2017-09-03 17:43:39+00:00,2017-09-03 21:49:19+00:00,{},
139044150,Refactor macro context system,ajrb,2017-09-03 11:32:33+00:00,2017-09-03 21:53:26+00:00,{},"Here you go, no inheritance for context providing objects anymore. Also added documentation, tidied up and added item condition & worth handlers.

This is now complete and ready for merging with master from my point of view. I plan to add a few more handlers, and also write instructions on 'Developer Discussion' forum so it's easy for anyone to add new handlers in the future when the see a %abc[tag] appear in game."
139023990,Transport menu - ship basics,ajrb,2017-09-02 19:37:56+00:00,2017-09-02 22:28:02+00:00,{},"Enabled ship option of transport menu.

Teleports to ship at 2,2
Stores player boarding position for transport back.
Saves and loads boarding position.
Handles terrain sampler changes on stored position.

Would like to do other ships but no idea where they are in gameworld, so they can wait.
"
139014820,Implement weapons and armor taking damage,Allofich,2017-09-02 14:51:46+00:00,2017-09-02 22:35:11+00:00,{},"Weapons and armor take damage now.

For now at least, I've copied classic behavior of only damaging non-magical weapons and armor when a damage-causing hit is made with a weapon. I know Morrowind has the same thing where creature hits don't damage armor, so this may have been a conscious decision.

I found what seems to be an oversight in classic, in that there is no code for damaging shields, only the weapons and the armor on the body part that gets hit, so I introduced an attempt at adding shield damage in. Going on the assumption that an attacked target first tries to avoid an attack completely with agility, luck, etc. and then uses their shield and then any armor equipped under the shield, I put in a ""what if"" calculation that looks at whether the attack gets avoided at the shield stage, in which case the shield takes damage. If the attack is not avoided, the armor worn underneath takes damage.

As part of putting that in, I needed to refactor some stuff for getting shield armor values (or else there would have been duplicate code), which makes the PR a little bigger.

I named the damage function DamageThroughPhysicalHit. Classic uses a separate function for damaging magic items when you use them, and we might, too.

The damage to items is done with the same calculation as classic. A message appears for the player and and also for enemies when an item breaks, which I think would also happen in classic, but I didn't test enemy. Item is unequipped from both player and enemy when it breaks.

I improved the message when an item breaks to show the long name of the item rather than the short name, and to be grammatically correct (""have"" for boots, gauntlets and greaves) and say ""has/have"" broken rather than ""is"" broken. I noted the difference from classic in a comment."
139004669,Prototype macro handling system,ajrb,2017-09-02 08:16:54+00:00,2017-09-02 22:25:05+00:00,{},"Please let me know what you think of this. If you like it I will finish it and tidy it up and submit again.

Info status popup complete. (press 'I')
Weapon info almost complete.
Armour info partially complete.
Quest macros handled."
138982542,Fix horse casule height and prevent horse crouching,ajrb,2017-09-01 22:19:15+00:00,2017-09-01 23:04:59+00:00,{},"Thanks for pointing out why the y axis capsule center needs repositioning.

Also realised I had re-allowed crouching at some point. Horses cant crouch right?"
138933279,Add sounds when enemy hits player or swing misses,Allofich,2017-09-01 16:57:10+00:00,2017-09-01 21:23:00+00:00,{},"Adds hit sounds when enemy hits player based on their weapon, or lack of, and also plays an appropriate miss sound if the player isn't in range of their attack."
138898022,Fixes,Allofich,2017-09-01 14:02:41+00:00,2017-09-01 21:21:33+00:00,{},"A few minor fixes. I fixed up a few comments from my last PR, fixed being able to equip the buckler with 2-handed weapons (it's reported in the bug reports forum) and added the popup for when you can't travel due to nearby enemies.

I used the CUSTOM01 quest to test the travel fix, and I noticed that the quest doesn't reveal the location of the graveyard on the travel map. The quest file says ""reveal dungeon"" which I think should be ""reveal graveyard"", but even after doing that the graveyard won't show up on the map, so it's not in this PR. I did a quick investigation but couldn't find out what the problem is."
138688386,Assign correct info popup window based on item,Allofich,2017-08-31 14:53:32+00:00,2017-08-31 23:40:43+00:00,{},"This hopefully helps lay the groundwork for info popups on items. This doesn't parse anything, it just assigns the correct popup, or in the case of potions, inserts a TODO with information for implementing it later."
138591051,Merge transportation to master,Interkarma,2017-08-31 06:41:20+00:00,2017-08-31 06:41:25+00:00,{},
138520701,TextureReplacement: Billboard code cleanup,rossipaolo,2017-08-30 20:29:34+00:00,2017-08-31 06:39:45+00:00,{},
138360618,fix for incorrectly shown border on travelmap (world map),Nystul-the-Magician,2017-08-30 08:04:36+00:00,2017-08-30 10:11:14+00:00,{},"fix for incorrectly shown border on travelmap (world map) -
border is only shown in region map now"
138285612,Fix issues with horse riding,ajrb,2017-08-29 21:14:00+00:00,2017-08-29 22:44:42+00:00,{},"- Capsule height and camera height now set correctly. Height when riding is now 2.6m and camera is always set at 9cm below the top of the capsule. (execpt for when crouching cos that is strange and I didn't want to mess with it)
- Speed is calculated using the base units from DF provided by Allofich (thanks!) and affected by speed skill level. (moved numbers into constants)
- Sounds and animations stop when game is paused."
138059890,Update to current master,Interkarma,2017-08-28 23:34:24+00:00,2017-08-28 23:34:31+00:00,{},
138011866,Added transport menu and horse riding.,ajrb,2017-08-28 18:50:53+00:00,2017-08-28 23:34:45+00:00,{},"- Transport popup menu added. 
- Options enabled depending on having horse or cart in inventory.
- Horse and cart transport modes change height and speed. (cart and horse are the same to minimise changes to PlayerMotor class)
- Allow jumping since it makes sense that a horse can jump. (should be disabled for cart when PlayerMotor is rewritten)
- Play sounds for movement (clip-clop) and random neighing. (every 2-30secs)
- Transport state is correctly saved & loaded. (not imported from classic saves)
- Automatically dismount when entering buildings or dungeons.
- Fixed palette bug in CfaFile.
"
137988177,TextureReplacement: minor optimization and logs for terrain,rossipaolo,2017-08-28 16:43:17+00:00,2017-08-28 23:33:50+00:00,{},"I removed a method used before my recent changes. I noticed it was also called for terrain but a more specific method exists for the purpose, so i swapped them. I took the occasion to add a few error messages for the log.

Nystul may want to review this PR but these should be pretty minor changes; all features, including normal map import, are preserved."
137955146,Match possible treasure pile sprites to classic,Allofich,2017-08-28 14:14:33+00:00,2017-08-28 23:31:37+00:00,{},Classic has these in a byte array in FALL.exe and uses them for loot piles in dungeons or when the player drops loot.
137845369,travel time countdown implemented for worldmap,Nystul-the-Magician,2017-08-27 19:38:03+00:00,2017-08-28 23:33:03+00:00,{},"this is done via coroutines
had to implement it with a helper class that inherits from MonoBehaviour so that coroutines could be used (since DaggerfallTravelPopUp class is not inheriting from MonoBehaviour)
this works reasonable well

unfortunately there are these limitations:

- location loading and countdown cannot be done in parallel - since unity does not allow different threads with calls to unity api functions (this would be needed since the gui needs to be updated and location loading also calls unity api funcions like gameobject creation etc., current approach with coroutines does  no concurrent processing

- countdown is done before actual fast travel actions right now

- since coroutines are involved now: camera updates happen now that did not before (I guess in between coroutines processing when yielded) - leading to ""empty"" scene loading in the background when new location is loaded (or in case of of farterrain and realtime reflecions mod some artifacts - camera glitches, and bottom side of reflection plane with green debug color)

- just disabling cameras and other camera update prevention measures did not work or made mods throw exceptions - so I decided to restrain from this for now - will further look for a solution

"
137812709,Texture replacement: Billboardbatch and optimization,rossipaolo,2017-08-26 21:31:15+00:00,2017-08-27 21:32:18+00:00,{},
137790876,Make building discovery closer to classic,Allofich,2017-08-26 08:35:39+00:00,2017-08-27 21:31:27+00:00,{},"Does these changes:

1. Houses on sale now identified as ""House for sale"" when clicked in info mode, and on automap
2. Clicking on buildings only discovers them (unless door is clicked) and shows shop times if in info mode
3. Buildings are discovered when their doors are clicked, in any mode

This all matches classic behavior as far as I can tell."
137698378,Implement building opened/closed hours,Allofich,2017-08-25 15:26:21+00:00,2017-08-26 00:06:55+00:00,{},"Implements:

- All buildings except houses should have the same hours for the doors being locked/unlocked. You can get a message for stores' opening and closing hours by clicking info mode, as in classic.
- Houses 1 through 4 are open during the day and closed at night, and you get a greeting when you enter, like in classic.

To be done:
- There's something more to how the houses' open hours are calculated, but I haven't figured it out yet.
- Since exterior doors don't have lock values and can't be picked or bashed yet, you can get in through any exterior door right now by clicking in steal mode."
137554390,Correct set_weather usage and add check,rossipaolo,2017-08-24 21:21:01+00:00,2017-08-24 22:37:40+00:00,{},
137237313,Approximate classic player movement speeds,Allofich,2017-08-23 14:43:22+00:00,2017-08-24 22:36:58+00:00,{},"This PR approximates classic player movement speeds.

First I recorded the length of time it took to walk the same distance with the same speed stat in classic and Unity. Comparing the movement values used in FALL.EXE for to those of DF Unity I found the ratio was about 39.5 to 1, meaning a speed value of 39.5 in classic is about the same as a speed value of 1 in DF Unity. This is probably slightly off. For one thing movement is classic seems to be instant stop-and-go but there is acceleration and deceleration in DF Unity.

The walk, crouch and run formulas are matched to classic. The run formula is also in DF Chronicles and matched what I saw in the assembly code.

One little thing I found: the ""maxSpeed"" value in z.cfg can be used to modify walk speed in Daggerfall version 1.0 but as of the latest Daggerfall version maxSpeed now seems to be hardcoded at 200 and is no longer read from z.cfg. Also I'm not sure why they named it ""maxSpeed"" because that doesn't seem to be what it does. Maybe it was used in a different way at some point or maybe I'm missing something. Walk speed in classic is calculated as (Player.Speed - 50 + maxSpeed).

Also I modified the get_walkingspeed and get_runningspeed commands to fit with the new code. If you set a value with them it's used as an override. You can return to the classic formula-based speeds by setting a value of -1."
136953306,Match door bash formula to classic,Allofich,2017-08-22 11:13:44+00:00,2017-08-24 22:35:11+00:00,{},
136644024,Add .VC.db files to gitignore,Allofich,2017-08-20 13:54:36+00:00,2017-08-21 00:49:03+00:00,{},I always have a .VC.db file show up among my modified files which is inconvenient when preparing commits.
136192641,improvements to discovery implementation of travelmap,Nystul-the-Magician,2017-08-17 07:48:21+00:00,2017-08-18 08:34:52+00:00,{},"added console command map_reveallocation [regionName] [locationName]
reverted behavior: forgotten graveyards are not known automatically (more investigations are needed of classic daggerfall behavior with graveyard - seems like common graveyards are always known, some forgotten graveyards are always known and some forgotten are not...)





"
135559958,travelmap location discovery implemented,Nystul-the-Magician,2017-08-14 09:34:57+00:00,2017-08-16 00:27:09+00:00,{},"Hi Interkarma!
I added static function checkIfLocationTypeAlwaysKnown to PlayerGPS - reason is because I added a check to location discovery function DiscoverCurrentLocation which checks if the location type is one of those that should always be known to the player like town, village, temple, common graveyard - I did add the check so that discovery dictionary (and savegame data) remains as small as possible - imagine a player that travels a lot will have lots of locations in there that could be saved
BUT: if you don't like it JUST remove the check (line 604, 605) - then the function checkIfLocationTypeAlwaysKnown could be moved over to DaggerfallTravelMapWindow.cs...

added 2 console commands (in DaggerfallTravelMapWindow.cs): map_reveallocations and map_hidelocations (it is only a temporal reveal - discovery state is of course not changed)

best regards!
"
135493227,Flesh out armor and weapon generation closer to classic,Allofich,2017-08-13 13:00:12+00:00,2017-08-16 00:29:27+00:00,{},"Currently in master, DF Unity is far more generous giving out weapons and armors of high materials than classic is. This PR replicates what I've found of the armor generation function in classic.

It uses random numbers so it's hard to say for sure, but it seems like classic is a little more generous with materials than the results from this PR. I don't think I'm missing anything from the generation function, so maybe it's a difference in the random number generators of classic and Unity, or maybe there's another factor somewhere that affects material generation.

Also, this PR sets weight, gold value, condition and enchantment points by material type. Variants aren't set yet and are always variant 0. as they are in master."
135401714,Add maps to loot and set loot by dungeon type,Allofich,2017-08-11 19:20:12+00:00,2017-08-13 22:46:07+00:00,{},"Adds maps to loot from enemies and in dungeons the same as classic, and sets loot by dungeon type as in classic"
135333740,Add DoorText action,Allofich,2017-08-11 13:18:24+00:00,2017-08-13 22:47:48+00:00,{},"This partially implements Action 99, which displays text at the top of the screen when clicking on some doors in info mode. Cases I know of that exist:
1) Doors in Castle Daggerfall off of throne room.
2) Doors in Castle Wayrest off of entrance area and in basement area before dungeon.
3) Doors in back of Orsinium throne room.

There's a few other texts in the used area of TEXT.RSC that might be unused or there might be a few other doors somewhere with this action.

There's an issue with this that I wanted your help with Interkarma. This action displays text at the top of the screen, but the text used is multi-line text. Is there currently a way to display this? Right now the text just runs off the screen.

This action can also cause castle guards to go hostile but this isn't implemented yet.

I found a few places where classic calls the wrong ID, creating an error message. I put in patches for these doors. Also, for fun, I recreated the Daggerfall error message if a wrong ID is called. :) Although I already patched the only wrong ID calls I know of. If you want me to remove the Daggerfall-style message and do a normal exception message I can do so.

Also, incidentally, do you know why the textIDs here are numbered as they are? From 7701 to 7705 are the first IDs, but then it suddenly jumps to 7717 for the orsinium one, and the next one is ID 7764.

Also, I display the popup text for 2 seconds. I measured the time in classic and it was 2 seconds or very close to it."
134944627,Update enemy equipment calculations,Allofich,2017-08-09 17:12:41+00:00,2017-08-10 03:58:16+00:00,{},"Updates to enemy equipment.

This mainly deals with armor values from equipment. I diverged somewhat from classic behavior for this. I'm trying to keep that to a minimum, but the classic behavior just seemed incorrect to me. In classic both monsters with equipment and enemy classes get their armor values from their equipment, overriding the armor values from the enemy definitions. This generally makes the monsters that use equipment (orc variants and centaurs) have worse armor than any other monsters, making them very easy to hit. The armor values they have in the enemy definitions work well, so in this PR they use whichever is better.

I did something similar for weapons. Here there's not as much of a problem with classic's behavior, but orc warlords in particular tend to do significantly less damage than they have in their enemy definition, because their weapon stats override the damage values. It seemed to me to be best if weapons are also only used if they are better than the enemy definition values."
134472791,Implement enemy equipment,Allofich,2017-08-07 16:04:59+00:00,2017-08-08 02:42:57+00:00,{},"This PR implements enemy equipment. Enemy classes and some monsters receive it, and the equipment can be found on their bodies when they die. Enemies with weapons use it for their attack damage now. I haven't yet implemented the effect of the armor on enemies' armor values. Also, right now the materials are using the random material methods in ItemBuilder, but I haven't looked into how classic chooses material.

Also, enemy classes now use the same loot table keys as classic. Their equipped items are added on top of this."
134211410,Make loot generation chance closer to classic,Allofich,2017-08-04 17:08:46+00:00,2017-08-07 08:20:34+00:00,{},"This makes loot generation chance closer to classic.

I had noticed that in DF Unity tons of loot would be found by higher level characters. DF Unity multiplies the chance of finding all item types by the player's level, but classic only does this for the first four categories of items (ingredients). Everything else is just the chance seen in the loot matrices regardless of player level.

Also, classic's compare is (random value from 0 to 99) <= chance, so even a 0% chance category can create an item. This also means the values in the matrices are effectively 1 higher. My guess is that this is probably unintended, so I didn't recreate it."
133989134,Match monster loot lists to classic,Allofich,2017-08-03 16:34:30+00:00,2017-08-07 08:21:33+00:00,{},"Matches monster loot lists to classic. Also a few minor cleanups to the enemyBasics.cs file.

Looks like Bethesda probably decided to cut back on magic item spawns in between the time of the data Chronicles uses and the game's release. Similar to how they disabled magic item repair.

This PR doesn't touch loot from enemy classes."
133936134,Wrap long text messages over multiple lines,Allofich,2017-08-03 12:49:42+00:00,2017-08-07 08:22:47+00:00,{},"Fixes long text messages going off screen, which could happen with many of the pickpocketing messages where you find nothing useful.

It doesn't intelligently wrap by word, but by letter, but Daggerfall is the same way and it doesn't really bother me."
133144248,building discovery integration for exterior automap,Nystul-the-Magician,2017-07-30 21:46:57+00:00,2017-07-30 23:06:58+00:00,{},
132795117,MeshReplacement: do not seek into unloaded assetbundles,rossipaolo,2017-07-27 16:45:37+00:00,2017-07-28 06:38:32+00:00,{},Prevents issue with Mod.LoadAllAssetsFromBundleAsync(true)
132308710,Implement pickpocketing,Allofich,2017-07-25 15:19:33+00:00,2017-07-26 01:58:16+00:00,{},"The basics of pickpocketing are implemented here. More work needs to be done on it, but first of all I want to be sure you're OK with the ray tracing checks. It's using a mix of a ""motor"" for mobile NPCs and a ""DaggerfallEntityBehaviour"" for mobile enemies, but it works.

The most notable problem at the moment is that many of the messages when you don't find any gold on the target are too long and run off the screen. Looks like the text formatting still needs some work.

Also shortened the lockpicking formulas."
132281683,Add day time logic for imported models,rossipaolo,2017-07-25 13:29:42+00:00,2017-07-26 01:53:58+00:00,{},"If you want a test model to try, [this is a town lamp](https://drive.google.com/open?id=0B_JvVNlSG3cRWHpzZ0txaUF6NDA).
"
132142720,bugfixes for exterior automap,Nystul-the-Magician,2017-07-24 20:53:50+00:00,2017-07-24 22:44:13+00:00,{},"when exterior automap is opened player position is now always in focus
exterior automap gameobject is now always deactivated correctly when a savegame is loaded with pc in an interior location (this would have resulted in a phantom player marker somewhere on the interior automap)"
132063128,Bugfix: face picker skipped a face,komoku,2017-07-24 14:26:12+00:00,2017-07-24 22:44:42+00:00,{},"When clicking the next face button, the last possible face for each race/gender is skipped due to an off-by-one error. This should fix it."
132038016,Change lockpicking to be closer to classic,Allofich,2017-07-24 12:27:08+00:00,2017-07-24 22:46:56+00:00,{},"I found out a little more how lockpicking works in classic.
It turns out that when the player fails to pick a lock (not counting magic locks), the door stores the player's lockpicking skill, and subsequent attempts fail if the player's lockpicking skill matches that value. I thought you couldn't try again at all if you failed once (unless you left and re-entered the area), but you can try again if your lockpicking skill rises."
132030709,Identify more classic save data,Allofich,2017-07-24 11:43:52+00:00,2017-07-24 22:55:19+00:00,{},"Details:

1) Corrected some magic effect enums (just comments in the CharacterRecord right now)
2) Verified UnknownTownLink records are doors
3) Identified Creature2 as record for dead mobiles
4) Renamed some fields and records to match what the Fixsave utility calls them. Fixsave seems to call recordID ""mapID"" or ""map identifier"" but I didn't change to that because at the moment recordID seems like a better name to me. Also it calls ""container"" an ""item holder"" but I didn't change to that because container was already being referenced and had a file named after it.
5) A little bit of other renaming of as-yet unused records to try to make the descriptions more accurate."
131645216,MeshReplacement: Set filtermode to materials in children,rossipaolo,2017-07-20 20:40:05+00:00,2017-07-20 22:51:37+00:00,{},This also solves the issue where an empty prefab is used as parent.
131316776,CustomVideoPlayer: use DaggerfallUI,rossipaolo,2017-07-19 13:07:57+00:00,2017-07-19 23:23:01+00:00,{},Instantiate video player as BaseScreenComponent instead of GameObject
130855518,Identify more classic item data,Allofich,2017-07-17 13:27:02+00:00,2017-07-18 08:19:42+00:00,{},Identifying more of the item record data led me (kind of forced me) to remove some unneeded complexity from potion recipe code. I also was able to implement importing stack count for arrows.
130793911,Initialize player armor values to 100 when loading,Allofich,2017-07-17 07:02:18+00:00,2017-07-17 08:12:10+00:00,{},"Directly and only resets the armor values to their starting value of 100 when loading DF Unity saves, since the previous attempt of calling PlayerEntity.reset() also reset faction data, which wasn't wanted.

Another approach would be to save the armor values in DF Unity saves, and then we could just copy without worrying about resetting the values or calculating the armor values when loading a game. Loading from classic saves is already working this way, since classic saves have the armor values in them."
130739990,Initialize new character armor values to 100,Allofich,2017-07-16 05:42:13+00:00,2017-07-16 09:09:19+00:00,{},100 is the player character armor value for no armor equipped.
130723454,Identify more classic data,Allofich,2017-07-15 17:35:42+00:00,2017-07-16 23:47:00+00:00,{},
130714293,Match monster encounter lists to classic,Allofich,2017-07-15 12:26:40+00:00,2017-07-15 22:47:59+00:00,{},"The lists were mostly correct but lacked duplicate entries (except for one duplicate Mage entry). All lists actually have 20 entries, and duplicates fill this out."
130702132,More work on combat calculations,Allofich,2017-07-15 03:45:14+00:00,2017-07-15 22:41:53+00:00,{},"Implement armor values for player shields.
Use correct value for monster level and relabel old one as number of
hit point die rolls for monsters.
Read armor values from classic as signed bytes."
130462039,Action component for flat->3d object /2,rossipaolo,2017-07-13 20:38:15+00:00,2017-07-13 23:51:21+00:00,{},"Sorry for the long delay :P

Add a trigger to imported gameobjects for NPCs. Flats with an action are already given a trigger on [AddAction()](https://github.com/Interkarma/daggerfall-unity/blob/master/Assets/Scripts/Utility/RDBLayout.cs#L853) so custom flats should be already covered for that."
129737735,Minor changes to Enemy classes.,murderbeard,2017-07-10 17:57:27+00:00,2017-07-11 07:13:12+00:00,{},"- Enemy classes might as well use the GameManager.Instance.PlayerXXX variables instead of grabbing the player themselves on Start.
- EnemySenses's DirectionToPlayer was not normalized.
- Moved hasEncounteredPlayer handling outside of CanHearPlayer and CanSeePlayer functions."
129721680,Identify more classic save data,Allofich,2017-07-10 16:31:55+00:00,2017-07-11 07:03:36+00:00,{},
129539334,Add player armor calculations and enemy combat sounds,Allofich,2017-07-08 19:18:51+00:00,2017-07-09 21:37:31+00:00,{},"Added player armor to the hit calculations, and miss sounds and collapse sound on death for enemies.

I wanted to add sounds for when enemies hit the player (two types, when the attack is done without a weapon and with), but I wasn't sure how that should be handled as far as what audio source to use."
129104857,Update to current master,Interkarma,2017-07-06 05:13:50+00:00,2017-07-06 05:13:57+00:00,{},
128758324,Merging smooth camera,Interkarma,2017-07-04 09:13:16+00:00,2017-07-04 09:13:20+00:00,{},
128586841,Smoothed out camera,murderbeard,2017-07-03 09:24:46+00:00,2017-07-04 07:18:35+00:00,{},"As the PlayerMotor uses FixedUpdate to calculate movement; the camera can feel choppy if your FPS is over 50. Increasing the fixed time step much higher will result in a lot of physics calls that affect FPS in general so that's not a good option. 

This adds the option to smooth out a transform child of PlayerMotor. This child will smoothly lag behind the motor so there is no perceivable stutter. It detects if the player has teleported when the distance travelled is larger than the velocity of motor allows, including a fairly large margin. When teleported the smoothing is reset so you don't see the camera lerping through the entire scene.

A few notes; smoothing reset also happens when the player switches to or from crouching. Currently this change is a hard jump anyway so I don't think this is noticeable. One option is to add this height difference as a minimum distance before it can even be regarded as a teleport.

One thing that might be an issue is that all children of the PlayerMotor are now grouped together under a new GameObject. This means that those children are hidden in the ProjectView as Unity only shows one level of Prefab depth. Trying to group them on runtime Start just adds confusion or issues because the Transform children cannot be found as they're disabled. "
128535889,Replaced any remaining non generic FindObjectOfType calls with generic version,murderbeard,2017-07-02 22:09:10+00:00,2017-07-02 22:32:11+00:00,{},"There were a couple of stragglers that used the old style of FindObjectOfType. These were not trying to get an interface for example so the non generic version wasn't required.

Did a similar search for GetComponent but those were all generic."
128488302,Minor fail-safe to video loading / playing,murderbeard,2017-07-01 13:18:22+00:00,2017-07-01 22:07:02+00:00,{},"This prevents a stream of errors in case someone didn't set up their daggerfall directory properly and is missing video files.

If the vidFile is unable to Load endOfFileReached is set to true so the video player just skips it and won't stay on a black screen forever."
128485015,Identify building data in classic saves,Allofich,2017-07-01 10:56:05+00:00,2017-07-01 22:08:45+00:00,{},"I figured out the data following the save tree header. Also, with this PR a classic save I had that didn't load correctly now does. Treating the ""environment"" variable as the number of LocationDetail records would cause it to move the reader past the character position record (record type 0x04), and the save would fail to load."
128239785,Don't play Mages Guild music in other guilds,Allofich,2017-06-29 20:26:29+00:00,2017-06-30 05:08:18+00:00,{},
128172560,Add damage and hit/miss calculations for AI,Allofich,2017-06-29 14:54:56+00:00,2017-06-30 05:08:09+00:00,{},
127982385,Add attack sounds for mace and bows,Allofich,2017-06-28 17:55:00+00:00,2017-06-28 22:25:53+00:00,{},
127979358,Implement hit/miss calculations for player,Allofich,2017-06-28 17:39:07+00:00,2017-06-29 03:45:49+00:00,{},"These are hit and miss calculations for the player. It's reverse-engineered from the executable so I think it's correct. There's no easy way to test it since it uses probabilities, but the results seem to match classic well."
127682722,Add more enemy stats and fix health calculation,Allofich,2017-06-27 12:33:55+00:00,2017-06-27 23:24:43+00:00,{},"This adds the stats for monsters' level, armor value and multiple attacks. I need to look into the attacks a little more but I think a monster with multiple damage values gets multiple damage rolls each time they attack. I think that Daggerfall actually supports (or at least there is room in the character/monster record) for up to 5 attacks, but no monsters have more than 3. I also fixed the health calculation for enemy classes.
"
127570474,Action component for flat->3d object,rossipaolo,2017-06-26 21:44:32+00:00,2017-06-27 08:10:59+00:00,{},"I moved my code in AddFlat() and hid the quest part under an if, so action and sound are applied in the same way for vanilla and custom. Let me know if you have other preferences."
127456048,Add more damage modifiers,Allofich,2017-06-26 12:07:44+00:00,2017-06-27 08:36:31+00:00,{},More work on damage modifiers. The damage modifier stuff should be almost done.
127370236,Fix damage values,Allofich,2017-06-25 16:47:45+00:00,2017-06-26 04:45:53+00:00,{},"Here are some fixes to damage values from the player's weapon hits.

It turns out there were a number of inaccurate things in the information Daggerfall gives about damage values, which were throwing me off until I figured them out. One is that the diagonal slash down to the right is actually a weaker attack than the horizontal attacks. The other diagonal attack is stronger, and the manual groups them together as both being stronger.

Another was that the strength damage modifier is different from what classic shows in the character sheet. It's actually (STR - 50) / 5, roughly twice the value that classic shows, in either negative or positive direction.

And then another was that the damage display for weapons with material modifiers (those other than steel and silver) is also incorrect! The material modifier to damage is half of what is shown, in both positive and negative direction.

This is backed up by a whole lot of testing and I'm pretty sure about these."
127248232,Add enums for furniture items,Allofich,2017-06-23 16:56:14+00:00,2017-06-23 22:20:17+00:00,{},"The group that was marked Error is furniture, according to the save game editor Daghex, which seems to be accurate about these sorts of things."
127030515,Implement weapon damage calculations,Allofich,2017-06-22 16:07:59+00:00,2017-06-23 23:23:40+00:00,{},"This puts in the basic weapon damage calculations for the player. The weapon type, material and strength modifier are all that are considered so far.

I plan to keep adding bits to this as I figure out the formulas, but first of all here are the basics."
126547613,Fix hit point calculations,Allofich,2017-06-20 14:30:10+00:00,2017-06-20 23:46:55+00:00,{},"For level up, I was just adding the Career.HitPointsPerLevelOrMonsterLevel. Actually it is a random number between this value and half of it, plus the endurance modifier."
126497606,Match shop quality text thresholds to classic,Allofich,2017-06-20 10:24:34+00:00,2017-06-20 23:47:05+00:00,{},
126496890,Identify classic save tree header data,Allofich,2017-06-20 10:21:08+00:00,2017-06-20 23:45:34+00:00,{},"Identified data in the classic save tree header and modified the SaveExplorer a little to match.

To keep compatibility with the current loading behavior, which uses the byte at 18 as the record length of SaveTreeLocationDetail, I reset the stream here for that class, but that byte is actually the current environment of the player."
126411049,New classic savedata,Interkarma,2017-06-19 22:27:37+00:00,2017-06-19 22:27:42+00:00,{},Merging this now offset problem fixed in equip table.
126410673,Update to current master,Interkarma,2017-06-19 22:24:54+00:00,2017-06-19 22:24:58+00:00,{},
126338505,Identify more save variables,Allofich,2017-06-19 15:58:49+00:00,2017-06-19 22:27:56+00:00,{},
126274627,bug fix for travel map find (location name occlusion issue),Nystul-the-Magician,2017-06-19 10:52:00+00:00,2017-06-20 23:44:28+00:00,{},"addresses a bug reported by user ""electrorobobody"" on forums - the bug prevented one to find locations with their names being a substring of a different location, e.g. in province Daggerfall ""Kingsly Manor"" could not be found via search because there exists a ""Buckingsly Manor"" that was returned instead"
126186601,Update to current master,Interkarma,2017-06-18 12:06:15+00:00,2017-06-18 12:06:20+00:00,{},
126166862,"MeshReplacement: name, optimization",rossipaolo,2017-06-17 20:17:05+00:00,2017-06-17 23:18:45+00:00,{},"* Added name as discussed
* Resource-import only on dev builds, import only from mods on released game.
* Optimization on method call to avoid repeating some code. Basically  some minor changes to integrate more default and custom import."
126155005,Correctly read cheat variable for godmode,Allofich,2017-06-17 13:27:21+00:00,2017-06-17 23:09:20+00:00,{},"Currently in master, if you load a classic save that has both the invulnerability cheat and the cheat to reveal all map locations active, godmode will not be activated.

Also includes code for reading the cheat to reveal all map locations. This is commented out for now until DF Unity supports hidden map locations, to avoid the unused variable warning."
126149919,Fix items in classic saves not being equipped,Allofich,2017-06-17 09:54:03+00:00,2017-06-17 23:03:14+00:00,{},Fixes problem mentioned in https://github.com/Interkarma/daggerfall-unity/pull/338.
126122178,Update to current master,Interkarma,2017-06-16 21:54:36+00:00,2017-06-16 21:54:41+00:00,{},
125867631,Fix rapid healing formula,Allofich,2017-06-15 16:58:06+00:00,2017-06-16 03:12:13+00:00,{},"Fixed a few problems with the rapid healing formula.

1. I accidentally set rapid healing in darkness so it worked in light.
2. Interiors should be considered a dark environment."
125853853,Don't pass time for full rest if at full health,Allofich,2017-06-15 15:49:27+00:00,2017-06-16 05:30:44+00:00,{},"The same issue of an hour passing for a 0-hour rest or loiter also applied for doing an ""until fully healed"" rest when at full health. No time should pass in that case."
125844941,Identify more data from classic saves,Allofich,2017-06-15 15:11:06+00:00,2017-06-16 03:50:45+00:00,{},"I identified quite a lot more data from classic saves with the help of Donald Tipton's save-viewing program chunktcl. I also found on my own that pitch and yaw seem to be default properties of all records.

The player's location is now gotten from the type 0x04 record, which I named ""CharacterPositionRecord."" I renamed the old CharacterPositionRecord to  HeaderCharacterPositionRecord.

Some of the record root data already being read into SaveTreeBaseRecord was reading data from the wrong location, but they should be reading from the correct spots now.

One thing that I think would now be possible is to recreate nearby monsters from save games, since I found the monster record and it includes their position. They have their name at the beginning of their data, so we could use that to determine the type. I'm not real sure about how you would want to handle spawning those monsters from a saved game, though."
125597448,Implement rapid healing,Allofich,2017-06-14 13:37:00+00:00,2017-06-15 09:11:06+00:00,{},"Implemented rapid healing (none, in light, in darkness, always) and cleaned up the earlier health recovery formula. This is checked against classic and should be correct."
125582151,Fix 0-hour rest and loiter taking 1 hour,Allofich,2017-06-14 12:23:40+00:00,2017-06-14 21:57:52+00:00,{},"Let's try this again.

I also noticed that the stupid healing rate when resting is acting up again, or maybe I didn't fix it correctly the last time. I'm only healing 1 point with a character who should heal more. I'll take a look at that next."
125575075,"Revert ""Fix 0-hour rest/loiter taking an hour""",Interkarma,2017-06-14 11:43:55+00:00,2017-06-14 11:44:03+00:00,{},Reverts Interkarma/daggerfall-unity#333
125561768,Raise foe max spawn limit,Allofich,2017-06-14 10:29:00+00:00,2017-06-14 11:44:55+00:00,{},"I saw the comment about foe spawn limits and decided to test it. I found no limit to the number of spawns classic can do of the same foe at a time.

I know for 100% sure it can spawn 20 at a time, as I was able to count them. I then raised it to 50, and what looked like 50 (I didn't actually count this time) spawned. An additional 50 (or what looked like 50) of another enemy spawned at the same time. If there is any limit it is very high."
125346166,Fix 0-hour rest/loiter taking an hour,Allofich,2017-06-13 12:02:18+00:00,2017-06-14 05:12:37+00:00,{},For http://forums.dfworkshop.net/viewtopic.php?f=24&t=529&p=5281#p5281.
125159180,Import player orientation from classic saves,Allofich,2017-06-12 15:07:27+00:00,2017-06-12 22:13:09+00:00,{},"This imports the pitch and yaw values from classic saves, resolving http://forums.dfworkshop.net/viewtopic.php?f=24&t=424&sid=3e361409f513f292e15381a7752cc11f.

After the pitch and yaw data is what seems to be a copy of the player position data found in the header. It is this position data, and not the player position data in the header, that determines where the player is when a save is loaded in classic. There is additional data after that, but I don't know what it is."
125088526,Do nothing if rest key is pushed while in air,Allofich,2017-06-12 09:01:09+00:00,2017-06-12 22:13:46+00:00,{},"Currently in DF Unity if you push the rest key while in the air you get the ""There are enemies nearby."" message. With this PR instead nothing happens, the same as classic."
125087181,Fix spinner missing on level-up screen in builds,Allofich,2017-06-12 08:53:27+00:00,2017-06-12 22:13:25+00:00,{},"Tested and confirmed working in a build using latest master, both from a DF Unity new game and from an imported classic save."
124993434,Correct spelling mistakes,Allofich,2017-06-10 14:56:19+00:00,2017-06-11 05:22:22+00:00,{},"This corrects all the spelling mistakes I saw in the code, not including comments.

By the way, Interkarma, if you use Visual Studio, you might want to try it's Code Analysis tool. It helped me find these spelling mistakes and it also pointed me to the incorrect uses of string.Format for my earlier PR. It can give a ton of suggestions if you apply all the rule sets, and I'm sure that are many false positives or suggestions that are against the coding style you want to use, but it may be worthwhile to take a look at if you feel like it."
124983281,Don't allow leaving with ESC during level-up,Allofich,2017-06-10 08:28:20+00:00,2017-06-12 22:26:58+00:00,{},"I suppose with this fix the issues in https://github.com/Interkarma/daggerfall-unity/pull/322 could result in you getting stuck in the character sheet window... I haven't been able to reproduce those yet, though."
124603893,"added exterior automap caption line (guilds, shops, taverns)",Nystul-the-Magician,2017-06-08 09:21:42+00:00,2017-06-10 04:09:13+00:00,{},"added exterior automap caption line (guilds, shops, taverns) to background image"
124406795,Fix input text overlapping,Allofich,2017-06-07 12:23:27+00:00,2017-06-07 23:32:39+00:00,{},"This is sort of a patched-on-top fix for overlapping text when you click on the banner/statue at Shedungent. This problem has been around since one of the changes I made some time ago to text formatting.

What classic seems to actually do is add these input text prompts to the same ""popup text"" lines used for things like ""-- just died."""
123883401,Fix for null reference on Unity saves,Allofich,2017-06-04 16:26:59+00:00,2017-06-04 22:49:49+00:00,{},"In an earlier PR I fixed null reference to skillUses[] on a new character, but it also happens with Unity saves that were saved before the additional data. This PR initializes the array in that case. It also sets EstimateStartingLevelUpSkillSum() to only be called if the skillsum is 0 because nothing was in the save file.

I guess stuff will continue to be added to the save file, so is this the way to handle missing data? Maybe defaults should be set first and things only assigned from the loaded file if they are non-null/non-0."
123875202,Correct stat raising calculations,Allofich,2017-06-04 11:55:24+00:00,2017-06-04 22:51:04+00:00,{},"Stat raising calculations should now be correct with this PR. This works for all the test cases I've used.

In a werewolf save I'm using (downloaded from the Internet), it looks like the skills raised by being a werewolf also have their advancement modifier halved, so they rise more easily. The character in the save is in human form but gets this benefit it seems. There may be something similar with vampires. This will need some more testing but I'm not going to bother with it for now."
123874472,ModSettings: support multiple pages,rossipaolo,2017-06-04 11:27:01+00:00,2017-06-04 22:50:26+00:00,{},"Places settings in a list of panels instead of a single one, in order to
support more than 38 keys.
A button and the keyboard Tab key can be used to switch among pages."
123830862,Implement player leveling,Allofich,2017-06-03 05:51:58+00:00,2017-06-04 00:47:49+00:00,{},Implements player leveling. As far as I know everything that should be implemented is implemented. Unity saves will at some point need to store the sum of starting skills used in calculating levels. For now this value is estimated based on the current level.
123830146,Fix for uninitialized skillUses with new character,Allofich,2017-06-03 05:22:08+00:00,2017-06-03 06:09:54+00:00,{},Exception will occur in master when resting with a new character when TallySkill tries to access the uninitialized SkillUses array.
123785826,"ModSettings: Tuples, improvements on Cancel button",rossipaolo,2017-06-02 19:34:16+00:00,2017-06-03 00:18:01+00:00,{},"* Added support for tuples in ModSettings and ModSettingsWindow.
* Do not write to disk automatically when a preset is applied, let the
user Save or Cancel all changes.
* Minor changes to colors: use a brighter blue for section titles."
123715778,Restore some settings from classic saves,Allofich,2017-06-02 13:18:52+00:00,2017-06-03 00:22:42+00:00,{},Does as the title says.
123669120,Import some more information from classic saves,Allofich,2017-06-02 08:45:12+00:00,2017-06-03 00:25:28+00:00,{},"This imports a couple more things from classic saves:

1. Race for player to return to after they have become a vampire, werewolf or wereboar.
2. Hit points to gain on leveling up

Also corrected the race enums to match classic (they were off by 1) and added in vampire, werewolf and wereboar."
123473133,Implement skill raising,Allofich,2017-06-01 11:04:49+00:00,2017-06-01 23:42:27+00:00,{},"Implements skill raising. From testing classic, I think the only factors that affect how many skill uses are needed to raise a skill are the skill value (it's percentage) and the player's level. Different skills have different modifiers to how many uses they need. Running has such a high one because it is tallied very quickly while moving."
123433790,Simplify previous fix,Allofich,2017-06-01 07:25:40+00:00,2017-06-01 23:40:31+00:00,{},Small simplifying of the last PR.
123425535,Fix player dying on starting new game,Allofich,2017-06-01 06:20:21+00:00,2017-06-01 06:29:13+00:00,{},Looks like I shouldn't have changed the thing. I didn't test my changes in the last PR on starting a new character. This PR should fix it.
123285268,Identify and import more data from classic saves,Allofich,2017-05-31 14:21:39+00:00,2017-06-01 02:43:10+00:00,{},"Through a combination of testing with the save editor DagHex and confirming in-game, new values have been identified in classic saves. Current health, spell points and fatigue are imported as they are into DF Unity, as are skill use counts.

The player's reputation with commoners, nobility, scholars, merchants and underworld is based on the message you get about your reputation being higher or lower during character creation. DagHex has nobility and merchants switched compared to this, and DaggeD, another save editor, has the reputations in the opposite order of how they're shown in-game. I'm going with the in-game display as most reliable until it can be confirmed somehow."
122932742,Remove unneeded checks,Allofich,2017-05-29 18:38:00+00:00,2017-05-29 22:20:31+00:00,{},Remove a couple unneeded checks I added to the healing formulas. I was tired and thought I was protecting against dividing by zero :).
122931948,Implement lockpicking difficulty messages,Allofich,2017-05-29 18:28:21+00:00,2017-05-30 12:18:33+00:00,{},"Implements lockpicking messages. I noted what seems to be an oversight in classic: the lockpicking difficulty messages in classic are always for the harder of two lockpicking formulas. That harder formula is used (I think) on exterior doors that lead into interiors, while an easier one is used for lockpicking the animating doors in interiors. I don't know whether the oversight is that the difficulty messages only account for one of the formulas, or if its that there are two different formulas.

I have hooked up the text to use the interior door formula (since DF Unity right now only has locked doors in interiors), so you will get accurate messages instead of the ones you will get in classic.

BTW, to be like classic, the text should be in the middle of the screen, the same spot currently being used for interaction mode changes. This spot is also used in classic for some other messages like ""You have no arrows."" when you try to equip a bow. If it's okay I'd like to change its name from ModeText to ""MidscreenText"" or something and use it for these other messages."
122773569,Improvements to FaceWall,rossipaolo,2017-05-27 20:26:52+00:00,2017-05-27 22:56:54+00:00,{},"* Rotate the GameObject to align it to non-straight dungeon walls
* Additionally to bring near the go if is distant from the wall, now it
also move it away if it's clipping in it."
122758323,Implement lockpicking,Allofich,2017-05-27 11:33:53+00:00,2017-05-27 22:55:07+00:00,{},"Here's an implementation of lockpicking.

I've found what I think is the formula for lockpicking interior doors in FALL.EXE. It involves randomness so it's hard to test in-game. It seems like I have higher success in the original game but that might have just been luck.

I also made an educated guess that the lock value of doors should be divided by 8 compared to what it is in DF Unity. DF Unity was marking a lock of 160 or more as magically locked, while original Daggerfall shows the magically-locked message for a value of 20 or more. Dividing the DF Unity lock values by 8 produces what seems like correct values for the locked doors in the Castle Daggerfall throne room.

The basic lockpicking behavior also replicates this behavior from the original game:
1. If you click on a locked door outside of steal mode, you get a message that the door is locked.
2. If you click on a non-magically locked door in steal mode, you make a lockpicking attempt. If you succeed the door opens and a click sound plays, which DF Unity was using for when you clicked on a locked door.
3. If you fail to pick a lock, you can no longer attempt to pick it unless you leave and re-enter the area. In original Daggerfall this persists across save and load."
122605476,Implement remaining formulas for resting,Allofich,2017-05-26 09:32:40+00:00,2017-05-27 10:16:43+00:00,{},"Implements the formulas from classic for recovering fatigue and spell points. This was easy because they are both just += (max points / 8). Also tallies the medical skill. This is all confirmed from testing in classic.

A pedantic point but I don't think the term ""magicka"" is used in Daggerfall, just ""spell points,"" so that's what I used. If you want to refer to it as magicka I can change it."
122510016,Fix issue with more than one songplayer in scene and tdbg command,rossipaolo,2017-05-25 19:39:19+00:00,2017-05-25 22:12:20+00:00,{},"A while ago i reported that the songplayer value in tdbg always shows that no song is playing.
This is caused by having more than one songplayer in scene, as two of them are detected but the correct one seems to be always the second. 
I don't know if this information can be trusted, so i have implemented a foreach to to seek wich one is playing.

On an unrelated note, i noticed that you started updating the copyright date, do you wish contributors to do the same when they submit a PR?"
122457251,Implement zero-fatigue behavior,Allofich,2017-05-25 14:56:58+00:00,2017-05-25 22:20:31+00:00,{},"This implements the game behavior when the player runs out of fatigue. There are two cases, depending on whether there are enemies nearby:

Enemies nearby: ""you are easy prey for monsters"" message, and player dies
No enemies nearby: ""you awaken one hour later"" message, and player is forced to rest for one hour

I redid the CanPlayerRest() function into a AreEnemiesNearby() function, because I needed this functionality separated out from the rest function.

There are a few issues that could be ironed out.
1. When the player dies with the ""you are easy prey for monsters"" message, he can still move the view and move slightly, unlike when you die from damage. I don't know why.
2. The player death sound plays while ""you are easy prey for monsters"" message is up.
3.  If you lose your last fatigue points from jumping, you will start the jump before getting the message box, whereas in classic you just lose the fatigue points and get the message box with no jump. I use cancelMovement() so the jump doesn't continue after the message box, but ideally I'd like to copy classic and stop the jump before it starts, but I know you don't want game logic in PlayerMotor.cs."
122420087,Fix fatigue loss and skill tallying for jumping,Allofich,2017-05-25 11:16:26+00:00,2017-05-25 22:12:38+00:00,{},"I should have checked that IsJumping is false again before resetting the bool to check for decreasing fatigue and tallying skill uses. When a jump ends, Update() in DaggerfallEntityBehaviour.cs would run a few times in the interval between when IsGrounded is set to true and IsJumping is set to false, so fatigue and skill tallying were happening multiple times per jump.

Also I renamed the variable isJumping to jumping, to match with other booleans in there like sliding and falling, and only set it to false when needed."
122390002,Fix rest health rate calculation,Allofich,2017-05-25 07:56:16+00:00,2017-05-25 10:26:54+00:00,{},"The problem with the resting function was with the endurance modifier. If you had a negative endurance modifier you could regain no health or even lose health. In classic you regain a minimum of 1 no matter how low your endurance modifier is, and this PR makes DF Unity the same."
122073693,TextureReplacement: Loot containers serialization,rossipaolo,2017-05-23 19:13:36+00:00,2017-05-23 23:10:28+00:00,{},Loot containers use custom textures when loaded from a save.
121984514,Tally weapon skill uses,Allofich,2017-05-23 12:24:41+00:00,2017-05-24 03:02:43+00:00,{},"Tallies weapon skill uses. I've managed to figure out a simple function in FALL.EXE used for tallying skills, and I added in calls to tally weapon usage. I also added in enums for skills based on their ordering in FALL.EXE."
121959420,Add fatigue loss for some actions,Allofich,2017-05-23 10:05:21+00:00,2017-05-25 08:48:27+00:00,{},"Adds fatigue loss for jumping and attacking, as well as per minute of game time based on whether the player is running or not. The values are from the Daggerfall Chronicles and I confirmed by testing in classic."
121848866,Track fatigue at 64 times character sheet value,Allofich,2017-05-22 19:31:36+00:00,2017-05-23 07:01:10+00:00,{},"Track fatigue internally at 64 times the value shown in the character sheet, the same as classic does. This will allow for implementing loss of fatigue values in the same way."
121823959,Set gargoyle to have blood splash,Allofich,2017-05-22 17:04:59+00:00,2017-05-22 22:28:07+00:00,{},"I can see why it was set without, but the gargoyle should have a blood splash like in classic, because it has blood in its corpse texture."
121822572,Implement ineffective weapon materials,Allofich,2017-05-22 16:57:17+00:00,2017-09-10 22:46:58+00:00,{},"Implements ineffective weapon materials, as well as a little reorganizing. Later we will probably want to use the weapon damage code for AI attacking the player or each other, too."
121731890,Identify more sound clips,Allofich,2017-05-22 09:17:11+00:00,2017-05-22 09:27:59+00:00,{},"This identifies more sound clips. The main thing is pain sounds based on race and gender. These are unused in classic Daggerfall but I'm almost sure that's what they were for, since their sound ID and the way they sound matches with the order of the races."
121718183,Set same ambient dungeon effects as classic,Allofich,2017-05-22 07:58:57+00:00,2017-05-22 09:27:39+00:00,{},"Sets the same ambient dungeon effects as classic, which are all next to each other in the list of sounds.

Alternate ambient sounds might be fun, too, but I figure we want to at least have the same ones as classic ready for use."
121060597,OnPreTransition now passes the correct transition type,rossipaolo,2017-05-17 13:42:36+00:00,2017-05-17 22:36:38+00:00,{},
120875500,Show hand-to-hand damage in character sheet,Allofich,2017-05-16 16:50:41+00:00,2017-05-16 22:43:46+00:00,{},"Shows the hand to hand damage in the character sheet, like classic Daggerfall.

In classic, this text is colored a light blue. I don't know off the top of my head if there are any other places with other-colored text like this, but if I'm not mistaken at the moment Daggerfall Unity only supports one color of text per text label/message box.  I want to change just the color of this one token, but the only way I thought of was to add a color property to `TextFile.Token,` and I thought you might not want that, so for now the text is the default color."
120803606,Fix string.Format usage,Allofich,2017-05-16 11:24:20+00:00,2017-05-16 22:44:25+00:00,{},There are a number of incorrect calls to `string.Format`.
120789277,Make player look straight when leaving dungeons,Allofich,2017-05-16 10:04:39+00:00,2017-05-16 23:09:02+00:00,{},A simple fix for http://forums.dfworkshop.net/viewtopic.php?f=24&t=325. Any reason to not just set the player's view horizontal like this?
120776607,Move text ID variables to method scope,Allofich,2017-05-16 09:00:26+00:00,2017-05-16 23:13:35+00:00,{},"Based on discussion in https://github.com/Interkarma/daggerfall-unity/pull/289, this is how I understand you would like to declare the text ID variables. This gets rid of the classic text ID regions and puts the variables in method scope, since none are used in more than one place.

Very minor point: Do you prefer ""ID"" or ""Id"" in the variable names? I assume ""Id"" since that's what had been used before in the armor, weapon and misc item variables, so that's what I used for this PR."
120443299,Fix enumerator error,Allofich,2017-05-13 10:23:17+00:00,2017-05-15 04:01:04+00:00,{},"As mentioned in https://github.com/Interkarma/daggerfall-unity/pull/288, an error appears in the console when turning pages in books.

I borrowed a solution for the same error from here:
http://answers.unity3d.com/questions/290595/enumeration-operation-may-not-execute-problem-with.html

The error is gone, and I can't see any difference in behavior when turning pages or opening and closing the various panels."
120440965,Add player death sound,Allofich,2017-05-13 08:54:58+00:00,2017-05-15 04:01:31+00:00,{},"Another tiny PR. I know you could easily add this yourself, so if you don't want these kinds of tiny PRs, just say so.

This adds the player death yell, which I'm sure is all too familiar to people who've played the original Daggerfall. :)

Classic Daggerfall uses this same voice for both male and female player characters. As you know there are various unused male and female pain sounds in the game. Maybe the player could be offered a choice of voice, and/or they could be used for human enemies. For now, anyway, this is just the Classic Daggerfall voice."
120440237,"Add ""no spells in your spellbook"" message",Allofich,2017-05-13 08:27:36+00:00,2017-05-15 04:15:31+00:00,{},"Kind of pointless, but I added the ""You have no spells in your spellbook."" message so something happens when you click use on your spellbook. I also moved a few text IDs to the top of the file, which is where I've seen them in other files."
120434724,Add book sounds,Allofich,2017-05-13 04:29:50+00:00,2017-05-13 04:54:48+00:00,{},"Adds book opening and page turning sounds.

Unrelated to this PR, there is an error in the console when turning book pages, although the page turning seems to work fine."
120433737,Adjust attack-related timings to resemble classic,Allofich,2017-05-13 03:49:57+00:00,2017-05-15 04:03:45+00:00,{},"Here are some changes to make the combat feel a little more like Daggerfall classic.

Daggerfall Unity's swing sound played at the start of an attack, played whether an enemy was hit or not, and the hit didn't register until after the animation finished.

In classic the swing seems to play at just about the frame after the middle frame. It plays if the player misses or the player hits a door, but not if they hit an enemy. The hit registers at about this same time.

This PR tries to make the above behavior like classic."
120256290,"Fix bow attack, now it does not require swing",electrorobobody,2017-05-12 06:28:57+00:00,2017-05-13 03:56:51+00:00,{},
119907276,ModSettings: Add overloads with min and max for numerical values,rossipaolo,2017-05-10 15:09:20+00:00,2017-05-10 22:34:19+00:00,{},
119500049,Implement basics of status window,Allofich,2017-05-08 17:54:26+00:00,2017-05-08 21:25:13+00:00,{},"This implements the basics of the status window (I key). It shows the place name and date. Right now the legal reputation just shows ""a common citizen.""

Some variables in TEXT.RSC that start with % are interpreted now. Anything with % followed by a letter or number is considered a variable that needs interpreting. This seems like the case in Daggerfall classic, because something like %a or %1 will just display as a blank in the game. If there's a space or a period or an exclamation point, and probably other things, after the % it will show in Daggerfall classic as it is, like ""% "" or ""%."" or ""%!""
"
119337682,Set message text color to match Daggerfall classic,Allofich,2017-05-07 12:53:54+00:00,2017-05-09 09:34:45+00:00,{},"This probably shouldn't be merged yet, because there's an issue with the colors that I hope you can help me with, @Interkarma.

This is an attempt to set text colors to match Daggerfall classic. I think the text colors of Daggerfall classic correspond to these colors found in its .COL palette files.

Regular yellow color - e2 dc 00 (R226, G220, B0)
Text shadow color - 5d 4e 0e (R93, G78, B14)
Light yellow color used in quest messages (""say"" command) - ff f6 67 (R255, G246, B103)

Unlike when testing FMAP_PAL.COL with the travel map, I couldn't see a difference in the game's colors from modiying these values in any of the .COL or .PAL files, so I don't know for 100% sure, but they are so close to the RGB values of the pixels seen when running in DOSBox that I think we can assume these are the values.

I tried to set these values for DF Unity. For some reason, though, the colors in-game don't match the RGB values I've set in the source code, though, and I have no idea why. My test case was using the tutorial quest and checking the font colors of the first two messages. The lighter-colored text completely loses its blue value even though it should have a blue of around 103.

Also, should I note the previous color values in a comment? Since they could be retrieved from the git history I don't suppose I need to."
119236728,Make cautious traveling arrive during daylight,Allofich,2017-05-05 18:50:49+00:00,2017-05-06 01:42:40+00:00,{},"With this PR the player will always arrive during daylight hours when using cautious travel, like Daggerfall classic.

From testing Daggerfall classic, I found that if the player's arrival would be between 6 p.m. and 6:10 a.m. it will be advanced to 6:10 a.m. This does the same for Daggerfall Unity."
118300329,Make Orsinium have dungeon music and lighting throughout,Allofich,2017-04-30 04:41:10+00:00,2017-05-01 00:53:30+00:00,{},"Daggerfall Unity used the castle music and lighting in Orsinium, until you got out of the first block and into the dungeon area. In classic, it has dungeon music and lighting throughout."
118271247,Fix gargoyle sounds,Allofich,2017-04-29 11:06:37+00:00,2017-05-01 00:33:30+00:00,{},"The gargoyle's attack sound was noted as missing, but actually it was being assigned to the orc shaman. For some reason, even though Daggerfall Jukebox will extract three sounds for the orc shaman, with the attack sound being identical to that of a regular orc (the files are identical), this index seems to be skipped over in Daggerfall Unity. I reassigned the orc shaman to use the regular orc's attack sound."
118269221,Changes for covens and poor homes,Allofich,2017-04-29 09:46:06+00:00,2017-04-30 01:07:51+00:00,{},"Categorizes covens as dungeons on the travel map, like Daggerfall classic. Also plays ""Dungeon Exterior"" music for covens and poor homes like Daggerfall classic."
117823347,support for texture arrays for terrain tiles,Nystul-the-Magician,2017-04-26 22:25:39+00:00,2017-04-27 06:39:53+00:00,{},"terrain now tries to use texture arrays (if system supports it, otherwise falls back to old approach)
- settings.ini file setting EnableTextureArrays = True added (set to False to force the use of old approach)

texture array usage has these advantages:
- no texture bleeding
- texture replacement with TheLacus mechanism (albedo, normal and metallicgloss map (last only used by reflection mod)) for textures with arbitrary sizes (all textures of an texture archive must have same dimensions and format)

new version of Distant Terrain mod (2.1.0) and Realtime Reflections mod (2.1.0) need to be used with this
to work correctly
"
117503241,Clock Resource & condition,Lypyl,2017-04-25 14:46:11+00:00,2017-04-25 23:02:48+00:00,{},"Added ClockAction class which is created by the Clock resource directly.  The basics of the clock resource are now working (see __Demo06 quest for example), though the flags & random range still need to be implemented."
117368553,ModSettings: presets,rossipaolo,2017-04-24 22:09:31+00:00,2017-04-25 23:03:10+00:00,{},"* Settings presets
* Do not close the window after reset"
117363441,"Mesh, Texture and Movies replacement: improvements",rossipaolo,2017-04-24 21:38:44+00:00,2017-04-25 23:04:26+00:00,{},"* Fix CHAR03I1.IMG size
* Import movies from mods
* Removed old code from MeshReplacement.
* MeshReplacement: get cached material instead of loading directly from
disk.
* TextureReplacement: Force normal and emission map if present on disk (like happens already with metallicgloss)
* Texture and Mesh replacement: use fixed size for archive (00X, 0XX or
XXX). Still uses the minimum number of digits for record and frame.
* Rename cif folder to CifRci and capitalize Img folder"
116658332,Updates to mod system,Lypyl,2017-04-19 22:51:06+00:00,2017-04-19 22:52:55+00:00,{},"
Added a simple message sending method to mod manager to allow mods to pass data

Further improvements to the mod builder window

Changed mod settings to look for mod title internally, and use the directory the mod file is in rather than the main mod path

Added GUID to ModInfo / Mod so modders"
116520527,added advanced settings option for setting shadow resolution mode,Nystul-the-Magician,2017-04-19 10:56:24+00:00,2017-04-19 22:53:23+00:00,{},"added advanced settings option for setting shadow resolution mode (modes are: low, medium, high, very high)

default mode is now medium resolution which should improve performance a lot for many systems"
116410450,TextureReplacement: Improvements,rossipaolo,2017-04-18 20:12:00+00:00,2017-04-19 22:52:25+00:00,{},"* save billboards material in cache for now, will get back to work on batch and atlas for the next build
* other minor improvements"
116213717,removed IncreasedTerrainDistance mod and ReflectionsMod,Nystul-the-Magician,2017-04-17 22:12:17+00:00,2017-04-17 22:41:24+00:00,{},"removed IncreasedTerrainDistance mod and ReflectionsMod
DaggerfallUnityGame.unity scene updated"
116045840,Updates the Mod creator window to make it more user friendly.,Lypyl,2017-04-16 02:14:15+00:00,2017-04-17 21:59:20+00:00,{},"It now remembers & automatically opens the last mod, as well as remembers the build directory so it only has to be set once

Adds visual seperators to make it easier to read"
116035940,Add EditorConfig,midopa,2017-04-15 19:21:17+00:00,2017-04-17 21:59:48+00:00,{},"EditorConfig (http://editorconfig.org/) is a simple, readable IDE/editor config file that makes certain style guides easy and automatically enforced. Things like tabs, newlines, etc. It's supported by several IDEs/editors (Atom, Rider to name a few). Visual Studio will need a plugin. I personally use Rider.

These configs are just my own preference. Feel free to rework to what you want the general style to be. I actually also like the `insert_final_newline` option, but it's more preference than anything. I think the actual reasons for that behavior/style are mostly antiquated now."
116035507,Brighter background for adv settings scrollbars,midopa,2017-04-15 19:05:12+00:00,2017-04-17 22:00:02+00:00,{},This makes it easier to see the visual limits in the UI.
115591999,ModSettings: fix button behaviour,rossipaolo,2017-04-12 17:12:58+00:00,2017-04-13 01:39:37+00:00,{},Get mod from title instead of current index
114996270,Mods: improvements,rossipaolo,2017-04-09 18:28:43+00:00,2017-04-10 01:51:47+00:00,{},"* Import models from mods instead of single assetbundles. This makes it easier to create, update and remove models packs.
* Fix some problems with panels and higher resolution textures.
* Settings button inside the ModLoaderWindow was wrongly  shown when there were no mods."
114956101,Improvements for mods,rossipaolo,2017-04-08 18:41:20+00:00,2017-04-08 23:23:40+00:00,{},"* (ModSettings window) Fixed bad alignment when the last object on the left column is a section and not a key.
* Added a method which allow mods to easily import textures from any path on disk."
114923684,Compute attacks from mouse gestures,midopa,2017-04-08 00:47:17+00:00,2017-04-10 01:51:40+00:00,{},"Revival of https://github.com/Interkarma/daggerfall-unity/pull/190

Mouse movement is now tracked as a gesture. The travel distance and final gesture vector is used to compute the angle of attack.

Practically, this doesn't feel much different from the original way of computing weapon attacks. Initially this was an attempt to get attacks working nicely on a trackpad, but after some thought I think the trackpad compatibility is more about tweaking the sensitivity and threshold values.

The advantage of this approach is gives a bit more control over how attacks can be initiated, how angles are computed, and gives a more natural abstraction of the user input to control (no longer have to maintain the same mouse direction over N frames/cycles)."
114009361,ModSettings: More changes,rossipaolo,2017-04-03 19:55:35+00:00,2017-04-04 22:19:58+00:00,{},"* Use comments as tooltips
* Use a fixed section to hide the most advanced settings from the GUI
* Use a version number to decide if preserve settings from the previous version of the mod or recreate them
* code organization"
113714372,Add ModSettings window,rossipaolo,2017-03-31 19:14:20+00:00,2017-04-01 23:40:37+00:00,{},
113433365,exterior automap - building nameplates collision detection and offsetting,Nystul-the-Magician,2017-03-30 13:52:01+00:00,2017-03-30 22:32:28+00:00,{},"exterior automap changes
- building nameplates collision detection and offsetting
- * nameplates with tooltip/pop-up on mouse over
- use of yellow color font
correction of window resize bug on interior and exterior automap

added property AutomapWindow and ExteriorAutomapWindow to  Assets/Scripts/Game/DaggerfallUI.cs 
"
112611596,Updates to DaggerfallBankManager & DaggerfallBankWindow,Lypyl,2017-03-26 02:31:43+00:00,2017-03-27 05:52:07+00:00,{},
112602424,Improvements in modding support,rossipaolo,2017-03-25 20:57:18+00:00,2017-03-25 23:04:02+00:00,{},"* Changes in mesh replacement
* Get UV for billboards
* use ogg for songs"
111733627,exterior automap - building names integration,Nystul-the-Magician,2017-03-21 09:26:03+00:00,2017-03-21 09:45:01+00:00,{},"excellent work of yours interkarma! just had to plug it in.
"
111460850,Add support for import of custom videos,rossipaolo,2017-03-19 18:10:09+00:00,2017-03-20 12:44:50+00:00,{},
111391114,Added items table & started on implementing quest item resource,Lypyl,2017-03-18 01:30:13+00:00,2017-03-18 02:32:05+00:00,{},
111364997,Various improvements on graphical and sound modding.,rossipaolo,2017-03-17 21:01:09+00:00,2017-03-17 23:09:18+00:00,{},"* Import .wav files for songsplayer. This means players can place correctly-named digital music files inside the sound folder and these will be played in the game without any technical knowledge required.
* Import MetalGloss textures and read Metallic/Smoothing parameters from xml.
* Improvements on TextureReplacement and XMLManager classes."
110825469,"automap - default rendermode dep. on building/dungeon,double-click left/right/middle",Nystul-the-Magician,2017-03-15 11:42:33+00:00,2017-03-16 07:33:01+00:00,{},"default automap render mode (automap opened for new location) is now dependent on if player is inside building or dungeon/palace:

building: cutout
dungeon/palace: transparent

this is done because: in buildings higher level floors easily distract when viewing the interior map, in dungeons people that don't know all the functions of the map often think the map is bugged when they don't see geometry above the slice level (I watched several youtube videos with confused people)

double click on left mouse button now switches between beacons
double click on right mouse button now resets view
double click on middle mouse button now switches rendering modes"
110825115,"default rendermode dep. on building/dungeon,double-click left/right",Nystul-the-Magician,2017-03-15 11:40:08+00:00,2017-03-15 11:41:53+00:00,{},"default automap render mode (automap opened for new location) is now dependent on if player is inside building or dungeon/palace:

building: cutout
dungeon/palace: transparent

this is done because: in buildings higher level floors easily distract when viewing the interior map, in dungeons people that don't know all the functions of the map often think the map is bugged when they don't see geometry above the slice level (I watched several youtube videos with confused people)

double click on left mouse button now switches between beacons
double click on right mouse button now resets view
double click on middle mouse button now switches rendering modes"
110757163,Adding play video quest action,Lypyl,2017-03-15 02:27:28+00:00,2017-03-15 02:54:45+00:00,{},
110453872,"Adding StopClock, StartClock, and remove LogMessage",Lypyl,2017-03-13 17:15:07+00:00,2017-03-13 21:37:09+00:00,{},"
Clock - stubbed StartClock and StopClock methods

Quest - added GetClock method
"
110327828,Implementing the basics for the quest journal ui window,Lypyl,2017-03-13 02:01:54+00:00,2017-03-13 02:38:52+00:00,{},
110288103,Adding PickRandomTask quest action & changes to quest system,Lypyl,2017-03-12 06:26:01+00:00,2017-03-12 20:58:24+00:00,{},"ClearTask - updated pattern

Parser - updated ParseQrc to work with quest log entry Qrc records

Quest - fixed bug that caused GetLogMessages() to only return 1 message

QuestMachine - Added GetAllQuestLogMessages()"
110259792,Mesh and Texture replacement: minor changes,rossipaolo,2017-03-11 13:37:11+00:00,2017-03-11 22:48:13+00:00,{},
110216662,Removes RealGrass and GrassAndPlants,rossipaolo,2017-03-10 21:54:04+00:00,2017-03-11 01:13:03+00:00,{},Removes grass mods as they are been released as independent mods.
110203023,Adding quest actions & startquest console commands,Lypyl,2017-03-10 20:26:17+00:00,2017-03-10 20:45:02+00:00,{},"Adds the following actions:

PlaySound

LogMessage

ClearTask

and the startquest console command"
109186422,Adding Bank Manager and Bank UI Window,Lypyl,2017-03-06 03:58:04+00:00,2017-03-07 07:43:46+00:00,{},"Bank data is now read from classic saves, and saved & loaded in Daggerfall Unity saves. Existing saves will still work like normal.

Basic functionality for the Bank window UI is implemented.

Added console command showbankwindow "
108995967,Add Advanced Settings Window,rossipaolo,2017-03-03 15:32:52+00:00,2017-03-05 22:17:41+00:00,{},"Add a new window in the main menu with several settings, which could
only be changed editing directly the .ini."
108943697,automap - slice level can now be adjusted with middle mouse button,Nystul-the-Magician,2017-03-03 10:17:39+00:00,2017-03-05 22:17:53+00:00,{},"interior automap (DaggerfallAutomapWindow.cs) - slice level can now be adjusted with middle mouse button:
hold down middle mouse button over main panel and move up/down to adjust the slice level

BaseScreenComponent.cs:
support for middle mouse button added, right mouse double-click added"
108925412,Changes to SpellRecord & Added DaggerfallSpellReader,Lypyl,2017-03-03 08:12:40+00:00,2017-03-05 22:16:59+00:00,{},"DaggerfallSpellReader -  can parse a SPELLS.STD file or spell records from SAVETREE.DAT

Spellrecord - Added SpellRecordData & EffectRecordData for storing raw spell data, and ReadNativeSpellData() which uses DaggerfallSpellReader.ReadSpellData()"
108300019,Checking in spellbook ui window & spell merchant ui window,Lypyl,2017-02-28 10:26:33+00:00,2017-03-02 21:37:24+00:00,{},
108019313,Mesh and Texture replacement - More changes,rossipaolo,2017-02-26 20:03:34+00:00,2017-02-27 00:34:12+00:00,{},"* Minor changes for exteriors billboards.
* Minor changes in RDB and code organization
* Models that replace billboards have a random rotation. This should be particularly useful for trees, as they look more natural and not all facing the same direction. I used a value from Position as seed so the rotation is always the same."
108004720,Changes to the DaggerfallTravelMapWindow,Lypyl,2017-02-26 13:28:54+00:00,2017-02-27 00:33:33+00:00,{},"overhauled & simplified the rendering process

Added zoom functionality

Replaced filter & arrow button handler functions"
107980719,Mesh and Texture replacement - Custom textures in towns exteriors,rossipaolo,2017-02-25 22:50:55+00:00,2017-02-26 00:52:58+00:00,{},
107956721,AllowNormal.mat,rossipaolo,2017-02-25 10:51:49+00:00,2017-02-25 11:45:59+00:00,{},
107919083,"Mesh, Texture and Sound Replacement - Minor changes",rossipaolo,2017-02-24 22:14:15+00:00,2017-02-24 23:43:12+00:00,{},"* Code organization
* Removed legacy method"
107794041,Removes Enhanced Sky,Lypyl,2017-02-24 09:26:20+00:00,2017-02-24 23:42:20+00:00,{},Removes the enhanced sky mod from project (so it can be converted to use the mod system).  
107708533,Sound Replacement - Songs,rossipaolo,2017-02-23 20:42:24+00:00,2017-02-23 22:14:56+00:00,{},
107482376,Sound replacement,rossipaolo,2017-02-22 19:40:03+00:00,2017-02-22 22:39:50+00:00,{},Import custom .wav audioclips from _StreamingAssets/Sound_.
107100475,Changes to Nystul's IncreasedTerrainDistance,Lypyl,2017-02-21 01:29:06+00:00,2017-02-22 22:38:49+00:00,{},"Removes all references to the Enhanced Sky mod from the IncreasedTerrainDistance, and a bug fix for the Mod class"
107077395,Mesh and Texture replacement - Weapons,rossipaolo,2017-02-20 21:16:07+00:00,2017-02-20 22:37:06+00:00,{},"Import textures for first person weapons, different for each kind of metal."
106824483,Mesh and Texture replacement - billboard-->model rotation,rossipaolo,2017-02-17 22:29:02+00:00,2017-02-19 07:09:49+00:00,{},"A script for objects that are hanged to walls, like wall torches. 
Let me know if i should place it somewhere else.

rotation:
http://i.imgur.com/HJWWzGT.png

alignToWall:
http://i.imgur.com/DBQPwwD.png"
106464167,Mod System update,Lypyl,2017-02-16 06:42:19+00:00,2017-02-17 02:58:55+00:00,{},"Changes to the mod system, including:

1. Custom components on prefabs that implement the idfmod_Serializable interface will have serialized data saved in the asset bundle

2. Prefabs can now be setup w/ the serialized file mentioned previously during setup

3. ModManager can now save / load mod settings (specifically enabled bool & load priority settings) to json so the user doesn't have to set these manually every time."
105881127,Mesh and Texture replacement - Enemies,rossipaolo,2017-02-13 12:08:45+00:00,2017-02-15 13:39:13+00:00,{},
105790327,Mesh and Texture replacement - more on textures,rossipaolo,2017-02-12 12:57:58+00:00,2017-02-12 20:50:21+00:00,{},"* Set optional custom size of billboards
*  Cleanup"
105767004,Mesh and Texture replacement - fix position inside dungeons,rossipaolo,2017-02-11 20:37:51+00:00,2017-02-12 02:19:49+00:00,{},
105564044,Merging keybind-ui branch,Interkarma,2017-02-10 04:20:21+00:00,2017-02-10 04:20:27+00:00,{},
105143091,Update from Master,jst1526,2017-02-08 03:34:18+00:00,2017-02-08 03:34:29+00:00,{},
105045497,Fix songs not repeating,Allofich,2017-02-07 16:45:10+00:00,2017-02-08 00:21:13+00:00,{},"Fixes the problem of songs not repeating, mentioned here
http://forums.dfworkshop.net/viewtopic.php?f=24&t=423. I don't know anything about the crash mentioned there.

I don't know the whole path of execution, but when songs were stopping, it looks like PlayCurrentSong() was called from Update() in SongManager, then PlayCurrentSong() was returning immediately because the `songPlayer.Song == currentSong` condition was true, even though the song had stopped playing. I added a check for `songPlayer.IsPlaying,` and this fixed the problem.

Adding this check caused a stutter in the music when loading a new context, though. Apparently IsPlaying wasn't being updated quickly enough, so `(songPlayer.Song == currentSong && songPlayer.IsPlaying)` would evaluate to false and the song would restart once. I made Play() in DaggerfallSongPlayer, which gets called before the end of PlayCurrentSong(), update IsPlaying to true, and this fixed the stutter. "
105028371,Update songplayer prefab,Allofich,2017-02-07 15:28:42+00:00,2017-02-08 00:21:33+00:00,{},"The playlists in the songplayer prefab for dungeon interiors and generic palaces were not updated earlier, so this updates them."
104946340,Completed keyboard bindings and reset defaults,jst1526,2017-02-07 06:47:46+00:00,2017-02-08 00:23:51+00:00,{},"- Set and save keyboard bindings fully functional
- Can no longer exit with invalid configuration. Duplicates are
highlighted and popups prevent closing window
- Defaults tab button returns keys to DFUnity defaults

Couldn't find the ""you have multiple assignments..."" message in the text.rsc dump. Probably a hard string, but it's not in our HardStrings class yet so I just added it manually for the moment."
104873787,Mesh and Texture replacement - Import rect sizes from xml files,rossipaolo,2017-02-06 20:18:12+00:00,2017-02-08 00:22:40+00:00,{},"Allow higher resolution textures for certain UI elements, using xml files to get rect size. This also means that user can customize these values, for example to change the size of the compass on screen."
104727068,Change and save controls through classic interface,jst1526,2017-02-06 02:18:02+00:00,2017-02-06 07:32:40+00:00,{},"Keyboard keys can now be changed and saved through the classic interface. Mouse, joystick, and set default button not implemented yet. Currently there is nothing preventing the player from setting duplicate keybinds, but the old keybind is removed and only the new keybind is applied. 

If the game is closed with an invalid key configuration (duplicate or empty keybind), the controls will reset to default when the game is restarted. Valid configurations are saved between restarts."
104585350,Mesh and Texture replacement - More on assetbundle,rossipaolo,2017-02-03 18:20:54+00:00,2017-02-03 23:18:49+00:00,{},"* More on AssetBundle import
* It's now possible to import models from more AssetBundles.  It's a
simple method for now which uses a little assetbundle for each model
(ID.model or Archive_Texture.flat for billboards), so it shouldn't
impact loading times too much.
* Textures, Models and Flats folders are now in StreamingAssetPath
* Moved option in main menu with the other settings"
104483959,Controls,jst1526,2017-02-03 06:52:27+00:00,2017-02-03 23:17:58+00:00,{},"Wired up keybinds, mouse control, and joystick control windows"
104229552,Mesh and Texture replacement - Preliminary support for AssetBundles,rossipaolo,2017-02-01 21:49:51+00:00,2017-02-02 21:24:52+00:00,{},"I started looking into Lypyl awesome work on mods support to see if i
can get a real-time import of meshes using assetbundles. This is very
WIP and it uses only a single mod package, but it does its job for now."
104015495,GrassAndPlants - Improvements,rossipaolo,2017-01-31 20:23:27+00:00,2017-02-01 12:44:18+00:00,{},
103617997,Mesh and Texture replacement - texture consistency between models,rossipaolo,2017-01-28 17:28:34+00:00,2017-01-29 23:14:25+00:00,{},"Right now model import and texture import are completely separated,
which means that if a user install some replacement for vanilla textures
these are applied only on vanilla models, and not on custom models which
use these same textures.  This commit bring some modularity as the
'textures' folder on disk available to players is now used for a global
injection, so custom and vanilla assets should blend nice together no
matter which custom textures are used. This should be especially useful
for the most vanilla-friendly models. It can also be used to import
optional bump maps where the original materials doesn't have them."
103540125,Read gender of human enemies and allow unspecified to be female,Allofich,2017-01-27 18:15:37+00:00,2017-01-29 23:13:31+00:00,{},"Enemies with a set gender, like in the castles, will be set according to it.

Also fixes the issue that `DFRandom.random_range` in `DaggerfallMobileUnit.cs` was always choosing 0 because it is exclusive of the maximum, so enemies with unspecified gender were always being male."
103472153,Implement travel costs,Allofich,2017-01-27 10:57:47+00:00,2017-01-29 23:12:34+00:00,{},"What this PR does:

1. Available gold is displayed when fast traveling, and is removed after travel. If the player doesn't have enough, the ""You do not have enough gold."" popup shows.

2. Tried to recreate the cost calculations of classic Daggerfall. It should be basically correct. The calculations for the amount of time are producing different results from classic, though, so the resulting costs are also different. For one thing, inland lakes or relatively short trips across bays don't cause ship travel while they do in classic Daggerfall. I looked and no ""ocean"" terrains were being processed in this case.

3. Implemented healing for cautious travel.

4. Set the modifier for ship travel based on some limited testing in classic Daggerfall.

5. Changed the ""Do you wish to travel to"" popup to not show when you click on a location, same as in classic Daggerfall."
103101500,exterior automap gameobject is now correctly hidden when inside,Nystul-the-Magician,2017-01-25 11:32:50+00:00,2017-01-26 22:36:17+00:00,{},"exterior automap gameobject is now correctly hidden via SetActive(false) function and shown via SetActive(true) function when going indoors resp. outdoors
this will fix a bug which can be seen in youtube video (https://www.youtube.com/watch?v=ANNVZfJqk48) minutes:seconds 14:52"
102130738,Mesh and Texture replacement - Move to own folder,rossipaolo,2017-01-18 19:16:51+00:00,2017-01-21 00:49:08+00:00,{},
102092603,GrassAndPlants,rossipaolo,2017-01-18 15:52:56+00:00,2017-01-18 22:40:37+00:00,{},"This is the mod i have showed on the forum a while back, which adds water plants near water tiles.
To keep intact the original mod for people who prefer to have only the grass, i placed all the new assets in a different folder with its own script. 
Players can choose on the main menu if they prefer Uncanny_Valley's mod as it is now or this version with plants.  Let me know if it's ok implemented this way, and thank you for all the support you give to modders :)"
101703236,fixed broken fog,Nystul-the-Magician,2017-01-16 14:48:31+00:00,2017-01-17 05:00:54+00:00,{},"some recent changes to WeatherManager broke the camera fog (the kind of fog one will always want even on a sunny day).

don't disable RenderSettingsFog! Rendering Fog != Weather Fog

to see the broken fog: uncomment the line that is now commented out (and should finally be removed), go to privateer's hold (outside) on a sunny day with all mods disabled and see that there is no transition from foreground to background - this is wrong
"
101592631,Move damage and healing rate formulas to helper,Allofich,2017-01-15 11:27:12+00:00,2017-01-17 05:02:37+00:00,{},"I had completely overlooked the existence of the formula helper before. I moved the previous work on damage and rest calculations to it.

There are some organizational things here I'm not sure about, like which formulas should go into the ""player"" region and which the ""basic"" region, or whether it is a good idea to use the player entity as a parameter for damage calculation."
101590247,Don't choose a new song for the same playlist,Allofich,2017-01-15 09:34:17+00:00,2017-01-17 05:01:54+00:00,{},"New songs are being chosen when switching between contexts with the same playlist (e.g. going from dungeon exterior at night to wilderness area at night, or weather changing at night). This is not what happens in classic, and this PR prevents it.

I noticed something when testing this. For some reason, the area just outside Privateer's Hold is being classified as ""Wilderness"" instead of ""DungeonExterior."" If you walk away from the entrance to the west somewhat, you'll enter a DungeonExterior area, and going farther away will put you in the wider Wilderness area. A couple other dungeons I looked at, including the same class of dungeon as Privateer's Hold, didn't seem to have this problem.

Edit: Accidentally added a heart emoji for my own message, lol. Oh well."
101561980,Recreate classic Daggerfall's music playlists,Allofich,2017-01-14 13:54:48+00:00,2017-01-15 00:22:08+00:00,{},"This recreates the music playlists of classic Daggerfall, based on what look like playlists in FALL.EXE. In-game testing seems to confirm it.

Also I renamed references to ""palace"" throughout the code with ""castle."" In classic Daggerfall, the rulers' structures in Daggerfall, Wayrest and Sentinel are all called ""-- Castle"" on the automap, while the ones for minor rulers in other places are called ""Palace."" I think this also is consistent with the text of quests that send you to palaces. The only inconsistency I saw is that the castle music is called ""gpalac.""

Some things remain to be done. One is that ""palaces"" are insisting on playing the ""castle"" music for some reason. I can't figure this out, and I'm asking for your help Interkarma if you know what's going on. It seems to be bypassing the playlists, because even if I remove or replace the ""gpalac"" music from the playlists it is still played.

Also currently all guilds play mage's guild music. The guild's besides the mage's guild should all be the standard ""interior"" music, I think.

"
101554591,Don't play sound or hit effect for 0 damage hits,Allofich,2017-01-14 08:14:02+00:00,2017-01-15 00:21:52+00:00,{},Imitates classic Daggerfall behavior. Also removed a debug comment I accidentally left in.
101488622,Mesh and Texture replacement - animated billboards,rossipaolo,2017-01-13 17:55:07+00:00,2017-01-14 05:01:54+00:00,{},"I enabled import of custom textures for statics billboards in interiors a few days ago, now this introduce support for animations, too.

The user can import any number of texture to be used as frames, independently from the original number used in Daggerfall, and it is possible to import emission maps, which i see it could be pretty useful for texture artists.
https://i.imgur.com/G5bn52P.png

I haven't enabled import of normal maps instead, because i'm not sure how they could be of any help for sprites. Do you think i should do it?

It's to note that textures are placed on original billboard meshes so they look fine as long as they have the same proportions as originals. Maybe in the future we can provide even more possibility of customization using XML files as you suggested and creating custom gameobjects."
100947555,Mesh and Texture replacement - check integrity of materials,rossipaolo,2017-01-10 20:27:59+00:00,2017-01-12 00:59:58+00:00,{},"* Avoid assigning filtermode in case of a missing material or texture,
which would cause a NullReferenceException and consequently would break
the entire placement of models in the given area.

* Minor changes to organization of code."
100459753,add calculations for weapon damage,Ezren,2017-01-06 13:35:03+00:00,2017-01-07 02:45:44+00:00,{}," - Adds the formulas for weapon damage
 - Adds helper methods to get modifiers for swing direction and weapon material
 - Adds weapon damage range to the weapon object"
100410871,Fix fast weather switching,midopa,2017-01-06 05:11:52+00:00,2017-01-06 05:49:58+00:00,{},"If the field is public, it gets set to 4s for some reason. Nothing in the code directly accessed this so it seems to be something Unity is doing."
100387372,Chronicles weather,Interkarma,2017-01-05 23:58:22+00:00,2017-01-05 23:58:28+00:00,{},
100386849,Update to current master,Interkarma,2017-01-05 23:53:16+00:00,2017-01-06 00:19:55+00:00,{},
100357411,Mesh and Texture replacement - add sprites replacement,rossipaolo,2017-01-05 20:23:44+00:00,2017-01-05 23:50:44+00:00,{},"Basic texture replacement for billboards. For now works only in interiors and dungeons with
non-animated billboards."
100300476,Implement stat-based health restoration on rest,Allofich,2017-01-05 14:39:25+00:00,2017-01-05 23:51:14+00:00,{},"Implements stat-based health restoration when resting, based on http://forums.dfworkshop.net/viewtopic.php?f=4&t=270 and my own testing. I get the expected health restoration amount for all my test cases and all of those in the thread.

I found what looks like a bug in original Daggerfall. The research thread I linked to says the negative endurance modifier is limited to -4, but what really happens is negative modifiers are treated as modifer + 1. So a -1 modifier is the same as a 0 modifier, a -5 modifier is treated like a -4 modifier, etc. I decided to use the correct value since this looks like a bug rather than a design decision."
100189502,Mesh and Texture replacement - PaperDoll background image,rossipaolo,2017-01-04 21:13:09+00:00,2017-01-05 23:51:52+00:00,{},
100114094,Implement stat-based player hand-to-hand damage,Allofich,2017-01-04 13:21:29+00:00,2017-01-05 23:52:29+00:00,{},"Simply implements hand-to-hand damage based on what the Daggerfall Chronicles says. I also did some quick testing in original Daggerfall and there was no difference in the number of hand-to-hand hits it took to kill an enemy with an up-to-down hit and a down-to-up hit, so I think all hand-to-hand hits might be the same."
99880082,Mesh and Texture replacement - Add support for custom prefabs in RDB/RMB,rossipaolo,2017-01-02 17:07:45+00:00,2017-01-05 23:51:30+00:00,{},
99469719,Mesh and Texture replacement - Add Flat --> 3d Model replacement in RDB/RMB,rossipaolo,2016-12-27 18:06:52+00:00,2016-12-30 23:24:32+00:00,{},Replace billboards with custom prefabs in dungeons/outdoor
99315569,Use weather table from Daggerfall Chronicles,midopa,2016-12-25 04:32:19+00:00,2016-12-27 00:31:54+00:00,{},"Weather is loaded from a JSON table based on the table in Chronicles (pg.49).

Currently weather is determined randomly. This is a bit jarring, however. It's possible to go from snowing to sunny with no transition. Marking it as a TODO to handle smoother/believable weather transitions.

Also added fog to the possible weather states."
99298893,Compute attacks from mouse gestures,midopa,2016-12-24 08:47:38+00:00,2016-12-27 00:33:48+00:00,{},"Mouse movement is now tracked as a gesture. The travel distance and final gesture vector is used to compute the angle of attack.

Practically, this doesn't feel much different from the original way of computing weapon attacks. Initially this was an attempt to get attacks working nicely on a trackpad, but after some thought I think the trackpad compatibility is more about tweaking the sensitivity and threshold values.

The advantage of this approach is gives a bit more control over how attacks can be initiated, how angles are computed, and gives a more natural abstraction of the user input to control (no longer have to maintain the same mouse direction over N frames/cycles)."
99274568,Mesh and Texture replacement - Add support for normal maps,rossipaolo,2016-12-23 19:23:40+00:00,2016-12-24 05:44:06+00:00,{},Enable import of normal maps along with custom textures.
99186914,Merging save-weather branch,Interkarma,2016-12-22 23:45:14+00:00,2016-12-22 23:45:18+00:00,{},Current weather conditions are now saved with game. Credit to midopa.
99186789,Updating to current master,Interkarma,2016-12-22 23:43:40+00:00,2016-12-22 23:43:46+00:00,{},
99186728,Merging combat-bow branch,Interkarma,2016-12-22 23:42:55+00:00,2016-12-22 23:42:59+00:00,{},This adds basic bow combat by electrorobobody.
99185645,Updating to current master,Interkarma,2016-12-22 23:29:28+00:00,2016-12-22 23:29:36+00:00,{},
99185112,Merging asset-injection branch,Interkarma,2016-12-22 23:23:07+00:00,2016-12-22 23:23:13+00:00,{},"This PR adds early support for texture and model replacement at runtime.
Credit to TheLacus for maintaining code and creating PR, and Uncanny_Valley for initial framework."
99184719,Updating to current master,Interkarma,2016-12-22 23:18:38+00:00,2016-12-22 23:18:43+00:00,{},
98876962,Remove old meta file,midopa,2016-12-21 06:03:11+00:00,2016-12-22 23:09:54+00:00,{},Looks like the Addons folder was removed a while ago
98876132,Fix no grass clearing,midopa,2016-12-21 05:52:57+00:00,2016-12-22 23:08:39+00:00,{},Grass generated from a previous area wasn't being cleared when the player travels to a non-grass area (season or climate).
98856766,Merging rat-stacks to master,Interkarma,2016-12-21 01:29:45+00:00,2016-12-21 01:29:52+00:00,{},
98854416,Updating to current master,Interkarma,2016-12-21 01:03:12+00:00,2016-12-21 01:03:35+00:00,{},
98854355,Updating to current master,Interkarma,2016-12-21 01:02:38+00:00,2016-12-21 01:02:43+00:00,{},
98854310,Updating to current master,Interkarma,2016-12-21 01:02:01+00:00,2016-12-21 01:02:07+00:00,{},
98777527,Mesh and Texture replacement - Add initial support,rossipaolo,2016-12-20 16:10:10+00:00,2016-12-21 01:50:37+00:00,{},"Mesh replacement 
-------------------
(by Uncanny_Valley)
Enable replacement of vanilla 3d models with custom meshes, and flats with custom prefabs.
Models and respective materials need to be placed in Resources during compile.

Texture replacement
----------------------
Enable real-time import of custom textures and images.
* textures for (vanilla) models:
_archive_record-frame.png_ (ex: 9_1-0.png) -and, if necessary, _archive_record-frame_Emission.png_- in
Application.persistentDataPath/textures
* .IMGs:
_imagefile.png_ (ex: REST02I0.IMG.png) in
Application.persistentDataPath/textures/img
* .CIFs and .RCIs:
_CifFile_record-frame.png_ (ex: INVE16I0.CIF_1-0.png) in
Application.persistentDataPath/textures/cif"
98491572,Save weather,midopa,2016-12-18 23:15:26+00:00,2016-12-19 06:59:51+00:00,{},Continuation of #174 
98489950,Save and load weather,midopa,2016-12-18 22:26:07+00:00,2016-12-18 22:39:10+00:00,{},Plus some cleanup (from default Rider IDE suggestions)
98467370,More natural looking grass,midopa,2016-12-18 07:34:48+00:00,2016-12-18 10:52:28+00:00,{},"Grass felt a little sparse and uniform. The main change was adding ranges to the grass width/heights so Unity will generate some more variety in grass patches. The values were tweaked to make the grass look a little more lush and varied.

The grass billboard counts for thick/sparse patches were also tweaked. There'd be grass ""walls"" where the grass patches stop, which looked odd. So the sparse patches are even sparser and can even be empty, which gives a more natural, decreasing, scattered look near non-grass terrain.

`AddGrass` stop watch times at an outdoor location:
* Original: 2.5 - 4.4 ms
* Change: 3.5 - 6.8 ms

This is approximate from eye-balling the log output after loading my save state.

Also refactoring, cleanup, comments.

Screenshot before:
<img width=""847"" alt=""screen shot 2016-12-17 at 11 18 08 pm"" src=""https://cloud.githubusercontent.com/assets/1522141/21292197/0d676716-c4b1-11e6-8a81-565c78fd8c10.png"">

Screenshot after:
<img width=""851"" alt=""screen shot 2016-12-17 at 11 39 50 pm"" src=""https://cloud.githubusercontent.com/assets/1522141/21292225/26704e3e-c4b2-11e6-964b-d84176883a2d.png"">"
97889487,Fix Unity compile warnings,midopa,2016-12-14 05:24:39+00:00,2016-12-18 10:52:41+00:00,{},
97683252,Fix errors when rendering during winter,midopa,2016-12-13 04:06:27+00:00,2016-12-14 06:09:54+00:00,{},"Console got a bunch of error messages when I exited the starting dungeon during winter.

It's a grassy climate, but there should be no grass because it's winter. But the code was trying to set the grass texture details (probably with garbage/invalid data). Since grass isn't present during winter, don't try to set texture details.

Original error message:
```
Detail index out of bounds in DetailDatabase.SetLayers
UnityEngine.TerrainData:SetDetailLayer(Int32, Int32, Int32, Int32[,])
DaggerfallWorkshop.Game.RealGrass:AddGrass(DaggerfallTerrain, TerrainData) (at Assets/Game/Addons/RealGrass/RealGrass.cs:245)
DaggerfallWorkshop.DaggerfallTerrain:RaiseOnPromoteTerrainDataEvent(TerrainData) (at Assets/Scripts/Terrain/DaggerfallTerrain.cs:343)
DaggerfallWorkshop.DaggerfallTerrain:PromoteTerrainData() (at Assets/Scripts/Terrain/DaggerfallTerrain.cs:257)
ProjectIncreasedTerrainDistance.IncreasedTerrainDistance:UpdateTerrainDataTransitionRing(TransitionTerrainDesc) (at Assets/Game/Addons/IncreasedTerrainDistanceMod/Scripts/IncreasedTerrainDistance.cs:1282)
ProjectIncreasedTerrainDistance.IncreasedTerrainDistance:PlaceTerrainOfTransitionRing(Int32) (at Assets/Game/Addons/IncreasedTerrainDistanceMod/Scripts/IncreasedTerrainDistance.cs:1426)
ProjectIncreasedTerrainDistance.<UpdateTerrainsTransitionRing>c__Iterator0:MoveNext() (at Assets/Game/Addons/IncreasedTerrainDistanceMod/Scripts/IncreasedTerrainDistance.cs:1537)
```"
97477827,Prevent Rat Stacks,midopa,2016-12-11 23:22:09+00:00,2016-12-14 06:07:59+00:00,{},"This isn't a perfect solution, but I figured I'd put it up and see if anyone else has ideas on how to solve this in a simple, elegant manner (without using NavMeshes because I'm not sure if that should be introduced at this stage of development).

In the original game, enemies could overlap if they got close to you. But I assume that isn't the desired behavior for Daggerfall Unity."
97470238,Add shortcut keys on the start window,midopa,2016-12-11 19:54:33+00:00,2016-12-11 23:14:09+00:00,{},
97450628,Don't treat enemies as moving platforms,midopa,2016-12-11 07:01:15+00:00,2016-12-11 23:14:19+00:00,{},"If we stand just right on an enemy, the player camera will get unstable. This still allows use to stand on an enemy, however."
97450347,Add some autogen files to gitignore,midopa,2016-12-11 06:45:29+00:00,2016-12-11 23:14:56+00:00,{},
96512622,Exterior automap,Nystul-the-Magician,2016-12-05 11:34:13+00:00,2016-12-06 08:59:28+00:00,{},"improvements and fixes to exterior automap
- introduced building nameplates (currently shop type is used instead of building name)
- walking to new locations works now correctly with exterior automap
- camera rotation and zoom settings are remembered and restored now when closing and reopening exterior automap while in a location (resets on new location)
- resources will be now loaded only on demand
- location layout is now only generated once - when the automap is opened for the first time for the current location
"
96455536,Potion recipe viewer,InconsolableCellist,2016-12-05 00:50:56+00:00,2016-12-05 07:18:51+00:00,{},"Implements the potion recipe viewer so that the user can click ""INFO"" in the inventory window and read their potion recipes."
96428953,Differentiate between unarmed hit sounds and weapon hit sounds,Allofich,2016-12-04 11:00:31+00:00,2016-12-05 07:17:25+00:00,{},"After some testing in Daggerfall, I found that unarmed hits, including those as a werecreature, only play two of the possible hit sounds. Weapons seem to play all of them.

I made sure by using the program DaggerSound to replace the hit sounds with ones that were easy to tell apart. This made it obvious that only the 3rd and 4th of the 5 possible hit sounds play for unarmed hits.

This is also true for enemy hits. Unarmed enemies only play those same two hit sounds, while enemies with weapons play all of them. This PR only affects the sounds for when the player hits an enemy.
"
95401087,Use palette file for travel map location colors,Allofich,2016-11-27 12:19:39+00:00,2016-11-29 23:25:09+00:00,{},"This makes the colors for location pixels and the identify flash be pulled from the FMAP_PAL.COL file, like they are in original Daggerfall. I checked the indexes that are used by hex-editing the palette file and watching which ones changed the colors in the original game. I put the RGB values that are read from the file in comments.

With this PR the RGB values will be exactly what they are defined as in the palette file. I can't really tell a difference in the colors that were being used and these colors, but they are slightly different if you look at the rgb values of the pixels. The rgb values of the pixels in DOSBox are slightly different from both of these, and change slightly depending on what you select for ""output"" in the DOSBox configuration file, or whether you use emulated vga or svga. No matter what settings I tried I couldn't get DOSBox to show the exact rgb values that are defined in the palette file. I'm no expert on this stuff, and I don't know what the most ""correct"" values are, but I would assume them to be the ones in the palette file... Is that how you are using palette data elsewhere?

Well it's not a big deal, but I figure we might as well pull from the original data, unless you would rather not. At any rate, it was kind of fun just figuring out where Daggerfall gets the data."
95364394,Basic bow combat implemented,electrorobobody,2016-11-26 07:46:49+00:00,2016-11-29 23:31:38+00:00,{},Bows can be used now
95336923,Allow return key and keypad enter key to close message boxes,Allofich,2016-11-25 18:06:06+00:00,2016-11-26 02:19:08+00:00,{},"Edit: I had a few other changes but I decided I want to reconsider them. I left this one in that I felt was probably worthwhile. It's possible in original Daggerfall to close message windows with the big enter key and the little enter key on the keypad, which in the unity engine means the `Return` KeyCode and the `KeypadEnter` KeyCode."
94993512,Make misc skills display alignment match classic,Allofich,2016-11-23 12:25:39+00:00,2016-11-24 21:54:15+00:00,{},"Does as the title says. I used the positioning token for this, as it seemed well-suited for it.

As far as I know, all the message windows currently in Daggerfall Unity should be aligned like original Daggerfall now."
94805749,Changes to starting clothing to match Daggerfall,Allofich,2016-11-22 12:38:14+00:00,2016-11-22 22:02:15+00:00,{},Just a few minor changes to make the starting clothing match with Daggerfall.
94536469,Merging ui-updates branch,Interkarma,2016-11-20 22:54:29+00:00,2016-11-20 22:54:34+00:00,{},
94500027,Merging book updates to master,Interkarma,2016-11-19 23:27:43+00:00,2016-11-19 23:27:47+00:00,{},
94495769,Position buttons to be correct distance below text,Allofich,2016-11-19 21:13:29+00:00,2016-11-19 23:18:01+00:00,{},"I finally figured out how to get buttons showing at buttonTextDistance (4 pixels) below the text in message boxes.

All that is left right now as far as positioning things is the misc skills. Interkarma do you have any advice about how that should be done?"
94185913,Identify more sound effects,Allofich,2016-11-17 15:12:49+00:00,2016-11-19 14:16:18+00:00,{},"More sounds identified, mostly monster sounds from Arena.

I also labeled a couple Daggerfall sounds, namely the body collapse sound when you kill an enemy, and the player death sound."
93979044,Various changes to make UI text positioning more like original Daggerfall,Allofich,2016-11-16 14:48:14+00:00,2016-11-16 22:37:36+00:00,{},"Here are various changes to make the UI text look more like original Daggerfall. Everything in the UI windows I worked on should be positioned like Daggerfall now except for buttons, which are still at the bottom of the window as before this PR, and the items in the misc skills window.

I'll go through the changes here.

1. Skills windows were changed to match what I saw in original Daggerfall, using tabs and no spaces. Tabs of 35 spaces are used, not 45.

2. I determined through experimentation that having a text entry that ends with justify left in original Daggerfall  adds the final newline into the length of the text, while ending with a justify center does not. Unity Daggerfall was adding the newline to the length in either case. Doing the same thing as original Daggerfall allows the attribute popups, which end with justify center, to be correctly sized.

3. I fixed the problem of messages with middle vertical alignment being too low. The initial row wasn't being added into `totalHeight.`

I'm pretty confident about the top three fixes. The below fixes have good results, but I'm not an experienced programmer and they might not be implemented well.

4. I added hardcoded width overrides and positioning information for the sizing of the rest, loiter and find location input windows. These windows don't use text from TEXT.RSC and I couldn't see what rules if any they followed for their positioning.

5. I added in the same max input character limits as Daggerfall for the rest, loiter, find location and gold drop windows. The find location actually allows up to 32 characters. This fixes a problem where the rest and loiter windows weren't giving their ""you can only rest/loiter for ___ hours"" popups if you entered in very large values.

6. I added in resizing of text labels when buttons are added. This positions the text correctly, but I couldn't figure out how to get the buttons correctly positioned 4 pixels under the text, so I just left them for now as aligned at the bottom."
93427135,Book updates,InconsolableCellist,2016-11-12 04:02:06+00:00,2016-11-14 00:47:19+00:00,{},"See individual commit comments. Added ToolTips to books, fixed a few bugs, and the latest commit is an optional addition to the default console commands"
93032564,Book updates,InconsolableCellist,2016-11-09 20:24:45+00:00,2016-11-09 23:23:55+00:00,{},See: http://forums.dfworkshop.net/viewtopic.php?f=23&t=382
92482311,Use original Daggerfall text for travel message,Allofich,2016-11-06 09:56:55+00:00,2016-11-06 23:24:32+00:00,{},"Minor change to use the original Daggerfall text. I did the same thing that is done for the drop gold message to replace the token for the location name, and marked it as a temporary hack as it is marked there.

The message from TEXT.RSC is

> Do you wish to travel to√Ω %tcn?√Ω

Using `GetRSCTokens` to put this into `TextFile.Token[] textTokens` the ""%tcn?"" is stored in `textTokens[2].text,` while `textTokens[0].text` holds the ""Do you wish to travel to"" part and  `textTokens[1].text` is null. I don't really understand why there is a null in between them, but this was how it was, so I tell the code to look in `textTokens[2].text` for the token to replace.
"
92461470,Fixes to appearance of UI windows,Allofich,2016-11-05 17:59:44+00:00,2016-11-05 20:49:52+00:00,{},"This is a number of minor fixes to the UI windows. I'll try to explain it all here, and please let me know if you want me to change anything.

1. Identify 0xf8 format token.

This token appears in TEXT.RSC for the gold drop input message, and for two tavern room renting input messages. From testing with the gold drop message, it looks like it positions the input cursor. Without it, the cursor appears in the middle of the text window, overlapping other text, so it seems to be used for that. I put in a debug message for it that will show instead of the ""Unknown formatting token"" one that was showing before.

2. Change panel margins from 12 to 10.

From testing with the text in Daggerfall, I know at least that attribute popup text can go as close as 10 pixels to the left edge, and the top can be at least as close as 11 pixels. I couldn't test the top any more finely than that, because I can't add by individual pixels vertically like I could horizontally, but for now it seems reasonable to assume it is 10 all around.

3. Make message window borders be applied by multiples of 22 pixels to avoid misaligned parchment border textures, and make parchment popups be a minimum of four border tiles (44 pixels by 44 pixels).

From testing, the attribute windows and other windows in Daggerfall seem to have this as a minimum size, and the windows are always sized so that the textures line up properly.

This code is assuming 22 x 22 textures are used, which is what the vanilla ones are.

I also used the code for the reflex selection window during character creation, which was just resizing to the text size before. I've put similar code in 3 spots for the sizing of windows, so maybe it could all be consolidated somewhere to avoid code duplication.

4. Change input distance for input messages from 4 to 0. Change text panel distances for other input messages from 0 to 8 or 5.

This is to match what I see in Daggerfall, and to look correct with new border sizes from the changes to the window sizing, which seems to make all the message windows I saw vertically the same size as in Daggerfall.

5. Change label vertical alignment from top to middle.

Makes things look more correct with the resized borders. However, they seem to be positioned slightly lower than the middle, which I haven't been able to find the reason for, so it doesn't look perfect. Any idea there? Also, I think the race selection dialogs need to have the buttons at the bottom somehow factored in to the vertical text alignment in order to look right.

6. Change vertical panel sizing for input messages.

The `textBox.MaxSize.y` in `Mathf.Max(textBox.MaxSize.y, textBoxLabel.Size.y)` was causing the gold dropping dialog to be too high vertically, so I removed it as it didn't seem necessary to me (you can only enter up to 8 digits for the input in Daggerfall). I just used `textBoxLabel.Size.y.`"
90517989,Fix parsing of PositionPrefix format token,Allofich,2016-10-23 14:59:40+00:00,2016-10-23 22:19:34+00:00,{},"Just a minor fix. I noticed that the Strength attribute description had a few stray parentheses not there in original Daggerfall. I poked around and found that the check for the ""PositionPrefix"" token that what comes after it is not a normal character seems to be wrong. This was causing it to show the parentheses instead of use them for PositionPrefix. As far as I saw you can use any value there other than 0x00, which causes Daggerfall to show endless gibberish and crash.

Also Daggerfall Unity was summing together the PositionPrefix to the x cursor but it should be used as an absolute position and not summed. Summing it would cause the second use of PositionPrefix on a line to be moved over too far.

Edit: I wrote various things here about how I thought there should be a default indentation of 5, since using PositionPrefix of 0x04 places text one pixel to the left of the other lines, but it seems like it's already displaying correctly in Daggerfall Unity.
"
89522277,Identify various sound clips,Allofich,2016-10-16 10:39:01+00:00,2016-10-16 22:14:08+00:00,{},"This identifies various sound clips. Several of them are from Arena. There are probably some other sounds that are also from Arena that I haven't identified yet.

Also the gold pieces sound was marked as ambient metal jangling but I'm pretty sure it is the normal gold pieces sound. There's a separate ambient version.

Also there was ""arrowhit1"" and ""arrowhit2,"" but arrowhit1 is the sound for shooting an arrow.
"
89500394,Play correct weapon swing sounds,Allofich,2016-10-15 17:38:35+00:00,2016-10-15 22:26:44+00:00,{},"With this PR the player's weapons will play the correct weapon sounds (as far as I know.)

There are comments in the code about varying the pitch of weapon swings according to attack speed. As far as I can see, this is not what happens in Daggerfall. It just plays one of three sound effects. Two of these were labeled as ""EnemySwing1"" and ""EnemySwing2,"" but these are used by the player as well, so I renamed them.

The sound effect used seems to be based on the type of weapon. I tried a few different materials of the weapons, and swinging some of them with two different characters, and I got the same results.

I'm not completely sure what all the stuff about attack speeds and sound pitches in the comments is, so I'll leave it to you Interkarma if you want to remove the related TODO comments or any code, etc.
"
89392156,Play equipping sounds and correct weapon draw sounds,Allofich,2016-10-14 14:15:27+00:00,2016-10-14 21:49:44+00:00,{},"This makes items play the correct sounds when equipped, as far as I know. I tested all the weapon equip sounds, etc. I could only test one artifact that I had a save game for, but it played the correct sound, so hopefully those work correctly.

I also made the correct sound play for drawing a weapon, which is the same as the equip sounds. I didn't change the swing sound.

I also changed the spelling of ""jewelry"" I had added to ""jewellery,"" to match the British spelling you were using. :) It's probably a good idea to keep references to things using the same spelling.

The equip sounds playing on load was pretty jarring if you had a lot of items being equipped. I added in some code to stop it from happening.

Let me know if there is anything you want me to change.
"
89211560,Identify equipment sounds and open book sound,Allofich,2016-10-13 14:19:12+00:00,2016-10-13 21:58:46+00:00,{},"This identifies some of the sounds in SoundClips.cs that weren't identified yet. I wasn't sure what 382 was so I left that undefined.

I will gladly set these to play on equipping the appropriate items if you like. Or is there a reason you would prefer to hold off on that for now? The only issue I'm aware of is that it will play the equip sound  when you load a game.
"
89014969,Set up female clothing for variants,Allofich,2016-10-12 13:24:05+00:00,2016-10-12 21:23:55+00:00,{},"Sets up female clothing for variants, as I did for male clothing.

There's an issue with the WomensClothing.Short_shirt, at least on a female redguard, in both original Daggerfall and in Daggerfall Unity. On one of the variants (the first of the green vest ones), it will disappear and become inaccessible when equipped. Seems like maybe an incorrect drawing priority or something, but Daggerfall Unity looks like it sets drawing priority by item, not by variant. The item looks OK with all its variants while in the inventory in original Daggerfall. Any idea?

Also you may be aware of this, but it seems that the inventory of a female character in Daggerfall Unity is empty/inaccessible. I could only test clothing in Daggerfall Unity by having it equipped at the time of saving in original Daggerfall.
"
89014640,Exterior automap - first milestone implementation,Nystul-the-Magician,2016-10-12 13:22:19+00:00,2016-10-12 21:27:02+00:00,{},"hopefully the changes to the scene work ;)
please, also take a look at the file Assets/Scripts/Game/DaggerfallUI.cs - since I had a merge conflict when syncing our working branches and I had to manually resolve this conflict (it seemed to be an easy fix but pls double-check)
hopefully both the interior map as well as the exterior map should work...

thing that should already work:
- map layout
- player position marker
- navigation

things missing:
- view state stored/restored while in the same location (currently always reset to default view)
- no text is displayed on the map (no building names, no custom notes)
- serialization/save game support
"
89001899,Set correct variant numbers for male clothing,Allofich,2016-10-12 11:53:30+00:00,2016-10-12 21:22:44+00:00,{},"Sets the correct variant numbers for male clothing that weren't correct yet. Verified with Daggerfall Imaging 2 and in-game. These match the numbers I posted in the last PR.

In the graphics files in Daggerfall Imaging 2 the ""short tunics"" have what look like the green vest that you get as a variant with other shirts, but in original Daggerfall I found one with the vest and one without as separate, nonchangeable versions of the short tunic, so it is correct that these do not have variants.
"
88818151,Set all men's clothing that have variants,Allofich,2016-10-11 11:53:02+00:00,2016-10-11 23:01:53+00:00,{},"I tested all the men's clothing in the game, and set the ones that have variants.
I also reordered the existing variant clothing to match the ordering of the enums.

Apparently, though, the number of variants isn't being read correctly from the data files or something. The shirts only cycle through two variants, if any.

For reference, here are the testing results, including the number of clickable variants I saw.

Clothing,                                          Has clickable variants, # of clickable variants

Straps                      n
Armbands                    n
Kimono                      n
Fancy_Armbands              n
Sash                                n
Eodoric                     n
Shoes                       n
Tall_Boots                          n
Boots                       n
Sandals                     n
Casual_pants                        n
Breeches                            n
Short_skirt                 n
Casual_cloak                        y, 6
Formal_cloak                        y, 2
Khajiit_suit                        n
Dwynnen_surcoat             n
Short_tunic                 n
Formal_tunic                        n
Toga                        n
Reversible_tunic                    y, 2
Loincloth                           n
Plain_robes                         y, 2
Priest_robes                        n
Short_shirt                 y, 5
Short_shirt_with_belt               y, 4
Long_shirt                  y, 5
Long_shirt_with_belt                        y, 4
Short_shirt_closed_top              y, 4
Short_shirt_closed_top2                     y, 4
Long_shirt_closed_top               y, 4
Long_shirt_closed_top2              y, 4
Open_Tunic                  n
Wrap                        n
Long_Skirt                  n
Anticlere_Surcoat                   n
Challenger_Straps                   n
Short_shirt_unchangeable            n
Long_shirt_unchangeable             n
Vest                                n
Champion_straps             n
"
86113282,ReflectionsMod - shader pragma multi_compile replaces shader_feature,Nystul-the-Magician,2016-09-21 07:51:48+00:00,2016-09-21 08:11:50+00:00,{},"incorrect use of shader pragma shader_feature replaced with multi_compile
hopefully might fix the glossmap issue
"
85947998,ReflectionsMod - deferred planar reflection shaders now DX9-compatible,Nystul-the-Magician,2016-09-20 10:21:27+00:00,2016-09-20 22:25:55+00:00,{},"should now hopefully get through cloud build also ;)
"
85810417,Reflections mod - Deferred Planar Reflections,Nystul-the-Magician,2016-09-19 15:02:10+00:00,2016-09-20 07:42:27+00:00,{},"Reflections mod - Deferred Planar Reflections

we have to see if the 3 new shaders are correctly included in the live builds

the shaders are:
Daggerfall/ReflectionsMod/CreateLookupReflectionTextureIndex
Daggerfall/ReflectionsMod/CreateLookupReflectionTextureCoordinates
Daggerfall/ReflectionsMod/DeferredPlanarReflections

the two old shaders are now also inside Daggerfall/ReflectionsMod subcategory (and FloorMaterialWithReflections shader is only used if deferred shading is not activated):
Daggerfall/ReflectionsMod/TilemapWithReflections
Daggerfall/ReflectionsMod/FloorMaterialWithReflections
"
85544047,automap - fix for automap - removed interior light rig handling code,Nystul-the-Magician,2016-09-16 09:37:33+00:00,2016-09-16 21:22:58+00:00,{},"automap now correctly opens up again ;)
"
85333243,Merging early quest system to master,Interkarma,2016-09-15 01:32:21+00:00,2016-09-15 01:32:26+00:00,{},
81961642,FarTerrain and ReflectionsMod improvements/fixes,Nystul-the-Magician,2016-08-19 10:45:28+00:00,2016-08-19 11:23:48+00:00,{},"FarTerrain - changed shaders to Standard shader instead of Lambert 
ReflectionsMod - fixed interior reflections
"
81809537,FarTerrain - starting up with EnhancedSky on/off now works correctly,Nystul-the-Magician,2016-08-18 12:47:47+00:00,2016-08-19 03:36:36+00:00,{},"FarTerrain - starting up with EnhancedSky on/off should now work correctly
toggle between EnhancedSky and vanilla sky at runtime is not working due to a unity bug - see my forum post in the IncreasedTerrainDistanceMod thread in the creator's corner
"
81546002,automap - fixed a bug with automap discovery state not remembered,Nystul-the-Magician,2016-08-16 21:14:27+00:00,2016-08-17 00:30:50+00:00,{},
81460049,ReflectionsMod - fixed bug with billboards reflecting in sea tiles,Nystul-the-Magician,2016-08-16 12:06:14+00:00,2016-08-17 00:30:43+00:00,{},"was a sideeffect of a change to IncreasedTerrainDistanceMod - now the corresponding value that needs to be synched (extraTranslationY) is queried from IncreasedTerrainDistanceMod and applied to ReflectionsMod
"
81311015,automap - entrance marker discovery state is now stored in savegames,Nystul-the-Magician,2016-08-15 13:23:34+00:00,2016-08-15 22:28:53+00:00,{},
81299653,removed UnityEditor statement and redo recent changes,Nystul-the-Magician,2016-08-15 11:21:17+00:00,2016-08-15 12:04:57+00:00,{},"reverting is super bad - broke all of my branches completely. had to manually do all recent changes since revert on a clean master . maybe we find a better workflow - or is it intended to make it impossible to work on on any existing branch?
"
81211166,"Revert ""FarTerrain and ReflectionMod improvements""",Interkarma,2016-08-13 08:53:22+00:00,2016-08-13 08:53:26+00:00,{},"Reverts Interkarma/daggerfall-unity#127
Cannot use UnityEditor namspace in builds.
"
81107018,FarTerrain and ReflectionMod improvements,Nystul-the-Magician,2016-08-12 11:49:37+00:00,2016-08-13 00:04:41+00:00,{},"FarTerrain - sky texture and water height are reassigned in Update() - got lost sometimes otherwise
ReflectionsMod - global fog is used for reflection (when in deferred) - looks correct now with heavy fog
"
80951263,FarTerrain - found a fix for global fog to work with camera stack,Nystul-the-Magician,2016-08-11 12:47:48+00:00,2016-08-12 01:32:19+00:00,{},"actually these are really good news! I found a fix for global fog to work with the far terrain camera stack. It was easier than expected in the end. only had to fix some bugs on my side and uncheck the checkbox ""Exclude Far Pixels"" in GlobalFog script. I do this by script when FarTerrain mod is enabled automatically - so it should not break anything when FarTerrain is not active.
you can try it out, go to a location in the mountains (so you see far terrain) and than go to the lighting tab to fog settings and change them (don't let yourself get confused by unity's message about fog and deferred shading - (the message is actually misleading since global fog still uses these values - it should have better been called ""without global fog script attached to camera component these values do not have any effect on opaque objects in deferred shading"" or something))
FarTerrain is now ready for foggy weather conditions in daggerfall. it should be even possible to make dynamic foggy weather now very easy by changing the fog settings dynamically
"
80447311,automap - fireplaces are now correctly shown on automap,Nystul-the-Magician,2016-08-08 13:05:13+00:00,2016-08-08 23:00:22+00:00,{},"issue was caused by emission color on some textures (for the moment just ignoring emission in the automap shader
added code to remove texture animation for automap geometry (since it is not necessary for automap)
"
80413378,automap - updated tooltips (hint was wrong for arrow buttons),Nystul-the-Magician,2016-08-08 08:42:41+00:00,2016-08-08 11:42:24+00:00,{},
80362468,automap - bugfix for outdoor saving and loading exceptions,Nystul-the-Magician,2016-08-07 09:21:14+00:00,2016-08-07 22:22:14+00:00,{},
80337271,automap - tooltip popup prevention with SuppressToolTip flag now rocks,Nystul-the-Magician,2016-08-06 10:46:53+00:00,2016-08-06 20:02:01+00:00,{},
80334361,Removed Tags / Layers update & ModManager now checks LypyL_ModSystem bool,Lypyl,2016-08-06 08:15:44+00:00,2016-08-06 20:03:52+00:00,{},"Removed recent Tags / Layers changes as they are no longer needed.

ModManager changed to check SettingsManager.LypyL_ModSystem bool at start.
"
80254317,automap - fix for quickload exception related to missing automap geometry,Nystul-the-Magician,2016-08-05 14:41:09+00:00,2016-08-06 00:47:41+00:00,{},
80241448,Automap - save system integration,Nystul-the-Magician,2016-08-05 13:16:34+00:00,2016-08-05 14:03:46+00:00,{},
79878549,Merging Automap,Interkarma,2016-08-03 09:58:04+00:00,2016-08-03 09:58:29+00:00,{},
79770304,automap - tooltips are now displayed on mouse over automap buttons,Nystul-the-Magician,2016-08-02 16:54:19+00:00,2016-08-03 08:34:16+00:00,{},"not as good as a dedicated help page but still an improvement and a start
"
79555535,Updating to current master,Interkarma,2016-08-01 11:47:24+00:00,2016-08-01 11:47:28+00:00,{},
79547139,automap - fixed save state behaviour if numberOfDungeonMemorized is 0,Nystul-the-Magician,2016-08-01 10:31:45+00:00,2016-08-01 11:47:49+00:00,{},"small fix - this should make vanilla behavior work once save system is wired up (reason for change: even when numberOfDungeonMemorized is 0 there must be one entry in the list of dungeons when saving inside a dungeon - this was incorrectly handled before)
"
79499504,Updating to latest master,Interkarma,2016-07-31 23:31:18+00:00,2016-07-31 23:31:26+00:00,{},
79490457,Automap work in progress,Nystul-the-Magician,2016-07-31 17:19:31+00:00,2016-07-31 23:31:34+00:00,{},"if you find the time please wire it up with the save system so we can test it.

the last n dungeons are now remembered

the number of dungeons memorized can be set via function setNumberOfDungeonMemorized(n)
0...vanilla behavior (no dungeons are remembered after leaving them)
1...the dungeon visited last is remembered after leaving it
n...the n last visited dungeons are remembered after leaving them

default is 1 - but if you like the vanilla behavior better you can change this to 0.
as discussed on the forums - would be nice to have a ini value (e.g. numberOfDungeonMemorized) where one can set the extended behavior
"
77227907,Added button to DaggerfallUnity inspector for setting Tags / Layers ,Lypyl,2016-07-13 04:14:15+00:00,2016-07-13 05:41:02+00:00,{},"Tags / Layers are set from enums in DaggerfallUnityEnums
"
77071689,Merging runtime-compiler to master,Interkarma,2016-07-12 07:14:41+00:00,2016-07-12 07:16:09+00:00,{},
77071224,Updating to current master,Interkarma,2016-07-12 07:10:11+00:00,2016-07-12 07:14:16+00:00,{},
76696522,Updating to current master,Interkarma,2016-07-08 03:14:07+00:00,2016-07-08 03:14:13+00:00,{},
76536768,Flattening unused effect system branch,Interkarma,2016-07-07 04:09:11+00:00,2016-07-07 04:09:22+00:00,{},"Will reopen at a later date when effect system ready to be added.
"
76109394,Merging updated Far Terrain branch to master,Interkarma,2016-07-04 03:41:03+00:00,2016-07-04 03:42:54+00:00,{},
74326252,Runtime compiler,Lypyl,2016-06-18 03:25:14+00:00,2016-06-18 04:25:30+00:00,{},
74017899,Runtime compiler,Lypyl,2016-06-16 03:38:45+00:00,2016-06-16 06:55:51+00:00,{},
72618971,Runtime compiler,Lypyl,2016-06-05 02:48:56+00:00,2016-06-10 08:56:12+00:00,{},
72593631,Runtime compiler,Lypyl,2016-06-04 05:24:04+00:00,2016-06-05 01:31:22+00:00,{},
71490694,Runtime compiler,Lypyl,2016-05-26 02:11:23+00:00,2016-05-26 03:49:42+00:00,{},"Checked in Mod Builder editor window
Checked in Compiler editor window
Added a button to the setup options to list loaded mods
"
71312133,Runtime compiler,Lypyl,2016-05-25 00:01:09+00:00,2016-05-25 21:43:06+00:00,{},"Checking in Modding framework
"
70999651,Updating C# compiler to newer version for bug fix,Lypyl,2016-05-23 03:03:57+00:00,2016-05-23 22:46:11+00:00,{},"Updated Compiler class to support compiling from source code or any array of file names
"
70966136,Updating to current master,Interkarma,2016-05-22 02:36:05+00:00,2016-05-22 02:36:10+00:00,{},
70966130,Updating to current master,Interkarma,2016-05-22 02:35:23+00:00,2016-05-22 02:35:32+00:00,{},
70966121,Updating to current master,Interkarma,2016-05-22 02:34:48+00:00,2016-05-22 02:34:53+00:00,{},
70957958,Runtime compiler,Lypyl,2016-05-21 19:22:01+00:00,2016-05-21 22:59:58+00:00,{},"Changes to SceneControl, GameManager & StateManager
"
70363174,FarTerrain - terrain transition ring,Nystul-the-Magician,2016-05-17 14:08:13+00:00,2016-05-17 22:15:45+00:00,{},"please test it and give me some feedback about it ;)
would suggest setting TerrainDistance in StreamingWorld script to 2 for a more fair performance comparison with the ""old"" implementation.
If your computer is strong enough run with TerrainDistance 3...
TerrainScale can be upped to 1.6 or even more if you want to see the blending more often in action ;)
"
70121293,Automap - switch automap background with hotkeys F4-F8,Nystul-the-Magician,2016-05-15 13:29:42+00:00,2016-05-17 22:13:38+00:00,{},"alternative background (single-color) can be selected with hotkeys, F5-F8, F4 is default
rendering mode hotkeys are now F2-F4, F1 is reserved for help window
"
69756084,Automap - transparency improvements in transparent mode,Nystul-the-Magician,2016-05-11 22:59:31+00:00,2016-05-12 22:24:04+00:00,{},"improved transparency mode a bit - shader is now a two-pass shader (opaque pass and transparent pass) - objects below slice plane should no longer disappear sometimes when under a transparent object
"
68473400,Runtime compiler,Lypyl,2016-04-30 17:12:53+00:00,2016-05-01 23:58:21+00:00,{},"Added compiler editor window

support for saving compiled assemblies to disk (experimental...)

moved compiler class & editor window into the Game.Utility namespace
"
67591802,"Cleaned up compiler class, added try / catch to execute console command",Lypyl,2016-04-23 01:27:43+00:00,2016-04-23 01:40:38+00:00,{},
67582782,Added a list picker pop-up window to the Travel Map...,Lypyl,2016-04-22 22:42:02+00:00,2016-04-23 01:40:26+00:00,{},"To displays list of locations in current region, and can select location to fast travel to.
"
67454991,Updating to current master,Interkarma,2016-04-22 03:36:54+00:00,2016-04-22 03:36:57+00:00,{},
67454972,Updating to current master,Interkarma,2016-04-22 03:36:27+00:00,2016-04-22 03:36:32+00:00,{},
66849394,Updating to current master,Interkarma,2016-04-18 13:03:49+00:00,2016-04-18 13:04:02+00:00,{},
66761511,Changed OnItemPickedEventHandler in DaggerfallListPickerWindow to...,Lypyl,2016-04-17 08:09:00+00:00,2016-04-17 22:23:01+00:00,{},"‚Ä¶now pass the string of selected item

Updated CreateCharClassSelect.DaggerfallClassSelectWindow_OnItemPicked() to take a string paramater for above change
"
66262606,Updating to current master,Interkarma,2016-04-13 03:55:52+00:00,2016-04-13 03:56:17+00:00,{},
66255209,Error handling for Travel Map Window's texture creation functions,Lypyl,2016-04-13 01:55:07+00:00,2016-04-13 03:55:22+00:00,{},
65875979,automap - improved controls,Nystul-the-Magician,2016-04-09 09:15:01+00:00,2016-04-10 08:17:22+00:00,{},"right-mouse drag&drop rotates now the camera around model (with left/right around the rotation axis, with up/down on the camera YZ-plane)
fine-tuned some control speeds
"
65781359,automap camera settings are now preserved,Nystul-the-Magician,2016-04-08 12:51:34+00:00,2016-04-08 22:34:39+00:00,{},"changed the way camera settings are preserved in 3D mode when closing and reopening the automap window
not all settings are preserved though:
e.g. slice level is reset and pivot axis is always reset to player position
camera is still focusing the player after reopening the map - this is intended
"
65738107,Changes to DefaultCommands & bug fix for TravelMap,Lypyl,2016-04-08 05:21:09+00:00,2016-04-08 22:34:24+00:00,{},"Added a FPS counter that can be enabled w/ the tdbg console command.

Added a new console command to trigger action objects.

Bug fix for texture creation in DaggerfallTravelMapWindow.
"
65710014,State manager,Interkarma,2016-04-07 22:25:31+00:00,2016-04-07 22:25:38+00:00,{},
65568100,State manager,Lypyl,2016-04-07 03:11:08+00:00,2016-04-07 22:24:07+00:00,{},
65567126,Updating to current master,Interkarma,2016-04-07 02:56:20+00:00,2016-04-07 02:56:29+00:00,{},
65464385,automap - fixed bug when player died and a new game is started,Nystul-the-Magician,2016-04-06 13:19:37+00:00,2016-04-07 00:07:02+00:00,{},"geometry now correctly loads when starting in privateer's hold
"
65117327,ReflectionsMod issue with non-reflecting materials fixed,Nystul-the-Magician,2016-04-04 09:33:55+00:00,2016-04-04 09:56:51+00:00,{},"ReflectionsMod issue with non-reflecting materials fixed
non-reflecting materials are no longer incorrectly injected with reflection shader
this resulted in white textures on several dungeon objects (e.g. direnni tower banners and levers)
"
64420457,Adds Groundme console command & update to Teleport console command,Lypyl,2016-03-29 06:46:28+00:00,2016-03-30 02:16:49+00:00,{},
64408825,tag manager updates,Lypyl,2016-03-29 03:24:38+00:00,2016-03-29 04:01:50+00:00,{},
64263755,[automap] Destroy() instead of DestroyImmediate() should work now,Nystul-the-Magician,2016-03-27 11:52:38+00:00,2016-03-27 12:25:23+00:00,{},"Destroy() instead of DestroyImmediate() should work now
I had to do some extra stuff:
1. after every ""Destroy(aGameObject)"" I had to do ""aGameObject = null"" - this is necessary so that the handle is invalid immediately
2. this is also the case for any GameObjects inside aGameObject (so I had to set the handles to null for all sub-GameObjects)
"
64202139,automap - entrance discovery and fixes,Nystul-the-Magician,2016-03-25 20:10:39+00:00,2016-03-25 23:25:28+00:00,{},"[automap]
entrance discovery now working with player collider again
fixed bugs introduced by switching from DestroyImmediate() to Destroy() - now went back to DestroyImmediate() since it is necessary and more predictable (see forum post for explanation: http://forums.dfworkshop.net/viewtopic.php?f=18&t=228&p=1912#p1912)
"
63802447,Added teleport command to DefaultConsoleCommands,Lypyl,2016-03-22 22:18:25+00:00,2016-03-22 23:18:05+00:00,{},
63509471,fixed NullReferenceException in IncreasedTerrainDistance mod and other fixes,Nystul-the-Magician,2016-03-20 22:16:52+00:00,2016-03-21 03:25:04+00:00,{},"fixed NullReferenceException in IncreasedTerrainDistance mod when ReflectionsMod is not activated
added some missing checks for mod activation state
fixed a bug in ImprovedWorldTerrain script and increased elevation amplification of map pixels without locations
"
63484475,State manager changes,Lypyl,2016-03-20 01:59:13+00:00,2016-03-21 03:22:33+00:00,{},
63484353,[ReflectionsMod],Nystul-the-Magician,2016-03-20 01:51:59+00:00,2016-03-20 02:27:37+00:00,{},"reflections should work now after fast traveling again
"
63469660,ReflectionsMod fixes and code cleanup,Nystul-the-Magician,2016-03-19 14:55:53+00:00,2016-03-19 22:55:26+00:00,{},"ReflectionMod improvements
transition should work correct now in all cases (also building2dungeon and dungeon2building)
removed event listening for the approach suggested originally for the automap - but for the reflection mod it really makes things easier ;)
code cleanup
replaced DestroyImmediate with Destroy
removed version number from files (does not make much sense since everything is in git now anyway)
"
63206057,Closing reflections mod branch,Interkarma,2016-03-17 11:08:13+00:00,2016-03-17 11:08:19+00:00,{},
63198412,Automap fixes (+small change to IncreasedTerrainDistance mod),Nystul-the-Magician,2016-03-17 10:06:43+00:00,2016-03-17 10:52:30+00:00,{},"automap geometry should now correctly be destroyed when player is in exterior environment
automap geometry should now correctly be disabled when automap is closed
automap geometry should now be correctly created on game start and when a savegame is loaded

IncreasedTerrainDistance mod exposes the rendertexture reflectionSeaTexture now (so one can easily see in the unity editor if the mod successfully hijacked the reflectionmods texture or not)
"
63164694,Updating to current master,Interkarma,2016-03-17 02:23:54+00:00,2016-03-17 02:23:57+00:00,{},
63164006,Updating to current master,Interkarma,2016-03-17 02:11:13+00:00,2016-03-17 02:11:29+00:00,{},
63017403,IsMagicallyHeld property for DaggerfallActionDoor,Lypyl,2016-03-16 05:55:20+00:00,2016-03-16 06:22:16+00:00,{},
63009610,Fixes for DaggerfallInputMessageBox and TextBox,Lypyl,2016-03-16 03:30:22+00:00,2016-03-16 04:32:44+00:00,{},
63003304,Fixed SongManager bug playing incorrect songs.,Interkarma,2016-03-16 01:43:25+00:00,2016-03-16 01:43:30+00:00,{},"Added indirect lighting to sun rig. This creates a point light that follows player and scales with sun brightness. Creates a more pleasing effect than multiple directional lights which would still leave dark surfaces at many angles.
Tweaked overall ambient manager and weather brightness settings.
"
62992297,Merging latest master,Interkarma,2016-03-15 23:14:45+00:00,2016-03-15 23:14:52+00:00,{},
62858586,Travel map button textures & fast travel updates,Lypyl,2016-03-15 05:55:55+00:00,2016-03-15 06:20:32+00:00,{},
62688654,Added PlayerCollision component to PlayerAdvanced.,Interkarma,2016-03-14 00:09:11+00:00,2016-03-14 00:09:14+00:00,{},"Disabled legacy capsule collider.
"
62686186,Add Automap game object.,Interkarma,2016-03-13 22:38:38+00:00,2016-03-13 22:38:44+00:00,{},"Fixed renamed UI setting.
"
62685645,Updating to current master,Interkarma,2016-03-13 22:20:52+00:00,2016-03-13 22:20:58+00:00,{},
62685627,Merging Items inventory window to master,Interkarma,2016-03-13 22:20:11+00:00,2016-03-13 22:20:17+00:00,{},
62685587,Merging travel map to master,Interkarma,2016-03-13 22:18:41+00:00,2016-03-13 22:18:51+00:00,{},
62685399,Merging automap playground,Interkarma,2016-03-13 22:12:49+00:00,2016-03-13 22:16:10+00:00,{},
62685087,Merging Actionobject update to master,Interkarma,2016-03-13 22:02:13+00:00,2016-03-13 22:03:37+00:00,{},
62684852,Updating to current master,Interkarma,2016-03-13 21:54:28+00:00,2016-03-13 21:54:40+00:00,{},
61424088,Action updates,Lypyl,2016-03-02 16:13:18+00:00,2016-03-02 21:25:11+00:00,{},"The ""hurt"" type actions work like in Daggerfall now.

Added a functioning Drain magicka action.

Fixed up the collision handling for actions

The trigger flags now work like they should in Daggerfall, and  the action will only trigger if the type is valid for that flag

WeaponManager will check for DaggerfallAction component on gameobject the player attacks

DaggerfallActionDoor will check for DaggerfallAction component when its opened / closed
"
61195207,Travel map update adding ability to switch to different regions,Lypyl,2016-03-01 05:31:34+00:00,2016-03-01 06:06:50+00:00,{},"last one ;)
"
61192891,Travel map ,Lypyl,2016-03-01 04:55:34+00:00,2016-03-01 05:25:34+00:00,{},"Replaces old teleport functions in DaggerfallTravelMap w/ travel options pop-up window
"
61038061,Travel Map Updates,Lypyl,2016-02-29 07:26:51+00:00,2016-02-29 08:19:35+00:00,{},
60984794,Travel map,Lypyl,2016-02-28 09:11:14+00:00,2016-02-28 10:46:00+00:00,{},"Adds properties & fixes some mouse related issues with DaggerfallTravelMap
"
60976318,Updating items inventory branch to current master,Interkarma,2016-02-28 03:28:02+00:00,2016-02-28 03:29:10+00:00,{},
60976254,Updating travel map branch to current master,Interkarma,2016-02-28 03:25:14+00:00,2016-02-28 03:25:26+00:00,{},
60934819,Small changes to InputManager,Lypyl,2016-02-27 03:46:06+00:00,2016-02-27 07:59:17+00:00,{},"Adds PlayerDeathInProgress getter to PlayerDeath, 

fixes camera height bug in death animation in PlayerDeath

Stops InputManager from opening windows during death animation (settings window still works), and includes a temp. fix for the constant forward movement when the player dies
"
60136662,Adds new console command to get map pixel coords of location,Lypyl,2016-02-22 07:55:45+00:00,2016-02-27 01:58:04+00:00,{},"Adds getlocpixel command to DefaultConsole commands.  Returns x,y of a valid region/location to the console.
"
54466898,Automap implementation,Nystul-the-Magician,2015-12-23 12:55:50+00:00,2015-12-23 13:02:21+00:00,{},"reverted scene to your scene, so to make the automap work you need to:
1.) create GameObject called ""Automap"" in the root of the scene hierarchy and attach script Game/DaggerfallAutomap.cs
2.) optional: create layer ""Automap"" in Edit->Project Settings->Tags And Layers (layer 10 is used if no layer called ""Automap"" is set)
3.) optional: uncheck layer ""Automap"" from culling mask of main camera (this is done by script anyway - but to make things more clear I would uncheck it)
"
54050778,Added keybind events that are raised when bindings are loaded / saved.,Lypyl,2015-12-18 00:25:07+00:00,2015-12-18 03:23:59+00:00,{},"created a default keybinding for ToggleConsole key in SetupDefaults()

ConsoleController now sets consoleKey after InputManager.OnLoadedKeyBind event
is triggered to make sure it isn't set before keybinds.ini has been parsed by inputmanager.

""BackQuote"": ""ToggleConsole"", entry needs to be added to KeyBinds.ini
"
53942001,travel map update,Lypyl,2015-12-17 07:14:10+00:00,2015-12-17 08:51:47+00:00,{},"DaggerfallUI changes:

ProcessMessages() won't push travel map window when player inside

DaggerfallTravelMapWindow:
1. Fixed Region overlay not updating player region after travel
2. Esc no longer closes travel window
3. Added color array for location pixels & lookup function; location pixel colors now correct
4. Can now click to travel to location or travel by find button
5. At button now works in both region and main map window.
6. Red flashing crosshair texture now created from both At & find buttons (in region map view).
7. Cybadies is now working
"
53940225,Fixed using statement in LoadCommand.cs.,Interkarma,2015-12-17 06:43:03+00:00,2015-12-17 06:43:12+00:00,{},"Bumped version to 1.4.57.
"
53919873,Updating to current master,Interkarma,2015-12-17 00:35:02+00:00,2015-12-17 00:35:12+00:00,{},
53919826,Updating to current master,Interkarma,2015-12-17 00:34:29+00:00,2015-12-17 00:34:35+00:00,{},
53639829,Travel map,Lypyl,2015-12-14 23:43:41+00:00,2015-12-17 01:16:11+00:00,{},"Updates for Travel Map:

Added borders for region maps

Colors for location pixels are now correct

Location filtering now works, button textures update correctly

Fixed region identification (at button on region picker screen) not updating
properly when player changed regions

Can now travel to locations using find button & by clicking on location pixel

When in a region map & mouse over a location, text label will update with location name

""I'm At"" and ""Find buttons"" now create flashing crosshair textures over locations

Cybiades is now working

Added a check in DaggerfallUI to prevent TravelMap from opening if player inside

Other changes are updates that have already been applied to Master branch (ListBox.SwapItems(), MapsFile.GetPixelFromPixelID(), ContentReader.HasLocation() )
"
53535799,Work in progress,Lypyl,2015-12-14 08:26:01+00:00,2015-12-14 08:42:40+00:00,{},"Added a static method to MapsFile to convert Pixel ID back to Map Pixel coordinates, and an overloaded HasLocation() to Content reader that only checks for a location.
"
53531388,Added a Method to ListBox to swap 2 text labels in the list by index,Lypyl,2015-12-14 07:15:11+00:00,2015-12-14 07:43:27+00:00,{},"Added a new method to ListBox to swap text labels
"
53511622,Merging work-in-progress to master,Interkarma,2015-12-13 22:22:46+00:00,2015-12-13 22:27:12+00:00,{},
52034774,Merge travel map changes and start on items.,Interkarma,2015-11-28 06:41:45+00:00,2015-11-28 06:42:36+00:00,{},
51579927,Automap playground,Nystul-the-Magician,2015-11-23 21:04:59+00:00,2015-12-11 22:05:57+00:00,{},"see changes to scene that were made - required (1.) and optional (2. and 3.) changes are:
1.) add GameObject ""Automap"" to hierarchy root and attach Game/DaggerfallAutomap.cs script
2.) define new layer ""Automap"" (if not found, will use layer 10)
3.) change main camera culling mask to ignore layer ""Automap"" (script will do this setting on runtime as well)
"
51473297,Automap implementation,Nystul-the-Magician,2015-11-22 20:10:52+00:00,2015-11-23 07:34:35+00:00,{},"unfortunately git hub tells me it cannot be automatically merged. I think it is because of the changed scene
had to change it by adding a GameObject called ""Automap"" which has to have script Game/DaggerfallAutomap.cs attached
"
50740679,VideoFilterMode,HowardRoeske,2015-11-15 06:10:14+00:00,2015-12-11 22:05:18+00:00,{},"Reverted GUIFilterMode connection and added VideoFilterMode to the GUI settings. Defaults to 0 (point sampling), to match the rest of the filtering defaults in the project.

The DaggerfallVideo.cs diff looks huge because I made the changes to my fork before realizing there were changes to the file in your repository and then learning how to merge in upstream changes to my own. The actual diff is just two lines, #57 and #68 from my copy. Sorry about that, still learning how to Git.
"
50739300,Committed travel map,Lypyl,2015-11-15 04:18:44+00:00,2015-11-15 05:45:42+00:00,{},
50736438,Updated ConsoleController to use Daggerfall InputManager keybind for ‚Ä¶,Lypyl,2015-11-15 00:48:10+00:00,2015-11-15 01:39:29+00:00,{},"‚Ä¶toggling console & fixed bug with teleport to map pixel command
"
50735671,Add method to update a text label in listbox at a given index,Lypyl,2015-11-14 23:58:42+00:00,2015-11-15 00:23:10+00:00,{},
50728778,Work in progress,HowardRoeske,2015-11-14 18:18:57+00:00,2015-11-14 22:55:38+00:00,{},"This started out as a way to expose point sampling on videos for a more old-school experience, but along the way I noticed that GUIFilterMode wasn't hooked up to anything. I studied the revision history and played around with the code for a bit, and ultimately the break seemed like an oversight rather than an intentional (""this isn't quite working yet"") omission. 

So now, the GUIFilterMode setting gets applied to DaggerfallUI's global filter mode. In turn, DaggerfallUI's filter mode is applied to DaggerfallVideos. Smoothed UIs get smoothed video, and pixely UIs get pixely video.

This does eliminate the current shipping default configuration of point-scaled UI and smooth videos, though. It might be better to expose a separate filter setting for the videos? Let me know if that's what you'd prefer.
"
50714250,Fixed texture wrapping artifacts on video textures.,HowardRoeske,2015-11-14 02:42:54+00:00,2015-11-14 02:48:11+00:00,{},"Set DaggerfallVideo textures to use the ""clamp"" repeat mode, which fixes wrapping artifacts when enlarged using smooth filtering (most easily visible in the live-action intro with the torch on the side of the screen).
"
50599334,Fix for indexing bug in TextLabel.SetText(),Lypyl,2015-11-13 03:03:28+00:00,2015-11-13 03:25:56+00:00,{},"Recent change to apply a max characters value to the text label will raise an
indexing error if max characters > length of the string
"
50540243,Added system info properties to better log hardware,Lypyl,2015-11-12 17:20:46+00:00,2015-11-12 22:31:54+00:00,{},"updated log creator to include system info.
"
50073541,Work in progress,Lypyl,2015-11-08 23:16:19+00:00,2015-11-09 05:59:50+00:00,{},"Action types 11 & 12, UI changes to support them, and a small change to SettingsManager that will create a new settings.ini file from fallback.ini if settings.ini isn't found in the data directory.
"
50021385,fixed bug in location command,Nystul-the-Magician,2015-11-07 00:28:21+00:00,2015-11-09 05:40:16+00:00,{},"location command no longer reports incorrectly that location index is invalid when it is correct and the player was teleported
"
49987522,"Enhanced Sky update, added properties to GameManager & set DefaultCom‚Ä¶",Lypyl,2015-11-06 18:25:28+00:00,2015-11-07 21:17:27+00:00,{},"‚Ä¶mands to use GameManager where possible

Enhanced Sky:

Tweaked settings for the sky to improve visuals
Updated refrences to use GameManager

GameManager:

Added PlayerHealth, PlayerEntityBehaviour, & Daggerfall Sky Rig properties.

Console Default Commands:

Updated references to use GameManager
"
49889339,Revert 2c8f3b8e3ab04406335f6b55d2e7fc3f468146d0,Interkarma,2015-11-05 22:19:30+00:00,2015-11-05 22:19:42+00:00,{},"Reverts Interkarma/daggerfall-unity#8
"
49888038,Revert f6a13bdf57759360aa9812b02770e42fc6ddf5e5,Interkarma,2015-11-05 22:08:08+00:00,2015-11-05 22:08:16+00:00,{},"Reverts Interkarma/daggerfall-unity#7
"
49788260,Changes to GameManager & SetWeather console command,Lypyl,2015-11-05 06:49:10+00:00,2015-11-05 22:02:10+00:00,{},"Added simple generic methods to GameManager for finding gameobjects & components
Expanded the properties in GameManager using these new generic methods
Added GetProperties() to GameManager, which sets all of the GameManager's properties
Updated Set_Weather console command to change weather via WeatherManager
"
49675475,detection of other mods and dependent behavior improved,Nystul-the-Magician,2015-11-04 11:10:53+00:00,2015-11-04 20:50:24+00:00,{},"renamed ENHANCED_SKY_AVAILABLE define into ENHANCED_SKY_CODE_AVAILABLE to make it clear that it is a define used to enable/disable code lines dependent on if the mod's code is available

same for REFLECTIONSMOD_CODE_AVAILABLE

there are now 2 boolean flags isActiveReflectionsMod, isActiveEnhancedSkyMod which are set to true at startup if the corresonding mods are active
these flags are used to control IncreasedTerrainDistance mod's behaviour dependent on the available other mods (this should for example fix the nullpointer error when reflectionsmod is disabled)

console command ""location"" now gives feedback to which location the player has been teleported
"
49543807,implemented changes due to feedback from interkarma,Nystul-the-Magician,2015-11-03 11:20:36+00:00,2015-11-03 21:51:47+00:00,{},"MirrorReflection.cs: eliminated GameObject.Find() invocations inside OnWillRenderObject() and doing them instead in Start() function

UpdateReflectionTextures.cs: new function for obtaining sea reflection render texture and ground level reflection render texture added (getSeaReflectionRenderTexture() and getGroundReflectionRenderTexture())

IncreasedTerrainDistance.cs: sea reflections activated and new function for obtaining sea reflection render texture (getSeaReflectionRenderTexture()) from ReflectionsMod's UpdateReflectionTextures script used, SetupGameObjects() is invoked OnAwake() so that cameras are created there - so MirrorReflection script of ReflectionsMod can find cameras in its Start() function

InjectReflectiveMaterialProperty.cs: eliminated GameObject.Find() invocations inside OnWillRenderObject() and doing them instead in Start() function - added corresponding class member variables

ImprovedWorldTerrain.cs: file path for export maps is not created with Path.Combine(Application.dataPath, ...)

DefaultCommands.cs: travel to random location with console location command now (TODO: investigate why player seems to end up with small offset to intended target location)
"
49536543,Overhaul & general cleanup of enhanced sky,Lypyl,2015-11-03 10:02:25+00:00,2015-11-03 21:50:30+00:00,{},"created new prefab that holds sky objects in scene; SkyManager now creates/destroys this prefab
MoonController, Cloud, RotationScript etc. no longer use the toggleSkyObjectsEvent & fastTravelEvents
Added CloudGenerator to the EnhancedSkyController object; this creates the textures for cloud object
Added Min/Max for cloud dimensions to Presets
SkyManager now loads / unloads materials + Container prefab from resources
Removed Moon & Cloud Materials
Cleaned up fields / properties in pretty much all the scripts
Deleted CloudEditor script, and moved most of it's function to SkyManagerEditor
Sky camera rendering path & fov now set from main camera
SkyManager now triggers an event when WeatherManager changes weather; The sky will update accordingly
"
49381857,IncreasedTerrainDistanceMod and ReflectionsMod improvements,Nystul-the-Magician,2015-11-01 21:50:39+00:00,2015-11-03 00:21:29+00:00,{},"IncreasedTerrainDistanceMod and ReflectionsMod improvements

added ""location""-command to console for fast location hopping to 9 predefined locations (using this for debugging IncreasedTerrainDistanceMod and ReflectionsMod) - You have to decide if you want to accept this command - I think it is pretty useful for debugging

fog settings from lighting tab are used for distant terrain fog now,
toggle of EnhancedSky mod should work with fog of distant terrain now
eliminated public fog parameters in IncreasedTerrainDistance script - since it is redundant information now that the fog settings from lighting tab works now again

loading strategy of configInjectionTextures.ini file reworked - loaded with Resources.Load if no user file is specified (user ini filepath can specified as public string in script UpdateReflectionTextures (which will forward the string to InjectReflectiveMaterialProperty script)

loading strategy tree coverage map reworked - now uses Resources.Load
creations of maps works like before - it is not intended to be done in the executable build - it is manually triggered and maps are created while running from unity editor - so the filepath should be ok like it is

far terrain if present is now reflected in reflection (known issue: terrain tiles of far terrain can end up in front of the ""outer"" ring of the near terrain)
bug with geometry in stackedNearCamera clip range not reflecting fixed

water reflections in far terrain hijack the reflection texture for the sea level plane

layers to be reflected is now set in callback of transition events

InjectMaterialProperties callback strategy streamlined a bit

reflections should work now on far terrain as well
"
48757284,IncreasedTerrainDistanceMod and ReflectionsMod,Nystul-the-Magician,2015-10-26 15:49:58+00:00,2015-10-27 00:04:39+00:00,{},"- added IncreasedTerrainDistanceMod
- added ReflectionsMod
- changed MaterialReader class: added function SetCachedMaterial(): this function is used to update materials with new/modified materials
- added a new unity scene (Scenes/DaggerfallUnityGame_withMods.unity) with mods enabled: EnhancedSky mod, IncreasedTerrainDistanceMod, ReflectionsMod

don't forget to define a ""WorldTerrain"" layer in Project Settings -> Tags and Layers
known issues: activated fog in conjunction with globalfog only works correctly on main camera
"
48715898,Log generator,Lypyl,2015-10-26 09:20:00+00:00,2015-10-26 11:53:05+00:00,{},"Log Generator for standalone builds.
"
