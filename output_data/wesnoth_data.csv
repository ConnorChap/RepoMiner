id,title,author,created_at,closed_at,labels,body
2900075864,Add a test for cumulative used with attributes other than value,newfrenchy83,2025-10-09 09:47:46+00:00,,{'Unit Tests': 1},This is to show that cumulative only works with the value attribute.
2899697497,Enable float conversions with utils::from_chars,Vultraz,2025-10-09 07:36:54+00:00,2025-10-09 11:54:52+00:00,"{'MP': 1, 'Units': 1, 'Lua API': 1}","Toward #10427. More importantly, it adds whitespace and leading + sign stripping that was missing from the previous implementation."
2898713078,WoF game play updates,Jonathan-Kelly,2025-10-08 20:50:58+00:00,,"{'Graphics': 1, 'Audio': 1, 'Units': 1, 'Campaign WoF': 1}","From community feedback given since 1.18.

The biggest change is the reduction of recall costs for level 2 and especially level 3 units, along with some interpolation between them based on how many experience points a unit has.

Planning to tackle story, map and art changes in a separate pull request following this one.

Resolves #8757"
2888311837,Bugfix unit_frame::get_overlaped_hex() redone [LLM assisted],mentos987,2025-10-05 19:20:33+00:00,,"{'Graphics': 1, 'Units': 1}","fixes #7626

This is an old issue where we miss redrawing some hexes that contained the last frame. This happens as the unit moves quickly, in this case from a combination of scrolling and moving.

I solve this by making a list of the hexes that a frame is on. Later, on the next frame, I add that list (last_redraw_hexes_) to tiles that needs redrawing.

I also commented out a lot of lines that currently does not seem to do anything, I need a second opinion before I remove any.

Here are 2 pictures of the issue.
<img width=""524"" height=""760"" alt=""bild"" src=""https://github.com/user-attachments/assets/b379111c-c9e7-43ac-9a4b-6e105c0f5933"" />
"
2886695511,"Add ""oceangoing"" and ""push-poles"" [defense] abilities to ships",Dalas121,2025-10-04 02:55:36+00:00,,{'Units': 1},"Following up on #10576, this PR adds two new abilities for different archetypes of ships, altering their defense on certain mixed aquatic terrains.

Closes #10504."
2877215070,Revert e135517393a since it shows wrong defense values,soliton-,2025-10-01 07:36:53+00:00,,{'UI': 1},
2873234626,Clarify help entry for random traits of a unit type,soliton-,2025-09-30 07:22:26+00:00,,{'Help': 1},
2871958571,Timers for halo updates fixed [LLM assisted],mentos987,2025-09-29 20:24:44+00:00,,"{'Graphics': 1, 'AI/LLM assisted': 1}","This is an issue for larger animations that also change rapidly (cant see the issue if the image isn't quickly changing).

The timers for halo updating where off before, this caused two issues. 
1: The halo would lag behind 1 frame in the animation, sometimes causing it to get stuck on the wrong frame. 
2: Since smaller parts of the halo are also updated by other animation update functions there could be glitches where parts of the halo are 1 frame behind the rest.

The image contains a ""fireball"" animation, we are here at one of the first frames of the animation, where to fireball quickly emerges. In the image you see that parts of the animation are on a different frame than the rest, this is because they got updated by another update function, and the main update function for halos is constantly out of sync.
<img width=""487"" height=""414"" alt=""image"" src=""https://github.com/user-attachments/assets/256381b2-ba9c-4af0-a587-8fba2af03708"" />
"
2869020326,Mark swap functions noexcept,Vultraz,2025-09-29 04:45:15+00:00,2025-09-29 06:13:07+00:00,"{'MP': 1, 'Units': 1, 'Add-ons': 1}",
2868993068,Config: misc minor cleanups,Vultraz,2025-09-29 04:32:24+00:00,2025-09-30 06:14:42+00:00,{'Engine': 1},Just a bunch of small cleanups to config that I had sitting around.
2868932606,Return value from read_locations,Vultraz,2025-09-29 03:57:14+00:00,2025-09-29 06:05:23+00:00,{},
2868362065,optimized square_parenthetical_split() [LLM assisted],mentos987,2025-09-28 20:06:49+00:00,,"{'Engine': 1, 'AI/LLM assisted': 1}","Added and reworked early returns for square_parenthetical_split() in string_utils.ccp, a heavy parsing function. Early returns are now 85% of all calls, was 30% before this change. No errors detected in an in-game quick test.

Image is the in-game test. First for the ""complex_markers"" early return and second for the total of all early returns.
<img width=""456"" height=""41"" alt=""image"" src=""https://github.com/user-attachments/assets/fe0fc511-17f7-4bc0-a9cd-02f8a7a60a46"" />

This function is called when loading new terrain or revealing shrouded areas.
"
2868299438,Remove confusing locale dir differences,soliton-,2025-09-28 19:02:48+00:00,,"{'Building': 1, 'SCons': 1}","All variants are either relative to the data dir or not. Relative to the current working directory is just what happens naturally if LOCALEDIR is a relative path.

To keep the same behavior on windows make sure HAS_RELATIVE_LOCALEDIR is set. CMake does that on windows but SCons does not.

As far as I can tell USE_INTERNAL_DATA is not used and unless HAS_RELATIVE_LOCALEDIR is also set for some reason the behavior stays the same except for a bug when the CWD cannot be determined. If get_cwd has an error it returns the empty string so in that case a ""/"" would be prepended which is just wrong."
2867008953,EI S5 Northern Outpost - fix issue 10239,Mathis11233,2025-09-28 01:29:36+00:00,,{'Campaign EI': 1},The game would not place the bandit leader. I edited 05_Northern_Outpost.cfg where the bug takes place
2866679846,max_value and min_value support WML formulas in abilities and specials.,newfrenchy83,2025-09-27 16:41:52+00:00,,"{'Unit Tests': 1, 'Units': 1}","Previously, formula support for these attributes only existed for [illuminates]."
2865855999,Fix #10239: add Bandit leader to Northern Outpost scenario,Mathis11233,2025-09-27 01:18:16+00:00,2025-09-28 00:35:03+00:00,{'Campaign EI': 1},The game cannot place the bandit leader. Fixed it by editing 05_Northern_Outpost.cfg
2865649066,ai: don't use lexical_cast to write configs,gfgtdf,2025-09-26 22:21:00+00:00,2025-09-28 03:52:29+00:00,{'AI': 1},pr for ci run
2865152344,Make lexical_cast non-throwing,Vultraz,2025-09-26 18:35:58+00:00,,"{'AI': 1, 'UI': 1, 'Editor': 1, 'Units': 1}","Toward #10427. lexical_cast<T> now returns optional<T> instead of throwing bad_lexical_cast on failure. This allows the code to be simplified by letting the caller handling the nonexistent value. lexical_cast_default<T> still returns T, now being a simple wrapper around lexical_cast<T>.value_or(). catch blocks for bad_lexical cast were removed or adjusted as necessary."
2863425425,Sulla's Ruins: mention that Sulla was Aether Mage,babaissarkar,2025-09-26 09:58:57+00:00,2025-09-27 17:34:28+00:00,"{'MP': 1, 'Prose': 1}",Makes it more consistent with https://github.com/wesnoth/wesnoth/pull/8539.
2863335498,Android: don't set WESNOTH_PATH,babaissarkar,2025-09-26 09:38:21+00:00,2025-09-27 03:02:25+00:00,"{'Building': 1, 'Packaging': 1, 'SCons': 1, 'Android': 1}",
2861966476,Prevent duplicates in extra recruits.,Pentarctagon,2025-09-25 21:12:42+00:00,2025-09-30 21:48:13+00:00,"{'Units': 1, 'Lua API': 1, 'WFL': 1}",Fixes #10407
2860677683,Remove most uses of atoi,Vultraz,2025-09-25 13:28:30+00:00,2025-09-26 06:04:22+00:00,"{'MP': 1, 'Units': 1, 'Lua API': 1}","Toward #10427. I decided to go with utils::from_chars as a replacement and keep the same fallback to 0 in case of errors (`atoi` returns 0 on error). I left the instances in attack_prediction.cpp (commented out ancient benchmarking code, should really just be removed) and `simple_wml::string_span::to_int()` (already full of C-isms, makes sense to keep for now)."
2860552418,base64: generate constants at compile time,Vultraz,2025-09-25 12:56:13+00:00,2025-09-26 06:01:01+00:00,{'Engine': 1},These are constant based on known inputs.
2858998771,"Heir to the Throne: replace campaign, rename old version to HttT Classic",Dalas121,2025-09-25 03:38:48+00:00,,"{'Graphics': 1, 'Audio': 1, 'Translations': 1, 'Unit Tests': 1, 'WML Tools': 1, 'Units': 1, 'Schema': 1, 'Terrain': 1, 'Achievements': 1, 'Campaign HttT': 1, 'Campaign Tutorial': 1}","This is the PR to add my new HttT revision to mainline.

Thanks to everyone who commented in #10533. Following that discussion, I've decided to stick with my original plan and keep the old HttT in 1.20 mainline as ""Heir to the Throne, Classic"", integrated with the old ""Battle Training"" tutorial.

As many have mentioned, there's a lot of nostalgia for the original HttT and tutorial. Right now the maintenance burden isn't high, and I don't think the presence of a ""Classic"" campaign is unprofessional or will deter new players. All in all, I think removing something people want would be a bigger problem than keeping something people don't - and don't forget that retaining/re-attracting veteran players is just as valuable as attracting new ones.

This decision is ONLY for HttT, not a precedent for other campaigns. Other past and future revisions (TSG, for example) will still be left up to the community to maintain as addons.

There have also been a couple suggestions to rename the new campaign to something other than HttT. However, I'd like to keep the names ""Heir to the Throne"" and ""Heir to the Throne, Classic"". I think similar names is the most straightforward way to acknowledge the campaigns' similar characters and plot, while also explaining their major gameplay differences. With different names, I think we'd run into confusion about ""why do these 2 different campaigns tell the same story?""

This PR includes a number of changes not in the H2tT addon, such as:
- New events and rebalancing for S42 'A Crisis of Leadership'.
- Using the whirlpool will now disable most achievements.
- S06 'The Isle of Alduin' no longer gives Rogue Mage recruits, but Seiumus is now a loyal companion.
- Uncle Somf is no longer a loyal companion, but Harper can now recruit Rogue Mages at the Grey Wood.
- Delfador's familiar is once again a loyal companion.
- S26 'The Dwarven Doors' no longer randomly chooses between the main entrance or the mine entrance.
- Countless minor feature additions, balance changes, and bug fixes.

To preserve translations, I've left the old campaign's textdomain as ""httt"" and made the new one ""h2tt"". Let me know if that's wrong.

I've done my best to clean up the WML style beforehand, but I'm fully expecting that this'll still need more changes. Let me know what you want me to change and I'll work on them. I'll fix the CI issues that I'm sure will crop up too, ofc."
2857334588,Dalas121 patch 1,Dalas121,2025-09-24 15:08:04+00:00,2025-09-24 15:08:12+00:00,{},
2855247415,Ships: don't bob while beached,Dalas121,2025-09-24 03:35:31+00:00,2025-10-04 02:57:43+00:00,"{'Graphics': 1, 'Units': 1}","Once/if #10576 is merged, ships will have 0% defense on land.

When ships are on land (usually only possible via a coastal village), this PR replaces their usual bobbing [standing_anim] with a more stationary one."
2855245947,"Add ""careen"" [defense] ability to ships",Dalas121,2025-09-24 03:34:58+00:00,2025-10-02 23:47:17+00:00,{'Units': 1},"Following up on #10478 and #10504, this PR adds a new ""careen"" ability to ships that limits them to 0% defense when out of water."
2854984400,The Hammer of Thursagan: revise plot and scenarios,Dalas121,2025-09-24 01:16:15+00:00,,"{'Graphics': 1, 'Audio': 1, 'Units': 1, 'Achievements': 1, 'Campaign THoT': 1}","According to last year's community survey, THoT is rated our 5th-worst campaign (out of 18). Now that Delfador's Memoirs has been removed and Battle Training is no longer the tutorial, THoT is our 3rd-worst campaign.

From both my personal experience and my conversations with others, players preferred the version that was present prior to its revision in 1.15/1.16. JL42's ""About the Overall Campaign"" comment in [this forum thread](https://forums.wesnoth.org/viewtopic.php?t=20277&start=71) says it best.

To hopefully improve the campaign's standings, I've prepared this new revision, including the removal of a character added in 1.16, the restoration of one of 1.14's cut scenarios, and numerous ""Dalas-style"" scenario changes. This isn't a complete rewrite like TDG or H2tT, but is nevertheless a moderately significant change to the story and gameplay.

Where dialogue was changed, to reduce the translations load I've tried to use as much verbatim 1.14 dialogue as possible."
2853874553,Sergeant Line: reduce crossbow strikes from 3 to 2,Dalas121,2025-09-23 16:09:59+00:00,2025-09-24 15:17:32+00:00,{'Units': 1},"The Duelist and Dragoon wield a 12-1 crossbow. The Master-at-Arms and Cavalier wield a 20-1 crossbow. I this this design helps their crossbows (1 strike) feel different from regular bows (3-4-5 strikes). This also mirrors a real life differences between crossbows and bows - bows shoot faster, crossbows shoot harder (more or less AFAIK).

To help the Sergeant-line crossbows feel distinct from bows, and to reduce similarities with the Elvish Fighter line, I've extended this same few-strikes design to the Sergeant, Lieutenant, General, and Grand Marshal.

Balance team vote passed. 4 in favor, 2 abstain, 0 veto.
"
2852108122,Campaignd: remove implicit conversion from control_line,Vultraz,2025-09-23 06:25:58+00:00,2025-09-23 08:04:01+00:00,{'Add-ons': 1},
2851773099,Move starting and trailing new-lines from translation strings,Wedge009,2025-09-23 03:20:28+00:00,2025-10-09 07:08:50+00:00,"{'MP': 1, 'Translations': 1, 'Editor': 1, 'Units': 1, 'Prose': 1, 'Help': 1, 'Campaign TSG': 1, 'Campaign Tutorial': 1, 'Campaign UtBS': 1}","This was prompted by https://github.com/wesnoth/wesnoth/commit/1016bd8c4fc36c0be6f2d1eea1d9fa7e866cb128#r166256192 and could be considered an extension of #10570 (eg removing `<header>` from the Help headings).

Some large chunks of text (particularly from Help pages) have multiple paragraphs and arguably should be broken into smaller chunks. But that sort of thing is probably best left for when the strings are actually changing, so I've limited doing this only for the things I'm changing here.

I requested @babaissarkar's review because of GUI2 Help mark-up changes mainly in the traits macros but there's also at least one `<header>` that still had `text=` attached to it. I'm not sure if I'm doing the conversion 'right'. (I'm assuming you didn't convert these previously to minimise changes to translation strings - would finishing off those conversions help with #10569?)

I also added a few po-hints for the Help text relating to in-game commands, specifying that the command text shouldn't be translated.

Edit: I initially started moving bullet points out of the translation strings but then remembered that wouldn't work for RTL languages, so I left them as they are."
2850855655,Fixup tests,Vultraz,2025-09-22 19:35:22+00:00,2025-09-23 06:21:30+00:00,"{'Add-ons': 1, 'Engine': 1}","Apparently, having operator!= defined for prevents operator rewriting, so comparison between a reversed string and t_string fails since it can't use the plain t_string to string function..."
2848156805,Ease (future) translation overhead,Wedge009,2025-09-22 06:57:12+00:00,2025-10-09 07:08:16+00:00,"{'Translations': 1, 'Units': 1, 'Prose': 1, 'Campaign EI': 1, 'Campaign TSG': 1, 'Campaign WoF': 1, 'Campaign TDG': 1}","...by removing mark-up from translation strings.

There is perhaps an argument for allowing translators to have some control over formatting, but I think in many cases it is unnecessary overhead.

There were more cases that I could have changed (and perhaps some I shouldn't have), but in general I think I followed the rough guide of if the mark-up applies to the whole string I think it is simpler to just drop it from the translation.

As a counter-example, Dalas sometimes has long strings of dialogue, followed by a span of smaller text to indicate the speaker mumbling or otherwise talking softly to themselves. I left these ones alone for now.

I considered doing something like this previously, but thought it was too much to try to review all translation strings. I was prompted to give it a try after finding some string updates due to things like f34d6155ce3e50b4290c0baf5eb7a482ba94d2df."
2846375931,Editor: Move scenario components when resizing scenario's map,babaissarkar,2025-09-20 16:19:16+00:00,,{'Editor': 1},"Resolves #10520

**TODO**
- [x] Move unit (undoable)
- [x] avoid unit suddenly showing idle animation after move
- [x] Move items
- [x] Move labels (undoable)
- [x] make item moving undoable (needs a new editor action)
- [x] move Time Areas

**NOTE**
Due to the way map coordinates work in hex grid, visual adjacency after resizing is not guaranteed.

Before:
<img width=""208"" height=""165"" alt=""Screenshot from 2025-09-20 21-44-32"" src=""https://github.com/user-attachments/assets/6b1e40f5-dabf-4acf-a71f-8986f4ba6bc1"" />
After resize (add 1 to width):
<img width=""262"" height=""249"" alt=""Screenshot from 2025-09-20 21-44-40"" src=""https://github.com/user-attachments/assets/5b1d7929-ea10-4093-8966-bec3745af14c"" />
"
2840560031,Test scenario: Give the Shyde a new slows that only works in forest,stevecotton,2025-09-18 14:41:38+00:00,2025-09-21 20:31:48+00:00,{'Unit Tests': 1},"Weapon specials can have location filters, even if they're applied directly to the weapon rather than being used like abilities. This gives the Shyde a special which should be shown as inactive except when moving to or attacking from a forest hex.

Currently (commit ee7f4c047a4) the sidebar always shows it as active, because the sidebar uses a weapon context that doesn't know which hex it should be used in."
2840088075,Add tests for reversed-order config heterogenous comparison,Vultraz,2025-09-18 12:35:36+00:00,2025-09-18 20:32:16+00:00,{},Expecting these to initially fail on C++17.
2839463180,Minor include cleanup,Vultraz,2025-09-18 09:26:42+00:00,2025-09-18 12:12:50+00:00,"{'AI': 1, 'UI': 1, 'Units': 1}",
2839137194,Test scenario: the Silver Mage teaches marksmanship,stevecotton,2025-09-18 07:47:53+00:00,2025-09-18 13:48:22+00:00,{'Unit Tests': 1},"Any unit within 2 hexes gets 80% chance to hit on their ranged attacks, but only when on offense. This is for testing the sidebar's showing of active and inactive taught weapon specials.

If you move the Dark Adept with the darkness aura north-east, it will get taught a weapon special. While it's on the currently playing team, the weapon special shows on the sidebar.

Changing the Dark Adept to side 2 will make it inactive. PR #10538 will make that special show on the sidebar even when its inactive."
2839017504,Test scenario: put a sensible filter on the shroud change,stevecotton,2025-09-18 07:11:46+00:00,2025-09-18 08:56:52+00:00,{'Unit Tests': 1},"It's not been annoying enough to fix until now, but it always triggered on the first moveto event."
2837972442,add_overlay extended: drawing_layer [LLM assisted] (last one),mentos987,2025-09-17 21:09:50+00:00,,"{'Lua API': 1, 'AI/LLM assisted': 1}","Enables images (items not halos) to be placed at any of the existing drawing layers, not just the default ""terrain_bg"".
Not to be confused with z_order input, which controls how images are layered within a drawing_layer.

Called in WML like:

```
[item]
	x,y=93,161
	halo=data/core/images/items/armor.png
	drawing_layer=arrows
[/item]
```

or in Lua like:

`wesnoth.interface.add_hex_overlay(103, 161, { drawing_layer=""grid_bottom"", multihex=true, image = ""data/add-ons/Animated_Weather_and_Scenery/images/scenery/god_game/1/[1~6].png~O(60%)""})`

The input names are gathered form drawing_layer.hpp, here is a list of them:
`terrain_bg,grid_top,mouseover_overlay,footsteps,mouseover_top,unit_bg,unit_default,terrain_fg,grid_bottom,unit_move_default,unit_fg,unit_missile_default,mouseover_bottom,fog_shroud,arrows,actions_numbering,selected_hex,attack_indicator,unit_bar,move_info,linger_overlay,border,reachmap_highlight,reachmap_border`

I am unsure of the best way to handle this input list, a discussion of further changes is needed.

If you test this code and see that the center hex is dark -- know that this an old bug recently fixed in another PR.

Look at the last commit to see the relevant code for this drawing_overlay PR, since this is stacked on top of other PRs

Suggested documentation change.
At https://wiki.wesnoth.org/InterfaceActionsWML#.5Bitem.5D after ""team_name"" add:
""drawing_layer: (string, default: terrain_bg) This specifies in what layer an overlay is drawn. It accepts a string name that maps to a specific layer, such as unit_fg (in front of units) or terrain_bg. Using an invalid string will cause the overlay to default to the terrain_bg layer. Valid layers are:""

follow that with either a link to github drawing_layer.hpp or make a hidden/spoiler list like:
""
```
terrain_bg: The base layer for drawing terrain.

reachmap_highlight: An alias for terrain_bg, used for highlighting reachable tiles.

grid_top: The top half of the grid image.

mouseover_overlay: A special overlay used by the editor.

footsteps: An overlay for showing a unit's path.

mouseover_top: The top part of an image following the mouse cursor.

unit_bg: The layer for the ellipse drawn behind a unit.

unit_default: The default layer for drawing most units.

terrain_fg: The layer for terrain drawn in front of a unit.

reachmap_border: An alias for terrain_fg, used for the border of a reachable area.

grid_bottom: The bottom half of the grid image, drawn under moving units.

unit_move_default: The default layer for drawing moving units.

unit_fg: The layer for the ellipse drawn in front of a unit.

unit_missile_default: The default layer for missile animations.

mouseover_bottom: The bottom part of an image following the mouse cursor.

fog_shroud: The layer for fog and shroud effects.

arrows: The layer for drawing arrows from the arrows framework.

actions_numbering: The layer for movement numbering.

selected_hex: The layer for drawing the selected hex indicator.

attack_indicator: The layer for drawing the attack indicator.

unit_bar: The layer for unit health and experience bars.

move_info: The layer for displaying information about movement, like defense percentage.

linger_overlay: The overlay used for ""linger mode.""

border: The layer for the border of the map.
```
""


<img width=""774"" height=""539"" alt=""bild"" src=""https://github.com/user-attachments/assets/cf7e987e-c714-4c3a-a92f-930ae0ca0830"" />
"
2837228854,Use tuples instead of an out parameter for specials' tooltips,stevecotton,2025-09-17 16:22:14+00:00,,"{'UI': 1, 'Units': 1, 'Help': 1}","There was only one caller for attack_type::abilities_special_tooltips(), so this can hardcode that it always wants inactive specials to be included in the list.

@newfrenchy83 I was thinking of this sort of thing might be good before #10538. Currently barely tested, but opening a PR to share it with you."
2835865926,side_ai.cfg: fix textdomain to correct one,knyghtmare,2025-09-17 09:25:38+00:00,2025-09-17 10:19:51+00:00,{'Campaign L': 1},
2835864942,correct documentation in [defense] test,newfrenchy83,2025-09-17 09:25:20+00:00,2025-09-17 11:25:04+00:00,{'Unit Tests': 1},
2834230148,GUI2/Campaign Selection: use initializer lists for nodes,Vultraz,2025-09-16 20:02:47+00:00,2025-09-16 23:30:33+00:00,{'UI': 1},
2833509322,add_overlay extended: duration [LLM assisted],mentos987,2025-09-16 15:31:00+00:00,,"{'Lua API': 1, 'AI/LLM assisted': 1}","Enables a timed duration for images and halos. After the time runs out the image is automatically removed. 

Called in WML like:

```
[item]
	x,y=102,157
	image=data/add-ons/Animated_Weather_and_Scenery/images/great_continent.png
	duration=25000 
[/item]
```

or in Lua like:

`wesnoth.interface.add_hex_overlay(103, 161, { duration=3700, multihex=true, image = ""data/add-ons/Animated_Weather_and_Scenery/images/scenery/god_game/1/[1~6].png~O(60%)""})`

Why this is needed: Previous solutions to this problem was to either force a wait and then remove (locking the game while waiting) or to add empty images to the end of an animation that lasts forever. 

When duration is enabled the items will not be stored in Lua or WML or savefile. They are just temporary visual overlays. Should be safe from sync issues.

If you test this code and see that some hexes are dark -- know that this an old bug recently fixed in another PR.

Look at the last commit to see the relevant code for this duration PR, since this is stacked on top of other PRs.

Suggested documentation change.
At https://wiki.wesnoth.org/InterfaceActionsWML#.5Bitem.5D after ""z_order"" add:
**duration:** (integer,  default: 0) If above 0, this specifies that the overlay is temporary and will be automatically removed after the specified number of milliseconds has passed. ""duration=4600"" - will be removed after 4.6 seconds. Images with a duration will not be stored in WML/Lua/savefile and can not be used for anything but pure visuals and will not persist over save/load. Works for images and halos. 

https://github.com/user-attachments/assets/dfbbe838-6972-49b3-a153-1df8eed76db5

"
2831833355,Note in CONTRIBUTING.md that code doesn't always match clang-format,stevecotton,2025-09-16 07:28:54+00:00,2025-09-23 19:05:58+00:00,{'Docs': 1},"Format CONTRIBUTING.md's example code with clang-format

Correct the setting of PackConstructorInitializers, as it didn't match the example; setting it to CurrentLine was worse because my_class' constructor ended up with everything including the `//` comment on the same line, so the position no longer made it obvious that the comment referred to an argument.

This converts spaces to tabs in the example, but it's not just whitespace changes.

The #include ""gettext.hpp"" and #include ""help/help.hpp"" lines are now sorted alphabetically.

The lambda function is short, thus all on a single line.

Note that we're incrementally moving towards the standard rather than doing a project-wide reformat that would break the git-blame history."
2831482721,Remove implicit attribute value conversion to t_string,Vultraz,2025-09-16 05:24:55+00:00,2025-09-18 07:55:05+00:00,"{'AI': 1, 'MP': 1, 'UI': 1, 'Units': 1, 'Help': 1, 'Terrain': 1}",
2831315054,"Fix ""no previous prototype for function"" warnings on Xcode 26",irydacea,2025-09-16 04:15:04+00:00,2025-09-16 06:04:34+00:00,"{'macOS': 1, 'Building': 1}","Since this is seemingly meant to be a private function, move its two implementations to the closest anonymous namespace and drop the prototypes to avoid the issue altogether."
2830543119,Mark t_string_base ctors explicit,Vultraz,2025-09-15 20:24:37+00:00,2025-09-15 23:19:47+00:00,{},
2830316196,TSG: use Asmodeus's new portrait for Mari,Dalas121,2025-09-15 18:59:36+00:00,2025-09-21 16:07:48+00:00,"{'Graphics': 1, 'Campaign TSG': 1}","Add portrait for Mari in TSG. Credit to Asmodeus / Joseph Gignoux.
"
2830315769,TSG: fix missing bun on 2 frames of Mari's defense animation,Dalas121,2025-09-15 18:59:23+00:00,2025-09-15 20:44:01+00:00,"{'Graphics': 1, 'Campaign TSG': 1}",How didn't I notice this before?
2827916390,Update .clang-format,Vultraz,2025-09-15 06:00:13+00:00,2025-09-15 19:30:32+00:00,{},Went through the clang-format docs and added new options that best match our existing coding style.
2827132137,Fix off-by-one error in padding calculation for progressive strings,soliton-,2025-09-14 20:38:45+00:00,2025-09-21 16:43:28+00:00,{'Engine': 1},
2827078499,add_overlay extended: multihex [LLM assisted],mentos987,2025-09-14 19:42:47+00:00,,"{'Lua API': 1, 'AI/LLM assisted': 1}","Enables multihex images at the terrain drawing layer (not via halo) without having to use the terrain_graphics system.

Called in WML like: 
```
[item]
	x,y=102,157
	image=data/add-ons/Animated_Weather_and_Scenery/images/great_continent.png
	multihex=yes
[/item]
```
		
or in Lua like:

`wesnoth.interface.add_hex_overlay(103, 161, { multihex=true, image = ""data/add-ons/Animated_Weather_and_Scenery/images/scenery/god_game/1/[1~6].png~O(60%)""})`

If you test this code and see that the center hex is dark -- know that this an old bug recently fixed in another PR.

Look at the last commit to see the relevant code for this multihex PR, since this is stacked on top of other PRs

<img width=""1450"" height=""848"" alt=""image"" src=""https://github.com/user-attachments/assets/09596061-b929-4e1d-9cda-19915103c4f3"" />
"
2826855102,remove [filter_adjacent(_student)] and [filter_adjacent(_student)_location],newfrenchy83,2025-09-14 15:58:24+00:00,,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1}","
I know that I myself made feet and hands so that these functions become functional, but since maintaining these shorthands complicate the WML, as much to remove it for this reason. And do not suggest that it is because the source code did not work."
2826589169,MP: Fix lag during AI turns on 5P The Wilderlands,stevecotton,2025-09-14 11:05:44+00:00,2025-09-14 14:57:58+00:00,"{'MP': 1, 'Stable 1.18': 1}","Opening a PR just for the CI run, this is a simple backport.

The filter on the unit_placed event didn't check if the unit was already loyal, and after 4 turns, the first unit belonging to side 5 had over 600 of these [object]s.

Thanks to gfgtdf for pointing out that the macro's upkeep=loyal will only last until the unit is rebuilt, so even the units created at the start should use an [object].

Any Walking Corpses created via plague won't get the object, but it will be added if they advance to Soulless.

Fixes #10419
Backports #10482"
2826267661,set expectations around LLM generated code,Pentarctagon,2025-09-14 03:39:21+00:00,2025-09-18 23:28:02+00:00,{'Docs': 1},
2824548664,let queues randomly select a scenario from a list,Pentarctagon,2025-09-13 03:43:26+00:00,2025-09-17 19:18:29+00:00,"{'MP': 1, 'MP Lobby': 1, 'UI': 1}",
2824477374,Replace S10x Elensefar map,Dalas121,2025-09-13 02:47:14+00:00,2025-09-13 15:31:47+00:00,{'Campaign TDG': 1},The upcoming HttT revision features a new Elensefar map. This PR changes TDG's Elensefar map to stay consistent.
2824415570,Use the default music playlist for Dark Forecast and Isle of Mists,Discontinuum,2025-09-13 01:25:45+00:00,2025-09-13 07:48:31+00:00,{'MP': 1},"So I played Dark Forecast last time and suddenly noticed that the soundtrack seems never changing. It turns out it's just three tracks. I find the resulting mood pretty dull, especially considering how the gameplay goes. I think it's better to just use DEFAULT_MUSIC_PLAYLIST as all other MP scenarios do."
2824084236,Liberty 1.20 adjustments,Dalas121,2025-09-12 21:34:04+00:00,2025-09-13 14:54:00+00:00,"{'Graphics': 1, 'Units': 1, 'Achievements': 1, 'Campaign L': 1}","This is a collection of small changes to Liberty, to stay consistent with the other campaigns in the intended new player arc: TSG -> [todo] -> TDG I -> TDG II -> Liberty -> HttT.

* Changed some of Maddock's dialogue to stay consistent with The Deceiver's Gambit.
* Difficulty scaling now follows the same pattern as the other beginner campaigns: 1x enemies, 2x enemies, 3x enemies.
* Use the new Elensefar map from the revised Heir to the Throne.
* Various minor bugfixes and tweaks.
"
2822866783,Fix abilities_special_tooltips() so that 'name_affected' is displayed the same way as [specials],newfrenchy83,2025-09-12 14:09:31+00:00,,"{'Unit Tests': 1, 'Units': 1}","Can resolve https://github.com/wesnoth/wesnoth/issues/10535 issue.

For example, if you have a marksman taught to a distant unit and its side isn't the one currently playing its turn, the 'name_affected' that should appear in its distance attack in the ini sidebar disappears. This PR changes this so that it is displayed inactive like a real special marksman.

The general idea is to do a two-step check, first check that the ability applies to 'self/student', taking into account only the filters used for 'self' [filter_student], but also [filter_attacker/defenser] depending on the circumstances, while ignoring the other filters and the 'active_on' attribute, and if these conditions are met, display 'name_affected', then comes the second more standard check where we look at everything, and if the check succeeds 'name_affected' is displayed as active, otherwise, it will be displayed as inactive"
2820697669,Revert 'Balancing Update' to Dwarvish Miner,moonymeric,2025-09-11 22:42:30+00:00,,{'Units': 1},"Resets HP and XP back to their values from 10 months ago.

hitpoints: 25 -> 22
experience: 20 -> 24

The Dwarvish Miner is already a tough unit with great resistances, movement_type, traits, advancements and damage. Giving it almost the same HP as the Wose Sapling is out of proportion, both in relation to the HP of comparable units, and because it makes the Miner impossible to kill by units of the same level.

Also, setting the XP to 20 means an intelligent Miner can advance with two L1 kills, which is too fast for a unit that advances into a Dwarvish Guardsman/Fighter. Those two are among the toughest default L1 recruits, so this gives a massive advantage to the side that can acquire them so *quickly*."
2818723054,Fix ability special tooltip not showing name_affected when not playing side,newfrenchy83,2025-09-11 11:07:16+00:00,2025-09-11 18:04:54+00:00,{},"
If the affected unit belongs to a side whose turn has not yet come, the 'name_afected' attribute will not be shown, this fix allows the display with the 'inactive' color"
2815805001,Editor controller: Allow selecting another addon even if one is selected,babaissarkar,2025-09-10 14:48:13+00:00,2025-09-11 04:46:10+00:00,"{'UI': 1, 'Editor': 1}",Resolves #10511
2815271077,Parallax for units [LLM assisted],mentos987,2025-09-10 12:05:49+00:00,,"{'Graphics': 1, 'Units': 1, 'Schema': 1, 'AI/LLM assisted': 1}","Enables parallax visuals for units by using new input: parallax_mult

Used inside unit.cfg files like:
```
[frame]
   image=""units/bats/bloodbat-ne-[3,4].png:[1,100]""
   parallax_mult=1.05
[/frame]
```

This commit includes changing of Bat_Blood.cfg as a test case. If this is approved then all flying units will have get the parallax_mult added in their .cfg files.

This is mostly useful for flying units.

Further improvements along this route would probably entail separating/segmenting the flying unit from its shadow, and having no parallax on the shadow. We could then place the flying unit further up from its shadow and increase the parallax a bit.

This image separation/segmentation would also allow ground units to have parallax effects (you could segment the legs into one [frame] and the upper body in another and run different parallax on them)

The video here is rather choppy and thus difficult to catch the parallax bats in it (it looks better in-game)

https://github.com/user-attachments/assets/d6b52ae4-bddb-49bb-b3a4-f150f4185b92


"
2813032045,add_overlay extended: parallax [LLM assisted],mentos987,2025-09-09 19:22:36+00:00,,"{'Graphics': 1, 'Lua API': 1, 'AI/LLM assisted': 1}","This PR adds optional input for parallax effect on halos. 

Called like:

```
[item]
	x,y=93,161
	halo=data/core/images/items/armor.png
	parallax_mult=1.1
[/item]
```
or

`wesnoth.interface.add_hex_overlay(93, 161, { parallax_mult=1.1, halo = ""data/core/images/items/armor.png""})`

https://github.com/user-attachments/assets/8784d4b9-548c-4f17-8ba5-6a82c3530c33


"
2806124673,TDG: Asheviere's Dogs reversions,Dalas121,2025-09-07 15:05:36+00:00,2025-09-08 15:33:47+00:00,{'Campaign TDG': 1},"Before TDG was added to mainline, I made some adjustments to the campaign to stay compatible with the upcoming ""Asheviere's Dogs"" campaign. However, the ""Asheviere's Dogs"" author is now planning to make some major revisions to his campaign, which has delayed its entry to mainline until 1.21.

Therefore, I'm making some further changes to the final few scenarios so as to lead more smoothly into Liberty and Heir to the Throne. This PR also includes some improvements to those scenarios' dialogue based on @doofus-01's feedback.
"
2806108286,add a 'base_cth' attribute in [chance_to_hit],newfrenchy83,2025-09-07 14:39:28+00:00,,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1, 'Campaign EI': 1, 'Campaign SoF': 1, 'Campaign UtBS': 1, 'Campaign TDG': 1}","I've already proposed this approach in https://github.com/wesnoth/wesnoth/pull/10279, but since creating a special [defense] weapon is a mistake, perhaps it will be accepted this time.

When this attribute is used, the resulting cth value is treated as a base value by chance_to_hit that doesn't use this attribute, other specials that affect chance to hit will  take precedence over this special.

"
2806039427,New IPF: PAD [LLM assisted],mentos987,2025-09-07 12:45:40+00:00,2025-09-28 20:46:57+00:00,"{'Graphics': 1, 'AI/LLM assisted': 1, 'Squash': 1}","Adds a new image path function ""OFFSET"", that offsets an image by an amount of pixels.

Used like:

```
[item]
	x,y=98,157
	image=data/core/images/items/armor.png~SCALE(50, 50)~OFFSET(-8,18)
[/item]
```
The armour in the image was shifted by this.
<img width=""1011"" height=""359"" alt=""image"" src=""https://github.com/user-attachments/assets/f01beaf1-fe90-4f5e-88ea-23f806913bcf"" />

Documentation will have to be added too, I will look into that if this is accepted.

"
2804840307,Changing the weapon special [defense] into an ability,newfrenchy83,2025-09-06 12:52:14+00:00,2025-09-16 15:20:11+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1, 'Campaign UtBS': 1, 'Campaign TDG': 1}","Resolve https://github.com/wesnoth/wesnoth/issues/10478 issue

make [defense] a generic abilitie ."
2803755018,"Revert ""Add [defense] ability to be able to modify base cth while be overwritable by [chance_to_hit] (#10279)""",Pentarctagon,2025-09-05 22:04:03+00:00,2025-09-13 03:41:50+00:00,"{'MP': 1, 'Unit Tests': 1, 'UI': 1, 'Units': 1, 'Schema': 1, 'Campaign UtBS': 1, 'Campaign TDG': 1}","This reverts commit e0dd4e801c09d46946a91d2d27b2be763ac3e3e3.

---

After discussing on Discord, there wasn't anyone who had a concrete use case for [defense] as a weapon special that they could think of. So rather than continuing to debate how it works, the naming of it, etc I think it'd be better to revert it.

Also more generally, I think it'd be good to avoid adding further complexity to the abilities C++ code for the sake of simplifying the WML needed to implement different ability effects."
2801936255,DW units: add generic mace attack animationWML,knyghtmare,2025-09-05 08:55:17+00:00,2025-09-05 12:46:05+00:00,"{'Units': 1, 'Campaign DW': 1}",closes #10519 
2799370892,add_overlay extended: animation [LLM assisted],mentos987,2025-09-04 13:02:20+00:00,,"{'Graphics': 1, 'Translations': 1, 'UI': 1, 'Units': 1, 'Add-ons': 1, 'Help': 1, 'Campaign DW': 1, 'Campaign TDG': 1, 'AI/LLM assisted': 1}","This PR aims to provide more options for image placements via the overlay system. Such a as [item] or wesnoth.interface.add_hex_overlay()

In order to make it simpler to review I will be remaking the other PR here. https://github.com/wesnoth/wesnoth/pull/10505

I'll try to split the code up in 1 commit per feature. And I'll publish each feature in this PR as I make them.

First of is the adding of animations.

Called like:

```
[item]
	x,y=101,158
	image=data/add-ons/Animated_Weather_and_Scenery/images/scenery/god_game/2/00[14~20].png:80
[/item]
```
		
or

`wesnoth.interface.add_hex_overlay(103, 161, { image = ""data/add-ons/Animated_Weather_and_Scenery/images/scenery/god_game/1/[1~6].png""})`


https://github.com/user-attachments/assets/3ecf3830-08e4-49cb-af6e-9b700a4e2035

"
2795565066,Bugfix for get_hexed in picture.ccp,mentos987,2025-09-03 11:13:35+00:00,2025-09-05 18:53:06+00:00,{'Graphics': 1},"rgb values for SDL_MapRGBA() goes from 0 to 255. 128 is neutral. The numbers were set to 0 which caused the image to darken.

Here is an image of before/after of a hex with an image of rain in it. 

<img width=""658"" height=""325"" alt=""image"" src=""https://github.com/user-attachments/assets/00cd1564-e99b-4fb7-a0f1-64eccf905f38"" />
"
2793382050,Fix some capitalization issues in new boat unit descriptions,Gothyoba,2025-09-02 16:59:44+00:00,2025-09-03 17:08:53+00:00,{'Units': 1},Some of these new boat descriptions aren't following the typography style guide's convention of capitalizing unit names.
2792177359,Help: Add positioning info to parse errors,babaissarkar,2025-09-02 10:42:43+00:00,2025-09-07 01:54:55+00:00,"{'UI': 1, 'Help': 1}","Resolves #4590 (Help browser can already deal with `&amp;`, and shows error messages in the page if invalid.)

Adds Line/Character position info in Help Markup Parser errors.

<img width=""592"" height=""112"" alt=""Screenshot from 2025-09-04 18-41-38"" src=""https://github.com/user-attachments/assets/669fd248-13d9-4252-a9f1-627d3c1cb989"" />

Source:
```ini
    [topic]
        id=..introduction
        title= _ ""Introduction""
        text=""<img src='misc/logo-bg.png~BLIT(misc/logo.png)' float='yes' align='center'/><clear/>"" + _ ""
<i>Battle for Wesnoth</i> is a turn-based fantasy strategy game somewhat unusual among modern strategy games. While other games strive for complexity, <i>Battle for Wesnoth</i> strives for simplicity of both rules and gameplay. This does not make the game simple, however — from these simple rules arises a wealth of strategy, making the game easy to learn but a challenge to master.

The following pages outline &all you need to know to play Wesnoth. As you play, new information is added to the various categories as you come across new aspects of the game. For more detailed information on special situations and exceptions, follow the included links.""
    [/topic]```"
2790658391,Add commands for the host or a moderator to change the host of a game.,kencheng,2025-09-01 20:00:49+00:00,,{'MP': 1},"Fixes https://github.com/wesnoth/wesnoth/issues/2536.

The host of the game can use `/transferhost <nick>` to transfer the host to `<nick>`, and a moderator can use `/query setashost <nick>` to change the host of the game that `<nick>` is in to `<nick>`."
2789811818,Remove nonsense check,soliton-,2025-09-01 13:19:32+00:00,,{'Editor': 1},
2788024970,AToTB S3: Add new event when standing between two runes,Gothyoba,2025-08-31 20:02:34+00:00,2025-10-05 22:08:32+00:00,{'Campaign AToTB': 1},"Forum user JL43 mentioned this in their review of AToTB S3 (https://forums.wesnoth.org/viewtopic.php?p=685198#p685198)

> It would also be more fun if there were additional ""surprises"" or points of interest in the castle – currently there's a bunch of decorations strewn all over, but most of them don't do anything.

Forum user SigurdFireDragon suggested the runes in the map should have some purpose, thouh this is not what I did here (https://forums.wesnoth.org/viewtopic.php?p=592642#p592642):

> I'd like to see the rune glyphs in the upper right hand corner of the castle provide healing. In this play-though, I sent a poisoned knight there thinking they'd provide healing. I've seen the glyphs used to denote healing spaces in other campaigns. (UtBS, I think) I'd be helpful to counter poison for a unit or two.

Forum user ftl suggested to give some of the decorations purpose (https://forums.wesnoth.org/viewtopic.php?p=411819&sid=14629ef689ffa7b0c71f9c41b3e79421#p411819):

> The castle was very ornate, and had some eye-candy (statues, goblets, etc.) which didn't do anything. Might've been cool to have some more events happen - a secret door, maybe a trap, or something - but then again there were already the passwords for guards and the treasure chest, and having to bring a key to open the cell, so maybe that's enough gimmicks for one scenario.

Based on this it seems there’s some demand to add some sort of purpose or event related to some of the decorative parts of this map. This PR adds a small event when a unit stands between the two runes on the map, in which they summon a Soulless by accident. It serves no purpose, and the Soulless is easy to defeat, but it does make this area a little more interesting."
2787904683,create a [individual_defense] self ability,newfrenchy83,2025-08-31 16:35:30+00:00,2025-09-01 16:16:47+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1}","
Can be a resolve to https://github.com/wesnoth/wesnoth/issues/10504 issue

can only affect ti's owner. [affect_adjacent] don't work here"
2787753367,TDG - small fixes,doofus-01,2025-08-31 14:12:21+00:00,2025-09-20 22:58:09+00:00,"{'Graphics': 1, 'Campaign TDG': 1}","A couple of small issues
- [x] fix enthrall drake overlay auto_hflip
- [x] alternative to white castles in _Long Live the Queen_"
2787724816,Remove unnecessary differences between Bone Knight and Skeleton Rider unit descriptions,Gothyoba,2025-08-31 13:28:48+00:00,2025-09-01 00:42:16+00:00,{'Units': 1},"Ideally both descriptions should be different, but two slightly different words between these are unnecessary and it feels like one may have been updated without updating the other at some point."
2787705627,add_overlay extended,mentos987,2025-08-31 12:57:30+00:00,2025-09-04 20:54:14+00:00,"{'Lua API': 1, 'Schema': 1}","First of. I am a novice to github and c++, no doubt  there will be rewrites needed. 

This is done in order to extend image placement functions to allow for: animations, multi-hex images and drawing layer inputs. All optional inputs.

This will give the content creators a lot more freedom in what they want their images to do.

Other changes:
Bug fix were cutting an image with an ""image::HEXED"" caused the image to darken.
Image removal is changed to allow for multi-hex removal.
Image removal also gets optional input to allow for a partial string match rather than a full one. This makes it simpler to remove an image when you don't know its full string, something that can happen with a lot of IPF modifications. (This is not needed for the rest of this code to work)

This is tested on Windows 10 and seems to work fine. No issues detected.

Call examples:

    //wml

    //add multihex animation
        [item]
	        x,y=105,158
	        image=data/add-ons/Animated_Weather_and_Scenery/images/weather/rain_heavy/00[01~20].png
	        multihex=yes
        [/item]
    
    //remove multihex animation from above
        [remove_item]
	        x,y=105,158
	        image=weather/rain_heavy
	        do_partial_string_match=yes
        [/remove_item]
    
    //lua
    
    //add great continent map on top of in-game terrain (see image below)
    //add "" drawing_layer = ""arrows"" "" in there and the image will be drawn at the arrow level (above the units)
        wesnoth.interface.add_hex_overlay(68, 57, { image = ""data/add-ons/Animated_Weather_and_Scenery/images/great_continent.png"", multihex = ""yes""})

    //remove
        wesnoth.interface.remove_hex_overlay(68, 57, ""ages/great_continent"", true)

<img width=""687"" height=""429"" alt=""image"" src=""https://github.com/user-attachments/assets/0cd693f3-4599-457f-b04a-c20ef1b95c17"" />


Edit, this has CRLF line endings, I'm guessing if should be LF. I'll change over later.

Edit 2, it also occurs to me now that a multi-hex image may get 1-hex-size children that are fully transparent. I will weed these out next.

Edit 3, When removing the children overlays we accidentally clear the entire child hex of all overlays, not just the child. I will change this.

Edit 4, no need to recall make_overlay_crop() for every frame, 1 time per hex is enough. Will rework.

Edit 5, also missed to enable ""drawing_layer"" as input from WML code (only Lua atm). Will add."
2787518385,Stop overwriting unit test replays,soliton-,2025-08-31 08:28:18+00:00,,"{'Replays': 1, 'Unit Tests': 1}",As a side effect we'll get a history of unit test replays from CI runs.
2786961856,"Config Attribute Value: compare string-like types directly, remove heterogenous comparison for integers",Vultraz,2025-08-30 17:38:56+00:00,2025-09-15 19:45:08+00:00,"{'Unit Tests': 1, 'Lua API': 1, 'Engine': 1}",Also fixes comparison with std::string_view on the legacy codepath
2786438154,Help hidden topic improvement,babaissarkar,2025-08-30 02:43:05+00:00,2025-08-30 06:16:44+00:00,"{'UI': 1, 'Help': 1}","Resolves #8853

For hidden topics, there may not be a corresponding `tree_view_node`, so makes corresponding checks optional."
2784950347, fix #10496 OOS when using DSU,gfgtdf,2025-08-29 13:48:07+00:00,2025-08-29 17:01:32+00:00,{},"the old code tried to prevent the creation of a dummy undo stack entry for toggling shroud updated if there are no elements in te undo stack before. However the old way of doing this resulted in the action being removed from the replay recorder aswell , leading to OOS.


Now we just always block undo in this case.

The optional paramter in get_auto_shroud does in theory allow us to make it undoable again later in a save way."
2782753921,AToTB S4 Map: Aesthetic Revision,Gothyoba,2025-08-28 19:21:56+00:00,2025-08-29 12:04:41+00:00,{'Campaign AToTB': 1},"@Dalas121 Very minor aesthetic changes to this map. I have made sure this map's new embellishments don't overlap with ruined houses seen in the scenario.

Current Map:

![AToTB_S3](https://github.com/user-attachments/assets/952bcdba-a3ba-48ac-8c48-540a74276ee4)

Proposed Map:

![AToTB_S3_FINAL](https://github.com/user-attachments/assets/144ce9bb-494c-41f1-829c-bee684a5f11e)"
2782632855,Implement [filter_adjacent_location] inside unit filter and deprecate abilities/specials [filter_adjacent(_student)] and [filter_adjacent(_student)_location],newfrenchy83,2025-08-28 18:27:04+00:00,2025-08-29 06:35:35+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1}","
By implementing this shorthand of [filter_location][filter_adjacent_location] in the unit filter, it can be used in both [filter] and [filter_self] as well as the equivalents in special weapons and thus deprecated the other shorthands"
2782456288,Units Dialog (Recall): sort by experience to next level,babaissarkar,2025-08-28 17:15:05+00:00,2025-08-28 21:48:24+00:00,{'UI': 1},"Resolves #10480

In Units Dialog (Recall), changes primary sort order to experience required to reach next level, secondary sort is by max experience."
2779369803,Some readability improvements for the message dialog WML,soliton-,2025-08-27 19:09:46+00:00,2025-09-21 16:19:17+00:00,{'UI': 1},
2778931166,Repair the [defense] display problem on the map.,newfrenchy83,2025-08-27 16:36:53+00:00,2025-09-06 12:48:17+00:00,{'Units': 1},"Resolve https://github.com/wesnoth/wesnoth/issues/10478 issue

As long as the ability is not limited to a specific weapon or contingent on any particular status of the opponent, the modified defense value should be displayed on the map and in the sidebar."
2778513311,Fix some issues with 'Enthrall' in TDG,newfrenchy83,2025-08-27 14:27:46+00:00,2025-08-29 21:49:17+00:00,{'Campaign TDG': 1},"Fix https://github.com/wesnoth/wesnoth/issues/10489 issue. (partially)

To fix the other issues, I have to leave the third point unresolved and restore some playability."
2774862758,"Revert ""rename [defense] special/abilities to [defense_special] (#10481)""",newfrenchy83,2025-08-26 11:49:01+00:00,2025-08-26 22:18:05+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1, 'Campaign UtBS': 1, 'Campaign TDG': 1}","
This reverts commit f5f78ce3b139a70df3f589982c83a63c050d5c16.

Due to objections to the use of _special as a suffix, I prefer to revert the changes until a better name is approved, and avoid changing the wikia multiple times for nothing."
2774477220,rechange [defense_special] to [chance_to_parry],newfrenchy83,2025-08-26 09:29:38+00:00,2025-08-26 09:38:22+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1, 'Campaign UtBS': 1, 'Campaign TDG': 1}","@Pentarctagon  , @CelticMinstrel Sorry to bother you with this again, but the term used isn't appropriate. If you have a better idea than 'parry' or a suffix, let me know BEFORE this PR is merged."
2772829070,Android: Handle errors when determining gamedata path and respect WESNOTH_PATH,soliton-,2025-08-25 19:35:18+00:00,2025-08-27 16:47:26+00:00,{'Android': 1},
2769854277,Create more conventionnal defense abilitie,newfrenchy83,2025-08-24 13:31:21+00:00,2025-08-24 17:50:23+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1, 'Campaign UtBS': 1, 'Campaign TDG': 1}","
Fix https://github.com/wesnoth/wesnoth/issues/10478 issue if not performances problems"
2769195014,MP: Fix lag during AI turns on 5P The Wilderlands,stevecotton,2025-08-23 19:46:17+00:00,2025-09-14 10:54:03+00:00,{'MP': 1},"The filter on the unit_placed event didn't check if the unit was already loyal, and after 4 turns, the first unit belonging to side 5 had over 600 of these [object]s.

The objects aren't needed at all, side 5's units are loyal anyway.

Fixes #10419"
2769100830,rename [defense] special/abilities to [defense_special],newfrenchy83,2025-08-23 18:36:20+00:00,2025-08-26 04:47:55+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1, 'Campaign UtBS': 1, 'Campaign TDG': 1}","Because of the term [defense] which is identical to the tag used in movetype, some expect that the modified defense values ​​are displayed on the map which, because of its character as a special weapon implementable in [abilities] as well as in [specials], was never the goal for me, to remove this confusion, I must therefore rename [defense_special] this ability/weapon"
2768973259,Save Index: fix dangling reference when index file does not exist,Vultraz,2025-08-23 16:49:46+00:00,2025-08-23 19:57:51+00:00,{},"If the save_index file did not exist when opening the Load Game dialog, the game could crash with a read access exception. When I first added the do-not-load-if-file-does-not-exist logic (691f9256ce134c731682d4635242b66be1824c44), I neglected to also set `loaded_` to true if the file was not found. Since `data()` had side effects - reading from the index file and setting the data_ member - the next time it was called, if the file *did* exist, this would result in a redundant read.

Prior to 02818082186faf78adc06c9378a08b57eda05511, this redundant read was no issue. `io::read_gz` took an input parameter, and if the file it was attempting to read was empty, it simply returned and did not touch the input. Once `read_gz` returned a config, however, the flaw in the original logic revealed itself. The dialog would try to get the first save's summary config, which would query the save index. The had not yet performed lazy initialization, so data() would try to load the index file and fail, since it did not exist. A new [save] child was added to the data_ config, the save file loaded, and a summary generated. The index would attempt to write the updated config back to disk and return the newly added [save] child.

Yet write_save_config *also* called data() rather than using the data_ member directly. Here, since loaded_ was still false and the index file now *did* exist (it was created in by opening a file ostream immediately prior to calling data()), the empty file was loaded from disk and data_ assigned an empty config. The child config reference was now dangling, since it was a reference into the now-empty class member.

Again, this step, though erroneous and extraneous, was a no-op before I changed the signature of read_gz to return a config. The proper fix is to set loaded_ to true even if the index file does not exist. I decided to go further and simply get rid of the lazy loading mechanism entirely, populating data_ directly in the ctor. We don't create save_index_class objects often enough for this to matter (the one managing the default save dir is kept as a static instance, for one). It also resolves the frankly bad design wherein a getter called from a write-to-disk function could first clobber its payload by reading from the target file."
2768922829,Remove [defense] ability from ships,Dalas121,2025-08-23 15:52:49+00:00,2025-08-25 13:09:26+00:00,{'Units': 1},"I'd previously used `[defense]` to cap ships' village defense at 0. Now that 1.19.15 is out and I can test `[defense]`, I've now learned that `[defense]` doesn't affect the terrain percentage that we show to the player. So a ship might say 30% on the map, but have 0% defense when it actually goes to fight - that's confusing.

Instead, accept that we'll have non-0 defense on land villages, and just set village defense to whatever our flat defense is.

I haven't changed any unit costs; at some point Hejnewar will revisit costs for all ships."
2768676892,Android: onscreen keyboard and back button support,babaissarkar,2025-08-23 12:09:41+00:00,2025-08-27 12:03:43+00:00,"{'UI': 1, 'Input': 1, 'Android': 1}","Related to #10326

* Support for showing the onscreen keyboard for floating textbox.
* Specifically for Android, moves the command prompt inside game (`Actions > Enter command`, hotkey `:`) to the top of the gamemap instead of bottom, so that it does not get hidden by the onscreen keyboard.
* Also add Back button support for Android. Behavior mirrors `Esc` key on desktop.

- [x] Back support in title screen

(I understand that iOS would benefit from this too, but that will have wait till #10458, which is further blocked by SDL3 migration, at which point mass-replacing Android defines to touchscreen defines could work.)"
2768653674,Make the Load Game dialog for 1.19 and 1.20 see each other's save files,stevecotton,2025-08-23 11:52:03+00:00,2025-08-25 09:24:12+00:00,{'UI': 1},"If there are save directories for other versions of Wesnoth, there's a drop-down list in the Load Game dialog to see those other directories.

That directory moved in 80fe9ba84ddb507f0212c445e4af9bb163e94bb3, this adapts so that the feature will continue working when 1.19 is an old version. The code is the same as 1.18's implementation, I think the technical debt of hardcoding the directory name ""sync"" in this place is balanced by this being a place where some cross-version debt is to be expected.

This is a simple forward-port of #10474."
2768636425,[1.18] Make the Load Game dialog see other-version save files from 1.19,stevecotton,2025-08-23 11:42:01+00:00,2025-08-25 09:24:06+00:00,"{'UI': 1, 'Stable 1.18': 1}","If there are save directories for other versions of Wesnoth, there's a drop-down list in the Load Game dialog to see those other directories.

This adapts 1.18 for commit 80fe9ba84ddb507f0212c445e4af9bb163e94bb3, so that 1.18 will see the save directory of 1.19.2 onwards.

Previously, 1.18 would show the directory that 1.19.0 and 1.19.1 used.

I'm planning to forward-port this as-is to 1.19, I think the technical debt of hardcoding the directory name ""sync"" in this place is balanced by this being a place where some cross-version debt is to be expected."
2763003894,Consolidated fix for the animation lag,Vultraz,2025-08-21 13:24:57+00:00,2025-08-21 14:44:01+00:00,{},"Combines work by Durzi (@mentos987)  and octalot (@stevecotton).

Fixes #9220
Resolves #10302
Closes #10468
Closes #10464"
2759778380,Slightly improve team/side number encapsulation (team::knows_upkeep),stevecotton,2025-08-20 13:13:36+00:00,2025-08-20 14:33:45+00:00,{'UI': 1},
2756183005,Fix animation glitches when terrain scrolls onto screen,stevecotton,2025-08-19 11:40:51+00:00,2025-08-22 19:23:36+00:00,{'Graphics': 1},"When an animated hex scrolled back on screen, instead of jumping to the current frame of the animation, the engine played any intermediate frames at a fast forwarded speed, because it incremented current_frame_key_ at most once per redraw. The fix for that is the second of the two loops changed in this commit.

When an animated hex first appears on screen, a while loop ran with one iteration per cycle, as if the animation had been running since the clock's epoch. Prior to b9bcdd3, the clock epoch seemed to be when the engine loaded, after that commit it's whatever steady_clock uses, which is implementation defined but made the lag more noticeable. The fix is to just calculate the number of cycles to skip.

Thanks to Durzi (@mentos987) for reporting the issue and working on a fix, but the discussion in #10464 is including a growing number of people, so it seems worth resolving these parts quickly.

Fixes #9220
Fixes #10302"
2756049515,Addon Info: remove extra escaping,babaissarkar,2025-08-19 10:54:38+00:00,2025-08-22 02:32:52+00:00,"{'UI': 1, 'Add-ons': 1}","Resolves #10466
The issue is caused by duplicate escaping in `addon_info::display_title`, which gets escaped again in the addon client (`client.cpp`)."
2751559847,1.21 Castle/Elevation update,doofus-01,2025-08-17 21:57:04+00:00,,"{'Postponed': 1, 'Graphics': 1, 'Terrain': 1}","This was primarily an attempt to have a keep/castle overlay that is visible yet not a built structure.  I'm not sure how useful it currently is, but it might be useful as is or might turn into something better if I think on it more.
EDIT: an example is posted on the forums: https://forums.wesnoth.org/viewtopic.php?p=700133#p700133"
2751503491,Update animated.tpp,mentos987,2025-08-17 20:05:20+00:00,2025-08-22 19:24:17+00:00,{'Graphics': 1},"This is the bugfix for the issue: https://github.com/wesnoth/wesnoth/issues/10302

An animation speedup/scroll fix that will reduce lag a bit and fix any animation speed-up that happens as you scroll.

Tested on linux and it works as intended."
2751428366,Tips: add hotkey customization tip and fix spacing,PGrayCS,2025-08-17 17:51:00+00:00,2025-08-19 04:48:35+00:00,{'Help': 1}," Adds a new gameplay tip highlighting that hotkeys are customizable (improves player QoL discovery) and fixes an extra space in an existing tip line. Changes:

data/tips.cfg: +1 new tip, minor spacing correction.
Rationale:

Encourages players to tailor controls, speeding turn execution.
Low-risk text-only change; no gameplay logic impacted."
2750573763,apply the 'neutral' alignment to the Scepter of Fire and align the power of the attacks with those of the scepter when it is held by Li'sar,newfrenchy83,2025-08-16 15:59:28+00:00,2025-08-17 12:33:01+00:00,"{'Units': 1, 'Campaign HttT': 1}","
I know I've already tried to sell the concept in another PR but here's an argument that might be more relevant ; Konrad is alignment lawful and Li'sar neutral, but the Scepter of Fire is so powerful that for them the difficulty comes more from keeping control in combat than trying to go to the maximum unlike the sword which comes from training, or from the magical mastery of mage which also comes with years of practice. For me, the fact that the Scepter attack is of reduced power at level 1 comes from the fact that the wearer lacks confidence and unconsciously restrains the power of the artifact. In the end, I consider that the alignment does not come into play because Konrad should not be more comfortable during the day than at night to handle what is a monster of power."
2748091074,Addon Manager: select correct layer for controls (#10457),babaissarkar,2025-08-15 05:52:58+00:00,2025-08-15 15:55:10+00:00,"{'UI': 1, 'Add-ons': 1}","Resolves #10457.
Fixes incorrect layer/parent being selected for some UI widgets, otherwise it can show the ""widget not found"" and return to title screen.

> The reason was incorrect stacked widget layer selection. The low-res version uses a stacked widget which put the add-on on layer zero and the details panel on layer one, while the high-res version puts them all on the parent container. During find_widget call, the correct layer/parent needs to be selected, otherwise it won't be able to find the version selection menu button."
2744977852,Rename second unit_mover class,soliton-,2025-08-14 05:39:50+00:00,2025-08-15 19:15:16+00:00,{'Units': 1},
2743268264,Global touchscreen define,babaissarkar,2025-08-13 15:33:31+00:00,,"{'macOS': 1, 'iOS': 1, 'Android': 1}",
2742873350,Update comments about image loading for canvases,stevecotton,2025-08-13 13:25:04+00:00,2025-08-16 05:31:16+00:00,{'UI': 1},"The i18n support was added in 887bd5f7d60da0e4373de877127d663ba565b3cc.

A trivial change, collecting knowledge from working on #10449."
2742809580,fix attack enemies command don't work anymore,newfrenchy83,2025-08-13 13:06:02+00:00,2025-08-13 14:34:55+00:00,{'UI': 1},Fix https://github.com/wesnoth/wesnoth/issues/10454 issue
2740816836,Simplify and consolidate save loading paths,Vultraz,2025-08-12 22:36:06+00:00,2025-08-19 15:37:17+00:00,{'UI': 1},"While working on #10451, I noticed that errors for saves weren't being displayed in-game. That was because b007b5a8d09980e10c5e7192f5620319e0d88edf made it so we checked the save index for save validity in order to avoid loading the actual save file twice - once to validate it before load_game_exception was thrown and once in the titlescreen loop to actually load the damn thing.

All in-game loading (autosaves and interactive) now reads the save file to check its validity and surface any errors *before* throwing load_game_exception. The load_game_metadata  payload is likewise now expected to contain the parsed save config. The autosave loader path has been adjusted to pass the loaded payload along with its exception. (Thankfully, gfgtdf's work already made this trivial.) Conversely, the interactive load path in game_launcher will assert if load data has already been provided.

The titlescreen loop has been simplified. Previously, we had two ""load"" paths: The first through the interactive Load Game menu on the titlescreen, which would load the save, reload the game config, and update the gamestate config before dismissing the titlescreen and entering a game. The second was through a load game exception, which would skip the titlescreen by updating the gamestate config and immediately launching the game. Both paths have now been unified. In the former case, the save is selected and its config loaded (to allow for any errors), before passing off to the game launcher to apply said config and launch the game. This means we aren't invoking the loading screen twice.

game_launcher::goto_editor was using the load_data payload when it had no reason to do so. The only piece of info actually needed was the filename, then passed on to the editor. Replaced the jump-to-editor flag with an optional string. The string may be empty, but that's a valid value for the editor.

The `savegame::loadgame` class has been removed and its constituent functionality made free-standing. There was really no reason to be a class, and its nature as such only made tracking the provenance of data and who was modifying what and when extremely difficulty. We now have `load_interactive`, `load_interactive_for_multiplayer`, and `load_interactive_by_exception`. (The last simply wraps the first). Each creates and return (or throws) its own load_game_metadata object.

The other two members of the loadgame class were similarly unnecessary. The game_config_view reference mostly existed to be passed to the Load Game dialog (it had one use in show_difficulty_dialog). The former has been removed; the game_config_manager is now queried when creating the dialog rather than passing the object in. The latter was turned into a local variable.

Finally, the gamestate (saved_game) reference. This is now handled by savegame::set_gamestate in order to make it extremely clear when the gamestate is being modified. Likewise, we no longer manually set the gamestate's game_classification object as part of the validation checks. We can just as easily query the version directly rather than relying on a temp object which will be later overwritten by set_state. `load_interactive_for_multiplayer` does still create its own game_classification object, but in that case, we need it for two checks. Would be good to dispense with that at some point...

Several early return checks has been removed, notable ""is manager null"" and ""is filename empty"". Neither of these should arise in the regular course of events. show_difficulty_dialog now writes the new difficulty value directly to the load config rather than leaving that to be handled separately.

One change I'm unsure about is calling `unify_controllers` in `set_gamestate` unconditionally. Years ago, @gfgtdf added code (see #1762) to strip `is_local` from the side tags in the load config. `unify_controllers` has since evolved to perform the same cleanup on the `starting_point_` config side tags. I am unsure whether simply calling `unify_controllers` unconditionally will strip the key from the right set of side_tags to not reintroduce the crash from #1762, considering `starting_point_` is read either from `[snapshot]` or `[scenario]`..."
2739206204,NR: stop some loyals and heroes from being renamed,knyghtmare,2025-08-12 13:31:35+00:00,2025-08-12 15:15:44+00:00,{'Campaign NR': 1},No comment.
2736986829,Display any errors encountered when reading save files,Vultraz,2025-08-11 21:39:59+00:00,2025-08-12 00:24:56+00:00,{},"`read_save_file` would throw if it encountered an error, but also log its errors to `error_log` if such an argument were provided. However, since an exception is thrown, the code that is meant to display the error messages was never called. Resolved by dispatching the error message as part of the exception object and catching it at the call site.

The error displayed when loading an invalid save is now more descriptive:
<img width=""432"" height=""254"" alt=""image"" src=""https://github.com/user-attachments/assets/9fd6999c-6540-43a5-93f0-54036c24ad80"" />

(Not sure why the path is shown as ""unknown"" here, but that's a separate issue.)

I've also made a corrupt save a fatal error. Two codepaths treated any errors from read_save_file as non-fatal, but it doesn't make sense to try and continue loading an invalid (or empty) config, or in the case of a stream error.

One inconsistency I noticed was with loading saves in-game. b007b5a8d09980e10c5e7192f5620319e0d88edf made it so we check the save_index cache for save validity, but that also means that any errors aren't shown when loading the save in-game (unlike loading from the main menu, for instance). Will look into addressing that."
2736894917,"Log at most one ""image won't be drawn"" error per canvas",stevecotton,2025-08-11 20:55:36+00:00,2025-08-12 16:56:13+00:00,{'UI': 1},"This was triggering for a broken Data URI in the list of add-ons, which declares itself as image/png but the data is image/webp. The whole Data URI was getting logged on every draw() call.

For formulas, this means that only the first failing filename or data URI will be reported, even if the formula changes to a different image. It seems unnecessary to add more logic; if the person who sees the log is the person who can fix the problem, then they're likely to either see a common pattern in a set of broken filenames, or to keep testing until everything is fixed.

Note: when testing this on the 1.19 add-ons server, you'll currently see two logs, which look like the same error. It's because Town of Arnsreach has a separate Resources add-on, and there's one log for each."
2736881549,Remove unnecessary use of blank-hex.png in the add-ons list,stevecotton,2025-08-11 20:50:06+00:00,2025-08-14 11:11:08+00:00,"{'UI': 1, 'Add-ons': 1}","This was originally just ""Tidy up an if() ... if() that could be an if() ... else if()"". Thanks to Nanamuru for pointing this out, it's one of the bugs found by static analysis and reported in #10386.

It's now ""remove unnecessary use of blank-hex.png for add-ons"" and ""for local add-ons without icons, don't add an IPF"".

Canvas' image_shape class will handle empty strings and simply not draw an image. It will log a gui/draw message at log-level debug, but there are many messages at that log level, and there's a separate discussion about removing it.

Locally authored add-ons normally get an overlay via an Image Path Function. The second commit prevents that overlay being added to add-ons which don't have an icon, because the IPF doesn't work without an image - the result is a blank space, the same as for any other add-on without an icon."
2733631293,regroup checks of unit for adjacent abilites in same function,newfrenchy83,2025-08-10 16:12:40+00:00,2025-08-10 18:17:43+00:00,{'Units': 1},"move check of incapacitated, comparaison of underlying_id() and ownership of ability with [affect_adjacent] in same function should make the code more readable."
2732498373,Regroup the checks for abilities used as weapons into two separate functions.,newfrenchy83,2025-08-09 09:09:10+00:00,2025-08-10 04:35:56+00:00,{'Units': 1},"
Now that support for Boolean specials is separated from filtering, it would be better if the checks for self_ and other_ were handled by a single function instead of copying the code for each of them to simplify the writing. Hence, the use of two functions: one for handling Boolean specials, which will be called twice, and one for the filter functions, which will be called four times in total.

the two first commit are the same what https://github.com/wesnoth/wesnoth/pull/10426 "
2730993146,TSG: make Afalas nicer,Dalas121,2025-08-08 14:40:08+00:00,2025-08-09 17:19:40+00:00,{'Campaign TSG': 1},"Urza Afalas was significantly more ""noble"" in the original TSG than in my revision. Revert some of that here.

Also fixes a `[companion_message]` bug, and reduces difficulty on one branch of S04."
2730973742,Preprocessor: clean up preproc_map input handling,Vultraz,2025-08-08 14:31:35+00:00,2025-08-10 15:03:05+00:00,"{'UI': 1, 'Editor': 1, 'Lua API': 1}","- Add preprocess_file and preprocess_string overloads taking a preproc_map reference instead of a defaulted pointer argument. No longer need to take the address of every defines map we pass in.
- Make preprocess_string return the stream to match preprocess_file
- Remove unused `default_defines_` member from from preprocessor_streambuf. Was added all the way back in 1e32e22ca9ba4f4be8726b908a76bdda4ba5f688 to serve as a local fallback for the defines pointer, but that functionality has long since been relegated to preprocessor_scope_helper (now called preprocessor_istream)
- Store defines as a reference in preprocessor_streambuf, since we know it's always valid.
- Use rdbuf over `std::ios::init` and remove a comment I added years ago which now proved to be incorrect.
- Expand preprocessor_istream functionality to make it usable in preprocess_string without duplicating code."
2729283706,EI: fix 2 baneblade bugs (#8914),Dalas121,2025-08-08 00:33:07+00:00,2025-08-08 19:18:52+00:00,{'Campaign EI': 1},
2727803192,Reduce copying of preproc_define and tidy up config cache,Vultraz,2025-08-07 13:25:08+00:00,2025-08-08 12:03:40+00:00,"{'UI': 1, 'Editor': 1, 'Lua API': 1, 'Add-ons': 1}","- Prefer return values over input parameters in the config cache. The test_non_clean_config_loading test has likewise been removed since `config_cache::get_config` no longer takes an input parameter.
- Remove unnecessary default ctors or use defaulted ones
- Use in-place construction for preproc_defines. Especially no need to create default objects only to assign them to default objects.) Subscript lookup for define maps has been replaced either with try_emplace or insert_or_assign`.
- Slightly optimize `preproc_define` size (saves 8 bytes)
- Replace `preproc_define::read_pair` with a new in-place construction helper (`preproc_define::insert`).
- ~Optimize `config_cache::transaction::add_defines_map_diff`. Remove an unnecessary copy by erasing duplicates from the input map before copying to the active map rather than going through an intermediate temp object.~
- Remove `config_cache_transaction::insert_to_active`. One use was superseded by the above change, the other by the new `preproc_define::insert` helper. The old implementation was also making an unnecessary value copy instead of simply inserting the value_type parameter. (Note that using `get_active_map` instead of straight map insertion results in defines being copied from the input map to the active map if the latter is empty, but I don’t see harm in doing so, given we expect that wherever else the accessor is used)."
2719564226,Have presets support saving the same values as the last used scenario preferences,Pentarctagon,2025-08-05 01:25:47+00:00,2025-08-14 04:30:08+00:00,{'UI': 1},Resolves #10377
2718832326,Dunefolk balance changes for 1.20,Hejnewar,2025-08-04 18:20:25+00:00,2025-08-07 09:54:32+00:00,{'Units': 1},As discussed by the balance team. 
2717154384,Consistently format achievements,Vultraz,2025-08-04 08:27:49+00:00,2025-08-04 13:38:03+00:00,"{'Achievements': 1, 'Campaign EI': 1, 'Campaign L': 1, 'Campaign THoT': 1, 'Campaign TDG': 1}","- Remove single quotes around scenario names. Some campaigns use them, some don't. IMO it looks cleaner without, since they names are already italicized. (TDG S2 wasn't using the proper typographic closing quote either)
- End all descriptions with periods. Again, I don't mind either way, but it should be consistent.
- Italicize all scenario names"
2716297827,1.19 Basic fire-dragon animations,doofus-01,2025-08-03 20:48:58+00:00,2025-08-16 22:35:09+00:00,"{'Graphics': 1, 'Units': 1}","Some minimal animation frames for the fire dragon, so it's not forever a ""one frame wonder"".

- [x] resting frame (put those wings down)
- [x] defense
- [x] standing animation (maybe)

Attack anims would be nice, but I'm not committing to that.
"
2716045570,Revert behavior change from 3cc3c75,soliton-,2025-08-03 14:03:51+00:00,2025-08-31 06:56:40+00:00,{'UI': 1},Also revert the original change in 81f916d and only remove trailing newlines from tooltips as intended.
2715012023,TRoW: improve {ABILITY_DISTRACT} description,Dalas121,2025-08-02 14:08:02+00:00,2025-08-03 22:35:28+00:00,{'Campaign TRoW': 1},"The description for TRoW's {ABILITY_DISTRACT} is a little confusing, and could be read to imply that adjacent enemies have their ZoC disabled.

This change to the description should hopefully be more clear."
2714981584,Import the different unit comparisons into the utils class functions.,newfrenchy83,2025-08-02 13:09:59+00:00,2025-08-04 09:43:56+00:00,{'Units': 1},This will avoid duplicating each check for affect_adjacent in all the functions involved.
2714624125,"Standardize L, EI, and TDG's Rogue Mage units",Dalas121,2025-08-02 02:02:31+00:00,2025-08-02 18:25:58+00:00,"{'Graphics': 1, 'Units': 1, 'Campaign EI': 1, 'Campaign L': 1, 'Campaign TDG': 1}","Liberty, EI, and TDG all use Rogue Mages with different stats. These units aren't high-quality enough for core, but we shouldn't duplicate them across different campaigns either.

This PR moves the unit definitions out of those campaigns and into `data/internal`, and standardizes their stats. I've done some very basic playtesting and don't believe any of these campaigns will be imbalanced by these changes.

@cooljeanius, I remember that you use Liberty's Shadow Lord in an addon. Pinging you so you're aware of this change and can copy the units' former stats into your addon if necessary."
2714420006,Fix move behavior of enable_lua_ptr<T>,stevecotton,2025-08-01 22:16:10+00:00,2025-08-10 10:39:31+00:00,{'Lua API': 1},"The move assignment didn't return a value, however it was also unused, GCC started giving warnings when the test was changed to use it.

Thanks to Nanamuru for finding this, it's one of the bugs found by static analysis and reported in #10386.

@gfgtdf I'm opening this as a draft, because I've added comments about what I think this code does, but I'd like your confirmation that I've understood it correctly."
2713686763,checking unit with underlying_id() and remove same_unit() function,newfrenchy83,2025-08-01 16:12:06+00:00,2025-08-09 13:00:59+00:00,{'Units': 1},
2713390738,Fix a potential out-of-bounds error in mouse button handling,stevecotton,2025-08-01 14:18:25+00:00,2025-08-01 18:22:12+00:00,{},Thanks to Nanamuru for finding this and pointing out the easy fix; it's one of the bugs found by static analysis and reported in #10386.
2712533712,Prefer utils::split_view over utils::split,Vultraz,2025-08-01 09:08:07+00:00,,"{'UI': 1, 'Units': 1, 'Add-ons': 1, 'WFL': 1, 'Help': 1, 'Terrain': 1}","Avoids creating unnecessary temporary strings by utilizing utils::split view when possible. This isn't a complete audit of all uses of split, but it's a fairly comprehensive one.

- Added a new split_view overload taking a config_attribute_valyue. This utilized a visitor to return a view list into the attribute's underlying string without creating a temporary copy with str()
- To facilitate the use of string_view, many functions (primarily in unit and unit_type) now take string_view parameters. Containers have been adjusted to allow heterogenous lookup when necessary.
- Fix comparison between an attribute value and a string_view."
2710517913,update codeblock projectfiles to c++20,newfrenchy83,2025-07-31 15:29:35+00:00,2025-07-31 15:58:41+00:00,{'Building': 1},
2709756004,Improve UI test,babaissarkar,2025-07-31 11:05:18+00:00,2025-08-06 15:24:14+00:00,"{'Unit Tests': 1, 'UI': 1}","Compare an error code instead of a tstring, the latter of which may change at any point, and is not very obvious. Also bad design pattern.

(Opened for CI run)"
2709046491,Use utils::contains in more places,Vultraz,2025-07-31 06:03:08+00:00,2025-07-31 08:09:38+00:00,"{'AI': 1, 'MP': 1, 'UI': 1, 'Units': 1, 'Add-ons': 1, 'WFL': 1, 'Help': 1, 'Schema': 1, 'Terrain': 1}",
2704650390,"Using a unit_type ""lighthouse"" instead of time_area in Trow",newfrenchy83,2025-07-29 16:18:22+00:00,,"{'Graphics': 1, 'Units': 1, 'Campaign TRoW': 1}","Now that [illuminates] can be exercised on a rdius greater than 1, why not use a [unit_type] for that?"
2701508145,Android/build-dependencies: check existence before copying,babaissarkar,2025-07-28 17:08:14+00:00,2025-07-29 06:02:12+00:00,"{'Packaging': 1, 'Android': 1}",Creating for the CI run.
2700369716,Fix replay theme,gfgtdf,2025-07-28 11:13:11+00:00,,"{'UI': 1, 'Lua API': 1}",
2700083238,Add fastlane metadata for f-droid,babaissarkar,2025-07-28 09:59:44+00:00,2025-07-28 12:18:32+00:00,"{'CI': 1, 'Android': 1}","Adds fastlane metadata for Wesnoth in `/fastlane` following `https://gitlab.com/-/snippets/1895688`. This is needed for F-Droid.
Also adds a CI check for verifying fastlane metadata."
2698878365,Sprite shadow corrections,Wedge009,2025-07-28 02:39:06+00:00,2025-07-28 08:00:35+00:00,"{'Graphics': 1, 'Units': 1, 'Stable 1.18': 1}","Back-port of #10008 and #10404. PR because of cherry-pick conflicts.

Closes #10409."
2696971622,fix #10393 shaman.png shadow,doofus-01,2025-07-26 12:46:37+00:00,2025-07-27 18:08:31+00:00,"{'Graphics': 1, 'Units': 1}",
2694404852,"Editor: further init cleanup, mostly to ToD info",Vultraz,2025-07-25 09:30:00+00:00,,{'Editor': 1},"- Split `[editor_times]` parsing into its own function in a separate private header along with the `[editor_music]` parsing.
- Add a dedicated struct for schedule into
- Let the context manager set the initial display context since it handles setting the context on switch.
- Initialize more class members in the initializer list rather than in two steps."
2694321544,Revise 1.19's new ships' stats alternative,newfrenchy83,2025-07-25 08:57:45+00:00,2025-08-02 15:49:01+00:00,"{'Graphics': 1, 'Audio': 1, 'Unit Tests': 1, 'Units': 1}",It si the same what https://github.com/wesnoth/wesnoth/pull/10343 PR authored by @Dalas121 but wit less commits and a try to fix wml test failing.
2691299973,using special [defense_special] instead of parry attribute with defense_weight=0,newfrenchy83,2025-07-24 09:04:23+00:00,2025-09-06 14:07:57+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1, 'Campaign UtBS': 1, 'Campaign TDG': 1}","Since these attacks almost all have the firststrike special, it makes no sense to cancel them in defense now that another solution exists."
2691283511,Move checking_tags()set to ability_tags.hpp file,newfrenchy83,2025-07-24 08:58:30+00:00,2025-07-24 18:55:19+00:00,"{'Units': 1, 'Building': 1}",So they are all gathered in the same file
2690783044,Skeletal Dragon image_icon,sevu,2025-07-24 05:20:27+00:00,2025-07-24 05:32:06+00:00,{'Units': 1},"> Not centered but it should use image_icon or similar. (#10391)

We could use a different cropping for the image_icon. Cropped in a way that one doesn't see the wings, with 72x72. Merging?

<img width=""836"" height=""757"" alt=""list"" src=""https://github.com/user-attachments/assets/afb82589-eb7d-48f8-bb8c-e35a260a4b02"" />
<img width=""823"" height=""259"" alt=""dialogue"" src=""https://github.com/user-attachments/assets/6a90c384-1515-4d3f-bb57-b94fdb89afe8"" />

It's cropped to 72x72, but the attack dialogue will use 144x144."
2689776181,"Use resting for burrow instead of moves, closes #8693",ProditorMagnus,2025-07-23 18:57:36+00:00,2025-08-03 13:54:29+00:00,{'Units': 1},
2687183288,Change mistaken call to active_view::origin back to active_view::size,kencheng,2025-07-23 01:10:44+00:00,2025-07-23 12:26:58+00:00,{},"This also prevents a divide-by-zero crash in `sdl::get_mouse_state()` if the `active_view`'s origin is at (0, 0)."
2685791415,TSG S06b: explain S05b bonus in objectives,Dalas121,2025-07-22 14:30:27+00:00,2025-07-31 18:13:33+00:00,{'Campaign TSG': 1},Resolves #10373
2685278034,Android/InitActivity: add userdata import/export functionality (#10326),babaissarkar,2025-07-22 11:52:57+00:00,2025-08-03 09:03:57+00:00,"{'UI': 1, 'Packaging': 1, 'Android': 1}","Adds a new menu item to the setting menu in the Android splash screen/launcher activity that allows import/export of Wesnoth userdata folders.

TODO
- [x] Export
- [x] Import
~~- [ ] Custom userdata folder~~ (Will attempt in a future PR if possible)

<img width=""1600"" height=""720"" alt=""Screenshot_20250722-172322"" src=""https://github.com/user-attachments/assets/8e615626-dcb1-43a2-ae9a-bc2182ea92ac"" />
<img width=""1600"" height=""720"" alt=""Screenshot_20250722-172327"" src=""https://github.com/user-attachments/assets/3cc6443a-251d-4f36-846a-27bf4e8ca5a4"" />
"
2683368964,06b_The_Tides_of_War.cfg Dialogue.,TheFlamelet,2025-07-21 22:49:11+00:00,2025-08-25 20:29:58+00:00,"{'Prose': 1, 'Campaign TSG': 1}",">                 message= _ ""So, the fleshbags have managed to mount a defense. I would seem that the pesky fly turned out to be more than a minor annoyance after all.""

I would seem to > It seems.
alternative rewordings:
who would have thought that the pesky fly...
I wouldnt have thought that the pesky fly... etc




Here are other changes which are optional rewording (i didnt submit them yet in this commit)
you defeated my lacky? > you defeated one of my lackies 
a great accomp > what a great accomplishment

kindest and gentlest > most kind and gentle.


@Dalas121 please review and tell me which of those alternative rewordings you would like. one by one."
2682993386,Ensure all music_tracks objects are valid,Vultraz,2025-07-21 19:48:09+00:00,2025-07-23 17:29:18+00:00,"{'Audio': 1, 'Editor': 1, 'Lua API': 1}","- `music_track` objects can no longer be created directly. Instead, use the factory method `music_track::create` which attempts to resolve the full binary path before returning a shared_ptr of the new object. This removes the need for the is-valid check that could fail if you created a track object whose path could not resolve.
- Check the track ptr is non-null when getting the current, previous, or indexed track with the Lua API. Returns nil otherwise.
- Move the localized path resolution from the music_thinker to the path resolution in music_track.
- Remove `sound::play_music_repeatedly` (was unused)
- Store the editor and editor map context tracks as shared_ptrs. This accords with the result of the factory method and also means the contexts' tracks are shared with the master list in editor_controller.
- Split the editor music init out of the class. There was no need for it to be a class member or to do initialization of the track list in two steps. I'll split the other init functions (init_tods, init_gui, etc) out separately."
2682035042,"Change Sylph, Shyde, and Enchantress to be closer to 1.16",Dalas121,2025-07-21 13:55:19+00:00,2025-07-31 18:14:25+00:00,{'Units': 1},"The Elvish Sylph, Shyde, and Enchantress received massive buffs in 1.18. Those have been partially walked back in #8749, but these units still remain outliers in power at their respective levels - especially now that most undead have -40% arcane resist.

A dexterous Sylph, for example, is better than a Great Mage in almost every possible aspect - damage, movement, hitpoints, melee, support (slows), and defense.

This PR brings most of their stats back down to their 1.16 levels (or slightly stronger), but deliberately leaves the Sylph and Enchantress's slowing attacks unnerfed; I think those attacks are somewhat weak in comparison to their much more deadly arcane attacks.

Balance vote is in progress; will conclude in a few days."
2681910814,fix name_affected no showed in sidebar for unit affected by 'initiative',newfrenchy83,2025-07-21 13:17:27+00:00,2025-07-24 09:17:54+00:00,{'Campaign HttT': 1},
2681435623,New Intercept Weapon Special,hladkyjakub,2025-07-21 10:41:42+00:00,,"{'Units': 1, 'Squash': 1}","New weapon special for future use in the Dunefolk faction and very likely in the UtBS campaign.

Weapon special makes the unit deliver one strike to enemies moving adjacent, without retaliation and battle XP, but kill XP is given.

A good idea would be to make a proper API to make more abilities, which do launch extra (and non-default ruled combat) attacks (I have made quite some) fully possible.
Draw_weapon and sheath_weapon animations aren't perfect, because there aren't tools for Lua animator to make them smooth, as well as units sometimes ""blicking"" to the default stance between animations (precauculating and putting all animations at one spot doesn't help that)

https://github.com/user-attachments/assets/425d17d1-d6ef-462d-943a-836e0977a8e4

 #10372 "
2680782876,TSG/TDG: A couple of corrections,Wedge009,2025-07-21 06:22:04+00:00,2025-07-21 13:03:43+00:00,"{'Prose': 1, 'Campaign TSG': 1, 'Campaign TDG': 1}","It's that time again, post-po-update review. Not too bad this time around."
2680693277,Android CI: tar first before uploading,babaissarkar,2025-07-21 05:38:55+00:00,2025-07-21 16:13:13+00:00,"{'CI': 1, 'Android': 1}","* Preserves symlinks inside the archive.
* Also fixes the Android CI not running on PRs or manual dispatch.

(PR for CI run)

"
2679598407,Merfolk Diviner: slightly adjust description.,babaissarkar,2025-07-20 04:44:05+00:00,2025-07-20 18:48:12+00:00,"{'Units': 1, 'Help': 1}","* Avoids slightly awkward phrasing. (`that` followed by `the`.)
* Improve sentence flow.
* Add `almost slain` instead of slain and delete `in full number`. If they were dead, they can't fight back next day in full number without necromancy. This makes it sound more realistic without changing the story too much."
2679497553,Some presets fixes,Pentarctagon,2025-07-20 01:57:43+00:00,2025-07-21 01:07:25+00:00,{'UI': 1},
2679296755,Improve play_music_config implementation,Vultraz,2025-07-19 20:00:58+00:00,2025-07-21 08:02:39+00:00,{'Audio': 1},"- Fix index argument never being used
- Don't try and play an invalid track even once
- Manage new track with shared_ptr (avoids unnecessary copies)
- Clarify list-insert logic"
2677944279,Add util for container lookup with projections,Vultraz,2025-07-18 18:21:58+00:00,2025-07-19 19:45:33+00:00,"{'UI': 1, 'Lua API': 1, 'Add-ons': 1, 'WFL': 1}","This adds a new `utils::ranges::find` helper function modeled after C++20's `ranges::find`. Unlike the latter, it only accepts lvalue references (you can't have a ""borrowed range""), but for most cases the syntax is equivalent to `ranges::find`. The most useful part is the projection argument, which significantly simplifies existing uses of `std::find_if`. The C++20 version proper should be a drop-in replacement once we bump our minimums."
2675332396,New Overwatch Ability,Hejnewar,2025-07-17 22:30:38+00:00,2025-07-21 11:58:07+00:00,{'Units': 1},"New ability for future use in Dunefolk faction and very likely in UtBS campaign. 

This is still quiet prototype but working ability, with some choices still to be made, currently it simply filters for a ranged weapon and takes its stats. Alternate solution might involve creating a dummy weapon special just for this ability that would allow for deliberate selection of attack used and improve visibility. However it would also clutter the game a bit with a special that basically serves as an advanced filter. So neither of the two solutions is imo perfect. 

Additionally the ability currently uses additional `harm_unit ` as animation trigger for some extra visibility for players to know better if the ability triggered and was disabled or not, which might not necessarily be a perfect solution in this case. 

Finally, no other core ability is actually written fully in WML (I think) and this is, right now it is all in one file but splitting events of it into another file seems like something that should be done, but right now this is mostly for code review anyway."
2674396826,Ghoul-line: Resistance changes,Hejnewar,2025-07-17 15:46:43+00:00,2025-07-17 22:33:53+00:00,{'Units': 1},As discussed by Balance Team.
2673064215,"SotBE: Add AMLAs for Orcish, Wolf, Troll and Saurian units.",knyghtmare,2025-07-17 08:05:44+00:00,2025-09-03 14:03:32+00:00,"{'Enhancement': 1, 'Campaign SotBE': 1}","- SotBE: Add AMLAs for Orcish, Wolf, Troll and Saurian units.
- AMLAs tailored and fine-tuned in line with those in TSG, TDG, and EI.
- Each AMLA costs 120-150 XP for a level 3 unit, and 80-100 XP for a level 2 unit. 120 and 80 if unit has intelligent.
- On testing, it has been seen that most player units can earn at most one AMLA or 2 AMLA if heavily recalled and used in scenarios. 
- Hero units like Kapou'e and Gruu have a chance of earning a 3rd AMLA as they always available in every scenario."
2672992895,Update Dialogue for 02_Proven_by_the_Sword.cfg,TheFlamelet,2025-07-17 07:42:26+00:00,2025-07-17 14:35:16+00:00,{'Campaign TSG': 1},"Another Urza ~~brother~~, augmenting his ranks with the restless dead. The brothers must have been waiting....
Another Urza, augmenting his ranks with the restless dead. The <ins>**Urza**</ins> brothers must have been waiting"
2672937367,SOTBE: add campaign menu bg,knyghtmare,2025-07-17 07:21:04+00:00,2025-07-17 12:27:37+00:00,"{'Enhancement': 1, 'Campaign SotBE': 1}",- Added a campaign menu background image. TRoW has a really good collection
2671064599,[change_theme]: ignore theme changes while in a replay,Dalas121,2025-07-16 15:08:06+00:00,2025-07-22 14:29:41+00:00,{'Lua API': 1},"Resolves #7122, at least partially.
"
2667447304,Menu Events: rework recruit validation,Vultraz,2025-07-15 13:45:13+00:00,2025-07-16 08:19:00+00:00,{'Units': 1},"This splits `unit_helper::recruit_message` into several smaller functions. Previously, both `recruit` and `do_recruit` ran all validation checks, which was unnecessary (we know we have a valid unit type in `do_recruit`, for instance, or that it's a valid recruit).

Error handling is now done in two stages:
- `recruit` and `repeat_recruit` handle the pre-action checks. Can we afford the unit, is it a valid type, etc.
- `do_recruit` assumes we have a valid type and now checks the requested recruit location.

The interface is much simpler now. We avoid calculating whiteboard gold for every unit checked in `recruit`, and get rid of the mutable references being passed around everywhere which necessitated unnecessary copies and made it very unclear what was modifying what (it also meant the error message function had side effects!)

We now have:
- `planned_gold_spent`: gives our ""whiteboard gold"". Splitting this off avoids recalculating it for every recruit checked
- `check_recruit_purse`: performs the actual ""have enough gold"" check. I'll add a version for recall separately.
- `validate_recruit_target`: This is now handled in `do_recruit`. We know we have a valid type that we can afford, now let's check locations. The mutable location references have been removed. This function returns a tuple with any error message regarding the target hex, the valid target, and the valid source.

Also moves the `command_disabler` to `do_recruit`. I *think* this is the right place for it, given the context of the recall function."
2667235847,GUI2/Unit Preview Pane: show accuracy/parry info,babaissarkar,2025-07-15 12:37:48+00:00,2025-07-15 16:33:24+00:00,"{'UI': 1, 'Units': 1}","Shows Accuracy/Parry in the Unit Preview Pane (left panel of Unit dialogs). (Makes it consistent with the sidebar)

<img width=""248"" height=""496"" alt=""Screenshot from 2025-07-15 18-02-44"" src=""https://github.com/user-attachments/assets/222cc4ad-f8ee-414a-8e37-3f10432f4f32"" />

Also moved the accuracy/parry info generation to `attack_type`"
2663516117,Fix halo and hides display bug in abilities,newfrenchy83,2025-07-14 08:50:39+00:00,2025-07-15 18:28:41+00:00,{'Units': 1},"Fix https://github.com/wesnoth/wesnoth/issues/10364 issue

When a unit with the halo_image attribute [affect_adjacent] but with affect_self=no moves, it is likely to be illuminated by this halo, as it finds itself next to a temporary unit that is almost identical except for its location. This requires slightly complicating the verification with id if a simple comparison of unit is not sufficient.

same for [filter_adjacent] and [filter], if a unit with hides ability is invisible only when another unit of same race is adjacent, when unitmoves, it is 'hidden' because' adjacent to itself."
2663381216,Fix command line and some keyboard shortcuts no longer work,newfrenchy83,2025-07-14 08:04:17+00:00,2025-07-14 14:23:04+00:00,"{'UI': 1, 'iOS': 1, 'Input': 1, 'Android': 1}","~~This reverts commit e503658256fa4ab07d9a7fbbc5bb2cb353638585.~~

Fixes https://github.com/wesnoth/wesnoth/issues/10361 issue by adding `ifdef` guard around `SDL_Start/StopTextInput()` introduced in e503658256fa4ab07d9a7fbbc5bb2cb353638585."
2662812365,Swift trait added,TheFlamelet,2025-07-14 02:05:57+00:00,2025-09-22 14:20:13+00:00,"{'Enhancement': 1, 'Units': 1}","Added Swift Trait. It might be useful for some campaigns or scenarios.

trait is still unused.

Here is the description:
    # Units with trait Swift get a +1 increment in melee Strikes but do 1 less damage..
    # This trait is meant to be for light units: elves,  saurians, & outlaw humans. Can also be used for fencer line, or even other human lines. 
    # But it is over powered for Drakes, orcs, Dwarves, Heavy Infantry line, and cavalry; these should be excluded
    # the trait is never used, for now."
2662662108,1.19 various monster sprite updates,doofus-01,2025-07-13 23:36:16+00:00,2025-07-28 03:55:49+00:00,"{'Graphics': 1, 'Units': 1}","Some animations and sprite cleanup for monster sprites, no particular goal except to eat the elephant one bite at a time."
2662319471,give 'radius' to 'illuminates' abilities,newfrenchy83,2025-07-13 14:25:13+00:00,2025-07-29 14:51:06+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1}",work like [affect_adjacent]radius but for radius of illumination/darkening
2662231513,Backport 1.18: Change Japanese font to Noto Sans JP,fujimo-t,2025-07-13 11:41:28+00:00,2025-07-13 17:04:32+00:00,"{'Translations': 1, 'Stable 1.18': 1}",Backport #10353 to 1.18.
2662132201,WFL: add new core functions to supplement FAI functionality,Vultraz,2025-07-13 09:39:39+00:00,2025-07-14 03:31:00+00:00,{'WFL': 1},"Adds debug_print, run_file, nearest_loc, unit_tod_modifier, is_shrouded, and is_fogged as non-FAI WFL functions."
2661901177,Fonts: Change Japanese font to Noto Sans JP (#10063),fujimo-t,2025-07-13 02:51:50+00:00,2025-07-13 07:36:18+00:00,{'Translations': 1},"Current Japanese font, Droid Sans Japanese, doesn't have bold style so replace it by a new font with variable weight. 
Also change the font order for Japanese to Lato first to display in-game UI and italic text correctly.
Japanese translators have already agreed with this change on Discord's japanese channel.

The font file and copyright are downloaded from [Google fonts](https://fonts.google.com/noto/specimen/Noto+Sans+JP) and unmodified.
But I scaled down the font by fonts.conf. See [here](https://github.com/wesnoth/wesnoth/issues/10063#issuecomment-2849107048).

<img width=""696"" height=""430"" alt=""title"" src=""https://github.com/user-attachments/assets/d05b7ffc-7e90-407d-846a-58d14d0d2f14"" />

<img width=""696"" height=""430"" alt=""drake_help"" src=""https://github.com/user-attachments/assets/c64d914b-3f32-428a-9477-4ad98e7ec812"" />
"
2661557724,fix bad indentation,newfrenchy83,2025-07-12 18:25:43+00:00,2025-07-12 18:26:30+00:00,{},
2661034681,Add native toggle button support to WML menu items,Vultraz,2025-07-12 08:11:57+00:00,,"{'UI': 1, 'WML': 1}","The TSG ""enable tutorial hints"" menu is implemented as two separate menu buttons, each displayed when the other is not. Given my recent context menu handling work, it's pretty simple to add native support for displaying a toggle button along with a custom WML menu item.

Currently, this adds a new [toggle] tag to [set_menu_item] with a solitary `state_variable` key. The variable specified here is read from to determine the toggle button's current state and flipped when ""executing"" the menu item's commands. While this works, it feels somewhat limiting and precludes more complex conditions. Do I want this key to hold the state itself, and leave state management to the player? What about exposing additional drop down menu functionality?

I'd like some feedback on the design. Pinging Dalas since his usecase inspired this.
<img width=""318"" height=""106"" alt=""image"" src=""https://github.com/user-attachments/assets/8a1d61aa-ace4-4caf-bfab-6b4863ed08fe"" />
"
2660813594,GUI2/Textboxes: fix virtual keyboard not appearing,babaissarkar,2025-07-12 03:54:58+00:00,2025-07-13 14:47:00+00:00,"{'UI': 1, 'Input': 1, 'Android': 1}","`window::keyboard_capture()` behavior is changed so that it is no-op for Android, but taping the textbox still works.
Accidentally disabled on: cadc6ec412db8fdc6b40a8b968bffa5a79c9fbde.

[Note: there are too many calls to `window::keyboard_capture()` so I have changed that function itself instead of modifying dozens of calls.]"
2660550624,"TSG/TDG: remove ""miss"" text from missed attacks",Dalas121,2025-07-11 23:41:26+00:00,2025-07-12 01:56:01+00:00,"{'Campaign TSG': 1, 'Campaign TDG': 1}",Made redundant after https://github.com/wesnoth/wesnoth/commit/ece4c2e432982515f98a9e1065d2b6f0eed36fb7
2654391527,MP: simplify payload config object construction,Vultraz,2025-07-10 01:46:26+00:00,2025-07-10 07:34:54+00:00,{'UI': 1},
2654086687,Remove the old tutorial,Vultraz,2025-07-09 21:57:50+00:00,,"{'Graphics': 1, 'Translations': 1, 'Unit Tests': 1, 'Units': 1, 'Achievements': 1, 'Campaign Tutorial': 1}","Opening this for @Pentarctagon's approval. Given that TSG has taken up the mantle of tutorial (and does quite a nice job of it), it makes little sense to keep the old tutorial around. It only serves to confuse new players."
2652304791,GUI/Events: Touch: double tap movement/single tap select,babaissarkar,2025-07-09 09:45:26+00:00,2025-07-10 11:36:04+00:00,"{'UI': 1, 'iOS': 1, 'Input': 1, 'Schema': 1, 'Android': 1}","Touch behavior changes:
* Double tap no longer shows context menu. It can still be accessed via long press.
* Single tap selects the unit. Another single tap on a hex shows hover info, which was previously not available.
* Single tap select followed by double tap on a hex moves the unit.
* Dragging now properly indicates the path and defense.

Also:
* mouse [hotkey]-s now support specifying the number of clicks.
* user visible mouse [hotkey] names (in Hotkey Preferences) are improved and will show number of clicks when >1. (i.e., left mouse instead of mouse 1)
* fixes long press delay accidentally being zero."
2651214916,Revise 1.19's new ships' stats,Dalas121,2025-07-08 23:25:13+00:00,2025-07-26 13:21:47+00:00,"{'Graphics': 1, 'Audio': 1, 'Units': 1}","This PR attempts to revise @doofus-01's new ships' stats, and adds some unit descriptions and attack animations.

Visually, most of these new ships are absolutely enormous, dwarfing even units like Tritons or Myrmidons. I've set them up as high-level units, with very high hitpoints but poor defense. They're much less mobile than their merfolk/naga counterparts, but to compensate are somewhat more powerful in direct combat.

For those who are familiar with my previous issue #10217, there's quite a few differences in this PR. The biggest changes are:
- Regular ships now have better defense: 40% in deep water, 30% in shallow water, 20% in swamp, and still 10% in reef/ford/bridge.
- The Skiff/Cutter/Sloop are now level 2/3/4, respectively. Their sprites are large enough that I felt they looked strange as level 1/2/3 units.
- The Transport ability isn't included here; it'll be part of a future PR.

This PR also uses the `[defense]` ability from #10279, which hasn't been added yet but supposedly will be soon. Once `[defense]` is merged I'll change this from a draft to a full PR.

Once this PR is feeling stable I'll submit this to the balance team for review."
2650729329,Lua jailbreak catch backport1.18,AI0867,2025-07-08 18:43:26+00:00,2025-07-11 15:01:40+00:00,"{'Unit Tests': 1, 'Lua API': 1, 'Stable 1.18': 1}",Backport of #10294
2649394819,MP/Faction Select: add listbox sorter for faction names,Vultraz,2025-07-08 10:32:11+00:00,2025-07-10 01:29:44+00:00,"{'UI': 1, 'Schema': 1}","Resolves #10338. Sorting is no longer done internally on the host, but is now a purely cosmetic operation for anyone selecting a faction. [era] auto_sort has been upgraded from a bool to now accept ""none"", ""ascending"", or ""descending""."
2647960407,Fix bug when receiving [notify_next_scenario] too early,gfgtdf,2025-07-07 21:57:09+00:00,2025-07-28 15:27:55+00:00,{'UI': 1},"Previously it could happen that on reciving [notify_next_scenario] the game fisrt sets end_turn_requested_ to ""true"" but when starintg linger mode it's set to false again."
2647939095,Fix #10029 leader for disabled side,gfgtdf,2025-07-07 21:42:49+00:00,2025-07-28 10:46:03+00:00,{'MP Lobby': 1},
2647267640,"TDG S07: add starting gold, replace vision indicator, and add note about luck",Dalas121,2025-07-07 16:08:49+00:00,2025-07-07 17:52:35+00:00,"{'Graphics': 1, 'Campaign TDG': 1}",Thanks to @doofus-01 for feedback.
2647230532,TSG: remove more fourth wall breaking dialogue,Dalas121,2025-07-07 15:53:49+00:00,2025-07-08 14:42:37+00:00,{'Campaign TSG': 1},Thanks for lhybrideur for helping with this.
2647104192,Editor Controller: Override error fix and cleanup,babaissarkar,2025-07-07 15:04:56+00:00,2025-07-07 17:06:48+00:00,{'Editor': 1},"Removes some orphan variables.
Fixes a override warning/error on master.
Opening for the CI run"
2645077165,1.19 Dune firetrooper sprites,doofus-01,2025-07-06 21:59:29+00:00,2025-07-06 22:59:35+00:00,"{'Graphics': 1, 'Units': 1}","This cleans up the dunefolk firetrooper sprites, and provides defense animations for them and for the scorchers."
2645058759,Fix non-permanent bans not actually working,Pentarctagon,2025-07-06 21:37:37+00:00,2025-07-11 18:32:14+00:00,"{'MP': 1, 'Add-ons': 1}","time_t ends up being a long while we only have if-blocks for int and unsigned long long. so the parameter doesn't get set at all, and somehow mariadbpp runs the query without all the required parameters being set."
2644432957,CI: Update Windows image,Wedge009,2025-07-06 08:45:46+00:00,2025-07-06 20:54:23+00:00,"{'Windows': 1, 'CI': 1, 'Stable 1.18': 1}",GitHub says Windows 2019 is no longer used and suggests to use Windows 2022 or 2025. master already does this via Windows 'latest'.
2644190159,Fonts: Replace Oldania with customized version,babaissarkar,2025-07-06 03:37:11+00:00,2025-08-12 13:55:35+00:00,{'UI': 1},"Replaces Oldania ADF Std with a customized variant that has a different 'A' which looks more distinct and less prone to be confused for a 'fi' ligature. Name changed to ""WesScript"" to conform with OFL license of Oldania.

Screenshots
**Oldania**
![Screenshot from 2025-07-06 08-13-05](https://github.com/user-attachments/assets/2a7332b2-167a-4e5b-987d-b01e1e66dd6c)

**WesScript**
![Screenshot from 2025-07-06 08-04-00](https://github.com/user-attachments/assets/bddebda4-1b8f-4a52-acf8-8526114df943)

**Old and new A comparison**
![Screenshot from 2025-07-06 07-56-37](https://github.com/user-attachments/assets/eb25891f-c256-4628-9472-f7c735ae173c)
"
2643493131,add tests for [gold],Pentarctagon,2025-07-05 15:50:11+00:00,2025-07-06 02:48:35+00:00,{'Unit Tests': 1},
2643431449,Several woptipng improvements,Elvish-Hunter,2025-07-05 14:40:43+00:00,,{'Packaging': 1},"This PR aims to make the `woptipng` script useful once again.
Since we started embedding copyright information directly into PNG images with EXIF tags, the script became useless because the tools used internally remove the metadata to reduce the file size. At first I though that I had to use some more command line switches, then I decided to use `exiftool` to preserve the metadata.

These are the improvements I made:

* added support for the `oxipng` script from the upstream repository
* used `exiftool` to read a few interesting (for us) EXIF tags (Artist, Copyright and UserComment), so they're added back after every single run of the four internal tools
* added command line switches to specify the paths of those tools, which should allow running the script on Windows (and on Linux I was able to use the AppImage release of ImageMagick instead of the one in the repositories!)
* improved the help text, so users know where to obtain the required dependencies.

Let me know if you find any issues (especially on Windows) or have any ideas."
2641471485,Additional Fire Wisp sprites and animations,Elvish-Hunter,2025-07-04 13:07:48+00:00,2025-07-11 10:08:15+00:00,"{'Graphics': 1, 'Units': 1}","I just found that there were some additional sprites for the Fire Wisp unit that I (and apparently everyone else) missed until now.
In the Path of Summoners MP Era for the 1.8 series, @fmunoz-geo added three more sprites that weren't available in previous versions: one for a recruit animation and two for a standing animation. This PR adds them; I also took care of adding the proper EXIF tags with `exiftool`."
2639489217,Remove FormulaAI,Vultraz,2025-07-03 19:39:38+00:00,2025-07-14 03:32:06+00:00,"{'macOS': 1, 'AI': 1, 'Units': 1, 'Building': 1, 'WFL': 1, 'Schema': 1}","This has been superseded by the Lua AI API. Its uses in mainline were removed in #5630.

Opening this PR for review to evaluate whether it's time to give FAI the axe completely. I know @CelticMinstrel mentioned at one point there were a few things the Lua AI could not yet do, but I can't recall if those have been resolved yet. Either way, it's been four years, and the deprecation notices indicate this was originally slated for 1.17.

This removes the entirety of the FAI engine and any related formula support in the AI code. It also removes the unused and unimplemented ability to execute arbitrary commands using the in-game console, since this relied on the FAI engine and was unimplemented for the Lua one."
2638748206,Fix [terrain_defaults] default value not being used,Vultraz,2025-07-03 14:33:37+00:00,2025-07-04 03:23:44+00:00,"{'Units': 1, 'WFL': 1}","Essentially, typed_formula was the wrong tool for this job. The default was only used if no input was provided, not if the formula itself evaluated to null."
2635940880,Allow var substitution for wml menu items at invocation time,Vultraz,2025-07-02 16:20:06+00:00,2025-07-05 15:14:59+00:00,{},"This includes a fix for #10270 which is required to implement #7948. I'm happy to commit the fix separately, but I'm putting them together for convenience, since I'd like feedback on both."
2632850981,"Use rect, point, and std::size_t consistently",Vultraz,2025-07-01 15:22:28+00:00,2025-07-02 13:20:22+00:00,"{'AI': 1, 'MP': 1, 'UI': 1, 'Editor': 1, 'Units': 1, 'Lua API': 1, 'WFL': 1, 'Help': 1, 'Terrain': 1}",
2632610194,Floating label cleanup and optimization,Vultraz,2025-07-01 14:06:24+00:00,2025-07-01 15:14:29+00:00,{'UI': 1},"Covers a bunch of misc changes to floating labels. Notably:
- Fixes damage floating labels not fading out over their whole duration
- Avoid calculating movement delta if no delta was specified (it had ended up as a multiplication by 0)
- Partially readds an early-exit optimization that was lost in the process of fixing #7700"
2628869816,GUI2: reworked the status label helper API,Vultraz,2025-06-30 13:05:00+00:00,2025-06-30 21:43:12+00:00,{'UI': 1},"This makes the actual usecases of it much cleaner and allows a bunch of code to be cleaned up.

- bind_status_label no longer takes IDs but instead widget references.
- Added bind_default_status_label to avoid having to manually specify the default getter just to specify a target ID.
- The setter helper is no longer returned. The only thing that relied on that was the map generator settings dialog, but this isn't needed anymore after fixing a bug in the slider code"
2627557324,1.19 Dunefolk Horse anims,doofus-01,2025-06-30 02:29:58+00:00,2025-07-06 22:03:33+00:00,"{'Graphics': 1, 'Units': 1}","The Dunefolk rider line, especially the archers, are missing even the most basic animations.  It might have been because the base frames still needed fixing.  I tried to keep the changes to the base frames as small as possible, but I couldn't figure out what to do with the original windbolt pose, so that got a more significant revision."
2627125396,Loyalist paladin arcane patch,knyghtmare,2025-06-29 17:34:51+00:00,2025-07-09 09:19:18+00:00,"{'Enhancement': 1, 'Units': 1, 'Campaign EI': 1}",As discussed by Balance Team
2627075003,NR S04: check if hex is passable before spawn,knyghtmare,2025-06-29 16:28:05+00:00,2025-06-30 07:18:02+00:00,"{'Enhancement': 1, 'Campaign NR': 1}",Source: https://forums.wesnoth.org/viewtopic.php?p=698930#p698930
2625952648, Compare units directly instead of locations ,newfrenchy83,2025-06-28 09:05:45+00:00,2025-06-28 16:00:27+00:00,{'Units': 1},"I didn't know how to do it anymore, and in a panic, I resorted to using locations, but comparing unit variables seems more robust to me."
2625925662,Use native widgets for theme dropdown menu toggles,Vultraz,2025-06-28 08:11:09+00:00,2025-06-29 05:38:30+00:00,"{'UI': 1, 'Editor': 1}","This encompasses several related changes which I'm bundling together:

- Game and Editor dropdown menus now use native GUI2 widgets for their toggle buttons instead of images. This allows them to be properly themed. At @CelticMinstrel 's suggestion, they are disabled, so one cannot interact with them directly as in the regular multimenu button. This makes event handling easier, since I had to account for the fact that the existing action system here expects the menu to close before executing the associated command.
- Radio button support was added to the dropdown menu. This has only been tested with the theme menus since we have no usecase otherwise.
- As a result of the changes necessary to get the checkboxes working, I was able to make use of the dropdown menu's native keep-open functionality for the editor music dialog instead of constantly reopening it every single time.
- `command_executor::get_action_image` has been removed. It's done nothing since 17a1bbd77707cff5134cc2bfd28cabcc0ff9f534"
2625087195,Editor/Controller: convert menu_type to a scoped enum,Vultraz,2025-06-27 18:07:13+00:00,2025-06-27 22:00:15+00:00,{'Editor': 1},
2625081746,Fix [filter_adjacent] which checks the central unit,newfrenchy83,2025-06-27 18:04:59+00:00,2025-06-27 21:59:51+00:00,"{'Unit Tests': 1, 'Units': 1}",Resolves https://github.com/wesnoth/wesnoth/issues/10304
2623858911,SotA: Update terrain,Wedge009,2025-06-27 10:01:28+00:00,2025-06-27 13:22:46+00:00,"{'Backport': 1, 'Campaign SotA': 1}","Closes #10299

I can see how this was missed in #5189 but I don't (yet) see the error message logged in #10299. 1.18 is also affected so it could be back-ported."
2621564067,fix specement error in windows.cpp,newfrenchy83,2025-06-26 15:36:53+00:00,2025-06-26 17:00:43+00:00,{'UI': 1},fix error in https://github.com/wesnoth/wesnoth/commit/cadc)6ec412db8fdc6b40a8b968bffa5a79c9fbde commit
2618364774,Lua jailbreak catch,AI0867,2025-06-25 14:09:39+00:00,,"{'Unit Tests': 1, 'Lua API': 1}","Add API to `lua_jailbreak_exception` to clear the rethrow mechanism. Use this API to stop lua `intf_show_dialog` from ~crashing the game~ _exiting scenarios_. Add a unit test for this.

Fixes #9178."
2617259125,specials/abilities string substitution refactor,babaissarkar,2025-06-25 07:29:34+00:00,2025-06-27 08:26:44+00:00,{'Units': 1},"Resolves #10290

* extends plague type substitution to inactive strings and when plague is used as an ability instead of a special
* substitution for help browser and unit preview pane
* various attempts to code simplification"
2612124790,Fix assertion after event cleanup failue,gfgtdf,2025-06-23 16:01:15+00:00,2025-06-29 00:50:43+00:00,{'Engine': 1},"its possible that event cleanup fails. I don't see any serious problems in that case so i replaced that assertion with a ERR_NG.

See also issue #9708"
2611875738,Fix 'name_afected' implemented in [specials] specials by error,newfrenchy83,2025-06-23 14:30:27+00:00,2025-06-28 06:03:11+00:00,"{'UI': 1, 'Units': 1, 'Campaign UtBS': 1, 'Campaign TDG': 1}",name_affected attribute is intented for abilities used like specials only
2609840211,convert game presets into preferences,Pentarctagon,2025-06-22 16:48:12+00:00,2025-07-05 15:21:32+00:00,"{'MP': 1, 'UI': 1, 'Schema': 1}","In the lobby:
![lobby](https://github.com/user-attachments/assets/7b5f9fef-a56f-44ad-aa53-038e3898b8a7)
The save button:
![button](https://github.com/user-attachments/assets/a3c428fc-d58e-42c9-820a-39835d843aae)"
2609687426,"Add a prefix "" MP"" for saves of hybrid campaigns run in MP",Discontinuum,2025-06-22 12:20:35+00:00,2025-06-29 05:34:14+00:00,{'MP': 1},"Fix #8871 Add a prefix "" MP"" for saves of hybrid campaigns run in MP so SP and MP runs don't mix up

Not sure which text domain "" MP"" string will be in, but I guess it will be translatable

![изображение](https://github.com/user-attachments/assets/4bbe8e1f-7bfa-4364-8a80-7a8b2a984d58)
"
2609105294,Use name_affected attributes in abilities for affected units.,newfrenchy83,2025-06-21 16:00:47+00:00,2025-06-23 14:42:21+00:00,"{'Units': 1, 'Schema': 1, 'Campaign DiD': 1, 'Campaign HttT': 1, 'Campaign UtBS': 1, 'Campaign TDG': 1}","
This will allow the effect and description of the effect to appear in the sidebar, which can be more useful when the ability is used beyond radius 1.

Attributes in abilities used as weapons are renamed to avoid unwanted use."
2608878755,Hotkey action state cleanup,Vultraz,2025-06-21 08:26:19+00:00,2025-06-21 16:56:44+00:00,{'Editor': 1},
2607499289,Units: Dwarvish Thunderer cost -1G,knyghtmare,2025-06-20 13:21:10+00:00,2025-06-21 15:11:32+00:00,{'Units': 1},As discussed by Balance Team
2607386535,Editor/Edit Side: don't add/write game default base_income,babaissarkar,2025-06-20 12:45:11+00:00,2025-06-28 07:39:28+00:00,"{'AI': 1, 'UI': 1, 'Editor': 1, 'Terrain': 1}","Resolves #10123

Reasoning given in https://github.com/wesnoth/wesnoth/issues/10123#issuecomment-2991271494, quoted here:

> 
> This is where the `+2` comes from:
> https://github.com/wesnoth/wesnoth/blob/a1d3e10e75b6695dc8466360168525a1bb47d743/src/team.hpp#L183
> 
> (game's base income is `2`, which gets added to the value loaded from the file)
> 
> `base_income()`'s retval is used for the `editor_team_info` constructor here:
> https://github.com/wesnoth/wesnoth/blob/a1d3e10e75b6695dc8466360168525a1bb47d743/src/editor/map/map_context.cpp#L46
> 
> Which in turn gets used in the Edit Side dialog, so when you save it it's income from saved scenario file + base income of game."
2605510727,Lower Drake Arcane Resistance,Refumee,2025-06-19 18:44:28+00:00,2025-07-25 14:06:21+00:00,{'Units': 1},"Adjusting the arcane resistance of Drakes to -20%.
- It will apply to all Drakes
- Drakes are magically beings as well as skeletons
- for consistency with https://github.com/wesnoth/wesnoth/pull/10275"
2604312251,[Units] Huntsman & Ranger balance adjustments,ForestDragon-wesnoth,2025-06-19 10:12:47+00:00,,{'Units': 1},"This PR introduces the following changes:

Huntsman:

-HP increased from 53 > 57 (pre-nerf value from 1.16)

-Swamp Lurk ability removed

Reasoning:

[hides] abilities massively affect the balance and gameplay of scenarios. In wesnoth balance, even a difference in resistances can majorly impact existing content (example - the now-partially-reverted arcane resistance, where the arcane rework affected most units in the game to some degree.).

Adding Swamp Lurk to the Huntsman is a very drastic change: despite the 2 MP cost in swamp, it enables stealth-based leaderkills on swamp-heavy maps that were previously impossible. And it is important to remember that the swamp tiles don't have to be consecutive to trick the AI - if it's a few swamp puddles with mostly flat in-between, even with 2mpcost swamp it is trivial to exploit.

And on the flipside, swamp scenarios with huntsmen as enemies suddenly become more difficult in an way that goes entirely against how the unit is normally designed (fully-visible DPS unit), it's like if you took a scenario where you fight loyalists in a forest, and then you swap every master bowman for an elvish avenger.



Ranger:

-castle defense 50% > 60%

Reasoning:

I believe the castle defense nerf is both mechanically an unnecessary decision (the unit was below-average before, it did not need nerfs to compensate the buffs he was given), and thematically doesn't hold water - the Ranger may be more 'wild' than the average human, yes, but he's not a feral animal. Even skeletons have 60% castle defense, even wolves, actual straight-up animals have 60% castle defense. The castle provides defense because it has walls, not because you can socialize well in it.



While I respect the initial idea that the lvl3s in the Poacher line were underpowered and deserved buffs, I believe PR #9582 overstepped beyond what was reasonably necessary to make the units viable."
2602212327,Allow checking multiple [filter_adjacent/location] in the same ability,newfrenchy83,2025-06-18 15:52:26+00:00,2025-06-18 16:38:28+00:00,"{'Unit Tests': 1, 'Units': 1}","Until now, using multiple filters required all filters to match for the ability to be active, but if we have [filter_adjacent] race,count=elf,2 and [filter_adjacent] race,count=human,3, we cannot use [filter_adjacent] race,count=elf,2 or race,count=human,3 because count is not part of the standard filtering and cannot be encoded in an [and/or/not] subtag, hence the idea of multiple filters."
2599683349,Add [defense] ability to be able to modify base cth while be overwritable by [chance_to_hit],newfrenchy83,2025-06-17 18:59:25+00:00,2025-07-24 00:47:01+00:00,"{'Unit Tests': 1, 'UI': 1, 'Units': 1, 'Schema': 1, 'Campaign DiD': 1, 'Campaign HttT': 1, 'Campaign UtBS': 1, 'Campaign TDG': 1}","In cases like 'dazed' (UTBs and TdG), you must specify the CTHs that should not be altered for the unit's precision part. For its defense, you must repeat the first operation, but also add a [chance_to_hit]add=10 apply_to=opponent active for marsksman when the base CTH is greater than 60. This is annoying in situations where eras or other resources are involved, hence the idea of a 'defense' ability."
2596741419,Hotkey/Handler: optimize menu list generation,Vultraz,2025-06-16 19:53:06+00:00,2025-06-20 04:40:45+00:00,{},"Instead of constructing an intermediate list whose special members (wml items, autosaves, etc) are then expanded, simply append the expanded items on the initial pass.

Also optimizes the case where a large number of configs would be constructed for long games, only to be pruned."
2596180177,Place the codes for [filter_adjacent] and [filter_adjacent_location] in the same function to avoid duplicating the code,newfrenchy83,2025-06-16 15:53:45+00:00,2025-06-17 19:44:10+00:00,{'Units': 1},
2594267357,add overlay layer wildcard to standing anim terrain filter,doofus-01,2025-06-16 02:33:57+00:00,2025-06-16 03:46:24+00:00,{'Units': 1},resolves #10273
2593800442,Skeletal Undead Arcane Resistance Resolution,knyghtmare,2025-06-15 16:31:21+00:00,2025-06-16 17:52:20+00:00,"{'Unit Tests': 1, 'Units': 1, 'Campaign EI': 1}","- Corrections done as decided by @Pentarctagon
- **Applies only to Skeletal Undead Units.**"
2593571337,"HttT: remove ""sparkles"" from Li'sar's Initiative ability",Dalas121,2025-06-15 13:11:51+00:00,2025-06-16 01:59:22+00:00,"{'Graphics': 1, 'Campaign HttT': 1}",Resolves #10271
2593102784,1.19 - add primary key to boat frames,doofus-01,2025-06-14 23:41:52+00:00,2025-06-15 01:56:12+00:00,{'Units': 1},addresses the comment here: https://github.com/wesnoth/wesnoth/issues/10217#issuecomment-2964421227
2590092708,fix 'cumulative' attribute not added in abilities filter shema validation(1.18 backport),newfrenchy83,2025-06-13 12:09:51+00:00,2025-06-13 13:25:12+00:00,{'Schema': 1},
2589579092,fix 'cumulative' attribute not added in abilities filter shema validation,newfrenchy83,2025-06-13 08:56:51+00:00,2025-06-13 09:54:34+00:00,{'Schema': 1},
2588362023,"Use math.randomseed make break_replay_with_lua_random reliable, closes #10143",ProditorMagnus,2025-06-12 19:56:07+00:00,2025-06-13 09:01:30+00:00,{'Unit Tests': 1},
2588297417,MP/Connect Engine: add ability to disable faction sorting,Vultraz,2025-06-12 19:27:13+00:00,2025-06-13 04:42:27+00:00,{'Schema': 1},"See #3177, resolves #7753. Adds an `auto_sort` key to [era] which, if false (default true), will use the [multiplayer_side] order as given in the config.

@ProditorMagnus is this acceptable?"
2587602577,[Units] Wyvern Rider: update ranged attack anim,knyghtmare,2025-06-12 14:35:33+00:00,2025-06-13 17:22:48+00:00,"{'Enhancement': 1, 'Units': 1}","Previously, it was doing a melee attack thing for a ranged attack..."
2585637347,Check the correct attribute for sub achievements,Pentarctagon,2025-06-11 23:38:13+00:00,2025-06-12 04:53:56+00:00,{},Fixes #10187
2577952546,[1.18] Floating label replace fix backport,babaissarkar,2025-06-09 09:56:29+00:00,2025-06-12 05:51:23+00:00,{'Lua API': 1},"Backport of 1d039c395dc44b93e9c22424cf976f0740284897 (#10258).
Resolves #10098 for 1.18.
"
2576844482,Lua API: add padding option to add_overlay_text,Vultraz,2025-06-08 17:08:19+00:00,,{'Lua API': 1},
2574055354,floating label/replace: properly use optional handle,babaissarkar,2025-06-06 17:24:16+00:00,2025-06-07 06:03:15+00:00,{'Lua API': 1},Resolves #10098.
2564593011,Add names or descriptions of abilities used as weapons to the sidebar.,newfrenchy83,2025-06-03 16:35:47+00:00,2025-06-11 16:44:28+00:00,"{'UI': 1, 'Units': 1, 'Schema': 1, 'Campaign HttT': 1, 'Campaign UtBS': 1}","To do this, the special_name and special_description attributes should be used instead of the usual attributes to name or describe the ability's effect on the weapon."
2562861392,wmlxgettext: Replace utcnow(),Wedge009,2025-06-03 07:02:54+00:00,2025-06-08 19:16:45+00:00,{'WML Tools': 1},"Python 3.12 deprecates `datetime.datetime.utcnow()`. Reference: https://docs.python.org/3/library/datetime.html#datetime.datetime.utcnow

I don't think there's any reason to use 'local' time here.

Also remove some unused/redundant pieces."
2562377765,TSG: replace {SAY_COMPANION} macro with lua,Dalas121,2025-06-03 02:26:16+00:00,2025-06-04 18:26:40+00:00,{'Campaign TSG': 1},Resolves #10227. Replaces #10237
2559968069,add id to event_abilities in Utbs,newfrenchy83,2025-06-02 09:42:02+00:00,2025-06-04 19:04:26+00:00,{'Campaign UtBS': 1},"Complete https://github.com/wesnoth/wesnoth/commit/8a3be4fd3eebdf1eaae28be530a86f3830f33548

reply to https://github.com/wesnoth/wesnoth/issues/10243#issuecomment-2929514717"
2558756860,1.19 attack animations for Dunefolk Rover,doofus-01,2025-06-01 23:16:04+00:00,2025-06-09 01:17:21+00:00,"{'Graphics': 1, 'Units': 1}",
2558438662,attempt to fix frost nova and soul rend,newfrenchy83,2025-06-01 18:01:14+00:00,2025-06-02 05:13:50+00:00,{'Campaign DiD': 1},Fix https://github.com/wesnoth/wesnoth/issues/10243 and https://github.com/wesnoth/wesnoth/issues/10244
2558341814,Fix weapon tooltip to display modifications by [damage_type],newfrenchy83,2025-06-01 16:21:29+00:00,2025-06-16 11:38:17+00:00,{'Units': 1},"
else [damage_type] not used in tooltips"
2557920670,Fix Sidebar tooltip no longer shows effect of unit damage resistances(always 0%),newfrenchy83,2025-06-01 09:22:45+00:00,2025-06-01 15:00:00+00:00,"{'Units': 1, 'Engine': 1}",Fix https://github.com/wesnoth/wesnoth/issues/10241 issue.
2557517028,"Unit Type: delete copy, default ctors",Vultraz,2025-06-01 02:38:51+00:00,2025-06-02 18:36:43+00:00,{'Units': 1},"#10053 inadvertently added a variable which copied a unit_type. This would have been caught had the copy ctor been deleted 
(as copy assignment already is). Since these aren't objects we'll be passing around, better to delete both to catch such cases in future. Ironically, the only place that actually used the unit_type copy ctor was the unit_type copy ctor itself (and the code for copying the gender variations looks broken anyway - it was checking whether the wrong variable was non-null!)

Also added a default definition of the move assignment operator (we already had a move ctor), and deleted the default ctor (unimplemented) ~~and dtor (empty~~)."
2557358188,Fix crash with invalid unit type in weapon special tooltip,Vultraz,2025-06-01 00:07:07+00:00,2025-06-02 06:52:37+00:00,{'Units': 1},Fixes #10240. ~~Also expands the use of the $type variable to any special for consistency.~~
2554854661,Fix Undoing a move by a counterspell-caster fails to undo the counterspell halo move,newfrenchy83,2025-05-30 14:03:38+00:00,2025-06-13 17:02:32+00:00,"{'Graphics': 1, 'Campaign TDG': 1}",resolve https://github.com/wesnoth/wesnoth/issues/10136 and https://github.com/wesnoth/wesnoth/issues/10135 issues
2553317607,TSG: fix {SAY_COMPANION} macro not using translations,Dalas121,2025-05-29 22:03:18+00:00,2025-06-03 02:26:18+00:00,{'Campaign TSG': 1},Resolves #10227
2552334857,Separate support for special weapons and filtering into separate functions.,newfrenchy83,2025-05-29 14:14:01+00:00,2025-06-05 07:40:21+00:00,{'Units': 1},"

This will allow for clear code reading for each type of function instead of using multitasking functions, and also allow for simultaneous filtering of 'special_id' and 'special_type'. Previously, the functions had to be called once per attribute. We had [filter_weapon]special_id_active=a and special_type_active=damage. This required a full check for special_id_active, then a repeat check for special_type_active, and the detection of each of them wasn't always done at the same point. Now, we'll have a simultaneous check where the detected special will necessarily be a [damage]id=a, and not an [attacks]id=a accompanied by a [damage]."
2550865324,use std::from_chars for the integer variants (issue #10009),gfgtdf,2025-05-29 00:28:16+00:00,2025-05-30 22:59:21+00:00,{'Engine': 1},"boost::charconv::from_chars with integers is broken on boost 1.85 (fixed in boost 1.86)

however for the floating point variants we still need boost on some compilers since those are sometimes missing/incomplete on std"
2547306824,Fix strict aliasing by not type-punning,AI0867,2025-05-27 18:42:55+00:00,2025-06-01 00:48:38+00:00,"{'Graphics': 1, 'Unit Tests': 1}","Instead of type-punning to smaller struct, just pas the const-ref to the larger one. The functions are intended to be inlined anyway."
2546873398,xBRZ: attempt to fix strict aliasing violation,Vultraz,2025-05-27 15:31:03+00:00,2025-05-28 16:05:25+00:00,{'Graphics': 1},"@AI0867 had another proposed fix, but just opening this to see if it satisfies CI at least."
2545331244,Playturn Network Adapter: remove unused functions,Vultraz,2025-05-27 05:31:38+00:00,2025-05-27 13:45:48+00:00,{'Network': 1},
2545223545,update to latest mariadbpp,Pentarctagon,2025-05-27 04:13:50+00:00,2025-06-03 03:10:39+00:00,"{'Building': 1, 'CI': 1, 'SCons': 1, 'CMake': 1}",build the servers with strict enabled
2542861107,"Remove XMP metadata, use EXIF for PNGs",doofus-01,2025-05-26 02:41:40+00:00,2025-06-01 22:04:42+00:00,"{'Graphics': 1, 'MP': 1, 'Units': 1, 'CI': 1, 'Campaign DW': 1, 'Campaign HttT': 1, 'Campaign L': 1, 'Campaign TRoW': 1, 'Campaign UtBS': 1}","This is to remove XMP metadata that is currently used for PNGs, since the intended benefits do not outweigh the costs.  See #9312 

- [x] Update CI to check for EXIF tags, no longer check for XMP tags

Update unit sprite images (includes moving critical data out of PNG chunk)
- [x] bats
- [x] drakes
- [x] dunefolk
- [x] dwarves
- [x] elves-wood
- [x] goblins
- [x] human-loyalists
- [x] human-magi
- [x] human-outlaws
- [x] human-peasants
- [x] merfolk
- [x] monsters
- [x] nagas
- [x] ogres
- [x] orcs
- [x] saurians
- [x] transport
- [x] trolls
- [x] undead
- [x] undead-necromancers
- [x] undead-skeletal
- [x] undead-spirit
- [x] woses

Not really part of the code or program data, but the wiki page on this stuff (https://wiki.wesnoth.org/ImageMetadata) should be updated.
- [x] Update Wiki"
2542574894,Wesnothd: make ping command useful,Vultraz,2025-05-25 18:28:21+00:00,2025-06-02 21:15:51+00:00,{'MP': 1},"While there was an existing ping command, it did nothing by send a message to the server which was silently ignored. This new implementation now reports the roundtrip packet flight time, in milliseconds."
2542326411,fix id=poison can poison opponent same if in another type of special,newfrenchy83,2025-05-25 09:40:34+00:00,2025-05-28 21:10:41+00:00,"{'Unit Tests': 1, 'Units': 1}","Fix https://github.com/wesnoth/wesnoth/issues/10225 issue. if for example, someone has fun giving a special [chance_to_hit] an id=poison, then the target will be poisoned once hit, this PR solves this problem"
2541588494,"Add core (add-on with id=""mainline"") to list of installed add-ons",demario-w,2025-05-24 09:06:23+00:00,2025-06-24 16:25:19+00:00,{'Add-ons': 1},fixes #10220
2540605849,Chat Handler: use std::chrono over C time API,Vultraz,2025-05-23 18:26:38+00:00,2025-05-25 06:42:41+00:00,"{'AI': 1, 'UI': 1, 'Lua API': 1, 'WFL': 1}","The chrono work continues. Besides misc changes and some things still using SDL_GetTicks, this should be the last of the big chrono batch changes."
2540100788,add a 'radius' to abilities [filter_adjacent] and [filter][filter_adjacent].,newfrenchy83,2025-05-23 14:50:41+00:00,2025-06-13 18:37:31+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1}",with using this attribute it is possible to filter unit on a radius greater than 1.
2537923383,Consistently mark move operations noexcept,Vultraz,2025-05-22 18:10:21+00:00,2025-05-23 14:56:20+00:00,"{'UI': 1, 'Units': 1, 'Lua API': 1, 'WFL': 1, 'Terrain': 1}",
2532112133,Add a 'radius' attribute to [affect adjacent] to allow abilities to affect distant units on the map,newfrenchy83,2025-05-20 16:48:29+00:00,2025-05-28 20:40:27+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1, 'Campaign DiD': 1}","This way, distant units can be checked without going through a different subtag."
2527225432,Ships clean-up,doofus-01,2025-05-18 23:21:48+00:00,2025-05-25 02:18:53+00:00,"{'Graphics': 1, 'Units': 1}","This is to clean up the new ship units' move-types, alignments, names, and small graphics issues.  Getting the other specifications fleshed out will take more feedback on the usage, it will need to be a different PR."
2527124989,Reinstate const modifiers to keep player_connections key constraints protected,soliton-,2025-05-18 19:14:14+00:00,2025-05-25 20:32:43+00:00,{'MP': 1},
2527055830,Simple WML: range for,Vultraz,2025-05-18 16:38:47+00:00,2025-06-02 19:08:00+00:00,"{'MP': 1, 'Add-ons': 1}",No functionality changes.
2526985140,Units Dialog: support marking units as favorite,babaissarkar,2025-05-18 14:18:01+00:00,2025-05-20 17:45:18+00:00,"{'UI': 1, 'Units': 1}","Resolves #7733

Adds a new button to the Units List and Recall dialog using which units can be marked as favorite. Favorite unis are shown (for now) with a white filled star in the leading column, while rest are shown with unfilled white star.

![Screenshot from 2025-05-19 10-01-47](https://github.com/user-attachments/assets/11bc58ea-2cbe-4838-9e90-514614670ef1)
![Screenshot from 2025-05-19 10-01-24](https://github.com/user-attachments/assets/0b767545-eba6-4f2a-9777-1972f44f1cec)
"
2526322276,GUI2/Network Transmission: refinements,Vultraz,2025-05-17 20:54:24+00:00,2025-05-18 16:06:09+00:00,{'UI': 1},"- Remove unnecessary invalidate_layout call
- Fix progress bar sometimes not filling up when completed
- Allow final progress stage to display
- Use a pointer instead of optional_reference"
2525211752,Wesnothd: avoid unnecessary copy of new player object,Vultraz,2025-05-16 19:45:48+00:00,2025-05-17 19:55:06+00:00,{'MP': 1},"- Use emplace when adding entry to player_connections_
- Remove const members from `player` to allow implicit move ctor to work
- Take `player` by rvalue reference in `player_record`"
2522087664,remove extra spaces in src/,newfrenchy83,2025-05-15 13:18:32+00:00,2025-05-15 13:23:10+00:00,"{'AI': 1, 'MP': 1, 'UI': 1, 'Editor': 1, 'Units': 1, 'Lua API': 1, 'Add-ons': 1, 'WFL': 1, 'Help': 1, 'Schema': 1, 'Terrain': 1, 'Achievements': 1}","I'm happy to remove the extra spaces like suggest @Pentarctagon , but in this case, it's best to do it in all the source files to encourage the developer engines to standardize their code writing.

The problem is that checking file by file is a real nightmare, and I doubt this PR can be merged as is, given the time it's going to take."
2520355866,Separate out GUI logic and handle more curl errors,soliton-,2025-05-14 21:09:01+00:00,2025-05-25 20:34:52+00:00,{'Network': 1},
2520303037,Adjust loading screen to current code,soliton-,2025-05-14 20:38:12+00:00,2025-05-19 20:37:52+00:00,{'UI': 1},
2520219485,CMake: use add_compile_definitions,Vultraz,2025-05-14 19:52:34+00:00,2025-05-15 05:31:49+00:00,"{'Building': 1, 'CMake': 1}",
2520213188,Handle boost process defaulting to v2 and add missing include,soliton-,2025-05-14 19:50:08+00:00,2025-05-16 21:30:07+00:00,"{'Building': 1, 'Stable 1.18': 1}",
2520145000,Simple WML: remove unused function with infinite loop,Vultraz,2025-05-14 19:13:59+00:00,2025-05-14 23:04:00+00:00,"{'MP': 1, 'Add-ons': 1}","Added in 2f95e5b43d47bebed3fdf636e867ea7458a56f94 and unchanged since. Was unused then, unused now, doesn't actually seem to insert anything, and is an infinite loop."
2519906412,Simple WML: make use of unique_ptr,Vultraz,2025-05-14 17:11:22+00:00,,"{'MP': 1, 'Add-ons': 1}",Reduces manual memory management by using unique_ptr. Doesn't (yet) touch `document::buffers_` since that's a slightly more in-depth change.
2518706248,update codeblock projectfiles,newfrenchy83,2025-05-14 09:20:30+00:00,2025-05-14 12:09:49+00:00,{'Building': 1},
2517270345,"TSG, TDG: capitalize ""XP""",Dalas121,2025-05-13 17:41:12+00:00,2025-05-13 22:58:09+00:00,"{'Campaign TSG': 1, 'Campaign TDG': 1}",
2515518822,Fix width weirdness with add_overlay_text (1.18),Wedge009,2025-05-13 05:48:13+00:00,2025-05-13 18:51:12+00:00,"{'UI': 1, 'Lua API': 1, 'Stable 1.18': 1}","Closes #9591

Back-port of 8ee2a2663451f1c68cc2ee76483f6c9f7340ac07"
2515002422,backport fixes for building with boost 1.88,Pentarctagon,2025-05-12 21:51:06+00:00,2025-05-14 15:05:13+00:00,"{'Building': 1, 'Packaging': 1, 'SCons': 1, 'CMake': 1}",
2514147527,(1.18) Implement <img> scale= attribute into the Help system markup and use it for unit portraits,irydacea,2025-05-12 15:00:27+00:00,2025-05-12 20:13:21+00:00,"{'UI': 1, 'Help': 1, 'Stable 1.18': 1}","Firstly, this patch adds an `<img> scale=` attribute that allows the user to express rendering intent for images that have been transformed via `~SCALE_INTO()` and similar IPFs. When this attribute is used, the UI shrinks the image's draw size accordingly so that the final result does not get upscaled according to the screen's pixel scale *again*, which can result in excessively blurry images on high pixel density screens (e.g. Apple Retina).

Secondly, this makes the unit type page generator convey the scale information in `<img>`, since it's the generator and not the rendering code that's currently in charge of picking the correct numbers for scaling portraits up according to the display device's properties.

This all fixes a major issue on high pixel density screens where the previous fixes for portrait upscaling quality and extents would cause the portraits to be upscaled again on render, resulting in incredibly blurry results (undermining the intent of the original fix) and a massive lack of room for the unit description text due to half the dialog being occupied by the portrait.

(Tested on a 2021 16"" MacBook Pro, both on the native panel and an external 1080p display. Additional testing would be very much welcome.)

### Before
<img width=""1455"" alt=""Screenshot 2025-05-12 at 10 57 09"" src=""https://github.com/user-attachments/assets/2dd96c80-17b3-408e-a2be-5055755a827a"" />

### After
<img width=""1455"" alt=""Screenshot 2025-05-12 at 10 56 34"" src=""https://github.com/user-attachments/assets/638aaa98-02e5-48b3-b814-5b0c56a0c2d3"" />"
2512268414,TDG: difficulty adjustment,Dalas121,2025-05-11 19:07:01+00:00,2025-05-12 20:33:39+00:00,"{'Achievements': 1, 'Campaign TDG': 1}","The Deceiver's Gambit
- Easy and Normal difficulties are now more challenging
- Delfador now references Elende's prophecy much more in Part II
- Numerous minor dialogue changes, scenario tweaks, and bug fixes"
2510678964,TSG S06: add tip about building a recall list,Dalas121,2025-05-09 22:47:22+00:00,2025-05-11 16:54:10+00:00,"{'Graphics': 1, 'Campaign TSG': 1}",
2510633093,Fix some linter issues relating to move/const refs,jj-marr,2025-05-09 21:59:06+00:00,2025-05-19 22:23:10+00:00,"{'AI': 1, 'MP': 1, 'Units': 1, 'Add-ons': 1}","Specifically, this redeclares some parameters as const references when those parameters are only used in a const way. It also removes std::move from being used on those parameters as you cannot move a const ref. Finally, it also adds std::move when necessary.

I'm not sure why these got missed but they appear as errors on my own machine."
2509633589,Improve the performance of wildcard_string_match,smokespren,2025-05-09 13:15:52+00:00,2025-05-11 19:16:12+00:00,{'Engine': 1},Completely rewrote the function to be 2-5x faster in most cases. Fixed a passing test case that should have failed and added a few more cases.
2502806384,Spaceship operator for light_adjust,Vultraz,2025-05-06 22:32:41+00:00,2025-05-07 00:32:35+00:00,{'Building': 1},
2502492809,Remove non-sensical get_dir calls,soliton-,2025-05-06 19:31:52+00:00,2025-05-14 20:21:36+00:00,{'Engine': 1},
2499586121,Store lightmap data keys explicitly,Vultraz,2025-05-05 19:20:09+00:00,2025-05-06 04:01:30+00:00,{'Graphics': 1},"Apparently, using a hash could lead to potential collisions and the wrong surface being pulled."
2498320981,Update .gitignore to ignore the LOCAL_APPDATA_FONTCONFIG_CACHE directory,knyghtmare,2025-05-05 09:59:35+00:00,2025-05-05 10:54:00+00:00,{},- Creates itself on latest master for some reason.
2497714144,1.19 Elf Ships,doofus-01,2025-05-05 03:09:40+00:00,2025-05-17 13:03:26+00:00,"{'Graphics': 1, 'Units': 1}","First draft of the first one for now, at least one more planned.  

Depending on how long that takes, this might also be a good time to clean up the organization and naming scheme."
2497408969,Saurian color adjustments,czyzby,2025-05-04 17:11:48+00:00,,"{'Graphics': 1, 'Units': 1}","* Fixes the color of saurian mouths, mostly in SE death animations.
  * In particular, `#c50203` from the original sprites used for tongues got converted to `#9e005d` which is one of the magenta colors switched based on the faction. There aren't any reds that would be a close fit in the current color map, but the available `#e45a4c` works quite well.
* Changes the colors of the saurian ambusher's shield.
  * See [this comment](https://github.com/wesnoth/wesnoth/issues/9470#issuecomment-2849104060) for a comparison. After the automatic recolor, the contrast on the shield was notably increased with a dark gray clashing against bright blue. I changed the colors to blues (edited variant A from the previous link) to match the spear material somewhat. It's still a bit jagged and might give an impression of changing shapes between the frames, but I think it's the best that can be done with an automatic recolor given the current palette.\
  \
  As a side note, I believe the shield was originally designed as a wooden one with a metallic shield boss in the center. The currently available browns don't really work well in any combination that I've tried though. Grays could work, but I think blues are better for metal. In general, it's difficult to come up with a combination that looks well within the current palette as the pre-1.16 color map was a lot larger and the original shield in particular used completely custom colors with less contrast. If you'd like me to submit another variant instead, please let me know.

All images are optimized with `woptipng` with the metadata tags converted to the expected format.

See #9470."
2497261529,[1.18] Help topic logic improvement,babaissarkar,2025-05-04 11:09:54+00:00,2025-05-05 03:15:07+00:00,"{'Backport': 1, 'Editor': 1, 'Help': 1}","Backport of 53b08325e7729397859b476dcd8c306aa514cb27, 81a7ba55dfb0771e1e03110eb69c040849ef7de5 and 8a2515d428393012ec5562a7ec29fb24a5a6b1c9, with 1.18 specific adjustments. (The second commit was small so it was squished into the preceding one)"
2497035962,Use boost::process::v2 on 1.86 and later,Vultraz,2025-05-03 22:13:08+00:00,2025-05-12 18:57:31+00:00,"{'Building': 1, 'Packaging': 1, 'SCons': 1, 'CMake': 1}","Resolves #10174. There doesn't seem to be a straight replacement for `process::process_error`, so I'm just going for a catch all `std::exception`."
2495963945,units_dialog.cpp: edit message text,knyghtmare,2025-05-02 15:57:50+00:00,2025-05-04 16:26:53+00:00,"{'Enhancement': 1, 'UI': 1, 'Prose': 1, 'Engine': 1}","To support the Great Horde mechanic in SotBE
Closes #8265
supersedes #9887

Note: Another non-engine alternative solution is modifying SotBE's Great Horde mechanics code itself. So, can do that if this does not fly either."
2495093061,Use boost::unordered_flat_map for image caches,Vultraz,2025-05-02 07:19:24+00:00,2025-05-02 17:34:01+00:00,{},"In testing, this change not only results in a noticeable improvement to map scrolling, but reduced cache access times across the board, sometimes by an order of magnitude. Given this is one of the most frequently hit codepaths, the little (and not-so-little) gains add up.

The locator hash remains unchanged, only moved to a static `hash_value` function in the `image` namespace, as `boost::hash` expects,"
2494963502,Use boost to hash lightmap range,Vultraz,2025-05-02 05:26:17+00:00,2025-05-02 07:10:18+00:00,{},"Supersedes and closes #10154. Confirmed this fixes at least one issue with ToD borders I noticed when testing with EI S2.

After giving the problem more thought, I decided to just let boost handle the actual has implementation instead of trying to come up with a suitable one myself. This is consistent with the `image::locator` hash which also uses `boost::hash_combine`.

I considered the feedback that suggests using the vector directly as a map key and relying on lexicographical comparison for cache lookup. That would require using a plain map instead of an unordered_map. As long as the cache uses an unordered map, a hash needs to come from *somewhere*, and using the span view (or even the vector itself) as a key would require specializing a range hash object. `boost::hash_range` provides a convenient method to implement such an object, for which the `hash_value` overload added here is required (`boost::hash` takes a different approach to customization than `std::hash`, which relies on specialization). In either case, a hash function for `light_adjust` is required. It seems wise to simply let boost handle the details of Good Hashing. Why call `hash_range` directly instead of using the span view as a map key? As I explained on Discord, it seems in contrast *unwise* to leave a bunch of pointers to freed memory sitting around in the cache.

One change I'm considering is whether it makes more sense to use `hash_unordered_range`. The order of `light_adjust`s is well-defined (always in ascending order by their `l` value, so perhaps it's not a practical consideration here. Semantically, though, swapping the order of the range elements shouldn't affect the hash..."
2494273459,TDG: several dialogue and gameplay tweaks,Dalas121,2025-05-01 18:17:31+00:00,2025-05-02 17:31:32+00:00,{'Campaign TDG': 1},"- Various dialogue tweaks in Part II to better-resolve some of Part I's lingering plot threads.
- S11: use simple_attack MAI for AI-vs-AI fighting, to reduce lag
- S11: reduced number of Orcish Adepts/Shamans, and added a voiceline when one of them is attacked
- S13: replaced Orcish Adepts/Shamans with regular cannon-fodder units."
2493583232,Fixed CMake build failure due to dependency on Boost CharConv,smokespren,2025-05-01 10:55:07+00:00,2025-05-03 22:00:55+00:00,"{'Building': 1, 'CMake': 1}",A fresh build on Manjaro Linux fails due to not including Boost::CharConv in the CMake build scripts. Adding the following patch fixes the issue.
2491538909,filesystem: simplify to_asset_path,babaissarkar,2025-04-30 13:43:15+00:00,2025-05-10 14:34:24+00:00,"{'UI': 1, 'Editor': 1}","Uses `boost::filesystem::path` and the `filesystem::is_prefix` method to improve the `filesystem::to_asset_path` method, hopefully improving cross-platform compatibility.

Resolves #9579
"
2490294913,Avoid translating entire table chunk in Help,Wedge009,2025-04-30 02:24:33+00:00,2025-04-30 03:38:20+00:00,"{'Translations': 1, 'Prose': 1, 'Help': 1}",The individual table items are already translated separately.
2486301423,use two different names for 'marksman' special when used in melee or ranged.,newfrenchy83,2025-04-28 16:08:59+00:00,2025-08-23 04:01:01+00:00,{'Units': 1},"
resolve https://github.com/wesnoth/wesnoth/issues/10153 issue"
2484931726,help: separate unit help page id generation logic,babaissarkar,2025-04-28 07:01:13+00:00,2025-04-28 15:18:28+00:00,"{'Editor': 1, 'Units': 1, 'Help': 1}","Follow-up to https://github.com/wesnoth/wesnoth/commit/53b08325e7729397859b476dcd8c306aa514cb27 and https://github.com/wesnoth/wesnoth/commit/81a7ba55dfb0771e1e03110eb69c040849ef7de5, separates out the help topic id generation logic from `help::show_unit_description()` so it can also be used in `reports.cpp`.
Also includes some cleanup and collapses one-use small methods"
2483472121,Don't keep a static light adjust list,Vultraz,2025-04-26 18:42:12+00:00,2025-04-26 21:59:53+00:00,{},"This was an attempt at an optimization in line with the image vector class member, but it wasn't backed up by profiling. Better to optimize later if it's found to be needed."
2483415227,help: correct inline image size for scaling > 1,babaissarkar,2025-04-26 17:12:45+00:00,2025-04-27 14:18:40+00:00,"{'UI': 1, 'Help': 1}","Without this, the inline images in help browser appear unscaled for pixel scale > 1. (smaller images with respect to text)

Tested with virtual scaling 2x. (My monitor is low res)"
2483379241,Restore old formatting for log timestamps,Vultraz,2025-04-26 16:23:19+00:00,2025-04-27 14:17:54+00:00,{},"Apparently, using `%Y-%m-%d %H:%M:%S` (the default of `format_local_timestamp` broke some external scripts. This does not re-add the trailing space which used to be part of the formatter (see 79120f1e313), since it's now appended separately."
2482873371,Improve light_adjust range hash,Vultraz,2025-04-26 05:13:20+00:00,2025-05-02 07:10:19+00:00,{'Engine': 1},"Given these values are 8 bit ints, there's no way they will ever come close to filling up size_t (unsigned long long). Also adjusted the has function to avoid duplicate hashes if two colors have the same value."
2481217762,scons: remove option to use c++20 on 1.18 branch,sevu,2025-04-25 10:21:48+00:00,2025-05-06 15:09:34+00:00,"{'Building': 1, 'SCons': 1}","Only 1.19 has all the required changes for c++20, #10146

Options are cached, removing the option makes sure that it is not accidentally enabled after switching from the master branch.
"
2477399682,Consolidate WML value escape functionality,soliton-,2025-04-23 21:45:53+00:00,2025-04-27 19:31:19+00:00,"{'MP': 1, 'Add-ons': 1}",
2476960518,simplify the reset affect adjacent() code since we don't care about directions here.,newfrenchy83,2025-04-23 17:48:03+00:00,2025-04-23 20:15:01+00:00,{'Units': 1},This should make @Pentarctagon  and @soliton- agree since here the verification that u_ is different from unit_itor is necessary here since u_ is one of the units reviewed without question.
2474889138,Clang build fix backport,Pentarctagon,2025-04-23 02:26:24+00:00,2025-05-06 16:16:18+00:00,{'Building': 1},
2473614351,fix direction reversal for adjacent attribute in [affect_adjacent],newfrenchy83,2025-04-22 13:19:02+00:00,2025-04-23 17:10:31+00:00,"{'Unit Tests': 1, 'Units': 1}","before tofix that, n was south and s was north"
2472376219,Reapply modification_queue commit,Vultraz,2025-04-22 02:26:09+00:00,2025-04-22 04:33:42+00:00,{},
2471808044,Allow direct loading of images and URIs to textures,Vultraz,2025-04-21 18:30:03+00:00,,"{'macOS': 1, 'Graphics': 1, 'Building': 1}","This delegates most of the internal logic to a static factory. The main benefit is this utilizes SDL_Image's direct-to-texture methods rather than running everything through the surface pipeline.

I'm still tweaking the implementation here, so feedback appreciated, especially on the use of boost::filesystem::path."
2471353561,add a tag [affect_distant] to abilities(without gameboard optimization),newfrenchy83,2025-04-21 14:18:14+00:00,2025-05-23 14:51:13+00:00,"{'Unit Tests': 1, 'Units': 1, 'Lua API': 1, 'Schema': 1, 'Campaign DiD': 1}","
like [affect_adjacent] this tag affects other units than the owner of the ability but this time, it concerns units located in a radius defined in the tag.

I had already tried to make one a few years ago but the code was too heavy and I had given up.

it is version without optimization posted here for compare duration of wml_validation"
2470433470,Network: Correct curl protocol configuration (resolves #10139),Wedge009,2025-04-21 03:40:53+00:00,2025-04-21 11:59:33+00:00,"{'Backport': 1, 'Network': 1}",Needs to be back-ported to 1.18 as well.
2470027033,label inline link mechanism code simplification,babaissarkar,2025-04-20 11:59:40+00:00,2025-04-22 02:28:02+00:00,{'UI': 1},"Also fixes non-left aligned inline links having wrong link click bounds. (resolves #8915)

Note: I came upon the solution accidentally while doing some cleanup. Fix is:
https://github.com/wesnoth/wesnoth/blob/4976f0a3f8cb6d5d10f608fbcb220fa36cabffce/src/gui/widgets/styled_widget.cpp#L560-L567"
2468428904,TDG: a few tweaks,Dalas121,2025-04-18 14:41:30+00:00,2025-04-18 22:20:57+00:00,{'Campaign TDG': 1},"A few minor TDG tweaks:
- Spells: clarified ""Counterspell"" description
- S05: the allied AIs now attack at Dawn instead of Second Watch
- S08: changed Trappers' dialogue to be less overtly hostile
- S14: the final boss now heals less on lower difficulties

@Wedge009, you've reviewed the dialogue for TDG before. Do you think the new S08 Trappers' dialogue is an improvement? I've based that change off [this forum thread](https://forums.wesnoth.org/viewtopic.php?t=57997&start=75), where two different people felt that the current dialogue isn't appropriate.




"
2462591655,Help: convert to new markup,Vultraz,2025-04-16 06:15:36+00:00,2025-04-17 17:38:50+00:00,"{'Editor': 1, 'Help': 1}","Covers `<img>`, `<ref>`, `<bold>`, `<italic>`, and `<header>`."
2460022884,Improve Stymphalian Unit Description,Gothyoba,2025-04-15 08:50:09+00:00,2025-04-24 14:05:12+00:00,"{'Units': 1, 'Campaign WoF': 1}","I made this description months ago but forgot to make a PR.

@Dalas121 I’m guessing you have to review this?"
2456628208,show max_attacks/attack usage in Help and Units dialog,babaissarkar,2025-04-14 05:22:25+00:00,2025-04-15 16:21:10+00:00,"{'UI': 1, 'Help': 1}","Resolves #10108.

Unit List (should be similar in Recall)
![Screenshot from 2025-04-14 10-48-19](https://github.com/user-attachments/assets/8c02b6e6-2523-461e-a8f3-122feb6f8c9c)

Unit Create Dialog (should be same in recruit)
![Screenshot from 2025-04-14 10-46-54](https://github.com/user-attachments/assets/93d2cedc-3800-4797-9633-00bb47fd08e3)

Help page for Unit Type (cannot show remaining attack because it's the Unit Type's help, and not the Unit's)
![Screenshot from 2025-04-14 09-42-47](https://github.com/user-attachments/assets/9057edb8-8bfb-45e5-bb5f-1aec992424ac)
"
2456423016,Use a proper struct for lightmap adjustments,Vultraz,2025-04-14 02:04:12+00:00,2025-04-14 15:16:03+00:00,{},"Resolves #10101. I'm not entirely sure about the approach I've taken here, so any thoughts are welcome."
2456324620,Don't skip fully transparent pixels when recoloring surfaces,Vultraz,2025-04-13 23:58:22+00:00,2025-04-14 15:15:28+00:00,{},"Resolves #8785. Diff best viewed with whitespace changes hidden. Functions affected:
- `adjust_surface_color`
- `greyscale_image`
- `monochrome_image`
- `sepia_image`
- `negative_image`
- `shadow_image`
- `swap_channels_image`
- `recolor_image`
- `brighten_image`
- `adjust_surface_alpha_add`
- `light_surface`"
2456026911,Color Refactor,babaissarkar,2025-04-13 10:56:23+00:00,2025-04-15 16:46:48+00:00,"{'UI': 1, 'Units': 1, 'Lua API': 1}","* Removes unused color constants.
* Changes `font::string_to_color` to use [pango_color_parse](https://docs.gtk.org/Pango/method.Color.parse.html). This allows us to use standard CSS color names in various places."
2455888687,Editor: Remove old ToD schedule before saving new one,Wedge009,2025-04-13 05:39:47+00:00,2025-04-13 13:00:46+00:00,"{'Backport': 1, 'Editor': 1}",Resolves #10115
2454710719,SotBE S15: add AI support code,knyghtmare,2025-04-11 20:20:14+00:00,2025-05-06 17:18:14+00:00,"{'Enhancement': 1, 'Campaign SotBE': 1}","- essentially units will prefer sticking to enemy leader if player units are nearby
- this makes the scenario less boring in the end when you just to kill a leader on a keep"
2452478578,Allow [modify_unit_type] to affect movetype entries,MrTitainin,2025-04-10 23:13:03+00:00,,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1, 'Squash': 1}","Add support for [movement_costs], [resistance], [defense], [vision_costs], [jamming_costs] in [modify_unit_type]"
2451965124,EI: some assorted fixes and tweaks,Dalas121,2025-04-10 18:45:34+00:00,2025-04-11 13:42:06+00:00,"{'Achievements': 1, 'Campaign EI': 1}","Things that've been on my list for a while, to do before 1.20:
- S01: initial objective text now includes the 10,15 trapdoor
- S05: added objective note explaining how to check for bandits
- S05: fix Gweddry or Owaec not getting XP if they personally kill the final enemy leader
- S09: cold damage now starts lower, but grows faster
- S09: drakes no longer avoid the objective area after the guarding icemonax are cleared
- S10: replaced wild Wyvern with a more climate-appropriate Yeti
- S15: Gweddry and co. now enter Weldyn through a tunnel, instead of effortlessly penetrating the undead siege
- achievements: use white teamcolor instead of magenta for S10's achievement"
2451724858,Add pango 1.50 to Steam package,babaissarkar,2025-04-10 16:51:53+00:00,2025-04-11 05:36:34+00:00,{'Packaging': 1},"Packages pango 1.50 with the Steam package, to avoid the issue mentioned in [#10088](https://github.com/wesnoth/wesnoth/pull/10088#issuecomment-2785195574)."
2451249834,"Revert ""Always default to NO_LAYER for the overlay""",newfrenchy83,2025-04-10 13:50:30+00:00,2025-04-17 18:37:09+00:00,{'Terrain': 1},"This reverts commit b4b278c5f72928bebac8d9129607ed5ebd27b7aa.

Fix https://github.com/wesnoth/wesnoth/issues/10117 issue"
2449647354,Remove bogus layer attribute in [variant],soliton-,2025-04-09 21:49:35+00:00,2025-04-17 14:12:26+00:00,"{'Schema': 1, 'Terrain': 1}",
2448952716,Make liminal bonus implementable in resource campaings,newfrenchy83,2025-04-09 15:37:30+00:00,2025-04-10 14:17:47+00:00,{'Schema': 1},Before that 'liminal_bonus' must be defined in each scenario when it want define a value diffrent to default
2447092357,Allow the tournament DB query to define the complete text,soliton-,2025-04-08 22:56:20+00:00,2025-04-17 16:29:44+00:00,"{'MP': 1, 'Add-ons': 1}",
2445182007,SDL: surface-related cleanups,Vultraz,2025-04-08 08:07:29+00:00,2025-04-08 16:52:20+00:00,"{'UI': 1, 'Lua API': 1}","- Use a mutable span for iterating over surface pixels (convers simple cases for now)
- Use the appropriate SDL_PixelFormatEnum directly rather than getting the value from a dummy surface. Likewise, simplified the is-neutral check by checking the format type (this wasn't available in SDL 1.2 when the check was originally written)
- Remove is_neutral and make_neutral as class members. All surfaces are already converted to the neutral format internally, so we don't need these as part of the public API. Likewise, removed the only remaining external use of make_neutral in the cursor code.
- Move most function implementations out of the header and cleaned up implementation helpers. These didn't need to be class members and just made the code harder to read.
- Simplify ctor/assignment ops and disallow self copy assignment
- Cleaned up unnecessary includes in the header. surface.hpp was pulling in the whole SDL.h header, the removal of which necessitated adding SDL includes to several other places. Just goes to show how much it was indirectly touching..."
2443982970,Remove old gamemap header parsing,Vultraz,2025-04-07 18:01:56+00:00,2025-04-10 11:31:54+00:00,{'Engine': 1},We haven't used maps with headers in years.
2442137807,WFL: add byte_index function,Vultraz,2025-04-07 03:41:02+00:00,2025-04-07 17:19:52+00:00,{'WFL': 1},"According to [the docs](https://wiki.wesnoth.org/Wesnoth_formula_language#substring), the optional size arguments are supposed to be the number of characters to take, relative to `offset`. ~Small fix to handle multi-byte characters. Confirmed while testing a fix for #9917.~

EDIT: After discussion on discord, I decided to add a `byte_index` function instead that takes a character index and a string. It seems better to opt into multibyte handling, especially since the logic for indices is very annoying complicated..."
2441265517,canvas [attribute]: use character indices,babaissarkar,2025-04-05 17:30:39+00:00,2025-04-07 06:09:08+00:00,{'UI': 1},"Resolves #10105

Uses character indices instead of byte indices in `[attribute]`."
2435621784,remove stuff specifically for 800xN resolutions,Pentarctagon,2025-04-03 01:45:09+00:00,2025-04-03 21:53:45+00:00,{'UI': 1},since that's not supported anymore
2434891041,"floor [gold]amount=, closes #9518",ProditorMagnus,2025-04-02 17:59:57+00:00,2025-04-03 00:56:21+00:00,{'Lua API': 1},
2433689742,Deployed std::span via compat wrapper,Vultraz,2025-04-02 09:38:58+00:00,2025-04-04 14:44:31+00:00,"{'UI': 1, 'Building': 1, 'SCons': 1, 'CMake': 1}","Boosts the boost requirements to 1.78 so we can use boost::span as a fallback when targeting C++17 (currently the default).

Covers existing conditional uses of std::span as well as utils::byte_string_view (here renamed to byte_view). This use of std::string_view is not standard-compliant, causes build issues, and should properly be a span anyway.

Resolves #10101, resolves #9546."
2432462786,Add server-side queues,Pentarctagon,2025-04-01 19:41:52+00:00,2025-05-08 17:00:24+00:00,"{'MP': 1, 'UI': 1, 'Schema': 1}","---

Very WIP, still needs cleanup, testing, and error handling for various possibilities."
2428200314,Move the toplevel read/write functions into their own namespace,Vultraz,2025-03-31 07:03:43+00:00,2025-04-02 08:48:19+00:00,"{'AI': 1, 'MP': 1, 'UI': 1, 'Editor': 1, 'Lua API': 1, 'Add-ons': 1, 'Achievements': 1}","- Parser functions now reside in the `io` namespace. It would probably be better to do something like `config::from_stream`, but I might do that separately.
- All `read` functions now return configs instead of taking an input parameter, since the functions would clobber existing data anyway. The dedicated overloads were removed.
- Simplified the way these functions are used, especially now that they return values."
2427806718,"Necromancer: emphasize plague, reduce durability",Dalas121,2025-03-31 00:14:20+00:00,2025-04-18 01:38:36+00:00,{'Units': 1},"The 1.18 Necromancer is in an odd spot. His/her damage is very similar to the Lich, but inferior to both the Enchantress and Arch Mage (and MoL, if we factor in Illuminates). But unlike every other mage, the Necromancer boasts a whopping 76 hp and 10% impact resistance.

These stats (more hp than a Royal Guard!?) point the Necromancer towards a front-line tank/shock trooper role. I get that this is reasonable for balance - undead don't have good impact-resistant tanks - but I also feel that using Necromancers as meatshields runs contrary to the unit fantasy.

This PR lowers the Necro's durability closer to that of the other mages, while instead emphasizing his/her thematic plague ability:
- hitpoints 76 -> 62, impact resist 10% -> 0%
- plague staff (melee impact) 6-3 -> 8-3
- chill wave (ranged cold) 19-2 -> 20-2
- shadow wave (ranged arcane) 16-2 -> 12-2, add ""plague"" weapon special

(unit cost and exact stats may need adjustment)"
2427518014,Update AI macros to account for midnight & midday,knyghtmare,2025-03-30 11:51:06+00:00,2025-04-03 00:59:05+00:00,{'AI': 1},Midnight and Midday were added later than the macro itself so this was not updated.
2427209886,GUI2: hotkey registration and related callback cleanup,Vultraz,2025-03-29 19:24:17+00:00,2025-03-29 20:49:18+00:00,"{'UI': 1, 'Achievements': 1}","- Restore the is-handled callback return value (functionally reverts 8bf95ce69a9bd59d98d14653cc727368d23f75c0)
- Take hotkey callbacks by rvalue reference
- Avoid registering achievement hotkey twice
- Clean up excessive callback wrappers in the lobby and main menu
- Properly define the display function for the test and achievement dialogs"
2427034203,Add New 6p Map - Double Siege,Hejnewar,2025-03-29 16:53:27+00:00,2025-07-19 18:07:27+00:00,{'MP': 1},"Add New 6p Map - Double Siege

Tested - As much as you can find 5 other people willing to play 3v3. 
Fun - Yes. 
Fast - Faster than usual (or at least more is happening). 
Different - Yes. 
Balanced - No idea. (But it is fun and mirrored.)
Looks - Good enough.

Needs better team names and description. 

Teams 1-4-5 & 2-3-6

![Map-Screenshot_025](https://github.com/user-attachments/assets/998d6d01-7747-4f4d-b118-a7c605c39d3e)
"
2426799164,rich label: Use Pango Shape attributes to handle inline images,babaissarkar,2025-03-29 08:42:21+00:00,2025-04-12 02:42:42+00:00,"{'MP': 1, 'UI': 1, 'Editor': 1, 'Units': 1, 'Building': 1, 'Help': 1, 'SCons': 1, 'CMake': 1, 'Schema': 1}","This simplifies quite a bit of manual inline image processing in RL, as much of it is done by Pango.

**TODO**
- [x] Fix any new broken help pages
- [x] Excessive space when newline is followed by inline image (worked around by always appending a zero width space (U+200B) in front of the image, no clue what's affecting pango's text size calculation)
- [x] Implement `<clear/>`. This moves the text following a floating image below it, instead of the text wrapping beside the image.
- [x] `<br/>` has been deleted. It's usecase is dealt with by a normal linebreak, and it was buggy.
- [x] Default table alignment values: `valign=center` and `halign=left`, since that was the most widely used case.
- [x] Package Pango 1.50 with Steam package (#10119)
"
2426773595,mouse back/forward button handling,babaissarkar,2025-03-29 07:30:33+00:00,2025-06-06 16:10:02+00:00,"{'UI': 1, 'Help': 1, 'Input': 1}","Resolves #10085.

* Backend support for mouse forward/back button in the context of GUI2
* Forward/back button history navigation in Help Browser
* Forward/back button story navigation in story screen."
2425327341,add a tag [affect_distant] to abilities(ver 4),newfrenchy83,2025-03-28 13:31:57+00:00,2025-04-03 21:45:28+00:00,"{'Unit Tests': 1, 'Units': 1, 'Lua API': 1, 'Schema': 1, 'Campaign DiD': 1}","
like [affect_adjacent] this tag affects other units than the owner of the ability but this time, it concerns units located in a radius defined in the tag or all units on the map.

I had already tried to make one a few years ago but the code was too heavy and I had given up."
2422283437,Units: Roc XP to 150,knyghtmare,2025-03-27 12:13:02+00:00,2025-03-27 16:20:28+00:00,{'Units': 1},"max AMLA XP for a level 3 Unit

Closes #10080 "
2422226603,SotBE-S14: refine map,knyghtmare,2025-03-27 11:57:33+00:00,2025-03-27 14:10:26+00:00,"{'Enhancement': 1, 'Campaign SotBE': 1}",Refined map.
2422097982,SotBE-S17: add message to event,knyghtmare,2025-03-27 11:15:20+00:00,2025-03-27 14:12:04+00:00,"{'Enhancement': 1, 'Prose': 1, 'Campaign SotBE': 1}",Players have complained why the NA was so unaware of such a brutal war erupting in the Far North. Provided a possible reason in one message. This is a better alternative than scripting 1-2 cutscenes in between scenarios.
2420586186,Always default to NO_LAYER for the overlay,soliton-,2025-03-26 22:20:05+00:00,2025-04-09 22:02:20+00:00,{'Terrain': 1},The only place WILDCARD was the default was [terrain_graphics][tile]type= and this had still exceptions for * and !. Should be simpler to have this work constistently in every context.
2420326527,fix boost_charconv linkage,jopadan,2025-03-26 19:27:17+00:00,2025-03-26 19:59:00+00:00,"{'Building': 1, 'CMake': 1}","- #10062
Oops obviously not working for ubuntu so I close it"
2419863584,add a tag [affect_distant] to abilities(version 3),newfrenchy83,2025-03-26 15:50:37+00:00,2025-03-27 17:36:50+00:00,"{'Unit Tests': 1, 'Units': 1, 'Lua API': 1, 'Schema': 1, 'Campaign DiD': 1}","
like [affect_adjacent] this tag affects other units than the owner of the ability but this time, i added variables for checking done only if unit with abilit[affect_distant] are on the map

I had already tried to make one a few years ago but the code was too heavy and I had given up."
2418880737,"Consistently update display when a unit changes (move, die, recruit) that affects the appearance of adjacent units through an ability",newfrenchy83,2025-03-26 09:58:06+00:00,2025-04-23 16:11:23+00:00,"{'Units': 1, 'Lua API': 1}",
2418302651,Great Mage: use Asmodeus's fireball animation,Dalas121,2025-03-26 04:25:52+00:00,2025-06-29 22:51:17+00:00,{'Units': 1},"![meteors](https://github.com/user-attachments/assets/6ff865b0-3503-4de9-a0bf-474ca9f940dc)

Fancy animation, differentiating the Great Mage a little more from his predecessors. He deals over twice the damage of the Red Mage - surely his attack animation should look more powerful?

I'm sure there's a more elegant way to implement this animation than adding an extra 500 lines of WML, but I wasn't able to figure out anything that looked clean.

Credit goes to Asmodeus. I shrank the size of the fireballs and explosions a little compared to your Endsinger harpy, but everything else should be identical.

@doofus-01, what do you think?"
2417994934,"Remove ""among"" parameter remains after fbe2166",soliton-,2025-03-25 23:55:08+00:00,2025-04-09 19:19:33+00:00,{'Campaign WC': 1},
2417351773,add a tag [affect_distant] to abilities(second experimental version),newfrenchy83,2025-03-25 17:40:44+00:00,2025-03-25 21:51:29+00:00,"{'Unit Tests': 1, 'Editor': 1, 'Units': 1, 'Lua API': 1, 'Schema': 1, 'Campaign DiD': 1}","
like [affect_adjacent] this tag affects other units than the owner of the ability but this time, it concerns units in a units_distant map for don't lower performances

I had already tried to make one a few years ago but the code was too heavy and I had given up."
2414954447,Continue work on chrono cleanup,Vultraz,2025-03-24 22:23:10+00:00,2025-03-27 23:07:37+00:00,"{'MP': 1, 'UI': 1, 'Units': 1, 'Add-ons': 1, 'WFL': 1}","- Remove config_attribute_value::to_time_t (finally!)
- Add C++20 codepath for format_time_summary
- Deploy chrono::format_local_timestamp more widely, including replacing uses of translation::strftime (need to confirm this still plays nicely with translations - don't want #1709 to crop back up...)
- Clean up unnecessary includes
- Clean up uses of time_t in filesystem and save_index
- Clean up last use of ctime
- Simplify wesnothd ban duration calculations"
2414353660,Fix quick trait for 4mp leaders,sevu,2025-03-24 17:15:19+00:00,,{'MP': 1},"Added a check for the side variable too, maybe I should even check only the side variable."
2412268295,Move the Orcish Shamans to core as a new unit line (2),Dalas121,2025-03-23 22:16:28+00:00,,"{'Graphics': 1, 'Units': 1, 'Campaign SotA': 1, 'Campaign SotBE': 1, 'Campaign TDG': 1, 'Squash': 1}","Following up on #7327.

This PR moves the orcish shaman units out of SotBE and TDG and into core, as a new unit line.

As discussed in #7327, the line is female-only by default, but still includes a male variation so the old sprites/portraits don't go to waste. I'd like to remove the male variation from the help menu, but don't know how - `hide_help=yes` doesn't work.

The orcish shaman is a common UMC unit. By adding the shaman to core, we'll cause issues for any UMC who use it. I don't have a good solution to this - if we were to avoid mainlining because of UMC, that would mean we'd never be able to mainline a popular unit ever. Ideally units defined in addons/campaigns could overwrite units defined in core, but that sounds like a big can of worms to open.

I know @knyghtmare has been working on SotBE recently; I'd appreciate his thoughts on how to balance the campaign with these much more powerful mainline shamans, particularly as they can now all advance to level 2/3. Right now I haven't changed anything from #7327.

Once SotBE is sound and we're happy with the overall direction and unit design, I'll ask the balance team to examine the precise damage / hp / cost / etc."
2410947571,Restore Windows CI job,Vultraz,2025-03-22 03:43:33+00:00,2025-03-22 05:27:30+00:00,{'CI': 1},"Closes #10044. This reverts the following commits: d3a8b882a75e155f32804205898f6d12008c0edc
6415bb8adc89b6b8d76735163e01ebb8a0cfe2e5"
2410323586,Add gold_cost for TDG's Magic System,mavpii,2025-03-21 19:15:14+00:00,2025-03-25 21:03:12+00:00,{'Campaign TDG': 1},"Just a small PR that allows developers to put a price on spells not only in experience but also in gold. 
This new feature doesn't affect TDG in any way and isn't used by it"
2408407305,HttT S19c: clearer objective,OrekOrek,2025-03-21 02:48:36+00:00,2025-07-07 21:56:21+00:00,{'Campaign HttT': 1},"The initial objective says ""Make it to the end of the river,"" and because gohere.png image is placed at (55,3), it's natural to assume that it is the place to go to. However, any hex within (53-55,1-5) meets the objective. Although meeting the initial objective doesn't end the scenario and only changes it to ""Move Konrad to the cave,"" visual markers should match the actual objective. Therefore, the hex to meet the initial objective is limited to (55,3)."
2407761530,Make the --data-dir explanation clearer,vgaming,2025-03-20 18:50:10+00:00,2025-03-23 08:37:36+00:00,{'Docs': 1},"Previously, one might naively assume that the data dir is the directory that's literally named ""data"".

In reality, the data dir should have subdirectories:
data/
fonts/
audio/
etc."
2407394305,Generalise log domain matching rules,vgaming,2025-03-20 15:56:23+00:00,2025-03-20 21:59:11+00:00,"{'Docs': 1, 'Command Line': 1}","Previously, `--log-debug='*'` would not match all domains. Similarly, `conf*` would not be a correct pattern, etc.

With this change, special handling of top-level domains is removed. For example, the `config` domain will be matched by `conf*`.

All domains can be matched by the magic string `all` as before, or by using `*`.

Basic manual testing was performed for this PR:

* broken domain patterns that do not match anything result in an error, as expected.

* patterns `all` and `*` were tested.

* specifying `conf*` correctly enables the config domain.

* specifying `gui/*` does not enable the config domain.

* patterns containing a comma (delimiter) are handled ""correctly"", that is, individual components are understood and processed separately. For example, `--log-debug='gui/*,conf*'` would enable debug logging for everything in the `gui` domain and `config` (as it's the only domain that matches `conf*`).

Fixes https://github.com/wesnoth/wesnoth/issues/10052"
2406919530,show plague type in UI,babaissarkar,2025-03-20 13:05:49+00:00,2025-03-25 13:09:50+00:00,"{'UI': 1, 'Units': 1}","Resolves #10047.

![Screenshot from 2025-03-20 18-31-10](https://github.com/user-attachments/assets/3c649ce1-6fda-41ec-9459-6d0a27ce1e5f)

(Partially translated strings because these new translatable strings will require translation before they show up properly.)"
2405442808,HttT S5a: clearer objective,OrekOrek,2025-03-20 01:26:50+00:00,2025-03-23 03:17:12+00:00,{'Campaign HttT': 1},"The main objective says ""Escape down the road to Elensefar"". It actually means that the scenario ends when Konrad moves to (5,1), but the signpost that says ""To Elensefar"" is at (8,2). In S1, the signpost was the place that Konrad was supposed to go to, so it’s natural for new players to assume the same for S5a (relevant feedback posts: [2019](https://forums.wesnoth.org/viewtopic.php?p=638143#p638143), [2024](https://forums.wesnoth.org/viewtopic.php?p=689695#p689695)).

Therefore, the signpost is moved to (5,1), and it is highlighted at the start of the scenario just like S1. Also, some minor terrain changes are made so that (5,1) is the only road-like terrain at the edge of the map at y=1.
![HttT-5a-all](https://github.com/user-attachments/assets/e81ff226-9149-48b4-910c-73fc78ab657e)

"
2404544116,Add Blue Flowers Variant,Hejnewar,2025-03-19 17:36:14+00:00,,"{'Graphics': 1, 'Terrain': 1}","Finally slowly getting to #8151. Hopefully looks good enough. Main reason for this is to add more diversity but they do work well in all grass types and beach sand. This is in most part a recolor but not entierly as there are some small changes and additions. 

![Zrzut ekranu 2025-03-19 181141](https://github.com/user-attachments/assets/3ce1682d-39c8-451c-a400-c2b769bf5e3a)
![Zrzut ekranu 2025-03-19 181202](https://github.com/user-attachments/assets/a9d14b8e-a4ec-4ccd-b4f9-89db779dc606)
"
2402205684,"NR S2, 3, 6, 8: fix carryover gold %",OrekOrek,2025-03-18 22:02:47+00:00,2025-03-21 21:48:59+00:00,{'Campaign NR': 1},"Currently, carryover gold % for meeting the main objective and the alternative objective are respectively;
S2: 40%, 80%
S3: 80%, 40%
S8: 40%, 80%
because `{NEW_GOLD_CARRYOVER 40}` was added only once per scenario by b0a302b. Also, S6 lacks `[endlevel]` for meeting the alternative objective and the scenario doesn't end (although it is probably impossible anyway), but the scenario automatically ends with 80% carryover gold when all enemy leaders are killed. For the record, S10 has multiple objectives as well, but they are all 40%, so no fix seems necessary.

This PR turns all 80% into 40% and adds `[endlevel]` with 100% for the alternative objective in S6."
2399445516,Port FPS viewer to GUI2,Vultraz,2025-03-18 01:35:45+00:00,2025-03-22 02:51:28+00:00,"{'macOS': 1, 'UI': 1, 'Building': 1}","Splits the FPS viewer out of the display class and into its own modeless dialog. This serves as a proof-of-concept for further modeless GUI in-game dialogs. Admittedly, it only works because I explicitly disconnect it from the UI event context, since it doesn't need to receive events.

This also introduces a new `tracked_drawable` interface that encapsulates the fps logic. This serves as a simple middleware for any `top_level_drawable`, and any class that inherits from it can have its render stats displayed using the new `fps_report` dialog."
2398924511,"TSG help.cfg: improve translatability of ""ranged attack"" help message",Dalas121,2025-03-17 20:01:44+00:00,2025-03-20 00:37:03+00:00,{'Campaign TSG': 1},"As pointed out by @Wedge009 / @stevecotton in #9682, this string may need to be translated differently depending on the type of unit being attacked.

Also removes the message when attacking a Thief - Rogues (which IIRC are the only thief-line unit you fight in this campaign) have a ranged attack."
2398605258,WFL/Formula: use a unique_ptr for the managed instance,Vultraz,2025-03-17 17:19:42+00:00,2025-03-17 17:51:22+00:00,{'WFL': 1},"Turns out we can use a unique_ptr after all, we just need to define the dtor out-of-line once function_symbol_table is a complete type.

Also adds a move ctor and assignment operator. This is necessary since the unique_ptr makes the class non-copyable, and also fixes a case in unit_filter_attribute_literal where a move was attempted but no move ctor provided."
2398487652,rich label: support setting table bgcolors from definition,babaissarkar,2025-03-17 16:37:35+00:00,2025-03-19 11:30:37+00:00,"{'UI': 1, 'Help': 1, 'Schema': 1}","Adds a `[colors]` tag under `[rich_label_definition]`. This allows associating color values with names which can later be accessed from Help Markup (for now just from `<table><row bgcolor=...>`).
Uses this functionality to improve Help Browser table's  appearance.
![Screenshot from 2025-03-17 17-29-01](https://github.com/user-attachments/assets/f208c46e-dddf-4d6b-b32f-768bcef342a9)
![Screenshot from 2025-03-17 17-29-08](https://github.com/user-attachments/assets/07b3a11f-7f88-4661-be3e-94968ac9f4ee)
"
2397780092,TDG: Correct Orcish Sorceress description,Wedge009,2025-03-17 12:42:27+00:00,2025-03-21 05:10:27+00:00,"{'Units': 1, 'Prose': 1, 'Campaign TDG': 1}",
2396283804,Make sure formula symbol tables get deleted properly,soliton-,2025-03-16 19:19:04+00:00,2025-03-17 04:14:04+00:00,"{'Units': 1, 'Lua API': 1, 'WFL': 1}",
2396257131,Leave chat open on failed command execution,soliton-,2025-03-16 18:13:33+00:00,2025-03-21 08:45:24+00:00,{'UI': 1},"Also save chat messages or commands in history. Previously this was not done in #5538 because ""Chat messages are not stored like this to avoid spam."" but the server rejects messages if they are sent too fast anyway. So that is not a good reason IMO."
2396118258,Move TDG's spells to a separate file + bug fix,mavpii,2025-03-16 13:13:59+00:00,2025-03-17 19:40:43+00:00,{'Campaign TDG': 1},"This pull request separates TDG's magic system and its spells, making it easier to create your own sets. I also fixed a bug with spell unlocking that I reported to @Dalas121 last year.

Now I create small PRs that don't change anything globally, but are the basis for future improvements. Unfortunately, I don't have enough free time to update everything at once."
2395773454,Delete spacer in TDG's spellcasting dialog,mavpii,2025-03-15 22:50:14+00:00,2025-03-16 02:44:04+00:00,{'Campaign TDG': 1},"This is my first in a series of PRs that will gradually replace the current TDG's magic system with a better and more developer-friendly version, which is currently used in CtL, as it was agreed with @Dalas121 

This PR removes a spacer that was significantly increasing the width of the spellcasting dialog in the new interface 1.19 due to the increased font size of title_text

**Before**
![1285](https://github.com/user-attachments/assets/b74985f8-46d0-400b-b765-30b97125eaa8)


**After**
![image4445465342](https://github.com/user-attachments/assets/afd21cab-fd79-4406-8f27-c8d2acc6d95a)
"
2395452595,PUA: Access only the right unit type ID attribute,soliton-,2025-03-15 16:04:32+00:00,2025-03-20 22:42:00+00:00,{'Lua API': 1},Fixes #10032.
2393591995,"Revert ""Use the alternative Troll Hero profile as a profile for the Great Troll""",Dalas121,2025-03-14 12:51:31+00:00,2025-03-14 12:52:01+00:00,{'Units': 1},Reverts wesnoth/wesnoth#10025
2390706473,EI S14: undefine GOLD_PICKUP macro,Dalas121,2025-03-13 11:44:02+00:00,2025-03-13 14:19:25+00:00,{'Campaign EI': 1},Closes #10024
2390586209,Use the alternative Troll Hero profile as a profile for the Great Troll,GreenScarab,2025-03-13 10:58:10+00:00,2025-03-13 14:18:54+00:00,"{'Graphics': 1, 'Units': 1}",I think it is a waste not to use a unique portrait for Great Troll when there is a possibility.
2386600149,Fix prefs call in backport,Vultraz,2025-03-12 00:18:49+00:00,2025-03-12 01:46:44+00:00,{},
2386586482,[1.18] Fix failure to build on current versions of MSVC,irydacea,2025-03-12 00:07:04+00:00,2025-03-12 03:40:04+00:00,"{'Windows': 1, 'Building': 1}","A recent change in an upstream library must've resulted in an indirect inclusion of `<chrono>` disappearing:

```
D:\wesnoth-1.18\src\log.cpp(429): error C2039: 'high_resolution_clock': is not a member of 'std::chrono'
```

Whatever the case may be, adding one of our own fixes this and poses no issue on other platforms.

(Not needed in the dev branch since the same include was already added by commit 2d765118ed48a976b102c5b296a8062d0846922a.)"
2382569829,TDG S06: clarify scenario objectives,Dalas121,2025-03-10 15:09:54+00:00,2025-03-10 16:36:43+00:00,{'Campaign TDG': 1},"TDG S06 requires the player to both rescue Asheviere and also survive until turns run out.

With this commit, re-show objectives after rescuing Asheviere, and strikethrough the completed ones."
2380357177,Improve scons/ python files code style standards,vibrahim09,2025-03-08 20:38:57+00:00,2025-03-17 14:36:19+00:00,"{'Building': 1, 'SCons': 1}","Addresses files in #9988 

Can keep PR open till all files have been addressed."
2380332274,HttT S19c: Fix and improve drake spawn algorithm,OrekOrek,2025-03-08 19:17:19+00:00,2025-03-13 14:16:59+00:00,{'Campaign HttT': 1},"The current version has been bugged since 701a52d in 2010. The intention of the change back then was to make level X drakes always spawn in X turns. However, whenever level 3 is randomly rolled on turn n, instead of spawning the unit on turn n+2 as intended, another random roll starts on turn n+1 to reset the previous roll. This results in much fewer level 3 drake spawns (intended=25%, actual=8%) and empty drake nests for too long (in theory, a nest can be empty forever if 3 gets rolled again and again).

Also, in the current version, only 3 Drake Clasher line drakes (lvl 1 Drake Clasher, lvl 2 Drake Thrasher, lvl 2 Drake Arbiter) don’t appear in this scenario out of all 17 drakes in the game, but there is no reason to exclude them. Now that a drake campaign, Winds of Fate, is added to the mainline, having a chance to introduce all drake units in HttT probably makes sense, too.

To fix the spawning rate and to introduce all drake units, the following changes are made:

1. The current version has 9 drake nests of the same nature. The fixed version has 2 different types of drake nests: melee drake nests (`name=drake_bases_melee`) and ranged drake nests (`name=drake_bases`). In 2 melee drake nests, only lvl 1 ~ 3 Drake Clasher line drakes spawn because they are the only drakes that don’t have ranged attacks. In 8 ranged drake nests, all the other lvl 1 ~ 3 drakes spawn. The decision to separate the nests was made because a simpler solution of spawning all drakes from all nests had an issue during experiments; players can easily avoid nests whenever melee drakes spawn because these non-flying melee drakes are extremely slow and can’t move far. 

2. Related to the change above, some map terrains are changed. A water village is turned into a drake nest, so the total number of villages remains the same. By placing 2 melee drake nests near the cave with enough fords around, it is difficult for players to ignore them, especially when they are surrounded by mountains that merfolks can’t reach. Terrains outside the picture below are unchanged.

![HttT-19c-current-vs-fixed-50%](https://github.com/user-attachments/assets/cfc03c3f-d7b3-4d2f-8ae2-395cad96e0e2)

3. The current version seems to be lvl 1 : 2 : 3 = 31% : 62% : 8% in theory although the original intention is 25% : 50% : 25%. The fixed version is 40% : 40% : 20%. The chance of lvl 1 spawns is increased to mitigate the difficulty change due to having many more lvl 3 spawns. The same algorithm is used for both drake base types.

Replays are attached:
[Orek-v1180-19c-HttT-The Cliffs of Thoria replay.gz](https://github.com/user-attachments/files/19145140/Orek-v1180-19c-HttT-The.Cliffs.of.Thoria.replay.gz)
[Orek-v1182-19c-fixedversion-HttT-The Cliffs of Thoria replay.gz](https://github.com/user-attachments/files/19145139/Orek-v1182-19c-fixedversion-HttT-The.Cliffs.of.Thoria.replay.gz)

lvl 1: 2: 3 = 34% : 66% : 7% (current version, 1.18.0, close to theory)
lvl 1: 2: 3 = 38% : 34% : 28% (fixed version, 1.18.2, higher lvl 3 than theory)

I’m not a WML expert, so I appreciate it if someone could check the fixed code. I didn't find any errors in my test play in 1.18.2 above, but there may be some edge cases that I didn't notice. Also, I’m not trying to push my own agenda or anything, so any other fix ideas are very welcome."
2380282800,update codeblock projectfile,newfrenchy83,2025-03-08 16:57:25+00:00,2025-03-08 16:58:51+00:00,{'Building': 1},
2380246708,add 'priority_min' and 'priority_max' values to priority attribute for overwrite_specials,newfrenchy83,2025-03-08 15:24:39+00:00,2025-03-10 12:42:56+00:00,"{'Units': 1, 'Schema': 1}",priority_min=0 and priority_max=std::numeric_limits<double>::max()
2379915233,Styling changes for readability,WilliamsBradley32,2025-03-08 04:22:27+00:00,2025-03-15 20:30:58+00:00,{'Building': 1},All the changes should be strictly styling changes to be more like other python files that are found in the project.  I didn't adjust any lines based off of line length because of the note about no min line length from the coding style guide on the website. 
2379203550,#9540 simple sprite shadow fix,AlexanderLu98,2025-03-07 18:26:52+00:00,2025-03-12 18:49:21+00:00,"{'Graphics': 1, 'Units': 1}","First time contribution so please contact me if I do not follow standard procedure. Fixes #9540

Simple sprite fixes to non-consistent shadows for Horseman and Lancer. This may have been caused by using dark mode in editor as the shadows are indistinguishable. Switching to light mode reveals the inconsistencies and the appropriate changes have been made. I have also checked all Horseman and Lancer sprites and no further issues with shadow can be seen.
"
2378397836,canvas: draw circle using cairo,babaissarkar,2025-03-07 11:31:53+00:00,2025-03-10 20:04:49+00:00,"{'Graphics': 1, 'UI': 1}","The circle shape in canvas is now drawn antialiased using cairo.

![Screenshot from 2025-03-09 18-52-27](https://github.com/user-attachments/assets/d9319b72-15e1-43fb-9cb3-463f17ff9174)"
2377013137,TSG: sg_help.cfg: use correct variable call,knyghtmare,2025-03-06 18:55:58+00:00,2025-03-06 19:01:21+00:00,{'Campaign TSG': 1},closes #10003
2376695373,CI fix,babaissarkar,2025-03-06 16:06:56+00:00,2025-03-06 17:45:03+00:00,{'UI': 1},Attempt to fix Windows CI after https://github.com/wesnoth/wesnoth/commit/e1e7e2c0b9a4bfd63bca3dc8c6c4c292c5c860a7.
2376298799,EI: S1: fix a typo,knyghtmare,2025-03-06 13:13:28+00:00,2025-03-06 19:20:14+00:00,"{'Prose': 1, 'Campaign EI': 1}",closes #9997
2374664016,Fix some indentation and make CI abort if wmlindent errors,soliton-,2025-03-05 21:29:20+00:00,2025-03-08 08:50:08+00:00,"{'CI': 1, 'Campaign TSG': 1}",Indentation was fixed by adding a newline to constructs with excessive density and running wmlindent again. While the constructs were not particularly readable it wouldn't hurt if wmlindent would cope a bit better.
2373356478,THoT-S3: make AI sides smarter,knyghtmare,2025-03-05 11:49:50+00:00,2025-03-05 16:22:39+00:00,"{'Enhancement': 1, 'Campaign THoT': 1}","- Side 2 will be less reckless and more defensive
- Side 3 will avoid making stupid moves, like placing units on water for easy kills

Players have mentioned they are disappointed in AI allies in this scenario not performing as well as they expect them too."
2370137174,Adding the [have_side] tag,rodolphecombe,2025-03-04 09:05:34+00:00,2025-03-11 19:11:41+00:00,"{'Unit Tests': 1, 'UI': 1, 'Units': 1, 'Lua API': 1, 'Schema': 1, 'Campaign THoT': 1}","Solving #9936 
Not sure if it is the right find into which to had the code."
2368460457,Android: hardcode landscape (right) orientation,JackGallstrom,2025-03-03 15:39:22+00:00,2025-03-15 16:48:56+00:00,"{'Packaging': 1, 'Android': 1}","Added 1 line for landscape orientation, at line 77, the following: _android:screenOrientation=""landscape""_
This instructs Android to always have landscape orientation (to right side of screen)"
2368362957,help browser: add search functionality,babaissarkar,2025-03-03 14:56:44+00:00,2025-03-07 15:13:23+00:00,"{'UI': 1, 'Help': 1}","Resolves #4450.

- [x] Does not work with topics generated by a help topic generator for some reason.
- [ ] ~~Add ""Search contents"" functionality.~~ (Might be done in a future PR)

![Screenshot from 2025-03-03 22-48-43](https://github.com/user-attachments/assets/e5d6e7ce-655f-428f-80a8-057e27168687)
"
2367458047,GUI2/Canvas: fix issues with literal text,Vultraz,2025-03-03 08:13:31+00:00,2025-03-03 14:49:18+00:00,{'UI': 1},"Resolves #9981
Resolves #9982

Bit of overkill... but it works. Really hope the use of variant doesn't cause CI issues with MacOS... I don't want to have to add compat wrappers for std::in_place_type."
2367148751,Add various terrain type subtables,babaissarkar,2025-03-03 04:34:54+00:00,2025-03-14 03:25:18+00:00,"{'Lua API': 1, 'Help': 1, 'Terrain': 1}","Resolves #9969.
These expose `terrain_type::mvt_type()` and `terrain_type::def_type()` as `mvt_alias` and `def_alias` subtables (array) to `wesnoth.terrain_types` table, which have the same meaning as mentioned in [TerrainWML](https://wiki.wesnoth.org/TerrainWML).

(Note: no way to figure out whether it is a `best of` or `worst of` for the latter two yet, because it's a bit too involved, but may be done in future.)"
2366701074,CI: run boost unit tests on a release build only,Vultraz,2025-03-02 15:01:18+00:00,2025-03-02 16:00:43+00:00,{},"The debug CI build is consistently the last CI job to finish, usually behind even the Windows and Mac jobs."
2366252534,GUI2: harden theme definition parsing,Vultraz,2025-03-01 17:32:22+00:00,2025-03-02 05:12:32+00:00,{'UI': 1},"- Ensure current_gui is a valid iterator after calling init(). It should match default_gui
- Ensure current_gui is always set to guis.end() if the requested theme isn't found in switch_theme(). It's initialized as such in gui_definition.cpp, but we shouldn't rely on that always being the case, especially in a function that changes it.
- Only create one schema validator for all themes. Previously, it would have been created anew for each addon with a custom theme.
- Add explicit exception handling for an invalid schema path or invalid gui2 entry point
- Add explicit warning for addon themes with the id ""default""
- Catch `wml_exception` when creating gui_definition objects for all themes (previously, this was only caught for add-on themes)
- Adjust error messages
- Fix duplicate theme errors when reloading cache (addresses one part of #9781). GUI2 definition changes now take effect without the need to restart the entire game. A cache reload is sufficient.
- Use `_main.cfg` for core theme entry points
- Include macros at global core GUI2 score instead of only in the default theme (they were always available to both themes, this just makes that clearer)"
2366176061,Add `[unit]dismissable` and `[unit]block_dismiss_message`,babaissarkar,2025-03-01 14:53:48+00:00,2025-03-05 16:25:53+00:00,"{'Unit Tests': 1, 'UI': 1, 'WML': 1, 'Units': 1, 'Schema': 1}","Resolves #8964.

Adds `dismissable` and `block_dismiss_message` keys to `[unit]`
Used in conjunction with `Dismiss` button on Unit Recall Dialog. If `dismissable` is false, the unit cannot be dismissed using the `Dismiss` button in the Unit Recall dialog, and doing so will show the `block_dismiss_message` if provided, else will show a default hardcoded message."
2365430769,Uncouple hidden dependency to Urban Jungle,spixi,2025-02-28 21:46:23+00:00,,{'Editor': 1},"Commit 366bf8f adds a hidden dependency from core to the Urban Jungle module. 

This PR uncouples this dependency, makes it easier to separate and expand the terrain system without making changes to the core and also fixes the textdomains to be consistent.
"
2363759151,Eastern Invasion S11,Wedge009,2025-02-28 05:35:38+00:00,2025-02-28 23:39:22+00:00,"{'Prose': 1, 'Campaign EI': 1}","Improvement upon 7e461ae2f52c28c37a41016e92776c30a806ce5a.

[ci_skip]"
2363076470,New Saurian Seer sprite,czyzby,2025-02-27 19:54:44+00:00,2025-03-29 15:03:44+00:00,"{'Graphics': 1, 'Units': 1}","Replaces Saurian Seer sprite added in #6911.

* Compliant with the saurian color map.
* All images optimized with `woptipng`.

Base SE and NE images were created by @doofus-01, I only did minor edits and the animations."
2362108646,Update Firebomb Ant and Grand Dragonfly XP,Dalas121,2025-02-27 12:41:27+00:00,2025-02-27 14:30:27+00:00,{'Units': 1},"These are L2 units with no L3 advancement, but have 80xp for some reason. This PR changes them to the more standard 100xp."
2361876304,Note that iOS/Android versions are currently unmaintained in readme,Gothyoba,2025-02-27 10:53:27+00:00,2025-02-28 03:29:05+00:00,{'Docs': 1},"I am aware Wesnoth is being ported to android, but this is not yet finished and not the version linked here."
2361520533,Standardize plural of naga as nagas,Gothyoba,2025-02-27 08:12:02+00:00,2025-03-22 02:01:27+00:00,"{'Units': 1, 'Campaign UtBS': 1}","Removed all instances (I could find) of naga being used for the plural, replacing them with nagas, while also fixing a few small capitalization errors I seem to have forgotten in previous PRs."
2360643836,Saurian Spearthrower tree palette cleanup,czyzby,2025-02-26 20:36:17+00:00,2025-03-29 18:14:21+00:00,"{'Graphics': 1, 'Units': 1}","Modifies saurian spearthrower and javelineer sprites:

* Replaces all colors outside of the saurian palette with the closest equivalents.
* Removes some stray semi-transparent pixels and other artifacts.
* Fixes head spikes in some spearthrower's NE run animation frames.

All images were optimized with `woptipng`."
2357867758,Saurian Oracle tree palette cleanup,czyzby,2025-02-25 22:25:06+00:00,2025-05-04 15:20:22+00:00,"{'Graphics': 1, 'Units': 1}","* Replaces semi-transparent staff swings of the Prophet with an opaque effect consistent with the Oracle sprites.
* Fixes outlines and shading of the organic parts of the Prophet frames caused by the automatic recolor of the Oracle sprites. In particular, `#581802` was replaced with `#17212c` around legs, arms, head, and tail.
* Replaces all colors outside of the saurian palette with the closest equivalents.
* Restores a medium dark shade of green in the Oracle frames to be more in line with the original sprite. In particular, `#22d22f` from the original pre-1.16 frames was replaced with `#85d64f` rather than the darker `#3f8b34`.

This is something that I originally planned to do in #6911, but that PR was eventually merged as is. All images are optimized with `woptipng`."
2357376354,Editor Adjustments,babaissarkar,2025-02-25 17:42:22+00:00,2025-03-02 15:31:07+00:00,"{'UI': 1, 'Editor': 1, 'Input': 1}","Resolves #9956.

A new ""Convert to Scenario"" option added to ""File"" menu to allow converting the currently active map to a scenario has been added.

(Can be squash-merged)"
2356084780,lua api: expose male/female names for races,babaissarkar,2025-02-25 09:20:05+00:00,2025-02-25 14:01:10+00:00,{'Lua API': 1},Resolves #9954.
2354740374,"TDG: remove silent raven speed reduction, and use TRAIT_SLOW instead",Dalas121,2025-02-24 21:14:17+00:00,2025-02-24 22:24:59+00:00,{'Campaign TDG': 1},"TDG gives Delfador access to a loyal raven/dire raven/war harbinger. Currently, the speed for this unit is capped at 6, to prevent it from being overly-powerful when compared with other options.

revolting_peasant pointed out that this speed cap makes the raven's stats inconsistent with the numbers in ""view unit type"". To resolve that, this PR replaces the speed cap with {TRAIT_SLOW}."
2353607966,Add map dimension info,soliton-,2025-02-24 13:02:54+00:00,2025-02-26 22:52:24+00:00,{'CI': 1},Always generate a comment even if image upload failed and add API response for easier debugging.
2353466464,add 'invulnerable' status for prevent unit die during tests,newfrenchy83,2025-02-24 12:02:49+00:00,2025-02-24 15:44:41+00:00,{'Unit Tests': 1},else possibility of victory result in test.
2352619243,Bump min Boost version to 1.70,Vultraz,2025-02-24 04:06:07+00:00,2025-02-24 06:05:17+00:00,"{'Building': 1, 'SCons': 1, 'CMake': 1}",
2352349902,Add Windows Boost tests,Wedge009,2025-02-23 21:55:20+00:00,2025-02-23 23:13:08+00:00,"{'Windows': 1, 'CI': 1}",Just running the CI checks to test the current status of #8658 and #8659.
2352304665,AToTB S3 Map: Aesthetic Revision,Gothyoba,2025-02-23 20:06:47+00:00,2025-03-09 13:22:01+00:00,{'Campaign AToTB': 1},"@Dalas121 Hope I have at least slightly improved this, though the revision is much smaller than most of my previous ones.

Current Map:

![atotb-s3-old](https://github.com/user-attachments/assets/101ab4a9-f236-4bd7-9801-39bf33ae8622)

Proposed map:

![atotb-s3-new](https://github.com/user-attachments/assets/82371bec-2603-4258-a495-d84e085b0883)"
2352197464,Touch persistence fix,JackGallstrom,2025-02-23 16:19:30+00:00,2025-03-04 09:33:40+00:00,"{'Input': 1, 'Android': 1}","Added logic for touch being negative, as well as extra code to make sure any touch event is cleaned up.

All changes occur inside the definition of ""#ifdef MOUSE_TOUCH_EMULATION"" and the most important line change is at 581"
2352068446,Saurian Juvenile,Refumee,2025-02-23 12:10:10+00:00,2025-02-26 18:27:11+00:00,"{'Graphics': 1, 'Units': 1, 'Campaign TDG': 1}","Updating the sprites for the saurian juveline for TDG. Colorset of the Saurians respect the ColorMap of the Saurians with some exceptions in the clothing.

I created 4 Saurian Juveline for TDG, cause TDG had 4 Saurian Juveline.
I also gave them a bobbing animation like a Saurian.
exif metadata is added."
2352025393,help: link base and overlay terrains in terrain help pages (#9456),babaissarkar,2025-02-23 10:53:20+00:00,2025-02-26 05:58:38+00:00,"{'UI': 1, 'Help': 1, 'Terrain': 1}","Resolves #9456 by linking the help pages for Base and Overlay terrain for composite terrains.

![Screenshot from 2025-02-23 16-20-28](https://github.com/user-attachments/assets/a5957dc7-4ed5-490d-800f-7c1e8c42655c)
"
2350946802,drop preferences.cpp from source lists (no longer needed),babaissarkar,2025-02-22 04:41:32+00:00,2025-02-22 06:27:30+00:00,{'Building': 1},"Duplicate inclusion, exists in both `source_lists/wesnoth` and `source_lists/libwesnoth`. Opened PR for test CI run to see if one can be dropped."
2350939257,lua api: add double click event handler,babaissarkar,2025-02-22 04:25:16+00:00,2025-08-07 05:06:29+00:00,"{'UI': 1, 'Lua API': 1}","Adds a new `on_double_click` function to toggle panels that get called when the user left double clicks on it. For other widgets, they can be wrapped inside a `[toggle_panel]` to add double click handlers, because the C++ dbl click handler supports only `[toggle_panel]`-s."
2350829887,TDG: some S00 onboarding improvements,Dalas121,2025-02-22 01:57:26+00:00,2025-02-23 14:28:14+00:00,{'Campaign TDG': 1},"Based on: https://forums.wesnoth.org/viewtopic.php?p=696551#p696551

Makes the ""_Delfador does not use XP to level-up_"" message less likely to appear in the first scenario, and elaborates on how delfador _does_ level-up."
2350157244,Improve Galleon Unit Description,Gothyoba,2025-02-21 17:19:17+00:00,2025-02-22 21:46:27+00:00,{'Units': 1},"I remade the Galleon unit description. The detail on their origin in the Green Isle in new, but their appearance in TRoW would suggest this."
2350118470,Remove instance of 4 repeated exclamation marks,Gothyoba,2025-02-21 16:56:51+00:00,2025-02-21 17:20:51+00:00,{'AI': 1},"Follow-up to #9918

It was decided that three exclamation marks is fine and the style guide has been changed accordingly, but this instance of four should still be removed. I replaced this with three exclamation marks."
2349243458,TDG: Improve Custom Saurian Unit Descriptions,Gothyoba,2025-02-21 10:06:34+00:00,2025-02-22 21:04:22+00:00,"{'Units': 1, 'Campaign TDG': 1}","@Dalas121 I tried to improve these descriptions. The Devotee and Spike are currently using description from their level 1 counterparts, so I gave them something more unique. The saurian race description already said saurians become adults at the age of three, so I used that in the Saurian Juvenile description, which I hopefully improved from the original.

(Check failure in the first commit is unrelated to my changes)"
2347657635,Use orcs instead of goblins in Sea Orc unit description,Gothyoba,2025-02-20 16:59:56+00:00,2025-02-22 21:04:54+00:00,"{'Units': 1, 'Campaign HttT': 1}","""a great leap for all orcs"" makes more sense since they are supposed to be orcs."
2347429640,Capitalize Kingdom in TRoW Campaign Description,Gothyoba,2025-02-20 15:27:02+00:00,2025-02-20 22:01:34+00:00,{'Campaign TRoW': 1},Other instances of “Kingdom of Wesnoj” have Kingdom capitalized (e.g. DW S2) and capitalizing this would be the general convention in this case so it makes sense to do it in the TRoW Campaign Description as well.
2345485239,Fix Inconsistent droid requirements in an all AI game,Mahoyomu,2025-02-19 20:20:10+00:00,,"{'MP': 1, 'UI': 1}","### Goal of the PR
- Fix #9879
### How does the PR work?
- By adding a `force` action and related code to command `droid`.
### Does it resolve any reported issue?
- #9879
### If not a bug fix, why is this PR needed? What use cases does it solve?
- This is a bug fix.

## To do

Adjust possibly missed related method and changes I mistakenly made, remove redundant notes I used for quickly locating(all after this pr is nearly ready for review).

This PR is Ready for Review.

## How to test
Compile and run, see the test video I might upload later if needed, or see changes in the src."
2344558123,SotBE-S16: tweak start event,knyghtmare,2025-02-19 13:03:10+00:00,2025-02-19 14:48:13+00:00,"{'Enhancement': 1, 'Campaign SotBE': 1}","Make Orga the Orc Warlord move to his keep and then face the player, Kapou'e

Shan Taum orders Orga to take care of the player while he chills at his keep. So, we move to Orga to the castle keep and give the impression he is taking over the Bitok defenses."
2344372607,Use numbers instead of words to write thirteen in WoF S11,Gothyoba,2025-02-19 11:37:44+00:00,2025-02-20 12:20:17+00:00,{'Campaign WoF': 1},"According to the typography style guide, numbers above 12 (except from round numbers) should be represnted with numbers, not words, at least in regular character dialogue. So this “thirteen” should be written as “13”."
2342857030,TDG: Fix typo in Saurian Juvenile Unit Description,Gothyoba,2025-02-18 18:50:04+00:00,2025-02-18 18:51:47+00:00,"{'Units': 1, 'Campaign TDG': 1}",sauians -> saurians
2342308740,Improve HttT Campaign Description,Gothyoba,2025-02-18 15:03:14+00:00,2025-02-18 15:50:24+00:00,{'Campaign HttT': 1},@Dalas121 Is this an improvement? I thought the current description isn’t very good compared to others.
2342122493,TSG: remove duplicated sound files,Dalas121,2025-02-18 13:48:14+00:00,2025-02-18 17:17:13+00:00,"{'Audio': 1, 'Campaign TSG': 1}","Remove TSG's version of two sound files duplicated in both `data/campaigns/tsg` and `data/internal`, as pointed out by @Wedge009 in #9874."
2342063487,Use Far North instead of Northern Lands in DW Campaign Description,Gothyoba,2025-02-18 13:24:44+00:00,2025-02-18 19:36:39+00:00,{'Campaign DW': 1},Pointed out by Wedge in #9924 
2341747361,Use Northlands instead of Northern Lands in THoT Campaign Description,Gothyoba,2025-02-18 11:17:43+00:00,2025-02-18 20:43:31+00:00,{'Campaign THoT': 1},@Dalas121 Should you review this and #9926?
2341482266,Update Unit Description Capitalization,Gothyoba,2025-02-18 09:19:05+00:00,2025-02-18 21:24:05+00:00,"{'Units': 1, 'Campaign EI': 1, 'Campaign THoT': 1, 'Campaign UtBS': 1, 'Campaign WoF': 1, 'Campaign TDG': 1}",@Wedge009 Follow-up to #9892 
2341260462,"HttT S11, 13: Remove names from monsters",OrekOrek,2025-02-18 07:17:56+00:00,2025-02-18 12:46:14+00:00,{'Campaign HttT': 1},"List of units from monster sides in HttT (scenario number: unit ID, unit name, manually defined ""name."")
S11: Water Serpent, Water Serpent, ""Water Serpent""
S11: Cuttle Fish, Cuttlefish, ""Cuttle Fish""
S13: Cuttle Fish, Cuttlefish, ""Cuttle Fish""
S14: Blood Bat, Blood Bat, no name
S14: Giant Spider, Giant Spider, ""Hywyn""
S19c: Water Serpent, Water Serpent, no name

Giant Spider has an original name just like Konrad/Li'sar, but names like ""Water Serpent"" and ""Cuttle Fish"" in S11 and S13 seem unnecessary.

Because unit IDs are untouched, there should be no risk of messing up other parts of the game unlike #9907."
2341040288,TSG S3: Correct ending scene,Wedge009,2025-02-18 04:25:27+00:00,2025-02-18 19:37:07+00:00,{'Campaign TSG': 1},"A Skeleton is supposed to be summoned to (12,3), but it isn't properly cleared like the other hexes around (12,4).

Resolves #9920"
2340498202,AToTB S2 Map: Aesthetic Revision,Gothyoba,2025-02-17 19:53:21+00:00,2025-02-18 20:44:27+00:00,{'Campaign AToTB': 1},"@Dalas121 I had a lot of fun making the THoT Map Revisions, so I decided to have a go at some small changes to the AToTB S2 Map. I changed the positions of some of the southernmost elvish troops to make sure they are still close to your keep, and I changed the woses position to make sure they aren't right on the shore of the river.

Current Map:

![Old_AToTB_S2](https://github.com/user-attachments/assets/93d1699a-0030-45ef-ad34-12f208c65aa3)

Proposed Map:

![New_AToTB_S2](https://github.com/user-attachments/assets/9ee9db9d-ac16-435a-aa02-6dec161189cf)
"
2339451585,Remove Instances of 3 or 4 Repeated Exclamation Marks,Gothyoba,2025-02-17 11:06:21+00:00,2025-02-21 16:54:28+00:00,"{'AI': 1, 'Unit Tests': 1, 'Campaign DiD': 1, 'Campaign EI': 1, 'Campaign HttT': 1, 'Campaign WoF': 1}","Removed all instances of three or four repeated exclamation marks from translatable strings, which are not allowed by the typography style guide:

> The following combinations are acceptable: !, ?, !?, ?!, ??, !!, but three or more marks really are not

I replaced all these instances with two exclamation marks, which are considered acceptable."
2338355451,Lua: optional parameter to ignore scrolling to fogged hex in wesnoth.interface.move_unit_fake,sevu,2025-02-16 18:37:06+00:00,,{'Lua API': 1},Currently it can reveal where a unit is on the map by scrolling there. with this change one could pass an fourth parameter whether to only scroll only if the starting hex is not under fog.
2337909555,Bump min and default game window size,Vultraz,2025-02-15 20:42:33+00:00,2025-02-16 16:13:21+00:00,{},"Hopefully, we'll be able to implement better support for layouts that don't relay on pixel canvas sizes, but for now, this solves two important issues:

Using 1280x720 as the default window size means 3x auto pixel scaling for 4k fullscreen, which looks utterly horrendous and unusable. 2x is the practical limit of usability without going so far in the opposite direction as to actually reduce the available space.

Bumping the min window size also resolves #9898 and saves us from having to deal with layouts on unusably small windows.

As a side note, we should not be thinking in terms of pixel size anymore. I'm hoping SDL3 can give us better control over our HDPI support (which is much improved from before), but the fact remains that our current pixel scaling implementation is, essentially, a method to scale up the canvas if your resolution is grater than 1080p. It does nothing for size calculations, and it does nothing if you actually set a window size smaller than 1080p even on a 4k monitor.

So, for now, imperfect solution while we wait for SDL3, but solves the immediate issues with scaling and small window sizes.

Resolves #9898"
2337899754,THoT S7 Map: Aesthetic Revision,Gothyoba,2025-02-15 20:11:20+00:00,2025-02-16 18:11:24+00:00,{'Campaign THoT': 1},"@Dalas121 This is the last aesthetic revision for a THoT Map I'll make, for Scenario 7. Like Scenario 1, this was intended to have an underground keep for Kal Kartha. Castle tiles for the orcs have been moved around, but there are the same number of them in total. The coordinates used in the scenario file stay the same due direction in which the map is expanded in, so it only requires map changes. I also added a changelog entry for all my THoT map revisions, so I hope this can be merged before 1.19.9.

RKT gave some very useful feedback for this one. Thank you very much!

Current Map:

![07_Unrevised](https://github.com/user-attachments/assets/ed2eff4a-ac75-4e12-a623-38e3310c0602)

Proposed Map:

![07_Revision_2](https://github.com/user-attachments/assets/d81bdb4e-9f7d-4136-a982-132d8c22d973)"
2337856254,Cmake: use BoostConfig explicitly to silence CMP0167 warning,Vultraz,2025-02-15 18:07:28+00:00,2025-02-19 21:05:04+00:00,"{'Building': 1, 'CMake': 1}","Fixes the ""Policy CMP0167 is not set: The FindBoost module is removed"" warning when running `vcpkg install`. I'm not sure if this change requires bumping to Boost 1.70 or not."
2337752633,TSG: Correctly show which arm Mari is missing in po note,Gothyoba,2025-02-15 14:28:16+00:00,2025-02-16 22:22:17+00:00,{'Campaign TSG': 1},"@Dalas121 Was this the arm intended to have been lost? The sprite would suggest the right arm was lost:

https://github.com/wesnoth/wesnoth/blob/529f4caca9ebfb1e94e2edad722d9f64e0821152/data/campaigns/The_South_Guard/images/units/mari2/mari.png

So I changed this po note to say right instead of left."
2336948562,Integrate special ability events into these abilities.,newfrenchy83,2025-02-14 19:48:53+00:00,2025-02-22 20:04:30+00:00,"{'Units': 1, 'Campaign DiD': 1, 'Campaign UtBS': 1, 'Campaign WoF': 1}",This had not yet been done in the mainline.
2336824345,TDG: allow the levitate spell to improve cave movement,Dalas121,2025-02-14 18:20:37+00:00,2025-02-14 19:53:19+00:00,{'Campaign TDG': 1},Cave movement was previously left out as an oversight.
2335956295,Fix defining formula function with existing name silently fails,Mahoyomu,2025-02-14 11:51:13+00:00,2025-03-02 15:16:59+00:00,{'WFL': 1},"### Goal of the PR
- Fix #9795
### How does the PR work?
- By adding a replace situation when the function name already exists in `custom_formulas_`.
### Does it resolve any reported issue?
- #9795
### If not a bug fix, why is this PR needed? What use cases does it solve?
- This is a bug fix.

## To do

Adjust possibly missed related method and changes I mistakenly made, remove redundant notes I used for quickly locating(all after this pr is nearly ready for review).

This PR is Ready for Review.

## How to test
Compile and run, see the test video I might upload later if needed, or see changes in the src."
2334612404,add a 'filter_distant' to abilities.,newfrenchy83,2025-02-13 19:48:23+00:00,2025-05-23 14:51:02+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1, 'Campaign DiD': 1}",with using this subtag it is possible to filter unit on a radius greater than 1.
2334149494,SotBE S6: add dialogue to resolve inconsistency,knyghtmare,2025-02-13 15:47:49+00:00,2025-02-14 13:16:39+00:00,"{'Prose': 1, 'Campaign SotBE': 1}","closes #9268

Updating the text to mention a possible reason is much more feasible than tweaking 3 scenarios to show the actual route taken."
2333789565,add a tag [affect_distant] to abilities,newfrenchy83,2025-02-13 13:23:16+00:00,2025-04-27 09:15:51+00:00,"{'Unit Tests': 1, 'Units': 1, 'Lua API': 1, 'Schema': 1, 'Campaign DiD': 1}","resolve https://github.com/wesnoth/wesnoth/issues/4981 issue
like [affect_adjacent] this tag affects other units than the owner of the ability but this time, it concerns units located in a radius defined in the tag.

I had already tried to make one a few years ago but the code was too heavy and I had given up."
2331407598,SotBE: S15: update map,knyghtmare,2025-02-12 14:12:23+00:00,2025-02-13 11:15:17+00:00,{'Campaign SotBE': 1},Just the usual round of refining...
2331301234,EI S12: Use Eyrie instead of Aerie,Gothyoba,2025-02-12 13:31:03+00:00,2025-02-12 21:14:05+00:00,{'Campaign EI': 1},"Eyrie is much more commonly used in Wesnoth nowadays, and is the form used in WoF."
2331037906,Only attempt to load .cfg scenarios in MP lobby,Wedge009,2025-02-12 11:28:30+00:00,2025-02-26 02:51:00+00:00,{'MP Lobby': 1},"The built-in editor only allows saving to `.cfg` files. Even the editor only tries to load `.cfg`, `.map`, or `.mask` files.

https://github.com/wesnoth/wesnoth/blob/c5c7674cf5e079113e918126ab9a038f1e434951/src/editor/map/map_context.cpp#L198-L204

So it makes sense to me to only attempt to load .cfg files when the MP lobby tries to find user scenarios.

Closes #4363"
2330085592,TDG: use improved saurian sprites by Refumee ,Dalas121,2025-02-12 00:28:46+00:00,2025-02-12 02:38:24+00:00,"{'Graphics': 1, 'Campaign TDG': 1}",
2329568826,fix rect.cpp compilation,newfrenchy83,2025-02-11 19:30:02+00:00,2025-02-11 19:37:54+00:00,{'Building': 1},when i try to compile std::round not know
2329178379,Capitalize Unit Names in their Descriptions,Gothyoba,2025-02-11 16:27:13+00:00,2025-02-12 12:05:09+00:00,"{'Units': 1, 'Campaign DW': 1, 'Campaign EI': 1, 'Campaign THoT': 1, 'Campaign TRoW': 1, 'Campaign UtBS': 1, 'Campaign WoF': 1, 'Campaign TDG': 1}","Based on the the typography style guide (https://wiki.wesnoth.org/Typography_Style_Guide#Race_Names):

> however unit types are capitalised as if they were proper nouns.

I have fixed (most) instances of uncapitalized unit names in unit type descriptions. Other capitalization or typography issues which may be present in these descriptions are not fixed by this PR. I have included partial unit names (e.g. Sunderer, full name Dune Sunderer), especially as in many cases these were already capitalized."
2327728713,Split text attribute handling into its own API,Vultraz,2025-02-11 04:54:34+00:00,2025-02-15 05:33:47+00:00,"{'macOS': 1, 'UI': 1, 'Building': 1}","WIP, opening for feedback on sorting out attribute handling issues."
2327062951,Capitalize both parts of Pirate Galleon in Unit Description,Gothyoba,2025-02-10 20:18:21+00:00,2025-02-10 20:26:12+00:00,{'Units': 1},"According to the typography style guide, both parts of unit names should be capitalized."
2327007968,Remove configure_engine,Pentarctagon,2025-02-10 19:51:12+00:00,2025-02-15 17:04:38+00:00,"{'macOS': 1, 'UI': 1, 'Building': 1}",it's mostly a wrapper around things which are already available via create_engine
2325832266,dismiss recall: add edge case handling code,knyghtmare,2025-02-10 11:43:18+00:00,2025-05-02 15:35:07+00:00,"{'UI': 1, 'Engine': 1}","SotBE: after S11, you get level 1 units with no upkeep. They trigger loyal unit dismissal dialogue warning. This should not happen. closes #8265

Disclaimer: I do not know any cpp. I just wrote this based on what I thought was okay. "
2324769203,Fix achievement and scenario name inconsistency in TSG,Gothyoba,2025-02-09 21:37:26+00:00,2025-02-09 22:38:11+00:00,"{'Achievements': 1, 'Campaign TSG': 1}",Fixes #9882 
2324729799,THoT S5 Map: Aesthetic Revision,Gothyoba,2025-02-09 20:03:59+00:00,2025-02-15 17:10:14+00:00,{'Campaign THoT': 1},"Yet another map revision for THoT. I won't revise the final caves scenarios or Forbidden Forest, so after this S7 is the last map to revised.

Current Map:

![THoT_Old_S5_Map](https://github.com/user-attachments/assets/0621f963-7103-4910-a526-3f7827fdae61)

Proposed Map:

![THoT_Proposed_S5_Map](https://github.com/user-attachments/assets/15c01054-8609-4c25-af03-f913fd2fa73d)

@Dalas121 Need your review
"
2324525431,Fix wesnoth-revision target dependency,soliton-,2025-02-09 13:39:06+00:00,2025-02-09 15:08:21+00:00,"{'Building': 1, 'CMake': 1}",
2324470726,Implement Reachmap Color and Opacity Options,ForestDragon-wesnoth,2025-02-09 12:21:58+00:00,2025-02-15 04:39:49+00:00,"{'macOS': 1, 'Graphics': 1, 'UI': 1, 'Building': 1, 'Schema': 1, 'Terrain': 1}","Expanding upon the brand-new 1.19 reachmap UI by Descacharrado, after discussing with him how to best handle the implementation of this feature, I have created brand-new color and opacity options for the reachmap, available from a submenu within the advanced settings menu.

The reachmap menu currently supports the following options:

-Reachmap Color: for the border and tint
 -defaults to teal, same as is in the main branch code
-Reachmap Enemy Color: for borders adjacent to an enemy
 -defaults to red, same as is in the main branch code
-Reachmap Border Opacity. 
 -ranges from 0% to 100%, defaults to 100%
-Reachmap Tint Opacity. 
 -ranges from 0% to 100%, defaults to 50% (however, the opacity of the base image has been doubled to compensate, so the result looks basically identical to main branch. this was done to allow players to set the opacity higher than on master branch if they want a brighter more high-contrast tint (for either personal preference or accessibility reasons)

Supported colors at the moment: teal, white, lightblue, red, gold, brightgreen, brightorange, darkred, orange, green

Screenshots:

White border color, red enemy color, 70% border opacity, 50% tint opacity:
![image](https://github.com/user-attachments/assets/0d77eaea-2cc9-46d4-83d7-c951297e1559)

Gold border color, Darkred enemy color, 70% border opacity, 50% tint opacity
![image](https://github.com/user-attachments/assets/78de54a1-7575-41aa-877f-f7df8447f0a5)

Red border color, Darkred enemy color, 70% border opacity, 50% tint opacity
![image](https://github.com/user-attachments/assets/3f4143f3-075d-46c2-8252-cebe15197060)

Default values: teal border color, red enemy color, 100% border opacity, 50% tint opacity (same as in main branch at the moment):
![image](https://github.com/user-attachments/assets/a6e34327-bffb-46c0-a748-d99f82a85b3a)

Reachmap option menu:

![image](https://github.com/user-attachments/assets/9284950f-c800-46ab-ba9d-a16e5c5ee9eb)
"
2324323871,Earth-Cake's updates to Northern Rebirth,Wedge009,2025-02-09 05:03:27+00:00,2025-02-10 05:28:29+00:00,{'Campaign NR': 1},"Cherry-picked from #8881, should include everything except for the changes to S5 The Pursuit.

@Dalas121 I don't think this needs your explicit approval since you already gave it for #8881 but notifying you all the same."
2323203521,EI: display the note for Owaec's weapon special in unit description,Thewodoros,2025-02-07 22:07:28+00:00,2025-02-15 14:50:57+00:00,"{'Units': 1, 'Campaign EI': 1}","I've noticed that PR #9864 removes an unused `NOTE_SHOCK` macro.

The text in that note is actually useful. Currently it doesn't appear in Owaec's unit description page, and that's a mistake.

Instead of including it into `[unit_type]` files, I put it directly into the tag for that weapon special. It's the newer and simpler way of achieving the same effect, see wiki: [UnitTypeWML#Special_Notes](https://wiki.wesnoth.org/UnitTypeWML#Special_Notes)

I've also changed the way the ""vanguard"" ability note is included to the newer one. No behavior change for this note: it's displayed the same way as before.

Note: I don't delete the unused macro `NOTE_SHOCK` because it's deleted in PR #9864, to avoid a merge conflict. The code will stay in a working state regardless which PR is merged first."
2323083306,Add History Section to Encyclopedia,Gothyoba,2025-02-07 20:39:39+00:00,,"{'Prose': 1, 'Help': 1}","Fixes #9495

Add a history section to the encyclopedia. I had planned on starting work on this several months ago, and now I'm finally actually starting it.

I currently only have a low quality drake section now based on unused history files in WoF. I hope to work on this for the next few weeks/months and improve this significantly. I will make individual sections for all major factions except dunefolk, which currently don't have enough history to make a section at the moment, as well as a central summarized timeline for all races, including those not covered by the factions. (similar in format to wiki timeline)

- [x] Drakes
- [ ] Dwarves
- [ ] Loyalists (Does not include Wesfolk/Dunefolk/Undead)
- [ ] Orcs
- [ ] Elves
- [ ] Undead
- [ ] Full Timeline"
2323077489,SotBE: update credits,knyghtmare,2025-02-07 20:35:08+00:00,2025-02-08 09:23:32+00:00,{'Campaign SotBE': 1},Going with what the Wedge said in #9858 
2322965309,Green Isle Encyclopedia Tweaks,Gothyoba,2025-02-07 19:21:25+00:00,2025-02-09 19:17:59+00:00,"{'Prose': 1, 'Help': 1}","Some small tweaks to the Green Isle section of the encyclopedia I recently added.

@Dalas121 Needs your review"
2320537896,Consistently capitalize Lord in THoT S2 Text,Gothyoba,2025-02-06 17:54:35+00:00,2025-02-07 22:42:28+00:00,"{'Prose': 1, 'Campaign THoT': 1}","I don't think the typography style guide specifies if this should be capitalized or not, but it does feel right and the capitalization was inconsistent within the same line, so I decided to fix it by capitalizing the word Lord in both titles."
2320491243,EI: Rename weapon special shock to stagger,Gothyoba,2025-02-06 17:27:47+00:00,2025-02-15 16:19:29+00:00,"{'Units': 1, 'Campaign EI': 1}",Fixes #8438 
2320469791,Add Thewodoros to credits,Gothyoba,2025-02-06 17:15:37+00:00,2025-02-09 19:15:49+00:00,"{'Units': 1, 'Campaign EI': 1}","@Thewodoros @Dalas I have added Thewodoros to the credits for EI in a new Campaign Maintenance section which includes them and Dalas, as Thewodoros has contributed more than 40 commits to the campaign. I have also added Thewodoros to the main credits with a comment saying “EI Maintenance”."
2320360917,TRoW S13: Fix Drake Dialogue Inconsistency,Gothyoba,2025-02-06 16:30:00+00:00,2025-02-09 19:09:33+00:00,{'Campaign TRoW': 1},"Fixes #8263

Now uses Morogor dialect. Casters is an ancient word for human mentioned here: https://github.com/wesnoth/wesnoth/blob/master/data/campaigns/Winds_of_Fate/story/Morogor_Dialect.txt"
2320189925,Uncapitalize goblin in pillager unit description,Gothyoba,2025-02-06 15:22:32+00:00,2025-02-07 21:56:42+00:00,{'Units': 1},Race names should not be capitalized according to the typography style guide.
2320183684,Capitalize Elvish Captain in unit description,Gothyoba,2025-02-06 15:19:39+00:00,2025-02-07 21:56:32+00:00,{'Units': 1},"Elvish Captain is a unit name, so according to the typogrpahy style guide both parts need to be capitalized."
2320152522,Change zookeeper to former maintainer of TRoW,Gothyoba,2025-02-06 15:05:57+00:00,2025-02-09 19:13:34+00:00,{'Campaign TRoW': 1},@ln-zookeeper has not committed to TRoW since 2018.
2320146246,Change zookeeper to former maintainer of SotBE,Gothyoba,2025-02-06 15:03:09+00:00,2025-02-07 20:13:25+00:00,{'Campaign SotBE': 1},@ln-zookeeper has not committed to SotBE since 2018.
2320138036,Change Fabi/Fendrin to former maintainer of LoW,Gothyoba,2025-02-06 14:59:35+00:00,2025-02-09 19:13:49+00:00,{'Campaign LoW': 1},"No commits to LoW since 2016 from @fendrin or Fabian Müller (not sure who this reffers to, but neither of these accounts have contributed in a very long time)."
2320057432,Change zookeeper to former maintainer of HttT,Gothyoba,2025-02-06 14:25:30+00:00,2025-02-09 19:14:02+00:00,{'Campaign HttT': 1},"@ln-zookeeper Hasn’t commited to HttT since 2018. I haven’t removed them from HttT’s credits, but I have replaced “current maintainer” with “former maintainer”, which is more accurate."
2319770898,Update INSTALL.md to include more detailed information about building wesnoth on Windows with vcpkg,ForestDragon-wesnoth,2025-02-06 12:14:04+00:00,2025-04-12 04:45:53+00:00,{'Docs': 1},"This PR aims to make the Windows guide in INSTALL.md for building wesnoth using vcpkg more detailed, as requested by Soliton.

Feedback about the quality of the expanded guide and any potential adjustments would be appreciated."
2318956093,"EI S09: fix minor bugs, code improvements",Thewodoros,2025-02-06 03:35:00+00:00,2025-02-10 16:58:38+00:00,{'Campaign EI': 1},"Explanation commit-by commit:

### Villages

It looks like this map had more villages before, and the scenario code wasn't changed to reflect that. 

#### Commit 1

There are no villages close enough to the player's starting position, so `STARTING_VILLAGES` macro does nothing, so I remove it. No changes in behavior.

#### Commit 2

 Two of the revealed coordinates are empty spots near the ogre camp. I've changed them to the coordinates of the village there. So, now on turn 1 we have 2 villages revealed instead of 1. There are 4 villages in total, and the other 2 are close to the main path.

#### Commit 3

There is no village at this coordinates, so `CAPTURE_VILLAGES` macro does nothing.

There is a village a bit further east, but Mortic needs 2 turns to reach it from the keep. I tested it, and he doesn't try to capture that eastern village, but fights my units instead.

No changes in behavior.

### Simplify meeting events

These events all used `FIND_NEARBY` macro, which is not necessary here; and I think using it repeatedly does not guarantee that the same units will be chosen every time (if there are more than 1 at the same distance).

I also replaced this macro in the event for sighting the drakes: see commit 10.

#### Commit 4

In human-meets-ogre event, we already have `unit` and `second unit`, we only need to find which is ours. No changes in behavior.

#### Commit 5

In ogre-meets-ogre event,  we only have `unit`, so we need to also store the unit adjacent to it. No changes in behavior.

#### Commit 6

Here using `FIND_NEARBY` actually caused a bug, because it's used with `found_unit` in its arguments, and inside the macro code that variable is being overwritten. The effect is, it just finds any unit fitting the filter, not necessary nearest; so Grug talks to an ogre not directly adjacent to him.

Another bug was caused by using `unit` instead of `found_unit` in the last message, which made Grug say this line instead of the newly allied ogre.

Anyway, I remove `FIND_NEARBY` and just store the side 5 unit adjacent to Grug. This commit fixes both bugs.

### Misc

#### Commit 7

I've noticed that `unit` variable is explicitly cleared in the end of the scenario. I think that's because it's used in the frostbite loop.

As `unit` variable is automatically set in many types of events, I think it may be bug-prone to name the custom variable the same. Instead I've just deleted the variable naming line, so the loop uses the default `this_item` variable.

#### Commit 8

There are several changes related to clearing the variables:

* Clear temporary variables like 'found_unit' and `gold` in the same event
* Clear all scenario-wide variables in one line in the `victory` event
* Don't clear standard `unit` variable
* Don't clear `frostbite_animate` variable because it was never created
* Clear `drakes_no_income` in `victory` event in case we never meet the drakes
* Remove creating `elixir_drinker` variable from the macro, and clearing it from the scenario, as the frostbite filter use the trait instead.

#### Commit 9

Use `x1` and `y1` variables instead of `unit.x` and `unit.y`.

### Commit 10

Simplify the event for meeting drakes. Instead of using `FIND_NEARBY`, just switch to Mortic if the orcs were sighted first. As Mortic is the drake closest to the orcs' location, there is no changes in behavior."
2318927944,remove legacy_vector map_locaton functions,gfgtdf,2025-02-06 03:07:45+00:00,,{'Terrain': 1},"these were brokenas mentioned in the comment, but the builders rotation functions assumed some of this broken behavior, so we have to replace the rotation functions aswell."
2317918652,SotBE: S12: make loyalists AI smarter,knyghtmare,2025-02-05 15:32:12+00:00,2025-02-10 08:50:00+00:00,"{'Enhancement': 1, 'AI': 1, 'Campaign SotBE': 1}","- Partially makes them focus on attacking only when no enemy is near their leader, but switch to full defensive if enemy leaders are nearing the vicinity"
2316153570,Only load the specified image type and add webp support,soliton-,2025-02-04 21:10:11+00:00,2025-02-05 22:56:57+00:00,{'Graphics': 1},
2315799662,Add rain to DiD S2 and S6,Gothyoba,2025-02-04 17:47:26+00:00,,{'Campaign DiD': 1},I feel like rain fits pretty well into Scenario 2 (Peaceful Valley) and Scenario 6 (Return to Parthyn).
2315626172,THoT S4 Map: Aesthetic Revision,Gothyoba,2025-02-04 16:15:06+00:00,2025-02-07 22:38:06+00:00,{'Campaign THoT': 1},"Another aesthetic revision of a THoT map, this time Scenario 4, High Pass.

Current Map:

![THoT-S4-Original](https://github.com/user-attachments/assets/72b93280-4e5c-45d7-a19e-0bffad0dc439)

Proposed Map:

![THoT-S4-Map-Rework-Hills](https://github.com/user-attachments/assets/c9c13876-09dd-44c7-a47b-0aab7451158f)

@Dalas121 Needs your review"
2315277385,Units Dialog fixes,babaissarkar,2025-02-04 13:49:28+00:00,2025-02-07 16:07:10+00:00,"{'UI': 1, 'Units': 1}","* Properly grey out units in recruit dialog (similar to 1.18) (Resolves https://github.com/wesnoth/wesnoth/issues/9813)
* Fix crash (Resolves https://github.com/wesnoth/wesnoth/issues/9839)

![Screenshot from 2025-02-04 19-04-31](https://github.com/user-attachments/assets/1769646c-382e-4cd0-b710-ea6242ef99e9)
"
2314559334,THoT: Update Masked Dwarf Stats,Gothyoba,2025-02-04 09:07:27+00:00,2025-02-10 16:55:31+00:00,"{'Units': 1, 'Campaign THoT': 1}","Updated the stats of Masked Dwarves in THoT to be up to date with default dwarves, as they are supposed to be he same in terms of stats. These hasn’t been updated in years despite several balancing changes for the default dwarves. I also updated the unit description the Dwarvish Masked Steelcad since the default one was reworked a few years ago."
2314092104,"Add [clear_chat], [get_zoom], and optional scrolling support",MadMax3947,2025-02-04 03:20:31+00:00,2025-09-24 12:54:58+00:00,"{'Lua API': 1, 'Squash': 1}","Add a couple simple (but potentially useful) wml actions, and add support for scrolling only if a tile is not currently visible.

`[clear_chat]`: as the name implies, clears recent chat messages. Could be used with cutscenes or transitions between different phases of a multiplayer scenario, or also if a scenario is using chat messages to provide information to the player.

`[get_zoom]`: implements request in #7423. Useful if a cutscene or other animation requires a fixed (non-relative) zoom level, so it can be set back, and I could also envision need for animations to scale based on current zoom level.

In addition, extends `[scroll_to]` and `[scroll_to_unit]` to support `only_if_needed`; if this is true then the map will only scroll if the hex or unit is not already visible. Primarily intended for extended dialog scenes with animations where units are (probably) all visible anyway so they can be less choppy.

Finally, extends `[kill]` with a `scroll_to` attribute. Defaults to true. If set to false, then map will not scroll to the unit being killed. Similar use cases as `only_if_needed`."
2313746972,Fix #9834 error after reloading after taking village,gfgtdf,2025-02-03 22:06:44+00:00,2025-02-04 04:34:01+00:00,{'Engine': 1},
2313630222,Add myself to credits,Gothyoba,2025-02-03 20:58:38+00:00,2025-02-03 21:16:58+00:00,{}," I think I may be eligible to be added miscellaneous contributor to the credits. I am an active contributor with  37 total commits (many of which are very minor) including a fairly significant revision of the in-game encyclopedia.

This PR should not be backported, since I only have two extremely minor contributions before 1.19."
2313159517,insert recursion_check for [damage_type] in the RAII system of recursion guard,newfrenchy83,2025-02-03 16:29:31+00:00,2025-02-03 17:33:14+00:00,"{'Unit Tests': 1, 'Units': 1, 'WFL': 1}","
the goal is to extend the check to has_attack but also to formulas.

I know I already proposed a variation but this time I use recursion_guard instead of creating a duplicate of the class for check_recursion."
2311949537,Update android dockerfile,babaissarkar,2025-02-03 07:37:32+00:00,2025-02-03 15:50:06+00:00,{'Android': 1},"Updates the dockerfile introduced in https://github.com/wesnoth/wesnoth/commit/7be779226514fb95df44b5635260e8e8d88288de.

1. Removes installation of dependency libraries via apt, they are downloaded and built from source during build.
2. Sets some environment variables"
2311398162,Balance Arcane for 1.20 + Miscellaneous,danielemurgioni,2025-02-02 20:25:43+00:00,,"{'Units': 1, 'Squash': 1}","My revision of [What is Arcane](https://forums.wesnoth.org/viewtopic.php?t=58949) proposal.

Changed Arcane Resistances of **movement types**: gruefoot, flamefly, drakefly/foot, smallfoot, orcishfoot, largefoot, armoredfoot, elusivefoot, dune(elusive/armored)foot, mounted, treefolk, lizard, scuttlefoot.

**- Arcane Changes**

Undeads: -40% Arcane
Skeletal Dragon: -30% Arcane
Drakes: -30% Arcane
Fire Wisps: -30% Arcane
Wose: -30% Arcane
Mudclawers: -30% Arcane
Trolls: -20% Arcane
Great Icemonax: -10% Arcane
Frost Stoat: -10% Arcane
White Horse: -10% Arcane
Dark Horse: -10% Arcane
Raven Harbringer/Omen: 0% Arcane
Rock/Giant Scorpion/Scorpling: +10% Arcane
Orcs/Goblins: +10% Arcane (conseguential changes to Northeners Faction if approved)
Humans/Dunefolks on horse: +10% Arcane
Dread Bat: +20% Arcane
Saurians: +20% Arcane
Humans/Dunefolks: +20% Arcane
Paladin: +40% Arcane, from 9x5 melee Arcane to 8x5 melee Arcane
Mage of Light: from 12x3 ranged Arcane to 11x3 ranged Arcane
Mermaid Diviner: from 8x4 ranged Arcane to 7x4 ranged Arcane
Dark Sorcerer: from 9x2 ranged Arcane to 10x2 ranged Arcane
Elvish Enchantress: from 11x4 ranged Arcane to 10x4 ranged Arcane
Elvish Sylph: from 13x5 ranged Arcane to 10x5 ranged Arcane

**- Misc Changes**

Elvish Enchantress: from 180xp to 190xp
Sand Scuttler/Scamperer: impact from +70% to +40%, fire from -100% to -40%, arcane from -50% to -20%"
2311302891,[Units] Dune Paragon redesign to avoid RIPLIB and ensure consistency with Blademaster,ForestDragon-wesnoth,2025-02-02 16:00:59+00:00,2025-02-13 08:03:28+00:00,{'Units': 1},"I noticed that the 1.18/1.19 Dune Paragon currently has major inconsistencies with the Dune Blademaster - the latter has 15x3 melee without marksman, and 18x2 melee with marksman, while Paragon has 13x4 marksman. Considering the Paragon is an macro-locked advancement for Blademaster, it is a major RIPLIB violation. The 13x4 marksman attack seems to be identical to the 1.14 version, and even has an identical name/icon. Another telltale sign of imperfect copying of old stats is the 11x3 pommel attack, losing 1.14's slow special without any buffs to compensate such a massive nerf. Therefore, I am making this PR to make the Dune Paragon's design consistent with the new 1.16+ dunefolk redesign, and slightly more powerful overall to make him better compete with other level 4 units.

What this PR does:
the 13x4 marksman attack is turned into 15x4 without marksman
NEW ATTACK: sword 25x2 marksman
~~pommel strike buffed from 11x3 to 14x3 and gains the stun special (suggested by lhybrideur/Dalas)~~
longsword renamed to scimitar, icon adjusted accordingly

EDIT: stun has been removed from the scope of the PR for now"
2310985027,flatpak boost upgrade,Pentarctagon,2025-02-01 22:40:49+00:00,2025-02-02 04:45:30+00:00,{'Packaging': 1},
2310938896,SotBE: add snow weather sfx to selected scenarios,knyghtmare,2025-02-01 20:55:56+00:00,2025-02-09 15:33:54+00:00,"{'Enhancement': 1, 'Campaign SotBE': 1}",The only excluded one is S16: The Coward as it takes place during the first days of Spring.
2310925138,Add snow to HttT S12,Gothyoba,2025-02-01 20:22:21+00:00,,{'Campaign HttT': 1},"Adds snow to S12 (Northern Winter) of HttT, since it is already canonically supposed to snow here and it makes sence for the scenario.

@Dalas121 Needs review"
2310924291,Add snow to THoT S4,Gothyoba,2025-02-01 20:20:12+00:00,,{'Campaign THoT': 1},"Added snow (same as in TSG) to THoT S4 (High Pass), since the scenario is on a snowy mountain where I think it would fit.

@Dalas121 Needs review"
2310918667,THoT S3 Map: Aesthetic Revision,Gothyoba,2025-02-01 20:04:38+00:00,2025-02-04 09:19:54+00:00,{'Campaign THoT': 1},"Accidentally deleted the branch for the last one (#9815). This passed checks the last time and was approved by knyghtmare and Dalas, so this can be merged I think.

(Not sure why this passed map diff check the last time but not this time)"
2310613401,canvas: add a `parse_text_as_formula` key to `[text]`,babaissarkar,2025-02-01 07:34:47+00:00,2025-02-03 01:55:42+00:00,"{'UI': 1, 'Help': 1, 'Schema': 1}","Resolves #9822.

This key toggles parsing of `text` key as formula or not. Default: true."
2310559064,Android patches and CI,babaissarkar,2025-02-01 05:37:32+00:00,2025-02-20 16:06:39+00:00,"{'Lua API': 1, 'Building': 1, 'Packaging': 1, 'SCons': 1, 'Android': 1}",Further Android patches and CI.
2309978011,SotBE: refine map for S16,knyghtmare,2025-01-31 20:26:24+00:00,2025-02-01 10:01:09+00:00,"{'Enhancement': 1, 'Campaign SotBE': 1}",nothing related to scenario balance has changed. Purely aesthetic refinements.
2307415764,tests: call set_main_thread,babaissarkar,2025-01-30 17:41:26+00:00,2025-01-31 02:05:11+00:00,{'Unit Tests': 1},Attempt to fix CI failure from https://github.com/wesnoth/wesnoth/commit/c9b54a5edacac369310d2c32f2a6b0986cdeca86.
2307327341,EI: add macro for multiracial messages,Thewodoros,2025-01-30 16:54:03+00:00,2025-02-03 16:52:41+00:00,{'Campaign EI': 1},"Fixes #9816

It displays message depending on the race of the unit. Dwarves, ogres, and undead use their own custom messages, the rest use the default one.

Optional arguments allow changing the speaker and the image. By default, narrator speaks for the undead, other units speak themselves.

Another optional argument is for the sound (same for all races).

This new macro is used for messages in scenarios 8 and 9, with placeholder messages to be filled in later commit."
2305948997,Add queue-like functionality to the multiplayer lobby,Pentarctagon,2025-01-30 03:08:45+00:00,2025-03-16 17:49:10+00:00,"{'MP': 1, 'UI': 1, 'Schema': 1}","This allows defining an [mp_queue] tag which contains [game] tags describing how to show the game in the lobby and what settings the game should use.

Functionally this adds an entry per [game] into the Matchmaking section of the MP lobby:
* If a player clicks Join and there are no previously created games from this ""queue"" that are open, then the server instead responds telling the client to create the game. The game is created directly using the settings defined in its [game] tag, so for the player it looks like they clicked join and then go straight to the MP staging screen.
* If a player clicks Join and there is an open game created from this ""queue"", then the server instead responds telling the client the actual ID of the game to join and the client then joins that game just as if they had clicked Join on a normal game.

---

This is very very very WIP - there are probably at least a couple dozen blocker problems to fix/address, not least of which is that it doesn't actually go directly to the MP staging screen yet (it sets all the settings on the game creation screen but the player still needs to click the Create button). However the core functionality does essentially work (at least locally), so I'm opening this to see if this is a reasonable approach given Wesnoth's client/server architecture or alternatively if it's so flawed that it's not worth spending more time on.

And yes, I know this is not actually a queue. If anyone has an alternative that's both short and descriptive for a regular player, feel free to suggest it."
2304464414,[SotBE] S10: refine objectives flow,knyghtmare,2025-01-29 12:47:16+00:00,2025-02-01 12:18:49+00:00,"{'Enhancement': 1, 'Campaign SotBE': 1}","- updated objectives to the player once Inarix and party arrive on turn 4
- move note part of objective win to notes section. Self-Explanatory
- add bonus objective caption to the saving inarix and her 4 saurians objective"
2302995099,THoT S3 Map: Aesthetic Revision,Gothyoba,2025-01-28 18:43:40+00:00,2025-02-01 20:03:01+00:00,{'Campaign THoT': 1},"Some slight aesthetic revisions to THoT's S3 Map similar to last time. Changes are largely aesthetic involving small additions and embellishments and should not need scenario changes.

Current Map:

![Old-THoT-S3](https://github.com/user-attachments/assets/a3b4a8f6-b1f6-4863-8cc1-6f67ce49f731)

Proposed Map:

![THoT-S3-Rework-1](https://github.com/user-attachments/assets/99bac4a8-3dac-4634-865c-9efa65dcd062)

@Dalas121"
2302410124,advanced prefs: clear list everytime advanced prefs are reloaded.,babaissarkar,2025-01-28 14:19:16+00:00,2025-01-28 21:35:49+00:00,{'UI': 1},"Resolves #9581.

The advanced preference list variable was not being cleared before loading from advanced preferences file."
2302328568,SotBE S7: update map,knyghtmare,2025-01-28 13:46:06+00:00,2025-01-29 07:59:22+00:00,"{'Enhancement': 1, 'Campaign SotBE': 1}",- Just the usual refinements
2301219490,TSG: some S01/S02 tweaks,Dalas121,2025-01-28 02:31:28+00:00,2025-07-04 04:34:14+00:00,"{'Units': 1, 'Campaign TSG': 1}","Following feedback in #9682, I've adjusted the first couple maps of TSG to:
1) remove fences and non-village windmills that might confuse new players
2) reduce immersion-breaking instances where characters talk directly about game mechanics. (e.g. in-universe Deoran has no idea what a ""hitpoint"" is)"
2300181538,revert Unit/Type: drop bar_scaling keys as well,newfrenchy83,2025-01-27 15:28:33+00:00,2025-01-27 16:16:42+00:00,"{'Units': 1, 'Schema': 1}",revert https://github.com/wesnoth/wesnoth/commit/fc8e8eb09e92ef0c2fb1bad216d9ee64f2a3c372#diff-dc56bda7f509dc7a0a91fbd69d289b59257ae33e16556cff72e86598172f788f because scaling keys used in TSG and TDG
2300058960,remove drop bar_scaling keys to TSG and TDG unit_type,newfrenchy83,2025-01-27 14:33:22+00:00,2025-01-27 16:17:20+00:00,"{'Units': 1, 'Campaign TSG': 1, 'Campaign TDG': 1}",fix https://github.com/wesnoth/wesnoth/commit/fc8e8eb09e92ef0c2fb1bad216d9ee64f2a3c372
2299980145,SotBE: S13: refine map,knyghtmare,2025-01-27 13:57:50+00:00,2025-01-27 16:42:51+00:00,"{'Enhancement': 1, 'Campaign SotBE': 1}","SotBE S13 map was last updated 8 years ago, so I did some refinements.
Mostly minor, more snow themed.
Same map size"
2299311797,Enable building wesnothd and campaignd on macos,soliton-,2025-01-27 08:21:28+00:00,2025-01-28 08:38:39+00:00,"{'Add-ons': 1, 'Building': 1, 'CI': 1}",
2298762088,Unit: remove bar scaling overrides,Vultraz,2025-01-26 18:51:41+00:00,2025-01-26 20:19:09+00:00,{'Units': 1},"See #7292, closes #2913. Apparently, this has never worked, and based on discussion in #7292, it's not even particularly useful. Plus, since it was removed from the schema two years ago, has been functionally deprecated since then.

The keys in unit_type remain untouched."
2298756127,Fix [message] with two images.,CelticMinstrel,2025-01-26 18:35:04+00:00,2025-01-26 20:17:30+00:00,{'UI': 1},The fix I proposed in the issue discussion worked just fine.
2298214929,TDG: Improve Translatability ,Dalas121,2025-01-25 16:36:34+00:00,2025-02-09 15:31:17+00:00,"{'Campaign TSG': 1, 'Campaign TDG': 1}","An attempt to improve the translatability of TDG, following lessons learned from #9797

I'm not sure how to handle a fixed-gender character addressing a varying-gender character. Please let me know if the way I've tried to handle it here is incorrect.

EDIT: I accidentally mixed in some changes from my TSG Translatability PR; they're removed now."
2298177548,Improving Wose Shaman (and renaming it Sage Wose),Discontinuum,2025-01-25 14:48:55+00:00,,"{'Units': 1, 'Campaign WoF': 1}","I, @MechanicalDragon963 and @Jonathan-Kelly are improving the Legend of Wesmere campaign and we're gonna introduce Wose Shaman as a playable unit at some point. But the current Wose Shaman in mainline looks pretty weird. Its melee damage decreases in comparison with Wose and its stats look weak-ish overall. Our proposal on how to improve it:

1. Melee 13-2, the same as lvl 1 Wose
2. 3 strikes on the slowing attack so the Shaman can use it more effectively (which is handy considering its slowness)"
2297903385,"Convert hex to new format, closes #9799",ProditorMagnus,2025-01-25 01:56:12+00:00,2025-01-28 18:47:09+00:00,{'AI': 1},closes #9799
2297903353,Fix parameter name re #9799,ProditorMagnus,2025-01-25 01:56:07+00:00,2025-01-25 20:52:51+00:00,{'AI': 1},
2296700114,TDG: Capitalize Queen in Queen Unit Description,Gothyoba,2025-01-24 12:35:14+00:00,2025-01-24 14:06:43+00:00,"{'Units': 1, 'Campaign TDG': 1}","Though generally uncapitalized in Wesnoth, this refers to a unit type and should be capitalized according to the style guide."
2295579229,TSG: Improve Translatability,Dalas121,2025-01-23 22:56:00+00:00,2025-01-25 13:24:06+00:00,{'Campaign TSG': 1},"Some po hints and string changes to make TSG more translatable, as requested by @celerini in #9682. Is this an improvement?"
2295348541,Improve Wose Shaman Description,Gothyoba,2025-01-23 20:38:33+00:00,2025-02-07 22:18:47+00:00,{'Units': 1},"After working on a proposed Sapling description, I decided I might as well work on improving all the wose descriptions."
2295171204,Add Wose Sapling Description,Gothyoba,2025-01-23 18:46:18+00:00,2025-02-07 22:17:11+00:00,{'Units': 1},"Fixes #7685

This issue I created has been lying around for a very long time, so I thought I'd try my best to fix it.

@Dalas121 I believe this should be reviewed by you."
2294448177,TDG: Capitalize Silverback in Unit Description,Gothyoba,2025-01-23 13:02:26+00:00,2025-01-23 19:59:48+00:00,"{'Units': 1, 'Campaign TDG': 1}","https://wiki.wesnoth.org/Typography_Style_Guide

According to the Typography Style Guide, races shouldn’t be capitalized but unit types should be. Silverbacks aren’t a species, and in this case I think this refer to the Unit Type."
2292704980,EI S09: make frostbite affect wild ogres after they are sighted,Thewodoros,2025-01-22 17:00:11+00:00,2025-01-24 01:01:06+00:00,{'Campaign EI': 1},"Fixes #9784

- The first commit simplifies the events for sighting the ogres and introduces `ogres_sighted` variable. No changes in behavior.
- The second commit adds `side 5` ogres to the list of frostbitten units, if `ogres_sighted` is set."
2292545998,Update coordinates for Movrur in THoT S1,Gothyoba,2025-01-22 15:41:14+00:00,2025-01-22 21:03:55+00:00,{'Campaign THoT': 1},"Was supposed to have been changed with the map revision, but was not saved properly."
2291200309,TDG: Minor corrections/revisions,Wedge009,2025-01-22 02:29:07+00:00,2025-01-22 11:14:36+00:00,"{'Units': 1, 'Prose': 1, 'Achievements': 1, 'Campaign TDG': 1}",
2290723730,Move files from data/resources to data/internal,Dalas121,2025-01-21 19:48:54+00:00,2025-01-22 01:50:00+00:00,"{'Campaign EI': 1, 'Campaign TSG': 1, 'Campaign TDG': 1}","""resources"" naming isn't correct - most of these files aren't resources.

Instead, we move the actual resources to data/internal/resources, and the other files to data/internal."
2290700909,"TDG: add to schema, and fix schema issues",Dalas121,2025-01-21 19:33:19+00:00,2025-01-22 01:50:18+00:00,"{'Schema': 1, 'Campaign TDG': 1}","While adding TDG to mainline, I missed adding it to the schema. As a result, a lot of issues went unnoticed.

This PR adds TDG to the schema, and fixes the various discovered errors. This PR also updates the schema to reflect the engine supporting multiple [filter] tags in events, and to reflect the engine supporting [change_theme] without keys."
2290491767,EI S09: make all ogres immune to frostbite,Thewodoros,2025-01-21 17:21:13+00:00,2025-01-21 17:59:15+00:00,{'Campaign EI': 1},Fixes #9784
2290413000,THoT S1 Map: Aesthetic Revision,Gothyoba,2025-01-21 16:38:55+00:00,2025-01-21 18:42:03+00:00,{'Campaign THoT': 1},"A few largely aesthetic changes to the THoT S1 map that should not require rebalancing the scenario. The Dwarvish keep has been places in a cave. A comment in the scenario file would suggest it was intemded to be in a cave, but this is not currently visible on the map. Some of the area around the the cave has also been changed to make the cave look better. Some non-underground Dwarvish Villages have been added for more variety, since dwarves are intended to live there as well. A campfire, remains and some deforestation has been added around the orcish camp. The southernmost elvish village has been replaced with an orcish one. Two widnmills have been added, as well as a couple of mushrooms and hills with forest on them. I replaced several coordinates in the scenario file as well, since the map was expanded somewhat to acomodate the new cave.

Proposed map:

![x4](https://github.com/user-attachments/assets/2f547771-4b0b-4155-bc67-3df2305a2c5d)

Current Map:

![Old_THoT_S1_Map](https://github.com/user-attachments/assets/d30a1d59-8ea5-44ab-822d-7eed1ff6aa33)

@Dalas121 I believe you should review this."
2290408565,"Expose [fire_event][data] values to WML variable $data, close #8439",ProditorMagnus,2025-01-21 16:36:29+00:00,2025-01-24 20:57:06+00:00,"{'Unit Tests': 1, 'Lua API': 1}",
2290324736,DM -> TDG translations cleanup,Dalas121,2025-01-21 15:54:41+00:00,2025-02-09 13:48:36+00:00,"{'WML Tools': 1, 'Achievements': 1, 'Campaign TDG': 1}","@stevecotton, does this look correct? I've replaced all occurrences I could find of Delfadors_Memoirs (except in po/pot files, which AFAIK shouldn't be deleted right now?)"
2290276100,help: readd HttT,babaissarkar,2025-01-21 15:31:56+00:00,2025-01-22 08:50:14+00:00,{'Help': 1},Unjustifiably removed on #9767.
2290222614,TDG: add help-message explaining that campaigns are developed by different authors,Dalas121,2025-01-21 15:07:41+00:00,2025-01-22 01:51:44+00:00,{'Campaign TDG': 1},"TDG's spellcasting isn't a core mechanic, and isn't reused in any other campaigns. Additionally, gameplay style varies significantly between mainline campaigns. Explain this here.

Suggested by @babaissarkar in #9767
"
2289771586,"For translation stats, TSG is now the tutorial",stevecotton,2025-01-21 11:49:18+00:00,2025-01-24 15:43:09+00:00,"{'Translations': 1, 'Campaign TSG': 1, 'Campaign Tutorial': 1}","For working out which languages have 80% of core translated, TSG is now relevant and the old tutorial isn't. This means that the 80% threshold has increased by around 500 strings.

Add missing changelog entries for 1.19.8 directly to the changelog. (Although I'm using the changelog_entries mechanism for the 1.19.9 change, there shouldn't be any danger of merge conflicts for the 1.19.8 part.)"
2289404292,lua: expose rich_label link handling mechanism,babaissarkar,2025-01-21 09:22:26+00:00,2025-01-23 03:44:55+00:00,"{'UI': 1, 'Lua API': 1}","Exposes Rich Label's `register_link_callback` function as the lua `on_link_click` setter. The function set to this will be called with the target of the clicked link.

Resolves #9124.

**Example:**
If you have a rich_label with id `test` in your dialog, say inside a grid like this:
```ini
[row]
    [column]
        horizontal_alignment = ""left""
        [rich_label]
            id = ""test""
            label = _ ""<b>Link: </b><ref dst='..units'>Units</ref>""
        [/rich_label]
    [/column]
    [column]
        [spacer]
        [/spacer]
    [/column]
[/row]
```
then you can use it like this inside your `preshow` function:
```lua
local test = dialog:find(""test"")
test.on_link_click = function(dest)
    gui.alert(dest)
    gui.show_help(dest)
end
```"
2289363202,Build the PO files for wesnoth-tdg,stevecotton,2025-01-21 09:05:39+00:00,2025-01-21 11:04:26+00:00,"{'Translations': 1, 'Building': 1, 'Campaign TDG': 1}","Many of the CI builds expect the .po files to already exist, and fail without them.
    
For SCons builds, the .pot file needs to exist, because po/SConscript uses the existing files to find out which textdomains it needs to update.
    
It was already added for CMake, but keeping the list in alphabetical order makes maintenance easier."
2288995491,TSG: Various small corrections and revisions,Wedge009,2025-01-21 05:36:46+00:00,2025-01-21 21:52:45+00:00,"{'Prose': 1, 'Campaign TSG': 1}","@Dalas121 Hopefully everything should make sense. Just a few comments:
* I think I must have mixed up the 'at range / in range' line references in my original review. The way I've changed it here sounds right to me.
* I'm guessing that line spacer wasn't meant to be translated.
* Line about healing should either be singular, 'a healer like me _or_ Ethiliel' or plural, '_healers_ like me and Ethiliel'.
* It's trivial, I know, but I really think double question marks and double exclamation marks are non-standard and distracting. Happy for those to be reverted if you feel strongly enough, however.
* In this context, classic and traditional mean the same thing to me so I found it redundant to call AToTB both.
* With respect to another instance of 'ironman' - I'm not sure what you'd prefer to rephrase it as, so feel free to edit that change or suggest something else, as you see fit."
2288820637,EI Final Battle: Em-dashes,Wedge009,2025-01-21 02:18:38+00:00,2025-01-21 14:00:12+00:00,"{'Prose': 1, 'Campaign EI': 1}",
2288808500,Encyclopedia: Corrections following #9253,Wedge009,2025-01-21 02:01:34+00:00,2025-01-21 14:00:59+00:00,"{'Prose': 1, 'Help': 1}",
2288327742,Keep gameplay help page up to date with new tutorial,Gothyoba,2025-01-20 17:38:09+00:00,2025-01-21 02:02:55+00:00,{'Help': 1},Replaces mentions of the old tutorial with TSG in the help page and changes the recommended begginer campaigns to TDG or AToTB. There’s also some slight wording changes.
2287954790,Revert change in recommended next campaign in old tutorial,Gothyoba,2025-01-20 15:34:29+00:00,2025-01-20 19:37:09+00:00,{'Campaign Tutorial': 1},"TSG is now the easier than AToTB and the recommend3d first campaign before even the old tutorial (now not recommended for new players), so it seems reasonable to revert my earlier change and recommend TSG instead."
2286314383,EI S09: improve frostbite event,Thewodoros,2025-01-19 18:10:53+00:00,2025-01-19 19:31:13+00:00,{'Campaign EI': 1},"The main purpose of this PR is to fix a minor bug: it was always Gweddry who said ""Brrrr, I can’t feel my fingers..."" between turns 1 and 2, even if he drank Hahid's elixir on turn 1 and became resistant to cold.

In the current code the speaker depends on the order the units are stored into the array (which, AFAIK, is not guaranteed to stay the same in future versions of the game). So I think it's better to fix the speaker to either Gweddry, or Owaec if Gweddry takes the elixir. The other speakers seem less suitable:

- Dolburras and Grug speak other dialects, they shouldn't suddenly start speaking proper Wesnothish.
- Dacyn is unlikely to complain about cold because he visited this area before, and it was him who dragged everyone here in the first place.
- Terraent seems pretty stoic in general.
- Addogin has his own separate complaining message in this event.
- Hahid would complain, but his message should have his own Dunefolk specific flavor (it can simply be added into this event next to Addogin's).

Note that the former `explain frostbite` is now `turn 1 end`, and according to [wiki](https://wiki.wesnoth.org/Eventwml#side_turn_end) it fires after all other end-turn events. That means the message appears after the harming animations for all units began, but while they still play. Before, the message appeared after the harming animation of one unit, and the harming animations of other units played after the message is closed. This is a small change in behavior, but I actually like the new version better - it makes it clearer that the frostbite affects all you units.

Also I've changed event names so they reflect the logic better (no changes in behavior):

- For the main frostbite event: from `side 5 turn end` to `turn end`, so it's clearer that it happens after all sides' turns, and has nothing to do with side 5 specifically.
- For the nested event: from `turn refresh` to `side 1 turn refresh`, so it's clearer that it affects side 1 only."
2286152766,Change display name of Old Tutorial Achievement Group,Gothyoba,2025-01-19 10:51:36+00:00,2025-01-19 15:18:20+00:00,"{'Achievements': 1, 'Campaign Tutorial': 1}",Changed from Tutorial to Old Tutorial given the TSG Rework.
2286037532,Refactor unit bar drawing,Vultraz,2025-01-19 05:15:32+00:00,2025-01-21 06:04:51+00:00,"{'Graphics': 1, 'Units': 1}","This fixes an issue where the bar borders would always be one pixel wide, regardless of the zoom level or game render scaling which made the bars stand out badly amongst the pixel art. This brings us closer to the old look from the surface-drawn days.

This is also an experiment with using normalized, fractional coordinates for rendering instead of absolute screen coordinates. I'd like to take this approach in more places, so this is a good proof of concept.

<img width=""509"" alt=""image"" src=""https://github.com/user-attachments/assets/ff01d24f-b5d8-490f-bec3-cbdf3046f68a"" />
"
2285801383,EI S06a: improve Hahid's eleixir-related messages,Thewodoros,2025-01-18 19:40:05+00:00,2025-01-18 22:08:40+00:00,{'Campaign EI': 1},"I noticed there's some differences between Hahid's dialogue in S06a and S07b:

- In S06a, there's small print saying the elixir is less effective on cavalry. But on testing it doesn't seem to be the case (in both scenarios).
- In S06a, the strike-through text is just ""call"". In S07b, it's ""call now"". The latter seems more readable to me.

So, I copied these two lines from S07b to S06a. "
2285756553,Add UI admin option for changing passphrase,Pentarctagon,2025-01-18 17:35:37+00:00,2025-01-19 15:13:28+00:00,"{'MP': 1, 'UI': 1, 'Add-ons': 1}",also renames some things and fixes the addon admin query again
2285749522,"EI prose, encyclopedia: fix Soradoc and outposts locations",Thewodoros,2025-01-18 17:14:25+00:00,2025-01-18 18:35:47+00:00,{'Campaign EI': 1},"On the title screen map, Soradoc seems to be the same latitude as Tath and Aldril, while Carcyn and Elensefar are even further north. Soradoc being the ""northernmost outpost"" seems to be a holdover from the early geography outline.

Also, as of EI years (which is the only current mainline campaign featuring Soradoc), there are settlements east of Weldyn river, so calling Soradoc an ""outpost"" seems wrong. Also, its description in EI S06b is:

> Established by the Crown and administered by the Horse Clans, Soradoc controlled the strategic confluence of the Great River and the River Weldyn. Since its founding in the early days of Wesnoth, it had grown into a prosperous and well-fortified border **town**.

As for location of the EI outposts, according to EI campaign map, the Northern Outpost is close to Soradoc and almost due east of it; the Southern outpost is much farther and almost due south of it. Describing them as being ""east of Soradoc"" seems more natural. The outposts being south of Soradoc seems to be a holdover from the earlier map when they and Soradoc were on the same (western) bank of Weldyn river (see my earlier PR ##9578)."
2284549330,Warn against old tutorial in description,Gothyoba,2025-01-17 15:23:48+00:00,2025-01-17 23:18:33+00:00,{'Campaign Tutorial': 1},I am aware the title was changed to include Old Tutorial. This is intended to further clarify to players that this tutorial is no longer reccomended fow new players. This is intended to remove contradictions between the title and description to prevent confusion for new players.
2284535935,EI: allow undo if we choose to not pick the item (or elixir),Thewodoros,2025-01-17 15:16:07+00:00,2025-01-17 17:09:13+00:00,{'Campaign EI': 1},"If we select the option to leave the item on the ground, we should be able to undo and move another unit to take it.

I've tested it in S06a with the crystal quiver and the elixir of water breathing, seems to work without any bugs."
2284520258,TSG: use RESOURCE_WEATHER,Dalas121,2025-01-17 15:07:34+00:00,2025-01-17 22:49:37+00:00,"{'Graphics': 1, 'Terrain': 1, 'Campaign EI': 1, 'Campaign TSG': 1}","When TSG was created (and when TSG's PR was created), RESOURCE_WEATHER did not exist. Now that it does, replace TSG's campaign-specific weather with RESOURCE_WEATHER."
2284519970,Fix typo in TSG Comment,Gothyoba,2025-01-17 15:07:25+00:00,2025-01-17 18:33:35+00:00,{'Campaign TSG': 1},becuase -> because
2282375695,texture: use size instead of w/h pair and reduce direct SDL calls,babaissarkar,2025-01-16 17:21:35+00:00,2025-01-17 18:58:02+00:00,{'Graphics': 1},
2282018703,Bump vcpkg baseline,Vultraz,2025-01-16 14:30:37+00:00,2025-01-16 22:51:33+00:00,"{'Backport': 1, 'Windows': 1, 'Building': 1}",CI run
2280893292,EI: remove the rest of unused schedules,Thewodoros,2025-01-16 04:52:50+00:00,2025-01-16 13:30:14+00:00,{'Campaign EI': 1},"Fixes #9748

- Remove `NORTHERN_MIDDAY` time of day which was used by removed `NORTHERN_WINTER_SCHEDULE` (see commit a5a84c4)
- Remove unused `BRAZIER_ILLUMINATION` schedule"
2280554147,(1.18 backport) Switch default Pango/Cairo render backend to Fontconfig on macOS,irydacea,2025-01-16 00:24:56+00:00,2025-01-16 02:11:39+00:00,"{'Backport': 1, 'macOS': 1, 'UI': 1}","This is a backport to 1.18 of PR #9593, which fixes issue #8488."
2278244743,use lambdas instead of rs_base,Pentarctagon,2025-01-15 04:08:37+00:00,2025-01-16 02:14:00+00:00,"{'macOS': 1, 'MP': 1, 'Add-ons': 1, 'Building': 1}",
2275364760,Refactor static const array into string_view,jj-marr,2025-01-13 22:35:13+00:00,2025-02-12 22:56:26+00:00,"{'AI': 1, 'MP': 1, 'Lua API': 1}","In scenarios where a static const array of char is used for a string constant, refactors to a static constexpr std::string_view. This has the same effect of making it a compile-time string, except that it no longer implicitly decays to a char pointer (necessitating the use of the .data() member function).

Partially addresses #9743 ."
2275079078,Partially implement misc-const-correctness,jj-marr,2025-01-13 20:26:58+00:00,2025-01-14 15:57:28+00:00,"{'AI': 1, 'MP': 1, 'UI': 1, 'Editor': 1, 'Units': 1, 'Lua API': 1, 'Add-ons': 1, 'WFL': 1, 'Help': 1, 'Schema': 1, 'Terrain': 1, 'Achievements': 1}","#9617 is tricky due to having to deal with macros that define variables that are sometimes used in a const manner and sometimes not. While I'm trying to resolve this, the main Wesnoth codebase keeps changing and causing merge conflicts. This PR factors out some of the simpler changes from #9617 to reduce the merge conflict burden later on."
2274025611,THoT: remove duplicate macro,knyghtmare,2025-01-13 14:38:43+00:00,2025-01-13 22:08:52+00:00,{'Campaign THoT': 1},The macro `CHARACTER_STATS_ANGARTHING` was defined. twice.
2274006271,"DiD, EI, NR: replace ""ken"" with ""can"" in dwarf speech",Thewodoros,2025-01-13 14:32:08+00:00,2025-01-13 15:46:19+00:00,"{'Campaign DiD': 1, 'Campaign EI': 1, 'Campaign NR': 1}","Use ""ken"" only for ""know"" or ""see"" meanings, not for ""can"" meaning.

Fixes #9731"
2273664735,EI S08: mention invasion force instead of just undead,Thewodoros,2025-01-13 12:03:13+00:00,2025-01-13 15:44:55+00:00,{'Campaign EI': 1},Fixes #9732
2273642547,EI S08: replace mention of Ulrek with Relgorn,Thewodoros,2025-01-13 11:52:00+00:00,2025-01-13 15:45:39+00:00,{'Campaign EI': 1},"Fixes #9730

I think we don't need to mention prince Konrad (HttT) because:

1. Players may confuse him with the current king Konrad II.
2. Delfador made a greater impression on dwarves with his magic, they remember him better than the prince."
2272553601,UtBS S01: make Kaleh's dialog a bit more emotional,babaissarkar,2025-01-12 14:41:11+00:00,2025-01-12 19:56:32+00:00,"{'Prose': 1, 'Campaign UtBS': 1}",Adds a couple of exclamation marks to better emphasize Kaleh's shock.
2272453286,"EI S08: fix bug, code improvements",Thewodoros,2025-01-12 09:55:28+00:00,2025-01-13 01:30:03+00:00,{'Campaign EI': 1},"Explanation by commit:

### Commit 1

`po` comments mentioned saurians. Side 5 is actually nagas.

### Commit 2

`po` comments mentioned that Whitefang orcs attacked Tath in the beginning of DiD. It was actually Parthyn.

### Commit 3

Prevent the Dolburras - Pelanthsil task from starting if Pelanthsil is dead. He can't actually be reached by enemies at that point (turn 2), but this makes the event more error-proof in case of future scenario changes.

### Commit 4

Fix a bug: the Dolburras - Pelanthsil task stays in the objective list even if one of them is killed.

### Commit 5

According to https://wiki.wesnoth.org/DirectActionsWML , keys like `bonus` in `[endlevel]` are not used if the result is `defeat`, so I remove it. No behavior changes.

### Commit 6

Minor improvement: if we choose to replay the level from the options, the defeat message seems odd, so I remove it in that case."
2272396823,celes theme: listbox header definition,babaissarkar,2025-01-12 06:28:17+00:00,2025-01-12 08:39:31+00:00,"{'Graphics': 1, 'UI': 1}","CI Run

**Before:**
![Screenshot from 2025-01-12 11-48-08](https://github.com/user-attachments/assets/7fbbd01e-0908-4943-b461-892fdc2a098b)

**After:**
![Screenshot from 2025-01-12 11-47-30](https://github.com/user-attachments/assets/bcfe41b7-5729-42d5-a59c-a9afbc3cc58a)
"
2272316490,Improve Resources: use_stronger_amlas and resource_weather,Dalas121,2025-01-12 00:46:38+00:00,2025-01-14 20:41:03+00:00,"{'WML': 1, 'Campaign EI': 1}","----1:
Previously, use_stronger_amlas added extra AMLAs to units that match a certain filter. If units didn't match the filter when they were placed, but did later-on, they still wouldn't be eligible for AMLAs.

Fix that here, by giving the AMLAs to all units, and applying the filter inside each [advancement] instead.

To make this work, I also needed to change AMLAs back into a macro.

----2:
[terrain_graphics] cannot be assigned or modified mid-scenario, but can be filtered by ToD.

To dynamically modify weather mid-scenario (such as in TSG), use these special ""noweather"" ToDs."
2272177288,"The Deceiver's Gambit: add TDG to mainline, replacing DM",Dalas121,2025-01-11 18:00:19+00:00,2025-01-20 17:22:46+00:00,"{'Graphics': 1, 'Audio': 1, 'Translations': 1, 'Units': 1, 'Achievements': 1, 'Campaign DM': 1}","Around two years ago Yumi asked me to create TDG as a replacement for Delfador's Memoirs, and gave me a rough script - the campaign covers Delfador's youth and Eldred's betrayal of Garard. Its gameplay includes a spellcasting mechanic for Delfador.

After this, I don't plan to drastically alter canon (like #9682) nor outright replace any campaigns (like this PR); TSG and TDG are a bit of a holdover from Yumi. DM has redeeming qualities, but it's a poor campaign - it was rated lower than every other mainline campaign in Hejnewar's recent community survey.

I plan to make some small tweaks to Liberty and HttT as well, to maintain continuity with TDG. For example, in L Maddock mentions ""_the majority of my forces are still returning from the battle of Abez_"" - but in TDG he refuses to send troops in the first place. That'll be a different PR sometime later."
2270974831,Move Weather effects into a separate resource,Dalas121,2025-01-10 17:35:52+00:00,2025-01-11 01:52:42+00:00,"{'Graphics': 1, 'Audio': 1}","These weather effects are used TSG, TDG, and other WIP campaign revisions. Duplicating them across each campaign seems pointless, so I've moved them into a resource here, following the precedent set by #9669.

Once this passes checks, is approved, and is merged, I'll modify my TSG PR #9682 to use this resource instead of duplicating the files.

Right now, there's a serious issue where the game suffers extreme lag and appears to freeze when loading some of these effects. I think this is an issue with a recent change, as such effects previously worked fine even in 1.19 (and as far as I can tell still do in 1.18). Will appreciate anyone with insight into the problem. As an example, this works fine:
```
[terrain_graphics]
    [tile]
        x,y=0,0
    [/tile]
    [image]
        layer=1
        name=rain/rain-1.png:80
    [/image]
[/terrain_graphics]
```
This freezes Wesnoth for so long that Windows thinks it's crashed:
```
[terrain_graphics]
    [tile]
        x,y=0,0
    [/tile]
    [image]
        layer=1
        name=rain/rain-1.png:80,rain/rain-2.png:80
    [/image]
[/terrain_graphics]
```

"
2270075140,EI S07b: fix contradiction about Plague Staff origins,Thewodoros,2025-01-10 09:33:42+00:00,2025-01-10 13:24:57+00:00,{'Campaign EI': 1},"Fixes #9709.

@Dalas121 , I tried to make it clear that that happened ""behind the scenes"", but you can edit that message more if you see fit."
2270024962,EI: remove death events for heroes before they join,Thewodoros,2025-01-10 09:06:33+00:00,2025-01-10 12:07:21+00:00,{'Campaign EI': 1},"This is a cleanup of unused events, no changes in behavior. Remove HERODEATH_* macros for heroes who have not appeared in the campaign yet. Also edit a comment to only mention the heroes who could have appeared in the campaign by that point.

FYI the heroes in question first appear:
- S05 - Owaec
- S06a - Dolburras
- S07b - Grug
- S13 - Gaennell (she also has a small appearance in S01, but can't join the player yet)"
2269728296,"EI S07b: fix bugs, code improvements",Thewodoros,2025-01-10 05:22:35+00:00,2025-01-10 15:39:37+00:00,{'Campaign EI': 1},"Explanation by commit.

# Commit 1

Fix a minor bug: the `SCROLL_TO` macro didn't work.

That's because it resolves to a `[scroll_to]` tag, which uses the [StandardLocationFilter](https://wiki.wesnoth.org/StandardLocationFilter) - so it can't match a location with coordinates outside of the map borders.

So I replace it with `[scroll_to_unit]` to Grug.

# Commit 2

By using the nested events, we can achieve the same effect (limiting undead moves on their first turn after appearing) without using variables. No changes in behavior.

# Commits 3 - 6

These commits improve the code for enemy leaders' deaths. No changes in behavior.

## Commit 3

Izziasch had two `last breath`, and the results (whether we get achievements or not) depended on the order they execute. While the events are [guaranteed](https://wiki.wesnoth.org/EventWML#priority) to fire in the order they are added to the scenario, that also means the code will be broken if someone changes the event order in the future. To avoid this, I moved incrementing the counter for Izziasch into her own event, and left the other event for undead leaders only.

## Commit 4

I split `last breath` and `die` events for Izziasch to avoid using manual kill (as I mentioned in #9700 commit 4, this is a less error-prone way).

## Commit 5

I replace `last breath` event with `die` for incrementing the counter for undead leaders. First, they already have `last breath` events imported through the `ENEMYDEATH_SORADOC` macro. Second, it seems that it's best to use the `last breath` events only for the unit's last messages, and put more complicated code into the `die` events.

## Commit 6

This `saved_Garnad` variable is not mentioned anywhere else, so no need to clear it.

# Commit 7

Fix a bug with ending the scenario on turn limit. After the undead appear from the northwestern swamp behind Izziasch's castle, the AI's sides still have their turns to play, and these new undead units can actually kill Izziasch, ending the scenario with victory for us, which I believe was not the intention.

That's because firing `time over` event manually doesn't actually end the level automatically, and this event had no `[endlevel]` tag inside it.

I previously mentioned this place as problematic in #9707 commit 6. I fix it the same way as there, by joining the events and inserting the `[endlevel]` tag. "
2269699983,GUI2/Units Dialog: simplify the column generator code,Vultraz,2025-01-10 04:56:12+00:00,2025-01-10 07:01:58+00:00,{'UI': 1},
2268527469,image_icon rendering adjustments,babaissarkar,2025-01-09 14:21:59+00:00,2025-01-14 06:54:58+00:00,"{'UI': 1, 'Units': 1}","1. Fire and Skeletal Dragon's image_icon is now cropped to 144x144px instead of 160x160px value, since image_icon is supposed to be used in places that have either 72x72px or 144x144px drawing area. This avoids non-integral scaling.
2. Units Dialog scaling moved to cfg, since it's easier to change without compiling.

Additionally, the `image_icon` documentation in [the wiki page for Unit Type WML](https://wiki.wesnoth.org/UnitTypeWML) will be adjusted based on this PR. Namely, the `image_icon`s are recommended to have dimensions that are integral multiples of 72x72 (such as 72x72 or 144x144) since the Unit Preview Panel has a `[drawing]` which is 144x144px. The list in recruit/create dialog is now 72x72px, so the recommended values will avoid non-integral scaling.

![Screenshot from 2025-01-13 18-58-59](https://github.com/user-attachments/assets/72a3af28-8ef6-4d54-84e1-7c1993ba987b)

(Related: #9701 and #9702)"
2265114834,"EI S06b: fix a couple of small bugs, code improvements",Thewodoros,2025-01-08 03:45:17+00:00,2025-01-08 12:35:54+00:00,{'Campaign EI': 1},"I'll explain them by commit.

## Commit 1

Write the event for moving one unit next to another in a simpler way. No behavior changes.

## Commit 2

The `meet_yannic` custom event can be fired from two other events, and one of them (Owaec moves next to Yannic) already guarantees that Yannic is alive. For another event (3 enemy leaders killed) we should check, so I moved the condition into that event. I think it makes the code more readable. No behavior changes.

## Commit 3

Fix a minor bug: Owaec's ""eulogy"" message for Yannic didn't appear even after they met. That's because the event used wrong variable: `saved_yannic` (which doesn't appear anywhere else) instead of `met_yannic`.

## Commit 4

Fix another bug: the message from the unit who reached the exit marker didn't appear because the engine doesn't understand reverse integer ranges.

To be precise, such ""ranges"" (""4-3"" or ""2-0"") only match their first number. So, the messages appeared if there were 4 or 2 enemy leaders left, but didn't appear if there were 3, 1, or 0.

## Commit 5

This event wins the scenario, no need to declare it repeatable. No behavior changes.

## Commit 6

It's no need to make the `side 1 turn {SCENARIO_TURN_LIMIT} end` event to fire the `time over` event. All that code may reside inside the former event; that's how it's done in most scenarios in this campaign.

Also, killing Dacyn triggers the defeat anyway, so no need to trigger in manually.

No behavior changes.

The issue with firing `time over` manually is also present in S07b and S13, I'll fix that when I reach them."
2263234314,EI S07a: init counter variables in prestart,Thewodoros,2025-01-07 07:37:26+00:00,2025-01-07 13:18:34+00:00,{'Campaign EI': 1},"This is a small code improvement, without changes in behavior.
If we initialize these cyclic counter variables in the `prestart` event, then we don't need to check for their existence every time.
Also, to preserve the message order, increment the counters after use rather than before."
2260782901,units dialog (recruit): use image_icon instead of image,babaissarkar,2025-01-05 15:15:51+00:00,2025-01-06 02:19:18+00:00,"{'Enhancement': 1, 'UI': 1}","Resolves #9701.

As already mentioned on #9701, the `image_icon` property is documented but not used. This updated the units dialog (recruit configuration) to use it if available and fallback to `image` if necessary. The image will be scaled to 72x72px if bigger.

Quoting from [UnitTypeWML](https://wiki.wesnoth.org/UnitTypeWML#Unit_Type) wiki page:
> **image_icon**: sets the image used to represent the unit in areas such as the attack dialog and the unit image box in the sidebar. [~CROP](https://wiki.wesnoth.org/ImagePathFunctions#Crop_Function) function can be useful here. You can see Loyalists Paladin as an example.
"
2260693538,EI S06a: improve death and endlevel events,Thewodoros,2025-01-05 10:34:53+00:00,2025-01-05 14:53:21+00:00,{'Campaign EI': 1},"This PR fixes several issues with death- and endlevel- related events in this scenario. It's easier to explain commit-by-commit. Sorry that they are in a bit of a haphazard order.

# Commit 1

It fixes a simple bug: if we rescue Dolburras and then he dies, the objectives are shown. But objectives don't change at this moment, so it's unneeded.

# Commit 2

This is a small code simplification, without changes in behavior. The repeatable `die` event has only one action - to fire the non-repeatable `undead_retreat` event (which isn't fired anywhere else). So we can merge them into one non-repeatable event.

# Commit 3

This one fixes the bug which happens when Mal-un-Karad himself is the unit whose death triggers the retreat event (by dropping the side 2 unit count below the difficulty-dependent threshold). In a real game this is unlikely to happen unless you specifically try to do so. The problem is, he says his message even though his death animation has already played and his corpse disappeared from the hex. In https://wiki.wesnoth.org/EventWML#die it says

> Note: The primary unit is not removed from the game until the end of this event. The primary unit can still be manipulated, will block other units from taking its hex, and will still be found by standard unit filters (except [have_unit]). To prevent this behavior, you can use [kill] to remove the unit immediately. However, this will stop any (still unfired) other events that also match the unit from firing afterwards, so use with caution.

The actions of this event are the message (should not happen in this case), changes in recruit list (don't matter after the leader is dead), and changes in AI retreating back to castle. I thought whether the AI changes should happen in this case or not, and I think they're not:

1. Without the leader there's no one to order the retreat.
2. It doesn't make sense for undead to rush back to guard a leaderless castle.
3. It's not nice to the player if the enemy behavior changes without any message or logical explanation.

The `have_unit` filter I added only matches units with greater than zero HP, so it won't match in the Mal-un-Karad's own `die` event.

# Commit 4

This one requires a longer explanation. I noticed that if you either

- kill Dolburras with `Shift-K` on the first turn
- or use `:unit hitpoints=1` on him on the first turn so he drowns after you end the turn

both this scenarios trigger the undead retreat event, which is weird (it's triggered by side 2 deaths, and Dolburras is side 4).

I ended up adding the following debug code (not included in PR commits) to see which events are triggered:

```
[event]
    name=last_breath
    first_time_only=no
    [message]
        speaker=narrator
        message=_""last breath | id = $unit.id | side = $unit.side""
    [/message]
[/event]
[event]
    name=die
    first_time_only=no
    [message]
        speaker=narrator
        message=_""die | id = $unit.id | side = $unit.side""
    [/message]
[/event]
```

In both cases, this showed the following messages:

```
last breath | id = Dolburras | side = 4
last breath | id = Dolburras | side = 4
die | id = Dolburras | side = 4
die | id = Walking Corpse-441 | side = 2
```

So what I think happens is:

1. Dolburras's `last_breath` is triggered normally.
2. Within it, the action `{KILL id=Dolburras ANIMATE=yes FIRE_EVENT=yes}` fires Dolburras's `last_breath` and `die` event once again. But because out custom `last_breath` is non-repeatable, it's already removed from the scenario's event list at that point, so it doesn't fire recursively.
2. Within the same `last_breath`, the action `{GENERIC_UNIT 2 (Walking Corpse) 18 6} {VARIATION dwarf}` creates a new unit at the same coordinates where Dolburras was.
3. After our customized `last_breath` is finished, it triggers the `die` event for a unit currently at the same coordinates - the walking corpse (but doesn't actually kill him). If we change the coordinates where the walking corpse is created, this event still happens, but without a unit bound to it: `die | id =  | side = `

In actual game, this won't cause problems (because creating the walking corpse actually increases the unit count). But it could if the event conditions were different. In any case, this is an error-prone way. So I moved the code into Dolburras's `die` event; I also had to remove arguments from `KILL` macro for the animation to be correct.

I've checked other scenarios, and I don't think there's such a bug anywhere else. It requires killing the original unit and replacing it with another at the same coordinates, all inside the `last_breath` event, and that new unit must match at least one of the `die` events present in the scenario. 

# Commit 5

We don't actually need `dolburras_rescued` variable, instead we can check if such a unit exists for side 4. This simplifies the code.

# Commit 6

I've noticed that this scenatio uses a non-standard way to end the level: it calls `[fire_event] name=victory [/fire_event]`, and has the `[endlevel]` tag inside the `victory` event. I switched it back to the standard way as in the rest of the scenarios. There is no change in behavior.

# Commit 7

Fix another simple bug: if we Dolburras drowns and then we kill the jailer, the objectives are shown unnecessarily. I fixed it by changing jailer's `id` when Dolburras drowns. Also, there are two `die` event for the jailer, and it's easier if we to merge them into one.

# Commit 8

Move `last breath` and `die` events next to each other for readability. Also move some code into the `die` event for consistency."
2259528038,fix bug in compilation for gcc,newfrenchy83,2025-01-03 16:50:12+00:00,2025-01-03 17:21:34+00:00,{'UI': 1},fix https://github.com/wesnoth/wesnoth/issues/9697 issue
2258643025,"Markup: doc cleanup, take arguments by string_view when possible",Vultraz,2025-01-03 02:37:59+00:00,2025-01-04 14:31:32+00:00,{},CI run
2257194460,j defrog 1.16,loonycyborg,2025-01-01 20:01:13+00:00,2025-01-01 20:02:46+00:00,"{'AI': 1, 'Docs': 1, 'Graphics': 1, 'MP': 1, 'Translations': 1, 'Unit Tests': 1, 'UI': 1, 'WML Tools': 1, 'Editor': 1, 'Units': 1, 'Lua API': 1, 'Building': 1, 'Packaging': 1, 'Help': 1, 'SCons': 1, 'CMake': 1, 'Input': 1, 'Schema': 1, 'Terrain': 1, 'Campaign AToTB': 1, 'Campaign DM': 1, 'Campaign DW': 1, 'Campaign DiD': 1, 'Campaign EI': 1, 'Campaign HttT': 1, 'Campaign LoW': 1, 'Campaign L': 1, 'Campaign NR': 1, 'Campaign SoF': 1, 'Campaign SotA': 1, 'Campaign SotBE': 1, 'Campaign THoT': 1, 'Campaign TRoW': 1, 'Campaign TSG': 1, 'Campaign Tutorial': 1, 'Campaign UtBS': 1, 'Campaign WC': 1}","- **Update deprecated lua**
- **Fix the deprecation message for {SPECIAL_NOTES}**
- **pofix: 1.14 announcement rules for 1.14.17**
- **Remove all textdomain declarations execpt the first from the test scenario**
- **pot-update and regenerate doc files**
- **Fix change making translatable strings from elsewhere untranslatable**
- **edited out an non-existent textdomain [IoM]**
- **pot and documentation update**
- **Revert ""Fix change making translatable strings from elsewhere untranslatable""**
- **Remove no longer needed HTML escaping.**
- **Specify working cmake version to use on CI.**
- **Update CI branch name configuration value for 1.16.**
- **Print cmake version.**
- **wmllint: added special_note to the translatable keys tuple**
- **wmllint: removed checks for arcane, spirit and defense cap special notes**
- **wmllint: added names to the translatable keys tuple**
- **wmlscope: match level 4 deprecated macros**
- **Added a missing undef for the Sky Hunter's DIVERSION_ANIM_FILTER local macro**
- **gui2/addon_manager: Remove broken untranslatable tooltip**
- **Fix shroud parsing functions**
- **Implement shroud API deprecation wrappers that handle shroud data strings**
- **Fix wml.remove_children**
- **Fix [modify_side]reset_maps|view**
- **WC: Update deprecated uses of get_viewing_side**
- **Add notes to the Windows INSTALL.md instructions.**
- **updated British English translation**
- **updated Portuguese (Brazil) translation**
- **updated Chinese (Traditional) translation**
- **Update deprecated path options**
- **Fix some incorrect deprecation messages**
- **various animations (#5903)**
- **Fix whitespace from 16157e286bce**
- **Add rc file to VS+cmake configuration.**
- **Remove 32-bit specific flag.**
- **Fix an intermittent crash with keyboard input during the load screen**
- **Add deprecation wrappers for math functions removed in Lua 5.4**
- **Call actually existing function**
- **Remove dead code**
- **Fix another deprecation message**
- **Return nil instead of an empty string when indexing beyond the string length**
- **Improve a deprecation message**
- **Lua AI: Fix bug in ai.get_attacks()**
- **updated Bulgarian translation**
- **updated Spanish translation**
- **updated Italian translation**
- **updated Portuguese (Brazil) translation**
- **updated Turkish translation**
- **wmlscope: do not report 'INTERNAL:' macros in the macro reference**
- **wmlscope: allow defining external docstrings for inline macros**
- **wmlscope: document external docstring directive**
- **Say what the error is when a broken .po file stops Wesnoth starting**
- **Add a unit test for wesnoth.current.synced_state**
- **Make failure loading textdomains non-fatal**
- **Fix incorrect default in wesnoth.audio.play**
- **Lua API: Fix crash if passing an out-of-bounds side to wesnoth.interface.end_turn**
- **Lua API: Fix side.side_name = side.side_name changing the side name**
- **Lua API: Fix campaign end text being untranslatable**
- **Update Xcode project**
- **UtBS S8: increase turn limit**
- **Fix Xcode project**
- **Fix custom synced commands not changing the AI game state**
- **updated Turkish translation**
- **updated Russian translation**
- **updated Czech translation**
- **1.16 animation update (#5916)**
- **Add a deprecation message for the Giant Stoat**
- **Lua API: Revive mp_settings.active_mods and mp_settings.era_id**
- **Lua API: Fix extraneous quotes in deprecation messages for attributes**
- **Fix crash when accessing variables from a map generator**
- **Fix wesnoth.schedule.get_time_of_day with a turn number**
- **Update dune explorer image path, closes #5945 (#5946)**
- **Fix a missing detail in saved game serialization**
- **Lua API: Fix some issues with versions**
- **WC: Miscellaneous cleanup**
- **WC: Change it to a campaign so it can use the built-in difficulty selection**
- **WC: Player count is now an option in the settings dialog**
- **WC: Add player count to campaign abbreviation**
- **Fix building with gcc 8.3.**
- **Add a prompt to migrate data from previous versions of wesnoth.**
- **Fixup version.**
- **updated Turkish translation**
- **Update changelog**
- **Update changelog.**
- **pot-update and regenerate doc files**
- **update codeblock for 1.16**
- **1.15.15.**
- **1.15.15+dev.**
- **1.16 - Troll defense animations (#5964)**
- **Tutorial S01: Don't let the first Quintain attack on turn 2**
- ** add the names of the abilities used as weapons in the attack prediction window(UI) for 1.16 (#5951)**
- **Preferences: fixed border sizing in MP section**
- **Wesnothd Connection: time out after 1 minute waiting for handshake**
- **Find other version save dirs in descending order**
- **MP Staging: removed ""Team: "" prefix before team names**
- **MP Join Game: removed ""Team: "" prefix before team name**
- **updated Turkish translation**
- **updated Russian translation**
- **removed ""\v\v"" from translated string**
- **updated Portuguese (Brazil) translation**
- **updated British English translation**
- **updated German translation**
- **updated German translation**
- **Prevents logging of duplicate deprecation messages and messages missing timestamps.**
- **updated German translation**
- **1.16 animation update 7/24 (#5980)**
- **Faction Select: refined design**
- **Faction Select: one more tiny refinement**
- **Revert this for 1.16.1**
- **updated Chinese (Traditional) translation**
- **Copyright update.**
- **Fixup some copyright notices.**
- **Re-add attribution to copyright notices.**
- **Add a script to automatically update the copyright notice in source files.**
- **Tutorial S01: Synchronise the choice of character**
- **SotA: Synchronise the zombie recruitment dialog**
- **updated German translation**
- **updated Russian translation**
- **updated Italian translation**
- **wmllint: removed check for spaces in e-mail addresses**
- **Fix a misplaced doc comment**
- **Lua AI: Fix a typo**
- **Lua API: Fix the deprecation wrappers for place_shroud and remove_shroud**
- **Add unit tests for the Lua shroud functions**
- **Update the shroud unit tests and add a few more for cases new in 1.16**
- **New config methods for getting deprecated attributes or children**
- **Add deprecation messages for the most FormulaAI WML**
- **AI: Fix short goal syntax**
- **Lua API: Fix wesnoth.map.find(filter, unit) ignoring the unit**
- **Lua API: Ensure unit test assertions specify a message string**
- **fix whitespace**
- **[world conquest] add campaign icons, campaign image and credits (#5958)**
- **Use enum in copyright update script.**
- **Missed some deprecated fungus on map edges.**
- **Add a deprecation message for something that has been deprecated since at least 1.14**
- **Tutorial S01: HDPI support**
- **Have add-ons with no min version specified require the latest version.**
- **wmllint: added automatic update of four terrain macros**
- **updated Turkish translation**
- **updated French translation**
- **updated Russian translation**
- **August 8th animations (#6012)**
- **Allow the campaign selection to be bigger on HDPI screens**
- **[world conquest] [1.16] update to new mushroom terrain from the deprecated mushroom terrain (#5960)**
- **Schema update for [era].**
- **Remove duplicate schema attributes.**
- **TSG S8b: reduce difficulty**
- **Put quotes around missing era in case it's blank.**
- **updated Polish translation**
- **updated Czech translation**
- **updated French translation**
- **updated German translation**
- **snow version of the small mountains for castless and chasms**
- **ran woptipng.py**
- **Resolve #6019 - allied side not triggering failure condition when sighted**
- **UtBS S09: Reveal the boss of the scenario at the end of part 1**
- **Update changelog**
- **[world conquest] World Conquest Era is only available for the WC campaign**
- **Update Polish translation credits**
- **When writing WML, output preprocessor-safe strings**
- **Make optional_reference bool conversion explicit**
- **Include deprecation info in preprocess-output-macros file**
- **Include optional arguments in preprocess-output-macros file**
- **fix whitespace**
- **Schema: Add [candidate_action][filter_own]**
- **AI: Fix missing serialization code for sticky candidate actions**
- **Lua: Fix console pretty-print output not showing zero or negative keys in tables**
- **Lua AI: Fix non-integer candidate evaluation scores being treated as 0**
- **AI: Fix assertion when trying to move to an off-map location**
- **Lua API: Fix an incorrect error message**
- **Lua API: Fix an error in the terrain hex API**
- **Lua API: Fix functional.map returning the wrong answer if used on a table that contains numeric keys but is not strictly an array**
- **Update Russian translation credits**
- **Updated my (kabachuha's) entry in the credits**
- **[world conquest] replaced khalifate unit types with dunefolk unit types**
- **updated German translation**
- **updated Finnish translation**
- **updated Indonesian translation**
- **updated Russian translation**
- **updated Turkish translation**
- **pot and documentation update**
- **1.15.16.**
- **1.15.16+dev.**
- **Fixup changelog header.**
- **naga sprite animations (#6027)**
- **WC: End the campaign at the end of the final scenario**
- **UtBS S02: Don't move Nym if she's already adjacent to the bottle**
- **updated German translation**
- **lower isolated pine trees within image**
- **updated British English translation**
- **updated Polish translation**
- **ran woptipng on the forest terrain images**
- **Revert ""When writing WML, output preprocessor-safe strings""**
- **[world conquest] [1.16] [lua] Check for wc2_scenario value before executing wc2_start_units function  (#6053)**
- **Fix an off-by-one in mapgen's x and y filters, and add unit tests**
- **Re-enable WC.**
- **changelog update.**
- **Messenger MAI: fix bug of own units blocking waypoint**
- **Fixup WC schema validation failures.**
- **1.15.17.**
- **1.15.17+dev.**
- **SotBE S13: rebalance scenario**
- **updated Portuguese (Brazil) translation**
- **Expand Wesnoth's README.**
- **WC: Add a WC_ prefix to defines with generic names**
- **Naga Sicarius sprite (#6056)**
- **UtBS S4: reduce difficulty**
- **2p_Aethermaw - fix sprit decorations above fog**
- **1.16 Chasm terrain graphics updates (#6066)**
- **Add doxygen docs to wesnothd's game.hpp. (#6017)**
- **.ogg -> .wav**
- **updated Bulgarian translation**
- **updated Czech translation**
- **updated Portuguese (Brazil) translation**
- **updated Russian translation**
- **updated Czech translation**
- **1.16 sprint - naga stuff (#6076)**
- **Ignore auto-generated Steam file in save directory (#6069)**
- **Use existing macro to avoid situations where Nym's otherwise-mute Dust Devil pet might speak.**
- **Specify a non-zero value for nplayers.**
- **Make the team Eryssa leads (if alive) have consistent colour (resolves #5375)**
- **i18n: Make dsngettext() strip caret annotations from plural forms too**
- **Update changelog**
- **updated Portuguese (Brazil) translation**
- **updated French translation**
- **Clear dehydration status on victory (resolves #5687)**
- **Switch to hard-coded colours instead of relying on pango names (resolves #4348).**
- **Switch to hard-coded colours for formula debugger as well.**
- **Link side-bar unit defence rating to unit's Help page (resolves #1297).**
- **TRoW S22: Remove out-of-turns lose condition. (Resolves #6109)**
- **Fix bug in attack prediction window**
- **TRoW S07: Make sure Lady Jessene is visible**
- **Spanish translation update**
- **LoW S3: fix deprecated WML warning**
- **Spanish translation update**
- **TRoW S12: Always give Lord Typhon a storm trident (#6113)**
- **gui2/core_selection: Allow links to be parsed in core descriptions**
- **gui2/core_selection: Use a more apropos OK label**
- **Spanish translation update**
- **gui2/button: Add definitions for special title screen buttons**
- **gui2/title_screen: Give the Language button its label back**
- **gui2/title_screen: Increase bottom row margins from 0px to 10px**
- **Use parentheses in English language variation names**
- **Changelog**
- **Work-around crash situation caused by using scenario-specific tools in map context (closes #5883)**
- **updated Portuguese (Brazil) translation**
- **updated French translation**
- **updated British English translation**
- **add Burmese to 1.16 LINGUAS files**
- **add Burmese po files (fixed version) to 1.16**
- **Update change log.**
- **Update change log.**
- **gui2: Make dropdown button light source consistent with other buttons**
- **Minor README formatting or content fixes**
- **Last-second naga portraits**
- **Wire in Ophidian portrait**
- **Wire in ophidian portrait**
- **wire in ringcaster portrait**
- **Wire in ringcaster portrait**
- **updated Italian translation**
- **correct translation definition file for Burmese**
- **Remove scaling by zoom_factor in unit height adjustment calculation (resolves #5974).**
- **Display Difficulty as em dash when it is not valid (resolves #5321)**
- **Update change log.**
- **1.16 - terrain graphics variations and transitions (#6078)**
- **pot and documentation update**
- **1.15.18.**
- **1.15.18+dev.**
- **updated Italian translation**
- **Make 100% gold carry-over explicit in objectives (resolves #6131)**
- **Pinnacle rock map label covered during dialog fix**
- **lua: Fix wesnoth.audio.volume always setting the volume to 0**
- **Specify specials mode.**
- **TRoW S8: smoothen naga appearance (fix #6140)**
- **Update British English translation**
- **Remove changes not actually in 1.16 branch just yet.**
- **SoF - S6 - fix #6146 and related side-storing issue causing auto-defeat (#6181)**
- **Update changelog.md**
- **wesnothd: avoid invalid iterator use when terminating game**
- **Fix issue #2926**
- **wesnothd: made ipv6 addresses work with /query status/searchlog**
- **Spanish translation update**
- **Fix color_adjust requiring all keys**
- **Avoid event taking away a village just captured by the player.**
- **updated German translation**
- **updated Portuguese (Brazil) translation**
- **updated Japanese translation**
- **updated Czech translation**
- **fixed changelog for Japanese translation**
- **add missing [special_note] to movetypes**
- **gui2/title_screen: Don't display locale identifiers on the Language button**
- **Update credits**
- **German translation update**
- **German translation: forwardport localized images**
- **Update steamrt docker builds**
- **docker: Compile own openssl for steamrt builds**
- **Error handling for corrupt .mo files (#6214)**
- **desktop/version: Attempt to identify Windows 11 GA**
- **desktop/version: Use release version from DisplayVersion if available**
- **Add 1.16 trailer to credits.**
- **Fixup 1.16 trailer credits.**
- **updated German translation**
- **updated Finnish translation**
- **updated Italian translation**
- **updated Finnish translation credits**
- **For a [message] with options, zero-initialise the default selection int (#6217)**
- **Spanish translation update**
- **Finnish translation update**
- **GUI.pyw: update constant for the 1.16 series**
- **Disable the fast path of [modify_unit] (#6222)**
- **Update changelog**
- **Spanish translation update**
- **wesnothd: exception safety fix**
- **pot and documentation update**
- **wesnothd: Accept 1.16.* versions by default**
- **1.16.0.**
- **1.16.0+dev.**
- **campaignd: Allow more than 3 arguments to setattr**
- **wesnothd: remove catch clause for std::exception**
- **wesnothd: avoid trying to remove destructed players from games during stack unwinding**
- **wesnothd: don't let exceptions stop asio's event loop**
- **MP Staging: fixed weirdness caused by accidentally removing the wrong node (fixes #5648)**
- **GUI2: increased listbox header toggle heights**
- **Revert ""Revert this for 1.16.1""**
- **Made get_dlls.py get dlls for wesnothd too**
- **wesnothd: check for possible null optional in error message**
- **vcpkg: Boost 1.77 necessitates an explicit boost-math dependency**
- **tutorial: Use Delfador's mentoring portrait for the menu**
- **gui2/addon_manager: Move Search to the top right on small resolutions**
- **Italian translation update**
- **SoF 2p5: add forgoten defeat condition on Alanin's death**
- **wesnoth: use async_shutdown() instead of shutdown()**
- **wesnothd: Fix server crash if client is autokicked by registered login**
- **servers: add dedicated catch for boost::system::system_error**
- **wesnothd: properly shutdown tls connection without leaving clients hanging**
- **wesnothd: fix crash when yielding after kick in is_login_allowed()**
- **campaignd: Include `core=` attribute from _server.pbl**
- **Lua: Fix nil-safety issues in location_set**
- **updated Dutch translation**
- **Add extra debug info when verifying TLS cert in the client**
- **Fixed UB due to debug log side effects not evaluating**
- **wesnothd: avoid potential use of null optional when handling surrender**
- **Have the names of the abilities used as weapons show in the attack dialog window when apply_to=opponent (#6111)**
- **Add translation hints for time format strings.**
- **Increase the limits of timer values that players can set**
- **Fix iterator-use-after-invalidation in tooltips**
- **Fix pango_text::set_maximum_height**
- **Re-add html character escaping.**
- **updated Portuguese (Brazil) translation**
- **gui.get_user_choice(): fixed a 'number expected, got function' error**
- **Make wmltools Forest avoid version control subdirectories (#6236)**
- **Cleaned up unused chat rooms handling**
- **Removed command handlers related to rooms**
- **Update changelog**
- **Revert ""Revert ""Revert this for 1.16.1""""**
- **Chatbox: partially fixed buggy nick autocompletion (fixes #6263)**
- **Attempt to fix build**
- **Orb Colors: fixed lack of borders on a label**
- **wesnothd: prevent spurious log messages about unknown data**
- **wesnothd: properly terminate in response to failure to bind port**
- **campaignd: return proper exit code**
- **pot-update and regenerate doc files**
- **1.16.1.**
- **1.16.1+dev.**
- **Resolve title-screen vs main menu inconsistency.**
- **Rename kick attack for horses and wyverns.**
- **Save Index: why was year *after* time...**
- **Add translation hints for time format strings.**
- **Correct typo.**
- **Avoid contemporary phrasing**
- **Rephrase #6060 as per suggestion from @CelticMinstrel.**
- **Replace 'straight' apostrophes with 'curly' or 'typesetter' apostrophes or quotes as per https://wiki.wesnoth.org/Typography_Style_Guide**
- **Revise capitalisation (#6067)**
- **LoW S4: Avoid use of 'men' with respect to female elves (resolves #4880)**
- **Correct inconsistency in Ring description (resolves #6043)**
- **Avoid use of 'cool' and 'guys' (closes #6107) (#6108)**
- **Correct punctuation.**
- **Clarify objectives (resolves #5608)**
- **Correct 13-year-old variable error...**
- **Accommodate variable $ally_name and translations. Resolves #6155.**
- **Add label to mark Alanin's goal. Resolves #6159.**
- **TSG Epilogue: wording revision (fix #6169)**
- **Minor correction.**
- **Minor correction.**
- **i18n: Add N_n() no-op macro to allow xgettext to extract plural forms**
- **Make utils::format_timespan() use gettext plurals**
- **Add a `detailed` parameter to utils::format_timespan()**
- **Update utils::format_timespan() documentation and tests**
- **Update changelog**
- **Re-apply reverted MP string changes from b765c0be66**
- **DM S07 Fix for player having to pass turn in order to meet alternative win condition (#6189)**
- **Simplify the description of leadership (#6117)**
- **Sota proofread (#6136)**
- **Dead Water Proofread Pass (#6139)**
- **TRoW Proofread Pass**
- **TroW Proofread Pass Second Draft**
- **TRoW Proofread Pass Third Draft**
- **Update 21_The_Plan.cfg**
- **Reference SotA in SoF, closes #6151 (#6152)**
- **Improve help entry of ""Mountains"" terrain. Resolves #5906 (#6163)**
- **SotA clarifications and prose edits. (#6168)**
- **DM: Proofread Pass (#6178)**
- **Tutorial: Suggested Proofread Edits (#6179)**
- **SoF S4: Make mining gold and coal clearer (#6182)**
- **TRoW S19:  Automatically collect chest at the end of the scenario (#6192)**
- **UtBS S06b: hermit enhancement and tentacle fix. (#6200)**
- **Add Objective Note for Thursagan's Rune Mechanic (#6207)**
- **SoF Add Rune Chest Objective Notes (#6208)**
- **UtBS S06b Fix Dwarf Sergeant confusing a dust devil or human for a troll (#6198)**
- **Remove a leading space from the Silver Mage's [special_note]**
- **TRoW S04a: Typographic style is not to have a hyphen in ""un-life""**
- **UtBS: Remove leading whitespace from Ethereal Shadow's special note**
- **SotA S02: Add l10n hints about temple label and bats**
- **Paraphrased allied orbs description to remove outdated color reference**
- **Removed WC2-specific feedback link**
- **Fixed boars' attack descriptions being started with capital letters**
- **HttT: add gendered variants to item pickup prompts**
- **Check for potential duplicates before inserting.**
- **Typo fix.**
- **Add help information for the :benchmark command.**
- **Adds some additional text regarding wesnothd's [redirect] and mysql support.**
- **updated Japanese translation**
- **updated Portuguese (Brazil) translation**
- **updated Czech translation**
- **Fix multi-account password saving**
- **Update changelog**
- **Check whether to display lobby joins in the game creation screen.**
- **Changelog update.**
- **Fix whitespace.**
- **HttT S05b - Added cracked temples (#6279)**
- **Refactor the boarding events for TRoW S8 Clearwater Port.**
- **Define KeyboardInterrupt Exception Handler in wmlindent**
- **Edit wmllint KeyboardInterrupt Displayed Message**
- **Edit wmlscope KeyboardInterrupt Displayed Message**
- **Define KeyboardInterrupt Exception Handler in wmlxgettext**
- **Add --simple-version command line option.**
- **Upload artifacts that could be used for releases.**
- **Fixup manpage.**
- **Attempt to trim down the CI after getting caught in github's automated platform abuse tool.**
- **Cleanup some names.**
- **UtBS: Use a lower-case letter for ""taurochs""**
- **updated German translation**
- **Revert ""updated German translation""**
- **updated German translation**
- **updated British English translation**
- **Restore word mistakenly removed in 19a42e3ead717dc1808162168585abe8755df4a4.**
- **Replace std::regex by boost to temporary workaround for Mingw-w64's bug See https://gcc.gnu.org/bugzilla/show_bug.cgi?id=98723**
- **Correct scenario count for SoF.**
- **Avoid unnecessary wording.**
- **Capitalise references to the Academy of Magic on Isle of Alduin, for consistency.**
- **ui: Fix 800x600 theme's sidebar tooltips**
- **Capitalise 'Sceptre of Fire'.**
- **Ardonna should only call her own bats 'my pet'.**
- **Can't checkout a commit with depth=1**
- **Minor correction.**
- **Phrasing.**
- **Fixed an extra whitespace in the Horse unit race description**
- **Minor correction.**
- **UtBS S02 Ogre now dissappears before Nym starts moving or talking (#6343)**
- **wmlxgettext: sort-by-filename before processing files**
- **Restrict who remarks about the dark underground tunnels.**
- **Maintain consistency with existing backwards-compatibility for race=elf.**
- **Changed and documented the change of XP bar color to blue**
- **wmllint: automatically remove {MAGENTA_IS_THE_TEAM_COLOR}**
- **remove 'formation' name of attack prediction windows**
- **Change capitalisation and update po hint as per post-merge discussion from #6198.**
- **updated Portuguese (Brazil) translation**
- **UtBS S06b: Improve Grog spawn**
- **UtBS Hide Dark Assassin's race until uncloacked (#6302)**
- **DiD: don't remove loyal trait from Darken Volk (fix #6351)**
- **DiD S3: add some more flavor text**
- **TSG: revise storytext (fix #6132)**
- **Eastern Invasion and Liberty Bone Knight attack image (#6297)**
- **DiD S3: fix whitespace**
- **Prompt moderators to observe game with observers disabled.**
- **TRoW S19: Don't let units spawn on chasm**
- **UtBS S02 Added a ring icon for the immune unit (#6344)**
- **Ensure humans are removed from display during their 'die' event.**
- **Add a specific prompt for a moderator joining a password protected game.**
- **Avoid counting encounters with 'Cloaked Figure'.**
- **UtBS S9: Avoid 'punishing' the player for saving the rebels (#6362)**
- **Update change log.**
- **Update 1.16 Changelog with my backported PRs (#6366)**
- **fix advancement for Darken Volk (#6358)**
- **UtBS S9: Turn rebels into loyal units (#6371)**
- **Update change log.**
- **Update changelog (including other people's changes)**
- **UtBS S06b Fixed weird scout AI behaviour (#6368)**
- **UtBS S06b Look at the blown charges and make sure no units get stuck (#6369)**
- **Remove the nonfunctional ""title screen tutorial"" hotkey and binding**
- **fix 'add' and 'sub' not added in leadership shema validation(1.16) (#6325)**
- **Print which campaign is causing the extra_defines warning**
- **updated Portuguese (Brazil) translation**
- **updated British English translation**
- **1.16 - some attack icon work (#6339)**
- **1.16 - some terrain graphics fixes (#6382)**
- **updated Czech translation**
- **Get the scenario_id from the addon content list sent by the server if it's not otherwise available.**
- **Changelog update.**
- **Remove a couple no longer needed cmake files.**
- **Alternate way to find SDL2.**
- **Update INSTALL.md.**
- **SDL2 version check.**
- **wesnothd: enable keepalive on socket before accept rather than after**
- **servers: use BOOST_THROW_EXCEPTION macro to ensure that exception cloning is available**
- **servers: convert the rest of throw statements for server_shutdown**
- **Revert ""wesnothd: enable keepalive on socket before accept rather than after""**
- **servers: set CLOEXEC on sockets we accept**
- **Add debug logging of SSL certs to addon manager.**
- **Add SSL debug logging to wesnothd_connection as well.**
- **Replace a hardcoded string with font::unicode_bullet**
- **Update Xcode project**
- **Added --version flag to wmllint, wmlscope and wmlindent**
- **Removed a superfluous backtick from the changelog**
- **Improve comments for translators around VNGETTEXT**
- **wmllint: added support for unit levels and types in recruitment pattern checks**
- **Changelog entry**
- **NR S05a_01 Spelling correction for ""our retreat is cut off""**
- **Wolves multipack MAI: prevent potential for infinite loop**
- **Remove unneeded cmake file.**
- **Support macOS 10.8-10.11 SDKs**
- **fix weapon abilities showed in void attack in attack dialog window**
- **Added attack icon to the nightblade's kick**
- **Only try to activate required addons after loading all addons present.**
- **pot-update and regenerate doc files**
- **Don't check controller type when it's not present.**
- **updated German translation**
- **Removed two no longer useful wmlscope directives**
- **Silence a few wmlscope warnings**
- **Ran wmlindent**
- **updated British English translation**
- **updated Italian translation**
- **updated Portuguese (Brazil) translation**
- **updated Turkish translation**
- **updated Chinese (Simplified) translation**
- **world conquest: typo fixes in file comments**
- **UtBS S04 - enhance goblin leader trigger ""how can he move that fast?"" (#6427)**
- **wmllint: fixed Ggf -> Gg^Emf and Qv -> Mv terrain conversions**
- **Fixed broken gui.get_user_choice()**
- **Fixed a gui.get_user_choice() call in the test scenario**
- **wmllint: fixed a typo in a terrain code**
- **World Conquest: Fix for Winged Scepter bug**
- **Fix [store_unit]'s stored coordinates for recalls**
- **world conquest: replace attack icon of ice-bow to something appropriate**
- **World Conquest: updated changelog on bug fixes**
- **Run the WML unit tests on macOS.**
- **Turns out github actions doesn't have a macOS ARM CI.**
- **Only show planned moves to self and allies**
- **Don't leave a hex selected when using 't' to continue a move**
- **Check for pango and readline with cmake.**
- **Fixed some wmlscope warnings**
- **Update changelog**
- **a few macOS WML unit tests will sometimes timeout so increase the limit.**
- **Update the cache ID to try and get the vcpkg cache working again.**
- **updated Czech translation**
- **updated Chinese (Simplified) translation**
- **updated Italian translation**
- **updated Japanese translation**
- **updated Scottish Gaelic translation**
- **Fix a changelog typo**
- **updated German translation**
- **updated i18n credits**
- **pot-update and regenerate doc files**
- **added Spanish (Latin American) translation**
- **updated German translation**
- **:x**
- **pot-update and regenerate doc files**
- **1.16.2.**
- **1.16.2+dev.**
- **Black Nightmare: add a translation hint for this unit's name**
- **Remove non-standard spacing.**
- **Spelling correction.**
- **Remove non-standard capitalisation.**
- **Remove non-standard spacing.**
- **Remove non-standard spacing.**
- **Remove non-standard spacing and replace hyphen with em dash as per typography standards.**
- **Spelling correction.**
- **UtBS S08 Kromph and Dust Devil able to trigger Eloh's event (#6428)**
- **DM S14 Smooth undead appearance and add dialogue (#6429)**
- **Fixed the possibility of a missplaces dialogue when a bridge was broken**
- **Change log corrections.**
- **Fix typo: ""with heavy loses"" -> ""with heavy losses""**
- **Spelling corrections**
- **Fix the po stats script to recognise ""es_419""**
- **pot-update to fix es_ES translation stats**
- **1.16 saurian sprites cleanup (#6450)**
- **world conquest: fix for hp glitch when picking up items**
- **Shouldn't have backported this line.**
- **This should be optional.**
- **updated British English translation**
- **updated Italian translation**
- **updated Portuguese (Brazil) translation**
- **1.16 - various small sprite updates (#6452)**
- **Editor: document the magenta D and the special terrain overlays**
- **Add a ""special notes"" section to terrain help pages**
- **SoF Proofread Pass and Campaign Prose edits (#6177)**
- **Capitalise direct references to the completed Sceptre of Fire.**
- **updated Czech translation**
- **more variations for rocks, rubble, and snowbits**
- **icy stone walls variation for Xos, based on adjacent terrain, not new code**
- **Add /clear chat command**
- **Update about.cfg**
- **Fix deprecation of [advancefrom], mark as already removed**
- **Make the adhoc add-on download check more detailed.**
- **Correct translation of variable.**
- **servers: log more diagnostic information on caught std::exception**
- **Log if a forced_unwind exception is caught in game destructor.**
- **Don't name the unused variable.**
- **updated Portuguese (Brazil) translation**
- **updated Russian translation**
- **servers: exception safety fix for async_send_doc_queued()**
- **Add additional logging.**
- **Add-ons manager: handle the selected add-on changing in small-screen mode**
- **flatpak: update freedesktop runtime version to 21.08. Fixes #6497**
- **Update flatpak build dockerfile**
- **Change [filter_weapon] to not depend on attack_type::weapon_specials**
- **(1.16) remove only_active argument to weapon_specials()**
- **correction in documentation**
- **Remove excessive newline**
- **updated Czech translation**
- **fix bad Swamp-Icy_Cobble (Ss-Rra) transition (#6491)**
- **Replace deprecated share_maps and share_view with share_vision.**
- **Set Chantal's side to have shroud so that share_vision has the intended effect when the player finds her.**
- **Spelling correction.**
- **SoF: fix thursagan's arcanister advancement breaking in some cases**
- **SoF: update changelog on thursagan bug fix**
- **wmllint: handle deprecated [unit] placement= values**
- **wmllint and wmlindent: avoid crashing on non-UTF8 files**
- **wmlxgettext and wmlindent change exit code**
- **[wmltools] Fix Docstrings**
- **Fix comment handling if the value is empty (fixes #6514)**
- **Improve empty value checks**
- **Mark PUA as MP-only so it doesn't show up as available for campaigns.**
- **HttT S17: Comply with current Wesnoth Lua API specifications**
- **Replace deprecated placement=map_overwrite.**
- **[world conquest] Update modding instructions**
- **updated Czech translation**
- **Lua: Fix a deprecation warning in the hex reference API**
- **Lua: Fix incorrect check for string type**
- **SotBE: Proofread Pass (#6166)**
- **Drake description: 'in to' should be a single word in this context.**
- **Directions are not capitalised.**
- **Not aware of north-east Wesnoth being a special region used as a proper noun, so remove capitalisation.**
- **DM S23: It makes more sense that Asheviere does not mention the attack on Sagus at all.**
- **macos: Update bundle copyright year**
- **macos: Use 1.16 changelog for 1.16 branch builds**
- **wmlscope: allow reporting deprecated macro calls**
- **Fix an incorrect macro argument reported by wmlscope**
- **Fix a deprecated macro call**
- **Changelog entry**
- **updated German translation**
- **2022 copyright update.**
- **Piglets: add a po hint that these are wild boars' young**
- **SoF: explain the Shorbear tools as products of the volcanic forge**
- **Ignore lua submodule folder in 1.16.**
- **Store add-on passwords in the credentials file as well.**
- **Changelog update.**
- **updated Czech translation**
- **Make MSVC fail when C files generate warnings.**
- **Fix #6389.**
- **updated Bulgarian translation**
- **Add unit tests for Lua API wesnoth.simulate_combat**
- **Fix graceful shutdown**
- **wesnothd: Properly enable cloexec even on non-keepalive codepath**
- **server: Fix set-but-unused variable warnings**
- **Fix signedness mismatch error with Xcode**
- **DiD S8: Ensure Spectral Servant unit-line cannot pick up the book**
- **Update change log.**
- **updated Italian translation**
- **wmlxgettext: add a --no-sort-by-file option**
- **Add a unit test for [move_unit]location_id with an occupied hex**
- **updated French translation**
- **Fix units stuck in spider wall and filter**
- **changelog**
- **fix [firststrike] special with apply_to=opponent crashes Wesnoth 1.16.x (#6573)**
- **SoF: Consistently use lower-case after ellipses**
- **updated Czech translation**
- **Update changelog**
- **Avoid potentially using unit IDs that are no longer valid**
- **Unit tests for [drains], [poison] and [slow], with apply_to=opponent**
- **Add debug for ""[event] is missing name or id""**
- **SoF S9: Allow for Gryphon Riders to trigger an event on the final runic tablet, and add translator hint**
- **Update change log.**
- **updated Chinese (Simplified) translation**
- **updated French translation**
- **SoF: A few extra translation hints (#6633)**
- **wmlindent: refactored indentation level handling code**
- **wmllint: removed --stringfreeze command line flag**
- **wmllint: finish removing support for the old special notes system**
- **Changelog entry**
- **Fix title-screen flicker when loading a game or starting a campaign.**
- **Update change log.**
- **updated Czech translation**
- **wmllint: removed gif from two regexps**
- **Editor: Add some missing terrain groupings (resolves #6643).**
- **Editor: Add sconce tile to cave group.**
- **Scroll at a consistent speed.**
- **wmllint: updated mainline campaigns tuple**
- **updated French translation**
- **Fix a typo in the editor-help (#6690)**
- **pot-update and regenerate doc files**
- **updated Italian translation**
- **updated Italian translation**
- **updated British English translation**
- **updated French translation**
- **updated Czech translation**
- **updated Japanese translation**
- **THoT S4: Remove spurious WML (closes #6725)**
- **servers: moved send_queued code into separate function from a lambda**
- **servers: avoid potential dangling queue items in send_doc_queued()**
- **updated French translation**
- **wmllint: add Giant Stoat -> Frost Stoat monster ID change (#6694)**
- **Prevent wmllint from updating a compatibility unit**
- **wmllint: automatically remove {SOUND:SLOW} and {SOUND:POISON} lines**
- **wmllint: fixed translation mark checks by adding a missing not**
- **wmllint: fixed translation marks not being removed from values when checking if a string is empty**
- **updated French translation credits**
- **pot-update and regenerate doc files**
- **1.16.3.**
- **1.16.3+dev.**
- **UtBS S05 Enforce encounter with the Cloaked Figure (#6644)**
- **EI S07a various fixes (#6639)**
- **Editor: Add missing items and scenery (resolves #6719)**
- **Editor palettes: allow keyboard scrolling to see the last row**
- **NR S1 Vary the die dialog depending on race**
- **Avoid using 'that' twice**
- **Use 'leader' and 'grunt' instead of 'chief' and 'lesser orc'**
- **Path finding: fix viewing side in function vision_path**
- **updated Polish translation**
- **ai_helper: fix visibility bug in get_attackable_enemies()**
- **updated Polish translation**
- **Update changelog**
- **Bottleneck Micro AI: fix bug involving units without moves**
- **Attack predictions: fix for chance of being unscathed**
- **ExpAI castle switch CA: fix error when stored leader has been killed**
- **updated Czech translation**
- **updated Finnish translation**
- **Protect Unit MAI: fix typo in MAI removal code**
- **Fix Xcode project DEBUG scheme builds**
- **updated Arabic translation**
- **updated Chinese (Traditional) translation**
- **Fix a bunch of broken uses of helper.wml_error**
- **Lua: fix assert when assigning a selected index to a menu button or toggle button**
- **Fix wmlindent quote detection (#6764)**
- **updated arabic translation credits**
- **Fix whitespace.**
- **Fix ""End Turn"" button placement on low-res themes.**
- **Fix low-res editor themes.**
- **Fix low-res themes during replay.**
- **Fix wmlindent complaint.**
- **Belated change log entry for resolution to #5620 and #6544.**
- **Retreat injured CA: fix for regenerate ability without value key**
- **Retreat injured CA: do not take villages from ally**
- **ExpAI: do not use generic_recruit_engine**
- **ExpAI recruit rushers: reset recruit_data.recruit each turn**
- **ExpAI recruit rushers: do not parse side __cfg each eval**
- **ExpAI recruit rushers: include unit types from extra_recruit**
- **updated Arabic translation**
- **updated Finnish translation**
- **Fix seg fault when weapon is removed during attack**
- **Add no-unit error message for unit debug command**
- **AI: improve efficiency of move-to-any-enemy CA**
- **updated Arabic translation**
- **Fixed Warden’s and Arbiter’s animations popping on water tiles (#6831)**
- **move-to-any-enemy CA: stop eval if no enemies**
- **Ignore Scroll Lock status when checking hotkey commands**
- **Update changelog**
- **pot-update and regenerate doc files**
- **Update changelog**
- **updated British English translation**
- **updated French translation**
- **updated French translation**
- **updated Arabic translation**
- **added a cmake hack for finding asciidoc when using recent archlinux**
- **updated Czech translation**
- **pot-update and regenerate doc files**
- **1.16.4.**
- **1.16.4+dev.**
- **Test scenario: Use progressive syntax for fire animation**
- **Check whether the unit is valid before using it.**
- **1.16.5.**
- **1.16.5+dev.**
- **updated Italian translation**
- **updated Japanese translation**
- **updated Swedish translation**
- **merged German translation**
- **updated Arabic translation**
- **config: Add copy_or_remove_attributes()**
- **campaignd: Drop removed pbl attributes on upload if applicable**
- **servers: avoid exception on write error**
- **updated Arabic translation**
- **Correctly invalidate the previous frame when displaying leadership**
- **Fix hex invalidation code for animations when zoomed**
- **Update changelog**
- **Populate active_addons_ when all add-ons are enabled.**
- **Fixed {IS_HERO} to prevent loss of hero ellipse when leveling up**
- **Update workflow since github actions is deprecating using macOS 10.15.**
- **updated Chinese (Traditional) transalation**
- **updated French translation**
- **Add missing new-lines to error messages.**
- **updated German translation**
- **Update missed copyright notices.**
- **updated Italian translation**
- **updated Bulgarian translation**
- **updated Czech translation**
- **updated Portuguese (Brazil) translation**
- **Pot update.**
- **add missing space**
- **minor German translation update**
- **updated Italian translation**
- **updated French translation**
- **updated Turkish translation**
- **updated Czech translation**
- **Lua AI: speed up battle_calcs.battle_outcome in extreme cases**
- **updated Russian translation**
- **updated French translation**
- **updated British English translation**
- **:x**
- **Show units' max move ranges, unless it's the owner's turn**
- **Update changelog**
- **Update flatpak runtime to freedesktop 22.08.**
- **updated French translation**
- **pot-update and regenerate doc files**
- **1.16.6.**
- **1.16.6+dev.**
- **updated Czech translation**
- **updated Italian translation**
- **campaignd: fixed file descriptor leak on sendfile() codepath**
- **wmlunits: used shutil.move() instead of calling mv as a subprocess**
- **wmlunits: used os.path.join() to build paths instead of string concatenation**
- **DiD S8: Handle situations where factions have not yet appeared (#7006)**
- **Open the forum profile of the currently selected user.**
- **Revert ""Open the forum profile of the currently selected user.""**
- **updated Portuguese (Brazil) translation**
- **updated French translation**
- **updated Portuguese (Brazil) translation**
- **Timestamping server messages**
- **servers: close socket on write error**
- **updated French translation**
- **campaignd: close socket on read error**
- **Servers: add explicit error checking to low level coro_ functions**
- **servers: implement consistent error handling policy for coro_* functions**
- **campaignd: fix native sendfile() codepath**
- **Fix -Wunused-variable warning**
- **updated French translation**
- **updated Czech translation**
- **Enabled client-side keepalive.**
- **Add keepalive advanced preference.**
- **Set linux interval+count to something better for clients.**
- **Address review comments.**
- **Update changelog.**
- **updated French translation**
- **updated Portuguese (Brazil) translation**
- **updated French translation**
- **updated French translation**
- **Fix unknown speaker errors (#7016)**
- **DM S16: Show Delfador taking a more direct route to Weldyn.**
- **Fix male Dark Horse name**
- **Fix wmllint translation mark errors (#6966)**
- **WC: Mark OK button for translation.**
- **UtBS: Add missing text domain.**
- **SoF S9: Separate Toomak's last breath message from the events following his death.**
- **wmllint: Ignore labels for translation if a PNG extension is found (#7079)**
- **DM S21: Show Delfador crossing at the Ford of Abez and take a route to Weldyn via Tath.**
- **updated Portuguese (Brazil) translation**
- **updated French translation**
- **updated Polish translation**
- **Polish translation: removed some ""\v"" that should not occur**
- **updated French translation**
- **Add unit tests for [break] and [return] during [fire_event]**
- **run_wml_tests: add an option to filter tests by name**
- **updated Czech translation**
- **Disable saving of replays for story-only scenarios.**
- **LoW S9: Remove standard enemies-defeated as a victory condition.**
- **updated Arabic translation**
- **fixed error in arabic translation (I hope...)**
- **updated German translation**
- **updated Finnish translation**
- **Fix [special_note] duplication when unstoring units**
- **Inspect console: fix infinite loop in pagination**
- **gettext: fix build with Boost.Locale 1.81**
- **Update vcpkg.**
- **Just look for the toplevel dir tag**
- **dynamic-load got removed in later SDL2 version.**
- **Update vcpkg schema URL.**
- **Add OpenSSL explicitly.**
- **Fixup cmakelists for updated vcpkg.**
- **ignore openssl 3 deprecations on windows.**
- **Add include.**
- **Update vcpkg baseline.**
- **Update used actions to avoid deprecated Node.js 12**
- **Update Windows CI cmake version to match master branch**
- **wmlunits: ignore a dependency on the addon itself**
- **updated Arabic translation**
- **updated Czech translation**
- **updated French translation**
- **Handle out-of-bounds side numbers in Lua's sync.evaluate_multiple**
- **Add unit tests for weapon-special calculations**
- **Allow abilities.cpp to access units and teams earlier during play_controller::init**
- **pot-update and regenerate doc files**
- **Correct path to unit portraits.**
- **Fixed texdomain**
- **updated Turkish translation**
- **updated British English translation**
- **Skip inserting rows that would cause a duplicate primary key error.**
- **Rename database column SOURCE to ADDON_ID.**
- **doxygen fixup.**
- **updated Japanese translation**
- **Update screenshot links in appdata per issue #7260**
- **updated Portuguese (Brazil) translation**
- **updated Czech translation**
- **updated Italian translation**
- **wmlscope: avoid crashing on non-UTF8 files**
- **wmlscope: used an enumerator instead of strings in scan_for_definitions() state checks**
- **Escape < and > even if only one of them exists or if found multiple times (#7154)**
- **wmllint: validate values of [campaign] rank=**
- **wmllint: improve [campaign] rank= validation message**
- **pot-update and regenerate doc files**
- **1.16.7**
- **1.16.7+dev**
- **updated Finnish translation**
- **updated Spanish translation**
- **Spirit PO: used non-deprecated boost phoenix headers**
- **Compatibility with Boost 1.81's locale changes**
- **Bump vcpkg baseline to use a non-obsolete version of libtool**
- **Show id in ""skipping duplicate variation"" warning**
- **HttT S03: Rewrite intro, hint about training troops for S06**
- **LoW: fix scenario count inconsistency**
- **[LoW] S3: fix mismatched coords of Urudin retreat (#7221)**
- **updated Spanish translation**
- **Fix crash in scenario editor when placing units**
- **Revert ""HttT S03: Rewrite intro, hint about training troops for S06""**
- **pot-update and regenerate doc files**
- **Update changelog.**
- **1.16.8.**
- **1.16.8+dev.**
- **Revert ""Revert ""HttT S03: Rewrite intro, hint about training troops for S06""""**
- **updated British English translation**
- **updated Spanish translation**
- **updated German translation (SoF)**
- **po: fix build / formatting**
- **Reduce log spam about the postponed removal of the SPECIAL_NOTES macro**
- **Add a unit test for scoped arrays**
- **updated Chinese (Simplified) translation**
- **updated Portuguese (Brazil) translation**
- **Orb color preferences dialog layout and tooltip**
- **Use two-color orbs for allies' units (configurable by preferences)**
- **updated Polish translation**
- **updated Spanish translation**
- **po: update IRC links**
- **Use an editor-only copy of font::set_help_string**
- **Editor: let the help text switch between the top and bottom of the screen**
- **updated Czech translation**
- **updated Dutch translation**
- **updated Polish translation**
- **updated Dutch translation**
- **Grüü apparition fixed (and commits squashed)**
- **Catch invalid argument exception for stoi in unit advancement. Resolves #7402.**
- **updated Spanish translation**
- **Correction: Lintair -> Lintanir**
- **scons: fix paths when compiling .rc files**
- **NR: Give Eryssa hero trait since her death is a loss condition.**
- **scons: backport sdl check fix for CI**
- **updated Italian translation**
- **updated Czech translation**
- **updated Bulgarian translation**
- **Fix unit being constructed too early 1**
- **Backport WC2 fixes**
- **Fix redo error after reloading #7253**
- **fix crash in whiteboard #3768**
- **Fix executing whiteboard actions during events #7465**
- **Fix assertion on invalid replay data**
- **block 'Back To..' in Mp in linger mode fixes #4236**
- **Fix crash on unit animations #5032**
- **update changelog**
- **planning mode: Fix game hanging during enemies attack**
- **Update changelog**
- **wc: Workaround [leadership] cumulative not working**
- **Try to fix lua errors in pick advance mod**
- **wc: Fix untranslatable scenario name**
- **DiD S8: Disallow undead bat from retrieving the Book.**
- **updated Spanish translation**
- **updated French translation**
- **pot-update and regenerate doc files**
- **updated Turkish translation**
- **updated French translation**
- **updated Czech translation**
- **updated Spanish translation**
- **updated British English translation**
- **updated German Translation**
- **updated German translation (DiD)**
- **updated French translation**
- **new credit entry**
- **wesnoth_addon_manager: update a deprecated method**
- **wesnoth_addon_manager: update another deprecated method**
- **wesnoth_addon_manager: don't upload old-style add-ons**
- **wesnoth_addon_manager: warn and exit if a deactivated server is used**
- **wesnoth_addon_manager: added SSL/TLS support**
- **wesnoth_addon_manager: added IPv6 support**
- **wesnoth_addon_manager: added new --terms flag (prints the server upload terms)**
- **wesnoth_addon_manager: added --version flag**
- **wesnoth_addon_manager: exit gracefully when removing a non-existing add-on**
- **wesnoth_addon_manager: removed unused --color switch**
- **pot-update and regenerate doc files**
- **1.16.9**
- **1.16.9+dev**
- **Backport CI fixes.**
- **Properly name job and prevent building multiple arches.**
- **Store side leader information in the database.**
- **Fix comments.**
- **updated Italian translation**
- **updated Arabic translation**
- **add missing cstdint includes (#7586)**
- **Don't call back() if open_window_stack is empty since that's UB.**
- **updated Czech translation**
- **Fix unused variable warning on Xcode 14.3**
- **Rewrite macOS version report again**
- **Update copyright on macOS About dialog**
- **cwesnoth.cmd cleanup**
- **desktop: Fix enumerate_storage_devices() inaccuracy on Linux**
- **Replace po4a-gettextize with po4a-updatepo**
- **CMake part of using po4a-updatepo instead of po4a-gettextize**
- **Remove an explicit GETTEXT_DOMAIN ""wesnoth""**
- **updated Spanish translation**
- **UtBS: Make the name of the dark assassin translatable again**
- **Apply upstream fix from https://github.com/flathub/org.wesnoth.Wesnoth/pull/20.**
- **Revert ""Apply upstream fix from https://github.com/flathub/org.wesnoth.Wesnoth/pull/20.""**
- **[1.16] UtBS: improve po hints (#7697)**
- **updated Czech translation**
- **gui/preferences: Update Display resolution list on game window resize**
- **Update changelog**
- **fix macro comment**
- **fix shadow’s north-facing animation**
- **Update Win32 resource section copyrights**
- **campaignd: Correct Win32 resource section's FileDescription**
- **updated Portuguese (Brazil) translation**
- **updated Czech translation**
- **Liberty S6: Correct target hex for Shadow Mage (resolves #7751).**
- **1.16 wmlunits fix syntax error**
- **vcpkg: Use same base-line as current master.**
- **WC: remove trailing whitespace from unittypedata.lua**
- **WC: add po hints to the messages when units join**
- **UtBS S3: Resolve Garak's attacks only partially being converted to fire damage on turn 2 (resolves #7774).**
- **pot-update and regenerate doc files**
- **Add missing include**
- **Just call std::_Exit**
- **Add event unit tests for dynamic filters and names (#6785)**
- **Update type.cpp**
- **Revert ""Game Display: make first_turn a static local to the only function that uses it""**
- **updated French translation**
- **updated Italian translation**
- **wc: fix lua error at victory (#7823)**
- **[1.16] Fix #7820 ""Enable planning mode on start"" Setting**
- **updated German UtBS translation**
- **updated Czech translation**
- **updated German HttT translation**
- **changelog_entries**
- **pot-update and regenerate doc files**
- **1.16.10**
- **1.16.10+dev**
- **Fetch older version of pango in mingw dockerfile**
- **Changelog: separate the entries for 1.16.9 from 1.16.10**
- **updated Japanese translation**
- **Compile fix for boost 1.83.**
- **Fix a crash in :inspect when switching from page 2 to a different item**
- **updated British English translation**
- **Backport fix for issue #7441**
- **updated Czech translation**
- **updated Arabic translation**
- **Update ar.po**
- **updated Chinese (Simplified) translation**
- **updated Slovak translation, added new maintainer**
- **fix missing closing tag in Slovak credits entry**
- **updated Slovak translation**
- **added Welsh translation**
- **verify that the Welsh files update correctly**
- **fix broken syntax in about_i18n for Slovak**
- **updated Czech translation**
- **updated Slovak translation**
- **updated Welsh translation**
- **updated Welsh translation credits**
- **fix missing closing "" in Welsh credits**
- **updated Polish translation**
- **updated Czech translation**
- **Update to 23.08**
- **Avoid pango 1.50.12+ that breaks non-system font loading on Windows when fontconfig is not used.**
- **updated French translation**
- **Revert ""Update to 23.08""**
- **Lists of lists in CPPDEFINES don't work in newer scons versions**
- **pot-update and regenerate doc files**
- **Update to new config file format**
- ** fix #8115  segmentation fault on attack event (berserker) (#8116)**
- **[1.16] fix #4055 invalid mp addon version info**
- **updated British English translation**
- **fixed changelog (merge Welsh into normal row)**
- **updated Bulgarian translation**
- **pot-update and regenerate doc files**
- **changelog_entries.**
- **1.16.11**
- **1.16.11+dev**
- **Update changelog.md**
- **copy libssp-0.dll from arch because msys2 doesn't provide it anymore**
- **Add define for int64_t. Seems to be needed on msys2 mingw**
- **Fix horizontal scrolling regression (fixes #7404)**
- **Save horizontal scrolling inversion check in static variable**
- **Confine special handling to only the affected platforms**
- **Sync with master workflow**
- **updated Italian translation**
- **updated German translation**
- **updated Czech translation**
- **systemd: Run as _wesnoth:_wesnoth**
- **systemd: drop _ prefix from username**
- **Fix tmpfiles.conf and sysusers.conf paths in SConstruct. (#8280)**
- **Revert ""systemd: drop _ prefix from username""**
- **Keep laurel decorations consistent with difficulty level (resolves #8442).**
- **Remove spurious if condition.**
- **Set gold laurel first in case of only one difficulty setting.**
- **changelog_entries**
- **pot-update and regenerate doc files**
- **1.16.12**
- **1.16.12+dev**
- **CI: Use the macos-12 disk image instead of macos-11.0**
- **Update boost download url in flatpak**
"
2257186042,Add additional functionality for the in-game add-ons manager,Pentarctagon,2025-01-01 19:33:42+00:00,2025-01-14 15:35:46+00:00,"{'macOS': 1, 'Docs': 1, 'MP': 1, 'UI': 1, 'Add-ons': 1, 'Building': 1}","When started with the command line argument --addon-info, the Info button is shown on the add-ons manager which then allows:
* querying the current count of all add-ons available on the add-ons server
* querying the count of add-ons by add-on type
* querying the downloads by version of the currently selected add-on
* querying the count of total add-ons uploaded vs the count of add-ons using forum_auth
* deleting an add-on (requires being a member of the Site Administrators or Forum Administrators forum groups)
* hiding an add-on (requires being a member of the Site Administrators or Forum Administrators forum groups)

Fixes #8875"
2257136365,extend tag_name check to has_attack using a class similar to recursion_guard,newfrenchy83,2025-01-01 17:01:45+00:00,2025-01-08 11:44:19+00:00,"{'Unit Tests': 1, 'Units': 1}","It annoys me that the tag_name check for filter_weapon doesn't work for has_attack and that it's recursion_guard that prevents infinite recursion (with error message in log), so I decided to reuse a similar method to solve of infinite recursion.

In addition to solving the has_attack problem, its implementation opens the possibility to create new attributes in [filter_weapo/attack] like a real_number that would check the number of attacks actually used (and not just the base number without attacks or swarm)"
2257126703,Change boost download link in flatpak to archive.boost.io,loonycyborg,2025-01-01 16:33:04+00:00,2025-01-01 19:26:03+00:00,{'Packaging': 1},"because artifactory is down too much and they plan to move away from it
anyway.
"
2256734259,EI S05 prose: Galdren and the sylph ,Dalas121,2024-12-31 22:09:07+00:00,2025-01-01 15:45:37+00:00,{'Campaign EI': 1},Fixes #9687
2256728262,EI S04c: clear dangling variables,Thewodoros,2024-12-31 21:49:26+00:00,2025-01-01 13:37:21+00:00,{'Campaign EI': 1},"These variables are not used later, so they may be cleared. Otherwise they appear uselessly in later scenarios.
- `dead_ravanal` variable is used in this scenario only
- `possessee` may be kept to use in `RAVANAL_DEPOSSESS`, but this macro is not used in this scenario"
2256335315,Improve keyboard navigation in MP Method Selection dialog,babaissarkar,2024-12-31 10:52:03+00:00,2025-01-07 05:46:40+00:00,"{'MP Lobby': 1, 'UI': 1}","Allows method selection using arrow keys once again (Resolves #9501).

Adds Tab ordering to the MP method selection dialog. Initially the method list has focus so method can be selected using Left/Right keys. To change username, the player just needs to press Tab once to move focus to the Login textbox.
Additionally, the layout and message is adjusted a bit and @ProditorMagnus's suggestion of remembering the last connection method has been implemented. (https://github.com/wesnoth/wesnoth/issues/9501#issuecomment-2560330243)
Also, a close button has been added so that the window can be close using mouse once again.

![Screenshot from 2025-01-07 09-38-47](https://github.com/user-attachments/assets/a011cd08-1c92-47c4-88e7-2c044bf8d089)

(Changed from initial idea of removing the login textbox based on feedback received on Discord/IRC.)"
2255967621,cleanup team::gold,gfgtdf,2024-12-31 00:07:35+00:00,2025-01-02 00:27:16+00:00,"{'Editor': 1, 'Campaign WC': 1}","previously there were team::gold_ and team::team_info::gold
doing the same thing, now we just have one gold variable
team::team_info::gold, we also removed some related unused code"
2254677227,"1.19 Partial reversion of boats, reorganization of new generation",doofus-01,2024-12-29 18:13:30+00:00,2025-05-03 12:35:31+00:00,"{'Graphics': 1, 'Units': 1}","This is to revert (partially or fully) recent changes to the old boats, leaving them as fake units, and allow new ships to be free of their influence.

This is the current state of affairs:
![Screenshot_20241229_ships](https://github.com/user-attachments/assets/7a620a35-f72a-442e-b90a-f5f44d1c3537)

Known To Do:

 - [ ]  ~Coherent plan for unit balance - the precise details don't necessarily need to be finalized here, but a general plan that could affect sprites and animations should be completed.~
 - [ ] ~Transport Ship vs Pirate ship differentiation~
 - [x] Orc ship
 - [ ] ~Elf Ship~
 - [x] Undead Ship
 - [ ] ~Dwarf Ship~
 - [x]  Primitive ship/barge (for saurians, ogres, etc.)

More variety is better (e.g. orcish skiff) but one of each main race makes sense a minimum.

EDIT:  This PR scope was too much, I need to reduce it.  The dropped components will still be addressed, just not here and now.
![Screenshot_20250413_](https://github.com/user-attachments/assets/b1288c91-fbb5-4c66-892d-170a8beba181)
EDIT2: Orcish ships now have the basic requirements.  Descriptions and unit balance are almost nonexistent, but that can be done in a subsequent PR."
2254162149,The South Guard: add Dalas's tutorial revision to mainline,Dalas121,2024-12-28 14:30:59+00:00,2025-01-17 14:26:44+00:00,"{'Graphics': 1, 'Audio': 1, 'Units': 1, 'Schema': 1, 'Terrain': 1, 'Achievements': 1, 'Campaign AToTB': 1, 'Campaign EI': 1, 'Campaign TSG': 1, 'Campaign Tutorial': 1}","It's time. This PR replaces the current TSG with my TSG tutorial revision from the addon server.

This also ~~removes the existing tutorial~~ de-emphasizes the existing tutorial, though a similar ""tutorial"" will still be available in the upcoming ""Asheviere's Dogs"" campaign, as bonus scenarios aimed at nostalgic veterans.

.

~~I have not yet run wmlindent. As noted in #1397, wmlindent cannot handle more than one closer on the same line, which causes issues in this campaign. For example, wmlindent fails to properly indent this example macro:! EDIT [example removed]~~ 

Speaking of macros: My campaigns make heavy use of space-shortening macros, like `{FILTER()}` or `{THEN()}` For me, these make the WML easier to read, bugfix, and maintain - but I realize these are unusual for mainline.

It's possible, if tedious, for me to remove them from TSG. But, they're absolutely essential for the more-complex TDG and HttT (my upcoming revision), and I'll have no chance of maintaining these campaigns without these simplifying macros - and a refactor of this scale would likely introduce countless bugs.

.

TSG and my other beginner-oriented reworks show floating ""Miss"" text when an attack misses - I noticed this was a common point of confusion for new players. As mentioned in #9461, I think this would work better as a core preference.

The rain/snow effects used in TSG are also used in other revisions of mine. Once we figure out how to handle resources in #9669, I'll need to move the rain/snow effects out of TSG and into a core resource.

I do have a localization.xcf file prepared for the new bigmap, and will be adding it to `wesnoth/resources` after this PR.

""Captain Mari"" still needs a portrait; the plan is to commission one from LordBob (based on his WIP female fencers) alongside some story art and a young Asheviere portrait, once his Dunefolk portraits are finished.

TSG is the first of several campaign revisions/additions planned for 1.20. I recognize this will be a major burden on translators, and that some revised campaign translations won't be finished in time for 1.20 (if ever...). TSG is the only campaign that I consider a priority to translate, as it's a tutorial aimed at beginners.

Everyone's welcome to comment on dialogue - I'm sure there're typos and issues that need to be fixed, and I still need to add more po notes - but I may not respond to dialogue-related reviews if I broadly disagree or feel they're bikeshedding.
"
2252845969,Clean up and expand ranges compat layer,Vultraz,2024-12-27 00:30:57+00:00,2024-12-27 03:11:34+00:00,"{'AI': 1, 'UI': 1, 'Lua API': 1}",Uses a simpler approach than what I added in 7311b19d4d24ca0f54a309e033f2a767d56faeb4. Also adds additional aliases to the compat layer.
2251781450,EI S5: reduce code duplication,Thewodoros,2024-12-25 17:04:39+00:00,2024-12-25 18:25:27+00:00,{'Campaign EI': 1},"The code for Owaec's side joining the player was duplicated, so I moved it into a custom event. This involves only the code merging the sides, without any dialogues.

There is no changes in behavior.

An alternative would be to join the `die` events like
```
[event]
        name=die
        [filter]
            id=Shodrano,Rilaka
        [/filter]
```
but then it would require 2-3 `[if]` blocks inside for differing dialogues and actions, so it would be less readable."
2251340775,EI S04c: avoid contradictory dialogue if Ravanal is triggered early,Thewodoros,2024-12-24 23:44:15+00:00,2024-12-25 14:56:49+00:00,{'Campaign EI': 1},"The problem is, if `ravanal_gets_serious` event is triggered before turn 8, then Dacyn's words in `turn 8` event:
> all will be lost if Mal-Ravanal finds me amongst you

are nonsense - as Ravanal has already found him.

To fix this, I put Dacyn saying those words into a separate single-use event `dacyn_warning`, and trigger it either in `turn 8` or in the beginning of `ravanal_gets_serious`, whichever happens earlier. "
2249720108,Improve unit filters in scenario end dialogue,Thewodoros,2024-12-23 15:31:40+00:00,2024-12-23 17:53:57+00:00,{'Campaign EI': 1},"In case victory is achieved with, for example, only one knight freed, who also advanced to Paladin or Great Knight. Then the message ""We cannot leave my companions behind"" doesn't appear. This PR fixes it.

The filter will now use the survivor trait instead of the type, like it's done in the achievement-related code a few lines below. No other units with this trait appear until S13

Also remove unit type filter for side 8 because it's redundant - all side 8 units are of those types."
2249692592,"Switch to unique attack names within unit type, re #9324",ProditorMagnus,2024-12-23 15:12:31+00:00,2025-09-22 14:47:48+00:00,{'Units': 1},"In preparation for #9324 idea 2, single unit type should not have multiple weapons with same name."
2248455729,"Move ""Urban Jungle"" terrain from EI into a separate resource",Dalas121,2024-12-22 16:53:23+00:00,2025-01-10 13:06:09+00:00,"{'Graphics': 1, 'Terrain': 1, 'Campaign EI': 1}","These terrains are used in EI, TSG, TDG, and other WIP campaign revisions. Duplicating them across each campaign seems pointless, so I've moved them into a resource here.

If we can figure out the right way to do things for this PR, this same pattern will also be useful in the future for things like Orcish Shamans, Rogue Mages, rain/snow, etc."
2247629325,Lint for static analyzer checks,jj-marr,2024-12-21 05:20:15+00:00,2025-01-16 15:33:52+00:00,"{'AI': 1, 'Lua API': 1, 'WFL': 1}","Mostly potential null pointer dereferences. Can't figure out how to resolve most of these, so making a PR for further discussion."
2247585752,add validation for icons that are too large,Pentarctagon,2024-12-21 02:53:22+00:00,2024-12-24 05:12:52+00:00,"{'UI': 1, 'Add-ons': 1}",
2247533518,Dwarvish Explorer: reduce resistances from 20% to 10%,Dalas121,2024-12-21 00:15:05+00:00,2024-12-24 17:35:02+00:00,{'Units': 1},"The Dwarvish Scout and Pathfinder have 10% resistance to Blade/Pierce/Impact, but the Explorer has 20%. The Explorer's 20% resistance removes one of the unit line's unique attributes, and also makes him even more similar to the Dragonguard than he already was.

This PR lowers the Explorer's resistances to match the rest of the unit line, and moderately improves their damage in compensation.

I don't mean to make the unit as a whole significantly stronger or weaker, nor do I mean to change their role or affect the balance of existing content. I do mean to reduce one area of similarity between the Explorer and Dragonguard, and to emphasize the Scout/Pathfinder's unique identity as a 10%-resistance dwarf.

The Dwarvish Scout's usage is currently set to 'mixed fighter'. This PR also changes the Pathfinder/Explorer's usage to 'mixed fighter', which is a better reflection of their stats than 'scout'."
2246103969,about dialog: use boost::filesystem::path for path calculations,babaissarkar,2024-12-20 06:54:26+00:00,2024-12-21 12:12:07+00:00,{'UI': 1},"Follow up to #9664, it rewrites the filename logic to use the cross-platform `boost::filesystem::path`.
Resolves #9663.

**Task**
- [x] Finding the manual path should be its own function, preferably in `filesystem`. (Suggested by @Vultraz)

(Recently found out that online versions of manual exists for all translated languages, so the steps might be like this
`manual.bn_BD.html` (offline) -> `manual.bn.html` (offline) -> `manual.bn.html` (online) -> `manual.en.html` (online)
However, need to find out how to check online manual availablity. (using Bengali bn_BD locale as an example), however I might choose not to do that here.)"
2243956592,View Manual: Avoid crash from indexing an empty vector,Wedge009,2024-12-19 09:23:36+00:00,2024-12-20 03:04:22+00:00,{'UI': 1},"Most of the changes here is just me restructuring things so I can read/understand the flow better. Hopefully it makes sense to others as well. The core of the change is not attempting to access non-existing elements in an empty vector.

The change avoids the immediate problem of the crash that causes #9661, but there are things that could be done better:
* I use `en` as a fall-back for System Language. I don't think it's unreasonable to open a US English manual as a default regardless of the user's system language, but perhaps we can re-use the same logic from the language menu label to have some sort of attempt at discerning the user's system language.
  https://github.com/wesnoth/wesnoth/blob/a6954bd56e214ab7e7f656a419a814e00f6de1b7/src/gui/dialogs/title_screen.cpp#L392-L418
* This change doesn't do anything to help with #9663 (I was only able to get local manual file opening working in Windows when I temporarily changed the `/` to `\\`). I don't know what mechanisms there are to handle cross-platform directory separators in Wesnoth, the standard library, boost, etc."
2243083775,Use [leader] in the c++ code,gfgtdf,2024-12-18 20:55:22+00:00,2024-12-26 19:22:09+00:00,"{'UI': 1, 'Units': 1}","Added code to convert all  ` [side]type=` to `[side][leader]` when the `[scenario]` is read, and the rest of the engine code to only work with [leader], this should fix all possible problems with  [leader] and also simplify the code a bit

Fixes #7985
Fixes #3742"
2240970384,remove [side] leader=,gfgtdf,2024-12-18 00:05:53+00:00,2024-12-18 17:48:41+00:00,{},"previously the leader= attribute in [side] could be used to make the engine choose a faction by its leader, similar to how [side]faction_from_recruit worked.

However this was not documented in the wiki, and the name clash with the [side][leader] subtag could also cause problems and is also a litte confusing.

So it was decided to remove it. an alternative approach to fix the name clash would be to rename it, but i can't think of real usecases of this feature currently."
2239324740,Fix a possible recursion error involving [has_attack],newfrenchy83,2024-12-17 10:41:42+00:00,2024-12-17 16:27:10+00:00,{'Units': 1},"I noticed that when using [has_attack], o does not necessarily track the attack used, and that if the unit checked does not use an attack, the recursion count does not work."
2238880400,add preference to not get addon icons,Pentarctagon,2024-12-17 06:48:12+00:00,2024-12-19 17:54:14+00:00,"{'UI': 1, 'Add-ons': 1}",
2238381221,Fix #9651 Error in u:extract(),gfgtdf,2024-12-16 22:22:42+00:00,2024-12-17 00:10:53+00:00,{'Lua API': 1},"This logic seems inverted, this probably happened while the lua attributes were converted to use the LATTR_SETTER macros."
2237839419,Allow to partially check the activity of a special weapon in [has attack],newfrenchy83,2024-12-16 17:00:35+00:00,2024-12-28 19:39:38+00:00,"{'Unit Tests': 1, 'Units': 1}","When using [filter][has_attack]special_id/type_active, if a unit has the special in question and it is still active, it is detected, but if any filter like [filter_self/student] is used, the detection does not work anymore because the weapon is considered as still inactive, no information about the user or the opponent being available. This PR partially fixes this lack by including the information about the filtered unit but not about the opponent or if active only in attack or defense"
2237284256,EI: forbid dunefolk from taking the Plague Staff and add custom rejection messages,Thewodoros,2024-12-16 12:49:45+00:00,2024-12-20 13:56:53+00:00,{'Campaign EI': 1},"Fixes #9627 . I've also added a changelog entry for my previous PR #9637 where I forgot to add one.

The INVALID_DESC parameter in PLACE_ITEM macro is now supposed to contain WML code rather than a single string. It should be at least a single [message] tag. Correspondingly, I replaced empty strings for this parameter with empty parentheses. This way I don't need to change a lot of code in the macro (which may break other items). However, that means that if the code is changed in the future, you need to make sure there's no contradictions between the code in REQUIREMENTS and in INVALID_DESC.

The unreachable dialogue in S18 (for the cases when Dolburras or Hahid wear the staff) is removed.

I have verified that different units produce different rejection messages, but I didn't fill the messages themselves, so this is a draft PR. @Dalas121 , as you are the author of this campaign, can you write Plague Staff rejection messages for:

* Individual units
  * Owaec
  * Gweddry
  * Dacyn
  * Hahid
  * Terraent
  * Konrad
* Unit types
  * White Mage
  * Mage of light
  * Paladin
* Races
  * Dunefolk

Of course some of them may be identical. I left the original message as a fallback in case no other specific messages were selected."
2235398451,Fix build with boost >= 1.87.0,berolinux,2024-12-14 23:25:11+00:00,2024-12-15 07:27:50+00:00,"{'Building': 1, 'Stable 1.18': 1}","Boost 1.87.0 removes some functions that have been deprecated for a few releases, but are still used in wesnoth.

(This is the same as #9652, but backported to the 1.18 branch)"
2235387485,Fix build with boost >= 1.87.0,berolinux,2024-12-14 22:32:41+00:00,2024-12-15 05:29:11+00:00,{'Building': 1},"Boost 1.87.0 removes some functions that have been deprecated for a few releases, but are still used in wesnoth."
2233005919,GUI2: simplify various dialog's filter handling,Vultraz,2024-12-13 04:44:13+00:00,2024-12-18 07:01:05+00:00,{'UI': 1},Lottttt of redundant code. Pondering ways to abstract even further...
2232615763,Target Windows 10,Vultraz,2024-12-12 21:48:00+00:00,2024-12-13 01:35:51+00:00,"{'Windows': 1, 'Building': 1, 'SCons': 1, 'CMake': 1}","As mentioned on Discord, it looks as if the ~current~ upcoming VS 17.13 release cycle will be the last, and support for targeting Windows 7 is going to be [dropped when VS 18.x comes out](https://github.com/microsoft/STL/issues/4560#issuecomment-2348622212). Additionally, boost::filesystem just dropped support for Windows versions prior to 10 with 1.87, so it seems a good a time as any to do this, especially since we're targeting 2026 for 1.20."
2232561633,return pbl author attribute to its original usage,Pentarctagon,2024-12-12 21:08:01+00:00,2024-12-15 00:49:33+00:00,"{'MP': 1, 'UI': 1, 'Add-ons': 1, 'Schema': 1}","and use the new primary_authors attribute instead

Fixes #9547"
2231110226,Remove heal+4 from Oracle and Prophet,rodolphecombe,2024-12-12 08:55:00+00:00,2024-12-16 12:18:46+00:00,"{'AI': 1, 'Graphics': 1, 'UI': 1, 'Units': 1, 'Lua API': 1, 'Help': 1}","This PR is the result of discussions inside the WMG. 

Disclaimer: although this PR affect balance, this is not a balance PR, rather a coherence PR. While we also feel that the balance of the whole augur line needs to be adjusted, this would be the subject of a second PR. 

As you probably know, the saurian Augur is the only healer keeping heal+4 on his DPS branch. Although this could be seen as a feature of the line, we consider it is rather an incoherence with respect to the other healer lines. 

The main proposition of this PR is therefore to remove heal+4 from the Oracle and Prophet. 

Following this main proposition, we are making the following additional propositions: 
1.	Add a special to the ranged attack of the Oracle and Prophet to help distinguish them more from the Soothsayer line. 
2.	Give a new special called curse to the “curse” attack of the Oracle and Prophet (“slow” would make them too similar to elvish line, “daze” would not synergize well with being use on an attack with magical, “stun” would not synergize well with the skirmisher line, “drain” and “poison” would not really make sense here). 
3.	Curse special reduce: 
a.	Physical and elemental resistances (not arcane until the position on arcane rework is clarified) 
b.	By 20% 
c.	Until turn end (same duration as “slow”) 
4.	Rename the attack of Augur, Soothsayer and Seer to “Frost Blast” 

All these propositions are of course open to discussing and most of them can be treated independently. The values of 3) are what we found worked best but other combinations are equally good (for example, reducing duration to “turn” has little to no influence in 1vs1).
"
2230527123,unit preview pane: use overloaded functions to set data,babaissarkar,2024-12-12 03:16:23+00:00,2024-12-12 14:47:48+00:00,"{'UI': 1, 'Lua API': 1}",
2224855506,allow to register custom lua map generators,gfgtdf,2024-12-09 22:10:37+00:00,,"{'UI': 1, 'Lua API': 1, 'Add-ons': 1, 'Schema': 1, 'Campaign HttT': 1, 'Campaign SoF': 1, 'Campaign WC': 1}","it's now possible to register custom lua map generators that can be called like map_generation=cave or
scenario_generation=world_conquest, so that the map generation lua code no longer has to be put into the [generator] into [scenario]

This in particular makes it easier to finally remove the deprecated c++ cavegen code, but also allows us to provide an easier way to user the world_conquest map_generator."
2224516829,Second test test,Vultraz,2024-12-09 19:19:20+00:00,2024-12-09 21:30:09+00:00,{'UI': 1},
2224365754,"Attempting to fix tests, nothing to see here",Vultraz,2024-12-09 17:55:56+00:00,2024-12-09 21:29:54+00:00,{},
2224273304,attempt to fix wesnothd crash when player disconnecting before game history response,Pentarctagon,2024-12-09 17:18:21+00:00,2024-12-10 13:41:25+00:00,"{'MP': 1, 'Add-ons': 1}","I was not able to reproduce the crash locally, but this is the solution discussed on discord and it doesn't appear to break anything."
2222675080,GUI2: take find_widget and find ID args as string_view,Vultraz,2024-12-09 05:09:28+00:00,2024-12-09 06:20:09+00:00,{'UI': 1},CI run
2222613158,EI S04c: fix gold management for Ravanal,Thewodoros,2024-12-09 04:12:02+00:00,2024-12-09 13:15:58+00:00,{'Campaign EI': 1},"Fixes #9623
@Dalas121 I've changed the WML you proposed in the issue a bit.
I think it's more straightforward to have it in one ""turn refresh"" event, right before the side's AI launches.
I've tested it, it works as intended."
2221969492,Message voice fix,hladkyjakub,2024-12-08 12:40:38+00:00,2024-12-21 01:57:49+00:00,{'Lua API': 1},"This is minor, typo correction,
The old way, if you put a voice into the message, it keeps playing again and again once the message is dismissed.
Repaired, tested."
2220207464,Move custom AMLAs from EI to core,Dalas121,2024-12-06 14:30:52+00:00,2024-12-28 13:07:15+00:00,{'Campaign EI': 1},"EI contains a basic custom set of AMLAs, replacing the default +3hp for all player units. Units gain a +8hp AMLA option, and units with 1/2/3+ melee/ranged strikes gain options for +4/+2/+1 melee/ranged damage, respectively. Investing XP into these AMLAs remains much weaker than leveling a new unit.

In EI, these AMLAs are intended to make purple XP ""feel"" less wasteful, as well as to help make level 2-capped units less weak in campaigns. The recent community survey also shows that players like seeing custom AMLAs in campaigns (though the survey focused on the more-complex ones seen in DiD and UtBS). And in TSG, for new players, I think the choice's UI provides a better explanation of the AMLAs system than the default AMLA with no UI.

I use these same AMLAs in my TSG revision, TDG campaign, and WIP HttT revision. In preparation for moving the TSG revision into mainline, I'd like to make these AMLAs accessible in core to avoid duplicating them across each campaign.

Not sure who're the right people to get reviews from on this; please let me know.

![Untitled](https://github.com/user-attachments/assets/843a7de4-e942-4b87-b00e-4b146b220fab)

"
2219559053,Listbox builder and sorter cleanup,Vultraz,2024-12-06 09:10:53+00:00,2024-12-09 04:04:44+00:00,{'UI': 1},"Worked off @babaissarkar 's work in #9630 combined with the general method employed by the matrix widget. Finally, `[instance]`!"
2219322102,Fix tutorial help text cutoff on macOS by removing location assignment in hint_message.lua,jansseal,2024-12-06 07:05:30+00:00,2025-01-22 08:18:34+00:00,"{'UI': 1, 'Campaign Tutorial': 1}","This PR resolves #9591, where the tutorial help text in the Battle Training Campaign was partially cut off on macOS.

**Fix Details**

The issue was caused by the `location` assignment in `hint_message.lua`, which introduced padding between the text box and the screen edge. It appears that the rectangle’s width was being set before the text’s starting point was adjusted to account for `location`. This mismatch caused some text to overflow when it exceeded the pre-defined width. By removing this assignment, the help text now displays fully without being truncated, resolving the immediate issue.

![Screenshot 2024-12-05 at 11 59 51 PM](https://github.com/user-attachments/assets/b1618e59-eab2-4f5f-826a-fdc28cf5f7c5)

**Alternative Fix Considered:**

An alternative approach would involve retaining the `location = {5, 5}` assignment in `hint_message.lua` and adding the following line to the `intf_set_floating_label()` function in `game_lua_kernel.cpp`:

`flabel.set_width(rect.w - loc.wml_x());`

While this adjustment would fix the cutoff, the resulting visual design is suboptimal:

- The fix proposed in this PR only impacts the tutorial hint messages.
- I'm not sure what impact the alternative fix would have on other callers of the function.
- The background color and text both extend to the rectangle’s edge which, when padded away from the screen's borders, creates an unpolished appearance.
- A better long-term solution might involve introducing padding between the text and the rectangle’s borders while maintaining the box’s position relative to the screen.

![Screenshot 2024-12-06 at 11 25 00 AM](https://github.com/user-attachments/assets/843e80c4-30bf-4e4c-9354-c735d6e38259)

**Next Steps**

For now, removing the location assignment is the most straightforward and effective fix. However, I recommend exploring a more comprehensive solution in the future to enhance visual consistency and maintainability. I’d appreciate feedback from maintainers and contributors familiar with the codebase on the best approach to achieve this.

(Resolves #9591)"
2219226116,"Revert ""listbox: simplify builder""",Vultraz,2024-12-06 05:42:53+00:00,2024-12-06 05:43:39+00:00,{'UI': 1},Reverts wesnoth/wesnoth#9630. Was merged prematurely.
2219224293,Remove incorrect moves,jj-marr,2024-12-06 05:40:55+00:00,2024-12-06 07:15:13+00:00,"{'MP': 1, 'Add-ons': 1}","These were added by clang-tidy's autofix, which both tried to convert the parameters to const references and std::move them. The correct behaviour is to convert only to a const reference."
2219109653,listbox: simplify builder,babaissarkar,2024-12-06 03:59:50+00:00,2024-12-06 05:39:47+00:00,{'UI': 1},Simplifies the Listbox builders. Split from #9499.
2218939546,GUI2/Listbox: allow setting all sorters at once,Vultraz,2024-12-06 01:09:36+00:00,2024-12-06 03:45:52+00:00,{'UI': 1},@babaissarkar How does this affect your work on #9499?
2216911822,[Android] Gradle build files,babaissarkar,2024-12-05 07:19:06+00:00,2024-12-05 18:16:34+00:00,"{'Building': 1, 'Packaging': 1, 'SCons': 1, 'Android': 1}","Allows to build the APKS by doing something like `./gradlew buildCppDepends buildCppSource installDebug`.

Tested on:
Java 21/Gradle 8.11.1/Gradle Android Plugin 8.7.0/Android 7

Might require a java keystore to properly sign the resultant apks.

(sorry, don't have a newer android model, but target API is 33.0, so should work on newer models.)

Also add a thread patch that allows the gui2 event dispatcher to properly work on android."
2214349603,GUI2/Listbox: unify registration of sorting options,Vultraz,2024-12-04 07:07:36+00:00,2024-12-05 02:46:39+00:00,{'UI': 1},"Instead of two functions for translatable and non-translatable options, comparison will be determined by the return value of the sorter. Existing translatable sorting options have been adjusted to return t_string rather than string."
2213714510,Update German translation,Wuzzy2,2024-12-03 21:47:02+00:00,2025-01-26 20:41:56+00:00,{'Translations': 1},"I've decided to update the German PO files to update incomplete translations and fix a few mistakes.

Work done today."
2213575124,Add -Wunused-member-function,jj-marr,2024-12-03 20:11:10+00:00,2024-12-05 17:57:16+00:00,"{'Building': 1, 'CMake': 1}","Draft right now, making a PR for discussion purposes."
2211785008,Fix exception when opening MP a second time at low resolution,Mahoyomu,2024-12-03 03:29:17+00:00,2024-12-06 20:41:14+00:00,{'UI': 1},"### Goal of the PR
- Fix #9528 
### How does the PR work?
- By set the `horizontal_scrollbar_mode` in `chat_log_container` to auto. In my test, after simply setting it to auto, the crash issue is gone, and from my view it also avoids creating multiple new lines by line-feeding (which could be annoying to distinguish 
from `username: ` in chat box) when resolution is relatively low.
### Does it resolve any reported issue?
- #9528 
### If not a bug fix, why is this PR needed? What use cases does it solve?
- This is a bug fix.

## To do

Adjust possibly missed related method and changes I mistakenly made, remove redundant notes I used for quickly locating.

If resolving the issue this way is introduce more bugs I don't think of, I think I can also do it by either adjust more related code to resolve those bugs introduced, or impl it in the line-feeding way, to make the `reduced width` generated shrink, might also work imo.

This PR is Ready for Review.

## How to test
see changes in the src."
2211194835,"Elvish Champion: revert hp to 1.16, explain accuracy bonus via a weapon special",Dalas121,2024-12-02 19:54:04+00:00,2024-12-02 21:04:15+00:00,{'Units': 1},"Following the failed balance team vote for #9557, we held a follow-up vote for a partial reversion: lowering the Champion's hp to 1.16 and explaining his accuracy bonus via a weapon special. The follow-up vote passed 3-0, so I'm implementing it here.

I don't mean to block off any possible future reversion to 1.16's 9-5, if the balance team decides to vote differently in the future - but this is still hopefully an improvement over 1.18.

Resolves #8706

Since discussion about this topic has already taken place on #9557 and since a vote for this partial reversion has already been held, I'll merge this PR once the checks finish."
2210705075,fix clang-tidy warnings,babaissarkar,2024-12-02 16:00:38+00:00,2024-12-03 15:05:25+00:00,"{'AI': 1, 'MP': 1, 'Units': 1, 'Add-ons': 1, 'Help': 1}",Fixes leftover clang-tidy warnings that causes the CI to fail. (Most probably from #9618)
2209516357,Fix last breath events for Hahid and Grug,Thewodoros,2024-12-02 05:52:58+00:00,2024-12-02 16:21:56+00:00,{'Campaign EI': 1},"When Hahid dies, Grug or Dolburras, if present, say the ""eulogy"". There were problems in scenarios where they first appear (S06a for Dolburras and S07b for Grug) - they say it even before joining the player's side, which makes no sense. I changed the message tags in utils/deaths.cfg to use ""id"" and ""side"" instead of ""speaker"", so they only say it when they are on the same side as Hahid.
Also in S07b, Hahid's herodeath macro was duplicated, so the dialogue was displayed twice.
Also I changed Grug's herodeath to ""id"" and ""side"" and re-included it into S07b, so now Gweddry says the eulogy for Grug after Grug joins, but not before."
2209237598,Enable warnings as errors for scons,jj-marr,2024-12-02 00:45:04+00:00,2024-12-02 01:55:11+00:00,{},I didn't realize I could do this until now. This PR actually makes CI fail when there's a linter issue.
2209140740,Implement misc-const-correctness linter check,jj-marr,2024-12-01 21:11:51+00:00,2025-02-27 23:41:49+00:00,"{'AI': 1, 'MP': 1, 'UI': 1, 'Editor': 1, 'Units': 1, 'Lua API': 1, 'Add-ons': 1, 'WFL': 1, 'Help': 1, 'Schema': 1, 'Terrain': 1, 'Achievements': 1}","This linter check is relatively simple. If it is possible to declare a variable as `const` but that variable isn't declared as such, the linter will emit a warning. The linter also has an autofix for this issue, which is applied to the codebase in this PR.

Also present in this PR is an addition to `clang-format` that enforces a preferred qualifier order. By default, the linters autofixes will have the order `type const variable` and not `const type variable`. I grepped the codebase for `const int` and `int const` to see which is the preferred style, and it appears putting `const` first is the recommended method.

Additionally, this PR moves `src/.clang-format` to `.clang-format` so the linter can see the format file when applying fixes.

Documentation on the check: https://clang.llvm.org/extra/clang-tidy/checks/misc/const-correctness.html

https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#es25-declare-an-object-const-or-constexpr-unless-you-want-to-modify-its-value-later-on"
2208931397,1.19 - Coastal Raider (new ship),doofus-01,2024-12-01 13:37:53+00:00,2024-12-26 01:53:26+00:00,"{'Graphics': 1, 'Units': 1}","This is adds a ~Galley~ Raider, from #9367

I expect the config won't please everyone, but we must start somewhere and some sort of distinction between galleys and galleons seems appropriate."
2208694582,1.19 - Ships update (part 2),doofus-01,2024-12-01 03:28:42+00:00,2024-12-01 04:24:11+00:00,"{'Graphics': 1, 'Units': 1}","The primary driver for this is the contribution from @CobraLad - I'm calling it ""Galley"", I guess there could be variants with different names.  I made some changes that I felt were needed, but the sprites are 95% CobraLad.

There were also a few screw-ups in portrait image references that also need to be fixed.

Other things could be added later, maybe."
2208394163,Modern theme update,babaissarkar,2024-11-30 14:58:03+00:00,2025-01-09 03:32:42+00:00,"{'Graphics': 1, 'UI': 1}","* Updates various aspects based on feedback received in #9104
* Based on @Dalas121's design https://github.com/wesnoth/wesnoth/pull/9104#issuecomment-2294991431 but not an exact copy.
* Adds definitions for various highly used controls (but not everything)
* UI visible name for the themes have been changed: ""Classic"" -> ""Parchment"" and ""Modern"" -> ""Celes""
* The Classic/Parchment theme remains the same except for the name change and is still default.
* A preference key + checkbox and a close button in tips panel has been added to show/hide it.
(Note: this theme does not provide equivalents for all existing widget definitions, just a minimum baseline.)

![Screenshot from 2024-12-29 19-10-01](https://github.com/user-attachments/assets/601d1e5f-4a0f-4dd6-b9e2-34bd9dc29e3c)
![Screenshot from 2025-01-08 22-55-44](https://github.com/user-attachments/assets/f8c6aef4-92d3-458b-b578-6af72bc69b2d)
![Screenshot from 2025-01-08 22-55-37](https://github.com/user-attachments/assets/f758bb98-c23d-41cd-a4a3-a65339077e7a)
"
2206194533,Dwarvish Bloodaxe - add level 3 Berserker advancement,Dalas121,2024-11-28 17:59:43+00:00,2024-12-08 16:19:06+00:00,"{'Graphics': 1, 'Units': 1, 'Campaign THoT': 1}","Dwarvish singleplayer campaigns suffer from issues with variety. Campaigns frequently disallow Outlaws, Gryphons, and Ulfs, leaving only the basic Fighter/Guardsman/Scout/Thunderer available to the player. Without the elements that make the multiplayer Knalgan faction interesting and dynamic, campaign gameplay can suffer.

Ulfs in particular simply aren't useful in many campaigns. Campaigns rely on mulching through large numbers of enemies without losing your own veterans - completely different from the Ulf's role in multiplayer. Even if the player makes the effort to level up an Ulf, there's little reason to recall a Berserker, as berserk makes them hard to keep alive and steals XP from other units.

To help address this issue, I'd like to add a level 3 ""Bloodaxe"" advancement to the Berserker. Having a L3 advancement makes Berserker XP less wasted, and including drains helps to solve the campaign survivability issue - a skilled player's Bloodaxes can always be at full hp. 8-4 berserk drains is VERY strong, but I think it's a worthy reward for keeping your Ulf alive to L3 - and it only takes a single unlucky 1% chance for your veteran to die.

@doofus-01 thoughts on the art? ~~Sprites from the War of the Gods add-on by ChaosRider, with modifications by Dalas.~~ Sprites by Turin.

https://forums.wesnoth.org/viewtopic.php?p=695051

.

_""According to legend, the dwarvish bloodaxes were forged at the dawn of time in the great stone-fires of Dhur Darihm, when all Irdya was still drowned in flame and soot. It is with them that the first dwarves made war against the troll-mother, laying low her people and forevermore claiming dominion in the underearth._

_While the truth of this legend is a matter of debate, battlefield reports leave no doubt that such weapons exist, and that they confer great resilience upon their wielder. The dwarves’ few remaining bloodaxes are jealously guarded, passed down from father to son and reclaimed from the fallen even at great cost.""_"
2206180761,EI: add missing last breath (HERODEATH) events for Addogin,Thewodoros,2024-11-28 17:47:14+00:00,2024-11-28 22:38:00+00:00,{'Campaign EI': 1},"In S04a, the event is added within his original ""last breath"" event - the one which switches him to the player's side. Without this additional event, he will die silently if killed by the elves after being ""captured"".

In S11, it looks like the event for him was simply forgotten (HERODEATH events are added for all other heroes).

His HERODEATH event is also missing in S13, but I think that scenario needs a bit more of (related) changes, so I'll post those later in a separate pull request."
2204861093,Refactor utils::format_timespan to use chrono types,Vultraz,2024-11-28 04:23:09+00:00,2024-11-29 03:07:52+00:00,"{'MP': 1, 'Building': 1, 'WFL': 1}","Required a rather in-depth refactor since we're now dealing with distinct types for the different durations. This also adjusts the periods for years and months. Previously, we were using values of 30 days for a month and 12 months for year. Now, we use the chrono values of a month as 1/12 of a year and a year as 365.2425 days.

Requesting a review from Iris since she implemented the function originally."
2202191880,Use variables for deducting gold in EI S04b,Thewodoros,2024-11-27 00:49:16+00:00,2024-11-28 17:02:36+00:00,{'Campaign EI': 1},"These two variables are used everywhere else in this scenario, hardcoding the amounts here must've been a mistake."
2196905904,split undo actions into smaller steps,gfgtdf,2024-11-24 18:16:38+00:00,2024-11-30 21:45:33+00:00,{'Lua API': 1},"This commit splits undo actions into multiple smaller steps. The main advantages:
- Its allows us always undo the parts of an action in the reverse order of which
  they originally happen, preventing bugs that could be caused if the parts
  interact with each other in a way where the order matters (like for example
  an [on_undo] resetting a units moves, when the event happend in a move action
  which would then also reset the units moves on undoing).
- It's easier to add (c++) undo steps for specific steps even if they are used
  from wml, like spending gold.
- [do_command] no longer confuses the undo stack (in fact it's by default now undoable).
- All actions are put onto the undo stack in the same way, previously it was
  often unclear whether the undo stack is empty during a specific step  during
  the execution of an action, in particular when people tried to use
  `undo_stack->empty()` to check whether an action could still be undone.
"
2196620274,fix portrait references,doofus-01,2024-11-24 05:37:38+00:00,2024-11-24 06:38:07+00:00,{'Units': 1},"I messed up some image references in #9484, this should fix it."
2196348051,wesnothd: handle server IP bans more generically,Vultraz,2024-11-23 18:21:29+00:00,2024-11-26 14:13:58+00:00,"{'MP': 1, 'Add-ons': 1}","Instead of simply returning a string, `is_ip_banned` now returns a struct with an error code, ban reason, and ban time remaining. This avoids doing time duration formatting on the server and allows the error message to be localized on the client. It also makes the ban handling interface more generic in server_base, which should hopefully allow forum bans to be handled this way as well.

~Drops the tor IP list stuff from wesnothd, since it doesn't fit well into this new paradigm.~"
2195681198,Add medieval warship for naval scenarios,Jonathan-Kelly,2024-11-22 21:49:21+00:00,,"{'Graphics': 1, 'Units': 1}","A big 'floating castle' warship unit. Following the lead of the TRoW story art, this is based on a medieval vessel, the cog.

Currently, I am seeking feedback on what is needed to bring the sprite up to core quality standards. It is animated and playable in game (though you will need to add it to a scenario of your choosing).

![cog](https://github.com/user-attachments/assets/e8e25d9e-047e-4894-a9ee-b7a83999a2ac)

Planning on releasing it and its source/project files under CC0, Unlicense and/or WTFPL. Any other licenses are fine too."
2195473962,wesnothd: handle bans and IP spam instead of the base class,Vultraz,2024-11-22 19:32:32+00:00,2024-11-23 17:27:46+00:00,"{'MP': 1, 'Add-ons': 1}","These methods were only implemented for wesnothd anyway, and would do nothing for the addon server (campaignd). If we want bans for the latter, it would be better to do it with forum auth.

This also moves the handling for both internal and forum bans for the same place."
2195311721,Clean up Pango environment setup code shared between Windows and macOS,irydacea,2024-11-22 17:54:08+00:00,2024-11-24 19:32:44+00:00,"{'Windows': 1, 'macOS': 1, 'UI': 1}","This makes it so the Windows version also uses setenv with overwrite disabled so the environment can overrule our values if needed for testing/research purposes.

(Addendum to #9593.)"
2190590456,Fix wesnoth.units.create_animator issues with direction,Mahoyomu,2024-11-20 18:44:33+00:00,,"{'Units': 1, 'Lua API': 1}","### Goal of the PR
- Fix #9032, including make it possible to create moving animation similar to normal unit moving using the animator in lua. (where as initially there's teleport issue when using `impl_add_animation`, which is associated with #9163 and #9487)
### How does the PR work?
- By adding and updating facing direction change before and after running animation. (To make the target field work)
- By splitting out the generation of movement animation. (To keep the teleport issue from reoccurring at the same time)
### Does it resolve any reported issue?
- #9032
### If not a bug fix, why is this PR needed? What use cases does it solve?
- This is a bug fix, and maybe it also adjusts related features, to impl the not-working target field and add facing field.

## To do

Adjust possibly missed related method and changes I mistakenly made, remove redundant notes I used for quickly locating(all after this pr is nearly ready for review).

Merge the solution I made in #9487, so that I can leave the generation of movement animation to it.

Add and impl facing field, to handle the usage mentioned in #9032.

This PR is a Work In Progress.

## How to test
Compile and run, see the test video I might upload later if needed, or see changes in the src."
2190313177,Fix issues with hero deaths in EI S03,Thewodoros,2024-11-20 16:06:05+00:00,2024-11-20 17:08:36+00:00,{'Campaign EI': 1},"This scenario aims to have a custom dialogue if Gweddry or Dacyn are killed by Mal-Tar's side (event on line 294). The comment on line 339 suggests that their normal ""last breath"" events (HERODEATH macros) are added only after Mal-Tar is dead. However, these macros are also added at the bottom of the file (line 438). This leads to a couple of minor bugs:
* If Gweddry or Dacyn are killed by Mal-Tar, a chat message ""\<Lua\> Repeated [endlevel] execution, ignoring"" appears in the top left corner of the screen. That's because it is executed in both this scenario's ""die"" event, and the ""last breath"" included by the macro.
* If Mal-Tar is killed, the ""last breath"" events for both Gweddry and Dacyn are duplicated. So, if one of them is killed afterwards, you need to press the space button twice to skip the message; also, the same chat message about repeated [endlevel] appears.

The proposed changes fix both of these bugs. Notes:
* First I tried to remove the HERODEATH macros in the bottom of the file (as the aforementioned comment suggests), but that's an incorrect solution: if Mal-Tar is alive and Dacyn is killed by Mal-Kallat's or Mal-Skraat's side, you can continue playing without him. (With Gweddry it's still defeat because he's the leader.)
* The proposed code relies on the fact that if the ""last breath"" event executes the [endlevel] tag, the corresponding ""die"" event will still run before the ""defeat"" event. It works like this with my 1.18.3 executables, but I didn't test this on the master branch, and I didn't find this explicitly mentioned in the documentation like https://wiki.wesnoth.org/EventWML or https://wiki.wesnoth.org/DirectActionsWML"
2190138225,Switch default Pango/Cairo render backend to Fontconfig on macOS,irydacea,2024-11-20 14:49:06+00:00,2024-11-22 17:30:03+00:00,"{'macOS': 1, 'UI': 1}","Fixes #8488 based on my first suggestion there since there doesn't seem to be any particular interest around here in pursuing the second path — the issue has been dormant for months with multiple stable and development releases tagged in the meantime and a wholesale refresh of the main menu making it even more visible to users.

Ideally we would instead figure out how to fix Oldania ADF Std to work on newer macOS, but since we know the Fontconfig backend works for us on Windows and Linux, we may as well stick to it and hope there will never be a situation where CoreText would prove superior somehow.

This patch is equivalent to invoking Wesnoth with `PANGOCAIRO_BACKEND=fontconfig wesnoth`, with the difference being that we don't overwrite the environment variable if it already exists (e.g. because someone wanted to test CoreText again with `PANGOCAIRO_BACKEND=coretext wesnoth`). Worth noting that `fontconfig` and `fc` are synonymous values in Pango (see the [source](https://github.com/GNOME/pango/blob/5d23702cc822ddf4c0e9c144e384c46be92f1e8b/pango/pangocairo-fontmap.c#L89) of `pango_cairo_font_map_new()`).

(Side note: I feel like the Windows-specific hack right above it should adopt the same approach and let the environment overrule the devs — currently it uses `putenv`, which is a forced overwrite of the existing environment. Not sure who to tag to gauge their opinion on this.)

### Backport plan

In my opinion, this should be backported to 1.18 after there's been a development release shipping it that hasn't caused any reported regressions for a couple of weeks. Preferably, of course, I'd hear from people on different macOS versions testing this before merging, but that might be hoping for too much since nobody else in the dev team seems to actively run dev builds on macOS — for a very flexible definition of ""actively"" on my part, anyway."
2189640278,give active_on and special filters to leadership,newfrenchy83,2024-11-20 10:48:25+00:00,2024-11-23 22:35:38+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1}","Here I suggest that [leadership] can use active_on, but also filter opponent characteristics other than the weapon used."
2187799914,draw: dashed lines w/ arbitrary pattern,white-haired-uncle,2024-11-19 15:02:08+00:00,2024-12-04 23:46:05+00:00,{'UI': 1},"Adds drawing dotted/dashed lines based on a supplied bitset, as mentioned in #9238.

Silly example.  You really have to scroll in to see the lines based on two points.
![Untitled](https://github.com/user-attachments/assets/9f328ea1-97a3-4499-abc7-7e1cbf97b446)
"
2187716907,[1.18] Map Editor terrain button click fix (#1335),stevecotton,2024-11-19 14:26:01+00:00,2024-11-19 16:16:33+00:00,"{'Editor': 1, 'Input': 1}","Backport of #9560, opening a PR to run the CI.

Fixed palette button not being clickable after scrolling in palette widget without moving the cursor. Resolves #1335. The cause of the bug was that scrolling doesnt change the highlighted state of the palette buttons and not highlighted buttons didnt process being clicked. Solved the bug by making not highlighted buttons process being clicked.

(cherry picked from commit 484116ea09ab3bf0ac6cddd5340458dd91ea8730)"
2187446377,add preprocess_string method and use preprocessed loyal trait,babaissarkar,2024-11-19 12:19:32+00:00,2024-11-24 15:51:12+00:00,"{'Docs': 1, 'UI': 1, 'Editor': 1}","Resolves #9580.

Adds a `preprocess_string` method that allows to run the preprocessor on a string. Example:
https://github.com/wesnoth/wesnoth/blob/0088534cd91b4331fe0ed5e9fcf992e93a1b8ea8/src/editor/map/map_context.cpp#L762

Also, the Loyal trait will now be written inside `[modifications]`.

TODO:
- [x] Add a command line option to preprocess a string"
2183568007,Revert of the Arcane Resistance Rework (partial revert) + Additional 1.20 arcane balance,ForestDragon-wesnoth,2024-11-17 09:29:51+00:00,,{'Units': 1},"This PR mostly reverts the controversial 1.18 arcane rework back to 1.16-like (and existing since version 1.4 for 15 years) values of arcane resistances, with exceptions and damage changes listed at the bottom of the description.

**Reasons for the revert:**



1. **How the change was designed/handled during the 1.17 dev builds:**

While the arcane rework was still being designed/PR-ed, it got an extremely low amount of comments (4 on the forum thread (half of which are from the creator of the rework), and 13 comments on the github PR) for such a colossal change, but after 1.18 release it got quite significant backlash.

https://forums.wesnoth.org/viewtopic.php?t=57075

https://github.com/wesnoth/wesnoth/pull/7801

The reasoning provided in the original forum thread also seems rather vague and far insufficient to justify such a major change being made to the game in the first place - ""changing all the resistances to better fit the growing needs of PvE and PvPvE, as well as potentially help with introduction of arcane based units on lower levels."".

If by PvPvE the MP Lead means things like Afterlife, that popular custom gamemode already has its own custom era to better fits the specific needs of such gameplay.

""potentially help with introduction of arcane based units on lower levels"" becomes irrelevant if arcane becomes basically ""fire that can also harm drakes"" - at that point you just get an orc archer equivalent (pierce + fire, with drakes having -10% to pierce/arcane) with extra steps. There is no point of introducing arcane if the damage type itself no longer introduces anything interesting.



2. **Loss of the original design/uniqueness/theme:**

What was once arguably the most interesting and unique damage type in the whole game, now feels more like a slightly different variant of fire damage that drakes aren't resistant to, but is almost indistinguishable from fire when fighting undead - skeletons/ghouls have identical resistances to those damage types, and for the majority of units the resistance to it now ranges between -20% and 10%. The only exception among the undead are walking corpses, which were just lucky enough to not get reworked before the 1.18 feature freeze.

In return, while being weaker against undead/magical units it previously countered, it instead is now slightly better against humans and many other non-magical living beings that had 20% arcane resistance before. 

As a result, units that relied on arcane damage went from specialists into generalists (especially if the base damage was also increased. for example, the rather infamous but now-partially-reverted 16x5 sylph buff, or the much more moderate example of paladin being buffed from 8x5 to 9x5 which combined with the human arcane resistance nerf makes him noticeably better against other humans)



3. **Impact on UMC content:**

The arcane resistances in question were consistent from version 1.4 (released in 2008) until the 1.17 dev build (2023), spanning 15 years of Wesnoth's development. The 1.18 rework fundamentally altered these resistances at the movetype level, affecting not only mainline units but also lots of custom human/undead units in UMC.

This is particularly significant because modders have relied on the pre-1.18 arcane resistance values for over a decade. Custom factions, campaigns, and scenarios were built with the expectation that arcane resistances were stable. Altering them so drastically disrupts balance across many add-ons unless developers explicitly override the new defaults.

There have also been multiple modders intentionally switching from mainline movetypes to custom ones to not have to deal with the controversial 1.18 changes (including Era of Magic, the most popular custom era getting such a change https://github.com/inferno8/wesnoth-Era_of_Magic/commit/2b7a547409814c95414e7c5e4c734bada62a4aa9#diff-803eb6e240fed7ba525943e203392d9f370af6ac39c0f753d20ba166199b11bd )

For mods still relying on default movetypes, this PR would simply revert resistances to their pre-1.18 values. Since most add-ons on the server are ports of content created before 1.18, they are generally already balanced for 1.16 or have earlier versions available as reference if adjustments were made for 1.18.

Previously the design approach of mainline balance was smaller and rarer changes, which resulted in mainline being a very stable foundation to build on top of. 1.18 broke that trust, and now mainline is no better than using a custom era as a dependency.

Thus, reverting arcane resistances to their 1.16 values would be far less disruptive for UMC than the 1.18 rework itself.

4. **The Damage Itself:**

SECTION 4 IS CURRENTLY SPLIT INTO A COMMENT HERE, TO KEEP THE PR DESCRIPTION SHORT ENOUGH: https://github.com/wesnoth/wesnoth/pull/9585#issuecomment-2481236505





Alongside resistance reverts, the PR also includes damage nerfs to certain units with arcane attacks who got buffed in 1.18 around the arcane rework:

enchantress: 11x4 > 9x4 (1.16 value)
sylph: 13x5 > 10x5 (1.16 value)
paladin: 9x5 > 8x5 (1.16 value)

~~necromancer shadow wave: 16x2 > 13x2 (not 1.16 value. necromancer's cold attack got buffed from 17x2 to 19x2 in 1.18. since the necromancer changes are outside the scope of this PR, I set it to 13x2 to keep a similar ratio between cold/arcane damage as on lvl1-2)~~

additional damage nerfs as requested by Dalas:

mage of light 12x3 > 11x3
mermaid diviner 8x4 > 7x4



Changes compared to 1.16 based on balance team/community feedback in the discussion:

Undead: -40% arcane (to be more in line with balance team's wishes)
Ogres: 10% arcane resistance instead of 20% (1.18 value)


EDIT: excluded the enchantress/sylph/necromancer damage changes for now

EDIT2: implemented some changes based on balance team/community members' feedback from this discussion

EDIT3: I will adjust difference changes later, currently there is some confusion with multiple PRs

EDIT4: Adjusted text to reflect current stats"
2181066966,wesnothd: use std::chrono instead of the C time API,Vultraz,2024-11-15 05:43:09+00:00,2024-11-20 06:03:42+00:00,"{'MP': 1, 'Add-ons': 1}","Still a few things to clean up, but mostly complete. Functionality should be unchanged."
2178767840,Change Human Ranger and Huntsman,Dalas121,2024-11-14 03:10:59+00:00,2024-11-16 21:55:38+00:00,{'Units': 1},"These Ranger changes are an attempt to raise his power closer to the Master Bowman or Elvish Avenger, while also cementing his role as a wilderness rover - powerful in the wild but vulnerable in castle/village.

These Huntsman changes are an attempt to help him better-fill the role of a frail mage-equivalent for the bandits (who otherwise lack Marksman/Magical), while adding some hunting flavor and a useful niche with ""swamp lurk"".

"
2176029810,EI S01 story: Fix outposts locations accorting to campaign map,Thewodoros,2024-11-13 00:18:45+00:00,2024-11-13 01:49:29+00:00,{'Campaign EI': 1},"The outposts are east of River Weldyn in the campaign map. Also, in scenario 1, the castle is east of the river. The heartland of Wesnoth country is west of that river, so the  eastern bank is the ""far"" one.
These words date back to the original campaign design by Eric S. Raymond. Back then, the campaign map had the outposts on the western bank of Weldyn.
But in aeb9ec7 the map was replaced with a newer one, with outpost on the eastern bank, which persists to this day with some minor changes (like the southern outpost was moved futher south)."
2175900665,EI S02: Avoid creating unit with same id twice,Thewodoros,2024-11-12 22:54:24+00:00,2024-11-13 00:53:14+00:00,{'Campaign EI': 1},"In the existing code, on HARD difficulty, creating a unit with id=""Hur"" is done twice, first as a Troll Whelp, then as a Troll Rocklobber. As a result, the former unit is replaced with the latter one. As they are created at the same coordinates, I believe this is the intended behavior.

But according to https://wiki.wesnoth.org/SingleUnitWML , reusing the id ""may produce unpredictable results in many cases"". For example, (I tested it) if you create the new unit at the different coordinates, it instead appears at the former unit's coordinates.

I've added another preprocessor directive, so the unit with this id is created only once on both NORMAL and HARD."
2173992435,Delay cleanup,Vultraz,2024-11-12 04:08:13+00:00,2024-11-12 05:19:44+00:00,"{'Units': 1, 'Lua API': 1}","Removes the `--no-delay` launch option, as well as the 200ms gameloop delay when the window isn't visible."
2173918570,Synced run refactor,gfgtdf,2024-11-12 02:37:53+00:00,2024-11-17 20:30:22+00:00,{'AI': 1},"the main intention here is to refactor the code a bit becasue
- it previously had a lot parameters that weren't really needed, and also 
- now all actions run though synced context::run,
so that we not only have a central place that happens before/after
synced actions, we also guarantee that there is no difference between
the original and the replay codepath for all actions.
- the pr also fixes a bug that caused oos in undoable menu items.
"
2173907409,markup: don't escape internally and update docs,babaissarkar,2024-11-12 02:25:51+00:00,2024-11-14 05:00:36+00:00,{'UI': 1},"Internal escaping causing markup failure when tags are nested. See #9569 and #9572 for example. Functions in markup will no longer escape their contents, and those should be escaped by caller if needed."
2173652206,Convert animation code to use chrono types,Vultraz,2024-11-11 21:41:39+00:00,2024-11-12 02:46:15+00:00,"{'Units': 1, 'Terrain': 1}",Follow up to #9519. I wanted to handle it separately since it touches so much.
2172805865,fix malformed markup in unit_list and unit_recall,newfrenchy83,2024-11-11 13:11:31+00:00,2024-11-11 15:33:10+00:00,{'UI': 1},error cause to show text of color code instead of use for color level number(same fix what for https://github.com/wesnoth/wesnoth/commit/37b7a83ce08f34f3fcc5036b9e16f824d234355f#diff-010538c81e10d3e4eeadfb49808ab52a6fe1becc787cb247c6a854b8f4c1900aL104)
2172337880,[SotBE] Enable Saurian Spearthrower for Saurians,knyghtmare,2024-11-11 09:27:08+00:00,2024-11-11 13:58:50+00:00,"{'Enhancement': 1, 'Campaign SotBE': 1}","### Part of the SotBE Refinements
- Players have complained about the lack of unit variety in this campaign. We know Orcs as a whole don't have much units in core so might need to come in the add-on package.
- Saurian Augur can go all the way to level 3 by default. The Skirmisher on the other hand has this advancement blocked by a macro. We enable this advance to partially mitigate the complaint.
- Also, The acquisition of saurian recruits is optional by itself (you can just abandon Inarix by blowing the bridge really early). So, the impact of this minor."
2172050769,Add missed preference,Pentarctagon,2024-11-11 06:33:23+00:00,2024-11-12 23:38:07+00:00,{'Engine': 1},Fixes #9567
2171770100,fix malformed markup and remove another hardcoded one,babaissarkar,2024-11-11 01:51:00+00:00,2024-11-11 02:54:51+00:00,"{'MP Lobby': 1, 'UI': 1}","Resolve #9568.

![Screenshot from 2024-11-11 07-11-11](https://github.com/user-attachments/assets/0dd99c0a-daa1-44ca-9922-b06f1326e2d7)
"
2171611350,fix #9561 OOS when undoingin multiplayer,gfgtdf,2024-11-10 20:38:43+00:00,2024-11-12 01:03:45+00:00,{'Engine': 1},"previously in `undoable_action->undo(side_) ` the undo stack was not in sync with the relpay stack becasue the code called `undos_.pop_back();` before that and `resources::recorder->undo_cut` after that, this could confuse the code which sends replay commands to the other clients."
2171574118,Add missing keys to the schema,soliton-,2024-11-10 19:07:06+00:00,2025-01-16 13:03:24+00:00,{'Schema': 1},
2171429790,Map editor segmentation fault fix,SomeName42,2024-11-10 12:20:47+00:00,2024-12-06 20:39:47+00:00,"{'AI': 1, 'Editor': 1}",Fixed map editor crashing when creating or opening scenario after played local scenario before opening map editor. Resolves #9563. The cause of the bug was that the ai manager singleton pointer was not set to nullptr after it was destructed. Fixed this by making ai manager destructor set singleton to nullptr. Before this the ai_map_ map member has to be cleared in destructor because it might try to access the singleton when destructed.
2171136972,Editor terrain button click fix,SomeName42,2024-11-09 19:09:40+00:00,2024-11-19 14:20:31+00:00,{'Editor': 1},Fixed palette button not being clickable after scrolling in palette widget without moving the cursor. Resolves #1335. The cause of the bug was that scrolling doesnt change the highlighted state of the palette buttons and not highlighted buttons didnt process being clicked. Solved the bug by making not highlighted buttons process being clicked.
2169846670,add recursion_guard in [filter_(second_)weapon] for [leadership] and [resistance] abilities.,newfrenchy83,2024-11-08 15:02:52+00:00,2024-11-11 13:32:05+00:00,"{'Unit Tests': 1, 'Units': 1}",In moving recursion_guard from matches_filter() to special_unit_matches() i has forgotten what [leadership] abilities called directly matches_filter().
2168978603,[Units] Tweak Elvish Champion Stats,ForestDragon-wesnoth,2024-11-08 07:44:36+00:00,,{'Units': 1},"This PR reverts the 1.18 changes to the Elvish Champion:

melee attack: 8-5 10 accuracy > 9-5

Elves already have access to two other chance-to-hit specials (marksman + magical), more than most factions, they don't need a third one, and especially 5-strike attacks with accuracy bonuses (sharpshooter/sylph)

Making the damage 9-5 also ensures the total max damage of champion is higher than Marshal (otherwise it is 40 vs 40 for both)

On top of that, Champion has always been the elf race's tough brute-force unit, and 5 strikes already offers a lot of the advantages that a cth bonus does.

hp 72 > 70

The hp buff in 1.18 was mainly needed to compensate marshal getting buffed from 62 to 68, resulting in a 4-hp gap between the units. now that PR #9512 was merged and nerfed Marshal hp from 68 to 60 in return for +1 MP, 70hp results in a 10-hp gap between the units, making them more than distinct enough."
2165326311,schema/gui/generic - use f_color,white-haired-uncle,2024-11-06 14:27:07+00:00,2024-11-17 17:07:22+00:00,{'Schema': 1},"Updated to match canvas_private.hpp

Also noticed this on line 94, for drawing object [line]

`{DEFAULT_KEY ""alpha"" f_unsigned 255}`

couldn't find any reference to this in the code or wiki?"
2164526791,Add a red line to the bottom of chat window when entering lobby,Mahoyomu,2024-11-06 07:25:47+00:00,2024-12-03 15:10:25+00:00,"{'MP Lobby': 1, 'Translations': 1, 'UI': 1}","### Goal of the PR
- Add a red line to help distinguish the old msgs (Based on the discussion of adding redlines as referenced in #9211）
### How does the PR work?
- By making sure every time the chat log is loaded, there's a red line at the bottom of chat window. 
### Does it resolve any reported issue?
- It's a feature from discussion in #9211.
### If not a bug fix, why is this PR needed? What use cases does it solve?
- While keeping the old msgs when entering lobby, some UI clarification on what are old messages would be expected according to the related discussion in #9211.

## To do

Adjust possibly missed related method and changes I mistakenly made. 

If there's a better idea about the details of red line content, it's perhaps also okay to replace existed red line content with that.

This PR is Ready for Review.

## How to test
Compile and run, see the test video I might upload later if needed, or see changes in the src."
2163867888,GUI2 stacked_widget - add length operator,white-haired-uncle,2024-11-05 20:34:09+00:00,2024-11-06 02:59:25+00:00,{'Lua API': 1},"Simply adds the ability to do something like `#dialog.my_stacked_widget`.

I started out wanting to make the sw more like other container widgets, where you could add and remove layers, etc.  Removing is simple, adding not so much.  I really can't think of any good use cases for adding layers, other than perhaps removing and adding layers as a way of changing the order of layers.

Along the way I found that the stacked_widget seems to be a little odd, particularly from the Lua API.  FWIW....

WML/LUA:
Initially, all layers are visible, selected_index returns 0, and events go to last (highest index) child.  Widgets may be made in/visible using sw[3].id3.visible (this is acting on the child widget, NOT the stacked_widget).

If you set selected_index (say =2), that widget becomes the only visible widget (irrespective of, for example, sw[3].id3.visible).  While you can still set sw[3].id3.visible, you won't actually see it, sw:find(""id3"") now fails (for any but the selected widget), etc.  You can set selected_index to 0 to make all children visible/""active"" (active in the stacked_widget sense) again.  I do not believe you can make 1 < N < #sw children visible/active, though this appears to be possible in cpp via `select_layers(const boost::dynamic_bitset<>& mask)`.

So it appears in Lua, a stacked_widget has two ""modes"".  1) one active/visible layer - basically a multi_page (or perhaps a MP + size_lock).  2) All layers visible (though you could manually set individual children to invisible).  I'm almost okay with this, except that you can't choose the layer to receive events.

At least that's what it looks like to me."
2159666438,Polishing the visual highlighting of reachable hexes,Descacharrado,2024-11-03 14:39:15+00:00,2025-02-02 18:48:10+00:00,"{'Graphics': 1, 'Terrain': 1}","This PR:
- Makes it so the reachmap highlighting does not cover enemy units (as they are unreachable)
- Adds a differenciation between the blue tinting (or shading) and the blue border, so the tinting is below units and the border is still above elevated terrain (most noticeable in caves).
- Redefines the used layers to improve maintainability.
- Avoids weird interaction between hover-hex visual objects and the reachmap border.
- Changes the color of the reachmap border when an unit is detected.

![untitled](https://github.com/user-attachments/assets/a11048f1-5b21-4d74-a39a-4afc2207bae7)


Closes #9523 "
2159492838,Reconvert background.webp from the original jpg and add metadata,babaissarkar,2024-11-03 04:05:37+00:00,2024-11-04 05:51:49+00:00,{'Graphics': 1},
2159444431,"Add ""After The Fall"" era featuring Dunefolk and Quenoth while removing Dunefolk from Default Era",Jonathan-Kelly,2024-11-03 00:26:55+00:00,,"{'Graphics': 1, 'MP': 1, 'Audio': 1, 'Units': 1, 'Lua API': 1, 'Campaign UtBS': 1}","Also tentatively adds Drakes to the new After The Fall era to fill the role of a third faction (since they also do well on sand heavy maps).


## Motivations

### Create a place for new game mechanics and balance goals to be explored:
* real ranged attacks
* area-of-affect attacks
* finer terrain movement cost system (as [suggested](https://github.com/wesnoth/wesnoth/pull/8688#issuecomment-2059383549) by @soliton-)
* better mirror match ups
* more abilities and specials per unit
* concepts from [Project Haldric](https://github.com/Byteron/haldric-next)


### More room for additional factions after Dunefolk.

Each new faction added to an era greatly increases balance complexity, so if adding a 7th faction to Default Era is already highly questionable then adding an 8th would be rather insane. At the same time, you need a minimum of 2 or 3 factions to get a new era started. Using Dunefolk and Quenoth to start a new era opens room for 3 or 4 addition factions to be added over the next decade of Wesnoth development. Possibilities include a version of the Clockwork Dwarves or one based on the Ixthala demons as replacements for the Undead (as suggested by dashomew/matto).


### Neatly fit Dunefolk into the Lore in a meaningful way.

The Dunefolk's fear of magic is clearly justified if they are the human survivors of The Fall, with their world having been ruined through the use of magic, while tyrannical magical entities dominate what is left. Other After The Fall factions can be made more fantastical and magical to better contrast with and highlight the thematic mundane-ness of the Dunefolk. Whereas Default era already has many non-magical units and even whole factions like the Knalgan Alliance and Northerners, so adding the Dunefolk to that time period does little for them or it.

Having an After The Fall era helps fill out the UtBS time period and make UtBS feel more ""canonical"" compared with the rest of the mainline campaigns. Units, abilities and specials made for After The Fall era can be used in the creation of additional campaigns set in UtBS's time period, too.


### Avoid imbalancing the venerable and tightly balanced Default era.

Default era has been stable and nearly unchanged from 1.8 (released in 2010) to 1.14/1.16 after having been put through numerous tournaments back when the competitive community was large and thriving. Wheras the Dunefolk faction is very poorly tested in highly competitive environments, having been rarely if ever used in tournaments and not adopted by the competitive community. It is likely poorly balanced compared to the classic six factions.


### Avoid needlessly antagonizing fans of classic Default era.

We don't need to try to force/trick fans of the classic 6 faction Default era (and its derived balance mods used in the tournaments) to play an experimental faction in order to advance mainline multiplayer. A new era allows for fresh multiplayer content to be created without further upsetting traditional players as #8688 is otherwise likely to do when 1.20 is released.

The highly unpopular 1.18 and (proposed) 1.20 changes to Default era units have already caused enough controversy, distrust and division. We should be moving away from this kind of approach.


## Art Limits

One thing we might strive for with this era is more judicious use of unit sprites, since they are the biggest cost of a multiplayer era. Some ideas:
* fewer units per faction (4-6 rather than 6-8)
* use existing mainline sprites (scorpion, jinn, fire guardian)
* use sprites from user made content"
2159189188,Fixed an error in [filter_special] encoding,newfrenchy83,2024-11-02 14:53:46+00:00,2024-11-03 18:42:23+00:00,"{'Unit Tests': 1, 'Units': 1}","In special_id/type without the _'active' suffix only the encoding of the special in the attack is checked, and therefore the specials encoded in the [abilities] tags are de facto excluded, except that I forgot this logic in [filter_special] and I have to fix my error before updating the wikia."
2156266658,Remove fallback logic from alignment_str() to work the same as alignment() ,newfrenchy83,2024-10-31 13:28:39+00:00,2024-11-05 01:09:59+00:00,{'Units': 1},"copied from @soliton- PR but with documentation corrected.
No caller was adjusted since IMO this is the correct behavior."
2156080220,Buff Dune Warmaster,Gothyoba,2024-10-31 11:41:20+00:00,2024-12-23 14:38:10+00:00,{'Units': 1},Fixes #9533
2154961064,Sicarius - replace Deflect with Guard,Dalas121,2024-10-30 20:34:44+00:00,2024-11-08 00:26:21+00:00,{'Units': 1},"I have three main goals with this PR:

1) remove Deflect. I support adding new specials to core, but because Deflect and Absorb overlap while being barely used, I believe they should not coexist. Since Absorb features prominently in #9529, I would like to remove Deflect instead.

2) add another instance of Absorb. As a new special, Absorb is currently only used on the Naga Guard line. Adding it to the Sicarius as well will make Absorb more mainstream, and establish it as a Naga specialty.

3) further differentiate the Sicarius and Zephyr, by leaning into the 1.18 Sicarius's unusual melee resilience.

For the record, I dislike the name ""absorb"" as well as having a varying {AMT} effect. However, I feel that changing either at this point would risk completely breaking any UMC that uses Absorb."
2154889913,Fix the attack_end event in Liberty S5,Thewodoros,2024-10-30 19:54:23+00:00,2024-10-30 23:26:23+00:00,"{'Backport': 1, 'Campaign L': 1}","The event never fired because it has to use side 3 (side 2 is idle). After fixing that, the event fires, but the IF_VAR statement is always false unless you remove the dollar sign."
2154784801,Improve Naga Guard line,MechanicalDragon963,2024-10-30 19:07:32+00:00,2024-11-07 22:33:23+00:00,{'Units': 1},"This PR based on issue https://github.com/wesnoth/wesnoth/issues/8992 
All stats already discussed with @Dalas121 
"
2150283997,Delete the obsolete comment about Dune Piercer,Discontinuum,2024-10-28 22:42:29+00:00,2025-01-29 21:45:16+00:00,{'Campaign WC': 1},"I believe this comment is no longer relevant, Dune Piercer is no longer used by WC"
2149168295,"Revert ""SoF S7: fewer and slower enemy outriders""",Jonathan-Kelly,2024-10-28 13:19:21+00:00,2024-11-08 00:40:26+00:00,{'Campaign SoF': 1},"This reverts commit b3802f44ea1d50364c83e00d207e8dcef04645b4.

Since commit 70df290 restores the Elvish Outrider to essentially its original stats, the 1.18 balance fix for this one campaign scenario is no longer useful."
2149105653,Better description for absorb.,rodolphecombe,2024-10-28 12:49:45+00:00,2024-11-07 18:51:26+00:00,{'Units': 1},"Absorb special is currently the only variable special of mainline.
Because of that its current description is confusion, not stating the value of prevented damages. 
This PR solve the problem by making two separate specials ""absorb 40%"" and ""absorb 25%"" and changing the two units that are using them accordingly.
Another option was to change the description to take into account the amount but that would introduce a variable value inside a translatable string. 
Absorb could be kept as deprecated for a few version if needed. "
2147953703,Chrono type refactor,Vultraz,2024-10-28 00:24:18+00:00,2024-11-07 16:10:13+00:00,"{'AI': 1, 'UI': 1, 'Editor': 1, 'Lua API': 1, 'Add-ons': 1, 'WFL': 1}","Initially, this was just going to affect events::pump_monitor, but in order to convert that, I had to convert the places using pump_monitor::ticks(), and it spiraled out from there.

In terms of behavior, everything should be the same, save that pump_monitor::ticks() now records a steady_clock value when created instead of being lazily initialized on first call."
2147740256,help browser: add toggle for showing/hiding contents in 800x600,babaissarkar,2024-10-27 14:18:22+00:00,2024-10-30 17:28:59+00:00,"{'UI': 1, 'Help': 1}","Resolves #1826.

Not perfect by any means, but as discussed in the issue, adds a toggle to show/hide the topic tree. Also, by default, the tree is hidden in lower resolutions. It hides itself again after a topic (not a section) is opened. By low resolution, I mean a window width of 800 or lower. In higher resolutions this option is not visible.

![Screenshot from 2024-10-28 15-35-13](https://github.com/user-attachments/assets/b8d0a8a4-2b36-402a-9177-76b3665a4c8e)
![Screenshot from 2024-10-28 15-35-03](https://github.com/user-attachments/assets/522a56d2-7efd-40c6-bef8-c8cf5ca33afd)

"
2147701435,unsuccessful whisper no feedback fix,SomeName42,2024-10-27 12:51:03+00:00,,"{'MP': 1, 'MP Lobby': 1, 'UI': 1}",Resolves #9049. The source of the error was trying to add message to the current whisper room with the add_chat_room_message_received function which is not meant to be used with whisper rooms. The error was solved by checking if the current room is whisper room and in this case selecting the lobby. There was an other error because during staging there is no lobby. This was solved by checking if the lobby room exists and if it doesnt then sending the message to the 'this game' room. Furthermore when receiving the cant find user message from the server the associated whisper room is closed.
2147425930,Events stuff,Vultraz,2024-10-26 19:47:41+00:00,2024-10-27 03:47:10+00:00,{},"Probably going to add more to this. Main functional change is using native SDL handling for double clicks, which means the click radius has bumped to 32px. Double click time remains unchanged (500ms), though I think SDL queries it from the OS on Windows (https://github.com/libsdl-org/SDL/blob/SDL2/src/events/SDL_mouse.c#L49-L75). Shouldn't be an issue though."
2147313915,sound source zero fade rangefix,SomeName42,2024-10-26 15:19:40+00:00,2024-10-26 21:13:18+00:00,{},Resolves #9453. Sound source full_range and fade_range are now allowed to be 0. When fade_range=0 division by zero prevented.
2147118006,Tweak Elvish Marshal Stats,MechanicalDragon963,2024-10-26 07:54:23+00:00,2024-11-07 02:50:32+00:00,{'Units': 1},"Since the 1.18 elf enhancements were deemed excessive and received a rollback of one sort or another, there is no reason to leave Marshal in an over-enhanced form. 

However, a full rollback to 1.16 was found to be controversial. I propose a different solution: 

```
HP: 68 -> 62 
MP: 5 -> 6 
```

This way, Marshal will lose some combat power, but will become stronger as a leader. This will emphasize his differences from the Champion and equalize both options in terms of strength. "
2146966159,Update Xcode build settings,cooljeanius,2024-10-26 00:44:09+00:00,2024-10-27 03:35:10+00:00,"{'macOS': 1, 'Building': 1}","PR #9510, take 2:
In attempting to address https://github.com/wesnoth/wesnoth/issues/9478 I opened the Xcode project, and while I didn't see the build setting in question for that issue, it did prompt me to make some other changes to the build settings... just opening this PR to see what sort of effect the changes have on CI...
"
2146963026,Update Xcode build settings,cooljeanius,2024-10-26 00:35:11+00:00,2024-10-26 00:41:37+00:00,"{'macOS': 1, 'Building': 1}","In attempting to address #9478 I opened the Xcode project, and while I didn't see the build setting in question for that issue, it did prompt me to make some other changes to the build settings... just opening this PR to see what sort of effect the changes have on CI...
(also some submodule changes slipped in here by accident; they can be ignored)
"
2146669129,Nerf of Orcish Crossbowman,Discontinuum,2024-10-25 20:29:40+00:00,2024-12-23 18:30:24+00:00,{'Units': 1},"The changes of Orcish Crossbowman made in 1.18 increased the power of this unit disproportionately. When advancing lvl 1 Orcish Archer, his melee damage rises extremely fast (3 times, from 3-2 of Orcish Archer to 6-3 of Orcish Crossbowman, which is unprecedented).

Also, the new xp requirement for advancing to level 3 is 43 (compared to 80 in 1.16), which is very close to lvl1-to-lvl-2 values. It becomes near-advancement after just several kills, which makes fighting him extremely troublesome.

My proposal is to set leveling XP to 57 (-10 xp compared to Orcish Warrior's 67 xp, like Orcish Archer-Orcish Grunt xp reqs) and to return 4-3 melee attack as it was in 1.16. I keep 1.18's increased hp (46 compared to 1.16's 43) and increased ranged pierce attack (9-3 vs 1.16's 8-3) because I believe those two were enough to make Orcish Crossbowman stronger without breaking things.

Regarding gold cost: in 1.16 he cost 21 gold, and after 1.18's buffs his price became 22 gold. I find just +1 gold completely unreasonable and weird for such substantial buffs. But after my nerf I think 22 gold becomes a reasonable price, so I let it stay unchanged."
2146554734,Bump vcpkg baseline,Vultraz,2024-10-25 19:04:48+00:00,2024-10-25 21:01:27+00:00,{},Let's see if this fixes the recent glib build issues...
2146048787,Balancing Update to Dwarvish Miner,Gothyoba,2024-10-25 14:41:53+00:00,2024-11-30 21:09:34+00:00,{'Units': 1},"Intended to compensate for high gold.

HP 22 -> 24
Attack 4x3 -> 5x3"
2145559465,Make sure Elvish Race Description doesn't contradict WoF,Gothyoba,2024-10-25 10:40:26+00:00,2024-10-27 07:57:28+00:00,{'Prose': 1},"https://github.com/wesnoth/wesnoth/blob/master/data/campaigns/Winds_of_Fate/story/Past_and_Future_Drake_History_(Spoilers).txt

This contradicts the unused drake history file in WoF, which shows the elves appeared after many other races, like drakes, trolls and many others.

CC: @Dalas121"
2145483327,Demote Dawarf to level 0,Gothyoba,2024-10-25 09:59:41+00:00,2024-12-06 20:35:07+00:00,"{'Units': 1, 'Campaign UtBS': 1}","This unit far too weak for a level 1, with only 22HP, relatively terrain defenses and resistances and a only 6x2 meele attack. I know it's only a joke unit, but I'd still like it if the stats made sense.

I propose the following changes:

-Decrease level from 1 to 0.
-Decrease XP from 50 to 25 so it makes more sense with the new level.
-Reduce gold from 17 to 12 like in Venomous Sands. They aren't recruited in-game, but I think it's still good to have a cost that is sensible for its level."
2145312636,Tutorial UI improvements,babaissarkar,2024-10-25 08:31:42+00:00,2024-11-02 07:26:29+00:00,"{'Graphics': 1, 'UI': 1, 'Help': 1, 'Campaign Tutorial': 1}","Uses portraits in the character selection dialog. Clicking on pictures selects the unit. Buttons are removed.
![Screenshot from 2024-10-28 17-58-32](https://github.com/user-attachments/assets/46bbb0b5-611f-4d80-901f-a6ae7cd0a711)

Adds a dark background to hint messages.

Adds marker to show which unit should be clicked at the beginning.


https://github.com/user-attachments/assets/69da30ee-7543-41cc-b7fd-e94c1d9eb119

"
2145147461,Deploy utils::erase_if,Vultraz,2024-10-25 06:56:47+00:00,2024-10-25 08:03:23+00:00,"{'AI': 1, 'MP': 1, 'UI': 1, 'Units': 1, 'Add-ons': 1}",
2144541520,Fix assertion error on [allow_undo] misuse,gfgtdf,2024-10-24 21:08:30+00:00,2025-07-28 14:24:25+00:00,{'WML': 1},"Previously it could happen that the replay recorder was not at end after redoing if redo() pushed additional user choices to the recorderwhihc were not used by the actual code (this can happen if the game is out of sync)

This was brought to my attention in https://forums.wesnoth.org/viewtopic.php?p=694081#p694081

"
2143431097,Unified units dialog,babaissarkar,2024-10-24 11:39:59+00:00,2024-12-29 16:30:00+00:00,"{'macOS': 1, 'UI': 1, 'Editor': 1, 'Units': 1, 'Lua API': 1, 'Building': 1, 'Campaign Tutorial': 1}","Unifies the codebases of existing `unit_recruit`, `unit_recall`, `unit_create` and `unit_list` dialogs into a single `units_dialog` with various customizable options.

The frontend UI visible to the players remains the same (so far)

**Tasks:**
- [x] Check all column sorters
- [x] Code simplification and reorganization (builder pattern)
- [x] Check recalllable is correctly used or not
- - [x] Add recallable tooltip
- [x] Add lua function to access this dialog (Resolves #8829)
- - [x] `gui.show_recruit_dialog` (emmylua docs added)
- - [x] `gui.show_recall_dialog` (emmylua docs added)"
2141373054,GUI2 LuaAPI: expand widget attr support,white-haired-uncle,2024-10-23 15:20:12+00:00,2024-11-20 03:41:48+00:00,"{'AI': 1, 'MP': 1, 'Translations': 1, 'Unit Tests': 1, 'UI': 1, 'Editor': 1, 'Units': 1, 'Lua API': 1, 'Add-ons': 1, 'Help': 1, 'Schema': 1, 'Terrain': 1}","Obviously, the Lua API is missing a lot of stuff, for example you can set a styled_widget enabled (active), but you can't check whether it is enabled.  Some of these are pretty obvious, others I'm not sure what, if anything, to do with.

The attached spreadsheet contains a bunch of ""attributes"" I've found, whether because they can be set in WML, or just have a public member function, or whatever.  It's a complete mess atm, but it seems like it would be useful to have the data in one place.

No real reason to push at this point, except that I know I'm going to have a lot of questions.  For example...

**visible**
- current can be set (not get) for styled_widget, though the function is a member of widget
- Currently, from lua you can set via string (visible,invisible,hidden) or bool (true=visible,false=invisible), but if I add get the only thing that seems to make sense is to return a string.  This is kind of weird, if you foo.visible=true and the print foo.visible you get back ""visible"" not true.  Not really a problem IMO, but a little odd.

**text_maximum_width**
- I don't know what this is or when I'd actually use it, so I probably won't touch it, but I noticed that set_text_maximum_width is public, while get_text_maximum_width is protected (another reason to leave it alone?).

**wrap**
- usually seems to be referred to as ""can_wrap"", but ""wrap"" is what's used in WML
- in cpp, you can get_can_wrap on any widget, but only set_can_wrap on label/rich_label/scroll_label/scroll_text.  I'm not sure how get wrap should work in lua, but I'm leaning toward only being able to get on widgets you can set, it seems like maybe less confusing that way?


[attrs.ods](https://github.com/user-attachments/files/17611403/attrs.ods)

"
2140935134,Re-use translation strings from wesnoth-lib instead of duplicating them in wesnoth-editor,Wedge009,2024-10-23 12:43:59+00:00,2024-10-31 12:29:08+00:00,"{'Translations': 1, 'UI': 1, 'Editor': 1}","Closes #9492. Bonus spelling correction.

The four translated strings are listed in https://github.com/wesnoth/wesnoth/issues/9492#issuecomment-2432013072."
2139679194,Help text review,Wedge009,2024-10-23 02:14:23+00:00,2024-10-26 15:11:53+00:00,"{'Editor': 1, 'Prose': 1, 'Help': 1}","#3653 and subsequent related commits prompted a change in translated strings and I found a few more issues. Primarily I want to avoid including mark-up in the translated strings (last commit here), hopefully to reduce the burden on translators if the strings in question haven't already been changed fundamentally. A lot of the strings include mark-up already (part of the problem) but at least we shouldn't be including new mark-up where none existed previously."
2139651300,Save game: text correction,Wedge009,2024-10-23 01:56:37+00:00,2024-10-25 02:03:45+00:00,{'Prose': 1},"I'll grant this is really old text, introduced in 2007 (1.3.13) in 22ad729bccab7d52f06e71a02fbcd6816a36da9e, but the text as it stands really doesn't read right to me.

This also aligns better with the line immediately below it:
https://github.com/wesnoth/wesnoth/blob/c284a080e3d7c93652598bb71b1bad95620263f6/src/savegame.cpp#L436"
2137522295,Display: use point math for viewport position,Vultraz,2024-10-22 05:31:35+00:00,2024-10-25 06:41:59+00:00,"{'Editor': 1, 'Lua API': 1}",
2137424936,campaign selection: opening add-ons manager entry,babaissarkar,2024-10-22 04:18:36+00:00,2024-10-22 23:59:55+00:00,"{'UI': 1, 'Add-ons': 1}","Resolves #8478 by adding an entry to open the Add-ons manager in the campaign list.

![Screenshot from 2024-10-13 09-22-59](https://github.com/user-attachments/assets/74795725-63ab-4b05-a125-f43915068874)
"
2136999643,multi_page::remove_page - consider index when limiting pages,white-haired-uncle,2024-10-21 20:56:27+00:00,2024-10-21 22:57:42+00:00,{'UI': 1},"

closes #9323"
2136980621,Fix wesnoth.units.create_animator fails with too long movement animations,Mahoyomu,2024-10-21 20:45:13+00:00,,{'Lua API': 1},"### Goal of the PR
- Resolves #9163.
### How does the PR work?
- By adding a lua side impl and an api for processing the queued movements.
### Does it resolve any reported issue?
- #9163
### If not a bug fix, why is this PR needed? What use cases does it solve?
- This is a bug fix.

## To do

Adjust possibly missed related method and changes I mistakenly made. 

The fix is mostly on lua side, and uses some existing code to implement. In my test it works with no jumpy animation, including queuing. A C++ side solution might be better according to CelticMinstrel, but with that solution it will be a lot more complicated for me to impl(after all in `action_wml` I could really use some more info about `move_unit_fake` part, including the `evil macro magic` mentioned). 

So after spending some time implementing and considering for it, I think it may be better to leave the solution along and deal with the bug first.

(I'll also try to implement that with more info provided, but it should take me quite some time before I finally make the solution. If I'm assigned in a related new issue, I think I'll keep doing it till the solution finally comes to C++ side)

This PR is Ready for Review.

## How to test
Compile and run, see the test video I might upload later if needed, or see changes in the src."
2135194632,Remove fallback logic from alignment_str() to work the same as alignment(),soliton-,2024-10-21 06:26:37+00:00,2024-11-05 16:15:35+00:00,{'Units': 1},No caller was adjusted since IMO this is the correct behavior.
2134721940,Allow accessing the old value in [set_var] formula=,soliton-,2024-10-20 20:05:19+00:00,2024-11-08 08:37:45+00:00,{'Lua API': 1},
2134689095,1.19 Boats update,doofus-01,2024-10-20 18:25:19+00:00,2024-11-24 00:28:38+00:00,"{'Graphics': 1, 'Units': 1}","Fresh start from #6781 because this is just to update/add a couple of boats; there are other people working on boats now, no need to get the whole set here.

___________________________
EDIT:  Others referenced are https://github.com/wesnoth/wesnoth/pull/6781#issuecomment-2440118418 and https://github.com/wesnoth/wesnoth/issues/9367#issuecomment-2409014788

The scope of this PR is:

- [x] Transport Galleon
- [x] Pirate Galleon - I shouldn't make many configuration changes here, but this seems like a unit that could use some review to make it more distinct.
- [x] Derelict Hulk - sort of a ""zombie ship"".  Ghost ships or Phantom ships are an overlapping yet separate thing and still fair game for anyone else.
- [x] Fireship - a different sort of ""zombie ship""

For portraits, there are the sailor images by LordBob https://forums.wesnoth.org/viewtopic.php?p=665657#p665657, but actual ships would be better for default profiles.  I don't remember if `small_profile` (https://wiki.wesnoth.org/UnitTypeWML) still works, but ideally it does and we can use the sailors for dialogs and ships for help pages."
2134687755,update codeblock librarie,newfrenchy83,2024-10-20 18:21:23+00:00,2024-10-20 19:16:40+00:00,{'Building': 1},
2134494860,Unit strange number manipulation fix,SomeName42,2024-10-20 13:51:22+00:00,,{'WFL': 1},Resolves  #8917. The cause of one of the bugs was that when converting config_attribute_value to formula variant it is unnecessarily multiplied by 1000. This is already done inside the constructor. The cause of the other bug was that the value becomes string when using certain syntax. To solve this now the variant to_decimal function attempts to convert string to number.
2133449570,Display: remove display_context wrapper functions,Vultraz,2024-10-19 07:12:56+00:00,2024-10-20 01:38:18+00:00,"{'UI': 1, 'Editor': 1, 'Units': 1}",
2131917196,campaignd: Use completion token overload,iv-m,2024-10-18 08:44:13+00:00,2024-10-18 09:41:35+00:00,"{'Backport': 1, 'Add-ons': 1}","... to fix compile issues with boost 1.86.

Commit 9c665ae3c4684f8826f4b7d8e0a75b9a986e8617 does the same for wesnothd, but campaignd still fails to compile with overload resolution failure.

References  #9284"
2131483698,Ci fixes,Vultraz,2024-10-18 03:38:27+00:00,2024-10-18 05:32:26+00:00,{'UI': 1},
2130610838,Fix weapon special int value ever truncated instead to be round to nearest integer.,newfrenchy83,2024-10-17 16:39:29+00:00,2025-01-27 23:02:40+00:00,"{'Unit Tests': 1, 'Units': 1}",Fix https://github.com/wesnoth/wesnoth/issues/9467
2127772568,Fix location_palette's override of supports_swap,stevecotton,2024-10-16 12:43:23+00:00,2024-10-16 13:36:47+00:00,{'Editor': 1},"Rename location_palette::can_swap() to the correct name so that it overrides as intended, thus making the UI disable the ""swap fg and bg items"" button.

The class structure doesn't match the responsibilities here, as part of UX isn't part of the palette, rather it's part of the tool that decides whether there are fg and bg items - alternatively, the tool decides whether right-click is ""place bg item"", ""delete items"", or ""show unit tool options"". However, this change seems to be enough to make the UX correct.

The ""virtual"" is redundant, but add it for consistency with the other code in these classes."
2127771145,(1.18 backport)Replace the recursion decoptge method with the less CPU-intensive config pointer comparison method,newfrenchy83,2024-10-16 12:42:39+00:00,2024-11-12 13:42:33+00:00,"{'Units': 1, 'Stable 1.18': 1}","When I use an ability id=A and include [filter][filter_adjacent]ability_id_active=A, the more units with the adjacent ability I add to it, the slower the game becomes, and at the third unit the game freezes, whereas with the direct comparison of the configs the game only slows down significantly after the 5th unit added."
2127529031,about dialog: add entry for game manual,babaissarkar,2024-10-16 10:56:49+00:00,2024-10-18 04:41:49+00:00,"{'Docs': 1, 'UI': 1}","Resolves #9369 by adding a labeled button for accessing the game manual in the General tab of About dialog.

![Screenshot from 2024-10-16 16-25-57](https://github.com/user-attachments/assets/821e0705-50e8-4194-81fd-d4cfc6519989)
"
2127085103,Config: deploy all_children_view en-mass,Vultraz,2024-10-16 07:42:02+00:00,2024-10-16 13:36:59+00:00,"{'AI': 1, 'UI': 1, 'Editor': 1, 'Units': 1, 'Lua API': 1, 'Add-ons': 1, 'WFL': 1, 'Help': 1}",Does reduce binary size for me by 12 KB.
2126149570,Tweak Cavalryman to use Ladder Era stats,Jonathan-Kelly,2024-10-15 20:32:27+00:00,2024-11-30 14:18:29+00:00,{'Units': 1},"Blade resistance is reverted to its original 30% (back from 20% in 1.18) while cost is increased from 17 to 18 gold.

This restores consistency with its advancements (Dragoon and Cavalier) and its general theme of being well armored cavalry.

Competitive multiplayer will not be affected, as expressed by the skilled competitive players Krogen and Skyend on the forums (and the generally conservative and carefully balanced nature of Ladder Era). But single player game play and lore do benefit from keeping the unit's design unique as the ""armored scout"" (generally tougher but less agile than the scouts of other factions/races).

As a side benefit, campaigns that were balanced around the cavalryman's traditional resistances will be more balanced again, since a 6% increase in initial recruit cost is negligible, especially when most campaigns revolve around recalls instead."
2123395392,More New Titlescreen Images,Gothyoba,2024-10-14 15:51:31+00:00,2024-10-30 15:30:28+00:00,{'UI': 1},"A followup to #9182 

Since then I have found more really cool images to add to the titlescreen.

![cool](https://github.com/user-attachments/assets/b4b727c7-95d6-41a6-92d1-02b2c2e6d126)
![cool2](https://github.com/user-attachments/assets/d68e2832-b7a2-4d0d-8553-973492746052)
![cool3](https://github.com/user-attachments/assets/2f7b9486-0771-4fc6-8a92-8179c3591feb)
![cool4](https://github.com/user-attachments/assets/77234840-f5f9-446d-a043-b415bfeb3ecd)
![cool5](https://github.com/user-attachments/assets/9161f591-98ad-4091-9770-29c2580888f6)
![cool6](https://github.com/user-attachments/assets/7197d16e-0cdf-4b94-9085-fb05727f9753)
"
2122124565,"Rect: add grow_by, point_at, and subrect",Vultraz,2024-10-14 06:32:48+00:00,2024-10-16 03:42:16+00:00,{'UI': 1},"Unsure if I should add a `shrink_by` function or keep the current `grow_by(-amount)` approach. Also, `grow_by` is a little inconsistent with the other const helper functions (`shifted_by`, for instance). Considering `adjusted_by`?"
2121965196,CI/CodeQL: ubuntu-latest now runs 24.04,Vultraz,2024-10-14 05:00:08+00:00,2024-10-14 05:23:02+00:00,{},
2121523264,Change the alignment code in attack to return an optional value and avoid falling back to neutral alignment when unit alignment is not available.,newfrenchy83,2024-10-13 16:26:56+00:00,2024-10-18 16:06:09+00:00,"{'UI': 1, 'Units': 1, 'Lua API': 1}","while retesting the alignment in lua I realized that the fallback was not working as I thought, so I'm coming back to a solution so that the value of string in the case of a non-existent attack alignment is empty if the value of the unit alignment is not available."
2121382504,change alignment in attack code for more readability.,newfrenchy83,2024-10-13 09:44:34+00:00,2024-10-13 14:40:39+00:00,{'Units': 1},
2121268899,"[Accidentally closed, now at 9489] campaign selection: open add-ons manager entry",babaissarkar,2024-10-13 04:03:57+00:00,2024-10-22 04:15:34+00:00,"{'UI': 1, 'Add-ons': 1}","Resolves #8478 by adding an entry to open the Add-ons manager in the campaign list.

![Screenshot from 2024-10-13 09-22-59](https://github.com/user-attachments/assets/74795725-63ab-4b05-a125-f43915068874)
"
2121219506,village bluff/gulch overlay terrain,doofus-01,2024-10-13 01:01:29+00:00,,"{'Graphics': 1, 'Terrain': 1}","If you really need to control the overlay terrain (village, mushrooms, etc.) of an elevation border, the best way is to make that hex adjacent to the border of a different elevation.  Something like forest may need to span an elevation border, so there is a dedicated elevation terrain type for forests that mimics the specific type from adjacent hexes.  I don't think there are any other important overlays that fit that model, but let me know if there is.

Villages are a significant overlay terrain, but don't usually span big splotches, so mimicking the adjacent terrain isn't a good plan.  If placing the village adjacent to the border isn't possible, the only other options I see are:
1.  Make a new terrain for every village type.
2.  Make the base terrain the village type choice lever

Option 1. will spam the editor palette, and will also lock maps into a certain behavior because it involves new terrain codes, not just the terrain-graphics.  But it will allow the map-maker to place the exact base/village combo they want.
Option 2. will make it difficult to figure out how to place a specific village type, especially if ""Terrain Description"" has nothing useful to say about it (#9456).  But it will allow for corrections later, without changing terrain codes, and the base terrain under a village isn't (usually) that critical.

This PR is going with option 2.  But until the ""Terrain Description"" context menu can help explain this, I don't think it can be merged."
2121142200,Some t_string cleanups,Vultraz,2024-10-12 20:55:42+00:00,2024-10-14 02:59:10+00:00,"{'UI': 1, 'Editor': 1, 'Help': 1, 'Terrain': 1}",
2121066337,swarm tests,Pentarctagon,2024-10-12 16:55:54+00:00,2024-10-15 22:31:01+00:00,{'Unit Tests': 1},
2118765630,GUI2: Fix broken tab order,babaissarkar,2024-10-11 01:43:16+00:00,2024-10-11 01:50:13+00:00,{'UI': 1},"Resolves #9443 and partially deals with #1239.
The first SDL_KEY_DOWN handler is being called twice, while the second one is being called once. The tab order handling is done by the first handler, which caused the focus to move *twice*, resulting in the erratic behavior when tab was pressed. Moving the tab handling to the second one stops this and now focus moves only once when Tab is pressed.

Original code:
https://github.com/wesnoth/wesnoth/blob/1ca69e1ecaf8fe387f3ea6220671c842c250cc3b/src/gui/widgets/window.cpp#L322-L327

"
2118364426,Map location: direction scoped enum,Vultraz,2024-10-10 19:45:06+00:00,2024-10-11 02:57:24+00:00,"{'AI': 1, 'Editor': 1, 'Units': 1, 'Lua API': 1, 'WFL': 1, 'Terrain': 1}","Intended to do more, but turns out to be more complicated than I initially thought. This is just the low-hanging fruit."
2117454409,Add support for UI Theme addon type,babaissarkar,2024-10-10 11:40:30+00:00,2024-10-11 01:49:38+00:00,"{'UI': 1, 'Add-ons': 1, 'Schema': 1}","With custom gui2 theme support in #9057, it is now possible to create addons that supply UI Themes or Skins. This adds support so such addons are properly recognized and validated.
A new addon type, `theme` is now recognized in the PBL file as well as the Addons Manager and PBL Editor."
2116992670,Fix wesnoth.interface.select_unit(nil) unexpected behavior,Mahoyomu,2024-10-10 08:18:07+00:00,2024-10-31 02:54:19+00:00,{'Lua API': 1},"### Goal of the PR
- Resolves #9213.
### How does the PR work?
- By adding an allowable case to the determining condition of resetting gui highlight.
### Does it resolve any reported issue?
- #9213
### If not a bug fix, why is this PR needed? What use cases does it solve?
- This is a bug fix.

## To do

Adjust possibly missed related method. The fix is not so efficient, so if there's a better idea etc. perhaps I'll try that one instead, but this fix also seems to work at least.

This PR is Ready for Review.

## How to test
Compile and run, see the test video I might upload later if needed, or see changes in the src."
2114141128,Config: remove implicit conversion to int and bool,Vultraz,2024-10-09 01:20:43+00:00,2024-10-09 05:36:11+00:00,"{'AI': 1, 'UI': 1, 'Editor': 1, 'Units': 1, 'Lua API': 1, 'Add-ons': 1, 'WFL': 1, 'Help': 1, 'Terrain': 1}","Resolves #9009, closes #9384. Besides the issues that came from having both int and bool conversions (even with bool marked explicit), it doesn't make sense to use int for all numeric assignments. I didn't test whether it would be an issue in practice, but it seems better to let callers be explicit about what type they want for numeric values than risking overflow or wrapping for very large values."
2112640589,Create in [filter_ability] an attribute 'active' to replace _active suffix in [filter_ability_active],newfrenchy83,2024-10-08 09:32:28+00:00,2024-10-13 21:37:31+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1}","Resolves https://github.com/wesnoth/wesnoth/issues/7926

Under pressure from @soliton-, I agree to merge [filter_ability] and [filter_ability_active] into a single filter equipped with the 'active' attribute which when the value is 'true' checks the units affected by the sought ability and when the value is 'false' will check the units carrying the ability even if they are not affected by it.

Because of the attribute strategy, I'm afraid that the developer will be mistaken about its function and that's why I'm not at all keen on it. (is it so bad to keep two tags like for ability_type and ability_type_active? there it would be clearer for those who manipulate these attributes because of the resemblance)"
2111250696,Tweak some Elvish units stats,MechanicalDragon963,2024-10-07 16:16:58+00:00,2024-10-25 20:08:48+00:00,"{'Unit Tests': 1, 'Units': 1}","In version 1.18, outrider/avenger/marshall were buffed alongside 1.18's 16-5 sylphs, 14-3 shydes and 12-5 sharpshooter in an unpopular attempt to make elves more ""elite"" while Yumi was still in charge of SP. Now that most of those units got reverted to be closer to 1.16 stats, I think it no longer makes sense to overbuff the remaining elf units, so I propose the following:

Elvish Scout: exp 42 -> 32 (revert to 1.16 value)
Elvish Rider: HP 49 > 46, bow 11-2 -> 9-2, exp 75 -> 60, cost 28 -> 29
Elvish Outrider: HP 60 -> 57, MP 11 -> 10, sword 8-4 -> 7-4, bow 11-3 -> 9-3, cost 58 -> 50
Elvish Avenger: HP 59 -> 55, cost 66 ->55 (sharpshooter got fully nerfed to 1.16 stats, so avenger keeping the hp bonus would be unfair advantage over sharpshooter)
Elvish Marshal: HP 68 -> 62, cost 68 -> 60 (with 10-4 melee damage, 1.18 marshall feels too similar to 72 hp 8-5 10 accuracy champion in overall melee power while he is supposed to be the weaker support branch)

EDIT: added new costs, re-balanced Rider and Outrider a bit.
"
2110657491,Properly capitalize Young Ogre description,Gothyoba,2024-10-07 11:48:02+00:00,2024-10-07 22:27:05+00:00,{'Units': 1},"According to the typography style guide (https://wiki.wesnoth.org/Typography_Style_Guide#Race_Names) race names should not be capitalized in Wesnoth. While ogres are a unit, in the context of the young ogre description this probably to reffers to the race and not the unit."
2110517685,Increase Fire Resistances of Fire Guardian Line,Gothyoba,2024-10-07 10:40:54+00:00,2024-12-19 15:24:41+00:00,{'Units': 1},"Fire Wisps and Guardian fire resistances increased from 50% to 70%, whereas the more powerful level 2 Fire Wraiths have increased to 80%. The previous 50% made little sense for a unit made of flames and smoke, so this is a bit more reasonable while still not requiring changes to existing scenarios or much rebalancing of UMC."
2110425641,Fix invalid WFL crashes Wesnoth,Mahoyomu,2024-10-07 09:55:19+00:00,2025-01-28 02:24:17+00:00,"{'Units': 1, 'WFL': 1}","### Goal of the PR
- Resolves #9249.
### How does the PR work?
- By adding try-catch to finish a todo in filter.cpp, it catches formula error when evaluating formula.
### Does it resolve any reported issue?
- #9249
### If not a bug fix, why is this PR needed? What use cases does it solve?
- This is a bug fix. Also, there's a case in formula evaluating that the formula will undoubtly be an empty expression and don't need to call itself again to find out the error, the pr also makes changes on it.

## To do

Adjust possibly missed related method, delete some redundant description.

This PR is Ready for Review.

## How to test
Compile and run, see the test video I might be uploading soon, or see changes in the src. (personally have tested it and it works)"
2109574447,Use XMP metadata for PNG files,doofus-01,2024-10-06 21:14:36+00:00,2024-10-27 17:40:00+00:00,{'CI': 1},"GIMP can read/write Creator and Rights XMP tags in PNGs, unlike the tags in the PNG or EXIF chunks.   Fixes #9312 

Maybe XMP should be used for everything, but at least for Dolphin, I can see the Artist & Copyright under PNG or EXIF, and nothing for XMP.  Is that just Dolphin weirdness, or is it a similar case for Windows and Mac?  If XMP isn't as visible, it would make sense to just use that for PNG files, while leaving the larger WebP and JPEG files with EXIF, since those are more likely to be ""browsed"" and shouldn't need ""small fixes"".

This is to change the CI.  A follow-up to migrate the data in existing PNGs will be a separate PR."
2109527562,Teleport path finding improvement,SomeName42,2024-10-06 18:42:03+00:00,2024-10-08 21:17:02+00:00,{'UI': 1},Resolves issue #8996. Performance issues were mostly caused by filtering through the entire map for villages. This was replaced by different filtering that uses already stored village locations. The issues were also caused by using inefficient data structures. These were replaced with more efficient ones. Furthermore small improvements were made in the path finding algorithm. 
2109322126,[Units][Jumpcat] Rebalance Stats,ForestDragon-wesnoth,2024-10-06 08:15:33+00:00,2024-10-07 19:27:45+00:00,{'Units': 1},"Alongside PR #9420, I also noticed that the new Jumpcat's current stats have some glaring problems:

1. first and most important, despite being a lvl1 unit it, he has, all at the same time: 9mp, a 12-2 attack that also has 10 accuracy bonus, nightstalk, parry on melee, and all this while only costing 15 gold
2. on the subject of parry, I believe using parry on an elusivefoot unit is too much, as the jumpcat will have 80% dodge chance on many types of terrain, while normally dodge chance is pretty much never above 70% in wesnoth.

I think heavily nerfing the unit to the point of being on par with other lvl1 would take away the unit's uniqueness, and it's cool to have a powerful non-undead nightstalk unit, so instead I propose rebalancing the unit into a lvl2:


level from 1 to 2 (massive change, but it is still a new unit in a dev build so I think such big changes are justifiable at this point)
hp from 32 to 40
claws parry removed
claws become 5-3 backstab (I was originally considering making the claws 8-3, but then after thinking decided that 5-3 backstab would give the claws a more useful niche while keeping tail as the main attack when not backstabbing)
arcane resistance from 20% to 10% (same as with the forest lion PR)
price from 15 to ~~28~~ 26

mp from 9 to 7
tail from 12-2 10 accuracy, to 13-2 no specials

EDIT: changed 6-3 backstab to 5-3 backstab after seeing that cats are not traitless unlike the monster race

EDIT2: implemented the 42hp, 7mp and 13-2 no specials tail ideas"
2109212601,GUI2/Widgets: use unique_ptr for builder ptrs,Vultraz,2024-10-06 00:33:57+00:00,2024-12-12 17:53:26+00:00,{'UI': 1},"They really didn't need to be shared_ptrs, except it was easier to copy things around (especially when builders held containers of builder ptrs).

This makes all widget_builder::build overrides non-const to facilitate move semantics from builders to widgets, if desired."
2109186091,World Conquest - Added Custom Game Options,AskAardvark,2024-10-05 22:20:44+00:00,,{'Campaign WC': 1},"World Conquest is a difficult and fun campaign. Strengthening characters over time is a roguelike mechanic making World Conquest fun. The original map maker implemented bonuses and an option to select artifacts.

This proposal does not seek to alter the default balance of World Conquest. These are mere toggles added to allow players to increase the ""Fantasy"" level of world conquest. With the wide array of difficulty settings, these toggles can be played with comfortably without making the game too easy while playing casually with friends.

Change List:

1. Added Config slider - custom_artifact_invest_options - Changes how many artifact investment options there are,
2. Added Config slider - custom_map_bonus_per_player - changes how many bonuses are spawned * player count.
    - Currently looking for an alternative allowing a player-defined variable to be influence bonus point generation.
```lua
-- Does not work
local player_num =  _G.scenario_data.nhumanplayers * wml.variables[""custom_map_bonus_per_player""]

-- Works
local player_num =  _G.scenario_data.nhumanplayers * 3
``` 
Edit: [Separate issue blocking this PR](https://github.com/wesnoth/wesnoth/issues/9463). 
    
3. Lowered the minimal distance between bonuses to allow for more bonuses on the map inversely proportional to # of bonuses selected. - Needs to be updated to not drop below 2 spacing.
    - ~~If this should be left at 9 but dropped to 3 when a non-default value is selected, let me know.~~
    
    
Feedback Welcome! :)

Disclaimer: I am making this PR with my ""World_Conquest_Item_Pack"" mod in mind."
2108816201,"Scenario editor, unit facing, game crash fix",SomeName42,2024-10-05 11:52:15+00:00,2024-10-20 19:48:31+00:00,{'Editor': 1},Resolves #9226. Game no longer crashes when clicking menu bar after setting unit facing.
2108629690,Hide load turn menu item in multiplayer,SomeName42,2024-10-05 07:25:08+00:00,2024-10-05 19:21:27+00:00,{},Resolves #9308. Hides load turn menu item in networked multiplayer games.
2108001840,GUI2/Rich Label: minor cleanup,Vultraz,2024-10-04 17:11:16+00:00,2024-10-04 23:53:29+00:00,{'UI': 1},Couple cleanup/optimization thinks I saw looking through the code.
2107324815,Markup refactor,babaissarkar,2024-10-04 10:53:16+00:00,2024-10-10 05:31:14+00:00,"{'macOS': 1, 'UI': 1, 'Editor': 1, 'Units': 1, 'Building': 1, 'Help': 1, 'Achievements': 1}","1. Introduces `serialization/markup.cpp` and its corresponding header file.
2. Replaces occurances of hardcoded xml style markup strings, such as `formatter() << ""<b>"" << sometext << ""</b>""` with calls to various utility functions in markup.cpp/hpp.
3. font/text_formatting.hpp has been removed, and its functions moved to either `serialization/markup.cpp` or to the calling class. The latter is possible for some functions because they were called only once.

(Note that I've intentionally left any markup that was inside VGETTEXT or _())

**TODO**
- [x] Move the help markup parser to markup.cpp
- [x] Make sure (a) all markup are correctly replaced, (b) formatted strings work as expected as much as possible."
2107052413,Typo fixes in EI _main.cfg,Gothyoba,2024-10-04 08:20:13+00:00,2024-10-04 12:57:55+00:00,{'Campaign EI': 1},"many -> may
guranteed -> guaranteed (twice)
incoime -> income
determine -> determines"
2106289203,More config stuff,Vultraz,2024-10-03 19:36:25+00:00,2024-10-04 03:40:41+00:00,{'Engine': 1},"Fixes:
* `cfg[""foo""] = std::move(value)` is now allowed
* `config { key, value }` will no longer fail if `value` is a const config reference (it worked with a non-const reference)

`config::all_children_view` is meant to replace `all_children_range` for the vast majority of cases in which you just need the iterate over tags without saving the iterator. It's easier to read, code-wise, it fixes the issue of `any_child` always holding a mutable reference even when the owning config was const, and intellisense now properly shows key/value types as references when destructuring (rather than value as with `all_children_range`)."
2106283577,Remove unused lua in THoT,Gothyoba,2024-10-03 19:32:34+00:00,2024-10-04 05:59:29+00:00,{'Campaign THoT': 1},Removes the probably unused lua folder for a now removed scenario.
2105446108,[Units] Adjust Forest Lion Stats,ForestDragon-wesnoth,2024-10-03 12:26:38+00:00,2024-11-09 13:54:38+00:00,{'Units': 1},"Looking at the brand-new 1.19 cat stats. The concept is neat but I believe the unit is a bit overtuned (and Jump Cat is very overtuned, but I will get to that one in another PR) with 9mp, 15-2 attack and 21 cost a once. Though on the other hand, using attack/defense weights seems a bit too not-user-friendly since that mechanic is not visible in-game, so I propose the following changes with my PR

arcane resistance from 20% to 10%
claws from 5-4 to 6-4 now usable on offense
bite from 15-2 to 9-2 charge, now usable in defense
price from 21 to ~~27~~ 30

MP from 9 to 7
HP from 42 to 48

EDIT: reduced price to 24

EDIT2: reverted damage numbers but nerfed MP to 7 as suggested by Dalas

EDIT3: another rebalance around making it a charge unit

EDIT4: increased price to 30"
2105178451,Status table team name fix,SomeName42,2024-10-03 10:03:23+00:00,2024-10-06 19:57:34+00:00,{'MP': 1},"Resolves #9407 where status dialog team names are not changed, when changed at game start."
2104311480,GUI2 LuaAPI: add clear_items(),white-haired-uncle,2024-10-02 21:05:25+00:00,2024-10-09 05:37:03+00:00,{'Lua API': 1},"Tested on listbox, multipage and tree_view/tv_node.

Please see comments starting at line 504 of lua_widget_methods.  I fixed a spelling issue, but that whole comment just looks wrong to me.

Looking at emmylua/gui.lua and the wiki for remove_items_at(), I think both might be wrong, but I'm not confident enough in that to correct them."
2103413900,Better action wml allow_recruit error,SomeName42,2024-10-02 13:02:12+00:00,2024-10-12 20:23:53+00:00,{'Lua API': 1},Better error messages for allow_recruit ActionWML. Resolves #9383.
2102873938,Set UtBS date to 600 AF to prevent lore conflicts with IfTU,Gothyoba,2024-10-02 07:47:56+00:00,2024-10-03 06:19:09+00:00,{'Campaign UtBS': 1},"Sorry about this second PR! This is a follow-up on #9404 Apparently my previsouly proposed date of 1000 AF contradicts certain UMC such as IfTU so I’m going for 600 AF, which is still more reasonable than the previous 300."
2102857093,Added error handling for unstore_unit when unit type doesn't exist,dnew0101,2024-10-02 07:35:39+00:00,2024-10-06 07:40:52+00:00,{'Lua API': 1},
2102670928,"Define core units without [base_unit] tag (Horse, Scorpion, Ant Egg)",OrekOrek,2024-10-02 04:13:42+00:00,2024-10-04 22:30:20+00:00,{'Units': 1},"Out of all 311 core units, only 5 relatively newly added units use `[base_unit]` tag as a part of their definition (Dark Horse, White Horse, Sand Scamperer, Sand Scuttler, and Fire Ant Egg).
To keep the consistency, and to prevent the potential nested structure of `[base_unit]` of `[base_unit]` in modified units, it is probably better to define core units without the tag.

1. Dark Horse, White Horse, Sand Scamperer, and Sand Scuttler are now defined without `[base_unit]` by copy-pasting data from respective base units.
2. The deprecated variation of Giant Scorpion (moved to Sand Scuttler) is untouched just in case, but it should be removed in the future.
3. Ant_Egg.cfg is the only file that defines 2 units (Giant Ant Egg and Fire Ant Egg) within a single file. They should be separate in my opinion, but I don’t know if separating causes any problem, especially when Giant Ant Egg (level 0) advances to Giant Ant (level 0) and it doesn’t appear in [the unit database](https://units.wesnoth.org/1.19/mainline/en_US/mainline.html). Therefore, Fire Ant Egg whose base unit is Giant Ant Egg is untouched for now.

I would like people to double-check the changes, and give opinions on Ant Eggs."
2102499792,EI: update Dacyn arcane resistance to be consistent with the arcane rework,Dalas121,2024-10-02 00:38:45+00:00,2024-10-02 12:43:40+00:00,"{'Units': 1, 'Campaign EI': 1}","In EI, Dacyn transforms into a Twilight Mage and then Fallen Mage, meant to foreshadow his transition towards undeath.

The original arcane resistances for these forms were set before the 1.18 arcane rework. In particular, it's odd that Fallen Mage Dacyn (who's still visibly human) has worse arcane resist than a lich or a skeleton.

Even if the arcane changes proposed in #9392 go through, these proposed Dacyn stats should still be reasonable."
2102489265,"EI S14 ""Drowned Plains"" - rework scenario objective",Dalas121,2024-10-02 00:24:24+00:00,2024-10-04 03:26:08+00:00,{'Campaign EI': 1},"Drowned Plains is one of the most-criticized EI scenarios. It has a 75 turn limit, and involves trudging across swamp while enduring ambushes to kill 3 enemy leaders.

This revision drastically shortens the scenario to only 25 turns, and changes the objective to _'Gather as much gold as you can before turns run out'_. Enemy leaders have piles of gold nearby, to reward killing them (or luring/stealing from them).

I played through this once to verify the balance was at least plausible and that nothing was completely broken, but it's possible I missed something. Please let me know if anything looks incorrect."
2100416440,Fix weapon special unexpected behaviour,Mahoyomu,2024-10-01 03:27:41+00:00,2024-10-06 18:44:00+00:00,{'Units': 1},"### Goal of the PR
- Resolves #9366
### How does the PR work?
- By setting the bouncing back logic of strike times to only happen when attributes are used incorrectly(meaning sub is non-negative at the same time)
### Does it resolve any reported issue?
- #9366
### If not a bug fix, why is this PR needed? What use cases does it solve?
- This is a bug fix.

## To do

Adjust possibly missed related method.

This PR is a Work In Progress.

## How to test
see changes in the src.
"
2100331791,World Conquest: Remove hard coded trainer indices,AskAardvark,2024-10-01 01:46:07+00:00,2025-02-23 21:37:26+00:00,{'Campaign WC': 1},"Intended as a bug fix for: https://github.com/wesnoth/wesnoth/issues/9372

Removed hard-coded indices. Bonus points route through get_trainer so they should work as normal. This primarily updates training.list_available. References to the ""Among"" list_available parameter were also removed. The dark training was updated to not be visible on the invest screen as is default. The modding readme was updated to include this new functionality.

Edit: I am working on testing this more extensively with friends, locally, in the meantime."
2099815334,Add achievements to THoT,Gothyoba,2024-09-30 18:49:39+00:00,2024-10-31 17:38:01+00:00,"{'Achievements': 1, 'Campaign THoT': 1}","The following achievements have been added:

- Gryphon Hunter: Kill the Gryphon leader in High Pass

- Conqueror of the Forest: Defeat an enemy leader in Forbidden Forest

- New Thursagan: Complete The Underlevels on challenging difficulty"
2099695778,Fix a comment typo in THoT S6,Gothyoba,2024-09-30 17:34:57+00:00,2024-09-30 17:36:13+00:00,{'Campaign THoT': 1},Aiglondor -> Aiglondur
2099545207,Change UtBS date from 300 to 1000 AF,Gothyoba,2024-09-30 16:16:05+00:00,2024-10-01 23:17:45+00:00,{'Campaign UtBS': 1},This makes a lot more sense given how forgotten everything before the fall is by the time of UtBS. 300 AF is small enough for a few elves to remember the times before. 1000 AF is more sensible in my opinion. This a change I proposed in #9398 but decide to split into another PR.
2098827982,[Units][Skeletal Dragon] Adjust Stats to a more moderate amount,ForestDragon-wesnoth,2024-09-30 11:06:59+00:00,2024-09-30 18:10:52+00:00,{'Units': 1},"Although I support making the skeletal dragon stronger than in 1.18, I believe that PR #8541 was too extreme of a change in that direction, nearly doubling the unit's jaw damage and more than doubling the healthbar. After discussing the matter with some other players, modders and Dalas, I decided to propose a more moderate improvement over the 1.18 stats, and a major nerf over the current 1.19 dev build stats which seem very overtuned.

HP: 171 > 98 (or 86 > 98 if comparing to 1.18)

jaw attack: 17x4 > 15x3 (or 10-4 > 15-3 when comparing to 1.18). More damage per hit than 1.18 and more total damage, but 1 fewer strike, making it feel more weighty. (Dalas' idea)

claws: 24-3 > 27-2 (or 25-2 > 27-2 when comparing to 1.18).

Fire Resistance: -20% > 20% (slightly more moderate version of Dalas's idea. Since the unit is the bones of a dead dragon, it's fitting that it is more fire-resistant than normal skeletons. Also makes the unit less weak to the Mage line)"
2098323048,Action wml unit better error,SomeName42,2024-09-30 07:05:12+00:00,2024-10-03 18:59:00+00:00,{'WML': 1},Better error message for ActionWML [unit] for unit type errors. resolves #9382
2098142164,slows tests,Pentarctagon,2024-09-30 04:56:10+00:00,2024-10-01 22:54:36+00:00,{'Unit Tests': 1},
2097846236,1.19 Better mountains/elevation interactions,doofus-01,2024-09-29 23:41:38+00:00,2024-10-07 00:51:54+00:00,"{'Graphics': 1, 'Terrain': 1}","I was going through the new EI, and saw the bluffs/gulches + mountains transitions really needed some work.  This isn't totally solved, but I think it's a few steps in the right direction.  Currently losing the multi-hex images for something like `Mm^Qhh`, but with more small-mountain variations, it might not look as bad.  Preserving the multi-hex images is probably possible, but will lead to a lot of corner cases. 
![mountains-bluffs](https://github.com/user-attachments/assets/3a826bab-3ec8-49ae-bf90-4809a9663791)
"
2097763354,Better error message for ActionWML [unit] invalid type,SomeName42,2024-09-29 19:37:07+00:00,2024-09-29 20:14:06+00:00,{},A fix for issue #9382
2097726292,Redesign campaign descriptions,Gothyoba,2024-09-29 18:52:38+00:00,2024-10-07 11:51:57+00:00,"{'Campaign AToTB': 1, 'Campaign DM': 1, 'Campaign DW': 1, 'Campaign DiD': 1, 'Campaign EI': 1, 'Campaign HttT': 1, 'Campaign LoW': 1, 'Campaign L': 1, 'Campaign NR': 1, 'Campaign SoF': 1, 'Campaign SotA': 1, 'Campaign SotBE': 1, 'Campaign THoT': 1, 'Campaign TRoW': 1, 'Campaign TSG': 1, 'Campaign Tutorial': 1, 'Campaign UtBS': 1, 'Campaign WoF': 1, 'Campaign WC': 1}","A completely unnecessary aesthetic change I wanted to propose for mainline. Feel free to close this if you feel it isn't necessary.

This is an example image showing a reworked description:

![campaign_redesign_prototype](https://github.com/user-attachments/assets/5109c0b6-aa3c-4bf4-b7da-a9a07c09e00e)

The following has been changed:

- All campaign descriptions now include a title using the #baac7d (gold), the Oldania ADF Std font, with font size xx-large, including multiplayer campaigns. This is an idea from knyghtmare's SotBE revision.

- All campaigns now have a short text below this which says ""Starts in year"" followed by the year in which the campaign starts. This should be small and italic, with no space between it and the title (though a space should exist between it and the main description.) This is intended to fix #4212

- All campaigns now have their difficulty level in bold. This is purely aesthetic.

- Notes in campaigns are standardized to always be small and start with ""Note: "".

Things like these titles are not automatically added so that UMC Campaigns can have space to do change things their own way. So this involves changing each _main.cfg file individually.

The date for UtBS has been changed from 300 AF to 1000 AF. This is mainly because it doesn't make sense that UtBS happens so shortly after the fall given how forgotten everything before is. While this wasn't a major issue when the date wasn't shown, now that it is shown it is better to give something more reasonable. So I'm proposing changing it to 1000 AF.

The tutorial has been given a date of 525 YW. While the tutorial is clearly not a part of mainline lore, and the date shown for the year= part is 9999 YW (which I have not changed, as I agree it should be at the end of the list when sorting by timeline), I still decide to give it this date. My reasoning here is that the tutorial will not last long in mainline, so any changes to it might as well not matter. This is just aesthetic to give it a date like the other campaigns. I chose a date shortly after HttT, given the appearance of Konrad and Li'sar next to Delfador.

Eidt: Looks like there’s a lot of errors. I’ll go over my changes and try to fix it tomorrow. At least one of them is accidently removing the translatiblity of the title of the tutorial. The PR is a draft u til the errors are fixed."
2097695926,Enable WFL functions to be defined in Lua,CelticMinstrel,2024-09-29 17:39:41+00:00,,"{'Lua API': 1, 'WFL': 1}","This enables Wesnoth Formula Language functions to be defined with a Lua definition.

When compiling a formula, a new optional function table argument is available. This argument is either a table mapping WFL identifiers to Lua functions or a ""function table"" userdata taken from a previously-compiled formula.

Not just any Lua function can be assigned to a WFL function table. The function must take at least one argument, which will be passed the global variables from formula evaluation (the same table passed to eval_formula). It may take any number of additional arguments. Arguments with a name ending in `_opt` will be treated as optional arguments by the WFL engine.

Apart from the first parameter, all parameters passed to the Lua definition of a WFL function are themselves formula objects. That means they must be _invoked_ to obtain the actual value that was passed in. That also means that higher-order functions (such as the built-in sort function) can be implemented by invoking a parameter with arguments.

The function can return no arguments (equivalent to `null()`), one value (the type is automatically detected), or a value and a string (where the string is the name of a WFL type to which the value will be coerced).

The function can only access a subset of the Lua API – the math[x], string[x], utf8, and wml libraries (excluding game-only API), plus a handful of functions and data tables in the wesnoth module. It can also access the function table the function is assigned to via the global `wfl_functions`. Upvalues are not supported at this time (that might be changed later), which means it can't access any data from the enclosing scope.

This also enables WFL functions to be _invoked_ from Lua. The functions can be looked up from a ""function table"" userdata, either via the `wfl_functions` global from within a function definition or via the `.functions` key on a precompiled formula userdata. The function can be called with any number of arguments, which can be either formula userdata or values, and it returns a formula userdata that will perform the invocation when called with no arguments. The third example below demonstrates this. Note that no ""self"" variable is passed in this case.

Some examples:

```lua

local example_functions  = {}

-- Invoke the nested formula twice
function example_functions.twice(self, name_opt, formula)
    local name
    if formula then
        name = name_opt{}
    else
        formula = name_opt
        name = 'n'
    end
    return formula{
        [name] = formula{
            [name] = self.n
        }
    }
end

-- Test if a predicate holds for every element of a list
function example_functions.allof(self, list, pred)
    list = list{}
    for i,v in ipairs(list) do
        -- This looks odd, but it's because WFL doesn't have a boolean type
        if pred{value = v} ~= 1 then
            return 0 -- false
        end
    end
    return 1 -- true
end

-- Apply all the arguments to a function chosen by name
function example_functions.apply(self, fcn_name, ...)
    local fcn = wfl_functions[fcn_name{}]
    return fcn(...){}
end

-- Examples of their use
local f1 = wesnoth.compile_formula(""twice('a', a + 1)"", example_functions)
print(f1{n = 5}) -- prints 7
print(f1{n = 2}) -- prints 4

local f2 = wesnoth.compile_formula('allof([1,2,3,4], value < 5)', example_functions)
print(f2{}) -- prints 1
local f3 = wesnoth.compile_formula('allof([1,2,3,5], value < 5)', example_functions)
print(f3{}) -- prints 0

local function f4 = wesnoth.compile_formula(""apply('lerp', 0.0, 4.0, 0.5)"", example_functions)
print(f4{}) -- prints 2.0
```"
2097203079,poison ability tests,Pentarctagon,2024-09-28 19:26:01+00:00,2024-09-30 03:15:47+00:00,{'Unit Tests': 1},
2096838442,fix problematic find_widget usage and slightly rewrite the logic (#9388),babaissarkar,2024-09-28 06:45:44+00:00,2024-09-28 16:43:35+00:00,"{'UI': 1, 'Add-ons': 1}",Resolves #9388.
2096219044,fix clang warning for signed unsigned comparison,Pentarctagon,2024-09-27 16:43:50+00:00,2024-09-27 18:20:09+00:00,{},
2095988929,The NOT_DANGLING specifier should be before the const attribute,stevecotton,2024-09-27 14:28:42+00:00,2024-09-27 14:38:15+00:00,{'UI': 1},Fixes a warning with GCC-14.
2094936782,Config: use structured bindings with all_children_range,Vultraz,2024-09-27 03:34:57+00:00,2024-09-27 06:49:57+00:00,"{'AI': 1, 'UI': 1, 'Editor': 1, 'Units': 1, 'Lua API': 1, 'Add-ons': 1, 'WFL': 1}",CI run
2092773033,use the correct editor dir location,Pentarctagon,2024-09-26 05:00:37+00:00,2024-09-27 13:41:54+00:00,{'Engine': 1},fixes issue brought up on the forums: https://forums.wesnoth.org/viewtopic.php?t=58725
2092348649,Fix config's automatic conversion of an attribute to bool gives unexpected behavior,Mahoyomu,2024-09-25 21:33:12+00:00,2024-10-09 05:36:12+00:00,{'Engine': 1},"### Goal of the PR
- Resolves #9009.
### How does the PR work?
- By making int conversion explicit.
### Does it resolve any reported issue?
- #9009
### If not a bug fix, why is this PR needed? What use cases does it solve?
- This is a bug fix.

## To do

If there's a need for related test cases in `BOOST_UNIT_TEST`, please share with me about the details of need.

This PR is a Work In Progress.

## How to test
see changes in the src."
2092295959,Lint for unnecessary pass by values and lack of std::move usage,jj-marr,2024-09-25 20:52:35+00:00,2024-12-02 04:19:53+00:00,"{'AI': 1, 'MP': 1, 'UI': 1, 'Editor': 1, 'Units': 1, 'Lua API': 1, 'Add-ons': 1, 'Building': 1, 'WFL': 1, 'Help': 1, 'SCons': 1, 'CMake': 1}","If a function parameter is only ever used in a `const` manner (so only `const` member functions are called or it is `const`), it can be treated as a `const reference` and no copying is required.

Additionally, if a parameter is only copied or moved once and has a non-trivial move constructor (i.e. one different than the copy constructor), it might make sense to `std::move` that parameter.

This PR enables the `clang-tidy` linter check (`performance-unnecessary-value-param`) that recommends doing so, and additionally applies its recommended autofixes to the codebase. This is based on #9358.

edit: The PR itself is split into five commits. The first three commits are mostly formulaic transformations.

The fourth and fifth commits are broken out as they're special cases. `goal::on_create(std::shared_ptr<ai::lua_ai_context>)` is _not_ turned into a const reference, as the goal of that override is to catch calls to `on_create` and cause a runtime error. That's why it's `NOLINT`ed

The fifth commit is because `modal_dialog::register_integer` accepts an argument `callback_save_value` which has slightly different types in `modal_dialog.h` and `modal_dialog.cpp`. Specifically, `callback_save_value` is a `std::function<void(int)>` in the header and `std::function<void(const int)>` in the implementation. I made the implementation match the header before applying the transformation to make the final type a `const std::function<void(int)>&`."
2089728620,give 'neutral' alignment' to scepter of fire and rod of justice,newfrenchy83,2024-09-24 18:47:03+00:00,2024-10-07 16:31:21+00:00,"{'Units': 1, 'Campaign HttT': 1, 'Campaign NR': 1, 'Campaign TRoW': 1}","This item have great power of their own, is should not depend of alignment of user."
2089440963,GUI2 code simplification: find_widget/pre_show/post_show and cleanup,babaissarkar,2024-09-24 15:57:08+00:00,2024-09-27 00:34:58+00:00,{'UI': 1},"1. Made `find_widget` a member function of `widget` and added default args. The first argument was unnecessary. Additionally default values have been added for last argument for both the 3 arg and 4 arg versions (now 2 and 3 arg versions respectively). With these changes, it is possible do just `find_widget<button>(""mybutton"")` instead of `find_widget<button>(get_window(), ""mybutton"", false)`.
2. Remove unnecessary window argument from `pre_show` and `post_show`
3. Remove more unnecessary `std::ref(window)` occurrences.
4. Remove `gui/auxiliary/find_widget.hpp` which is no longer needed."
2088848860,update codeblock projectfiles,newfrenchy83,2024-09-24 11:32:36+00:00,2024-09-24 12:39:40+00:00,{'Building': 1},
2088034191,Fixes #7992,Pentarctagon,2024-09-24 03:58:41+00:00,2024-09-25 22:41:06+00:00,{'Units': 1},"abilities.cpp changes taken from #9361 by newfrenchy

---

Removing the `cfg` checks from `config_filters.cpp` currently breaks the WML unit tests, so that still needs to be fixed. Supercedes #9361."
2087868393,Removed a ton of unused GUI1 stuff,Vultraz,2024-09-24 01:14:55+00:00,2024-09-24 03:54:47+00:00,"{'macOS': 1, 'Building': 1, 'Help': 1}",Don't need these now that the GUI2 help browser is merged.
2087790750,fixup #8766,spixi,2024-09-23 23:55:59+00:00,2024-09-24 06:35:31+00:00,{'Campaign DW': 1},This fixes a small dialogue issue introduced with PR #8766 
2087290693,Add manual to Wesnoth about section,Gothyoba,2024-09-23 19:04:50+00:00,2024-09-29 17:56:16+00:00,"{'Docs': 1, 'UI': 1}","Fixes #9369 

I have tested this on both UI themes. This adds the manual just below the wiki when clicking on the about button on the bottom left."
2085602841,Display: simplify add_overlay interface,Vultraz,2024-09-23 04:37:38+00:00,2024-09-23 05:47:42+00:00,"{'Editor': 1, 'Lua API': 1}","Instead of passing all the arguments for an overlay to display::add_overlay, just take an rvalue-reference to an existing overlay object.

The overlay ctor was adjusted. It no longer takes a halo::handle argument, and the display class sets that manually."
2085338670,Fix improper uses of std::move detected with clang-tidy,jj-marr,2024-09-22 21:11:08+00:00,2025-01-25 13:58:45+00:00,"{'MP': 1, 'UI': 1, 'Editor': 1, 'Units': 1, 'Lua API': 1, 'Add-ons': 1, 'Building': 1, 'WFL': 1, 'Help': 1, 'SCons': 1, 'CMake': 1}","There are a few improper uses of `std::move` in the codebase.
### bugprone-use-after-move
An object should never be used after it is `std::move`d from. `std::move` generally makes no guarantees about a moved-from object's state aside from it being valid---anything that does happen is implementation-defined. The first commit in this PR makes it explicit what the code was implicitly doing when using a moved-from object.

https://clang.llvm.org/extra/clang-tidy/checks/bugprone/use-after-move.html

### bugprone-move-forwarding-reference
There's no code in the codebase that currently violates this rule. More or less, this check detects whether or not a function of the type:
`template<class X>
void foo( X&& x );`
decides to `std::move` from `x` in its body. Due to the vagaries of C++ templates, a function declared like this _can_ take in both lvalues and rvalues, so calling:
`std::string s = ""example"";
foo(s);`
Will clobber `s` and leave it in an undefined state. This check recommends using `std::forward` instead of `std::move`, which automatically decides whether or not to `std::move` the parameter in the function call.

https://clang.llvm.org/extra/clang-tidy/checks/bugprone/move-forwarding-reference.html
### cppcoreguidelines-rvalue-reference-param-not-moved
An rvalue reference parameter is guaranteed to disappear and never be used again once the function is complete. That means the function should probably `std::move` it into something else, otherwise there was no need to make the parameter an rvalue in the first place. This check enforces that.

As an example of why this is valuable, the method `replace_map_context_with` on `src/editor/map/context_manager.cpp:1054` takes in an rvalue `unique_ptr` to a `map_context` (called `mc`). This means any calls to this method must've been either an immediately created `unique_ptr` or a `std::move`d one. The function body then swaps the object in `mc` with another object in the `context_manager`'s list of `map_context`s. This swap is unnecessary since `mc` will expire at the end of the function call, so we can replace it with a `std::move(mc)` into the list of `map_context`s at the appropriate point.
 
https://clang.llvm.org/extra/clang-tidy/checks/cppcoreguidelines/rvalue-reference-param-not-moved.html

https://isocpp.github.io/CppCoreGuidelines/CppCoreGuidelines#f18-for-will-move-from-parameters-pass-by-x-and-stdmove-the-parameter
### performance-move-const-arg
This linter check warns when `std::move` is called on an object that won't actually be moved. For example, bools, integers, or constants won't be moved even if using `std::move` because their copy constructors are identical to their move constructors. The same applies for trivial types.

https://clang.llvm.org/extra/clang-tidy/checks/performance/move-const-arg.html
### performance-move-constructor-init
The move constructor of an object should move-construct its members and parents as well. Otherwise, we're likely making unnecessary copies from the original object's members.

https://clang.llvm.org/extra/clang-tidy/checks/performance/move-constructor-init.html
### performance-no-automatic-move
When returning a local variable from a method, the compiler will try to move that variable into the return value. However, this doesn't happen if the local variable is defined as `const`, since it isn't possible to move from a const. This linter check prevents unnecessary copies from a local variable to a return value.

https://clang.llvm.org/extra/clang-tidy/checks/performance/no-automatic-move.html"
2084470541,UtBS: cut duplicate stun weapon special remnants,Jonathan-Kelly,2024-09-21 13:00:24+00:00,2024-09-21 16:42:19+00:00,"{'Graphics': 1, 'Campaign UtBS': 1}",An identical copy of the stun weapon special was already moved to core by [#7323](https://github.com/wesnoth/wesnoth/issues/7323) (also this special is not used anywhere in UtBS).
2083460423,Move Cry from Elensefar to Core,Gothyoba,2024-09-20 15:32:25+00:00,2024-10-20 19:50:46+00:00,{'Audio': 1},"This music would be useful in core. I don't have to change any WML as I'm not actually changing any playlists. It's still specific to EI. The difference here is UMC creators can more easily use them without copying unnecessary files.

Edit: Failed copyright checks. Is music still using copyrights.csv?

Eidt 2: Looks like it is. I thought it was replaced with a metadata system."
2081291400,Increased text size for UMC Author note in terrain elevation help page,Gothyoba,2024-09-19 15:14:12+00:00,2024-09-19 15:15:03+00:00,{'Editor': 1},"This note was previously borderline unreadable on my screen. This makes it slightly larger. Still not as large as the other text, but it should be a bit easier to read."
2079529522,Display: clean up the FPS counter implementation,Vultraz,2024-09-18 20:27:42+00:00,2024-09-18 22:15:22+00:00,{},"* Makes it more type-safe by using chrono types more directly.
* Fixes a few design issues, such as the current time point being taken multiple times when updating the data.
* Fixes min and map FPS times being swapped"
2078234609,filter attribute integrates the tag_name check to verify that the attribute sought can be used there,newfrenchy83,2024-09-18 09:29:19+00:00,2024-09-28 03:24:04+00:00,{'Units': 1},resolve https://github.com/wesnoth/wesnoth/issues/7992 issue
2077566252,Typography update,Wedge009,2024-09-18 00:48:28+00:00,2024-10-05 22:13:10+00:00,"{'AI': 1, 'MP': 1, 'Unit Tests': 1, 'UI': 1, 'Editor': 1, 'Units': 1, 'Add-ons': 1, 'Prose': 1, 'Terrain': 1, 'Campaign EI': 1, 'Campaign L': 1, 'Campaign NR': 1, 'Campaign SoF': 1, 'Campaign SotBE': 1, 'Campaign TSG': 1, 'Campaign UtBS': 1, 'Campaign WC': 1}","Before anyone has another go at me for this: this pass was borne out of the discussion for #8000, and closes that issue. Since we do not yet have automated validation (that's #7967), unfortunately I doubt this is the last review that will be necessary. However, I've put considerable effort into picking up the bulk of what's left to do so it should only be the odd omission here and there - and future incoming omissions - to take care of.

Closes #8000."
2076671260,Enable clang-tidy and refactor NULL to nullptr,jj-marr,2024-09-17 15:23:19+00:00,2024-11-30 12:24:45+00:00,"{'MP': 1, 'UI': 1, 'Lua API': 1, 'Add-ons': 1, 'Building': 1, 'SCons': 1, 'CMake': 1}","clang-tidy is a linter tool that automatically checks for common code quality issues. This PR adds a cmake option `DCLANG_TIDY` that when set with `DCLANG_TIDY=ON` will automatically lint Wesnoth's code for the issues specified in `src/.clang-tidy`

As a representative example, the `NULL` macro is an implementation-defined keyword that is typically the integer 0. This causes issues because it is not actually a pointer type, and so will trigger integer overloads of methods preferentially to pointer overloads. In C++11, the keyword `nullptr` was introduced which is actually a pointer type and doesn't have this problem. This PR removes the last remaining usages of `NULL` or `0` from the codebase and enables `clang-tidy` to check for usage of `NULL` automatically.

Git submodules not owned by `wesnoth` are excluded from linting.

To use clang-tidy with an in-tree build:

1. Install `clang` and tooling
2. `cmake . -DCLANG_TIDY=ON && make`"
2075958591,[1.18] fix #9225 events with negative priority getting erroneously deleted,gfgtdf,2024-09-17 09:51:34+00:00,2024-09-18 00:10:55+00:00,{'WML': 1},"previously is_map_[id] would point to the wrong event, so that when an event was later deleted by id the wrong event would be deleted."
2075346972,Multiline markup and link support and MP lobby text copy support,babaissarkar,2024-09-17 04:40:16+00:00,2024-09-19 03:01:47+00:00,"{'Enhancement': 1, 'MP Lobby': 1, 'UI': 1, 'Editor': 1}","Resolves #1206.

![Screenshot from 2024-09-19 07-14-36](https://github.com/user-attachments/assets/1f827cde-ba4d-46ae-80c5-947a66118f0e)

This allows text to be selected from the MP lobby chat log area.

Introduces the following two keys in `multiline_text` and `scroll_text`: `use_markup` and `link_aware`. Markup support only works for non-editable text areas only ATM, which is relevant to the usecase of #1206. Editable text areas with formatted text are outside the scope of this PR, but may be done in future (that essentially makes `multiline_text` a pango rich text editor)."
2075272830,Enable clang-tidy for Wesnoth,jj-marr,2024-09-17 03:06:10+00:00,2024-09-22 18:38:19+00:00,"{'AI': 1, 'UI': 1, 'Lua API': 1, 'Building': 1, 'WFL': 1, 'CMake': 1}","To run clang-tidy on the Wesnoth source code, add:
`-DCLANG_TIDY=ON` to your cmake command line. Then, when running `make`, clang-tidy will lint the compiled code for errors.
Right now, only the absolutely required clang-tidy checks are enabled. These mainly catch `nullptr` dereferences and divisions by zero. The fixes I've added (just assert that something isn't a `nullptr`) aren't the best, I'll likely need advice on some of them."
2075224019,add code documentation for the tokenizer,Pentarctagon,2024-09-17 02:11:25+00:00,2024-09-23 18:29:43+00:00,{'Engine': 1},also clean it up a bit/make usage of things consistent
2074606039,add amla advancement to [modify_unit_type] and fix male/female/variation subtags not supported,newfrenchy83,2024-09-16 18:05:26+00:00,2024-10-27 14:14:45+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1}","Addresses https://github.com/wesnoth/wesnoth/issues/9309 

when used, the amlas in [unit_type] are replaced by list of amlas in [modify_unit_type],i cannot done add [advancement] without erase amla already present."
2073743577,Feature Request: add `[advancement]` to `[modify_unit_type]`,knyghtmare,2024-09-16 11:06:06+00:00,2024-10-04 13:25:06+00:00,"{'Enhancement': 1, 'WML': 1, 'Units': 1, 'Schema': 1}",Addresses #9309 
2072944056,More small config things,Vultraz,2024-09-15 21:32:14+00:00,2024-09-18 19:42:21+00:00,"{'UI': 1, 'Lua API': 1}",CI run
2072900895,Expand Lua plugin API,CelticMinstrel,2024-09-15 19:29:01+00:00,2025-01-15 14:46:42+00:00,"{'macOS': 1, 'AI': 1, 'Docs': 1, 'Unit Tests': 1, 'UI': 1, 'Units': 1, 'Lua API': 1, 'Building': 1, 'WFL': 1}",This expands the Lua plugin API to allow a plugin to play a single-player campaign.
2072761116,Use proper apostrophe to spell Shek’kahan,Gothyoba,2024-09-15 15:48:37+00:00,2024-09-16 20:51:40+00:00,"{'Campaign TRoW': 1, 'Campaign WoF': 1}",This follows the typography style guide.
2072714920,Remove any_tag for a more useful schema validation,soliton-,2024-09-15 13:58:08+00:00,2024-09-24 07:12:48+00:00,"{'CI': 1, 'Schema': 1}",
2072465677,Minor config cleanup,Vultraz,2024-09-14 21:36:33+00:00,2024-09-15 04:16:51+00:00,"{'AI': 1, 'UI': 1, 'Units': 1, 'Lua API': 1, 'Add-ons': 1, 'WFL': 1}",CI run
2071052514,UtBS: move ability events into ability tags,Jonathan-Kelly,2024-09-13 14:42:15+00:00,,{'Campaign UtBS': 1},Simple refactor of UtBS's custom abilities and weapon specials which nests their events inside the ability and special tags themselves. This is made possible by #9236.
2070131816,Add a second unit test for TEST_FORCE_CHANCE_TO_HIT,stevecotton,2024-09-13 06:32:24+00:00,2024-09-13 17:15:56+00:00,{'Unit Tests': 1},"It should work even when the macro appears in the same event as the attack; this tests that.

The new one uses the COMMON_KEEP macro, but I've left the existing one unchanged, except for the renaming."
2069271002,fix feeding test.,newfrenchy83,2024-09-12 18:02:14+00:00,2024-09-13 07:43:44+00:00,{'Unit Tests': 1},"On ubuntu c++17, FORCE_CHANCE_TO_HIT macro don't work and test fail randomly.

If i see correct, then tis commit should fix that."
2067805812,A bunch of Lua/WFL API updates,CelticMinstrel,2024-09-12 05:42:31+00:00,2024-09-15 19:27:39+00:00,"{'macOS': 1, 'Unit Tests': 1, 'UI': 1, 'Units': 1, 'Lua API': 1, 'Building': 1, 'WFL': 1, 'Schema': 1}","I've been working on a bunch of mostly-small updates to the API. Some of these are adding little things that were missing, and I also put a lot of work into adding `__dir` metamethods in the Lua API to make more parts somewhat self-documenting. There'll probably still be more to come, but I thought I should run the CI before it gets _too_ long."
2067001600,Replace the recursion decoptge method with the less CPU-intensive config comparison method,newfrenchy83,2024-09-11 18:49:12+00:00,2024-10-15 18:13:01+00:00,"{'Unit Tests': 1, 'Units': 1}","When I use an ability id=A and include [filter][filter_adjacent]ability_id_active=A, the more units with the adjacent ability I add to it, the slower the game becomes, and at the third unit the game freezes, whereas with the direct comparison of the configs the game only slows down significantly after the 5th unit added."
2066497096,GUI2: new base class and lua support for menu_button,white-haired-uncle,2024-09-11 14:36:58+00:00,2024-12-05 14:52:37+00:00,"{'macOS': 1, 'UI': 1, 'Lua API': 1, 'Building': 1, 'Schema': 1}","Create new options_button, basically a menu_button with state and button label updates removed.  Basically the Menu/Actions button in game.

Use new options_button as base class for menu_button.

Add Lua support.
    - Currently mostly working except references from add_item() are not invalidated when underlying config is removed."
2065772474,Remove unit recursion of special_unit_matches() (1.18 backport),newfrenchy83,2024-09-11 09:19:51+00:00,2024-09-12 08:51:54+00:00,{'Units': 1},"Like unit recursion depth is to 3 and attack recursion 4, what count begin if and only if ability_(id/type) active called is more appropriate."
2064790558,Clean up use of chrono types in log code,Vultraz,2024-09-10 22:24:06+00:00,2024-09-11 01:09:28+00:00,{},
2064645125,GUI2/LuaAPI: add len operator to container widgets,white-haired-uncle,2024-09-10 21:32:01+00:00,2024-09-11 02:25:06+00:00,{'Lua API': 1},"Enables length operator for listbox, multi_page, tree_view and tree_view_node, e.g. 
`dialog.lb_slider.max_value = #dialog.lb`

number_of_items() was recently added to lua_widget_methods.cpp.  I kind of feel like that should be moved somewhere where it can be shared, for example I could use it here instead of replicating the work.  Wouldn't save anything here, but it'd be consistent.  I'm just not sure if it's worth doing, or where it would go.  Or perhaps all containers should have the same get_item_count()?"
2064633002,Clarify unit type description label,ProditorMagnus,2024-09-10 21:27:37+00:00,2024-09-10 23:14:13+00:00,{},"Unit description is not yet implemented. Once it is, I expect menu item is changed back to unit description, while the opened dialog has link to navigate to unit type description."
2063353745,add 'core' folder in folder list of boost folder used in include,newfrenchy83,2024-09-10 13:30:06+00:00,2024-09-10 14:15:37+00:00,{'Building': 1},
2063288381,Extend case-insensitive filtering beyond ASCII characters,Wedge009,2024-09-10 13:03:54+00:00,2024-09-11 18:42:45+00:00,"{'Backport': 1, 'Translations': 1, 'UI': 1, 'Add-ons': 1}","Attempt to resolve #9328.

Caveats:
1. This is based purely on the discussion from the linked issue. I don't know if I've covered all the details discussed therein.
2. This seems to work for me, but at present I don't have non-ASCII characters in my saved game names, so I can't properly test this.
3. The game load dialogue isn't the only place where case-insensitive searching is limited to ASCII characters. If this change is accepted, then potentially it could be applied to other searches:

https://github.com/wesnoth/wesnoth/blob/47642719bf4e5519945f99d579c926d43725a04d/src/gui/dialogs/addon/manager.cpp#L68-L77

https://github.com/wesnoth/wesnoth/blob/47642719bf4e5519945f99d579c926d43725a04d/src/menu_events.cpp#L1393-L1397

https://github.com/wesnoth/wesnoth/blob/47642719bf4e5519945f99d579c926d43725a04d/src/game_initialization/lobby_data.cpp#L503-L506

https://github.com/wesnoth/wesnoth/blob/47642719bf4e5519945f99d579c926d43725a04d/src/serialization/string_utils.cpp#L664-L669

Also, given this is an improvement at least for players using non-ASCII translations, it could possibly be back-ported."
2062367776,plague tests,Pentarctagon,2024-09-10 04:34:24+00:00,2024-09-10 23:14:50+00:00,{'Unit Tests': 1},
2062240734,[1.18] Update the help page entry for the Item tool,babaissarkar,2024-09-10 01:51:42+00:00,2024-09-13 01:31:20+00:00,"{'Backport': 1, 'Editor': 1, 'Prose': 1, 'Help': 1}",Reflects the change that it is now possible to remove items.
2062228347,Preferences: move the Apply button and disable it unless needed,babaissarkar,2024-09-10 01:35:50+00:00,2024-09-11 19:07:49+00:00,{'UI': 1},"Moves the Apply button beside the UI Theme list and disables it unless the theme is changed.
This also makes it obvious that the Apply button is used only for UI theme selection, and is not a global Apply button.

![Screenshot from 2024-09-10 06-56-03](https://github.com/user-attachments/assets/12ff5615-d5e6-44c0-8f7d-154d68eee952)
"
2060573799,Remove unit recursion of special_unit_matches() ,newfrenchy83,2024-09-09 08:59:42+00:00,2024-09-10 23:14:40+00:00,{'Units': 1},"Like unit recursion depth is to 3 and attack recursion 4, what count begin if and only if ability_(id/type) active called is more appropriate."
2059855316,Avoid using wildcards for checking filename extensions,stevecotton,2024-09-08 20:07:51+00:00,2025-08-20 07:55:36+00:00,"{'Enhancement': 1, 'Engine': 1}","According to Valgrind's Callgrind tool, around 2.7% of the time for running unit tests is spent on checking for blacklisted filenames in filesystem::is_legal_filename.

This drops that to around 0.8%."
2059714571,[1.18] Test calculations of abilities with add and sub,stevecotton,2024-09-08 12:52:57+00:00,2024-09-08 14:28:40+00:00,{'Unit Tests': 1},"Fix a typo in the add_sub_separated test, because it was testing exactly the same code as add_sub_cumulative.

Add two new tests and clarify documentation, because in these tests the order of the abilities determines whether the add or sub value is used, it isn't that sub always overrides add.

(cherry picked from commit 547de5fd93c5dca321c4382c265a90d93ed3f30b)"
2059644558,Fix recursion abilitie count version1.18,newfrenchy83,2024-09-08 09:34:47+00:00,2024-09-08 11:13:32+00:00,"{'Unit Tests': 1, 'Units': 1}",
2059576283,Add utils::span wrapper,Vultraz,2024-09-08 05:28:31+00:00,2024-09-08 06:38:24+00:00,{},CI run
2059550581,[For CI] Bump min Boost to 1.82,Vultraz,2024-09-08 03:19:15+00:00,2024-09-08 04:58:32+00:00,"{'Building': 1, 'Packaging': 1, 'SCons': 1, 'CMake': 1}","1.82 adds boost::mysql, which Pent means to make use of, and 1.78 adds boost::span, which I want to make use of."
2059088011,Test calculations of abilities with add and sub,stevecotton,2024-09-07 14:09:02+00:00,2024-09-07 19:02:39+00:00,{'Unit Tests': 1},"Fix a typo in the add_sub_separated test, because it was testing exactly the same code as add_sub_cumulative.

Add two new tests and clarify documentation, because in these tests the order of the abilities determines whether the add or sub value is used, it isn't that sub always overrides add.

Will merge-conflict with #7271, but I'd prefer to have this merge first, documenting what the behavior was, and then have #7271 change the tests as documentation of what it changes."
2059028721,Update the help page entry for the Item tool,babaissarkar,2024-09-07 10:43:48+00:00,2024-09-10 00:44:34+00:00,"{'Backport': 1, 'Editor': 1, 'Prose': 1, 'Help': 1}","Updates the help page entry for the item tool to reflect the changes in 7065ed9fde535e14b45a3e8bad1dfc74ea663b9f, in particular, that removal of items is now possible. Should be backported."
2058670539,petrifies tests,Pentarctagon,2024-09-06 20:49:40+00:00,2024-09-08 00:53:08+00:00,{'Unit Tests': 1},
2058501544,fix submerge item issue,newfrenchy83,2024-09-06 18:30:01+00:00,2024-09-07 05:04:43+00:00,{},"fix https://github.com/wesnoth/wesnoth/issues/9305 issue.

ter_sub was not include in if loop condition and submerge calculation made a multiply by zero."
2057604211,fix tag_name check deficiencies(1.18 backport),newfrenchy83,2024-09-06 09:26:29+00:00,2024-09-07 08:23:28+00:00,"{'Unit Tests': 1, 'Units': 1}","The tag_name check is deficient for two reasons:
1.when apply_to=both is used, in the case of [damage_type] [filter_opponent][filter_weapon]type= will check the modified type for application to the owner and the original type for application to the opponent, hence a risk of infinite recursion, especially if [filter_self][filter_weapon]type= is used in the same weapon.

2. in the case of apply_to=attacker/defender, the check for [filter_attacker/defender] must take into account both the value of the variable is_attacker but also the application AFFECT_SELF/OTHER, otherwise in the case apply_to=defender with [filter_defender][filter_weapon]type=, and[filter_attacker][filter_weapon]type= otherwise we end up in the same configuration as for apply_to=both

Finally tag_name is renamed check_if_recursion to mean that this variable is used to ensure that a recursion cannot be set up even if https://github.com/wesnoth/wesnoth/commit/743b146efc1e9c643a601317de491dcadffc760b prevents it from causing a crash but with an error log"
2057179964,[1.18] item tool: add right-click to remove functionality,babaissarkar,2024-09-06 04:40:26+00:00,2024-09-06 14:59:17+00:00,"{'Backport': 1, 'UI': 1, 'Editor': 1}","Backport of the item tool improvement from #9273 (https://github.com/wesnoth/wesnoth/commit/7065ed9fde535e14b45a3e8bad1dfc74ea663b9f). This allows to remove items by right clicking with the unit tool.

![363065203-8b8fd4bd-e1ad-4bc1-ae60-6da5b1735b26](https://github.com/user-attachments/assets/d23c3cca-44c8-42ef-9d02-fcb5d7ad7416)
"
2057177057,[1.18] Item tool enhancement backport,babaissarkar,2024-09-06 04:36:54+00:00,2024-09-06 04:37:26+00:00,"{'Backport': 1, 'macOS': 1, 'AI': 1, 'Docs': 1, 'Graphics': 1, 'MP': 1, 'Translations': 1, 'Unit Tests': 1, 'UI': 1, 'WML Tools': 1, 'Editor': 1, 'Units': 1, 'Services': 1, 'Lua API': 1, 'Add-ons': 1, 'Building': 1, 'Packaging': 1, 'Help': 1, 'SCons': 1, 'CMake': 1, 'Schema': 1, 'Terrain': 1, 'Achievements': 1, 'Campaign DM': 1, 'Campaign DiD': 1, 'Campaign EI': 1, 'Campaign HttT': 1, 'Campaign LoW': 1, 'Campaign L': 1, 'Campaign SoF': 1, 'Campaign SotA': 1, 'Campaign THoT': 1, 'Campaign Tutorial': 1, 'Campaign UtBS': 1, 'Campaign WoF': 1, 'Campaign WC': 1}","Backport of the item tool improvement from #9273 (https://github.com/wesnoth/wesnoth/commit/7065ed9fde535e14b45a3e8bad1dfc74ea663b9f). This allows to remove items by right clicking with the unit tool.

![363065203-8b8fd4bd-e1ad-4bc1-ae60-6da5b1735b26](https://github.com/user-attachments/assets/d23c3cca-44c8-42ef-9d02-fcb5d7ad7416)
"
2054721842,Fixes unit moving during attack selection screen,Mahoyomu,2024-09-05 04:47:22+00:00,2025-02-27 01:53:29+00:00,"{'macOS': 1, 'Graphics': 1, 'MP': 1, 'Unit Tests': 1, 'UI': 1, 'Editor': 1, 'Units': 1, 'Lua API': 1, 'Building': 1, 'WFL': 1, 'Help': 1, 'Schema': 1, 'Campaign DW': 1}","### Goal of the PR
- Resolves #8728.
### How does the PR work?
- By keeping the unit place not changed, and deal with the logic that a unit must stand beside the other in order to launch an attack.
### Does it resolve any reported issue?
- #8728
### If not a bug fix, why is this PR needed? What use cases does it solve?
- This is a bug fix.

## To do

Adjust possibly missed related method. If the ranged attack units(which can attack from 2 or more hexes away) come into being, more changes need to take place for backward compat.

This PR is Ready for Review.

## How to test
Compile and run, see the test video I uploaded, or see changes in the src."
2053939569,Singleplayer-oriented stats proposal for some level 3-4 mages,Dalas121,2024-09-04 17:02:15+00:00,2025-03-31 00:05:59+00:00,"{'Enhancement': 1, 'Units': 1}","This is a PR with several proposed changes for high-level mages, aimed primarily at improving Wesnoth's singleplayer campaigns.

Problems I'm trying to address:
- In long or large-scale campaigns, having a default L4 advancement makes a unit line significantly more desirable than others, irregardless of their XP cost.
- The Great Mage has long been overshadowed by the other L4 mages, particularly after the recent Sylph buffs. 
- The Elven Shyde, Enchantress, and Sylph are still very powerful compared to their 1.16 counterparts. Additionally, the Shyde/Sylph's magical attacks were buffed far more than their slowing attacks, shifting their role to be less supportive.
- The Necromancer has more HP than a Royal Guard plus 10% impact resistance, which is thematically odd. In addition, the Necro's defining ability (plague) is limited to their 6x3 melee attack.

Proposed changes:
- ~~Make the Sylph and Great Mage optional advancements. The {ENABLE_ELVISH_SYLPH} and {ENABLE_GREAT_MAGE} macros can easily re-enable them for any UMC (or campaigns), so this shouldn't break anything.~~ **[NEW:** Add {DISABLE_ELVISH_SYLPH} and {DISABLE_GREAT_MAGE} macros to core, allowing campaign/UMC authors to ""officially"" disable these advancements.]
- Increase the Great Mage's fire attack from 17x4 to 18x4.
- Revert the Shyde's pierce attack back down to 1.16's 8x3, her impact attack back down to 1.16's 6x3, her melee attack back down to 1.16'x 6x2, and her hitpoints back down to 1.16's 46.
- Revert the Enchantress's arcane attack back down to 1.16's 9x4, **[NEW:** but increase her impact attack up to 7x4].
- Revert the Sylph's hitpoints back down to 1.16's 60 and reduce her arcane attack to ~9x5~ 10x5, **[NEW:** but increase her impact attack up to 8x5.]
- Revert the Necromancer's ~~cold attack back down to 1.16's 17x2~~ **[NEW:** increase his cold attack up to 20x2], his arcane attack back down to 1.16's 12x2, and his impact resistance back down to 1.16's 0%. Reduce his hitpoints from 76 to 62, but add the plague weapon special to his arcane (not cold) attack.
I'll appreciate hearing all of your opinions on this proposal.

Hejnewar is shadowbanned from github, but he's been discussing in [this forum thread](https://forums.wesnoth.org/viewtopic.php?p=693009#p693000).

** **
Table of changes, as requested by OrekOrek:

| Shyde | Cost | HP | XP | D | S | DxS | WS | D | S | DxS | WS | D | S | DxS | WS |
| ---: | ---: | ---: | ---: | ---: | ---: | ---: | ---: | ---: | ---: | ---: | ---: | ---: | ---: | ---: | ---: |
| 1.16 | 52 | 46 | 150 | 6 | 2 | 12 | ma | 6 | 3 | 18 | sl | 8 | 3 | 24 | ma |
| 1.18 | 69 | 51 | 150 | 7 | 2 | 14 | ma | 8 | 3 | 24 | sl | 14 | 3 | 42 | ma |
| #8749 | 58 | 51 | 150 | 7 | 2 | 14 | ma | 7 | 3 | 21 | sl | 10 | 3 | 30 | ma |
| #9300 | 52 | 46 | 150 | 6 | 2 | 12 | ma | 6 | 3 | 18 | sl | 8 | 3 | 24 | ma |
| **Enchantress** |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
| 1.16 | 55 | 50 | 180 | 6 | 2 | 12 |  | 5 | 4 | 20 | sl | 9 | 4 | 36 | ma |
| 1.18 | 70 | 50 | 198 | 6 | 2 | 12 |  | 7 | 4 | 28 | sl | 13 | 4 | 52 | ma |
| #8749 | 62 | 50 | 180 | 6 | 2 | 12 |  | 6 | 4 | 24 | sl | 11 | 4 | 44 | ma |
| #9300 | 60 | 50 | 198 | 6 | 2 | 12 |  | 7 | 4 | 28 | sl | 9 | 4 | 36 | ma |
| **Sylph** |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
| 1.16 | 67 | 60 | 200 | 6 | 3 | 18 | ma | 6 | 5 | 30 | sl | 10 | 5 | 50 | ma |
| 1.18 | 161 | 68 | 200 | 6 | 3 | 18 | ma | 7 | 5 | 35 | sl | 16 | 5 | 80 | ma |
| #8749 | 135 | 68 | 200 | 6 | 3 | 18 | ma | 7 | 5 | 35 | sl | 13 | 5 | 65 | ma |
| #9300 | 115 | 60 | 200 | 6 | 3 | 18 | ma | 8 | 5 | 40 | sl | 10 | 5 | 45 | ma |
| **Arch Mage** |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
| 1.16 | 59 | 54 | 220 | 7 | 2 | 14 |  | 12 | 4 | 48 | ma |  |  |  |  |
| 1.18 | 63 | 54 | 150 | 7 | 2 | 14 |  | 12 | 4 | 48 | ma |  |  |  |  |
| #9300 | 63 | 54 | 220 | 7 | 2 | 14 |  | 12 | 4 | 48 | ma |  |  |  |  |
| **Great Mage** |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
| 1.16 | 72 | 65 | 200 | 9 | 2 | 18 |  | 16 | 4 | 64 | ma |  |  |  |  |
| 1.18 | 110 | 65 | 200 | 9 | 2 | 18 |  | 17 | 4 | 68 | ma |  |  |  |  |
| #9300 | 115 | 65 | 200 | 9 | 2 | 18 |  | 18 | 4 | 72 | ma |  |  |  |  |
| **Necromancer** |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
| 1.16 | 50 | 70 | 150 | 6 | 3 | 18 | pl | 17 | 2 | 34 | ma | 12 | 2 | 24 | ma |
| 1.18 | 90 | 76 | 150 | 6 | 3 | 18 | pl | 19 | 2 | 38 | ma | 16 | 2 | 32 | ma |
| #9300 | 90 | 62 | 150 | 6 | 3 | 18 | pl | 20 | 2 | 40 | ma | 12 | 2 | 24 | ma,pl |
| **Lich** |  |  |  |  |  |  |  |  |  |  |  |  |  |  |  |
| 1.16 | 50 | 60 | 150 | 8 | 3 | 24 | dr | 12 | 3 | 36 | ma | 9 | 3 | 27 | ma |
| 1.18 | 90 | 60 | 150 | 8 | 3 | 24 | dr | 12 | 3 | 36 | ma | 9 | 3 | 27 | ma |

For attacks, left=melee, middle=1st ranged, right= 2nd ranged.
D: Damage, S: Strikes, DxS: D times S (total damage), WS: Weapon Special (ma=magical, sl=slow, pl=plague, dr=drain)"
2052728877,"Cleaned up ellipse rendering, combined ellipse images",Vultraz,2024-09-04 07:32:13+00:00,,"{'Graphics': 1, 'Units': 1}","Split the ellipse drawing into its own function. render_unit is massive and needs to be cleaned up. Rewrote the code to be much more readable in the process. It also resolves a bunch of logical messes, such as still registering a handle with the drawing buffer if ellipse was set to ""none"" or draw_bars was false.

Combined all the ellipse top/bottom images into single images. As far back as I can find, the rendering code has always drawn the two halves on the same layer, so it really doesn't make sense to have them be separate images. In case any addons still use the old two-image format, they will be used as a fallback if a single image isn't found."
2051602613,Fix recursion ability count version,newfrenchy83,2024-09-03 16:11:17+00:00,2024-09-07 14:45:26+00:00,"{'Unit Tests': 1, 'Units': 1}",
2050793714,Fix typos in test of recursion,newfrenchy83,2024-09-03 09:25:24+00:00,2024-09-03 16:39:22+00:00,"{'Unit Tests': 1, 'Units': 1}",
2050420764,[1.18] Backport of PRs 9245 and 9291,babaissarkar,2024-09-03 05:28:03+00:00,2024-09-03 14:34:32+00:00,"{'Backport': 1, 'Prose': 1}","Removes some inappropriate and inconsistent names from `names.cfg`.
Relevant PRs: #9245 and #9291."
2049881443,Highlight reachable hexes instead of darkening unreachable hexes,Descacharrado,2024-09-02 16:44:18+00:00,2024-10-18 03:23:53+00:00,"{'Graphics': 1, 'WML Tools': 1, 'Schema': 1, 'Terrain': 1}","This is a **_first step_** to make the ""you can't move here"" overlay (reach) look nicer (issue #9027).

This would be the current (updated after aa879b6) implementation:

![untitled](https://github.com/user-attachments/assets/7b2c148f-1e7f-437b-999c-3f6f9b3c409f)

~The highlighting is much more noticeable ingame, compared to a still image, but~ the exact color used is open for debate.
Also, as can be seen in the image, the reach gets on top of the cave walls, which is not the nicest thing imo.

[Here](https://github.com/wesnoth/wesnoth/issues/9027#issuecomment-2186512507) is the proposed mockup by Dalas 

- [X] A border on the furthest-away hexes (or the limit of the reach) as Dalas proposed would be very visually pleasing, but I wouldn't know where to start to implement that. Edit: seems like I was.
- ~[ ] Also, changing the color of the reach to the color of the team you are selecting would be a _cool_ adition.~ Decided not to do this part in this PR. See comments below.



"
2049815754,Unit Names: remove inappropriate saurian name,knyghtmare,2024-09-02 15:47:44+00:00,2024-09-02 16:31:57+00:00,{'Prose': 1},"So, removing this word for...self-explanatory reasons."
2048637769,Mass cleanup of index-based teams list access,Vultraz,2024-09-02 03:51:15+00:00,2024-09-03 17:31:06+00:00,"{'AI': 1, 'UI': 1, 'Lua API': 1, 'WFL': 1}","Mostly converting index-based loops to for loops. Includes a couple other non-team loops that were in the files I was editing.

~NOTE: currently on top of #9285~"
2048460251,various animations,doofus-01,2024-09-01 23:12:36+00:00,2024-10-06 01:25:06+00:00,"{'Graphics': 1, 'Units': 1}","No real plan, just whatever I can get done in the next couple weekends.
 - orcish warrior attack/defend
 - goblin pillager torch (standing, mostly) and 3-frame net attack anim
 - orcish warlord attack(alt)"
2048386405,AToTB: Add Maghre to bigmap,Gothyoba,2024-09-01 19:26:00+00:00,2024-09-01 20:50:35+00:00,"{'Graphics': 1, 'Campaign AToTB': 1}","Edit: It seems I’ve accidently deleted the metadata. I will mark this as a draft until I solve that (probably tomorrow).

Adds Maghre to the AToTB big map. This is only small village, but in the context of the campaign it is quite important. It is the location Mordak terrorized at the start, the location of scenario 1, and the location of the final battle.

New map:

![Maghre](https://raw.githubusercontent.com/Gothyoba/wesnoth/atotb-bigmap-update/data/campaigns/Two_Brothers/images/maps/tb.webp)

Current Map:

![NoMaghre](https://raw.githubusercontent.com/wesnoth/wesnoth/master/data/campaigns/Two_Brothers/images/maps/tb.webp)"
2048379044,heal_on_hit tests - results identical aside from default value,Pentarctagon,2024-09-01 19:04:55+00:00,2024-09-02 00:40:14+00:00,{'Unit Tests': 1},
2048324375,UI support for real-ranged attacks,hladkyjakub,2024-09-01 16:29:21+00:00,2025-03-27 20:35:33+00:00,"{'UI': 1, 'Engine': 1}","This makes units with weapons with custom min/max_range capable of attack when controlled by player.
(I have the AI code too, but not in this PR)
For proper working requires these PR merged:
Propper max/min_range: https://github.com/wesnoth/wesnoth/pull/9203
Propper UI preview: https://github.com/wesnoth/wesnoth/pull/9255"
2047931585,Disp team index cleanup,Vultraz,2024-09-01 00:34:59+00:00,2024-09-02 16:37:41+00:00,"{'UI': 1, 'Editor': 1, 'Units': 1, 'Lua API': 1}","Removes the hideously confusing distinction between `viewing/playing_team` (the vector index) and `viewing/playing_side` (the side number). We only expose the index and query the team object for the side number, if needed."
2047414366,Reduce Corpse/Soulless arcane vulnerablility from -40% to -20%,Dalas121,2024-08-31 00:40:21+00:00,2024-09-01 23:25:34+00:00,{'Units': 1},"Resolves #9224

Hejnewar says he doesn't have strong feelings about this right now, but that originally it was an oversight to leave Corpse/Soulless arcane resist at -40%. Making this PR to keep things consistent, and also because I think it's a generally positive change."
2047169491,Bunch of small things for a CI run,Vultraz,2024-08-30 20:28:36+00:00,2024-08-31 09:08:19+00:00,"{'Units': 1, 'Terrain': 1}",
2047165164,AToTB: Use month names instead of Roman Numerals,Gothyoba,2024-08-30 20:25:10+00:00,2024-09-02 21:09:11+00:00,{'Campaign AToTB': 1},"A small tweak to the story text in AToTB that replaces roman numerals for months with Wesnoth’s fictional month names. The months are shown in the in-game encyclopedia. As far as I’m aware, these are 
only used in Liberty and  Eastern Invasion. Presuming they map to the Gregorian months, Scryer’s Bloom is around May and Stillseed is around September."
2046725394,SotBE S7: UX improvements,knyghtmare,2024-08-30 15:45:36+00:00,2024-08-31 09:23:55+00:00,"{'Enhancement': 1, 'Campaign SotBE': 1}","- add auxiliary camp keep and camp

There is fog of war enabled and no distinct way to tell what the enemy sides are (unless you are playing as a veteran with foreknowledge). We add second keep and camp of 2 hexes to allow player to react to facing the bandits (as in, to recall/recruit a Grunt/Whelp to combat as these types would not be usually recalled since Sand Scuttlers are heavily resistant vs Impact)

- make scorpions avoid villages

Some players have expressed that ""it's not fair"" that the scorpions would spawn behind them and then damage their per turn income (by stealing villages), leading to low bonus gold at scenario end.  "
2046392959,replace generic icon/name with wesnoth's icon and name,babaissarkar,2024-08-30 13:14:12+00:00,2024-08-30 19:36:15+00:00,{'Packaging': 1},
2044673314,Include the unknown condition in the error message,soliton-,2024-08-29 18:07:18+00:00,2024-09-13 19:51:43+00:00,{'Lua API': 1},
2044615765,"Fix deprecated lambda capture, includes display overlay drawing cleanup",Vultraz,2024-08-29 17:37:54+00:00,2024-08-29 18:41:17+00:00,"{'MP': 1, 'Add-ons': 1}",
2044385707,Enable a C++20 CI build,Vultraz,2024-08-29 15:38:32+00:00,2024-08-31 15:56:48+00:00,{'CI': 1},
2044087843,Editor enhancements,babaissarkar,2024-08-29 13:48:22+00:00,2024-09-06 03:32:05+00:00,"{'UI': 1, 'Editor': 1}","1. Item tool: Right click now removes items from the map (https://forums.wesnoth.org/viewtopic.php?t=54905)

![Screenshot from 2024-08-30 11-59-01](https://github.com/user-attachments/assets/8b8fd4bd-e1ad-4bc1-ae60-6da5b1735b26)

2. If an addon is selected using Select active Add-on option, the Unit menu now becomes active and the Unit Type Editor can be accessed.

3. New validation check for filenames with whitespaces.
![Screenshot from 2024-09-02 08-21-31](https://github.com/user-attachments/assets/2865109e-5c70-4f3f-9c99-c2b22b05de10)

4. Using comboboxes for Attack range and types that show icons. (Partial custom type/range support)
![Screenshot from 2024-09-02 14-54-03](https://github.com/user-attachments/assets/b72e4a54-88ac-47a7-ac68-7b1e0343c2d2)

5. Icons are also shown for race and alignments.
![Screenshot from 2024-09-02 14-35-17](https://github.com/user-attachments/assets/ff4dca0c-66af-4233-bb6e-b1e6e4fa47fd)

6. Fixes a bug that disabled the Save button when a filename was selected from list instead of typed manually.

7. Unit type editor: Add a quit confirmation to cancel button so the user doesn't lose data.

8. File Dialog: Fix a bug that stopped the user bookmarks from getting saved. (Resolves #9298)"
2042868515,firststrike tests,Pentarctagon,2024-08-28 23:15:47+00:00,2024-08-31 15:14:36+00:00,{'Unit Tests': 1},
2042543313,WoF: Change Leopard race to cats,Gothyoba,2024-08-28 18:43:44+00:00,2024-08-29 15:36:27+00:00,"{'Units': 1, 'Campaign WoF': 1}"," Given the new cats race, I think it makes more sense for them to be cats, and to not use the wolf undead variation. So I changed the race from monster to cats."
2041899525,SOTBE S5: some UX improvements,knyghtmare,2024-08-28 12:58:55+00:00,2024-08-28 16:55:11+00:00,"{'Enhancement': 1, 'Campaign SotBE': 1}","- give side 1 starting villages near the orc base
- move Kapou'e to his keep at start"
2041369896,SotBE S6: replace bad advice at turn 2,knyghtmare,2024-08-28 08:28:57+00:00,2024-08-28 16:54:24+00:00,"{'Enhancement': 1, 'Prose': 1, 'Campaign SotBE': 1}","- Making Gruu do a suicidal solo charge? Yeah, no.

- To win this scenario, it's imperative that Kapou'e can reach the unoccupied keep at Tirigaz Harbor. His only starting units are Gruu, and maybe Jetto (if he's alive). So, he delays by even a turn, it's a full restart...Thus, we give some hint to the player to focus on the first goal: getting Kapou'e to the keep. 

- Sending Gruu to face side 2 loyalists alone is suicide. He is easily overwhelmed even at level 3 Great Troll."
2040665534,Back-port #9004 to resolve #9259 (wmlscope),Wedge009,2024-08-27 23:08:59+00:00,2024-08-28 05:25:56+00:00,"{'WML Tools': 1, 'Stable 1.18': 1}",
2040590138,gui2: complete support for spinner,white-haired-uncle,2024-08-27 21:49:50+00:00,2024-12-05 14:52:36+00:00,"{'UI': 1, 'Lua API': 1, 'Schema': 1}","I believe this provides a completion for the spinner.

@babaissarkar, when I started on this I thought I was just adding a little lua support.  I hope I didn't get too carried away with the changes I made.

1. There is a can_wrap/wrap parameter.  I'm not sure what it does, but it looks like it's fixed to true AND in schema, which doesn't seem right to me.  I didn't do anything with lua for that, I'm guessing if it is supposed to always be true it should just be removed from schema.
3. I don't know when member functions go in hpp, and when in cpp.  I kind of just stuck with what was there, though it feels kind of wrong to me.
4. It's possible to type a number (or anything else really) in the text_box that is outside the min/max if used.  I don't know how to avoid this, or immediately update the value since there is no way to know when the user is done inputting (I suppose you could add a mouse leaves event, but even then you're not guaranteed the user will move the mouse).  So the invalid value does not get updated until you press a button or close the menu (in which case, if it is below the min it gets set to the min, above the max gets set to the max).  I think this is just the nature of using a text_box for numerical input.
5. Now that I think about it, it's possible to set min=max (as long as you don't try to set a step size).  Seems like kind of a silly thing to do, but probably not technically an error?

Resolves #9080.

would benefit from #9261 "
2038028234,Update to Lua 5.4.7,Vultraz,2024-08-26 18:45:25+00:00,2024-08-26 20:18:42+00:00,{},
2037737325,add optional data type support,white-haired-uncle,2024-08-26 16:03:52+00:00,2024-08-27 18:36:54+00:00,{'Lua API': 1},"@gfgtdf wrote this for me

Adds the ability to set a variable to nil in lua to indicate ""unused"" instead of just, for example, an int.  Or at least, that's what I'm using it for.

Example (tested):

```
dialog.no_max.on_button_click = function() dialog.gold_sp.max_value=nil end
dialog.yes_max.on_button_click = function() dialog.gold_sp.max_value=80 end
```

```
WIDGET_SETTER(""max_value"", utils::optional<int>, gui2::spinner)
{
    if(value) {
        w.set_maximum_value(*value);
    } else {
        w.reset_maximum_value();  // disable use of maximum_value completely
    }
}
```

see #9080 "
2037326930,Fix weapon special filters can lead to infinite recursion(1.18 backport),newfrenchy83,2024-08-26 12:32:25+00:00,2024-09-03 22:11:37+00:00,"{'Unit Tests': 1, 'Units': 1}","this is a backport of https://github.com/wesnoth/wesnoth/commits?author=stevecotton https://github.com/wesnoth/wesnoth/commit/4afdc92f13eff33f89684e4e9489ff66f87bf17e comit because one change of behavior is to prevent crashes of game

This adds a recursion counter which runs on a per-weapon basis; if the recursion limit is reached then the last level of recursion is assumed to have returned false. A warning is printed (with error severity).

At the user-visible layer, that gives the following logic:

* Abilities that depend on another ability being active will be inactive.
* Pairs of abilities, where X depends on Y being inactive and Y depends on X being inactive, will end up with them both inactive.

The limit is defined by ATTACK_RECURSION_LIMIT in attack_type.cpp. The minimum for passing all the unit tests is 2, but I've left some headroom by setting it to 4.

With the recursion limit set to 1, the following tests fail, which seems reasonable because they're checking that the special is on a particular type of weapon.
* event_test_filter_attack_specials
* event_test_filter_attack_opponent_weapon_condition
* event_test_filter_attack_student_weapon_condition

Output from the four_cycle_recursion_branching test:
```
error unit: Recursion limit reached for weapon 'melee_attack' while checking filter 'special_type_active = parry'
error unit: Recursion limit reached for weapon 'melee_attack' while checking filter 'special_type_active = poison'
error unit: Recursion limit reached for weapon 'melee_attack' while checking filter 'special_type_active = damage'
```

There's deduplication to prevent the logfiles getting spammed during AI turns. As implemented, the two tests mentioned below print 3 messages each; these tests are added in separate commits because the tests are shared between PRs while we discuss the right mechanism for guarding against recursion.

With no rate limit:
* four_cycle_recursion_branching prints 1280 logs
* event_test_filter_attack_student_weapon_condition prints 320

With a rate limit via a flag that's reset in recursion_guard's destructor:
* four_cycle_recursion_branching prints 80 logs
* event_test_filter_attack_student_weapon_condition prints 160

Resetting the flag in specials_context_t's destructor gets better numbers, but splits the logic across .cpp files. I think the trade-off isn't worth it:
* four_cycle_recursion_branching prints 40 logs
* event_test_filter_attack_student_weapon_condition prints 132

Co-authored-by: newfrenchy83"
2036169390,Use more meaningful prompt text,soliton-,2024-08-25 20:38:40+00:00,2024-08-29 19:06:43+00:00,{},
2036101974,Corrections to image metadata check CI,doofus-01,2024-08-25 16:36:08+00:00,2024-08-26 00:41:08+00:00,{'CI': 1},Correcting some mistakes in [78a4c5c](https://github.com/wesnoth/wesnoth/commit/78a4c5c494ee2cd50f97347f52776d0a3c741c61)
2036078710,Make status orb work with custom max/min_range,hladkyjakub,2024-08-25 15:35:51+00:00,2024-09-14 17:07:54+00:00,{'UI': 1},"This code sets orb color to can-still-make-an-action if unit has no moves left, and has a visible enemy within max and min range of a weapon.
This also affects if the unit is selectable with 'N' (units that can move or attack).

Currently, it doesn't affect the mainline much, as no unit has a weapon max/min_range different from 1, most notice-able, it marks units with no attack as incapable of action, after having no moves left.

The purpose of this is part of getting real-ranged attacks into the mainline."
2036020797,Add Exif tags to images,doofus-01,2024-08-25 13:44:43+00:00,2024-08-26 03:18:17+00:00,"{'Graphics': 1, 'Terrain': 1, 'Campaign AToTB': 1, 'Campaign DM': 1, 'Campaign DW': 1, 'Campaign DiD': 1, 'Campaign EI': 1, 'Campaign HttT': 1, 'Campaign LoW': 1, 'Campaign L': 1, 'Campaign NR': 1, 'Campaign SoF': 1, 'Campaign SotA': 1, 'Campaign SotBE': 1, 'Campaign THoT': 1, 'Campaign TRoW': 1, 'Campaign TSG': 1, 'Campaign Tutorial': 1, 'Campaign UtBS': 1, 'Campaign WoF': 1, 'Campaign WC': 1}",Follow up to f684c20dac0392ea6b8b960706ad07c655b7111a and 78a4c5c494ee2cd50f97347f52776d0a3c741c61
2035977343,Encyclopedia Revision for TSG: Re-Revised,Gothyoba,2024-08-25 12:07:45+00:00,2025-01-17 16:35:57+00:00,"{'Prose': 1, 'Help': 1}","An encyclopedia revision partially for TSG: Re-Revised:

- Explain BF (Before the Fall) in the calendar page. This is not used in mainline, but appears in the game’s code and can be be used by UMC or future mainline content.

- Made spacing throughout the encyclopedia consistent.

- Added a detail on Mount Morogor being the highest active volcano in Morogor, not just a random volcano. This makes it appear more sensible that it is included.

- Added the Island of Gaall and Isle of Omarath to Morogor, shown WoF. IIRC no other islands in Morogor are named in WoF.

- Mentioned Kerlath and the Far South at the end of the Wesnoth description.

- Removed reference to Blackmore being Wesfolk to prevent contradicting certain add-ons

- Clarified Kerlath is the southernmost province in the Westin description, not just a southern province.

- Added Southport to the Wesnoth section from the TSG Re-Revision.

- Mentioned farmland in the periphery of Elensefar, mostly to fix a minor nagging lore inconsistency where Elensefar is always shown on the island in the Great River in scenario maps, but is shown south of it in the large map of Wesnoth. Since there are usually some village around Elensefar, some farmland made sense.

- Removed the Southwood due to its removal from the TSG Re-Revision.

- Added the Vale of Blossoming Trees and Lake Aelin to the section on Southwestern Elves.

- Replaced ""men"" with ""humans"" in the Northlands description, which I accidentally copied from the old description. I see no reason for this not being gender-neutral. (Actually, these small changes could be merged separately earlier)

- Mentioned Saurgrath in the Northlands.

- Replaced Bay fo Jotha in Jotha’s descriotion with “South of Bitok”

- Added a description of the Mourned Hills which mentions Lmarig, as suggested by CelticMinstrel

- Added the Acanclave Citadel in the Far North from the MP Map

- Remove explicit mention of Dunefolk in the Far South and mainline Isanbar and the Ashland Desert."
2035969156,test image metadata CI,doofus-01,2024-08-25 11:44:54+00:00,2024-08-25 12:41:45+00:00,{'Graphics': 1},this is only a test
2035968088,add test for apply_to=both and apply_to=attacker/defender when both type of self and opponent weapon are filtered.,newfrenchy83,2024-08-25 11:42:47+00:00,2024-08-26 21:42:30+00:00,{'Unit Tests': 1},"if filtering type of damage in [damage_type] for both self and opponent when apply_to=both, it will create a recursion issue.

Idem for apply_to=attacker/defender when applied to opponent of owner of special."
2035705630,filesystem.hpp: include missing <cstdint>,trofi,2024-08-24 21:29:39+00:00,2024-08-24 21:34:08+00:00,{},"Without the change build fails on upcoming `gcc-15` as:

    In file included from src/desktop/paths.cpp:20:
    src/filesystem.hpp:232:13: error: 'uint8_t' was not declared in this scope
      232 | std::vector<uint8_t> read_file_binary(const std::string& fname);
          |             ^~~~~~~"
2035404588,remove CI check of copyrights.csv for images,doofus-01,2024-08-24 11:40:54+00:00,2024-08-25 13:36:27+00:00,"{'Graphics': 1, 'CI': 1}",
2035371805,remove inproper and inconsistent names,babaissarkar,2024-08-24 10:37:25+00:00,2024-09-02 15:42:58+00:00,"{'Backport': 1, 'Prose': 1}","1. remove obviously English female names from Dunefolk female names list
2. remove 'bakri' from male name list (means 'goat', could be offensive)
3. remove one potentially offensive name from saurian name list
4. remove 'Dalal' from dunefolk female names (~~not female name,~~ can be used as slang, means 'broker/pimp')"
2035087783,drains tests,Pentarctagon,2024-08-24 03:38:44+00:00,2024-08-26 01:46:15+00:00,{'Unit Tests': 1},
2035006288,"Fix #9241, Liberty S1 dialogue item tweak",sprunk,2024-08-24 00:08:34+00:00,2024-08-24 08:55:29+00:00,{'Campaign L': 1},"Extends damage and not the number of hits, so use ""heavier rocks"" instead of ""more rocks""."
2031808673,[SOTBE] S3: make allied AI smarter,knyghtmare,2024-08-22 10:18:59+00:00,2024-08-28 16:53:34+00:00,"{'Enhancement': 1, 'AI': 1, 'Campaign SotBE': 1}","- they wont attack from poor defense anymore
- will only attack from hills where they have better defense
- makes them less suicidal (so players wont lose when Gruu gets whacked due to stupid AI decisions)

Part of the SotBE revision but added here earlier than the rest."
2031170077,add debug_border to gui2 objects,white-haired-uncle,2024-08-22 02:48:23+00:00,2024-12-04 23:45:32+00:00,"{'UI': 1, 'Schema': 1}","Completes debug_border support for styled_widget, and adds grid/row/column support.

Adds dotted border (questionable value) and dashed border, to add additional clarity especially for those who see a limited color range.

Getting things to line up properly in GUI2 can be frustrating.  For example, in the image, my text is left aligned, why is it centered??? (it's left aligned in the label, but the label is centered in the column).  I always wished there was a way to draw borders around objects so I could see what was going on.  I was excited to discover debug_border, unfortunately from what I can tell, ""This function is only meant for debugging and might not be available in all Wesnoth binaries"" really means ""This function is only meant for debugging and is not available at all"".

Silly example with nested grids and different modes/colors/objects:

![debug_border_example](https://github.com/user-attachments/assets/99369535-acb7-49cc-afec-ca62e720e2a7)
"
2030077893,Support events in [abilities] and [specials] tags,Jonathan-Kelly,2024-08-21 15:36:11+00:00,2024-09-17 01:07:39+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1}","This aims to better support abilities and weapon specials which rely on events written in WML, like those on this [page](https://wiki.wesnoth.org/Wml_abilities
). Currently such event code has to be loaded explicitly in each `[campaign]`, `[scenario]`, `[era]`, or `[resource]` where the custom ability or special will be used, or otherwise written directly in the `[unit_type]`. By supporting embedded events in the `[abilities]` and `[specials]` tags this code can load automatically whenever a unit with a custom ability or special is spawned."
2029331855,Fix infinite recursion issue abilities,newfrenchy83,2024-08-21 09:21:57+00:00,2024-09-03 16:11:39+00:00,"{'Unit Tests': 1, 'Units': 1}",I reuse same method what in https://github.com/wesnoth/wesnoth/pull/9185 PR for resolve infinite recursion in abilities
2028896457,Image cache no exceptions,Vultraz,2024-08-21 04:47:22+00:00,2024-08-21 17:16:55+00:00,{},
2028335343,Further Encyclopedia Revision,Gothyoba,2024-08-20 19:34:45+00:00,2024-08-25 12:01:10+00:00,"{'Prose': 1, 'Help': 1}","I initially intended this to just remove the Southwood and add Southport, but I have since found many other small improvements to make. Because of the major lore implication of some of these changes, I am posting this as a draft early. I will also be trying to follow changes to the TSG Re-Revision and update this accordingly over time. This should be merged at least once the TSG Re-Revision is nearly or fully merged into mainline. This will be much smaller than the last revision.

- Added a detail on Mount Morogor being the highest active volcano in Morogor, not just a random volcano. This makes it appear more sensible that it is included.

- Mentioned Kerlath and the Far South at the end of the Wesnoth description.

- Clarified Kerlath is the southernmost province in the Westin description, not just a southern province.

- Added Southport to the Wesnoth section from the TSG Re-Revision.

- Removed the Southwood due to its removal from the TSG Re-Revision.

- Added the Vale of Blossoming Trees to the section on Southwestern Elves.

- Replaced ""men"" with ""humans"" in the Northlands description, which I accidentally copied from the old description. I see no reason for this not being gender-neutral. (Actually, these small changes could be merged separately earlier)

- Mentioned Saurgrath in the Northlands.

- Added a description of the Mourned Hills which mentions Lmarig, as suggested by CelticMinstrel

- Mainlined many ideas from this thread with slight changes: https://forums.wesnoth.org/viewtopic.php?t=52368&hilit=al+shizirad&start=45

I haven't played TDG yet, so there might be more changes from that campaign. I don’t Fort Garard is significant enough to become a notable city in the Northlands, but I might mention it in one of the descriptions of something else.

@Dalas121 What are your thoughts on these changes?"
2027674473,fix #9225 events with negative priority getting erroneously deleted,gfgtdf,2024-08-20 13:32:35+00:00,2024-08-21 00:08:47+00:00,{'WML': 1},"previously is_map_[id] would point to the wrong event, so that when an event was later deleted by id the wrong event would be deleted."
2026956670,Encyclopedia clean up following #9188,Wedge009,2024-08-20 07:00:35+00:00,2024-08-20 11:39:34+00:00,"{'Docs': 1, 'Prose': 1, 'Help': 1}",CC: @Gothyoba
2026277759,Make command line option errors consistently return 2 as documented,soliton-,2024-08-19 19:54:55+00:00,2024-08-22 16:33:12+00:00,{'Command Line': 1},Also print the error before the dialog so you don't first have to dismiss it to see the message on stderr as well.
2024979981,add tooltip to [unit_vision],ProditorMagnus,2024-08-19 07:29:57+00:00,2024-08-19 19:57:32+00:00,{'UI': 1},#9191
2024467717,Image metadata CI check,doofus-01,2024-08-18 17:25:04+00:00,2024-08-24 11:07:31+00:00,"{'Graphics': 1, 'CI': 1}","I don't know how to test this directly in the PR, but I did test in a different repository.

- It only tests for Artist and Copyright tags, I guess the other tags can be optional.
- It doesn't sift through all images in the repository, it just looks at images in a PR."
2024350181,HttT S20b: Remove reference to Asperger Syndrome in po comment,Gothyoba,2024-08-18 11:44:22+00:00,2024-08-18 16:47:19+00:00,{'Campaign HttT': 1},The change to Alzheimer’s Disease was suggested by CelticMinstrel some time ago in #7545
2024160700,wmlscope: fix format of magic comment in documentation,cooljeanius,2024-08-17 22:57:23+00:00,2024-08-18 08:56:50+00:00,{'WML Tools': 1},"It's not just `prune`, but rather `wmlscope: prune`. I discovered this when working on cooljeanius/Flight_Freedom#23 earlier.
"
2024139295,Conduct surface manipulation in-place when possible,Vultraz,2024-08-17 21:16:29+00:00,2024-08-18 00:22:44+00:00,{'UI': 1},"Before, every single surface operation would clone the surface before operating and return the new surface. This made for a convenient API, but there's really no reason to do that for the majority of surface mods. Obviously, some of them, like scaling, will need a new surface, so those have been left alone."
2023876529,add disable ability tests,Pentarctagon,2024-08-17 05:26:11+00:00,2024-08-18 02:13:10+00:00,{'Unit Tests': 1},
2023536204,Add test store_locations_with_unit_filter,stevecotton,2024-08-16 20:03:52+00:00,2024-08-18 22:17:37+00:00,{'Unit Tests': 1},"Not sure this is really needed, but it's currently part of a discussion about whether `[filter_weapon][not]special_id_active=foo` should match a unit that has no weapon. So this is checking for reference that `[filter][not]race=elf` excludes every hex that has no unit on it."
2019262228,fix incomplete add [disable] abilityto abilities used like weapon special,newfrenchy83,2024-08-14 13:06:08+00:00,2024-08-15 00:39:35+00:00,{'Schema': 1},fix https://github.com/wesnoth/wesnoth/pull/9192 don't work with ability
2018575391,Remove UNUSED,Vultraz,2024-08-14 06:38:42+00:00,2024-08-14 17:55:58+00:00,"{'AI': 1, 'Units': 1, 'Lua API': 1, 'WFL': 1}",
2018454255,handle preferences case change,Pentarctagon,2024-08-14 04:37:49+00:00,2024-08-15 00:33:55+00:00,{'Engine': 1},Fixes #9199
2018349083,Update xBRZ to v1.8,Vultraz,2024-08-14 02:26:54+00:00,2024-08-14 05:13:37+00:00,{},
2017995702,Death Squire optional advancement macro and damage nerf,Dalas121,2024-08-13 21:29:21+00:00,2024-08-25 00:04:18+00:00,{'Units': 1},"The existing {ENABLE_DEATH_KNIGHT} macro allows Revenants to advance to Death Knights. The newly core-ed Death Squire also advances to Death Knight, but has no {ENABLE_DEATH_SQUIRE} macro.

I suggest adding a new {ENABLE_DEATH_SQUIRE} macro, while keeping the old {ENABLE_DEATH_KNIGHT} for backwards compatibility.

I also propose reducing the Death Squire's attack from 8x4 to 9x3, to make the Revenant a more competitive advancement.

Who's the current maintainer of SotA? Should {ENABLE_DEATH_SQUIRE} be used there, or should we continue using {ENABLE_DEATH_KNIGHT}?

Hejnewar, if you approve, what cost should the Death Squire be after this change?"
2017136502,fix map_locker in lua kernel,gfgtdf,2024-08-13 13:01:16+00:00,2024-08-25 03:48:11+00:00,{'Lua API': 1},"it previously didn't work as expected because that the variable wasn't given a name, so it locks the map and then immediately unlocks it again."
2015831349,"add max_range and min_range to weapon API, re #9169",ProditorMagnus,2024-08-12 20:32:51+00:00,2024-09-03 17:37:34+00:00,"{'Units': 1, 'Lua API': 1, 'WFL': 1}",
2015633053,Fix infinite recursion (recursion-counting version),stevecotton,2024-08-12 18:18:28+00:00,2024-08-18 22:07:41+00:00,"{'Unit Tests': 1, 'Units': 1}","Another PR for #8940, this time based on adding a recursion count - it's mainly a subset of the #8977 changes, but the opposite subset to #9185. The tests are the same as #8977, except for a few changes to comments.

This adds a recursion counter which runs on a per-weapon basis; if the
recursion limit is reached then the last level of recursion is assumed
to have returned false. At the user-visible layer, that gives the
following logic:

* Abilities that depend on another ability being active will be
  inactive.
* Pairs of abilities, where X depends on Y being inactive and Y
  depends on X being inactive, will end up with them both inactive.

The limit is defined by ATTACK_RECURSION_LIMIT in attack_type.cpp.
The minimum for passing all the unit tests is 2, but I've left some
headroom by setting it to 4.

With the recursion limit set to 1, the following tests fail, which
seems reasonable because they're checking that the special is on
a particular type of weapon.
* event_test_filter_attack_specials
* event_test_filter_attack_opponent_weapon_condition
* event_test_filter_attack_student_weapon_condition

I've set the author of the main commit to myself, with a ""Co-authored-by:"" credit to @newfrenchy83.

The existing `tag_name` checks are still in to support the special handling of `[damage_type]`, but aren't expanded to any other use. (If a `[damage_type]` special includes a `[filter_weapon]type=`, that filter is tested against the base type of the weapon, ignoring all `[damage_type]` specials.)"
2014473410,fix [filter_weapon][not] cannot detect in special weapon filters the absence of the attribute when the weapon does not exist (1.19 branch and later),newfrenchy83,2024-08-12 08:21:33+00:00,2024-08-17 12:46:14+00:00,"{'Unit Tests': 1, 'Units': 1}","
when a special weapon works under the condition that the opponent does not have a variable (no poison special weapon), the condition is only true if the opponent opposes a non-poisoned weapon but is false if no weapon at all is used when it should be true."
2013904457,Simplify game_config::path determination,soliton-,2024-08-11 17:51:51+00:00,2024-08-19 14:15:49+00:00,{'Engine': 1},
2013880658,Add disable ability,newfrenchy83,2024-08-11 16:29:47+00:00,2024-08-11 18:29:35+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1}",fix bug show in https://github.com/wesnoth/wesnoth/pull/9192
2013871627,WC: Explain that you can also add data via resources,soliton-,2024-08-11 16:09:45+00:00,2024-09-08 17:55:58+00:00,{'Campaign WC': 1},
2013842636,Make sure stdout encoding is UTF-8,soliton-,2024-08-11 14:36:27+00:00,2024-08-19 06:52:04+00:00,{'WML Tools': 1},
2013835799,Update and correct game config schema,soliton-,2024-08-11 14:15:16+00:00,2024-08-19 06:27:18+00:00,{'Schema': 1},"Fix schema tags where ""name"" is a comma separated list which is not actually supported."
2013701493,Gamestate Inspector: replace scroll_label with scroll_text,babaissarkar,2024-08-11 06:43:43+00:00,2024-08-14 06:33:40+00:00,{'UI': 1},"Resolves #8032.
Uses `scroll_text` instead of `scroll_label` so that text can be copied.
(Should not be squashed.)

_Known issue:_
Could face slight slowdown for large texts, but it won't crash while selecting text or lag during loading."
2013694654,disable ability test,Pentarctagon,2024-08-11 06:13:02+00:00,2024-08-15 00:39:36+00:00,{'Unit Tests': 1},
2013599336,add tooltip to [unit_vision],ProditorMagnus,2024-08-10 21:56:51+00:00,2024-08-18 22:00:07+00:00,{'UI': 1},"closes #7636
re #6021
re #5575"
2013344844,Add sprite for the Cold Dagger item to UtBS,Elvish-Hunter,2024-08-10 09:02:03+00:00,2024-08-11 22:28:54+00:00,"{'Graphics': 1, 'Campaign UtBS': 1}","I just finished replaying UtBS and I noticed that the map was changed in the Descending Into Darkness scenario.
To be more specific, in older versions there was a long tunnel filled with water; at its end, there was a hex of ford terrain, so it was obvious that moving there would've done something.
In the 1.18 version, the map has been reworked so the tunnel has disappeared and has been replaced with a small cave filled with water and some other terrains and objects (paved road, a brazier, some remains...); it isn't really clear any more where to find the cold dagger, especially if you play the campaign for the first time, so a sprite for this item seems needed.
I looked in the forums to see if a cold dagger/sword sprite was already made, but apparently nobody did; however, a long time ago, I made a recolor of the flaming sword sprite to give it a blue flame, so I decided to finally use it.
Being a derivative work of the original flaming sword, I'm forced to release the sprite as GPL v2+ (but if it were just for me, we could use any license we want)."
2012525867,Revised Encyclopedia,Gothyoba,2024-08-09 14:30:10+00:00,2024-08-09 17:26:48+00:00,{},"Re-opened #9059 after some unexpected merge conflicts from force-pushing and accidently closing the PR. @Dalas121 You can merge this. I have checked that nothing weird has happened. This is exactly the same as the previous PR.

Edit: Checks have passed!"
2011253119,Build fixup,Vultraz,2024-08-08 20:36:04+00:00,2024-08-08 21:26:35+00:00,"{'macOS': 1, 'Building': 1}",
2010540165,Fix infinite recursion (no recursion-counting version),newfrenchy83,2024-08-08 13:20:57+00:00,2024-09-03 16:11:49+00:00,"{'Unit Tests': 1, 'Units': 1}","

When for example we have [damage_type][filter_self][has_attack|filter_weapon]type=pierce applied to one or any pierce type attack and the unit does not have an unaffected pierce attack, the change in type triggers an infinite recursion.

this PR fixes the problem and other because filter of weapon specials or formula except if special A [filter_self]special_id_active=B special B [filter_self]special_id_active=A.

Fix https://github.com/wesnoth/wesnoth/issues/8940"
2009714875,"Split drawing_layer into its own file, make scoped enum",Vultraz,2024-08-08 05:11:51+00:00,2024-08-08 06:14:22+00:00,"{'Editor': 1, 'Units': 1}",CI run
2008893367,wesnothd: avoid a race condition when logging on,loonycyborg,2024-08-07 17:23:05+00:00,2024-08-09 09:50:09+00:00,{'MP': 1},"Ensure that there is no coroutine yield between confirmation of login
and update of player_connections_. Otherwise another login under same
name could succeed if it happened before handle_player() which resulted
in an assert later.
"
2008859058,New Titlescreen Images,Gothyoba,2024-08-07 17:00:55+00:00,2024-08-09 02:37:42+00:00,{'Graphics': 1},"This does not add any new images to the game (except wesmere.webp, which was previously removed), it only adds more currently existing images to the set of images used for the game's titlescreen on the modern theme. This adds some nice variety to the background images used. All of these images are from story art from various campaigns.

The following images have been added:

![img_1](https://raw.githubusercontent.com/wesnoth/wesnoth/master/data/campaigns/The_Rise_Of_Wesnoth/images/story/trow_story_02-The_Fall.jpg)

![img_2](https://raw.githubusercontent.com/wesnoth/wesnoth/master/data/campaigns/The_Rise_Of_Wesnoth/images/story/trow_story_04-Fall_of_Eldaric.jpg)

![img_3](https://raw.githubusercontent.com/wesnoth/wesnoth/master/data/core/images/story/landscape-battlefield.webp)

![img_4](https://raw.githubusercontent.com/wesnoth/wesnoth/master/data/core/images/story/landscape-mountains-04.webp)

![img_5](https://raw.githubusercontent.com/wesnoth/wesnoth/master/data/core/images/story/wesmere.webp)

The last used to be story art for AOI, but it was removed together with AOI a few years ago. I have re-added it under the new name wesmere.webp as part of the core story images. This also allows it to be used elsewhere, which might be good given the lack of story art for many scenarios. Here are some steam screenshots of these in use:

![img_6](https://raw.githubusercontent.com/Gothyoba/hello_world/main/orcs_titlescreen.jpg)

![img_7](https://raw.githubusercontent.com/Gothyoba/hello_world/main/trow_4_titlescreen.jpg)

![img_8](https://raw.githubusercontent.com/Gothyoba/hello_world/main/battlefield_titlescreen.jpg)

![img_9](https://raw.githubusercontent.com/Gothyoba/hello_world/main/mountains_titlescreen.jpg)

![img_10](https://raw.githubusercontent.com/Gothyoba/hello_world/main/wesmere_titlescreen.jpg)"
2008302601,MP: correctly register Start Game button's shortcut with hotkey system,babaissarkar,2024-08-07 12:08:18+00:00,2024-08-09 03:26:08+00:00,"{'MP Lobby': 1, 'UI': 1, 'Input': 1}","Resolves #9175.

The hotkey is now visible in Hotkey Preferences and can be customized.

![Screenshot from 2024-08-07 17-33-25](https://github.com/user-attachments/assets/003005e6-397d-44b8-88f0-d979b0f794c5)
"
2007059157,editor: Backport Show Tool Information toggle option to 1.18,irydacea,2024-08-07 01:29:32+00:00,2024-08-17 16:49:53+00:00,"{'Enhancement': 1, 'Graphics': 1, 'UI': 1, 'Editor': 1}","This is a 1.18 ""backport"" of the feature implemented in PR #8861 that allows hiding the help text tooltip for the current editor tool. Please refer to [this comment](https://github.com/wesnoth/wesnoth/pull/8861#issuecomment-2260433403) on the previous PR for reference screenshots.

(In reality, this version of the code predates the PR I published against master, so the existing PR is more like a forward-port with this being the original version. Because the preferences API changed drastically in master, the main patch is quite different in some parts.)

I strongly believe it would be a good idea to bring this feature to the 1.18 stable series due to the fact that it's a simple quality-of-life improvement that benefits add-on creators greatly, as it enables those who have no use for the tooltip — mainly experienced users — to remove a very significant visual obstruction from the editor view."
2006680144,"Decouple image cache management from locator, and simplify",Vultraz,2024-08-06 19:29:18+00:00,2024-08-07 01:42:15+00:00,{},"Makes all the cache management functions local to the cache class. There's no reason to publicly expose it through locator given that the actual cache objects which that API needs to function are local to this translation unit anyway.

This also cleans up the cache implementation in order to take advantage of the switch from a vector to map awhile back. `copy_from_cache` was removed in favor of bounds- checked access."
2004964628,action menu support for menu_button,white-haired-uncle,2024-08-05 23:33:06+00:00,2024-09-11 14:40:24+00:00,"{'macOS': 1, 'UI': 1, 'Building': 1, 'Schema': 1}","Allows menu_button to act like Menu/Actions buttons on main game screen.
- Adds update_label parameter to determine whether to update the button text when value changes
- Adds new definition that nearly matches existing Menu/Actions buttons (I don't think available font options will allow an exact match)

Example showing button label not reflecting choice and no item showing as selected, in comparison to the standard menu_button:
![persistent_menu_button](https://github.com/user-attachments/assets/20068e3a-3d80-464a-ab4b-61f74d704cc7)
"
2004543395,"hotkey: Identify Alt as ""opt"" on macOS",irydacea,2024-08-05 18:03:56+00:00,2024-08-22 21:04:51+00:00,"{'macOS': 1, 'UI': 1}","Addresses #9172.

A couple of additional remarks about this:

* It is common for macOS apps to use the standards icons for key modifiers rather than their textual labels, i.e. ⌥ for Option, ⌃ for Control, ⌘ for Command. However, I don't believe there are any official guidelines specifically encouraging this, and since Wesnoth is a game it kind of violates most user interface design guidelines as it is anyway.
* It may make sense to add a combo-based Advanced preferences entry that lets the player choose between ""Native"", ""PC"" and ""Mac"" key labels, but at the same time it's a lot of effort for a niche use case (people with mismatched keyboards that struggle to translate between Mac and PC keyboard layouts)."
2004214938,Add GUI window type with no background,mavpii,2024-08-05 15:14:30+00:00,2024-09-29 17:03:42+00:00,{'UI': 1},"Recently, I had to create some GUI dialogs for my add-on, and I noticed that there is no way to create a widget/window without any background, only a blue background with borders or a blue background without borders. So I decided to fix it.

Why it's important:
— The restriction on widgets and windows being strictly square(visually) will be removed, giving GUI developers more room for creativity.
— Developers/modders will be able to significantly increase the immersion of the game by diluting the text through [message] with things like custom notes, books, maps, signposts, tablets, etc.

How it works:
1) As usual, we create a window through [resolution] and specify definition = ""transparent"" there;
    1.1) If we want to display a simple image, we do everything as usual;
    1.2) If we want to use some image as a background, we use [stacked_widget]

Examples of use:

Here are two fully working dialogs that I have implemented in my add-on:
![Screenshot_1393](https://github.com/user-attachments/assets/589b8cf8-3225-4bb0-8ec2-cd171855ee08)
![Screenshot_1395](https://github.com/user-attachments/assets/a1f58509-b386-4289-91ce-a2eb3c6cd6fc)


Here's a mockup based on the magic system window from TDG that explains how everything works:
![Screenshot_1394](https://github.com/user-attachments/assets/e3273930-3a5a-4b32-9707-e9a786749d11)

"
2003956943,Disable WML tests for debug builds,soliton-,2024-08-05 13:09:16+00:00,2024-08-06 03:08:46+00:00,"{'Unit Tests': 1, 'CI': 1}","Not that useful to run them with debug as well as release binaries and it takes a lot of time.

Adresses #9167."
2002826470,Replaced Egg Sacs in EI with Fire/Giant Ant Eggs from core,Gothyoba,2024-08-04 19:12:02+00:00,2024-08-08 13:23:23+00:00,"{'Graphics': 1, 'Units': 1, 'Lua API': 1, 'Building': 1, 'SCons': 1, 'Schema': 1, 'Campaign EI': 1, 'Campaign THoT': 1}","This is a change proposed in #8734 

This is a small change that does not require any further balancing changes to the scenario in my opinion. It replaces the custom Egg Sac unit in EI with the Fire Ant Eggs and Giant Ant Eggs from core. The proposal in the issue above only mentioned Giant Ant Eggs, but given that fire ants exist in the scenario, some eggs near where fire ants first appear have been changed to Fire Ant Eggs. This also add some nice visual variety to this area in my opinion."
2002430997,damage_type tests,Pentarctagon,2024-08-04 04:46:56+00:00,2024-08-08 02:32:46+00:00,{'Unit Tests': 1},@newfrenchy83 currently the alternate_type tests fail since only the defender uses the damage type that deals more damage. The attacker uses the original damage type even though the alternate type would deal more damage.
2002203344,Handling empty team in :droid,drewdaemon,2024-08-03 18:31:41+00:00,2024-08-07 07:19:21+00:00,{'Engine': 1},"Closes https://github.com/wesnoth/wesnoth/issues/8879

This PR adds handling for empty/null teams when using the `:droid` command.

It now shows an error message:

<img width=""371"" alt=""Screenshot 2024-08-03 at 12 30 47 PM"" src=""https://github.com/user-attachments/assets/3dfa4198-3e45-4587-a8a0-51e03f86a567"">

"
2000915361, Set unit hitpoints to 0 during [kill],ProditorMagnus,2024-08-02 14:34:18+00:00,2024-08-10 14:20:12+00:00,"{'Unit Tests': 1, 'Lua API': 1}",Solves https://forums.wesnoth.org/viewtopic.php?t=58511
2000195513,[WIP] GUI2 Help Browser,babaissarkar,2024-08-02 07:41:27+00:00,2024-08-06 06:12:41+00:00,"{'UI': 1, 'Help': 1}","Moved here from #9134.
The previous one was accidentally closed and github won't let me reopen that.

![Screenshot from 2024-07-29 18-16-03](https://github.com/user-attachments/assets/c9f2d3b2-f105-4316-94d3-6a48be4bc9e3)"
1998939732,Call Export appropriately instead of using locals(),soliton-,2024-08-01 16:51:48+00:00,2024-08-04 10:13:06+00:00,"{'Building': 1, 'SCons': 1}",Fixes #9142.
1998229624,Properly implement DO_NOT_MODIFY_CACHE,soliton-,2024-08-01 10:52:05+00:00,2024-08-10 10:58:30+00:00,"{'MP': 1, 'Add-ons': 1}",This fixes node_to_string().
1996996316,Turn Dwarvish Miners into a Level 0 unit,Gothyoba,2024-07-31 19:04:20+00:00,2024-08-27 17:23:44+00:00,{'Units': 1},"This was proposed in the forums a while back, and I personally think its a good idea. This changes the Dwarvish Miner to a level 0 unit which can advance to a Dwarvish Ulfserker, Fighter or Guardsman. It also reduces its XP from 50 to 19. The Dwarvish Fighter's stats look like a level 0 unit, and I think it would make sense as one. These are all proposals made by various people on this thread, not myself: https://forums.wesnoth.org/viewtopic.php?t=57995"
1996756141,"Add underlying type of the terrain to Lua, re #4227",ProditorMagnus,2024-07-31 16:21:52+00:00,2024-08-01 11:30:02+00:00,{'Lua API': 1},
1996403714,Fix unit tostring conversion causing a crash if the unit is invalid,CelticMinstrel,2024-07-31 13:18:08+00:00,2024-08-02 13:38:02+00:00,{'Lua API': 1},
1996137078,SotA S2: Avoid destroying unit potentially already occupying target hex,Wedge009,2024-07-31 10:54:02+00:00,2024-08-06 23:00:04+00:00,"{'Backport': 1, 'Campaign SotA': 1}","Work-around for #9150. If a unit already occupies the hex, it doesn't do anything about the break in animation, but at least the unit present won't be destroyed - and it won't fail the scenario if Ardonna is the one occupying the hex."
1995741011,Avoid rewriting the same file multiple times,soliton-,2024-07-31 07:13:23+00:00,2024-08-19 07:42:14+00:00,{'CI': 1},Also process some more extensions that current source files use.
1995315288,macroify some preferences code,Pentarctagon,2024-07-30 23:28:50+00:00,2024-08-08 02:31:11+00:00,{'UI': 1},
1994434879,Clean up `config_attribute_value::operator==`,Vultraz,2024-07-30 13:28:54+00:00,2024-07-31 02:48:40+00:00,{'Engine': 1},"The old implementation was recursive when building with C++20 due to primary operator reordering. More importantly, however, it would fail this test:
```
	c[""x""] = ""yes"";
	BOOST_CHECK_EQUAL(c[""x""], true);
```"
1994360863,Update Elvish Hunter copyrights,cooljeanius,2024-07-30 12:50:37+00:00,2024-07-30 13:14:12+00:00,{},"This PR is against @CelticMinstrel's PR #7329; it ought to get the copyright check passing again...
"
1993473278,Cleanup backported from cpp20 branch,Vultraz,2024-07-30 03:02:50+00:00,2024-07-31 01:03:43+00:00,"{'UI': 1, 'Units': 1, 'Lua API': 1, 'WFL': 1, 'Schema': 1, 'Terrain': 1}",Various changes from #9109 that don't need C++20.
1993177695,Update copyrights: use consistent output format,ProditorMagnus,2024-07-29 22:01:39+00:00,2024-08-03 15:24:20+00:00,{'Docs': 1},
1993138648,Update copyrights: restore input file when script fails,ProditorMagnus,2024-07-29 21:29:30+00:00,2024-09-06 10:10:54+00:00,"{'Postponed': 1, 'Docs': 1}","```
Ravana@RavanaE480 /cygdrive/c/Users/Ravana/games/battle-for-wesnoth-1.19.2 $ ./update_copyrights.txt
fatal: not a git repository (or any parent up to mount point /cygdrive)
Stopping at filesystem boundary (GIT_DISCOVERY_ACROSS_FILESYSTEM not set).
Traceback (most recent call last):
  File ""./update_copyrights.txt"", line 113, in <module>
    added.append(["""", file_path, """", """", """", do_git(file_path), file_hash])
  File ""./update_copyrights.txt"", line 42, in do_git
    return str(check_output([""git"", ""log"", ""-1"", ""--format=%ad"", ""--date=format:%Y/%m/%d"", file]), 'UTF-8').rstrip('\n')
  File ""C:\Program Files (x86)\Python37-32\lib\subprocess.py"", line 376, in check_output
    **kwargs).stdout
  File ""C:\Program Files (x86)\Python37-32\lib\subprocess.py"", line 468, in run
    output=stdout, stderr=stderr)
subprocess.CalledProcessError: Command '['git', 'log', '-1', '--format=%ad', '--date=format:%Y/%m/%d', 'data/campaigns/Legend_of_Wesmere/images/low-map.png']' returned non-zero exit status 128.

Ravana@RavanaE480 /cygdrive/c/Users/Ravana/games/battle-for-wesnoth-1.19.2 $ ./update_copyrights.txt
Traceback (most recent call last):
  File ""./update_copyrights.txt"", line 83, in <module>
    with open(options.input, encoding=""utf-8"") as csvfile:
FileNotFoundError: [Errno 2] No such file or directory: 'copyrights.csv'
```"
1990928448,[SotBE] replace mature phrase in S14,knyghtmare,2024-07-28 14:24:42+00:00,2024-08-02 18:28:55+00:00,"{'Prose': 1, 'Campaign SotBE': 1}","The phrase was swapped out in the campaign descriptions but stayed in the dialogue here. 
Is this even allowed in kid-friendly games?"
1990874093,fix WRN_NG level,ProditorMagnus,2024-07-28 11:50:57+00:00,2024-07-29 00:50:58+00:00,"{'Backport': 1, 'Engine': 1}",@gfgtdf 
1990768343,update CI to Ubuntu 24.04,Pentarctagon,2024-07-28 05:58:04+00:00,2024-07-28 18:07:59+00:00,"{'Docs': 1, 'UI': 1, 'Units': 1, 'Lua API': 1, 'CI': 1, 'Campaign WC': 1}",
1990609328,Removed deprecated unit message from fog clearer,Gothyoba,2024-07-27 17:57:54+00:00,2024-07-27 18:01:11+00:00,{'Units': 1},"Version 1.15 has passed and this unit has not been removed. Based on the comment at the start of the file, this is unlikely to be removed in the near future. The message shown is hence unnecessary and could potentially lead to confusion."
1990593798,damage ability tests,Pentarctagon,2024-07-27 16:55:50+00:00,2024-07-31 00:06:38+00:00,{'Unit Tests': 1},
1988193868,Simplify pot generation,soliton-,2024-07-25 19:06:27+00:00,2024-08-05 19:50:44+00:00,{'Translations': 1},Use a standard sed invocation and avoid rewriting the file.
1987888586,THoT S6 Music Tweak,Gothyoba,2024-07-25 16:08:04+00:00,2024-08-04 22:57:35+00:00,{'Campaign THoT': 1},"Somewhat adresses #8507 (SotA is unaffected)

This replaces the song Travelling Minstrels with Vengeful Pursuit in S6 of THoT (Forbidden Forest). In my opinion, this is much more fitting to the scenario."
1987671903,[WIP] GUI2 Help Browser (accidentally closed),babaissarkar,2024-07-25 14:33:01+00:00,2024-08-02 06:49:39+00:00,"{'macOS': 1, 'UI': 1, 'Building': 1, 'Help': 1, 'Schema': 1}","![Screenshot from 2024-07-29 18-16-03](https://github.com/user-attachments/assets/c9f2d3b2-f105-4316-94d3-6a48be4bc9e3)

EDIT: Moved to #9162 since I couldn't reopen this one after I accidentally force-pushed it."
1987618179,Correct confusing handling of ./ paths,soliton-,2024-07-25 14:07:16+00:00,2024-08-24 04:42:13+00:00,{'Engine': 1},This fixes #9092.
1987485156,Update link to https in fortunes,Gothyoba,2024-07-25 13:07:17+00:00,2024-08-03 15:23:13+00:00,{},"I update an old link now available in https. I’m not sure what this file is for, but I doubt this should cause any issues."
1987149264,THoT: Create heroes if they don't exist,mavpii,2024-07-25 09:58:25+00:00,2024-08-03 15:44:57+00:00,{'Campaign THoT': 1},Resolves [1.15 THoT Movrur should be created if he doesn't exist #5520 ](https://github.com/wesnoth/wesnoth/issues/5520) as well as adds few small fixes.
1986640555,[Fwdport] Opens load map/save map as dialogs in correct folders,babaissarkar,2024-07-25 04:09:25+00:00,2024-07-25 09:05:22+00:00,"{'Editor': 1, 'Fwdport': 1}","Forward port of the new commit in #9062. (88fc3cda4fb66d09cf670c7e456f042fcb3d0fdb)
Opens load map/save map as dialogs in the addon's map directory.
With no addon selected they open in the `editor/maps` directory."
1985720133,"LoW: some fixes for S10, S22",mavpii,2024-07-24 15:31:44+00:00,2024-09-14 20:00:02+00:00,{'Campaign LoW': 1},"Well, I was bored and decided to fix a few small bugs in LoW. I can't say that I did my best, but I got the job done.

List of fixed issues:
[LoW S9 and S10: Scenario designs are too similar #7137 ](https://github.com/wesnoth/wesnoth/issues/7137)
[LoW: Clarify player's veterans joining Landar #8359 ](https://github.com/wesnoth/wesnoth/issues/8359) 
[LoW S22: Enemy camp starts too close to friendly camp #8360 ](https://github.com/wesnoth/wesnoth/issues/8360)
"
1984326337,Increase minimum macOS version to 10.15.,Pentarctagon,2024-07-23 23:52:58+00:00,2024-08-08 02:36:24+00:00,"{'macOS': 1, 'Services': 1, 'Building': 1}","I'm tired of the repeated arguments around increasing the minimum macOS version vs new language features. So barring any kind of clear definition that can be used to determine it, this is the lowest version with a strong, clear reason to not upgrade past. After all, I can't think of a language feature that would be worth losing celticminstrel as a contributor."
1983973413,Add font for Cyrillic symbols,mavpii,2024-07-23 19:07:17+00:00,2024-08-06 11:44:59+00:00,{'UI': 1},"The new main menu screen uses Oldania font, which does not have any Cyrillic characters, which makes labels in Ukrainian and other languages that use the Cyrillic alphabet look too generic due to the use of the default font.
This PR aims to fix this by adding another font which was designed specifically for Cyrillic. Translators can enable it by changing one line in [wesnoth.po](https://github.com/wesnoth/wesnoth/blob/2679fec5f2a7afa1948406a998cbe9749a59dca3/po/wesnoth/uk.po#L4223)(Remove Oldania from the msgstr and put the ""Akademie Alte"" there)
"
1983310182,Fix build on MacOS Catalina,CelticMinstrel,2024-07-23 13:08:23+00:00,2024-07-23 13:29:52+00:00,"{'AI': 1, 'MP': 1, 'UI': 1, 'Editor': 1, 'Units': 1, 'Lua API': 1, 'Add-ons': 1, 'WFL': 1, 'Help': 1, 'Schema': 1}","I had a choice of replacing `value()` with `*` or bringing back `utils::optional`. Personally, I think having `value()` is probably better, as it throws an exception instead of silently reading garbage."
1982717833,titlescreen: make drop cap algorithm utf8 aware,babaissarkar,2024-07-23 07:49:35+00:00,2024-07-25 03:10:30+00:00,{'UI': 1},"1. Uses `utf8::insert` to modify the string so that it works for non-ASCII characters.
2. Use the locale's script font instead of using Oldania always."
1982311188,add .lua files to .editorconfig,gfgtdf,2024-07-23 01:21:49+00:00,2024-07-24 14:04:27+00:00,{},we currently use the same indentation style for  lua as for cpp files
1981410313,Fix filter check errors for special weapons(1.18 backport),newfrenchy83,2024-07-22 14:41:09+00:00,2024-08-03 15:46:50+00:00,{'Units': 1},"This is to repair two errors introduced in the conditions of definition of tag_name variables, used to determine if an attack variable can be checked taking into account or not the modifications introduced by a special weapon.

First error, when apply_to=both, the distinction between AFFECT_SELF/OTHER must not be made to avoid an infinite loop.

2nd error, for the check of [filter_attacker/defender] the check of the variable is_attacker must be associated with AFFECT_SELF/OTHER in the following way: If special affects self then is_attacker is true if [filter_attacker] and false if [filter_defender].

If special affects opponent then it's the opposite."
1981402031,Fix filter check errors for special weapons,newfrenchy83,2024-07-22 14:37:18+00:00,2024-09-05 23:35:35+00:00,"{'Unit Tests': 1, 'Units': 1}","This is to repair two errors introduced in the conditions of definition of tag_name variables, used to determine if an attack variable can be checked taking into account or not the modifications introduced by a special weapon.

First error, when apply_to=both, the distinction between AFFECT_SELF/OTHER must not be made to avoid an infinite loop.

2nd error, for the check of [filter_attacker/defender] the check of the variable is_attacker must be associated with AFFECT_SELF/OTHER in the following way: 
If special affects self then is_attacker is true if [filter_attacker] and false if [filter_defender].

If special affects opponent then it's the opposite."
1977510134,DM: S18 recall fix,mavpii,2024-07-19 08:17:51+00:00,2024-07-23 05:38:59+00:00,"{'Backport': 1, 'Campaign DM': 1}","In S18 Portal of Doom, all player units must escape through the tunnel, after which Delfador will follow them.
However, if unit entered the tunnel, it magically appeared in the recall list and could be recalled again. I fixed it, and now the escaped units are not available until the next scenario."
1977183885,"allow quick reload of gui2 themes, no restart of wesnoth needed",babaissarkar,2024-07-19 04:22:39+00:00,2024-07-30 02:29:54+00:00,{'UI': 1},"With this, after changing the gui2 theme using **Preferences -> Display -> UI Theme**, no restart of wesnoth is required. The theme gets reloaded after the user presses the ""Apply"" button."
1977183312,Move command line processing before logger initialization,Pentarctagon,2024-07-19 04:21:54+00:00,2024-07-21 22:28:54+00:00,{'Engine': 1},"Log files goes in the userdata folder so they therefore need the userdata to be initialized before that.

Fixes #9111

---

This does at least fix #9111, though obviously more is needed before it can be merged."
1976600658,"EI S11, S99: prevent backdoor entrance into prison cells",Dalas121,2024-07-18 18:26:16+00:00,2024-07-20 00:16:13+00:00,"{'Backport': 1, 'Campaign EI': 1}","EI's S11 and S99 have prison cells, one of which has an unintended backdoor entrance via an unwalkable deep water river. Flying units are involved in these scenarios, and can possibly fly into the cells through this unintended backdoor.

This PR changes the map hexes from unwalkable to impassable."
1976582185,EI S12: fix Dra-Nak having inconsistent traits and portrait,Dalas121,2024-07-18 18:15:30+00:00,2024-07-20 00:25:37+00:00,"{'Backport': 1, 'Campaign EI': 1}","In EI S11, the player encounters an orcish warlord named Dra-Nak. If not killed in S11, he continues pursuing the player in S12, but the current S12 gives him different traits and a different portrait. This PR fixes the issue."
1976571457,EI S99: prevent prisoner income if prisons are captured,Dalas121,2024-07-18 18:07:36+00:00,2024-07-20 00:16:57+00:00,"{'Backport': 1, 'Campaign EI': 1}","In EI's S99, you gain gold from defeating and capturing hostile drakes.  The drakes are physically moved to prison cells in the middle of the map.

Previously, the player could continue capturing drakes even if enemies overran the prison area. Additionally, the prison cells stayed locked with prisoners inside. This makes no sense in-universe, and also made it a strong strategy to abandon the center and turtle up in a corner of the map. 

This PR fixes this issue. This also adds 2 new strings; I'm planning to backport to 1.18.2, as this is arguably a bugfix."
1976324990,MP/Faction Select: fix help page handling (backport),sevu,2024-07-18 15:36:52+00:00,2024-07-18 15:54:19+00:00,{'UI': 1},
1976139885,Build with C++20,Vultraz,2024-07-18 14:18:56+00:00,2024-08-31 16:10:56+00:00,"{'macOS': 1, 'AI': 1, 'MP': 1, 'UI': 1, 'Units': 1, 'Lua API': 1, 'Add-ons': 1, 'Building': 1, 'WFL': 1, 'Packaging': 1, 'CI': 1, 'SCons': 1, 'CMake': 1, 'Schema': 1, 'Terrain': 1}","Given the CI failures, it looks like we won’t be able to use this for a while. Specifically, we need a newer version of clang (at least 16) due to https://github.com/llvm/llvm-project/issues/44178, which seems to be (if I’m not mistaken) the underlying issue causing the failures related to `views::reverse`. That requires a new docker image built off Ubuntu 24.04.

As for the Windows failures, I don’t know what to make of them. I don’t get the warnings about a recursive `config_attribute_value::operator==` implementation in VS 17.10, but I also do realize that my “updated” implementation in this PR is most likely actually wrong.

The macOS builds are equally baffling. While it seems possible that we might not need to bump the minimum deployment target, we definitely require a much newer version of XCode. Though even running on the `macos-latest` runner, we get weird errors about `wfl::variant` being an incomplete type.

The flatpak failure, I can’t figure out. We need to update to boost 1.74 (https://github.com/boostorg/bimap/commit/6fba6e5de3a5d9b0675a875fdac8aad9238d6dd8 is needed), but on doing `make` randomly decides to stop detecting asio, and with 1.85, to stop detecting system. No idea what’s going on.

Likewise, the GCC failure is somehow related to boost, but doesn’t seem affected by a boost version bump, and I can’t find any info on that particular failure.

TL’DR: The best we can do for now with regards to C++20 is conditional compilation. VS offers (and has offered) the best support thereof for a few years now (we could honestly use C++23 features if we were just targeting VS). I might look to enabling certain features on a per-compiler basis, but that’s a different project.

UPDATE 7/31: I've gotten everything building. We don't actually need to bump the MacOS target, but we do require a newer XCode version to actually build. That constitutes a requirement bump for devs (not for players), so for now C++20 features should be enabled by conditional compilation using the [standard feature test macros](https://en.cppreference.com/w/cpp/utility/feature_test). All existing C++20 code has already been updated to use those guards."
1974997198,EI S04c: only award achievement if all prisoners escape,Dalas121,2024-07-18 03:46:09+00:00,2024-07-20 00:17:08+00:00,{'Campaign EI': 1},"EI's S04c has an achievement for rescuing all 6 prisoners. This achievement currently triggers whenever all prisoners are freed, even if they die before escaping the scenario.  This PR changes the achievement to only trigger if all 6 prisoners actually escape."
1974393310,FS: use optional<string> to represent non-existent paths,Vultraz,2024-07-17 19:15:27+00:00,2024-07-18 13:58:55+00:00,"{'AI': 1, 'UI': 1, 'Editor': 1, 'Units': 1, 'Lua API': 1, 'Add-ons': 1, 'WFL': 1}","Most `filesystem::` functions that returned an empty string for an invalid path now return `optional<string>` . There are a couple areas (mostly with the schema files) where I'm not sure if I should use `value_or("""")`, since it's possible with `value` we get the wrong exception thrown for an invalid path."
1972964466,Move assert into filesystem::get_user_data_path(),Pentarctagon,2024-07-17 06:37:41+00:00,2024-07-17 22:50:03+00:00,{'MP': 1},As discussed previously in https://github.com/wesnoth/wesnoth/pull/9016#discussion_r1650036348
1972796144,EI S17b: fix buggy dynamic recruit list macro,Dalas121,2024-07-17 04:05:58+00:00,2024-07-20 00:17:42+00:00,{'Campaign EI': 1},"EI's S17b has a gold refund mechanic, allowing enemies to build up large gold reserves in certain situations.

When gold gets high, enemies are supposed to start recruiting higher-level units so they can spend it faster. The former implementation had some inconsistent issues; this should restore the intended behavior."
1972784904,"make ""modern"" the default theme and rename ""default"" -> ""classic""",babaissarkar,2024-07-17 03:54:45+00:00,2024-08-31 11:38:24+00:00,{'UI': 1},"Makes _Modern_ the initial theme (it will be used when no theme is set by preferences).
The previous theme (now called _Classic_) still exists and can be used by **Preferences -> Display -> UI Theme**.
Additionally, some more small reorganization has been done:
* the default theme is now named **Classic** (id is still *default*, otherwise the dialog/widget fallback mechanism won't work)
* more folder rename: *default* -> *classic*, *window* -> *dialogs*, *widget* -> *widgets*."
1972771346,EI: minor assorted unit stat and item tweaks,Dalas121,2024-07-17 03:36:18+00:00,2024-07-20 01:30:07+00:00,"{'Units': 1, 'Campaign EI': 1}","Fixing several reported issues.

Units: Gweddry has the wrong HP values
Units: Konrad is neutral, should he be lawful
Units: ""Dark Shape"" is neutral instead of chaotic
Items: prevent Konrad from picking up the plague staff
S16: prevent Konrad and generals from recalling undead
"
1971867408,LoW bigmap localization fix and folder regroup,mavpii,2024-07-16 15:35:17+00:00,2024-07-17 22:48:40+00:00,"{'Graphics': 1, 'Translations': 1, 'Campaign LoW': 1}","I noticed that map localization in LoW doesn't work. As it turned out, this is because main map image is in .png format, but all overlays are in .webp format. 

So I fixed this and also:
— Created separate folder for maps and renamed files to match the format of other campaigns.
— Updated bigmap.cfg to point to the new location of bigmap.
— Updated copyrights.csv."
1969244005,update bengali locale info,babaissarkar,2024-07-15 11:48:49+00:00,2024-07-15 16:58:15+00:00,{'Translations': 1},"Adds a `sort_name` key as well as makes the naming consistent with other languages.
Without this Bengali will be sorted at the end of the language selection list"
1969172223,WC: update todo.txt file,knyghtmare,2024-07-15 11:04:45+00:00,2024-07-17 13:29:28+00:00,{'Campaign WC': 1},Removes completed TODOs and ones deemed irrelevant.
1968408897,Update copyrights: Write CSV as UTF-8,Wedge009,2024-07-14 21:33:04+00:00,2024-07-15 13:05:27+00:00,{'Docs': 1},"This surprises me, but quoting https://docs.python.org/3/library/functions.html#open:

> In text mode, if encoding is not specified the encoding used is platform-dependent...

At any rate, 'explicit is better than implicit'."
1968361886,Make goblins a subfolder in orcs,Gothyoba,2024-07-14 18:22:06+00:00,2024-07-18 20:10:40+00:00,"{'Units': 1, 'Help': 1}","Goblins are orcs, right? The race descriptions confirms their the same race, and I think the Goblin Spearman description implies that goblins are orcs and not vice versa. Based on my testing, I don't think this introduces any gameplay issues."
1968340767,"Implement nonzero attack_weight, closes #3923",ProditorMagnus,2024-07-14 17:07:13+00:00,2024-07-21 22:51:18+00:00,"{'Enhancement': 1, 'AI': 1, 'Engine': 1}",
1968339685,Locale and language dialog: retrieve country code using boost::locale,babaissarkar,2024-07-14 17:03:29+00:00,2024-07-15 11:30:03+00:00,"{'Translations': 1, 'UI': 1}","1. Remove embedded country code from `English (US)` and `English (GB)`. Countries will be programmatically retrieved using `boost::locale`.
2. Update Bengali locale info (add transliteration and `sort_name`)
3. Slightly reorganize the language selection dialog so that country codes are shown for each language. The country code is calculated from the locale's `locale` key.

![Screenshot from 2024-07-14 22-27-29](https://github.com/user-attachments/assets/291f8440-605d-47c1-a685-a8d325485372)
"
1968108361,wc: fix #9012 errro when deserter list is empty,gfgtdf,2024-07-14 02:27:03+00:00,2024-07-16 20:31:57+00:00,{'Campaign WC': 1},we no longer show the deserter option fo no deserter are avilable
1967968611,chance_to_hit tests,Pentarctagon,2024-07-13 17:34:24+00:00,2024-07-21 22:30:37+00:00,{'Unit Tests': 1},
1965883291,Use std::numeric_limits instead of C macros,Vultraz,2024-07-12 04:38:01+00:00,2024-07-12 06:49:28+00:00,"{'UI': 1, 'Units': 1, 'WFL': 1, 'Schema': 1, 'Terrain': 1}",CI run
1965708751,Update copyrights: Always use slashes for the file path,Wedge009,2024-07-12 01:53:57+00:00,2024-07-13 14:29:38+00:00,{'Docs': 1},"Avoid discarding the entire copyrights.csv when running the update on Windows, and force slashes in file path strings if adding new files.

Also rename hash object to avoid collision with built-in hash function. Clarified file object is representing a file path string as opposed to an actual open file object.

See https://github.com/wesnoth/wesnoth/pull/9063#issuecomment-2224076873 for why I settled on this particular resolution."
1965164692,[1.18] CI run for an updated German translation,stevecotton,2024-07-11 18:41:46+00:00,2024-07-11 20:50:15+00:00,{'Translations': 1},"Thanks to Wuzzy for all of these.

Also reverted a couple of places where 1.19's change from ""default has six factions"" to ""default has seven factions"" had leaked into 1.18."
1965164158,CI run for an updated German translation,stevecotton,2024-07-11 18:41:22+00:00,2024-07-11 20:27:07+00:00,{'Translations': 1},Thanks to Wuzzy for all of these.
1962686940,Make wose unit folder plural,Gothyoba,2024-07-10 15:30:24+00:00,2024-07-13 20:35:00+00:00,{'Units': 1},"Based on my tests this should not break anything in mainline. All other unit folders for different races use their plural name, except for woses. This PR changes the name of the wose folder to woses to stay consistent with other folders."
1962630454,validate [screen_fade] required parameters,ProditorMagnus,2024-07-10 15:00:18+00:00,2024-07-21 22:48:45+00:00,{'Lua API': 1},
1960582250,add a command line option for disabling log sanitization,babaissarkar,2024-07-09 16:41:32+00:00,2024-07-11 18:46:27+00:00,"{'Docs': 1, 'Command Line': 1}","Resolves #8505.

Adds the `--no-log-sanitize` option. When this option is used, the actual username of the user will be shown in the log instead of `USER`."
1959097381,Make parse_ranges_unsigned actually return an unsigned range,Vultraz,2024-07-09 03:59:15+00:00,2024-08-13 04:00:16+00:00,"{'Units': 1, 'Terrain': 1}","This shouldn't result in any behavior changes, just makes the typing more strict. Also cleans up some of the relevant code using in_ranges. It does raise the question as to whether a lot of these variables should be unsigned instead of int, but that's a different matter altogether..."
1958925688,EI S10: Clarify Dacyn's wording,Wedge009,2024-07-09 00:53:09+00:00,2024-07-09 02:01:24+00:00,"{'Prose': 1, 'Campaign EI': 1}","Resolves #9066.

@Dalas121 Might as well ask you to review this at the same time as #9081."
1958924897,Minor changes to Eastern Invasion item wording,Wedge009,2024-07-09 00:51:53+00:00,2024-07-09 02:37:50+00:00,{'Campaign EI': 1},"Resolves #9070.

@Dalas121 While I was reviewing this, I noticed empty bold blocks and double-spaces at the start of italics blocks. Any reason for this?

https://github.com/wesnoth/wesnoth/blob/888fbf13e55e41cef445770c0479d2706ac5eb37/data/campaigns/Eastern_Invasion/utils/items.cfg#L116-L120"
1957786643,Fix “filter_adjacent_location” not working in ability,newfrenchy83,2024-07-08 13:06:24+00:00,2025-02-22 20:04:10+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1}","check is the same what for units/filter.cpp, if an unit or an adjacent locaton don't matche, the loop continue without increase value of 'coount' variable instead of return false and stop checking, that who doing fail the function.

"
1957714968,"Reserve the name ""_bug"" for tests of behavior that should change",stevecotton,2024-07-08 12:32:25+00:00,2024-07-20 09:19:51+00:00,{'Unit Tests': 1},"Rewrite the non-reservation of ""break"" and ""error"" for clarity.

Even tests that don't have ""_bug"" in the name shouldn't prevent intentional changes to behavior, I've added a paragraph about that.

The idea comes from #9074, I'm splitting it from that because I wrote that PR to test a behavior that I knew about, and found other problems that have meant I need to change what I'm testing."
1957263642,WFL: Use correct argument for the second location in rotate_loc_around,hladkyjakub,2024-07-08 08:38:31+00:00,2024-07-08 12:32:12+00:00,{'WFL': 1},"WFL rotate_loc_around used to set both loc to first parameter.
Repaired."
1956577726,EI - urbanjungle clean-ups,doofus-01,2024-07-07 21:18:08+00:00,2024-07-12 12:58:16+00:00,"{'Terrain': 1, 'Campaign EI': 1}","Cleans up the help browser and fixes #8497 (and makes the icon no longer pink).

I'm not sure I like this terrain idea, villages that aren't villages but use the village graphics.  As long as it stays in EI though, I guess it can be OK."
1956509392,Perform multiplication in result type for types larger than int,soliton-,2024-07-07 17:09:31+00:00,2024-07-11 18:57:57+00:00,"{'AI': 1, 'UI': 1, 'WFL': 1, 'Terrain': 1}",Makes the code do what is commonly expected and avoids needless overflow since otherwise the multiplication is done as int.
1956475421,"[1.18] Add unit tests for ability[filter_adjacent_location]adjacent,count=",stevecotton,2024-07-07 15:14:20+00:00,,{'Unit Tests': 1},"Adds a new convention, that unit test names containing `_bug_` or ending `_bug` are reserved for tests where consensus is that the behavior should change in the development branch, however that it's better to accept the current behavior in the stable branch than to risk Out Of Sync errors.

I'm assuming the PR review will agree on this being something to fix for 1.20. I believe the bug has been present since `count` and `adjacent` were added in 1.13.2.

The Wiki docs say that count= takes a number or numerical range, and is true if the number of matches in adjacent locations matches that range. However, the implementations that are specific to using it in ability filters are buggy, and returns false if any location in the adjacent= set doesn't match.

There are several implementations of the Standard Location filter. Although this bug is specific to filters used in abilities, it feels to me that the test should be in the FilterWML directory instead of adding more tests to `data/test/scenarios/wml_tests/UnitsWML/AbilitiesWML/`. That's just a gut feeling, I'll happily move it if asked.

I already have a fix written, I ran into this bug while writing a new infinite-recursion test.

Ping @newfrenchy83, @CelticMinstrel "
1956421475,Updated link to android version in README,Gothyoba,2024-07-07 12:17:12+00:00,2024-07-07 16:42:32+00:00,{'Docs': 1},The app has been removed from the Play Store.
1956179098,"Bump macOS target, drop boost::variant and boost::any compat",Vultraz,2024-07-06 21:57:27+00:00,2024-07-09 02:02:32+00:00,"{'macOS': 1, 'AI': 1, 'MP': 1, 'Units': 1, 'Lua API': 1, 'Add-ons': 1, 'Building': 1, 'WFL': 1, 'Schema': 1}",Bumps macOS target to ~~10.15 as discussed in #9031~~ 10.13.
1956009068,[android-support] libffi patch,babaissarkar,2024-07-06 12:17:48+00:00,2024-07-08 18:18:08+00:00,"{'Packaging': 1, 'Android': 1}","Fixes the following error when building libffi
1.
```
/tmp/android-build/src/libffi-3.4.4/src/tramp.c:262:22: error: call to undeclared function 'open_temp_exec_file'; ISO C99 and later do not support implicit function declarations [-Wimplicit-function-declaration]
  tramp_globals.fd = open_temp_exec_file ();
```
Fixed by libffi.patch file included here. The patch is from [here](https://github.com/libffi/libffi/pull/764).

2.
```
ld.lld: error: version script assignment of 'LIBFFI_BASE_8.0' to symbol 'ffi_type_longdouble' failed: symbol not defined
ld.lld: error: version script assignment of 'LIBFFI_COMPLEX_8.0' to symbol 'ffi_type_complex_longdouble' failed: symbol not defined
clang-17: error: linker command failed with exit code 1 (use -v to see invocation)
```
Fixed by adding the linker flags `-Wl,--undefined-version` in setup_toolchains.py. This solution is based on the patch [here](https://cgit.freebsd.org/ports/commit/?id=b547544132486acbe86da6d9e729ae13a4fd6e54).

Tested on Devuan Daedalus 5.0.
  "
1955855968,Add string_view access to config_attribute_value (with usecase),Vultraz,2024-07-06 03:05:37+00:00,2024-08-18 05:04:45+00:00,{'Units': 1},Other changes added to show usecase.
1954845569,[1.18] Restore force-pushed commits,stevecotton,2024-07-05 09:28:38+00:00,2024-07-05 10:18:24+00:00,"{'Translations': 1, 'UI': 1, 'WML Tools': 1, 'Campaign HttT': 1}","@Wedge009 is there anything wrong in this? I didn't push it back because I wasn't sure whether the force-push was accidental or intentional, so waiting for you to say if there's something bad somewhere in these 5 commits.

Branch-name is just what I had locally tracking 1.18, but given that it's restoring Wuzzy's German translation (commit by @sevu), it seems appropriate.

Reapplies
* #9045
* #9053
* e28041573ac7405d38a02cd4d7751ed020d670e3 Fix ""span"" regex
* #9054
* d75639205d40ee6ec3ff8ad162213fb5cd93deee German translation update"
1953610347,Delete the wmltools3.Translation class,stevecotton,2024-07-04 13:04:05+00:00,2024-07-04 14:37:39+00:00,{'WML Tools': 1},"Appears to be unused, and is still Python2 code. To be Python3, these lines need to change:

- f = file(fn)
+ f = open(fn, encoding=""utf-8"")

- gettext = f.read().decode(""utf8"")
+ gettext = f.read()

Even knowing how to make it work, it still doesn't seem useful to keep.

wmlunits uses html_output.Translation, but that's not this class. It's a wrapper around Python's standard gettext library, in html_output.py."
1953320535,l10n: Add Ukrainian Logo and Maps,mavpii,2024-07-04 10:15:54+00:00,2024-07-16 22:38:23+00:00,"{'Graphics': 1, 'Translations': 1, 'Campaign AToTB': 1, 'Campaign DW': 1, 'Campaign DiD': 1, 'Campaign EI': 1, 'Campaign LoW': 1, 'Campaign L': 1, 'Campaign NR': 1, 'Campaign SoF': 1, 'Campaign THoT': 1, 'Campaign TRoW': 1, 'Campaign TSG': 1}",
1953147108,some editor bugfixes from #8903,babaissarkar,2024-07-04 08:48:48+00:00,2024-07-05 07:02:16+00:00,"{'Backport': 1, 'Editor': 1, 'Units': 1}","Contains a couple of backported fixes from #8903, and some new behavioral fixes inside the Editor. Changes detailed in the commit messages. New changes will need to be forward-ported.

New commits in this PR (forward-port needed):
4b1752be06b396abf3201b9fc4e14beccd2127ab"
1952855306,Optimize color_range reference palette generation,Vultraz,2024-07-04 05:32:27+00:00,2024-07-05 20:19:02+00:00,{'Engine': 1},"For this specific codepath on game launch, it reduces its execution time from ~18ms to ~1ms."
1952413162,Encyclopedia revision,Gothyoba,2024-07-03 21:06:42+00:00,2024-08-09 14:20:38+00:00,{'Help': 1},"This is a series of mostly minor changes to the encyclopedia:

- The Wesnoth Calendar has been renamed to Wesnothian Calendar.
- The calendar page now explains YW, BW, and AF. As far as I’m aware, these are not explained in-game despite their use.
- The unused file drakes.txt has been removed.
- The Great Ocean section now mentions the drakish name World Ocean and some drakish mythology from drakes.txt. 
- The Great River page has had a section on the Ford of Abez added. This is partly copied from the wiki (section copied appears to have been added by Esr, 8 October 2008)
- Morogor has had Mount Krogor been added as a notable land feature in the encyclopedia, taken from drakes.txt.
- The Green Isle section has been greatly expanded to include details on settlements and terrain. I thought it would be useful to have this, as the Green Isle is the original home of the Wesnothians and a major part of the setting of TRoW.
- Added a short sentence on the Old Continent being the original homeland of orcs and humans.
- Westin has been added to the Wesnoth page.
- The Isle of Alduin has been added to the Wesnoth page.
- A section on the Green Swamp has been added to the Wesnoth page. This is copied from the wiki. (section copied appears to have been added by Octalot, 21 September 2021)
- The section on notable cities for the Southwestern Elves has been removed due to the lack of known cities in the region.
- The Northlands description has been modified.
- The local orcish names for the Heart Mountains are now mentioned on the page for the Heart Mountains.
- Tirigaz and Jotha now have short one-sentence descriptions.
- The Desert of Death has been added to the far north section.
- Various land features from the far north have had short descriptions added.
- A section on the Far South has been added. It does not expand much on current lore except for some mentions of monsters. It only includes the Mountains of Peril, Sandy Wastes, and the Black Forest (moved from Southwestern Elven Lands and slightly modified) and is intenced to be very vague to allow UMC creators to imagine details of the Far South."
1952384240,Simplify user data dir determination,soliton-,2024-07-03 20:55:02+00:00,2024-07-14 12:55:20+00:00,{'Engine': 1},Behavior should be generally as in 1.18 except for interpreting relative paths normally instead of under $HOME. The latter was warned about for quite a few versions now.
1951664012,Support loading gui2 themes from addons,babaissarkar,2024-07-03 13:35:13+00:00,2024-08-25 05:56:22+00:00,"{'UI': 1, 'Lua API': 1, 'Schema': 1}","The relevant gui definition should be in `<add-on-dir>/gui-theme.cfg`

**TODO**
- [x] Add a Lua function to change themes from an addon (`gui.switch_theme()`)
- [x] Make sure themes are loaded correctly just after downloading theme from addons server (that is, no restart is needed).
- [x] Allow user to switch in case of defunct theme."
1951137410,use correct font for checkmark character,babaissarkar,2024-07-03 08:56:53+00:00,2024-07-04 00:31:47+00:00,{'UI': 1},Resolves #9055.
1950012971,[1.18] wmltools3 and Python 3.12,stevecotton,2024-07-02 17:46:12+00:00,2024-07-03 00:07:13+00:00,{'WML Tools': 1},Backport #9044 and #8952.
1949650311,[1.18] GUI2/Game Load: Apply filter when changing directory,stevecotton,2024-07-02 14:26:14+00:00,2024-07-02 17:12:19+00:00,{'UI': 1},"Backport of #8955.

When the user types something into the filter box and then changes to a different version, apply the filter immediately instead of showing the full list of files.

The drop-down to switch between directories is hidden unless savegames from other versions are detected. The button will appear at the bottom-left in master, and at the top of the dialog in 1.18.

(cherry picked from commit 17c202d3fb4fdb2f89f65f3b49eeda56836fd43e)"
1949541705,[1.16] Version bump for 1.16.12+dev,stevecotton,2024-07-02 13:41:26+00:00,2024-07-07 18:22:23+00:00,"{'WML Tools': 1, 'Building': 1, 'Stable 1.16': 1}","I have no expectation that we'll release a 1.16.13, but it's still useful to know which builds were from exactly the 1.16.12 tag.

That ""I have no expectation"" is in the commit message, please say if I should remove it.

The reason to push this now is to find out if the CI still works for 1.16, given that 1.14's Docker images no longer exist (see the build logs of #9036)."
1949489477,Patch 2,ProditorMagnus,2024-07-02 13:21:02+00:00,2024-07-02 13:38:34+00:00,{},
1948618345,SoF: Align masked dwarf portrait to the right,Wedge009,2024-07-02 05:24:36+00:00,2024-07-06 01:44:33+00:00,"{'Backport': 1, 'Graphics': 1, 'Campaign THoT': 1}","Resolves #9008.

I think this is a small enough change to be back-ported."
1948001581,"merge moveto event into turn_refresh, closes #8954",ProditorMagnus,2024-07-01 19:23:56+00:00,2024-07-07 11:56:24+00:00,{'Lua API': 1},
1947243920,[1.18] HttT S17 Don't erase castles from other leaders,stevecotton,2024-07-01 12:32:10+00:00,2024-08-10 16:10:57+00:00,"{'Bug': 1, 'Unit Tests': 1, 'Fwdport': 1, 'Campaign HttT': 1}","The random map generator can generate starting locations so close that ERASE_CASTLE removed not just the intended castle, but also the keep of the nearby leader. To avoid that, remove the intended keep, then castle that isn't adjacent to a keep.

The ERASE_CASTLE macro is obsolete, using location_id makes the code simple enough that a macro isn't useful. However, as this change is being applied to 1.18, I'm only adding a comment about it.

Fixes #9042. For obvious reasons, tested alongside #9045."
1947242659,[1.18] HttT S17 Don't create lava near the Sceptre,stevecotton,2024-07-01 12:31:28+00:00,2024-07-02 09:16:30+00:00,"{'Bug': 1, 'Fwdport': 1, 'Campaign HttT': 1}","The lava is supposed to stay away from the Sceptre itself. However, 60d114b changed from using sceptre_x,sceptre_y to using a location_id, and missed updating these macros.

Fixes #9038."
1947214259,wmltools3: fix regexp compatibility with Python 3.12,stevecotton,2024-07-01 12:17:42+00:00,2024-07-02 17:42:13+00:00,"{'Backport': 1, 'WML Tools': 1}","Has no merge conflicts with #9041.

When backporting, I'll cherry-pick 28a895985499afac8809c4c03ed080f4fe133da5 too."
1947157748,Fix some GCC-14 warnings,stevecotton,2024-07-01 11:50:17+00:00,2024-07-05 21:19:01+00:00,"{'UI': 1, 'Units': 1, 'Building': 1, 'Help': 1}","Forward-port of
* #8998 
* #9006 

Fixes most of #8979. There are still warnings in src/actions/attack.cpp, but that area is being worked on for an infinite recursion bug, and those warnings log in a single batch instead of being spread across multiple .cpp files."
1946628029,Reduce hardcoded extensions,babaissarkar,2024-07-01 07:18:04+00:00,2024-07-05 03:35:26+00:00,"{'UI': 1, 'WML Tools': 1, 'Editor': 1, 'Add-ons': 1}","Reduces the the number of hardcoded filenames extensions, especially those that are used in many files (.map, .cfg, .mask). Instead hardcode them only once. For C++, it's in `filesystem.cpp`, for Python tools, it is in `wmltools3.py`.
Also adds new methods for checking if a file is one of these extensions in `filesystem`. (Please use those in new code.)"
1946122747,(1.19) Cat units,doofus-01,2024-06-30 22:41:27+00:00,2024-08-04 22:07:15+00:00,"{'Graphics': 1, 'Units': 1}","Addresses #7186 (sort of) and might do something for WoF.  The triple tail is supposed to be some mild fantasy, otherwise we're just making an animated encyclopedia with low-quality writing.

This is a first draft with some filler, the only configuration feature I'd insist on is the `attack/defense_weight=0`.
![Screenshot_20240630_cat](https://github.com/wesnoth/wesnoth/assets/13510196/a8e73f40-5cbf-4e07-91c6-277ab0ba7b66)

EDIT:  The other cat (currently ""Jump Cat"") is also a mild fantasy, but hopefully different enough to still be useful/interesting.  And then there are the undead variations.

- [X] Tritail (or whatever name)
- [x] Jump Cat (or whatever name)
- [X] Walking Corpse
- [x] Soulless
"
1945950705,replace alternative/replacement_type by type with mode= in [damage_type],newfrenchy83,2024-06-30 13:52:38+00:00,2024-08-03 16:04:16+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1, 'Campaign EI': 1}",resolve https://github.com/wesnoth/wesnoth/issues/9035 issue by reply to @stevecotton suggestion.
1945925412,[1.14] Backport compatibility fixes for Boost 1.81 and 1.83,stevecotton,2024-06-30 12:30:49+00:00,2025-08-20 07:58:50+00:00,"{'Building': 1, 'Stable 1.14': 1}","Needed these while trying to work out when #8643 was introduced, which is part of sanity-checking the fix for that bug.

Planning to merge once the CI confirms that it builds on all platforms."
1940569413,WFL rotate_loc_around typo,hladkyjakub,2024-06-26 17:47:08+00:00,2024-07-08 08:31:07+00:00,"{'Unit Tests': 1, 'WFL': 1}","Hi,
In core formula function rotate_loc_around has been both locations the function operates with set to the first parameter.
I've fixed that and made a coresponding unit test.

(I'm not sure how does this PR work, so please message me if I've messed up)"
1940037983,Add -r option to add_source_file fix #8733,gfgtdf,2024-06-26 13:25:07+00:00,2024-12-14 21:39:12+00:00,{'Building': 1},"I think the title is self explaining.

When i tested this, it removed unexpected things from the xcode projectfile, butim assuming its just that opening tthe pjects with the lib and hen closing them removes unsed stuff? Not fully sure

Also im unsure wheterh the option should be -d or -r"
1936371402,Minor color_t cleanup,Vultraz,2024-06-24 21:41:07+00:00,2024-06-25 00:00:39+00:00,{},"Just to double check, since we don't use hex value with alpha, `uint32_t` should be big enough to support any hex string-to-num conversion, right?"
1935465430,"Remove unused dawn.png image, update copyrights.csv",stevecotton,2024-06-24 12:41:52+00:00,2024-07-04 12:56:23+00:00,"{'Graphics': 1, 'Terrain': 1}","dawn.png was leftover from the Time of Day being shown with an overlay image; 074e157400e04d16cdb2b77db5065537f35c9177 removed dusk.png and night.png. The image itself should be a transparent blue hexagon, but the alpha channel was corrupted, and so it appeared completely transparent.

empty.png was a copy of images/misc/blank.png, and only blank.png is used in mainline. It's a 640x480 pixel completely transparent image.

Make the capitalisation of Kitty's name consistent, and attribute the orb-disengaged.png image.

Part of clearing up #9028."
1934438089,Fix #8805 Add-on version check prevents joining game,gfgtdf,2024-06-24 01:29:21+00:00,2024-06-27 08:25:23+00:00,"{'Bug': 1, 'Backport': 1, 'MP': 1}",
1934177728,show a message when nothing exists to migrate,Pentarctagon,2024-06-23 15:07:08+00:00,2024-07-02 23:14:06+00:00,{'UI': 1},
1933848069,Moving image data to the image,doofus-01,2024-06-23 02:53:11+00:00,2024-08-05 01:40:45+00:00,{'Graphics': 1},"This is the child of https://github.com/wesnoth/wesnoth/issues/8863

Figuring out how to do this without causing a lot of headaches isn't trivial - I will not address the actual image EXIF tag changes (all the images) here.  The CI will also have to wait.  For now, it's just getting these two maintenance scripts (derived from the existing `update_copyrights` script) to be ready.

Ideally, the workflow goes like this:
1.  Run csv2img-exif to read the data from the existing `copyrights.csv` and write that to the Exif tags of the wesnoth images
2.  Run img-exif2csv to read back the Exif tag data and give a summary of the Exif tag situation.
3.  Any new image in a PR is checked by CI for the needed tags
4.  Periodically, someone runs these two scripts, in case CI didn't catch something.


The initial run of `img-exif2csv` yields the attached CSV.
[img-exif2csv_output-original.csv](https://github.com/user-attachments/files/15942359/img-exif2csv_output-original.csv)

`csv2img-exif` got hung up on some weird data in EI, so this isn't ready for prime-time."
1933716711,Proposed New Wyvern Rider Description,Gothyoba,2024-06-22 20:02:41+00:00,2024-07-10 06:55:44+00:00,{'Units': 1},"I know I already made a PR for this as well as some other descriptions around a year ago, but the writing was not very good and I ultimately abandoned the idea. However, I have decided to this to propose a new and hopefully better description."
1932981070,Modify a line in tutorial on reccommended next campaign,Gothyoba,2024-06-21 18:56:50+00:00,2024-06-25 16:42:32+00:00,"{'Enhancement': 1, 'Campaign Tutorial': 1}","AToTB has not been described as rookie since 2019, and I do not think it contains many strategy hints. This replaces the term rookie-level used in the tutorial to reffer to AToTB with novice-level."
1931046208,Prevent program hang when compiled with relative path PREFERENCES_DIR,Pentarctagon,2024-06-20 17:23:29+00:00,2024-07-01 18:51:40+00:00,"{'Building': 1, 'SCons': 1}","Fixes #2000
Fixes #9007

---

Draft still since I need to get the assert to not trigger on the various other non-boost tests."
1929930835,AToTB: Warn in the description how hard the challenging difficulty is,stevecotton,2024-06-20 07:01:13+00:00,2024-06-25 12:03:27+00:00,"{'Enhancement': 1, 'Campaign AToTB': 1}",
1924775006,Fix damage_type types show in unit attack window[1.18],newfrenchy83,2024-06-17 18:15:10+00:00,2024-06-18 20:39:51+00:00,{'Units': 1},"If [damage_type]apply_to= is applied to a unit that does not have the range attack equivalent to that of the user this type will still be shown, which should not be."
1924763736,Fix damage_type types show in unit attack window,newfrenchy83,2024-06-17 18:07:23+00:00,2024-06-18 20:39:57+00:00,{'Units': 1},"If [damage_type]apply_to= is applied to a unit that does not have the range attack equivalent to that of the user this type will still be shown, which should not be."
1922749782,[1.18] Ignore GCC-14 and Clang false positives about dangling pointers,stevecotton,2024-06-16 11:03:50+00:00,2024-07-01 11:33:37+00:00,"{'UI': 1, 'Units': 1, 'Building': 1, 'Fwdport': 1}","For GCC-13, cfb28fbfb52ed5c75d93e283738d2e45061f9c84 (in master) added -Wno-dangling-reference, and that commit explains why the false positive is triggered by calling find_widget. For GCC-14 there's an attribute so we can flag this specific function as ok.

Clang complains about unknown attributes in the gnu:: namespace, so has to have the #if, and the #if means we need the #ifdef.  I'm intending to leave this PR open a couple of weeks (until the end of June) for discussion about whether there's a less unpleasant alternative.

There are still warnings in src/actions/attack.cpp, but that area is being worked on for an infinite recursion bug, and those warnings log in a single batch instead of being spread across multiple .cpp files.

Fixes part of #8979, will forward-port along with #8998."
1922504473,lua: use correct method to attach on_left_click signal,babaissarkar,2024-06-16 02:59:17+00:00,2024-06-17 12:48:13+00:00,{'Lua API': 1},"the signal is ""on_left_click"", so logically the correct method is `connect_signal_mouse_left_click`.
(AFAIK notify_modified is not available for most widgets and doesn't do the same thing as left_click either.)"
1922428414,Update generator calls since the method was removed in 2413e2f,soliton-,2024-06-15 21:47:38+00:00,2024-06-16 19:57:02+00:00,{'WML Tools': 1},
1922423721,Update added/removed header files in Xcode project,soliton-,2024-06-15 21:42:00+00:00,2024-06-16 18:38:20+00:00,"{'macOS': 1, 'Building': 1}","Header files added/removd in commits: c4c292fa3bc0, 43f5644e36e1, 32799739608b, c5b1fa9dfdbb, d954d307bce6, 01f28b12aea5, 63d14217c9c1, 6d77fdc48c6f, 0e85fac29c15, 0b646dec8a13 and 6c5a8e923d52"
1922191753,Remove extra parens to avoid compiler warning,soliton-,2024-06-15 17:06:50+00:00,2024-06-16 17:53:04+00:00,{'UI': 1},
1920798370,[1.18]Backport replacing deprecated CURLOPT_PROTOCOLS with CURLOPT_PROTOCOLS_STR,stevecotton,2024-06-14 14:19:02+00:00,2024-06-15 12:15:01+00:00,{'Building': 1},"Backports of #8958 and #8999, fixing the compiler warning. Not sure whether to squash or not, I like having a separation between ""this is the change"" and ""this is just formatting""."
1920631815,network_download_file: replace spaces with tabs,babaissarkar,2024-06-14 12:46:11+00:00,2024-06-14 13:05:12+00:00,{},
1920610750,[1.18] Fix some GCC-14 warnings,stevecotton,2024-06-14 12:34:08+00:00,2024-06-16 10:48:13+00:00,"{'UI': 1, 'Building': 1, 'Help': 1, 'Fwdport': 1}","Fix warnings about a template id in a constructor, which is redundant, and GCC-14 warns that this isn't allowed in C++20.

An iterator can often be a struct containing a single pointer, so creating a reference to such a small struct doesn't make sense.

The structure returned by child_range is likely to be exactly two pointers, so it's not a burden to keep it even though back() has already finished accessing the child_iterator.

This fixes half of #8979, as I'm splitting the PRs by estimated amount of discussion. Once it's merged I'll open a PR that pastes 6 copies of the following block into header files, but request that comments on that wait until that PR opens.
```c++
#ifdef __has_cpp_attribute
#if __has_cpp_attribute(gnu::no_dangling)
[[gnu::no_dangling]]
#endif
#endif
```"
1919266323,Fix Weapon special filters can be affected by the weapon special leading to infinite recursion[1.18],newfrenchy83,2024-06-13 18:09:44+00:00,2024-08-03 15:46:45+00:00,"{'Unit Tests': 1, 'Units': 1}","When for example we have [damage_type][filter_self][has_attack|filter_weapon]type=pierce applied to one or any pierce type attack and the unit does not have an unaffected pierce attack, the change in type triggers an infinite recursion.

this PR fixes the problem and other because filter of weapon specials or formula.

Fix https://github.com/wesnoth/wesnoth/issues/8940"
1918672679,Fire pre harm and post harm events from [harm_unit] (Issue #8974),rodolphecombe,2024-06-13 13:06:08+00:00,2024-12-06 20:48:37+00:00,{'Lua API': 1},"https://github.com/wesnoth/wesnoth/issues/8974
[harm_unit] now fires a pre harm and a post harm event, checking after each of those that the harmed unit still exists."
1915125900,"Trigger unit_hits, unit_misses events, re #7782",ProditorMagnus,2024-06-11 19:30:43+00:00,2024-06-30 10:02:55+00:00,{'Unit Tests': 1},If there are no strong objections about design I will add some tests too.
1914830761,Move data that should be synced between computers to a common dir,Pentarctagon,2024-06-11 16:11:51+00:00,2024-07-08 22:42:21+00:00,"{'Docs': 1, 'UI': 1, 'Editor': 1}","Fixes #8059

---

Still need to read through `preferences_list.hpp` again, but I don't recall seeing any that would require splitting the preferences file between synced and unsynced preferences.

The stuff moved under the `sync` folder was taken from https://github.com/wesnoth/wesnoth/issues/8059#issuecomment-2068444154"
1912327486,Change id tag in appstream manifest to what is expected,loonycyborg,2024-06-10 14:08:17+00:00,2024-06-12 01:21:22+00:00,{'Packaging': 1},"Flathub linter complains about mismatched id in flatpak manifest and
appstream. Based on appstream docs it seems that reverse-DNS name is
expected without .desktop extension so appstream should be changed.
Extra `<provides>` and `<replaces>` tags added as per
https://docs.flathub.org/docs/for-app-authors/metainfo-guidelines/#renaming-id-tag
"
1912303857,EI S10: add message about Owaec being able to recruit,Dalas121,2024-06-10 13:57:22+00:00,2024-06-10 15:30:36+00:00,{'Campaign EI': 1},"Owaec has a crown but little other indicator that he's a leader, and this scenario requires him to be used to recruit."
1912100158, Fix Weapon special filters can be affected by the weapon special leading to infinite recursion[1.18],newfrenchy83,2024-06-10 12:22:00+00:00,2024-06-10 12:49:21+00:00,"{'Unit Tests': 1, 'Units': 1}","When for example we have [damage_type][filter_self][has_attack|filter_weapon]type=pierce applied to one or any pierce type attack and the unit does not have an unaffected pierce attack, the change in type triggers an infinite recursion.

this PR fixes the problem and other because filter of weapon specials or formula.

Fix https://github.com/wesnoth/wesnoth/issues/8940"
1911028256,Fix game sending actions too soon leading to OOS erros,gfgtdf,2024-06-10 00:06:50+00:00,2024-06-10 11:46:51+00:00,{'Engine': 1},"Previously undo_blocked() would return false positive results. Leading to OOS erros because the game would then send actions to other clients even though they were still undoable. This would then result in OOS erros when the player attempts to undo the move.

This line is probably not needed at all since using the rng should always set is_simultaneous_ to true, but lets keep the changes minimal for the 1.18 stable branch."
1910999545,EI items: add [filter_second] to Sentinel Shield and set delay=0,Dalas121,2024-06-09 23:06:28+00:00,2024-06-10 02:10:53+00:00,{'Campaign EI': 1},
1910997951,Fix common OOS error #8960,gfgtdf,2024-06-09 23:05:31+00:00,2024-07-21 22:49:10+00:00,{'Engine': 1},"Previously `synced_context::undo_blocked()` sometimes returned the worng result, leading to OOS because `synced_context::undo_blocked()` was used to determine whether we can send action to the other clients.

With this patch `synced_context::undo_blocked()` not doesn't always return true  when its called during ""local choices"".

I am curently not even sure whether that line is needed at all since using the rng should always set is_simultaneous_ to true."
1910980536,EI S11: drop equippable items when imprisoned,Dalas121,2024-06-09 22:12:28+00:00,2024-06-10 02:09:58+00:00,{'Campaign EI': 1},
1910961532,EI S09: fix Grug telling Gweddry he can recruit the wild ogres after having already done so,Dalas121,2024-06-09 21:09:04+00:00,2024-06-10 02:08:52+00:00,{'Campaign EI': 1},
1910956670,"EI S13: fix gaoler rebuild breaking ""free prisoner"" events",Dalas121,2024-06-09 20:53:18+00:00,2024-06-10 02:10:26+00:00,{'Campaign EI': 1},"Formerly, EI S13 uses various Deathblades' max-moves status instead of [filter_second] for some reason. This breaks when deathblades get rebuild, which in the bug report was caused by the sentinel shield.  Use [filter_second] instead."
1910899945,Fix Weapon special filters can be affected by the weapon special leading to infinite recursion,newfrenchy83,2024-06-09 18:25:46+00:00,2024-08-16 11:51:08+00:00,"{'Unit Tests': 1, 'UI': 1, 'Units': 1}","When for example we have [damage_type][filter_self][has_attack|filter_weapon]type=pierce applied to one or any pierce type attack and the unit does not have an unaffected pierce attack, the change in type triggers an infinite recursion.

this PR fixes the problem and other because filter of weapon specials or formula.

Fix https://github.com/wesnoth/wesnoth/issues/8940"
1910890166,"EI S10, S11, S12: Dacyn difficulty tweaks",Dalas121,2024-06-09 17:56:13+00:00,2024-06-10 02:09:17+00:00,{'Campaign EI': 1},"Resolves #8969

In EI S10, Dacyn picks up a cursed amulet and his HP drops to 1. In EI S11, Dacyn remains on very low HP, and is surrounded by orcs. There's a convenient ford hex he can hide on and be protected, but several players did not notice this hex and complained about difficulty.

In S10, this commit also drops his XP to 0. 1) showing that the amulet interferes with his MoL-ing, and 2) preventing the player from deliberately AMLA-ing Dacyn in the next scenario (partially a difficulty issue, but mostly it's bad to punish blind playthroughs / reward foreknowledge).

In S11, this commit adds a gold pile on Easy/Normal hinting towards the hex, while on Easy Dacyn's HP is fully restored. Hard is unaffected.

In S12, this commit restores Dacyn's HP on Easy (since it would be odd if he had full HP S11 but low HP S12)."
1910586973,Add berserk weapon special abilities tests,Pentarctagon,2024-06-09 05:56:00+00:00,2024-06-16 01:20:54+00:00,"{'Backport': 1, 'Translations': 1, 'Unit Tests': 1}","Changes:
* CHECK_STRIKES macro now takes a comma-delimited list of strike counts for when units have a different number of strikes for different weapons, and updates the existing usage in the attacks tests
* Fixed a typo in the attacks_zero test
* Adds tests for berserk as a weapon special ability.

Berserk's handling differs from attacks as a weapon special ability:
* A value less than 1 is treated as effectively infinite rounds of combat (undocumented)
* The cumulative attribute is handled differently - in some cases it sums the values instead of using the highest single value whereas for attacks it always uses the highest single value"
1910564085,Luacheck,cooljeanius,2024-06-09 04:02:23+00:00,2024-08-26 02:30:06+00:00,{'Lua API': 1},Just creating this for a CI run; not actually ready to merge... 
1910553385,1.19 Sprite animations June 2024,doofus-01,2024-06-09 03:11:36+00:00,2024-06-16 15:07:07+00:00,"{'Graphics': 1, 'Units': 1}"," - [x] Melee animation for Dragoon
 - [x] Melee animation for Cavalier
 - [ ] something else, depends on how the planets align."
1910287979,Add a unit test for a weapon-special activating mid-attack,stevecotton,2024-06-08 13:53:33+00:00,2024-06-08 20:08:28+00:00,{'Unit Tests': 1},"A weapon with poison, which does extra damage to poisoned opponents. This tests that the weapon-special's filter is checked on each strike, instead of being tested once and then cached during the battle.

(cherry picked from commit 55aa8b44cfd561d0d97f254312f395cebc8ccc6e)"
1910218119,move filter_abilitie/specials code in abilities.cpp,newfrenchy83,2024-06-08 09:42:24+00:00,2024-08-03 15:43:31+00:00,{'Units': 1},"The code was moved to abilities.cpp so that it can be called from the units or attack_type functions, the attack_type function state necessary for the tags [filter_special_active] and [remove_specials] which I plan to implement when the code for filter_ability] is validated in its final form."
1907840392,Add a unit test for a weapon-special activating mid-attack,stevecotton,2024-06-06 18:21:04+00:00,2024-06-08 13:50:42+00:00,"{'Unit Tests': 1, 'Units': 1, 'Fwdport': 1}","A weapon with poison, which does extra damage to poisoned opponents. This tests that the weapon-special's filter is checked on each strike, instead of being tested once and then cached during the battle.

I'd welcome suggestions of a better name for this."
1905700001,Fix sidebar always showing text for [damage_type]alternative_type= ,newfrenchy83,2024-06-05 18:11:50+00:00,2024-06-07 15:02:33+00:00,{'UI': 1},"When any of the images is missing, a text description is shown as a fallback.
The bug being fixed is that the search for the secondary PNGs used the basename
with neither the directory nor the "".png"".

The existence of the files controls a single conditional block, but was using
three bools with two dedicated to single files and one shared between all the
alternate files. This changes it to a single bool shared between all files for
clarity."
1905585346,replace deprecated CURLOPT_PROTOCOLS with CURLOPT_PROTOCOLS_STR,babaissarkar,2024-06-05 16:59:19+00:00,2024-06-08 08:45:06+00:00,{'Postponed': 1},"According to [Curl Docs](https://curl.se/libcurl/c/CURLOPT_PROTOCOLS.html), CURLOPT_PROTOCOLS is deprecated with `curl_easy_setopt()`."
1904047810,EI S10: reduce difficulty on Easy/Normal,Dalas121,2024-06-05 01:15:55+00:00,2024-06-09 15:29:45+00:00,"{'Backport': 1, 'Campaign EI': 1}","https://www.reddit.com/r/wesnoth/comments/1d6a3e7/eastern_invasion_is_much_better_but_still_bad/

EI's S10 is overly hard on Normal, and especially on Easy (which is intended to be a very accessible difficulty).  This PR increases the available gold and adds several villages, which aid in both defense and upkeep.  This PR also drastically reduces the number of orcs on lower difficulties."
1903815105,GUI2/Game Load: Apply filter when changing directory,stevecotton,2024-06-04 21:58:40+00:00,2024-07-02 14:02:26+00:00,"{'Backport': 1, 'UI': 1}","When the user types something into the filter box and then changes to a different version, apply the filter immediately instead of showing the full list of files.

The drop-down to switch between directories is hidden unless savegames from other versions are detected. The button will appear at the bottom-left in master, and at the top of the dialog in 1.18.

It's a trivial bug, but still worth backporting IMO."
1902306049,Title Screen Redesign,babaissarkar,2024-06-04 07:24:40+00:00,2024-07-16 07:37:57+00:00,"{'Graphics': 1, 'UI': 1, 'Schema': 1}","Resolves #4531 
Related issue #8951

Redesign of the Title screen based on @Dalas121 's proposal https://github.com/wesnoth/wesnoth/issues/4531#issuecomment-2133921535.

Note: This PR's scope is limited to the title screen only. If I decide to redo the UI (the various dialogs and controls), that will be done in another PR.

![Screenshot from 2024-07-16 09-18-34](https://github.com/user-attachments/assets/bdc55834-c987-4749-854b-f4ba3377a54b)

**Note:**
The previous theme still exists and default as of this PR. To use the new theme, you'll need to switch to the `modern` theme using **Preferences -> Display -> UI Theme** and click **Apply**.
"
1901292805,"Fix ""span"" regex",soliton-,2024-06-03 16:55:00+00:00,2024-06-12 17:52:50+00:00,{'WML Tools': 1},"This disallows matching ""0-11-2"" and ""1,"" for example. It also avoids an exponential backtracking issue which could make this regex very slow."
1899734239,EI S10: specify that Owaec can recruit,Dalas121,2024-06-02 22:28:31+00:00,2024-06-05 01:01:36+00:00,"{'Backport': 1, 'Campaign EI': 1}","https://www.reddit.com/r/wesnoth/comments/1d6a3e7/eastern_invasion_is_much_better_but_still_bad/?rdt=58522

Owaec has a leader icon, but it's not made explicit that he can recruit units. In most scenarios that doesn't matter, but in S10 he becomes isolated from Gweddry and must recruit to survive.

Note that there's already a `[show_objectives][/show_objectives]` when `orcs_attacking` is set."
1899500853,Fix the whitespace error on 1.18,stevecotton,2024-06-02 11:36:11+00:00,2024-06-02 13:15:29+00:00,{'Campaign EI': 1},"@Dalas121 when a PR is reporting errors, please fix them before merging"
1899500798,Fix the whitespace error on master,stevecotton,2024-06-02 11:36:00+00:00,2024-06-02 13:15:22+00:00,{'Campaign EI': 1},"@Dalas121 when a PR is reporting errors, please fix them before merging"
1899309206,"EI: use ""bonus objective"" instead of ""optional objective""",Dalas121,2024-06-01 22:54:09+00:00,2024-06-01 22:57:19+00:00,{'Campaign EI': 1},"""optional"" may imply that the scenario will be completed once this objective is finished, which is not accurate."
1899233128, Fix [has_attack]type= cause infinite recursion when called from [damage_type] which concerns the filtered attack.,newfrenchy83,2024-06-01 18:39:49+00:00,2024-06-13 18:13:54+00:00,"{'Unit Tests': 1, 'Units': 1}","When for example we have [damage_type][filter_self][has_attack]type=pierce applied to one or any pierce type attack and the unit does not have an unaffected pierce attack, the change in type triggers an infinite recursion.

this PR fixes the problem in the same way as for [filter_weapon]"
1899232836, Fix [has_attack]type= cause infinite recursion when called from [damage_type] which concerns the filtered attack.[1.18],newfrenchy83,2024-06-01 18:39:01+00:00,2024-06-13 18:14:22+00:00,"{'Unit Tests': 1, 'Units': 1}","When for example we have [damage_type][filter_self][has_attack]type=pierce applied to one or any pierce type attack and the unit does not have an unaffected pierce attack, the change in type triggers an infinite recursion.

this PR fixes the problem in the same way as for [filter_weapon]

Fix https://github.com/wesnoth/wesnoth/issues/8940"
1899185758,fix show error in report,newfrenchy83,2024-06-01 16:26:49+00:00,2024-06-03 15:15:18+00:00,{'Units': 1},"When a [damage_type] without alternative_type is used,un """" value is added to set and """", "" + string_table[""type_"" + alt_t]"" will be added in report.cpp

It will have then a unknow type showed in report"
1899174233,fix [has_attack] can cause infinite recursion in weapon special[1.18],newfrenchy83,2024-06-01 15:55:36+00:00,2024-06-01 17:53:21+00:00,"{'Unit Tests': 1, 'Units': 1}","Fix [#8939 issues/8939](https://github.com/wesnoth/wesnoth/issues/8940)

It is not ideal because check repeated one time, but recursion is not infinite."
1899171678,fix [has_attack] can cause infinite recursion in weapon special,newfrenchy83,2024-06-01 15:47:41+00:00,2024-06-01 17:53:34+00:00,"{'Unit Tests': 1, 'Units': 1}","
I is not ideal because  check repeated one time, but recursion is not infinite."
1898774112,"EI: use fancy script for ""Part II"" ""Part III"" storytext",Dalas121,2024-06-01 00:08:07+00:00,2024-06-05 01:03:40+00:00,{'Campaign EI': 1},"In add-on form, EI used images to display ""Part II"" and ""Part III"".  For translation reasons this got replaced with ugly title_text when the add-on went mainline.

This PR once again makes the ""Part II"" ""Part III"" storytext more fancy, while maintaining translatability."
1898166091,Add [part]text_alignment= to schema,sevu,2024-05-31 15:14:06+00:00,2024-05-31 23:07:14+00:00,{'Schema': 1},
1897175695,Back-port vcpkg base-line,Wedge009,2024-05-31 04:59:38+00:00,2024-05-31 14:35:04+00:00,"{'Windows': 1, 'Building': 1, 'Stable 1.18': 1}",I was not able to build current 1.18 branch on MSVC without this. Also means master and 1.18 use same vcpkg base-line again.
1896631616,Doing [filter_attack/weapon]type= pick type who doing more damage only,newfrenchy83,2024-05-30 18:58:56+00:00,2025-02-01 16:36:55+00:00,"{'AI': 1, 'Unit Tests': 1, 'UI': 1, 'Units': 1, 'Lua API': 1, 'WFL': 1, 'Schema': 1}",Fix (https://github.com/wesnoth/wesnoth/issues/8585)
1894191459,Use same default id in [remove_unit_overlay] as [unit_overlay],soliton-,2024-05-29 15:42:58+00:00,2024-06-13 16:02:05+00:00,{'Lua API': 1},Closes #7896.
1893338586,Implement table sorting without tablesorter.js,soliton-,2024-05-29 08:25:50+00:00,2024-06-03 15:08:33+00:00,{'WML Tools': 1},This allows getting rid of a bunch of dependencies for minimal own code.
1892368184,[MP][Hornshark Island] Fix mudcrawlers after #8837,spixi,2024-05-28 17:39:37+00:00,2024-08-03 16:10:37+00:00,{'MP': 1},"This commit restores the pre-#8837 defenses of the mudcrawlers in 2p Hornshark Island by adding a new ""hemerophile"" trait, which works as an opposite of the ""feral"" trait.
Movement is not affected as all swamp hexes in the map are also villages."
1891033315,Refactor the preferences into a proper singleton.,Pentarctagon,2024-05-28 04:42:59+00:00,2024-06-09 16:34:10+00:00,"{'macOS': 1, 'AI': 1, 'UI': 1, 'Editor': 1, 'Units': 1, 'Lua API': 1, 'Add-ons': 1, 'Building': 1, 'Help': 1, 'Terrain': 1, 'Achievements': 1}","The current preferences handling is a mess:
* it's essentially a global config object that anything can modify in any way the caller wants, which is managed across multiple source files which have their own oddities and interdependencies.
* the general preferences has its own bit of SDL event handling and while I get the idea behind `events::sdl_handler` there's no reason to have SDL events handled in the preferences instead of just calling the relevant preferences setter for each event when it happens.
* the general preferences is where most of the preferences are handled and has its `base_manager` struct, which is part of the `manager` struct in the game preferences, which is then implicitly initialized as part of game_launcher's constructor.
* the editor preferences are the only preferences in a sub-namespace `preferences::editor` while all other preferences are just in the `preferences` namespace.
* the display, editor, and lobby preferences are all dependent on including the game preferences, the credentials are dependent on including the general preferences (but not the game preferences), the game preferences are dependent on including the general preferences, and the advanced preferences are entirely their own thing which is dependent on none of the other preference functionality and manages its own singleton.
* nothing checks whether the preferences file has actually been loaded before allowing values to be read from or written to the preferences config - if you attempt to get a value too early in wesnoth's initialization it will silently just give you whatever the default value for that preference happens to be.

With this there is instead a single access point (with exceptions handled via friend functions/classes), all predefined preferences are accessed via their own setter/getter, and all mainline preferences are defined in a single file (preference_list.hpp) so it's easily findable what preferences exist and where they're used. Having the list of all mainline preferences listed out also allows the lua preferences API to provide that full list rather than just the list of the preferences that have been set so far. Also it now checks for whether the location of the preferences file is known before attempting to load the preferences file and asserts if someone attempts to use the preferences too early.

---

@CelticMinstrel I added you as a reviewer for the lua_preferences changes."
1889187802,Don't translate links in About dialogue,Wedge009,2024-05-27 01:16:22+00:00,2024-05-27 01:27:34+00:00,"{'Translations': 1, 'UI': 1}",
1888995879,Allow [experimental_ability(_active)]apply_to= to check damage types in abilities [resistance],newfrenchy83,2024-05-26 15:58:15+00:00,2024-06-07 16:08:44+00:00,"{'Unit Tests': 1, 'WML': 1, 'Units': 1}","Until now apply_to= could only be used to check if the ability used as a weapon applied to 'self|opponent|attacker|defender' but abilities [resistance] which use apply_to= to determine the types of damage concerned remained excluded.

if all the elements of the list to be checked are present in the ability, then it will match, for example if we look for apply_to=arcane, fire in an ability [resistance]apply_to=arcane, fire, cold, it will match even if its list is longer than the one used for the backward check if [resistance]apply_to=arcane, impact, cold, this will not match because 'fire' will be missing."
1888951529,Update changelog,stevecotton,2024-05-26 15:09:03+00:00,2024-05-26 19:52:39+00:00,{'Docs': 1},"Add entries for Git commits that are visible to players or UMC authors, but which don't already have a file in the changelog_entries directory."
1888878243,[1.18] Update the changelog,stevecotton,2024-05-26 11:50:59+00:00,2024-05-26 13:14:13+00:00,"{'Docs': 1, 'Stable 1.18': 1}","Just adding entries for commits that should have had a changelog_entries file, not merging the existing changelog_entries files."
1888664638,add changelog entries,babaissarkar,2024-05-26 03:42:46+00:00,2024-05-26 05:59:38+00:00,{'Docs': 1},"Adds changelog entry files in the changelog_entries folder for PRs #8166, #8390, #8451, #8539, #8737 and #8803."
1888647338,make sure bullets in about dialog use a font that has those characters,babaissarkar,2024-05-26 02:29:24+00:00,2024-05-26 05:59:07+00:00,{'UI': 1},"In some platforms, the bullet characters ✦ (U+2726) and ➤ (U+27A4) used in the About dialog will not be visible unless they are using a font that actually has those characters."
1888645532,set buttons inactive when irrelevant,white-haired-uncle,2024-05-26 02:22:31+00:00,2024-05-26 07:31:29+00:00,{'UI': 1},"Setting visibility::hidden would be consistent with the only other example I could find, the arrows in the help menu.  I think it looks weird to have buttons just disappear completely (except when none would be available), but I'd change it if that's the standard."
1888487712,[1.18] Put the community dialog's strings in the wesnoth-lib domain,stevecotton,2024-05-25 20:22:27+00:00,2024-05-26 02:08:39+00:00,{'UI': 1},"Most of the GUI, including the title screen's ""Community"" button, is already in wesnoth-lib. So making this consistent also means we're only adding one copy of ""Community"" to the .pot files.

Make the whitespace in this file consistent (using tabs)."
1888451163,remove deprecated controller=<number>,gfgtdf,2024-05-25 18:48:28+00:00,2024-05-27 19:13:09+00:00,{'Engine': 1},This was deprecated back in 1.13.1
1888309743,[1.18] gui/language_selection: Rephrase text about becoming a translator,stevecotton,2024-05-25 13:31:28+00:00,2024-05-26 02:09:24+00:00,"{'Enhancement': 1, 'Translations': 1, 'UI': 1}","Backport of the still-in-review #8905 - I hope the current wording will be accepted, and if so, I want the CI to have already run.

The link with details about individual compaigns is useful to players, even if they aren't looking to become translators. So move it upwards.

The text about first-time players seemed confusing to me, as the choice is already limited to languages that the player can read. Reworded it, but after discussion in the PR, neither version was better than just removing it."
1887303577,[backport] WoF: fix Lua type error with cast to number,Jonathan-Kelly,2024-05-24 17:36:08+00:00,2024-05-24 23:35:55+00:00,{'Campaign WoF': 1},Backport of #8773
1887291656,[backport] WoF S11: fix easy win AI exploit,Jonathan-Kelly,2024-05-24 17:26:13+00:00,2024-05-24 23:36:14+00:00,{'Campaign WoF': 1},Backport of #8774
1883503435,improve tooltip placement on sidebar,white-haired-uncle,2024-05-22 23:52:29+00:00,2024-07-30 22:27:27+00:00,"{'Enhancement': 1, 'UI': 1}","In some cases (LotI), some tooltips for items on the right hand panel of the main scenario screen do not fit.  The current algo to place tips just checks to see if the tip will fit above the origin, and if not places it below (which is often a worse choice).  I made a suggestion for improving this at https://forums.wesnoth.org/viewtopic.php?t=57103 where it was recommended that I submit a PR, even though I'm not a programmer, I don't know C++ (or SDL, or...), etc.  So here it is, warts and all.

The first step, changes to init_label(), is a complete mess.  It's clear I have no idea what I'm doing, except I know I'm doing it wrong.  But it does at least allow me to demonstrate the idea.  Basically, the text_width of the tooltip texture is set to 400.  If a tooltip is too ""tall"" to fit (and assuming we can't/won't fix that), one possible choice is to stretch the width until the height fits.  It turns out that this is not so easy to do with text, you can't just assume that the same data will fit in the same area by scaling the width by the same ratio as the overflow in height.  Also, I have no idea how to get the height of the text so I did some really ugly stuff.  It works, but it ain't right and I don't have the skills at this point to do it right.

The second piece, update_label_pos() is pretty straight forward.  Just check that the tip will fit before placing it below the origin, and if not find a better way to place it.  That works.  Obviously I need to remove the debugging lines, but I left them in for now in case they are of use to anyone.

P.S.  I did read CONTRIBUTING.md, but understood about none of it.  "
1882869137,Fix #7478 game crash after reloading a mp game in debug mode,gfgtdf,2024-05-22 16:30:40+00:00,2024-05-25 16:04:13+00:00,{'Engine': 1},"This is not an optiomal fix as it can still crash if can_start_game() returns false, but its clearly am improvment to the situation in #7478 .

This also removes the ""always show mp staging between scenarios in debug mode"" feature, which imo never was that useful anyways."
1882781856,WoF S8: clarify objective notes,Jonathan-Kelly,2024-05-22 15:49:08+00:00,2024-05-26 12:25:15+00:00,{'Campaign WoF': 1},Resolves #8751
1882588998,gui/language_selection: Rephrase text about becoming a translator,stevecotton,2024-05-22 14:16:23+00:00,2024-05-26 02:09:34+00:00,"{'Enhancement': 1, 'Backport': 1, 'Translations': 1, 'UI': 1}","The link with details about individual compaigns is useful to players, even if they aren't looking to become translators. So move it upwards.

The text about first-time players seemed confusing to me, as the choice is already limited to languages that the player can read. Rearrange it to say that people should be familiar with most of the campaigns before considering joining the translation teams.

The current text was added in #8792, and backported to 1.18 after 1.18.0, so this changes text which hasn't yet entered the .pot files. The first paragraph is unchanged - I'm wondering if it should start with ""The"".

![image](https://github.com/wesnoth/wesnoth/assets/101462/8c36f304-ad7a-42f7-b3b8-767cc39f0e9a)"
1882040604,Use type_adv_tree in some filters to support addons adding advancements to existing unit types[1.18],newfrenchy83,2024-05-22 09:44:33+00:00,2024-06-05 09:50:46+00:00,"{'Campaign DiD': 1, 'Campaign EI': 1, 'Campaign HttT': 1, 'Campaign LoW': 1, 'Campaign SotA': 1, 'Campaign UtBS': 1}",i will fix [filter] too specific to type for include unit_type advancement in addons mods
1881568379,Editor enhancements,babaissarkar,2024-05-22 04:26:09+00:00,2024-06-29 16:26:54+00:00,"{'Enhancement': 1, 'Graphics': 1, 'UI': 1, 'Editor': 1, 'Units': 1}","Contains various enhancements mostly to the Time Schedule Editor that I couldn't manage to add in #8066. It also contains a few other things in the Map Editor itself. There are also changes to the Unit Type Editor that are related to the new features in the Schedule Editor. The File Dialog has also been redesigned.

### Map Editor
* Rename `Load Map` to `Load Map/Scenario` (since it can load both), `Edit Scenario` to `Edit Scenario Settings`, `Save Map` to just `Save`.
* Rearrange menu order
* Add icon for the preferences menu item (used the preexisting settings.png icon)
* Open folder correctly at Add-on's scenario directory instead of `editor/scenarios`. (Resolves #8910)
* Show `Save Scenario As` only for Scenarios
* Use the `settings.png` icon for `Preferences` menu item
* Add functionality to ""Loyal"" checkbox (Unit tool -> Place unit -> Right click menu) (Resolves #8445)
* Do not allow maps to be saved in scenarios folder or vice versa (Resolves #8911)
* Unit List moved to Units menu from File menu to reduce some pressure from the latter. (2e1c3f25d95fbb9ae642e79eeafcb5988c0f0bfa)
* Status Table menu item disabled since it does nothing. Should be reenabled once the functionality has been added. (See 2e1c3f25d95fbb9ae642e79eeafcb5988c0f0bfa)
* Improve reload functionality in Editor (F5). Reload happens directly from memory and no temp files are needed. Also, the undo/redo stacks will be preserved. (Resolves #9024)

**Map Mode:**
![Screenshot from 2024-05-25 17-52-50](https://github.com/wesnoth/wesnoth/assets/8469888/abfeeae4-9b96-472e-9abb-3fab82b92c10)

**Scenario Mode:**
![Screenshot from 2024-05-25 17-53-03](https://github.com/wesnoth/wesnoth/assets/8469888/60cd2c95-33f1-4e82-99f0-1c96d1c7c5f3)


### Time Schedule Editor
* Browse buttons now set wesnoth style paths instead of just pasting the absolute path returned by the file dialog
* Change text boxes from inactive to uneditable.
* Code generation improvements
* Add copyright notice to `tod_new_schedule` (missed in #8066)
* Confirmation messages
* New icons for the preview button (2 sets : preview image and preview sound)
* Preview buttons for image and sound files
![Screenshot from 2024-05-24 12-48-36](https://github.com/wesnoth/wesnoth/assets/8469888/a998e393-679a-4cb6-ae4e-fe110f3fa4f1)

### Unit Type Editor
The last four entries above :
* Confirmation messages
* New icons for the preview button (2 sets : preview image and preview sound)

### Add-on menu
* Two new items for (1) opening the select add-on dialog, (2) opening the add-on folder
![Screenshot from 2024-05-25 17-54-24](https://github.com/wesnoth/wesnoth/assets/8469888/78ef436c-a0d0-4ab7-b849-7ebc04db1467)

The open add-on folder option shows a GUI2 file dialog at the add-on's folder which can be used to open any file. If it is a loadable map/scenario it will be opened in the editor, otherwise the OS's default application for that file will be opened.

### File Dialog
* Redesigned with new icons
* New `Open External` button that opens selected file/folder in the platform's default application (independently of what pressing `Open` would do). This could be used to quickly open a folder or preview the file before actually selecting it.
* Extension checking and filename validation. (See https://github.com/wesnoth/wesnoth/issues/8911#issuecomment-2180708634) (Resolves #8911)

![Screenshot from 2024-05-28 11-09-16](https://github.com/wesnoth/wesnoth/assets/8469888/b0cd9ad8-22ae-4f4f-8564-969416098d95)

"
1881408188,Liberty - get The Nameless General achievement to work on dawn,Earth-Cake,2024-05-22 00:44:34+00:00,2024-05-22 04:21:37+00:00,{'Campaign L': 1},Resolving #8701 
1881239081,Schema: add other mp_ keys too,sevu,2024-05-21 21:44:53+00:00,2024-08-03 16:02:05+00:00,{'Schema': 1},"In addition to the mp_village_gold used in mainline, there exist as well:
- mp_fog
- mp_shroud
- mp_village_support

Not covered by this PR: How to specify what is allowed when using a generator? In 
```
[multiplayer]
    scenario_generation=default
    [generator]
        [scenario]
            mp_* = are  allowed here, but not if map_generation=default is used
```"
1881061020,EI: simplify S16 achievement,Dalas121,2024-05-21 19:37:29+00:00,2024-05-22 14:51:02+00:00,"{'Backport': 1, 'Achievements': 1, 'Campaign EI': 1}","The current S16 achievement requires that the player don't recall any units or have any items.

Some items are undroppable, which can make this achievement impossible if you give one to a loyal auto-recalled unit early in the campaign.

This PR alters the achievement to only care about droppable items."
1881026788,EI: remove random traits from S16 townsfolk,Dalas121,2024-05-21 19:12:01+00:00,2024-05-22 14:54:45+00:00,"{'Backport': 1, 'Units': 1, 'Campaign EI': 1}","Fixes #8886

"
1880998563,Use type_adv_tree in some filters to support addons adding advancements to existing unit types,newfrenchy83,2024-05-21 18:50:55+00:00,2024-06-05 09:49:33+00:00,"{'Campaign DM': 1, 'Campaign DiD': 1, 'Campaign EI': 1, 'Campaign HttT': 1, 'Campaign LoW': 1, 'Campaign L': 1, 'Campaign NR': 1, 'Campaign SotA': 1, 'Campaign SotBE': 1, 'Campaign UtBS': 1}",
1880728451,'value' attribute in [experimental_filter_ability(_active)] can have 'default' value,newfrenchy83,2024-05-21 15:49:07+00:00,2024-05-26 11:48:45+00:00,"{'Units': 1, 'Schema': 1}","for answer to an suggestion of @soliton- who think in filter abilitie, value must could check 'default' value of an abilitie/specials directly without have specify this value in filter"
1880714035,EI: Prevent Dacyn from using the Plague Staff,Dalas121,2024-05-21 15:40:17+00:00,2024-05-21 16:14:44+00:00,"{'Bug': 1, 'Backport': 1, 'Campaign EI': 1}",Fixes #8885 (and I'll backport)
1880682541,add a [experimental_remove_specials] tag in [effect] and [experimental_filter_special_active] to [has_attack/filter_weapon],newfrenchy83,2024-05-21 15:21:59+00:00,2024-05-21 15:34:03+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1}","
with this, it is possible to simultaneously check specials with id and type, and/or other attributes for remove_specials effector filter_weapon"
1879614697,about dialog : correctly open the initial tab,babaissarkar,2024-05-21 05:52:52+00:00,2024-05-21 08:32:04+00:00,{'UI': 1},Fix typo that stops the initial tab from opening correctly. (It's opening tab id 0 instead of tab id = `start_page_`)
1878753499,[Campaign][Dead Water] S9: improve event handling of bat units in player side (fixes #8766),spixi,2024-05-20 17:17:06+00:00,2024-09-22 16:36:57+00:00,{'Campaign DW': 1},"This PR adds a dialog, when you enter Caladon's house with a bat to prevent the scenario being too easy."
1877784071,Remove WmlDefineState class disabled-as-comment/string,Wedge009,2024-05-20 07:43:42+00:00,2024-05-21 12:55:09+00:00,{'WML Tools': 1},"Resolves #8867.

As best as I can tell, this class isn't mentioned or used anywhere else. Not sure if these tools are intended to be used from the stable branch - this probably should be back-ported if that's the case."
1877000266,preferences accessor cleanup,Pentarctagon,2024-05-19 03:14:09+00:00,2024-05-22 14:53:37+00:00,{'UI': 1},
1876991778,NR: Minor dialogue tweaks and quality of life improvements,Earth-Cake,2024-05-19 02:26:59+00:00,,{'Campaign NR': 1},"Addresses #8493 , #8499 , #8501 , #8584 and #8586 ."
1876750157,add [filter_wml] to filter_abilities code,newfrenchy83,2024-05-18 13:35:58+00:00,2024-05-21 12:54:44+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1}"," 
adding a sub-filter should make it possible to take into account the sub_tags of the abilities in the checking

use https://github.com/wesnoth/wesnoth/pull/8561/commits/596a64c00c76ddffffbaa7fbb224acc6f486d121 commit like base"
1873920426,More thoroughly search for possible wesnothd executable names,Pentarctagon,2024-05-16 17:03:28+00:00,2024-05-17 16:58:56+00:00,{},
1871195782,Added an explanation of vision to the in-game help,palmenf,2024-05-15 13:19:07+00:00,2024-09-03 07:02:12+00:00,{'Help': 1},"Resolves: [https://github.com/wesnoth/wesnoth/issues/8719](https://github.com/wesnoth/wesnoth/issues/8719)

Added a short explanation of vision to the in-game help. As the text isn't certain to be translated at the moment no .po/.pot files were generated."
1870499199,CI run for updating the German translation on master,stevecotton,2024-05-15 07:47:40+00:00,2024-05-15 10:05:26+00:00,{'Translations': 1},Thanks to Aurelix.
1870488243,CI run for updating the German translation on 1.18,stevecotton,2024-05-15 07:41:18+00:00,2024-05-15 09:35:46+00:00,{'Translations': 1},Thanks to Aurelix.
1865731089,Misc update copyrights changes,Pentarctagon,2024-05-13 05:11:19+00:00,2024-05-22 14:53:22+00:00,{},
1865585729,update macos version used in CI,Pentarctagon,2024-05-13 02:27:58+00:00,2024-05-13 04:15:28+00:00,{},
1865468804,Fix compiler warnings due to missing function prototypes,irydacea,2024-05-12 23:13:47+00:00,2024-05-13 14:24:01+00:00,{'Building': 1},"Introduced in d2b0df99673b9bd871d24d00cacae97e17ae8b10, at least one of the functions is affected on Xcode on macOS."
1865153327,Copyrights for Wyvern images,doofus-01,2024-05-12 04:04:47+00:00,2024-05-12 10:28:55+00:00,{},update copyrights.csv for recent Wyvern graphics update
1862947157,editor: Implement a Show Tool Information toggle option,irydacea,2024-05-09 23:27:26+00:00,2024-08-07 01:15:57+00:00,"{'Enhancement': 1, 'Graphics': 1, 'UI': 1, 'Editor': 1}","This allows permanently hiding the obnoxious help text tooltip that constantly dances between the top and bottom of the screen depending on what you're doing in the editor.

**EDIT 2024-07-31:** @babaissarkar provided new definitive icons for this button replacing the ones shown in this post, [see here](https://github.com/wesnoth/wesnoth/pull/8861#issuecomment-2260433403).

**Toolbar**
<img width=""445"" alt=""Screenshot 2024-05-09 at 19 28 35"" src=""https://github.com/wesnoth/wesnoth/assets/489895/cce44327-7c10-4e5f-ad3a-5c147e7f0f8e"">
**Menu**
<img width=""398"" alt=""Screenshot 2024-05-09 at 19 29 35"" src=""https://github.com/wesnoth/wesnoth/assets/489895/0e0d769e-d9d7-4924-bb03-a3a1e516b7e8"">

Note: the icons provided here are really just a placeholder that's identical to the About button icon used in the main menu. This is probably not ideal because the About icon is also used in the Preferences dialog -- we're breaking a pre-established pattern by reusing the same icon for a completely different action."
1859197610,Don't trigger achievement completion during replays.,Pentarctagon,2024-05-07 23:17:25+00:00,2024-05-07 23:54:50+00:00,{'Lua API': 1},"Fixes #8858

---

Though this also essentially means that all of the functionality for UMC to query achievement status is not replay-safe either. Not sure if it's best to just document that on the wiki vs removing the functionality entirely though."
1859170628,Prevent aswaldan herbs from stacking,Dalas121,2024-05-07 22:52:10+00:00,2024-05-07 22:52:50+00:00,{'Campaign EI': 1},"In ""Ill Humors"", 2 spawn regions for aswaldan herbs overlap, which can result in both spawning on the same hex without any special visual indicator.

Credit to PointMeAtTheDawn."
1857363503,Simplify preferences handling some more,Pentarctagon,2024-05-07 03:53:14+00:00,2024-05-16 14:59:39+00:00,"{'Docs': 1, 'MP': 1, 'Building': 1, 'SCons': 1, 'CMake': 1}",
1855309076,Wyvern portrait and animations,doofus-01,2024-05-06 02:20:06+00:00,2024-05-12 02:43:45+00:00,"{'Graphics': 1, 'Units': 1}","This needs some cleanup before committing, and maybe a few more frames, but it will remove the ""sliding statue"" instances for this unit."
1855069581,add a attack  'alignment' attribute for have specific attack alignment different of unit alignment,newfrenchy83,2024-05-05 16:14:05+00:00,2024-09-23 15:11:46+00:00,"{'Unit Tests': 1, 'UI': 1, 'Units': 1, 'Lua API': 1, 'WFL': 1, 'Schema': 1}",it is almost same what https://github.com/wesnoth/wesnoth/pull/6968 who is rebased with this commit but i add only attribute in [attack] here
1855027562,EI: S10 fix owaec being able to enter the sanctuary,Dalas121,2024-05-05 14:10:37+00:00,2024-05-05 14:13:54+00:00,{'Campaign EI': 1},Fixes #8843
1854767433,EI - change undead variants from 'spider' to 'ant',Earth-Cake,2024-05-04 22:28:37+00:00,2024-05-05 01:49:09+00:00,"{'Units': 1, 'Campaign EI': 1}",Resolving issue #8769 . @Dalas121 
1854709254,Remove special handling of config directory on linux,Pentarctagon,2024-05-04 18:22:04+00:00,2024-05-07 02:57:30+00:00,{'UI': 1},"Instead store the preferences, credentials, and lua command history files in the userdata folder, same as is done on windows and macos.

Also removes another instance of _X11 for #8806"
1854526971,bugfixes for unit type editor,babaissarkar,2024-05-04 10:23:19+00:00,2024-05-12 09:11:28+00:00,"{'UI': 1, 'Editor': 1, 'Units': 1}","1. accept space in unit type id
2. don't write translated string to generated wml (https://github.com/wesnoth/wesnoth/pull/8731#issuecomment-2059282680)
3. add textdomain at the top of the generated file
4. fix bad key in generated attack block

Please let me know if I missed any translatable strings."
1853620294,EI: Add po hints about the plague staff,stevecotton,2024-05-03 15:07:25+00:00,2024-05-03 23:44:39+00:00,{'Campaign EI': 1},"Forward-port of #8802.

(cherry picked from commit 8c83da78e28c54a32f0fc526f5ab38198eb4706b)"
1852991067,Editor Help: grammar correction,Wedge009,2024-05-03 08:18:26+00:00,2024-05-03 11:40:38+00:00,"{'Editor': 1, 'Help': 1}","As a spelling mistake, I think this should be back-ported, but it is a rather long block of text so if others disagree, so be it.

Resolves #8615."
1852990984,Change Delfador's quote date to the start of HttT,Wedge009,2024-05-03 08:18:22+00:00,2024-05-31 03:37:33+00:00,"{'Prose': 1, 'Help': 1}","As requested by @Konrad22.

There's no particular reason why Delfador should say this during HttT, but perhaps it will make the connection to the campaign clearer.

Closes #8365."
1852990903,SoF S6: Remove reference to finding Alanin,Wedge009,2024-05-03 08:18:18+00:00,2024-05-31 03:37:49+00:00,"{'Prose': 1, 'Campaign SoF': 1}","...since he is already present among the dwarves, as highlighted by @doofus-01.

Given this is a bug in the meaning of the text, I think it warrants back-porting to 1.18. However, if others disagree, so be it.

Resolves #8311."
1852514640,"Mudcrawlers better in swamp, worse in buildings",Jonathan-Kelly,2024-05-02 22:48:30+00:00,2024-05-26 17:17:25+00:00,{'Units': 1},Resolves #8823
1852472493,"bi: Fix for ""unknown"" arch issue and enforce the fix",irydacea,2024-05-02 22:04:20+00:00,2024-05-03 11:45:14+00:00,{'Building': 1},"Next time someone attempts to remove Boost.Predef because it looks ""unused"", they will at least cause strict CI builds to fail.

(Discovered while reviewing #8803.)"
1850695056,Add date/time reference to translation hint,stevecotton,2024-05-02 05:04:53+00:00,2024-05-02 06:28:19+00:00,"{'Translations': 1, 'UI': 1, 'Add-ons': 1}","Backport of #8826, fixes #8822

Current implementation of translation::strftime() uses boost. Boost docs do not appear to have a 'current' or 'latest' link, instead only making documentation available by explicit version number.

(cherry picked from commit 5e9260570b3f1401603b294ecd63119d8ca732d1)"
1850479976,Make userdata path setting code easier to read,Pentarctagon,2024-05-02 00:00:38+00:00,2024-05-04 18:11:28+00:00,{'Engine': 1},"Partially in preparation for #8059 and also removes one use of _X11 for #8806

---

Would also like to get rid of the `PREFERENCES_DIR` define and the associated `relative_ok` boolean."
1849819690,allow loading .mask files,Pentarctagon,2024-05-01 14:43:42+00:00,2024-05-01 18:06:22+00:00,"{'Backport': 1, 'Editor': 1}",Fixes #8831
1849173752,NR05a: Vary dialogue to better suit the speaker,Ethan-Nowa,2024-05-01 04:23:56+00:00,2024-09-04 08:35:36+00:00,"{'Prose': 1, 'Campaign NR': 1}","I changed some of the lines in NR The Pursuit to fit better with the different heroes. Tallin, Abhai, Krash. I did not do it for every dialogue.
Addresses issues #8319 and #8772"
1849124968,Tutorial S2: Only trigger comment about the orc if it is still alive,Wedge009,2024-05-01 03:17:28+00:00,2024-05-19 00:54:16+00:00,"{'Backport': 1, 'Campaign Tutorial': 1}","Addresses the final point mentioned in #5544.

The advice about the Elvish Shamans is lost in the scenario where the orc dies during the first attack of Turn 3, but I suppose a player would have been _very_ lucky to be in this situation, plus I think there are still plenty of notes about Shamans as healers elsewhere."
1847023400,Remove version-specific info from xcode projectfile,Pentarctagon,2024-04-30 04:25:25+00:00,2024-05-04 04:39:01+00:00,"{'macOS': 1, 'Building': 1}","Instead set the Apple preferences folder from within the code rather than using -DPREFERENCES_DIR. Remove -DHAS_RELATIVE_LOCALEDIR since that doesn't appear to actually do anything since its only usage is in filesystem_common.cpp, not filesystem.cpp."
1846878679,Add-ons UI: Add date/time reference to translation hint,Wedge009,2024-04-30 01:24:22+00:00,2024-05-02 05:01:54+00:00,"{'Backport': 1, 'Translations': 1, 'UI': 1, 'Add-ons': 1}","Current implementation of translation::strftime() uses boost. Boost docs do not appear to have a 'current' or 'latest' link, instead only making documentation available by explicit version number.

Resolves #8822."
1844784974,fix copyrights.csv for #8764,doofus-01,2024-04-29 02:20:29+00:00,2024-04-29 02:32:23+00:00,{},
1844740969,Remove doxygen comments for GUI2.,Pentarctagon,2024-04-29 01:28:28+00:00,2024-04-30 15:00:46+00:00,"{'Docs': 1, 'UI': 1}","Instead move this documentation over to the wiki under https://wiki.wesnoth.org/Category:GUI_WML_Reference

Fixes #7899"
1844494428,utils.cfg: typo fix in FULL HEAL macro,knyghtmare,2024-04-28 16:25:23+00:00,2024-04-28 18:45:28+00:00,{},
1844002463,add icon to windows installer and uninstaller,babaissarkar,2024-04-27 16:28:59+00:00,2024-04-28 15:57:10+00:00,{'Packaging': 1},"Add icons to the windows installer and uninstaller executable, which are currently using the default icon of NSIS.
This gives more authenticity and branding to the installer/uninstaller, and makes it look a bit more official.
PNG previews : (actual images are ico files)
![icon-installer](https://github.com/wesnoth/wesnoth/assets/8469888/3754819b-1b2a-4752-ace8-e35986a27cd1) ![icon-uninstaller](https://github.com/wesnoth/wesnoth/assets/8469888/275908be-cd0c-443b-b765-a433c2c26da7)
"
1843843394,Units: fix White Horse HP and XP stats,knyghtmare,2024-04-27 07:08:30+00:00,2024-05-15 10:54:53+00:00,{'Units': 1},As pointed out by Celtic Minstrel and hejnewar
1843716691,Add submerge to oasis terrain,Jonathan-Kelly,2024-04-27 02:46:43+00:00,2024-04-28 09:31:45+00:00,{'Terrain': 1},"Follow up to #8783 this makes a unit on an oasis tile visibly sink slightly into its waters, just like with ford terrain."
1843004070,SoF S7: fewer and slower enemy outriders,stevecotton,2024-04-26 14:47:07+00:00,2024-04-26 17:21:08+00:00,{'Campaign SoF': 1},"Backport of #8680.

This is to counteract the swifter and deadlier Elvish Outrider after the 1.18 core unit balance changes.

(cherry picked from commit b3802f44ea1d50364c83e00d207e8dcef04645b4)"
1840725761,Update wesnothd man page,soliton-,2024-04-25 11:59:09+00:00,2024-05-07 07:12:43+00:00,{'Docs': 1},"Closes #8616.
Partially addresses #8622."
1838158602,UI : About dialog,babaissarkar,2024-04-24 07:08:47+00:00,2024-05-21 04:13:32+00:00,"{'Enhancement': 1, 'macOS': 1, 'Graphics': 1, 'UI': 1, 'Building': 1, 'Schema': 1}","Enhances the previous build info dialog into a general purpose ""About"" dialog following the discussions in #8768.

![Screenshot from 2024-04-23 10-58-31](https://github.com/wesnoth/wesnoth/assets/8469888/49b597e7-2ef7-48b1-b00c-bf0092d26929)

![Screenshot from 2024-05-14 06-38-37](https://github.com/wesnoth/wesnoth/assets/8469888/6bd4c2ea-a20a-4743-88df-a16817331d83)

![Screenshot from 2024-05-14 06-40-26](https://github.com/wesnoth/wesnoth/assets/8469888/5871b437-f1ae-4dd6-8eec-6a948aec3936)

![Screenshot from 2024-05-14 06-40-53](https://github.com/wesnoth/wesnoth/assets/8469888/108f2db9-e51e-4ae5-b9a1-55783d38f413)


I've also adjusted the order of the title screen buttons, so that Preferences is now at bottom, just before Quit and Achievements have moved up, a priority change.

![Screenshot from 2024-04-24 12-38-00](https://github.com/wesnoth/wesnoth/assets/8469888/acc73143-c187-4c1c-a5ee-34c9f84c6105)

Buttons now can have a success state which they can use to show a different appearance when the action performed by them succeeds. (https://github.com/wesnoth/wesnoth/pull/8803#issuecomment-2105662305)
"
1836109656,EI: Add po hints for the plague staff,stevecotton,2024-04-23 07:58:43+00:00,2024-05-03 15:05:02+00:00,"{'Prose': 1, 'Campaign EI': 1}","@Dalas121, this was prompted by a question from the German translator, about what context this string appears in. However, AFAICS it's using ""crown"" to refer to the top of the head of 4 kinds of animals, including spiders and scorpions."
1836042478,Only return info of known terrain,soliton-,2024-04-23 07:16:02+00:00,2024-04-23 11:29:20+00:00,{'Lua API': 1},
1836021026,Remove history expansion,soliton-,2024-04-23 07:01:30+00:00,2024-04-23 20:59:42+00:00,{'UI': 1},It's rarely useful and just gets in the way. Fixes #3328.
1835882072,SP campaigns: rename beginner difficulty level,nemaara,2024-04-23 05:11:17+00:00,2024-08-22 02:52:46+00:00,"{'Campaign AToTB': 1, 'Campaign TSG': 1, 'Campaign WoF': 1}","As the title says. We have enough campaign difficulties and as @Dalas121 rightly pointed out, I doubt players are going to want to stoop to a difficulty level they deem as ""beginner"". Having Easy/Normal take the place of the older lower difficulty levels will probably make people feel better about themselves. "
1835451560,Show the oasis in help without needing a hacky aliasof,stevecotton,2024-04-22 21:17:03+00:00,2024-05-01 10:33:01+00:00,"{'Enhancement': 1, 'Editor': 1, 'Help': 1, 'Terrain': 1}","Help shows terrain types in the section for their default_base
    
Instead of the aliasing hack that the oasis terrain used to use, have the help topic generator reuse the editor_default_base as a hint that it should be included in that section.
    
The terrain_type class gets a new boolean method, and more documentation. There's a couple of refactors to use the new method in old code too."
1835134408,Unit test cumulative resistance calculations,stevecotton,2024-04-22 17:43:59+00:00,2024-04-24 12:52:23+00:00,{'Unit Tests': 1},"Forward-port and modification of #8730. The first commit is the same as the 1.18 version, the second (for `max_value`) has changed.

These tests clarify what ""cumulative"" means for non-leadership abilities, which since Wesnoth 1.1.3 doesn't seem to fit the English word.

For cumulative abilities, if the base value from the unit is higher that the ability's value, then the base value is used instead. In the case of a Skeleton with 40% base resistance, ""cumulative=yes"" is equivalent to ""value,cumulative=40,no"".

In all of these cases, a single ability's `value` is used; `cumulative` doesn't mean that the `value`s from multiple abilities interact.

In 1.19 since 82499d07857885263d2617560b4754c20e34f16f, having multiple abilities with a `max_value` results in the minimum of those limits being used, regardless of whether `cumulative` was set. On 1.18, for `cumulative` abilities the `max_value` attributes were added together."
1835104241,[1.18] Fix a warning in the sdl2 conftest,stevecotton,2024-04-22 17:25:49+00:00,2024-04-22 19:49:59+00:00,{},"The argv variable was unused. The build still succeeded, but GCC emited a warning about it.

(cherry picked from commit c7acbd243a7e3f6e5d2ed69953759461adf75fb7)"
1835068452,[1.18] Avoid invalid pointer access on recall,stevecotton,2024-04-22 17:05:59+00:00,2024-04-22 18:58:45+00:00,{'UI': 1},"Backport of #8788, fixes #8778.

(cherry picked from commit 5ec648a1b2b8675a2a6bb7dcb8b50404b7d2c800)"
1834643588,Fix a warning in the sdl2 conftest,stevecotton,2024-04-22 13:44:54+00:00,2024-04-22 17:24:11+00:00,{},"The argv variable was unused. The build still succeeded, but GCC emited a warning about it."
1834295793,Add more information to the Language selection UI,irydacea,2024-04-22 10:38:38+00:00,2024-04-24 13:45:13+00:00,"{'Enhancement': 1, 'Translations': 1, 'UI': 1}","This pull request brings a few minor additions to the improved Language selection UI from #7638:

1. Adds text requested by @Pentarctagon to clarify that the percentages shown only correspond to core textdomains, which also includes a pointer to <https://gettext.wesnoth.org/>.
   (Because I know someone will inevitably complain that the explanation isn't exhaustive... There is hardly any point in mentioning every single textdomain counted as ""core"" in this dialog. If someone really, *really* wants to know, they can either use gettext.wesnoth.org or ask the team about it on Discord/IRC. Listing every single textdomain counted as core here would require writing many words for no tangible gain.)
2. Moves the Show All checkbox from the main panel to the bottom left corner of the dialog to save space in the former and make it more obviously connected to the listbox it affects.
3. Reduces the word count in the Show All checkbox while keeping the meaning clear, to make the ""oh no we've run out of space let's add a horizontal scrollbar to the whole dialog"" case less likely to happen in translations.
4. Shows locale codes under each language name **only** if debug mode is enabled, to make it easier to identify languages for debugging purposes (mainly for the Wesnoth development team, really).

### Debug mode off
<img width=""886"" alt=""Screenshot 2024-04-22 at 06 27 37"" src=""https://github.com/wesnoth/wesnoth/assets/489895/58a623f5-10f7-49df-b2cc-87d50a9b6c3e"">

### Debug mode on
<img width=""886"" alt=""Screenshot 2024-04-22 at 06 27 27"" src=""https://github.com/wesnoth/wesnoth/assets/489895/1a593132-19f5-482c-a660-0c6efc6f9f72"">
"
1833679973,Add a button to the build info dialog to rerun the migrator.,Pentarctagon,2024-04-22 03:35:19+00:00,2024-04-27 05:45:41+00:00,"{'macOS': 1, 'UI': 1, 'Building': 1}","Add-ons: checks for any that exist in the chosen other version but not in the current version.
Preferences: adds attributes that don't exist from the chosen other version's preferences that aren't in the current version's preferences. for attributes that exist in both, use whichever was modified most recently.
Credentials: skip on rerun.

Fixes #7936

---

Not tested yet."
1833675643,use to/from_chars in attribute_value and lexical_cast,gfgtdf,2024-04-22 03:29:25+00:00,2024-12-08 21:28:11+00:00,"{'macOS': 1, 'Building': 1, 'SCons': 1}","This makes attribute_value and lexical_cast use the ""new"" to/from_chars api.

Its main advantages are:
- It's guaranteed to be locale independent, hopefully fixing all cases of #3945 and similar
- It fixes some cases config serialization, in particular the test
```
	cfg[""x""] = ""9.87654321"";
	BOOST_CHECK_EQUAL(cfg[""x""], 9.87654321);
```
- Previously the lexical_cast implementation used exception
  handling for invalid formats (catching std::invalid_argument)
  which made noise during debugging (and is also slower if it
  is not optimized out).
- It's faster


So far afaik the only compiler which has a complete and proper to/from_chars implementation is msvc, gccs implementation of from_chars sometimes uses strtod under the hood and clang simply hasn't implemented from_chars for floating point numbers yet at all (actually the upcomig clang 20 will have it). Luckily for us, there is now also boost::charconv that can be used. So this raises to minimum build requirement to have at least one of:

- msvc 2019 update 5
- gcc 11
- clang 14 (i have added a fallback implementation of from_chars for this case, that doesn't support all of its features, and is probably certainly not as fast as the boost version, but supports the features that we use from it)
- boost 1.85
 
Since in particular the gcc implementation isn't that good (at least it on gcc11), boost charconv is the preferred implementation that is used if available.
TODO:

- [x] the macosx ci buildfails, , so it will need to be updated , preferably to use boost 1.85
- [x] the steam runtime ci build fails, , so it will need to be updated , preferably to use boost 1.85
- [x] The test also haven't been updated yet for the changes in lexical_cast
- [ ] makefile updates for boost charconv
- [x] figure out when exactly `-lquadmath`is needed
- [x] commits cleanup

"
1833431461,Avoid invalid pointer access on recall,soliton-,2024-04-21 18:52:24+00:00,2024-04-22 17:03:12+00:00,"{'Backport': 1, 'UI': 1}",Should fix #8778.
1833371295,Reject [terrain] with unknown terrain type,ProditorMagnus,2024-04-21 15:47:49+00:00,2024-05-21 09:34:42+00:00,{'Lua API': 1},closes #8786
1832937043,Add shallow water to oasis like ford terrain,Jonathan-Kelly,2024-04-20 16:11:35+00:00,2024-04-24 02:39:07+00:00,{'Terrain': 1},Closes  #8753
1832896578,S16: fix li'sar missing her unrenamable=yes,knyghtmare,2024-04-20 13:58:21+00:00,2024-04-27 06:53:23+00:00,"{'Backport': 1, 'Campaign HttT': 1}",Closes #8781 
1832891228,[objectives.lua] improve clarity of error message,knyghtmare,2024-04-20 13:39:45+00:00,2024-08-03 16:24:41+00:00,{'Lua API': 1},"Current message:
```
Unknown Condition, ignoring
```
This really does not tell me anything of where I might have messed up and can be even more confusing if I have custom lua from the campaign or an add-on being used in the same scenario.

The edited one tells me where I actually have to look for the error message and fix it."
1830841477,Restore Windows CI,Wedge009,2024-04-19 05:30:00+00:00,2024-04-20 08:05:19+00:00,"{'Backport': 1, 'Windows': 1, 'CI': 1}",Closes #7523 (again).
1829838541,WoF S11: fix easy win AI exploit,Jonathan-Kelly,2024-04-18 15:35:53+00:00,2024-05-24 17:12:19+00:00,"{'Backport': 1, 'Campaign WoF': 1}","Fixes #8759

This should be back portable."
1827476825,WoF: fix Lua type error with cast to number,Jonathan-Kelly,2024-04-17 13:47:18+00:00,2024-05-24 17:30:01+00:00,"{'Backport': 1, 'Campaign WoF': 1}","Lua was getting this variable without being told it is a number rather than a string. On some systems it is interpreted as a string which breaks the monster spawner code and throws Lua error messages onto the player's screen.

This is a critical fix which needs a back port for 1.18.1."
1825834844,"Add a ""Teleport Unit (Debug!)"" option to debug menu",Pentarctagon,2024-04-16 16:53:24+00:00,2024-04-18 23:24:56+00:00,"{'UI': 1, 'Input': 1}","Code taken from #7961 by TheHitsy

Fixes #5649"
1823596772, Change the list check from [damage_type] to a system that takes into account the opponent's sensitivity(2nd try),newfrenchy83,2024-04-15 15:43:28+00:00,2024-04-21 11:05:03+00:00,"{'Graphics': 1, 'Unit Tests': 1, 'Units': 1}","If two [damage_type]altenative_type= are used with two different types, the chosen type displayed in the pre-combat window will be the one to which the opponent will be most vulnerable, and if he is more vulnerable to that one rather than to the type d originally, this is the one that will be used.

On the other hand, in this case, report will not display alternative_type because there is no opponent to check

"
1822329218,1.19 - Brush up minor characters ,doofus-01,2024-04-15 03:10:28+00:00,2024-04-29 01:53:11+00:00,"{'Graphics': 1, 'Units': 1, 'Campaign HttT': 1, 'Campaign TRoW': 1, 'Campaign TSG': 1}","Inspired by #8734, this is to complete some minor characters, rather than discard them.  Maybe they can be hooks for UMC to develop further.  For now it's just the Sea Orc from HttT (not totally finished) but I think there will be others.

I'm not going to make a checklist because I don't know yet what all this covers.  I'd be open to suggestions, if anyone has any."
1822170369,Add the Rogue Mage line to core,Dalas121,2024-04-14 23:32:10+00:00,2024-05-01 19:49:31+00:00,"{'Enhancement': 1, 'Graphics': 1, 'Units': 1, 'Campaign EI': 1, 'Campaign L': 1}","Liberty contains 3 custom outlaws: the Rogue Mage, Shadow Mage, and Shadow Lord (and TDG has the related ""Arcane Enforcer""). Different variants of these units are also used in EI and TDG, as well as (possibly) the upcoming TRoW and HttT projects.

With multiple mainline campaigns using these units (and all with different variations/stats, which is my fault), I suggest deciding on stats and moving the Rogue Mage line to core to standardize the units and make them easier for campaigns/UMC to use.

If adding these to core is acceptable, here are some things that need to be handled:
- [ ] Stats Balancing <details><summary>(this is a summary/detail HTML element; click me for details)</summary><br>With the proposed stats I intend these to be fragile mixed fighters, with good damage at both melee and ranged but very low hp. Nightstalks is primarily for thematic reasons; after all, they're called ""Shadow"" Mages and wear all black. I felt that Liberty's leadership ability didn't really fit the unit's fantasy.<br><br>Liminal, nightstalks, magical, and ""astral"" all on the same unit is pretty extreme, and some of them might need to be changed. But I do feel the Shadow Mage's and (separately) the Shadow Lord's unusual standing animations need to be reflected in their stats in some way.<br><br>One more vanilla alternative could be to remove magical from the L2 Shadow Mage's melee and give it an alternate damage type instead. Then remove the ""astral"" special altogether and give the L3 Shadow Mage magical on melee. Damage of both melees would need to be increased.</details>
- [ ] The Rogue Mage sprites are poor, in my opinion.

- [ ] The male Rogue Mage, Shadow Mage, and Shadow Lord are missing several animations (and the female ones aren't incredible either).

- [ ] None of these units have portraits.

- [x] Liberty may need rebalancing. I'm confident EI and TDG aren't issues.

- [ ] UMC likely have their own versions of these units, which may cause conflicts.

- [ ] Copyright.

- [ ] I may have made mistakes/bugs in the PR."
1822007105,EI S12: prevent ogres from saying the final goodbye,Dalas121,2024-04-14 15:43:33+00:00,2024-04-14 19:07:20+00:00,{'Campaign EI': 1},Fixes #8746
1822003959,NR: remove unused unit: Cave Serpent,knyghtmare,2024-04-14 15:34:23+00:00,2024-04-14 16:54:31+00:00,"{'Units': 1, 'Campaign NR': 1}","Part of #8734
**Note**: I searched all NR scenario files with ""search and replace"" in VS Code and apparently this unit was not even being used in NR."
1821672262,Consistently sort damage types,soliton-,2024-04-13 23:58:01+00:00,2024-04-22 17:38:30+00:00,{'Units': 1},The double sorting before should have used stable_sort. Now we sort just the types with the highest frequency count.
1821550773,"EI: fix ""mak-dak'an"" typo",Dalas121,2024-04-13 18:01:09+00:00,2024-04-13 22:01:40+00:00,"{'Bug': 1, 'Campaign EI': 1}",Fixes #8744
1821448666,Nerf Elvish Shyde/Enchantress/Sylph/Sharpshooter/Avenger in 1.19,ForestDragon-wesnoth,2024-04-13 13:03:12+00:00,2024-04-27 11:56:50+00:00,{'Units': 1},Seeing the very positive reaction from the community to my suggestions in issue #8741 I decided to move forward with this issue and open a PR with my changes implemented.
1821435600,[1.18]Fix EI: Plague Staff Doesn't Gain Arcane Damage When Equipped After Holy Amulet,newfrenchy83,2024-04-13 12:15:15+00:00,2024-04-24 10:51:45+00:00,{'Campaign EI': 1},Fix https://github.com/wesnoth/wesnoth/issues/8745 in using ability instead of specials
1821427086,Fix EI: Plague Staff Doesn't Gain Arcane Damage When Equipped After Holy Amulet,newfrenchy83,2024-04-13 11:43:52+00:00,2024-04-24 08:41:09+00:00,{'Campaign EI': 1},Fix https://github.com/wesnoth/wesnoth/issues/8745 in using ability instead of specials
1820563832,Add a Community button to the title screen.,Pentarctagon,2024-04-12 17:08:41+00:00,2024-04-15 21:50:42+00:00,"{'macOS': 1, 'UI': 1, 'Services': 1, 'Building': 1, 'Achievements': 1}","This opens a dialog with links to the forums, discord, etc, plus a donate button that links to Wesnoth's SPI page.

---

I'm not really sure if IRC should be included or how to include it, just since presumably it would only work if the player already has an IRC client installed.

![one](https://github.com/wesnoth/wesnoth/assets/3030250/00e3e406-c0fc-44ef-94aa-c87e23fadb02)
![two](https://github.com/wesnoth/wesnoth/assets/3030250/c25624a9-a391-46f2-af7a-2037ae2401b1)
"
1820313145,Actually run the SDL2 test to check the version,soliton-,2024-04-12 14:35:42+00:00,2024-04-18 04:43:21+00:00,"{'Building': 1, 'SCons': 1}",
1820038970,[1.18]return optional<std::string> instead of vector<std::string> for static damage_type_list,newfrenchy83,2024-04-12 11:56:07+00:00,2024-04-12 12:22:24+00:00,{'Units': 1},"
this code should be more readable without affecting the operation of damage_type"
1820021301,return optional<std::string> instead of vector<std::string> for static damage_type_list,newfrenchy83,2024-04-12 11:47:45+00:00,2024-04-13 05:50:22+00:00,{'Units': 1},"
this code should be more readable without affecting the operation of damage_type"
1819057654,sylph and enchantress attack description changes (cosmetic),babaissarkar,2024-04-12 02:12:30+00:00,2024-04-12 15:10:32+00:00,{'Units': 1},"Elvish Sylph's gossamer and Enchantress' entangle attacks' user visible name is changed to _ethereal web_ to make them more consistent with the new lore introduced in Wesnoth 1.16. (Issue #8583)

Enchantress' attack icon is also changed to make it consistent with the description.

All changes are purely cosmetic and should not break any existing mainline or UMC content."
1817879508,Make log_file_suffix dependency explicit,soliton-,2024-04-11 12:24:53+00:00,2024-04-12 09:44:19+00:00,{'Engine': 1},
1817239647,reduce the number of translatable strings in the unit type editor,babaissarkar,2024-04-11 04:37:39+00:00,2024-09-05 11:20:56+00:00,"{'Translations': 1, 'UI': 1, 'Editor': 1}",Resolves #8677.
1817162523,[1.18] Unit test cumulative resistance with a base value,stevecotton,2024-04-11 02:46:05+00:00,2024-04-22 17:28:24+00:00,{'Unit Tests': 1},"These tests clarify what ""cumulative"" means for non-leadership abilites, which since Wesnoth 1.1.3 doesn't seem to fit the English word.

For cumulative abilities, if the base value from the unit is higher that the ability's value, then the base value is used instead. In the case of a Skeleton with 40% base resistance, ""cumulative=yes"" is equivalent to ""value,cumulative=40,no"".

In all of these cases, a single ability's value is used; ""cumulative"" doesn't mean that the values from multiple abilities interact.

This is all when using value=, not when using add= or sub=."
1817090373,Remove translation mark from image paths,Wedge009,2024-04-11 01:22:04+00:00,2024-04-11 02:04:21+00:00,"{'Translations': 1, 'UI': 1}",I'm assuming these translation marks weren't intended.
1816059399,Check log file actually exists before enabling Log File button,Wedge009,2024-04-10 13:19:32+00:00,2024-04-14 06:56:02+00:00,"{'Backport': 1, 'UI': 1}",Resolves #8691
1816031170,WIP: Unify the code paths in effect::effect,stevecotton,2024-04-10 13:05:18+00:00,,{'Units': 1},"@newfrenchy83 this is just a draft at the moment, but it comes from trying to work out why leadership has a different path through effect::effect, and mainly trying to work out how to convert the two paths into having more code in common with each other.

Current commit is just working out that nothing uses the location returned by get_extremum.

The calculation of the location seemed to be wrong for getting the lowest value, because it used `comp` after flipping the sign to get an absolute value. So I tested whether it was used at all, and it isn't; this is the beginning of removing unnecessary code.

WIP: the aim here is to work out the code paths in effect::effect can be unified between leadership (which uses is_cumulative == true), and other abilities (which use is_cumulative == false).

WIP: decide whether this is worth a stand-alone PR, without doing the cleanup of changing all the callers so that the half_pair struct can be deleted. The full list of callers seems to be:

```
actions/attack.cpp: rounds = weapon->get_specials_and_abilities(""berserk"").highest(""value"", 1).first;
actions/attack.cpp: rounds = weapon->get_specials(""berserk"").highest(""value"", 1).first;
tod_manager.cpp: max_list.push_back(illum.highest(""max_value"").first);
units/abilities.cpp: min_attacks = std::max<int>(0, swarm_specials.highest(""swarm_attacks_min"").first);
units/abilities.cpp: max_attacks = std::max<int>(0, swarm_specials.highest(""swarm_attacks_max"", attacks_value).first);
units/types.cpp: resistance_abilities.highest(""max_value"").first
units/unit.cpp: resistance_max_value.highest(""max_value"").first

tod_manager.cpp: min_list.push_back(illum.lowest(""min_value"").first);

units/abilities.cpp: int value_set = is_cumulable ? std::max(list.highest(""value"").first, 0) + std::min(list.lowest(""value"").first, 0) : def;
```"
1815093470,Move knowledge of attack_type out of movetype,stevecotton,2024-04-09 23:51:46+00:00,2024-04-10 22:07:23+00:00,"{'AI': 1, 'WFL': 1}","The movetype data includes vulnerability to damage types, for example `resistance_against(""arcane"")`. There was also a convenience wrapper that took an attack_type, and returned the vulnerability to that attack_type's damage type.

The logic of the wrapper is very basic, and does not use unit.cpp's logic to check whether abilities that change the type are active. Although it gained knowledge of alternative damage types in 3910817cf7, it won't always return the same value as the unit.cpp function does.

The wrapper is now only used in FormulaAI, so let's move the code there, which in effect marks it deprecated."
1815040998,EI: remove duplicate AMLAs,Dalas121,2024-04-09 22:46:54+00:00,2024-04-09 22:47:19+00:00,"{'macOS': 1, 'AI': 1, 'Docs': 1, 'Graphics': 1, 'MP': 1, 'Translations': 1, 'Unit Tests': 1, 'UI': 1, 'WML Tools': 1, 'Editor': 1, 'Units': 1, 'Services': 1, 'Lua API': 1, 'Add-ons': 1, 'Building': 1, 'WFL': 1, 'Packaging': 1, 'Help': 1, 'SCons': 1, 'CMake': 1, 'Input': 1, 'Schema': 1, 'Terrain': 1, 'Achievements': 1, 'Campaign DM': 1, 'Campaign EI': 1, 'Campaign HttT': 1, 'Campaign SotA': 1, 'Campaign Tutorial': 1, 'Campaign UtBS': 1, 'Campaign WoF': 1, 'Campaign WC': 1}","Under some circumstances, units in EI can have their custom AMLAs listed multiple times in the advancement dialog. This PR should fix that issue.

This is a backport PR.

Edit: umm, no, wait, let me delete this"
1814874612,EI: remove duplicate AMLAs,Dalas121,2024-04-09 20:34:14+00:00,2024-04-09 23:46:55+00:00,"{'Backport': 1, 'Campaign EI': 1}","Under some circumstances, units in EI can have their custom AMLAs listed multiple times in the advancement dialog.  This PR should fix that issue.

Also can we backport this?"
1814457516,add min_value to [resistance],newfrenchy83,2024-04-09 16:02:25+00:00,2024-04-11 02:48:41+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1}","If max_value is used to limit the increase in resistance with the ""resistance"" capability there is no equivalent for its reduction.

To be able to add min_value without redoing the ""resistance"" checking for the umpteenth time, I prefer to modify effect:: so that the checking of these two attributes is done at the same time as the other numerical attributes and keep the door open to a possible generalization of the proceed"
1814009311,Fix race condition causing moveto messages to immediately close,stevecotton,2024-04-09 12:11:02+00:00,2024-04-09 17:29:52+00:00,{'UI': 1},"Forward-port of #8717, fixes #8644.

If a mouse click causes a delay and then a message to appear, for example when moving a unit triggers an `[event]name=moveto`, then the message would sometimes flash on screen and then disappear with barely enough time to see which character's portrait was used, let alone to read it.

Although there's already logic to not be triggered by the same mouseclick that caused the unit to move, it had a race condition if the MOUSE_UP happened around the time the the dialog's pre_show() function was running.

(cherry picked from commit 26ead85914c9e7af9e378d583657fef7f68f6821)"
1811146048,Remove gzip/bzip2 (de)compression commandline options,grz0,2024-04-08 02:26:55+00:00,2024-04-10 13:45:01+00:00,{'Docs': 1},"The pull request removes the `--gzip`, ` --gunzip`, `--bzip2`, and `--bunzip2` command line options and related documentation.

These options allow compression and decompression of gzip and bzip2 archives from the command line. Given the widespread availability of third-party compression tools, these options most likely have no real use case. Also, it looks like Windows 11, starting from build 23493, can natively handle gzip and bzip2 files (I didn't test how well it works). 

Resolves #8065"
1811044227,[1.18] Fix race condition causing moveto messages to immediately close,stevecotton,2024-04-07 23:37:32+00:00,2024-04-09 12:07:53+00:00,"{'UI': 1, 'Fwdport': 1}","If a mouse click causes a delay and then a message to appear, for example when moving a unit triggers an `[event]name=moveto`, then the message would sometimes flash on screen and then disappear with barely enough time to see which character's portrait was used, let alone to read it.

Although there's already logic to not be triggered by the same mouseclick that caused the unit to move, it had a race condition if the MOUSE_UP happened around the time the the dialog's pre_show() function was running.

Fixes #8644"
1811031314,EI: preserve XP when Dacyn receives scripted advancements,Dalas121,2024-04-07 22:53:04+00:00,2024-04-09 22:06:39+00:00,"{'Backport': 1, 'Campaign EI': 1}",Resolves #8702
1811028963,EI: reduce Barrow/Pyre Wight vulnerability to arcane,Dalas121,2024-04-07 22:45:33+00:00,2024-04-09 22:07:18+00:00,"{'Backport': 1, 'Units': 1, 'Campaign EI': 1}",EI's Barrow/Pyre Wights still have 50% arcane vulnerability. This PR lowers it to 20%
1810997222,Fix clicking on the sidebar going to the wrong trait,stevecotton,2024-04-07 20:48:19+00:00,2024-04-07 23:20:01+00:00,{'Units': 1},"Forward-port of #8684, going to merge when the CI finishes.

If the first trait of a unit has no name, then clicking on the units (other) trait in the sidebar opened the wrong page in the help.

(cherry picked from commit f9af941f1ec7165ad135cba465717203a4007287)"
1810972559,CI run for a German translation update,stevecotton,2024-04-07 19:57:29+00:00,2024-04-07 22:32:43+00:00,{'Translations': 1},
1810904458,[1.18] CI run for an updated German translation,stevecotton,2024-04-07 16:37:08+00:00,2024-04-07 19:52:20+00:00,{'Translations': 1},
1810680674,Disable the Windows CI builds,stevecotton,2024-04-07 05:49:06+00:00,2024-04-07 10:35:03+00:00,{},"Setting up vcpkg tries to build xz from source, which fails because the entire xz repo has now been made private or taken down. The vcpkg team have been advised not to switch to an alternative repo [1], so for now our Windows builds will always fail.

Turn those builds off, so that we don't get familiar with seeing red status markers on all PR's CI results.

[1] `https://github.com/microsoft/vcpkg/pull/37957` - second comment is the vcpkg team's ""We have been explicitly asked by security folks to not change the upstream [to a different repo] for liblzma at this time."""
1810661558,[1.18] Disable the Windows CI builds,stevecotton,2024-04-07 04:11:54+00:00,2024-04-07 05:47:37+00:00,{},"Setting up vcpkg tries to build xz from source, which fails because the entire xz repo has now been made private or taken down. The vcpkg team have been advised not to switch to an alternative repo [1], so for now our Windows builds will always fail.

Turn those builds off, so that we don't get familiar with seeing red status markers on all PR's CI results.

[1] `https://github.com/microsoft/vcpkg/pull/37957` - second comment is the vcpkg team's ""We have been explicitly asked by security folks to not change the upstream [to a different repo] for liblzma at this time.""

Link is in backticks because I didn't intend this to create noise in the vcpkg PR it linked to (the commit itself does, sadly)."
1810448715,Fix mismatch between what gettext.w.o and wesnoth consider core textdomains,soliton-,2024-04-06 15:28:57+00:00,2024-04-09 19:10:27+00:00,{'Translations': 1},Compare to https://github.com/wesnoth/website/blob/17f8223c38bc40380a89299fb5013a476164d0db/gettext.wesnoth.org/includes/config.php#L45-L54
1810341664,CI run for German translation update,stevecotton,2024-04-06 09:32:44+00:00,2024-04-07 10:35:35+00:00,{'Translations': 1},"s1m0n was in the credits for 1.16, but that was missed when his contributions were copied to master. Fix that, along with adding his latest updates.

The fuzzy flag in -wof probably got readded by mistake when rebasing."
1810313075,CI run for a German translation update,stevecotton,2024-04-06 07:43:06+00:00,2024-04-06 09:27:22+00:00,{'Translations': 1},"s1m0n was in the credits for 1.16, but that was missed when his contributions were copied to master. Fix that, along with adding his latest updates.

The fuzzy flag in -wof probably got readded by mistake when rebasing."
1805962150,Move Dunefolk to the Default era.,Pentarctagon,2024-04-04 02:43:47+00:00,2024-04-11 15:43:41+00:00,{'MP': 1},
1805122341,Hardware unit submerge effect using SDL_RenderGeometry.,Pentarctagon,2024-04-03 16:42:19+00:00,2024-04-11 17:58:56+00:00,"{'Units': 1, 'Building': 1, 'SCons': 1, 'CMake': 1}","Original code from mesilliac in #6826. Made a separate PR for this since the relevant code moved to an entirely separate file and trying to ""properly"" fix the merge conflicts resulting from that isn't worth the time."
1804075448,Ukrainian translators update2 about_i18n.cfg,mavpii,2024-04-03 08:24:35+00:00,2024-04-03 10:50:20+00:00,{},
1803840993,[1.18] Fix clicking on the sidebar going to the wrong trait,stevecotton,2024-04-03 06:15:44+00:00,2024-04-07 06:05:30+00:00,"{'UI': 1, 'Units': 1, 'Help': 1, 'Fwdport': 1}","If the first trait of a unit has no name, then clicking on the units (other) trait in the sidebar opened the wrong page in the help.

Fixes #8635."
1803773561,Document why the Fog Clearer's traits show in help,stevecotton,2024-04-03 05:26:31+00:00,2024-04-07 19:53:34+00:00,"{'Docs': 1, 'Units': 1}","Not mentioned here, but turning on debug mode also affects which units, and therefore which units' traits, are shown in help.

Having looked back into the history while wondering why it was done this way in e9603e6e01, back then we needed a fix that could be backported to 1.14, so couldn't add a new attribute to [unit_type]. The feature request to do it properly is #5139."
1803508576,Back-port of #8594,Wedge009,2024-04-02 23:39:38+00:00,2024-04-03 02:03:39+00:00,"{'UI': 1, 'Campaign WC': 1, 'Stable 1.18': 1}",
1803248441,Ukrainian translators update about_i18n.cfg,Pentarctagon,2024-04-02 19:53:16+00:00,2024-04-02 19:53:27+00:00,{},
1803218916,SoF S7: fewer and slower enemy outriders,Jonathan-Kelly,2024-04-02 19:32:23+00:00,2024-04-26 14:44:24+00:00,"{'Backport': 1, 'Campaign SoF': 1}","This is to counteract the swifter and deadlier Elvish Outrider after the 1.18 core unit balance changes. It reduces the number of Elvish Outriders at the beginning of the scenario from 5 to 4 and ensures none of them has the  `quick` trait.

This should get back ported to 1.18.

Closes #8589"
1802440242,Clearer documentation for the ATTACK_AND_VALIDATE macro,stevecotton,2024-04-02 12:49:51+00:00,2024-04-08 22:28:23+00:00,"{'Docs': 1, 'Unit Tests': 1}",@newfrenchy83 please would you review whether this PR is a good change?
1802208596,"wmlxgettext: Fix ""fix invalid escape sequence""",stevecotton,2024-04-02 10:50:47+00:00,2024-04-02 14:12:23+00:00,"{'Translations': 1, 'WML Tools': 1}","Forward-port of #8672, will merge when the CI run finishes.

The original code was probably meant to strip trailing whitespace, which turned out to be a bug when 4be9aa85849010e93a9a3b0f0701d0630e7b9368 fixed the buggy regexp so that it started working. That has now been removed.

Fixed handling of multiline plural strings, which was broken too.

One feature has been left unimplemented, and will cause wmlxgettext to error out. For ""long bracketed"" strings, Lua allows the contents to start with a newline, which is automatically stripped from the resulting string. Trying to understand the original purpose lead me to this feature of Lua strings which we don't use in Wesnoth; and I finally concluded that, if someone wants to use that feature, it can be their problem to implement it.

This fixes commit 4be9aa85849010e93a9a3b0f0701d0630e7b9368.

(cherry picked from commit e4239634e5094410478fa6b1d91df3be4ddf1caf)"
1801492069,EI 12_Evacuation.cfg: fix Dacyn's halo not flickering,Dalas121,2024-04-02 01:08:16+00:00,2024-04-02 03:48:48+00:00,{'Campaign EI': 1},"The ""illuminates"" ability was recently changed to create its own halo, instead of relying on the unit's halo. This caused issues in a section of EI where Dacyn (a mage of light) is supposed to have a flickering halo. This PR fixes that EI bug.

Fixes issue #8675"
1799767243,remove leftover print statement,babaissarkar,2024-04-01 04:15:13+00:00,2024-04-01 12:18:55+00:00,{'UI': 1},Remove leftover print statement and `#include<iostream>` from #8451 which is only used for testing.
1799471988,"[1.18] wmlxgettext: Fix ""fix invalid escape sequence""",stevecotton,2024-03-31 18:40:35+00:00,2024-04-02 10:26:17+00:00,"{'Translations': 1, 'WML Tools': 1, 'Stable 1.18': 1}","Testing: running a pot-update with this should produce no string changes compared to 1.18.0. SotA's strings are a particular place to check, because this fixes #8646. Some strings move around in wesnoth-tutorial.pot because of #8660, but they shouldn't change.

The original code was probably meant to strip trailing whitespace, which turned out to be a bug when adce3fe79b4f52e2caf21962b2bc440fa36b0476 fixed the buggy regexp so that it started working. That has now been removed.

Fixed handling of multiline plural strings, which was broken too.

One feature has been left unimplemented, and will cause wmlxgettext to error out. For ""long bracketed"" strings, Lua allows the contents to start with a newline, which is automatically stripped from the resulting string. Trying to understand the original purpose lead me to this feature of Lua strings which we don't use in Wesnoth; and I finally concluded that, if someone wants to use that feature, it can be their problem to implement it."
1799100917,Make the Changelog macOS app menu item more relevant (development branch forward-port version),irydacea,2024-03-30 21:20:08+00:00,2024-03-31 05:44:04+00:00,"{'macOS': 1, 'UI': 1}",Just running a forward-port of #8572 through CI build.
1799061560,Boost tests: run test_without_attribute_filter,stevecotton,2024-03-30 18:34:05+00:00,2024-03-31 07:36:42+00:00,{'Unit Tests': 1},"It was added in 532d17f958969186baa0646c5528c2477bcb65b3, but that commit missed adding it to boost_test_schedule.

(cherry picked from commit c80fdc2283ac42635674a441999544b6164bd6b2)"
1798957811,EI: survivor trait and sentinel shield bugfix,Dalas121,2024-03-30 14:30:16+00:00,2024-04-02 01:20:52+00:00,{'Campaign EI': 1},Fixes the related issues #8632 and #8633.
1798957162,[1.18] Boost tests: run test_without_attribute_filter,stevecotton,2024-03-30 14:28:41+00:00,2024-03-30 18:30:27+00:00,{'Unit Tests': 1},"It was added in 532d17f958969186baa0646c5528c2477bcb65b3, but that commit missed adding it to boost_test_schedule."
1797689014,Tutorial S01: Better timing for the hints,stevecotton,2024-03-29 10:00:49+00:00,2024-03-29 12:38:22+00:00,"{'Enhancement': 1, 'Campaign Tutorial': 1}","Forward-port of #8647, intending to merge when the CI passes.

No string changes, just adjusting when the hints at the top-left of the screen appear and disappear.

The hint about crowns now appears after recruiting both elves, so that there are units to compare the leader to, who have the same orb color but no crown.

The hint about traits appears when told to attack the quintain with the elves. The player will probably find a strong or dexterous trait, and Delfador already comments about those traits after attacking. Even if neither elf has those, speedy or robust could also influence whether to use melee or ranged attacks.

There's now no hint on screen when first choosing which village to use for healing; previously it was the hint about crowns which didn't seem relevant. No strings are added in this commit, but a hint about checking the quintain's movement range would fit here, see <https://r.wesnoth.org/t54644>.

(cherry picked from commit f7a0f119de8f07d128d64374d7e872a2b3250cb5)"
1796896114,Fix description of World Conquest 4p,Discontinuum,2024-03-28 21:02:26+00:00,2024-03-29 23:51:07+00:00,{'Campaign WC': 1},
1795857218,Rich Text Label widget for Help Browser GUI2 port,babaissarkar,2024-03-28 11:32:41+00:00,2024-06-06 11:03:38+00:00,"{'Enhancement': 1, 'macOS': 1, 'UI': 1, 'Building': 1, 'Help': 1, 'Schema': 1}","Resolves #2687 

Work in progress, full of debug code.

**Work done so far**

-  Update canvas to support setting pango attributes on a part of text. New WML keys in `[text]`
-  Help Markup Parser supports a subset of XML style parsing in addition to existing markup.
-  Tags implemented : `<header>/<h>`, `<bold>/<b>`, `<italic>/<i>`, `<underline>/<u>`, `<format>/<span>`, `<img>`, `<ref>`, `<table>` and related tags. (`<endtable/>`, `<jump/>`, `<br/>`)

**ToDo**
- [x] Correct positioning and wrapping of text and images
- [x] Correct size calculation using `calculate_best_size()`
- [x] Link handling callback
- [x] Correct calculation of Link Position (could be buggy in complex situations)
- [x] Correct wrapping for floating images"
1795662805,Keep python 2 compatibility,soliton-,2024-03-28 09:43:47+00:00,2024-03-28 16:06:00+00:00,"{'Building': 1, 'SCons': 1}",
1794992642,UtBS luck smoothing: scenario 1,PointMeAtTheDawn,2024-03-27 22:35:09+00:00,2024-03-29 20:40:11+00:00,{'Campaign UtBS': 1},"Adjusts chance of finding a unit in village (by difficulty and unit value), making it less likely to have long streaks of luck or unluck.

https://docs.google.com/spreadsheets/d/1Wqrb6ytW3FeYcWXlfKBlNgi6bcklNyk7bXDfdl1QsJ4/edit#gid=0 is a quick and dirty analysis of different max_fate values on how much an empty village, fighter, scout, or tauroch adjusts your chances in all future villages."
1794923878,EI - show custom traits in help menu,Dalas121,2024-03-27 21:27:21+00:00,2024-03-30 13:33:38+00:00,"{'Units': 1, 'Help': 1, 'Campaign EI': 1}","EI has a few custom traits, but since they aren't assigned to a race they don't show up in the help menu.

This PR creates a dummy race and dummy unit to fix the issue. Ugly but it works."
1794775090,Boost tests: check what config_filters's *_matches_if_present default to,stevecotton,2024-03-27 19:47:32+00:00,2024-03-30 12:59:25+00:00,"{'Postponed': 1, 'Unit Tests': 1, 'Building': 1, 'Stable 1.18': 1}","These took a std::nullopt defaulted to NULL, but NULL is often defined to be zero rather than std::nullopt.

Ideally this should be using a WML test to find out what the result is for things accessible via FilterWML, but for 1.18 let's check what the low-level function does.

Also add test_without_attribute_filter to boost_test_schedule."
1794668678,[1.18] alternative fix build with musl libc,newfrenchy83,2024-03-27 18:48:54+00:00,2024-03-30 12:34:35+00:00,"{'Linux': 1, 'Building': 1, 'Stable 1.18': 1}",
1794662240,alternative fix build with musl libc,newfrenchy83,2024-03-27 18:44:37+00:00,2024-03-30 12:34:30+00:00,"{'Linux': 1, 'Building': 1}","Due to my confusion between NULL and std::nullopt, a compilation error was introduced. @iFoundSilentHouse would this suit you better?"
1794106071,Tutorial S01: Better timing for the hints,stevecotton,2024-03-27 14:33:16+00:00,2024-03-29 09:22:48+00:00,"{'Enhancement': 1, 'Campaign Tutorial': 1}","No string changes, just adjusting when the hints at the top-left of the screen appear and disappear.

The hint about crowns now appears after recruiting both elves, so that there are units to compare the leader to, who have the same orb color but no crown.

The hint about traits appears when told to attack the quintain with the elves. The player will probably find a strong or dexterous trait, and Delfador already comments about those traits after attacking. Even if neither elf has those, speedy or robust could also influence whether to use melee or ranged attacks.

There's now no hint on screen when first choosing which village to use for healing; previously it was the hint about crowns which didn't seem relevant. No strings are added in this commit, but a hint about checking the quintain's movement range would fit here, see <https://r.wesnoth.org/t54644> and #8643."
1793903529,"EI S10: change ""ghasts in cages"" to ""ghouls in cages""",Dalas121,2024-03-27 12:57:51+00:00,2024-03-30 15:28:07+00:00,{'Campaign EI': 1},Fixes issue #8620 
1792756065,[1.18]EI: Barrow Wight Resistance to Arcane On Defence Ability Doesn't Work Against Mixed Damage Type Weapons,newfrenchy83,2024-03-26 22:26:59+00:00,2024-04-04 12:15:15+00:00,"{'Unit Tests': 1, 'Units': 1, 'Campaign EI': 1, 'Stable 1.18': 1}","Fix https://github.com/wesnoth/wesnoth/issues/8631 issue

When damage_type is used but the opponent uses the resistance ability against the added type it can only detect the original type and the new type is not affected."
1792749754,fix attack::damage_type bug for abilitie resistance,newfrenchy83,2024-03-26 22:23:21+00:00,2024-04-04 16:01:36+00:00,"{'Unit Tests': 1, 'Units': 1}","Fix https://github.com/wesnoth/wesnoth/issues/8631 issue

When damage_type is used but the opponent uses the resistance ability against the added type it can only detect the original type and the new type is not affected."
1792573929,SDL3,Pentarctagon,2024-03-26 20:29:30+00:00,,"{'macOS': 1, 'AI': 1, 'UI': 1, 'Editor': 1, 'Units': 1, 'Lua API': 1, 'Building': 1, 'Help': 1, 'SCons': 1, 'CMake': 1, 'Engine': 1}","---

Some initial work seeing what moving to SDL3 will take. The first commit is from running the recommended `rename_*` scripts from https://github.com/libsdl-org/SDL/blob/main/docs/README-migration.md. Second commit is simpler things I was able to easily fix - main thing with this was more things are taking floats instead of ints as arguments."
1792529532,CI run for updated German translation,stevecotton,2024-03-26 20:03:45+00:00,2024-03-27 00:00:51+00:00,{'Translations': 1},
1792525237,[1.18] CI run for updated German translation,stevecotton,2024-03-26 20:00:43+00:00,2024-03-27 00:00:43+00:00,{'Translations': 1},
1791412968,CI run for an updated German translation,stevecotton,2024-03-26 11:24:07+00:00,2024-03-26 13:46:05+00:00,{'Translations': 1},
1791394895,[1.18] CI run for a German translation update,stevecotton,2024-03-26 11:13:28+00:00,2024-03-26 13:46:01+00:00,{'Translations': 1},All of these are from René.
1791293210,fix build with musl libc,iFoundSilentHouse,2024-03-26 10:24:11+00:00,2024-03-28 05:53:47+00:00,{'Building': 1},"Wesnoth was unable to build with musl.
Error message: ```error: could not convert 'nullptr' from 'std::nullptr_t' to 'int'``` 
It was for strings 43, 44, 65.
I found the same error but with other program: https://github.com/dotnet/runtime/issues/67763
And after changing 'NULL' to '0' build was successful."
1790169418,Don't duplicate player names per mod used,Pentarctagon,2024-03-25 19:54:40+00:00,2024-04-01 19:44:59+00:00,"{'MP': 1, 'UI': 1, 'Add-ons': 1}","Currently even though the results ultimately don't display duplicate information for the modifications used, the resultset coming back does have a row per modification and player, so it appears as though the player list is duplicated.

Fixes #8619

---

Draft since I haven't tested it locally yet - my local database instance seems to have vanished, so I need to see what's going on with that."
1789914996,Automatically replace missing .jpg images with .webp if found,stevecotton,2024-03-25 17:25:38+00:00,2024-03-25 20:02:19+00:00,{},"Forward-port of #8618

Give .jpg files the same logic that .png files were given in 8f06da197462e376bf25704253299a886622ba58, because many files were renamed in 51b58ad218fc285717c7d5889fdfeda59f017ca6. UMC using the old name for images will trigger a warning, but the player will still see the image file.

This is just a cosmetic change that doesn't change compatibility, because have_asset(""images"", ""blah.jpg"") won't be automatically redirected to ""blah.webp"".

(cherry picked from commit 84ed5488e0676a1cff6989ae3caa75a68f739bf7)"
1789905925,MP: Aethermaw: Update images with their 1.18 variants,stevecotton,2024-03-25 17:19:56+00:00,2024-03-25 20:02:48+00:00,{'MP': 1},"Forward-port of #8563, which was itself a cherry-pick from with #8539 with added changelog. I think it makes sense to merge this part so that #8539 becomes smaller.

(cherry picked from commit 2b9ed4708003d1b213f2efc3649f8dfffca5e95b)"
1788346959,fix invalid escape sequence,stevecotton,2024-03-24 20:39:20+00:00,2024-03-25 17:26:20+00:00,{'WML Tools': 1},"Backport of #8577

(cherry picked from commit 4be9aa85849010e93a9a3b0f0701d0630e7b9368)"
1788330690,[1.18] Automatically replace missing .jpg images with .webp if found,stevecotton,2024-03-24 19:43:19+00:00,2024-03-25 17:22:27+00:00,"{'Enhancement': 1, 'Graphics': 1, 'Fwdport': 1}","Give .jpg files the same logic that .png files were given in 8f06da197462e376bf25704253299a886622ba58, because many files were renamed in 51b58ad218fc285717c7d5889fdfeda59f017ca6. UMC using the old name for images will trigger a warning, but the player will still see the image file.

This is just a cosmetic change that doesn't change compatibility, because have_asset(""images"", ""blah.jpg"") won't be automatically redirected to ""blah.webp"". Thanks to @ProditorMagnus for pointing that out. I feel it should merge for 1.18.1, and it can then be cleanly cherry-picked for master - if it's not going into 1.18, no reason to add it to master as UMC will be updated anyway for 1.18."
1787997595,Tutorial scenario 1 - simplify the quintain's stats,Dalas121,2024-03-24 00:38:49+00:00,2024-03-24 23:25:57+00:00,"{'Units': 1, 'Campaign Tutorial': 1}","The tutorial's quintains are the first enemies a new player is likely to fight. Therefore, their stats should be simple, and representative of the average wesnoth unit.

Currently, quintains deal 3x5 damage with the magical special and the wose movetype - all highly unusual. This PR switches the movetype to smallfoot, removes the magical special, and swaps their attack to 5x3.

Movetype buff and attack nerf should result in unchanged overall strength, so hopefully no rebalancing necessary."
1787991924,campaign_dialog.cfg - Explain the RNG options better,Dalas121,2024-03-24 00:19:43+00:00,2024-04-01 22:43:39+00:00,{'UI': 1},"The different RNG options available when choosing a new campaign could use more in-depth explanations with examples, to make them easier for new players to understand.

As part of this, I've also renamed ""Biased RNG (experimental)"" to ""Reduced RNG"", which I believe is a more intuitive name.

![Screenshot_2024-03-23_19-18-58](https://github.com/wesnoth/wesnoth/assets/33790750/5cbb05d0-2506-4583-a22f-8c2f07c56b1e)
"
1787988740,wording change for one of the RNG options,Pentarctagon,2024-03-24 00:09:47+00:00,2024-03-24 01:29:07+00:00,{'UI': 1},
1787166322,Attempt to fix data migration for steam,Pentarctagon,2024-03-22 19:08:54+00:00,2024-03-22 22:44:39+00:00,{'Engine': 1},"It *appears* that the migration prompt doesn't show up for steam players because steam automatically creates the <userdata>/saves/steam_autocloud.vdf file on start, since the saves folder is what's synced. Since the migration logic is looking for whether the userdata folder exists, this means it always exists when launched from steam.

So, fix that by checking a different subfolder under userdata (checking the logs folder is arbitrary, it could be any of them aside from the saves folder)."
1787053129,fix help portraits scaling too large,Pentarctagon,2024-03-22 17:54:58+00:00,2024-03-22 22:44:24+00:00,{'Help': 1},
1784669984,Streamline bug report template,soliton-,2024-03-21 14:38:41+00:00,2024-03-22 18:53:14+00:00,{'Services': 1},"IMO build info is rather confusing for most people and those that understand it are likely to provide the info anyway.

Has downloaded from ever been helpful?"
1783480894,fix double scrollbar bug in WC Help dialog,babaissarkar,2024-03-21 03:52:14+00:00,2024-03-22 13:45:42+00:00,"{'UI': 1, 'Campaign WC': 1}","Caused by the fact that the vertical scollbar mode in the left hand treeview was set to `never`. Setting it to `auto` allows the scrollbar to grow, and prevent the window from showing it's own scrollbar. (Issue #8576)
"
1780248714,[1.18]fix shema validation for overwrite_specials,newfrenchy83,2024-03-19 16:01:59+00:00,2024-03-22 16:09:16+00:00,{'Schema': 1},some weapon special can use overwrite_specials but i forget to put it in shema validation
1780238382,fix shema validation for overwrite_specials,newfrenchy83,2024-03-19 15:56:45+00:00,2024-03-22 16:09:29+00:00,{'Schema': 1},some weapon special can use overwrite_specials but i forget to put it in shema validation
1778286526,Use unique flatpak branch to allow parallel installation,soliton-,2024-03-18 20:11:52+00:00,2024-03-19 18:26:29+00:00,{'CI': 1},
1778083834,Re-add libraries due to https://github.com/ValveSoftware/steam-runtime/issues/647,Pentarctagon,2024-03-18 18:31:14+00:00,2024-03-19 18:02:55+00:00,"{'CI': 1, 'Steam': 1}","Currently on the steam deck wesnoth is not properly setup to use the sniper runtime, and this can only be updated by a valve developer. So until that happens, we need to go back to providing these libraries ourselves."
1776228868,fix invalid escape sequence,ProditorMagnus,2024-03-17 22:12:21+00:00,2024-03-24 20:33:47+00:00,{'WML Tools': 1},
1776120713,WoF S11: tweak enemy gold,Jonathan-Kelly,2024-03-17 16:42:35+00:00,2024-03-17 19:11:33+00:00,{'Campaign WoF': 1},Port of #8574
1776116596,[1.18] WoF S11: tweak enemy gold,Jonathan-Kelly,2024-03-17 16:30:13+00:00,2024-03-17 19:11:30+00:00,{'Campaign WoF': 1},"Last minute tweak to WoF S11 for the stable branch.

Testing the default difficulty setting by effectively droiding the player's side, the enemy side still lost even with 480 gold and otherwise default difficulty settings - [droid_side1_vs_480g_side2.gz](https://github.com/wesnoth/wesnoth/files/14628065/droid_side1_vs_480g_side2.gz). So upping enemy side gold to 480 for all difficulty levels. (Note I had to manually retreat the non-leader-but-must-survive characters since default AI does not recognize the importance of their survivals).

Will forward port this to master."
1775755238,CI run for po update,stevecotton,2024-03-16 23:09:53+00:00,2024-03-17 00:38:38+00:00,{'Translations': 1},German SoF
1775699033,Make the Changelog macOS app menu item more relevant,irydacea,2024-03-16 21:31:26+00:00,2024-03-30 21:18:25+00:00,"{'macOS': 1, 'UI': 1}","This changes the URL used for the changelog menu item from using a direct GitHub file link to the master branch's changelog.md file to using a https://changelog.wesnoth.org/X.Y.Z link, where X.Y.Z are specifically the version number used in the macOS bundle's Info.plist file.

Note that this may result in incorrect links for +dev versions, where the Changelog link will simply send the user to the page for the latest release and not the future release. This shouldn't be a problem though, since people using those builds, especially on macOS, should really already know where to find the most relevant changelog for the version they're running -- in their own source tree.

---

To add a little more background to this, I remember adding a https://changelog.wesnoth.org/X.Y.Z redirect at some point either to make links easier to craft for release announcements, or to phase out the legacy X.Y-changelog.wesnoth.org domains that would force us to constantly add more and more new domains to the website certificate with each new major version release. So, the infrastructure on wesnoth.org's end for this patch already exists.

However, I still consider this to be kind of a work in progress because I do have an important question for @hrubymar10.

I seem to vaguely remember a conversation before where I was told that when a Mac App Store version needs to be reuploaded for whatever reason, the Z version number in X.Y.Z needs to be bumped regardless of anything else. If this is correct, the implication for this change in particular is that the changelog with the new version number would not be reachable via changelog.wesnoth.org, so this would effectively just lead the user to GitHub's 404 page.

Would it be perhaps more convenient in this case to use `game_config::wesnoth_version` to obtain the required info to build the URL, instead of using the Info.plist value? And in this case, is it okay to just pull `game_version.hpp` into `SDLMain.mm`?"
1775681516,"Fix ""implicit conversion turns floating-point number into integer"" warnings (development branch forward-port version)",irydacea,2024-03-16 20:45:57+00:00,2024-03-16 23:42:25+00:00,"{'macOS': 1, 'Building': 1}",Forward-port of #8570.
1775680448,"Fix ""implicit conversion turns floating-point number into integer"" warnings",irydacea,2024-03-16 20:42:41+00:00,2024-03-16 23:40:07+00:00,"{'macOS': 1, 'Building': 1}","Found with Xcode 15.3:

`/Users/iris/Projects/wesnoth/src/game_config.cpp:551:18 Implicit conversion turns floating-point number into integer: 'double' to 'const int'`"
1775677194,Fix macOS-specific deprecation warning from Boost.Filesystem API call (development branch forward-port version),irydacea,2024-03-16 20:31:39+00:00,2024-03-30 21:12:48+00:00,"{'macOS': 1, 'Building': 1}",Forward-port of #8568.
1775674428,Fix macOS-specific deprecation warning from Boost.Filesystem API call,irydacea,2024-03-16 20:22:15+00:00,2024-03-30 21:12:38+00:00,"{'macOS': 1, 'Building': 1}",`boost::filesystem::symbolic_link_exists()` has been deprecated since at least Boost 1.34 (2007).
1775620364,Add an environment variable to disable logging to file,Pentarctagon,2024-03-16 18:16:39+00:00,2024-03-17 17:23:31+00:00,{'Docs': 1},Fixes #8527
1775555673,CI run for a po update,stevecotton,2024-03-16 15:19:26+00:00,2024-03-16 23:03:25+00:00,{'Translations': 1},German SoF
1775518915,Improve default settings for the timer,Hejnewar,2024-03-16 14:42:21+00:00,2024-03-16 23:12:20+00:00,{},"Change default settings for the timer to 240/240/360/0.

Will forward port latter. "
1775345681,[1.18] MP: Aethermaw: Update images with their 1.18 variants,stevecotton,2024-03-16 08:14:20+00:00,2024-03-16 15:36:56+00:00,{'MP': 1},"Cherry-picked backport of the first commit from @babaissarkar's #8539 (that PR is still in review, but only because the later commits add new art and prose).

Fixes #8432.

I've added a changelog entry when backporting."
1774887724,[1.18] WoF: some fixes for stable,Jonathan-Kelly,2024-03-15 19:31:37+00:00,2024-03-15 19:53:09+00:00,{'Campaign WoF': 1},Backport of #8514 and  #8533
1774674641, made tag_name is mandatory in [experimental_filter_ability(_active)] but remain optionnal in overwrite_specials[overwrite][experimental_filter_specials],newfrenchy83,2024-03-15 17:02:52+00:00,2024-08-03 16:09:48+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1}",Fix https://github.com/wesnoth/wesnoth/issues/7992 
1774563456,add secondary_authors to pbl schema,Pentarctagon,2024-03-15 16:06:08+00:00,2024-03-16 06:25:29+00:00,{'Schema': 1},
1773690731,gui/unit_recall: Add alignment and race hints for filtering (1.18),irydacea,2024-03-15 09:01:21+00:00,2024-03-16 03:13:27+00:00,"{'Enhancement': 1, 'UI': 1}",Backport of #8520 to 1.18.
1773009490,ui: Add add-ons server identification to the bottom left display in Add-ons Manager,irydacea,2024-03-14 21:02:57+00:00,2024-03-15 03:51:44+00:00,"{'Enhancement': 1, 'UI': 1, 'Add-ons': 1}",Backport of #8481.
1772841801,Use --jobs instead of adjusting the manifest,soliton-,2024-03-14 19:00:20+00:00,2024-03-18 19:56:31+00:00,{'CI': 1},
1772744816,Add yellow and pink color_range,ProditorMagnus,2024-03-14 18:08:45+00:00,2024-03-25 17:28:55+00:00,{'Graphics': 1},
1772395424,fix tags and secondary_author for pbl editor,Pentarctagon,2024-03-14 14:54:00+00:00,2024-03-15 03:03:45+00:00,"{'UI': 1, 'Editor': 1}",
1772164399,Set distribution channel for flatpak,soliton-,2024-03-14 13:01:26+00:00,2024-03-14 18:24:34+00:00,{'Packaging': 1},
1771310274,Liberty: Custom Unit for Lord Maddock,Dalas121,2024-03-14 03:57:10+00:00,2024-04-13 10:13:23+00:00,"{'Graphics': 1, 'Units': 1, 'Campaign L': 1}","Elensefar's Lord Maddock makes an appearance in Liberty's scenario 4 ""Unlawful Orders"", where he's represented by the General unit.  As a somewhat significant character, I say he deserves his own unit, which I've added in this PR.

Image based on the Cavalier, with added animations.  If my contributions need a license, CC-BY-SA 4.0 is fine.

Also, are animations of this low-ish quality acceptable for mainline units?  I could put together some similar attack animations for the regular Cavalier, who still doesn't have any."
1770927962,Add -Wno-shorten-64-to-32 to compiler flags in Xcode,irydacea,2024-03-13 21:33:54+00:00,2024-03-14 02:04:29+00:00,"{'macOS': 1, 'Building': 1}",Forward port of #8544 which was already merged into 1.18.
1770835983,EI S05: fade to silence when recounting the priestess's death (v2),Dalas121,2024-03-13 20:24:28+00:00,2024-03-31 07:48:11+00:00,{'Campaign EI': 1},"In EI's S05, Owaec briefly recounts the bloody fate of his local priestess, killed by undead.

The scenario's music consists of wanderer.ogg and traveling_minstrels.ogg, which are inappropriate for encountering a mangled corpse.

Instead, fade the music out during this section.

This is the second version of this pull request; I did something weird on the first one causing the entire file to change."
1770697905,remove 'experimental_' of filter_ability/specials tags,newfrenchy83,2024-03-13 18:44:12+00:00,2024-10-14 21:35:56+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1, 'Campaign EI': 1}",now what 1.18 separate of master branch it istime of aiming for that.
1770001492,Changelog for SotA S16: Keep Crelanu within his ring,stevecotton,2024-03-13 12:34:38+00:00,2024-03-13 20:07:37+00:00,{'Docs': 1},"Just a CI run (arguably unnecessary, but I want to keep the habit of PRs for everything)

Changelog for d106238410cf1ffc7f36352ce7b5d24fcfa19b59, the changelog is already included in 1.18's cherry-pick."
1768915887,Add -Wno-shorten-64-to-32 to compiler flags in Xcode,irydacea,2024-03-12 21:15:26+00:00,2024-03-13 12:15:34+00:00,"{'macOS': 1, 'Building': 1, 'Fwdport': 1}","This is necessary with Xcode 15.3 to avoid about 750 warnings across all of the codebase regarding ""Implicit conversion loses integer precision"", most of which apply in cases where theoretical limits are involved because of conversions from unsigned 64-bit integers (usually `size_t`) to signed 32-bit (`int`).

Ideally we want to address these warnings, but given how many of them there are all over the place this is not something that can reasonably be done in such short notice before Wesnoth 1.18.0 is released, and in the meantime they make the compiler output with Xcode unnecessarily noisy and completely bury any relevant warnings from actual code changes. In the meantime, this is best for productivity until we can get to a place where we can fix all of them and force using -Wshorten-64-to-32 for all platforms in CI.

*(Read: I can't properly see warnings in my own code without this change lol)*"
1768501527,fix math include necessary in game_config.cpp for compile file.,newfrenchy83,2024-03-12 17:09:45+00:00,2024-03-12 17:12:16+00:00,{},
1768402131,[Units][Skeletal Dragon] Update Stats,knyghtmare,2024-03-12 16:27:12+00:00,2024-08-03 16:13:01+00:00,{'Units': 1},"This comment existed when the unit was still in EI campaign. It's been moved to core ages ago and yet, the comment, now no longer relevant outside of EI still persisted...

Also, why is this _undead_ unit still in `units/monsters/` when `units/undead/` exists?"
1767873763,SotA S16: Keep Crelanu within his ring of protective holy waters,stevecotton,2024-03-12 12:51:14+00:00,2024-03-13 12:26:34+00:00,{'Campaign SotA': 1},"Backport of #8521, fixes #8361.

Changelog added after cherry-picking.

(cherry picked from commit d106238410cf1ffc7f36352ce7b5d24fcfa19b59)"
1767431959,Aethermaw Cosmetic Updates,babaissarkar,2024-03-12 08:51:47+00:00,2024-03-26 13:44:34+00:00,"{'MP': 1, 'Units': 1, 'Prose': 1}","Sulla's power in Aethermaw seem to be far more than what can be expected of a Wesnothian Great Mage, so updated the lore and gave her a new type which seems more apt.
Also planning to add some new images for the new type, if it is something I can do with my skill level.

Yet another reason would be to let players know that the paths human magi can take are as varied as there are human. Currently the main paths are Red vs White mage (and Silver maybe). But other races show that these are not the only types of magic that exist. (I think at this moment it gives a false impression that Red Magi are the best, and only they can become Great Mages). This can slightly alleviate that. (Compare for example War of Legends' magi, where even dual and multielement magi are possible)

Current choice : *Aether Mage*

Also addresses issue https://github.com/wesnoth/wesnoth/issues/8432. (Update missing images to use newer variants found in 1.18)

Associated forum thread : https://forums.wesnoth.org/viewtopic.php?t=57811"
1766863254,EI S05: fade to silence when recounting the priestess's death,Dalas121,2024-03-11 23:05:06+00:00,2024-03-13 20:20:50+00:00,"{'Audio': 1, 'Campaign EI': 1}","In EI's S05, Owaec briefly recounts the bloody fate of his local priestess, killed by undead.

The scenario's music consists of wanderer.ogg and traveling_minstrels.ogg, which are inappropriate for encountering a mangled corpse.

Instead, fade the music out during this section."
1766855515,"EI S14: Indicate uncleared swamp hexes with ""swamp reeds"" images",Dalas121,2024-03-11 22:56:36+00:00,2024-03-30 18:32:51+00:00,"{'Graphics': 1, 'Campaign EI': 1}","EI's S14 involves traversing a swamp with hidden, immobile undead waiting in ambush. To make it easier for the player to remember which hexes they've cleared, mark the uncleared hexes.

Alternatively, this aid could be available only on the lower difficulties."
1766771499,[WIP] New tweening-based API for the outro screen,Vultraz,2024-03-11 21:43:49+00:00,2025-01-06 02:17:17+00:00,"{'UI': 1, 'Building': 1}","This refactors the outro handling using a new tween-based API. Opening for design feedback.

Easings impls copied from https://github.com/warrenm/AHEasing/blob/master/AHEasing/easing.c and modified for our codebase."
1766725161,WoF: balance tweaks,Jonathan-Kelly,2024-03-11 21:20:01+00:00,2024-03-15 19:52:32+00:00,"{'Backport': 1, 'Campaign WoF': 1}","Some tweaks for the later scenarios based on a final play test of all scenarios before the stable release.

These should also get backported into 1.18."
1766435112,Attempt to disambiguate operator<< for optimer,Vultraz,2024-03-11 18:36:47+00:00,2024-03-11 20:39:45+00:00,{},Ci run
1764650435,Remove unnecessary header files,xingwozhonghua126,2024-03-10 23:44:23+00:00,2024-03-12 04:07:49+00:00,"{'AI': 1, 'MP': 1, 'UI': 1, 'Editor': 1, 'Units': 1, 'Lua API': 1, 'Add-ons': 1, 'WFL': 1, 'Help': 1, 'Terrain': 1}","“Remove unnecessary header files”

BTW This should be my last pull request for this project, I don’t know what to do next, all the useless includes in the project have been removed by the script.
"
1764531093,minor cleanup of theme font macro (backport),doofus-01,2024-03-10 17:47:04+00:00,2024-03-10 18:07:26+00:00,"{'Backport': 1, 'UI': 1}",backport of #8526
1764477692,Change the list check from [damage_type] to a system that takes into account the opponent's sensitivity,newfrenchy83,2024-03-10 15:05:25+00:00,2024-04-12 11:09:22+00:00,"{'Unit Tests': 1, 'Units': 1}","

If two [damage_type]altenative_type= are used with two different types, the chosen type displayed in the pre-combat window will be the one to which the opponent will be most vulnerable, and if he is more vulnerable to that one rather than to the type d originally, this is the one that will be used.

On the other hand, in this case, report will not display alternative_type because there is no opponent to check"
1764263974,fix accidental conditional inversion,Pentarctagon,2024-03-10 02:52:52+00:00,2024-03-10 17:11:51+00:00,{'Lua API': 1},"fixes #8525
fixes #8524"
1764221186,minor cleanup of theme font macro,doofus-01,2024-03-09 23:24:37+00:00,2024-03-10 18:07:14+00:00,{'UI': 1},"The other font size macros were cleared at the end, this one must be an oversight.  Matters if you are trying to set up an alternate theme, as you have to redefine those macros."
1763963722,Bengali logo for Wesnoth and enable bn image assets,stevecotton,2024-03-09 08:10:25+00:00,2024-03-09 10:43:34+00:00,"{'Graphics': 1, 'Translations': 1}","Backport of #8513 + f5ebda099; making a PR to run the CI.

* wesnoth logo localized to bengali
* update copyright

(cherry picked from commit 95c62173a3abf454ee6233cfcd3a651f352c0812)

Enabling the image assets is
(cherry picked as commit f5ebda09968b6b2433d58561d3c297a9173a223c)"
1763786255,SotA S16: Keep Crelanu within his ring of protective holy waters,Wedge009,2024-03-08 23:36:18+00:00,2024-03-12 12:35:40+00:00,"{'Backport': 1, 'Campaign SotA': 1}","I play-tested this in master and couldn't get Crelanu to leave his ring, even with as tempting a target such as a weak Ardonna.

Resolves #8361."
1763681073,gui/unit_recall: Add alignment and race hints for filtering,irydacea,2024-03-08 21:33:27+00:00,2024-03-16 03:13:16+00:00,"{'Enhancement': 1, 'UI': 1}","This adds the human-readable version of each unit's alignment and their (gendered) race name and plural race name as hints for the filter box functionality, so that players can enter keywords such as ""liminal"", ""dwarves"", ""mermaid"" and get what they expect even if those words are not literally part of the unit type names.

Inspired by this Ideas forum thread: https://forums.wesnoth.org/viewtopic.php?t=57749

Still a work in progress since I want to do the same for the Recruit dialog, which seems a little more involved due to it using a different mechanism for handling the Filter box.

I'm curious if @Pentarctagon and @Vultraz believe this is a reasonable candidate for backporting to 1.18 since it's not a massively impactful change and — especially for the Recall dialog when playing longer singleplayer campaigns — it constitutes a nice QoL improvement."
1763072975,[1.18]Fix Ambush Ability Does not Work in Bluff/Glutch Forest Terrain,newfrenchy83,2024-03-08 14:18:50+00:00,2024-03-09 18:32:17+00:00,{'Terrain': 1},Fix https://github.com/wesnoth/wesnoth/issues/8512 issue in 1.18
1763064194,Fix Ambush Ability Does not Work in Bluff/Glutch Forest Terrain,newfrenchy83,2024-03-08 14:12:42+00:00,2024-03-09 18:32:20+00:00,{'Terrain': 1},Resolve https://github.com/wesnoth/wesnoth/issues/8512 issue
1762294655,gui: Better positioning of submenus in the main UI,irydacea,2024-03-08 04:38:06+00:00,2025-01-16 02:02:02+00:00,"{'Enhancement': 1, 'UI': 1}","This is an attempt to improve the way menus work in Wesnoth. The current implementation handles each menu as a modal dialog of its own, in particular allowing there to be at most only one menu on screen. It goes without saying that when dealing with menus that have submenus (such as the in-game turn and replay menus, as well as the editor's MRU list) this is very suboptimal. I'd like to look into changing this later, but for now I've at least figured out a way to improve the **positioning** of submenus.

Currently, when a menu item that spawns a submenu is selected, the latter is displayed with its top left coordinate at the exact position of the mouse cursor. This means that the top left corner of a **submenu** is not so much dependent on where the **parent menu item** that is associated with it is located on the screen, but rather where the mouse cursor is at the time the event that selected it goes through. This results in this funny quirk where the same menu spawns at different locations each time.

In the absence of a way to have both the submenu and its parent menu displayed on screen at the same time, I've decided it would still be a marked improvement if at least the submenu position on screen stayed consistent and made a little more sense overall.

This initial version of the PR makes it so the **submenu's** top left corner is set to the top left corner of the **parent menu item**, with a small shift to compensate for the dialog (menu) borders. Below is an example of what it looks like when a submenu is displayed without moving the mouse cursor after clicking on the parent menu item-

**Parent menu**
<img width=""555"" alt=""menu1"" src=""https://github.com/wesnoth/wesnoth/assets/489895/248f6d4c-9001-445d-a311-16eeceb2588a"">

**Submenu**
<img width=""555"" alt=""menu2"" src=""https://github.com/wesnoth/wesnoth/assets/489895/cda1c0fc-d76b-4dc7-bd33-e30b128eb969"">

(Please ignore the weird colouring of the mouse cursor. That's fully unrelated to this commit and doesn't actually happen on my screen.)

Note that I'm not entirely sure what happens when the parent menu item is on an edge case (no pun intended) location such as close to the right bottom corner of the screen. It seems like this *should*, at least in theory, be handled by the WFL in the WML definition of the dropdown menu window, but I'm not entirely sure. It may be necessary to make additional changes to it. I'm sure @Vultraz may be able to provide me with more insight on this."
1762185633,Fix indices in widget.add_item_of_type(),gfgtdf,2024-03-08 02:09:09+00:00,2024-09-03 12:17:57+00:00,{'Lua API': 1},"previously this function used c++ 0-based indexing, and could  lead to assertions when wrong indicies were used, now it used lua 1-based indicies and throws lua errors on wrong indicies."
1762023703,Make sure animations are skipped when skipping animations in replays,Pentarctagon,2024-03-07 22:45:17+00:00,2024-03-08 18:47:46+00:00,"{'Graphics': 1, 'Units': 1, 'Lua API': 1}","Fixes #8227

---

I haven't looked deeper to see if there's anything else that needs to be done yet, but it does fix the death animation playing at least."
1761578986,WoF: adjust music,Jonathan-Kelly,2024-03-07 18:12:48+00:00,2024-03-14 18:22:40+00:00,"{'Backport': 1, 'Audio': 1, 'Campaign WoF': 1}","This is based on feedback in #8507 and a review of WoF's scenario music playlists as a result.

I am going to start a full play through with these adjustments to get a better sense for them, so there might be some further adjustments soon. But posting this now in case @irydacea or anyone else has further feedback to give before the stable release."
1760708387,Bengali logo for Wesnoth,babaissarkar,2024-03-07 10:15:47+00:00,2024-03-07 12:56:50+00:00,{'Graphics': 1},"The logo of Battle for Wesnoth, localized to the Bengali language.
![bfw-logo-bn](https://github.com/wesnoth/wesnoth/assets/8469888/09b2f6f7-8b26-4811-9e7f-a4dca88db25f)
"
1760145720,EI - recolor achievement icon,Dalas121,2024-03-07 03:31:42+00:00,2024-03-10 15:18:30+00:00,{'Campaign EI': 1},"Replace the magenta coloring on the S04 achievement icon with white, reflecting the in-game unit color.

Very minor change. Thanks to Konrad2 for pointing this out."
1759397146,Story screen update,babaissarkar,2024-03-06 17:13:44+00:00,2024-05-24 13:59:47+00:00,"{'Enhancement': 1, 'Graphics': 1, 'UI': 1, 'Schema': 1}","Modifies the story screen to give it the following look : 
![Screenshot from 2024-03-06 22-41-33](https://github.com/wesnoth/wesnoth/assets/8469888/9e02218f-8162-4507-baaa-58ac3b9372d4)

**No text :**
![Screenshot from 2024-03-17 19-29-58](https://github.com/wesnoth/wesnoth/assets/8469888/690b73e2-207b-448e-a015-60d025788470)


Clicking on the left/right ornate arrow shows previous/next story part. Clicking on the ""skip"" text (or the dots) skips the story screen.

Addresses issue #8508, but in a different way.
**TODO**
 ~~Clicking on text moves story forward.~~ (Can't do that as a label already has an internal left click handler which deals with embedded links. Adding a listener might overwrite that.)
- [x] Skip button positioning may need to be adjusted for `text-layout=top`?
- [x] correct position of skip and left/right arrows when there's no text."
1758273597,EI: Bind stock translatable strings in Barrow Wight's definition to the wesnoth-units textdomain,irydacea,2024-03-06 07:00:32+00:00,2024-03-07 14:13:19+00:00,"{'Translations': 1, 'Units': 1, 'Fwdport': 1, 'Campaign EI': 1}","Barrow Wight's definition includes a couple of attack name strings from the wesnoth-units textdomain bound to wesnoth-ei by default instead, which creates two unnecessary extra strings for translators to translate. This PR fixes this by binding these two strings to wesnoth-units so their existing translations can be used.

(Pyre Wight does not require this change since it already uses the wesnoth-units textdomain for the single attack name it uses.)"
1757704434,use the currently selected map's path when opening a new file,Pentarctagon,2024-03-05 21:13:16+00:00,2024-03-06 01:54:29+00:00,{'Editor': 1},"currently the editor defaults to its maps directory even when you open a map file somewhere without it being in an ""add-on"", for example opening a map in a mainline campaign's maps folder."
1756882547,[1.18] WoF: another fix for stable,Jonathan-Kelly,2024-03-05 13:28:15+00:00,2024-03-05 16:04:33+00:00,{'Campaign WoF': 1},Backports to stable 1.18 branch the last remaining commit from #8447 which was not already backported by #8487
1756203160,gui/outro: New clock-based timing logic for the text fading,stevecotton,2024-03-05 07:25:11+00:00,2024-03-05 09:56:50+00:00,"{'Bug': 1, 'UI': 1}","Running the CI on a forward-port of #8454

This version uses SDL_GetTicks() as a monotonic source to avoid the previous version's pitfalls, namely the fact that the game's framerate may not necessarily be a constant, and in particular, the old code assumed a completely different framerate than what we ended up with after the texture-based rendering changes in 1.17.x, resulting in an almost-unnoticeable text fade due to the update() function being called WAY more often than before.

Note that the reliance on SDL_GetTicks() means the timings break at some point after 49 days of game runtime, exactly once. This should result in a visible ""jitter"" effect if the 32-bits ticks value wraps around in the middle of a fade sequence, but other than that it's not that big of a deal to warrant requiring SDL 2.0.18+ for the 64-bit version.

(cherry picked from commit db30ca53ae32eee37f805aa4aefb3e08de65de9c)"
1755027896,WoF S9: fix crannog village on map edge,Jonathan-Kelly,2024-03-04 15:53:42+00:00,2024-03-14 17:20:29+00:00,"{'Backport': 1, 'Campaign WoF': 1}","Fixes #8494

Visually speaking, this shortens the crannog's bridge section by one tile to bring in its village section from the map edge. Two other maps and one other scenario which feature the same village get corresponding tweaks.

I assume this should be backported to 1.18 also, right?"
1752614711,[1.18] WoF: two fixes for stable,Jonathan-Kelly,2024-03-02 00:30:29+00:00,2024-03-02 01:08:16+00:00,{'Campaign WoF': 1},Cherry picks two WoF fixes from #8447 on master and back ports them to the 1.18 stable branch.
1751536402,"The method is static, but these variables can't be.",stevecotton,2024-03-01 11:43:39+00:00,2024-03-01 13:08:07+00:00,{'Units': 1},"Backport of #8483

static variables are only initialized the first time they are encountered, even if they are only defined in the body of the method. therefore their value here is set to the first language used when this method is called, but won't change later if the language changes because they've already been initialized.

Fixes #8393

(cherry picked from commit ef972bb0a064002359f8ec00545c37181d63344f)"
1750999350,"The method is static, but these variables can't be.",Pentarctagon,2024-03-01 05:20:24+00:00,2024-03-01 11:41:06+00:00,{'Units': 1},"static variables are only initialized the first time they are encountered, even if they are only defined in the body of the method. therefore their value here is set to the first language used when this method is called, but won't change later if the language changes because they've already been initialized.

Fixes #8393"
1750696690,ui: Add add-ons server identification to the bottom left display in Add-ons Manager,irydacea,2024-02-29 23:59:54+00:00,2024-03-02 03:33:31+00:00,"{'Enhancement': 1, 'Backport': 1, 'UI': 1, 'Add-ons': 1}","This expands the server display at the bottom left of the Add-ons Manager window to include the server-provided server id and version after the server address. The goal with this is to make proper use of the `[server_id]` command (already sent during every connection since 1.15.x) and be able to differentiate server instances more easily when the port number is not part of the connection address.

<img width=""960"" alt=""Screenshot 2024-02-29 at 20 43 51"" src=""https://github.com/wesnoth/wesnoth/assets/489895/67580243-bcec-4d8e-acdf-87c320253199"">

**Default view (debug mode disabled):**

<img width=""235"" alt=""Screenshot 2024-02-29 at 20 43 51"" src=""https://github.com/wesnoth/wesnoth/assets/489895/8d88b46a-fdc4-428b-a4c7-85ea8177a155"">

**Detailed view (debug mode enabled):**

<img width=""235"" alt=""Screenshot 2024-02-29 at 20 44 22"" src=""https://github.com/wesnoth/wesnoth/assets/489895/a997ee44-ab9d-486d-b2b0-7b8fb8a380b0"">

If the `[server_id]` info is not available (e.g. when connecting to obsolete pre-1.15.x servers), the instance id/version are simply not shown.

As a reminder, the `[server_id]` is part of the add-ons server protocol and the `id=` field in it is a free-form string specified by the server admins, while the `version=` is the campaignd build version, which does not necessarily match the server id. Because sometimes the campaignd version number does not reflect the server id/the server's intended target client version, it could potentially be confusing or misleading to see it by default, hence it's hidden behind debug mode in this PR.

Finally, these changes don't add any new translatable strings so IMO they are worth considering for merging into 1.18 too. My original intention was to implement some form of UI for `[server_id]` back in 1.15.x anyway, I just never remembered to do it."
1750034959,[1.18] Use missing_mandatory_wml_tag instead of extra translatable strings,stevecotton,2024-02-29 15:43:23+00:00,2024-03-01 23:04:32+00:00,{'UI': 1},"The logic is that the strings included the names of WML tags, but weren't clear that they were WML tags, and so the tag names are being translated. The change is similar to #8433, and there's discussion leading up to this PR in #7600.

This reverts almost all of the string changes of PR #7600, which were in commit f5be4cffb7b34fdd2ac875cf0f76fc8db7e23cef, as well as a few similar strings which weren't in 1.16.x.

Yes, it's intentional that the non-translatable strings don't have the outermost `[` and `]`, even if they're `tag_1][tag_2`. Those outside ones are added by the message-creation function."
1749772973,[Lua][typing] Add map access typing to terrain_map,benoitkugler,2024-02-29 13:29:16+00:00,2024-02-29 14:19:48+00:00,{},This make terrain read/write described in https://wiki.wesnoth.org/LuaAPI/types/map (Terrain) better typed.
1747982824,Fix #8460 [effect] apply_to=variation,gfgtdf,2024-02-28 15:42:09+00:00,2024-03-07 00:26:00+00:00,"{'Unit Tests': 1, 'Units': 1}","Previously the code would apply the variation effects last, so that codes like
```
[effect]
  apply_to=variation
  ..
[/effect]
[effect]
  apply_to=hitpoints
  heal_full=yes
[/effect]
```
Would not set the unit hitpoints to the new variations hitpoints because the variation effect was applied after the healing effect.

In 1.16 this worked becasue healign was applied a little too often but that lead  also to bugs like #8324"
1747349783,"[1.18] Multiplayer: Add a po hint about ""Matchmaking""",stevecotton,2024-02-28 09:57:59+00:00,2024-03-01 21:38:35+00:00,{'UI': 1},
1747339704,[1.18] DM S18: Add a po hint about grammatical tense of some text,stevecotton,2024-02-28 09:52:18+00:00,2024-03-01 21:36:37+00:00,{'Campaign DM': 1},
1745886831,backport it to 1.18,newfrenchy83,2024-02-27 15:38:37+00:00,2024-02-27 15:40:11+00:00,{'Building': 1},
1745676061,update list of boost headers used in compilation,newfrenchy83,2024-02-27 14:07:39+00:00,2024-02-27 14:21:11+00:00,{'Building': 1},
1744536342,Adding myself to credits,fusaty,2024-02-27 00:36:35+00:00,2024-03-08 18:45:49+00:00,"{'Backport': 1, 'Docs': 1}",Based on https://wiki.wesnoth.org/SlovakTranslation
1743107861,[1.18] HttT S06: Make Elensefar's defenses look damaged by the Orcish siege,stevecotton,2024-02-26 10:41:13+00:00,2024-02-26 12:13:46+00:00,"{'Enhancement': 1, 'Campaign HttT': 1}","Just some debris embellishments to suggest that the towers at the end of the bridges were hit with siege weapons. The defense stats are still the same and there's no dialogue change to go with this.

(cherry picked from commit b9cb577bacde0db33f54b87a32accb3c3987e421)"
1742347659,Lua feeding cleanup,CelticMinstrel,2024-02-25 23:14:33+00:00,2024-07-20 09:09:33+00:00,"{'AI': 1, 'Lua API': 1}","Use filters to decide whether the event should trigger, rather than triggering it always and aborting if the filter doesn't match.

This _might_ be backportable.

Note: Must merge #8462 before this, as the first commit listed below belongs in that PR."
1742347426,[Lua] Make wesnoth.read_location return its result in standard named tuple format,CelticMinstrel,2024-02-25 23:13:46+00:00,2024-04-12 03:48:21+00:00,{'Lua API': 1},This is for consistency with other things that return locations in the engine.
1742347213,"[Lua] Accept {r=..., g=..., b=...} format for colours in add_overlay_text",CelticMinstrel,2024-02-25 23:13:00+00:00,2024-04-12 03:48:56+00:00,{'Lua API': 1},
1742347034,[Lua] Officially expose the Gamestate Inspector's title paramater in the Lua API,CelticMinstrel,2024-02-25 23:12:30+00:00,2024-04-12 03:49:15+00:00,{'Lua API': 1},
1742342579,[Lua] Update places that reference named tuples (eg locations or WML tags) by index instead of name,CelticMinstrel,2024-02-25 22:58:02+00:00,2024-05-19 16:54:36+00:00,"{'AI': 1, 'Lua API': 1, 'Campaign AToTB': 1, 'Campaign EI': 1, 'Campaign SotBE': 1, 'Campaign WC': 1}","This also updates places that are constructing WML tables without using `wml.tag`.

I'm not certain that I got _every single place_ for these updates, but I did use my IDE's problem list to find them, so if I missed one it's presumably a result of issues with the LuaDoc annotations.

Pulled out from #7359."
1742338009,Lua Warning Cleanup (1.18),CelticMinstrel,2024-02-25 22:41:09+00:00,2024-02-26 18:19:55+00:00,"{'AI': 1, 'Lua API': 1, 'Campaign SotA': 1}","I split out the parts of #7359 that seemed backportable. Obviously, this should be merged into master as well."
1742252070,skeletal rider and alternative bear portraits (backport #8453),doofus-01,2024-02-25 17:42:57+00:00,2024-02-25 23:15:42+00:00,"{'Backport': 1, 'Graphics': 1, 'Units': 1}","* skeletal rider portrait

* alternative bear portrait"
1742232329,Lua: Make sure unit type is built before returning it from iteration,CelticMinstrel,2024-02-25 16:35:44+00:00,2024-02-25 21:13:29+00:00,{'Lua API': 1},Fixes #8456
1742192203,wmllint: drop the rule about [campaign]rank= being a multiple of 5,stevecotton,2024-02-25 14:36:11+00:00,2024-03-06 07:58:25+00:00,"{'Enhancement': 1, 'WML Tools': 1}","The idea of using multiples of 5 seems like a way to avoid having to change multiple campaigns' ranks at once, because it leaves space to rearrange a mainline campaign between two other campaigns.

But enforcing ""it must be a multiple of 5, even if that means changing other campaigns"" loses the advantage of using multiples. For example, WoF currently has rank=152, which triggers the warning, which has caused a PR to be opened that changes WoF, SoF, LoW and SotA - because keeping them in order requires four campaigns to change.

Closes #7224, removes a commit from #8447, will itself be obsoleted by #8321."
1742052353,gui/outro: New clock-based timing logic for the text fading,irydacea,2024-02-25 06:18:59+00:00,2024-03-05 07:21:55+00:00,"{'Bug': 1, 'UI': 1}","While playing HttT last night I found out that the text fading effect in the outro screen at the end of the campaign was basically unnoticeable on my M1 MacBook Pro because of some poor assumptions in the outro screen's animation code regarding the frequency of screen updates — assumptions that in particular appear to have been broken by the 1.17.x rendering engine changes.

This PR replaces the outro screen's text fading logic with a clock-based version to avoid relying on rendering engine internals that can change all the time because of architectural changes, different hardware configurations, or user preferences.

Relevant text from the commit message follows:

> This version uses `SDL_GetTicks()` as a monotonic source to avoid the previous version's pitfalls, namely the fact that the game's framerate may not necessarily be a constant, and in particular, the old code assumed a completely different framerate than what we ended up with after the texture-based rendering changes in 1.17.x, resulting in an almost-unnoticeable text fade due to the `update()` function being called WAY more often than before.
> 
> Note that the reliance on `SDL_GetTicks()` means the timings break at some point after 49 days of game runtime, exactly once. This should result in a visible ""jitter"" effect if the 32-bits ticks value wraps around in the middle of a fade sequence, but other than that it's not that big of a deal to warrant requiring SDL 2.0.18+ for the 64-bit version.
"
1742041627,Random portraits,doofus-01,2024-02-25 05:22:20+00:00,2024-02-25 16:40:47+00:00,"{'Graphics': 1, 'Units': 1}","Mainly to fill the missing ""skeletal rider"", but some other things as well."
1741961702,Multiply help portait scaling by the pixel multiplier.,Pentarctagon,2024-02-24 22:21:59+00:00,2024-02-26 06:27:15+00:00,{'Help': 1},"Fixes #8275

------

Current:
![without](https://github.com/wesnoth/wesnoth/assets/3030250/9b70780f-d9b8-4656-9e0c-244481a26284)

With this PR:
![with1](https://github.com/wesnoth/wesnoth/assets/3030250/3e291f6a-2b8b-4acf-baf6-281c5e226091)
![with2](https://github.com/wesnoth/wesnoth/assets/3030250/b9b87ceb-34c3-4a6d-aa44-5c2f9dfad006)
"
1740453158,basic support for filtering campaigns based on completion status,babaissarkar,2024-02-23 10:16:17+00:00,2024-03-26 18:24:14+00:00,"{'Enhancement': 1, 'UI': 1}","Adds support to the campaign selection dialog so that the player can show/hide campaigns based on whether they are completed or not. Presently it does not support partial completion status, but I plan to add that in the future.
Addresses issue #8441.

![Screenshot from 2024-02-23 15-45-53](https://github.com/wesnoth/wesnoth/assets/8469888/7a9d0ca2-49ad-4aeb-83b7-05a51aa104b8)
"
1740182509,Bump vcpkg baseline,Vultraz,2024-02-23 07:01:05+00:00,2024-02-28 18:18:27+00:00,"{'Windows': 1, 'Building': 1}","Gives us (among other things) these updates:

Boost:             1.82                            -> 1.84
OpenSSL/libcrypto: 3.1.0a-dev (runtime 3.1.0a-dev) -> 3.2.0a-dev (runtime 3.2.0a-dev)
libcurl:           8.1.2 (runtime 8.1.2-DEV)       -> 8.6.0 (runtime 8.6.0-DEV)
Cairo:             1.17.8 (runtime 1.17.8)         -> 1.18.0 (runtime 1.18.0)
Pango:             1.50.14 (runtime 1.50.14)       -> 1.50.14 (runtime 1.50.14)
SDL:               2.26.5 (runtime 2.26.5)         -> 2.30.0 (runtime 2.30.0)
SDL_image:         2.6.3 (runtime 2.6.3)           -> 2.8.2 (runtime 2.8.2)
SDL_mixer:         2.6.3 (runtime 2.6.3)           -> 2.8.0 (runtime 2.8.0)"
1740119139,Keep laurel decorations consistent with difficulty level,Wedge009,2024-02-23 05:51:07+00:00,2024-02-28 03:03:53+00:00,"{'Backport': 1, 'UI': 1}","Still feels a bit clunky, but I'm following the pattern already used here:
https://github.com/wesnoth/wesnoth/blob/90a74e1b965b77b6abca46a4b7f94a297a290ab1/src/gui/dialogs/campaign_selection.cpp#L98-L110

This works for me, at least. Thanks to @CelticMinstrel for pointing me in the right direction. If there's a better way than just relying on the count of difficulties, please advise.

Resolves #8442. Should be back-ported to 1.18 branch, I think 1.16 as well unless there's absolutely no way there's going to be another release for it.

![image](https://github.com/wesnoth/wesnoth/assets/13679322/810eefc9-65fb-4b91-b0a6-d9341e4074a0)
"
1739993968,HttT S5b: Fix duplicate loyal trait for Delurin,irydacea,2024-02-23 02:37:13+00:00,2024-02-25 07:46:59+00:00,"{'Fwdport': 1, 'Campaign HttT': 1}","NAMED_LOYAL_UNIT has the loyal trait built in, so this results in an extra copy of it being granted to the unit."
1739970038,WoF: fixes for wmllint warnings,Jonathan-Kelly,2024-02-23 01:59:23+00:00,2024-03-05 07:56:05+00:00,"{'Campaign LoW': 1, 'Campaign SoF': 1, 'Campaign SotA': 1, 'Campaign WoF': 1}","Fixes an issue [discovered](https://github.com/wesnoth/wesnoth/pull/7908#discussion_r1495724310) by @Wedge009 in the wmllint logs, using the magic comment [suggested](https://github.com/wesnoth/wesnoth/pull/7908#discussion_r1496780958) by @CelticMinstrel. Also fixes three other WoF issues reported in the wmllint logs.

At least the ""wrongly capitalized variable name"" should be considered for backporting to 1.18 since it fixes a player affecting bug of one of their main character units (Resha) losing an upgrade object if it is given to her."
1738970100,"All ""Sands"" to ""Sand""",OrekOrek,2024-02-22 13:55:22+00:00,2024-04-03 14:25:08+00:00,{'Terrain': 1},Fixes #8434
1734621411,Correct image locations,Wedge009,2024-02-20 12:50:14+00:00,2024-02-21 00:11:12+00:00,"{'Backport': 1, 'Units': 1, 'Campaign SotA': 1}","Corrects some image paths as flagged by `wmllint`. This complements @pehjota's #8435/#8436 for #8432.

This should probably be back-ported to 1.18 branch."
1734608607,[1.18] Re-add the renamed/removed unit images in MP Aethermaw (#8432),pehjota,2024-02-20 12:43:07+00:00,2024-03-16 08:24:13+00:00,"{'Graphics': 1, 'MP': 1, 'Units': 1}","Playing the multiplayer scenario Aethermaw as Loyalists vs. Undead revealed some image errors (#8432):

    20240219 06:50:21 error image: could not open image 'units/undead/shadow-s-attack-1.png'
    20240219 06:50:21 error image: could not open image 'units/undead/shadow-s-attack-4.png'
    20240219 06:50:21 error image: could not open image 'units/undead/shadow-n-3.png'
    20240219 06:50:22 error image: could not open image 'units/undead/shadow-n-attack-2.png'
    20240219 06:50:26 error image: could not open image 'units/human-loyalists/spearman-attack-se-9.png'
    20240219 06:50:26 error image: could not open image 'units/human-loyalists/spearman-attack-se-10.png'
    20240219 06:50:26 error image: could not open image 'units/human-loyalists/spearman-attack-s-6.png'
    20240219 06:50:26 error image: could not open image 'units/human-loyalists/general-idle-5.png'

units/undead/shadow-* images were moved to units/undead-spirit/shadow-* in 1.17.4 commit a2ad3ae1988, specifically the ""1.17 undead sprite cleanup"" commit 961b8a3a323 of PR #6655.  This was documented on the forums:
https://forums.wesnoth.org/viewtopic.php?p=684291&hilit=units%2Fundead-spirit%2F#p684291

wmllint handles renamed images, but it also makes an enormous number of other (often questionable at best) changes (issue #5799).  So for now, instead of using wmllint, just update Aethermaw for these renamed images as follows (requires GNU sed):

    git grep -Fl -- 'units/undead/shadow-' \
        | grep -v '^data/tools/wmllint$' \
        | xargs sed -i 's|units/undead/shadow-|units/undead-spirit/shadow-|'

These units/human-loyalists/ images were removed in 1.17.12 commit 8e38cfd01ad, specifically the ""spearman image cleanup"" commit 775e7f8 and the ""remove left-over old general frames"" commit e07d554 in PR #7208.  But Aethermaw still uses them.

Restore the removed images that are still used:

    git grep -EIh -- '^[^#]*[{]PLACE_IMAGE[^ ]* +[(]?""?[^{}$ ~"")]+[ ~"")].*$' data/ \
        | sed -E 's|^.*[{]PLACE_IMAGE[^ ]* +[(]?""?([^{}$ ~"")]+)[ ~"")].*$|\1|' \
        | while read -r img; do
            [ -e data/core/images/${img} ] && continue
            [ -e data/campaigns/*/images/${img} ] && continue
            [ -e ${img} ] && continue
            git show 8e38cfd01ad~1:data/core/images/${img} 1>data/core/images/${img}
        done

Also add a CI check to prevent this from happening in the future. Example output without these Aethermaw fixes:

    data/multiplayer/scenarios/2p_Aethermaw.cfg:134: missing image: units/undead/shadow-s-attack-1.png
    data/multiplayer/scenarios/2p_Aethermaw.cfg:135: missing image: units/undead/shadow-n-attack-2.png
    data/multiplayer/scenarios/2p_Aethermaw.cfg:147: missing image: units/undead/shadow-n-3.png
    data/multiplayer/scenarios/2p_Aethermaw.cfg:149: missing image: units/undead/shadow-s-attack-4.png
    data/multiplayer/scenarios/2p_Aethermaw.cfg:196: missing image: units/human-loyalists/spearman-attack-se-10.png
    data/multiplayer/scenarios/2p_Aethermaw.cfg:197: missing image: units/human-loyalists/spearman-attack-s-6.png
    data/multiplayer/scenarios/2p_Aethermaw.cfg:198: missing image: units/human-loyalists/spearman-attack-se-9.png
    data/multiplayer/scenarios/2p_Aethermaw.cfg:203: missing image: units/human-loyalists/general-idle-5.png

See also #8435 for master."
1734608208,Re-add the renamed/removed unit images in MP Aethermaw (#8432),pehjota,2024-02-20 12:42:53+00:00,2024-03-26 18:23:22+00:00,"{'Graphics': 1, 'MP': 1, 'Units': 1}","Playing the multiplayer scenario Aethermaw as Loyalists vs. Undead revealed some image errors (#8432):

    20240219 06:50:21 error image: could not open image 'units/undead/shadow-s-attack-1.png'
    20240219 06:50:21 error image: could not open image 'units/undead/shadow-s-attack-4.png'
    20240219 06:50:21 error image: could not open image 'units/undead/shadow-n-3.png'
    20240219 06:50:22 error image: could not open image 'units/undead/shadow-n-attack-2.png'
    20240219 06:50:26 error image: could not open image 'units/human-loyalists/spearman-attack-se-9.png'
    20240219 06:50:26 error image: could not open image 'units/human-loyalists/spearman-attack-se-10.png'
    20240219 06:50:26 error image: could not open image 'units/human-loyalists/spearman-attack-s-6.png'
    20240219 06:50:26 error image: could not open image 'units/human-loyalists/general-idle-5.png'

units/undead/shadow-* images were moved to units/undead-spirit/shadow-* in 1.17.4 commit a2ad3ae1988, specifically the ""1.17 undead sprite cleanup"" commit 961b8a3a323 of PR #6655.  This was documented on the forums:
https://forums.wesnoth.org/viewtopic.php?p=684291&hilit=units%2Fundead-spirit%2F#p684291

wmllint handles renamed images, but it also makes an enormous number of other (often questionable at best) changes (issue #5799).  So for now, instead of using wmllint, just update Aethermaw for these renamed images as follows (requires GNU sed):

    git grep -Fl -- 'units/undead/shadow-' \
        | grep -v '^data/tools/wmllint$' \
        | xargs sed -i 's|units/undead/shadow-|units/undead-spirit/shadow-|'

These units/human-loyalists/ images were removed in 1.17.12 commit 8e38cfd01ad, specifically the ""spearman image cleanup"" commit 775e7f8 and the ""remove left-over old general frames"" commit e07d554 in PR #7208.  But Aethermaw still uses them.

Restore the removed images that are still used:

    git grep -EIh -- '^[^#]*[{]PLACE_IMAGE[^ ]* +[(]?""?[^{}$ ~"")]+[ ~"")].*$' data/ \
        | sed -E 's|^.*[{]PLACE_IMAGE[^ ]* +[(]?""?([^{}$ ~"")]+)[ ~"")].*$|\1|' \
        | while read -r img; do
            [ -e data/core/images/${img} ] && continue
            [ -e data/campaigns/*/images/${img} ] && continue
            [ -e ${img} ] && continue
            git show 8e38cfd01ad~1:data/core/images/${img} 1>data/core/images/${img}
        done

Also add a CI check to prevent this from happening in the future. Example output without these Aethermaw fixes:

    data/multiplayer/scenarios/2p_Aethermaw.cfg:134: missing image: units/undead/shadow-s-attack-1.png
    data/multiplayer/scenarios/2p_Aethermaw.cfg:135: missing image: units/undead/shadow-n-attack-2.png
    data/multiplayer/scenarios/2p_Aethermaw.cfg:147: missing image: units/undead/shadow-n-3.png
    data/multiplayer/scenarios/2p_Aethermaw.cfg:149: missing image: units/undead/shadow-s-attack-4.png
    data/multiplayer/scenarios/2p_Aethermaw.cfg:196: missing image: units/human-loyalists/spearman-attack-se-10.png
    data/multiplayer/scenarios/2p_Aethermaw.cfg:197: missing image: units/human-loyalists/spearman-attack-s-6.png
    data/multiplayer/scenarios/2p_Aethermaw.cfg:198: missing image: units/human-loyalists/spearman-attack-se-9.png
    data/multiplayer/scenarios/2p_Aethermaw.cfg:203: missing image: units/human-loyalists/general-idle-5.png

See also #8436 for 1.18."
1733302378,Remove new strings that were used for VALIDATE_WML_CHILD,stevecotton,2024-02-19 17:06:07+00:00,2024-02-19 22:11:06+00:00,"{'Bug': 1, 'UI': 1, 'Engine': 1}","This adds a new missing_mandatory_wml_tag() function, which returns a message using a common string, similar to the existing missing_mandatory_wml_key.

To avoid new strings in 1.18, the current implementation just calls missing_mandatory_wml_key directly."
1732911560,Add Bengali translation to the build scripts,stevecotton,2024-02-19 13:35:34+00:00,2024-02-19 23:08:10+00:00,{'Translations': 1},"The bn.po files have been build assuming the #8433 will merge as-is, so we have one new string in WoF but no new strings for the widgets.

No translated text yet, just template .po files."
1732459671,Revert IPF string handling optimisations,stevecotton,2024-02-19 09:18:18+00:00,2024-02-19 11:25:56+00:00,"{'Lua API': 1, 'Building': 1, 'Engine': 1}","When reverting this revert (after 1.18 has branched), the new .hpp file should be added to XCode and CodeBlocks.

This reverts PR #8396, PR #8407 and the ""Small fixup"" commit; they bumped the minimum compiler version from GCC 7 to 8 or 11.

This reverts commit 870eeff8e68de000bbe6608c2b6f982b28a2200f.
This reverts commit 029136b19acf9627170e9ab9383cea48b7d70a81.
This reverts commit d74ff6f31b3668d07236ffaa4059f31c373d4996.
This reverts commit 8a6de95d489b4e96d2c9a368b25a0c20e249cdf6.
This reverts commit d14d233d79957ddfcbe200d21f16ab78915c883b.
This reverts commit 698f5c115c1546e3fcf1c52be90d72a5a841abb6."
1731875351,ui: Visibly misaligned button text labels on Windows,irydacea,2024-02-18 23:26:57+00:00,2024-03-30 21:13:29+00:00,"{'Bug': 1, 'UI': 1}","Since some unknown point in Wesnoth 1.17.x's development, button text labels became horribly misaligned on Windows on 1080p screens, potentially as a side effect of one of the many changes intended to help in high DPI configurations.

I attempted a fix for this in this PR by removing the -2 px vertical offset from button labels, but it seems to have unexpected consequences on Linux (1080p) and macOS (high DPI) causing the labels to be visibly closer to the bottom of the button frame, which is not quite ideal either — even if it **does** solve the more visible misalignment on 1080p Windows. I can't quite tell if there might be a Windows-specific issue going on affecting the GUI canvas measurements.

## Windows (1080p)

**Before**
![Screenshot_1089](https://github.com/wesnoth/wesnoth/assets/489895/eaf987cb-3b76-4981-8cb6-297980f93d3b)

**After**
![Screenshot_1090](https://github.com/wesnoth/wesnoth/assets/489895/3cdc9d39-7273-4077-b7d2-0730a24cebd0)

## Linux (1080p)

**Before**
![Screenshot_20240218_201535](https://github.com/wesnoth/wesnoth/assets/489895/02798f88-e0b7-42d8-b3d6-033125e3e763)

**After**
![Screenshot_20240218_201619](https://github.com/wesnoth/wesnoth/assets/489895/6d79f261-7a10-46ea-bcea-d2953af33d9e)

## macOS (high DPI)

**Before**
![Screenshot 2024-02-18 at 20 14 38](https://github.com/wesnoth/wesnoth/assets/489895/066cd151-64a2-4fbe-88fa-d85bc0af2cc1)

**After**
![Screenshot 2024-02-18 at 20 14 12](https://github.com/wesnoth/wesnoth/assets/489895/61ee377a-7efe-4062-8b44-d23b7e2d724b)
"
1731779039,UtBS Units and Heroes: Fighter line adjustments and Taunting Strike xp farm fix,Hejnewar,2024-02-18 18:00:46+00:00,2024-02-18 20:04:29+00:00,"{'Units': 1, 'Campaign UtBS': 1}",As in title. 
1731768355,Fix increase by percentage returns 1 if experience or max_experience are equal to zero,newfrenchy83,2024-02-18 17:33:24+00:00,2024-02-19 12:49:09+00:00,"{'Unit Tests': 1, 'Units': 1}","
Resolve https://github.com/wesnoth/wesnoth/issues/8374 issue"
1731715434,HttT S06: Make Elensefar's defenses look damaged by the Orcish siege,stevecotton,2024-02-18 15:23:14+00:00,2024-02-26 10:31:38+00:00,"{'Enhancement': 1, 'Campaign HttT': 1}","Just some debris embellishments to suggest that the towers at the end of the bridges were hit with siege weapons.

The defense stats are unchanged and there's no dialogue change to go with this. I just looked at my old branch for #7369 again and thought that the map changes alone are probably worth having. (There isn't anything else in that branch either.)"
1731695878,UtBS S05: Stop moving when sighting ants and dwarf,stevecotton,2024-02-18 14:38:40+00:00,2024-03-30 12:13:38+00:00,"{'Enhancement': 1, 'Campaign UtBS': 1}","The stalactite and dwarf sighting became effectively a single event in a7680561d0e, so this combines them into one."
1731674208,DiD S10: Fix missing line in human heroes' book endings,stevecotton,2024-02-18 13:28:19+00:00,2024-02-18 15:43:54+00:00,"{'Bug': 1, 'Campaign DiD': 1}","A simple case of `role=unit` instead of `speaker=unit`, the necessary translatable text was already in the scenario.

Reported by JL42 in https://r.wesnoth.org/p686563 , it's a trivial fix so intending to merge once the CI's sanity checks are done."
1731171831,tweak UtBS difficulty,cooljeanius,2024-02-17 18:28:21+00:00,,"{'Ready for testing': 1, 'Units': 1, 'Campaign UtBS': 1}","Like with my previous campaign-related PRs (#5268, #5496, #5497, #5524, #5382, #5603, and #6057), this basically just attempts to apply the changes that I made to the campaign in question (UtBS in this case) during my most recent playthrough of it.
Closes cooljeanius/wesnoth_mods#9
Originally taken from https://github.com/cooljeanius/wesnoth_mods/tree/master/campaigns/Under_the_Burning_Suns/diffs
Note: contains string changes, so it'll have to wait until 1.19 or later.
"
1730932501,"EI S01, S13: Fix Gaennell's gender",stevecotton,2024-02-17 15:03:03+00:00,2024-02-17 19:24:08+00:00,"{'Bug': 1, 'Campaign EI': 1}","She's meant to be female, but in S01 the gender defaulted to male, while in S13 it was set to random.

Fixes #8389."
1730846038,Fix multiline_text's overriding of set_cursor,stevecotton,2024-02-17 13:14:20+00:00,2024-02-19 16:10:16+00:00,{'UI': 1},"When code in text_box_base.cpp calls the virtual method, it will only consider the 2-argument version, and thus skip the 3-argument wrapper. Override the 2-argument method to catch the calls and have the intended extra effect.

Note: in testing I don't see a difference in what happens in the UI, but I'm not familiar with the edge cases of this widget.
I just checked the stack traces to confirm that the call from text_box_base::insert_char skipped the wrapper.

This fixes a Clang warning, although the warning itself points out the opposite effect - that the 3-argument version hid the 2-argument one in the subclass.

Also fix a Clang warning that scroll_text could mark a method as an override."
1730177623,EI S11-S18: Add more PO hints,stevecotton,2024-02-16 19:54:38+00:00,2024-02-18 09:44:33+00:00,"{'Enhancement': 1, 'Translations': 1, 'Campaign EI': 1}","Has a few updates to S04a, S04b, S09 and S99 too. This isn't the complete set for S99, but it feels like a good stopping point if I want to get it reviewed in time for this weekend's release.

Lore: this declares Khrakrahs (dragon seen in SoF) to be male. He's been in many versions of Wesnoth that only had male drakes, thus will surely already be male in any translation where the gender has an effect on the wording.

There's a few questions and ""TODO for 1.19"" comments added:

* In S12, the left behind units say ""we must ride ... to save Wesnoth"", but it looks like that should be ""you must ride"".
* The intro of S13 is confusing, there's little indication of why you only have one unit, or what mission he failed.
* In S16, Gweddry says ""night approaches"" on turn 1 (morning)

This shouldn't cause merge conflicts with #8416, or with the (currently WIP) fix for #8389."
1729858472,EI - dra_nak_dead branch bugfix,Dalas121,2024-02-16 16:48:47+00:00,2024-02-17 02:52:27+00:00,{'Campaign EI': 1},"Fixes #8414.

S18 conditionally forwards the player to the bonus scenario, S99. One of the required conditions is that dra_nak_dead is not yes. The victory event of S12 unconditionally clears dra_nak_dead, meaning that that test in S18 will always pass.

S12 tests dra_nak_dead to see if he was killed in S11, and if he wasn't then it renames ""Varrak-Klar"" to ""Chief Dra-Nak"", as if Dra-Nak was pursuing the heroes. However, S12 doesn't set the dra_nak_dead variable if the renamed Varrak-Klar dies.
"
1729421629,Revert renaming of ai_helper.checked_move_core,ProditorMagnus,2024-02-16 12:18:28+00:00,2024-02-16 14:32:00+00:00,{'AI': 1},@CelticMinstrel fixes #8412
1725988928,Multiline Text Area bugfix,babaissarkar,2024-02-14 15:54:33+00:00,2024-02-17 11:50:09+00:00,"{'UI': 1, 'Schema': 1}","Fixes the following bugs :
1. Stop `scroll_text` from growing infinitely and instead show the scrollbars when the text dimensions exceed the default size of the underlying `multiline_text` in some dialogs (such as edit_pbl, the pbl publishing editor).
2. Allow `horizontal_grow`/`vertical_grow` to work correctly. Currently, the widget stops vertically growing due to absence of `max_height=0`, again in some specific dialogs."
1724950565,IPF: convert uses of lexical_cast_default to from_chars,Vultraz,2024-02-14 04:22:21+00:00,2024-02-16 06:46:49+00:00,{'Graphics': 1},CI run
1724675454,EI - fix S11 cell-door-open event,Dalas121,2024-02-13 21:59:24+00:00,2024-02-15 14:31:42+00:00,{'Campaign EI': 1},"You begin the scenario locked in a cell needing to escape through some caves, but it's possible to open the cell from the inside.  This fixes it.  #8386 "
1724619774,Tutorial: Specify the side of Li'sar in the char select,stevecotton,2024-02-13 21:10:34+00:00,2024-02-15 08:57:17+00:00,{'Campaign Tutorial': 1},"When a unit data passed to `to_map` either lacks a side or has side zero, implementation automatically sets it to 1, thus the existing code worked fine. However:

1. The lack of a `side` caused a warning in EmmyLua.

2. The tutorial should be good example code, and the special-case in the C++ code that made this work is a case of ""assume it's a SP situation, and choose the result that benefits side 1"".

Cherry-picked from #7359."
1724550799,"Fix Lua update documentation, $UID in Docker scripts, and execute permissions on installed scripts",pehjota,2024-02-13 20:14:00+00:00,2024-02-15 23:27:44+00:00,"{'WML Tools': 1, 'Lua API': 1, 'Campaign WoF': 1, 'Campaign WC': 1}","Add Dockerfile update to Lua update documentation
Another minor documentation improvement I should have thought to include in #8234 or #8394 (I knew I was forgetting something else...).

Replace Bash `$UID` with portable `$(id -u)` in Docker scripts
@Pentarctagon noticed in commit 9a34cbb3291 that `$UID` isn't set when `/bin/sh` isn't GNU Bash.  `id -u` is [specified by POSIX](https://pubs.opengroup.org/onlinepubs/9699919799.2018edition/utilities/id.html).
Also move `-xe` to a `set` command (in case someone runs scripts with `sh path/to/script` instead of `path/to/script`) and add `set -u` to complain more loudly about such unset variables.

Make TeamColorizer and update_pathfinding executable    
These scripts get installed but were missing execute mode bits."
1724511097,use scroll_text for pbl editor description,Pentarctagon,2024-02-13 19:39:21+00:00,2024-02-13 21:37:12+00:00,{'UI': 1},
1724123342,EI S05-S10: Add more PO hints,stevecotton,2024-02-13 15:23:07+00:00,2024-02-15 16:33:41+00:00,"{'Enhancement': 1, 'Translations': 1, 'Campaign EI': 1}","Please can I have a review, @Dalas121?

@nemaara this puts into comments the dates from the timeline that are mentioned in #8387, along with suggesting that that text will change to ""Early in the reign of ..."" in 1.19."
1723168643,IPF string view cleanup,Vultraz,2024-02-13 05:48:21+00:00,2024-02-13 23:12:26+00:00,{'Lua API': 1},"No functionality changes, just cleanup. Would like some thoughts on the from_chars wrapper."
1723089276,Add myself to about.cfg,pehjota,2024-02-13 03:57:15+00:00,2024-02-13 04:00:38+00:00,{},"Under ""Packagers"" and ""Miscellaneous Contributors""."
1723082984,Add CI update to Lua update documentation,pehjota,2024-02-13 03:49:14+00:00,2024-02-13 04:00:29+00:00,{},A minor documentation improvement I should have thought to include in #8234.
1722345320,EI: Avoid using an untranslatable name,stevecotton,2024-02-12 17:10:57+00:00,2024-02-13 17:48:26+00:00,"{'Bug': 1, 'Campaign EI': 1}","If Mal-Talar dies in S01 then a new leader (actually just a rename) turns up in S06b and S07b. That name needs to be translatable.

Edit: There was already a usable ""Mal-Bakral', so this doesn't need to add a new string."
1722238560,Redirect using C output instead of C++ output,Pentarctagon,2024-02-12 16:12:20+00:00,2024-02-17 15:28:08+00:00,{'Engine': 1},"Apparently redirecting stdout/stderr also results in std::cout/std::cerr being redirected, but not the reverse. This is not compatible with using boost's tee.

Fixes #8108
Fixes #8255

---

The uncommented code in log.cpp results in the following being logged to file:
```
0
1
2
3
4
wesnoth: src/wesnoth.cpp:1131: int main(int, char**): Assertion `false && ""5""' failed.
```

The commented code in log.cpp results in the following being logged to file (stdout/std::cout is missing):
```
0
1
3
wesnoth: src/wesnoth.cpp:1131: int main(int, char**): Assertion `false && ""5""' failed.
```
The commented code is based on the 1.16 code from log_windows, so I'm not sure why stdout doesn't get redirected correctly (it's neither in the log file nor present on the terminal - I've no idea where it's getting sent to):
https://github.com/wesnoth/wesnoth/blob/165d2ba37f2c95257a33ab916ca254594890278d/src/log_windows.cpp#L382

---

@Wedge009 would you be able to test if this works the same on Windows 10 1903 or later where the path to the log file contains non-ascii characters?"
1722028506,[1.19] Combobox,babaissarkar,2024-02-12 14:15:27+00:00,2024-05-06 04:26:44+00:00,"{'Enhancement': 1, 'macOS': 1, 'UI': 1, 'Building': 1, 'Schema': 1}","Intended for 1.19. Contains the combobox widget removed from PR #8199, and the `editable` property support in `text_box`, as well as the `tab_container` widget.

**Combobox** (issue #1024)
![Screenshot from 2024-01-02 21-00-51](https://github.com/wesnoth/wesnoth/assets/8469888/e0113271-4854-46b9-99f4-985453f8c299)

**Tab container** (only the top part)

https://github.com/wesnoth/wesnoth/assets/8469888/b9eb31a6-6999-4acd-ac56-a4b9506ad2fd

**Textbox**
Adds the ability to make the textbox uneditable via a `editable` key. Text can still be selected and copied, so this allows us to remove the various ""Copy..."" buttons present in various places.
"
1721603277,wmlxgettext: treat gender as a po hint,stevecotton,2024-02-12 09:51:51+00:00,2024-02-12 22:43:00+00:00,"{'Enhancement': 1, 'Translations': 1, 'WML Tools': 1}","This will automatically record the gender (if specified) of each `[unit]`, `[unit_type]` and `[side]` (leader).

The hint `gender=male,female` is often applied to `[unit_type]name=`, although that's usually the male name. I believe that's the only downside of this change.

Resolves #8382."
1721039908,[WoF] Avoid code duplication and fix a non-translatable string,CelticMinstrel,2024-02-11 18:18:00+00:00,2024-02-16 14:38:46+00:00,"{'MP': 1, 'Campaign WoF': 1}","Instead of copy-pasting the multiplayer turns over advantage function, just use that function directly.

This requires making some minor changes to the function for this specific use-case, but I think it's still better than copy-pasting it.

This also fixes #8368."
1721009542,Fix duplicate mod ids breaking mod selection,Pentarctagon,2024-02-11 16:42:00+00:00,2024-02-11 20:38:14+00:00,{'UI': 1},"Error string left as untranslatable for now due to string freeze.

Fixes #6780"
1720982347,"EI: fix Terraent standing animation, and update stats to match mainline",Dalas121,2024-02-11 15:17:05+00:00,2024-02-15 23:47:45+00:00,"{'Units': 1, 'Campaign EI': 1}","When Terraent was created, the mainline paladin had no standing anim. When that was added, it conflicted with Terraent's. This fixes that issue.

This also updates Terraent's other stats to match the mainline paladin's rebalanced stats.

#8371 

(is this an acceptable way to fix the issue?)"
1720977216,EI S06: fix enemy spawning event not triggering when turns end (#8376),Dalas121,2024-02-11 15:02:09+00:00,2024-02-12 11:30:42+00:00,"{'Bug': 1, 'Campaign EI': 1}","@tamanegi-jp thanks for the bug report. This PR should fix the issue.
"
1720957897,EI S01-S04x: Add more po hints,stevecotton,2024-02-11 14:00:27+00:00,2024-02-13 08:39:16+00:00,"{'Enhancement': 1, 'Translations': 1, 'Campaign EI': 1}","No changes to translatable strings, just to the hints.

@tamanegi-jp and @hermestrismi, is this the right sort and amount of comments? I'm intending to do another pass over the same scenario files and maybe add a bit more, hence the ""draft"" status of the PR."
1720952465,EI S04b: Fix Hahid's name having a trailing comma,stevecotton,2024-02-11 13:41:01+00:00,2024-02-11 15:55:20+00:00,"{'Bug': 1, 'Campaign EI': 1}","This doesn't change a translatable string, it removes a comma that was immediately after the translatable string.

Fixes #8372."
1720666400,"Add a composite hero/leader ellipse, closes #8011 closes #6258",ProditorMagnus,2024-02-10 17:35:08+00:00,2024-02-10 20:29:33+00:00,{'Graphics': 1},"Add a composite hero/leader ellipse, closes #8011 closes #6258"
1720482040,[dev] Remove unnecessary includes,xingwozhonghua126,2024-02-10 13:17:31+00:00,2024-02-13 20:06:39+00:00,"{'UI': 1, 'Achievements': 1}",
1719727166,"Avoid extra square brackets in ""missing key"" error dialogs",stevecotton,2024-02-09 17:20:18+00:00,2024-02-13 08:46:21+00:00,{'UI': 1},"This builds the standard text for errors such as
""In section '[styled_widget]' the mandatory key 'id' isn't set.""

However, if passed ""[styled_widget]"" as the section argument, the message would say ""[[styled_widget]]"". If passed ""styled_widget"", the doubled ""[["" and ""]]"" would still appear, along with an extra log message about the lack of square brackets.

Make calling it without square brackets the documentated way.

There are four calls to this that want to pass multiple tags, which I haven't changed. This means they'll still show doubled brackets, but as it's a message which should rarely be seen I feel that's better than having strings which look wrong in the source.

* gui/core/window_builder.cpp: ""[window][resolution]["" + tagname + ""]""
* gui/widgets/listbox.cpp: ""[list_data][row][column][widget]""
* theme.cpp: ""[theme][partialresolution][remove]""
* theme.cpp: ""[theme][partialresolution][change]""

Maybe we should revisit this for 1.19 (after the string freeze).

Fixes #8322

The changed behavior will be copied into a fix to #8175 - I'm planning to add a similar function with a standard message for having more than one instance of a mandatory key (when the max is 1)."
1718675099,Update COPYING.txt for jQuery and tablesorter,pehjota,2024-02-09 02:46:41+00:00,2024-02-09 03:39:17+00:00,{'WML Tools': 1},"Commit 81c31c40c53 updated jQuery to 3.7.0 and tablesorter to 2.31.3.

Update homepages, in particular for the tablesorter fork.

jQuery dropped the confusing and unnecessary dual licensing in 2012:
- https://blog.jquery.com/2012/09/10/jquery-licensing-changes/

Also specify the GPL version used by tablesorter and clarify the ""MIT"" license.  The license actually comes from Expat and is one of many licenses used by MIT (including the X11 license, which is also commonly called ""the MIT license""):
- https://en.wikipedia.org/wiki/MIT_License#Ambiguity_and_variants
- https://www.gnu.org/licenses/license-list.html#Expat"
1715824475,SoF S02: Alanin has planned (unshrouded) his escape route,stevecotton,2024-02-07 14:45:11+00:00,2024-02-07 23:47:28+00:00,{'Campaign SoF': 1},"The intro to this map shows Rugnur running into the stronghold, with the elves not far behind. Those moves were running into shroud, which generated ""could not find move_unit_fake route"" warnings because the animation prefers routes that moving side can already see.

Also, have the conversation between Alanin and Rugnur take place with Alanin on a road hex, because if he starts on the keep then he takes a long route to avoid cave terrain.

Fixes #8350."
1714694050,"[Lua] Clean up inconsistencies in mapgen filter API, and improve documentation",CelticMinstrel,2024-02-07 00:11:38+00:00,2024-07-21 23:58:03+00:00,"{'AI': 1, 'Lua API': 1, 'Campaign WC': 1}","I split this from #7359 so that @gfgtdf can easily review and merge it. It looks like several places are just doing entirely the wrong thing. I haven't verified that I caught _every_ place with this issue, but it's likely that I did, as I think they all would've raised the same warning in my Lua linter."
1712886430,Fix copyrights.csv quoting and extra fields,pehjota,2024-02-06 03:42:07+00:00,2024-02-07 10:12:56+00:00,{'Docs': 1},"The first `update_copyrights` run writes output without quoting fields that contain commas, so the second run parses them as multiple fields and adds a ""missing"" extra field to each of all the other rows.  The first commit fixes this by using a `csv.writer()` object instead of `str.join()` to format rows for output.  It also undoes the removal of commas from fields that was necessary in commit 676c1fa2b98.

The second commit adds a check for extra or missing fields, which would have caught the aforementioned issue but now caught another one: three rows added in commit c6313453143c had duplicated MD5 fields."
1711707738,Use -Wno-dangling-reference when building with GCC-13,stevecotton,2024-02-05 13:40:22+00:00,2024-02-05 19:03:40+00:00,"{'Building': 1, 'SCons': 1, 'CMake': 1}","Version 13 of GCC added the -Wdangling-reference option, however due to false positives it had to be moved from -Wall to -Wextra. Discussion about its status in GCC-14 is in
https://gcc.gnu.org/bugzilla/show_bug.cgi?id=110075

The docs don't explain exactly what triggers the warning, but here's the explanation from https://gcc.gnu.org/bugzilla/show_bug.cgi?id=106393#c1
> The warning works by checking if a reference is initialized with a function
> that returns a reference, and at least one parameter of the function is a
> reference that is bound to a temporary. It assumes that such a function
> actually returns one of its arguments! ... suppress the warning when we've
> seen the definition of the function and we can say that it can return a
> variable with static storage duration.

Consistent with that, we're getting warnings on functions of the form find(container, const std::string&). All of the things triggering it seem to be false positives:

* Calls to find_widget<...>.
* Calls to theme::get_theme_config.
* Calls to race::gender_value.
* In src/actions/attack.cpp, any `attacker->attacks()[i]`. Although there's an iterator in there, the eventual reference is to a member of the array, not the iterator.
* In src/gui/dialogs/unit_advance.cpp, `cfg.child_range(""..."").back()` That returns an object indirectly owned by cfg.

We'd like the other warnings of -Wextra, so turn off -Wdangling-reference.

Fixes #8334 in a least-changes way. Alternatively, there's a new `#pragma` that could be used to mark `find_widget` etc as not returning a pointer into the temporary argument."
1710595797,Avoid linebreak in title text of help pages,sevu,2024-02-04 22:59:22+00:00,2024-02-05 03:20:53+00:00,{'Help': 1},"Displaying variations in the help has some rough edges. This is a patch from the liked PR which, while it can be further improved, is still good enough to improve the situation. Changes:

* Doesn't clutter unit help tree when a unit variation is displayed (that's the main problem. Doofus posted a before/after image is in the issue.)

* When displaying a unit variation in the help, it displays the links below the unit image at the same line as when displaying the base unit (That's a side effect)

Room for further improvement improvement:
Change the code so that not the same text is used in both places. Sidebar should stay as with this change, but help page couls show the Type Name with the variation in parentheses in the same line, instead of with the line break as before, or not at all with this change. But as we don't have that currently, I'm proposing to add this patch from #6011"
1710343113,Remove unnecessary includes,xingwozhonghua126,2024-02-04 11:19:13+00:00,2024-02-08 15:40:17+00:00,{'Schema': 1},
1710002852,SoF S02: Don't [allow_undo] when activating the runes,stevecotton,2024-02-03 19:32:50+00:00,2024-02-05 15:18:34+00:00,{'Campaign SoF': 1},"Standing on the runes changes some hexes to impassable, so it's a change to the game state. It isn't a random event, so it would be possible to add an [on_undo], but that seems unnecessary, and would need to handle multiple runes.

Fixes #8343 (assuming that @alberic89 confirms that it's only happened in this scenario)."
1709987091,1.18 - remove LAYER argument from main Cud wall rule,doofus-01,2024-02-03 18:26:21+00:00,2024-02-03 22:57:45+00:00,{'Terrain': 1},"fixes #8333 
removes something added in b4471f3 that might have been ghost of an abandoned plan that crept in, because I'm not seeing the reason for it now."
1709747870,UtBS: Fix poison bug?,PointMeAtTheDawn,2024-02-03 08:34:07+00:00,2024-02-03 17:52:45+00:00,"{'Units': 1, 'Campaign UtBS': 1}","https://github.com/wesnoth/wesnoth/issues/8324

Frankly I have no idea if this actually fixes the issue, or why it was causing it. I left it in the COMMON_AMLA. I tested it sporadically and it appears consistent to me but someone who actually understands what's happening please weigh in before merging :p."
1709682621,Force the UI to update fully when changing addon filters,Pentarctagon,2024-02-03 06:15:38+00:00,2024-02-04 18:03:00+00:00,{'UI': 1},"content_resize_request() doesn't appear to return the correct result in this case, even when the number of rows to display has increased.

Fix #7270"
1709489356,wc: fix #6513  Bezoar artifact,gfgtdf,2024-02-03 00:29:47+00:00,2024-02-17 22:25:07+00:00,{'Campaign WC': 1},"The item now applies the effects directly instead of using [trait]s,  The lua code that added traits in the wc lua files didn't work, but the main reason why i preferred  this solution instead of changing the lua files is that it makes it possible to simply remove the artifact via for example [remove_object] (which wouldn't work for artifacts using traits as those are separate modifications)

The code now also adds a dummy ability so that players know that this unit has the benefits of the healthy fearless and  undead  traits."
1709254843,"Add a composite hero/leader ellipse, closes #8011 closes #6258",ProditorMagnus,2024-02-02 21:16:57+00:00,2024-02-10 20:34:31+00:00,{'Graphics': 1},"Add a composite hero/leader ellipse, closes #8011 closes #6258"
1709019792,Remove transparent padding from the status icon image files.,Pentarctagon,2024-02-02 18:49:22+00:00,2024-02-04 16:56:03+00:00,"{'Graphics': 1, 'Campaign UtBS': 1}","Just removing transparency from all images on the top bar and side bar causes other issues, particularly with the unit sprite and the clock icon alignment.

Fixes #8335"
1708704641,Remove unused header files,xingwozhonghua126,2024-02-02 15:42:17+00:00,2024-02-03 19:21:57+00:00,{'Building': 1},
1708560796,[1.16] Remove fonts not used since SDL_ttf was replaced,pehjota,2024-02-02 14:17:40+00:00,2024-02-03 10:01:46+00:00,"{'UI': 1, 'Stable 1.16': 1}","The Andagii, Droid Sans Fallback, and Droid Sans Japanese fonts were mentioned in WML `[fonts][font]` tags in `data/hardwired/fonts.cfg`, which were removed along with the engine code to read them in commit e0d60b0e2bc (version 1.15.14).  That code was unused since SDL_ttf wrapper code was removed in commit 2dfdc0061d4 (version 1.15.11).

Tested by selecting the Japanese (`ja_JP`) locale with these fonts removed and no system copies installed.  Also confirmed by running wesnoth under strace before and after removing the fonts to verify that it doesn't attempt to open them.

The only remaining references to these fonts are PO file message entries from `data/hardwired/fonts.cfg` which were marked obsolete (beginning with `#~`) in commit fecfe194803 (version 1.15.14).

See also #8330 for master."
1708560697,Remove fonts not used since SDL_ttf was replaced,pehjota,2024-02-02 14:17:37+00:00,2024-02-03 10:07:17+00:00,{'UI': 1},"The Andagii, Droid Sans Fallback, and Droid Sans Japanese fonts were mentioned in WML `[fonts][font]` tags in `data/hardwired/fonts.cfg`, which were removed along with the engine code to read them in commit e0d60b0e2bc (version 1.15.14).  That code was unused since SDL_ttf wrapper code was removed in commit 2dfdc0061d4 (version 1.15.11).

Tested by selecting the Japanese (`ja_JP`) locale with these fonts removed and no system copies installed.  Also confirmed by running wesnoth under strace before and after removing the fonts to verify that it doesn't attempt to open them.

The only remaining references to these fonts are PO file message entries from `data/hardwired/fonts.cfg` which were marked obsolete (beginning with `#~`) in commit fecfe194803 (version 1.15.14).

See also #8331 for 1.16."
1708291476,changelog: add missing unit type ID prefix to clarify ambiguity,knyghtmare,2024-02-02 11:46:17+00:00,2024-02-02 13:28:33+00:00,{'Docs': 1},"Doing so since we have three Javelineers:

- Javelineer (Loyalist)
- Merman Javelineer (Rebels)
- Saurian Javelineer (core/pseudo-Drakes)

One can easily mistake the loyalist one for the merman one here."
1707307413,updated copyright in WML tool GUI app,knyghtmare,2024-02-01 22:49:38+00:00,2024-02-27 05:37:03+00:00,{'WML Tools': 1},From 2016 to 2024
1706344614,HttT S11 Make the objective clearer,OrekOrek,2024-02-01 14:06:26+00:00,2024-02-12 11:29:53+00:00,"{'Enhancement': 1, 'Campaign HttT': 1}","For almost 20 years, ""Move Konrad to the north side of the river"" has been criticized for being misleading and unclear objective because “the north side” does not include sand hexes. There are dozens of posts pointing this out in [the campaign feedback thread](https://forums.wesnoth.org/viewtopic.php?t=8716).

Therefore, “past the sandy shores” is added to the objective sentence. I’m not sure if this is a correct, natural, and clear English expression, so I don’t mind seeing it replaced by better wording.

Also, currently, only y=1~8 hexes trigger the scenario end event, but some grass hexes are y=9 (picture). Therefore, all the non-sand hexes in the north are specified in the fixed version.

![HttT-11-xy](https://github.com/wesnoth/wesnoth/assets/155947547/5c8bf1c3-a573-4668-87d9-ddac3000fe74)

"
1703286138,Log instead of assert for incorrect [teleport] tags in ActionWML,stevecotton,2024-01-31 03:26:56+00:00,2024-02-09 13:45:04+00:00,{'Schema': 1},"Each [teleport] tag should have exactly one each of [source], [target] and [filter]. Missing any of those is caught immediately above the new conditional block, so this makes having two or more of any of them be treated the same.

The log should maybe be made more visible, but it's a case that can already be detected by schema validation, so validate it there instead.

The code in teleport.cpp uses assert() in the cases that the newly-added code in this commit catches. That's bug #8175, and it's probably still reachable for units with teleport abilities, so this doesn't close that bug. The change in #8223 should still be added as well."
1702814759,Re-add cropping of transparent padding on status icons.,Pentarctagon,2024-01-30 20:15:25+00:00,2024-02-01 15:32:15+00:00,{},Fixes #8303
1702203213,"HttT S14 Use ""id="" to remove Gryphon units",OrekOrek,2024-01-30 14:25:56+00:00,2024-01-30 16:55:47+00:00,{'Campaign HttT': 1},"Usually, when (14, 23) is unoccupied by any unit,
(14, 23) = Kalenz
(13, 23) = Gryphon
(12, 22) = irrelevant
, and then the Gryphon is killed by the current code.

However, when (14, 23) is occupied either by an ally or enemy unit (picture below),
(14, 23) = occupied
(13, 23) = Kalenz
(12, 22) = Gryphon
, and then the Gryphon stays there and joins the recall list.

(15, 19) is almost always unoccupied, but the same problem can occur.

Therefore, this fix uses ""id="" instead of positions to make sure that Gryphons are removed no matter where they are on the map, just like how Gryphon Tender (Elvish Shaman) is removed by the current code.

Relevant forum posts: [Feedback by Orek (me)](https://forums.wesnoth.org/viewtopic.php?p=681283#p681283), [Feedback by JL42](https://forums.wesnoth.org/viewtopic.php?p=685757#p685757)

![HttT-14-Gryphon-xy](https://github.com/wesnoth/wesnoth/assets/155947547/fe1ae86e-03b4-4305-baf9-8b00c1f5612b)"
1700704151,fix (most parts of) 7780 make unit_placed events nonundoable by default,gfgtdf,2024-01-29 20:01:00+00:00,2024-01-31 01:53:55+00:00,{'Engine': 1},"There are still other places in the code that call unit_placed so there might be some cases left where unit_placed don't prevent undoing, but most of them are nonundoable anyways."
1699994668,HttT S17 Map always has 6 castle hexes around Konrad,OrekOrek,2024-01-29 13:39:49+00:00,2024-02-17 17:05:18+00:00,{'Campaign HttT': 1},"Relevant forum post: [https://forums.wesnoth.org/viewtopic.php?p=683820#p683820](https://forums.wesnoth.org/viewtopic.php?p=683820#p683820)

Most of the time, Konrad can recruit/recall 6 units per turn. However, when he spawns at the very bottom of the map, some hexes are outside the map boundary, and therefore, only 5 or 3 units can be recruited/recalled. To fix this problem, 1 castle hex is added when he is at (odd, 68), and 3 castle hexes are added when he is at (even, 68).

![HttT-17-CastlesAddedSmall](https://github.com/wesnoth/wesnoth/assets/155947547/fee4b977-fe73-492d-b050-e9a83fc33708)

These added codes are made based on the codes immediately above (line 445~473). If more experienced people can come up with better and more concise codes to achieve the same outcome, I am all for it."
1698889981,1.18 - fix terrain graphics rule for elevation/ice/water transition,doofus-01,2024-01-28 18:03:45+00:00,2024-01-29 01:42:38+00:00,{'Terrain': 1},"Allows for more flag-based filtering, so that the ice transitions can be disabled in the little hole in the upper right, but still works for the same terrain inside the big gulch region.
![Screenshot_20240128_](https://github.com/wesnoth/wesnoth/assets/13510196/e0e45364-57fc-4ff0-9557-ad5461910f59)
"
1698777870,"Revert ""Check for correct openssl version.""",pehjota,2024-01-28 12:43:44+00:00,2024-01-28 17:27:43+00:00,"{'Building': 1, 'CMake': 1}","This reverts commits 7ce1bf9f7da and c6a2dc93175.

OpenSSL >= 3.0 was required (but only when building with CMake) so that `src/preferences/credentials.cpp` could use `EVP_EncryptInit_ex2()` (commit a880f01a315), but that change was reverted (commit 83ab05532a9), all within three hours.

Tested locally by building with OpenSSL version 1.1.1w, logging into the lobby with ""Save password locally (encrypted)"" checked, quitting, and logging in again without having to enter a password.

@Pentarctagon"
1698065843,add an optional delay argument to scroll.,Pentarctagon,2024-01-27 05:03:33+00:00,2024-01-29 06:48:06+00:00,"{'Lua API': 1, 'Schema': 1}",Fixes #8276
1697940100,Handle Dust Devil overlays,PointMeAtTheDawn,2024-01-27 00:00:37+00:00,2024-01-30 17:50:01+00:00,"{'Units': 1, 'Campaign UtBS': 1}",
1697653184,Clarify whether add_source_file should add .hpp files,stevecotton,2024-01-26 19:13:58+00:00,2024-01-30 08:41:26+00:00,{'Building': 1},"Only add files that were named on the command line, don't implicitly add a .hpp file when the .cpp file was given. Previously the script both needed the .hpp (for Xcode) and failed when the .hpp was given (for CodeBlocks).

Add the following checks, and if any of them fail exit before making any changes. Also add a --no-checks option to proceed anyway.

* Check the files exist
* If a .cpp is given and the .hpp exists, check it was given too.
* If a .hpp is given and the .cpp exists, check it was given too.

For the files used by CMake and SCons, .hpp files were never added, and they still won't be.

PR #8301 is a draft, but has successfully compiled on the CI with files added with this script. The numbers in Xcode files are randomly generated UUIDs, so they change each time the script is run - there's no way to check that it generates exactly the same output.

Fixes #8291."
1697280452,Encapsulate side numbers in team queries,stevecotton,2024-01-26 14:47:14+00:00,2025-08-21 00:39:05+00:00,"{'macOS': 1, 'AI': 1, 'Building': 1}","Draft, PR opened to test a new version of the add_source_files script on the CI.

WML numbers sides starting from 1, C++ likes indicies to start from zero, and so dealing directly with a vector of sides requires handling the off-by-one numbering.This wrapper encapsulates that logic.

This is a draft, looking at whether it would remove knowledge of the off-by-one quirk from a sufficient number of places in the source tree to be useful. It's a suggestion for reducing the number of files involved in PR #8271.

A wrapper for the sides or teams array, answering questions such as ""are these units on the same side"".
"
1697266767,[`bug_report.yml`]: change comma to full-stop,knyghtmare,2024-01-26 14:37:19+00:00,2024-01-26 14:39:08+00:00,{},Fixed a typo
1697259109,"Remove warning 'Weapon special x has no name for', fixes #8298",ProditorMagnus,2024-01-26 14:31:47+00:00,2024-01-26 15:21:15+00:00,{'WML Tools': 1},fixes #8298
1696137579,Fix Kaleh sword parry,PointMeAtTheDawn,2024-01-25 19:07:35+00:00,2024-01-25 19:42:07+00:00,"{'Units': 1, 'Campaign UtBS': 1}",Nym's 2 parry adjustments function as expected. Kaleh's does not as it uses improper WML. It should use increase_parry instead of parry.
1695945464,Re-sets the standing animation before and after the temporary_unit_mover moves the unit,Pentarctagon,2024-01-25 16:45:03+00:00,2024-01-26 22:18:46+00:00,"{'Unit Tests': 1, 'Units': 1}",Fixes #6960
1695723721,Use argparse for add_source_file,stevecotton,2024-01-25 14:37:51+00:00,2024-01-26 12:03:05+00:00,"{'Enhancement': 1, 'Building': 1}","Treat an argument of ""--help"" as a request to print help, instead of a filename to add to the source lists.

Treat the arguments ""src/foo.cpp"" ""src/foo.hpp"" as two filenames, instead of adding src/foo.cpp to target src/foo.hpp. The old command line

    ./add_source_file a b c

becomes

    ./add_source_file a --target b --target c

When saying that pbxproj is required, suggest optionally using a venv instead of installing systemwide.

Fixes the ""obnoxious behavior"" noted in #8291, but not the issue about .hpp files that's reported there."
1695571144,HttT S12 Snow falls at a constant pace,OrekOrek,2024-01-25 13:04:47+00:00,2024-01-28 17:49:35+00:00,{'Campaign HttT': 1},"
Currently, snowfall is not at a constant pace as intended.
707 hexes of 10 terrain types (Gs,Gd,Co,Ko,Gll^Fp,Gll^Fmw,Gll^Fdw,Gd^Vo,Gd^Vc,Hhd^Vo) are converted to snowy terrains. Therefore, on challenging difficulty with 28 turn limit (=27 snowfall turns), it should be (26 hexes converted*22 turns) + (27 hexes converted*5 turns)=707 hexes. However, according to my experiments, 21~30 hexes are randomly converted. Removing Re and Rb from filtered locations should solve this problem.

Line 227 (original):
Re, Rb are dirt, and these hexes are not converted to snowy terrain. However, by having them within [filter_location], the snowfall pace fluctuates. Also, Hhd^Vc doesn't exist on this map.

Line 258~269 (original):
Coa and Hhd are not filtered.

Line306~311 (original)
Hhd^Vc doesn't exist on this map.

These changes make snow fall at a constant pace. Also, unnecessary codes are deleted."
1694877696,"[1.16] Revert ""systemd: drop _ prefix from username""",pehjota,2024-01-25 05:12:45+00:00,2024-01-25 08:33:06+00:00,{'Packaging': 1},"Prefixing all system and group names with the underscore is recommended by the systemd developers.

This reverts commit 8b6ef6aeeb80273a5826e2a25fffe5a2ca26a529.

(cherry picked from commit 91bd96b319ffa4b33fcfb33dce03c529aa480509)

1.17.25 was released using `_wesnoth:_wesnoth`.  So should be the upcoming 1.16.12.

Some discussion in https://github.com/wesnoth/wesnoth/pull/8168#issuecomment-1898040835.

Ping @stevecotton"
1694639660,Backstab unit tests: check that backstab works in a free-for-all,stevecotton,2024-01-24 23:44:22+00:00,2024-01-26 14:35:07+00:00,{'Unit Tests': 1},"The units on the outsides of a backstab don't have to be allied to each other, they just have to be enemies of the victim. That's hardcoded into the AI via attack.cpp's backstab_check() function, hence a unit test to check that WEAPON_SPECIAL_BACKSTAB activates in that situation.

Add a new map with 4 sides all on separate castles. This is a variation of the generic 2p unit test map, extended in the south with a horizontal reflection of existing map.

Add a MAP_FILE argument to COMMON_KEEP_A_B_C_D_UNIT_TEST, because it's the same setup except for the map file."
1694560195,Restore 'screen shake' animations,Wedge009,2024-01-24 22:30:26+00:00,2024-01-25 06:14:10+00:00,"{'Graphics': 1, 'WML': 1, 'Campaign UtBS': 1}","Resolves #8276.

With the new draw manager introduced in 1.17.6 it appears the `[scroll]` animations are playing too fast to be noticeable, so introduce a `[delay]` similar to other macros (eg `MEMOIRS_TREMOR`).

As mentioned in #8276, I have left the `[scroll]`s in UtBS S12 alone because they don't appear to do anything, even in 1.16."
1692606561,UtBS fixes,Hejnewar,2024-01-23 21:36:32+00:00,2024-02-18 13:44:54+00:00,{'Campaign UtBS': 1},"Fixes #8201, #8198, #8190, #8188 (very not great fix but works), #8184 and a bit more"
1690716377,Fix tmpfiles.conf and sysusers.conf paths in SConstruct.,limburgher,2024-01-22 22:45:47+00:00,2024-01-23 01:07:45+00:00,"{'Building': 1, 'SCons': 1}",
1689808108,Fix deprecation warning when setting [endlevel]end_credits=,stevecotton,2024-01-22 13:12:23+00:00,2024-02-02 15:04:27+00:00,"{'Unit Tests': 1, 'Lua API': 1}","Change the Lua implementation to directly call the non-deprecated function, this is related to 9daa10a9f2.

Clean up the C++ header files by removing the declarations of functions that were removed in 3c8de46771.

Use [endlevel]end_credits=no in the test scenario (trigger it by moving to hex 9,3). If you debug with :next_level without triggering the moveto, ""The End"" will show; trigger the moveto first, and it won't show the credits."
1688819456,Expose weapon data in weapon special formula,CelticMinstrel,2024-01-21 21:27:45+00:00,,"{'Unit Tests': 1, 'Units': 1}","I haven't tested this at all, other than to confirm it compiles."
1688522028,Refactor the sides list to use 1-indexing everywhere,CelticMinstrel,2024-01-21 04:04:09+00:00,2024-09-03 17:36:20+00:00,"{'AI': 1, 'MP': 1, 'UI': 1, 'Editor': 1, 'Units': 1, 'Lua API': 1, 'WFL': 1}","The intent behind this was to fix #6230 by changing the underlying container type from `vector` to `deque`, but that turned out to be a pretty intrusive change due to the `vector` type being baked into the interface and spiralling out to several other classes as well.

So I decided to normalize the side indexing system at the same time so that the sides list is always indexed from 1 instead of 0. 

With this refactor it should also be relatively easy to switch out `deque` for something else later on if we wanted to, such as `boost::stable_vector`.

It's not done and doesn't even build yet – there are link errors because I haven't finished implementing `ordinal_list`, and I reduced my initial workload by deprecating some functions which I still need to go through and replace. However, I thought it would be better to have other eyes on it sooner rather than later. I still need to comb through the source for all references to sides, looking for places that add or subtract 1 from a side index, or loops that iterate from `0` to `size() - 1` instead of `1` to `size()`, or places that use the side number to index other lists. If anyone happens to spot any such locations, please point them out to me. Code style comments and the like are welcome too.

Ignore the event handler commit for now. I'll rebase it away later."
1688404756,EI S11: Correct a couple of [message]message= to [message]female_message=,stevecotton,2024-01-21 00:05:27+00:00,2024-01-21 01:11:12+00:00,{'Campaign EI': 1},Fixup to #8268
1688313275,UtBS Balance,Hejnewar,2024-01-20 17:18:12+00:00,2024-01-21 00:15:14+00:00,"{'Enhancement': 1, 'Units': 1, 'Campaign UtBS': 1}","As in title, some bug fixes, balance and some more balance.

S1 - Way too easy. I still comfortably won S1 after changes. 
S4 - Just slightly too hard in my taste no major. 
S5 - One of the two scenarios that actually got harder with the update. Maybe I even made it bit too easy but will see later. 
S11 - The second harder scenario. Also perhaps too easy now, maybe Im just playing it somewhat unoptimally, will see if I can find better way. 

Dust Devil - The amlas were joke for this kind of xp. 
L1 units - just price updates in later scenarios. 
Stalwart and Protector - I found it way more fun when there was a unit that is very strong, very expensive and takes 5-6 scenarios to level up. Also not at all op. 
Sun Ladies - general buffs, when I generally though of them I didnt take into consideration some things and now they came out so buffs. 

Bunch of AMLA updates for heroes. 
Bunch of ability fixes. 

Return to 100/150/200% xp. 306xp for lvl 3 is the way. 

Ideally merged before next version, no string changes. "
1688227522,"EI: fix macros in translatable strings, improve po hints",stevecotton,2024-01-20 14:05:47+00:00,2024-01-20 22:58:11+00:00,"{'Prose': 1, 'Campaign EI': 1}","In S11, make the first deserter always male so the translations don't need to worry about gender variants.

Fixes #8225. Most the new strings are ones that had to be added to replace the strings that contained macros. The deserter mechanism included strings that had to change, so a few of the deserter-related strings in S11 have also been split for male/female speakers; I think that's a bug-fix, and those strings are currently only translated in `en_GB` and `sk` (plus any translation that's not yet reached @ivanovic )."
1688167193,"WoF S02: Rename the orc team to ""Trespassers""",stevecotton,2024-01-20 09:50:59+00:00,2024-01-20 21:22:22+00:00,"{'Prose': 1, 'Campaign WoF': 1}","The drakes' dialogue is unchanged, so Vladnir still calls them ""infesters"", this just removes the term from the UI.

Ping: @Jonathan-Kelly @CelticMinstrel @demario-w"
1685723161,"Set filelist parameter in CrossRefLister constructor call, fixes #7841",ProditorMagnus,2024-01-18 23:23:44+00:00,2024-01-19 13:20:08+00:00,{'WML Tools': 1},
1685497117,Add missing names to about.cfg,Pentarctagon,2024-01-18 20:34:59+00:00,2024-01-19 22:16:31+00:00,"{'Docs': 1, 'Help': 1}",Fixes #6475
1685249859,"Show accuracy/parry as weapon specials in html, fixes #7895",ProditorMagnus,2024-01-18 17:17:26+00:00,2024-01-18 21:01:54+00:00,{'WML Tools': 1},"Not tested, and not planning to personally test until #3953

Given attack has accuracy=2 and parry=3, unit would show instead of current 
12 × 5 ranged (arcane) (pierce, skilled)
12 × 5 ranged (arcane) (pierce, skilled, accuracy 2%, parry 3%)"
1685107187,Update Morogor Dialect notes,CelticMinstrel,2024-01-18 15:50:34+00:00,2024-01-20 19:20:25+00:00,{'Campaign WoF': 1},"Address a few weird or problematic entries in the glossary. This also makes it use the term ""glossary"" instead of ""dictionary"", as that's what it really is."
1683657338,"Add warning when [modification]type is not set, re #3415",ProditorMagnus,2024-01-17 20:47:59+00:00,2024-01-18 01:48:44+00:00,{'Schema': 1},
1683212254,Double check executables were produced,soliton-,2024-01-17 15:41:39+00:00,2024-01-18 10:47:34+00:00,{'CI': 1},
1681361695,"copyrights.csv: Fix and check ""License"" and ""Needs Updated"" fields",pehjota,2024-01-16 16:26:27+00:00,2024-01-31 03:20:10+00:00,{'Docs': 1},"Commit 97c8feb8ca3b (pull #7903) included a comma in the ""Notes"" field of four files, which instead of being enclosed in quotes, overflowed into the ""Needs Update"" field.  So if those files are updated, update_copyrights would clobber part of the notes.

The same commit specified for 58 of LordBob's portraits a license of ""GNU GPL v2+;CC BY-SA 4.0"".  I don't know if the semicolon is supposed to mean ""and"" or ""or"".

""And"" isn't legally possible, because the GPL doesn't allow others to relicense under CC BY-SA.  ""Or"" appears incorrect, because LordBob [licensed][1] his portraits under ""the GNU GPL"" and I can't find any evidence of him also licensing them under CC BY-SA 4.0.

@Pentarctagon, is this license fix correct, or did LordBob relicense some (but not all) of his portraits somewhere I can't find?

Commit 1ecd4f4d599c (pull #8195) updated the ""Date"" field but didn't clear ""Needs Update"" after update_copyrights set ""Needs Update"" and ""MD5"" for data/core/images/units/monsters/raven/harbinger.png.

@doofus-01, is the row for data/core/images/units/monsters/raven/harbinger.png otherwise up-to-date?

Make update_copyrights check for and warn about ""Needs Update"" instead of clobbering it.  This should trigger CI failures if someone forgets to update a row or accidentally puts into the ""Needs Update"" field important information that shouldn't be clobbered on future updates.

And make it check for and warn about possibly invalid licenses like ""GNU GPL v2+;CC BY-SA 4.0"".

[1]: https://forums.wesnoth.org/viewtopic.php?p=329342#p329342"
1681280826,Rebalance utbs amla,newfrenchy83,2024-01-16 15:37:51+00:00,2024-01-21 00:14:54+00:00,"{'Units': 1, 'Campaign UtBS': 1}","So that the player can navigate all the improvement choices, I decided to ensure that the secondary options are only available from level 2 and the tertiary options (requiring two amlas to be available) at level 3.

In addition, I modified the experiences required for level changes in order to force the player to take 3 primary amlas to reach level 2 as well as an increase in max_hipoints by 3 to maintain consistency."
1681126624,Store core ID into save,demario-w,2024-01-16 14:36:27+00:00,2024-01-22 15:35:35+00:00,{'Engine': 1},"As the core is potentially changing the behavior of the game, the core should be stored into the save in order to have the full setting of the game in the save.

The behavior of the engine when loading a save with a core (different from default) can be left open, but the saves should include the core id to leave options open."
1680543525,Add 'k' hotkey to core management window from main screen,demario-w,2024-01-16 09:51:54+00:00,2024-01-22 15:30:40+00:00,{'Input': 1},"Add 'k' hotkey in data/core to be available in main menu ('M').
(fixes #8209)"
1680262878,Hotkeys,babaissarkar,2024-01-16 07:34:01+00:00,2024-01-21 01:32:32+00:00,"{'UI': 1, 'Lua API': 1, 'Building': 1, 'Packaging': 1, 'SCons': 1, 'Input': 1, 'Schema': 1}","1. Added keybindings to menu items in the Map Editor.
2. Put `Save Scenario As` menu item just after `Save Map As`, instead of `Map Screenshot`.
3. Added `Ctrl+G` as a shortcut for `I'm Ready` button in mp_staging.
**File Menu**
![Screenshot from 2024-01-19 16-49-49](https://github.com/wesnoth/wesnoth/assets/8469888/ef9650e2-ef1b-4af2-8330-25f81c56322a)

**Map Menu**
![Screenshot from 2024-01-19 16-50-06](https://github.com/wesnoth/wesnoth/assets/8469888/dfdab719-fadc-46d0-aaaf-e2e38c25ee37)

**Add-ons menu**
![Screenshot from 2024-01-19 16-50-48](https://github.com/wesnoth/wesnoth/assets/8469888/f8d12c03-f62e-40a1-8510-3adbb058237c)

**Fill selection and randomize tiles buttons**

![Screenshot from 2024-01-19 16-51-48](https://github.com/wesnoth/wesnoth/assets/8469888/377ba21b-5ee3-4ebb-bd77-b2b97d4f291c)
![Screenshot from 2024-01-19 16-51-55](https://github.com/wesnoth/wesnoth/assets/8469888/3f264574-0a2e-43a9-a5bb-c95828f24112)


"
1680247262,Enable stricter checks for debug builds,Pentarctagon,2024-01-16 07:20:48+00:00,2024-01-17 06:38:12+00:00,"{'Building': 1, 'SCons': 1}",
1678549784,Make event_test_filter_condition check when the filters run,stevecotton,2024-01-15 04:37:07+00:00,2024-01-20 22:00:59+00:00,{'Unit Tests': 1},"This passes both with and without #8245, it tests to prevent an unintentional API change in case someone looks at that copy and prematurely optimises the list copying.

It also adds the missing first_time_only=no, which is why the three [moveto] events didn't trigger the third event three times."
1678449718,Fix mp empty side1,gfgtdf,2024-01-15 02:13:47+00:00,2024-12-15 23:20:40+00:00,"{'MP': 1, 'Add-ons': 1}",We refactor a the mp server game turn data a bit to fix #2563 and #3899
1678249362,Make a copy of the active event handler list before executing them.,CelticMinstrel,2024-01-14 21:13:09+00:00,2024-01-21 00:38:48+00:00,{'Unit Tests': 1},"This avoids issues if the events being executed add new handlers, since adding a new handler needs to sort the list according to the event priority.

Fixes #8157"
1678020959,EI S12: Ran-Lar appears to be renamed Rakkha,Wedge009,2024-01-14 07:42:38+00:00,2024-01-15 02:25:26+00:00,{'Campaign EI': 1},Resolves #8242.
1677725443,HttT Map Update,Hejnewar,2024-01-13 11:37:32+00:00,2025-02-09 15:23:30+00:00,"{'Enhancement': 1, 'Campaign HttT': 1}","Fix #8058 

Maps made by Mechanical. "
1677251774,Simplify nearest neighbor rescale,Kaltxi,2024-01-12 20:57:25+00:00,2024-01-20 22:50:15+00:00,"{'macOS': 1, 'Graphics': 1, 'Building': 1}","Simplification of nearest neighbor rescaling algorithm which improves minimap regeneration performance for #1605.

After initial attempt at optimization I noticed that the the two inner loops that go over the src image region corresponding to the dest image pixel look like a weighted sum, but in reality samping only a single pixel - the first one. This effectively leads to just taking this pixel (albeit with some additional floating summation and division, which as far as I can see should lead to a constant factor of 1). If we modify this algorithm to actually sample each pixel in the region - we get an averaged blurry image. By the name of the function - we seek a *sharp* rescale, so averaging seems incorrect. Original behavior looks like nearest neighbor interpolation, so I simplfied it to just take the pixel without any additional computations.

This greatly speeds up the scaling function and yields *almost* the same image. The slight differences in some pixels' brightness I attribute to the floating operations error accumulation."
1677168164,fix unit:to_map(loc) #8229,gfgtdf,2024-01-12 20:00:36+00:00,2024-01-17 23:58:57+00:00,{'Lua API': 1},"lua_unit::put_map already removes the unit previously on that tile, and doing it here causes an error when the unit was on that tile already."
1675814941,UtBS S6a: Avoid Dust Devil speaking,Wedge009,2024-01-12 05:53:34+00:00,2024-01-12 08:52:02+00:00,{'Campaign UtBS': 1},"Resolves #8192.

I grant this still doesn't make much sense, because arguably the Dust Devil shouldn't be able to bury the bones, but it's perhaps less jarring than a mute Dust Devil having dialogue."
1675758207,EI S4: Safyam is supposed to be female,Wedge009,2024-01-12 04:46:24+00:00,2024-01-12 08:52:19+00:00,{'Campaign EI': 1},Resolves #8233.
1675501920,Prevent wesnoth from crashing after campaign credits,Pentarctagon,2024-01-11 23:20:17+00:00,2024-01-13 17:15:51+00:00,{'UI': 1},Fixes #7395
1674744547,"Enable use of system Lua 5.4 C++ on non-Windows platforms, fix pcall()/xpcall() blocking jailbreak exceptions, and fix strict mode missing some Lua errors",pehjota,2024-01-11 15:14:49+00:00,2024-02-12 05:21:15+00:00,"{'macOS': 1, 'AI': 1, 'UI': 1, 'Lua API': 1, 'Building': 1, 'SCons': 1, 'CMake': 1}","Wesnoth no longer changes Lua source (since commit 5155a74, pull #6549, version 1.17.2), and lua5.4 [was promoted to Ubuntu main](https://bugs.launchpad.net/bugs/2028695) where it [is officially maintained](https://github.com/canonical/ubuntu-mir) since [Ubuntu 23.10](https://packages.ubuntu.com/search?searchon=sourcenames&keywords=lua5.4) (but wesnoth is still in universe where it isn't officially maintained or updated).  This is an opportunity to again (as was done before [1.9.0](https://github.com/wesnoth/wesnoth/blob/3e3913d/changelog.md?plain=1#L8605)) enable distributions to use Wesnoth with their own Lua 5.4 packages that will receive any security updates or other important bug fixes (since Lua CVEs happen, and distributions usually don't update Wesnoth and its submodule copy of Lua in their stable releases, except via optional backports or PPAs).

Wesnoth wants Lua [compiled](https://github.com/wesnoth/wesnoth/blob/9315079/src/CMakeLists.txt#L90) as [C++](https://github.com/wesnoth/wesnoth/blob/ac259f0/src/SConscript#L124) so that it can [recover](https://github.com/wesnoth/wesnoth/commit/e4d0ae0) from C++ [exceptions](https://github.com/lua/lua/blob/9be74cc/ldo.c#L47).  Lua's build system doesn't compile as C++, but [Debian](https://salsa.debian.org/lua-team/lua5.2/-/commit/fa2dc77c) and [Arch](https://gitlab.archlinux.org/archlinux/packaging/packages/lua/-/commit/4e97e19d) do (and [Fedora](https://src.fedoraproject.org/rpms/lua/blob/rawhide/f/lua.spec) doesn't).  Wesnoth also still wants some compile-time [definitions](https://github.com/wesnoth/wesnoth/blob/c44cc27/src/wesnoth_lua_config.h), although the `LUA_COMPAT_*` ones are from Lua 5.3 and are [unused](https://github.com/lua/lua/commit/34b00c1) in 5.4 (so this PR removes them).  So that leaves the Windows `strcoll()` redefinition and exception rethrowing, hence this PR excludes Windows.

The CMake module and SCons check search for the Lua headers and library (instead of using pkg-config like the [old scons/lua.py did](https://github.com/wesnoth/wesnoth/blob/5e3ee31/scons/lua.py)), because even though distributions typically provide .pc files for Lua, upstream Lua doesn't.  It's likely that all distributions that compile Lua as a C++ library will also provide .pc files, but these checks don't rely on that.  Unfortunately, SCons is a little noisy when looking for a working include directory and library name.  I'm open to suggestions on the SCons check, like using pkg-config (although I tried to instead make it consistent with the FindLua module pulled from CMake, which doesn't use pkg-config) or somehow suppressing all the ""Checking for C++ library lua54-c++... no"" etc. messages.

Build tested locally with both system and submodule Lua using both CMake and SCons.  Please don't squash on merge."
1672908222,Support [harm_unit]experience values kill/attack/defend/fight/yes/no,ProditorMagnus,2024-01-10 18:03:50+00:00,2024-01-18 10:32:19+00:00,"{'Unit Tests': 1, 'Lua API': 1, 'Schema': 1}",Fixes #8176. Re #7776. Re #8178.
1669342250,Handling RTL in the left pane of the help browser,stevecotton,2024-01-08 17:21:50+00:00,2024-01-20 13:28:16+00:00,"{'Translations': 1, 'UI': 1, 'Help': 1}","Fixes #8205

This addresses #5600 and #8205. As #8205 is specifically about the names I'm marking it as fixing that one, and leaving #5600 for the issues that you can see on the right-hand pane in that issue's first screenshot, where the yellow text should be to the left of the corresponding white header text.

The GUI1 menu code is only used to support one UI feature, which is the help browser. The RTL support displayed incorrectly, and the code in menu::draw_row was complex, because it supported multiple columns and multiple things in each column; to do so it did a lot of string parsing. The help browser itself wanted to know whether clicks are on the icon or the text, but that wasn't provided by the existing code (it's all in the same column), so was already reimplemented in help_menu.cpp's subclass.

This rips out a lot of features, so that each row has only an indent, an optional icon, and optional text. It's a 3 commit PR, where
* the first commit removes some constructor arguments, but otherwise only touches dead code
* the second deletes lines from active code
* the third changes the menu's data format

In LTR languages, this looks almost identical.

In RTL languages, the book icons now appear in the right place, and the text placement is reasonable.

![image](https://github.com/wesnoth/wesnoth/assets/101462/35792960-32e3-4980-94d3-d6c8758a3b8a)"
1668081227,08_Clearwater_Port.map,TheFlamelet,2024-01-08 02:58:29+00:00,2024-01-08 18:27:16+00:00,{'Campaign TRoW': 1},"Fixed starting location (bug)

In 1.17, the author has changed the enemy side numbers in the scenario file. However, it seems that the map file starting locations where not updated accordingly. This file updates the starting location. However, there is a chance the author did alter the map as whole, and in that case, we should wait for his upload for the new file.

Tldr: changed these locations:
3 into 4
4 into 5
5 into 6 (originally there was no 6th starting location)"
1668034060,Use VALIDATE macro to validate WML in teleport.cpp (#8175),dsfb,2024-01-08 02:14:33+00:00,2024-02-14 22:12:48+00:00,{'WML': 1},"This code is an implementation that can solve the issue #8175.
(Sorry, but it is not tested!)"
1667035846,Accept percentage arguments in scaling IPFs,Vultraz,2024-01-06 02:03:45+00:00,2024-02-20 09:05:49+00:00,{'Graphics': 1},Should probably add some tests.
1667006536,Update all units of type and side after selection with is_game_override,ProditorMagnus,2024-01-06 00:41:31+00:00,2024-01-14 16:04:32+00:00,{'Units': 1},Fixes #6977
1666482833,[Units] Raven unit tree Stats patch,knyghtmare,2024-01-05 16:45:20+00:00,2024-01-31 19:29:24+00:00,"{'Enhancement': 1, 'Units': 1}","## Summary
Level 1 has HP 26 and XP 44
but level 2 has HP 29 (just +3?) and XP 150 (It's not a level 3)

This pull request adjusts the stats of level 2 _War Harbinger_ to be level 2"
1666387491,add a bunch of attacks tests,Pentarctagon,2024-01-05 15:48:38+00:00,2024-01-08 18:04:46+00:00,{'Unit Tests': 1},
1666134302,"Add po hints for ""taught"" in the attack dialog",stevecotton,2024-01-05 12:43:43+00:00,2024-01-05 15:11:55+00:00,{'Units': 1},
1665804957,Remove xbrz,Vultraz,2024-01-05 08:22:51+00:00,2024-04-01 19:50:27+00:00,"{'Postponed': 1, 'macOS': 1, 'Building': 1}",CI run.
1665241624,Fix some multiline po: comments,stevecotton,2024-01-04 20:12:33+00:00,2024-01-05 09:19:44+00:00,"{'Translations': 1, 'Units': 1, 'Campaign UtBS': 1}","Multiline comments need the `po:` prefix on each line, otherwise that line is ignored. This fixes all occurances of this.

Any lines which have nothing after the `po:` are still ignored, so I haven't added it to the paragraph-break lines. The resulting .pot file doesn't have paragraphs.

Planning to just do a CI check overnight and merge in the morning."
1664655283,Check that every file in copyrights.csv has a license and author,stevecotton,2024-01-04 12:52:38+00:00,2024-01-07 14:22:37+00:00,"{'Enhancement': 1, 'Building': 1, 'CI': 1}","Improve the error messages about the input file needing sorting, to avoid confusion when successfully creating a sorted output from an unsorted input.

Addresses the discussion in https://github.com/wesnoth/wesnoth/commit/e07acf71dc926b975420de3e34dbfa0303b6f4bb#commitcomment-136180490"
1664259208,Simplified scale IPF implementations,Vultraz,2024-01-04 07:47:27+00:00,2024-01-04 18:50:47+00:00,{},~Also want to consolidate the parsers too. Considering where best to put that.~ Done so now. Doing this in preparation for adding percentage arg support to replace the relative scaling in ~XBRZ.
1663428503,Widgets,babaissarkar,2024-01-03 15:19:41+00:00,2024-02-13 17:54:34+00:00,"{'macOS': 1, 'UI': 1, 'Editor': 1, 'Building': 1, 'Input': 1, 'Schema': 1}","This PR introduces two new UI widgets,
1. **Spinner**  `[spinner]`
![Screenshot from 2024-01-09 09-28-11](https://github.com/wesnoth/wesnoth/assets/8469888/9a3cf6f1-4a14-45f8-b91c-82888f81b503)

2. **Multiline Text Editor**  `[scroll_text]`
![Screenshot from 2024-01-31 20-46-01](https://github.com/wesnoth/wesnoth/assets/8469888/c892be7f-78c7-478a-8276-9b06b140a933)

(Use Shift+Enter to insert line break, as Enter trigger dialog's OK button.)

*Combobox will be moved to another PR*

*TODO list*
- [x] Scroll bar works with cursor now, but it requires more refinement."
1662109171,Add modification count and ids in formula,newfrenchy83,2024-01-02 17:36:31+00:00,2024-04-24 18:01:37+00:00,"{'Units': 1, 'Lua API': 1, 'WFL': 1, 'Campaign UtBS': 1}","Can resolve https://github.com/wesnoth/wesnoth/issues/8179 issue

while waiting for the release of the use of the number of advancement or their identity to be decided, I added both in the formulas"
1661722107,Add tests for [harm_unit],stevecotton,2024-01-02 11:39:59+00:00,2024-01-04 16:50:49+00:00,"{'Unit Tests': 1, 'WML': 1}","This is testing experience=yes and experience=no, with the expectation that some new values for that attribute will be added afterwards.

Adds a new generic macro ASSERT_UNIT_HP_XP. Looking thorugh the ability tests, ASSERT_UNIT_HP (without the XP) could be a heavily-used macro, but it wouldn't be used by this particular commit, so I'm not adding it in this commit."
1661375255,1.18 - various minor monster updates,doofus-01,2024-01-02 03:21:12+00:00,2024-01-15 20:25:39+00:00,"{'Graphics': 1, 'Units': 1}","These are some very small, random updates to a few monster sprites, just a tiny project I could get done in time for 1.18.0.

EDIT: Don't commit this unless I've disappeared before 1.18.0.  This is a holding pen for small images fixes I wish to get in before next stable release."
1661281258,1.18 Peasant animations,doofus-01,2024-01-01 21:47:39+00:00,2024-01-07 20:10:57+00:00,"{'Graphics': 1, 'Units': 1}","N/S directional attack frames for peasant
Death animation for peasant"
1661190746,use lenght of modifications.advancement for leveling of Quenoth Youth,newfrenchy83,2024-01-01 17:44:56+00:00,2024-01-11 21:39:55+00:00,"{'Units': 1, 'Campaign UtBS': 1}","Can resolve https://github.com/wesnoth/wesnoth/issues/8179

It is should be more consistent what my precedet commit"
1661164573,"Allow effects applied in [modifications] to be reported by [advancement], [object] or [trait]",newfrenchy83,2024-01-01 16:36:08+00:00,2024-01-01 17:43:49+00:00,"{'Units': 1, 'WFL': 1, 'Campaign UtBS': 1}","
Can resolve https://github.com/wesnoth/wesnoth/issues/8179

This approach consists of using three different variables to perform the counting before making them accessible in the formulas, but not in the wml variables because they must remain read-only to avoid any modifications making their values incorrect."
1661058661,[1.16] Save horizontal scrolling inversion check in static variable,pehjota,2024-01-01 12:32:13+00:00,2024-01-01 22:00:59+00:00,{},"Avoids two to four function calls on each SDL_MouseWheelEvent.

Also update code comment and changelog entry based on @vgaming's report of issue #3362 being fixed.

Slightly improves commit e628e27.  Tested again with SDL 2.0.14 and 2.28.5.

Slight (unnoticeable) performance improvement inspired by @vgaming's review of pull #8158.

See also #8185 for master."
1661058575,Save horizontal scrolling inversion check in static variable,pehjota,2024-01-01 12:32:00+00:00,2024-01-01 22:00:55+00:00,{},"Avoids two to four function calls on each SDL_MouseWheelEvent.

Also update code comment and changelog entry based on @vgaming's report of issue #3362 being fixed.

Slightly improves commit ab4001d.  Tested again with SDL 2.0.14 and 2.28.5.

Slight (unnoticeable) performance improvement inspired by @vgaming's review of pull #8158.

See also #8186 for 1.16."
1660740318,Add WML verification workflow,czyzby,2023-12-31 22:10:12+00:00,2024-08-03 16:27:23+00:00,"{'WML Tools': 1, 'CI': 1}","Closes #7082.

The workflow steps are as follows:

* Wesnoth respository is checked out.
* Python 3.10 is set up.
* Dependencies for spellchecking are installed.
* `wmllint` is ran in dry-run mode against the `data/` folder.
  * Since the script does not define error codes, the messages are filtered instead to check if there are any issues.
  * Logs starting with `#` are filtered out, since they seem to be purely informational and do not indicate any errors.
  * If the filtered output logs are not empty, the pipeline step is considered to be failed.
  * The same output handling is applied to other tools.
* `wmlindent` is ran in dry-run mode against the `data/` folder.
* `wmlscope` is ran against the `data/` folder.
  * Currently no flags are selected. Let me know if that should be changed.
  * Trying to verify the WML files with `-u` (unresolved references) yields the following Python error:

```python
  File ""/home/runner/work/wesnoth/wesnoth/data/tools/wmlscope"", line 564, in <module>
    xref.incorrectlysized()
  File ""/home/runner/work/wesnoth/wesnoth/data/tools/wmlscope"", line 221, in incorrectlysized
    for (namespace, filename) in xref.filelist.generator():
AttributeError: 'list' object has no attribute 'generator'
```

The pipeline is executed on every push and pull request to the `master` branch, as well as by manual dispatch. Note that the workflow currently fails with 3000+ reported issues."
1660516356,"Allow experience key in [harm_unit] tag to be set to kill, primary / secondary hit, hit or yes",Hejnewar,2023-12-30 22:30:33+00:00,2024-01-10 18:18:53+00:00,"{'Unit Tests': 1, 'WML': 1, 'Lua API': 1}","Discussed in issue #8176 

Needed for 7776  

Question:
There is no shema for this right? I tried to find it but didn't."
1660138945,make `wml_tag::iterator` copy assignable,rfsc-mori,2023-12-29 20:18:18+00:00,2023-12-31 17:16:03+00:00,{'Schema': 1},"For more context:
https://github.com/wesnoth/wesnoth/pull/8136#issuecomment-1872243927

This makes iterators based on `wml_tag::iterator` to meet LegacyInputIterator requirements."
1659419386,[1.16] Fix font permissions to allow installable embedding,pehjota,2023-12-28 22:21:30+00:00,2024-12-06 20:52:45+00:00,"{'Packaging': 1, 'Stable 1.16': 1}","The TrueType ""OS/2"" table ""fsType"" (embedding permissions) field was set to 0x8 in the Droid Sans and Oldania ADF Std fonts, allowing only editable embedding.  This change marks the fonts as allowing permanent installation on a system, as is typically done with Wesnoth and allowed by the fonts' licenses.

I set the field using Tom Murphy 7's public domain and portable C ""embed"" program, now included at utils/font-embedding-fix.c (converted with dos2unix and fixed to `#include <string.h>`).  I verified with VBinDiff that only the ""OS/2"" table ""checksum"" and ""fsType"" fields were changed, so no other changes have been made to the fonts.  I confirmed using FontForge and the new utils/font-embedding-check.pl script that the fonts now allow installable embedding.

References:
http://carnage-melon.tom7.org/embed/
https://developer.apple.com/fonts/TrueType-Reference-Manual/RM06/Chap6.html https://developer.apple.com/fonts/TrueType-Reference-Manual/RM06/Chap6OS2.html https://learn.microsoft.com/en-us/typography/opentype/otspec140/os2#fst

See also #8171 for master."
1659419249,Fix font permissions to allow installable embedding,pehjota,2023-12-28 22:21:25+00:00,2024-12-06 20:53:21+00:00,{'Packaging': 1},"The TrueType ""OS/2"" table ""fsType"" (embedding permissions) field was set to 0x8 in the Droid Sans and Oldania ADF Std fonts, allowing only editable embedding.  This change marks the fonts as allowing permanent installation on a system, as is typically done with Wesnoth and allowed by the fonts' licenses.

I set the field using Tom Murphy 7's public domain and portable C ""embed"" program, now included at utils/font-embedding-fix.c (converted with dos2unix and fixed to `#include <string.h>`).  I verified with VBinDiff that only the ""OS/2"" table ""checksum"" and ""fsType"" fields were changed, so no other changes have been made to the fonts.  I confirmed using FontForge and the new utils/font-embedding-check.pl script that the fonts now allow installable embedding.

References:
http://carnage-melon.tom7.org/embed/
https://developer.apple.com/fonts/TrueType-Reference-Manual/RM06/Chap6.html https://developer.apple.com/fonts/TrueType-Reference-Manual/RM06/Chap6OS2.html https://learn.microsoft.com/en-us/typography/opentype/otspec140/os2#fst

See also #8172 for 1.16."
1659276180,[1.16] systemd: Run as _wesnoth:_wesnoth using sysusers.d,pehjota,2023-12-28 18:52:13+00:00,2024-01-15 20:33:55+00:00,"{'Packaging': 1, 'Security': 1}","[systemd 246+ logs a warning message](https://github.com/systemd/systemd/blob/v246/NEWS#L106-L113), because running as ""nobody"" is unsafe.

This should be reviewed and tested by someone who knows and uses systemd, as I do not.  Is this worth escalating in the changelog to `### Security Fixes`?

See also #8168 for master."
1659276127,systemd: Run as _wesnoth:_wesnoth using sysusers.d,pehjota,2023-12-28 18:52:07+00:00,2024-01-15 20:33:26+00:00,"{'Building': 1, 'Packaging': 1, 'SCons': 1}","[systemd 246+ logs a warning message](https://github.com/systemd/systemd/blob/v246/NEWS#L106-L113), because running as ""nobody"" is unsafe.

This should be reviewed and tested by someone who knows and uses systemd, as I do not.  Is this worth escalating in the changelog to `### Security Fixes`?

See also #8169 for 1.16."
1659196494,Add changelog entry for horizontal scrolling fix (PR #8137),pehjota,2023-12-28 16:49:58+00:00,2023-12-28 17:14:15+00:00,{},
1659069067,Unit Type Editor,babaissarkar,2023-12-28 14:18:09+00:00,2024-03-26 18:23:39+00:00,"{'Enhancement': 1, 'UI': 1, 'Editor': 1, 'Units': 1}","New Unit Type Editor UI inside Map Editor. Allow the user to create a template that supports many of the common keys in UnitTypeWML, along with preview of the generated WML.
It can be accessed via new **Units menu > Edit**.

**Screenshots**
![Screenshot from 2023-12-28 22-35-54](https://github.com/wesnoth/wesnoth/assets/8469888/a77394bd-803d-4bd5-8cb7-58a61ccd6fa3)

![Screenshot from 2023-12-28 22-36-06](https://github.com/wesnoth/wesnoth/assets/8469888/c35c04d9-ea0c-476e-998b-50be2d5ff7b8)

![Screenshot from 2023-12-28 22-36-14](https://github.com/wesnoth/wesnoth/assets/8469888/b3a8dfa4-3cec-4997-b187-f45d56b92394)

![Screenshot from 2023-12-28 22-36-24](https://github.com/wesnoth/wesnoth/assets/8469888/08090b0a-41c6-4844-80c4-03ec6493f080)

![Screenshot from 2023-12-28 22-38-02](https://github.com/wesnoth/wesnoth/assets/8469888/c2201847-9a73-44b0-8b40-bcf0ae6ac8e2)

![Screenshot from 2023-12-28 22-38-10](https://github.com/wesnoth/wesnoth/assets/8469888/52774796-d024-408d-b11d-89c68133244e)

![Screenshot from 2023-12-28 22-36-33](https://github.com/wesnoth/wesnoth/assets/8469888/0f6949b4-2d8d-4a79-bc8b-3abec2efa07f)

(Note : The screenshots are slightly old, so one or two texts might be a bit different.)"
1659055287,1.18 - graphics for elder falcon,doofus-01,2023-12-28 14:03:33+00:00,2023-12-29 13:44:15+00:00,"{'Graphics': 1, 'Units': 1}",
1658571170,IPF: improve memory safety when constructing mod queue,Vultraz,2023-12-28 02:59:41+00:00,2023-12-28 04:41:33+00:00,{},"Previously, the mod parser returned a raw to-heap pointer. Once added to a mod queue, it would then be owned by a shared_ptr (overkill). This makes it so the mod executors are managed by unique_ptrs for their entire lifetime."
1658501656,Deprecate abilites,gfgtdf,2023-12-27 23:45:07+00:00,,"{'AI': 1, 'Lua API': 1, 'WFL': 1}","the deprecated the `u.abilities` perperies in formula and lua which returns a list of ability ids, and renames them to ""ability_ids"", the idea is that by doing this now we an make `u.abilities` returns a userdata that gives more information than just the ids in 1.19"
1658443397,Add optional tag name overrides to conditional tags in schema.cfg,rfsc-mori,2023-12-27 21:19:08+00:00,2024-02-02 13:57:05+00:00,{'Schema': 1},"Fixes schema.cfg validation errors after #8136.

I've followed the same pattern of the other tags in this schema to allow the conditional tags `case`, `else`, `then`, `elseif` and `else` to be defined without a name key."
1658312948,"EI - 04b_Ill_Humors.cfg ""time over"" bugfix",Dalas121,2023-12-27 17:46:12+00:00,2023-12-27 18:59:53+00:00,{'Campaign EI': 1},"04b's ""time over"" event triggers on turn 22, even after the turn limit gets extended (thanks for the bug report 'Emperor').  This is a quick fix for the issue."
1657922829,Check that copyrights.csv is sorted by filename,stevecotton,2023-12-27 10:26:10+00:00,2023-12-28 12:01:11+00:00,"{'Enhancement': 1, 'Building': 1, 'CI': 1}","When the tool finds new or changed files, it puts them at the top of the output .csv file for easy editing. However, this means that those lines move when update_copyrights is run again. It also means that any two PRs touching images are likely to have merge conflicts, as they'll change line 2 of copyrights.csv.

Make the CI fail unless the file has been sorted again after editing."
1657883852,[1.16] Backport #8137: Fix horizontal scrolling regression (fixes #7404),pehjota,2023-12-27 09:47:02+00:00,2023-12-31 20:03:10+00:00,{},"The old issue #2218 was actually a bug in SDL, fixed on X11 in version 2.0.18 and on Wayland in version 2.0.20.  The hardcoded workaround in pull #2481 (commit 4bc4373) caused a regression in fixed SDL versions.

This fix is similar to the workaround in widelands/widelands#5394 committed as widelands/widelands@67db32a.

Also make mouse handler use same coordinate signs as map and fix mouse_wheel_*() virtual method calls, which have been wrong in the X axis since commit dfe2f33 (and unused since commit c912f7e).

Tested with SDL 2.0.14 and 2.28.5.

Cherry picked from commit ab4001d (pull #8137) in the master branch (1.17)."
1657612988,1.18 - Revise new skeleton sprites,doofus-01,2023-12-27 02:29:32+00:00,2023-12-31 16:33:12+00:00,"{'Graphics': 1, 'Units': 1}","- [x] Skeleton Rider
- [x] Bone Knight
- [x] Death Squire

Related to #8150

Portraits are not in the scope of this PR, but it would be nice to get those in before 1.18.0 "
1657491813,add some more abilities tests,Pentarctagon,2023-12-26 20:42:47+00:00,2024-01-01 11:34:08+00:00,"{'Unit Tests': 1, 'Schema': 1}","hides, skirmisher, and teleport

---

Draft for teleport, hides and skirmisher have fewer tests given they don't use the `value` attribute."
1656747706,fix leveling for Kaleh and Nym in Utbs,newfrenchy83,2023-12-25 19:19:44+00:00,2023-12-31 20:11:05+00:00,"{'Units': 1, 'Campaign UtBS': 1}",Fix https://github.com/wesnoth/wesnoth/issues/8149 issue
1656229123, make sure transform_unit doesn't heal the unit,gfgtdf,2023-12-25 00:02:06+00:00,2024-02-03 17:47:38+00:00,{'Units': 1},"previously it could happen that removing an object applies the status healing, in particular of the default amlas (which are meant to only heal the unit once)

[tranform_unit], unit:transform(),  [remove_object]  and unit:remove_modifications() are required not to change a unit current hp see https://wiki.wesnoth.org/DirectActionsWML#.5Btransform_unit.5D , especially not in a unpredictable manner like this. 
"
1655931006,"1.18 - wooden-frame, non-village windmill",doofus-01,2023-12-23 18:41:14+00:00,2023-12-27 02:26:27+00:00,"{'Graphics': 1, 'Terrain': 1}","No API changes, just change the images for `^Wm`.
Fixes #8064 and 82e1e06 (it sure took a while, but I had always thought the ambiguity was intentional)
Not finished, but this is the first draft
![Screenshot_20231223_windmills](https://github.com/wesnoth/wesnoth/assets/13510196/322224da-cf66-43c0-8bab-40d11076b5e0)


"
1655724656,1.18 - SoF Wyrms update,doofus-01,2023-12-23 01:34:59+00:00,2023-12-23 12:08:55+00:00,"{'Graphics': 1, 'Units': 1, 'Campaign SoF': 1}","Cleaner version of #8131, with an additional little palette adjustment.
 - Make wyrmlets sprites thinner and more snake-like, matching portrait
 - Give wyrms a separate portrait
 - Make Red Wyrm(let) portraits a slightly less lazy recolor through ~CHAN() formulas  "
1655426765,Modify shema validation for more consistency,newfrenchy83,2023-12-22 17:36:52+00:00,2023-12-23 18:06:57+00:00,{'Schema': 1},"In the validation schema abilities-value in abilities.cfg contains not only the numerical attributes but also active_on and apply_to, while these two deniers are only used by [resistance], and the abilities used as weapons are validated by the schema validation of special weapons, and the abilities [leadership], [heals], [regenerate] and [illuminates] also use all numerical attributes."
1655154417,[Units] Skeleton Rider and Bone Knight can now traverse Deep Water,knyghtmare,2023-12-22 14:13:04+00:00,2023-12-24 12:47:11+00:00,{'Units': 1},"## Summary
Both Units can now move in deep water and use submerge

## Issue Patched
Closes #8138"
1653164107,add a bunch of illuminates tests.,Pentarctagon,2023-12-21 06:11:15+00:00,2023-12-23 18:07:45+00:00,"{'Unit Tests': 1, 'Schema': 1}",
1652469337,Fix horizontal scrolling regression (fixes #7404),pehjota,2023-12-20 17:31:31+00:00,2023-12-26 04:52:52+00:00,"{'Building': 1, 'CMake': 1}","The old issue #2218 was actually a bug in SDL, fixed on X11 in version 2.0.18 and on Wayland in version 2.0.20.  The hardcoded workaround in pull #2481 (commit 4bc4373) caused a regression in fixed SDL versions.

This fix is similar to the workaround in widelands/widelands#5394 committed as widelands/widelands@67db32a.

Tested with SDL 2.0.14 and 2.28.5."
1652403971,"Improve schema super validation (mandatory keys, cycles and missing super)",rfsc-mori,2023-12-20 16:39:20+00:00,2024-02-26 16:12:43+00:00,"{'macOS': 1, 'Building': 1, 'SCons': 1, 'CMake': 1, 'Schema': 1}","Fixes issue #7897.

Before anything, I apologize if the PR is too big, I can split it if it's better for reviewing. All my changes were mostly in the same context, so I've decided to keep them together.

This PR aims to improve the validation of super tags, specifically to fix the mandatory keys and how that's affected by cycles in the super graph.

**Decision context:**
Implementing validation for mandatory super keys requires traversing the super tag tree and if there are any cycles this will lead to infinite loops. My first step was then to allow validating the schema itself to prevent super cycles. This was done using Boost Graph and DFS with back edge detection, treating the super dependency tree as a directed graph.

Now to the non-schema WML validation, I first had to change `wml_tag`'s `find_key` method, and decided to implement the same adjustment for `find_tag` despite not finding a way to reproduce the same issue. The issue was that if any key used in the WML file wasn't defined in the schema, it'd cause an infinite loop while traversing the super list. To solve this issue, I've added a bookkeeping vector to identify when a tag was processed twice. The non-schema cycle detection does not catch this because `find_key` calls happens before the final root tag validation.

Still in the `wml_tag` context, I've decided to add the super's path to the `super_refs_` member, and then expose its iterator in the same way the key and tag iterators are exposed. This allows for better diagnostics in the schema validator.

After the above preparation, I've implemented cycle detection for the schema validator as well, while parsing a non-schema WML file. After each tag is parsed, during its validation, I register them in the boost's graph list and search for cycles once we finally validate the root element.

Notes:
- This will catch super cycles even in the case of a schema and WML file that works normally, as some combinations may not lead to infinite loops.
- This won't catch super cycles for tags that aren't used in the WML file.
- The cycle is reported as an error following the same pattern as the other validation errors.

Following the reported issue this aims to solve, I've also decided to report an error when the WML schema specifies a super that does not exist. This is already handled by the schema_self_validator, but was not identified in a WML file validation. This has the same catch that the detection will only happen if the affected tag is used in the WML file.

Finally, I've addressed the mandatory keys validation in a way that includes all super keys, using the same bookkeeping method to prevent infinite loop in the case of a cycle. This also has the same issue where the super cycle cannot be detected beforehand, as all the other keys are validated before the root key is closed and validated.

**Other changes:**
During my experiments, I've decided to fix `tag.hpp`'s CRTP which was missing a parameter, causing it to pick a different template parameter (the default Map) in the base class context. This was done while experimenting to allow a `std::vector` to be used as the Map type parameter.

**Known risks:**
- I did not test the XCode project files as I don't have a system that supports XCode nor known an alternative way to validate if the file works. The script to add new files to the project didn't work very well for adding tests.
- This may be a breaking change for WML schemas that contains cycles or other conditions that would now cause an error.
- WML parsing performance may be affected due to the extra loops if there are _very_ big WML files.
"
1651191307,require_modification/campaign now defaults to yes,gfgtdf,2023-12-19 23:03:12+00:00,2024-02-01 00:29:20+00:00,"{'MP': 1, 'WML': 1}","It's better to be defensive with those default values, especially now that the mp lobby code can automatically download addons, having require_modification set to true isn't inconvenient for the users either.

(The issue that the added comment is abotu isn't something that was added in this commit)"
1648499937,fix heals and regenrate test validation,newfrenchy83,2023-12-18 12:27:46+00:00,2023-12-18 15:43:21+00:00,{'Unit Tests': 1},shema validation don't disabled for these test
1648495132,Generalize the use of max_value and add the min_value attribute,newfrenchy83,2023-12-18 12:24:48+00:00,2024-06-19 14:18:54+00:00,"{'Unit Tests': 1, 'UI': 1, 'Units': 1, 'Schema': 1}","
In the case of [leadership], the fact that the values of each ability can be added when cumulative=yes can justify the addition of limit values not to be exceeded, but this can also apply to heals and [regenerates] with the use of 'add' or 'multiply'.

As for [resistance], it already uses max_value, but if cumulative=yes, then all max_values can add up which could be problematic."
1647670431,1.18 - SoF Wyrms graphics,doofus-01,2023-12-18 02:54:42+00:00,2023-12-22 20:43:35+00:00,"{'Graphics': 1, 'Units': 1, 'Campaign SoF': 1}","Purpose of this PR:

- [x] different portrait for wyrm vs wyrmlet
- [ ] make wyrmlet sprite a bit smaller - probably wings unchanged, but body must shrink"
1647473800,1.18 various ant image updates,doofus-01,2023-12-17 22:42:28+00:00,2023-12-18 03:10:53+00:00,"{'Graphics': 1, 'Units': 1}","This is a minor update to ants:
1. Make some of the portraits a little more distinct
2. fix the giant ant attack/defend frames so they don't jump around"
1647205591,add a bunch of leadership ability tests,Pentarctagon,2023-12-17 06:48:21+00:00,2023-12-18 00:29:28+00:00,{'Unit Tests': 1},
1647172126,WoF S12: Change Karron's epilogue,stevecotton,2023-12-17 03:29:13+00:00,2024-01-19 10:41:09+00:00,"{'Prose': 1, 'Campaign WoF': 1}","The replaced first line added facts into canon that didn't need to be there. Having a flight of drakes travel west from Morogor to find the island that the orcs are sailing from makes sense, but giving Karron this canon fate in WoF put constraints on future stories about both the Green Isle and Morogor itself.

Also, that text felt too similar to some real-world racism, which is why I'm proposing this change during the string freeze.

In discussion during review, the last two lines felt more like the start of another story than part of WoF itself. One more is removed because ending with other flights accepting Gorlack's wisdom feels better than saying they all
went back into exile.

Original description when this PR opened
---

Rewrite a paragraph, making it her plan instead of a reliable narration. I'm hoping this can be accepted during the string-freeze.

1. Karron has been defeated multiple times, and is part of the overthrown old order of Morogor. If she tried to go back to Morogor, even if she only asked for the supplies to travel onward to the Green Isle, then I'd expect its new rulers to fight her instead.
2. Even if she reaches the Green Isle, I wouldn't expect her to manage to defeat all the orcs. Also, TRoW suggests that whatever follows the orcs will be stronger.
3. It puts facts into canon that don't need to be canon. Having a flight of drakes travel west from Morogor to find the island that the orcs are sailing from makes sense, but I see no reason to constrain that story by having Karron's fate in WoF's canon.
4. Using ""infestation"" felt too similar to some real-world racist graffiti.
5. It should use the past tense ""led"" instead of ""lead""."
1647160954,1.18 - bridge-end layering relative to castle walls,doofus-01,2023-12-17 02:13:03+00:00,2023-12-18 03:15:49+00:00,{'Terrain': 1},"This adjusts layering of bridges vs castles to put castle walls above.  The image below is a hybrid: 
1. NW-SE (new)
2. NE-SW (current)
![Screenshot_20231216_bridges](https://github.com/wesnoth/wesnoth/assets/13510196/b9694255-ef71-4e8a-8296-078b98438efd)
My comment in #8121 on this issue may be wrong, I don't think new images are needed after all if ""castles on top"" are the desired outcome.  If ""bridges on top"" are desired, then lots of new images likely are needed to avoid weirdness like this:
![Screenshot_20231216_bridge-glitches](https://github.com/wesnoth/wesnoth/assets/13510196/b05d169a-da01-4334-ab9a-24672b263a18)
(the jaggy shadow on the dwarf castle NW and the strange cut-off on the elf castle NW)"
1647118569,[wip] add [status_type] toplevel tag,gfgtdf,2023-12-16 21:50:32+00:00,,"{'macOS': 1, 'Units': 1, 'Building': 1}","[status_type] describes a status (poisoned/unhealable etc), this intends to fix multiple problems:
1) States not being reset (see for example https://github.com/wesnoth/wesnoth/issues/5190). This has caused multiple
issues for example undead units not losing their undrainable etc statuses
when their type (and traits) is changed.
2) The previous way to show custom states (overwriting wesnoth.theme_items.
unit_status() is not very reusable since it is tied to theme items, in
particular it offers no way to show custom statuses in other places (like
unitlist, unit_preview_pane etc). With this it should be easier to implement
custom statuses also at those places."
1647117994,1.18 - N/S bridge and sprite layering,doofus-01,2023-12-16 21:47:14+00:00,2023-12-17 00:23:02+00:00,{'Terrain': 1},"adjust layering to keep units from sinking into N/S bridge image, fixes #8111 (and hopefully doesn't create any new issues)

I also see the NW, N, NE bridge to castle transition needs help, but that needs new images so I will postpone."
1646938109,Update the copyright info for the Finnish help images,stevecotton,2023-12-16 14:10:03+00:00,2023-12-16 14:51:44+00:00,{},"This assumes Styxnix is the right attribution, currently waiting for confirmation in IRC (in the Finnish language channel). I'm going AFK for the afternoon, so anyone please merge once it's confirmed.

Move the previous addition of the UtBS blowgun into sort-by-filename order.

Correct copyright of orb-two-color.png, as it was based on orb.png."
1646914434,1.18 SoF S1 - Victory Conditions,doofus-01,2023-12-16 12:31:16+00:00,2023-12-19 17:47:49+00:00,{'Campaign SoF': 1},"This is to fix #8083 
1. Clarify the objectives of where the caravans and rider are supposed to go
2. make the target area a little bigger (could have also made it `enter_hex` instead of `moveto`, but I think this should do - it wasn't the main complaint anyway)

EDIT:  I'm really not a fan of this copyrights.csv CI, it gives me grief even when I don't touch images.
EDIT2: Never mind, I see it has nothing to do with this, it was failing after the recent translations update"
1646785746,Fix ai error,gfgtdf,2023-12-16 02:43:49+00:00,2023-12-23 23:51:58+00:00,{'AI': 1},
1646279075,segmentation fault on attack event (berserker) #8115,gfgtdf,2023-12-15 16:23:51+00:00,2023-12-15 20:08:17+00:00,{},
1645052996,[WFL] deal with formula_callable inputs that currently don't do anything,soliton-,2023-12-14 23:07:10+00:00,2024-01-08 07:31:01+00:00,{'WFL': 1},"The ""undead"" attribute for `unit_type_callable` was split in https://github.com/wesnoth/wesnoth/commit/d82762b87d8#diff-7842222d67a8d773accb3fa2e9b89c54e5342a648566c987c88004eb8998b1bc but the input remained and the split was not done for `unit_callable`.

For 1.18 I think it might be best to fix the input to have it work for unit and unit type. It can be removed for 1.20."
1644985773,Fix out of sync errors with pick advance mod,gfgtdf,2023-12-14 21:53:29+00:00,2023-12-16 16:00:17+00:00,{},local lua variables  are not persitent over reloading. moveto events that change the gamestate cannot be undoable unless on_undo code is provided.
1639946801,allow units.remove_modifications to remove multiple types,gfgtdf,2023-12-12 03:37:50+00:00,2023-12-13 16:01:28+00:00,"{'AI': 1, 'Unit Tests': 1, 'UI': 1, 'Lua API': 1, 'Campaign WC': 1}",previously it needed multiple calls to remove multiple types of modifications (which could be slow since each call involves a full rebuild of the unit).
1638146598,add a bunch of resistance ability tests,Pentarctagon,2023-12-11 06:21:17+00:00,2023-12-15 15:59:02+00:00,{'Unit Tests': 1},
1638001354,update copyrights.csv,doofus-01,2023-12-11 03:29:59+00:00,2023-12-11 04:00:18+00:00,{},from the blowgun thing
1637941484,Add clangd cache directory to gitignore,rfsc-mori,2023-12-11 02:04:25+00:00,2023-12-11 04:03:18+00:00,{},"I've written my previous PR using VSCode with the Clangd extension after generating a compile_commands.json file. This environment creates the .cache/clangd [index](https://clangd.llvm.org/design/indexing) directories.

I've decided to request this change as well to help future users and to reduce the need of editing .gitignore locally when contributing more in the future."
1637937433,Allow fine-tuning log levels for log domains from the command line,rfsc-mori,2023-12-11 01:58:33+00:00,2023-12-14 20:56:56+00:00,{},"Fixes the issue #2919.

Old behavior:
The log severities would always override the previous one, in this order: error < warning < info < debug < none.

Changes:
1) Whenever a log domain is specified more than once, the one with higher logging level will be applied, following this pattern: none < error < warning < info < debug.
2) The log domain severity is applied from the most generic directives to the more specific directives. This means that the ""all"" directive is applied before a ""gui/*"" wildcard directive, and then, finally, a ""gui/draw"" is applied last. By redefining this order, it is now possible to fine-tune log levels from the command line.

Tests added:
1) Adds a test case for the log domain severity override ordering, ensuring the domain and severity values parsed from the command line are applied correctly according to the new rules.

Decision context:
I've decided to add this change to commandline_options.cpp for these reasons:
1) It is in the closest context to command line parsing and is very close to the related function parse_log_domains_.
2) The code is not used anywhere else, so I believe it is fine to fix this issue only for the command line code path.
3) It is easily testable and already contains a test suite.
4) Requires the minimum number of changes. One alternative would be implementing this behavior in the log.cpp lg namespace, then passing the vector from wesnoth.cpp process_command_args to a new function that applies the severity to each log domain correctly. Another alternative is adding extra global state to log.cpp and/or set_log_domain_severity to enhance the handling for the ""all"" case.

This is still one of my first PRs for open source projects, so I'm not sure if I did everything correctly. If there are any requests, mistakes or anything at all, please let me know. I'll do my best to fix!"
1637290933,add priority= attribute to [lua]  tags,gfgtdf,2023-12-09 16:22:40+00:00,2025-07-28 15:28:49+00:00,{'WML': 1},"When multiple [lua] tags from different [resource]s [era]s etc interact  with each other, the engine currently make no guarantee in which order they are executed, making it hard to reliably use (global) varialbes/functions in one [lua] tag that was defined in other [lua] tags"
1637252253,"automatically generate ""load_addon_<addon_id>"" [resource]",gfgtdf,2023-12-09 14:08:10+00:00,,{'WML': 1},"It is a common problem that when an addon1 that wants to  make use of another addon2s assets (units etc) it doesn't really have a good way to do so unless addon2 provides a [resource] that addon1 can load via [load_resource]. In particular it seems to be a not so uncommon practice to include other addons data via macro inclusion, however this is a very bad things to do since

* It parses the addons basicially twice (or even more times), resulting in much longer loading times.
* It evades the addon versions checks in mp (when the version of the included addon had changed for one player), leading to possible OOS erros during the game.
* It will can lead to events being exceuted twice when multiple addons include the same code that way.

To make it easier for addon1 to load addon2 without having to ask the author of addon2 to add a [resource] he can load, the game now automatically generates a [resource] for each addon."
1637076417,removed the compression code,Walker0710,2023-12-09 06:25:21+00:00,2024-04-01 20:06:32+00:00,"{'Docs': 1, 'Engine': 1}",
1636639277,Use index 0 when current theme is not found,soliton-,2023-12-08 19:01:37+00:00,2023-12-11 12:05:10+00:00,{'UI': 1},Trying to open the preferences dialog when a theme from an addon was selected that is not currently in use asserts in menu_button::set_values.
1636280025,"EI S04b: fix scenario id, fix macro in translatable string",stevecotton,2023-12-08 14:32:16+00:00,2023-12-10 21:53:14+00:00,"{'Prose': 1, 'Campaign EI': 1}","Two commits, related by the fact that one renames a file that the other one changes. Will split into two PRs if either needs to be significantly changed.

EI S04b: use en_US spelling for the scenario id
---

* S04b start-of-scenario saves since 1.17.21 will be broken
* S03 mid-scenario saves since 1.17.21 will show a warning,
  and players will only be able to go west
* Saves from earlier versions are already broken by the campaign rewrite

Fixes #7994, but does not change the translatable strings which are also mentioned in that issue.

EI S04b: Avoid using a macro in a translatable string
---

The required number is already in a WML variable, herbs_needed. However, the string is used in an `[objective]` tag, which means we're not necessarily in an ActionWML block when it's shown, and thus can't use the Lua API to look up plural strings. Instead, brute force it by making 6 separate strings.

Also, use the mainline `ALTERNATIVE_OBJECTIVE_CAPTION` macro instead of a campaign-specific translatable string.

Fixes #8086, which requires changing a translatable string."
1636077519,Invalid [resistance] who don't have max_value attribute,newfrenchy83,2023-12-08 12:08:18+00:00,2023-12-12 17:40:46+00:00,"{'Unit Tests': 1, 'Units': 1}","Fix https://github.com/wesnoth/wesnoth/issues/8092 issue.

If [resistance] ability don't contain ""max_value"" attribute, it will be removed of the list because invalid"
1635969645,Fix [resistance] without max_value bug,newfrenchy83,2023-12-08 10:47:12+00:00,2023-12-14 23:12:44+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1}","Fix https://github.com/wesnoth/wesnoth/issues/8092 issue.

If none [resistance] ability of the list contain max_avlue, on default value of 100 is used instead."
1632931032,Fix #8090 : end credits not showing when a scenario has no [side]s,gfgtdf,2023-12-06 17:14:39+00:00,2023-12-06 22:06:17+00:00,{},
1627484354,1.18 - Sprite updates to Ravens and Ants,doofus-01,2023-12-04 03:36:09+00:00,2023-12-11 02:28:08+00:00,"{'Graphics': 1, 'Units': 1}","Reviewing the ants and ravens.  This should make the ants more visually distinct from each other.  This screenshot shows where we are when PR is opened.
![ants-ravens](https://github.com/wesnoth/wesnoth/assets/13510196/5d4b0edf-d201-4c44-9a4a-c790e0fefbe3)
"
1626836394,WoF: fix macro argument in translatable string,Jonathan-Kelly,2023-12-02 20:17:30+00:00,2023-12-05 12:37:54+00:00,{'Campaign (any)': 1},"This simply puts the raw macro argument in a temporary variable.

Resolves  #8084"
1626560860,use game_events.add in on_event.lua,gfgtdf,2023-12-02 04:53:53+00:00,2023-12-15 20:28:46+00:00,{'Lua API': 1},"previously on_event.lua and game_events.add had seperate priority lists, so that unrelated of the priority parameter (which both game_events.add and on_event.lua now support) on_event.lua events were always excuted first. 

The set_undoable(false) call is there for compatibility with the old on_event implementation."
1625780218,Allow wesnoth --preprocess to work on files without the .cfg extension,stevecotton,2023-12-01 14:20:31+00:00,2023-12-01 16:05:10+00:00,{},"The changed function is only called when using --preprocess, but calls itself recursively. This moves the filename filter to be around the recursive call, thus skipping the check for the top-level call.

Fixes #7654.

Ping @ProditorMagnus "
1625167094,add a bunch of regenerate tests,Pentarctagon,2023-12-01 07:38:07+00:00,2023-12-06 05:15:26+00:00,{'Unit Tests': 1},"mostly the same as the heals tests, since they're basically the same ability with different defaults."
1623761255,Solution to #7768. Added a way for players to change an existing label to an empty label. ,alesk852,2023-11-30 13:59:38+00:00,2023-12-22 12:13:24+00:00,{},"Hello! 
This is my solution to #7768.

I made a statement that checks if the player wants to change the name of an existing map label to an empty label. And then creates a label that is visually empty but won't be deleted and thereby will still be recorded.

I tested my solution by running two instances of the game, entered multiplayer and logged in with two different accounts. Then I created a game and tried all the different permutations that one can create a label and change it to an empty text.

This is my first time contributing to Westnoth and would really appreciate the feedback!"
1620405739,Add a 'special_id_active' attribute to [overwrite] in case the 'experimental_filter_specials' filter is not accepted(postpone 1.19),newfrenchy83,2023-11-28 17:49:14+00:00,2024-10-16 14:20:58+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1}","
Because of this risk I duplicate special_id_active in overwrite to be sure to maintain a way to remain selective on the abilities/specials to overwrite."
1617803210,lg::severity Enum refactoring,ZBugH1,2023-11-27 11:39:26+00:00,2023-12-08 12:55:51+00:00,"{'MP': 1, 'UI': 1, 'Add-ons': 1}","Refactored all relevant code to use `lg::severity` Enum instead of `int` type. 
A nice-to-have prerequisite for issue #7894 (not technically required but would be nice).
"
1617378772,"Make mp server from ""Host Networked Game"" listen on all interfaces",loonycyborg,2023-11-27 06:48:58+00:00,2023-11-27 14:14:02+00:00,{'UI': 1},"Fixes issue #8072
"
1617305897,Add a bunch of tests for heals.,Pentarctagon,2023-11-27 05:43:03+00:00,2023-11-30 10:09:52+00:00,"{'Unit Tests': 1, 'Schema': 1}","Covers only attributes, not filters."
1617123038,Adaptive drag threshold,ZBugH1,2023-11-27 01:15:38+00:00,2023-12-01 14:29:51+00:00,{},"Implemented TODO* in `mouse_handler::drag_threshold()`

Changes the drag threshold from 14 to be based on window resolution. Scaling is performed so that a 1080p window has the original threshold of 14 (since 1080p is currently the most popular monitor size and I assume people are mostly playing Wesnoth in full screen mode). 

*Note that I haven't used the physical screen size because I imagine that it would be impractical to maintain cross-platform, and probably it isn't a good measure of user perceived drag distance anyway (eg. you hold a phone much closer to your face than a laptop). 

The main use case for this is ensuring that on very high resolution displays the drag distance is still reasonable. 

Tangentially related to issue #7955
Closely related to issue #8071"
1616437566,Avoid enabling deprecation logging after disabling,ZBugH1,2023-11-25 05:08:25+00:00,2023-11-27 11:42:58+00:00,{},"Fixes issue #7894

Setting ""log-none deprecation"" causes the deprecation severity to be set to -1 (disabled). The problem was that debug mode being enabled changed the deprecation severity afterwards hence
enabling deprecation messages.
"
1616411202,1.17/1.18 - UtBS blowgun icon,doofus-01,2023-11-25 02:48:55+00:00,2023-12-11 03:22:12+00:00,"{'Graphics': 1, 'Units': 1, 'Campaign UtBS': 1}","Updates the Quenoth blowgun attack icon to avoid image clash - see #7907
EDIT:  Icon in context
![blowgun_demo](https://github.com/wesnoth/wesnoth/assets/13510196/a96f09d9-b0dd-44f7-997a-06ce0eb0aab8)
"
1615484549,Add functionality to Time Schedule Editor,babaissarkar,2023-11-24 09:23:19+00:00,2023-12-14 23:12:08+00:00,"{'macOS': 1, 'UI': 1, 'Editor': 1, 'Building': 1, 'Schema': 1}","Changes :
1. Pressing the OK button in the Time Schedule Editor in the Map Editor now modifies the current schedule.
2. `Save Scenario As` menu item now writes the current assigned schedule to `utils/schedule.cfg`.
3. `color_slider_callback()` has new parameter to identify slider. Previously with one callback, the g and b sliders in the ui were not updating their values.
4. New `Description` textbox added in `custom_tod` dialog that allows to view and modify the `description` key of the `[time]` tag.
5. The Time Schedule button/hotkey now disabled unless the user is editing a scenario.
6. Preview button for color sliders. Map color changes can be previewed without closing and reopening the dialog.
7. WML translatable attributes written with leading underscore '_'."
1612955091,Remove unused RESIST_DAMAGE macro,soliton-,2023-11-22 14:45:18+00:00,2023-11-24 18:28:59+00:00,{'Campaign (any)': 1},
1612354688,Add (and use) a drawing function to clear the current render target,mesilliac,2023-11-22 08:39:15+00:00,2023-11-22 23:30:01+00:00,{'UI': 1},"This might fix #8061 ... in any case `fill(0,0,0,0)` wasn't doing what it was supposed to.

I added a `draw::clear()` function to clear the current render target / fill it with transparency, as semi-transparent fills are being used in a few places and i don't want to change how they work."
1610598784,Clip rerender requests to the window area.,mesilliac,2023-11-21 09:50:18+00:00,2023-11-21 20:05:52+00:00,{'UI': 1},Should fix #8044.
1608055098,Remove Saurian Seer and Soothsayer from the leaderpool,Hejnewar,2023-11-19 19:57:07+00:00,2023-11-19 21:36:51+00:00,{'MP': 1},Reason: Saurian Seer and Soothsayer have 7mp
1607790193,UtBS: Mention the campaign mechanics in the campaign description,stevecotton,2023-11-19 04:00:42+00:00,2023-11-20 17:12:36+00:00,"{'Enhancement': 1, 'Campaign (any)': 1}","Let players see what to expect when looking through the campaign menu, instead of only giving players this information after they start the campaign and have no clear or quick way to return to the main or campaign selection menus.

The cherry-picks text from both the commits and the review comments of #8027, and fixes part (but not all) of #8009.

The preceding translatable string includes trailing newlines, but is the same as 1.16. So I've left that as-is, while using a separate non-translatable string for the new string's newlines."
1607712884,WoF S6: weaken player allies,Jonathan-Kelly,2023-11-18 21:31:09+00:00,2023-12-04 17:05:51+00:00,{'Campaign (any)': 1},A small balance patch based on feedback from @Hejnewar over [here.](https://github.com/wesnoth/wesnoth/pull/8031#issuecomment-1797917693)
1607346731,Add female name strings for drake units,Jonathan-Kelly,2023-11-18 01:43:21+00:00,2023-11-20 15:42:50+00:00,{'Units': 1},"This (should) solve the issue raised by Antro of the Italiano translation team [on the forums](https://forums.wesnoth.org/viewtopic.php?p=684505#p684505). Basically, some languages have no neuter gender or cannot use it for unit names without sounding very awkward. So if any drake character is female, then its `unit_type` must also have a translatable string available for the female version of its name.

As with the naga race, there is no need for new sprites to be created for female variations of drake units. Since our real life audience is entirely made up of humans, they will not be able to tell the difference between male and female dragons anyway. :p

Additionally, this enables the long unused female drake name list and name generator to be used for recruited and randomly spawned units."
1606156583,reverse change to filter_ability ->experimental_filter_ability,newfrenchy83,2023-11-17 10:49:38+00:00,2023-11-17 13:18:57+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1}","By changing the names of filter_ability to experimental_filter_ability, I think I'm making a mistake. By doing this, we will force the authors who use these filters to change the names when we exit the ""experimental"" phase and I don't like that, it would be better to just indicate it in the changelog and the wiki."
1605560682,[filter_specials] -> [experimental_filter_specials],Pentarctagon,2023-11-17 02:21:51+00:00,2023-11-17 23:41:41+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1}",Since it calls into the same code as [filter_ability] did.
1603038263," remove checking for the presence of add, sub etc. attributes when check value.",newfrenchy83,2023-11-15 18:42:40+00:00,2023-11-16 13:55:55+00:00,{'Units': 1},"For me (and this is not the opinion of @soliton-) when we check the value of the value attribute,
 we seek to verify that the value encoded in ability (or possibly the default) corresponds,
 the value by default means that the value attribute is encoded with this default value, that's it.
 Apparently @soliton- understood that it was the returned value that was checked and
 I let myself get into this error which I am now correcting.

currently absence of default value is only detected when other numeric attributes are used, this commit is here to repair this rather unfortunate oversight."
1602958709,rename [filter_ability(_active)] to experiemental_ability,newfrenchy83,2023-11-15 17:38:11+00:00,2023-11-16 00:05:57+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1}","because it is experimental the tag of filter is changed except for [overwrite][filter_specials]

a bug is fixed also for case or ability diffrent of drains, berserk etc in checking 'value' attribute"
1602464045,Solution to #7768 (No Label removing for other players in multiplayer),ecomitz,2023-11-15 12:31:19+00:00,2023-11-21 18:37:57+00:00,{'MP': 1},"In issue #7768 we see an issue where if you delete a label by emptying its contents, it is deleted for you, but not other players in multiplayer. I attempted to remedy this issue this way:

I first examined the issue and discovered that the game currently has no way of deleting a single label - which, can be considered a separate issue per se. I resolved to then try to kill two birds with one stone - but first only resolving the first issue, and starting to carve the path for the second (An option to simply remove a single label)

First, I learned how the game maintains these things - a config file is created and maintained by the multiplayer server being run, and can accept commands to manipulate the file for the scenario maintaining the labels for everyone. 

I started first with labels themselves - their own ability to delete and find labels innately. 

I then looked at the recorder - the thing responsible for recording things that happen in the game, and told it how to record and send the command to the server, and implemented it into menu events

I taught the server to recognize ""clear_label"" (a single label) as a command. 

I tested this by running the boost test suite, and I used two computers with a locally built server, created labels, modified them without deletion to test whether or not that still works, cleared all labels to test whether or not that still works, and I emptied labels to see if the other player would still see it, and voila, the other player no longer sees the other label. 

Please feel free to ask any questions, comments, or if I need to change anything else, also feel free to let me know. If you folks would like a video of the aforementioned test, I can do it when I get home today from work. Thank you. 

"
1600478802,UtBS S02: Beach Sand is a dehydrating terrain,newfrenchy83,2023-11-14 10:38:08+00:00,2023-11-15 18:57:00+00:00,"{'Ready for testing': 1, 'Campaign (any)': 1}","
all terrain sand should be deshydrating terrain."
1600467560,verify what ''add'' 'sub' etc.. modify value by default in filter_ability checks 'value'(postpone1.19),newfrenchy83,2023-11-14 10:31:04+00:00,2023-11-16 09:42:24+00:00,{'Units': 1},"As @soliton- in https://github.com/wesnoth/wesnoth/issues/7992#issuecomment-1795270245 noticed the presence of 'add' 'sub' etc.. is not enough to determine if the default value of an ability is changed (add=0, multiply=1); hence this repair to refine it to ensure the value is not changed."
1598022409,Update SDL render hints,Wedge009,2023-11-13 01:17:39+00:00,2023-11-17 02:05:33+00:00,{'Graphics': 1},"Resolves #8038 by requesting Direct3D v11 over the default Direct3D v9 on Windows platforms.

According to https://discourse.libsdl.org/t/a-couple-of-questions-regarding-batching-in-sdl-2-0-10/26453/2, `SDL_HINT_RENDER_DRIVER` implies `SDL_HINT_RENDER_BATCHING=0`. I tested `SDL_HINT_RENDER_BATCHING=1` on Windows and Linux and was not able to replicate #4237 nor #4245 (I was never able to replicate the related #4309). Given the rendering work I think disabling batched renders is no longer necessary.

I suppose we could force `SDL_HINT_RENDER_BATCHING=1` on Windows as well just for consistency but Wesnoth isn't exactly a demanding application in terms of rendering. If someone with sufficiently low-end hardware can demonstrate a significant difference between batched and non-batched renders, then we can consider enforcing it for Windows too."
1597659649,Favour OpenGL over DirectX on Windows (resolves #8038),Wedge009,2023-11-12 07:36:48+00:00,2023-11-13 01:18:24+00:00,"{'Windows': 1, 'Graphics': 1}",No idea if we really want to take this option but this works around the issue of #8038 by avoiding the specific renderer that exhibits that issue - namely DirectX.
1597638690,Show an error when mainline campaigns are missing.,Pentarctagon,2023-11-12 05:52:27+00:00,2023-11-17 02:06:02+00:00,{'UI': 1},"A Linux packaging issue has, for apparently multiple years now, resulted in Wesnoth getting installed with only the tutorial campaign available. So, check for that and alert the player that there's an issue so they don't think Wesnoth actually only has a tutorial available.

Fixes #7875"
1597523085,New unit test for UtBS-style [heals] with a filter,stevecotton,2023-11-11 20:31:51+00:00,2023-11-15 16:45:59+00:00,{'Unit Tests': 1},"The ability's code in UtBS hasn't changed since 1.16, but there's now bug #8037 about healing sometimes not working in UtBS S02. The new test was written to check for an engine bug when a healer has two units next to it, only one of which passes the filter. Although the test is passing, it seems reasonable to keep the test.

Also, use `{ASSERT ...}` for better logging in the old healing test."
1590445799,Help Browser: only show one image if male and female are the same,stevecotton,2023-11-07 12:04:37+00:00,2023-11-07 23:44:47+00:00,"{'Enhancement': 1, 'Low Priority': 1, 'Help': 1}","If a unit type has male and female versions, then two images of the unit are displayed at the top-left of the help page. However, it did this even if the two images were the same, which made the duplication look like a bug.

The Naga Fighter is one of the affected unit types.

This was reported in the [WoF discussion about female drakes](https://r.wesnoth.org/p684546), and I was in the middle of logging a ""good first issue"" bug when I realised it was just a one-liner.

Screenshot **without** the fix:
![image](https://github.com/wesnoth/wesnoth/assets/101462/816f7fcf-712b-4519-b7d1-3bb9f67805ef)"
1590393335,[🗺️ World Conquest⚔️] Renamed the Difficulty Levels to reflect their true Difficulties ,AugustVesterbacka,2023-11-07 11:28:31+00:00,2023-12-01 14:28:44+00:00,{'Campaign (any)': 1},"resolves #7661

Implements @knyghtmare 's latest suggestion from issue #7661

Field | 1 | 2 | 3 | 4 | 5 | 6
-- | -- | -- | -- | -- | -- | --
Old Name | Beginner | Easy | Medium | Hard | Challenging | Expert
New Implemented Name | Normal | Challenging | Difficult | Fanatical | Torment | Nightmare
Unit Image | Peasant | Sergeant | Lieutenant | General | Marshal | Dragon
"
1589756229,EI - Sentinel Shield Bugfix,Dalas121,2023-11-07 02:29:25+00:00,2023-11-11 03:16:06+00:00,{'Campaign (any)': 1},"During the transition from add-on to mainline, EI's Sentinel Shield item's behavior got broken. This fixes it."
1588959786,WoF: list unique mechanics in campaign description,Jonathan-Kelly,2023-11-06 16:17:24+00:00,2023-11-20 16:05:54+00:00,{'Campaign (any)': 1},"Resolves #8008 

Any thoughts on the wording or formatting?"
1587863074,Quick hack to get the gamestate inspector working again.,Pentarctagon,2023-11-06 05:17:00+00:00,2023-11-08 15:50:19+00:00,{'UI': 1},"This doesn't fix the underlying issue with labels trying to show text too long to be rendered, but it does at least make the text show up now.

Fixes #7565, not sure about the other inspector related issues."
1587559633,UtBS: Add note on modified game mechanics to campaign description,Hejnewar,2023-11-05 20:57:42+00:00,2023-11-20 18:20:21+00:00,{'Campaign (any)': 1},Probably not good enough but good enough to start a discussion I hope. 
1587551549,Update title screen widget blur when resizing the game window,mesilliac,2023-11-05 20:33:41+00:00,2023-11-22 23:30:35+00:00,{'UI': 1},"This adds a check to regenerate blur whenever the screen region of the blur changes. This should catch most cases of moved and resized widgets.

It also explicitly regenerates the title screen blurs when the prefs dialog is closed. Otherwise the regenerated blurs will include the prefs dialog that's sitting on top.

Fixes #8023 "
1587217046,touchup wall-rough-chasm to fix #8001,doofus-01,2023-11-04 22:06:38+00:00,2023-11-04 22:10:03+00:00,"{'Graphics': 1, 'Terrain': 1}",
1587188984,Avoid accessing data of potentially killed unit,soliton-,2023-11-04 20:27:59+00:00,2023-11-12 21:12:17+00:00,{'Lua API': 1},Fixes #8019.
1587144602,"1.17/1.18 - adjust bridge layering, fixes #8010",doofus-01,2023-11-04 17:33:14+00:00,2023-11-04 19:57:12+00:00,{'Terrain': 1},
1587042587,touchup to direwolf defense frames,doofus-01,2023-11-04 12:43:27+00:00,2023-11-04 15:28:38+00:00,"{'Graphics': 1, 'Units': 1}",
1586963593,Work around #7543 for 1.16,Wedge009,2023-11-04 07:48:11+00:00,2023-11-18 02:11:43+00:00,"{'Building': 1, 'Stable 1.16': 1}","Works around #7543 for MSVC developers but does not resolve it as the official Wesnoth Windows builds do not use MSVC or vcpkg.

Only necessary for 1.16 because 1.17+ uses fontconfig."
1586797857,Fix overlapping fog texture at some zoom levels,mesilliac,2023-11-03 22:53:43+00:00,2023-11-05 11:34:44+00:00,{'Graphics': 1},"Zoom scales, which are described in draw-space pixels, were always required to be multiples of 4. This was violated at some point, resulting in graphical glitches when drawing fog at some zoom levels.

This both checks that zoom scales are divisible by four, and changes the zoom level specification to integers rather than multiplication factors so that they can be specified accurately.

This *also* fixes an auxiliary problem that the 1/3x zoom level specified as ""0.33333333333333333"" was incorrectly rounding to 23 in stead of 24, resulting in more graphical glitches.

This is related to #6959 but won't fix it entirely as that's a separate problem. The 1/3x zoom level is likely improved however.

These are the types of glitches fixed by this change. They are only obvious in fog, as that applies twice when hexes overlap:
![fog_glitches](https://github.com/wesnoth/wesnoth/assets/243646/b4b9e328-bfb4-44b4-8aca-dca0455413ba)
"
1586363731,Logging improvements,soliton-,2023-11-03 16:15:20+00:00,,{'MP': 1},Improve uniformity of logging statements.
1580694251,UtBS: Units with tailwind have green orbs and rest-heal,stevecotton,2023-10-31 10:44:19+00:00,2024-01-05 10:07:37+00:00,"{'Bug': 1, 'Campaign UtBS': 1}","Fixes #7966

In UtBS, at the start of the player's turn any units that are next to a Quenoth Shaman get +1 move (or +2 for some of the L2/L3 shamans).

Without this fix, the buffed units have an orange orb instead of the green unmoved orb, and don't rest-heal next turn. This makes things look correct during the player's turn, at the expense of showing the unit's max_moves as the buffed amount, even if the unit won't get the buff next turn."
1580293457,Update CONTRIBUTING.md,ghost,2023-10-31 06:13:19+00:00,2023-11-10 10:43:50+00:00,{'Docs': 1},"# Fixed a typographical error in the repository

Revised the sentence for enhanced clarity and resolved a grammar issue by changing:

 should -> should use it"
1580083213,Fix the --screenshot commandline arg,mesilliac,2023-10-31 01:42:31+00:00,2023-10-31 22:33:30+00:00,{'Command Line': 1},"It does require a rendering context now.

I added a new fake video mode that just does everything as normal except with the main window hidden.

Also renamed the `video::fake` enum entries for a bit more clarity.

It seems to work for me. I'm not sure how it would work on a headless system, but i think anything that can run the unit tests should be able to do `--screenshot` as well."
1578734159,replace alternative/replacement_type with 'type' in [filter_attack/weapon],newfrenchy83,2023-10-30 10:12:24+00:00,2023-11-10 22:35:57+00:00,"{'Campaign (any)': 1, 'Unit Tests': 1, 'UI': 1, 'Units': 1, 'Schema': 1}","To respond to an objection from @CelticMinstrel in https://github.com/wesnoth/wesnoth/pull/7865#issuecomment-1784239363, I moved alternative/replacement_type in matches_ability_filter and checking will be done with the 'type' filter in attack_type ::matches_filter() with security, if the function is called from a weapons specials([filter_self/opponent][filter_weapon]) then the type encoded in [damage] will not be checked to avoid a recursive loop."
1577715876,1.18 - Some loyalist animation updates,doofus-01,2023-10-29 01:29:14+00:00,2023-10-30 00:45:09+00:00,"{'Graphics': 1, 'Units': 1}",Whatever I can get done this weekend.  No changes to anything but animations.
1577678417,add some logging to game history query,Pentarctagon,2023-10-28 22:35:38+00:00,2023-11-02 16:04:07+00:00,"{'MP': 1, 'Add-ons': 1}","---

Not sure if this makes sense to keep after the performance issue is resolved or not, but the goal is:
* log the actual SQL statement being run, to make sure it matches what I think it should.
* log between the individual steps so it's clear which is taking up too much time."
1577587303,Start game with theme buttons hidden.,mesilliac,2023-10-28 15:48:00+00:00,2023-10-29 23:24:28+00:00,{'Graphics': 1},"Fixes #6922

Just hides the buttons until the game has started. There was already a function to cause the game map not to draw while the story screen was showing, so i just used that as the cue for unhiding the buttons.

There is some weirdness with the buttons under the minimap appearing at different times. But that seems to be a separate issue, and unrelated."
1577585953,Multipass rendering,mesilliac,2023-10-28 15:42:34+00:00,2023-10-29 23:28:14+00:00,{'UI': 1},"I didn't like that the blur effect required two frames to render, so i implemented basic multipass rendering. That is, while rendering, anything can request that another rendering pass is performed before flipping to the screen. This means the blur can render the thing behind it, blur that, then render itself, all in the same frame.

Theoretically this would also work for multiple layered blurs, rendering in three or more passes. But try not to do that as it's expensive, and will probably drop frames on weak hardware.

I also noticed while testing that the story screen text panels now have blur, and it wasn't updating, so i forced it to regenerate the blur at each step. Without the multipass rendering, this causes a one-frame flicker which was pretty much unacceptable. It looks pretty good now."
1577570314,Allow filter also apply_to in [resistance],newfrenchy83,2023-10-28 14:45:51+00:00,2023-10-28 17:42:24+00:00,{'Units': 1},"In engine [resistance] is the only ability that also uses the apply_to attribute, but in a different way than for special weapons so I propose that in this case the filter applpy_to does not have a default value.

It seems unlikely to me that anyone will use this attribute in a custom ability (dummy, tailwind etc.) but if it is considered possible then I will abandon the idea"
1577522314,fix [filter_ability] issue,newfrenchy83,2023-10-28 11:38:34+00:00,2023-10-28 14:30:12+00:00,{'Units': 1},Fix https://github.com/wesnoth/wesnoth/issues/7992
1576582224,show error message if wml author don'tuse booelan value on bool filter call bool_matches_if_present,newfrenchy83,2023-10-27 13:10:43+00:00,2023-10-28 11:46:55+00:00,{},"if filter[attribute] has value other what boolean, it can't doing checking and should return true like if !filter.has_attribute(attribute).

name of function and bool_or_empty() changed."
1575746144,Improve performance of the game history query by a lot.,Pentarctagon,2023-10-27 00:13:23+00:00,2023-10-27 19:44:06+00:00,"{'MP': 1, 'Add-ons': 1}","Fixes #7988

I have no idea why this helps anything at all, since my understanding has always been that inner joins vs a big where clause are essentially two different ways of accomplishing the same thing, but changing the two inner joins to a where clause improves query performance from 6.3 to 0.012 seconds (when running the query from the website VM). As best I can tell from the explain plans, the inner joins are somehow confusing the query optimizer to use the game_content_info table as the starting point of the query instead of the game_info table, but why it's doing that or why it has such a large impact remains a mystery.

------

Current query:
```
select 
  game.GAME_NAME, 
  game.START_TIME, 
  GROUP_CONCAT(CONCAT(player.USER_NAME, ':', player.FACTION)) as PLAYERS, 
  IFNULL(scenario.NAME, '') as SCENARIO_NAME, 
  IFNULL(era.NAME, '') as ERA_NAME, 
  IFNULL(GROUP_CONCAT(distinct mods.NAME), '') as MODIFICATION_NAMES, 
  case 
  when game.PUBLIC = 1 and game.INSTANCE_VERSION != 'trunk' 
  then concat('https://replays.wesnoth.org/', substring(game.INSTANCE_VERSION, 1, 4), '/', year(game.END_TIME), '/', lpad(month(game.END_TIME), 2, '0'), '/', lpad(day(game.END_TIME), 2, '0'), '/', game.REPLAY_NAME) 
  when game.PUBLIC = 1 and game.INSTANCE_VERSION = 'trunk' 
  then concat('https://replays.wesnoth.org/', game.INSTANCE_VERSION, '/', year(game.END_TIME), '/', lpad(month(game.END_TIME), 2, '0'), '/', lpad(day(game.END_TIME), 2, '0'), '/', game.REPLAY_NAME) 
  else '' 
  end as REPLAY_URL, 
  case 
  when game.INSTANCE_VERSION != 'trunk' 
  then SUBSTRING(game.INSTANCE_VERSION, 1, 4) 
  else 'trunk' 
  end as VERSION 
from wesnothd_game_info game 
inner join wesnothd_game_player_info player 
   on exists 
  ( 
    select 1 
    from wesnothd_game_player_info player1 
    where game.INSTANCE_UUID = player1.INSTANCE_UUID 
      and game.GAME_ID = player1.GAME_ID 
      and player1.USER_ID = 132039
  ) 
  and game.INSTANCE_UUID = player.INSTANCE_UUID 
  and game.GAME_ID = player.GAME_ID 
  and player.USER_ID != -1 
  and game.END_TIME is not NULL 
inner join wesnothd_game_content_info scenario 
   on scenario.TYPE = 'scenario' 
  and scenario.INSTANCE_UUID = game.INSTANCE_UUID 
  and scenario.GAME_ID = game.GAME_ID 
inner join wesnothd_game_content_info era 
   on era.TYPE = 'era' 
  and era.INSTANCE_UUID = game.INSTANCE_UUID 
  and era.GAME_ID = game.GAME_ID 
left join wesnothd_game_content_info mods
   on mods.TYPE = 'modification' 
  and mods.INSTANCE_UUID = game.INSTANCE_UUID 
  and mods.GAME_ID = game.GAME_ID 
group by game.INSTANCE_UUID, game.GAME_ID 
order by game.START_TIME desc 
limit 11 offset 0;
```
Explain plan:
```
+------+--------------------+----------+--------+---------------------+-------------+---------+-----------------------------------------------------------+---------+----------------------------------------------+
| id   | select_type        | table    | type   | possible_keys       | key         | key_len | ref                                                       | rows    | Extra                                        |
+------+--------------------+----------+--------+---------------------+-------------+---------+-----------------------------------------------------------+---------+----------------------------------------------+
|    1 | PRIMARY            | scenario | ALL    | PRIMARY             | NULL        | NULL    | NULL                                                      | 4272062 | Using where; Using temporary; Using filesort |
|    1 | PRIMARY            | game     | eq_ref | PRIMARY             | PRIMARY     | 148     | forum.scenario.INSTANCE_UUID,forum.scenario.GAME_ID       | 1       | Using where                                  |
|    1 | PRIMARY            | era      | ref    | PRIMARY             | PRIMARY     | 550     | forum.scenario.INSTANCE_UUID,forum.scenario.GAME_ID,const | 1       | Using where                                  |
|    1 | PRIMARY            | mods     | ref    | PRIMARY             | PRIMARY     | 550     | forum.scenario.INSTANCE_UUID,forum.scenario.GAME_ID,const | 1       | Using where                                  |
|    1 | PRIMARY            | player   | ref    | PRIMARY,USER_ID_IDX | PRIMARY     | 148     | forum.scenario.INSTANCE_UUID,forum.scenario.GAME_ID       | 4       | Using where                                  |
|    2 | DEPENDENT SUBQUERY | player1  | ref    | PRIMARY,USER_ID_IDX | USER_ID_IDX | 152     | const,forum.game.INSTANCE_UUID,forum.game.GAME_ID         | 2       | Using index                                  |
+------+--------------------+----------+--------+---------------------+-------------+---------+-----------------------------------------------------------+---------+----------------------------------------------+

```

------

New query:
```
select 
  game.GAME_NAME, 
  game.START_TIME, 
  GROUP_CONCAT(CONCAT(player.USER_NAME, ':', player.FACTION)) as PLAYERS, 
  IFNULL(scenario.NAME, '') as SCENARIO_NAME, 
  IFNULL(era.NAME, '') as ERA_NAME, 
  IFNULL(GROUP_CONCAT(distinct mods.NAME), '') as MODIFICATION_NAMES, 
  case 
  when game.PUBLIC = 1 and game.INSTANCE_VERSION != 'trunk' 
  then concat('https://replays.wesnoth.org/', substring(game.INSTANCE_VERSION, 1, 4), '/', year(game.END_TIME), '/', lpad(month(game.END_TIME), 2, '0'), '/', lpad(day(game.END_TIME), 2, '0'), '/', game.REPLAY_NAME) 
  when game.PUBLIC = 1 and game.INSTANCE_VERSION = 'trunk' 
  then concat('https://replays.wesnoth.org/', game.INSTANCE_VERSION, '/', year(game.END_TIME), '/', lpad(month(game.END_TIME), 2, '0'), '/', lpad(day(game.END_TIME), 2, '0'), '/', game.REPLAY_NAME) 
  else '' 
  end as REPLAY_URL, 
  case 
  when game.INSTANCE_VERSION != 'trunk' 
  then SUBSTRING(game.INSTANCE_VERSION, 1, 4) 
  else 'trunk' 
  end as VERSION 
from wesnothd_game_player_info player , wesnothd_game_content_info scenario , wesnothd_game_content_info era , wesnothd_game_info game
left join wesnothd_game_content_info mods
   on mods.TYPE = 'modification' 
  and mods.INSTANCE_UUID = game.INSTANCE_UUID 
  and mods.GAME_ID = game.GAME_ID 
where exists 
  ( 
    select 1 
    from wesnothd_game_player_info player1 
    where game.INSTANCE_UUID = player1.INSTANCE_UUID 
      and game.GAME_ID = player1.GAME_ID 
      and player1.USER_ID = 132039
  ) 
  and game.INSTANCE_UUID = player.INSTANCE_UUID 
  and game.GAME_ID = player.GAME_ID 
  and player.USER_ID != -1 
  and game.END_TIME is not NULL 
  and scenario.TYPE = 'scenario' 
  and scenario.INSTANCE_UUID = game.INSTANCE_UUID 
  and scenario.GAME_ID = game.GAME_ID 
  and era.TYPE = 'era' 
  and era.INSTANCE_UUID = game.INSTANCE_UUID 
  and era.GAME_ID = game.GAME_ID 
group by game.INSTANCE_UUID, game.GAME_ID 
order by game.START_TIME desc 
limit 11 offset 0;
```
Explain plan:
```
+------+--------------+-------------+--------+---------------------+-------------+---------+---------------------------------------------------------+------+---------------------------------+
| id   | select_type  | table       | type   | possible_keys       | key         | key_len | ref                                                     | rows | Extra                           |
+------+--------------+-------------+--------+---------------------+-------------+---------+---------------------------------------------------------+------+---------------------------------+
|    1 | PRIMARY      | <subquery2> | ALL    | distinct_key        | NULL        | NULL    | NULL                                                    | 502  | Using temporary; Using filesort |
|    1 | PRIMARY      | game        | eq_ref | PRIMARY             | PRIMARY     | 148     | forum.player1.INSTANCE_UUID,forum.player1.GAME_ID       | 1    | Using where                     |
|    1 | PRIMARY      | scenario    | ref    | PRIMARY             | PRIMARY     | 550     | forum.player1.INSTANCE_UUID,forum.player1.GAME_ID,const | 1    | Using where                     |
|    1 | PRIMARY      | era         | ref    | PRIMARY             | PRIMARY     | 550     | forum.player1.INSTANCE_UUID,forum.player1.GAME_ID,const | 1    | Using where                     |
|    1 | PRIMARY      | mods        | ref    | PRIMARY             | PRIMARY     | 550     | forum.player1.INSTANCE_UUID,forum.player1.GAME_ID,const | 1    | Using where                     |
|    1 | PRIMARY      | player      | ref    | PRIMARY,USER_ID_IDX | PRIMARY     | 148     | forum.player1.INSTANCE_UUID,forum.player1.GAME_ID       | 4    | Using where                     |
|    2 | MATERIALIZED | player1     | ref    | PRIMARY,USER_ID_IDX | USER_ID_IDX | 4       | const                                                   | 502  | Using index                     |
+------+--------------+-------------+--------+---------------------+-------------+---------+---------------------------------------------------------+------+---------------------------------+

```"
1573919303,Fix UI update when changing pixel scale in preferences,mesilliac,2023-10-26 00:43:31+00:00,2023-10-27 23:05:04+00:00,{'UI': 1},"This just brings the custom resize event that can be fired in line with the change made in ac96df07bebbfc5d494f7325b89aa42ad4e567a9 .

The only thing that uses this event is the pixel scale slider which fires it manually when changed, as the window size doesn't actually change but the UI still needs to be regenerated.

This fixes the display updating incorrectly when changing pixel scale in prefs. (which i haven't reported because i just fixed it in stead)"
1573394629,Fix include_file= not being able to handle cfg files generated by the editor,gfgtdf,2023-10-25 17:48:49+00:00,2023-10-27 21:41:52+00:00,{},"

including scenarios generated by the editor was the main usecase for this"
1572073773,Don't treat an add-on as published if it has no version attribute.,Pentarctagon,2023-10-25 03:16:24+00:00,2023-10-26 20:39:40+00:00,{'Add-ons': 1},Fixes #7846
1571456694,[Campaigns][Eastern Invasion] fix editor group icon,knyghtmare,2023-10-24 17:27:08+00:00,2023-10-25 15:34:51+00:00,"{'Campaign (any)': 1, 'Editor': 1}","## Summary
Changes Editor terrain Group Icon from ""UMC"" to ""Mainline"".

### Why?
Well, a mainline campaign should not have the UMC terrain group icon. Just looks odd in the terrain group listings.

"
1571428689,[Units] update falcon and raven races to not get names,knyghtmare,2023-10-24 17:04:08+00:00,2023-10-26 06:54:38+00:00,{},"### Context:
- feral wolves do not get names (but wolf riders do, and that's supposed to be true)
- Ants do not get names
- scorpion do not get names
- bears do not get names
- bats do not get names
- Roc does not get name
- falcons and ravens get names which is unusual
- horses do not get names

### Expected behaviour
- Falcons and Ravens should not get names.

This pull request does this."
1570435982,Offscreen window rendering,mesilliac,2023-10-24 06:07:58+00:00,2023-10-27 23:13:34+00:00,{'UI': 1},"I haven't done much (or any, really) testing on this, but it should solve #7615 

I verified that it does reduce CPU usage when opening the Load Game screen while in the tutorial.

I'm not sure if there might be rendering bugs in other areas. But the basic system is straightforward. It just renders windows to offscreen render textures when they change, and doesn't do any more work unless it needs to. When the window needs to be redrawn, it just blits from this texture without actually redrawing anything.

Renders should be minimal, and it's using all the same draw code so actually very little has changed."
1570264623,Get the add-on ID from the file path if possible.,Pentarctagon,2023-10-24 03:06:16+00:00,2023-10-27 15:22:53+00:00,{'Editor': 1},Fixes #7979
1569831107,add error message for #7164,gfgtdf,2023-10-23 19:37:18+00:00,2023-10-25 13:12:24+00:00,{},
1568658038,"UtBS: Balance the ""life and life's demise"" text",stevecotton,2023-10-23 07:58:45+00:00,2023-11-10 10:42:11+00:00,"{'Campaign (any)': 1, 'Units': 1, 'Prose': 1}","This line has already been altered in 94b48615f, so it's going to be fuzzy for the translators anyway."
1567948690,Change editor event from start to prestart.,Pentarctagon,2023-10-22 03:15:05+00:00,2023-10-22 17:03:10+00:00,{'Editor': 1},fixes #7969
1567914026,also invalidate previous location when resizing a widget,gfgtdf,2023-10-21 23:28:27+00:00,2023-10-22 21:34:44+00:00,{'UI': 1},"Fixes #7617

widget::set_origin should probably also call queue_redraw(), not fully sure yet though."
1567746284,Various terrain fixes and additions,doofus-01,2023-10-21 12:58:25+00:00,2023-10-22 18:42:25+00:00,"{'Graphics': 1, 'Terrain': 1}","First commit fixes a bad Xor/Xo* transition, I'll add whatever other fixes or transition improvements I can do in the next day or two."
1567570419,wmltools GUI review,Wedge009,2023-10-21 03:18:51+00:00,2023-11-10 17:55:22+00:00,{'WML Tools': 1},"What started as a string / translation notes review for #7724 turned into a code review as well. I separated changes into commits - I advise looking at per-commit changes instead of trying to view the differences altogether because the auto-formatting causes a lot of changes.

While I could have skipped the auto-format, I honestly find compressed code (no spacing between commas, etc) very hard to read so I think it's worth including. If I had free reign, I'd add a lot new lines between code blocks too, to help with readability and logical grouping ('Sparse is better than dense'?).

The changes for #7724 are towards the end. This PR doesn't close that issue, however, as there are a lot of strings I don't really know the meaning of - mainly the ones displayed as options for each of the tools as shown in their own tab.

I can still run the program on my own system after these changes."
1567204682,fix  [store_reachable_locations] #7891,gfgtdf,2023-10-20 18:50:36+00:00,2023-10-20 20:39:11+00:00,{},
1566931727,Avoid an assert in replay::add_start_if_not_there_yet with corrupt files,stevecotton,2023-10-20 15:41:44+00:00,2023-10-21 18:31:21+00:00,{},"With this it puts the player back to the title screen after showing an error dialog, so it's not much better, but at least it's not a crash.

Fixes #7164

We weren't able to work out what caused the file corruption reported, but I believe it's a race condition about saving while the AI is recruiting. The file in the bug report has a `[snapshot]` tag with `init_side_done=yes` but without a `playing_team` attribute, which must be the result of `game_state::write()` when not in the `PLAY` phase. Loading such a file causes `game_state::start_event_fired_ == false`, and triggers `play_controller::start_game` to call `replay::add_start_if_not_there_yet`.

The i18n'd string is reused from `game_launcher.cpp`."
1563800924,Post-Freeze Typography Review,Wedge009,2023-10-19 01:44:27+00:00,2023-10-23 07:44:51+00:00,"{'AI': 1, 'Campaign (any)': 1, 'MP': 1, 'Unit Tests': 1, 'UI': 1, 'Units': 1, 'Prose': 1, 'Help': 1}","Extends #7964 - not basing this directly on master because when that one gets merged, this will probably result in merge conflicts otherwise.

I just focused on dashes, apostrophes/quotes, and spacing here. The straight-to-curly quote review was wider this time around - I have seen the micro-AI lines come up in searches before, but previously decided to leave them since they don't look like something average players would see. But since they keep coming up in searches I went ahead and changed them this time around.

I don't expect this to be merged very quickly given the current string freeze."
1563800516,Post-Freeze Corrections,Wedge009,2023-10-19 01:44:06+00:00,2023-10-23 07:45:27+00:00,"{'Campaign (any)': 1, 'UI': 1, 'Units': 1, 'Prose': 1}","* Barrow Wight: discussed in #7958.
* UtBS abilities: looks like originally 'taunt' description had 'for a turn', then changed to 'for one turn' as per 'taunted' description. Also added punctuation for clarity.
* Roc: mentioned in #7902.
* Shadow Jumping Spider: spelling error.
* GUI descriptions: found these while looking for 'straight' apostrophes. I'm not sure if the user sees these, but the strings aren't marked for translation so I included them here."
1560453639,"Add a ""Teleport Unit (Debug!)"" option to debug menu",TheHitsy,2023-10-17 12:24:40+00:00,2024-04-16 16:54:24+00:00,"{'UI': 1, 'Input': 1}","resolves #5649 

Added a teleport debug option which works similarly to how move works, you right click a unit and select the teleport debug option (or hover over a unit and press shift + t) and then press left click on the tile you want to teleport to. There is no limitation over where or how far you can teleport as long as it is not on top of another unit. 

### Screenshot 
![](https://github.com/wesnoth/wesnoth/assets/50992547/3acb84e2-97a1-4136-82a3-b2cf6b29f6c3)
"
1558368626,"EI: Move the Horse Barrow Wight to the right dir, and fix a missing word",stevecotton,2023-10-16 11:06:53+00:00,2023-10-16 18:48:07+00:00,"{'Campaign (any)': 1, 'Units': 1}","The text seems odd too, maybe there's more to do here."
1557853802,Replace wesnoth-map-diff with a submodule,cooljeanius,2023-10-16 05:14:20+00:00,2024-07-03 22:57:36+00:00,{},"I recently created a separate repository for the wesnoth-map-diff too, which is here: 
https://github.com/cooljeanius/wesnoth-map-diff
It preserves the existing history of the directory, while allowing it to develop separately, and also be used as a submodule in other UMC that want to make use of it as well.
cc @macabeus @Pentarctagon @stevecotton @soliton- "
1557798636,Correct drag_distance calculation and adjust drag_threshold() to match,daniel-santos,2023-10-16 04:17:39+00:00,2023-10-16 05:18:45+00:00,{},"If the user drags 13 pixels on the x or y axis, but none on the other, then it will not be considered a drag event. However, dragging just 3 pixels in both the x and y direction, a total distance of 4.25 pixels, will be counted as a drag. This patch calculates the correct length and triggers a drag if the total distance is at least 4 pixels in any direction."
1557596662,UtBS: ability names and descriptions,sevu,2023-10-15 22:58:52+00:00,2023-10-15 23:52:44+00:00,{'Campaign (any)': 1},"The sun units have several abilities, but it is basically one big ability.

The STR_VERSE macros won't be used, but I left them in for now.

"
1557557354,Add lua mouse button event handler,daniel-santos,2023-10-15 20:16:19+00:00,2023-10-17 04:08:01+00:00,{'Lua API': 1},"This is a flexible event handler mechanism to allow for more advanced add-on features. It does not allow the add-on to consume the value however, so there's no mechanism for the add-on to requrest the default action not be executed.

We would normally deal separately with mouse down, up and click, with the later being an event where the mouse has gone both down and up on the same UI component. However, Wesnoth's code seems to allow a mouse up on many UI components to serve as a click, so this implementation follows that behavior.

This addresses issue #7949

I'm still in the process of testing, but would like to get this in before the freeze!"
1557483798,Fix crash when mousing over a village in the terrain editor,stevecotton,2023-10-15 16:13:27+00:00,2023-10-16 03:33:09+00:00,{'Editor': 1},"I merged #7920, missing @soliton- 's comment that - ""Actually I get an out of range exception in the editor when hovering over a village. In scenario mode it works fine. I'm guessing the owner_team stuff needs checking.""

This is the fix, and most of it is just a whitespace change for the extra level of indentation."
1557449764,1.17 - Last-minute string cleanups,doofus-01,2023-10-15 14:25:46+00:00,2023-10-15 23:08:22+00:00,{'Units': 1},"This should make the fluff tied to the ravens less placeholder-y.  I'll see if there are any other strings I added that need a quick revision before the freeze, but if 1.17.22 can't wait any longer, this can be merged (assuming it doesn't fail CI for some reason).

EDIT: As much as I dislike the current name of the jumping spiders, I'm having trouble thinking of a clear improvement.
EDIT2:  This is probably all I'll get done, will merge in a couple hours"
1553726683,Remove [filter_ability]type_value=,stevecotton,2023-10-12 08:55:55+00:00,2023-10-12 13:31:45+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1}","This addresses #7944 without addressing #7923. The code and schema changes are a subset of #7924, the test changes are a subset of those in #7924 with an extra assert added on top. I think #7924 should probably be merged, but there's a few changes still under discussion, and so it would be worth merging this and then rebasing to reduce the size of #7924.

There are questions about how `[filter_ability]type_value=` should treat empty values. The use cases that we can think of can be implemented in other ways, for example, if we want to look for big damage boosts, then we could filter for `add=5-infinity` `[or]` `multiply=2-infinity`. The simple answer seems to be to remove `type_value=` from the API before we freeze for 1.18.

Make the ability filter tests stricter. With the default first_time_only=yes then these events would be triggered at most once even if the filter would have passed multiple times."
1548556195,New units & stragglers balance,Hejnewar,2023-10-09 21:18:55+00:00,2023-10-13 19:14:08+00:00,{'Units': 1},"Im not even writing changelog for this, all (or 80%) was added / changed during this patch anyway, 10% is pretty much bugfix and what remains are maybe ant queens unless they were added during this patch as well. 

If no objections mergin withing like soon(tm).

Fail CI I dare u."
1547035480,update copyrights.csv,doofus-01,2023-10-09 01:00:48+00:00,2023-10-09 17:51:06+00:00,{},for #7930 and #7934
1546465700,Fix: global label update bug with empty string,raj007-star,2023-10-07 19:11:24+00:00,2023-10-25 09:35:07+00:00,{'UI': 1},"#7768 

# Bug-fix
**This commit implements a fix for a bug related to updating global labels with an empty string. The issue was that when a player updated an existing map label with an empty string, only the local label was updated, and not the labels of all team members.**

**To address this problem, the code was modified to correctly handle the update of global labels with empty strings. When a label is updated with an empty string, it now removes the old label for the current team and restores the global label in the same spot if there was one. This ensures that all players see an empty string for that label, as expected.**

**The changes made in this commit ensure that the behavior of updating map labels with empty strings is consistent for all players in a multiplayer game.**

```
const terrain_label* map_labels::set_label(const map_location& loc,
		const t_string& text,
		const int creator,
		const std::string& team_name,
		const color_t color,
		const bool visible_in_fog,
		const bool visible_in_shroud,
		const bool immutable,
		const std::string& category,
		const t_string& tooltip)
{
	terrain_label* res = nullptr;

	// See if there is already a label in this location for this team.
	// (We do not use get_label_private() here because we might need
	// the label_map as well as the terrain_label.)
	team_label_map::iterator current_label_map = labels_.find(team_name);
	label_map::iterator current_label;

	if(current_label_map != labels_.end() &&
		(current_label = current_label_map->second.find(loc)) != current_label_map->second.end())
	{
		// Found old checking if need to erase it
		if(text.str().empty()) {
			// Erase the old label.
			current_label_map->second.erase(current_label);

			// Remove the label from other team members
			for(auto& team : labels_) {
				if(team.first != team_name) {
					auto itor = team.second.find(loc);
					if(itor != team.second.end()) {
						team.second.erase(itor);
					}
				}
			}

			// Restore the global label in the same spot, if any.
			if(terrain_label* global_label = get_label_private(loc, """")) {
				global_label->recalculate();
			}
		} else {
			current_label->second.update_info(
				text, creator, tooltip, team_name, color, visible_in_fog, visible_in_shroud, immutable, category);

			res = &current_label->second;
		}
	} else if(!text.str().empty()) {
		// See if we will be replacing a global label.
		terrain_label* global_label = get_label_private(loc, """");

		// Add the new label.
		res = add_label(
			*this, text, creator, team_name, loc, color, visible_in_fog, visible_in_shroud, immutable, category, tooltip);

		// Hide the old label.
		if(global_label != nullptr) {
			global_label->recalculate();
		}
	}

	categories_dirty = true;
	return res;
}

```
*The key change made in the updated code is within the block that handles labels with empty strings. It ensures that when a label is updated with an empty string and removed, the global label (if any) is correctly restored in the same location. This change ensures that all players see an empty string for that label when it is updated, addressing the bug you described.*"
1541101380,"EI Barrow Wight fix, licensing update - attempt #2",Dalas121,2023-10-04 04:30:02+00:00,2023-10-10 14:03:38+00:00,"{'Campaign (any)': 1, 'Graphics': 1, 'Units': 1}","Round 2 of the EI barrow wight fix and licensing update.

> Looks like EI's Barrow Wight unit configuration file was mistakenly deleted at some point, most likely when the Skeleton Rider/Bone Knight sprites were being merged into mainline. This breaks scenario 14_Drowned_Plains, since the Barrow Wight enemy leader doesn't spawn. This PR restores the Barrow Wight's cfg.
> 
> This PR also removes the Skeleton Rider2's cfg, since it was (I think?) mistakenly left in when its sprite was merged into mainline.
> 
> This PR also includes fixes to the attribution for pacifist.png and lamp-genie.png, and removes the unneeded barrow-wight.webp file (thanks Pentarctagon).
"
1539160560,"EI Shadow Mage, Shadow Lord Balance",Dalas121,2023-10-03 02:53:33+00:00,2024-01-23 15:49:44+00:00,"{'Units': 1, 'Campaign EI': 1}","Original Shadow Mage/Lord stats were based on undead's 50% arcane vulnerability.  With the arcane rebalance, the Mage/Lord's arcane weapon is no longer worth using.

This PR adjusts the Lord/Mage's arcane weapon to be stronger, and impact weapon to be weaker."
1537381095,1.17 - Jumping Spider,doofus-01,2023-10-02 03:37:05+00:00,2023-10-09 00:32:18+00:00,"{'Graphics': 1, 'Units': 1}","This is a last minute addition to the Spider roster, I think it would be nice to have some variety there.  It would have been better to include this earlier, but we are where we are.

The images were thrown together somewhat quickly, will need updates, but they should be good enough for the next release?
![Screenshot_20231001_](https://github.com/wesnoth/wesnoth/assets/13510196/2115273c-1fa9-43c2-9bd1-368eaa93d709)
"
1537221784,update_copyrights - improve performance a lot,Pentarctagon,2023-10-01 22:28:07+00:00,2023-10-03 00:43:24+00:00,{},
1536990681,Credits Crash Bug fix,irregularBismuth,2023-10-01 12:02:06+00:00,2023-11-03 17:10:59+00:00,{'UI': 1},"## Fix Issue ##
#6952 
## Solution ##
Implements sliding window by parsing the markup of the string and splitting it into smaller chunks and combining three chunks at a time. By doing this the users will see the credits without it crashing. 

The current solution introduces some magic numbers for how long to move upward in the scroll bar this is not a perfect solution and will need more work as there are some visual glitches!

## New Delimitation ##
As users scroll further, content from the first chunk is replaced by that from the fourth chunk and so on. Consequently, once users move past the initial segment, they cannot revisit it without restarting the credits, introducing a limitation in the scrolling functionality.

"
1536836983,1.17 - Windows (Xo* embellishment),doofus-01,2023-10-01 04:21:24+00:00,2023-10-09 00:37:24+00:00,"{'Graphics': 1, 'Terrain': 1}","This is an embellishment overlay for `Xo*`-style walls.  Currently only:
 - `Xos` barred gap with time-of-day-variants (though day version needs work)
 - `Xoc` stained glass window (also not great, but works for now)

Despite the raw state, I think all the ""API changes"" needed are here, so it should be OK for feature freeze.  The images can be touched-up and other variations can be added later.
![Screenshot_20230930_](https://github.com/wesnoth/wesnoth/assets/13510196/4e7a3179-7288-4e8c-bbac-9157e5061499)
"
1536601529,WoF: new campaign description,Jonathan-Kelly,2023-09-30 13:32:53+00:00,2023-10-13 17:15:48+00:00,{'Campaign (any)': 1},"Somehow I never updated the placeholder campaign description, so doing that now.

Any thoughts? Otherwise, this should be ready to commit."
1535706301,repair detects non-existent default attribute value in numérical attribute,newfrenchy83,2023-09-29 12:58:01+00:00,2023-10-15 01:14:52+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1}","Fix https://github.com/wesnoth/wesnoth/issues/7923 .when we want to detect an ability with value=0-20 and an ability with add=15 is present, this is detected because the system assigns a value of 0 when 'value' is not present, and so the system matches abilities that do not use 'value' or even no numerical value at all. it is therefore necessary to decide that the absence of an attribute is a non-correspondence to the criteria."
1532855633,WC: fix #7921 Random training per scenario,gfgtdf,2023-09-27 17:39:20+00:00,2023-10-16 21:25:13+00:00,{'Campaign (any)': 1},a free random training on easier difficulties should only be given in the first scenario. (Otherwise they'll accumulate to 5 free trainings at scenario 5.)
1531959996,Mousing over a village show the owner side in the UI,AugustVesterbacka,2023-09-27 08:52:52+00:00,2023-10-15 12:51:48+00:00,{'UI': 1},"Solves  #4344

Shows the village owner side when a tile is hovered in the terrain info field.

Fits the field well when the terrain code is two or less (type, village), 
I have not find a scenario where these have been more, and players are less than 10. 
If these conditions are not met the number would go outside the box, but you could still see the flag color clearly.


![VillageOwnerSide](https://github.com/wesnoth/wesnoth/assets/144417269/5aefb396-a5de-4f59-917b-754b35c2ebf8)
"
1531286479,"EI Barrow Wight fix, licensing update",Dalas121,2023-09-26 20:35:29+00:00,2023-10-04 04:24:15+00:00,"{'Campaign (any)': 1, 'Graphics': 1, 'Units': 1}","Looks like EI's Barrow Wight unit configuration file was mistakenly deleted at some point, most likely when the Skeleton Rider/Bone Knight sprites were being merged into mainline.  This breaks scenario 14_Drowned_Plains, since the Barrow Wight enemy leader doesn't spawn.  This PR restores the Barrow Wight's cfg.

This PR also removes the Skeleton Rider2's cfg, since it was (I think?) mistakenly left in when its sprite was merged into mainline.

This PR also includes fixes to the attribution for pacifist.png and lamp-genie.png, and removes the unneeded barrow-wight.webp file (thanks Pentarctagon)."
1531066194,Update copyrights with WoF data,Jonathan-Kelly,2023-09-26 17:56:23+00:00,2023-10-01 02:11:53+00:00,{'Campaign (any)': 1},
1527555364,Add game logic to Forest of Fear,Jonathan-Kelly,2023-09-24 00:47:54+00:00,2023-09-28 22:47:35+00:00,{'MP': 1},"Similarly to #7792 this adds game logic to Forest of Fear rewarding taking and holding the central castle. Each turn, dangerous forest wildlife and magical creatures enter from the edges of the map to attack players and each other (while ignoring villages). Yet these creatures will ally with whichever player occupies the faerie keep using their leader, and for as long as they do. Which means both relief from their relentless attacks and the ability to see through their eyes (`share_vision`) by the magic of the faerie throne.

As with King of the Hill, each side gets two leaders and whenever one dies another replacement leader is always available from the recall list at its full recruiting cost. And a treasure chest of gold (which only a leader can unlock) awaits the first player to claim the center."
1521832562,Add ambusher portrait to core from SotBE,Jonathan-Kelly,2023-09-19 18:51:18+00:00,2023-10-18 16:11:52+00:00,"{'Campaign (any)': 1, 'Graphics': 1, 'Units': 1}",Apparently we have had a saurian ambusher portrait for the past fifteen years. It was only being used with a minor character in one campaign.
1521796659,"EI: ""survivor"" trait no longer grants ""terror"" immunity",Dalas121,2023-09-19 18:24:36+00:00,2023-09-19 18:54:58+00:00,{'Campaign (any)': 1},"Minor tweak to EI.

Mal-Ravanal and Khrakrahs have the ""terror"" ability, reducing the damage of nearby enemies.  The custom ""survivor"" trait (found on a number of scripted units) grants immunity, but these units are numerous and I feel this devalues the ""terror"" ability.  This PR removes survivors' terror immunity."
1520619035,"add `""pkgconf""` to `vcpkg.json`",Chaojimengnan,2023-09-19 04:26:05+00:00,2023-09-20 03:50:09+00:00,{},"When I was compiling on Windows, I got an error:

```text
[cmake] CMake Error at D:/program/cmake/share/cmake-3.24/Modules/FindPackageHandleStandardArgs.cmake:230 (message):
[cmake]   Could NOT find PkgConfig (missing: PKG_CONFIG_EXECUTABLE)
```

PkgConfig installation is quite troublesome in Windows, but vcpkg provides it for us, so we only need to add the following line in `vcpkg.json` to automatically add Pkgconfig during Windows build:

```json
    {
      ""name"": ""pkgconf"",
      ""platform"": ""windows""
    }
```"
1518318728,Add King of the Hill changes to changelog,Jonathan-Kelly,2023-09-16 20:28:39+00:00,2023-09-16 22:32:19+00:00,{},
1518297049,Give kraken submerge ability,Jonathan-Kelly,2023-09-16 18:36:17+00:00,2023-11-20 19:09:26+00:00,{'Units': 1},"Scenario designers can finally have access to a sea creature unit with the submerge ability.

The kraken is based on the [giant squid](https://en.wikipedia.org/wiki/Giant_squid) and [colossal squid](https://en.wikipedia.org/wiki/Colossal_squid) which live in the deepest zones of the ocean (they are products of [deep sea gigantism](https://en.wikipedia.org/wiki/Deep-sea_gigantism)) and have chromatophores for some additional camouflage ability. Also the kraken's eerie green sprite lurks low in the water giving it a stealthy appearance:
![sneaky_kraken](https://github.com/wesnoth/wesnoth/assets/80054769/54eae225-34d5-4b1c-9b94-41ded0a422df)

No balance changes will be needed to DW (where the kraken serves as an advancement for the player's single cuttlefish unit) or WoF (which has already been tested with this). Since it has only recently been added to core, the kraken does not yet appear anywhere else in the game (or UMC) so right now is the perfect time to for this change."
1518272097,Update WoF,Jonathan-Kelly,2023-09-16 16:56:05+00:00,2023-09-23 16:44:33+00:00,"{'Campaign (any)': 1, 'Units': 1}","This will probably be its last big update of for this development cycle. The focus was on game mechanics and balance:

* Added an Easy difficulty setting for new players.
* Recall costs now vary per unit (being equal to its full recruit cost). Similar to #7450 for UtBS.
* Removed all remaining turn limits from scenarios that had no story justification for them.
* Wildlife spawners rewritten for easier maintenance and better balance (they now have populations caps).
* Added the excellent new core wildlife units by @doofus-01
* Tested with the latest unit balance improvements by @Hejnewar"
1517332806,Send messages to newly joining players,Kingofd,2023-09-15 13:12:11+00:00,2023-10-10 16:59:15+00:00,{'MP': 1},"This is my second shot at ""pinning"" comments #6974
Now they are being replayed to each player newly joining

It is as of yet without sending the timestamp with the original message, as that would entail much more effort than just adding the base functionality"
1513553234,fix #7821: all cases of the calculation should be cached,GomesGoncalo,2023-09-13 09:41:11+00:00,2023-09-14 08:10:20+00:00,{'AI': 1},"in the previous logic some cases return from the function and others would set a return variable that would be set later.

this commit, changes all the cases into all returns so that other cases added in the future should not avoid caching.

right now there are no ways to avoid the caching which should be the expected behaviour (unless explicitly added the case where cache is unwanted)"
1512320806,fix #2648: allow load turn in local multiplayer,GomesGoncalo,2023-09-12 15:13:09+00:00,2023-09-12 20:22:26+00:00,{},this commit handles the load_game_exception thrown when the user presses the button to load a specific turn.
1511345878,add image copyright tracking,Pentarctagon,2023-09-12 04:26:09+00:00,2023-09-25 16:47:07+00:00,{'Graphics': 1},"---

This adds a copyrights.csv file, generated by the `update_copyrights` python script. This script checks the existing copyrights.csv file, compares its contents with the current actual contents of the repository (all images and audio files) for files that have been added, removed, or changed since the last time the script was run, and then outputs a new csv file with the added or changed files marked to have their authorship information updated (if needed).

The current contents of copyrights.csv is not necessarily correct - it's entirely possible things are incorrectly attributed or only partially attributed, and there are a bunch of things whose authorship is unknown - but given the various limitations involved it's the best I could do and if nothing else it's a starting point to be able to keep better track of this information.

This also then obsoletes the portraits/ARTISTS file.

Going forward, the options would be:
a) Make this a CI check, with the expectation that anyone who adds or changes any music or art files updates copyrights.csv themselves as part of their commit/PR.
b) I can go through and updates this myself each release as part of the release steps I do."
1509518932,1.17 - Ravens,doofus-01,2023-09-11 03:41:49+00:00,2023-10-01 04:45:40+00:00,"{'Graphics': 1, 'Units': 1}","This is something I'd started earlier in the year.  The window for new things is closing, and while lack of ravens isn't the most pressing issue, it is a project I think I can get completed in time.  Very WIP for now.

EDIT:  Roc isn't a Raven, but it is a bird, and something needs to be done about it before 1.18."
1509338474,1.17 - fix some dragonfly images,doofus-01,2023-09-10 23:33:50+00:00,2023-09-11 04:08:08+00:00,{'Graphics': 1},Very minor PR.  Fixes missing attack icon and badly exported portrait.
1508834769,Kaleh and Nym AMLAs,Hejnewar,2023-09-09 13:38:56+00:00,2023-10-01 20:40:32+00:00,"{'Campaign (any)': 1, 'Units': 1, 'Schema': 1}","So I finally got some decent concept for doing this. General pourpose of this is making them more interesting, customisable and original as well as making playthrus more of a unique experience. 

Legend:
Arrows - amla required
Orance colour - exclusive almas, you can only get one.

New Kaleh ALMA tree: 
![New Kaleh (1)](https://github.com/wesnoth/wesnoth/assets/41817546/36fa53d4-e2c9-45d5-a1cd-7c2c5da86cb8)

New Nym ALMA tree: 
![New Nym](https://github.com/wesnoth/wesnoth/assets/41817546/bde671cf-50e8-4ddb-8dab-a80253a991e0)

Hmm... even now, I wanted to write something about goals or something grand, but whatever, I still see thing to improve, like adding at least one AMLA to Kaleh melee tree and bola disengage for Nym. Discuss! "
1502881274,Miscellaneous units changes (mostly),Hejnewar,2023-09-05 14:04:23+00:00,2023-09-16 17:55:29+00:00,{'Units': 1},"Misc
Elder Falcon - cost changed from 18 to 20.
Soldier ant – cost changed from 16 to 12, hp changed from 35 to 36
Yeti - cost changed from 80 to 151
Piglet – xp changed from 26 to 20
Woodland Boar – cost changed from 15 to 16, hp changed from 35 to 34
Fire guardian – xp changed from 29 to 24, hp changed from 23 to 25
Fire Wraith – gold cost changed from 22 to 17
Bay Horse and Dark Horse – xp changed from 44 to 24
Giant Scorpion - cost changed from 16 to 17.
Fire Ant - xp changed from 50 to 22.
Firebomb Ant - hp changed from 38 to 45, cost changed from 14 to 19.
Giant Ant – xp changed from 26 to 16
Mermaid Initiate – cost changed from 19 to 16, xp changed from 50 to 42
Mermaind Priestess – cost changed from 38 to 31, xp changed from 132 to 61 
Mermaid Diviner – cost changed from 57 to 49
Mermaid Enchanterss – cost changed from 33 to 32, xp changed from 90 to 46
Mermaid Siren – cost changed from 52 to 42
Merman Brawler - cost changed from 19 to 17.
Naga Guardian – xp changed from 35 to 36
Naga Warden – xp changed from 70 to 54
Troll Hero – cost changed from 30 to 42, xp changed from 52 to 90
Great Troll – cost changed from 48 to 78
Troll Shaman – cost changed from 32 to 35
Dwarvish Scout – xp changed from 30 to 33
Dwarvish Pathfinder – cost changed from 30 to 24, xp changed from 60 to 65
Dwarvish Explorer –cost changed from 45 to 51
Dwarvish Runesmith – cost changed from 30 to 27, xp changed from 86 to 71
Dwarvish Runemaster – cost changed from 50 to 55
Dwarvish Arcanister – cost changed form 80 to 98
Dwarvish Miner – cost changed from 19 to 5
Orcish Leader – cost changed from 20 to 21, xp changed from 60 to 54
Orcish Ruler – cost changed from 35 to 45, xp changed from 120 to 102
Orcish Sovereign – cost changed from 50 to 80
Skeleton Rider – xp changed from 44 to 33
Death Squire – xp changed from 144 to 91
Death Knight –cost changed from 45 to 80
Royal Warrior - cost changed from 40 to 47
Elvish Lord – cost changed from 36 to 42, xp changed from 120 to 97
Elvish Highlord	- cost changed from 56 to 77
Nibbler – cost changed from 10 to 15, xp changed from 32 to 26
Caribe – cost changed from 16 to 25, xp changed from 40 to 43
Hunter Caribe – cost changed from 25 to 40
Dragonfly Naiad – cost changed from 8 to 11, xp changed from 23 to 16
Dragonfly – cost changed from 13 to 16, xp changed from 23 to 25
Grand Dragonfly – hp changed from 34 to 39, cost changed from 22 to 30
Ruffian - cost changed from 6 to 7.
Thug - xp changed from 42 to 32.
Bandit - cost changed from 23 to 22, xp changed from 70 to 61.
Peasant and Woodsman - xp changed from 23 to 19.
Elder Mage - cost changed from 65 to 90.
Loyalists
Young Ogre – cost changed from 15 to 13, xp changed from 32 to 34, mountain defense changed from 60% to 50%, arcane resistance changed from 20% to 10%
Ogre – cost changed from 30 to 27, mountain defense changed from 60% to 50%, arcane resistance changed from 20% to 10%
Rebels
Elvish Enchanterss – xp changed from 180 to 198
Elvish Sylph – cost changed from 148 to 161

This is not the end i still didnt do / forgot about some units.
"
1500027567,Nr: Add names of people who helped with rewrite to the credits,TheShadowOfHassen,2023-09-02 17:21:19+00:00,2023-09-05 21:47:14+00:00,{'Campaign (any)': 1},"This PR is just supposed to add my name and the names of those who helped me with the dialog rewrite/edit/ touchup to the credits. I had been planning to do this after the last tweak I wanted to add, that is issue #7684. However seeing that no one has gotten back to me, I decided that that change isn't that important and to just go ahead with this.

The other people who helped (and I don't know how they want put in or added were @nemaara @stevecotton @Wedge009. If they want they can put their names with mine in the credits listing I made. (Assuming I did it right and the entire thing doesn't need redone)

If people think the rewrite/edit/touchup shouldn't be in the credits that's OK, but at the very least seeing that I put a lot fo work in it I should at least be somewhere so people can find me if they have questions.
"
1496088277,Fix #7886: leaders type set to null in campaigns.,gfgtdf,2023-08-30 20:16:51+00:00,2023-10-21 16:24:50+00:00,{'Engine': 1},
1495731109,fix some Chinese(Simplified) translation,MageDelfador,2023-08-30 15:20:23+00:00,2023-08-30 15:28:48+00:00,{'Translations': 1},
1494349955,Refact the PASSABLE_HEX implementation,Descacharrado,2023-08-29 20:11:35+00:00,2024-04-14 21:20:30+00:00,"{'Campaign (any)': 1, 'Unit Tests': 1}","In #6677 I moved the PASSABLE_HEX macro into core so I could use it to fix wallstuck spawned units. As commented on discord (@soliton-), it makes much more sense to move passable=yes to the unit generating macros so the default behaviour is more aligned to what one would expect (units appearing in places where they can walk). One can still opt-out of this by overwriting the default:

`{NAMED_UNIT 3 (Skeleton) 15 40 () ( _ ""Restless Dead"") (upkeep,animate,passable=free,yes,no)}` (Tested)

With this in mind, if we approve this PR maybe we should remove the PASSABLE_HEX macro from core, I dont know if we would need to deprecate it first.

Marking as draft for discussion on the matter."
1492208145,Fix get_files_in_dir for boost 1.83,gfgtdf,2023-08-28 14:40:17+00:00,2023-08-28 17:02:49+00:00,{},
1491349970,1.17 - Ant Queen,doofus-01,2023-08-28 04:34:41+00:00,2023-09-11 04:10:12+00:00,"{'Graphics': 1, 'Units': 1}","This is a first draft to get the assets on the table; the details, fluff, and abilities should probably be changed."
1490731767,"Add ""aliens"" boss to core from UtBS",Jonathan-Kelly,2023-08-26 18:06:31+00:00,2024-04-02 20:30:57+00:00,"{'Graphics': 1, 'Units': 1}","@Hejnewar and myself are working on putting together some core boss opponents for use in a new multiplayer scenario type (hunt) as well as traditional survival scenarios.

This adds a foxfire mushroom and slime mold inspired 'spawner' boss. It consists of an immobile fruiting body unit which produces mobile ""spore"" units. These spores can level into barely mobile ""stalk"" units which nourish the fruiting body to increase the rate at which it produces new spores. Whereas this sporulation rate _decreases_ with the number of living spores, acting like a kind of upkeep (and with stalks acting like villages). A stalk can eventually level into another fruiting body which acts as another spawn point for new spores and also multiplies the spore production rate.

Fungoid units generally have cold attacks with the 'drain' special, making them easier to take on for the undead faction, to compensate for how disadvantaged undead are against the new #7827 fire dragon boss and its #7859 wyrm minions.

Fungoid mobility is very poor, but this is partly counterbalanced by their stun special and a new 'miasma' ability which weakly but broadly attacks all units within a small radius (the damage and radius is determined by the level of the fungoid unit). Also all damage inflicted by spores and stalks heals the immobile fruiting body by the same amount, making it difficult to kill until enough of its minions are defeated."
1490522468,TRoW: add new Jevyan sprite and buff him,nemaara,2023-08-26 06:33:00+00:00,2023-09-05 15:41:12+00:00,"{'Campaign (any)': 1, 'Graphics': 1, 'Units': 1}",As the title says. @Dalas121 @knyghtmare 
1489007972,Also search the path for executable,Pentarctagon,2023-08-25 04:06:23+00:00,2023-08-27 16:04:15+00:00,{},
1488847995,wesnoth-lib review,Wedge009,2023-08-25 00:25:47+00:00,2023-09-12 17:06:29+00:00,"{'UI': 1, 'Prose': 1, 'Help': 1}","* Removed duplicated  'to display' text
* Favour generic term 'file manager' over Microsoft terminology.
* Clarify language code use - though I'm not actually sure what language code convention Wesnoth follows. Please correct as necessary.
* Replace inconsistent spelling of 'add-on'. It looks like older instances use the single-word form 'addon' (which I don't think is right) and that 'add-on' is currently the intended spelling in Wesnoth's context. I verified this by checking the `en_US` language option.
  * There are a couple of lingering instances I left alone because the line they were in had been disabled-via-comment (and should probably just be deleted)."
1488847576,Replace idiom 'by hand' with its actual meaning,Wedge009,2023-08-25 00:25:02+00:00,2023-08-28 00:30:46+00:00,"{'Editor': 1, 'Help': 1}","While native Anglophones should know what 'by hand' means in these contexts, I think it's clearer for non-native readers and translators to use its meaning of non-automatic, non-machine -> manual processes."
1485676532,GUI2/Game Load: refactor filter implementation,Vultraz,2023-08-23 03:05:40+00:00,2024-12-18 07:01:06+00:00,"{'UI': 1, 'Building': 1, 'CMake': 1}","Opening this for feedback. This replaces the old filter code with a new regex-based method, and adds a new function to filter listboxes based on a predicate instead of providing a mask directly.

In terms of performance, it's extremely fast on my machine (often under 1ms). It pulls in the `fmt` library as a substitute for `<format>` (there's a flag I can set for header-only mode), which could be further deployed elsewhere in preparation for the standard library version once we can use C++20."
1485580857,LoW: Replace lingering instances of ‘old’ style gold carry over,Wedge009,2023-08-23 00:30:21+00:00,2023-08-24 05:04:25+00:00,{'Campaign (any)': 1},"So it looks like when I made #7248 I wasn't aware of - or had forgotten about - the distinction between 'old' and 'new' style gold carry-over. Like that PR, this potentially disrupts the gold balancing again, but this time in the player's favour. My assumption was the changes that led to both #7230 and #7862 being reported were intended to change the entire campaign to the 'new' style carry over at the standard 40% rate. If that assumption is incorrect, then some other means of sorting out the gold carry-over inconsistency needs to be decided upon.

Otherwise resolves #7862."
1483025847,add a 'replacement_type' and 'alternative_type' attribute in [damage] special or ability who modify the type of attack used,newfrenchy83,2023-08-21 14:43:56+00:00,2023-10-25 13:10:53+00:00,"{'Campaign (any)': 1, 'Unit Tests': 1, 'UI': 1, 'Units': 1, 'Schema': 1}","
At the suggestion of @stevecotton, I propose a special 'type' and 'added_type' attribute in [damage] capable of modifying the type of attack used when the conditions are met."
1482837517,update libraires.md list of file boost needed,newfrenchy83,2023-08-21 13:00:09+00:00,2023-08-21 13:03:39+00:00,{'Building': 1},
1481439437,Fix a crash in :inspect when switching from page 2 to a different item,stevecotton,2023-08-19 12:20:49+00:00,2023-08-19 17:02:26+00:00,{'UI': 1},"Switching to a different item cleared the data, but didn't clear the cache of where the page breaks are located. The subsequent call to `get_data_paged(int which_page)` has a bounds check for the page number, so it's sufficient to just clear the page breaks, which is already ok as it resets the object to the same state as a newly-created instance.

Forward-ported to fix #7851, but currently untestable in master, as the page-selection buttons are only shown when there's a large amount of text, which triggers the known regression (the credits-crash bug).

(cherry picked from commit 7cb5f09bcf0de4b5a2cc26a593cffa2d5cfbcd14)"
1479675191,Add Wyrm and Wyrmlet (amphiptere) to Core (from SoF),Jonathan-Kelly,2023-08-17 20:59:26+00:00,,"{'Graphics': 1, 'Units': 1, 'Campaign SoF': 1, 'Campaign WoF': 1}","Their statistics are (roughly) aimed at complementing the other small but fast flying creatures in core - bats, falcons, dragonflies. Whereas those other small flyers exclusively use melee attacks, this wyrm line focuses instead on its ranged attack (fire breath). But it is meant to be otherwise comparable to them in general power (and thus less power than the special variants in SoF).

The appearance of SoF's Cave Wyrm and Cave Wymlet are also color graded from green to blue to help distinguish them from these new core variants and to perhaps give them a more subterranean appearance. Other color options include yellow (as with the mythical [amphiptere](https://en.wikipedia.org/wiki/Amphiptere)) or a chalky cave albinism look. Also this experimentally gives the Cave Wyrm and Cave Wyrmlet frost breath to further distinguish them from the other variants (but this is just an idea)."
1479520779,fix indent in schema,newfrenchy83,2023-08-17 18:47:14+00:00,2023-08-17 19:38:56+00:00,{'Schema': 1},
1479116902,give to abilitie support of halo or overlay,newfrenchy83,2023-08-17 14:04:57+00:00,2023-09-25 16:06:41+00:00,"{'Campaign (any)': 1, 'Graphics': 1, 'Unit Tests': 1, 'Units': 1, 'Schema': 1}","generalise halo_image and overlay_image to all abilities for 1.19 version and later.
i put that now for let you review my work.

"
1478412143,Don't show the add-on selection dialog on editor start.,Pentarctagon,2023-08-17 05:49:16+00:00,2023-08-19 15:13:24+00:00,"{'UI': 1, 'Editor': 1}",Fixes #7810
1477953093,Liberty: text editing and work on Harper's character,nemaara,2023-08-16 19:09:59+00:00,2023-08-23 16:53:27+00:00,"{'Campaign (any)': 1, 'Graphics': 1}","A quick edit of Liberty, fixing some dialogue, making Harper a girl and looking younger, editing some related (and unrelated) dialogue to go with it as well. Prep for a possible Harper reappearance in HttT."
1477634060,Add range support for [micro_ai]side=,Jonathan-Kelly,2023-08-16 14:53:48+00:00,2023-08-19 00:04:06+00:00,"{'Lua API': 1, 'Schema': 1}","~~It can take a list as of this commit: https://github.com/wesnoth/wesnoth/commit/0bd679b11c8a5bf6b2b2c0a38ee2250b9736de77~~

~~From @CelticMinstrel on IRC/Discord:~~

> It's likely another case of ""we want to encourage the use of filters going forward"" that didn't make it into the schema because it > was complicated to handle it correctly.
> Looking closer, I guess I was wrong. It doesn't actually support a filter for the sides.
> BTW, s_unsigned_range_list is incorrect. It doesn't support ranges, so it would have to be s_unsigned_list.
> Unless of course you want to make it support ranges, which is valid.
> I don't know how useful it is. There aren't so many sides in a normal scenario that I'd find ranges to be useful.
> Maybe it's s_uint_list actually.

~~Have to agree checking for a `s_uint_list` makes sense since sides are always represented by (natural) numbers.~~

EDIT: Now also adds range support for `[micro_ai]side=` in addition to updating the relevant schema.

I hope this PR can go through quickly since this is the one thing blocking https://github.com/wesnoth/wesnoth/pull/7792"
1477291691,[1.16] Fix a crash in :inspect when switching from page 2 to a different item,stevecotton,2023-08-16 11:18:08+00:00,2023-08-19 11:44:40+00:00,"{'UI': 1, 'Fwdport': 1}","Switching to a different item cleared the data, but didn't clear the cache of where the page breaks are located. The subsequent call to `get_data_paged(int which_page)` has a bounds check for the page number, so it's sufficient to just clear the page breaks, which is already ok as it resets the object to the same state as a newly-created instance.

Fixes (on 1.16) #7851. Will be forward-ported to master, as the bug will definitely exist on master too, however I'm unable to trigger the page-change buttons to appear on master (possibly a side-effect of #7565)."
1475968943,Error on #ifdef/#ifhave without argument,soliton-,2023-08-15 14:21:22+00:00,2023-08-16 20:25:32+00:00,{},
1473547650,1.17 - make soldier ant sprite a little more distinct from giant ant,doofus-01,2023-08-14 00:21:21+00:00,2023-08-14 03:11:52+00:00,"{'Graphics': 1, 'Units': 1}","This is a very minor update, but I think it is still worth doing."
1473496449,1.17 various troll sprite things,doofus-01,2023-08-13 21:03:56+00:00,2023-09-05 01:09:53+00:00,"{'Graphics': 1, 'Units': 1}","Great troll still needs its attack animation, at the very least."
1473240349,Cleaned up last use of boost::mpl,Vultraz,2023-08-13 05:55:30+00:00,2023-08-13 20:22:56+00:00,{},CI run.
1472192523,fix self-detecting unit issue in abilities [affect_adjacent] and [fiter_adjacent],newfrenchy83,2023-08-11 18:30:19+00:00,2023-08-12 10:03:45+00:00,{'Units': 1},"…

when selecting a unit with an active ability only when adjacent to another, it marks active when the cursor is placed next to it

and with https://github.com/wesnoth/wesnoth/pull/7805 it's the problem of displaying the halo with an ability that only affects adjacent units, in this case the owner briefly displays the halo when he moves to side of a unit meeting the conditions"
1469650424,persist last chosen add-on in the preferences,Pentarctagon,2023-08-10 04:50:00+00:00,2023-08-12 01:53:45+00:00,{'UI': 1},
1469265068,deleted unnecessary check,Welrub,2023-08-09 20:34:48+00:00,2023-12-01 14:21:17+00:00,{},The problem in #7654 was that the preprocessor ignored files with an extension other than .cfg. Now it will preprocess all files
1465559915,Cut arbitrary hardcoded restrictions of scenario settings,Jonathan-Kelly,2023-08-07 16:15:55+00:00,2023-08-17 23:02:22+00:00,{'UI': 1},"And widen the corresponding 'soft' limits for the multiplayer scenario creation screen.

~~Normally I thoroughly test everything before a pull request, but am not currently set up to build from source, So I cannot test the small, surgical, engine level changes in this one.~~ Edit: now tested and working."
1464377461,WC: fix to in 6A_Rural mapgen,gfgtdf,2023-08-07 00:10:54+00:00,2023-10-21 16:24:12+00:00,{'Campaign (any)': 1},"A random thing i noticed while searching for something else, pr because  not tested yet."
1463870748,address codeql issue,Pentarctagon,2023-08-05 16:25:51+00:00,2023-08-21 00:45:47+00:00,"{'Building': 1, 'Packaging': 1, 'SCons': 1, 'CMake': 1}",
1463743780,Use 'neg' like prefix for negative value in parse_range,newfrenchy83,2023-08-05 09:37:11+00:00,2023-08-05 18:28:40+00:00,"{'Unit Tests': 1, 'Schema': 1}","Since '-' is usually used to define a range of numbers but the same sign is used to define a negative number, it is impossible to filter a negative number [filter_abiliti] and similar filter hence the idea of using 'neg' instead for define negative value in parse_range"
1462924217,Use '_' instead of '-' as separator in filter_abilites filters,newfrenchy83,2023-08-04 13:21:24+00:00,2023-08-06 14:11:59+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1}","Since '-' is usually used to define a range of numbers but the same sign is used to define a negative number, it is impossible to filter a negative number [filter_abiliti] and similar filter hence the idea of using ' _' instead in this specific case to remedy the problem."
1461337092,"Support negative numbers in ranges, move to utils/config_filters.cpp",stevecotton,2023-08-03 11:56:16+00:00,2023-08-11 19:59:06+00:00,"{'macOS': 1, 'Unit Tests': 1, 'Units': 1, 'Building': 1, 'Schema': 1, 'Terrain': 1}","This was an idea from PRs #7003 and #7746: move some functions that, although currently only used in the weapons and ability code, would be applicable for any config-based filter. @newfrenchy83, @CelticMinstrel and @gfgtdf, what do you think?
Edit: source of the idea was https://github.com/wesnoth/wesnoth/pull/7814#discussion_r1273856127

The task then expanded into how to handle negative values in filters.

Adds support for using these in the weapons and ability filters:
* ""-1"", which was previously treated as an parse error (no number before the separator).
* ""-3--1""
* Using ""-infinity"" as the lower number in the range, provided a different upper number is given.

Using `..` won't be supported, at least not in this PR.

This treats ""-infinity"" (with no other number), ""-infinity..-infinity"",
""infinity"" (with no other number) and ""infinity..infinity"" as errors. It seems
unlikely that someone would intend to use a filter that can't match any
reasonable number.

The range ""-infinity..infinity"" will be parsed successfully. I don't see a use case for that,
but nor do I see a reason to add a special case to reject it.

This started as a change to move common filter functions from unit.cpp to
somewhere that they could be reused for other config-based filters. In the
process a missing feature was found and added, the move is still included in a
single Git commit because the move was required in order to make these
functions accessible to the Boost unit tests.

Two CodeBlocks project files additionally get src/utils/any.hpp added,
which was in one of them but missing from the other two. I noticed because
these are alphabetically at the start of the src/utils file list."
1460736928,Don't ask for the addon again when using F5,Pentarctagon,2023-08-03 04:24:59+00:00,2023-08-04 23:36:05+00:00,"{'UI': 1, 'Editor': 1}",
1460358613,Dragons! (Postponed 1.19),Hejnewar,2023-08-02 19:52:31+00:00,2024-03-05 23:07:35+00:00,"{'Postponed': 1, 'Units': 1}","As we all know dragons are weak. 

These changes are here to help with that a bit. 

Fire Dragon - hp changed form 101 to 500, cold resistance changed from -50% to 10%, 14-4 fire breath changed to 14-6, bite changed from 21-2 to 21-4, tail changed from 24-1 to 24-3, xp changed from 250 to 500, cost changed form 100 to 1297g, leadership removed. (Dont approach without at least 7 ancient liches. It bites.)
Skeletal dragon - hp changed from 86 to 171, jaw changed from 10-4 to 17-4, claws changed from 25-2 to 24-3, cost changed from 100 to 297. 

This is a separate issue from monsters balance pass because Draconic weakness is a long standing issue that sparks discussion (im knida counting on that) (also I didnt finish monsters and felt like this PR). "
1459517548,Update vcpkg baseline to include glib's build fix,stevecotton,2023-08-02 10:14:13+00:00,2023-08-02 12:25:10+00:00,{},"Using the version from 2 days ago, as that avoids an update to CMake, and I want to look at one issue at a time."
1459027515,"[1.16] Fix #7820 ""Enable planning mode on start"" Setting",gfgtdf,2023-08-02 02:37:15+00:00,2023-08-03 13:47:25+00:00,{},"previously the code that tried to activate the whiteboard failed because it checks `can_modify_game_state` which checks for `!synced_context::is_unsynced`.

This moves init_side_end() further down to be called after check_victory and do_final_checkup for technical reasons. But this is safe to do since these functions only set unrelated variables and don't throw (except in case of  a gamebreaking error ofc)"
1458881323,wc: fix lua error at victory (#7823),gfgtdf,2023-08-01 23:18:10+00:00,2023-08-03 13:32:33+00:00,{'Campaign (any)': 1},It seems like id can only be set when the unit is not on the map.
1458654810,"Fix #7820 ""Enable planning mode on start"" Setting",gfgtdf,2023-08-01 19:36:03+00:00,2023-08-02 02:23:18+00:00,{},previously the code that tried to activate the whiteboard failed because it checks `can_modify_game_state` which checks for `!synced_context::is_unsynced`
1456994327,AToTB: Remove the instant-communication amulets,stevecotton,2023-07-31 20:54:07+00:00,2023-08-12 17:51:28+00:00,"{'Campaign (any)': 1, 'Prose': 1}","Having these in canon felt like a plot hole in other campaigns. If an apprentice mage could make these amulets circa 350 YW then every village and border-fort should have them, but Wesnoth's storylines work better if a messenger on horseback is the usual method of long-distance communication. For example, TSG is about a commander sent to discipline a lazy outpost, only to find that they should have brought reinforcements. When it's the enemy trying to communicate, DM S21 and UtBS S08 both involve stopping the messengers.

This changes the intro to have a beacons for communicating with the trade caravans, I'm leaving it ambiguous whether it's a smoke signal or a fire signal. Fire beacons might make more sense if the village sees the caravan's campfires at night and, in normal usage, light the beacon to trade.

While this adds beacons to canon, they're an ancient technology with a limited range and very limited bandwidth. There are easy plot reasons not to set beacons up, such as the costs of having people watch for and maintain them, there are easy plot reasons why they don't work on a given day, such as weather, and there are easy plot reasons for attempted communication to be ignored by assuming that it's a fire for a different purpose.

Previously suggested in https://r.wesnoth.org/p669889 ."
1451092337,try enabling vcpkg's dependency graph,Pentarctagon,2023-07-26 23:15:46+00:00,2023-07-27 01:16:52+00:00,{'CI': 1},
1449649429,Eastern Invasion: add Dalas's version to mainline,nemaara,2023-07-26 06:59:46+00:00,2023-09-15 17:43:55+00:00,"{'AI': 1, 'Campaign (any)': 1, 'Graphics': 1, 'Audio': 1, 'Units': 1, 'Terrain': 1, 'Achievements': 1}","Hi all, I've taken Dalas's EI revised from the addon server and prepped it for mainline. We've gone through one round of review and are on the second now. The review items in order of importance are:

- Playtesting and bug reports
- Code review
- Typo review 
- Balancing 
- Anyone wanting to clear some of the TODOs in the scenarios is welcome to do so too.

I'm going to aim to get this in master by September 15. This time, let's please not do a line by line dialogue review and instead keep it to general comments. Thanks!"
1448400907,Remove one or more special weapons based on common stats and add 'filter_special' in  [filter_weapon/attack/has_attack] filters,newfrenchy83,2023-07-25 13:01:30+00:00,2024-10-30 23:38:36+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1, 'Campaign EI': 1}","In [effect] you can add a special weapon or replace the existing specials with others, or specifically remove a weapon by the identifier but not by the tag_name or other characteristics.

The use of a [filter_special] associated with a mode=remove should fill this gap

Fix https://github.com/wesnoth/wesnoth/issues/7812 issue"
1445659796,Fix parts of #7810,Pentarctagon,2023-07-23 16:39:39+00:00,2023-07-24 00:58:49+00:00,"{'UI': 1, 'Editor': 1}","F5 causing the editor to crash - the editor saves temporary files out to disk which don't have an extension, so give them the proper extension
The add-on selection dialog showing non-add-on folders in the add-ons folder - only show files with a _main.cfg"
1443551958,Re-enable Windows CI jobs,Pentarctagon,2023-07-20 20:20:59+00:00,2023-07-20 22:25:48+00:00,"{'Windows': 1, 'CI': 1}","Based on some feedback, doing a `git checkout` may help with the frequent cache misses of the vcpkg dependencies."
1443311420,"Move {join,host}.lua",soliton-,2023-07-20 17:24:58+00:00,2023-08-03 20:06:28+00:00,{'Unit Tests': 1},Creating a PR to see if anyone is actually using mp_tests. If so it can also be moved to utils instead of removing it.
1440671312,"Revert ""[Wmllint] add two missing corrections for Naga Warrior and Myrmidon""",soliton-,2023-07-19 09:23:14+00:00,2023-07-19 09:24:29+00:00,{'WML Tools': 1},Reverts wesnoth/wesnoth#7765 since it just adds redundant replacements
1439748281,"add a ""halo"" and'overlay' abilities for add overlays so that the unit  benefits from a second halo or overlay when conditions are matched",newfrenchy83,2023-07-18 18:36:37+00:00,2023-09-20 10:41:59+00:00,"{'Campaign (any)': 1, 'Unit Tests': 1, 'Units': 1, 'Schema': 1}","One of the things that bothers me is the permanent character of the halos of the Mage of Light and other units with the ""illuminates"" ability, which forces them to program only a permanent illumination applied only to the possessor of the ability.

Adding the halo ability does not change anything about the behavior of the unit, but can be used in several cases:

1 allowing the use of """"illuminates"" whose activity would be variable, in this case encoding the halo in halos ability and not in the unit_type allows to modulate the appearance of the halo under the same conditions

2. Applying illumination to adjacent units, I know it's pretty cheesy but a set developer might consider it easier if the hlo display follows the same logic.

3 The halo used to illustrate the possession in the unit of a special weapon used as leadership, the halo would be used to raise the possessor of the ability.

for overlay,same logic for illustrate possession of a special weapon used as leadership, or influence on student"
1437437050,Arcane Resistances Rework,Hejnewar,2023-07-17 14:19:30+00:00,2023-08-17 12:25:59+00:00,{'Units': 1},"Smallfoot, armoredfoot, elusivefoot, mounted,  fly, smallfly, lightfly, deepsea, mountainfoot, gurefoot, rodentfoot, lizard, dunefoot, duneelusivefoot, dunearmoredfoot, dunehorse, dunearmoredhorse - arcane resistance changed from 20% to 10%. 
Treefolk - arcane resistance changed from -30% to -20%.
Undeadfoot - arcane resistance changed from -50% to -20%.
Undeadfly - arcane resistance changed from -40% to -20%.
Drakefly, drakeglide, drakeglide2, drakefoot - arcane resistance changed from -30% to -10%.

Float ???

Paladin - arcane resistance changed from 60% to 30%.
White mage - arcane resistance changed from 40% to 30%.
Mage of Light - arcane resistance changed from 60% to 50%.
Lich - arcane resistance changed from -40% to -20%.

@nemaara kinda lore changes, paladin no longer is on a level of MoL with arcane resistance and Lich doesnt have arcane resistane lower than ancient lich. I also dont know exactly know what to do with ghoul from lore perspective should they have higher arcane resistance or should it go down by 10%, Im leaning towards 10% but we will see. "
1436381194,Updated to Lua 5.4.6,Vultraz,2023-07-16 21:11:46+00:00,2023-07-16 23:48:24+00:00,{},CI run.
1436355964,Fix song verse ability for UtBS,Hejnewar,2023-07-16 19:13:13+00:00,2023-08-17 12:20:30+00:00,"{'Campaign (any)': 1, 'Units': 1}","As in title, still no description improvement tho so with that help would be nice.  "
1436348337,doc: proofreading fixes for changelog.md,pydsigner,2023-07-16 18:40:48+00:00,2023-07-16 18:42:11+00:00,{'Docs': 1},"Primarily fixes for 1.17.19 changelog, but caught a few old typos as well."
1436158257,update missing entries for 1.17.19 changelog,knyghtmare,2023-07-16 06:10:13+00:00,2023-07-16 15:42:08+00:00,{'Docs': 1},"- [x] Rebels/Elves
- [x] Undead
- [x] Drakes
- [x] Dunefolk
- [x] Knalgan Alliance
- [x] Northerners
- [x] Loyalists 

Left out movement point changes of `Elvish Outrider` and `Saurian Soothsayer` as that PR has not been merged yet."
1436132900,Movement changes and test update,Hejnewar,2023-07-16 03:18:46+00:00,2023-07-17 14:23:03+00:00,"{'Unit Tests': 1, 'Units': 1}","I put a lot of blood into this because cmd breaks my wesnoth and prevents me from really doing this in a smooth way so at least I hope it works. 

Saurain Soothsayer movement points changed from 6 to 7. 
Outrider movement points changed from 10 to 11. "
1435645041,WC II - Typo and translatability of Difficulty and Version,Toranks,2023-07-15 02:20:23+00:00,2023-07-17 20:22:53+00:00,"{'Backport': 1, 'Campaign (any)': 1}","![imagen](https://github.com/wesnoth/wesnoth/assets/40789364/fb9e50a2-8f18-444a-ba84-12350d7725ef)

It should be backported too"
1434182649,1.16: Use same vcpkg base-line as current master,Wedge009,2023-07-14 05:33:12+00:00,2023-07-14 14:38:08+00:00,"{'Windows': 1, 'Building': 1, 'Stable 1.16': 1}","Uses the same base-line that @Vultraz updated in master recently, in b50a8012ea000b47955a1c92283be9d88fd929b2. This updates to pango 1.50.14 (from 1.50.12) which resolves #7217 (but also introduces #7543).

I had to make the other changes (back-ported from master) to compile. Tested and verified on VS2019 (Win7) and VS2022 (Win10)."
1433687071,Add game logic to King of the Hill scenario,Jonathan-Kelly,2023-07-13 19:36:19+00:00,2023-08-19 09:50:02+00:00,{'MP': 1},"The premise of this venerable mainline map was always for players to fight over the central hilltop castle. Yet its scenario gave no perks to combat the downsides of taking the hill:

- No recruiting while leader is traveling there.
- Leader vulnerable while traveling.
- Hill surrounded by enemies on multiple sides.

This update adds a powerful perk to hopefully make the hill worth fighting over.

~~When a leader sits on the hill keep, all other castles collapse into ruins so that no other side can recruit. Only if this leader (the king) is assassinated or abdicates his hilltop throne will the other castles be restored. To make the situation more clear, there is no fog or shroud on the hill, so that all players can see some of what goes on there at all times.~~

~~[Forum Development Thread](https://forums.wesnoth.org/viewtopic.php?t=56209)~~

UPDATE: Based on extensive feedback from @Hejnewar on discord, rewrote the scenario to be as follows:

A side with a leader holding the hill keep gets bonus gold and a bonus leader (who spawns on their original keep), A treasure chest which only a leader can unlock further rewards the first player to take the hill.

Also there are two tweaks to the King of the Hill map itself. One switches a handful of tiles to improve water access for the northern castles so that they are less disadvantaged when deploying water units. The other is a minor cosmetic touch up to help distinguish the cold and wet northern regions from dry and hot southern ones by switching to a slightly greener shade of grass under the pine forest tiles."
1432078346,1.16 wmlunits fix syntax error,ProditorMagnus,2023-07-12 22:41:43+00:00,2023-07-13 01:37:09+00:00,{'WML Tools': 1},
1431879155,Balance for Undead 1.18,Hejnewar,2023-07-12 19:40:41+00:00,2023-07-15 22:19:19+00:00,{'Units': 1},"Changes:
Level1:
Skeleton - xp changed from 35 to 39. 
Ghoul - xp changed from 35 to 30. 
Blood Bat - cost changed from 22 to 23, xp changed from 70 to 37. 

Level 2:
Revenant - cost changed from 31 to 28, xp changed from 85 to 78.
Dark Sorcerer - cost changed from 33 to 34, xp changed from 90 to 110.
Shadow - cost changed from 38 to 44, xp changed from 100 to 77.
Wraith - xp changed from 100 to 90.
Necrophage - melee damage changed from 7 to 9, cost changed from 27 to 23, xp changed from 120 to 61.
Bone Shooter - cost changed from 26 to 24, xp changed from 80 to 60.
Dread Bat - cost changed from 34 to 32.

Level 3:
Draug - cost changed from 47 to 70.
Lich - cost changed from 50 to 90. 
Necromancer - ranged cold damage changed from 17 to 19, ranged arcane damage changed from 12 to 16, hp changed to 76, impact resistance changed to 10%, cost changed from 50 to 90.
Nightgaunt - cost changed from 52 to 71. 
Specter - cost changed from 52 to 78.
Ghast  - melee damage changed from 10 to 12, cost changed from 43 to 50. 
Banebow - cost changed from 41 to 52. 

Level 4:
Ancient lich cost changed from 100 to  214.

Some bigger changes were made, Now you cant get 5 shadow opening and you cant get 4 shadow 2 blood bat opening. Necro got more hp and impact resistance. 
"
1431669977,Balance for Loyalists 1.18,Hejnewar,2023-07-12 17:11:15+00:00,2023-07-15 22:20:12+00:00,{'Units': 1},"Changes:
Level 1:
Cavalryman - blade resistance changed from 30% to 20%, xp changed from 40 to 44.
Bowman - xp changed from 39 to 35, melee damage changed from 4 to 5.
Horseman - cost changed from 23 to 24, xp changed from 44 to 54. 
Merman - xp changed from 36 to 34. 
Mage - xp changed from 54 to 48.

Level 2: 
Javelineer - ranged damage increased from 11 to 13, cost changed from 25 to 24. 
Pikeman - cost changed from 25 to 24, xp changed from 65 to 69.
Swordsman - xp changed from 60 to 80.
Knight - cost changed from 38 to 56, but I'm inclined to leave it at 50 to the fun of AoH WC players, xp changed from 120 to 100. 
Lancer - cost changed from 44 to 47. 
Shock Trooper - cost changed from 35 to 28, xp changed from 110 to 65.
Red mage - cost changed from 38 to 35, xp changed from 100 to 83.
White mage - cost changed from 38 to 31, xp changed from 136 to 75.
Dragoon - cost changed from 28 to 29, xp changed from 95 to 80.
Longbowman - cost changed from 26 to 23, xp changed from 68 to 65. 
Duelist - xp changed from 90 to 80, price changed form 29 to 31.
Merman Warrior - cost changed from 26 to 24, xp changed from 80 to 60.
Lieutenant - cost changed from 34 to 31, xp changed from 80 to 85.

Level 3:
Halberdier - cost changed from 44 to 52.
Royal Guard - cost changed from 44 to 61
GK - hp changed from 78 to 84, lance damage changed from 17 to 19, cost changed from 58 to 86.
Paladin - hp changed from 65 to 77, lance damage changed from 15 to 16, melee damage changed from 8 to 9, cost changed from 58 to 82.
Iron Mauler cost changed from 50 to 49.
Archmage - cost changed from 59 to 63 xp changed from 220 to 150.
Mage of Light - cost changed from 60 to 59.
Cavalier - cost changed from 52 to 62.
Master Bowman - cost changed from 46 to 50.
Master at Arms - melee damage increased from 7 to 8, cost changed from 44 to 65.
Hoplite - cost changed from 43 to 45.
Triton - cost changed from 43 to 46.
General - hp changed from 50 to 55, cost changed from 54 to 66, xp changed from 180 to 105.

Level 4: 
Great Mage - ranged damage changed from 16 to 17, cost changed from 72 to 110. 
Grand Marshal - hp changed from 60 to 68 cost changed from 66 to 101.

There are still few units that didnt make it here (HI, Silver Mage, Elder Mage)."
1430244057,Balance for Northerners 1.18,Hejnewar,2023-07-11 22:01:17+00:00,2023-07-15 22:20:29+00:00,{'Units': 1},"Changes:
Level 1:
Archer - xp changed from 30 to 32.
Naga - xp changed from 32 to 33.
Wolf Rider - xp change from 30 to 34. 

Level 2:
Warrior - cost changed from 26 to 23, xp changed from 60 to 67.
Pillager - cost changed from 28 to 31. 
Troll - cost changed from 27 to 25, xp changed from 66 to 58. 
Rocklobber - ranged damage changed from 17 to 19, hp changed form 51 to 53. 
Naga Warrior - cost changed from 24 to 22, xp changed from 66 to 56.
Crossbowman - melee damage changed from 4 to 6, ranged pierce damage changed from 8 to 9, hp changed from 43 to 46, cost changed from 21 to 22, xp changed from 80 to 43.
Slayer - cost changed from 26 to 21, xp changed from 64 to 62.

Level 3:
Warlord - cost changed from 48 to 52.
Direwolf Rider - cost changed from 44 to 52. 
Troll Warrior - cost changed from 44 to 49.
Myrmidon - cost changed from 48 to 47.
Nightblade - cost changed from 43 to 53. 
Slurbow - cost changed from 43 to 37.
"
1430210258,Balance for Knalgan Alliance 1.18,Hejnewar,2023-07-11 21:27:51+00:00,2023-07-15 22:20:47+00:00,{'Units': 1},"Changes:

Level 1:
Fighter - xp changed from 41 to 45.
Thunderer - xp changed from 40 to 35.
Guardsman - ranged damage increased from 5 to 6, xp changed from 47 to 40.
Footpad - xp changed from 36 to 35.
Thief - xp changed from 28 to 29.
Poacher - xp changed from 29 to 28.
Gryphon Rider - cost changed from 24 to 23, xp changed from 38 to 46.

Level 2: 
Steelclad - xp changed from 74 to 88.
Thunderguard - cost changed from 27 to 24, xp changed from 95 to 65.
Stalwart - hp changed from54 to 59, ranged damage changed from 8 to 9, xp changed from 85 to 78.
Outlaw - cost changed from 26 to 24, hp changed from 42 to 47, xp changed from 77 to 71.
Rogue - xp changed from 70 to 80, cost changed from 24 to 25.
Trapper - hp changed from 45 to 49, melee damage changed from 4 to 5, xp changed from 65 to 73.
Gryphon Master - cost changed from 38 to 40. 

Level 3:
Lord - cost changed from 50 to 69. 
Sentinel - cost changed from 44 to 63. 
Dragonguard - cost changed from 46 to 61. 
Fugitive - hp changed from 62 to 68, cost changed from 53 to 55. 
Huntsman - cost changed from 50 to 43. 
Ranger - cost changed from 52 to 43. 
Assassin - cost changed from 44 to 46.
"
1430130992,Balance for Dunefolk 1.18,Hejnewar,2023-07-11 20:17:07+00:00,2023-07-15 22:21:04+00:00,{'Units': 1},"Changes:

Level 1:
Burner - hp changed from 34 to 35, xp changed from 40 to 37.
Herbalist - cost changed from 14 to 13, xp changed for 39 to 36.
Rider - hp changed from 34 to 33, xp changed from 47 to 49.
Rover - hp changed from 32 to 33, xp changed from 43 to 40. 
Soldier - cost changed from 18 to 17, xp changed from 43 to 39. 
Skirmisher - xp changed from 34 to 39. 

Level 2:
Explorer - xp changed from 80 to 73.
Swordsman - cost changed from 30 to 28, xp changed from 75 to 68.
Capitan - cost changed from 30 to 29, xp changed from 75 to 74.
Spearguard - cost changed from 30 to 29, xp changed from 75 to 74.
Scorcher - ranged damage changed from 9 to 10, cost changed from 25 to 23, xp changed from 70 to 60.
Raider - cost changed from 34 to 35, xp changed from 70 to 77.
Swiftrider - xp changed from 65 to 62.
Sunderer - xp changed from 76 to 85. 
Apothecary - cost changed from 27 to 23, xp changed from 65 to 50.
Falconer - hp changed from 38 to 39, cost changed from 23 to 29, xp changed from 78 to 70. 
Strider - hp changed from 39 to 42, cost changed from 23 to 29, xp changed from 74 to 64. 
Ophidian - hp changed from 43 to 44, cost changed from 22 to 24, xp changed from 76 to 62.
Ringcaster - hp changed from 40 to 41, cost changed from 22 to 24, ranged damage changed from 7 to 8, xp changed from 70 to 62.

Level 3:
Blademaster - hp changed from 69 to 76.
Spearmaster - hp changed from 67 to 68.
Cataphract - mace melee attack damage changed from 14 to 15, lance damage changed from 13 to 14, cost changed from 62 to 65 cost changed from 62 to 69.
Harrier - cost changed from 47 to 50.
Sky Hunter - cost changed from 50 to 54.
"
1430065113,Balance for Drakes 1.18,Hejnewar,2023-07-11 19:19:19+00:00,2023-07-15 22:21:23+00:00,{'Units': 1},"Changes: 
Level 1:
Fighter - xp changed from 42 to 41.
Clasher - xp changed from 43 to 41.
Glider - xp changed from 35 to 39.

Level 2: 
Warrior - xp changed from 70 to 81, cost changed from 32 to 31. 
Arbiter - hp changed from 62 to 63, xp changed from 105 to 81.
Thrasher - xp changed from 95 to 77.
Flare  - xp changed from 80 to 86.
Fire - xp changed from 80 to 84.
Sky - xp changed from 80 to 76, cost changed from 28 to 32. 
Ambusher - hp changed from 36 to 38, cost changed from 24 to 22. 
Soothsayer - melee attack strikes changed from 2 to 3, mp changed from 6 to 7, cost changed from 25 to 28.
Spearthrower - melee damage changed from 6 to 5.

Level 3:
Blademaster - cost changed from 47 to 62.
Warden - cost changed from 46 to 62.
Enforcer - cost changed from 44 to 58.
Flameheart - cost changed from 51 to 66.
Inferno - cost changed from 51 to 64.
Hurricane - cost changed from 43 to 59.
Flanker - hp changed from 47 to 52, cost changed from 46 to 42.
Javelineer - ranged attack strikes changed from 5 to 4, cost changed from 52 to 42.

Armageddon drake - cost changed from 85 to 118.

Importantly - added Arma drake, Spearthrower and Javelineer. MP changes not included. "
1426513065,Bump tough-cookie from 4.0.0 to 4.1.3 in /utils/wesnoth-map-diff,cooljeanius,2023-07-10 00:18:18+00:00,2023-07-10 03:11:07+00:00,{},"I have Dependabot PRs turned on in my fork, so it opened this against mine today, so I'm submitting it back upstream as well.

Bumps [tough-cookie](https://github.com/salesforce/tough-cookie) from 4.0.0 to 4.1.3.
- [Release notes](https://github.com/salesforce/tough-cookie/releases)
- [Changelog](https://github.com/salesforce/tough-cookie/blob/master/CHANGELOG.md)
- [Commits](https://github.com/salesforce/tough-cookie/compare/v4.0.0...v4.1.3)

---
updated-dependencies:
- dependency-name: tough-cookie
  dependency-type: indirect
...

Signed-off-by: dependabot[bot] <support@github.com>"
1423787342,UtBS S3: Resolve Garak's attacks only partially being converted to fire damage,Wedge009,2023-07-07 01:40:48+00:00,2023-07-17 00:56:51+00:00,"{'Backport': 1, 'Campaign (any)': 1}","Resolves #7774

I think this can/should be back-ported to 1.16 as well."
1421517900,Add a test for formulas in taught abilities,stevecotton,2023-07-05 17:52:17+00:00,2023-07-06 14:57:28+00:00,{'Unit Tests': 1},"Originally by gfgtdf, this was cherry-picked from gfgtdf's PR #7589, with modifications.

COMMON_KEEP_A_B_UNIT_TEST gains support for optional args SIDE1_LEADER and SIDE2_LEADER."
1420368493,DiD: Correct inconsistency between AMLA description and its actual effect,Wedge009,2023-07-05 04:18:41+00:00,2023-07-06 00:22:33+00:00,{'Campaign (any)': 1},"Resolves #7767.

Not sure if it could be back-ported. Perhaps not, since it's a bug that works in the player's favour.

Alternative would be to change the description to match the actual effect."
1419983601,Balance for Rebels 1.18,Hejnewar,2023-07-04 17:52:55+00:00,2023-07-15 22:26:03+00:00,{'Units': 1},"Level 1: 
Fighter - xp cost changed from 40 to 37.
Merman Hunter - xp changed from 35 to 33.
Scout - xp changed from 32 to 42.

Level 2: 
Hero - xp changed from 90 to 80.
Captain - xp changed from 90 to 85.
Marksman - cost changed from 31 to 34, xp changed from 80 to 80.
Ranger - xp changed from 90 to 85. 
Rider - ranged damage changed from 9 to 11, hp changed form 46 to 49, cost changed from 28 to 35, xp changed from 53 to 75.
Druid - cost changed from 27 to 25, xp changed from 80 to 85.
Sorceress - cost changed from 32 to 34, xp changed from 100 to 90. 
Elder Wose - cost changed from 27 to 28, xp changed from 100 to 80.
Merman Netcaster - cost changed from 27 to 26, xp changed from 85 to 54.
Merman Spearman - cost changed from 27 to 22, xp changed from 85 to 54.

Level 3:
Champion - melee damage changed from 9 to 8. added 10 melee accuracy, hp changed from 70 to 72, cost changed from 48 to 61.
Marshal - hp changed from 62 to 68, cost changed from 54 to 67.
Sharpshooter - ranged damage changed from 10 to 12. cost changed from 51 to 62.
Avenger - ranged damage changed from 10 to 11, hp changed from 55 to 59, cost changed from 53 to 66.
Outrider - ranged damage changed from 8 to 11, melee damage changed from 7 to 8,  hp changed form 57 to 60, mp from 10 to 11, cost changed from 43 to 58.
Shyde - hp changed from 46 to 51, melee damage changed from 6 to 7, ranged slow (entangle) changed from 6 to 8, ranged magical (thorns) changed from 8 to 14, cost changed from 52 to 69.
Enchantress - cost changed from 55 to 70, ranged slow damage changed from 5 to 7, ranged magical damage changed from 9 to 13, xp changed from 180 to 180.
Ancient Wose - cost changed from 48 to 50.
Entangler - cost changed from 46 to 42.
Javelineer - cost changed from 48 to 55.

Level 4:
Sylph - hp changed from 60 to 68, ranged slow damage changed from 6 to 7, ranged magical damage changed from 10 to 16, cost changed from 67 to 148 (this is wrong but as commited will fix latter).
"
1419738593,[Wmllint] add two missing corrections for Naga Warrior and Myrmidon,knyghtmare,2023-07-04 14:17:46+00:00,2023-07-12 20:59:43+00:00,{'WML Tools': 1},"Adds missing wmllint entries for image path change
- Naga Warrior
- Naga Myrmidon"
1419115915,UtBS prose updates,Wedge009,2023-07-04 07:21:50+00:00,2023-07-06 00:22:06+00:00,"{'Campaign (any)': 1, 'Prose': 1}","Resolves #7634
Resolves #7695"
1417811369,DiD S3: Resolved Darken Volk speaking from the darkness,Wedge009,2023-07-03 10:13:07+00:00,2023-07-04 04:20:52+00:00,{'Campaign (any)': 1},"Resolves #7758

New commit instead of just reverting 4a5f38c5755da9e4ab3511f1daf2e3987e33d9f7 so I could add an explanatory comment to hopefully avoid this kind of breakage again."
1416798945,1.17 elf scout animations,doofus-01,2023-07-02 16:34:16+00:00,2023-07-03 00:02:05+00:00,"{'Graphics': 1, 'Units': 1}","This has melee attack, ranged attack, ranged defend.  Melee defend already existed.  The ranged attack isn't great, but it's still better than nothing"
1416658261,Liberty S6: Correct target hex for Shadow Mage,Wedge009,2023-07-02 09:26:37+00:00,2023-07-04 02:04:35+00:00,"{'Backport': 1, 'Campaign (any)': 1}","Resolves #7751

Question: Would it be appropriate to back-port this to 1.16? While it's not a major bug, there doesn't appear to be high risk in making this correction either."
1416654717,Liberty S5: Make the loss of Hans a lose-condition,Wedge009,2023-07-02 09:13:33+00:00,2023-07-04 03:15:46+00:00,{'Campaign (any)': 1},"Hans only makes an appearance in this scenario and isn't even mentioned afterwards (that I could see). Still, Link explicitly states that Hans will guide Baldras and Harper to the Grey Woods so I suppose it does make sense to make a consequence of Hans' death.

I'm not a writer, happy for the dialogue to be updated directly without my input. But the change itself should address @Konrad22's concern in #7750."
1415514876,Liberty S4: Resolve nameless enemies gaining names,Wedge009,2023-07-01 00:22:01+00:00,2023-07-02 01:33:02+00:00,{'Campaign (any)': 1},"Resolves #7748, introduced with #7518."
1414511923,Add priority and filter to overwrite specials,newfrenchy83,2023-06-30 08:50:21+00:00,2023-10-08 15:09:32+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1}","Since I add another feature to overwrite_specials in addition to filtering with the priority system, which obviates the need to limit its use to abilities used as weapons, I prefer to open this query to group the main commits that are related to it ."
1414478097,simplify checking for overwrite_specials when 'one_side' used,newfrenchy83,2023-06-30 08:23:20+00:00,2023-07-08 15:45:43+00:00,{'Units': 1},"Because complexity of special_active function, i was afraid to use directly special_affects_self/opponent, but like in this state, only apply to self/opponent/etc. is pertinent, i have finally try that."
1414070049,Prevent duplicate advancements from being added to unit type,nullmoose,2023-06-29 23:50:31+00:00,2023-07-09 03:08:11+00:00,"{'Unit Tests': 1, 'Units': 1}","Fixes issue #7009 

When adding an advancement to a unit type, check that the advancement is already present in `advances_to_`. If the advancement does already exist, it will not be added.
"
1413242439,Fix bug in overwrite_specials,newfrenchy83,2023-06-29 12:18:45+00:00,2023-06-29 17:03:28+00:00,{'Units': 1},I forget what abilities is the only who can use 'overwrite_specials' and what'filter_student' must ever checked instead of 'filter_self' in reference list
1410462424,"Add [test_do_attack_by_id], a wrapper for [do_command][attack]",stevecotton,2023-06-27 19:11:37+00:00,2023-07-02 16:54:17+00:00,"{'Enhancement': 1, 'Unit Tests': 1, 'Units': 1}","Just a draft for the moment, as several different improvements have ended up intertwined with each other. If anyone wants to use one of these on its own, please shout, because I feel this PR is going to be in draft for about a month (other things in life are currently higher priority).

The new tag takes ids instead of needing coordinates. So instead of storing units or hardcoding values, an attack can be done like this:

```
[test_do_attack_by_id]
	attacker=alice
	defender=bob
	weapon=0
[/test_do_attack_by_id]
```

Add a simpler unit for unit tests than the Elvish Archer / Orcish Grunt combo, cherry-picked from gfgtdf's PR #7589. This is a unit with a 10x1 melee attack, and 0% defense on all terrains.

Edit on 29th June: this now includes a test for plague abilities, to see if a plague weapon special always takes priority over a taught plague ability."
1410073951,Create CODE_OF_CONDUCT.md,cooljeanius,2023-06-27 14:54:23+00:00,2023-06-27 15:22:27+00:00,{},"This is to check off an item in the Community Standards: https://github.com/wesnoth/wesnoth/community

Right now it just links to https://forums.wesnoth.org/viewtopic.php?t=24277 (as proposed by @Pentarctagon on Discord)
"
1410001329,Fix a writing in matches_ability_filter function,newfrenchy83,2023-06-27 14:13:42+00:00,2023-06-27 18:28:13+00:00,{'Units': 1},"error don't affect functionality, but it is for writing quality."
1399465271,[Wmllint] add a new find and replace,knyghtmare,2023-06-20 08:50:18+00:00,2023-06-20 12:22:51+00:00,{'WML Tools': 1},for the Elven Fighter unit
1399444341,LoW/ANL/WC update instances of `units/elves-wood/fighter` to account extra introduced DIR,knyghtmare,2023-06-20 08:35:04+00:00,2023-06-20 12:14:16+00:00,"{'Campaign (any)': 1, 'MP': 1}","Fixes this:
![image](https://github.com/wesnoth/wesnoth/assets/5283677/96c3bb1f-3739-4a15-af25-71a0c061b3b4)
"
1398995633,1.17 Elf fighter sprite updates,doofus-01,2023-06-20 00:14:50+00:00,2023-07-03 00:03:24+00:00,"{'Graphics': 1, 'Units': 1}","#7651 updated the elvish fighter with what had been overlooked for years, and added a running animation.  There was some question about the shoulders and chest, which I agreed were a bit too much, so I am proposing a slight revision.  

The running animation is great, and can still be used after the update, but the basic combat animations are too similar to the old frames (as was intended at the time; the goalposts have moved).  So I am updating those, though for now it is just melee frames.

At the end of this, it will be subjected to #6417 "
1396920315,1.17 - add primary key to some unit animations that need it,doofus-01,2023-06-17 23:33:56+00:00,2023-06-18 16:32:22+00:00,{'Units': 1},"Some units still didn't change color when they were supposed to (poisoned or petrified*, anything else?)
 - Jinn 
 - Wild Wyvern
 - WC & Soulless Falcon

I think this is it, but if anyone finds something, I can add it to the list.

partially deals with #7709 

[*] via debug, they do turn gray under most circumstances."
1396647875,"WC: change some messages when units join, and add po hints",stevecotton,2023-06-17 06:45:20+00:00,2023-07-16 12:28:24+00:00,{'Campaign (any)': 1},"Add to 1.17 the po hints that #7716 adds to 1.16, and fix the issues of #7718.

Drake Fighters now say ""blade"" instead of ""sword"".

Remove the response when a human finds an Ulf, because it didn't sound right as the first thing a human says to a dwarf. The Ulf’s ""a good day to die"" could be read as a Native American battlecry, and ""brave words"" as ""words of an Indian Brave"", leaving the ""little big man"" to sound like a name.

Without catching the culture reference, it came across as a jibe about the dwarf's height.

Catching the culture reference, the logic seems reversed. Why would another dwarf use the generic form, but a human feel comfortable saying that?"
1393354330,Start giving the editor add-on level functionality.,Pentarctagon,2023-06-15 03:11:31+00:00,2023-07-19 20:00:14+00:00,"{'macOS': 1, 'UI': 1, 'Editor': 1, 'Building': 1}","The key word of course being ""start"". This PR changes the editor to work at the add-on level instead of in its own separate scenarios and maps directories. The goal is to make the editor more useful generally, but also specifically to make it much easier for players to distribute content they create using the editor:
* When they click the Editor button on the main menu, they will first be prompted to choose an add-on (or mainline), or to enter a new add-on ID.
* If maps or scenarios exist in the editor's own directories, those are migrated to the chosen add-on (if mainline isn't chosen). Plain maps have a basic scenario cfg created for them, while scenarios have their embedded map data split out to a separate .map file which is referenced in the cfg via the map_file attribute.
* Relatedly, the editor now knows how to handle scenarios with the map_file attribute at all (which yes, does mean that currently wesnoth's editor doesn't know how to load its own mainline scenarios from their cfg).
* When opening the file chooser dialog, it now defaults to their selected add-on's directory.

If they enter a new add-on ID, then the editor creates for them:
* a basic but functional _main.cfg.
* an empty achievements.cfg (at this point mostly just so they might see it at some point and realize achievements exist, but ideally an achievements editor dialog could be created eventually).
* an empty _server.pbl file.
* a proper add-on directory structure containing the standard set of folders (maps/, scenarios/, units/, utils/, images/, etc).

Additionally, as an initial proof of concept for actually using this new add-on level functionality, a new Add-ons dropdown has been added to the editor's topbar, with a single option - the pbl editor. This allows populating the blank _server.pbl file as well as editing an existing _server.pbl.

Misc other changes:
* The ability to add a recruit list to a side has been added back as a text box on the edit side dialog. While admittedly this doesn't allow players to select units from within the editor itself, it does set the actual side's recruit list (rather than a specific unit's extra_recruits), will show the user what the current recruit list for the side is (which the previously removed implementation didn't show anywhere), and correctly sets the faction as Custom so that the recruit list is used.
* Everything that can be triggered via [event] is either moved to a start event with a specific id attribute during the migration from the editor directories to the add-on directories or is saved there directly by the editor for new scenarios/edits to existing scenarios. Exceptions to this are [time], [side], and [side][village]. This is done so that the editor can know (for the most part) what things are actually its own to safely replace. As such, aside from the three previously mentioned tags plus the start event, any other WML added to a scenario by a UMC author is preserved rather than being overwritten - the editor no longer replaces the entire contents of the scenario file.
* The editor no longer writes out cfg files missing the top level scenario tag. If it doesn't find one or this is the first save of a new scenario it defaults to [multiplayer], but otherwise it will properly handle finding [test] or [scenario] as well.
* Requires that map files have the .map extension and scenario files have the .cfg extension. Also it assumes that .map files do actually only have map data in them and the .cfg files do actually have valid WML in them. I understand that this is not a limitation it had previously, but I don't think this is an unreasonable thing to require.
* Addresses part of #7667 by just not using regex for figuring out the map_data attribute value.

Additionally, it is not possible to change the currently selected add-on without going back to the main menu, clicking the editor button, and choosing a different add-on. This is intentional - I don't want to deal with having multiple add-ons open at the same time. If someone feels really strongly otherwise, then they can implement that themselves later.

---

TODOs:
- [x] support loading .mask files
- [x] add a ""new add-on"" option instead of a text box and instead generate some sort of add-on ID automatically
- [x] add an option to the editor to rename the current add-on
- [x] add secondary_authors text box to the pbl editor dialog
- [x] implement an include/include_file attribute for [scenario]/[multiplayer]/[test]. this would work similarly to the way map_file merges WML into the host scenario. need some way to append rather than merge the editor created start event (and editor created events generally - check based on the event's ID). preprocessing of this file to expand macros?
- [x] change auto-migration on starting the editor to converting old-style editor scenarios on load
- [x] when loading a scenario, also error not just if there are macros, but also check for ""<<"" for inline lua - otherwise the preprocessor will remove those on load and they won't be added back on save
- [x] add definitions for GUIWindowDefinitionWML in headers of choose_addon, edit_pbl, and edit_pbl_translation
- [x] updates to editor's in-game help text
- [x] validate the _server.pbl values
- [x] Update the commit message
- [x] How to display scenarios created in the editor in the game creation screen's list of scenarios.
- [x] ~~Check that the screenshot option still works.~~ #7747

New dialog screenshots:
![choose-addon](https://github.com/wesnoth/wesnoth/assets/3030250/3934cf42-708b-4a3b-9892-20454eab91f2)
![dropdown](https://github.com/wesnoth/wesnoth/assets/3030250/7f0966d2-318b-49e5-82ad-4a0f9cc2ac01)
![pbl-editor](https://github.com/wesnoth/wesnoth/assets/3030250/d34afc66-298b-4698-9cf9-13d1cc199905)
![translations](https://github.com/wesnoth/wesnoth/assets/3030250/ec9317d3-5e6e-4175-8f26-7d2d63cff489)
"
1392381780,"fail if [kill] contains [filter], re #4316",ProditorMagnus,2023-06-14 13:05:20+00:00,2023-07-16 17:47:44+00:00,"{'WML': 1, 'Lua API': 1}",
1392256278,[1.16] WC: add po hints to the messages when units join,stevecotton,2023-06-14 11:57:07+00:00,2023-07-16 11:40:22+00:00,{'Campaign (any)': 1},"These didn't have context in the .po files, so this makes clear which unit is joining.

The Ulf and Ghoul are special, a couple of others get a bit more detail about British slang."
1391084927,UtBS: improve po hints,stevecotton,2023-06-13 18:01:46+00:00,2023-06-14 12:38:42+00:00,"{'Campaign (any)': 1, 'Translations': 1, 'Prose': 1}","Forward-port of #7697, so assuming that just waiting 24 hours for the CI and any comments is OK.

po: The rest of this commit message is for the translators' changelog, because it's notes about what changed recently, as found by looking at fuzzies while updating the German translation.

S01 ""Come on, Kaleh, we have to go see if anyone is hurt or needs help. ..."" was just a grammar fix, of ""answer to the call"".

UtBS S08's dialogue had Esanoo refer to Melusand as ""my master"" repeatedly. That changed to ""leader"" or ""wise leader"" in 1.15.4, mainly without other changes in the text.

Other lines should have changed ""master"" to ""leader"". I'm planning to do that later, but this commit is just the cherry-pick.
* S08 Zhul's ""You don’t know where to find your master?""
* S08 Kaleh's two game-over lines because ""too many merfolk have died""

UtBS S08 ""You dare defy me?!..."" : the change is just a typo fix

UtBS S10 ""This will go much faster if you don’t interrupt me. ..."" the one-word change is from ""the many"" to ""many"" in the last sentence.

UtBS unit type Dawarf: the unit description had a grammar correction of ""it's isn't""

(cherry picked from commit b42a1b83a1f318222f58bb206eabfd1656043c29)"
1390934080,Create test for special_id_active in the style of eoma_beam,ProditorMagnus,2023-06-13 16:06:33+00:00,2023-07-04 09:28:39+00:00,{'Unit Tests': 1},"Test created to verify that special_id_active does not work in 1.16.0.

https://github.com/inferno8/wesnoth-Era_of_Magic/issues/30 https://github.com/inferno8/wesnoth-Era_of_Magic/pull/54"
1387989853,Contributing: the Typography and Gettext docs are separate Wiki pages,stevecotton,2023-06-12 05:59:44+00:00,2023-06-15 15:42:53+00:00,{'Docs': 1},"There's also <https://wiki.wesnoth.org/UI_Style_Guide>, which I haven't linked here."
1387779501,"WML Tools: Retain file owner, group, and permissions when writing new file",Wedge009,2023-06-12 01:28:50+00:00,2023-06-25 11:35:14+00:00,{'WML Tools': 1},"Resolves #7708

I only tested on Linux, not sure if there needs to be other things done to accommodate Windows platform (as with `os.rename`).

Would also appreciate review of the other changes too - some really weird code here, I'm guessing due to age, like use of equality operations where it looks like it's meant to be an assignment, plus a nonsensical try-except block that doesn't do anything with the exception."
1387297585,Android support,loonycyborg,2023-06-10 23:05:00+00:00,2025-06-15 03:29:58+00:00,"{'UI': 1, 'Lua API': 1, 'Building': 1, 'Packaging': 1, 'CI': 1, 'SCons': 1, 'Android': 1}","Current way to build:
```
export ANDROID_HOME=~/Android/Sdk
export ANDROID_NDK_ROOT=~/Android/Sdk/ndk/27.0.12077973
cd packaging/android
chmod +x ./gradlew
./gradlew buildCppDepends buildCppSource assembleRelease
```
NOTE: exact Android sdk/ndk paths will like differ on your setup
NOTE2: target android api version can be chosen with `export API=<number>`


(Standard Android Gradle plugin tasks are available, so `assembleDebug` for debug, `bundleDebug` for AAB bundle can be used for example. `buildCppDepends` and `buildCppSource` download and build Wesnoth dependencies and Wesnoth itself respectively, and are needed before the third task that builds the APK)
If a physical Android device with USB debugging enabled/official Android emulator is attached and recognized by ADB, then the `installDebug` task can be used to build Wesnoth apk and directly install it to the attached device/emulator.

Buildscripts use Bash scripting and may not run on non-Linux without proper setup.

Resolves #7477
Resolves #7978"
1386964277,wmlunits: Fix text domains used for translatable strings,Slayer95,2023-06-10 02:31:28+00:00,,{'WML Tools': 1},"Fixes #7704.

This commit also reworks the _ function into several functions, since it would conflict with xgettext's supported keywords.

Test:

```sh
xgettext --language=Python --output=uwo-wesnoth.py.pot --add-comments=TRANSLATORS --copyright-holder=""Wesnoth development team"" --msgid-bugs-address=""https://bugs.wesnoth.org/"" --from-code=UTF-8 --sort-by-file --keyword=_w --exclude-file=po/wesnoth/wesnoth.pot data/tools/unit_tree/html_output.py
if test -f uwo-wesnoth.py.pot; then
	echo ""Extraneous msgid in wesnoth""
	exit 1;
fi

for SUFFIX in editor help lib; do
	xgettext --language=Python --output=uwo-wesnoth-$SUFFIX.py.pot --add-comments=TRANSLATORS --copyright-holder=""Wesnoth development team"" --msgid-bugs-address=""https://bugs.wesnoth.org/"" --from-code=UTF-8 --sort-by-file --keyword=_w_$SUFFIX --exclude-file=po/wesnoth-$SUFFIX/wesnoth-$SUFFIX.pot data/tools/unit_tree/html_output.py
	if test -f uwo-wesnoth-$SUFFIX.py.pot; then
		echo ""Extraneous msgid in wesnoth-$SUFFIX""
		exit 1;
	fi
done
```"
1381337681,Avoid using double-quote as a C++ raw string delimiter-char,stevecotton,2023-06-06 18:48:22+00:00,2023-12-13 10:15:57+00:00,"{'AI': 1, 'Editor': 1, 'Add-ons': 1}","This avoids warnings from xgettext, which considers `R""""""...""""""` to be sufficiently unusual that it doesn't have support for it.

Sanity-checking with `strings wesnoth_binary | grep map_data` shows the expected strings in the binary.

Fixes #7667"
1381039943,[1.16] UtBS: improve po hints,stevecotton,2023-06-06 15:04:29+00:00,2023-06-13 17:56:29+00:00,{'Campaign (any)': 1},"No new strings here, just comments. The big comment in S03 predicts fixing #7634 (in 1.17 only).

po: The rest of this commit message is for the translators' changelog, because it's notes about what changed recently, as found by looking at fuzzies while updating the German translation.

S01 ""Come on, Kaleh, we have to go see if anyone is hurt or needs help. ..."" was just a grammar fix, of ""answer to the call"".

UtBS S08's dialogue had Esanoo refer to Melusand as ""my master"" repeatedly. That changed to ""leader"" or ""wise leader"" in 1.15.4, mainly without other changes in the text.

Other lines should have changed ""master"" to ""leader"". Will be [fixed in 1.17](https://github.com/wesnoth/wesnoth/issues/7695) but not backported:
* S08 Zhul's ""You don’t know where to find your master?""
* S08 Kaleh's two game-over lines because ""too many merfolk have died""

UtBS S08 ""You dare defy me?!..."" : the change is just a typo fix

UtBS S10 ""This will go much faster if you don’t interrupt me. ..."" the one-word change is from ""the many"" to ""many"" in the last sentence.

UtBS unit type Dawarf: the unit description had a grammar correction of ""it's isn't"""
1380561564,UtBS: Make the name of the dark assassin translatable again,stevecotton,2023-06-06 10:05:23+00:00,2023-06-06 12:08:23+00:00,"{'Campaign (any)': 1, 'Prose': 1}","Forward-port of #7675, just running the CI.

It needs to be translatable because it needs to match the other strings that call him by name. It was translatable until 1.15.4, and several of the .po files that are already in the 1.16 still include it as an obsolete message, so the next pot-update run will turn this back into a translated text in Bulgarian, Greek, Irish, Galician, Latin, Lithuanian, Russian, Serbian and Traditional Chinese.

(cherry picked from commit d07b74f010945c82823f38040e9e33fdf8631f11)"
1378278071,Display Preferences touch-ups,irydacea,2023-06-05 05:08:06+00:00,2023-06-17 20:56:52+00:00,"{'Enhancement': 1, 'UI': 1}","This PR started out as a reorganisation of the Theme selection in the Preferences -> Display section but now includes other layout/label changes in the same section.

<img width=""796"" alt=""Screenshot 2023-06-05 at 01 00 00"" src=""https://github.com/wesnoth/wesnoth/assets/489895/e679b151-e619-4541-9ed8-831b6618b9be"">

## General changes

* The Theme selection is now a dropdown menu in the Preferences panel rather than a sub-dialog (sub-dialogs are not ideal), and the labels clarify it's the Interface theme
* The Show grid/team colours/floating labels options are now grouped with the theme selection as part of a general UI options group
* The Automatic pixel scale multiplier checkbox has a shorter label to avoid redundancy
* The Resolution options now refer to the window size instead, matching the current implementation of Fullscreen which is really Borderless windowed and always uses the desktop resolution, meaning the game's ""resolution"" is nothing but the non-fullscreen window size
* The VSync and Limit FPS options are grouped together with the Window size options
* The Animated map/water and Show unit standing/idle animations are in two separate groups of their own now

## Other ideas

* Relabel Show team colors as Show team color ellipses?
* Relabel Show floating labels as Show damage indicators? (The game implementation uses ""floating labels"" to refer to map labels and the like, which are not affected by this option in any way. Even if the internal name were different, the fact is that static labels still ""float"" in a way)
* Drop ""Show"" from several options (It is rather redundant)

## Note

* The old Theme selection menu and the `show_theme_dialog()` function are **not** gone and can still be triggered using the in-game console via the `:theme` command
* I left in some commented-out fragments in the first commit I need to remove before merging"
1378012357,gui: Bring Open Log File button to non-Windows platforms + minor UI tweaks,irydacea,2023-06-05 00:26:31+00:00,2023-06-05 02:19:17+00:00,"{'Enhancement': 1, 'UI': 1}","This patch series brings the Open Log File button in the game version dialog to non-Windows platforms whenever logging to a file has been enabled. When logging to a file isn't enabled, the button will be greyed out rather than missing — hints at the functionality being disabled rather than removed.

It also relocates the button to avoid taking up a whole row in the dialog for it, and makes the button label more succinct in accordance with standard UI design practices.

<img width=""636"" alt=""Screenshot 2023-06-04 at 20 19 55"" src=""https://github.com/wesnoth/wesnoth/assets/489895/414f8ff9-9890-4206-89bc-4fb270b40c7d"">
<img width=""636"" alt=""Screenshot 2023-06-04 at 20 23 52"" src=""https://github.com/wesnoth/wesnoth/assets/489895/7956c605-4e49-49e2-aa4a-fae969c541c8"">
"
1377420878,hopefully fixes #6883,ghost,2023-06-03 23:57:31+00:00,2023-06-13 17:21:20+00:00,{},"I am unsure if this is an acceptable way to do this, I'd be glad to hear any suggestions if it's not."
1374589946,Remove signal handlers,soliton-,2023-06-01 18:40:19+00:00,2023-06-01 19:38:19+00:00,{},This replaces a workaround to overwrite SDL signal handlers with our own by simply telling SDL to not set up its signal handlers.
1373900717,Fixed another old typo,Gothyoba,2023-06-01 11:35:34+00:00,2023-06-03 11:24:42+00:00,{},"This is a 16 year old typo. I don't think this should break anything, though I'm unsure what exactly this file is for. This should probably be eligible for merging."
1373739521,Simplify steam and mingw jobs,soliton-,2023-06-01 09:59:40+00:00,2023-06-01 11:02:26+00:00,{},
1373654445,"Remove an explicit GETTEXT_DOMAIN ""wesnoth""",stevecotton,2023-06-01 09:09:30+00:00,2023-06-02 03:01:59+00:00,"{'UI': 1, 'Add-ons': 1}","Forward-port of #7674, just doing a CI run. This isn't an issue with the CMake scripts in master, I'm just cherry picking the commit so that there isn't a ""missing"" commit on master.


C++ source files are considered to be in textdomain ""wesnoth"" by default.

The 1.16 CMake scripts that sort files into textdomains miss this file, because it treats files with no `GETTEXT_DOMAIN` as being in ""wesnoth"", but not ones that explicitly declare themselves in ""wesnoth"".

(cherry picked from commit f0ceaf2ae086bf412e56778656e3f4b95824a261)"
1372946058,"NR: FINAL Edit/Rewrite/Touchup 11, 12, 13 and epilogue.",TheShadowOfHassen,2023-05-31 21:15:36+00:00,2023-06-08 01:59:58+00:00,{'Campaign (any)': 1},"Ok so last one. This one, unfortunately, is a bit more towards the rewrite on the spectrum than edit/ touch up. You'll see why below.

Most changes should be self-explanatory, but for the ones that are not, I have a changelog/ commentary.

11a_The_Eastern_Flank:

In both line 283 and 298 reduce seems like the wrong word. I changed the word to something different that is in line with their character.

In line 356: Can you bring someone a head without killing them?

In line 546 I changed fell to perilous because it sounded more elfy

12a_Get_the_Gold:

I rewrote a large chunk of the introduction because it would fit if Hidel was in with the rest of the orcs.

In line 70 it seems that the earth thing seems a bit dwarfy. Do you think I should change it?

Also, I haven't edited it, but I thought all the ... weren't necessary. If you want, I can rewrite it to seem like he's dying and not put so many ...

I edited line 87 so that Eryssa's sister was mentioned.

I removed watch in 460 because the sentences were awkward.

13a_Showdown:

I notice some repeat code and some comments referencing if Eryssa is dead, except I know if she dies, you lost the game. Maybe someone who knows the wesnoth script might want to look at it and see if there's some stuff that can be placed in functions and/or deleted?

I added one last narrator bit at the end, so I could rewrite a bit of the epilogue to make it less convoluted. I mean, where did the party in the epilogue come from?
14_a_Epilogue

There wasn't anything major except for the first paragraph, which I rewrote to make it a bit more to point.


Well It's done now, at least my revision is.

In this campaign, Camerin was my favorite character. In fact, next to Moremirmu he's my favorite character in the entire wesnoth game. Seeing how close the events in the two campaigns line up, I'd love to have a campaign with them in it together.

Also, I don't want to get on discord, but if people think another campaign needs to be edited, or just want another set of eyes looking at some text, I'd be happy to. Just @ me and I should be notified, and I'll take a look."
1372902281,"NR: Rewrite/Edit/Touchup: 08a, 09a, 10a ",TheShadowOfHassen,2023-05-31 20:47:21+00:00,2023-06-08 00:46:45+00:00,{'Campaign (any)': 1},"Like before, I'm not going to put a detailed list of changes and justifications, but below is a list of the most important ones. The rest should be pretty self-explanatory, if not, ask, and I'll try to explain.

This time, however, in with the changelog I also have the mention of an addition. My favorite character is Camerin, so I added a line of dialog. It can be taken out if you want.

08a_Elvish_Princess:

In lien 33 I changed unit to force because unit is the name of a person in the wesnoth game in general.

I removed all the times Princess was capital because her name wasn't Princess.

I understand that Tallin is going to have a crush on the princess, but he shouldn't say for the princess, or really for Knalga because he's from Dwarven Doors.

09a_Introductions:

I rewrote part of line 210 because it was rather... modern in a bad way. I also rewrote 220

I added Lord Talin in line 230 to bring up that running joke.

In line 300 I changed Northern Elf to northern elf because It's not a proper noun, is it?

I feel like in line 410 there Camerin should almost fry Eryssa. I'm not adding it but, if you think something like that would be an OK thing to add, I'll do it before this PR is merged.

Honestly, I don't feel like one elf sister would change Eryssa's view from snobby brat to thankful adorer. I'm not making any changes, but it doesn't seem consistent.

10a_Stolen_Gold:

In line 55 I edited because what's hardened mean?

In line 111 changed manpower to dwarfpower like I had suggested in issue #7448

The change I made in 532 is optional, but I thought it was better.

I think ""to defeat the trolls"" in line 806 isn't needed because there are no other enemies.

Watch how we crush and destroy you in line 885 didn't read as well as We will crush and destroy you.

I made northern elves non-capital. If they are a proper noun, I will recapitalize them

I added a Camerin statment to agree with Ro'Arthian in line 1067. I can delete it if someone doesn't like it. If it's bugged also let me know.
"
1372814957,Check path options,soliton-,2023-05-31 19:45:52+00:00,2023-05-31 20:45:42+00:00,{},
1372791638,"Nr: Rewrite/Edit/Touchup 05_02, 06_a, 07_a",TheShadowOfHassen,2023-05-31 19:27:57+00:00,2023-06-07 23:39:46+00:00,{'Campaign (any)': 1},"So this is the next installment of the Rewrite/Edit/Touch up(I don't care what we call it.)

I decided to try to do more than one file in each PR. It was easier for me. I hope it doesn't make it harder for reviewers. If it is, sorry because I already finished editing the entire scenario, and it's waiting in branches.

Same plan as before, a lot of the changes should be self-explanatory, however for the ones that I thought weren't I have a changelog with the file and the line.

One more thing to add, is the narrator from the first few scenarios is back. No offense to whoever originally wrote him, but the narrator is really hard to understand. I rewrote quite a bit of it. If you don't think I understood what was going on perfectly/ think of a better way to write it, you're welcome to suggest changes.

Changelog:

05_a_02:

Rewrote the wording on line 163

I deleted an entire dialog paragraph because it just repeated things

06_a

I removed the () in 23 and changed clash because it sounds like fighting, not arming.

The ""are they"" in 302 didn't sound very natural.

I noticed in the style guide that in 410 500 should be five-hundred.

Rewrote the dialog in 507 to make it sound like it was said by someone who had been fighting for three days straight.

07:
I changed the wording in 436 because a ""huh"" didn't seem like the best statement.

In line 488 I didn't think ""Let's go"" was needed."
1372493595,Fixed old typo in definition of unit recruit window,Gothyoba,2023-05-31 15:58:59+00:00,2023-05-31 16:00:43+00:00,{'UI': 1},Just a typo fix. Nothing else. This should be eligible for merging (I think).
1371859960,Separate out wesnoth independent checks into their own job,soliton-,2023-05-31 10:05:02+00:00,2023-05-31 13:57:40+00:00,{'CI': 1},Also check that *-path options output something to stdout.
1371363260,Separate menus for quick replays,gfgtdf,2023-05-31 02:11:50+00:00,2023-06-03 13:56:01+00:00,"{'UI': 1, 'Editor': 1}","This also does a bit of refactoring on the show_menu code, in particular `do_execute_command` now now tries to use the id of the command instead of mapping the index to certain actions."
1371258534,NR Dialog Rewrite/Edit/Touchup: Scenarios: 5,TheShadowOfHassen,2023-05-30 23:21:00+00:00,2023-06-07 17:49:33+00:00,{'Campaign (any)': 1},"This is the editing/touch up/rewrite for Scenario 5

A lot of the changes I think are self-explanatory, but for the ones I don't I have a short changelog below:

""Good luck, my friend"" isn't clear. I changed the dialog so that it makes more sense.

I changed the ""but let's get back at that disgusting skeleton,"" because they weren't talking about a skeleton.

I deleted either friend or foe in line 1140. It's fine if you want it back, but I thought it didn't seem natural dialog wise.

I also edited some typos in the comments

I rewrote Camerin's line at 2751 to try to make it funnier."
1371132232,[1.16] UtBS: Make the name of the dark assassin translatable again,stevecotton,2023-05-30 21:02:35+00:00,2023-06-06 10:01:23+00:00,"{'Campaign (any)': 1, 'Prose': 1}","It needs to be translatable because it needs to match the other strings that call him by name. It was translatable until 1.15.4, and several of the .po files that are already in the 1.16 still include it as an obsolete message, so the next pot-update run will turn this back into a translated text in Bulgarian, Greek, Irish, Galician, Latin, Lithuanian, Russian, Serbian and Traditional Chinese.

Opening as a PR, but will be linking to this from the forum thread about translations."
1370904176,"[1.16] Remove an explicit GETTEXT_DOMAIN ""wesnoth""",stevecotton,2023-05-30 18:24:46+00:00,2023-06-01 08:07:40+00:00,"{'UI': 1, 'Add-ons': 1}","C++ source files are considered to be in textdomain ""wesnoth"" by default.

The 1.16 CMake scripts that sort files into textdomains miss this file, because it treats files with no `GETTEXT_DOMAIN` as being in ""wesnoth"", but not ones that explicitly declare themselves in ""wesnoth"".

Doing a pot-update with SCons includes this file anyway, so the official ""pot-update and regenerate doc files"" commits already include it, even without this fix."
1370785944,Adding/Changing Unit Descriptions,Gothyoba,2023-05-30 16:45:30+00:00,2023-09-19 19:57:48+00:00,{'Units': 1},"This PR aims to add unit descriptions to Wesnoth units, or replace unit descriptions which have been copied from other units. More units can be worked on, and changes can be made to these new descriptions. This is intended to make the game feel deeper, more complete and implement more lore around these units. The following units have been worked on in this PR:

Direwolf - This one had the same description as a wolf. I took some lines from the description for the Direwolf Rider.

Great Wolf - Like the Direwolf, this unit copied its description from the wolf.

Wyvern Rider - This one had no description.

You may suggest changes to these descriptions. While my Great Wolf description does not expand much on the game, I feel like not much can be done there. Adding this description could still make wolves feel more complete though. I am also expanding on Direwolf lore through the Direwolf Rider. I would personally consider this PR to be complete. Is this currently eligible for merging?

Note: I will not be working on Wose Sapling in this PR"
1370752010,Write log output both to stderr and logfile at the same time,loonycyborg,2023-05-30 16:21:48+00:00,2023-06-09 07:03:52+00:00,{},this uses tee sink from boost.iostreams
1370262136,[1.16] Backport the fixes for running pot-update with recent versions of po4a,stevecotton,2023-05-30 11:12:16+00:00,2023-05-30 18:19:59+00:00,"{'Docs': 1, 'Translations': 1, 'Building': 1, 'SCons': 1}","Backport the SCons fix from https://github.com/wesnoth/wesnoth/pull/7648 and the CMake fix from https://github.com/wesnoth/wesnoth/pull/7649.

Fixes #7149.

This cherry-picks only the important part of #7649 from master, making the script use `PO4A-UPDATEPO_EXECUTABLE` instead of `PO4A-GETTEXTIZE_EXECUTABLE`. In contrast to the master branch's commit, this makes no changes to  findTranslationTools.cmake, so `PO4A-GETTEXTIZE_EXECUTABLE` will still be defined in that script. It's simply that that script has been extensively rewritten in master, and I don't see a point in porting that part of the change."
1369706973,1.17 - Make map elevation available to [scenarios],doofus-01,2023-05-30 02:24:49+00:00,2023-06-17 11:00:45+00:00,"{'MP': 1, 'Lua API': 1, 'Schema': 1}","This is to create a tag that determines the elevation data on a map that uses the feature correctly.  The five-level limit is pretty baked in, because that's how it is in the terrain graphics.  The use for this would be anything that could use a location set (group of `x,y` ) as a filter.
```
[elevation_score_map]
    high_border=<terrain code> (*^Qhh* default, key is optional)
    low_border=<terrain code> (*^Qhu* default, key is optional)
    test_labels = <boolean> ( default false )
[/elevation_score_map]
```
The effect of this tag is to create some WML variables `[elevation_area]`, one per elevation marker (the arrows in the editor) + the unassigned default elevation
It also creates a WML variable `[elevation_data]` that is basically a summary, in case that helps somehow.  Currently it is just a count of the different elevation levels.

This can be tested in the `Test_Elevation_Test.cfg` MP scenario, which has a simple example use-case, where higher-ground attacker (horseman) gets a damage boost and lower-ground attacker (wolf rider) gets a damage nerf.
![Screenshot_20230611_](https://github.com/wesnoth/wesnoth/assets/13510196/25c21ec6-d39c-42cc-8bd8-d07787325b77)



---- original post ------
I'm really not the right person to be doing this, but we've got to start somewhere.  This is a first draft, I need to reconcile it with the terrain-graphics rules better and then work on improving the efficiency (the failsafe cycle works, but it causes Wesnoth to choke, need to get the main flood-fill to work better).  It reminds me of Tron, I'm probably reinventing the wheel.

For this PR, I hope to get the elevation data available to the scenario author (for now it is a label, which is obviously just debug).  Goal is for each hex to have elevation data (low-low, low, default, high, high-high).  How this data should be used is out of scope.

This is a hack, just like the elevation terrain-graphics.  Best action would be to replace both of them with an engine update, but 1.18 isn't that far away, so this may be the best realistic option.
![Screenshot_20230529_](https://github.com/wesnoth/wesnoth/assets/13510196/a89f78f7-6fea-4601-a9a0-cbf4bb8566f4)
"
1367676340,Add --no-con to disable writing to CONOUT.,Pentarctagon,2023-05-28 03:13:24+00:00,2023-05-29 05:08:56+00:00,{'Docs': 1},"Fixes #7619

---

Also adds the `--log-to-file` man page entry since it was missing."
1367567020,Cleaned up implementation of image::locator,Vultraz,2023-05-27 23:07:13+00:00,2023-05-28 00:20:04+00:00,"{'Editor': 1, 'Units': 1, 'Add-ons': 1}","- Used inline default values to reduce ctor mess
- Used a forwarded ctor for locator::value instead of duplicating them between the main class and the value class
- Removed trailing underscores from public struct members
- Removed const char* ctor to make locator use more explicit instead of relying on implicit conversions
- Moved parse_arguments to a value ctor since it's more appropriate there
- Added locator::clone to replace the ctor with optional modifications"
1366208879,"NR Dialog Rewrite/Edit/Touchup: 2-2 3, 4",TheShadowOfHassen,2023-05-26 11:43:25+00:00,2023-06-07 17:48:06+00:00,{'Campaign (any)': 1},"This PR is for the next three scenarios. They don't really have that much from the narrator, which is where I found most of the issues. Mostly it's just some general editing and adding a few exclamations when they're needed.

I had put descriptions of these changes in the comments of the changes, but then I lost them after I had to reconcile branches.

There also was a weird thing when VS Code decided to turn all the quotes into smart quotes and other formatting things like that. I think I got all of them fixed, but you'll have to see.

I think a lot of the edits are self-explanatory, if you want an explanation of why I did something, ask."
1365162505,Update wmllint calls to parse_macroref,Slayer95,2023-05-25 18:28:33+00:00,2023-05-30 16:03:21+00:00,{'WML Tools': 1},Fixup for #7561.
1362558380,Implement macro to feature-test translations in ActionWML,Slayer95,2023-05-24 07:37:04+00:00,2024-08-27 21:49:01+00:00,{'Unit Tests': 1},"There are [concerns ](https://forums.wesnoth.org/viewtopic.php?p=681745#p681745)about new English dialogues and/or hints popping up in the middle of otherwise fully-translated campaigns, so this provides a standard way to check whether given sentences are already translated."
1362091940,campaignd: Fix link-time options for Xcode build,irydacea,2023-05-23 21:51:37+00:00,2023-05-29 07:39:24+00:00,"{'macOS': 1, 'Building': 1}","This copies the same runpath search paths already used for wesnothd to enable campaignd to run at all.

Without this change, campaignd will not run:
```
17:40:25 iris@mia ~/Projects/wesnoth git:master % campaignd
dyld[88945]: Library not loaded: @rpath/libboost_locale-mt.dylib
  Referenced from: <4D3C727A-C2FF-30FB-B750-3EEAFFB31E03> /Users/iris/Library/Developer/Xcode/DerivedData/The_Battle_for_Wesnoth-gvcieigqfnvlbvdaxanimpkfsprs/Build/Products/Debug/campaignd
  Reason: tried: '/Users/iris/Library/Developer/Xcode/DerivedData/The_Battle_for_Wesnoth-gvcieigqfnvlbvdaxanimpkfsprs/Build/Products/Debug/../Frameworks/libboost_locale-mt.dylib' (no such file), '/Users/iris/Library/Developer/Xcode/DerivedData/The_Battle_for_Wesnoth-gvcieigqfnvlbvdaxanimpkfsprs/Build/Products/Debug/../Frameworks/libboost_locale-mt.dylib' (no such file), '/usr/local/lib/libboost_locale-mt.dylib' (no such file), '/usr/lib/libboost_locale-mt.dylib' (no such file, not in dyld cache)
/Users/iris/Tools/bin/campaignd: line 30: 88945 Abort trap: 6           ""$APP_PATH/$BIN_NAME"" $CMDLINE ""$@""
```"
1360699294,desktop: Fix enumerate_storage_devices() inaccuracy on Linux,irydacea,2023-05-23 06:12:49+00:00,2023-05-25 04:14:16+00:00,"{'Bug': 1, 'Linux': 1}","Current Linux distributions tend to use udisks2 for storage device management, which uses `/run/media/USERNAME` instead of `/media` for gathering mount points. This commit makes this the first candidate for enumeration of mount point collections."
1359865915,1.17 Updated Elf Fighter sprite,doofus-01,2023-05-22 19:47:50+00:00,2023-06-18 16:33:19+00:00,"{'Graphics': 1, 'Units': 1}","from here https://forums.wesnoth.org/viewtopic.php?p=681569

Still need to review a bit more, but I wanted to make sure it wasn't forgotten again."
1358729910,gui: Use true labelless checkboxes in the dropdown menu implementation,irydacea,2023-05-22 07:51:23+00:00,2023-05-25 02:48:29+00:00,"{'Enhancement': 1, 'UI': 1}","Using checkboxes with an empty label doesn't quite do the trick and it results in some (minimal) wasted horizontal space.

I wrote the labelless checkbox definition a few years ago precisely to solve a similar issue in the MP alerts configuration dialog, so it makes sense to use it here as well since the real label is a different widget on a different column.

**Before:**
<img width=""796"" alt=""Screenshot 2023-05-22 at 03 43 17"" src=""https://github.com/wesnoth/wesnoth/assets/489895/b1a652f5-8018-4d52-90e9-4133a5970aa3"">

**After:**
<img width=""796"" alt=""Screenshot 2023-05-22 at 03 42 33"" src=""https://github.com/wesnoth/wesnoth/assets/489895/93a88db9-0e1a-4afa-a1e8-f61a6a664cf8"">
"
1358238879,Support po4a version 0.68-1 (cmake part),stevecotton,2023-05-21 14:50:02+00:00,2023-05-28 22:21:52+00:00,"{'Docs': 1, 'Building': 1, 'SCons': 1, 'CMake': 1}","This and @loonycyborg's #7648 are both working on #7149. Ended up with this being the CMake one, and the other being the SCons one.

The po4a tool's author considers running po4a-gettextize to be a once-and-done operation, however it seems to be moving towards acting as its own build system, expecting to be run with a config file telling it which files to build.

See https://bugs.debian.org/1020821"
1358223240,Refresh po4a workflow,loonycyborg,2023-05-21 13:51:51+00:00,2023-05-22 11:01:48+00:00,"{'Translations': 1, 'Building': 1, 'SCons': 1}",currently this fixes error with newest po4a but still po4a complains about po4a-gettextize/po4a-translate being deprecated. Could also go unified po4a approach but it seems less buildsystem-friendly.
1358187148,move multiplayer macros to proper folder,ProditorMagnus,2023-05-21 11:22:19+00:00,2023-05-22 14:01:23+00:00,{'MP': 1},closes #4698 closes #7471
1358184347,translate unit_attack.cpp strings in french,newfrenchy83,2023-05-21 11:09:12+00:00,2023-05-21 14:09:29+00:00,{'Translations': 1},
1358089433,Nr: Dialog/Story Edit/Rewrite 3 (Scenario 2),TheShadowOfHassen,2023-05-21 01:47:23+00:00,2023-05-26 05:15:49+00:00,{'Campaign (any)': 1},"This might be a bit messier than the other pull requests. Sorry.

First, I don't know if it'll pop up in the pull request, but after the last pull request it keeps saying my branch is eight commits ahead, but it only has the changes for this one.

Second, my Chrome extension for LanguageTool randomly stopped working with the GitHub code editor.(Neither would chromes normal spell check) I know that you say in your guidelines not to use the GitHub editor, but I needed LanguageTool more than I needed syntax highlighting.

That is all to say; if I have too many commits, let me know, and I'll try to fix it. Also, there may be some typos I double-checked, but I'm human. I honestly wish there was a program that was built for editing game scenario files (that had LanguageTool)

Real quick, I'm going to go through and put an explanation for each large change. There are also some nitpicky dialog punctuations that can be ignored, and also I cut some words out that weren't nessisary 

The first sentence while has a more archaic sounding, with the comma set off, I didn't think it was an easy read. 

The bit of the dwarven dead walking I thought needed to be reworded because I found it unclear on whether the scouts heard the rumor or the people knew it.

The bandits are called woodsrunners in one paragraph and nightrunners in the other. I changed both to woodsrunners, but nightrunners might be a better name. I don't know if there's lore corrected to it.

I cut out the gathered together and because I thought it slowed down the urgency.

I reworded some of the dialog to make the sarcasm make more sense (I didn't get it, and make the rumor reference I wrote make more sense).

I changed the ""find how to open it"" to figure out how to open it or find out how to open it for both."
1357981742,chage source code in unit_attack.cppand abilities.cpp for pot update,newfrenchy83,2023-05-20 15:21:10+00:00,2023-05-21 01:59:24+00:00,"{'Translations': 1, 'UI': 1, 'Units': 1}",resolve https://github.com/wesnoth/wesnoth/issues/7612 issue
1357904081,Add libcurl to library version reports in Game Version dialog,irydacea,2023-05-20 08:39:48+00:00,2023-05-20 18:50:27+00:00,"{'Enhancement': 1, 'UI': 1}",
1357869499,gui2/title_screen: Fix Version label translation not updating,irydacea,2023-05-20 05:25:05+00:00,2023-05-20 18:50:28+00:00,"{'Bug': 1, 'Translations': 1, 'UI': 1}","This unifies both the Version and the Language menu labels into a single method for both that is called both during construction and after switching languages. Both have this issue where they aren't `t_string` instances, so changing languages has no effect on them for that reason and they need to be manually re-translated."
1356696536,gui: Handle SDL_WINDOWEVENT_SIZE_CHANGED instead of SDL_WINDOWEVENT_RESIZED,irydacea,2023-05-19 06:54:39+00:00,2023-05-20 02:12:19+00:00,"{'Bug': 1, 'UI': 1}","The documentation is a bit unclear, but `SDL_WINDOWEVENT_RESIZED` seems not to trigger under certain circumstances, specifically when changing resolution via `SDL_SetWindowSize()`; `SDL_WINDOWEVENT_SIZE_CHANGED` meanwhile is implied to trigger any time the window size changes whether it's from an API call, or the operating system, or a user action.

<https://wiki.libsdl.org/SDL2/SDL_WindowEventID>

We need to translate at least one of these events into a GUI2 event in order for dialogs to be properly re-laid out after the window size changes, but we should not handle both because that could result in unnecessary work recalculating all dialog layouts.

Closes #7436.

Tested on macOS Ventura and openSUSE Tumbleweed so far. I want to properly test this on Windows just in case so don't merge yet."
1356604978,Language selection UI overhaul,irydacea,2023-05-19 05:25:28+00:00,2024-04-02 12:51:46+00:00,"{'Enhancement': 1, 'Translations': 1, 'UI': 1}","(Please ignore the first commit including a separate bugfix.)

This overhaul introduces a GUI option to show all languages regardless of their completion threshold, as well as a side panel including a general explanation of community translations and how players can potentially contribute to them, plus a link to the main translations page on the wiki.

<img width=""922"" alt=""Screenshot 2023-05-19 at 01 23 16"" src=""https://github.com/wesnoth/wesnoth/assets/489895/e1af8962-978b-48c0-8655-31f270d9dfa7"">
<img width=""922"" alt=""Screenshot 2023-05-19 at 01 23 38"" src=""https://github.com/wesnoth/wesnoth/assets/489895/b588766a-81af-4309-9c7b-25201b5fde56"">

A few points to make here:

* The URL points to the main page on purpose, since it's meant to be a catch-all for all languages regardless of which one the player has got selected or configured (those are two different things at the moment).

* There's an issue where when showing all translations, some of the non-Latin translation names cause the baseline of the language name labels to end up entirely misaligned with the completion labels. I am not entirely sure how to fix this right now.

* Showing all translations alters the dialog's layout permanently. I believe there's no way out of this with the current GUI API.

* We use the stock text colouring function used for unit defence values. This might not be entirely ideal because they are all very green for translation stats above the minimum threshold, so there's basically no variance by default until all translations are shown together.

* An idea could be to add a link to the gettext.wesnoth.org stats page in the dialog.

Additionally, I'd like to look into potentially reflecting the selection in the dialog or the entire Wesnoth UI without having to press OK, but I'm not entirely sure how feasible that is."
1356513190,gui/title_screen: Refresh Language button after changing languages,irydacea,2023-05-19 02:57:25+00:00,2023-05-19 05:31:58+00:00,"{'Bug': 1, 'UI': 1}",Closes #7437.
1352635610,Don't redirect windows output to CONOUT etc.,Pentarctagon,2023-05-16 14:38:04+00:00,2023-05-19 15:38:19+00:00,{'Command Line': 1},Fixes #7619
1349698486,1.17 new terrain - ruined walls,doofus-01,2023-05-14 04:44:09+00:00,2023-05-27 23:30:37+00:00,"{'Graphics': 1, 'Terrain': 1}","There are at least three types of ruined walls I can think of:

- [x] 1.  Damaged stone walls (Xor)
- [x] 2.  Damaged cave walls (Xur)
- [x] 3.  Ruined walls, was originally an overlay, but is now alias of cave or flat (whichever is worse) - (Exos)


Then there are all the transitions:
- [x] 4.  Transitions (mostly done)

For now, just item 1 is done.
EDIT: some progress on item 3, though there is still some work to do:
![Screenshot_20230514_](https://github.com/wesnoth/wesnoth/assets/13510196/893862e2-33ee-43e7-9ac7-2c7e0b163763)
"
1349506539,Nr: Dialog/ Story Rewrite : Scenario One (Fix) and herodeaths,TheShadowOfHassen,2023-05-13 11:39:53+00:00,2023-05-20 21:39:12+00:00,{'Campaign (any)': 1},"So this is another part of the northern rebirth editing /rewrite I'm doing. The last one was #7454. This one isn't the next scenario but I should be able to get that soon. This one is fixing a couple editing problems I didn't catch in scenario one and I real quick checked the herodeaths.

The main thing is in scenario one I rewrote a paragraph in order to fix issue #6510. I also changed a sentence that seemed to really pop out to be confusing. The bit about raiding parties becoming companies becoming war-bands. Because while you can have a company of orc soldiers, it's different from a war band.

I also added an oxford comma. Are we using oxford comas in wesnoth? If not I'll change it back. 

The hero death changes are pretty self explanatory."
1349138065,Make GUI.pyw translatable,Slayer95,2023-05-12 19:59:46+00:00,2023-06-14 07:58:57+00:00,"{'Translations': 1, 'WML Tools': 1, 'Building': 1, 'CMake': 1}","- POT file with textdomain ``wesnoth-tools`` is generated with the command:
```console
xgettext --language=Python --output=wesnoth-tools.py.pot --force-po --add-comments=TRANSLATORS --copyright-holder=""Wesnoth development team"" --msgid-bugs-address=""https://bugs.wesnoth.org/"" --from-code=UTF-8 --sort-by-file --keyword=_ --keyword=N_ --keyword=sgettext --keyword=vgettext --keyword=VGETTEXT --keyword=_n:1,2 --keyword=N_n:1,2 --keyword=sngettext:1,2 --keyword=vngettext:1,2 --keyword=VNGETTEXT:1,2 data/tools/*.pyw data/tools/*.py
```"
1348568105,wmlxgettext: Improve parser resiliency for malformed files,Slayer95,2023-05-12 11:55:58+00:00,2023-05-17 19:40:37+00:00,"{'UI': 1, 'WML Tools': 1}","- WML files with no translatable strings will no longer
crash the script on unbalanced tags (but translatable will).
- .cfg files belonging to man(1) will no longer crash the script."
1348413244,wmlxgettext: Support extracting all textdomains at once ,Slayer95,2023-05-12 09:53:32+00:00,2023-05-24 20:08:19+00:00,{'WML Tools': 1},
1348281817,Rewrite macOS version report again,irydacea,2023-05-12 08:12:11+00:00,2023-05-18 04:24:51+00:00,"{'macOS': 1, 'UI': 1}","This version doesn't rely on custom parsing of the version number from the (notably **not meant to be parsed**) `operatingSystemVersionString` property, and explicitly appends the version number components to the reported string instead so we don't get weirdness like `Apple macOS 13.3.1 ((Build` from an `operatingSystemVersionString` value like `Version 13.3.1 (a) (Build 22E772610a)` (found after the early May 2023 rapid response patch to Ventura).

Additionally, this replaces the clunky version comparison to decide whether to use the macOS or OS X branding with the `@available` syntax.

<https://developer.apple.com/library/archive/releasenotes/AppKit/RN-AppKit/index.html> (Under ""Runtime Version Check"")

(**Note:** 1.16 also needs this patch)"
1348172248,HttT: Improve Thoria branch rewards,Slayer95,2023-05-12 06:56:11+00:00,2023-06-07 21:30:16+00:00,"{'Campaign (any)': 1, 'Units': 1}","There are concerns about the rewards from this campaign branch being disappointing,
so this PR improves that.

- Sergeant gets a third resilient trait (which explains his survival.)
- Book of Wose Lore now also effectively grants intelligent trait. Tailored for a newly acquired low-level unit (e.g. the Sergeant, to ease its journey to Grand Marshall.) "
1348069479,Let wesnothd and campaignd build without SDL.,Pentarctagon,2023-05-12 05:02:42+00:00,2023-05-13 00:30:38+00:00,"{'MP': 1, 'Add-ons': 1, 'Building': 1}",
1346132587,Simplify logging options,Pentarctagon,2023-05-10 23:09:26+00:00,2023-05-14 17:47:43+00:00,{},
1345224031,"Add ""Other aspects: "" string in catalogue",newfrenchy83,2023-05-10 11:22:35+00:00,2023-05-10 15:41:47+00:00,{'Translations': 1},Fix partially of https://github.com/wesnoth/wesnoth/issues/7612 issue
1343595841,CI run for first commit of 7168 (filter_ability),stevecotton,2023-05-09 10:55:18+00:00,2023-05-09 17:26:10+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1}","This is the first commit of #7168, which I intend to merge while leaving the other 2 commits for further discussion in that PR.

See the comments starting at https://github.com/wesnoth/wesnoth/pull/7168#issuecomment-1537129642 for an explanation."
1342825859,"wmlunits: Simplify usage of --list, --batch parameters",Slayer95,2023-05-08 21:32:08+00:00,2023-05-25 00:29:15+00:00,{'WML Tools': 1},"- Inputs for ``--list FILE`` and ``--batch FILE`` almost always match, so this makes it possible to omit ``FILE`` from one of them, and they will be synchronized.
- If no ``FILE`` is provided at all, their values default to ``index.yml`` inside the ``--output`` folder.

- Before: ``wmlunits --output unit_tree --list intermediate.yml --batch intermediate.yml``
-  After: ``wmlunits --output unit_tree --list --batch``"
1342181048,move the carryover gold handling and dialog to lua ,gfgtdf,2023-05-08 13:24:11+00:00,2024-12-15 04:17:57+00:00,"{'macOS': 1, 'Lua API': 1, 'Building': 1, 'Campaign WC': 1}","This moves the carryover gold handling to lua, so that it easier to customize  it."
1341647177,wmlunits: Refactor HTML postprocess step,Slayer95,2023-05-08 07:00:39+00:00,2023-05-17 22:21:06+00:00,{'WML Tools': 1},Just some low-hanging fruit. This makes the code and output cleaner and faster.
1341580905,wmlunits: Support filtering add-ons,Slayer95,2023-05-08 05:59:15+00:00,,{'WML Tools': 1},"In order to process only a relevant subset of the contents of the add-ons folder. Matching add-ons must be installed in the folder defined by --addons.

This works by modifying the output produced by --list, and feeding it seamlessly to --batch.

Add-ons are specified as positional arguments.

See also #3953"
1341339727,Add support for distinct sub-achievements.,Pentarctagon,2023-05-08 00:12:32+00:00,2023-05-18 04:54:17+00:00,"{'MP': 1, 'UI': 1, 'Lua API': 1, 'Schema': 1, 'Achievements': 1}","This adds support for having up to 28 distinct sub-achievements within a single achievement. This limit exists since wesnoth's layout isn't smart enough to tell a horizontal listbox to actually use its scrollbar instead of forcing a horizontal scrollbar on the whole window.

Additionally this adds the [set_sub_achievement] and [has_sub_achievement] WML tags and their respective lua functions. [has_sub_achievement] is unsafe for use in MP, for the same reasons that [has_achievement] is.

---

![Screenshot from 2023-05-07 19-10-29](https://user-images.githubusercontent.com/3030250/236709482-97fc7057-2607-4636-8336-122d5b7d8441.png)"
1341272552,Make sure Lua GUI2 dialogs are properly cleaned up in the event of an exception,CelticMinstrel,2023-05-07 20:45:18+00:00,2023-05-10 03:13:03+00:00,{'Lua API': 1},Theoretically fixes an issue that @gfgtdf discovered
1341038512,Make wmlunits Windows-compatible,Slayer95,2023-05-07 08:12:01+00:00,2023-05-25 08:35:57+00:00,{'WML Tools': 1},
1341027614,Refactor TeamColorizer into a Python library,Slayer95,2023-05-07 07:29:32+00:00,2023-05-07 21:54:18+00:00,{'WML Tools': 1},"Reduces subprocess spamming in ``wmlunits``.
"
1341023991,wmlunits: Include nested dependencies in -L for -B to process,Slayer95,2023-05-07 07:15:21+00:00,2023-05-07 21:57:10+00:00,{'WML Tools': 1},"This fixes an issue of missing resources, such as seen in https://units.wesnoth.org/1.16/To_Lands_Unknown/en_US/To_Lands_Unknown.html

Closes #4124
"
1340962461,1.17 - more overgrown walls,doofus-01,2023-05-07 02:32:19+00:00,2023-05-08 03:20:20+00:00,"{'Graphics': 1, 'Terrain': 1}","
More like kudzu than hedges, so name may need revision, but the general idea is there.  The real utility will be in the mixed/transition images; the odds of anyone wanting to make a whole map with this are low, but the basic images are needed first.

![Screenshot_20230506_](https://user-images.githubusercontent.com/13510196/236654543-63a14d22-10aa-4576-b429-73977b87b621.jpg)

EDIT: The most important transition images now exist.

![Screenshot_20230507_](https://user-images.githubusercontent.com/13510196/236703908-f9f3eedf-0cd3-4e26-8982-69ae8adb6ac1.jpg)"
1340865321,Don't use optional_child for widget state definitions when it's mandatory,CelticMinstrel,2023-05-06 19:04:59+00:00,2023-05-06 23:54:28+00:00,{'UI': 1},
1340713345,Reserve `fail` in test names for tests that shouldn't `PASS`,stevecotton,2023-05-06 09:35:14+00:00,2023-05-07 09:10:06+00:00,"{'Docs': 1, 'Unit Tests': 1}","Convert the readme in data/test/scenarios to Markdown.

Add a new guideline that reserves test names containing `_fail_` or ending `_fail` for tests that don't `PASS`. The rest of the text is just collecting knowledge already written elsewhere.

Rename `test_terrain_mask_simple_name_fail` to `..._ignore`."
1340582201,Don't allow markup in achievement titles.,CelticMinstrel,2023-05-06 03:28:59+00:00,2023-05-06 18:45:40+00:00,"{'UI': 1, 'Achievements': 1}",This is done as a guarantee that there will always be one unambiguous way to identify that the achievement is completed.
1340429390,wmlunits: Fixup for fa76e77,Slayer95,2023-05-05 21:46:46+00:00,2023-05-05 21:55:40+00:00,{'WML Tools': 1},Sorry :sweat: 
1340268023,update codeblock projectfiles,newfrenchy83,2023-05-05 18:49:51+00:00,2023-05-05 18:50:43+00:00,{'Building': 1},
1339937327,Fix insecure SSL/TLS connexion used in campaignserver_client.py,alberic89,2023-05-05 14:01:42+00:00,2023-05-05 22:12:18+00:00,{'WML Tools': 1},Add a minimum version of protocol for security.
1339057097,Ability refactor,gfgtdf,2023-05-04 20:54:55+00:00,,"{'AI': 1, 'Unit Tests': 1, 'UI': 1, 'Units': 1, 'Lua API': 1, 'Building': 1, 'WFL': 1}","We create a class ability, and make units/unit_type hold a vector of those instead of just a config, this not only allows us to safely add/remove abilities, we could also add more members to abilities.

the macosx projectfiles are still missing because  they often cuase merging conflics.
WIP"
1338884277,Reorder WML includes so manual tests can use the unit-test macros,stevecotton,2023-05-04 18:23:31+00:00,2023-05-08 08:58:23+00:00,"{'Docs': 1, 'Unit Tests': 1}","Move the line that includes data/test/scenarios/manual_tests/ below the line that includes data/test/macros/. This allows a manual test to use the setup in COMMON_KEEP_A_B_C_D_UNIT_TEST, putting units in the right position to test combat and leadership abilities.

Also improve comments in data/test/_main.cfg."
1336996819,fix: crash in edit_distance_approx,smokespren,2023-05-03 16:21:14+00:00,2023-05-23 16:20:19+00:00,{'WFL': 1},"Prevent crash from buffer overflow and improve the approximation of the Levenshtein distance without sacrificing much performance.

Fixes: #7412"
1336828064,add missing stdint.h includes,AngryPenguinPL,2023-05-03 14:39:05+00:00,2023-05-03 20:53:25+00:00,{},"Looks like 1.16.9 no longer compile on new compilers as Clang 16.

Due errors:
```
/builddir/build/BUILD/wesnoth-1.16.9/src/deprecation.hpp:20:24: error: unknown type name 'uint8_t'
DEBUG util.py:445:  enum class DEP_LEVEL : uint8_t { INDEFINITE = 1, PREEMPTIVE, FOR_REMOVAL, REMOVED };
DEBUG util.py:445:                         ^
DEBUG util.py:445:  In file included from /builddir/build/BUILD/wesnoth-1.16.9/src/serialization/preprocessor.cpp:25:
DEBUG util.py:445:  /builddir/build/BUILD/wesnoth-1.16.9/src/config.hpp:51:12: error: enumeration redeclared with different underlying type 'uint8_t' (aka 'unsigned char') (was 'int')
DEBUG util.py:445:  enum class DEP_LEVEL : uint8_t;
DEBUG util.py:445:             ^
DEBUG util.py:445:  /builddir/build/BUILD/wesnoth-1.16.9/src/deprecation.hpp:20:12: note: previous declaration is here
DEBUG util.py:445:  enum class DEP_LEVEL : uint8_t { INDEFINITE = 1, PREEMPTIVE, FOR_REMOVAL, REMOVED };
DEBUG util.py:445:             ^
DEBUG util.py:445:  2 errors generated.
```
etc.

Adding few missing #include <stdint.h> fixing it."
1335904388,Refactor Statistics,gfgtdf,2023-05-02 22:21:16+00:00,2023-05-04 19:25:55+00:00,"{'macOS': 1, 'UI': 1, 'Building': 1}","Previously statistics were stored in global variables, now it is a part of saved_game. With this saved_game now finally represent the contents of a safefile as it was intended to, without needing to fill the statistics part in some global variable.

In particular now no longer have to manually reset the statistics as random parts of the code, it gets reset along with the saved_game object. Also it is now in theroy possible for multiple saved_game objects to exist.

Statistics was split in two objects, the statistics_record which only contains the data, and statistics_t, which provides methods to modify statistics during a game (to get cleaner dependencies)"
1334743570,Implement event priority,Slayer95,2023-05-02 06:31:27+00:00,2023-08-11 06:34:43+00:00,"{'Unit Tests': 1, 'Lua API': 1, 'Schema': 1}","For any given event name, events execute in order of decreasing priority.

Priority is a real number, and may be assigned via the `priority` attribute for
the WML ``[event]`` tag, or through the Lua APIs:

- ``wesnoth.game_events.add({priority = number})``
- ``wesnoth.game_events.add_repeating(name, action, [priority])``

Note that delayed variable substitution is not currently supported in the WML attribute.

Fixes #7582 "
1334120998,wmlunits: Specify error as class in html reports,Slayer95,2023-05-01 18:25:43+00:00,2023-05-05 19:05:09+00:00,{'WML Tools': 1},Suggested by @CelticMinstrel 
1333385381,wmlunits: Handle code paths for missing attributes,Slayer95,2023-05-01 03:43:19+00:00,2023-05-05 16:45:12+00:00,{'WML Tools': 1},"This PR deals with several issues similar to the one reported in #7578. However, the specific reason behind #7578 should get clarified after someone pulls up the log files."
1333269559,Misc fixes,gfgtdf,2023-05-01 00:58:39+00:00,2023-05-02 22:16:13+00:00,"{'MP': 1, 'Units': 1}",Fixes (some only partial) for #https://github.com/wesnoth/wesnoth/issues/3925 https://github.com/wesnoth/wesnoth/issues/3742 https://github.com/wesnoth/wesnoth/issues/4438
1332921855,Schema-validate several things that were being missed,CelticMinstrel,2023-04-30 03:46:15+00:00,2023-05-03 01:04:41+00:00,"{'Campaign (any)': 1, 'Translations': 1, 'UI': 1, 'Schema': 1}","* WML dialogs loaded in Lua via `wml.load`
* The fonts.cfg file
* The language.cfg file

My one missing piece in here is that a change to po_stat.py _may_ be needed to ensure that en_US.cfg contains `percent=100`. Does anyone know if that's needed and if so, how to do it?"
1332893253,1.17 - various terrain graphics fixes,doofus-01,2023-04-30 00:23:49+00:00,2023-04-30 19:39:03+00:00,{'Terrain': 1},"This is a small collection of random terrain graphics fixes.  List for now (will be updated):
 - fix #7301
 - fix #7302 (mostly)
 - fix #7170"
1332561350,"Refactor collection of #po, #po-override comments",Slayer95,2023-04-29 02:04:32+00:00,2023-07-12 20:47:26+00:00,{'WML Tools': 1},"This is a pure refactor that simplifies the code and makes it easier to implement new TBD directives and/or modify behavior of ``#po-override``.

Related: #7570 "
1329425521,"wmlxgettext: Error out on unused #po, #po-override directives",Slayer95,2023-04-26 21:39:22+00:00,2023-05-07 22:08:21+00:00,"{'Campaign (any)': 1, 'WML Tools': 1, 'Editor': 1}","```
# po: narrator is explaining the tale
[message]
speaker=narrator
message= ""This is the story I am narrating, but I forgot to mark is a translatable""
[/message]

[message]
speaker=Delfador
message= _ ""Hi. I am a mage, and my sentence will be translated""
[/message]
```

According to @AncientLich , current behavior is:
> in this situation, discarding all previous comments after the first sentence found avoids to place itself in a wrong place. If the # po wouldn't discarded, than it would be applied to the next translatable string, with the result of adding the comment ""narrator is explaining the tale"" in the sentence ""Hi. I am a mage, and my sentence will be translated"".

> This behaviour is thinked in order to prevent to misplace comments or overrides. The logic around this choice was ""better dropping an information, than adding a completely wrong one that could add confusion to a translator"".
The same reason is more strong when thinking about lua because wmlxgettext is even more limted on understand what lua is doinf than WML, so introducing a more strict control is even more necessary.

So this is a silent failure in the procedures ``wmlxgettext`` is expected to deal with. This PR makes them loud errors.
"
1328523509,Test the correct unit in swarms_effects_not_checkable,stevecotton,2023-04-26 10:30:46+00:00,2023-04-26 14:34:29+00:00,{'Unit Tests': 1},"The test spawns a new unit, this commit makes it test that new unit instead of the Elvish Archer with a 5x2 melee attack.

@newfrenchy83 please would you review this?"
1327873610,Add some search terms to the match history dialog.,Pentarctagon,2023-04-25 23:23:18+00:00,2023-05-26 16:55:36+00:00,"{'MP': 1, 'UI': 1, 'Add-ons': 1}","This still defaults to searching by the selected player name, but now also allows searching by:
* player name
* game name
* one of scenario id, era id, or modification id

The game name, scenario id, era id, and modification id support a leading and/or trailing wildcard for partial matches by essentially replacing the leading and/or trailing asterisk with a percent sign.

Scenario, era, and modification parameters are the ID, not the name, since the server gets the translated value for the name. Therefore searching by name would only give partial results in nearly all situations. So while this is probably unintuitive to a player, it still seems like the less bad option.

---

The updated UI:
![Screenshot from 2023-04-25 18-20-43](https://user-images.githubusercontent.com/3030250/234428287-99d774a6-1137-40ec-94b1-18c5edb63b64.png)

The close button and left/right arrows have been moved up into the same line as the new Search button to save vertical space."
1326509444,wmlxgettext: Handle multiple strings in single line better,Slayer95,2023-04-25 05:30:04+00:00,,{'WML Tools': 1},"This provides enough flexibility to document the different meanings of
    multiple strings in a single line, e.g. in macro calls, taking advantage of
    the design goal of #po-override (only one override allowed per sentence),
    as documented in
    https://wmlxgettext-unoff.readthedocs.io/en/latest/enduser/wml.html#po-override-override-info

- ``#po``, ``#po-override`` directives are no longer consumed by untranslatable strings.
- Each translatable string consumes a single ``#po-override`` directive.

Given the following example:
```php
#textdomain wesnoth-test

# po: Unit name
# po: This is a unit tasked with guarding a place
# po-override: Male unit name
# po-override: Female unit name
{NAMED_NOTRAIT_UNIT 2 (""Silver Mage"") 13 7 ("""") ( _ ""Guardian"") FEMALE_NAME=_""female^Guardian""}
```

Old output:
```pot
#: input/test.cfg:7
msgid ""Guardian""
msgstr """"

#: input/test.cfg:7
msgid ""female^Guardian""
msgstr """"
```

New output:
```pot
#. Male unit name
#. Unit name
#. This is a unit tasked with guarding a place
#: input/test.cfg:7
msgid ""Guardian""
msgstr """"

#. Female unit name
#: input/test.cfg:7
msgid ""female^Guardian""
msgstr """"
```
"
1325425769,Update options that disable logging to file,soliton-,2023-04-24 13:06:28+00:00,2023-04-25 08:33:51+00:00,{},
1324441950,Lua API to the undo system,CelticMinstrel,2023-04-23 17:58:57+00:00,2023-10-14 23:26:36+00:00,{'Lua API': 1},"This fixes the issue of the new events API not allowing a way to make events undoable, beyond calling into the corresponding WML actions.

The API additions are:

* `wesnoth.game_events.set_undoable` sets whether or not the current event can be undone.
* `wesnoth.game_events.add_undo_actions` adds actions to be performed when the current event is undone. Can be either a Lua function or a table of ActionWML.
* `wesnoth.game_events.add_repeating` takes an optional third argument which a function to call on undo, which automatically marks the event undoable. (Or it was supposed to, I think I actually missed that.)

There are a couple of things missing – the above parenthetical, and what to do when serializing an undo stack that contains a Lua function. Obviously it's not going to work, but we can't just ignore it, as I imagine it could cause strange things to happen when loading a saved game.

This was tested and working prior to rebasing onto the latest master. I don't have any reason to think the rebase would've broken anything though."
1324380534,filter true damage and attacks in [filter_attack/weapon] except in [damage] and [attacks],newfrenchy83,2023-04-23 13:42:19+00:00,2023-04-26 12:04:16+00:00,"{'Units': 1, 'Schema': 1}","Now that [event][filter_attack] can manage the activity of special weapons, the question arises of the possibility or not of filtering the damage and the number of attacks taking into account the modifications made by [damage] and [attacks].

In this PR, the real damages and attacks are taken into account except for the special ones in order to avoid problems of infinite loops.

I admit, it was also while looking for this solution for damage_type that I came to propose it for two filterable parameters in special weapons, which had led to filtering only the unchanged parameters."
1324200662,[1.17] - make engine-bobbing sprites use the correct primary frame,doofus-01,2023-04-23 00:59:53+00:00,2023-04-24 03:53:27+00:00,{'Units': 1},"To keep the ellipses and status indicators from bobbing/drifting with the base frame, I'd put the body sprite in an alternate frame, but did not think to check for status effect color-shifts like poison or slows.  This is a simple fix for that, only question is if I missed some unit.

fixes #7551 "
1323816352,Improvements to wmltools3,Slayer95,2023-04-22 05:25:18+00:00,2023-05-01 15:08:30+00:00,{'WML Tools': 1},"Split out from #7540 
"
1323258443,add dummy side in story scenario in mainline for fix assertion.,newfrenchy83,2023-04-21 15:30:26+00:00,2023-04-22 09:47:16+00:00,{'Campaign (any)': 1},"fix https://github.com/wesnoth/wesnoth/issues/7554 , fix https://github.com/wesnoth/wesnoth/issues/7553 and fix https://github.com/wesnoth/wesnoth/issues/7550 issues"
1322908259,Made flatpak ci job upload bundle too,loonycyborg,2023-04-21 10:55:08+00:00,2023-04-24 08:32:19+00:00,{},"This adds new CI artifact containing file wesnoth.flatpak. It can be installed and run like this:
`flatpak --user install wesnoth.flatpak`
`flatpak run --branch=ci org.wesnoth.Wesnoth`
After done with with testing it can be removed to save disk space:
`flatpak uninstall org.wesnoth.Wesnoth` and choose install from branch `ci` if there are other installs."
1321456071,flatpak upload,soliton-,2023-04-20 12:53:25+00:00,2023-04-20 20:51:31+00:00,{},
1320449289,Return early if there are no sides,soliton-,2023-04-19 19:44:25+00:00,2023-04-23 03:08:53+00:00,{},Avoids calling modulo with 0.
1320176995,WoF: Patch Assertion by Adding Dummy Player Side to StoryText-Cutscenes,knyghtmare,2023-04-19 16:04:19+00:00,2023-04-20 12:43:44+00:00,{'Campaign (any)': 1},Closes #7550 
1319204992,Fix modify_unit recall_cost indexing issue ,mjmagno,2023-04-19 03:22:37+00:00,2023-04-21 11:32:02+00:00,"{'Unit Tests': 1, 'Units': 1}",Fixed issue #7159. Bug had to do with indexing into 0 based team vector with 1 based side_ member variable as speculated in the thread. Added method to return side_ - 1 and then used in apply_to recall_cost code. 
1317694981,Add a hack to workaround setting the fontconfig cachedir only for windows.,Pentarctagon,2023-04-18 05:33:41+00:00,2023-04-23 03:31:56+00:00,{},Fixes #7089
1316994489,Add gender-specific names for units with random traits,Slayer95,2023-04-17 16:46:25+00:00,2023-04-24 21:01:14+00:00,"{'Campaign (any)': 1, 'Units': 1, 'Schema': 1}",
1316720688,HttT: Restore context information for Haralandum's name,Slayer95,2023-04-17 14:10:32+00:00,2023-04-18 18:42:29+00:00,{'Campaign (any)': 1},4eb7fccaa0 made this comment a ``po-override`` without given justification.
1315899551,Backport of #6685,Pentarctagon,2023-04-17 03:42:33+00:00,2023-04-28 14:11:45+00:00,{'Packaging': 1},Should hopefully address #7543
1315648489,Achievements - use lua_error instead of returning -2,Pentarctagon,2023-04-16 17:12:43+00:00,2023-04-26 00:16:02+00:00,{'Lua API': 1},Fixes #7528
1315591147,Adjust how no game history results are handled,Pentarctagon,2023-04-16 13:54:56+00:00,2023-04-17 14:21:39+00:00,"{'MP': 1, 'UI': 1, 'Add-ons': 1}",
1315293389,Add macros support to wmlxgettext,Slayer95,2023-04-16 01:10:46+00:00,,"{'Enhancement': 1, 'Postponed': 1, 'WML Tools': 1}","e.g.

```c++
#textdomain wesnoth-test

#define GREET MODE WHOM
[{MODE}]
    {MODE} = _ ""Hello, {WHOM}.""
[/{MODE}]
#enddef

{GREET message world}

#define MOODY_GREET MODE WHOM
#arg QUALIFIER
meh#endarg
   {GREET {MODE} (very {QUALIFIER} {WHOM})}
#enddef

{MOODY_GREET message world QUALIFIER=good}
{MOODY_GREET message world QUALIFIER=bad}
{MOODY_GREET message world}
```

Outputs:
```
#: test/test.cfg:5
msgid ""Hello, world.""
msgstr """"

#: test/test.cfg:5
msgid ""Hello, very good world.""
msgstr """"

#: test/test.cfg:5
msgid ""Hello, very bad world.""
msgstr """"

#: test/test.cfg:5
msgid ""Hello, very meh world.""
msgstr """"
```"
1315048966,fix ability used like weapon affect placeholder weapon used in defense when not attack of same range what attacker,newfrenchy83,2023-04-15 11:53:56+00:00,2023-04-18 13:19:37+00:00,{'Units': 1},best fix what https://github.com/wesnoth/wesnoth/pull/7537 or https://github.com/wesnoth/wesnoth/pull/7535 because don't delete placeholder weapon of filter_attack and applied to weapon like ability only.
1315012788,Stop removing manually-added labels on Github PRs,stevecotton,2023-04-15 09:33:45+00:00,2023-04-16 05:08:31+00:00,{'CI': 1},"Setting sync-labels to ""true"" means that it removes labels which people have added, but which aren't implied by the filelist."
1315005591,Test attack_filter with melee-only vs ranged-only units,stevecotton,2023-04-15 09:21:00+00:00,2023-04-18 15:29:49+00:00,"{'Unit Tests': 1, 'Units': 1}","A new test of what happens when a unit with only a ranged weapon fights a unit with only a melee weapon, along with a code change to ignore the placeholder attack that caused the new test to fail.

(The next paragraph is a suggestion for future work, I'm not intending to add it to this PR.)
This only affects the filtering so far, there should probably be another additional test to check what the combat results are. Not added in this commit, as the test here is specific to the code path being fixed; also testing the actual results would need an ability such as the Deep Elves' Stardust that passively affects the amount of damage taken, and doesn't need the defender to hit with a slows ability.

@newfrenchy83 I'm suggesting this instead of #7535, please would you review it?"
1314180671,fix filter_second_attack matche when_no defense.,newfrenchy83,2023-04-14 14:14:29+00:00,2023-04-15 11:54:39+00:00,{},if a unit in defense has no attack of range of attacker and under influence of abilitie used like weapon a filter_second_attack can matche it. This PR is a fix for this bug encountered with https://github.com/wesnoth/wesnoth/pull/7534/files#diff-8d03fe35ba9cd63a235a745ba5739e4f37f175915e73324125d3881953968b3c who succed then it must fail
1314021642,More unit tests for attack_filter,stevecotton,2023-04-14 12:17:46+00:00,2023-04-18 23:17:06+00:00,"{'Unit Tests': 1, 'Units': 1}","Add `first_time_only=no` to some existing tests, and verify that events that should only trigger once do trigger exactly once.

A new test of what happens when a unit with only a ranged weapon fights a unit with only a melee weapon. That's the ""no defense"" test.

A new test of `[filter_attack]` when an event lacks attack data. In testing, I found that it used to trigger a warning that I thought was useless code, and had removed during 88439d6427a81a6b131acd8b0f7bf04b2d981d71's review. I think removing it is still good, at the time that the filter was checked it would have warned ""attempt to filter attack for an event with no attack data.""

@newfrenchy83 please would you review my new tests?"
1312194636,fix test of presence of attack/second_attack in filter_attack function,newfrenchy83,2023-04-13 09:30:31+00:00,2023-04-13 19:33:45+00:00,{},resolve problem in https://github.com/wesnoth/wesnoth/pull/7509#discussion_r1165220995discussion
1312122649,Fix -Wshorten-64-to-32: math.hpp,stevecotton,2023-04-13 08:39:26+00:00,2023-04-13 11:55:11+00:00,{},"The last uses of this were removed in 0fbc12ea01986bc97ef6426e0edc89f12224a0d5.

The only uses of the other fixed-point functions from math.hpp are in src/sdl/utils.cpp. That should probably move to using color.hpp instead, but this commit is just to solve the -Wshorten-64-to-32 warning."
1311531830,Store side leader information in the database.,Pentarctagon,2023-04-12 21:44:09+00:00,2023-04-21 11:58:17+00:00,"{'MP': 1, 'Services': 1, 'Add-ons': 1}","Fixes #7267

---

The plan would be to also backport this to 1.16. Examples/tests of this functionality:
```
+--------------------------------------+---------+---------+-------------+---------+-------------+----------------+---------------+--------------------+-----------------------+
| INSTANCE_UUID                        | GAME_ID | USER_ID | SIDE_NUMBER | IS_HOST | FACTION     | CLIENT_VERSION | CLIENT_SOURCE | USER_NAME          | LEADERS               |
+--------------------------------------+---------+---------+-------------+---------+-------------+----------------+---------------+--------------------+-----------------------+
| 0b8b9fb8-d979-11ed-a063-0afdd5358605 |       1 |      52 |           1 |        | Custom      | 1.17.14+dev    | Default       | p2                 | Elvish Marksman       |
| 0b8b9fb8-d979-11ed-a063-0afdd5358605 |       1 |      52 |           2 |         | Custom      | 1.17.14+dev    | Default       | p2                 | Necrophage            |
| 0b8b9fb8-d979-11ed-a063-0afdd5358605 |       1 |      52 |           3 |         | Custom      | 1.17.14+dev    | Default       | p2                 | Revenant              |
| 0b8b9fb8-d979-11ed-a063-0afdd5358605 |       1 |      52 |           4 |         | Custom      | 1.17.14+dev    | Default       | Default AI (RCA) 4 | Saurian Oracle        |
| 0b8b9fb8-d979-11ed-a063-0afdd5358605 |       1 |      52 |           5 |         | Custom      | 1.17.14+dev    | Default       | Computer Player 5  | Death Knight          |
| 0b8b9fb8-d979-11ed-a063-0afdd5358605 |       1 |      52 |           6 |         | Custom      | 1.17.14+dev    | Default       | Computer Player 6  | Orcish Sovereign      |
| 0b8b9fb8-d979-11ed-a063-0afdd5358605 |       1 |      52 |           7 |         | Custom      | 1.17.14+dev    | Default       | Computer Player 7  | Orcish Sovereign      |
| 0b8b9fb8-d979-11ed-a063-0afdd5358605 |       1 |      52 |           8 |         | Custom      | 1.17.14+dev    | Default       | Computer Player 8  | Death Knight          |
| 0b8b9fb8-d979-11ed-a063-0afdd5358605 |       1 |      -1 |           9 |         | Custom      |                |               |                    | null                  |
| 0b8b9fb8-d979-11ed-a063-0afdd5358605 |       1 |      52 |          10 |         | Custom      | 1.17.14+dev    | Default       | Computer Player 10 | null                  |
| 0b8b9fb8-d979-11ed-a063-0afdd5358605 |       2 |      52 |           1 |        | Northerners | 1.17.14+dev    | Default       | p2                 | Mage                  |
| 0b8b9fb8-d979-11ed-a063-0afdd5358605 |       2 |      52 |           2 |         | Undead      | 1.17.14+dev    | Default       | p2                 | Bone Shooter,Spearman |
| 0b8b9fb8-d979-11ed-a063-0afdd5358605 |       2 |      52 |           3 |         | Rebels      | 1.17.14+dev    | Default       | p2                 | Elvish Archer         |
| 0b8b9fb8-d979-11ed-a063-0afdd5358605 |       3 |      52 |           1 |        | Rebels      | 1.17.14+dev    | Default       | p2                 | Elvish Ranger         |
| 0b8b9fb8-d979-11ed-a063-0afdd5358605 |       3 |      52 |           2 |         | Drakes      | 1.17.14+dev    | Default       | p2                 | Drake Thrasher        |
| 0b8b9fb8-d979-11ed-a063-0afdd5358605 |       3 |      52 |           3 |         | Undead      | 1.17.14+dev    | Default       | p2                 | Bone Shooter          |
+--------------------------------------+---------+---------+-------------+---------+-------------+----------------+---------------+--------------------+-----------------------+
```
GAME_ID 1 is ANL with the player sides left as Random in MP staging.
GAME_ID 2 is from Morituri modified to have a side each that specifies a leader vs `[side]type=`, `[side][leader]`, and `[side][unit]canrecruit=yes`.
GAME_ID 3 is from Alirok Marsh with each side's leader explicitly chosen in MP staging rather than being left as random."
1309987020,Improve TRoW's Clearwater and Southbay ally AI,Dalas121,2023-04-12 02:21:45+00:00,2023-05-19 16:11:07+00:00,{'Campaign (any)': 1},"First time using github! Lemme know if this is wrong.

Vanilla Wesnoth AI is highly aggressive - good for swarmy enemies, bad for outnumbered allies.  This fork alters TRoW's Clearwater and Southbay ally AI to be much more defensive.

Difficulty may need adjusting.

![Aether forward](https://user-images.githubusercontent.com/33790750/231329397-bc15c2d7-f6ca-49c5-971c-eb8b84ad1054.png)

![Aether leveling](https://user-images.githubusercontent.com/33790750/231329433-eae6ecfc-ef8b-4415-98e2-d59618730207.png)

![Addoran](https://user-images.githubusercontent.com/33790750/231329443-7428595a-ca10-4384-b052-5c9bf6518727.png)


"
1307718008,Temporarily disable Windows CI builds,stevecotton,2023-04-10 16:03:48+00:00,2023-04-10 17:30:23+00:00,"{'Windows': 1, 'CI': 1}","It's better to disable them that to get in the habit of ignoring the CI fails from the following two issues; this can be reverted once either is fixed.

glib has a bug where it builds things out of order which results in it failing to build the dependencies, which fails the build.
https://github.com/microsoft/vcpkg/issues/28722

vcpkg also has a bug where it very often fails to use the cache of the previously built dependencies even if none of them changed, which then makes it rebuild all the dependencies again.
https://github.com/microsoft/vcpkg/issues/26601

If the glib bug was fixed, then the errors wouldn't happen since rebuilding the dependencies wouldn't fail. If the caching bug was fixed, then the errors wouldn't happen since it'd just reuse the cached dependencies."
1306862865,Add achievements to Liberty,nemaara,2023-04-09 22:34:32+00:00,2023-04-16 23:38:58+00:00,"{'Campaign (any)': 1, 'Achievements': 1}",Like the title says. Giving a few days for feedback on this one too.
1306738211,Units/Nibbler: set resistances to be same as level ups,knyghtmare,2023-04-09 12:31:10+00:00,2023-04-10 05:45:35+00:00,"{'Enhancement': 1, 'Units': 1}","Closes #7516

## Summary

Nibbler now has the same resistances as the level 1 (Caribe) and level 2 (Hunter Caribe)"
1306675031,Add achievements to DiD,nemaara,2023-04-09 07:01:33+00:00,2023-04-16 23:38:05+00:00,"{'Campaign (any)': 1, 'Achievements': 1}",Like the title says. I playtested some but not others (will do that soon). It will help if others can confirm if they work as well.
1306593177,"Add comments to display and display_context, silence 64-to-32 warnings",stevecotton,2023-04-08 22:16:43+00:00,2023-04-10 08:47:46+00:00,{},"Silence the warnings in `viewing_side()` and `playing_side()` with a `static_cast`.

The static casts are for -Wshorten-64-to-32 warnings, it would take a lot of work to fix this in a better way."
1303091013,Units: Add `submerge` ability to Bone Knight and solve RIPLIB,knyghtmare,2023-04-05 12:05:24+00:00,2023-04-05 16:32:13+00:00,"{'Enhancement': 1, 'Units': 1}","Skeleton Rider: _has_ submerge
Bone Knight: does not...

This PR fixes this. "
1302360057,Add support for [effect] apply_to=level,Elvish-Hunter,2023-04-04 22:31:31+00:00,2023-04-05 18:11:09+00:00,{'Units': 1},"The title here is pretty self-explanatory.

Regarding use cases, this can be useful every time a unit needs to increase its level in an AMLA: for example, I have two units like this in TSoG and until now I had to use variations as a workaround for the lack of this feature. In an RPG-style add-on, this can allow a unit to level up (or down, if you wish so) as much as you want.

Implementation notes:

* there are two keys to change the unit's level, which are `increase=` and `set=`;
* negative levels are correctly supported;
* percentages aren't supported. Usually levels are small numbers so it doesn't make much sense to use percentages, but I can add them if you want;
* using `apply_to=level` and `times=per level` at the same time is disallowed to avoid confusion (would that apply to the levels before this effect is applied, or would we have a recursion?); if such combination is used, the engine emits a warning (not sure if `ERR_UT` would be better than `WRN_UT`) and uses 1 as default value."
1299149617,Correctly handle no game history data existing.,Pentarctagon,2023-04-02 16:27:15+00:00,2023-04-11 20:32:43+00:00,"{'MP': 1, 'UI': 1, 'Add-ons': 1}","Fixes #7489

---

@Wedge009 I'm not able to reproduce the crash you mentioned in that issue. Could you get a stack trace for it?"
1299084628, Fix a bug in [event][filter_attack] when trying to use special_id/type_active to detect a special whose activity is conditional.,newfrenchy83,2023-04-02 12:25:14+00:00,2023-04-11 17:34:28+00:00,{'Unit Tests': 1}," Fix a bug in [event][filter_attack] when trying to use special_id/type_active to detect a special whose activity is conditional.

When we try to trigger an event conditioned by the use of a special whose activity is subject to a condition, we cannot use special_active because the specials are always considered inactive. Additionally, abilities used as weapons possessed or taught by a leadership are also not detectable in [event][filter_attack]. This PR is there to remedy this double problem."
1298808707,Set uploader attribute when forum_auth=true and passphrase exists in the pbl.,Pentarctagon,2023-04-01 18:42:05+00:00,2023-04-02 04:09:03+00:00,"{'UI': 1, 'Add-ons': 1}",Fixes #7468
1298592063,updated Kalenz's dialogue #7110,VALiUMgithub,2023-04-01 06:29:55+00:00,2023-04-01 19:16:05+00:00,{'Campaign (any)': 1},Updated the proposed changes of Kalenz's speech.
1298314353,Fix -Wshorten-64-to-32: config.hpp and config.cpp,stevecotton,2023-03-31 20:41:57+00:00,2023-04-05 16:15:11+00:00,{},"Use std::size_t instead of unsigned int for container sizes.

There's one place where it still uses signed int, for using a negative index to access children from the end of the array. Overflow shouldn't be a worry here, as it would require 2**31 objects to be in the container, implying the container and children would use at least 32GB even if every child object was empty.

This expanded from review comments on Pentarctagon's #7451, seemed sensible to just make a PR. It goes in a different direction from that PR, trying to clean up the code's behavior instead of documenting what the compiler was already doing to the old code."
1296664198,Try to fix map diff failure when terrain doesn't have an image associated with it,cooljeanius,2023-03-30 18:21:34+00:00,2023-04-13 08:41:39+00:00,{},"I screwed up my previous attempt at doing #7452, so this is a new attempt that shouldn't have all the messed up rebasing commits added to it"
1296595588,Fix reset gamestate,gfgtdf,2023-03-30 17:26:02+00:00,2023-04-01 03:49:36+00:00,{},
1295549316,deploy and refactor config::optional_child,gfgtdf,2023-03-30 03:10:54+00:00,2023-04-02 22:39:13+00:00,"{'AI': 1, 'Docs': 1, 'MP': 1, 'UI': 1, 'Editor': 1, 'Units': 1, 'Lua API': 1, 'Add-ons': 1, 'WFL': 1, 'Help': 1, 'Schema': 1}",
1295384998,Editor palettes: fix -Wshorten-64-to-32 and improve docs,stevecotton,2023-03-29 22:53:42+00:00,2023-04-07 16:53:27+00:00,{'Editor': 1},"Use int for measurements of pixels, vs std::size_t for container sizes.

The scroll_bottom() methods were never called, although scroll_top() is used when switching between subgroups. The logic is scroll_bottom() was broken; items_start wasn't changed inside the loop, so the loop would run at most once."
1295376532,"Make rng::get_random_element return an index, not an int",stevecotton,2023-03-29 22:42:32+00:00,2023-03-30 05:57:58+00:00,{},"This makes it match the documentation, although it makes no practical difference, other than solving one of the -Wshorten-64-to-32 warnings."
1293982474,Overhaul image cache to be hash-based rather than index-based,Vultraz,2023-03-29 05:34:42+00:00,2023-03-30 05:01:42+00:00,{},Gets rid of that dreadful last_index stuff. It basically meant a slot was reserved for every image locator in every cache (even if never populated) rather than only the needed cache. The index was also never reset for the lifetime of the program. This new design uses a hashmap based on the locators themselves.
1291950941,remove static_assert used only for testing,bencsikandrei,2023-03-27 20:20:54+00:00,2023-03-28 05:13:44+00:00,{},"based on discussions here: https://github.com/wesnoth/wesnoth/pull/7483/commits/c4439cf5ebb47f6ca5ceed4ef75690f2d1efc00b

and here:
https://github.com/wesnoth/wesnoth/commit/7bff35f991ee6bb4db4918a9165ad921a69086a7#r106243393"
1290923405,DiD S8: Disallow undead bat from retrieving the Book,Wedge009,2023-03-27 07:57:20+00:00,2023-03-27 21:44:06+00:00,"{'Backport': 1, 'Campaign (any)': 1}","Resolves #7485.

I tested with 'Walking' Corpse Bat, Soulless Bat, and regular (humanoid) Walking Corpse and regular Soulless. First two behave the same as live bats (aside from not squeaking) while the latter two behave as a regular unit picking up the book normally. Re-using Malin's line about the bat avoids translation overhead.

I think this should be back-ported too."
1290489011,Minor fixes filesystem,bencsikandrei,2023-03-26 21:03:20+00:00,2023-03-28 05:13:06+00:00,{},"Remove a couple cases where the same header was included in both .cpp and .hpp of some modules. No harm really, but it looks like it was either the result of a merge conflict resolution or simply an omission.
Since I was there, remove copying of `default_blacklist` in multiple TUs, which include `filesystem.hpp`, by using extern (instead of a static const) inside the header. TBH `inline` would have worked just the same, but since the filesystem module already has a .cpp might as well just put it to use."
1290075531,Create 'priority' attribute  for plague used like leadership,newfrenchy83,2023-03-25 16:18:16+00:00,2023-07-07 09:35:11+00:00,"{'Units': 1, 'Schema': 1}",
1290009548,EBO for unique_ptr with SDL_RWops,bencsikandrei,2023-03-25 11:42:52+00:00,2023-03-26 15:36:57+00:00,{},"unique_ptr is designed to allow EBO (empty base class optimization)
for the use case of SDL_RWops this fits well and allows the UP to be half the size it is now (8 bytes vs 16 bytes on x86-64)

see this compiler explorer link:
https://godbolt.org/z/KjnTeqhbv

it also allows easier construction of the unique_ptrs as the ctor no longer requires passing the address of the function to call
since runtime setting of the deleter is not required, that's an added bonus"
1289311837,Update WoF,Jonathan-Kelly,2023-03-24 16:20:07+00:00,2023-03-28 02:14:03+00:00,{'Campaign (any)': 1},Closes #7361
1287220207,Add libboost coroutine and libssl to needed build libraries in INSTALL.md. Resolve #7475,alberic89,2023-03-23 11:16:53+00:00,2023-03-23 15:57:20+00:00,{},Add libboost coroutine and libssl to needed build libraries in INSTALL.md. Resolve #7475
1286571171,Crop dragon unit images to fit the side-bar window,Wedge009,2023-03-22 22:24:50+00:00,2023-04-10 01:28:10+00:00,"{'Graphics': 1, 'Units': 1}",Resolves #7472
1285717569,DiD: Remove invalid syntax,Wedge009,2023-03-22 11:46:26+00:00,2023-03-22 22:31:29+00:00,{'Campaign (any)': 1},"Not really sure what's correct here (hence the PR for the CI check), but https://wiki.wesnoth.org/AbilitiesWML#Common_keys_and_tags_for_every_ability seems to suggest that no `[affect_adjacent]` tags is sufficient to disable the affect-adjacent functionality."
1284785190,Update codeblock projectfiles,newfrenchy83,2023-03-21 19:04:49+00:00,2023-03-21 19:15:39+00:00,{'Building': 1},
1283445479,Typo hander > handler,Toranks,2023-03-20 23:54:41+00:00,2023-03-21 00:36:52+00:00,{'Lua API': 1},Just a typo
1281794528,Revert WML workarounds on mainline replay OOS issues,Descacharrado,2023-03-19 23:24:05+00:00,2023-03-20 16:20:59+00:00,{'Campaign (any)': 1},"Retested all scenarios in #6832 all are working fine, including the scenarios having the fixes reverted.

c1b6bfba34d777c6d854eb49af37db645c256c0b and cd9e92c3c3323ccc6ce41243cac01720d29d849b don't include changes to the changelog file, that's why the commits are different from bb2de96d71b88ee5561ab6b67c4a29c422244f23.

Closes #6832"
1281347747,SotBE: Replace unfortunate wording,Wedge009,2023-03-18 21:56:12+00:00,2023-03-19 04:13:22+00:00,"{'Campaign (any)': 1, 'Prose': 1}","Kapou'e does not appear to be making a comical statement, 'our rear' could be interpreted (admittedly, in a juvenile fashion) as 'rear end', or posterior.

Since #7454 was accepted I think this is a good time to make this change as well (noted this a long time ago but refrained from changing due to the complaints about re-translation overhead)."
1281234978,enable linger mode in replays,gfgtdf,2023-03-18 18:31:55+00:00,2023-03-19 20:18:05+00:00,"{'Bug': 1, 'MP': 1, 'Replays': 1, 'Lua API': 1, 'Engine': 1}","With this pr the replay the replay viewer doesn't stop anymore before the victory event is fired but replay until the game has ended ""Linger mode"".

This Fixes
- #4667 
- #6180 (only tested for non-story-only scenarios)
- #4236 ""Back to turn"" feature not working in mp linger mode

This also contains a few cleanups that made these changes easier.
"
1280872959,move carryover message to new file,gfgtdf,2023-03-18 01:08:27+00:00,2023-03-18 18:04:40+00:00,"{'macOS': 1, 'Building': 1}","Pr to run the checks. Part of my current work to fix victory events in replays, Since adding a new file seems to have a rather big chance for merging conflicts (in particular the xcode projectifles, i used the add_source_file script), i want to merge this quickly."
1279628892,1.16 Backports,gfgtdf,2023-03-17 03:57:34+00:00,2023-03-25 18:31:03+00:00,"{'Campaign (any)': 1, 'Units': 1}","Partly tested.

- the Bezoar Item works now (tested)
- custom effects work in following scenarios
- ""Destruction mechanic line 73 bug""
- Promoted commanders having the wrong id."
1276007220,NR: Dialog/ Story Rewrite: Scenario One.,TheShadowOfHassen,2023-03-15 01:39:11+00:00,2023-03-18 21:43:37+00:00,"{'Campaign (any)': 1, 'Prose': 1}","So I was talking in issue #7448 and someone said that I could make some dialog changes but thought I remembered some other editing problems in the story. I looked at the first scenario and a lot of things in the story that didn't make sense on reading through. I'd like to, if you don't mind, go through each scenario and do some editing.

I don't want my editing to hurt anyone's feelings, and I tried to separate each change in a different commit. So you can pick and choose the changes and squash the commits you like. If you don't like any of the changes, you can reject them all.

I edited it as well as I could, and I ran it through LanguageTool. A lot of the problems I found were that the sentences were too long and made my eyes cross. I tried to shorten them."
1275942722,Fixes #7234 Units being constructed too early ,gfgtdf,2023-03-15 00:14:15+00:00,2023-03-16 17:44:01+00:00,{},
1275557173,Try to fix map diff failure when terrain doesn't have an image associated with it,cooljeanius,2023-03-14 18:14:13+00:00,2023-03-30 18:22:04+00:00,"{'macOS': 1, 'Campaign (any)': 1, 'Docs': 1, 'Graphics': 1, 'Translations': 1, 'UI': 1, 'WML Tools': 1, 'Units': 1, 'Lua API': 1, 'Add-ons': 1, 'Building': 1, 'Help': 1, 'CI': 1, 'SCons': 1, 'CMake': 1}","I'm just trying some suggestions from @macabeus to see if we can fix the map diff failure in #6057
(idk if this is even actually valid TypeScript, much less whether it will actually work or not)"
1274454840,Fix -Wshorten-64-to-32,Pentarctagon,2023-03-14 06:23:45+00:00,2023-04-01 15:48:03+00:00,"{'AI': 1, 'MP': 1, 'UI': 1, 'Editor': 1, 'Units': 1, 'Lua API': 1, 'Add-ons': 1, 'Building': 1, 'WFL': 1, 'Help': 1, 'SCons': 1, 'CMake': 1, 'Terrain': 1, 'Achievements': 1}","---

I'm going to try and go through the rest of them as well (hence the draft PR status), but this change by itself reduces the number of warnings from 2638 to 1721."
1272441428,UtBS - Update and Fixes,Hejnewar,2023-03-12 21:23:38+00:00,2023-03-16 21:04:20+00:00,"{'Campaign (any)': 1, 'Units': 1}","Fixing #7447 #7446 

As well as, various unit stat changes. 

Finally XP and Recall Cost changes, honestly I really like them, yes it will probably require more work but its really fun to play for me. It does make the game overall harder, maybe with the exception of Normal difficulty where recalling for leveling is now cheaper and L3 units still cost around 20g. 

Hard is now like previous Nightmare and I can roll thru it  just as easily and Nightmare is finally a challenge (thus far I managed to beat 4 scenarios and I will continue this run when I have time, no idea if I will win tho). 

The problem currently might be a bigger difference in difficulty between well difficulties but maybe thats also for the better. "
1272280917,NR: Give Eryssa hero trait since her death is a loss condition,Wedge009,2023-03-12 10:25:22+00:00,2023-03-14 04:44:08+00:00,"{'Backport': 1, 'Campaign (any)': 1, 'Units': 1}","I never got an answer to my question in #5374, but this change seems to do what was requested."
1270852890,Reimplement the end_credits with a [listbox],stevecotton,2023-03-10 09:16:01+00:00,2024-04-01 22:52:33+00:00,"{'Bug': 1, 'UI': 1}","The UX here is terrible, but at least it doesn't crash. My intention here is to provide a stepping stone which I hope someone familiar with the GUI2 widgets will take and then improve the UX to solve the bug which this is just a part of, #6952.

UX issues include:
* It sets the background of an item to blue.
* Mousing over the list can make the background shadowed.
* Pressing ""up"" at the start jumps to the bottom of the list.

I'd be happy if someone takes this and reworks it. No need to keep this as a separate commit, cherry-pick bits from it as you wish. Alternatively, maybe there are already better widgets to use, or it could be merged with the expectation that it'll be improved before 1.18 releases."
1267739606,Improve docs about pango_text's high-dpi encapsulation,stevecotton,2023-03-08 11:31:03+00:00,2023-03-09 14:10:07+00:00,"{'Docs': 1, 'Graphics': 1}","A couple of functions become private. Although render_texture(viewport) is dead code I think it's useful enough as documentation to leave it in, at least until we work out how to fix #6952, the crash when trying to show the long text in the end_credits screen.

The removed render_surface() would be private because it returns a surface with render-space width and height, however it was also never called and wouldn't be useful as documentation.

While I understand the implementation of this class, I've not spent time to understand the overview of the design for the high-dpi support; please review assuming that I'm not going to be looking further at this area of the GUI code in the near future, so if you want more explanation about the implementation or if I've used the wrong terminology please ask now.

@mesilliac I'd welcome a review from you, but I've set @Vultraz as the reviewer because as the GUI maintainer he's the person that I'm expecting to fix the credits crash."
1267299877,Add curl-based functionality to download files from a URL.,Pentarctagon,2023-03-08 03:52:54+00:00,2023-03-15 19:49:16+00:00,"{'macOS': 1, 'UI': 1, 'Building': 1, 'SCons': 1, 'CMake': 1}",This is a complement to #7416 where it would be used to replace opening the replay's download URL in a browser.
1267286768,Display ID of addon in addon manager,binarydigitz01,2023-03-08 03:29:15+00:00,2023-03-08 16:15:25+00:00,"{'UI': 1, 'Add-ons': 1}",As discussed in  #6255.
1264932126,GUI: fix indentation that uses both tabs and spaces on the same line,stevecotton,2023-03-06 17:50:18+00:00,2023-03-07 11:21:28+00:00,{'UI': 1},"This isn't the complete set needed to allow `check_mixed_indent` to run over the data/gui directory, it's just these small changes:

* Remove the single space from lines indented ""tab ... tab space"".
* Convert lines indented with ""tab ... tab four_spaces"".

Although these are WML files, the coding standard for the data/gui directory is to indent with tabs instead of spaces.

These are whitespace-only changes, so I'm planning to merge after 24 hours unless someone comments on it."
1263099004,[achievements] add macros for the icons,knyghtmare,2023-03-04 14:27:15+00:00,2023-09-26 21:37:38+00:00,"{'Enhancement': 1, 'WML': 1}",Closes #7415
1262986140,manual_tests: change macro loader to TEST,knyghtmare,2023-03-04 07:35:34+00:00,2023-03-11 16:41:14+00:00,{'Unit Tests': 1},Closes #7426 
1262541254,campaignd: Fix blank license terms if [server_info] is missing,irydacea,2023-03-03 19:41:18+00:00,2023-03-17 22:22:39+00:00,"{'Bug': 1, 'Add-ons': 1}","If interacting with a campaignd instance that has a fresh configuration or is otherwise missing the `[server_info]` tag, the client will present the player with completely blank licensing terms. This was caused by a logic issue with the processing of `[server_info]` wherein no default attribute values would ever be loaded if the tag was missing.

(This has never been relevant or found on the production campaignd instances because all of them have `[server_info]` tags explicitly provided for the purpose of formatting add-on forum thread URLs.)"
1260167154,removed mutex according to issue #7371 Revert b780da4,SyedSaifuddin045,2023-03-02 09:51:52+00:00,2023-03-07 22:12:09+00:00,{},
1257665017,UtBS S05 add logic to the main cavern event so scouting is taken into account,Descacharrado,2023-02-28 19:15:22+00:00,2023-02-28 22:57:16+00:00,{'Campaign (any)': 1},"Closes #7394 

Line 846 (changing the position of the troll) is meant as a fix to a borderline issue, where Kaleh is in a position where he can't reach the keep if the player allies the dwarves, but can if he allies the trolls (because Zone of Control) - a different approach could be setting the troll in 30, 28. Not a major change anyways.

As seen in the picture, Kaleh can't get to the keep via the 6-moves that is represented with the blue line, as it crosses two tiles with ZoC and he can't reach either via the 7-moves represented with the green line, as it is too far away.
![ZoCThen](https://user-images.githubusercontent.com/30196839/221952974-f4d9529b-3684-4600-bc8b-b5fa4b858b3d.png)
Kaleh would be able to reach the keep with the new position of the troll.
![ZoCNow](https://user-images.githubusercontent.com/30196839/221952980-ddbba554-6915-4b2d-a1ac-b898f175b893.png)

Line 933 is a debug message, useful for debugging or playtesting later.

Lines 934 - 973 
- If kaleh is the explorer, he just says ""Whoa."" and everything else in these lines is skipped
- If other unit is the explorer and
    1. the explorer does not reach too far out (x=26 or beyond). Then Kaleh moves up to the explorer
    2. the explorer reaches too far out. Then Kaleh moves to 24,28 (the first tile that triggers the moveto event)
  
Lines 974-1005 Kaleh's movement points are fully restored in EASY and MEDIUM, partially restored (only if necessary) in HARD
"
1255619794,"Fix mixed indents in the schema, and verify new additions",stevecotton,2023-02-27 14:56:35+00:00,2023-03-02 14:34:41+00:00,"{'WML Tools': 1, 'Schema': 1}","This uses tabs instead of spaces, because although that's not our coding standard, it is only a few lines of changes.

The alternative of running wmlindent on these files changes 4700 lines; while I'm in favor of doing it, it's discussed in #5709."
1254484022,"Help: don't display trait availability, and refactor code",stevecotton,2023-02-26 13:01:48+00:00,2023-03-02 13:18:59+00:00,{'Help': 1},"The `[trait]availability=` attribute acts as a part of the parent tag, not as a part of the trait itself. For example, `[trait]id=fearless` occurs in both the `TRAIT_FEARLESS` and `TRAIT_FEARLESS_MUSTHAVE` macros, and the trait is:

* Must-have for units: Ghast, Ghoul, ...
* Available for non-leaders of race: Troll
* Available for non-leaders of types: Dune Paragon, HI, ...

Showing a single ""Availability:"" in the help is therefor misleading. Adding a detailed list of where it's available adds a lot of code complexity for little gain; this commit takes the code cleanup and comments from prototyping that, but just removes the ""Availability:"" text from the help."
1254284580,Add a CMake and SCons flag for GLIBCXX_ASSERTIONS without GLIBCXX_DEBUG,stevecotton,2023-02-25 19:04:26+00:00,2023-03-03 09:44:22+00:00,"{'Building': 1, 'SCons': 1, 'CMake': 1}","Turning GLIBCXX_ASSERTIONS adds some bounds checks, such as checking in std::string::operator[]. It's a subset of the checks that GLIBCXX_DEBUG adds, but has the advantage that it doesn't require a rebuild of the Boost libraries.

None of the CI builds enable these assertions, as they slow down the code which makes the unit tests time out.

This makes it easy to replicate #7412."
1254267935,"WoF S03,S08 - Added animation when units go to recall list",Toranks,2023-02-25 17:46:17+00:00,2023-02-28 03:12:49+00:00,{'Campaign (any)': 1},"This resolves #7410  and the same situation on S08 Overlook, when the units escapes from the cave on 31,1
Uses the pre_teleport animation (in the absence of another specific animation for drakes), which does a smooth fade effect and is automatically generated on any unit."
1252566206,"Fixup, complete, and enable the lobby's game history viewer.",Pentarctagon,2023-02-24 03:55:59+00:00,2023-03-11 16:55:56+00:00,"{'macOS': 1, 'MP': 1, 'UI': 1, 'Add-ons': 1, 'Building': 1}","At some point in the future I'd like to come back and add some search parameters - right now it shows the game history of the currently selected player in the lobby, but ideally it would instead have options for player name, era, scenario, etc.

---

The replay link also only opens the player's browser which downloads the replay file. Ideally it would be downloaded by the client directly to the saves folder, but as far as I know there's currently no way to do that and this seemed like enough for a PR.

The UI:
![image](https://user-images.githubusercontent.com/3030250/222972125-4d83632c-6719-4ed6-832e-2088dbe6cefe.png)

"
1249725014,WoF make recall of some unit type trees undoable,Toranks,2023-02-22 08:01:02+00:00,2023-02-22 20:02:47+00:00,{'Campaign (any)': 1},"The way it's written prevents undoing the recall action of the filtered unit trees (Drake Arbiter, Drake Thrasher and Drake Warrior). It is better to activate the event only if the other conditional is also fulfilled, it is unnecessary in the rest of the cases.
What I have done is simply moved the conditional from [if] to the [filter_condition] of the event itself

Just to clarify for those who don't know, the code makes the unit loyal if the original loyal of the same type tree died or was removed from the recall list. I've tested all cases with the new filters and works fine."
1249481432,Catch invalid argument exception for stoi in unit advancement,Wedge009,2023-02-22 02:26:52+00:00,2023-02-23 02:57:08+00:00,"{'Backport': 1, 'Units': 1}","Resolves #7402.

Took me a while to find the relevant `stoi` call - not sure if 'replay' is the right log domain but I'm just following the convention used elsewhere in this file.

When I checked, normal (debug) unit advancement still works and attempting to use a string argument does nothing (but logs the warning) instead of completely crashing.

Could be back-ported as the bug is present for 1.16 as well."
1249443365,Units: Try to avoid hard-coding of size of known boolean states,Wedge009,2023-02-22 01:28:16+00:00,2023-02-23 02:56:27+00:00,{'Units': 1},"#7363 added a new invulnerable state but neglected to increment the number of states.

I'm not sure if there's a better way of doing this."
1249361546,Show availability on traits' help pages,stevecotton,2023-02-21 23:10:18+00:00,2023-02-26 13:02:46+00:00,{'Help': 1},"It started as a ""quick test of a review comment for #7388"", and grew....

WIP: This adds a lot of complexity. I think there's two possible routes to go from here:
* Remove the availability note completely. Maybe merge some code cleanup from this.
* Clean up this code, however it's not going to get any less complex.

This logic was seeming too complex, until I realised that the TRAIT_FEARLESS
and TRAIT_FEARLESS_MUSTHAVE macros exist. That trait is:

* Must-have for units: Ghast, Ghoul, ...
* Available for non-leaders of race: Troll
* Available for non-leaders of types: Dune Paragon, HI, ...

Splitting the for loop into two is just because it seemed unnecessary to look
up the race for each member of the race. That's one of the code cleanups that
would be worth doing even if the availability note is removed."
1248030955,WoF S01 typo,Toranks,2023-02-21 02:42:00+00:00,2023-02-21 02:46:43+00:00,{'Campaign (any)': 1},Just a double quote by mistake
1247794711,Resolve Issue 7398: Crash on Attack with Planning Mode,Dyrcona,2023-02-20 20:45:23+00:00,2023-02-21 08:02:46+00:00,{'Whiteboard': 1},"The game crashes when the player clicks the Attack button with planning mode with a console error about a failed assert on line 164 of src/whiteboard/attack.cpp.  The assert uses > but it looks like it should be >=.

This commit switches from > to >= and appears to resolve the issue."
1247373793,Grüü apparition fixed (and commits squashed),stevecotton,2023-02-20 14:07:16+00:00,2023-02-21 07:21:29+00:00,{'Campaign (any)': 1},"Backport of #7282, this time squashing the commits instead of rebase-merging them.

This, instead of killing Grüü, moves him along with the others to participate in the conversation, and also switches him to side 1 (this side is temporary and only for narrative purposes, later on turn 7 he switches to side 4 again).

Grüü is correctly stored on the variable when the conversation ends, and restored later on turn 7.

(cherry picked from commit cccd562cc5726348530f077dd9663239ef9cddda)
(cherry picked from commit 34a5cce2b072209cbf4de128b123a3dde7e65ee5)
(cherry picked from commit f23134890009896088b8e9fe549042ee4d0553a1)
(cherry picked from commit 89dbd2d37336785c416b9e76a3a0dcf27500b0b0)"
1246280972,[Achievements] add achievement frames for Icons,knyghtmare,2023-02-19 12:30:20+00:00,2023-03-20 16:59:49+00:00,"{'Enhancement': 1, 'Graphics': 1, 'Achievements': 1}","Will resize to 72x72 on request

Author of Frames: Eleazar (wesnoth's former terrain art director)
Source: <https://opengameart.org/content/painterly-spell-icons-part-3>

![image](https://user-images.githubusercontent.com/5283677/219947997-fa601686-3fba-4f7e-8141-3fd1a5de1ea6.png)
"
1244193761,"Display ""any"" availability instead of ""none""",soliton-,2023-02-16 19:20:02+00:00,2023-02-28 10:10:04+00:00,{'Help': 1},Feel free to suggest better wording.
1243803945,[Terrains] Add treehouse villages,knyghtmare,2023-02-16 14:41:10+00:00,2023-06-06 14:36:59+00:00,"{'Enhancement': 1, 'Graphics': 1, 'Terrain': 1}",From the UMC Terrain Pack. Closes #7385 
1242569105,Further consolidate logging functionality between Windows and non-Windows platforms.,Pentarctagon,2023-02-15 19:11:48+00:00,2023-02-17 16:03:05+00:00,"{'Campaign (any)': 1, 'Graphics': 1, 'Units': 1, 'Building': 1}","For non-Windows platforms this adds:
* a new check for whether the logs directory exists and is writable by attempting to write a single whitespace to a dummy.log file.
* a popup shown immediately after the GUI system is initialized letting the player know if there was an issue creating the log file.

For Windows, this changes:
* instead of writing to the OS temp directory and then attempting to move that file to the logs directory, this uses the same check that was described above for non-Windows platforms.
* the alert shown when writing the dummy log file fails is now a Wesnoth alert message rather than the Windows-specific MessageBox.
* a failure to create a log file does not immediately exit wesnoth anymore.

---

@knyghtmare or @Wedge009 - Can one of you test the following on Windows?:
* By default, logs are still correctly written to the log file.
* Running with `--wconsole` still writes the output to the terminal."
1239581126,"Update ReadME.md (add Features/Gallery, etc.)",samuelroman74,2023-02-13 20:28:10+00:00,2023-04-29 06:20:46+00:00,{'Docs': 1},"Added features list and gallery, fixed some grammatical errors, clarified itch.io installation technique, and further compartmentalized how people could contribute to the project."
1237762229,Add script for starting wesnoth on macos+steam with the right arch.,Pentarctagon,2023-02-11 15:59:45+00:00,2023-05-19 16:08:45+00:00,"{'macOS': 1, 'Building': 1}",
1236663523,Editor: move the text at the bottom of the screen,stevecotton,2023-02-10 13:02:45+00:00,2023-02-15 14:03:37+00:00,"{'UI': 1, 'Editor': 1}","This is the forwardport of #7362. I'm now seeing that more cleanup is possible, but I'd prefer to merge this close to as-is, so that any cleanup that happens in later commits is separate and easily reviewable for (if necessary) backporting to 1.16 too.

Fixes: #6422

Second commit (cherry-pick of 1.16's 29d86d2c369483c45aa599076eb076c5792b7ef3)
---

Editor: let the help text switch between the top and bottom of the screen

If the northmost hexes of the map are visible, put the text on the bottom; if
the southmost are visible, put it on the top. Also, make the text smaller if
it's very wide.

It used to be fixed to the bottom of the screen, but this meant that it always
obscured the southmost hexes of the map, and the only way to avoid that is to
scroll east/west, or to add an extra row on the south. Similarly, having it at
the very top obscures the northmost hexes.

Moving it to any fixed location that isn't the edge of the screen makes it
possible to edit all the hexes, but also makes it more annoying when working
elsewhere on the map; that trade-off was rejected in review.

For very small maps, it will be at the bottom of the screen in the border
outside the map area. For any screen resolution there will be a specific
map-height that still has the old issue, but that's an improvement on it
happening for every map size.

First commit (corresponds to 1.16's 76306d3fb61da9a046087fc862d960a6ac5d4cad)
---

Move set_help_string to editor-only code

No behavior changes, this is just separating it into the editor directory.

This corresponds to 1.16's 76306d3fb61da9a046087fc862d960a6ac5d4cad, but has
additional cleanup outside the editor directory, including removing the unused
code from floating_label.cpp. Even within the editor, there are differences
because of the graphics refactor."
1235987584,Add achievements button to titlescreen.,Pentarctagon,2023-02-10 02:22:30+00:00,2023-02-12 16:10:15+00:00,{'UI': 1},
1234627001,Engine: make achievement title less bright gold,knyghtmare,2023-02-09 06:49:27+00:00,2023-02-09 15:01:11+00:00,"{'Enhancement': 1, 'UI': 1, 'Achievements': 1}","changes from gold to khaki

The current gold looks more yellow and doesn't synergize well with the green description text."
1234156668,Small achievements cleanup,Pentarctagon,2023-02-08 21:10:09+00:00,2023-02-10 00:36:45+00:00,{'Lua API': 1},"---

@CelticMinstrel There isn't really much going on here, but I just wanted to have my use of `luaW_pcall` double checked before merging."
1231971805,Delete an out-of-date comment in data/themes/default.cfg,stevecotton,2023-02-07 13:17:02+00:00,2023-02-08 08:01:52+00:00,{'UI': 1},"The level isn't to the right of the alignment any more, the workaround that the comment refers was removed in ca2eec45b9."
1231068472,Add icons for invulnerable and unhealable states,Elvish-Hunter,2023-02-06 21:08:08+00:00,2023-02-13 09:01:35+00:00,"{'Graphics': 1, 'Units': 1}","As it was discussed in the development channel, this PR adds three icons (artwork by me; keep in mind that I'm not an artist) for the guardian, unhealable and invulnerable units states; it also makes the invulnerable status formally known by the engine (currently it's checked by string comparison)."
1230059058,[1.16] Editor: Move the text at the bottom of the screen,stevecotton,2023-02-06 08:37:03+00:00,2023-02-09 04:39:05+00:00,"{'UI': 1, 'Editor': 1, 'Fwdport': 1}","Having it at the very bottom means that it will always obscure the southmost hexes
of the map, and the only way to avoid that is to scroll east/west, or to add an extra
row on the south. Moving it upwards makes it more annoying when working elsewhere on
the map, but it's a trade-off for being able to edit those southmost hexes.

Also, make the text smaller if it's very wide.

This is the 1.16 fix for #6422, with the idea that the second commit will be cherry-picked to 1.17 and then possibly expanded upon. I've also looked at moving the label between the top and bottom of the screen, but that would feature-creep into adding additional functionality to the floating_label support.

![help_string_800x600](https://user-images.githubusercontent.com/101462/216923012-73802cd3-2382-4a98-9985-cd44252271b5.png)
![help_string_1280x1024](https://user-images.githubusercontent.com/101462/216923023-b94b9737-9fdb-4dc6-ad1c-7b0e431eabec.png)
![help_string_2560x1440](https://user-images.githubusercontent.com/101462/216923025-3fe60a7f-b262-4284-9fbb-8e82907a37da.png)


The first commit of the two in this PR
--

Use an editor-only copy of font::set_help_string

This function shows a tooltip-like text at the bottom of the editor's screen,
for example when the paint tool is active it shows which terrains are assigned
to the left and right mouse buttons. There is similar functionality in GUI2,
for example when hovering over the title screen's buttons, which is handled via
event::MESSAGE_SHOW_TOOLTIP.

In the 1.17 branch's 3900419f9230189c699cf2cddb06b31f5025a5f9, I checked that
nothing outside the editor was calling the function. However, that analysis was
done after 1.17's refactoring of the graphics system. For 1.16 I'm not going to
repeat that analysis; the copy that's left in video.cpp is probably dead code,
but I see little reason to remove it from the stable branch."
1229794637,NR S07 - Arthian > Ro'Arthian typo,Toranks,2023-02-06 03:35:49+00:00,2023-02-06 15:19:23+00:00,{'Campaign (any)': 1},"In only one place Ro'Arthian has an error in his name:

#. [part]
#: data/campaigns/Northern_Rebirth/utils/utils.cfg:160
msgid ""Arthian""
msgstr ""Arthian""

I realized it by checking the translations."
1229634527,Lua warning cleanup,CelticMinstrel,2023-02-05 23:29:50+00:00,2024-08-13 12:54:04+00:00,"{'AI': 1, 'MP': 1, 'Lua API': 1}",
1229590326,Allow playing a sound when an achievement is completed.,Pentarctagon,2023-02-05 20:40:57+00:00,2023-02-06 03:29:05+00:00,"{'Lua API': 1, 'Schema': 1, 'Achievements': 1}",
1229479102,Isar's Cross waterfall animations,inferno8,2023-02-05 15:09:01+00:00,2023-02-13 04:22:37+00:00,"{'Graphics': 1, 'MP': 1, 'Terrain': 1}","This addressees #7348. The PR includes 40 waterfall animation frames for Isar's Cross and the updated scenario file. It also adds a new ""Art Placeholder"" (^Xxxx) terrain, which is used to place the animation.

The looped animation was rendered at 24fps (.webp RGBA format.).

![isar waterfall](https://user-images.githubusercontent.com/35965303/216826424-390eab34-2b00-4e22-ad61-317189ee38ef.gif)
"
1229419540,Only call font::set_help_string() from the editor,stevecotton,2023-02-05 11:47:31+00:00,2023-02-05 16:19:13+00:00,{'Graphics': 1},"Remove some dead GUI1 code, leaving the editor's palettes as the only code that calls font::set_help_string. This function shows a tooltip-like text at the bottom of the editor's screen, for example when the paint tool is active it shows which terrains are assigned to the left and right mouse buttons.

There is similar functionality in GUI2, for example when hovering over the title screen's buttons, which is handled via event::MESSAGE_SHOW_TOOLTIP.

This cleanup is the groundwork for moving the label in the map editor so that it doesn't always obscure the southmost hexes of the map. The implementation of font::set_help_string() has moved during 1.17's refactoring (from CVideo in 1.16 to floating_label in 1.17.12); the intention is to replace it with editor-specific code in a later PR for #6422.

Checking that the code is dead
---

Nothing called widget::set_help_string, therefore the rest of the removed code in the widget class was effectively dead.

For the menu class, nothing set item::help. I doubt it was ever used; it was added in a commit titled ""changes to wose stats"" that presumably accidentally captured some work-in-progess C++ changes too: e2597cbc83.

The menu class is now only used by the help browser. The complete set of .cpp files that get recompiled after changing menu.hpp are:

* help/help.cpp
* help/help_browser.cpp
* help/help_menu.cpp
* video.cpp
* widgets/menu.cpp
* widgets/menu_style.cpp

@CelticMinstrel I'm assigning the review to you as you've recently worked on the GUI1 -> GUI2 transition for the help browser."
1229359218,Save last selected achievement to the preferences,Pentarctagon,2023-02-05 06:26:01+00:00,2023-02-05 15:42:35+00:00,"{'UI': 1, 'Lua API': 1, 'Achievements': 1}",Also give a better warning when amount isn't a number.
1229288027,Have hidden achievements actually be hidden.,Pentarctagon,2023-02-04 23:07:29+00:00,2023-02-05 03:40:03+00:00,"{'Campaign (any)': 1, 'UI': 1, 'Lua API': 1, 'Schema': 1, 'Achievements': 1}",Also hidden_name and hidden_hint are no longer attributes of [achievement].
1227245714,Store glib build log on build failure,stevecotton,2023-02-02 21:22:30+00:00,2023-02-03 09:12:59+00:00,"{'Bug': 1, 'Building': 1}","If the Windows CI rebuilds (or has an empty cache and just builds) vcpkg, and that build fails, then this will try to upload the logs from the glib build. It doesn't trigger if the vcpkg rebuild succeeds.

Although I was originally planning to close this without merging, as the builds have been awkwardly successful recently, I'd like to merge this and catch the logs when it does fail. It doesn't need the cache to be cleared - if vcpkg decides not to rebuild then everything is good for that build."
1225809525,Add new attacks_used key to [attack],CelticMinstrel,2023-02-02 01:51:16+00:00,2023-02-04 18:55:04+00:00,"{'Unit Tests': 1, 'Units': 1, 'Lua API': 1, 'WFL': 1, 'Schema': 1}","This implements the ""uses N attacks"" feature used by @Hejnewar in #7349. Since it parallels the existing `movement_used` key it seemed reasonable to handle it at the engine level.

Wiki documentation to be updated if this is merged:

* [x] Attacks section in UnitTypeWML
* [x] `apply_to=attack` section in EffectWML
* [x] StandardWeaponFilter
* [x] WFL documentation for attack objects
* [x] Lua documentation for attack objects
"
1225649375,modify calling of unit_abilities::effect and get_composite_value(),newfrenchy83,2023-02-01 23:05:14+00:00,2023-02-02 19:27:09+00:00,{'Units': 1},"in addition to simplify the calling of calculation function for int weapon specials, it also because an commit what i want push in https://github.com/wesnoth/wesnoth/pull/6968 a attribute  require this function."
1225030183,Quenoth Rework,Hejnewar,2023-02-01 15:07:08+00:00,2023-02-17 23:33:49+00:00,"{'Campaign (any)': 1, 'Graphics': 1, 'Units': 1, 'Schema': 1}","The faction design of the current Quenoth is not satisfactory with some faults here and there, and I think the faction deserves more effort and scope of originality. This PR will hopefully make the whole faction more interesting and enjoyable to play. Also sorry if this PR is too big. 

Credits: 
Jarom - for big help with the code. 
Everyone who helped with idea for the Quenoth Sun Singer and Sun Sylph.
"
1224835957,[MP] Add Survival Scenario Achievements,knyghtmare,2023-02-01 12:55:41+00:00,2023-02-09 18:31:33+00:00,"{'Enhancement': 1, 'MP': 1, 'Achievements': 1}","- [x] A New Land
- [x] Team Survival
- [x] Dark Forecast
- [x] Isle of Mists
- [x] A New Land Extra Achievements (got like 6 in mind, but will add later)"
1224027699,Add Sand Scamperer portrait and fix Giant Scorpion's ,spixi,2023-01-31 23:30:54+00:00,2023-02-12 16:09:49+00:00,"{'Graphics': 1, 'Units': 1}","The portraits of Giant Scorpion and Sand Scuttler where not aligned properly. I fixed that, so that their position now matches. I also added a portrait for the Sand Scamperer (based on the Giant Scorpling and the Sand Scuttler with some color shifting and added sand). Finally I added a macro to increase maintainability of the Sand Scamperer's unit cfg.

This belongs to #7244"
1223533624,Remove unused deprecation functions from wml_exception.cpp/hpp,stevecotton,2023-01-31 15:56:07+00:00,2023-02-07 13:18:13+00:00,"{'Lua API': 1, 'Terrain': 1}","Remove some unnecessary includes of wml_exception.hpp.

The last callers of these functions were removed in f545fbcbe8 and 4437691bdd, and any potential future callers can use config::get_old_attribute instead.

Removes some translatable strings."
1223529397,Unit tests to evaluate behavior with max_experience=0 and with no advancements,Toranks,2023-01-31 15:52:54+00:00,2023-02-04 12:14:44+00:00,{'Unit Tests': 1},"Check the behavior of units when their maximum experience is 0, with or without advancement available. The default engine behavior is that if a unit has any advancement, it can't have `max_experience=0`, so it always changes to `0/1`. If the unit have no advancements, then the experience bar will disappear and show `-` instead of `0/1`

This test is equivalent to `experience=0` on `[unit_type]` too. `[unit] max_experience=` takes by default the value of `[unit_type] experience=`

* API(s) being tested: `[unit] max_experience=0`

* Actions:
Change Alice's and Bob's max_experience to 0. Delete Bob's 'Orcish Warrior' advancement but not Alice's. Harm bob with 1 hitpoint to be sure that he have some damage. They then fight each other.

* Expected end state:
Alice levels up and changes her max_experience to the advancement. Bob don't advances and have 1 point of max experience. The default behaviour is for a unit with max_experience 0 always changes to 1, no matter if they have advancements or not (seen with inspect console).

Note: For some reason I've been forced to use `[object] [effect] apply_to=remove_advancement`, because without `[object]` it doesn't work.

![imagen](https://user-images.githubusercontent.com/40789364/215809200-7d81a040-c4e3-4345-bf31-7c10155f8c13.png)

This PR is complemented with #7339, for which it serves as a test."
1222909614,Fix the missing logs issue (closes #7310),CelticMinstrel,2023-01-31 08:33:21+00:00,2023-02-15 04:10:38+00:00,{},
1220995638,[1.16] Ally orb color preferences,stevecotton,2023-01-30 04:21:33+00:00,2023-01-31 09:36:50+00:00,"{'Enhancement': 1, 'UI': 1, 'Units': 1}","Backports of #7266 and #7189.

Use spacing to improve the orb color preferences dialog (backport of #7266)

Use two-color orbs for allies' units, configurable by preferences (backport of #7189)

These orbs no longer look the same as the player's own orbs, so they won't cause confusion in multiplayer.

The relevant part of the advanced preference now shows:

```
[ ] - Show ally orb
[ ] - During ally’s turn, use a two-color orb to show movement
Radio buttons for colors: ( )  ( )  ( )  ( )  ( )  ( )  ( )
```

That offers these choices:

* Don't show ally orbs at all
* Always use the one-color (with ally color, not status)
* Use the two-color when that ally is playing, single color at other times
* Use the two-color when that ally is playing, no orb at other times

This probably doesn't need a change to the in-game help, at least for the en_US version of the documentation. The current text in data/core/help.cfg is:

* Blue for allied units, except during that ally's own turn.
* During the ally's own turn, their units will be shown with the colors showing whether the units can still move and attack; however their moves, and the corresponding orb changes, are delayed as explained in ""Shroud and Fog of War'."
1220948832,Orb related cleanup for preferences and game_config,stevecotton,2023-01-30 03:15:55+00:00,2023-01-31 05:45:53+00:00,"{'UI': 1, 'Units': 1, 'Low Priority': 1, 'Schema': 1}","Assorted cleanup, fixes #7261.

* Add `game_config.cfg`'s `show_*_orb` to the schema
* Rename `show_partly_orb`
* Remove the unused `disengaged_orb_color` preference

The `show_*_orb` keys are supported in game_config.cfg, but currently they're not used in that file, instead falling back to the defaults in the C++. Add them to the schema, but not to `game_config.cfg` itself.

The name `show_partly_orb` was inconsistent - in other places, including the WML that's stored in the user's preferences file, it's called `show_partial_orb`.

Remove leftovers from the original implementation of the disengage orb, when it was a new color for the single-color orb. During the review process it became the two-color design, but these parts were left in.

The value of orb_status_helper::get_orb_color(orb_status::disengaged) is used (both before and after this commit) by the minimap; this commit changes get_orb_color to return the partial_color() directly. The result will be the same as before, because disengage_color() returned the same as partial_color(). Prior to this commit that was done by giving both orbs the same value in game_config.cfg. If the advanced preference to change orbs colors was used, the value chosen for the partial orb was passed to set_disengage_color() too."
1220751732,"[Unit Tree] Update defines list and comment out ""not-working"" advancefrom",knyghtmare,2023-01-29 19:57:43+00:00,2023-02-12 16:11:46+00:00,{'WML Tools': 1},
1220724271,UTBS Minion and Spire XP reduced,Toranks,2023-01-29 18:20:04+00:00,2023-02-15 08:09:47+00:00,"{'Campaign (any)': 1, 'Units': 1}","
![imagen](https://user-images.githubusercontent.com/40789364/215347397-c8c6c785-b52f-45c4-a1f4-ed974a017554.png)

All the alien units have the same experience, resulting in this disproportion, and it looks pretty ugly.

I can change the ratio of the experience bar with xp_bar_scaling, but reducing the experience is the best option, it does not affect the balance since they are low health units, it is very almost impossible for them to level up."
1220647938,Fix Issue 7337: Byte Compiler Warnings for wesnoth-mode,Dyrcona,2023-01-29 14:24:45+00:00,2023-01-29 17:14:59+00:00,{'WML Tools': 1},"Switch from obsolete Emacs Lisp functions to modern functions in order to remove two compiler warnings.

Properly quote lambdas with #' to remove two more compiler warnings."
1218845200,Add functionality for achievements to be partially complete.,Pentarctagon,2023-01-27 06:12:32+00:00,2023-02-04 21:43:29+00:00,"{'Campaign (any)': 1, 'UI': 1, 'Lua API': 1, 'Schema': 1, 'Achievements': 1}","Instead of being either complete or incomplete, achievements can now specify a value at which they will be considered complete. For such achievements that are not yet complete, a progress bar is added to the achievements dialog showing how close to completion the achievement is.
![img](https://user-images.githubusercontent.com/3030250/215358037-e780ff72-17a7-498e-9dae-d8bce0f85eda.png)
"
1218585155,Add Sand Scamperer,spixi,2023-01-26 23:39:07+00:00,2023-01-29 16:48:42+00:00,"{'Enhancement': 1, 'Units': 1}","The Sand Scuttler has been separated from the Giant Scorpion. This commit adds a Level 0 counterpart of the Giant Scorpling which advances into the Sand Scuttler.
See also: #7244 "
1218377783,Make fix_whitespace complain about mixing tabs and spaces,stevecotton,2023-01-26 20:05:39+00:00,2023-02-05 01:22:53+00:00,"{'Enhancement': 1, 'AI': 1, 'Campaign (any)': 1, 'WML Tools': 1, 'Lua API': 1, 'CI': 1}","Ensures that files either use tabs for indentation or spaces for indentation, but don't switch between the two within the same file.

This doesn't fix the whitespace, it's a simple check to flag it up on the assumption that it's better to use an editor or code formatter to clean up the file.

Elsewhere in the CI we use the luacheck tool - while that can detect mixing tabs and spaces in a single line's indent, it doesn't check for inconsistent indentation within a file."
1217657049,Make fix_whitespace convert tabs in Lua files,stevecotton,2023-01-26 09:59:42+00:00,2023-01-26 10:39:29+00:00,{'Campaign (any)': 1},"There was exactly one .lua file that contained any tabs at all, so we seem to already have a coding standard.

This will also convert tabs inside strings - I didn't anchor the regexp to the start of the line because it should convert all tabs used in the indent, not just the first tab on the line."
1216992849,Add the Elvish Hunter line to mainline,CelticMinstrel,2023-01-25 18:57:16+00:00,,"{'Graphics': 1, 'Units': 1}","These are sort of a relic from the pre-Quenoth desert elves, only converted back to a wood elf. I think it's a nice flavour unit to have for some campaigns."
1216146307,CI: Make the Windows CI builds use separate caches,stevecotton,2023-01-25 07:17:35+00:00,2023-01-26 10:56:24+00:00,"{'Building': 1, 'CI': 1}","Looking at recent build failures, one of Debug or Release is using the prebuilt vcpkg from the cache, and the other one is detecting it but then deciding to rebuild many of the packages.

The build logs circa 8bd8c53f9887ae2440b9a4d29ec55655de08b519 are no longer accessible, only the success/failure and time taken are still accessible. Looking at build timings around those changes is inconclusive, however my guess is that the CI is noticing that CFG is different between the two builds, and that's forcing a rebuild for one of them."
1216080608,Move the Orcish Shamans to core as a new unit line,CelticMinstrel,2023-01-25 05:44:50+00:00,2025-03-23 22:16:49+00:00,"{'Graphics': 1, 'Units': 1, 'Campaign SotA': 1, 'Campaign SotBE': 1}","This allows addons to safely use them without having to copy the files into their own addon directory.

I've also converted them into a unit line, rather than keeping them as three separate and unrelated units.

Existing uses are now special-cased units based on the new line, rather than directly using the new line."
1216080339,Move the Naga Hunter unit to core,CelticMinstrel,2023-01-25 05:44:18+00:00,,"{'Graphics': 1, 'Units': 1}",This allows addons to safely use it without having to copy the files into their own addon directory.
1216080268,Add the Great Ogre to core,CelticMinstrel,2023-01-25 05:44:11+00:00,,"{'Graphics': 1, 'Units': 1}","This used to be a custom unit in Legend of Wesmere, but it was removed at some point.

This allows addons to safely use it without having to copy the files into their own addon directory.

This commit makes Ogre advance to Great Ogre. It may instead be desirable to make this an optional advancement."
1216079959,Move the Dwarvish Miner unit to core,CelticMinstrel,2023-01-25 05:43:36+00:00,2023-02-14 13:02:37+00:00,"{'Campaign (any)': 1, 'Graphics': 1, 'Units': 1}","This allows addons to safely use it without having to copy the files into their own addon directory.

Also changes the tracking of what they're carrying to be a status instead of a role, which should be more portable to other use-cases."
1216079828,Move the Merman Citizen and Brawler units to core,CelticMinstrel,2023-01-25 05:43:20+00:00,2023-01-27 03:45:29+00:00,"{'Campaign (any)': 1, 'Graphics': 1, 'Units': 1, 'Lua API': 1}","This allows addons to safely use them without having to copy them into their own addon directory.

Opened as a draft because it's not quite done – the stun event needs to be handled somewhere other than in the brawler unit definition."
1215650037,[1.16] Add a unit test for scoped arrays,stevecotton,2023-01-24 20:08:06+00:00,2023-01-25 01:12:04+00:00,{'Unit Tests': 1},"Backport of #7321 

The existing test for scoped vars is both copied and renamed.

(cherry picked from commit fba0970509804c9faa16c8f1c707253a4a8e4245 with files moved back to the old directory)"
1215374821,Add a unit test for scoped arrays,stevecotton,2023-01-24 16:25:39+00:00,2023-01-24 20:02:35+00:00,{'Unit Tests': 1},"The existing test for scoped vars is both copied and renamed.

This passes on 1.16 too (after moving the files to the old directory)."
1213154275,[HttT] [Units] make injured sergeant lie flat on ground,knyghtmare,2023-01-23 09:26:31+00:00,2023-01-24 18:40:09+00:00,"{'Campaign (any)': 1, 'Units': 1}",Closes #7311 
1212493549,Fix crash in scenario editor when placing units,stevecotton,2023-01-22 01:54:31+00:00,2023-01-22 23:04:33+00:00,"{'Bug': 1, 'Units': 1}","Forwardport of #7297. @newfrenchy83 this doesn't seem to have conflicts with your PRs.

The previous bugfix fixed a crash when loading savegames with units whose abilities accessed the map while the display_context was still being constructed, however it reintroduced a bug in the scenario editor. Using the unit tool always crashed when adding any unit.

This commit uses 4d1fc268b1's code path whenever possible, however it falls back to 6a21fdc675's code path when 4d1fc268b1 would assert. In practise one path is used in game and the other is used in the scenario editor, but doing the logic in this way ensures that any edge cases are going to affect the scenario editor rather than the game itself.

Cherry picked from commit 1485cfd6256b73bb06aa34c512c2890749b45487, with conflicts because code from attack_type::weapon_specials() has moved to attack_type::weapon_specials_impl_adj().

Fixes #7296."
1212474751,Fix game data dir search for Visual Studio builds on Windows,irydacea,2023-01-21 23:43:39+00:00,2023-01-23 07:15:19+00:00,{'Windows': 1},"The logic we used here hasn't had the desired results since the move from using custom Visual Studio project files to using the CMake integration system, so this patch updates it to match the layout we get with the CMake integration on Visual Studio 2019 and 2022.

Note that without this patch, the game is unable to detect a valid game directory by default when launched by MSVC++ without an explicit path, which results in an assertion failure somewhere in the filesystem API."
1212441614,Fix HP lost with dehydrated on tooltip,Toranks,2023-01-21 21:05:00+00:00,2023-01-26 00:23:57+00:00,"{'Campaign (any)': 1, 'Translations': 1}","It's simple, only a variable substitution, and I just tested it. The only problem is that the string will have to be translated again in all languages.
![imagen](https://user-images.githubusercontent.com/40789364/213886939-47ace831-cb5e-4c4e-9c54-6d2cc42169a0.png)
To be more sure, I've tried the spanish translation, and it works.
![imagen](https://user-images.githubusercontent.com/40789364/213887060-14ea41aa-a222-4bfb-8ed7-ad721cce47f3.png)

This should resolve #7295 
"
1212414562,[Achievements] add correct tag,knyghtmare,2023-01-21 18:25:46+00:00,2023-01-21 18:54:09+00:00,"{'Campaign (any)': 1, 'Achievements': 1}","it's `[set_achievement]` (in the Lua file)

Fixes #7305 "
1212397576,HttT: Achievements (Full Set),knyghtmare,2023-01-21 16:59:12+00:00,2024-08-01 16:20:32+00:00,"{'Enhancement': 1, 'Postponed': 1, 'Graphics': 1, 'Achievements': 1, 'Campaign HttT': 1}","Closes #7258 
Will do this in parts and all. So draft for now"
1212270770,"bi: Re-add screen dpi report line, add information on the renderer setup",irydacea,2023-01-21 04:11:21+00:00,2023-01-23 19:55:21+00:00,{'Engine': 1},"This patchset re-adds a clipboard report line for the Game Version dialog showing the game screen's DPI like in 1.16. This particular bit was dropped by mesilliac in the middle of an architectural change to how DPI is handled in the game, however it really shouldn't have been part of the removal given that it's meant to be diagnostic information for developer use when processing bug reports from players.

Additionally, it adds new information on the renderer in use including its name (e.g. ""metal"" on macOS, ""direct3d"" on Windows), whether it's a software rasteriser (indicated by ""sw""), whether it's hardware accelerated (indicated by ""hw""), whether VSync is enabled, and the maximum renderer texture size."
1212266879,bi: Fix --report SIGSEGV caused by uninitialised video,irydacea,2023-01-21 03:54:56+00:00,2023-01-23 19:54:07+00:00,"{'Bug': 1, 'Engine': 1}","There is currently a bug in master causing `--report` to raise a segmentation fault because of an attempt to dereference a null pointer to the game window to check the game's display configuration.

At some point in 1.17.x, the check for whether the game window was null disappeared. This brings it back by exposing a check through the `video` namespace so as to avoid piggybacking further on the `video::get_window()` function, which we are meant to avoid using."
1212236059,[1.16] Fix crash in scenario editor when placing units,stevecotton,2023-01-21 01:31:42+00:00,2023-01-22 01:33:17+00:00,{'Units': 1},"The previous bugfix fixed a crash when loading savegames with units whose abilities accessed the map while the display_context was still being constructed, however it reintroduced a bug in the scenario editor. Using the unit tool always crashed when adding any unit.

This commit uses 4d1fc268b1's code path whenever possible, however it falls back to 6a21fdc675's code path when 4d1fc268b1 would assert. In practise one path is used in game and the other is used in the scenario editor, but doing the logic in this way ensures that any edge cases are going to affect the scenario editor rather than the game itself."
1210926074,units: Limit energy bar sizes to the game tile size,irydacea,2023-01-20 00:24:09+00:00,2023-01-20 10:17:23+00:00,"{'UI': 1, 'Units': 1}","Fixes #7171.

Because of the move to hardware rendering in commit afd6baa7cf1685610c72305f5c9f989078462dff, some relevant info was lost that was previously used to limit bar height in particular.

This patch re-adds a dimension check and additionally ensures that the bar width doesn't exceed the tile size either.

**Before**
<img width=""624"" alt=""Screenshot_2023-01-19_at_20 15 43"" src=""https://user-images.githubusercontent.com/489895/213590901-44e7d93e-275a-4f54-85d3-a997bb0321c3.png"">

**After**
<img width=""380"" alt=""Screenshot_2023-01-19_at_21 22 12"" src=""https://user-images.githubusercontent.com/489895/213591142-e41a0c63-6311-443f-bf63-a2ab6e4c13c8.png"">

**Note:**

This is probably not 1:1 equivalent to the check done in past stable series. However, it does ensure that the bars do not exceed the tile size at the current zoom level, so it works in practice and solves the issue at hand. Right now drawing bars that exceed the tile area is generally a bad idea anyway and leads to graphical glitches when mousing over adjacent tiles."
1210908148,Remove hp_bar_scaling and xp_bar_scaling from [unit] schema,ProditorMagnus,2023-01-19 23:56:11+00:00,2023-02-12 16:11:06+00:00,{'Schema': 1},#2913
1210134260,"[1.16] HttT S03: Rewrite intro, hint about training troops for S06",stevecotton,2023-01-19 14:18:18+00:00,2023-01-20 01:49:12+00:00,"{'Campaign (any)': 1, 'Prose': 1}","Backport of #7214, simple cherry-pick with nothing to fix up afterwards.

The island gives the player two fronts to progress on, and it's early enough to give the player time to prepare for the SoE. Hint to them about improving their recall list.

When trying to add that hint as a single-line change to the dialogue, I reviewed the existing text and felt it didn't flow well. Reading the feedback thread, Delfador should have more emotion about finding his childhood home overrun; however I've gone for practical thoughts first.

The hint isn't #ifdef to only appear on easy, because the text wouldn't flow without it - take that line out and it goes from ""there are more orcs than I thought"" to ""we must fight these orcs, who aren't the ones at the SoE"". Also, players who are already doing XP management can feel knowledgeable when they see it.

(cherry picked from commit 9f780903abfa592752cb02c767a4ef5992f6f9c7)"
1201352407,"Fix indent on unit tests, and make the CI check it",stevecotton,2023-01-18 08:56:50+00:00,2023-01-20 01:28:54+00:00,"{'Unit Tests': 1, 'WML Tools': 1, 'CI': 1}","The whole data/test directory was excluded from the CI's indentation check.
Two of the commits in this PR fix the indentation in some of the tests, and
then the final commit reduces the exclusion list to only

* data/test/scenarios/cve_tests/
* data/test/scenarios/lua_tests/
* data/test/scenarios/wml_tests/TerrainWML/

Exclude cve_tests because of the binary file that's masquerading as a .cfg;
I think it's correct to exclude the whole directory because any new tests
added there might also use weird edge cases in the parsing.

Exclude lua_tests as a ""keep this PR small"" thing. We should fix the bugs in
wmlindent, but I don't want to take on that work.

The exclusion of TerrainWML is again because I don't want to take on the work
of working out whether it's problems with terrain masks or bugs in wmlindent.

Most of the files in those directories wouldn't be changed, the ones that would
(or would trigger an error about not being valid UTF-8 ) are:

* data/test/scenarios/cve_tests/test_cve_2018_1999023_2.cfg
* data/test/scenarios/lua_tests/functional/lua_functional.cfg
* data/test/scenarios/lua_tests/wesnoth/map/mapgen_filter.cfg
* data/test/scenarios/wml_tests/TerrainWML/test_terrain_mask.cfg

Notes on specific files:
---

For the unit tests using sync.evaluate_single or sync.evaluate_multiple, I'm
using two wmlindent bugs against each other, putting two opening statements on
the same line to balance two closing statements on the same line. However, the
unit tests ought to be code that can be cut & pasted elsewhere without causing
indentation problems, and this is simpler than fixing wmlindent's Lua parsing.

There are two cve_2018_1999023 tests. The other one needs to be treated as a
binary file, but the one changed here is plain text that loads its attack from
a separate file.

The change in start_position_generic.cfg doesn't seem good, but it's not
particularly bad and it's what wmlindent currently does."
1199607263,[1.16] Bump vcpkg baseline to use a non-obsolete version of libtool,stevecotton,2023-01-16 23:53:49+00:00,2023-01-17 16:36:05+00:00,{'Building': 1},"The vital commit is fd766eba2b4cf59c7123d46189be373e2cee959d, but I'm taking the most recent version of vcpkg as the new baseline because it might as well use the latest."
1199605626,Bump vcpkg baseline to use a non-obsolete version of libtool,stevecotton,2023-01-16 23:49:55+00:00,2023-01-17 13:09:47+00:00,{'Building': 1},"The vital commit is fd766eba2b4cf59c7123d46189be373e2cee959d, but I'm taking the most recent version of vcpkg as the new baseline because it might as well use the latest."
1198470802,[LoW] fix scenario count inconsistency,knyghtmare,2023-01-16 05:30:30+00:00,2023-01-20 01:50:05+00:00,{'Campaign (any)': 1},Closes #7218
1198467289,WC: fix abnormal commander mechanic,knyghtmare,2023-01-16 05:24:00+00:00,2023-02-12 16:21:28+00:00,"{'Campaign (any)': 1, 'MP': 1}",Fixes #7264 
1196688954,Test fire_event of kill unit on recall list,Toranks,2023-01-13 12:58:13+00:00,2023-01-16 12:25:09+00:00,{'Unit Tests': 1},"This test checks if the last_breath and die events are triggered when a unit on the recall list is killed.
As you can see, with **equals yes** on all variables Alice does not trigger the last_breath and die events when she is on the recall list. This is the default behavior on 1.16 and 1.17
I send a version of the test that is supposed to pass, with Alice not firing the event.

![imagen](https://user-images.githubusercontent.com/40789364/212325587-e83f4ee1-97ed-40a5-be94-d5edb0be49ba.png)
![imagen](https://user-images.githubusercontent.com/40789364/212325621-eb7ae7ea-ff4d-4d4e-9b40-6f0301e69753.png)


Note: Sorry for sending the pull request again, since in the previous one I used a fork, and it is better to use a branch, since I cannot create more than one fork.
https://github.com/wesnoth/wesnoth/pull/7272"
1196680816,SotBE S14 Grüü apparition fixed,Toranks,2023-01-13 12:50:08+00:00,2023-01-26 06:36:39+00:00,{'Campaign (any)': 1},"This, instead of killing Grüü, moves him along with the others to participate in the conversation, and also switches him to side 1 (this side is temporary and only for narrative purposes, later on turn 7 he switches to side 4 again).
Grüü is correctly stored on the variable when the conversation ends, and restored later on turn 7."
1196653776,SotBE S14 Grüü apparition fixed,Toranks,2023-01-13 12:23:08+00:00,2023-01-13 12:41:08+00:00,{'Campaign (any)': 1},"This, instead of killing Grüü, moves him along with the others to participate in the conversation, and also switches him to side 1 (this side is temporary and only for narrative purposes, later on turn 7 he switches to side 4 again).
Grüü is correctly stored on the variable when the conversation starts, and restored later on turn 7."
1195636151,Enable logging to file by default.,Pentarctagon,2023-01-12 17:03:47+00:00,2023-01-13 11:51:03+00:00,"{'Docs': 1, 'Command Line': 1, 'Engine': 1}",
1195575112,[1.16] Reduce log spam about the postponed removal of the SPECIAL_NOTES macro,stevecotton,2023-01-12 16:17:33+00:00,2023-01-24 00:50:22+00:00,{'Help': 1},"This is a partial cherry-pick of b9e4fdffb46b9933a602ed2601b051c642e7ba07, merely reflecting that the removal has been postponed from 1.17 to 1.19 along with updating some outdated comments.

The motivation for backporting this is to make other warnings that are printed to stdout/stderr more visible, instead of being scrolled offscreen by the SPECIAL_NOTES messages."
1195565323,"[1.16] Show id in ""skipping duplicate variation"" warning",stevecotton,2023-01-12 16:12:22+00:00,2023-01-17 20:02:54+00:00,{'Units': 1},"The strings involved aren't translatable, so this is taking a message that's already only printed in English, and making it more helpful. (It probably should be translatable, but this isn't making anything worse).

Add a useful identifier to the message

    error config: Skipping duplicate unit variation ID: ''

This warning is generally shown because the variation_id is completely missing, and so the message appeared as above, without any hint of which unit was causing the problem.

In contrast to 19a5ce83's warning, this one is printed multiple times to stdout even if the messages are identical; therefore backporting this to 1.16 seems reasonable.

(cherry picked from commit 323ce6ec260f29f81c4cb4a703cc2202610db982)"
1195171990,[Units] add correct textdomain to Grand Dragonfly,knyghtmare,2023-01-12 11:32:47+00:00,2023-01-12 14:00:49+00:00,{'Units': 1},"Grand Dragonfly has been the using the textdomain of the UMC ""Coaltion of Swamp Creatures: big Battle 1"""
1194908593,Units: Giant Ant advances to Soldier Ant,knyghtmare,2023-01-12 07:52:28+00:00,2023-02-12 16:21:46+00:00,"{'Enhancement': 1, 'Units': 1}","Adds the missing advancement, unless there is argument that soldier ants and worker (Giant) ants should be different unit-lines as Darwinism goes."
1194840955,Add start script to force the correct arch.,Pentarctagon,2023-01-12 06:32:50+00:00,2023-01-27 06:11:56+00:00,"{'Campaign (any)': 1, 'UI': 1, 'Lua API': 1}","Since Steam itself is not a native ARM app, for macOS it launches Wesnoth using the x86_64 version instead of the ARM version. This script forces the correct arch to be used which leads to improved performance (especially for 1.16) when using ARM-based Macs.

---

@hrubymar10 - The main question I have is where this file needs to be in order for it to work with how Wesnoth is packaged. I assume putting it in the repository root won't actually work.
@irydacea Do you know if additional arguments can be provided to `""The Battle for Wesnoth""` when used with the `arch` command?"
1194835750,Test fire_event of kill unit on recall list,Toranks,2023-01-12 06:26:04+00:00,2023-01-13 12:36:37+00:00,{'Unit Tests': 1},"This test checks if the last_breath and die events are triggered when a unit on the recall list is killed.
As you can see, Alice does not trigger the last_breath and die events when she is on the recall list. I don't know if it's an expected behavior or not.

Edit: Changed conditions to make the test succeed instead of fail

![imagen](https://user-images.githubusercontent.com/40789364/211993335-762376d7-8724-44d7-9fa8-694eef3d2401.png)
![imagen](https://user-images.githubusercontent.com/40789364/211993369-37c5d8d6-88e2-4bc9-afa9-57b9c825190f.png)
"
1192707305,change calculation rules so that add and sub are always used independently,newfrenchy83,2023-01-10 17:36:55+00:00,2024-09-08 12:16:28+00:00,"{'Unit Tests': 1, 'Units': 1}","
when two special weapons use multiply and divide with the same id, both operations are used, isn't that so why should it be different with 'add' and 'sub' where it's the larger value that is used (if asub=value_sub and add=value_add are used and value_sub>value_add then value_sub is used). This logic is counter-intuitive. that multiplication/division is applied to (base_value +- add/sub) is understandable but not this discrimination. For me add and sub should still be usable; even if it means changing the rules, but I think we will gain clarity in the end."
1192148638,"Fix the indentation in the ""special_calculations"" test",stevecotton,2023-01-10 10:31:33+00:00,2023-01-10 11:25:17+00:00,{'Unit Tests': 1},"Just a whitespace change, because it can't be used as a reference to cut & paste from when it's incorrectly indented."
1191363089,Add ability to allow secondary authors to upload an add-on.,Pentarctagon,2023-01-09 19:56:37+00:00,2023-01-11 16:21:55+00:00,"{'MP': 1, 'UI': 1, 'Services': 1, 'Add-ons': 1}","The secondary_authors attribute is a comma-delimited list of forum accounts that can also upload updates to an add-on. Secondary authors can't change the primary/secondary authors and can't delete the add-on.

The primary author can also make someone else the primary author by:
* Putting their username in the secondary_authors attribute
* Putting someone else's username in the author attribute
* Uploading the add-on while selecting themselves

This works since they are still (until the upload is done) the primary author in the database, so they are allowed to change the authors list, including in this case.

---

Scenarios tested locally:
* upload as primary author, no secondary authors - **succeeds**, only primary author row exists
* upload as primary author, has secondary authors - **succeeds**, primary author row and secondary author rows exists
* upload as primary author, adds a new secondary author and removes another - **succeeds**, table reflects this change
* upload as primary author with changing primary author - **succeeds**, table reflects primary author and secondary author swapped
* upload as secondary author with changing primary author - **succeeds**, addon_authors is unchanged
* upload with non-existing primary author - **fails**
* upload with non-existing secondary author - **fails**
* upload with author as an existing user that is not the primary author - **fails**
* upload with author as an existing user that is not a secondary author - **fails**
* delete addon as secondary author - **fails**
* delete addon as primary author - **succeeds**, author rows deleted
* delete addon as non-existing primary author - **fails**
* delete addon as non-existing secondary author - **fails**
* delete by author as an existing user that is not the primary - **fails**
* delete by author as an existing user that is not a secondary author - **fails**
* delete by former secondary author after changing them to primary author - **succeeds**"
1189887541,Orb color preferences dialog layout and tooltip,stevecotton,2023-01-08 16:40:29+00:00,2023-01-14 17:10:14+00:00,"{'Backport': 1, 'UI': 1}","Add some spacing to make it clearer what is grouped with what, move the disengage orb's setting to be part of the partial orb's group, and add tooltip.

There's only one tooltip so far, does anyone feel the ""Show ... orb"" checkboxes should have them too?

This dialog uses checkbox labels as section headers to indicate what the rows of colors refer to. This commit doesn't change that, but it makes the grouping clearer. Actual section headers would take additional space and probably not look any better.

The intention would be to backport it, and then backport a rebased PR #7189 on top of it. The image below shows the intended final destination, the current PR doesn't include the ""During ally's turn, use a two-colored orb with status"" line.
![image](https://user-images.githubusercontent.com/101462/211196159-d62eae8d-3f29-4200-a94c-aad22f02cd2d.png)"
1188414847,Rename database column SOURCE to ADDON_ID.,Pentarctagon,2023-01-06 16:54:27+00:00,2023-01-07 01:59:27+00:00,"{'MP': 1, 'Services': 1, 'Add-ons': 1}",
1182233635,SotA: change textdomain of zombie-utils.cfg,Toranks,2023-01-02 02:45:52+00:00,2023-01-02 03:06:37+00:00,"{'Backport': 1, 'Campaign (any)': 1}","Weapon specials usually are on wesnoth-help texdomain, as this case.
Before, appears on english on all languages."
1181622665,1.17 generalize the birds race,doofus-01,2023-01-01 04:35:30+00:00,2023-05-06 11:19:23+00:00,"{'Graphics': 1, 'Units': 1}","Changing the ""falcon"" race to ""bird"" is the biggest change, might need some sort of compatibility code.

As far as new units, the Raven is WIP.  Maybe there could be an ostrich/emu for something related to the Chocobone, or maybe that's just best left to fables and history."
1181548887,"1.17 - new explode ability, given to firebomb ant",doofus-01,2022-12-31 23:34:24+00:00,2023-04-30 00:33:23+00:00,"{'Units': 1, 'Lua API': 1, 'Schema': 1}","The ant's animation is a bit half-assed, and the value probably needs adjusting, but the general idea is there."
1181464262,LoW: Make gold carry-over consistent with objectives,Wedge009,2022-12-31 13:47:46+00:00,2023-01-19 20:00:47+00:00,{'Campaign (any)': 1},Resolves #7230
1181239533,Allow abilities.cpp to access units and teams earlier during play_controller::init,stevecotton,2022-12-30 21:36:45+00:00,2022-12-31 01:20:42+00:00,"{'Bug': 1, 'Units': 1, 'Engine': 1}","Backport of #7245, needed some manual edits during the backport.

Partially reverts 6a21fdc6750a8342846ef18248517808316c4118
Fixes #5643
Fixes #7238

There's a bunch of global things that can be accessed either via global pointers in the `resource` namespace, or via `display::get_singleton()`. The singleton and these global pointers are set up in `play_controller::init`, however there's a section where things are available via the global pointers but the `display` singleton doesn't exist yet. During that time, checking whether an ability is active can crash the game.

Removing the global pointers is a good goal, but detouring through a GUI class to access the data causes its own problems.

The ""has already been confirmed valid by both callers"" comment is replaced with an assert, because there's currently at least three callers.

(cherry picked from commit 7ddf691e13885d1d5fb82a3cd4ad15c6c8d0ab0b)"
1181080887,Allow abilities.cpp to access units and teams earlier during play_controller::init,stevecotton,2022-12-30 17:54:56+00:00,2022-12-30 21:08:32+00:00,"{'Bug': 1, 'Backport': 1, 'Units': 1, 'Engine': 1}","Partially reverts 6a21fdc6750a8342846ef18248517808316c4118
Fixes #5643
Fixes #7238

There's a bunch of global things that can be accessed either via global pointers in the `resource` namespace, or via `display::get_singleton()`. The singleton and these global pointers are set up in `play_controller::init`, however there's a section where things are available via the global pointers but the `display` singleton doesn't exist yet. During that time, checking whether an ability is active can crash the game.

Removing the global pointers is a good goal, but detouring through a GUI class to access the data causes its own problems.

The ""has already been confirmed valid by both callers"" comment is replaced with an assert, because there's currently at least three callers."
1180668341,1.17 more fauna work,doofus-01,2022-12-30 03:45:52+00:00,2022-12-31 13:46:16+00:00,"{'Graphics': 1, 'Units': 1}","I've been slowly making my way through WoF, which makes use of random fauna.  I've also got the upgrade in #7228 in mind.  Also, also, also, #7236 made me realize there is a carbon-copy zombie scorpion variation that should not be a model for the future.

So, with all that in mind, I think we could use a little more variety and reorganization within existing monster/animal races (which could be renamed, Falcons -> Birds/Avians for example).

In this PR, I plan to add some ants and a raven, and get it over with in a couple days.  I know, the elephant in the room is actually a firedragon, and I hope to address that later this weekend, but it's not here."
1180372894,Add unit tests for weapon-special calculations,stevecotton,2022-12-29 16:16:02+00:00,2022-12-29 20:12:39+00:00,"{'Docs': 1, 'Unit Tests': 1}","Backport of #7240.

Covers the math for [attack]add=, [attack]divide=, [attack]multiply= and [attack]sub=.

* 5 + 2 = 7
* 5 - 3 = 2
* 5 + 2 - 3 = 2. Yes it does, that's half of why this unit test exists ...
* 5 + 2 + 3 = 8
* 5 + 3 + 2 = 8
* 5 + 2 - (-3) = 7
* 3 * 3.34 = 10
* 3 * 3.334 = 9. ... and that's the other half of why this unit test exists.

(cherry picked from commit e28f29b4ac16d8717637cc69b58fc830b5469311)"
1179840655,Add unit tests for weapon-special calculations,stevecotton,2022-12-29 00:51:41+00:00,2022-12-29 14:40:01+00:00,"{'Docs': 1, 'Unit Tests': 1}","Covers the math for [attack]add=, [attack]divide=, [attack]multiply= and [attack]sub=. The behavior is the same in 1.16.

* 5 + 2 = 7
* 5 - 3 = 2
* 5 + 2 - 3 = 2. Yes it does, that's half of why this unit test exists ...
* 5 + 2 + 3 = 8
* 5 + 3 + 2 = 8
* 5 + 2 - (-3) = 7
* 3 * 3.34 = 10
* 3 * 3.334 = 9. ... and that's the other half of why this unit test exists.

@newfrenchy83 sorry, reviewing your PRs got sidetracked into discovering what the math rules are. I'll ask in the IRC channel if we can add you to a group that lets you be added to the ""reviewers"" list."
1179751436,Validate _server.pbl files on load against the schema,CelticMinstrel,2022-12-28 21:08:36+00:00,2023-01-26 00:10:41+00:00,"{'UI': 1, 'Add-ons': 1, 'Schema': 1}",
1179147514,Add basic achievements functionality.,Pentarctagon,2022-12-28 07:18:20+00:00,2023-01-21 16:32:45+00:00,"{'macOS': 1, 'Campaign (any)': 1, 'MP': 1, 'Unit Tests': 1, 'UI': 1, 'Lua API': 1, 'Building': 1, 'Input': 1, 'Schema': 1}","This reads the mainline achievements.cfg and then all the achievements of each installed add-on.

This is intentionally handled separately from other WML loading so that: a) All achievements and their status are able to be displayed on the main menu right after Wesnoth starts and regardless of which add-ons are active. b) Add-ons can add additional achievements to other content, whether UMC or mainline. For example, a modification that adds more achievements for mainline campaigns.

Marking something as achieved is handled by the new [set_achieved] tag and whether an achievement has been completed can be checked via [has_achievement].

There is no attempt to prevent people from manually editing which achievements they've accomplished.

NOTE: These are *not* in any way related to Steam achievements!

---

In-game popup example:
![completed-ingame](https://user-images.githubusercontent.com/3030250/213015244-636a28ed-4aee-4f80-9234-ea56faaeefab.png)

Completed in the dialog:
![completed-inlist](https://user-images.githubusercontent.com/3030250/213015284-7625c760-a419-41f6-937a-9d38045f5899.png)

Not completed:
![not-completed](https://user-images.githubusercontent.com/3030250/213015323-c009edc8-927b-475e-b7b4-ca97fc7f2e04.png)

Hidden:
![hidden](https://user-images.githubusercontent.com/3030250/213015341-0c8ffce3-d4af-461e-a22d-30ba5ead6d77.png)
"
1178987184,1.17 move Sand Scuttler out of scorpion,doofus-01,2022-12-28 01:02:17+00:00,2022-12-30 04:41:22+00:00,"{'Campaign (any)': 1, 'MP': 1, 'Units': 1}","The potential unit race help menu tree rearrangements in #7228 reminded me how terrible the ""variations"" look there (#6011), and it's really only the zombies and the sand scuttler that use the feature, at least for core.  It's not super clear how to deal with the zombies, but the sand scuttler really stands out and can be more easily fixed/removed.

I used `[base_unit]` in case there was some reason to have the Giant Scorpion and Sand Scuttler remain linked."
1178950239,1.17 minor updates to monsters,doofus-01,2022-12-27 23:25:17+00:00,2022-12-28 01:03:10+00:00,"{'Graphics': 1, 'Units': 1}",update to kraken portrait and added  a few animation frames to elder falcon
1178121932,1.17 - make north-breathing drakes face se instead of s,doofus-01,2022-12-26 23:51:19+00:00,2022-12-27 01:13:53+00:00,"{'Graphics': 1, 'Units': 1}","Drakes attacking to the north with their fire breath face south and bend over, is this some sort of long running joke?
Using the se frames instead still doesn't look great, but it's not quite as bad."
1177967968,1.17 - get elevation markers out of the mini-map,doofus-01,2022-12-26 18:32:47+00:00,2022-12-26 19:37:57+00:00,{'Terrain': 1},fixes #7231 
1177162601,1.17 - add forgotten kraken ink projectile images,doofus-01,2022-12-24 23:30:05+00:00,2022-12-25 01:54:55+00:00,{'Graphics': 1},These should have been in #7152.
1177105356,Show races as nestable subfolders in help,stevecotton,2022-12-24 16:10:43+00:00,2023-01-18 14:34:23+00:00,"{'UI': 1, 'Units': 1, 'Help': 1}","Edit: no longer just a prototype.

Prototype: This was the original idea for visualising [race]help_taxonomy=, it didn't feel right to me back in September 2020, but I can't remember why it didn't. That idea is now being discussed in https://r.wesnoth.org/t56522 , so I'm opening a PR to share the implementation."
1176687591,Ignore duplicate primary key errors for game_content_info table.,Pentarctagon,2022-12-23 18:37:08+00:00,2023-01-06 16:22:04+00:00,"{'MP': 1, 'Services': 1, 'Add-ons': 1}","The cause is that somehow, during regular play, MP campaigns can end up with duplicate values in the [content] data for each [addon]. A very similar issue was fixed in 6c980d12dcd56ccd16ff8b7150cd15ef19f0a821, but there's apparently some other way to trigger it that I haven't been able to reproduce. Since the error itself is harmless, it'll just be ignored server-side to avoid the spurious errors in the server log file."
1174160063,[1.17] extend ability removal with remove_ability by attributes add a [overwrite_specials] abilities for replace deprecated overwrite_specials attribute,newfrenchy83,2022-12-21 19:42:47+00:00,2023-02-15 11:35:23+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1}",
1174060709,[1.16] Handle out-of-bounds side numbers in Lua's sync.evaluate_multiple,stevecotton,2022-12-21 18:04:38+00:00,2022-12-24 15:48:49+00:00,"{'Bug': 1, 'Unit Tests': 1, 'Lua API': 1}","Backport of #7197.

Change the C++ to show a Lua error instead of crashing with an assert.

Cherry picked from commit a9d5c6ac6d8364f2fb3a6cd24dc55593d5b6f924, with a changelog entry added."
1173290763,[LoW] S3: fix mismatched coords of Urudin retreat,knyghtmare,2022-12-21 07:46:35+00:00,2023-01-20 10:14:56+00:00,"{'Enhancement': 1, 'Backport': 1, 'Ready for testing': 1, 'Campaign (any)': 1}","Urudin the Slayer is supposed to move to 12,4 (next to the castle of one of the warlords), instead he is set to move to 20,6 which makes little sense. The event of Urudin moving at 12,4 was supposedly never triggered.

Reported on Discord

> Hi
In the file 03_Kalian_under_Attack.cfg, the coordinates of line 200 and 454/455 are not the same. Is that just a typo or intentional?
Steam 1.16.6"
1173272621,[Campaign] [WoF] Enable Saurian Spearthrower,knyghtmare,2022-12-21 07:26:38+00:00,2022-12-31 05:45:49+00:00,"{'Enhancement': 1, 'Campaign (any)': 1, 'Units': 1}","Since the unit has been (finally) added to core, I believe it should be made be available for players in _Winds of Fate_."
1170043718,1.17 - dunefolk rover portrait,doofus-01,2022-12-19 01:33:54+00:00,2022-12-26 01:53:50+00:00,"{'Graphics': 1, 'Units': 1}","This was meant for the rover, extending it to the explorer might be a stretch."
1169347721,"HttT S03: Rewrite intro text, hint about training troops for S06",stevecotton,2022-12-17 09:30:35+00:00,2023-01-03 22:32:05+00:00,"{'Campaign (any)': 1, 'Prose': 1}","The Isle of Alduin doesn't have much dialogue at the start, it's a map where the island gives the player two fronts to progress on, and it's early enough to give the player time to prepare for the SoE."
1164908771,SoF: Convert Ias terrain codes missed in #7042,Wedge009,2022-12-14 10:54:45+00:00,2022-12-16 07:54:36+00:00,"{'Campaign (any)': 1, 'Terrain': 1}","Resolves #7210

I think this is all the remaining instances of `Ias*` codes, aside from code specifically to mark or handle deprecated terrains.

At least I can confirm SoF S9 loads properly with this change."
1164062964,SoF S9: Map `Isay` to `Iasy` code swap,knyghtmare,2022-12-14 01:17:24+00:00,2022-12-14 08:34:40+00:00,{'Campaign (any)': 1},Closes #7210 
1160526625,Update deprecation but postpone removal of the SPECIAL_NOTES macro,stevecotton,2022-12-12 10:28:59+00:00,2022-12-29 15:53:13+00:00,{'WML': 1},"Units still using this in their descriptions will have the player-visible header change from ""Special Notes:"" to ""Special Notes (1.14-style, please update to the new list format)"".

The SPECIAL_NOTES macro was originally removed early in the 1.17 dev cycle. That removal was reverted and postponed in the roadmap until Jan 2023, on the grounds that it's a lot easier to test 1.17 when the big add-ons from 1.16 can run on it.

In 1.16, UMC that hasn't upgraded yet already has a cosmetic bug - the help pages of units still using the {SPECIAL_NOTES} macro will include duplicate notes (assuming the expected usage of {SPECIAL_NOTES} as a heading in [unit_type]description=, which is followed by old-style notes). These are minor cosmetic bugs, which are expected to be removed as UMC gets updated.

That leaves the issue of what to do with the deprecated macro in 1.18. My feeling is that we can easily continue to support the macro, albeit with the cosmetic bug, so we should keep it for 1.18. However we could make it clearer that the duplicated notes should be removed from the UMC.

This also removes some docs about NOTE_*s, those macros have already been removed after being deprecated in 3568b5ff66ece00ec09f40059e552123f356d962.

Example help page of a unit still using this macro, but using mainline abilities that already include the special note. We can't simply remove all old-style special notes, because UMC abilities of affected units probably haven't been updated to include the notes in the ability.
![image](https://user-images.githubusercontent.com/101462/207022159-828b7c5a-2572-4859-aff6-6b6334529628.png)
"
1158431145,1.17 some random Loyalists sprite updates,doofus-01,2022-12-11 02:24:07+00:00,2022-12-26 05:12:19+00:00,"{'Graphics': 1, 'Units': 1}","This is what I intend to accomplish here.  It won't completely finish everything, but you have to eat the elephant a piece at a time.
- [x] Spearman
- [x] Cavalryman (at least an animation or two)
- [x] Grand Knight (at least an animation or two)
- [x] General"
1155233838,Address some minor nits in gettext.cpp,cooljeanius,2022-12-09 03:08:50+00:00,2022-12-11 00:53:00+00:00,{},This PR is pretty simple; it fixes issue #3868 and addresses a review comment that @CelticMinstrel had left in b780da4.
1153517771,wmllint: convert `^Uf` to `^Tf`,knyghtmare,2022-12-08 08:10:18+00:00,2022-12-16 02:16:22+00:00,"{'Enhancement': 1, 'WML Tools': 1, 'Terrain': 1}","## Summary

`^Uf` has been deprecated since 1.15.x
`^Tf` is the new and current one."
1153499178,[MP] Change Elevation Test Scenario Name and Desc,knyghtmare,2022-12-08 07:58:34+00:00,2022-12-16 06:50:47+00:00,{'MP': 1},"Currently, the name of this scenario is too long, and it causes unattractive-looking width expansion of the MP scenario lists. Thus, it should be enclosed in `DEBUG_MODE` like the other three test scenarios in the MP scenarios folder. "
1152522640,Reorganize unit tests.,Pentarctagon,2022-12-07 22:03:21+00:00,2022-12-21 18:30:04+00:00,"{'AI': 1, 'Unit Tests': 1, 'Editor': 1}","---

Reorganizes the tests to directories following the layout of https://wiki.wesnoth.org/ReferenceWML and https://wiki.wesnoth.org/LuaAPI.

Draft for now since some cleanup is still needed for the actual tests themselves."
1152304588,Exclude nonvillages from outer_villages array,ProditorMagnus,2022-12-07 19:53:22+00:00,2022-12-27 07:16:50+00:00,"{'Ready for testing': 1, 'Campaign (any)': 1}","Fixes #7202 

@nemaara could confirm that Gd^Vdt, Rd^Vdt, Re^Vda are intended to be included.

V terrains in that map:
Dd^Vda
Dd^Vdr
Dd^Vdt
Ds^Vda
Ds^Vdr
Ds^Vdt
Gd^Vdt
Rd^Vdt
Re^Vda"
1152137957,Checksums: accept 1.16's checksums during replays,stevecotton,2022-12-07 18:11:36+00:00,2023-01-06 15:00:57+00:00,"{'Replays': 1, 'Units': 1, 'Engine': 1}","Looking at the discussion in #7188, I thought it wouldn't be hard to have a fallback which only triggers when the normal checksum fails, and sees if the unit passes a 1.16 style checksum instead. Took a bit longer than expected, but looks like a reasonable solution to that problem without adding a maintenance burden.

This will also accept them during multiplayer matches, but it will still warn if the unit's stats have changed. When using the new option, the checksum includes data that has been ignored since 93fe5607a658c74b987."
1151378180,[1.16] Inspect console: fix infinite loop in pagination,stevecotton,2022-12-07 11:46:18+00:00,2022-12-07 16:15:36+00:00,"{'Bug': 1, 'UI': 1}","Backport of #1795, will merge when CI passes.

When given a string that includes newlines but doesn't end with a newline, the old code would get stuck in an infinite loop.

Fixes #7194.

(cherry picked from commit b5ff5c3ddc706f1281bbbe2f235b16c4b00f92db)"
1149514539,Handle out-of-bounds side numbers in Lua's sync.evaluate_multiple,stevecotton,2022-12-06 17:34:52+00:00,2022-12-16 15:40:46+00:00,"{'Bug': 1, 'Backport': 1, 'Unit Tests': 1, 'Lua API': 1}","Change the C++ to show a Lua error instead of crashing with an assert.

There's no issue logged for this, but this adds a unit-test for reproducing the crash.

The code formatting is consistent with the rest of the file; the entire file should be run through clang-format, but I don't want to do that on a change that should be backported.

I haven't included a changelog entry, I'm on the borderline of whether it should have one or not."
1148290234,WML: Adjust the weapon selection logic for [kill],CelticMinstrel,2022-12-06 06:55:41+00:00,2022-12-24 15:52:57+00:00,{'Lua API': 1},"The previous logic simply did not make sense, especially for the secondary weapon. For example, it would ignore the secondary weapon specification if the primary weapon was not found on the secondary unit, which does not make any sense.

The cases that this changes are:
- There is a secondary unit and a primary attack, but no matching attack was found. Previously it would use the default, now it pretends that attack exists.
- There is a secondary attack specified, but no primary attack, either because it was unspecified or because it didn't match any attack on the secondary unit

In both these cases, the animation runs as if a matching attack exists, rather than using no attack and choosing the default animation."
1147673714,Inspect console: fix infinite loop in pagination,stevecotton,2022-12-05 23:44:10+00:00,2022-12-07 08:15:52+00:00,"{'Bug': 1, 'Backport': 1, 'UI': 1}","When given a string that includes newlines but doesn't end with a newline, the old code would get stuck in an infinite loop.

Fixes #7194"
1145452701,1.17 elevated terrain Help Topic,doofus-01,2022-12-04 23:41:29+00:00,2022-12-26 13:13:55+00:00,"{'Campaign (any)': 1, 'Editor': 1, 'Terrain': 1}","The terrain elevation feature is different than the usual terrain graphics.  So this is for a help topic in the ""Map and Scenario Editor->Terrain Editor"" tree."
1145313950,Avoid throwing exceptions internally to lexical_cast when parsing an empty string,CelticMinstrel,2022-12-04 20:29:36+00:00,2022-12-06 06:48:54+00:00,{},"The motivation for this is that `lexical_cast` is called very frequently, even to the point of being called repeatedly in the main loop. By relying on exceptions internally, it becomes a hindrance to debugging.

This PR is mainly opened solely for CI purposes. Unless there are objections before the CI successfully completes, I will merge it immediately."
1145186853,fixes #7180,doofus-01,2022-12-04 17:33:48+00:00,2022-12-04 19:52:53+00:00,{'Terrain': 1},
1144072010,Use two-color orbs for allies' units,stevecotton,2022-12-03 06:22:45+00:00,2023-01-17 17:06:46+00:00,"{'Enhancement': 1, 'Backport': 1, 'UI': 1, 'Units': 1}","They no longer look the same as the player's own units. Possible fix for #7108, and the plan is to backport this to 1.16 (it's improving the UI, not revealing more information that would be shown to players of earlier 1.16 versions).

This probably doesn't need a change to the in-game help, at least for the en_US version of the documentation. The current text in data/core/help.cfg is:

* Blue for allied units, except during that ally's own turn.
* During the ally's own turn, their units will be shown with the colors showing whether the units can still move and attack; however their moves, and the corresponding orb changes, are delayed as explained in ""Shroud and Fog of War'.

The left castle shows what this PR does, the right castle shows the colors the other way round.
![allied_two_color_orbs](https://user-images.githubusercontent.com/101462/205427705-2d91c7fe-1b18-4b64-88f6-c9a2ebc139d6.png)"
1142791175,Add option to run a test based on replaying a specified save (feature #7029),demario-w,2022-12-02 06:10:16+00:00,2023-07-04 07:35:43+00:00,{'Replays': 1},"
There is no description for the new command line option to avoid breaking translation as the change was implemented for branch 1.16. But a recent change in src/game_launcher.cpp makes the code incompatible for that branch now (feature #7029).

--------
The path for the replay is relative to wesnoth save directory.

The solution is based on:

    - adding a command line option 'replay_test'
    - putting the code to replay a save from game_launcher::single_unit_test()
      in a standalone function game_launcher::replay_test()
    - calling that function if the option --replay_test is passed
    - defaulting to skip animation ('skip_replay' in the code) when running
      a test based on save ('is_unit_test', by using replay_test or matching
      the replay part of unit_test)
    - adding a parameter to not linger to replay_controller::replay_controller
      after the end of of the game
    - do not linger at the end when running a test based on save
      (no_linger=is_unit_test_)
    - if any OOS is encountered during replay, the replay stops and the game
      lingers

The command line option --replay_test has no description.

The compatibility with the various use cases for --unit_test should be checked."
1142421455,Language string duplicate removal,Kingofd,2022-12-01 21:00:26+00:00,2022-12-03 02:27:16+00:00,"{'Translations': 1, 'UI': 1, 'Add-ons': 1}","Attempts to fix this issue here: https://github.com/wesnoth/wesnoth/issues/7169
I just push the output of `langcode_to_string()` through another set, which removes duplicates of the display string."
1140959505,Document last batch of unit tests.,Pentarctagon,2022-11-30 22:42:48+00:00,2022-12-04 05:29:48+00:00,{'Unit Tests': 1},
1140691917,Just look for the toplevel dir tag,soliton-,2022-11-30 17:49:50+00:00,2022-12-14 08:24:55+00:00,{'Add-ons': 1},"""campaign_name"" is not an existing attribute in the given config anymore. An addon should only contain a single toplevel dir tag with the name of the addon anyway."
1140635155,Update used actions to avoid deprecated Node.js 12,soliton-,2022-11-30 16:56:41+00:00,2022-12-01 15:12:07+00:00,{'CI': 1},Fixes #7178.
1139511700,Pin comments chat,Kingofd,2022-11-29 20:42:31+00:00,2023-09-15 13:12:34+00:00,"{'MP': 1, 'UI': 1}","This is my first shot at the ""pinning comments"" functionality:
https://github.com/wesnoth/wesnoth/issues/6974

Open questions:

1. I need to overload the two functions I implement in `chat_events.hpp`, which I need for `chatbox.cpp` also in `menu_events.hpp` where they effectively are not doing anything. Maybe there is a better way of doing this
2. Still searching for a good place for a client after leaving a game to tell it to delete its logs. Otherwise the players will always have access to the last game's chat logs
"
1138827709,[1.16] Fix [special_note] duplication when unstoring units,stevecotton,2022-11-29 11:29:13+00:00,2022-11-29 15:41:09+00:00,"{'Unit Tests': 1, 'Units': 1}","Backport of #7157, fixes #7153. Will merge once the CI passes.

The movetype's special notes were becoming a new note for the individual unit.

Clean up the documentation on some of movetype's functions, as they had documentation in both the .hpp and the .cpp.

(cherry picked from commit 38fdf06fa9a17ff0995909d5f76309d65ac05a5c)"
1138528548,Change Twitter link to Mastodon link in README.md,cooljeanius,2022-11-29 07:05:33+00:00,2022-11-29 14:58:57+00:00,{'Docs': 1},"Pretty simple; since the project has announced a migration from Twitter to Mastodon, this updates the README to reflect it.
"
1137792667,gettext: fix build with Boost.Locale 1.81,sgn,2022-11-28 16:22:34+00:00,2022-11-28 20:38:54+00:00,{'Translations': 1},See https://github.com/boostorg/locale/pull/128/
1137585926,"Zoom-in using ""+""",Ferk,2022-11-28 13:56:51+00:00,2022-11-29 17:03:17+00:00,{'Input': 1},"This adds ""+"" for Zoom-in as an additional hotkey (without removing the previously set value, so ""="" would still work).

The ""="" key doesn't seem to work when pressing it from a keyboard layout such as German QWERTZ in Windows. It's also against the user's expectations that if we accidentally press on ""minus"" causing the map to zoom out, ""plus"" (typically the opposite operation to ""minus"") doesn't work. Someone who's new and hasn't checked the hotkeys screens might be frustrated if he can't figure out how to zoom back in.

I expect this is designed around the US keyboard layout, where the ""="" key is the same as ""+"" (without requiring ""Shift"") and it's right next to the ""-"" key. But this is not the case in every keyboard layout (eg. in QWERTZ you'd have to press Shift+0 for obtaining ""="" and as mentioned before, this doesn't seem to be picked up by the engine, so you can't really Zoom-in). Not even for those with a numeric keypad (which does have a ""+"" key, but no ""="").

But I understand the reasoning for having it be ""="" in a US QWERTY keyboard (specially if using ""shift+"" doesn't work for Wesnoth hotkeys), so I think it would be best to keep both keys so that it works properly on both keyboard layouts and doesn't really have an actual effect on people used to ""=""."
1136669883,[1.17]Add ability filter and 'priority' for overwrite_specials,newfrenchy83,2022-11-27 11:39:40+00:00,2023-07-08 16:00:32+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1}","This request groups 3 commits which, once approved, will have to be merged separately into the master branch.

The first two commits are identical to https://github.com/wesnoth/wesnoth/pull/7050

The third concerns the addition of a filter for the overwrite_specials attribute which exploits the code of the first commit."
1136523892,Fix WML for standing animations for Walking Corpse and Soulless intro…,walodar,2022-11-26 18:37:13+00:00,2022-12-17 19:49:06+00:00,{'Units': 1},…duced in b0d327ea3c78209397571f11773f056b272f496f (#7102).
1136357023,Chat message overlap,Wedge009,2022-11-26 01:20:13+00:00,2022-12-11 22:20:00+00:00,{'UI': 1},"**Draft because there is a lingering redraw issue**.

1.16.6 release (no difference with zoom):
![1 16 6](https://user-images.githubusercontent.com/13679322/204066735-f71ad8bb-4ada-4f6a-b5cb-239df42459bc.png)

1.17.10 release - 100% and 200% zoom (issue #7100):
![1 17 10](https://user-images.githubusercontent.com/13679322/204066806-5267e6b9-a2a2-4bb1-a424-035c667aea2d.png) ![1 17 10-zoomed](https://user-images.githubusercontent.com/13679322/204066815-bdf0f62f-d36e-45c9-9fe9-aa1cdcc7ff6a.png)

This PR (at 200% zoom):
![1 17 10-branch](https://user-images.githubusercontent.com/13679322/204066846-9b8dc4c2-49a2-4867-98de-da6023150383.png)

However, I still need some help with the undraw calls, when the chat messages are scrolled up (as subsequent messages are displayed):
![1 17 10-undraw](https://user-images.githubusercontent.com/13679322/204066893-3d0f1161-833e-4e57-9097-333bc9ef1a6f.png)

`display_chat_manager::prune_chat_messages()` calls `remove_floating_label()`:
https://github.com/wesnoth/wesnoth/blob/710867e010a73c4dfe6b78a52908670b23e2d091/src/display_chat_manager.cpp#L203-L215

`remove_floating_label()` then calls `floating_label::undraw()`:
https://github.com/wesnoth/wesnoth/blob/710867e010a73c4dfe6b78a52908670b23e2d091/src/floating_label.cpp#L309

...and then `undraw()` calls `floating_label::get_bg_rect()`:
https://github.com/wesnoth/wesnoth/blob/710867e010a73c4dfe6b78a52908670b23e2d091/src/floating_label.cpp#L159-L164

I've verified that `get_bg_rect()` properly accounts for the border padding for the chat messages, so I'm not sure why they are not being undrawn properly (I'm not really familiar with the graphics code). Help? I accept this may not be the 'right' or 'best' way to resolve #7100."
1135389159,Don't call back() if open_window_stack is empty since that's UB.,Pentarctagon,2022-11-24 23:12:11+00:00,2022-11-25 07:37:52+00:00,{'UI': 1},Resolves #7104
1134274939,Implementation of feature #7029 to use replays as tests,demario-w,2022-11-24 01:02:33+00:00,2022-11-24 01:03:32+00:00,{'Units': 1},"There is no description for the new command line option to avoid breaking translation as the change was implemented for branch 1.16. But a recent change in src/game_launcher.cpp makes the code incompatible for that branch now. Anyways.
"
1133641001,Add unit tests for interpolated event names and end_turn,stevecotton,2022-11-23 14:53:55+00:00,2022-11-25 11:16:46+00:00,"{'Unit Tests': 1, 'WML': 1}","Move `event_name_variable_substitution` to the top of the file, as it's testing that the event triggers at all, before the tests that check which order the events are triggered in.

The old `order_of_variable_events1` seemed to be a combination of two tests that should exist, but the code didn't quite test either of them. This replaces it with a new `order_of_variable_events1` and `order_of_variable_events3`.

Docs partially written by Pentarctagon, this started as a review comment on the documentation PR."
1131984173,Add a unit test for the preprocessor's #ifdef handling,stevecotton,2022-11-22 15:24:35+00:00,2022-11-26 13:55:33+00:00,"{'Backport': 1, 'Unit Tests': 1}","This one's surprising, but it's the behavior of 1.16, so add a test for the current behavior even though I wonder if it should change in 1.17.

@CelticMinstrel @newfrenchy83 this explains my current confusion in #7157."
1131721439,Fix [special_note] duplication when unstoring units,stevecotton,2022-11-22 12:35:42+00:00,2022-11-29 10:40:12+00:00,"{'Bug': 1, 'Backport': 1, 'Unit Tests': 1, 'Units': 1}","Fixes #7153

The movetype's special notes were becoming a new note for the individual unit.

Clean up the documentation on some of movetype's functions, as they had documentation in both the .hpp and the .cpp."
1130878169,More unit test documentation.,Pentarctagon,2022-11-22 01:46:24+00:00,2022-11-23 22:25:37+00:00,{'Unit Tests': 1},"---

Skipped over `test_force_chance_to_hit_macro` for now since it's changing in #7050."
1130630005,Escape < and > even if only one of them exists,ProditorMagnus,2022-11-21 21:19:09+00:00,2022-12-20 19:07:17+00:00,{'WML Tools': 1},"In python negative index counts from the end, so without this change or another solution 
`example with only < one side` would be converted to  
`example with only < one sid&gt;example with only < one side`"
1129450928,1.17 - a couple more monsters,doofus-01,2022-11-21 03:57:55+00:00,2022-12-04 20:00:48+00:00,"{'Campaign (any)': 1, 'Graphics': 1, 'Units': 1}","Initial commit is a dragonfly, inspired by forum member Helmet in https://forums.wesnoth.org/viewtopic.php?t=56341.
These dragonflies are not lifted from that, but that's where the inspiration came from and I used his sprite as a starting point, so he should be in the credits.

Other things to add here:
- level 0 dragonfly naiad
- The kraken, following up on #7125 
- ~~possibly reorganize the ""monsters"" race further to monsters/beasts/bugs/etc.~~ Actually, this is better left to a different PR"
1129222136,Sync Delurin between HttT and Liberty,knyghtmare,2022-11-20 18:30:38+00:00,2022-11-30 10:27:38+00:00,"{'Enhancement': 1, 'Campaign (any)': 1, 'Units': 1}",Closes #7148 
1129167153,include Refactor ability lists using utils::erase_if and std::remove_if to overwrite_specials,newfrenchy83,2022-11-20 14:52:01+00:00,2022-11-20 19:14:00+00:00,{'Units': 1},using code of https://github.com/wesnoth/wesnoth/commit/67f2c32c54e65055abc909e219a87c65ad11ea14 commit in overwrite_specials
1128045753,Refactor ability lists using utils::erase_if and std::remove_if,stevecotton,2022-11-18 18:54:27+00:00,2022-11-20 14:20:29+00:00,{'Units': 1},"C++20 will add std::erase_if as a convenience wrapper around std::remove_if, handling the subsequent call to std::vector::erase. This simplifies readability, avoiding the need to either store the result of std::remove_if in a temporary or to put the second argument of vector::erase after the body of a lambda.

This adds utils::erase_if, which does the same thing. The C++20 function returns the number of elements removed, but as none of the callers need that I've not implemented it in utils::erase_if.

This commit omits the refactor of attack_type::overwrite_special_checking, because that function is being worked on in parallel by @newfrenchy83. It'll be simpler for either of us to update it later instead of creating merge conflicts.

@newfrenchy83, please would you review this?"
1127253560,Refactor autodetect_game_data_dir into function,bencsikandrei,2022-11-18 09:12:46+00:00,2022-11-19 11:34:14+00:00,{},"the code that does autodetection looked like it could be put inside a function - add a function that explains what it does

avoid some string copying and move where possible

use scoped ifs (c++17) to limit scope of local variables"
1126302292,[1.17]further simplification of overwrite_specials attribute code,newfrenchy83,2022-11-17 17:05:12+00:00,2022-11-20 14:17:02+00:00,{'Units': 1},"I know that I have already proposed a simplification of the code of this attribute, but several things lead me to propose this second rewrite.

First, using the first loop to define three boolean variables is more complicated than simply eliminating from the 'overwrite_specials' list the abilities not carrying the attribute then; if an ability with the attribute is present define a double for loop inside each other, where for each ability with overwrite_specials the type of ability removal from the returned list is defined at that time (one_side or both_sides). The code is even more readable than with the previous work in my opinion.

The second reason is that I eventually want to be able to use the request code https://github.com/wesnoth/wesnoth/pull/7050 to be even more selective about the abilities that can be removed or not and extend the use of the attribute beyond chance_to_hit (when (and if) these two PRs will be merged in master, I will have to add 3-4 lines of code in hadcoding to implement the filtering). Building a list instead of splicing the existing one is incompatible with this project."
1125621238,HttT: give Kalenz his missing 2nd trait,knyghtmare,2022-11-17 08:21:41+00:00,2022-11-22 01:26:20+00:00,"{'Enhancement': 1, 'Campaign (any)': 1}","Kalenz now has traits loyal, and resilient. The quick trait is part of his changed unit type after LoW's ending.

Closes #7141 "
1125596628,HttT S14: give Relgorn his missing traits,knyghtmare,2022-11-17 07:59:14+00:00,2022-11-19 07:26:24+00:00,"{'Enhancement': 1, 'Campaign (any)': 1}",Closes #7139 
1125579933,[TRoW][Units] Give Prince Haldric his resilient and healthy traits,knyghtmare,2022-11-17 07:41:00+00:00,2022-11-18 23:39:25+00:00,"{'Enhancement': 1, 'Campaign (any)': 1, 'Units': 1}",Part of #7129
1124900491,"Make undo work again, undeprecate on_event()",stevecotton,2022-11-16 18:18:20+00:00,2022-11-19 04:23:30+00:00,"{'Bug': 1, 'MP': 1, 'Lua API': 1, 'Engine': 1}","Fixes #6898. The issue is that non-WML events added through the new events API always disable undo with no equivalent of WML's `[allow_undo]`. The long-term fix is to add a way to do that; however until that's available then listeners for `moveto` need to use the old `on_event` API. The old `on_event` API can't be deprecated yet, and this is enforced by our unit tests (the build fails if there are unexpected deprecation warnings during the tests).

Reverts most of 7e234f8833282424b3535b9c334c751748f7222b. Does not revert files that only listen for non-undoable events such as `die` or `new turn`.

Reverts the deprecation part of #5663's 8cd133263058a5df85f64988e348d2cf54d13a48."
1124267913,Remove some un-needed references and optimize some string operations,bencsikandrei,2022-11-16 10:53:46+00:00,2022-11-23 00:12:32+00:00,{'Command Line': 1},"when returning by value, the ideal way to store the returned value is another value - using a const& works only because of how c++ prolongs the lifetime of temporaries with const&'s

use move on strings that get destroyed at scope end

fix some formatting differences between a couple functions (parenthesis spaces)"
1124066990,Simple refactor in read_argv,bencsikandrei,2022-11-16 08:38:08+00:00,2022-11-19 04:22:31+00:00,{'Command Line': 1},"use return of `emplace_back` to swap buffers
use argc to reserve space in the args vector
remove explicit constructor used in `push_back` vs `emplace_back`"
1123529862,LoW S9: Remove standard enemies-defeated as a victory condition,Wedge009,2022-11-15 23:20:09+00:00,2022-11-16 00:54:01+00:00,"{'Backport': 1, 'Campaign (any)': 1}","Resolves #7130.

Enforcing the river crossing seems to be the better option (as opposed to just adding defeat enemies as an alternative victory objective) since there are monsters to contend with when arriving at the river."
1122338450,Move Kraken to core as Cuttle Fish advancement and give both submerge ability,Jonathan-Kelly,2022-11-15 04:47:01+00:00,2023-07-19 20:58:04+00:00,"{'Campaign (any)': 1, 'Graphics': 1, 'Units': 1}","Similar to #3414 this moves the Kraken from DW and WoF into core as the level 3 advancement for the Cuttle Fish.

The cuttlefish has perhaps the most sophisticated camouflage ability in the animal kingdom and no need to breathe air, so there may be no better fit for the submerge stealth ability than this unit.

Slightly increases the gold costs for both units to compensate (just let me know if this or experience needs further adjustment). Tweaks campaign scenarios sufficiently affected due to having large areas of deep water terrain and multiple individuals of these unit types, Note that DW S6 is partly counter balanced by the increased Cuttle Fish cost."
1120801613,Disable saving of replays for story-only scenarios,Wedge009,2022-11-14 05:37:15+00:00,2022-11-14 08:54:06+00:00,"{'Backport': 1, 'Campaign (any)': 1}","Resolves #6180.
Resolves #7123."
1120167082,Slightly reduce merfolk forest and hill move cost,Jonathan-Kelly,2022-11-13 02:14:02+00:00,2022-11-17 04:39:29+00:00,{'Units': 1},"From 5 to 4. Makes moving them from one water body to another somewhat less tedious. Likewise makes merfolk units a bit more viable on maps with separated waterways.

Just as it was before this change, the merfolk remain twice as slow as naga at moving through these two terrains."
1120011505,[1.2] Fix unit/unit_map include circular dependency and force use of std=c++03 for g++ compiler.,alberic89,2022-11-12 16:07:50+00:00,2022-11-12 17:05:58+00:00,{},"Fix unit/unit_map include circular dependency (thanks to moi1392 on LinuxFR.org) Support of modern compiler (thanks to remico on LinuxFR.org)
Thanks to gnombat and Pentarctagon."
1119808153,Add some more unit test documentation.,Pentarctagon,2022-11-12 05:45:39+00:00,2022-11-13 22:35:06+00:00,{'Unit Tests': 1},Also split some larger tests into multiple smaller tests.
1119588428,[1.16] run_wml_tests: add an option to filter tests by name,stevecotton,2022-11-11 21:44:48+00:00,2022-11-12 01:08:22+00:00,{'Unit Tests': 1},"Backport of #7036. It might be a little excessive to run this one through the CI, but I like to have a check-everything workflow.

For example, `run_wml_tests --filter backstab` runs only the tests listed in `wml_test_schedule` that have `backstab` somewhere in their name.

(cherry picked from commit 34ae0490b1975b950e90a5c9505abb85cc07d049)"
1119581557,[1.16] Add unit tests for [break] and [return] during [fire_event],stevecotton,2022-11-11 21:32:25+00:00,2022-11-12 01:08:05+00:00,"{'Unit Tests': 1, 'WML': 1}","Backport of #7086, planning to merge once the CI finishes.

Cherry-picked from b18b0e0f55ce595fe0e6986f96b1e26d7c44823b, including the docs from 16b900c27340a06c3b26cb5cbc1845432d8a2a34."
1119545478,Make Nightblade the default advancement for Slayer,Jonathan-Kelly,2022-11-11 20:40:34+00:00,2022-11-17 04:03:27+00:00,"{'Campaign (any)': 1, 'MP': 1, 'Units': 1}","Similarly to #6911 this gives a level 3 advancement to a default unit that is still missing one. Except in this case the advancement was already in core, just not fully utilized.

Also adds the Orcish Nightblade as a leader for Age of Heroes era and to campaign side recruit lists wherever the other level 3 orcish units are found."
1118861616,Unit traits exclusive,Kingofd,2022-11-11 09:32:57+00:00,2023-01-19 18:49:40+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1}","Please, for your convenience, test it with a build, trait config file included. Do not include trait config in merge, tho, only for testing"
1112251800,Fix 64-to-32 bits integer downcast issue,irydacea,2022-11-07 04:52:02+00:00,2022-11-09 13:19:35+00:00,{},"The affected function may return prematurely given a sufficiently large input because of a downcast to int of a size_t value, followed by a comparison.

(This was caught through a mishap with `-Wshorten-64-to-32` on Xcode.)"
1112218153,1.17 - standing animations for zombies,doofus-01,2022-11-07 03:54:13+00:00,2022-11-14 00:47:22+00:00,"{'Graphics': 1, 'Units': 1}","For now, just the default WC.  I'm not sure which variations are most important, maybe `mounted`, `drake`, and `troll`?"
1112143458,[Core/Macros] [1.17] [FR] add new macro for unit advancement sound event,knyghtmare,2022-11-07 01:21:02+00:00,2022-11-20 22:12:38+00:00,"{'Enhancement': 1, 'Audio': 1}",Closes #7085 
1111882802,Add screenshots directory to game version dialogue,Wedge009,2022-11-06 07:05:03+00:00,2022-11-13 02:34:34+00:00,{'UI': 1},"Honestly, I'm not sure if this addition is a good idea - it is possible to have too much information displayed - but it was requested and it looked relatively straightforward to implement, so here it is. Of course, I could have missed something somewhere.

Resolves #7096."
1111725291,add missing terrain type alias to elevation markers,doofus-01,2022-11-05 17:28:12+00:00,2022-11-05 22:28:33+00:00,{'Terrain': 1},fixes #7080 
1111704472,"Fix ""Chance to hit"" not translated in tooltip",newfrenchy83,2022-11-05 16:17:41+00:00,2022-11-06 04:07:03+00:00,"{'Translations': 1, 'UI': 1}",Fix https://github.com/wesnoth/wesnoth/issues/7088 issue
1111699695,"add ""Chance to hit: "" in wesnoth.pot and po files",newfrenchy83,2022-11-05 16:02:14+00:00,2022-11-05 16:13:26+00:00,{'Translations': 1},resolve https://github.com/wesnoth/wesnoth/issues/7088 issue
1109234292,Add unit tests for [break] and [return] during [fire_event],stevecotton,2022-11-03 08:02:10+00:00,2022-11-05 05:21:30+00:00,"{'Unit Tests': 1, 'WML': 1}","I've backported this and confirmed that the behavior is the same on 1.16 (using a binary built around 2 weeks ago).

Fixes #7084."
1107409540,DM S21: Show Delfador crossing at the Ford of Abez,Wedge009,2022-11-01 22:24:12+00:00,2022-11-03 00:16:56+00:00,"{'Backport': 1, 'Campaign (any)': 1}","Before:
![before](https://user-images.githubusercontent.com/13679322/199352910-774ea0d6-a20d-4521-8e65-5d64c55fbd66.png)

After:
![after](https://user-images.githubusercontent.com/13679322/199352926-45dd7cd5-12f8-498c-bb28-0a4db4a0ea83.png)

For me, the problem isn't so much the indirectness of the existing route. I can only imagine that the path through Tath would be better because the marked route to Dan'Tonk implies an established road that would be more expedient to traverse. If we're going nit-pick, however, I'd argue the bigger problem is how Delfador and company magically (perhaps literally) cross the Great River directly from Wesmere Forest. Instead, they ought to cross at the Ford of Abez.

Resolves #7081"
1106245556,wmllint: Ignore labels for translation if a PNG extension is found,Wedge009,2022-11-01 04:43:42+00:00,2022-11-03 00:16:37+00:00,"{'Backport': 1, 'WML Tools': 1}","Resolves #6995.

I'd prefer to use `pathlib.PurePath.suffix` but `os.path` is already used extensively here. Also, `os.path.isfile()` doesn't work because that actually checks for the presence of the file, not just if the string is a valid file expression.

I don't really know all the details from the discussion in #6995, I just noted that this dropped remaining 'label needs translation mark' (for `[image]`s) in master and 1.16 for me (including `units/human-princess.png~TC(1,magenta)`). This may not necessarily be the 'right' solution."
1106211003,Replace use of strtod in config_attribute_value.cpp.,Pentarctagon,2022-11-01 03:52:44+00:00,2022-11-01 14:02:30+00:00,{},"May or may not have any effect on #3945, however the use of the locale-dependent strtod is likely wrong (or at least sub-optimal since it will fall back to storing values as strings more than it should) and std::from_chars is faster than strtod regardless."
1106207780,SoF S9: Separate Toomak's last breath message from the events following his death,Wedge009,2022-11-01 03:46:08+00:00,2022-11-03 00:15:56+00:00,"{'Backport': 1, 'Campaign (any)': 1}","Visually, this makes more sense: on the game board Toomak isn't killed until he's said his final piece. This also resolves the `wmllint` flag against a unit speaking in their `die` event, probably so-flagged precisely because of a unit speaking after they've already been removed from the board is a visual inconsistency."
1106183088,Add documentation to more WML unit tests.,Pentarctagon,2022-11-01 03:07:30+00:00,2022-11-02 20:16:23+00:00,{'Unit Tests': 1},
1106154957,Fix male Dark Horse unit name,demario-w,2022-11-01 02:23:27+00:00,2022-11-01 02:36:35+00:00,"{'Translations': 1, 'Units': 1}","The male variation of the dark horse unit is using the female translatable string.
Fix by making a male specific string to allow accurate translation."
1104652193,1.17 Horses updates,doofus-01,2022-10-30 22:58:07+00:00,2022-11-06 20:45:21+00:00,"{'Graphics': 1, 'Units': 1}","Some updates to the horses, mostly the art."
1104398331,DM S16: Show Delfador taking a more direct route to Weldyn,Wedge009,2022-10-30 11:53:30+00:00,2022-10-31 22:36:18+00:00,"{'Backport': 1, 'Campaign (any)': 1}","Original path shown in #7067.

New path:
![dm_s16](https://user-images.githubusercontent.com/13679322/198876942-4caa2a04-5483-48bd-b032-fc31ee87d43e.png)
"
1099598862,Show the log directory in the build info on non-windows platforms.,Pentarctagon,2022-10-25 23:54:08+00:00,2022-10-27 00:13:57+00:00,{'UI': 1},"Also moves the last bit of potentially common code from log_windows into the base logger.

---

To be honest I'm tempted to tinker with it more to see if any more of the windows-specific code needs to be windows-specific, but I also don't have a Windows machine to actually test it out. Also a lot of it is around that weird console behavior windows has.

@Vultraz Can you build this PR and just make sure that the Windows logging to file still works?"
1096871474,1.17 dunefolk falconer portrait,doofus-01,2022-10-24 03:16:36+00:00,2022-11-20 00:45:43+00:00,"{'Graphics': 1, 'Units': 1}",
1096657498,Add documentation to more WML unit tests.,Pentarctagon,2022-10-23 19:17:23+00:00,2022-10-25 16:29:49+00:00,{'Unit Tests': 1},"---

Will merge after a couple days if there are no comments."
1089321646,Fix 'attacks' abilities don't work(1.16),newfrenchy83,2022-10-17 13:04:09+00:00,2022-10-17 20:46:10+00:00,{'Units': 1},
1089314111,Fix 'attacks' abilities not checked(1.17).,newfrenchy83,2022-10-17 12:59:51+00:00,2022-10-21 16:12:29+00:00,{'Units': 1},the 'attacks' abilities don't be checked by special-id/type_active
1088220771,1.17 - make some overlay terrain available on bluff/gulch,doofus-01,2022-10-15 18:42:24+00:00,2022-10-16 03:34:06+00:00,"{'Graphics': 1, 'Terrain': 1}","For now, it's forests on bluffs.  Put *^Qhhf next to some forest, the sparse version of that forest grows on that bluff tile.  There should be some default version that's there when no neighboring forest exists, but currently it's just nothing.

I'm not sure what else is really needed after forest.  Fences, maybe. Rough terrain, walls, and castles aren't overlays so are a different case.  "
1088158972,Extend ability removal with remove_ability by attributes and no longer just by id,newfrenchy83,2022-10-15 13:54:18+00:00,2022-12-21 23:16:01+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1}","

using the id to designate the ability to remove can be quite tedious and especially incomplete when you want to use remove_ability to remove a whole type of ability with common characteristics. For this I suggest 1, to be able to filter the abilities by type. (we still need to place the id in the tag but this one cannot be differentiated from another) 2) filter by attribute in addition to id (name, affect_self/allies/enemies, active_on or apply_to or overwrite_specials for combat ability equivalent to a special 3) be able to place attributes outside ability tags to filter multiple types (works when no tag used in filtering)

the type of ability used is also filtered.

i apply hese modification in FORCE_CHANCE_TO_HIT macro for test."
1086381938,EI S11: update inconsistency on northern orcs/trolls,knyghtmare,2022-10-13 16:48:51+00:00,2022-10-14 03:24:08+00:00,{'Campaign (any)': 1},Closes #7040 
1084693257,Adding language filter option in addon menu,Kingofd,2022-10-12 13:24:11+00:00,2022-11-05 17:04:55+00:00,"{'UI': 1, 'Add-ons': 1}","My shot at [https://github.com/wesnoth/wesnoth/issues/1063](https://github.com/wesnoth/wesnoth/issues/1063)

Also merged some changes from master since I was working on it first a while ago

Looks like this now: 

![FeaturePicture](https://user-images.githubusercontent.com/26515148/195354158-e396a503-bd27-4c04-9908-c1dc73fa0a94.png)
"
1082072622,Wmllint: add new terrain code updaters,knyghtmare,2022-10-10 13:49:25+00:00,2022-10-12 04:26:25+00:00,"{'Enhancement': 1, 'WML Tools': 1}",Allows updating terrain codes for stone floors and wooden floors by Wmllint tool. Accommodates #7042
1081974455,Simplify code of overwrite_specials attribute for more readibility.,newfrenchy83,2022-10-10 12:31:31+00:00,2022-10-27 14:50:41+00:00,{'Units': 1},
1081449685,1.17 weathered stone elevation borders for Isa,doofus-01,2022-10-10 01:59:53+00:00,2022-10-10 04:18:24+00:00,"{'Graphics': 1, 'Terrain': 1}",
1081152651,1.17 Saurian palette cleanup,doofus-01,2022-10-09 02:18:11+00:00,2022-10-09 05:01:57+00:00,"{'Graphics': 1, 'Units': 1}","This doesn't really improve the user experience by itself, but it lays groundwork for future Saurian additions"
1081017710,Fix FORCE_CHANCE_TO_HIT macro,newfrenchy83,2022-10-08 13:35:52+00:00,2022-10-19 22:23:10+00:00,{'Unit Tests': 1},"with this fix, FORCE_CHANCE_TO_HIT macro work when unit affected using a cth ability with overwrite_specials.(But not if opponent using a cth ability with overwrite_specials and apply_to=opponent)."
1081014155,Change terrain codes for stone and wooden floors ,doofus-01,2022-10-08 13:19:29+00:00,2022-10-08 23:04:18+00:00,"{'Campaign (any)': 1, 'MP': 1, 'Terrain': 1}","fixes #7035 

Wood floors
 - Keep `Iwr` 
 - change `Ior, Icn` to `Iwo, Iwc`

Stone floors
 - Change `Irs,Ias,Icr` to `Isr,Isa,Isc`

still need to update existing maps, and fix `Isa`-`Isr` transition"
1080417267,"Add ""all_others"" option to overwrite_specials attribute for overwrite all specials of same type",newfrenchy83,2022-10-07 14:08:06+00:00,2022-10-08 13:36:17+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1}","

when overwrite_specials used with ""all_others"" all specials/abilities of same type wh don't have overwrite_specials=all_others will be overwrited.

Can resolve force_chance_to_hit macro can't overwrite chance_to_hit ability using overwrite_specials."
1076254421,Add [filter_weapon][not]special_id_active=forced_cth in chance_to_hit abilities using overwrite_specials attribute,newfrenchy83,2022-10-04 16:30:38+00:00,2022-10-07 14:08:22+00:00,"{'Unit Tests': 1, 'Units': 1}","

The FORCE_CHANCE_TO_HIT macrodon't overwrite a cth who using overwrite_specials attribute if [filter_weapon][not]special_id_active=forced_cth not addedin [filter_student/opponent]. i propose to add that in hard code for resolve this issue."
1075528830,Refactored gamemap drawing,Vultraz,2022-10-04 06:02:55+00:00,2022-10-04 08:38:46+00:00,"{'Editor': 1, 'Units': 1}","Should be almost ready, opening for CI."
1074329997,run_wml_tests: add an option to filter tests by name,stevecotton,2022-10-03 08:26:11+00:00,2022-10-05 05:44:02+00:00,{'Unit Tests': 1},"For example, `run_wml_tests --filter backstab` runs only the tests listed in `wml_test_schedule` that have `backstab` somewhere in their name.

I haven't tried to match the Boost test framework's [syntax for filters](https://www.boost.org/doc/libs/1_80_0/libs/test/doc/html/boost_test/utf_reference/rt_param_reference/run_test.html), because they expect tests to be organised into suites.

GTest's `--gtest_filter` agrees on the name and using regexps. That framework also allows negative patterns and multiple regexps separated by colons, but I'm not spending time adding that, nor does it seem necessary for our purposes."
1073785889,Unit tests for changing filters in [event]name=attack,stevecotton,2022-10-02 09:03:49+00:00,2022-10-21 18:26:12+00:00,{'Unit Tests': 1},"I'm using the existing backstab test as a framework for the new tests, but this means they have to be in the same file as the backstab test.

@Pentarctagon, this is probably a good time to discuss your plans for reorganising the tests - where would the common code of the `TEST_BACKSTAB` macro go?"
1073603167,Remove deprecated backstab code and using wml filters instead,newfrenchy83,2022-10-01 16:26:03+00:00,2022-10-06 12:52:20+00:00,"{'AI': 1, 'UI': 1, 'Units': 1, 'Lua API': 1}",the old code of deprecated backstab is removedin this PR and wml code used intead pushed in backstab attribute for it's work
1073218825,Enabled client-side keepalive.,Pentarctagon,2022-09-30 20:45:10+00:00,2022-10-12 12:58:08+00:00,"{'MP': 1, 'Units': 1, 'Add-ons': 1}","Also adds a windows version of keepalive to the servers.

Resolves #1336

---

I'm not too sure what would be a good test of this, however."
1068842664,Units: add sand_scorpion variation to Walking Corpse and Soulless,knyghtmare,2022-09-27 16:05:43+00:00,2022-10-05 16:29:55+00:00,"{'Enhancement': 1, 'Units': 1}","This accommodates the variation of the Giant Scorpion, the Sand Scuttler.

## Why has this been done?

Well, compare the resistances of the Giant Scorpion base variation and the Walking Corpse scorpion variation...do they match? No, They don't.

The WC/SL variation of the scorpion coincidences perfectly with the sand scuttler variation of the Giant Scorpion, not the base.
Oversight developed from b9e67f459840a01a3d453570cd6ceec31ef10ac6

Closes #7015 "
1068807844,Units: Wyvern Rider XP set to 200,knyghtmare,2022-09-27 15:36:39+00:00,2022-09-29 15:02:39+00:00,"{'Enhancement': 1, 'Units': 1}","This is a level 4 unit and so, by convention, `experience=` should be `200`."
1067684589,"Remove ""Apply to all units"" option from the pick_advance mod",Discontinuum,2022-09-26 20:32:53+00:00,2022-10-28 22:33:57+00:00,"{'UI': 1, 'Units': 1}","So, for starters I propose this change, completely remove ""Apply to all units"" option from the Plan Unit Advancements mod. It works in a buggy and confusing way: it enables the chosen advancement for all subsequent recruits and doesn't apply to the unit by clicking on which it was requested. There were no suggestions how to improve it and the more I thought about it, I came to a conclusion that it will be confusing either way. Some people think it sets for all units on the board, others that on all subsequent units on the board including the one you clicked on. So I propose for now just delete this option, people may set up advancements for each unit individually (although it may be tedious for very large scenario prob?) I'm not committed to this resolution and if any other good ideas on how to improve it appear, I will gladly double down on them.

As this mod is inlined in each game that uses it, afaik this change shouldn't cause any OOS and so could be merged right in 1.16"
1067124907,define  version for remove backstab option in deprecated message,newfrenchy83,2022-09-26 13:08:46+00:00,2022-09-29 15:42:12+00:00,{'Units': 1},
1066350423,Changed Fire_Dragon and Skeletal_Dragon to match issue 5703,BlakeOneal,2022-09-25 17:39:48+00:00,2024-08-03 16:27:41+00:00,{'Units': 1},Updated the Skeletal_Dragon and Fire_Dragon monsters to match the user request in 5703. Put a placeholder attack for Tail_Whip as it was matching an animation file. Resolves #5703 
1066308025,Timestamping server messages [1.16 backport],Discontinuum,2022-09-25 14:17:53+00:00,2022-09-25 20:50:04+00:00,{'MP': 1},Backport #6979
1066114517,change the deprecation message content for backstab option,newfrenchy83,2022-09-24 18:01:41+00:00,2022-09-25 14:59:44+00:00,{'Units': 1},
1064897865,Reduce the saturation of hex colour for movement points,Wedge009,2022-09-23 05:08:58+00:00,2022-10-06 08:19:57+00:00,"{'UI': 1, 'Help': 1}","Attempting to mitigate #7017.

It's a subtle difference, but I think it may help ease the complaints of 'garishness' regarding the recent addition to the help page. (Also applied to the side bar reports, etc.)

Before:
![191890877-b944fe4f-0447-4323-9490-87b1624ed97d](https://user-images.githubusercontent.com/13679322/191895504-3fee2371-d832-44bb-81f1-cf214c51226f.png)

After:
![image](https://user-images.githubusercontent.com/13679322/191895520-3cc2a10f-b3f0-48b5-8883-e08714115bda.png)
"
1062125044,Fix unknown speaker errors,Dou1622,2022-09-20 22:06:34+00:00,2022-10-30 21:17:51+00:00,"{'Campaign (any)': 1, 'WML Tools': 1}","Fix unknown speaker or id errors
See #4494"
1059775765,1.17 elevated terrain work,doofus-01,2022-09-19 03:41:33+00:00,2022-10-03 03:28:03+00:00,"{'Graphics': 1, 'MP': 1, 'Terrain': 1}","Revised the stone stairs to be less jagged, and worked on some corner transitions.  The job isn't finished, as can be seen in the image below, and I haven't touched the wooden transitions.
![Screenshot_20220918_a](https://user-images.githubusercontent.com/13510196/190946164-a3efee20-0332-4229-88f6-2753f5f4cf55.jpg)
"
1059372441,MP tooltips: allow line breaks between hexagons by using Unicode zero width space,walodar,2022-09-17 17:48:36+00:00,2022-09-19 22:40:50+00:00,{'UI': 1},"To allow potential line breaks between the hexagons in MP tooltips, this pull request inserts (invisible) Unicode zero width space characters between them.

Previously, I have already used this little trick for the hexagons in the help browser.

With this pull request, the same thing is done for the MP tooltips in the sidebar and the recruitment dialog, which covers all places where MP hexagons appear.

This only makes a visible difference if a unit's movepoints are extremely large, quite beyond any mainline unit, but I see no drawbacks."
1059242443,Re pr 6538,Pentarctagon,2022-09-17 04:20:26+00:00,2022-09-23 21:39:12+00:00,{'Campaign (any)': 1},Re-PR of #6538 without the problematic second commit.
1056476704,Change macos back to using RC4.,Pentarctagon,2022-09-14 19:24:18+00:00,2022-09-15 15:39:19+00:00,{'macOS': 1},"The AES implementation wasn't working, so someone using macos will need to investigate that in the future probably. For now though RC4 isn't deprecated yet on macos."
1052347301,1.17 alternate high/low terrain levels,doofus-01,2022-09-10 23:14:19+00:00,2022-09-12 04:01:28+00:00,"{'Graphics': 1, 'Terrain': 1}","What this PR does:
1.  Provides an additional raised level and lowered level
2.  Improves the appearance in editor and makes use more intuitive (though I still won't claim it is intuitive)

What this PR won't do:
1.  Extra tall cliff transitions (i.e. it is always one step up or down)

I'm trying to figure out if there is some way to get a Möbius strip rule-set that makes it possible to build shallow staircases by alternating available levels.  At the moment, prospects are not looking good.
![Screenshot_20220910_a](https://user-images.githubusercontent.com/13510196/189504805-f40759c7-0d8a-4959-a2c8-aebcaad3c5c0.jpg)

"
1050928592,DiD S8: Handle situations where factions have not yet appeared,Wedge009,2022-09-08 23:15:26+00:00,2022-09-14 05:04:52+00:00,"{'Backport': 1, 'Campaign (any)': 1, 'Prose': 1}","Resolves #7005.

I think this is perhaps overkill, but clearly at least some people notice the discrepancy in the dialogue if the scenario is completed before certain factions have appeared.

I consider 'paladins' as a generalisation for Cadaeus' forces, so there doesn't need to be yet another piece of dialogue differentiating whether or not Cadaeus is alive. Similarly, I generalise Dela's forces as 'Dela's men' so it shouldn't matter if Dela is alive or not. Regardless, the underlying bug report requires that there be work for the translators.

I think this scenario file is the same in 1.16 branch, so could be back-ported. I have tested the three phases as stated in the commentary: before Cadaeus appears, after Cadaeus appears but before Dela appears, and after Dela appears. It makes sense to me, given the context of the bug report."
1048821561,add a [damage_type] special or ability who modify the type of attack used,newfrenchy83,2022-09-07 14:09:04+00:00,2023-10-06 16:29:17+00:00,"{'Campaign (any)': 1, 'Unit Tests': 1, 'UI': 1, 'Units': 1, 'Schema': 1}","At the suggestion of @stevecotton, I propose a special [damage_type] capable of modifying the type of attack used when the conditions are met. Its operation is similar to [attack_alignment]: https://github.com/wesnoth/wesnoth/pull/6968. .

the priority rules defined by value of priority_type attribute. lowestest value= highest priority

rules applied alos to ""plague"" special"
1047076296,Separate player-hosted games and bot-hosted games into tabs,Pentarctagon,2022-09-06 05:26:53+00:00,2022-09-26 14:01:11+00:00,"{'MP Lobby': 1, 'UI': 1}","Bot-hosted games are now shown in a separate tab from player-hosted games, based on the new `auto_hosted` attribute on the game creation WML. This is not something that's available to be selected during game creation since it's assumed it will instead be set by the bot implementation.

Resolves #6939"
1045508240,Update flatpak runtime to freedesktop 22.08.,Pentarctagon,2022-09-03 16:01:58+00:00,2022-09-03 16:53:56+00:00,{'Packaging': 1},"---

Opening for CI."
1045488907,"[1.16] Show units' max move ranges, unless it's the owner's turn",stevecotton,2022-09-03 14:33:46+00:00,2022-09-03 16:57:33+00:00,"{'Bug': 1, 'MP': 1, 'UI': 1}","Backport of #6998.

If it's another player's turn, then movement points will be reset in a refresh
phase and it's not useful to show current movement.

Partially reverts 978229c247 (af0968d9c3 on 1.16), using the old logic for
the movement range but the allies-based logic for goto_x,goto_y information.

Fixes #6716.

(cherry picked from commit ae4ecd17e4c617af72c8c2e00bca014dcfb1b993)"
1045316026,"Show units' max move ranges, unless it's the owner's turn",stevecotton,2022-09-02 22:19:36+00:00,2022-09-03 12:26:09+00:00,"{'Backport': 1, 'MP': 1, 'UI': 1}","If it's another player's turn, then movement points will be reset in a refresh
phase and it's not useful to show current movement.

Partially reverts 978229c247 (af0968d9c3 on 1.16), using the old logic for
the movement range but the allies-based logic for goto_x,goto_y information.

Fixes #6716.

Note: bug #6997 is reproducible in all three of these combinations, so I'm treating it as an orthogonal issue:
* without this PR
* with this PR
* with a full revert of 978229c247"
1044008356,Give Shyde and Sylph unwalkable statistics,Jonathan-Kelly,2022-09-01 17:08:56+00:00,2022-10-23 23:54:13+00:00,"{'Enhancement': 1, 'Campaign (any)': 1, 'Units': 1}","With the same unwalkable terrain movement and defense as the Quenoth versions of these units. Makes them behave as true flying/floating units as their wings, movetype name and other statistics suggest, while opening up interesting game play possibilities."
1044005199,Match lightning attacks to arcane damage icon,Jonathan-Kelly,2022-09-01 17:06:30+00:00,2022-09-24 01:08:50+00:00,"{'Campaign (any)': 1, 'Units': 1}","[A lightning bolt](https://github.com/wesnoth/wesnoth/blob/master/images/icons/profiles/arcane.png) is prominently displayed throughout the UI as the icon for arcane attacks. So switch the rare instances of lightning attacks from fire to arcane to match this convention. Doing so also makes the core Jinn unit more versatile, by giving it better utility against drakes (which are resistant to all its existing attack types)."
1042935320,Fix #4456: Sidebar abilities display leaks shrouded information,Pentarctagon,2022-08-31 22:23:34+00:00,2022-09-05 15:51:35+00:00,{},Re-PR of #4462
1042143194,wmllint: stop adding wesnoth-icon.png to messages,stevecotton,2022-08-31 09:19:15+00:00,2022-08-31 19:27:16+00:00,{'WML Tools': 1},"We're had at least two people look at the ""good first issue"" list, pick up
the wmllint warnings, open a PR, and then get a response that these .pngs
shouldn't be added by default. That's not a welcoming introduction.

IIRC we didn't get full consensus that these should never be added, but I
think it's time to open a ""just drop that code, no options"" PR. If someone
wants it back in a subset of circumstances, they can always create a PR to
readd it along with adding an option to enable it.

Inspired by #6990, previously discussed in #5164."
1041559603,Fix inserting image=wesnoth-icon.png errors,Dou1622,2022-08-30 22:40:54+00:00,2022-08-31 19:30:43+00:00,{'Campaign (any)': 1},"Fixes all wmllint ""inserting 'image=wesnoth-icon.png'"" errors.
Wmllint will insert a image for the narrator when there isn't one, and print a warning (see comment starting on line 2765).
I added an image for the narrator when there wasn't one.
See #4494"
1039763829,Lua AI: speed up battle_calcs.battle_outcome in extreme cases,mattsc,2022-08-29 14:13:07+00:00,2022-08-31 19:39:43+00:00,"{'AI': 1, 'Fwdport': 1}","The method used in the battle_outcome() function is somewhat simplified compared to the default engine calculation and faster in the vast majority of cases, but it can become extremely slow when the combined number of strikes of the attacker and defender is very large.

This was reported as a complete stalling of the game in HttT The Princess of Wesnoth (which uses the Assassin Squad Micro AI) in combination with the Less Random modification.  Details are given in [this forum thread](https://forums.wesnoth.org/viewtopic.php?t=56116)."
1038863521,Remove obsolete reference to gna.org,Wedge009,2022-08-28 12:10:24+00:00,2022-08-29 18:06:56+00:00,"{'Units': 1, 'Engine': 1}",Resolves #6933 - it was suggested there to just remove the error message altogether.
1037741993,CMake 2.24.0: Workaround for missing SDL2::SDL2main,stevecotton,2022-08-26 09:35:39+00:00,2022-08-27 06:27:39+00:00,"{'Building': 1, 'CMake': 1}","@bencsikandrei please would you review this? I can only add project members as reviewers, but you're probably the best reviewer.

In SDL 2.24.0, the CONFIG method doesn't add a target for libSDL2main. Seen on Debian Unstable, and seems to be https://github.com/libsdl-org/SDL/issues/6119 which is reported upstream on macOS. For consistency's sake, let's add a phony library we can link with, which is also the workaround that upstream suggests in the bug report."
1037614951,[Units] Fix XP conventions oversight in some monster/horse Units,knyghtmare,2022-08-26 07:26:08+00:00,2022-09-18 05:32:10+00:00,{'Units': 1},"## Summary:

Certain units with no level up/advancements were not adhering to the max XP conventions which had been set for core units. This rectifies such oversights.

## Reference Table:

| Level | Maximum XP |
| ----- |  -------------- |
| 0 | 25 |
| 1 | 50 |
| 2 | 100 |
| 3 | 150 |
| 4 | 200 |
| 5 | 250 |
| 6 | 300 |

Note: Only Applicable for Units with no further advancements being available apart from `{AMLA_DEFAULT}`

Note 2: Some commits here should/can be cherry-picked since these units exist in 1.16 as well (all except the Hunter Caribe)"
1037596968,WoF/Units: Adjust XP value oversights in the campaign units.,knyghtmare,2022-08-26 07:08:57+00:00,2022-08-28 02:40:44+00:00,"{'Campaign (any)': 1, 'Units': 1}","# Summary:

1. Outrigger max XP is now 100
2. Stymphalian XP set to 50
3. Wyrm XP set to 50

# Remark:

XP value conventions for units with no level ups

- Level 0: 25
- level 1: 50
- level 2: 100
- level 3: 150
- level 4: 200
- level 5: 250
- level 6: 300"
1037519153,Make cache directory configurable too.,Pentarctagon,2022-08-26 05:19:38+00:00,2022-08-28 22:59:48+00:00,{'Command Line': 1},"---

Re-PR of #4103"
1037274366,Log exception type when doing catch(...).,Pentarctagon,2022-08-25 21:39:22+00:00,2022-08-26 03:22:23+00:00,"{'macOS': 1, 'MP': 1, 'UI': 1, 'Units': 1, 'Add-ons': 1, 'Building': 1, 'WFL': 1}",
1036164257,Timestamping server messages,Discontinuum,2022-08-25 02:13:38+00:00,2022-08-27 16:47:57+00:00,{'MP': 1},"Implements #6641

Just add ""time"" in the ""speak"" command that the server sends, I guess it should be fine?

I push to master, but I wonder, can it be backported into 1.16? Would be nice if possible"
1035454716,WoF S4: fix message not firing,Jonathan-Kelly,2022-08-24 13:03:12+00:00,2022-08-24 16:50:26+00:00,{'Campaign (any)': 1},"The first of four sea serpent spawn messages was not firing, because it was set to fire before its speaker appeared. The bug was introduced last year in a balance update affecting the sea serpent spawn rate, and was minor enough that it was missed during several play tests.

This simple fix is fully tested."
1032151051,1.17 raised terrain,doofus-01,2022-08-21 23:23:37+00:00,2022-09-06 02:41:07+00:00,"{'Graphics': 1, 'Editor': 1, 'Terrain': 1}","This is companion to #6927, it allows a cosmetic raised terrain.  It also allows larger raised/lowered regions to be marked as raised or lowered, so that the overlay slot (`^Fp` for example) isn't taken up by the gulch/bluff designation.  The marking is based on setting terrain-graphics flags to disable the little cliff transitions, since we can't rely on terrain codes to know what the map is supposed to look like. 

To use:

1. Draw the outline of the raised/lowered blob with the bluff/gulch terrain overlay.
2. Put the appropriate marker (""special"" terrain group) on one of the bounded hexes.
3. The rest of the bounded hexes will get flood-filled to be on the same raised/lowered level.
4. Don't worry about the banded overlay, it is just a guide for the map-maker.  It should not show up in game.

There are still some issues: 

- [ ] Most major is that the terrain-graphics flag setting seems to only propagate up & left two hexes per terrain-graphics tag.  It's possible I'm doing something wrong, but it may be an engine limitation.  
- [ ] Another limitation is that we only have three elevation levels; I think that is fixable, but I've run out of time for this week.
- [ ] Related to the number of levels, is that high-low (vs high-normal) transitions don't have special tall cliff images.  I'm not sure how to deal with this, since the elevation change doesn't actually exist.  Special images for this will (I fear) cause the number of needed transitions to explode (same reason I've not touched the ""cliffs"" terrain idea that's been floating around for years).
- [x] A little more fun, and something I can actually deal with in this PR, is that we need steps or some sort of man-made transition, in addition to the little cliffs.
![Screenshot_20220821_a](https://user-images.githubusercontent.com/13510196/185815139-ce4daa9b-0679-4e5f-a110-e67a434e3c48.jpg)
EDIT: Got the stairs done.  I don't know how to deal with the first and third issues, but I do plan to work on the second one."
1031968000,Open the forum profile of the currently selected user.,Pentarctagon,2022-08-21 05:21:40+00:00,2022-08-21 18:18:05+00:00,{'UI': 1},Rather than always opening your own.
1030310549,Have /report show a dialog for entering information.,Pentarctagon,2022-08-18 18:31:41+00:00,2022-09-03 02:18:03+00:00,"{'macOS': 1, 'UI': 1, 'Building': 1}","---

Screenshot of the dialog:
![report](https://user-images.githubusercontent.com/3030250/185467638-28362f99-7d9b-4aad-8e83-fdd1e3c1c789.png)

Importantly for this being useful, the person being reported and the reason for reporting them is required before allowing the report to be sent. For example, reports currently sometimes have literally just a username, which is fairly useless.

The options for the location of occurrence are Lobby, Whisper, and Game."
1027816571,"Add ""attack_alignment"" weapon special/ability for specific attacks",newfrenchy83,2022-08-16 16:04:01+00:00,2024-06-02 14:11:32+00:00,"{'Unit Tests': 1, 'UI': 1, 'Units': 1, 'Lua API': 1, 'WFL': 1, 'Schema': 1}","Although it is possible to mimic the operation of an alignment of the unit according to the time of day in standard conditions with [damage], the use of a fixed value limits the use of this substitutes for pre-determined conditions, but in the case of deep caves or large illuminations, the absolute value is no longer 25 and the special damage continues to mimic the standard values. That's why I propose a [attack_alignment] which actually replicates the alignment for a single attack.
The objective being that a unit can have attacks of alignment different from the standard alignment.

for [unit_alignment] the changes affect all attacks but appear in UI with name of alignment modified"
1026797697,Replace RC4 credentials encryption with AES.,Pentarctagon,2022-08-15 19:32:09+00:00,2022-08-17 19:32:50+00:00,{},"Starting with OpenSSL 3, RC4 is not enabled/accessible by default.

---

The remaining issue is what to do for Apple systems. I could try to update it to also use AES though I have no way of testing to know if it works or not, or I could leave Apple systems as using RC4 which would break credentials file compatibility when synced with other OSes."
1026782508,Fix wmllint translation mark errors,Dou1622,2022-08-15 19:12:57+00:00,2022-11-01 02:40:50+00:00,"{'Campaign (any)': 1, 'WML Tools': 1, 'Units': 1, 'Terrain': 1}","Fixes all wmllint warnings about translation mark.
See #4494"
1026642929,Rename display::current_frame_sample,grz0,2022-08-15 16:35:11+00:00,2022-08-16 08:14:50+00:00,{},Rename display::current_frame_sample to display::current_frame_sample_ for consistency.
1025667680,[UtBS] S4 extra dialog to acknowledge effect of finding the map in S3,max-torch,2022-08-13 21:41:36+00:00,2022-09-02 11:44:38+00:00,"{'Campaign (any)': 1, 'Prose': 1}",Aims to resolve #6199.
1025439273,Font/Text: tweak line height,Vultraz,2022-08-12 23:08:59+00:00,2022-08-13 01:57:29+00:00,{},For CI.
1025062557,Fixed vcpkg build issue for port update to 2.6.1,Vultraz,2022-08-12 15:19:14+00:00,2022-08-12 23:02:02+00:00,"{'Building': 1, 'CMake': 1}",Relevant vcpkg PR: https://github.com/microsoft/vcpkg/pull/25763
1021948882,Fix crash in update_fps_label(),grz0,2022-08-09 20:29:57+00:00,2022-08-10 14:08:12+00:00,{},"update_fps_label() uses a static variable to track current frame sample.
This causes division by zero while loading a save file if the
variable was previously equal to 9.

The commit changes the variable to private member to match its lifetime
with a lifetime of frametimes_ circular buffer.

Fixes: #5670"
1020919137,Clear all texture caches before game end,mesilliac,2022-08-09 01:09:13+00:00,2022-08-09 03:18:08+00:00,{},Probably does the F-word you should never say on github to #6950 
1019602534,Maybe fix MP create dialog,mesilliac,2022-08-07 18:05:13+00:00,2022-08-07 22:10:14+00:00,{'UI': 1},
1019580083,update codeblock projectfiles,newfrenchy83,2022-08-07 15:59:28+00:00,2022-08-07 21:08:41+00:00,{'Building': 1},
1019521625,A script to add new source files,mesilliac,2022-08-07 10:56:31+00:00,2022-08-16 16:47:17+00:00,{},"Usage: `./add_source_file <filename> [target ...]`

Targets are ""wesnoth"", ""wesnothd"", ""campaignd"", ""lua"", ""tests"".
It defaults to the ""wesnoth"" target.

The 'pbxproj' python package is required to modify the Xcode project. As may be inferred, this is a Python script.

It probably works? I don't know, really. It adds some stuff and looks vaguely correct.

It also sorts the `source_lists` files when adding to them, if that's a problem it can be made to not do that."
1019480150,Add pre attack event,Pentarctagon,2022-08-07 06:38:46+00:00,2022-08-10 14:07:31+00:00,{'Unit Tests': 1},"This addresses #4075

---

This is a re-PR of #4083 - I'll be testing and adding some unit tests for it, and if everything works then I'll merge it."
1019391500,addon/client: Add file operation progress dialog for installing add-ons,Pentarctagon,2022-08-06 18:19:57+00:00,2022-08-06 20:11:41+00:00,"{'macOS': 1, 'UI': 1, 'Add-ons': 1, 'Building': 1}","This implements an add-on extraction progress dialog that does not actually run its own event loop, allowing the caller to take ownership of it (`display()` static method) and update its state using a callback function object.

The dialog is roughly identical to the network progress dialog, except for the greyed out Cancel button. This is intentional so that the dialogs can be transitioned more or less seamlessly into each other by the add-ons client code.

![image](https://user-images.githubusercontent.com/489895/108446452-e6c1d900-723c-11eb-8b1c-cb18894a7057.png)

In order to avoid stalling the extraction process in UI code, the callback is invoked for every single file, but the dialog's progress update method places a time restriction on GUI2 API calls of 120 milliseconds -- this is a good throttle interval that allows add-ons to be extracted in about the same amount of time as before while still updating the progress bar smoothly enough for add-ons that take longer than that.

(This is not the most trivial code to test, so it is suggested to add a sleep/delay API call in `unarchive_file()` in src/addon/manager.cpp to introduce artificial delays.)

One issue with this code, however, is that because `modeless_dialog` doesn't execute its own event loop, the only way to get the dialog to be updated is to force a draw event in ourselves via the new `gui2::dialogs::modeless_dialog::force_redraw()` method. This is really a side-effect of my design choice here to run the dialog in the middle of a blocking operation instead of somewhere where events are being processed normally. I'm not entirely sure if the draw events would be pushed even in that case, however.

---

This is a re-PR of #5561"
1019332347,update codeblock,newfrenchy83,2022-08-06 12:20:47+00:00,2022-08-06 15:37:38+00:00,{'Building': 1},
1017434251,revert removefiles of list,newfrenchy83,2022-08-04 11:56:43+00:00,2022-08-05 05:08:04+00:00,{'Building': 1},all files necessary for compilation of tests in codeblock projectfiles/CodeBlocks/tests
1017195279,A modal dialog is a window,mesilliac,2022-08-04 08:12:22+00:00,2022-08-06 05:31:52+00:00,"{'UI': 1, 'Add-ons': 1, 'Help': 1}","Similar to #6935 except for `modal_dialog` and thus touches many more things.

The majority of changes are simply calling the now-explicit modal_dialog constructor with the window id of the subclass.

Some things that were in pre_show have been moved to the subclass constructor. There were several instances of specific things already ending up in the constructors because ""it needs to be done too early to put in `post_build` or `pre_show`"". This is no longer a problem, setup can and should be done in the constructor.

The `post_build` virtual callback was completely unused after refactor. It could be readded and called from the modal_dialog constructor if it is actually needed for anything.

`pre_show` and `post_show` still take window arguments, even tho these are now completely unnecessary. Similarly `get_window()` still exists and is used, even tho it just returns `this`. I simply do not want to change that many things. Some uses were updated out of necessity as the old `get_window()` was somewhat spuriously marked ""const"" but did not return a const window pointer. `find_widget` requires a non-const window pointer.

Relating to cases where a dialog was kept around even after ""show"" had finished, i added a ""hide"" for windows, which also disconnects them from the event handler. Modal dialogs thus hide after ""show"" has completed, and reconnect to the event handler on ""show"" in case there are uses that are keeping them around for later re-display.

The title screen was hanging around. I'm not sure if there are other cases. I think i saw something in the MP setup collection of dialogs that also behaved this way.

I fixed the title screen to not do that, as it wasn't even reusing itself after the game ended. In stead it was just sitting in the background and was then destroyed and recreated when returning to the title screen. It might be that dialogs don't really need to hide themselves for reshow, but i can't say there isn't a case that still does.

There may also still be things acting in pre_show in such a way that they assume their actions will be undone after show by destruction of the window. Like connecting callbacks in `pre_show`. The connections will be duplicated every time the dialog is reshown, if they are not disconnected in `post_show`. If the dialog is destroyed anyway this is irrelevant, and this is the case with most dialogs, but as above i can't say it is with all.

The biggest important change brought on by this, is that modal dialogs can now trivially animate. In stead of having to apply complex hooks in places that really shouldn't have arbitrary function hooks inserted, a dialog can simply override any of the `top_level_drawable` interface functions. This is now used by the story screen, the credits screen, and the loading screen. Any modal dialog can update animations as it wishes simply by overloading the ""update"" method, which will be called once per vsync. They should make sure to also call `modal_dialog::update()`, in case any of the superclasses also have something important to do."
1014729373,Make modeless_dialog an actual window,mesilliac,2022-08-02 07:36:42+00:00,2022-08-04 07:30:05+00:00,{'UI': 1},"Not only was it conceptually confusing that a modeless dialog was not a window, but it causes several inefficiencies and general incapabilities when converting to use the new draw system.

So here i made a modeless dialog a window. This was the easy one as there are basically no modeless dialogs right now. Basically just tooltips and the debug clock.

As a note this will slightly invalidate #5561 which also uses a modeless dialog. But any changes are minimal and can be tacked on to whichever gets merged second.

The window builder finalization stuff was moved to a method of `window` so it can be called in the modeless dialog constructor.

As far as practical usage changes go... most stuff that was previously in ""post_build"" and ""pre_show"" virtual callbacks can simply go into the subclass constructor.

Modeless dialogs now require the window id to be given as a constructor parameter. This is becaues the virtual function that is defined by `REGISTER_DIALOG` is not able to be called from the `modeless_dialog` cosntructor. It is simply called from the subclass constructor and passed on."
1013111811,Updates for Ubuntu 22.04 CI,Pentarctagon,2022-07-31 20:28:15+00:00,2022-08-06 08:03:17+00:00,"{'UI': 1, 'Lua API': 1, 'Building': 1, 'WFL': 1}","The one remaining issue is that the scons+gcc+LTO job fails when executing the boost unit tests with the error `unknown location(0): fatal error: in ""Test setup"": unknown type`, which I also haven't been able to reproduce locally."
1013050553,update codeblock test project,newfrenchy83,2022-07-31 15:27:10+00:00,2022-08-03 12:40:25+00:00,{'Building': 1},
1012948643,"Finishing some draw_manager todos, and minor cleanup",mesilliac,2022-07-31 05:02:48+00:00,2022-07-31 07:42:33+00:00,"{'UI': 1, 'Editor': 1}",
1012920055,1.17 Lower terrain,doofus-01,2022-07-31 00:21:56+00:00,2022-08-08 03:10:36+00:00,"{'Graphics': 1, 'Terrain': 1}","This is a generalized version of what was requested in #6919.  You can create some awkward situations, but that's up to the map-maker.  It's at the border instead of the hex center (like ""cliffs"" would need to be) by design.

Known issues:
1.  It's currently an overlay that makes terrain unwalkable, needs some refinement somehow, probably separate unwalkable and base-movement terrains - the unwalkable version with some sort of indicator like the mountain peaks have.
2.  Needs some variations, this is just the default so far (very little new art at this first commit)

![Screenshot_20220730_a](https://user-images.githubusercontent.com/13510196/182004394-10d0748b-d7f5-44ae-8ecb-763b8ce45262.jpeg)
"
1012580106,update codeblock projectfile,newfrenchy83,2022-07-30 09:10:22+00:00,2022-07-30 13:34:55+00:00,{'Building': 1},
1012543706,Replace deprecated wesnoth.fire_event with wesnoth.game_events.fire,Wedge009,2022-07-30 04:24:17+00:00,2022-07-30 06:32:31+00:00,"{'Campaign (any)': 1, 'Lua API': 1}","I tested and confirmed the deprecation warning and resolution for the bandits event in Eastern Invasion S5.

The only place I could find a `fire_event` within a `[move_unit]` block was the MP version of Legend of Wesmere S4 so I didn't test that one. I also didn't test World of Conquest."
1012489180,Revert Windows ClearType CA work-around,Wedge009,2022-07-30 02:07:22+00:00,2022-07-30 04:25:02+00:00,{'UI': 1},"Resolves #6908.

The work-around is no longer required due to 06b02471 (#6685).

I checked both Windows and Linux/X11 builds and the text rendering looks good to me in both. I'll merge after CI checks, assuming no objections."
1012252205,"[SoF] In S7, edit a sentence to not use awkward reuse of the word ""doubt""",max-torch,2022-07-29 18:33:34+00:00,2022-07-29 21:23:32+00:00,{'Campaign (any)': 1},Resolves #6773.
1012231382,Utbs s6 add scroll to detonation event,max-torch,2022-07-29 18:05:45+00:00,2022-08-07 06:11:29+00:00,{'Campaign (any)': 1},"One of the subitems of #6197. When Jorgin dies, the map scrolls to the place where the detonation will occur. Some shroud is removed so that the player can see the event unfold."
1012202363,"[UtBS] In S6b, add an ""explosive charge failed"" sound to event",max-torch,2022-07-29 17:24:26+00:00,2022-08-07 06:13:00+00:00,{'Campaign (any)': 1},"Used the dwarvish thunderer miss sound as a sound effect that plays in an event where a dwarf lights an explosive charge but if fails to detonate.
One of the subitems of #6197."
1011552394,Tidying up some remaining draw_manager to-dos,mesilliac,2022-07-29 04:57:20+00:00,2022-07-29 09:45:11+00:00,"{'UI': 1, 'Editor': 1, 'Units': 1, 'Help': 1}","All pretty minor, putting up for CI"
1011329085,Move simple_wml test and remove long disabled AI test.,Pentarctagon,2022-07-28 21:26:06+00:00,2022-07-30 05:07:47+00:00,"{'macOS': 1, 'MP': 1, 'Add-ons': 1, 'Building': 1}",
1010582479,[UTBS] Remove some fungus from S6,max-torch,2022-07-28 09:30:22+00:00,2022-07-29 19:12:34+00:00,{'Campaign (any)': 1},"Resolves one of the subitems of #6197.
Rationale for this PR is in the Issue thread.
Nemaara tagged as reviewer because they originally added the fungus. (git blame)
Knyghtmare because i believe he has a vision and focus for UtBS."
1010548716,[UtBS] Add series of bat screeches in the Zochtanol Isle scenario,max-torch,2022-07-28 08:58:27+00:00,2022-07-29 16:54:08+00:00,{'Campaign (any)': 1},"Resolves #6503. I tested this both with and without music enabled to the same level as the sound effects.

At worst, the player might not notice if music is on and louder than sound effects, but because the bat sound repeats 7 times it is more likely the player will notice. It also represents the fact that there are multiple bats that await.

At best, if the player falls under the demographic of players that like to play with music off, they will definitely hear the sound.

Requesting permission to merge."
1009378463,Update mainline campaigns to use screen_fade,mesilliac,2022-07-27 08:53:45+00:00,2023-02-12 16:29:36+00:00,"{'Campaign (any)': 1, 'WML Tools': 1, 'Units': 1}","According to usage, i ended up adding the macros:

 * `SCREEN_FADE_OUT` - replaces `FADE_TO_BLACK` in most cases
 * `SCREEN_FADE_IN` - replaces `FADE_IN` in most cases
 * `SCREEN_FADE r g b duration` - convenience wrapper for `[screen_fade]` with 255 alpha. Mostly used internally.
 * `SCREEN_UNFADE duration` - convenience wrapper for `[screen_fade]` with 0 alpha. Mostly used internally.
 * `FLASH r g b actionWML` - like `FLASH_WHITE` etc but takes a colour
 * `FLASH_LIGHTNING actionWML` - flashes an appropriate colour and plays `lightning.ogg`

The `FLASH_WHITE`/`RED`/`GREEN`/`BLUE` macros were updated to use `screen_fade`.

All mainline campaigns were updated to use these or `[screen_fade]` over `[color_adjust]`, as appropriate. There are only a couple remaining uses of `color_adjust` that weren't obvious to switch, and nothing needed the old `FADE_TO_BLACK` behaviour."
1008981833,Saurian Spearthrower tree,czyzby,2022-07-26 21:30:18+00:00,2022-10-27 04:17:22+00:00,"{'Graphics': 1, 'Units': 1}","This pull requests is a part of the effort to bring units that are used by mainline campaign candidates (see #6905, #6875). It contains an alternative upgrade of the Saurian Skirmisher from the [Saurian Pack add-on](https://github.com/czyzby/wesnoth-saurian-pack).

The pull request consists of the following changes:

* Saurian Spearthrower unit is added. This level-2 unit is a mixed fighter with a stronger ranged attack designed as an alternative upgrade of the Saurian Skirmisher.
* Saurian Javelineer unit is added as an upgrade of the Saurian Spearthrower. It's a steady upgrade to the Spearthrower, gaining stronger melee and ranged attacks.
* `ENABLE_SAURIAN_SPEARTHROWER` macro is added to allow campaigns and scenarios to turn on the Skirmisher→Spearthrower upgrade.

When compared to the Ambusher and Flanker, these units lack the skirmisher ability and deal 1 less hit in melee, but make up for it with a stronger ranged attack and slightly more HP.

During reviewing the PR in terms of the sprites and balance, please consider that these units are mostly meant for campaigns and UMC. They are _not_ available in the default eras. While the proposed stats should be looked into before merging, these units do not have to be balanced in the context of the mainline drakes faction."
1008951115,Saurian Augur level-3 upgrades,czyzby,2022-07-26 20:48:41+00:00,2023-10-07 04:50:22+00:00,"{'Graphics': 1, 'MP': 1, 'Units': 1}","This pull requests is a part of the effort to bring units that are used by mainline campaign candidates (see #6905, #6875). It contains the level-3 upgrades of the Saurian Augur from the [Saurian Pack add-on](https://github.com/czyzby/wesnoth-saurian-pack).

The pull request consists of the following changes:

* Saurian Prophet is added as an upgrade of the Saurian Oracle.
* Saurian Seer is added as an upgrade of the Saurian Soothsayer.
* Saurian Soothsayer is replaced by the Saurian Seer as a possible leader of the Age of Heroes Drakes faction.
* Saurian Oracle is replaced by the Saurian Prophet as a possible leader of the Age of Heroes Drakes faction.
* Saurian Prophet and Saurian Soothsayer level up experience values are adjusted accordingly to support the new upgrades.

The following issues might have to be addressed:

* Since the units are added to the mainline, they have to meet the sprite quality and balancing standards.
* Unit descriptions are currently reused from the level-2 units. Custom descriptions might have to be prepared.
* Saurian Prophet sprites were based on the recolored Oracle’s sprites. During the recolor, dark grayish blue was replaced with dark brown, which worked well for things like the armor shadows, but does not fit other areas such as the body outlines where it does not complement the dark green as well. Dark blue color should be restored in some areas of the sprites where it fits better than the current palette.
* ~~Animations of the Saurian Seer’s pauldron fringes in NE frames are missing, and might be added based on the SE sprites.~~
  * New Seer animations are a work in progress."
1008937616,distinguish noun from verb,celerini,2022-07-26 20:31:02+00:00,2022-08-13 16:12:26+00:00,{'UI': 1},I added contexts to the word Recruits to be able to translate it by proper Czech words.
1007911516,Populate active_addons_ when all add-ons are enabled.,Pentarctagon,2022-07-26 00:20:28+00:00,2022-07-26 15:05:00+00:00,{'Units': 1},"When loading into different screens prior to actually starting or joining a game, Wesnoth loads the configs of all add-ons, otherwise it wouldn't know to display eras, campaigns, etc for selection. However starting with a4e8ac339eabcd94f337ad809d10de2a70272ba7, when loading all add-ons the `active_addons_` variable was no longer being populated with any of the the add-ons that were active. This meant that when checking to see if any of the active add-ons had changed it could falsely determine that nothing had changed and therefore could skip the step where it actually deactivated add-ons.

As an example of the current state prior to this fix:
* Player starts Wesnoth and joins the multiplayer lobby -> all add-ons are active, but `active_addons_` is empty.
* Player joins a game with no add-on content required -> Wesnoth checks the add-ons required for the game (none) against the contents of active_addons_ (empty).
* Wesnoth therefore determines that it doesn't need to deactivate any add-ons since it thinks no add-ons are active, when in fact all add-ons are active.
* Out of sync errors then happen if any of the players that join have add-ons installed that can globally affect other unit_types, such as [resistance_defaults], since those add-ons haven't been correctly deactivated.

The fix then is to make sure that game_config_manager::set_enabled_addon_all() correctly populates active_addons_ when it's called.

Fixes #6650"
1006631742,1.17 human magi sprite cleanup,doofus-01,2022-07-24 21:52:07+00:00,2022-07-25 00:28:14+00:00,"{'Graphics': 1, 'Units': 1}",part of #6417 
1006615557,New alternative Saurian Skirmisher upgrade,czyzby,2022-07-24 20:04:24+00:00,,"{'Enhancement': 1, 'Graphics': 1, 'MP': 1, 'Units': 1}","This pull request adds the following saurian units to the core:

* Saurian Guard: Saurian Skirmisher alternative upgrade.
* Saurian Sentinel: Saurian Guard final upgrade.

Additionally, the core Drake factions are modified as follows:

* Saurian Guard can now be a leader of the default Drakes faction.
* Saurian Sentinel can now be a leader of the Age of Heroes Drakes faction.
* Saurian Guard can now be recruited by the Age of Heroes Drakes faction.

Points of concern that should be discussed before merging this PR:

**`1)`** Naming

If there's one thing I usually struggle with, that would be naming things. I'm not sure if Spearwoman→Warden are the best fitting names for the saurian warriors. Especially since there's a Drake Warden in the same faction.

@Jonathan-Kelly has suggested Spearthrower→Javelineer - I've actually considered those before, but since I'm not sure if ""spearthrower"" is a valid word in the first place, I decided to go with unit names that are less focused on the spear-throwing aspect and emphasize their defensive abilities instead.

As a side note, the descriptions of the new units might have to be updated or replaced.

**EDIT:** For now, it settled on Guard→Sentinel, but I'm still open to suggestions. Spearthrower→Javelineer might be used for a campaign unit with the legacy sprites (see #6912).

**`2)`** Sprites

I did my best, but these are still mostly recolored original sprites with some stuff thrown on top. I think I mostly followed the convention for saurian upgrades, but it has to be decided whether they fit the mainline standards in the first place.

**EDIT:** @doofus-01 has proposed a revised sprite for the guard unit. Might need some time to update the animation frames. The current WIP basic sprites can be seen here:

![Base frames](https://user-images.githubusercontent.com/11707612/181102420-8a4d2530-0e92-45d0-8b05-be1a615c1285.png)

**`3)`** Balancing

The unit statistics were discussed with and adjusted by @Hejnewar, and I've also done some playtesting vs AI locally. Although they seem fine on paper, they have to be looked into and approved.

**EDIT**: A change of the attack types was considered from pierce to blade or impact, along with a replacement of the spear weapon with a glaive.

**`4)`** Factions

The new alternative upgrade changes the Skirmisher unit tree quite significantly. Rather than just fragile skirmishers, saurian warriors would be able to be advanced to a more defensive variant with a better ranged attack and the first strike ability. This might change how the Drakes play against factions with common access to pierce attacks such as the Loyalists.

* Should Guards be available as leaders of the default Drakes faction? With 6 speed and lack of the skirmisher ability, I believe they conform to the core leader requirements. 
* Should Guards be available in the default era at all? As an alternative, they could be an optional upgrade for campaigns and add-ons, similarly to how the Dwarvish Arcanister tree is handled."
1006583337,1.17 merfolk sprite palette cleanup,doofus-01,2022-07-24 16:54:46+00:00,2022-07-24 20:03:12+00:00,"{'Graphics': 1, 'Units': 1}",part of #6417 
1006567611,Use start.sh to enable logging to file for Steam Linux.,Pentarctagon,2022-07-24 15:24:49+00:00,2022-07-24 18:43:41+00:00,{},
1006446771,1.17 dwarf sprite cleanup,doofus-01,2022-07-24 01:25:00+00:00,2022-07-24 04:30:49+00:00,"{'Graphics': 1, 'Units': 1}",part of #6417
1006420305,1.17 drake sprite cleanup,doofus-01,2022-07-23 21:03:02+00:00,2022-07-24 01:33:15+00:00,"{'Graphics': 1, 'Units': 1}",part of #6417 
1006278272,Handle non-hex-sized images when cropping to hex,mesilliac,2022-07-23 05:03:19+00:00,2022-07-24 10:03:34+00:00,{'Graphics': 1},"Images that are not 72x72 are centered and cropped before masking.

This fixes the inconsistent masking in SoTA (#6118)."
1004986625,Video interface refactor and clean,mesilliac,2022-07-22 03:41:11+00:00,2022-07-24 10:06:33+00:00,"{'UI': 1, 'Editor': 1, 'Units': 1, 'Lua API': 1, 'Help': 1}","This is addressing the remaining TODOs for the high-dpi work (not including the ongoing hardware acceleration work). Particularly it focuses on cleaning up and making sure the video interface is correct, and on cleaning up the systems to do with drawing in response to events, in particular window resize events and the now-obsolete ""draw"" type events.

1. I overhauled the video interface, previously known as the `CVideo` class. In stead of acting on a singleton class, this interface is now a `video` namespace. So functions such as `CVideo::get_singleton().draw_area()` are now accessed via `video::draw_area()`.

2. There was a large internal rearrangement and overhaul of the video interface. Many functions were removed or renamed. Many were checked for correctness and fixed. Most notably the whole ""fake"" video system was reworked to clearly differentiate normal operation from ""headless"" operation from ""testing"" operation.

3. Video resizing was overhauled. It should now work much better in all cases. The display will auto-resize as the user resizes the window in real-time, and it should do so without glitches, missing areas, flashing black rectangles, and glitching UI in the wrong resolution.

4. The interface for drawing was clarified. ""DRAW"" events are now no longer used, as drawing is handled via the draw manager. ""DRAW_ALL"" events are also no longer used, as screen invalidation is handled by the draw manager.

5. The `display` class was cleaned to make use of the improved video interface, and to remove various bugs relating to flickering and resizing.

6. Size calculations and coordinate spaces were clarified and verified (and in some cases fixed). Such calculations should now also work correctly for custom render targets.

7. Input space calculations were also clarified and fixed - notably there was a single-render-pixel offset in some situations that was not previously accounted for.

8. `texture` objects now store their source region for blits internally. This cleans up and clarifies usage, particularly whether the source region is specified in draw space or texture space.

These changes were mostly related and intertwined. I squashed a lot of the individual fixes and changes together into single commits where reasonable, so it should generally make sense. But on the whole it's easiest just to apply this all as one big chunk."
1004167359,Fix the description of concealment,Discontinuum,2022-07-21 13:01:20+00:00,2022-07-21 16:21:15+00:00,{},"It affects all villages, water villages included. I don't see it practical to try to recreate the described behaviour cause concealment's been working for all village types for 12 years already https://github.com/wesnoth/wesnoth/commit/630b08078c8c14a18a8e046166af6a8ebc0d5f5a the commit made Oct 2008. So let's just fix the description to reflect the reality"
1003452318,Add --log-to-file command line option.,Pentarctagon,2022-07-21 03:16:51+00:00,2022-07-24 14:22:51+00:00,"{'Docs': 1, 'Command Line': 1}","This option sets up writing both the cerr and cout streams to a log file, as well as pulls the log rotation logic out of log_windows.*pp into the general logger.

Note that this is meant for usage on macOS and Linux, not Windows. log_windows.*pp has additional functionality in it, as well as a fair bit related to the --wconsole option.

---

Testing locally this seems to work fine, though the fact that this wasn't done years ago makes me wonder if there's something obvious that I'm missing."
1003392861,Several more invasive fixes arising from general tidyup,mesilliac,2022-07-21 02:35:48+00:00,2022-07-22 03:07:59+00:00,"{'UI': 1, 'Editor': 1, 'Units': 1, 'Help': 1}","Notable items:
* tod_hex_mask is now hardware accelerated... whatever this is. There are no examples using it in mainline so i'm not sure it works correctly. But it should.
* HP/XP bars are now rendered in hardware, using the single-pixel image from my last PR.
* Unit animation invalidation code has been updated to properly account for zoom.

Re the HP/XP bars i ended up supporting the custom bar stuff, although it's confirmed to be unused by anything. Might still be better to do this by drawing rectangles, as it would give a better result when zoomed. I had an implementation for that too, but i discarded it as broken... turns out that was due to an unrelated bug.

Re the animation invalidation, this should address #6589 and maybe #6891... i confirmed it also fixed some leftovers from movement and attacking animations when zoomed in, so it might fix other bugs as well. This fix could probably be backported to 1.16

The rest of the stuff here is general cleanup."
1002119897,Added a variation to the Royal Guard portrait to fix an anachronism,Descacharrado,2022-07-20 12:37:56+00:00,2022-09-04 10:48:23+00:00,"{'Graphics': 1, 'Units': 1}","Converted the image from the issue using optiwebp

The preprocessor nesting is not pretty, I know that, but I preferred that to modifying the unit line in every affected campaign because the change will be easier to find and edit in the future.

There are some problems that arise:

1. The LoW campaign extends beyond the SoF in the timeline, so the later half of the campaign (after the SoF is created) will have Royal Guards without a sceptre drawn over their armor, maybe thats ok.
2. Maybe all campaigns up to (and including) HttT should be included and not just up to SoF, as the sceptre is not found until then.
3. This creates image redundancy, instead of this maybe it would be preferrable to have overlays to a base image, although that is something that could be done in the future once/if we want to have something drawn over the units armor (e.g. a coat of arms).

Closes #6431 "
1001874572,update codeblock for gcc11,newfrenchy83,2022-07-20 09:33:17+00:00,2022-07-20 09:39:50+00:00,{'Building': 1},
1001613022,Some small improvements and fixes,mesilliac,2022-07-20 05:18:18+00:00,2022-07-21 00:16:05+00:00,"{'Graphics': 1, 'UI': 1}","These are just some easy-to-pull-out fixes and improvements to base tools that i'm pulling out of my video system tidyup.

* Added some additional convenience methods on sdl/point, sdl/rect, sdl/window
* Added a single-white-pixel PNG. This is useful for drawing filled rectangles by blitting it as a texture with colour and alpha mod.
* Added an `update()` method to the top-level-drawable interface
* Improved how the draw-manager handles adding and removing TLDs, especially while iterating over them
* Allowed blit helpers to use chained method calls for setup - so you can now call `drawing_buffer_add(...).set_alpha(200).set_color(c)` etc.
* Fixed sdl/texture to properly set blend mode when creating from surface
* Fixed the `--render-image` comandline option to run without GUI and also work when --nogui is used.

For the draw manager / TLD change, i also documented a lot of how the process is supposed to work.
In summary all top-level-drawable objects (e.g. windows, tooltips, dialogs) have a chance to execute a function in each of four distinct phases every vsync frame. They are, in order:
1. `update()` - change variables, process animations, update anything that might affect layout
2. `layout()` - ensure that positioning information is up-to-date
3. `render()` - perform any offscreen rendering necessary in preparation for draw
4. `expose()` - draw to the screen

`layout()` and `expose()` are mandatory to implement. `update()` and `render()` are optional.

It already worked like this, i just added the `update()` stage."
1001084033,Additional event attributes,CelticMinstrel,2022-07-19 18:01:43+00:00,,"{'Unit Tests': 1, 'Lua API': 1, 'Schema': 1}","These are the extra features that were pulled from #5663, as a draft for future reference."
1000473379,Schema: the [fire_event][data] tag is optional,stevecotton,2022-07-19 08:31:53+00:00,2022-07-19 11:09:30+00:00,{'Schema': 1},"Fixup for 715cf386, planning to merge when the CI finishes."
1000218476,Fix assertion when opening the gamestate inspector while disabled events haven't been cleaned up,CelticMinstrel,2022-07-19 02:00:42+00:00,2022-07-19 17:48:04+00:00,{},Fixes #3257
998943354,Automatically append std::endl to all log messages,mesilliac,2022-07-18 06:10:45+00:00,2022-07-20 03:20:57+00:00,"{'AI': 1, 'MP': 1, 'UI': 1, 'Editor': 1, 'Units': 1, 'Lua API': 1, 'Add-ons': 1, 'WFL': 1, 'Help': 1, 'Schema': 1, 'Terrain': 1}","There is no reason not to do this for general logging functions. They print names and timestamps, so cannot be sensibly concatenated without newlines.

I added a `STREAMING_LOG` replacement for `PLAIN_LOG` in the few instances relying on piecemeal output. It doesn't append the newline.

Everything else had its newline taken off, mostly via overly complex sed command.

Surprisingly this only touched a little over half the files in the project..."
998557961,1.17 Ghost-line animations,doofus-01,2022-07-17 04:18:59+00:00,2022-07-17 21:13:28+00:00,"{'Graphics': 1, 'Units': 1}","This is to address #6825, most work going into finishing the nightgaunt."
998553169,General `map-diff` improvements,macabeus,2022-07-17 03:35:27+00:00,2022-08-09 12:54:14+00:00,{},"This PR adds a set of fixes and improvements on `map-diff`:
- fix bug when reading a wml attributes with comments (https://github.com/wesnoth/wesnoth/issues/6862)
- fix bug when reading terrains like `_off^_usr` (https://github.com/wesnoth/wesnoth/issues/6862)
- changes map order on the image output (https://github.com/wesnoth/wesnoth/issues/6862)
- change focus color to pink (https://discord.com/channels/231976805987385345/259976436490829825/997976827131854991)
- add axis and changes notes on the image

You can see a full example on my test repository: https://github.com/macabeus/wesnoth/pull/17

![image](https://user-images.githubusercontent.com/9501115/179383332-985d8c17-4ce7-41d9-a75a-5fcd99731c1e.png)

![image](https://user-images.githubusercontent.com/9501115/182044244-d000b9ee-55a9-458c-a084-4ad1a17f76a8.png)"
998474833,1.17 (test scenario) out-of-hex unit animation tests,doofus-01,2022-07-16 18:16:03+00:00,2022-07-25 03:22:47+00:00,{'Graphics': 1},"This is for testing #6589, as well as looking at how ellipse and HP bar move with sprite in progressive y= key"
998324240,preferences: Adjust show_deprecation default to coincide with usage,mesilliac,2022-07-16 02:05:49+00:00,2022-09-03 15:44:59+00:00,{'UI': 1},"If unset it has different behaviour in dev branch when checked (defaulting to yes). However this was not reflected in the actual prefs dialog which clearly said that it was ""no"".

This is a bit ugly... but well the default is set statically in `data/advanced_preferences.cfg`, so...

Also usage of bool preferences and how the default values work is horribly wrong everywhere, as the default value must be given by the code that tries to access the value. But they don't know the default value. So they make something up. Which leads to situations such as this one where it does not match the actual default value and wrong shit happens."
998187752,Update WoF,Jonathan-Kelly,2022-07-15 21:07:35+00:00,2022-08-19 00:07:16+00:00,"{'Enhancement': 1, 'Campaign (any)': 1, 'Graphics': 1, 'MP': 1, 'Audio': 1, 'Units': 1}","Issues #6847 and #6706 should be addressed by these changes, as well as most all issues and change requests (regarding WoF) made by players and developers up to this point.

It looks like we now have (including WoF) three in development mainline campaigns all using the four new saurian advancements sprites created by the talented @czyzby. So I thought it might make the most sense to add these to core rather than them becoming three separate copies of campaign specific units. Also, I went a step further and hooked them up to the multiplayer drakes faction since I believe their statistics were already balanced by @Hejnewar (?) and we are still over a year away from the next major release. They might help make drakes-v-loyalists and drakes-v-drakes matches more interesting with more unit types becoming useful during these?

This adds a WoF specific unit, a powerful level 5 air elemental, which may also be worth considering in relation to #5532. The sprite is from an [older version of EoMa](https://units.wesnoth.org/1.10/Era_of_Magic/en_US/EoMa_Air_God.html) from the BfW 1.10 time period. @inferno8 let me know if you have any issue with this sprite being used in mainline. I really enjoy how ominous and otherworldly it is (the same goes for your fire and water elementals)."
997578268,Update INSTALL.md,m4fi01,2022-07-15 09:57:06+00:00,2022-08-07 05:29:49+00:00,"{'Needs more info': 1, 'Docs': 1}",just a little edit to package name for easy installation
996092425,"Submerge items on water, just like units",mesilliac,2022-07-14 01:10:54+00:00,2022-07-30 02:56:38+00:00,"{'Campaign (any)': 1, 'Graphics': 1, 'Editor': 1, 'Lua API': 1, 'Schema': 1}","This is addressing #1146.

As per the comments in #1146 I made a change to simply use the same submerge code as units, for items. So when an item is placed on water it partially submerges. This fixes the visual appearance when a unit is swimming on top of the item, and also IMO makes items in water look a whole lot better.

There are one or two situations in which the item probably should not be submerged. It can be seen below, with the target circle. This could be fixed by using ""halo"" in stead of ""image"" in the item definition, so it draws over units in stead of under them.

It might make sense to have a separate ""floating"" item type, like say for debris that is actually floating on the water. There would need to be an implementation to split the item into two halves, one drawn in front of the unit and one drawn behind, as for unit ellipses. However unless there's an actual use case where this is required i don't want to speculatively implement it.

Here's the new look:
![submerge](https://user-images.githubusercontent.com/243646/178862538-86b81682-09b9-4f12-97db-ad4da4234a96.jpg)

And the old look for comparison:
![nosubmerge](https://user-images.githubusercontent.com/243646/178862555-a5f2bfb0-8cd2-4ef9-870e-339fce337ded.jpg)"
995791603,Don't include <iostream> in every single file,CelticMinstrel,2022-07-13 18:00:32+00:00,2022-07-14 06:13:33+00:00,"{'MP': 1, 'Add-ons': 1}","We don't want std::cerr to be used at all, and std::cout is only for certain special
cases such as command-line responses.

Therefore, log.hpp should not include `<iostream>`.

This is open as a PR to make sure there are no CI failures."
995420968,update codeblocks projectfiles,newfrenchy83,2022-07-13 12:13:05+00:00,2022-07-13 12:15:06+00:00,{'Building': 1},
994942236,Add new [screen_fade] WML action,mesilliac,2022-07-13 01:52:22+00:00,2022-07-15 13:32:20+00:00,"{'Lua API': 1, 'Schema': 1}","This is an implementation of FR #6745 . As mentioned there it is a new interface action WML tag `[screen_fade]`, which can fade the game display to a given colour over a given duration.

It has the following format in WML:
```
[screen_fade]
	duration=(ms) #if 0 the effect is instantaneous
	red,green,blue=(0-255,0-255,0-255)
	alpha=(0-255)
[/screen_fade]
```

The fade is persistent, so after fading to a colour that colour is kept as an overlay on the game map until a fade to 0 alpha is performed.

I already implemented fading in #6855 so this is just the WML interface.

Unlike the `[color_adjust]` tag, this one also covers units and halos. And also unlike `color_adjust`, `screen_fade` is hardware accelerated.

I also added a flashy event to the test scenario to make sure that it works."
994229041,Soliton  patch 9,soliton-,2022-07-12 12:29:04+00:00,2022-07-12 12:29:27+00:00,{'MP': 1},
993336334,TSG S4 Fixed replay OOS on victory event,Descacharrado,2022-07-11 16:53:05+00:00,2022-07-15 16:52:36+00:00,{'Campaign (any)': 1},Part of #6832
992420320,Combine windows jobs into a matrix,soliton-,2022-07-10 13:05:42+00:00,2022-07-10 14:37:44+00:00,{},
992312003,Split ubuntu build into separate steps (based on PR #6856),soliton-,2022-07-09 22:09:06+00:00,2022-07-10 12:24:15+00:00,{},
992267876,Split macos build into separate steps,soliton-,2022-07-09 16:35:42+00:00,2022-07-10 11:44:23+00:00,{},
992209538,A draw manager. To manage drawing to the screen.,mesilliac,2022-07-09 11:16:16+00:00,2022-07-13 01:34:52+00:00,"{'macOS': 1, 'Graphics': 1, 'UI': 1, 'Editor': 1, 'Units': 1, 'Lua API': 1, 'Add-ons': 1, 'Building': 1, 'Help': 1}","This is now basically feature-complete and fully functional.

It is a complete overhaul of the way things are drawn to the screen.

In summary:

 * objects no-longer draw by hooking a draw event. In stead they inherit from a new (mostly-)abstract base class `gui2::top_level_drawable`, and implement its interface.
 * the gamemap now renders to an offscreen buffer. This is used to implement hardware scrolling, and to redraw after halos, floating labels etc. move.
 * halos, floating labels, tooltips, and a few more things are now drawn on top of the gamemap, rather than as part of it. This allows them to be updated independently without reading pixels from the screen.
 * surface restorers have been removed. Reading pixels from the screen should now be unnecessary excepting two cases: (a) screenshots, (b) background blur. Blur is cached, and screenshots are occasional.
 * GUI2 widgets no longer keep track of dirty state. They are redrawn as necessary. Most places which previously set dirty state now queue a redraw in their part of the screen in stead.
 * A consequence is that active translucency is enabled across all UI elements, and the game display can (and does) continue to animate while menus and dialogs are showing.
 * performance is drastically increased for basically everything, most notably map scrolling, floating text, and halos.
 * CPU usage is drastically decreased. With animations disabled it is essentially zero while nothing is moving.
 * GPU usage is also minimal. The display is only flipped if something is drawn.

I haven't merged with new_rendering yet, but that shouldn't be too much trouble. For now i'm putting this up in a state that can be tested. There will be bugs. But there shouldn't be anything too major or insoluble.

Apologies for the megacommit, but it really was a mess. Easier just to commit the final cleaned version than try to preserve any separable changes."
992142926,Print vcpkg_abi_info.txt contents.,Pentarctagon,2022-07-09 04:09:18+00:00,2022-07-09 04:09:23+00:00,{},"The only suggestion that came up was checking to see if something in this file changed between when the vcpkg cache is used vs isn't used, so... print out the contents of a random dependency and then check back later I guess."
991544363,Re-add an <fstream> include for GCC 11,stevecotton,2022-07-08 11:22:51+00:00,2022-07-08 15:35:07+00:00,{'UI': 1},"3874fe5f0 compiled okay on the CI, but it seems it was relying
on an implicit include somewhere. GCC 11.3.0 requires this."
991101474,Remove one more std::cerr.,Pentarctagon,2022-07-08 02:15:29+00:00,2022-07-08 03:30:46+00:00,{},"---

Letting this go through CI just in case first."
991050397,Add raise_user_interact calls to Lua CAs,mattsc,2022-07-08 01:00:15+00:00,2022-07-13 02:57:16+00:00,"{'AI': 1, 'Lua API': 1}",
990553193,MP Create Game dialog: improve error handling,mattsc,2022-07-07 17:06:47+00:00,2022-07-09 13:52:11+00:00,"{'MP': 1, 'UI': 1, 'Terrain': 1}","This PR causes all map errors to be handled identically in the Create Game dialog.  The behavior is now the same for all errors, as well as for maps provided via both `map_file=` and `map_data=`; errors are always displayed in the description under the minimap; none of them causes the game to fall back to the main menu; and none of them allows advancing to the next dialog.

This addresses the additional issues discussed after #1346 was closed."
989925129,update codeblock projectfiles,newfrenchy83,2022-07-07 09:30:55+00:00,2022-07-07 11:05:53+00:00,{'Building': 1},remove unused tracer.cpp source file
989648765,GUI2/minimap: Mark minimap dirty when updating,mesilliac,2022-07-07 04:15:43+00:00,2022-07-07 07:48:21+00:00,{'UI': 1},Aimed at fixing #6844 
988251672,Stop directly using std::cerr in most places,Pentarctagon,2022-07-06 06:11:46+00:00,2022-07-07 01:11:11+00:00,"{'AI': 1, 'MP': 1, 'UI': 1, 'Lua API': 1, 'Add-ons': 1, 'Building': 1, 'WFL': 1, 'Help': 1, 'Schema': 1, 'Terrain': 1}",
987461483,add GLIBCXX_USE_DEPRECATED=0 in codeblock projectfiles,newfrenchy83,2022-07-05 13:48:37+00:00,2022-07-05 13:57:12+00:00,{'Building': 1},This is for stop using of deprecated variable in boost
987057733,Clear minimap render textures,mesilliac,2022-07-05 06:51:14+00:00,2022-07-05 10:24:21+00:00,{'UI': 1},Aimed at fixing #6836 
986903832,Backport scroll lock fix,mesilliac,2022-07-05 01:00:04+00:00,2022-07-05 05:16:59+00:00,{},The simple parts of https://github.com/wesnoth/wesnoth/pull/6840
986902085,Fix being unable to interact with units when scroll lock is active,mesilliac,2022-07-05 00:54:09+00:00,2022-07-05 05:14:44+00:00,{},Fixes #6759 
986748148,"Revert ""update codeblock projectfiles""",newfrenchy83,2022-07-04 18:44:10+00:00,2022-07-05 01:21:16+00:00,{'Building': 1},Reverts wesnoth/wesnoth#6838
986729568,update codeblock projectfiles,newfrenchy83,2022-07-04 18:11:35+00:00,2022-07-04 18:13:44+00:00,{'Building': 1},
986565682,Some miscellaneous additions and minor refactoring,mesilliac,2022-07-04 14:51:08+00:00,2022-07-05 05:13:34+00:00,{},"Added some utility methods to `sdl::texture`, scalar multiplcation and division for `sdl::point`, and changed CVideo render target functions to use `sdl::texture` in stead of `SDL_Texture*`"
985729314,fix compilation issue in src/test/main.cpp,newfrenchy83,2022-07-03 13:52:59+00:00,2022-07-03 18:09:57+00:00,{},Fix https://github.com/wesnoth/wesnoth/issues/6834 issue in wait of best resolving.
985645587,See if deleting the vcpkg executable keeps it from trying to rebuild …,Pentarctagon,2022-07-03 05:09:28+00:00,2022-07-03 16:23:09+00:00,{},…all dependencies.
985602496,Fixed Warden’s and Arbiter’s animations popping on water tiles backport,Descacharrado,2022-07-02 22:27:40+00:00,2022-07-03 00:29:09+00:00,{'Units': 1},"Backport of #6828 

~Note: I hope I cherry-picked correctly, this is my first time backporting using only git and this is why I'm opening a PR instead of commiting directly.~

Yup, I did not, 95b3225 solves changelog conflicts."
985593603,Skip vcpkg setup if the cache exists already.,Pentarctagon,2022-07-02 21:10:59+00:00,2022-07-02 21:11:05+00:00,{},
985567681,Fixed Warden’s and Arbiter’s animations popping on water tiles.,Descacharrado,2022-07-02 18:09:45+00:00,2022-07-02 21:39:18+00:00,{'Units': 1},"Previously, part of these drakes were popping out of the water during attack and defense animations because their images were bigger than a hex. This adds hand-picked submerge values that makes the animation feel more connected on water.

Closes https://github.com/wesnoth/wesnoth/issues/6508"
985531037,Run Boost unit tests on MacOS CI,CelticMinstrel,2022-07-02 14:02:49+00:00,2022-07-06 02:43:13+00:00,"{'macOS': 1, 'CI': 1}",Currently this is just to test if it even works. I'm not sure whether or not it's a good idea.
985501265,Hardware unit submerge effect using SDL_RenderGeometry,mesilliac,2022-07-02 10:30:52+00:00,2024-04-03 17:00:28+00:00,"{'Graphics': 1, 'Building': 1, 'SCons': 1, 'CMake': 1}","I'm putting this here without any intention of merging it, because it depends on SDL 2.0.18.

It does however pretty much complete moving the set of on-the-fly unit sprite effects to hardware manipulations.

This PR has three things:
1. An API function `draw::smooth_shaded` to draw a texture to a rectangle with specified colour modifier (including alpha) and UV texture coordinate at each corner. It linearly interpolates these values between the corners. It does this using `SDL_RenderGeometry`, which is only available in SDL version 2.0.18 and above.
2. An implementation of the unit submerge effect using the above API function.
3. A flag `ENABLE_RENDERGEOMETRY` added as an option in CMake and SCons, to optionally enable the use of the above.

Currently it works. It is, however, quite intrusive, and there are a lot of those ENABLE_RENDERGEOMETRY checks. Also the code it touches is quite likely to change, and might even get completely redone in the future. I don't want to have to maintain this while that happens.

This will however provide a good base if someone wants to implement this later. Either if the minimum SDL version progresses enough that it can be put in as is, or if this section of code becomes stable enough that it can be put in with the `#ifdef` checks, or if the game moves to a graphics framework supporting fragment shaders. The implementation here should port directly to pretty much any GPU framework."
985445845,Add PLAIN_LOG logging macro.,Pentarctagon,2022-07-02 03:28:38+00:00,2022-07-02 14:44:21+00:00,{},"This logs the provided text always, and without adding the log domain or timestamp. This is meant to be a replacement for std::cerr/std::cout, but that also goes through the normal logging logic as well."
985437867,Perform unit highlight and frame tint effects in hardware,mesilliac,2022-07-02 02:25:30+00:00,2022-07-02 09:03:43+00:00,{'Units': 1},"I managed to get an effect that reproduces previous behaviour.

Some improvements could be made for things like the unit poisoning tint effect, but it would probably be better to revisit this when using GPU shaders is a possibility.

For now this does some semi-nasty hacks involving blitting one to four copies of the image depending on the effects used. This is still very cheap to do in hardware, so is fine for now. This should greatly improve performance for effects that animate colour tint, such as the flashing effect when clicking on an owned unit and some missile effects.

The tint effect is 1:1 identical to that in 1.16 for fully opaque pixels. It may differ slightly for translucent pixels. There's not much that can be done about that without shaders."
985423859,"Tweak debug representations of color_t, point and SDL_Rect",mesilliac,2022-07-02 00:48:55+00:00,2022-07-03 00:31:11+00:00,{},"These were somewhat inconsistent, and could be difficult to read. This only affects how these are written to an ostream.

It's basically as discussed in https://github.com/wesnoth/wesnoth/pull/6814#issuecomment-1171870532

The previous representations were:
```
color_t(255, 60, 140, 255) --> ""255 60 140 255""
point(10,25) --> ""10,25""
SDL_Rect(3, 15, 22, 89) --> ""x: 3, y: 15, w: 22, h: 89""
```

The new representtions are:
```
color_t(255, 60, 140, 255) --> ""#ff3c8c""
color_t(255, 60, 140, 128) --> ""#ff3c8c80""
point(10,25) --> ""(10,25)""
SDL_Rect(3, 15, 22, 89) --> ""[3,15|22,89]""
```

The vertical bar in the rect representation is to differentiate the second pair as a size, not a position, and also (along with the square brackets) to make it clear that it's a rect, not some other 4-integer-element object.

The reasoning for this change is to make the representations both compact and clear for easy parsing in logs and debug output."
985389267,Boost unit tests: fix Xcode warnings,mattsc,2022-07-01 22:31:50+00:00,2022-07-02 01:00:56+00:00,"{'macOS': 1, 'Building': 1}",Making this a PR to ensure this works in other OSs as well.
984496951,Update Death Squire and Bone Knight units,knyghtmare,2022-07-01 04:04:12+00:00,2022-07-01 06:41:03+00:00,"{'Enhancement': 1, 'Units': 1}","- [x] Skeleton Rider : primary attack icon update to `attacks/axe-undead.png`
- [x] Bone Knight: primary attack icon update to `attacks/axe-undead.png`
- [x] Bone Knight: Filename change to `Skele_Bone_Knight.cfg` (to be in-line with the rest)
- [x] Bone Knight: Melee attack damage 8 -> 10
- [x] Bone Knight: HP 48 -> 50
- [x] Bone Knight: MP 7 -> 8
- [x] Bone Knight: Cost 35 -> 26
- [x] Death Squire: attack icon update to `attacks/sword-orcish.png`
- [x] Death Squire: Filename change to `Skele_Death_Squire.cfg` (to be in-line with the rest)"
984368676,[WC] Cleanup macro+translatable string usage,Pentarctagon,2022-06-30 23:31:11+00:00,2022-07-01 15:21:40+00:00,{'Campaign (any)': 1},"I believe this should also resolve #5114, as well as just generally makes it easier to see what text is being used when reading the code."
984224929,Sound path,mattsc,2022-06-30 19:49:48+00:00,2022-07-01 23:17:58+00:00,{'Engine': 1},Making this a PR only to make sure I am not missing something and CI passes.
984001670,Add no-unit error message for unit debug command,mattsc,2022-06-30 15:36:04+00:00,2022-07-01 22:41:27+00:00,{'UI': 1},"This adds an error message when the `:unit` debug command fails because no unit is selected or hovered over, as suggested in #6116"
983906185,Fix seg fault when weapon is removed during attack,mattsc,2022-06-30 14:19:53+00:00,2022-07-01 22:47:19+00:00,"{'Units': 1, 'Fwdport': 1}","Events during attacks may modify either of the units involved. If, as a result, one of the units does not have a weapon of the type used any more, this previously caused a segmentation fault in unit_attack() in udisplay.cpp. The solution is to set the remaining number of strikes for the unit to zero. This prevents that unit from striking again, but lets the opponent continue its attack.

I have confirmed that this fixes both #4927 and #5914. That's also the reason why this is based on 1.16, because the save provided in one of the issues is for 1.16.  Obviously, if this is merged, it should be forward ported as well."
983806275,A thin wrapper for SDL_Rect,mesilliac,2022-06-30 12:52:48+00:00,2022-07-02 00:30:58+00:00,"{'UI': 1, 'Editor': 1, 'Units': 1, 'Help': 1}","Similar to #6813 in creating a `rect` wrapper for `SDL_Rect`.

There are several things i wanted this for that are unwieldy when dealing with SDL_Rect directly. Things like pixel scale operations where i want to do things like multiply and divide rects by scalars, and intersections and clipping which rapidly become unwieldy when calling functions on pairs of rects.

The way this is done makes it interchangeable with SDL_Rect in all current situations. Things can either switch to using `rect`, or not, with no change.

Usage of rectangle manipulation functions generally becomes decently cleaner using this. I moved the standalone functions to rect member functions, so `sdl::point_in_rect(x, y, r)` became `r.contains(x, y)`, `sdl::intersect_rects(a, b)` became `a.intersect(b)` etc. Several usages were things like `a = sdl::intersect_rects(a, b)`, which became `a.clip(b)` which modifies `a` in place. It doesn't look like all that much, but existing usage became a lot cleaner when i converted things over.

The messiest part is dealing with things that are calling their internal variables ""rect"". I only converted things that were using the rectangle manipulation functions, most things are still using and can keep using SDL_Rect.

This is based on top of #6813 because i used the SDL_Point inheritance to simplify a couple things. So the parts of that that are in this can be ignored... i just want to put this up as a PR now because i have so much mess in my local at the moment. Trying to do one thing has led to four separate cleanups."
983314627,Inherit from SDL types for point and color_t,mesilliac,2022-06-30 03:36:00+00:00,2022-07-01 05:11:16+00:00,{},"This changes `color_t` and `point` to be thin wrappers over `SDL_Color` and `SDL_Point`.

They already had the same members, so usage is completely unchanged.

Aside from being a bit tidier to define, the practical differences are:
1. converting to and from the SDL versions no longer requires copying the data in most cases
2. color_t and point references can be passed directly to SDL functions requiring SDL_Color and SDL_Point pointers.

That second one was mostly why i wanted this."
983267267,Address various minor highdpi TODOs,mesilliac,2022-06-30 01:52:06+00:00,2022-07-01 03:06:26+00:00,"{'UI': 1, 'Help': 1, 'Schema': 1}","Mostly these just involved checking if something was okay.

A couple unused things were removed.
1. The `hex_brightening` config option. This was not used, and from the looks of it has not been for quite some time. It was added in 2010 for testing the mouseover effect. The current effect is hardcoded and ignores this value.
2. There was a function dealing with ""report"" images, which actively analyzed them for transparency and automatically clipped them. This is ridiculous and i removed it some time ago. No adverse effect has been reported.

I originally thought ""reports"" were maybe some automatically generated graphs or something. But no. It is just the name for the automatically updated UI sections of the game display, such as the amount of village gold etc.. The icon images do not need clipping, and even if they do, it should be done via IPF."
983265384,Manual forward-port of #4244.,Pentarctagon,2022-06-30 01:47:10+00:00,2022-06-30 01:48:38+00:00,{'UI': 1},"This seems to have been applied to 1.14, but not 1.15/master at the time."
982428685,update codeblock projectfiles,newfrenchy83,2022-06-29 10:55:41+00:00,2022-06-29 11:35:49+00:00,{'Building': 1},
981586502,Minor SDL interface tidy up,mesilliac,2022-06-28 15:44:11+00:00,2022-06-29 02:49:53+00:00,"{'UI': 1, 'Units': 1}","Mostly removing unused or already recategorized functions, with some other general cleaning, organization and minor reshuffling.

Most of the mess is because sdl/rect.hpp was including sdl/utils.hpp and now no longer is. Turns out a lot was depending on that for its side effects."
980853389,[Units] [Loyalists] Add missing resistance special notes to Javelineer,knyghtmare,2022-06-28 03:15:20+00:00,2022-06-28 04:34:08+00:00,"{'Enhancement': 1, 'Units': 1, 'Prose': 1}","Pikeman and Swordsman have special notes denoting their resistance increases...but the Javelineer got ignored?

Javelineer has 40% pierce resistance (identical to the Pikeman)"
980837965,Remove WC's custom Pick Your Advancements mod,CelticMinstrel,2022-06-28 02:45:08+00:00,2022-06-29 23:29:04+00:00,{'Campaign (any)': 1},
980094841,Canvas cleanup,mesilliac,2022-06-27 13:50:47+00:00,2022-06-28 08:14:48+00:00,{'UI': 1},"Pulling most of the canvas cleanup out of the `new_rendering` branch.

This fixes #6787 , or at least it puts it back to the state it was in before. The GUI is still using the wrong layout at those resolutions, but it won't go all black.

This also introduces bugs with the credits screen. I managed to get it at least not crashing, but it looks terrible. That can't be fixed without overhauling the credits screen to not try to draw 80000 pixels worth of text all at once. It's not trying to draw all that here, but the way the canvas overhaul was set up, it still can't handle the size even if it only draws a small amount.

I left out the massive removal of dirty widget handling code.

I also had to completely overhaul how viewport setting works to micromanage clipping regions. It was not pleasant. I am not a fan of viewports."
979352541,1.17 Loyalist sprite updates,doofus-01,2022-06-26 17:10:04+00:00,2022-07-11 01:03:11+00:00,"{'Graphics': 1, 'Units': 1}","Updating the Loyalist Sprites from this thread:
https://forums.wesnoth.org/viewtopic.php?t=34095

Swordsman attack animation is from:
https://forums.wesnoth.org/viewtopic.php?p=595151#p595151

Some of the old sprites have decent animations, but I'm not going to try to replace all of the existing frames.  Defense + attack need to be done to be considered ""complete"", the idle/death/etc. are nice to have but not strictly needed.

EDIT:  This PR got bigger than what I intended when I opened it.  I'll cull this list, there will be a followup.
- [x] Swordsman - Mostly done, lost the idle animation
- [x] Pikeman - Basic combat animations done.  Lost the idle and die animations.
- [x] Royal Guard -Base image, defense & attack animations done.  No death/idle animations to lose.
- [x] Halberdier - base image, defend & attack animations done.  Lost the idle animation
- [x] Lieutenant - most important animations done, lost the idle animation
~~Javelineer - base image to work from exists, not touched yet.~~
~~General - nothing done yet~~
~~Grand Marshal - nothing done yet~~
- [x] Sergeant - most important animations done, lost the idle animation

Note to self:  Add ""Luke Bunday (Amorphous)"" to the credits, for the swordsman slashing animation."
979162024,Mai parms tests,mattsc,2022-06-25 23:21:54+00:00,2022-06-28 13:21:31+00:00,{'AI': 1},"This adds checks for the types of [micro_ai] tag parameters, addressing #6408.  It also adds warning messages if a parameter specified in a [micro_ai] tag is not valid for that MAI.

And while I was at it, I also added a couple bug fixes that I came across while working on this.

I am not planning to backport this to 1.16, as the risk of screwing something up in the stable series is too high."
978935101,Draw rectangles as lines for some SDL versions.,mesilliac,2022-06-25 06:46:25+00:00,2022-06-26 09:23:21+00:00,{'Graphics': 1},"Aimed at fixing #6799.

According to the SDL bug linked there this was reported in SDL 2.0.15 and should have been fixed in 2.0.18. So i've set it to draw rectangles as four individual lines when linked against the affected SDL versions.

If the problem crops up again for others, the version check could be extended.

I'm assuming the problem doesn't also occur for lines."
978895580,Fix a whole bunch of bad indentation.,mesilliac,2022-06-25 03:26:15+00:00,2022-06-25 04:34:19+00:00,"{'macOS': 1, 'AI': 1, 'MP': 1, 'UI': 1, 'Editor': 1, 'Units': 1, 'Lua API': 1, 'Add-ons': 1, 'WFL': 1, 'Help': 1, 'Terrain': 1}",Mostly spaces where tabs should have been used.
978078593,Some more conversion from SDL Surface to Texture,mesilliac,2022-06-24 08:57:58+00:00,2022-06-24 11:21:39+00:00,{'Editor': 1},"Just converting some of the less straightforward things that were creating and passing surfaces around.

It's now constructing mouseover hex overlays (like the terrain brush indicator in the editor) using IPF where necessary. It could be done in hardware, but there would be minimal benefit and it's much less disruptive to do this way."
977932619,Make predicate optional in config::remove_children,CelticMinstrel,2022-06-24 06:01:58+00:00,2022-06-24 12:35:44+00:00,{},"This PR is just to test that CI passes, in case this syntax breaks in MSVC or something."
977839787,Add options to skip adding images to the surface and texture caches,mesilliac,2022-06-24 02:52:01+00:00,2022-06-25 01:32:34+00:00,{},"I also added some diagnostics, and did some minor cleanup.

After checking the diagnostics, i set it to skip the surface cache automatically when loading textures from image files unmodified. These get cached as textures only. Sometimes this causes images to be loaded twice when the surface is needed later, but not very frequently.

I left it caching surfaces when loading IPF modified textures, as these turned out to be often reused for other image loading operations. It could be revisited after hardware-acceleration conversion is more complete.

I'm considering exposing the cache skip to WML for edge-case use of animations (see #2915 ), but it would be kind of ugly to do for halos, so i'm a bit reluctant.

Currently the point of this is mostly to avoid keeping copies of images both in graphics memory and main memory unless both are required."
977473746,Fix load_string() ignoring the passed chunk name,CelticMinstrel,2022-06-23 18:00:20+00:00,2022-06-24 05:49:29+00:00,"{'Unit Tests': 1, 'Lua API': 1}","Complete with a unit test!
The test results in PASS_BY_VICTORY if it fails, which is a bit weird, but it does work.

There was a comment on this commit noting that it won't work without the events PR (#5663), but I suspect that comment is outdated, so I'm opening this to test the CI."
976320826,Fix Xcode warnings,mattsc,2022-06-23 01:34:34+00:00,2022-06-23 15:19:09+00:00,"{'macOS': 1, 'MP': 1, 'UI': 1, 'Lua API': 1, 'Add-ons': 1, 'Building': 1}","Trying to fix the Xcode warnings.  I'm putting this up here to see what the CI run says, and also because in some cases I do not know if what I did is the preferred solution.  So let me know what needs to be changed."
975303401,Fix retreat injured CA taking allied villages,mattsc,2022-06-22 15:28:24+00:00,2022-06-24 23:31:15+00:00,"{'AI': 1, 'WML Tools': 1, 'WFL': 1, 'Schema': 1}","There is a comment in the retreat injured CA code that taking ally side villages should be disallowed, with potential exceptions, but apparently I forgot to do that after porting this CA to the default AI. For 1.16, it is too late to do anything other than disallowing this.  That part should be done though, in order to make it consistent with previous behavior (and with player expectations).  That's the first commit in this PR, which should be backported.

The other two commits, for master only, add a new AI aspect `allow_ally_villages` which, when set, let's injured units take ally villages, but they will do so with lower priority than using own or enemy villages.  I decided against letting only ""very injured"" units do so in favor of a more clear-cut behavior, and also because there is already an aspect that affects how injured a unit has to be before it retreats.  Adding yet another sliding-scale parameter on top of that would be too confusing, in my opinion."
974927521,(1.17/1.18)remove deprecated backstab option,newfrenchy83,2022-06-22 10:50:20+00:00,2022-09-24 17:50:16+00:00,"{'UI': 1, 'Units': 1, 'Lua API': 1, 'Schema': 1}","Backstab attribute option deprecated, we could remove that, isn't it?"
974601480,Back-port resolution to #6544,Wedge009,2022-06-22 05:47:32+00:00,2022-06-22 21:50:17+00:00,{'UI': 1},Apply theme corrections for 1.16 branch as well.
974223778,Enable LTO for flatpak.,Pentarctagon,2022-06-21 22:10:23+00:00,2022-06-22 00:14:44+00:00,{'Packaging': 1},
973614655,Add event unit tests for dynamic filters and names,CelticMinstrel,2022-06-21 13:56:42+00:00,2022-06-22 02:25:01+00:00,{'Unit Tests': 1},"Mostly for CI, though I guess I need to add comments too."
973207052,Flush texture caches on :refresh,mesilliac,2022-06-21 07:40:31+00:00,2022-06-21 12:32:26+00:00,{},aimed at fixing https://github.com/wesnoth/wesnoth/issues/6782
972905254,Some fixes to the Experimental AI,mattsc,2022-06-21 02:26:47+00:00,2022-06-24 23:37:59+00:00,{'AI': 1},"The incentive for this change was the fact that there is a ""data leakage"" bug if several sides all use the Experimental AI recruiting. Because AI candidate actions are loaded with `wesnoth.require`, all the information set in the old `ca_recruit_rushers.lua` is only loaded once and thus applied to all sides. While there are other ways of fixing this problem, I've been meaning to remove the generic recruit engine in favor of simple straight CAs for a while anyway.

There is no change in behavior due to the first (refactoring) commit. The CA functions exactly as before, and `generic_recruit_engine.lua` is still there, in case some UMC uses it directly.

There are, however, a couple internal parameter changes. `leader_takes_village` and `min_turn_1_recruit` were internal parameters for the interaction between the Experimental AI's castle switch and recruit rushers CAs. Now that both CAs have full access to the AI engine's `data` variable, they are not needed any more.

The one actual change is that `score_function` has now been replaced by the usual `ca_score` parameter. Again, this is entirely internal and there is no change of behavior. In the unlikely case that some UMC actually uses the generic recruit engine with a score function, the engine is still there, as already mentioned. And for the ExpAI itself, the behavior is exactly the same, as the score function just returned a constant value anyway.

While I'm at it, I might as well also do the following as part of this PR (but I first want to see if there are any substantial objections to what I have so far):

- [x] Deprecate the generic recruit engine
- [x] When the castle switch CA is not present, l.928 of the new `ca_recruit_rushers.lua` appears to go through the `__cfg` of the AI configuration on each call, which is very inefficient. That should be avoided.
- [x] Fix #4924.  (By contrast, #4117 is more complex than I want to deal with at this time.)"
972623645,1.17 boat sprites,doofus-01,2022-06-20 20:54:22+00:00,,"{'Graphics': 1, 'Units': 1}","The boats & galleons are not pixel art.  I've moved the existing images to scenery for now, but they might need to go into terrain."
972238006,SDL: Increase requirement to 2.0.10,Wedge009,2022-06-20 13:30:50+00:00,2022-06-20 16:51:42+00:00,"{'Building': 1, 'Packaging': 1, 'SCons': 1, 'CMake': 1}","@doofus-01 reported not being able to build master with SDL 2.0.8. [SDL_RenderCopyF](https://wiki.libsdl.org/SDL_RenderCopyF) and [SDL_RenderCopyExF](https://wiki.libsdl.org/SDL_RenderCopyExF) are only available from SDL 2.0.10 onwards.

These are the only instances of SDL 2.0.8 that I could find. I do not know if there are other places where references to SDL need to be updated."
971594811,Manual forward-port of #4244.,Pentarctagon,2022-06-19 23:58:46+00:00,2022-06-30 01:42:35+00:00,{},"This seems to have been applied to 1.14, but not 1.15/master at the time.

---

Tested locally by successfully downloading the largest add-on currently available on 1.17's add-ons server: Akladian Music"
971134597,Unsetting macOS code signing is no longer needed.,Pentarctagon,2022-06-18 00:12:38+00:00,2022-06-18 01:25:48+00:00,{},testing
969499412,Support latin hotkeys in non-latin layouts,renom,2022-06-16 15:54:33+00:00,2024-04-01 20:19:44+00:00,"{'Enhancement': 1, 'Input': 1}","Different approach to solve #5421. All the latin hotkeys are supported in non-latin layouts.
In comparison with #5598, this PR isn't supposed to affect special character hotkeys."
967211549,Add new SignedRelease build configuration to Xcode project,hrubymar10,2022-06-14 17:27:53+00:00,2022-06-17 18:41:09+00:00,"{'macOS': 1, 'Building': 1}",
966730602,Fix some SoTA zombie recruit dialog errors,mesilliac,2022-06-14 10:14:39+00:00,2022-06-15 06:54:44+00:00,{'Campaign (any)': 1},"There was an error `error gui/parse: horizontal_grow and horizontal_alignment can't be combined, alignment is ignored.` when opening the recruit dialog for corpses in SoTA.

I removed horizontal_grow in favour of horizontal_alignment here, as that matches what is used in other blocks. There seems to be no visible difference.

There were also some unnecessary `..` which seemed to be attempting to concatenate strings in WML. It looks like this is a lua thing? They were visible in-game like ""..Traits.."" and ""..Attacks.."". I removed them and it seems to work fine now?"
966388976,High-res tiled textures,mesilliac,2022-06-14 02:59:53+00:00,2022-06-14 05:25:02+00:00,"{'UI': 1, 'Help': 1, 'Schema': 1}","This adds back the smooth scaling image mode, and also adds a new tiling mode ""tile_highres"" which can be used to tile images in full high-dpi output resolution rather than game resolution.

This is useful for texturing effects, such as the image that is used to texture window backgrounds which has been updated to use this tiling mode.

I didn't make it the default, because it would break anything relying on the previous sizing. The other modes ""tile"" and ""tile_center"" both tile images in draw-space - so their drawn sizes will match with sprite scales and with other sizing in WML.

Mostly just putting this up for the CI check."
965214960,Render most in-game text in high-dpi automatically,mesilliac,2022-06-13 03:24:23+00:00,2022-06-14 02:45:00+00:00,{'UI': 1},"This is partially just a compatibility wrapper for the font rendering system, so that it can return high-res textures with the intended draw-space resolution indicated. But in doing that i also had to fix some other things to get consistent results. So there are four things here:
1. Automatic high-dpi text (works for in-game UI and help browser, for example).
2. Floating game text such as damage numbers has been scaled up according to in-game zoom level for consistent size. This is in addition to also now rendering in high-dpi.
3. Outlines for floating labels have also been scaled up according both to pixel scale and zoom level.
4. Outlines for in-hex text (such as defense % when hovering a unit move) have also been scaled up.

3 and 4 are distinct because they use completely different systems to do the outline.

Everything seems to be working fine for me, but it could use some testing.

I'm not completely sure on the high-dpi game text. It might be out of place next to low-dpi sprites? It seems to look good in practice though. The examples below using both pixel scale 2 and zoom 2 are rather extreme. I expect zoom levels in practice will be much closer to 1. At a glance the text should appear similar at all zoom and pixel scaling levels, with this PR.

<details>
<summary>For some comparisons... here's what damage text in master currently looks like</summary>

pixel scale 2 zoom level 1 (master):
![flzoom-master-hp-ps2z1](https://user-images.githubusercontent.com/243646/173269487-bbcfc044-6ec8-4148-a4c8-92ed91687f4f.png)
pixel scale 2 zoom level 2 (master):
![flzoom-master-hp-ps2z2](https://user-images.githubusercontent.com/243646/173269578-b80c9788-64d8-4a06-85a1-0d72a89ade75.png)

and with this PR:
pixel scale 2 zoom level 1 (PR):
![flzoom-pr-ps2z1](https://user-images.githubusercontent.com/243646/173269874-dcef3bf5-b096-4e29-adf2-9116c198ea18.png)
pixel scale 2 zoom level 2 (PR):
![flzoom-pr-hp-ps2z2](https://user-images.githubusercontent.com/243646/173269902-43a67f18-d827-4590-b1bd-7223e0fd7a3c.png)

static label and movement text, in current master:
pixel scale 1 zoom 1 (master):
![flzoom-master-ps1z1](https://user-images.githubusercontent.com/243646/173270120-1a3e2b80-efe1-4368-92f8-104829a8e212.png)
pixel scale 2 zoom 1 (master):
![flzoom-master-ps2z1](https://user-images.githubusercontent.com/243646/173270147-c510d447-0906-4a78-b2cf-cb7dc65eae5c.png)
pixel scale 2 zoom 2 (master):
![flzoom-master-ps2z2](https://user-images.githubusercontent.com/243646/173270164-d9c2f2ce-d850-4f63-88f5-95033bf14f2c.png)

and with this PR:
pixel scale 1 zoom 1 (PR):
![flzoom-pr-ps1z1](https://user-images.githubusercontent.com/243646/173272856-815e57e6-d3ae-49dc-a1e6-f0bf6bc386de.png)
pixel scale 2 zoom 1 (PR):
![flzoom-pr-ps2z1](https://user-images.githubusercontent.com/243646/173270352-2b8f938c-b3b4-432c-85e2-d7062b8d3158.png)
pixel scale 2 zoom 2 (PR):
![flzoom-pr-ps2z2](https://user-images.githubusercontent.com/243646/173270385-40af8093-db62-42e4-bf69-80efc0c007ce.png)

</details>
"
965165652,1.17 fauna work,doofus-01,2022-06-13 01:54:02+00:00,2022-06-20 01:56:25+00:00,"{'Graphics': 1, 'Units': 1}",
964994525,update codeblock projectfiles,newfrenchy83,2022-06-12 12:54:51+00:00,2022-06-12 14:29:37+00:00,{'Building': 1},
964768872,Fix wmlindent quote detection,CelticMinstrel,2022-06-11 13:42:09+00:00,2022-06-18 07:37:56+00:00,"{'AI': 1, 'WML Tools': 1, 'Units': 1, 'Terrain': 1}","There's been a persistent wmlindent warning in the CI logs for awhile now, so I thought I'd fix it. This prevents wmlindent from treating commented-out quotes as opening or closing a string.

I also removed several ignore directives that were clear workarounds for the bug, as well as a clearly-pointless pair in terrain-graphics.cfg. As you can see, there are no actual changes in the wmlindent run as a result, other than the removal of trailing whitespace."
964664038,Fix text positioning when clipped to a viewport.,mesilliac,2022-06-11 03:37:38+00:00,2022-06-11 14:11:10+00:00,{'UI': 1},"Should fix the lua console, and the credits screen."
964046397,Texture speedups,mesilliac,2022-06-10 12:00:52+00:00,2022-06-10 23:25:58+00:00,"{'Campaign (any)': 1, 'UI': 1, 'Editor': 1, 'Units': 1, 'Lua API': 1, 'Help': 1}","Pulled out the image caching stuff from new_rendering (excluding text caching).

Should bring performance back up to scratch in most cases."
962396175,Colourful CI output,mesilliac,2022-06-09 04:37:33+00:00,2022-06-10 04:45:39+00:00,"{'Building': 1, 'CI': 1, 'SCons': 1, 'CMake': 1}","Adds colours to CI output in a variety of places. Most notably:

* compiler error messages (this was actually already working, but now it's explicit)
* cmake progress stages
* test section headers (these were also made more distinct with a border and spacing)
* test section failure messages
* WML validation failures
* gdb backtraces
* boost test suite stages are now displayed, in colour (they weren't previously displayed at all)

The coloured outputs only really work in the linux builds. I'm not sure what the equivalent commands are on mac and windows, if any.

I also ran into a couple other problems during this, so fixed them in some additional commits.

* game::error messages weren't always being displayed on exit
* the MP Test executor was not actually running MP Tests, but duplicating Play Tests, so i fixed that as well"
962112804,macOS: Link with AppKit and Foundation frameworks,ryandesign,2022-06-08 20:19:28+00:00,2022-06-08 22:27:12+00:00,"{'macOS': 1, 'Building': 1, 'CMake': 1}","Building wesnoth 1.16.3 with the cmake build system fails for me on macOS 10.15:

```
Undefined symbols for architecture x86_64:
  ""_CFArrayGetCount"", referenced from:
      network_asio::load_tls_root_certs(boost::asio::ssl::context&) in libwesnoth-client.a(tls_root_store.cpp.o)
      desktop::battery_info::apple::get_iops_battery_info() in libwesnoth-client.a(apple_battery_info.mm.o)
  ""_CFArrayGetValueAtIndex"", referenced from:
      network_asio::load_tls_root_certs(boost::asio::ssl::context&) in libwesnoth-client.a(tls_root_store.cpp.o)
      desktop::battery_info::apple::get_iops_battery_info() in libwesnoth-client.a(apple_battery_info.mm.o)
  ""_CFDataGetBytePtr"", referenced from:
      network_asio::load_tls_root_certs(boost::asio::ssl::context&) in libwesnoth-client.a(tls_root_store.cpp.o)
  ""_CFDataGetLength"", referenced from:
      network_asio::load_tls_root_certs(boost::asio::ssl::context&) in libwesnoth-client.a(tls_root_store.cpp.o)
  ""_CFDictionaryCreateCopy"", referenced from:
      desktop::battery_info::apple::get_iops_battery_info() in libwesnoth-client.a(apple_battery_info.mm.o)
  ""_CFRelease"", referenced from:
      network_asio::load_tls_root_certs(boost::asio::ssl::context&) in libwesnoth-client.a(tls_root_store.cpp.o)
      desktop::battery_info::apple::get_iops_battery_info() in libwesnoth-client.a(apple_battery_info.mm.o)
  ""_NSApp"", referenced from:
      _main in SDLMain.mm.o
  ""_NSClassFromString"", referenced from:
      apple_notifications::available() in libwesnoth-client.a(apple_notification.mm.o)
      apple_notifications::send_notification(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, desktop::notifications::type) in libwesnoth-client.a(apple_notification.mm.o)
  ""_OBJC_CLASS_$_NSApplication"", referenced from:
      _OBJC_CLASS_$_WesnothSDLApplication in SDLMain.mm.o
  ""_OBJC_CLASS_$_NSBundle"", referenced from:
      objc-class-ref in SDLMain.mm.o
  ""_OBJC_CLASS_$_NSDate"", referenced from:
      objc-class-ref in libwesnoth-client.a(apple_notification.mm.o)
  ""_OBJC_CLASS_$_NSObject"", referenced from:
      _OBJC_CLASS_$_SDLMain in SDLMain.mm.o
  ""_OBJC_CLASS_$_NSProcessInfo"", referenced from:
      objc-class-ref in libwesnoth-client.a(apple_version.mm.o)
  ""_OBJC_CLASS_$_NSScreen"", referenced from:
      objc-class-ref in libwesnoth-client.a(apple_video.mm.o)
  ""_OBJC_CLASS_$_NSString"", referenced from:
      objc-class-ref in libwesnoth-client.a(apple_notification.mm.o)
  ""_OBJC_CLASS_$_NSURL"", referenced from:
      objc-class-ref in SDLMain.mm.o
  ""_OBJC_CLASS_$_NSUserNotification"", referenced from:
      objc-class-ref in libwesnoth-client.a(apple_notification.mm.o)
  ""_OBJC_CLASS_$_NSUserNotificationCenter"", referenced from:
      objc-class-ref in libwesnoth-client.a(apple_notification.mm.o)
  ""_OBJC_CLASS_$_NSWorkspace"", referenced from:
      objc-class-ref in SDLMain.mm.o
  ""_OBJC_METACLASS_$_NSApplication"", referenced from:
      _OBJC_METACLASS_$_WesnothSDLApplication in SDLMain.mm.o
  ""_OBJC_METACLASS_$_NSObject"", referenced from:
      _OBJC_METACLASS_$_WesnothSDLApplication in SDLMain.mm.o
      _OBJC_METACLASS_$_SDLMain in SDLMain.mm.o
  ""___CFConstantStringClassReference"", referenced from:
      CFString in SDLMain.mm.o
      CFString in SDLMain.mm.o
      CFString in SDLMain.mm.o
      CFString in libwesnoth-client.a(apple_version.mm.o)
      CFString in libwesnoth-client.a(apple_notification.mm.o)
      CFString in libwesnoth-client.a(apple_battery_info.mm.o)
      CFString in libwesnoth-client.a(apple_battery_info.mm.o)
      ...
  ""__objc_empty_cache"", referenced from:
      _OBJC_CLASS_$_WesnothSDLApplication in SDLMain.mm.o
      _OBJC_METACLASS_$_WesnothSDLApplication in SDLMain.mm.o
      _OBJC_METACLASS_$_SDLMain in SDLMain.mm.o
      _OBJC_CLASS_$_SDLMain in SDLMain.mm.o
  ""_objc_alloc_init"", referenced from:
      apple_notifications::send_cocoa_notification(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&) in libwesnoth-client.a(apple_notification.mm.o)
  ""_objc_autoreleasePoolPop"", referenced from:
      apple_notifications::send_notification(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, desktop::notifications::type) in libwesnoth-client.a(apple_notification.mm.o)
  ""_objc_autoreleasePoolPush"", referenced from:
      apple_notifications::send_notification(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, desktop::notifications::type) in libwesnoth-client.a(apple_notification.mm.o)
  ""_objc_msgSend"", referenced from:
      -[WesnothSDLApplication _handleKeyEquivalent:] in SDLMain.mm.o
      -[WesnothSDLApplication sendEvent:] in SDLMain.mm.o
      -[SDLMain openHomepage:] in SDLMain.mm.o
      -[SDLMain openChangelog:] in SDLMain.mm.o
      -[SDLMain applicationDidFinishLaunching:] in SDLMain.mm.o
      _main in SDLMain.mm.o
      desktop::apple::get_scale_factor(int) in libwesnoth-client.a(apple_video.mm.o)
      ...
  ""_objc_msgSendSuper2"", referenced from:
      -[WesnothSDLApplication _handleKeyEquivalent:] in SDLMain.mm.o
      -[WesnothSDLApplication sendEvent:] in SDLMain.mm.o
  ""_objc_opt_respondsToSelector"", referenced from:
      _main in SDLMain.mm.o
      desktop::apple::get_scale_factor(int) in libwesnoth-client.a(apple_video.mm.o)
ld: symbol(s) not found for architecture x86_64
clang: error: linker command failed with exit code 1 (use -v to see invocation)
make[2]: *** [wesnoth] Error 1
```

This PR fixes it by linking with the macOS AppKit and Foundation frameworks which define those symbols."
961334833,Workflow testing,mesilliac,2022-06-08 08:19:21+00:00,2022-06-09 05:04:30+00:00,"{'UI': 1, 'Building': 1, 'CI': 1, 'SCons': 1, 'CMake': 1}",This is just for messing around with CI workflows and colour diagnostics support.
961205107,"merge some commits from the base of new_rendering, should fix problems with rendering on MacOS in master",mesilliac,2022-06-08 05:43:15+00:00,2022-06-10 04:53:33+00:00,"{'UI': 1, 'Editor': 1, 'Units': 1, 'Building': 1, 'SCons': 1, 'CMake': 1}","This is to address some bugs preventing the game from working on MacOS, raised on Discord.

It removes the fake compatibility framebuffer that was being used to maintain old code that expected to be able to draw directly to the screen. However it does so in a way that is likely to be very bad for performance. Or rather, the subsequent commits that bring performance back into line haven't been pulled in to this PR.

It needs some brief testing from someone with a less fast system than i have. Previously there were reports of slowness in the editor, but i don't experience it. Two things might cause slowness: scrolling around a large map in game, and scrolling the tool pallete in the map editor. If these are acceptable, then this should be merged.

Actually that editor issue might also be in current master... i'm not sure. It seems fine to me.

Most of this is converting things that used to use `SDL_Surface` to use `SDL_Texture` in stead.

There are several ""TODO"" comments added. Most of these are already resolved in the `new_rendering` branch."
959474019,Use the Sniper runtime.,Pentarctagon,2022-06-06 19:10:54+00:00,2022-08-03 22:19:44+00:00,{'Steam': 1},
958512320,1.17 small terrain updates,doofus-01,2022-06-05 22:10:39+00:00,2022-06-06 00:09:35+00:00,"{'Campaign (any)': 1, 'Graphics': 1, 'Terrain': 1}",
958464284,Sync new rendering,Vultraz,2022-06-05 17:19:22+00:00,2022-07-13 01:57:43+00:00,"{'UI': 1, 'Editor': 1, 'Units': 1, 'Lua API': 1, 'Help': 1}",Opening this for a CI run.
958445692,Make Liminal be sensitive to overillumination/overdarkening,newfrenchy83,2022-06-05 15:37:32+00:00,2022-06-05 21:23:42+00:00,{},Resolve https://github.com/wesnoth/wesnoth/issues/6740 issue. Based on last proposition of @CelticMinstrel 
958318859,1.17 some horseman line standing animations,doofus-01,2022-06-05 00:27:59+00:00,2022-06-05 22:09:36+00:00,"{'Graphics': 1, 'Units': 1}",
958279847,1.17 loyalist sprite cleanup,doofus-01,2022-06-04 19:17:07+00:00,2022-06-04 21:52:24+00:00,"{'Graphics': 1, 'Units': 1}",part of #6417
957830782,Fix potential for OOS errors due to wrong viewing side in vision_path,mattsc,2022-06-03 20:20:01+00:00,2022-06-07 02:15:51+00:00,"{'Bug': 1, 'MP': 1, 'Replays': 1, 'Fwdport': 1}","When finding the vision path for a unit, that unit's team's vision needs to be used.  This had the potential of causing OOS errors in rare cases on maps with tunnels and at least three sides that do not share vision."
957666075,Store add-on download count in the database.,Pentarctagon,2022-06-03 17:02:37+00:00,2022-06-04 16:21:00+00:00,"{'MP': 1, 'Services': 1, 'Add-ons': 1}","The idea being that this could then also be included as a sheet in the multiplayer activity report, which would then be an easy way to view add-on downloads over time. This would of course not be especially useful until 1.18, since for 1.17 the database count would be starting at 0 even though existing add-ons would have a non-zero download count.

---

Assuming the CI passes, and my own local testing I'm planning to do later today works, I'll go ahead and merge this."
955695734,update codeblock projectfiles,newfrenchy83,2022-06-02 09:37:46+00:00,2022-06-02 13:52:30+00:00,{'Building': 1},
952143576,NR S1 Vary the die dialog depending on race,Descacharrado,2022-05-31 15:47:02+00:00,2022-06-01 00:03:01+00:00,"{'Backport': 1, 'Campaign (any)': 1}","Closes #6735

The new strings are not set in stone."
952089439,[1.16] Editor palettes: allow keyboard scrolling to see the last row,stevecotton,2022-05-31 15:01:52+00:00,2022-05-31 23:58:38+00:00,"{'Bug': 1, 'UI': 1, 'Editor': 1}","Backport of #6733, just running a CI check before merging.

Fixes #6724, where scrolling with the mousewheel could reach the last row, but
scrolling with keys or buttons couldn't. Although can_scroll_up() and
can_scroll_down() already existed, can_scroll_down() didn't allow access to the
last line when that line had less than the full number of items. The mousewheel
still worked, because it ignored that logic.

Remove a feature that was seen when the last row is visible - things jumped
between columns to fill the spaces. If you have 10 items, with 4 columns and 2
visible rows then it will appear like this:
    a b c d
    e f g h
when scrolling down it used to move items sideways to fill the last line, which
seems bad UI because it made items harder to find:
    c d e f
    g h i j
the new code is simpler, and will instead show the following when scrolling down:
    e f g h
    i j

Move the layout code into adjust_size(), so that it runs one time when the number
of buttons changes. That could be separated from this commit, but the code
would still be touched in this commit (`counter_from_zero` would still be
replaced by `i`), so doing it and testing the changes together made sense.

(cherry picked from commit 8edd8f22920115c662287847b67f1a2cb96dd6a9)"
951459191,Sync rendering system changes so far,mesilliac,2022-05-31 03:12:13+00:00,2022-06-02 01:36:00+00:00,"{'macOS': 1, 'UI': 1, 'Editor': 1, 'Lua API': 1, 'Building': 1, 'Help': 1, 'Schema': 1}","Primary visible changes:
* high-DPI fonts now work for all GUI2 items - so most of the UI. It's very nice.
* some images are also rendered in high-dpi, notably the title screen background
* the previous physical-DPI-based scaling has been disabled. Pixel scale is used exclusively for now. The old UI scaling code is still there, for future use.

Architectural changes:
* There is a new API for drawing things to the screen. It can be found in `draw.cpp/hpp`. Usage is straightforward, `draw::line(from, to)` draws a line, for example. `draw::flipped(tex, where)` draws a mirrored texture (by default horizontally, but with optional explicit direction flags). All functions drawing to the screen have been updated to use this new API. The code was consolidated from several places.
* The image cache has a stub for returning textures rather than surfaces. It doesn't actually cache textures yet, but it eventually will. This is just to assist conversion. `get_image` has been deprecated in favour of `get_surface` and `get_texture` to explicitly request that type of image storage. Where it was obvious, i have updated calls to use one or the other. Some calls to `get_image` remain, where they will be overhauled later anyway, or where the choice wasn't obvious.
* Some things have been changed from using separate mirrored or scaled textures to mirroring and scaling on-the-fly. More work remains to be done changing things over.
* GUI2 elements now draw directly to the screen, in stead of caching their canvas as a separate SDL surface.

What remains to be done:
* game display still needs to be converted
* GUI1 also needs some more converting
* image cache needs to be updated to manage textures
* there should probably be some sort of cache for rendered text, especially calculated sizes
* a new system for handling redraws without surface restorers / screen reads needs to be put in place
* a lot more

Oh, i also reimplemented map screenshots. But that will still remain broken until the game display is converted over to the new hardware accelerated rendering system, as it doesn't mix well with the old drawing system in this specific case."
950635113,Editor palettes: allow keyboard scrolling to see the last row,stevecotton,2022-05-30 07:46:24+00:00,2022-05-31 12:07:17+00:00,"{'Bug': 1, 'Backport': 1, 'UI': 1, 'Editor': 1}","Fixes #6724, where scrolling with the mousewheel could reach the last row, but
scrolling with keys or buttons couldn't. Although can_scroll_up() and
can_scroll_down() already existed, can_scroll_down() didn't allow access to the
last line when that line had less than the full number of items. The mousewheel
still worked, because it ignored that logic.

Remove a feature that was seen when the last row is visible - things jumped
between columns to fill the spaces. If you have 10 items, with 4 columns and 2
visible rows then it will appear like this:
```
    a b c d
    e f g h
```
when scrolling down it used to move items sideways to fill the last line, which
seems bad UI because it made items harder to find:
```
    c d e f
    g h i j
```
the new code is simpler, and will instead show the following when scrolling down:
```
    e f g h
    i j
```

Move the layout code into adjust_size(), so that it runs one time when the number
of buttons changes. That could be separated from this commit, but the code
would still be touched in this commit (`counter_from_zero` would still be
replaced by `i`), so doing it and testing the changes together made sense.

Note for the master branch only: scrolling the palettes up and down is
noticeably laggy, which is a regression from last week. That's not caused by
this commit, we're just at a point in the rendering refactor where
`surface_restorer::update()` and thus `gui::widget::hide()` are slow. The fix
for that is already in progress and going to be in 1.17.5."
950135853,[Terrains] Snowy Drake Village,knyghtmare,2022-05-28 21:05:36+00:00,2022-05-31 06:41:10+00:00,"{'Enhancement': 1, 'Graphics': 1, 'Terrain': 1}","Originally by the forum user Neil Armius / [neilarmius](https://forums.wesnoth.org/memberlist.php?mode=viewprofile&u=106215&sid=806841a3aac4fad9ce01f57fda5f7ef4)

![image](https://user-images.githubusercontent.com/5283677/170842742-b45527d9-d997-494e-b455-a68dc0427338.png)

These seem really good to be just lost in the forums, so opening the PR.

Notes on the terrain type code being `^Vka`:

1. `^V` must be present for village terrain types
2. small case `a` must be present for frozen/snow terrain
3. `k` because `d` is already taken for dry/desert terrain"
950098191,[CI TEST] nyeeeeee,Vultraz,2022-05-28 16:49:51+00:00,2022-05-28 19:35:19+00:00,{},
947927235,Hotkeys: refactored how hotkey_commands are stored and managed (WML hotkeys only),Vultraz,2022-05-26 06:44:15+00:00,2022-05-26 18:32:14+00:00,{'UI': 1},"This encompasses two closely related changes. First, we now store hotkey_commands in a map instead of
a vector with accompanying index map. Most code did not rely on the command container being contiguous,
and since the commonly used get_hotkey_command was already performing a lookup in the index map, there
wasn't much need to use a separate container. Associative storage makes the most sense here.

The one place that did rely on the command container being contiguous was remove_wml_hotkey. I realized,
however, that it would be much cleaner to eliminate the manual bookkeeping. To this end, I added a new
wml_hotkey_record RAII class. It registers a hotkey_command when created and removes it on destruction.
Using a map for the commands made this even easier, since it doesn't invalidate other iterators or
require other commands to be moved to keep the container contiguous. In addition, removing the secondary
index map means we no longer need to recreate that every time a wml hotkey is removed!

Switching to this RAII-based system means delete_all_wml_hotkeys could also be removed, since all WML
hotkeys should now be handled by wml_hotkey_record and clean themselves up on destruction.

clear_hotkey_commands was also removed, since it was both misleading and now unnecessary. It only cleared
the index map, not the actual list of hotkey_commands! Given that init_hotkey_commands actually set up
the command list, this was doubly confusing."
946421727,Potential fix for flickering and corrupted graphics on master branch.,mesilliac,2022-05-25 04:18:49+00:00,2022-05-26 01:00:19+00:00,{'Graphics': 1},"Changed to render everything to an offscreen texture rather than allowing SDL to do whatever it wants.

This isn't all that undesirable anyway.

From my earlier research, the only thing that doesn't support rendering to texture is some very very old graphics hardware. So likely these days, nothing."
944308550,Fix building with GCC 13.,marxin,2022-05-23 11:26:55+00:00,2022-05-23 14:09:28+00:00,{},"Fixes the following issue:
`base64.hpp:23:49: error: 'uint8_t' was not declared in this scope`

and:
`deprecation.hpp:20:22: error: found ':' in nested-name-specifier, expected '::'`"
943778131,Editor: Add missing items and scenery,Wedge009,2022-05-23 00:29:36+00:00,2022-05-27 00:11:48+00:00,"{'Backport': 1, 'Editor': 1}","Resolves #6719. I didn't review #5821, I used the files that are actually present in `items` and `scenery` directories.

I'm not sure if the spelling correction for the `holly-water` ID will break anything (I couldn't find any references to it in `cfg` files). Please advise if I got anything wrong for the Lit Brazier, I'm not familiar with the animation syntax.

Back-port will need to wait for 1.16.3 string freeze to end."
943734168,1.17 some orc standing animations,doofus-01,2022-05-22 20:26:02+00:00,2022-05-31 04:07:30+00:00,"{'Graphics': 1, 'Units': 1}","Some standing animations, no particular grouping.
EDIT:  It looks like it will be orcs."
941034516,Potential fix for hardware-rendering high-dpi issues on Mac.,mesilliac,2022-05-19 03:51:57+00:00,2022-05-22 04:12:33+00:00,{},Aimed at fixing #6715
938070316,map-diff: fix get new map,macabeus,2022-05-16 22:19:02+00:00,2022-05-17 06:10:52+00:00,{},"Fix again the `map-diff` action, as reported [in this comment](https://github.com/wesnoth/wesnoth/pull/6711#issuecomment-1127240999).

This PR also adds a step to get the previous comment to update it to avoid flooding the PR.

I tested it on my test repository and it's working: https://github.com/macabeus/wesnoth/pull/9
<img width=""826"" alt=""image"" src=""https://user-images.githubusercontent.com/9501115/168691617-1e02e543-2c87-40f8-8ad1-a75e60ff03d9.png"">
We can see the difference on the fire position and on the farm.

And the comment was updated:
<img width=""920"" alt=""image"" src=""https://user-images.githubusercontent.com/9501115/168691671-3c9f9801-45ec-49c6-8ebd-f64526360a92.png"">"
936910260,Test PR,macabeus,2022-05-16 00:42:28+00:00,2022-09-16 09:41:08+00:00,{'Campaign (any)': 1},This PR is just for testing the `map-diff` action
936891293,map-diff: fix event name,macabeus,2022-05-15 23:20:20+00:00,2022-05-16 00:57:17+00:00,{'Campaign (any)': 1},"On the previous PR (https://github.com/wesnoth/wesnoth/pull/6709), I forgot to change orders when fetching the map files.

Since now it's running using the base branch, it should now use `github.event.pull_request.head.sha`.

I tested it on my test repository and it worked: https://github.com/macabeus/wesnoth/pull/9"
936757309,map-diff: fix missing permission,macabeus,2022-05-15 14:06:44+00:00,2022-05-15 16:58:37+00:00,{},"The `Map Diff` action failed on this PR: https://github.com/wesnoth/wesnoth/pull/6704

<img width=""940"" alt=""image"" src=""https://user-images.githubusercontent.com/9501115/168476924-afb87aac-e6a7-47d1-a963-a788386a6409.png"">

Following [the documentation](https://github.com/peter-evans/create-or-update-comment/tree/v1.4.5), we should replace `pull_request` with `pull_request_target` - and this PR does it"
936249575,Add explicit + some cleanup in arrow.h/cpp,bencsikandrei,2022-05-13 19:36:20+00:00,2022-05-13 22:55:45+00:00,{},Here are some small spacing issues and a return that seems clearer
936130072,EI S01 Move the campfire and give it a little more range,Descacharrado,2022-05-13 16:53:30+00:00,2022-05-16 00:56:28+00:00,{'Campaign (any)': 1},"The campfire in S01 would not sound on certain zoom levels because of it's range. I fixed it by moving the campfire and giving all campfires in the campaign a bit more range. Tested S04b and it sounds fine.

Another issue I found while doing this is that when you change the zoom without moving the camera, the state of the sound is not updated (so if you were in max zoom, listening to the campfire and then zoomed out, the sound would not change until you moved the camera the tiniest of bits), maybe it's intentional, or an oversight.

Maybe it would be good to have an option to scale the sound source depending on zoom levels, something like:
```
[sound_source]
        scale_with_zoom=yes
        ...
[/sound_source]
```

Closes #5766 "
935692058,Wmllint: Handle removal of {SOUND:SLOW} and {SOUND:POISON},knyghtmare,2022-05-13 09:27:25+00:00,2022-05-15 08:44:09+00:00,"{'Enhancement': 1, 'WML Tools': 1}","Refer to point number five #6403

"
935658845,De-thread the loading screen. Load in the main thread.,mesilliac,2022-05-13 08:56:33+00:00,2022-06-16 04:12:16+00:00,{'UI': 1},"The programming interface is still the same. Draw and input events are now processed when the worker function calls loading_screen::progress().

This has two main repercussions:
1. exceptions will no longer be silently eaten by the loading screen,
2. loading screen animations will not update unless progress() is called.

In order to update animations in a timely fashion... well, for me they already update so fast as to be nigh-instant. I'm not really sure what ever takes any significant time to load.

If there are actually sections of loading code that take significant time, some sort of `loading_screen::spin()` function shouild be added, that simply lets the loading screen update the spinner animation. Worker functions should call this periodically while performing long-duration tasks.

An alternate option would be to use a progress bar in stead of a spinner animation. Such that when `loading_screen::progress()` is called, it updates both the name of the loading section and the overall progress amount.

In any case, with this change it becomes the responsibility of the worker function to relinquish control momentarily so that events can be processed. As worker functions were already regularly calling `loading_screen::progress()`, with the changes i made here they do this automatically but with relatively low frequency.

The main thing that is potentially lost here is that if a loading function deadlocks for some reason, it becomes impossible to close the program via the close button. I have no idea if there is actually any chance of this happening, nor if it is really a problem. My OS offers to kill programs that are not responding to input anyway. And if there is a chance of a loading operation deadlocking, it should probably have a time-out attached.

I think doing things this way is preferable to the existing situation, and also to the major architectural overhaul that would be needed to do it properly using threads. I have previously tried four separate solutions to salvage the existing threaded implmentation, and all would be far more work than i am prepared to put in, as well as changing core game systems in dangerous ways, which i do not want to do."
935186151,Remove some dead code (maybe a merge defect?),bencsikandrei,2022-05-12 19:18:13+00:00,2022-05-13 22:56:53+00:00,{},"* small formatting changes
* small rearrange
"
934284076,Fixup msys2 on windows.,Pentarctagon,2022-05-12 01:38:34+00:00,2022-05-12 13:46:16+00:00,"{'Building': 1, 'SCons': 1, 'CMake': 1}",
932232334,Automatically replace missing .png graphics with .webp if found.,mesilliac,2022-05-10 10:22:43+00:00,2022-05-11 06:02:38+00:00,{'Engine': 1},"I made it log a warning when it replaces, because while this will work fine, it indicates a bug if it happens in a fresh install or newly started campaign.

Fixes https://github.com/wesnoth/wesnoth/issues/6696"
930621993,1.17 waterworld,doofus-01,2022-05-09 01:58:28+00:00,2022-05-22 12:05:52+00:00,"{'Graphics': 1, 'Units': 1, 'Terrain': 1}","This was inspired by a semi-recent conversation about underwater scenarios.  It doesn't directly address that, but it does lay some groundwork.  So far, this has:
1. Another water creature/monster
2. Seaweed terrain - I'm not totally sure how to deal with this, for now it is a ""swamp"" overlay.
3. Seashells - a simple embellishment overlay

All WIP, especially the seaweed/kelp"
930532736,wmllint: add missing monster ID changes,knyghtmare,2022-05-08 18:44:24+00:00,2022-05-14 21:24:04+00:00,{'WML Tools': 1},"Context:

1. Gorer and Tusklet were added as is, and clashed with UMC units, so ID was changed during 1.15 cycle. Wmllint was not notified of this. Some addons using Gorer/Tusklet that time were not updated so I got Lua unknown unit bug. Also, I think better to not have these 2 lines since UMC still use IDs for this. Any comments? (#5662)

2. Giant Stoat and Frost Stoat was quickly renamed but wmllint was never notified. This might be worth adding to wmllint. (#5344) Some UMC still use deprecated Giant Stoat and aren't aware unless they see deprecated message."
930372894,Rendering system overhaul,mesilliac,2022-05-07 23:59:51+00:00,2022-05-24 07:15:15+00:00,"{'macOS': 1, 'UI': 1, 'Building': 1, 'Help': 1}","This is a basically complete forward-compatible bridging layer for the rendering system.

Everything is now rendering using the new system, but most parts of the code are using a compatibility shim with relatively low performance. Basically to finish conversion to the new high-dpi hardware-accelerated system, everything that is using SDL surfaces and rendering via `CVideo::blit_surface()` should be changed to use SDL textures and render via `CVideo::blit_texture()`. `blit_texture()` could be renamed, as it's not really blitting, but it makes it obvious for now that it is a direct replacement for `blit_surface()`.

A more detailed description of the changes and the new system can be found in the forum post: https://forums.wesnoth.org/viewtopic.php?t=55695

There should be only one thing that is currently broken, which is map screenshots. As i understand it, a solution for this should be able to be forward-ported from the `old_master2018...` branch."
930331245,compress pngs by at least 30% ,matthiaskrgr,2022-05-07 18:30:05+00:00,2022-09-16 06:16:55+00:00,"{'Campaign (any)': 1, 'Docs': 1, 'Graphics': 1, 'Units': 1, 'Terrain': 1}","compress png files via matthiaskrgr/woptipng (rust branch)

Tools used:
imagemagick / convert -strip -defined png:color-type=6
optipng -q -o5 -nb -nc -np
advpng -Z -{1-4}
oxipng --nc --np -o6 --quiet

Compression threshold: 30% (only keep files that get 30%+ smaller)

Optimized 1216 files, reduced 3755130 bytes to 1890944 bytes
3.75 mb -> 1.89 mb"
930294628,[1.16] Fix a typo in the editor-help,stevecotton,2022-05-07 14:33:09+00:00,2022-05-07 18:11:16+00:00,"{'Editor': 1, 'Prose': 1, 'Fwdport': 1}","po: in wesnoth-help's `<header>text='The files: .map and .cfg' ...`,
the change is just a spelling correction of ""scenaro"" to ""scenario"".

Reported by Antro in https://forums.wesnoth.org/viewtopic.php?t=55696

I think string-freeze will be tonight, so planning to merge before that."
930067261,Add command suggestions,Descacharrado,2022-05-06 20:34:52+00:00,2022-05-13 22:54:56+00:00,"{'UI': 1, 'WFL': 1}","Makes suggestions when a command is misspelled as seen below.

![untitled](https://user-images.githubusercontent.com/30196839/167211125-655eeb0d-ebdd-455c-bf40-b5d3bc63f6bd.png)
*works in mp chats too.

Explanation:

Other commands will be recommended when a third or less of the letters (of the shortest string, either player input or actual command) are wrong. Additions, deletions, swaps and changes all count as 1 error (1 wrong letter).

- Writing 'hlep' recommends 'help' because there is only one error and the word is four letters (1/4 <= 1/3, one swap, string_utils.cpp Line 375)
- Writing 'hel' recommends 'help' because there is only one error and the word is three letters (1/3 <= 1/3, one deletion)
- Writing 'hello' does not recommend 'help' because there are two errors and the word is four letters (2/3 > 1/3, an addition and a change)
- Writing 'aawhiteboard' does not recommend 'whiteboard', even if there are only two errors out of eleven letters (2/11 <= 1/3) because the implementation is approximated and gets ""lost"" after two consecutive (non-swap) errors (string_utils.hpp Line 139)

The change comes from https://github.com/wesnoth/wesnoth/pull/6421#issuecomment-1015416479 which comes from #1018

Needless to say that the implementation and thresholds are not set in stone, I even pushed all the commits so anyone can follow along the development to better understand my decisions."
929917781,Update woptipng.py to add encoding line,cooljeanius,2022-05-06 17:09:47+00:00,2022-05-06 17:10:58+00:00,{},"This PR simply just adds an encoding comment, as per: https://peps.python.org/pep-0263/"
929071572,Add FindSDL2 to simplify main CML,bencsikandrei,2022-05-05 19:57:20+00:00,2022-05-11 14:18:14+00:00,"{'Building': 1, 'CMake': 1}","In summary:

* the FindSDL2 module forwards to CONFIG mode first
* if that fails (eg. no -version.cmake or config not even present) it
uses pkg-config
* exports SDL2::SDL2 as a target

I've tried it in the following scenarios:
1) ubuntu 18 (no config present for SDL2) - uses pkg config, works
2) ubuntu 20 (config present, but no version) - uses pkg-config, works
3) ubuntu 20 (with vcpkg, static libSDL2) - uses custom -config/-version, works
4) ubuntu 22 (has a good version of libSDL2) - uses -config/-version), works
5) macos 11.6 (brew) - uses -config/-version, works

Haven't tried Windows, I was hoping the CI would help :D

Please let me know what you think about this one, I'd like to also make some Modules for SDL2_Image and Mixer

Have a good one!

EDIT: It also exports SDL2::SDL2main
EDIT2: I've also tested on windows (msvc/vcpkg/cmake/pkg-config-lite)"
928159459,Use fontconfig,Pentarctagon,2022-05-04 22:53:41+00:00,2022-06-11 21:23:12+00:00,{'Packaging': 1},See #1549 for the background here. For now just creating this PR so the CI will generate a windows installer with these changes applied to see if it also fixes a potentially related issue.
928142364,NR: give hamel leadership,knyghtmare,2022-05-04 22:19:07+00:00,2022-07-29 19:34:09+00:00,"{'Enhancement': 1, 'Campaign (any)': 1}",Closes #6683 
927579118,Use mutexes for hotkey list and image cache access.,mesilliac,2022-05-04 12:44:05+00:00,2022-05-09 19:53:47+00:00,{},"This allows `game_config_manager` to modify these directly, in stead of raising an event to switch to the main thread."
927202157,GUI2: made widget initialization process more secure against memory leaks,Vultraz,2022-05-04 03:04:23+00:00,2022-05-06 03:35:16+00:00,{'UI': 1},"Pulling this out of the old master branch.

This commit is the followup to a similar one I did regarding window initialization. Instead
of widgets being created on the heap and not being managed by a smart pointer until they're
added to a grid, they are now always managed by a shared_ptr. To that end, this commit covers
bunch of things:

* builder_widget::build (both overloads) and all its overrides (which have now been marked
  as such) now return shared_ptr<widget>.
* The builder_grid::build() override now returns the same instead of grid* since you can't
  use covariant return types with smart pointers.
* The two implementation build helpers in builder_grid have been combined with an optional
  replacement map as the second parameter. Uses of the version that took a grid pointer could
  be easily converted to pass a reference instead.
* The pane, matrix, and viewport build() functions were removed in favor of making the ctor
  public. In case there was a deprecated ctor, that was removed.
* The viewport now keeps a widget shared_ptr instead of a reference that was then deleted
  by address-of. This was both better design and necessary to fix a crash.
* ~~build_single_widget_instance_helper and build_single_widget_instance were renamed to
  build_single_widget and build_single_widget_and_cast_to to better represent their roles
  and to indicate the latter was more a convenience extension for the latter than the other
  way around.~~"
927170166,GUI2: removed frameBuffer argument from widget drawing functions,Vultraz,2022-05-04 01:20:23+00:00,2022-05-04 01:53:23+00:00,{'UI': 1},
927118507,Clear out some old code,Pentarctagon,2022-05-03 23:24:20+00:00,2022-05-04 01:36:00+00:00,"{'Building': 1, 'SCons': 1}",Letting the CI run before merging just in case.
926545661,UtBS S8 fixed wallstuck units and moved PASSABLE_HEX macro to core,Descacharrado,2022-05-03 13:12:20+00:00,2022-05-05 17:44:46+00:00,{'Campaign (any)': 1},"Half of #6439 Moves the macro first used in #6357 and uses it to fix the possibility of wall-stuck units in UtBS S8.

Line 2157 in UtBS S08 changes the trigger to be more reliable, so the player is not able to sneak units past the trigger.

Test photos:
![test_utbs_s8](https://user-images.githubusercontent.com/30196839/166459065-528f6032-320e-45d6-8bbd-ea82d6327fcf.png)
![test_trow_s19](https://user-images.githubusercontent.com/30196839/166459074-7625afab-8ccf-4c4f-a782-465a0e93eac4.png)

Squash merge because of conflicts in changelog."
926523048,UtBS S08 Fixed replay OOS by moving victory event to synced event,Descacharrado,2022-05-03 12:45:24+00:00,2022-07-03 06:02:37+00:00,{'Campaign (any)': 1},"Half of #6439 This implementation is different from the previous implementation (in the linked PR) because there was a simpler way of doing it and the previous implementation was buggy.

Closes #6267 "
926316608,Backport smooth scrolling fix,mesilliac,2022-05-03 08:12:24+00:00,2022-05-03 23:57:04+00:00,"{'UI': 1, 'Input': 1}","I tested it briefly and it's working as expected.

I also updated the changelog."
925938310,Various fixes about [h|c]pp,bencsikandrei,2022-05-02 20:27:46+00:00,2022-05-10 16:45:53+00:00,{},"Hello!

I'll detail the small changes I've made in the  bunch of commits I've made. On all changes, please correct me if I made assumptions that are not valid, I'm trying my best to read and understand (and test) but I'm still in the process of discovering the project.

0) There were some minor typos inside the comments of `about.hpp` and I figured they were worth committing.

1) `std::vector::insert` can be called with an empty range as it does a check internally (via its loop) so I figured the `if` was not needed

2) found a place where a `std::map` was searched twice via `[]`, doesn't matter much since it's probably called very seldom but it looks a bit better with the `.find`, I think. Please correct me on this if I'm wrong, but I figured adding the (empty) entry (via `[]`) to the map in case of not found wasn't useful. If it is, then that change is wrong.

3) AFAIK default constructors are already called so there was no need to call them in the initializer lists

4) `std::pair` was used but its official header not included (it's most probably included by vector, or string) but I think it's safer like this

Thanks again for the awesome project and for the time to review my PR!

Have a good one!

EDIT: Please tell me if I'd better squash these, cause I'll do it no probs!"
925514364,Refactor find vorbis file cmake,bencsikandrei,2022-05-02 12:38:05+00:00,2022-05-02 21:23:17+00:00,"{'Building': 1, 'CMake': 1}","A couple of changes for consistency with the other modules + a small commit to state the minimum requirements for Boost and CMake which were a bit behind.

As always, tested as much I could, the `link.txt` file is looking good, same as `compile_commands.json`.

I was thinking, would it be interesting to move the `FindXXX` files in a `cmake/modules` folder? That way they're separate from other cmake utilities.

Also, since I've embarked in this journey, and haven't yet seen the whole history of the project, have there been efforts to unite the SDL2 find? I'm thinking about unifying windows/*nix finders with a couple of tricks but I'd like to see if there have been other efforts. Of course, it's fine even if there weren't and it may actually be impossible, but I'd like to try.

Thanks!"
925068306,1.17 skeleton sprite cleanup,doofus-01,2022-05-01 23:25:50+00:00,2022-05-02 02:51:17+00:00,"{'Graphics': 1, 'Units': 1}",part of #6417 
925045304,1.17 necromancers cleanup,doofus-01,2022-05-01 21:58:23+00:00,2022-05-02 00:06:15+00:00,"{'Graphics': 1, 'Units': 1}",part of #6417 
925025149,1.17 elf sprite cleanup,doofus-01,2022-05-01 20:17:58+00:00,2022-05-01 23:26:50+00:00,"{'Graphics': 1, 'Units': 1}",part of #6417 
925003678,Refactor FindTranslationTools.cmake,bencsikandrei,2022-05-01 18:58:58+00:00,2022-05-02 03:31:23+00:00,"{'Building': 1, 'CMake': 1}","Hello!

I've looked into the translation search file and it was finding a bunch of `gettext` tools in the same manner.
Used a macro to factor that code out a bit.

How I've tested: inside a docker container and I've activated the `ENABLE_POT_UPDATE_TARGET` and built like that.
During my testing I've had cmake in very verbose mode to check for the paths and how it set the variables. All LGTM.

All in all seems to work well and the code is shorter and easier to modify if needed.

The CI seems to also do what I've done so fingers crossed!

Please let me know if you'd like me to further test this change.

Thanks!
Andrei"
924811093,Added spritsheet generator,Vultraz,2022-05-01 04:44:51+00:00,2024-08-08 15:29:08+00:00,{'Building': 1},"Pulls in my old spritesheet generator code from the `old_master_20181015` with minor tweaks for code changes since then. Placing here for consideration.

This takes a folder with images and writes an assembled spritesheet to disk along with a config file."
924730591,add sdl/ texture and input to codeblock projectfiles,newfrenchy83,2022-04-30 21:30:41+00:00,2022-04-30 21:40:42+00:00,{'Building': 1},
924724818,1.17 dunefolk sprite cleanup,doofus-01,2022-04-30 20:48:12+00:00,2022-05-01 03:43:50+00:00,"{'Graphics': 1, 'Units': 1}",part of #6417 
924717938,[Campaign] [DiD] [Liberty] Fix background image paths,knyghtmare,2022-04-30 19:57:04+00:00,2022-04-30 19:59:01+00:00,{'Campaign (any)': 1},"- [x]  Descent into Darkness
- [x] Liberty

After conversion to webp, their images for backgrounds were not being shown.

![image](https://user-images.githubusercontent.com/5283677/166120771-e3d35df6-ad28-4598-844b-30020b1ca145.png)
"
924717212,Have cmake also execute the conftests.,Pentarctagon,2022-04-30 19:52:11+00:00,2022-05-03 23:10:46+00:00,"{'Graphics': 1, 'Building': 1, 'SCons': 1, 'CMake': 1}","---

This moves the scons conf tests into their own cpp files rather than being embedded in the scons python scripts, and also has them be executed by cmake before building."
924714169,1.17 goblin sprite cleanup,doofus-01,2022-04-30 19:29:59+00:00,2022-05-01 00:51:31+00:00,"{'Graphics': 1, 'Units': 1}",part of #6417 
924711498,[wc2p] fix broken icon image path for WC2P campaign,knyghtmare,2022-04-30 19:11:51+00:00,2022-04-30 19:14:46+00:00,{'Campaign (any)': 1},incorrect image path after merger of #6655 so patching it
924698633,1.17 orc sprite cleanup,doofus-01,2022-04-30 17:46:52+00:00,2022-04-30 20:52:36+00:00,"{'Graphics': 1, 'Units': 1}",part of #6417
924537923,Add images solely for use in the scons conftests.,Pentarctagon,2022-04-30 00:56:57+00:00,2022-04-30 01:08:07+00:00,"{'Graphics': 1, 'Building': 1, 'SCons': 1}",Just waiting for the CI just in case.
924532168,1.17 undead sprite cleanup,doofus-01,2022-04-30 00:26:19+00:00,2022-04-30 17:50:52+00:00,"{'Graphics': 1, 'Units': 1}","part of #6417 - completed

The ghosts were interesting; all of them were good sprites, but there was an evolution ending with the spectre, which is really top-shelf.  If all sprites were like the spectre, this whole cleanup project would be unneeded."
924381797,Refactor FindHistory.cmake,bencsikandrei,2022-04-29 19:58:15+00:00,2022-04-29 23:44:39+00:00,"{'Building': 1, 'CMake': 1}","Hello!

I was super excited to look into `wesnoth`! Amazing work!

While I was getting to know the project I've read through some of the `cmake` finders and thought I may help with some modernization.

I've made `FindHistory.cmake` use lower caps keywords, added an `IMPORTED` target for it and some documentation that looks like the standard `cmake` docs.

Please let me know if this kind of stuff is interesting to you as I'll probably also look into the other `cmake` files during my journey.

Thanks and keep up the great work!
Andrei

EDIT: my editor was configured with `spaces`. I noticed all other cmake finders use tabs. I'll update accordingly"
923815774,1.17 troll sprite cleanup,doofus-01,2022-04-29 13:39:19+00:00,2022-04-30 02:01:40+00:00,"{'Graphics': 1, 'Units': 1}","part of #6417 
The trolls didn't really need a lot of cleanup."
923711585,1.17 wose sprite palette cleanup,doofus-01,2022-04-29 12:47:24+00:00,2022-04-29 14:40:51+00:00,"{'Graphics': 1, 'Units': 1}",part of #6417 
922712860,1.17 outlaws sprite cleanup,doofus-01,2022-04-29 03:05:40+00:00,2022-04-29 14:40:21+00:00,"{'Graphics': 1, 'Units': 1}",part of #6417
921850003,1.17 cleanup of human peasant-type sprites,doofus-01,2022-04-28 13:26:39+00:00,2022-04-29 03:08:21+00:00,"{'Graphics': 1, 'Units': 1}","Part of #6417
There is some weirdness in the base sprites, but that was true before this change.  Those sprites do need touch-up, but that is for a different PR. "
921795206,Fix single-frame title-screen flicker when loading a game or starting a campaign.,mesilliac,2022-04-28 12:36:56+00:00,2022-04-28 20:04:47+00:00,{'UI': 1},"The title screen was being displayed for a single frame in between loading dialogs when either starting a new campaign or loading a game.

This was giving me an aneurysm.

I just turned off drawing of the title screen after these processes are confirmed. The next time the title screen needs to be drawn, it is recreated from scratch anyway, so the existing instance should never actually need to redraw."
921310783,Editor: Add some missing terrain groupings,Wedge009,2022-04-28 02:46:54+00:00,2022-05-01 23:00:11+00:00,"{'Backport': 1, 'Editor': 1, 'Terrain': 1}","Resolves #6643.

I'm not overly familiar with the myriad of terrains but this seems to make sense to me (I tested the changes too). I tried to review everything but it's possible there could be more groupings that could be added."
921194966,Add decltype.,Pentarctagon,2022-04-27 23:30:59+00:00,2022-04-27 23:31:15+00:00,{'UI': 1},"Already ran it on my fork's CI, so merging immediately."
921169538,Bump minimist from 1.2.5 to 1.2.6 in /utils/wesnoth-map-diff,dependabot[bot],2022-04-27 22:41:31+00:00,2022-04-27 22:47:29+00:00,{'dependencies': 1},"Bumps [minimist](https://github.com/substack/minimist) from 1.2.5 to 1.2.6.
<details>
<summary>Commits</summary>
<ul>
<li><a href=""https://github.com/substack/minimist/commit/7efb22a518b53b06f5b02a1038a88bd6290c2846""><code>7efb22a</code></a> 1.2.6</li>
<li><a href=""https://github.com/substack/minimist/commit/ef88b9325f77b5ee643ccfc97e2ebda577e4c4e2""><code>ef88b93</code></a> security notice for additional prototype pollution issue</li>
<li><a href=""https://github.com/substack/minimist/commit/c2b981977fa834b223b408cfb860f933c9811e4d""><code>c2b9819</code></a> isConstructorOrProto adapted from PR</li>
<li><a href=""https://github.com/substack/minimist/commit/bc8ecee43875261f4f17eb20b1243d3ed15e70eb""><code>bc8ecee</code></a> test from prototype pollution PR</li>
<li>See full diff in <a href=""https://github.com/substack/minimist/compare/1.2.5...1.2.6"">compare view</a></li>
</ul>
</details>
<br />


[![Dependabot compatibility score](https://dependabot-badges.githubapp.com/badges/compatibility_score?dependency-name=minimist&package-manager=npm_and_yarn&previous-version=1.2.5&new-version=1.2.6)](https://docs.github.com/en/github/managing-security-vulnerabilities/about-dependabot-security-updates#about-compatibility-scores)

Dependabot will resolve any conflicts with this PR as long as you don't alter it yourself. You can also trigger a rebase manually by commenting `@dependabot rebase`.

[//]: # (dependabot-automerge-start)
[//]: # (dependabot-automerge-end)

---

<details>
<summary>Dependabot commands and options</summary>
<br />

You can trigger Dependabot actions by commenting on this PR:
- `@dependabot rebase` will rebase this PR
- `@dependabot recreate` will recreate this PR, overwriting any edits that have been made to it
- `@dependabot merge` will merge this PR after your CI passes on it
- `@dependabot squash and merge` will squash and merge this PR after your CI passes on it
- `@dependabot cancel merge` will cancel a previously requested merge and block automerging
- `@dependabot reopen` will reopen this PR if it is closed
- `@dependabot close` will close this PR and stop Dependabot recreating it. You can achieve the same result by closing it manually
- `@dependabot ignore this major version` will close this PR and stop Dependabot creating any more for this major version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this minor version` will close this PR and stop Dependabot creating any more for this minor version (unless you reopen the PR or upgrade to it yourself)
- `@dependabot ignore this dependency` will close this PR and stop Dependabot creating any more for this dependency (unless you reopen the PR or upgrade to it yourself)
- `@dependabot use these labels` will set the current labels as the default for future PRs for this repo and language
- `@dependabot use these reviewers` will set the current reviewers as the default for future PRs for this repo and language
- `@dependabot use these assignees` will set the current assignees as the default for future PRs for this repo and language
- `@dependabot use this milestone` will set the current milestone as the default for future PRs for this repo and language

You can disable automated security fix PRs for this repo from the [Security Alerts page](https://github.com/wesnoth/wesnoth/network/alerts).

</details>"
921128453,UtBS S05 Enforce encounter with the Cloaked Figure,Descacharrado,2022-04-27 21:34:03+00:00,2022-05-09 00:32:14+00:00,"{'Backport': 1, 'Campaign (any)': 1}","The Cloaked Figure will appear when enemies are defeated if it did not already. 

I tried other methods, like spawning the cloaked figure some turns after defeating an enemy leader (so the randomness is kept) or some turns after moving to certain sections, but none of those implementations felt the same (as how it is rn) and could be cheesed (so we would not be enforcing the encounter, just changing the spawning method). 

So I decided that keeping the spawning mechanism and, in the cases where the figure is not spawned (likely because of players rushing), the figure just appears.

Closes #6364 and has a revert of #6361."
920752156,1.17 cleanup of Naga sprites,doofus-01,2022-04-27 14:49:28+00:00,2022-04-28 14:00:13+00:00,"{'Graphics': 1, 'Units': 1}","Part of #6417 - EDIT: now this is complete.
The palettes for the fighter, guardian, and mixed (dirkfang) lines are a little different, so I reorganized the files.  I'm on the fence about whether the differences should be played up or toned down, but that should be easy to change later."
920083214,1.17 Palette cleanup of Ogre sprites,doofus-01,2022-04-27 02:54:16+00:00,2022-04-27 11:29:25+00:00,"{'Graphics': 1, 'Units': 1}","This is my first attempt at addressing #6417.  

It's also my first attempt at batch image processing.  I think it worked but I might have missed something.  The ColorMap image is included deliberately, for future reference."
919903475,EI S07a various fixes,Descacharrado,2022-04-26 21:42:06+00:00,2022-05-22 15:45:17+00:00,"{'Backport': 1, 'Campaign (any)': 1}","Addresses some points in #4145.

Side 2 was spoiled previously in two ways:
- With the status table showing it (as commented in the linked issue)
- With enough resolution and zoomout, you could see the leader being stored.
Now the status table at turns 1 and 2 will be:
![side 2 hidden](https://user-images.githubusercontent.com/30196839/165396704-2af8343c-1ae1-4923-adc0-f27b86a6472e.png)
![side 2 unhidden](https://user-images.githubusercontent.com/30196839/165396708-376d5dcd-46fa-4b7c-890b-708fc77b8470.png)
And the leader is stored in the prestart event to ensure that it is not leaked.

Also, the player will now be notified that two more ogres are joining Gweddry (both with dialogue and visually) and Grug will have no upkeep (fixed by deleting the [modifications] tag).

Squash before merging.

P.S. If you want to test this, keep in mind you need Owaec from S05 to trigger the victory condition."
918085078,pofix: wesnoth-sof rules for 1.16.3,stevecotton,2022-04-25 12:21:48+00:00,2022-05-03 05:01:19+00:00,{'Translations': 1},"This will still leave 20 fuzzies that are trivial but which should not be done with a line-by-line search-and-replace; that's a difference between this as PR #6634.

The string beginning ""Much to his chagrin, Alanin was dispatched to scout further"" has multiple changes, some of which split over the word-wrap. Two parts of it get fixed here, but it will still become fuzzy due to the changes around ""cold passage"" part."
917995544,Scroll at a consistent speed.,mesilliac,2022-04-25 10:50:21+00:00,2022-04-29 23:00:19+00:00,"{'Bug': 1, 'Backport': 1, 'UI': 1}","Fixes #3607

The `controller_base::handle_scroll` function is being called inside a loop that doesn't seem to be limited by anything. So if processing is fast, it loops and scrolls a lot, and if processing is slow, it doesn't.

I made it scroll by an amount proportional to the amount of time between calls to `handle_scroll`."
917475533,1.17 - UtBS - recolor of dwarf/phantom castle,doofus-01,2022-04-24 16:42:45+00:00,2024-04-07 20:42:12+00:00,"{'Graphics': 1, 'Terrain': 1, 'Campaign UtBS': 1}","The ""phantom castle"" in UtBS is a barely modified dwarf castle, always struck me as either pointless (just use the core version) or inadequate.  I don't personally feel like making a custom castle for this scenario, but some IPF recolor might be worth considering.  An example so far:
![Screenshot_20220424_castles](https://user-images.githubusercontent.com/13510196/164986390-72466808-e283-47b9-84fc-4c257a95b59e.jpg)
I went with blend because the lowered contrast might seem more ghostly.

I'm not sure what I think of this, maybe any severe recolor is just going to look bad, and some other ruins-type castle might be a better starting-point anyway.

Whatever change is made, if any is, would dictate what we do with the keep image (currently the dwarf throne)

pinging @nemaara because it is mainline campaign material"
917251751,Changes to prepare for ubuntu 22.04 CI,Pentarctagon,2022-04-23 17:56:44+00:00,2022-04-25 18:47:10+00:00,{'UI': 1},
917173870,Partial pot-update: trivial changes only,stevecotton,2022-04-23 10:24:31+00:00,2022-05-03 05:03:04+00:00,{'Translations': 1},"These are typo-fixes and minor grammar improvements to the English text,
which don't change the meaning of the text and therefore shouldn't set
the fuzzy flags on their respective translations.

This is a hand-edited subset of the changes that a full pot-update would make.
The plan once this is reviewed is to update the .po files with the changes in
these .pot files, but to filter out any added fuzzy flags when commiting them
to Git. A normal pot-update can then be run, which will add fuzzy flags for the
string changes which weren't included in this PR.

What comes after this
---

The intended followup to this is in https://github.com/stevecotton/wesnoth/commits/dry_run_fuzzyless_po_update_1_16 .

The SConstruct files are set up so that rules for building .po files are only
added if `pot-update`, `update-po` or `update-po4a` is given on the command
line; also `update-po` only builds files whose language is additionally given
on the command line, for example `scons update-po de`. The command line to
trigger this without triggering an update of the .pot files too is thus:
```
scons update-po `cat po/LINGUAS`
```

Don't commit all the changes, instead avoid adding the fuzzy flags, by using
`add -e` and filtering out all lines that are `+#, fuzzy` or that begin `+#| `.
Warning: this drops you into Git's editor, probably a vi-based one.
```
git add -e
```

One translation should still have the fuzzy flags - `en_GB` is likely to have
the same typos and grammar mistakes as `en_US`.
```
git add po/*/en_GB.po
```"
916740944,[1.16] SoF S09: A few extra translation hints,stevecotton,2022-04-22 19:23:34+00:00,2022-04-23 09:59:14+00:00,"{'Campaign (any)': 1, 'Translations': 1, 'Fwdport': 1}","Also an idea for the translators' changelog: put a paragraph starting with `po:` in the commit message, so that someone can generate the translators' changelog from the Git changelog.

Example covering this and 2581ab6c87f24abc92c1933d790324cc22cc20e3 / f82079bcc0eb2a24fa0e0ee6559fb390480a77d7 :
```
po: In SoF S09, many strings involving Krawg (a gryphon) assumed that Krawg was
the only flying unit. Similar texts have been added that are used when the player
has gryphon riders too; most of these will be marked as fuzzy versions of the
Krawg-only strings."
915885401,Update docker images to Ubuntu 22.04.,Pentarctagon,2022-04-22 00:12:33+00:00,2022-04-22 01:30:34+00:00,{},
912371190,[WoF] Add missing wesnoth-wof.pot file,knyghtmare,2022-04-18 20:39:28+00:00,2022-04-29 21:52:12+00:00,{'Translations': 1},"Title says it all.

This was never added as the addition of WoF was rushed for 1.17.0 (as something new had to be offered)"
911762941,"Add a pixel scale multiplier option, enabling integer scaling of the game to higher resolutions.",mesilliac,2022-04-18 06:43:49+00:00,2022-04-30 07:22:11+00:00,"{'macOS': 1, 'UI': 1, 'Editor': 1, 'Lua API': 1, 'Building': 1, 'Help': 1}","I found the game unplayable on my 3840x2160 pixel display, so... i fixed it.

The primary change:
 * A new pixel scale multiplier option, ranging from 1 to 4, which scales the game by that amount before display.
 * An automatic option, that sets pixel scale to something reasonable based on window size.

What i changed to make this work:
 * The window framebuffer has been replaced (for game purposes) by a separare `SDL_Surface` for drawing onto. Everything that previously drew directly to the window framebuffer now draws to this surface.
 * The window is now rendered via texture copy. SDL handles this. I left it in software mode for the actual rendering, but theoretically hardware accelleration could be enabled as available simply by removing this restriction. SDL should choose correctly according to system.
 * When a screen flip is requested, the drawing surface the game now uses is copied manually to a rendering texture. SDL then scales this texture to the actual final output rendering surface, which Wesnoth does not currently need to care about.
 * Resize events / framebuffer updates now verify and if needed create the drawing surface and rendering texture. The rest is handled by SDL.
 * SDL's built-in capability for scaling the render texture (`SDL_RenderSetLogicalSize`) is used to automatically convert input events to the same scale as the drawing surface. Some tweaks were needed where Wesnoth overloads SDL events, particularly the window resize event, which must remain in display coordinates. This is converted to drawing coordinates in the relevant places to make everything work without further change to existing drawing or input handling.
 * a new `sdl/input.cpp` was added wrapping routines to return the mouse positon, as SDL returns this in display coordinates, not draw-space coordinates. The new `sdl::get_mouse_state` must be used in place of `SDL_GetMouseState`, but this is the only important change code-wise.
 * Some `CVideo` functions were renamed to make the coordinate space explicit. `GetSurface` is now `GetDrawingSurface`, and `screen_area` is now `draw_area`. `get_width` and `get_height` are left as-is, as from Wesnoth's point of view input coordinates are still the same as draw coordinates. Some new functions were added to get the various different draw/display/input/high-dpi-output sizes.
 * _The minimum allowable window height has been reduced from 600 to 540 pixels!_ This is so that resolutions above a new ""maximum"" window size of 1920x1080 can be scaled by 2. In my tests this works adequately, even with the existing 800x600 theme, but ideally a 960x540 theme should be created. 1920x1080 looks to me to be about the maximum workable resolution for Wesnoth, and for it to be scalable without fractional scaling (which looks bad), a size half-the-maximum needs to be supported. I set the maximum to 1920x1080 in `preferences/general.cpp`.
 * A few minor auxiliary functions were added. Mostly to get the preferences screen to automatically update the pixel scale when changed.

Some notes:
 * The pixel scale will never reduce beyond the minimum resolution indicated in `preferences/general.cpp`. This was previously 800x600 but i changed it to 800x540 for the reason mentioned above, and so that users running 1920x1080 can use a pixel scale of 2 if they explicitly choose to.
 * The automatic option will attempt to scale to the default resolution indicated in `preferences/general.cpp`. This is 1280x720 and is unchanged. It will try not to scale below this.
 * The automatic option will attempt to scale to ensure the (new) maximum resolution indicated in `preferences/general.cpp` is not exceeded. I have set this to 1920x1080, which feels reasonable to me, but it can easily be changed. If needed, this _will_ scale below the default resolution, but will not scale below the minimum resolution.

Potential issues with the new system:
 * SDL explicitly states that the rendering interface is not safe for multi-threaded use. Judging from what i saw of the Wesnoth codebase this may be a problem. There already seemed to be some race conditions with the old code where the game would crash if the framebuffer wasn't updated quickly enough. These problems are probably still there. In any case there should be only one routine that meaningfully touches this system - the `CVideo::flip()` function.

I have played several scenarios and browsed a variety of game systems using pixel scales of 2 and 3 at various window sizes, and everything i tested appears to work without issue.

I tested enabling hardware acceleration and that _did_ have issues. So i left it in software mode for now, which should behave roughly identically to the previous system.

And because i like pictures, here is the difference in fullscreen output at 4K resolution (3840x2160), without and with pixel scaling.
![wesnoth-4k](https://user-images.githubusercontent.com/243646/163766214-cd63bf9f-8539-4e63-81f7-533c4f13b0e6.jpg)
![wesnot-4k-scaledx3](https://user-images.githubusercontent.com/243646/163766249-bc37b124-5bb2-4cb9-ade6-7252799b55f0.jpg)
"
911629905,Max torch final victory dialog handling of SoF s9 rework,max-torch,2022-04-18 02:15:48+00:00,2022-04-22 01:30:04+00:00,"{'Backport': 1, 'Campaign (any)': 1}","This is my contribution to completing what was started in #6334 .
The issue this tries to close is #6332.
Things in the scenario didn't quite make logical sense considering the presence of Gryphon Riders. This resolves the issue by allowing them to trigger an event, and by acknowledging them in the dialog.

The last narrator dialog is slightly different depending on whether or not the player has a gryphon rider in addition having Krawg. Also, events are triggered when Gryphon Riders move to the stone tablet at the bottom of the map."
911534131,Unit tests: make separate files for each starting position,stevecotton,2022-04-17 19:17:39+00:00,2022-04-18 02:48:54+00:00,{'Unit Tests': 1},"Turn the 4 side setup of the `firststrike_and_laststrike` test into a macro
called `COMMON_KEEP_A_B_C_D`for reuse in other tests.

The comment for `GENERIC_UNIT_TEST` gets a couple of extra paragraphs.

All the files get wmlindent run on them, which reindents `FAIL_IF_NOT`.

The main reason for having these is separate files is Git's fuzzy-patch
matching when merging and rebasing. Having large blocks of identical text
in `wml_unit_test_macros.cfg` can mean the wrong section gets patched."
911372891,1.17 - minor terrain updates,doofus-01,2022-04-17 02:13:34+00:00,2022-04-24 03:23:35+00:00,"{'Graphics': 1, 'Terrain': 1}","`Rrd` graphics are mostly placeholder, the graphics rules were the point for now.
Addresses #1345 - not by making \, |, / versions, but just futzing with the images.
![Screenshot_20220417_](https://user-images.githubusercontent.com/13510196/163725377-67499b01-188b-437c-9a2c-7cbc077b109e.jpg)
I'm not sure about the road color, but it's really easy to change for now.
"
910199977,"Unit tests for [drains], [poison] and [slow], with apply_to=opponent",stevecotton,2022-04-14 17:52:21+00:00,2022-04-19 13:27:49+00:00,"{'Bug': 1, 'Unit Tests': 1, 'Units': 1}","Slightly different to PR #6582, which was the 1.16 version of this. The five
lines that were labelled `preserving known bug` are changed to test that it's
been fixed. Once #6582 is approved, I'm intending to merge this too.

Here `apply_to=opponent` means that the weapon special gives the opponent the
ability, the unit that should get poisoned or slowed is the unit that has the
weapon special.

There's a known bug in 1.16, that `apply_to=opponent` check the wrong unit to
see it it's `unpoisonable`, `undrainable` etc. It also checks the wrong unit to
see if it's already poisoned or slowed, so a battle between two units that both
have reverse-poison results in at most one being poisoned.

Most of the credit for this is Newfrenchy's, as he's already written a fix
and a WML based test. This commit uses a Lua test instead to test more
combinations of statuses.

This adds a `COMMON_KEEP_A_B_UNIT_TEST` macro, which is a counterpart to the
`GENERIC_UNIT_TEST` macro that starts the leaders next to each other, ready
to attack. The `A_B` is because I'm planning a multiple-side variant too.

There's no test for [petrify], as simulate_combat doesn't provide a stat for it.

This tests only 3 of the 6 abilities whose behavior changed in 650f70405ff.
My thoughts on testing the others are:
* [firststrike]'s test is in 650f70405ff.
* [drains], [poison] and [slow] are tested here.
* [petrify] ends combat, it's also not exposed in simulate_combat's stats.
* [plague] triggers after combat ends."
908145133,Even more dispatcher,Vultraz,2022-04-12 20:51:25+00:00,2022-04-13 00:27:47+00:00,{'UI': 1},
905471614,GUI2/Distributor: further cleanup,Vultraz,2022-04-11 03:27:40+00:00,2022-04-11 11:52:54+00:00,{'UI': 1},"This restores the template to mouse_button, but it keeps the struct-based approach for specifying ui_events."
905325239,GUI2/Dispatcher: encode event categories in their enum values,Vultraz,2022-04-10 20:40:29+00:00,2022-04-10 21:56:28+00:00,{'UI': 1},inb4 CI doesn't like
905283354,Make tutorial hint messages persistent,CelticMinstrel,2022-04-10 17:07:02+00:00,2022-05-20 16:23:49+00:00,{'Campaign (any)': 1},"Based on @stevecotton's #6615, this moves many of the tutorial hint messages into persistent overlay text. I played through the tutorial with these changes and I think it seems pretty good, but it probably needs a little refinement."
904968167,"Add debug for ""[event] is missing name or id""",stevecotton,2022-04-09 15:10:22+00:00,2022-04-21 13:29:17+00:00,"{'Enhancement': 1, 'WML Tools': 1, 'Fwdport': 1}","The problem with this warning was that it didn't include any clue about what
had triggered it - just that there's a broken event somewhere, and it could be
in a scenario, macro, unit_type or even from another add-on if you're using a
non-default era.

When run with `--log-debug=wml`, this makes Wesnoth print out whatever the
contents of the affected [event] tag are.

See https://r.wesnoth.org/t55584 for more details."
903878879,SoF: Consistently use lower-case after ellipses,stevecotton,2022-04-08 13:58:00+00:00,2022-04-08 23:26:54+00:00,"{'Campaign (any)': 1, 'Prose': 1, 'Fwdport': 1}","Sadly, this takes the campaign up to 100 string changes between 1.16.2 and 1.16.3. The only one of these that was already going to change for 1.16.3 is S04t's volcanic forge one.

My intention (whether or not this merges) is to send out a mail to the i18n list when Saturday's pot-update is done, identifying the [4 strings that are actual changes](https://r.wesnoth.org/p672656), and saying that all the other fuzzies are just en_US grammar changes.

I think all of these make sense as mid-sentence pauses, but a few were arguably starting a new sentence so the ellipse was acting as both an ellipse and a full stop.

Pings: @max-torch. I'd ping demario if I knew his Github username."
903326740,Avoid using unit IDs that are no longer valid,Wedge009,2022-04-08 01:13:12+00:00,2022-04-11 14:26:00+00:00,"{'Backport': 1, 'Lua API': 1, 'Engine': 1}","Patch originally from @stevecotton. Aiming to merge before 1.16.3 is tagged (supposedly scheduled for 17th April 2022).

Resolves #6603 (crash with musl implementation of libc)"
902059838,Proof of concept: Convert the tutorial's wall of text [message]s into overlay text,stevecotton,2022-04-06 22:07:44+00:00,2022-04-09 21:15:47+00:00,"{'Enhancement': 1, 'Question': 1, 'Campaign (any)': 1, 'UI': 1, 'Schema': 1}","The reason for opening this is to ask if it's a direction that the UI should go in.

Adds the implementation of a prototype [hint_message] tag, either using PR #5837's add_overlay_text feature, or a fallback of outputting them to the chat log. This means a few less dialogs for the user to click through, but mainly means that about one hint per turn stays visible even when skipping through the dialogs.

The first of the two commits is PR #6614.

Turn 1's hint about upkeep appears near the end, when the player captures a village.

Turn 2's hint appears in the start-of-turn dialogue, when commenting on the orc blocking the bridge.

Turn 3 onwards appear at the start of each turn.

Initially I tried the bottom of the screen, but that overlaps with the area for `[message]`s.

With PR #5873 merged too:
![tutorial_add_overlay](https://user-images.githubusercontent.com/101462/161870949-4c7ad2de-9ddd-44fc-b5c6-f8e8d32de990.png)

Without that PR:
![tutorial_without_add_overlay](https://user-images.githubusercontent.com/101462/162079527-7232bbfc-5445-4321-97a4-20d729c098e9.png)"
902045124,Tutorial S02: Reduce the number of [messages],stevecotton,2022-04-06 21:43:53+00:00,2022-04-08 20:00:48+00:00,"{'Campaign (any)': 1, 'Prose': 1}","Drop many of the flavortext messages, to focus on the ones that explain
mechanics or tactics to the player.

The message about the Status Table gets removed because the player is unlikely
to benefit from it in this scenario. It might fit near the end as ""you can
check how much gold the enemy has, and guess if he'll recruit next turn"", but
otherwise it's just ""hey, you could look at all the menu items"" without any
suggestion about why the player should use it now.

Probably of interest to @max-torch too. The file is the same in 1.16 as master, so
could be backported."
900545043,NR S05a_01 Enhance dialogue between Tallin and Abhai,Descacharrado,2022-04-05 17:44:10+00:00,2022-04-08 00:26:09+00:00,{'Campaign (any)': 1},"
Squash before merging.

Closes #6608 "
899702097,Convert images to webp format,Pentarctagon,2022-04-05 03:35:43+00:00,2022-04-30 19:23:32+00:00,"{'AI': 1, 'Campaign (any)': 1, 'Docs': 1, 'Graphics': 1, 'MP': 1, 'UI': 1, 'WML Tools': 1, 'Units': 1, 'Building': 1, 'SCons': 1}","The commits in order:
* Fix a couple issues with the optiwebp script I noticed.
* Convert the contents of all images to webp, but leaving their extensions untouched.
* Rename all image files to match their webp contents.

This was done in two separate commits like this so that git would be able to recognize the image files as being the same before and after, and so still be able to track their history through the conversion.

The list of file size changes for all images changed, sorted by change in size, is [here](https://github.com/wesnoth/wesnoth/files/8414585/conversion-good.csv). This conversion does result in 34 files that have their size increased by some amount, however given it's only 34 out of 15,532 images, for the sake of consistency I went ahead and had those converted as well. Additionally:
* My own remaining work (replacing all references to .png and .jpg images with .webp) it's simpler since I can just blindly replace all filename extensions.
* Likewise, for UMC authors, they can rename all of their usage of mainline images to webp without needing to double check whether it's actually one of the few that's not a webp image.

The end result of this conversion is a decrease in the total size of the images Wesnoth uses from 234,037,555 bytes to 160,955,590. This is a decrease of 73,081,965 bytes, or 31.23% (almost 1/3).

---

Remaining work:
* Actually change all of mainline to reference the webp images.
* See if there's a way for wmllint to automatically do this work. The main thing I'm wondering about being whether it would be able to tell apart images an add-on is using from mainline vs from its own images directory.
* Re-add some test png and jpg images somewhere so the scons conf tests still work."
898786524,NR S05a_01 The Pursuit - Fixed units getting stuck in the wall before the spider chamber.,Descacharrado,2022-04-04 09:35:58+00:00,2022-04-05 00:27:08+00:00,"{'Backport': 1, 'Campaign (any)': 1}","Stuck units will now be brought back (or pushed forward if hex is occupied). Also fixed the trigger. Will open backport PR ~soon~ when approved.

Closes #6607 "
898478261,THoT: Move unused images to attic,Wedge009,2022-04-04 02:18:00+00:00,2022-04-05 00:34:19+00:00,{'Campaign (any)': 1},Resolves #6602
898184266,1.17 terrain-graphics macros clean-up,doofus-01,2022-04-03 02:13:29+00:00,2022-04-16 17:01:10+00:00,"{'Campaign (any)': 1, 'Graphics': 1, 'Terrain': 1}","I'll try to clear out the unused and used, but not really needed, terrain-graphics macros, so that migrating to a different graphics engine is less daunting.  This will take a while to reach merge state.

In general, I believe many (most?) of the terrain macros are legacy, and no longer really needed.  Most terrains can use one of the NEW:* macros, those are the ones to keep and update.  The *_PLFB-style and ""meta-macro"" + auto-generated rules are prime targets for removal, but the NEW macros aren't quite ready to take over as-is.

First thing to tackle is to replace the OVERLAY_* macros

EDIT: and I tried to skip CI from memory, but didn't get it right, apparently."
897204820,Attempt to actually make this a compile-time check,Vultraz,2022-04-01 10:18:46+00:00,2022-04-01 18:18:39+00:00,{'UI': 1},CI.
897195606,Scale map labels by zoom,Vultraz,2022-04-01 10:09:46+00:00,2022-04-01 19:06:05+00:00,{'UI': 1},"Simple UX improvement that occurred to me. Thoughts?

Before:
<img width=""237"" alt=""image"" src=""https://user-images.githubusercontent.com/3558659/161243251-56cb89f1-7e22-42e4-b86d-16cd90993b6f.png"">

After:
<img width=""371"" alt=""image"" src=""https://user-images.githubusercontent.com/3558659/161243340-679bc2ab-950a-4411-87fa-f365901eed45.png"">"
896190409,Refactored display-class theme initialization,Vultraz,2022-03-31 17:55:42+00:00,2022-03-31 20:56:29+00:00,"{'Editor': 1, 'Lua API': 1}","* controller_base::get_theme was removed and replaced with theme::get_theme_config. There was already a static map
  of theme configs in the theme class, so no need to reinvent the wheel.
* Renamed theme::get_known_themes to theme::get_basic_theme_info
* Hidden themes will be included in the known_themes map. Filtering now happens in get_basic_theme_info, which now
  has an additional `include_hidden` (false by default) argument.
* display::set_theme now takes the theme id instead of config
* editor_display no longer takes a theme_config/id argument and instead simply initializes its base class with the
  ""editor"" theme directly.
* display now takes the theme id instead of config. game_display was adjusted accordingly"
895205324,Add a unit test for [move_unit]location_id with an occupied hex,stevecotton,2022-03-31 01:14:30+00:00,2022-03-31 07:33:14+00:00,{'Unit Tests': 1},"Just a CI check for the forward-port of #6571.

(cherry picked from commit ba1767f8b90a4ca34cf8ef2abbc03cf98fd488f8)"
893996079,Simplify math.hpp's count_leading_zeros,stevecotton,2022-03-30 06:07:14+00:00,2022-03-31 01:11:11+00:00,{},"The old count_ones had undefined behavior in the case of arithmetic underflow,
so replace count_leading_zeros with a simpler implementation.

Note: `std::numeric_limits<signed char>::digits` excludes the sign bit from the
size - so the `for` loop gets an off-by-one error if the 'std::make_unsigned_t`
is removed."
892610161,Create MP Server Dashboard,max-torch,2022-03-29 06:13:13+00:00,2023-02-16 14:58:40+00:00,{'Services': 1},A web-based dashboard for viewing and exploring mp server data.
891336152,Add script to mass convert images to webp.,Pentarctagon,2022-03-28 05:05:35+00:00,2022-04-03 19:56:39+00:00,{'Graphics': 1},"---

This is a script that converts png to lossless webp and jpg to lossy webp (quality 90), as well as reconverts existing webp images using lossless conversion. This PR is not for actually converting any images.

Remaining work:
* Some TODO comments.
* See if there's some way to tell if a webp image was created with lossy vs lossless compression.

[conversion-good.csv](https://github.com/wesnoth/wesnoth/files/8359738/conversion-good.csv) has a list of the files that had their size reduced by more than 10%.
[conversion-bad.csv](https://github.com/wesnoth/wesnoth/files/8359737/conversion-bad.csv) has a list of files that did not have their size reduced by more than 10%.

A quick summary:
* Out of 13832 files, 13345 files had their size reduced by more than 10% while 487 did not.
* Of the 13345 files, the average size reduction was ~30%.
* The total size reduction for the 13345 files was 71.8 MBs."
891153213,THoT: Remove unused Ratheln character,Wedge009,2022-03-27 22:13:08+00:00,2022-03-28 04:06:54+00:00,"{'Campaign (any)': 1, 'Graphics': 1}",Resolves #6587
891131806,[1.16] [draft because it triggers the crash]: Add a unit test for firststrike and laststrike,stevecotton,2022-03-27 20:26:38+00:00,2022-03-29 07:23:50+00:00,"{'Bug': 1, 'Unit Tests': 1, 'Fwdport': 1}","Unit test for issue #6575, and confirming that the fix in #6573 works. Will
rebase on top of the fix once the fix is merged.

[ci skip]"
891101343,1.17 terrain transitions update,doofus-01,2022-03-27 18:05:23+00:00,2022-04-02 11:13:20+00:00,"{'Graphics': 1, 'Terrain': 1}","This is best summarized with these before/after images.  Possibly the rubble is too busy now, maybe it should have bigger rocks, or maybe just lower contrasts.
![Screenshot_20220327_before](https://user-images.githubusercontent.com/13510196/160294525-aaa60910-b694-45e8-8c1f-f896519a8c48.jpg)
![Screenshot_20220327_after](https://user-images.githubusercontent.com/13510196/160294534-dfc371ab-ab6c-40dd-be0b-5895b44ac78a.jpg)
"
890493911,[1.16] wmlxgettext: add a --no-sort-by-file option,stevecotton,2022-03-26 17:30:49+00:00,2022-03-28 08:34:17+00:00,"{'Translations': 1, 'WML Tools': 1, 'Fwdport': 1}","Some users of wmlxgettext have scripts that already provide the file list in
a deterministic order, and the sorting added in 2adcb92fab was choosing a
different order to the one desired.

This doesn't affect mainline's .pot files - `scons pot-update` will have the same
output with or without this change.

@cooljeanius here you go."
890451428,[campaign] [1.17] Update Xol -> Xos^Efs for 4 campaign maps,knyghtmare,2022-03-26 16:25:10+00:00,2022-03-29 07:26:05+00:00,{'Campaign (any)': 1},Fixes #6584 
890445141,"[1.16] Unit tests for [drains], [poison] and [slows], including apply_to=opponent",stevecotton,2022-03-26 16:15:18+00:00,2022-04-19 13:27:23+00:00,"{'Bug': 1, 'Unit Tests': 1, 'Units': 1, 'Fwdport': 1}","Here `apply_to=opponent` means that the weapon special gives the opponent the
ability, the unit that should get poisoned or slowed is the unit that has the
weapon special.

There's a known bug in 1.16, that `apply_to=opponent` check the wrong unit to
see it it's `unpoisonable`, `undrainable` etc. It also checks the wrong unit to
see if it's already poisoned or slowed, so a battle between two units that both
have reverse-poison results in at most one being poisoned.

As 1.16 has already been released, to avoid OOS the test is checking that the
current behavior's known bug is preserved. For the 1.17 branch the four tests
labelled `preserving known bug` will be changed to test the reverse.

Most of the credit for this is Newfrenchy's, as he's already written a fix
and a WML based test. This commit uses a Lua test instead to test more
combinations of statuses.

This adds a `COMMON_KEEP_A_B_UNIT_TEST` macro, which is a counterpart to the
`GENERIC_UNIT_TEST` macro that starts the leaders next to each other, ready
to attack. The `A_B` is because I'm planning a multiple-side variant too.

There's no test for [petrify], as simulate_combat doesn't provide a stat for it.

This tests only 3 of the 6 abilities whose behavior will change in 1.17's
equivalent of 1.16's 7b39b656063. That's sufficient to prevent any accidental
copy of the 1.17 fix to 1.16, and my thoughts on testing the others are:
* [firststrike]'s test is in 7b39b656063. It crashed, so is fixed in 1.16.
* [drains], [poison] and [slow] are tested here.
* [petrify] ends combat, it's also not exposed in simulate_combat's stats.
* [plague] triggers after combat ends."
888648119,1.16 build fixes for Xcode,irydacea,2022-03-24 17:39:15+00:00,2022-03-24 18:58:45+00:00,"{'macOS': 1, 'Building': 1}",
887810952,[DID] [Alone at Last] Ensure Spectral Servant unit-line cannot pick up the book,knyghtmare,2022-03-24 00:22:02+00:00,2022-03-25 21:37:24+00:00,"{'Backport': 1, 'Campaign (any)': 1}",Fixes #6576 
886590615,fix [firststrike] special with apply_to=opponent crashes Wesnoth 1.17.x,newfrenchy83,2022-03-22 23:08:16+00:00,2022-04-08 00:30:15+00:00,"{'Unit Tests': 1, 'WML': 1, 'Units': 1}","like reported in forum in https://forums.wesnoth.org/viewtopic.php?p=672374#p672374
if unit with ""last strike"" ([firststrike] special with apply_to=opponent, on any of its attacks) is targeted by other unit for attack, wesnoth crashes,
and other problems exist also for other weapon specials like poisons, when apply_to=opponent used(id two user of this specials fight, one fighter only could be poisoned)"
886587540,fix [firststrike] special with apply_to=opponent crashes Wesnoth 1.16.x,newfrenchy83,2022-03-22 23:03:06+00:00,2022-04-05 19:52:57+00:00,"{'Unit Tests': 1, 'WML': 1, 'Units': 1}","Closes https://github.com/wesnoth/wesnoth/issues/6575. like reported in forum in https://forums.wesnoth.org/viewtopic.php?p=672374#p672374
if unit with ""last strike"" ([firststrike] special with apply_to=opponent, on any of its attacks) is targeted by other unit for attack, wesnoth crashes,
and other problems exist also for other weapon specials like poisons, when apply_to=opponent used(id two user of this specials fight, one fighter only could be poisoned)"
886421385,Add unit tests for Lua API wesnoth.simulate_combat,stevecotton,2022-03-22 19:18:33+00:00,2022-03-23 06:43:11+00:00,"{'Unit Tests': 1, 'Lua API': 1}","Forward-port of #6569, just running the CI.

(cherry picked from commit d96968b2ec0ea3198982fc530ee68054dd19af63)"
886363049,[1.16] Add a unit test for [move_unit]location_id with an occupied hex,stevecotton,2022-03-22 18:19:46+00:00,2022-03-29 07:24:19+00:00,"{'Unit Tests': 1, 'Fwdport': 1}",
886124975,Misc cleanups,Vultraz,2022-03-22 14:25:15+00:00,2022-03-22 15:26:54+00:00,"{'AI': 1, 'UI': 1, 'Units': 1, 'Lua API': 1, 'Terrain': 1}",For CI.
886093901,[1.16] Add unit tests for Lua API wesnoth.simulate_combat,stevecotton,2022-03-22 14:01:08+00:00,2022-03-22 18:16:12+00:00,"{'Unit Tests': 1, 'Lua API': 1, 'Fwdport': 1}","Building blocks to write the tests that I want to add for #6468. The PR adds the tests to 1.16, because it might as well check that the API stays stable.

@newfrenchy83 sorry it's taking so long to finish your review."
885985021,Reimplement mingw cross-compile docker image,loonycyborg,2022-03-22 12:27:46+00:00,2022-03-22 18:06:07+00:00,{'Docker': 1},"rwgrim/msys2-cross on dockerhub we're currently using is incapable of being updated anymore because of changes in msys2 keyring and rebuilding the image from scratch is hard because it requires manual setup and many things seems to have broken due to changes in pacman and the like. So I made my own variant of it that downloads msys2 as archive, and uses pacman from archlinux base image to download msys2 package updates. rwgrim/msys2-cross uses debian base with pacman-static but I couldn't make this way work since new version of pacman-static seems to depend on some extra config files not existing in debian."
885166806,Use non-attic jpg file.,Pentarctagon,2022-03-21 18:22:13+00:00,2022-03-21 18:26:17+00:00,"{'Building': 1, 'SCons': 1}","---

Just waiting to see that the scons jpg check passes, then I'll merge."
882331362,"Used std::any, except on MacOS",Vultraz,2022-03-17 10:55:16+00:00,2022-03-17 12:27:06+00:00,{'WFL': 1},"For CI.

There's one remaining use of boost::any in commandline_options.cpp that cannot be converted since boost::program_options
excepted custom validator functions to take boost::any as their first argument.

"
878430626,update codeblock projetfiles,newfrenchy83,2022-03-13 17:05:31+00:00,2022-03-13 17:07:00+00:00,{'Building': 1},Fix https://github.com/wesnoth/wesnoth/issues/6562 isue
878360507,update codeblock projectfiles,newfrenchy83,2022-03-13 10:39:48+00:00,2022-03-13 10:44:34+00:00,{'Building': 1},
878267385,Make MSVC fail when C files generate warnings.,Pentarctagon,2022-03-12 22:32:39+00:00,2022-03-12 22:32:46+00:00,"{'Building': 1, 'CMake': 1}",
878097486,Fix #6389.,Pentarctagon,2022-03-12 05:58:41+00:00,2022-03-13 16:46:18+00:00,{'Add-ons': 1},"Previously this code assumed that all add-ons would have a _server.pbl or an _info.cfg. When neither was the case, it tried to dereference the begin() of an empty set, causing the crash."
875277877,Remove gui/auxiliary/filter.hpp and unused includes of pane.hpp,stevecotton,2022-03-09 12:56:54+00:00,2022-03-14 20:36:04+00:00,"{'UI': 1, 'Add-ons': 1, 'Building': 1}","Remove filter.hpp, which wasn't included by any file, and relied on
pane.hpp indirectly via one of the lines removed in this commit. The sorting
functionality seems to have moved into pane.cpp when matrix.hpp was added.
Note: there are two other unrelated `filter.hpp` files.

Header pane.hpp is only used by matrix.hpp, pane.cpp, and window_builder.cpp;
the class is also used via a forward-declaration in window.hpp, which friends
it, allowing a call to window::layout_linked_widgets. The class is also made
accessible via REGISTER_WIDGET.

Part of #6540."
874962943,Minor req cleanup,Vultraz,2022-03-09 06:32:32+00:00,2022-03-09 09:36:44+00:00,"{'Building': 1, 'SCons': 1, 'CMake': 1, 'Terrain': 1}",For CI.
873403621,Put translation contribution info into CONTRIBUTING.md.,Pentarctagon,2022-03-07 18:01:24+00:00,2022-03-12 03:42:29+00:00,{'Docs': 1},"---

This would be a replacement to https://wiki.wesnoth.org/WesnothTranslations, just in a place people are more likely to see that contributing to translations is a thing they can do.  After merging, that wiki page would be replaced with a redirect to this section of CONTRIBUTING.md.

Translations listed with a maintainer of None were determined by there being no updates to that language for over 5 years, or if a language was added more recently but has not received any meaningful updates since."
872688854,1.17 new terrain,doofus-01,2022-03-07 04:29:32+00:00,2022-03-21 03:35:08+00:00,"{'Graphics': 1, 'Terrain': 1}","Very rough draft of palisades, mostly just planting a flag for now."
872483353,SoF: explain the Shorbear tools as products of the volcanic forge,stevecotton,2022-03-06 15:46:18+00:00,2022-03-09 12:31:19+00:00,"{'Backport': 1, 'Campaign (any)': 1, 'Prose': 1}","I don't like the explanation of the tools being made of unobtainium, so changed
it to use a convenient plot device. I think this also solves a plot hole about
the forge; instead of it being near the Shorbear Caves by random chance, this
gives a reason for the Shorbear Clan to live there (even if they haven't been
in there in living memory).

@max-torch I'd appreciate a review please, but I can't add you in Github's UI."
872477470,Piglets: add a po hint that these are wild boars' young,stevecotton,2022-03-06 15:14:13+00:00,2022-03-07 07:27:56+00:00,{'Units': 1},"Possibly unnecessary, but can't hurt."
872466610,"Treat all 1.17 builds as dev versions, including non-canonical ones",stevecotton,2022-03-06 14:14:46+00:00,2022-03-06 16:44:55+00:00,{'Engine': 1},"This controls whether the ""show deprecation warnings"" preference defaults to
on or off. It seemed odd to have that default to on for the official 1.17.x
releases, yet default to off for local builds which developers are fixing."
871829506,update codeblock projectfiles,newfrenchy83,2022-03-04 16:40:11+00:00,2022-03-04 16:41:13+00:00,{'Building': 1},
871014040,Make lua a git submodule,Pentarctagon,2022-03-03 21:03:54+00:00,2022-03-09 21:01:37+00:00,"{'macOS': 1, 'AI': 1, 'Lua API': 1, 'Building': 1, 'SCons': 1, 'CMake': 1}","This PR removes the in-tree lua code to instead be a git submodule. This is done by:
* Reverting the static_cast change to the lua source code - wrap the direct `lua/` includes in one of the headers in the `nowarn/` directory, which contains the necessary changes (mostly `#pragma`s) to ignore the old style cast warnings. This is kinda hacky, but I wasn't able to find a better way to suppress warnings from external header files.
* Not renaming the `.c` files to `.cpp` - instead specify those files to be compiled as C++ via the command line (`-x c++` for gcc/clang, `/TP` for MSVC).

The main benefit being that we'd be using the unmodified lua source code, which as a submodule means that updating to a new version of lua can be done just by going into the submodule's directory, doing a `git checkout` of the next tagged version, and pushing that update to Wesnoth's repo."
867440227,Add egallager to about.cfg,cooljeanius,2022-03-01 04:11:48+00:00,2022-03-01 06:04:58+00:00,{},"Add myself as a miscellaneous contributor; see #6475

Past commits: https://github.com/wesnoth/wesnoth/commits?author=cooljeanius

Inspired by #6545
"
867140755,Add larb0b to about.cfg,larb0b,2022-02-28 20:05:36+00:00,2022-02-28 20:13:09+00:00,{},Add larb0b as a miscellaneous contributor. Was pinged about this in #6475. 
864096335,Store add-on passwords in the credentials file as well.,Pentarctagon,2022-02-26 04:57:17+00:00,2022-03-10 16:23:01+00:00,"{'UI': 1, 'Add-ons': 1}","This allows storing add-on passwords for uploading in the same credentials file as is currently used by the client when connecting to a multiplayer server. For add-on authors that don't keep their passwords as plaintext in their _server.pbl, this removes the need for them to manually enter their password each time they upload an add-on."
863880993,Doxygen: fix mainpage links with Doxygen 1.9.1,stevecotton,2022-02-25 23:40:42+00:00,2022-02-26 07:11:35+00:00,"{'Docs': 1, 'Building': 1}","The extra indentation on these lines caused Doxygen in my local builds
to treat them as a block of preformatted text, and to escape all the HTML.

Locally I'm building with Debian Unstable, which has Doxygen 1.9.1. The
bug isn't present in the CI built docs on https://devdocs.wesnoth.org/
which were built with Doxygen 1.8.13."
858949389,Fix some minor bugs in WC campaign,wuxiangjinxing,2022-02-21 00:33:37+00:00,2022-09-17 04:20:35+00:00,{'Campaign (any)': 1},
858868196,WoF: update map of S9 To stop a Cave Bear spawning at an unreachable location,knyghtmare,2022-02-20 17:18:55+00:00,2022-02-20 17:28:05+00:00,{'Campaign (any)': 1},"This patches the following:
https://cdn.discordapp.com/attachments/438001869906903060/934966013311737936/unknown.png

Context: At the second stage, the player has to team up with the dragon and kill all enemies...but this cave bear is unreachable so scenario never ends"
858637352,[world conquest] update deprecated share_view to share_vision,knyghtmare,2022-02-19 16:35:57+00:00,2022-02-19 18:54:59+00:00,{'Campaign (any)': 1},"```lua
share_view = true,
```
To:
```lua
share_vision = ""all"",
```"
858633916,[world conquest] Backport of making Banner stack with leadership,knyghtmare,2022-02-19 16:24:47+00:00,2022-06-27 19:14:50+00:00,{'Campaign (any)': 1},This was supposed to have been backported around 18-20 January of 2022...
857900735,Don't require keep for human players,chris-cook,2022-02-19 00:12:35+00:00,2022-02-19 00:17:17+00:00,{},"Unfortunately, the AI is hard-coded to assume that keep occupation is required, so this is strictly human player only."
855012097,Replace deprecated placement=map_overwrite,Wedge009,2022-02-17 02:32:26+00:00,2022-02-17 05:04:09+00:00,"{'Backport': 1, 'Campaign (any)': 1, 'WML': 1}","I think deprecation notifications are only being shown in 1.17 but not 1.16. I noticed the `map_overwrite` deprecation message when testing the former.

I checked the change in SotA S17, no apparent regressions. I don't see any other instances of `map_overwrite`.

Info: https://wiki.wesnoth.org/SingleUnitWML#placement"
854620099,update instruction for compilate boost libraries,newfrenchy83,2022-02-16 16:53:17+00:00,2022-02-16 16:53:53+00:00,{'Building': 1},
854153727,Workaround a Doxygen bug by naming an anonymous Lua struct,stevecotton,2022-02-16 09:06:16+00:00,2022-02-16 15:42:46+00:00,"{'Lua API': 1, 'Building': 1}","This change should make no difference at all. However, without it Doxygen reports these warnings, thus making the CI builds fail.
Fixes #6528.

* /home/wesnoth-CI/src/actions/heal.cpp:45: warning: documented symbol 'heal_unit::heal_unit' was not declared or defined.
* /home/wesnoth-CI/src/actions/heal.cpp:66: warning: documented symbol 'POISON_STATUS @8::poison_status' was not declared or defined.
* /home/wesnoth-CI/src/actions/heal.cpp:83: warning: documented symbol 'POISON_STATUS @8::poison_progress' was not declared or defined.
* /home/wesnoth-CI/src/actions/heal.cpp:159: warning: documented symbol 'bool @8::update_healing' was not declared or defined.
* /home/wesnoth-CI/src/actions/heal.cpp:180: warning: documented symbol 'int @8::heal_amount' was not declared or defined.
* /home/wesnoth-CI/src/actions/heal.cpp:234: warning: documented symbol 'void @8::do_heal' was not declared or defined.
* /home/wesnoth-CI/src/actions/heal.cpp:250: warning: documented symbol 'void @8::animate_heals' was not declared or defined."
853961463,Upgrade to lua 5.4.4,Vultraz,2022-02-16 04:17:18+00:00,2022-02-16 06:14:37+00:00,{},
853917976,HttT S17: Update to comply with current Wesnoth Lua API specifications,Wedge009,2022-02-16 02:57:32+00:00,2022-02-16 15:46:25+00:00,"{'Backport': 1, 'Campaign (any)': 1, 'Lua API': 1}","Resolves #6517

It might be obvious to experienced Lua API users but it's not a direct translation to `map.special_locations` as per https://wiki.wesnoth.org/LuaAPI/UpdatingFrom14, but rather `wesnoth.current.map.special_locations`.

I tested this in master and believe it can/should be back-ported to 1.16."
853706088,SoF: Fix for Thursagan's Arcanister advancement breaking,knyghtmare,2022-02-15 21:13:43+00:00,2022-02-16 06:37:48+00:00,{'Campaign (any)': 1},Same as #6484 but for the 1.16.x branch. A backport.
853317829,Fix comment handling if the value is empty (fixes #6514),soliton-,2022-02-15 14:13:44+00:00,2022-02-15 18:49:31+00:00,{'WML Tools': 1},
852921720,DM S11: Correct vision sharing when Delfador finds Chantal,Wedge009,2022-02-15 07:35:37+00:00,2022-02-15 12:28:40+00:00,{'Campaign (any)': 1},"Partial back-port of #6498 (second and final commit in that PR, as at time of writing). Originally @stevecotton's findings."
851070948,1.16 [micro_ai] bottleneck ai,doofus-01,2022-02-13 18:04:36+00:00,2022-06-09 13:36:13+00:00,{'AI': 1},"This addresses an error (I'll update if I get a simple way to reproduce)
```error scripting/lua: ai/lua/ai_helper.lua:314: attempt to index a nil value (local 'dst')
stack traceback:
        ai/lua/ai_helper.lua:314: in field 'robust_move_and_attack'
        ai/micro_ais/cas/ca_bottleneck_move.lua:480: in field 'execution'
        [string ""local self, params, data, filter_own = ......""]:2: in main chunk
```

I'm not sure this is a proper fix, but it seems to work, so I'll park it here for now."
850677087,Fixed Warden’s and Arbiter’s animations popping on water tiles,Descacharrado,2022-02-13 12:57:44+00:00,2022-07-02 17:54:09+00:00,"{'AI': 1, 'Campaign (any)': 1, 'Graphics': 1, 'Editor': 1, 'Units': 1, 'Building': 1, 'SCons': 1, 'CMake': 1, 'Terrain': 1}","Will add animation gifs if needed. Needs more testing. Diff says there were deletions even tho  there were no deletions, only additions and code repositioning.

Closes #6508 
Addresses my request in #6475 (my name should be deleted from that issue when backported)"
849738632,[units] [Orcish Nightblade] Update Icon for the kick attack,knyghtmare,2022-02-13 00:09:20+00:00,2022-02-13 13:25:52+00:00,{'Units': 1},"Note: On the 2nd of January, 2022, this was committed for the 1.16 branch but was not forward ported. Thus, I am making a PR."
849726919,world conquest: fix bezoar artifact being bugged,knyghtmare,2022-02-12 23:59:51+00:00,2022-06-28 04:33:56+00:00,"{'Ready for testing': 1, 'Campaign (any)': 1, 'MP': 1}",Closes #6513 
848551027,[1.16] Warning when share_view or share_maps overrides share_vision,stevecotton,2022-02-12 04:10:30+00:00,2024-01-05 10:23:25+00:00,"{'Enhancement': 1, 'WML': 1, 'Fwdport': 1}","Add a new type of deprecation warning, used when a deprecated WML attribute is used alongside its replacement. Use that to log a deprecation warning if a [side] has share_vision overridden by share_view or share_maps.

While share_view and share_maps are deprecated on the Wiki, they don't trigger deprecation warnings on their own. I intend to make them trigger warnings in 1.17, but they map cleanly to the share_vision enum so the wrapper is easy to support indefinitely.

All SP uses of the deprecated attributes were removed from mainline in f983a998a2 on the 1.17 branch, which was backported to 1.16 as 80c9263003.

On 1.16, WC still has one [side]share_view=, in WC's side_definitions.lua; this has been replaced in 35aa0d1893 on the master branch. It won't trigger this warning, because it isn't used in the same tag as [side]share_vision=.

The branch name is no longer accurate, as some feature-creep has been removed."
845657254,remove only_active argument to weapon_specials(),newfrenchy83,2022-02-10 17:13:41+00:00,2022-02-11 05:23:00+00:00,"{'UI': 1, 'Units': 1}","weapon_specials only called in unit_attack.cpp, only_active argument don't usable"
845362394,Add test scenario for teacher-based weapon specials,stevecotton,2022-02-10 14:29:18+00:00,2022-04-18 02:52:56+00:00,{'Unit Tests': 1},"This is intended for manual testing, the reason for writing it is to
test tooltips in the attack-predictions dialog. It has a new map, with
five sides packed into adjacent hexes.

Everyone gets a self+allies leadership based on their side number, with
their name in the ability's id and ability's name for tracking whose buffs
are affecting who.

I'm expecting to do more changes to it before considering whether it should
be merged as a standalone test, added to data/scenario-test.cfg, or discarded.

[ci skip]"
845023610,[1.16] Update to Flatpak 21.08,stevecotton,2022-02-10 10:39:35+00:00,2022-02-10 13:10:53+00:00,"{'Building': 1, 'Packaging': 1}","Since the CI was updated to build 1.17 with Flatpak 21.08, the 1.16 builds have failed because they're lacking 20.08.

This cherry-picks c6f9a96a09e3eda6e1e43ccdaabe8a5442a40b2a and 35211181b4ba6e08ff67d9a1b9ee3cdd2e311990. I haven't done local testing, just want to run a build to check that the CI is currently fully set up if we upgrade 1.16 to 21.08.
"
844737081,[1.16] Change [filter_weapon] to not depend on attack_type::weapon_specials,stevecotton,2022-02-10 05:41:39+00:00,2022-02-10 15:35:24+00:00,"{'WFL': 1, 'Units Database': 1}","Backport of #6501.

This changes it to use the function that attack_type::get_value already uses,
thus removing a call to attack_type::weapon_specials. The latter is being
refactored by newfrenchy83 (and that refactor is expected to be backported as
it allows UI improvements).

This code is part of the object used for [filter_weapon]formula=, however the
implementation of that filter creates exactly one attack_type_callable, so
doesn't trigger this code. For testing I called it via a debugger.

(cherry picked from commit 6ccac5a5e8ff75303c9190c0da60580925cb32c0)"
844232654,Change [filter_weapon] to not depend on attack_type::weapon_specials,stevecotton,2022-02-09 19:03:41+00:00,2022-02-10 05:36:48+00:00,"{'Enhancement': 1, 'Units': 1, 'WFL': 1}","This changes it to use the function that attack_type::get_value already uses,
thus removing a call to attack_type::weapon_specials. The latter is being
refactored by @newfrenchy83, and questions about the effect of that refactor on
this code delayed the review on his PR.

This code is part of the object used for [filter_weapon]formula=, however the
implementation of that filter creates exactly one attack_type_callable, so
doesn't trigger this code. For testing I called it via a debugger."
843603606,wmlxgettext and wmlindent change exit code,max-torch,2022-02-09 08:13:08+00:00,2022-02-16 11:12:38+00:00,"{'Backport': 1, 'WML Tools': 1}",For keyboard interrupt change exit code from 0 to 1.
842899006,Add-ons manager: handle the selected add-on changing in small-screen mode,stevecotton,2022-02-08 14:49:23+00:00,2022-02-08 16:43:07+00:00,"{'Bug': 1, 'UI': 1, 'Add-ons': 1}","Forward-port of #6490, intending to merge after the CI finishes.
Fixes #6485.

Fix another instance of issue #3059, where code assumes that all parts of the
add-ons manager's UI are accessible, an assumption that fails when the dialog
uses a stacked widget to handle small window sizes.

The up and down arrow keys select the previous or next add-on in the list,
even when the small-window layout is hiding the list. That feels like a feature
rather than a bug, as it's useful and an understandable UX; however it needs
the fix in this commit so that on_addon_select() doesn't throw an exception
and close the dialog. The new code is the same as the fix that 050feb623b
applied to on_selected_version_change, traversing the stacked widget to get the
info.

(cherry picked from commit 6a72b2e5114619e7736de97d47a1407254f8fa8a)"
842771510,Replace deprecated share_maps and share_view with share_vision,Wedge009,2022-02-08 12:45:42+00:00,2022-02-15 11:08:04+00:00,"{'Campaign (any)': 1, 'Unit Tests': 1, 'WML': 1}","Closes #6496.

Not sure if I'm understanding the [documentation](https://wiki.wesnoth.org/SideWML) correctly but I interpreted `share_maps=yes` as `share_vision=shroud` and `share_view=yes` as `share_vision=all`.

Also not sure if it's worth back-porting, since there's the potential to break compatibility for games in progress. But if reviewers think it's okay, I can back-port too."
841796399,reintroduced usage of time_cfg[current_time] in replace (local) schedule funtions,kallaballa,2022-02-07 14:25:37+00:00,2022-02-13 18:51:42+00:00,{'Lua API': 1},Fixes #5757
841464478,reintroduced usage of time_cfg[current_time] in replace_schedule functions,kallaballa,2022-02-07 08:45:44+00:00,2022-02-07 14:22:24+00:00,"{'Editor': 1, 'Lua API': 1}",This fixes #5757
841452110,WoF and Drake revisions,nemaara,2022-02-07 08:32:03+00:00,2022-02-19 17:58:54+00:00,{'Campaign (any)': 1},"Like the title says, cleans up some references in WoF and revises the mainline drake race description. This will not handle a more detailed text revision of WoF, only lore references. "
841183545,1.17 minor terrain fixes,doofus-01,2022-02-06 23:45:50+00:00,2022-03-06 23:25:16+00:00,"{'Graphics': 1, 'Terrain': 1}",1.17 version of #6488
841182597,1.16 fix bad Swamp-Icy_Cobble (Ss-Rra) transition,doofus-01,2022-02-06 23:40:32+00:00,2022-02-12 12:08:40+00:00,{'Terrain': 1},
841028071,Add-ons manager: handle the selected add-on changing in small-screen mode,stevecotton,2022-02-06 09:16:21+00:00,2022-02-08 13:07:41+00:00,"{'Bug': 1, 'UI': 1, 'Add-ons': 1, 'Fwdport': 1}","Fix another instance of issue #3059, where code assumes that all parts of the
add-ons manager's UI are accessible, an assumption that fails when the dialog
uses a stacked widget to handle small window sizes.

The up and down arrow keys select the previous or next add-on in the list,
even when the small-window layout is hiding the list. That feels like a feature
rather than a bug, as it's useful and an understandable UX; however it needs
the fix in this commit so that on_addon_select() doesn't throw an exception
and close the dialog. The new code is the same as the fix that 050feb623b
applied to on_selected_version_change, traversing the stacked widget to get the
info.

Fixes #6485."
840979277,1.16 Various terrain fixes,doofus-01,2022-02-06 02:15:18+00:00,2022-02-06 06:04:51+00:00,"{'Graphics': 1, 'Terrain': 1}","some terrain graphics fixes, no new content."
840860111,forwardport #6477,doofus-01,2022-02-05 12:53:56+00:00,2022-02-07 00:02:25+00:00,"{'Graphics': 1, 'Terrain': 1}",
839509489,SoF: fix thursagan's arcanister advancement breaking in some cases,knyghtmare,2022-02-03 16:53:48+00:00,2022-02-15 21:06:51+00:00,"{'Backport': 1, 'Ready for testing': 1, 'Campaign (any)': 1, 'Units': 1}","Fix for the following bug:
![image](https://user-images.githubusercontent.com/5283677/152389647-4c495e78-1402-478d-aef6-a77c611a29cb.png)
"
839360651,Lua API: Add inline documentation for pretty much everything,CelticMinstrel,2022-02-03 14:30:06+00:00,2022-02-17 18:43:31+00:00,"{'AI': 1, 'Campaign (any)': 1, 'Lua API': 1}","I did this several months ago but never got around to submitting it, so there might be something missing here and there if things have changed since then.

In addition to covering things defined in Lua, this includes stub definitions with documentation of everything defined in C++, in the utils/emmylua folder.

The Lua add-on for Visual Studio Code uses this format to improve tooltips and auto-completion.
"
838031983,"Fix deprecation of [advancefrom], mark as already removed",stevecotton,2022-02-02 07:49:18+00:00,2022-02-02 11:00:49+00:00,"{'Bug': 1, 'WML': 1, 'Units': 1}","Forward-port of #6425, planning to just run the CI and then merge immediately.
Closes #6204.

The existing code searched for `[units][advancefrom]` instead of
`[unit_type][advancefrom]`, so wasn't triggering. It was planned
for removal in 1.17, so simply mark it as already-removed in 1.15.3.

The deprecation warning is shown on stdout/stderr, but not in the
in-game UI, so it's generally not visible to players. I think it
would be better if it was visible, but OTOH it's something that's
easy for someone to check all add-ons for with a simple grep.

(cherry picked from commit f2fa807e6107c63aa9b38f36e5ad8a8fcfacf9a9)"
836887811,Update credits,czyzby,2022-02-01 06:45:53+00:00,2022-02-07 03:09:32+00:00,{},Add missing entry to the `about.cfg` file. See #6475.
835718967,Add max_torch to about.cfg,max-torch,2022-01-31 04:11:09+00:00,2022-01-31 22:48:49+00:00,{'Backport': 1},Add max_torch as miscellaneous contributor.
835689144,reset stats on replay load,silverthefox123,2022-01-31 03:33:12+00:00,2022-06-27 18:56:29+00:00,{'Replays': 1},solves [#4133](https://github.com/wesnoth/wesnoth/issues/4133)
835602065,Master variations 20220129,doofus-01,2022-01-31 01:01:14+00:00,2022-01-31 01:01:20+00:00,{},
835596111,1.16 variations 20220129,doofus-01,2022-01-31 00:45:42+00:00,2022-01-31 03:17:55+00:00,"{'Graphics': 1, 'Fwdport': 1, 'Terrain': 1}","I'm not completely sure these can go into 1.16.  They only change the appearance slightly and won't break anything outright, but new transition behavior between terrain codes Xos and Aa might be too much for stable?"
835595727,Add /clear chat command,macabeus,2022-01-31 00:44:25+00:00,2022-01-31 02:59:25+00:00,{'UI': 1},"Solves #3202

Add `/clear` chat command

(cherry-picked commit from https://github.com/wesnoth/wesnoth/pull/6457)"
835316576,Update pl.po,IliketoTranslate,2022-01-30 09:03:36+00:00,2022-01-30 23:28:31+00:00,{'Translations': 1},
835258528,Refactor the backstab unit test,stevecotton,2022-01-30 02:54:36+00:00,2022-02-02 19:46:37+00:00,"{'Docs': 1, 'Unit Tests': 1}","Based on part of Pentarctagon's #6308, and also improving
the encapsulation of the test to take a boolean value for whether
the ability should be active instead of the expected damage total."
835256930,Add `wesnoth-map-diff`,macabeus,2022-01-30 02:36:57+00:00,2022-04-27 22:40:53+00:00,{'Editor': 1},"Solves https://github.com/wesnoth/wesnoth/issues/2323

This PR is a proposal to add a new command-line tool, `wesnoth-map-diff`.

It aims to be a CLI to produce an image comparing two tilemaps, used by a GitHub Action to comment on a PR automatically:
<img width=""731"" alt=""image"" src=""https://user-images.githubusercontent.com/9501115/158066801-1cecf2c4-df32-46ed-aab6-2e1624810a4d.png"">

I'm writing it using JS because it's the language I'm most used to and be easy to develop this kind of tool.
To use it, you need to have Node.js. Then on your terminal:
```
> cd utils/wesnoth-map-diff
> npm i
> node src/index.js
```"
835188048,Fix sidebar abilities leaking shrouded information,macabeus,2022-01-29 18:43:34+00:00,2022-09-16 03:49:13+00:00,{'Units': 1},"Fixes https://github.com/wesnoth/wesnoth/issues/4456

Now when you focus on a shrouded tile, all abilities will be shown as inactive.

I tried to make it only for abilities that depend on a specific tile, but I can't find a parameter to check it. If there is one, we can improve that.

![image](https://user-images.githubusercontent.com/9501115/151673482-267ccde8-eb77-463a-9e0c-a9af97b73030.png)

![image](https://user-images.githubusercontent.com/9501115/151673487-0161b7e6-63ef-4b6b-8007-99eee83def2a.png)

![image](https://user-images.githubusercontent.com/9501115/151673491-03866628-474c-4c95-b0ee-a3625c0c9fe5.png)
"
835169683,Replace make enum,Pentarctagon,2022-01-29 16:52:15+00:00,2022-03-04 03:23:02+00:00,"{'macOS': 1, 'AI': 1, 'MP': 1, 'UI': 1, 'Editor': 1, 'Units': 1, 'Lua API': 1, 'Add-ons': 1, 'Building': 1, 'WFL': 1, 'Help': 1, 'Terrain': 1}","Enums:
- [x] enumname - make_enum unit test, irrelevant
- [x] another - make_enum unit test, irrelevant
- [x] ALIGNMENT_FEMALE_VARIATION - t_string
- [x] UNIT_ALIGNMENT - t_string
- [x] RANDOM_FACTION_MODE - t_string
- [x] CAMPAIGN_TYPE - string
- [x] component_availability - string
- [x] CONDITIONAL_TYPE - string
- [x] DEFEAT_CONDITION - string
- [x] EPOCH - string
- [x] grow_direction - string
- [x] hit_type - string
- [x] LEVEL_RESULT - string
- [x] PROXY_CONTROLLER - string
- [x] SAVED_GAME_MODE - string
- [x] SHARE_VISION - string
- [x] SORT_ORDER - string
- [x] STATUS - string
- [x] create_engine/TYPE - string
- [x] ai/TYPE - string
- [x] VARIANT_TYPE - string

The plan for MAKE_ENUMs that use t_strings is to implement that part the same as was already done for the [side_controller enum](https://github.com/wesnoth/wesnoth/pull/6423/files#diff-64452baca10a211dae88365da8ebc8870a3fd724cf4067030f7163ae13b938b3) (aka a static const std::array containing t_strings), though I'm not sure what the difference is between using `N_` vs `_`.

---

Testing:
- [x] ALIGNMENT_FEMALE_VARIATION - t_string
- [x] UNIT_ALIGNMENT - t_string
- [x] RANDOM_FACTION_MODE - t_string
- [x] CAMPAIGN_TYPE - string
- [x] component_availability - string
- [x] CONDITIONAL_TYPE - string
- [x] DEFEAT_CONDITION - string
- [x] EPOCH - string
- [x] grow_direction - string
- [x] hit_type - string
- [x] LEVEL_RESULT - string
- [x] PROXY_CONTROLLER - string
- [x] SAVED_GAME_MODE - string
- [x] SHARE_VISION - string
- [x] SORT_ORDER - string
- [x] STATUS - string
- [x] create_engine/TYPE - string
- [x] ai/TYPE - string
- [x] VARIANT_TYPE - string

---

Remaining:
- [x] Should the `string_enum`s all be in their own directory or kept in the directories they each are most used in?
- [x] Rename `attack_result` to `strike_result`.
- [x] Rename the formula variant values to remove the `type_` prefix."
834508122,fix cumulative=yes don't function for [leadership](1.16),newfrenchy83,2022-01-28 14:33:03+00:00,2022-01-28 19:07:29+00:00,{'Units': 1},Fix https://github.com/wesnoth/wesnoth/issues/6466 issue.
834491516,1.17 fix cumulative=yes don't function for [leadership],newfrenchy83,2022-01-28 14:14:39+00:00,2022-05-19 23:13:43+00:00,"{'Unit Tests': 1, 'Units': 1}",Fix https://github.com/wesnoth/wesnoth/issues/6466 issue.
834474158,[world conquest] [artifact/abilities] Make banner stack with leadership ability.,knyghtmare,2022-01-28 13:55:24+00:00,2022-02-01 23:10:20+00:00,"{'Backport': 1, 'Campaign (any)': 1, 'MP': 1}","fixes banner not stacking with leadership

Addresses point 8 of #6411 "
833722677,update codeblock projectfiles,newfrenchy83,2022-01-27 17:29:01+00:00,2022-01-27 17:41:29+00:00,{'Building': 1},
832926113,Make the adhoc add-on download check more detailed.,Pentarctagon,2022-01-27 00:26:34+00:00,2022-02-03 11:18:38+00:00,"{'Bug': 1, 'Backport': 1, 'MP Lobby': 1, 'Add-ons': 1}","Originally this simply checked for whether the add-on's directory existed to avoid downloading the same add-on multiple times when migrating from one major release to another. However this then causes add-ons to not get updated when joining a multiplayer game where to person joining has the add-on (so the directory exists) but needs an updated version of it.

Fixes #6383"
832892358,Temporarily re-introduce the SPECIAL_NOTES macro,stevecotton,2022-01-26 23:15:42+00:00,2022-01-27 00:12:46+00:00,"{'WML': 1, 'Units': 1}","While this will be deleted before 1.18, at the moment UMC authors
are still working on 1.16. While the 1.17 branch is being used for
new development in the engine, I think it's more useful to be able
to run 1.16 UMCs that test engine edge cases rather than force the
UMCs to be upgraded for 1.18's macros.

There's currently circa 1200 units using `{SPECIAL_NOTES}` in
Ageless Era, probably requiring manual checks to update them.
Another option would be to `#define SPECIAL_NOTES` in the UMC
itself, but that would likely also mean that the warning was
silenced when running on 1.16, and few of the 1200 units would
get fixed during the 1.16 cycle.

This reverts part of commit 61fa3627818c1a3fb5181a21fc651b67d17b133a."
831468746,add tooltip to unit_attack dialogs,newfrenchy83,2022-01-25 13:37:55+00:00,2022-05-18 06:54:28+00:00,"{'UI': 1, 'Units': 1}","in tooltip, the special and weapon_abilities are listed by stats (damage, attacks and chance to hit) and owner of each is specified.
replace https://github.com/wesnoth/wesnoth/pull/6399 for readibility purpose."
831366554,"[1.16] Add a ""special notes"" section to terrain help pages",stevecotton,2022-01-25 11:38:32+00:00,2022-01-26 00:24:56+00:00,"{'Enhancement': 1, 'UI': 1, 'Help': 1, 'Terrain': 1}","Backport of #6400 and the follow-up change of ""on to"" to ""onto"". Already reviewed, so will merge once the CI passes.

The notes are automatically added based on the terrain's properties,
there isn't a way to add or remove them in WML.

Any questions about negative values for gives_healing() are issue #4232.

(cherry picked from commits 1afb7effc490d2c7c12116d278fc07c465c54f57
and d3e1c73ca10ea51cb2bccbb7657a90a708feb2b1)"
830505520,Editor: document the magenta D and the special terrain overlays,stevecotton,2022-01-24 15:06:45+00:00,2022-01-25 11:30:37+00:00,"{'Enhancement': 1, 'Editor': 1, 'Help': 1, 'Fwdport': 1}","This adds help documentation for:
* The deprecated terrain marker
* XO and UO movement overlays
* Castle, keep and village overlays
* Fake Shroud
![deprecated_terrain](https://user-images.githubusercontent.com/101462/150808377-d2eeaeea-de6c-4217-8c09-7e1d9898b975.png)
![terrain_overlays](https://user-images.githubusercontent.com/101462/150808384-decec315-c7c4-44d1-82d7-c76c59c850eb.png)

"
829956334, various small sprite updates,doofus-01,2022-01-24 03:51:51+00:00,2022-01-29 12:08:42+00:00,"{'Graphics': 1, 'Units': 1}","Forward-port of #6452

* flip water serpent defense frames

* fix layering issue with lizard tail

* update sea-serpent attack icon

* NE anims for swamp lizard"
829881745,Show team village owner name when hovering,macabeus,2022-01-24 00:52:36+00:00,2022-09-16 03:44:24+00:00,"{'Enhancement': 1, 'UI': 1, 'Terrain': 1}","Solves https://github.com/wesnoth/wesnoth/issues/4344

Show on the side menu the village owner's name, as proposed on the above issue.

BUT I'm not sure if it's the best way to solve it because there is a little space on the side menu, so the description could be dropped frequently.

<img src=""https://user-images.githubusercontent.com/9501115/150705774-d5c64e89-78af-4302-9f8c-7ca0d4f66736.png"" height=""300px"" />
"
829856794,Add /clear chat command,macabeus,2022-01-23 23:10:51+00:00,2022-01-30 20:18:19+00:00,{'UI': 1},"Solves https://github.com/wesnoth/wesnoth/issues/3202

Add `/clear` chat command

https://user-images.githubusercontent.com/9501115/150701852-c67dd99f-f77f-43a7-8cff-270976dc91ac.mp4

"
828947096,display a warning message if part[1] is missing mention of the id key…,RutviShukla,2022-01-21 21:16:44+00:00,2022-06-27 18:54:59+00:00,{'Help': 1},"… related to [race] or [era]

Hey, I made a set of if/else statements to help resolve this issue related to a warning message that needed to be implemented for this section.
"
826928344,world conquest: update modding instructions,knyghtmare,2022-01-19 21:42:42+00:00,2022-02-18 09:13:43+00:00,"{'Campaign (any)': 1, 'MP': 1}",The current instructions were incomplete. This allows the first step to be completed. The other steps were not even documented..but at least the current one works.
825554211,[world conquest] Fix for HP glitch when picking up items/artifacts,knyghtmare,2022-01-18 14:37:01+00:00,2022-01-18 17:10:55+00:00,"{'Backport': 1, 'Campaign (any)': 1, 'MP': 1}",Fixes 7th bug of #6411
825076252,1.16 - various small sprite updates,doofus-01,2022-01-18 03:04:11+00:00,2022-01-24 03:00:51+00:00,"{'Graphics': 1, 'Units': 1}",
824923324,"Fix the po stats script to recognise ""es_419""",stevecotton,2022-01-17 20:37:56+00:00,2022-01-17 20:50:24+00:00,{},"The failure mode caused it to overwrite the es_ES stats
with the es_419 ones. Skipping the CI step, as this script
is only run by the pot-update targets.

[ci_skip]"
824899607,1.16 saurian sprites cleanup,doofus-01,2022-01-17 20:00:50+00:00,2022-01-18 03:02:42+00:00,"{'Graphics': 1, 'Units': 1}",backport of #6413 
823966202,Remove non-standard spacing (SoF's wyrms),stevecotton,2022-01-16 18:44:13+00:00,2022-01-17 12:55:28+00:00,"{'Backport': 1, 'Campaign (any)': 1, 'Units': 1, 'Prose': 1}",
823723353,"Fix typo: ""with heavy loses"" -> ""with heavy losses""",severin,2022-01-15 19:10:49+00:00,2022-01-16 23:05:35+00:00,"{'Backport': 1, 'Campaign (any)': 1, 'Translations': 1, 'Prose': 1}",This is a simple translation fix
823160727,"Support [foreach]array=this_item, nested loops using the default name",stevecotton,2022-01-14 23:11:03+00:00,2023-02-05 03:34:24+00:00,"{'Bug': 1, 'Unit Tests': 1, 'WML': 1, 'Lua API': 1}","Since a0ee38a49, the inner this_item was still in scope when the inner loop
writes changed data back to the outer loop's variable, which meant that
changes were silently ignored.

A lot of the changes in wml-flow.lua are just indentation because of the
extra block.

Extend the unit test for scoped variables, which includes fixing the mixed
tab-and-space indentation in that file.

Fixes #6305. I'm dithering about whether to say it's a bugfix and should go
in 1.16, or say that it's unimportant enough to only go in 1.17."
820582303,Black Nightmare: add a translation hint for this unit's name,stevecotton,2022-01-13 08:11:50+00:00,2022-01-16 19:19:58+00:00,"{'Units': 1, 'Fwdport': 1}",
820558850,Only show planned moves to self and allies in multiplayer,stevecotton,2022-01-13 07:41:40+00:00,2022-01-13 09:46:44+00:00,"{'Bug': 1, 'MP': 1, 'UI': 1}","Forward-port of #6405, so just running the CI and testing locally.

Fixes #6292."
820178483,[new feature 1.17] create a filter_distant for detect unit distant and test if enemy or not( more simple what filter_location),newfrenchy83,2022-01-12 23:19:53+00:00,2022-10-09 16:12:09+00:00,"{'Campaign (any)': 1, 'Units': 1, 'Schema': 1}","

use a ""filter_distant"" equivalent ot ""filter_adjacent"" is simplest to write and more dynamic what [filter_location] because is it no more necessary to specifie side of unit.

More intessting for encode events in unit_type or [+abilities] with presence of allies or enemies unit in radius."
819849228,UtBS S08 OOS and wall-stuck units fixes,Descacharrado,2022-01-12 16:03:43+00:00,2022-05-03 10:01:38+00:00,"{'Backport': 1, 'Campaign (any)': 1}","Addresses my comment on #6428:
> Another thing I found testing is that skeletons in one of the events can get stuck on the wall if you walk to their spawning positions maybe fixable on another PR.

13 units could get stuck in a wall if you knew where they would spawn (and had quick sun sylphs), now they will not (fixed the same way #6357 was fixed, lines 873, 893, etc.). 
Image below is an exaggeration (but was possible with enough sun sylphs).
![wall](https://user-images.githubusercontent.com/30196839/149175043-801d77c0-5cb0-4dbf-b147-4309ee267267.png)

Also you could get past a trigger (without using debug mode line 2119).
Fixed OOS at victory (similar to how #6438 was fixed, lines 3511-3781).

I'll open a PR once this is merged to add {PASSABLE_HEX} to unit-utils and remove it from TRoW S19 and here.

Closes #6267 "
819732309,NR S01 Solve OOS by moving code to synced event,Descacharrado,2022-01-12 14:00:37+00:00,2022-05-23 08:09:58+00:00,"{'Backport': 1, 'Campaign (any)': 1, 'Replays': 1}","[This](https://wiki.wesnoth.org/EventWML#Multiplayer_safety) says the victory event is unsynced so I just moved the code to the enemies defeated event. Tested that everything works the same and replay goes all the way without OOSs.

Closes #6268 "
819076277,Run the WML unit tests on macOS.,Pentarctagon,2022-01-11 20:39:27+00:00,2022-01-11 22:06:00+00:00,{},"Not really sure why they're able to run now.

---

Will merge after CI passes."
818958293,"HttT S04, S05b & S06 Role code enhancement",Descacharrado,2022-01-11 17:47:27+00:00,2022-01-22 07:20:36+00:00,"{'Backport': 1, 'Campaign (any)': 1}",">S04 assigns a unit as role=Supporter, which is used exactly once, in a [message] immediately after the assignment. The list isn't quite the same as the later scenarios' role=Advisor, as it includes no merfolk (and in S04 it shouldn't), but it seems odd to only use it once.

Now `type` is used inside `[message]` to avoid assigning a role used only once.

> S05a seems okay. It assigns role=Advisor along with [auto_recall][/auto_recall] even though the role hasn't been assigned in a previous scenario; however in this case it's in a prestart event and the [role] tag will search the recall list, so auto_recall makes sense. The type= list includes merfolk, but that's okay as the starting encampment is on a beach.

Agreed, S05a uses it properly.

> S05b also assigns role=Advisor, and again includes merfolk in the type= list. The ISLE_GALLEON_ARRIVE macro will put the Advisor on-board the galleon, even if the Advisor is a merfolk. Worse, if the Advisor is a merfolk then the unit will be killed and not replaced with a copy from iotd_recall_store. If a merfolk gets the role then the player has probably already lost the campaign anyway (army too weak for S06), but while we're testing code changes for this issue then it's something that could be fixed along the way.

Merfolk will now be unable to be the hidden advisors in S05b.

> S06 has #define ADVISOR in the middle of an event. It works, but seems a bad coding style and messes up the indentation. Recalling a merfolk with full moves on turn 1 does give some time to get them in the water, but it still doesn't seem the best choice for the starting encampment.

Moved the define outside, changed the priority list of the advisor (so merfolk will be a last resort).

Closes #6388 

"
818766851,Fix [store_unit]'s stored coordinates for recalls,stevecotton,2022-01-11 14:31:11+00:00,2022-01-12 05:57:35+00:00,"{'Unit Tests': 1, 'WML': 1, 'Lua API': 1}","Forward-port of #6296, just doing a CI run before merging.
Fixes #6295
Fixes #6315

Units on the recall list might have x,y coordinates that are on the map, which
therefore need to be replaced with ""recall,recall"" within [store_unit]. The
existing code created a temporary variable, changed the coordinates, and then
returned the unchanged original instead of the temporary.

Add a new test that `[put_to_recall_list]` followed by `[modify_unit]`
doesn't move the unit back to the map.

(cherry picked from commit 096d8aba1474e9c6583d240e7eedbcd66957f327)"
818201173,Fix Winged Sceptre bug in WC,Discontinuum,2022-01-11 02:20:44+00:00,2022-01-11 10:12:07+00:00,{'Campaign (any)': 1},"In the old WC here there was wesnoth.unit_defense function, so it should be wesnoth.units.chance_to_be_hit. In the current code it's wesnoth.units.defense_on which returns actual defense (50,60,40, etc), so the code checked if the defense of the unit is better than given by the artifact and worsened it."
818023512,[AI] [Micro AI] [1.17] Add new Micro AI: ai_type=bloodlust,knyghtmare,2022-01-10 20:56:11+00:00,2022-08-02 00:32:18+00:00,"{'Enhancement': 1, 'AI': 1}","Here is a subset of the hunter MAI, called `ai_type=boss`, intended for dungeon and scenario boss-category units.

Sample Code:
```ini
[micro_ai]
        side=2
        ai_type=boss
        action=add

        id=""Mal Keshar""
        [filter_location]
            x=30
            y=31
            radius=6
        [/filter_location]
[/micro_ai]
```

What it does?

1. Makes the 'boss' wander around a specified area (boss arena)
2. If enemy is within the boss's movement, target weakest enemy.
3. Approach and attack the weakest enemy.
4. Kill and reset to wandering mode.

Pending Stuff before making a full PR:

- [x] Test map
- [x] Test Scenario
- [ ] Documentation when merged.
- [x] Update Code to accomodate LuaAPI changes

Closes #6372 "
817643211,TRoW S22 Fixed the possibility of a missplaced dialogue when a bridge was broken,Descacharrado,2022-01-10 13:50:41+00:00,2022-01-16 22:52:53+00:00,"{'Backport': 1, 'Campaign (any)': 1}","**New behaviour:**
When no units are in the ""island"" north of the bridge, ""retreat"" is said instead of ""advance"".
![advance](https://user-images.githubusercontent.com/30196839/148776235-b01b92a5-5591-41e7-ae6f-d47cb2516710.png)
![retreat](https://user-images.githubusercontent.com/30196839/148776243-c817b1ef-5c68-41af-bba2-42b79f86b6de.png)

If there are units on both sides of the bridge, (even if it is only one, minor level 1 unit) the word advance takes priority over retreat. As stated on the issue, it is such a minor possibility that it does not matter if the condition is simple, as long as it does not feel weird when the dialogue is triggered (at least, that is my opinion).

Also remember string freeze if backported.

Closes #6376"
817077023,DM S14 Smooth undead appearance and add dialogue,Descacharrado,2022-01-09 17:25:08+00:00,2022-01-16 22:48:40+00:00,"{'Backport': 1, 'Campaign (any)': 1}","Please add postponed label due to string freeze.

**Changes:**
Changed the event comment (as beating the enemy leader is allowed and accounted for on lines 349+) (Line 331).
Added a dialogue to explain a bit why they are being spawned (Lines 332-335) (string could be changed before merging)
And added `animate=yes` to enemy spawning (Lines 337-339, 341-343)

Closes #6176 
"
817065725,UtBS S08 Kromph and Dust Devil able to trigger Eloh's event,Descacharrado,2022-01-09 16:18:38+00:00,2022-01-16 22:44:44+00:00,"{'Backport': 1, 'Campaign (any)': 1}","The variable talking_unit is used instead of unit to set the speaker in many messages.

The talking unit that talks on behalf of the monsters can be, in this order: An elf in the map, a recalled elf, a forcedly spawned elf (Lines 3007-3067)

That unit will move to the dunes to fit the dialogue (Lines 3124-3137)

EDIT: fixed on 061a42b:

I found that code at line 3024 was not searching for units on the recall list
Also if a unit was on 19 20 previously, it would get the talker role, even if it was not intended.
Also the unit which gets created in case everything else fails could get stuck in a wall

Another thing I found testing is that skeletons in one of the events can get stuck on the wall if you walk to their spawning positions maybe fixable on another PR.

Closes #6211 "
817035371,"UtBS S04 - enhance goblin leader trigger ""how can he move that fast?""",Descacharrado,2022-01-09 13:24:31+00:00,2022-01-10 06:16:28+00:00,"{'Backport': 1, 'Campaign (any)': 1}","Now the event triggers when the player gets sight on Panok (the goblin leader) moving.

Closes #6266 "
816984242,Add set_cost and set_advances_to to modify_unit_type schema,demario-w,2022-01-09 07:24:30+00:00,2022-01-11 07:57:04+00:00,{'Schema': 1},"The proposed schema update is based on the documented attributes
on the wiki https://wiki.wesnoth.org/ModificationWML (of 2021/01/09).

The new attributes are documented as applicable since version 1.15.2.

# Issue

This is tested against the following test case:

$ cat ./modify_unit_type.cfg

    [modification]
        [modify_unit_type]
            type=Peasant
            set_experience=30
            set_cost=10
            set_advances_to=Thief,Footpad
            add_advancement=Spearman
            remove_advancement=Footpad
        [/modify_unit_type]
    [/modification]

Before commit the test fails with the output:

$ ./wesnoth --data-dir=. --validate=./modify_unit_type.cfg
Battle for Wesnoth v1.16.1+dev x86_64
Started on Sun Jan  9 14:56:33 2022

Automatically found a possible data directory at /opt/wesnoth/wesnoth.git.master/build/..
Overriding data directory with /opt/wesnoth/wesnoth.git.master
Validating ./modify_unit_type.cfg against schema /opt/wesnoth/wesnoth.git.master/data/schema/game_config.cfg
Error (strict mode, strict_level = 0): wesnoth reported on channel error validation
20220109 14:56:33 error validation: Invalid key 'set_cost=' in tag [modify_unit_type]
at ./modify_unit_type.cfg:5
20220109 14:56:33 error validation: Invalid key 'set_advances_to=' in tag [modify_unit_type]
at ./modify_unit_type.cfg:6
validation failed

# Fix

After the changes, the WML is validated ok:

$ ./wesnoth --data-dir=. --validate=./modify_unit_type.cfg
[...]
Validating ./modify_unit_type.cfg against schema /opt/wesnoth/wesnoth.git.master/data/schema/game_config.cfg
validation succeeded"
816779856,"[1.16.3] Fix deprecation of [advancefrom], mark as already removed",stevecotton,2022-01-08 02:33:02+00:00,2022-02-02 07:43:38+00:00,"{'Bug': 1, 'WML': 1, 'Units': 1, 'Fwdport': 1}","Postponed until 1.16.3 due to string freeze.
Closes #6204.
Supersedes PR #5922, which is why it was opened as a draft before 1.16.2 released.

The existing code searched for `[units][advancefrom]` instead of
`[unit_type][advancefrom]`, so wasn't triggering. It was planned
for removed in 1.17, so simply mark it as already-removed instead.

The deprecation warning is shown on stdout/stderr, but not in the
in-game UI, so it's generally not visible to players. I think it
would be better if it was visible, but OTOH it's something that's
easy for someone to check all add-ons for with a simple grep."
814991879,Use a less complicated implementation for the MAKE_ENUM of CONTROLLER.,Pentarctagon,2022-01-05 19:41:14+00:00,2022-01-25 22:57:30+00:00,"{'MP': 1, 'UI': 1, 'Editor': 1, 'Lua API': 1}",
814140201,Remove command prefixes on commandline,Descacharrado,2022-01-04 19:20:00+00:00,2022-07-19 17:04:35+00:00,"{'Backport': 1, 'UI': 1}","Commands will no longer have a prefix in the commandline, but they will keep it in the chat commands.

Closes #1018"
813058661,[1.16] Add support to replay 1.14 saves to BFW1.16,demario-w,2022-01-03 10:56:13+00:00,2022-01-11 06:15:26+00:00,"{'Replays': 1, 'Building': 1}","(version tagged as BFW1.16.load_1.14_replay_backward_support_UNITLESS-noSPDE.v4)

This supports loading the 1.14 saves from the ""Show saves from different a version"" without OOS.
See details in https://forums.wesnoth.org/viewtopic.php?p=669885#p669885

The patch is creating:
- the data/add-ons directory in mainline data
- a default-unitless-1.14 era
- no new unit type
- the events of the era are appended to the 1.14 saves to brings compatibility with 1.16 engine

The replays doesn't work on ladder and dunefolk saves."
812485828,Saurian sprites cleanup,czyzby,2022-01-01 01:26:28+00:00,2022-01-18 03:01:43+00:00,"{'Graphics': 1, 'Units': 1}","This pull request improves the mainline Saurian sprites.

* Removed stray transparent pixels from the Augur tree sprites. These were usually supposed to be grey parts of the robes, and might have been missed as they blended with the default transparent background in tools such as Gimp.
* Recolored Oracle's robes in SE melee attack frames to match the other animations. They were grey instead of blue.
* Fixed overlapped and broken shadows. This should address most of the graphical artifacts where 2 shadows were placed on top of each other, had incorrect colors, or when a shadow was pasted over the sprite's outline, making it purple.
* Added missing leg bracelets to Flanker SE and Oracle NE running animations.
* Fixed eye colors in Ambusher NE bob, run and throw frames, as well as Soothsayer magic animation. Now they are consistent throughout all frames.
* Replaced pure black `#000000` (and nearly pure black `#020202`) with a lighter `#151515` shade. Since `#000000` usage is discouraged in the Wesnoth guidelines, I updated the palette across all animation frames of all Saurian units. The palette is still pretty dark, and the units look mostly the same in game, but the outlines are now slightly more subtle.
  * As a side note, I've toyed with more drastic changes like `#202020` and it still looks pretty OK. If you propose any further palette changes, please let me know - I've written a script that does so automatically.
* Removed around 50 redundant colors, replacing them with their closest equivalents. See the comments below for the current palette.

All images were optimized using `woptipng` script. Let me know if you'd like me to adjust or revert any of the changes."
811685808,Only try to activate required addons after loading all addons present.,Pentarctagon,2021-12-29 21:36:36+00:00,2022-01-01 19:31:10+00:00,{},"The current issue is that, when loading a replay that requires addons from the main menu, it's checking for which addons can be enabled with game_classification.active_addons(...) before it reloads the cache to contain addons (such as eras) that are behind the #ifdef MULTIPLAYER define. It is of course impossible to find addon content before it has been loaded, which results in things like OOS errors due to unknown unit types.

Fixes #6283"
811546133,Support macOS 10.8-10.11 SDKs,evanmiller,2021-12-29 15:33:18+00:00,2021-12-29 21:32:20+00:00,{'macOS': 1},"Map new constant names to their previous names after testing the SDK version. Tested against wesnoth 1.16.1.

Patch adapted from https://github.com/macports/macports-ports/pull/13437"
811434613,[1.16] Only show planned moves to self and allies in multiplayer,stevecotton,2021-12-29 11:49:47+00:00,2022-01-13 07:34:57+00:00,"{'Bug': 1, 'MP': 1, 'UI': 1, 'Fwdport': 1}","Two commits. The first one unifies some common code from mouse_handler::mouse_motion and mouse_handler::touch_motion.

For changelog.md
---

``` 
 ### Multiplayer
   * Fixed the originally planned move becoming visible to enemies when an ""enemy sighted"" event interrupts a multi-turn move (issue #6292)
   * Made planned multi-turn moves consistently visible to allies.

 ### User interface
   * Fixed ""enemy sighted, press t to continue"" also activating a feature that showed units' route to where the move started (issue #6292)
```


Only show planned moves to self and allies
---

Fixes #6292, that the planned final destination from multi-turn moves and
interrupted moves was visible to enemies. There are three side-numbers involved
in this logic, listed below; the GUI code was checking whether the move should
be visible to the player whose turn it is, rather to the viewing team.

* un->side(), the owner of the unit
* mouse_handler::side_num_, the side whose turn it is
* viewing_team(), the side of the player whose computer this wesnoth-client is
  running on, thus which side's shroud and fog should be applied.

The plans are still hidden for units belonging to local AI sides, to hide any
goto_x,goto_y settings by campaign authors. The edge case in multiplayer of
allied network AI sides isn't tested here, but I think it's a trivial matter
whether or not those plans are shown.

Don't leave a hex selected when using 't' to continue a move
---

Fixes the minor part of issue #6292, that functionality showing the path
to a selected hex was active after continuing an interrupted move. That
feature is completely separate to the main bug of #6292, but it looks
confusingly similar in testing. The intended way to activate this feature is
via the ""Select Hex"" hotkey, which doesn't have any keybinding by default, so
should only be reachable by people who want the feature.

It would be good to refactor the movement handling so that it's not split
between mouse-handling and menu-handling files, but it would also need a lot of
work and would be out-of-scope for backporting to 1.16.
"
810397215,"NR S05a_01 Spelling correction for ""our retreat is cut off""",stevecotton,2021-12-27 13:11:59+00:00,2021-12-28 08:46:34+00:00,"{'Backport': 1, 'Campaign (any)': 1, 'Prose': 1}",
810039315,fix weapon abilities showed in void attack in attack dialog window,newfrenchy83,2021-12-26 16:12:46+00:00,2021-12-31 12:04:59+00:00,{'UI': 1},"if by example, formation affect a dark Adept, and he is defender, then formation name appear in defender attack.(if name and description of formation in chance_to_hit abilities)"
809750954,"Add a ""special notes"" section to terrain help pages",stevecotton,2021-12-24 14:43:57+00:00,2022-01-23 02:41:08+00:00,"{'Enhancement': 1, 'Backport': 1, 'UI': 1, 'Help': 1, 'Terrain': 1}","The notes are automatically added based on the terrain's properties, there isn't a way to add or remove them in WML.

As-is, this fixes #6394. Issue #4417 mentions some other possibilities too, but I want to postpone these:
* income is complex about upkeep, and the values can be specific to the map and the side
* illumination would need to handle min and max lighting caps too
* defense caps would entangle this with the units on the map, I don't intend to add that at all

Any questions about negative values for gives_healing() are issue #4232; this PR simply doesn't add a special note for that.

![keep_in_800x600](https://user-images.githubusercontent.com/101462/147358571-0b0e310c-0c3a-49e4-8962-c5e0081072db.png)
![desert_village](https://user-images.githubusercontent.com/101462/147358569-cac459ff-d91d-463f-adb7-f5fbe5df2426.png)

The next image is what's shown when choosing the terrain in the help browser's list. The main reasoning for this PR is that the ""A welcome sight"" line doesn't appear when right-clicking on an oasis on the map and choosing the ""terrain description"" menu option.
![oasis](https://user-images.githubusercontent.com/101462/147358574-2c22d417-265d-4907-a440-9e906e960100.png)

Right-clicking on an oasis on the map leads to a page similar to this one. This wording is only used for 1 hp; for 2 hp or more the wording is similar to the 8 hp one shown above (that logic may vary by language, it's the language's pluralisation rules that force two wordings for en_US).
![oasis_1hp](https://user-images.githubusercontent.com/101462/147358575-7bb37e33-3d6b-4af6-a3ae-16a6975f73df.png)

Another terrain that doesn't appear in mainline, but seemed better to handle than not to.
![keep_no_recruit_onto](https://user-images.githubusercontent.com/101462/147358573-d5b79ccd-7c44-4291-830d-72d7e761804b.png)"
809439600,add tooltip to unit_attack dialogs,newfrenchy83,2021-12-23 23:13:06+00:00,2022-01-25 13:32:44+00:00,"{'UI': 1, 'Units': 1}","with this way, weapon abilities applied to stats of attacks showed in tooltips same if from opponent but only if modify damage num of attack or chance to hit stats.

i cannot capture the windows with tooltip this time."
809239509,Improve comments for translators around VNGETTEXT,stevecotton,2021-12-23 15:20:01+00:00,2021-12-27 12:48:16+00:00,"{'Backport': 1, 'Translations': 1, 'UI': 1}","I tried to use the Wiki docs, and found the Wiki docs were outdated compared to
our codebase, which prompted this code review.

No code or string changes, just an improvement to the comments."
808590895,Additional SSL connection logging,Pentarctagon,2021-12-22 17:42:07+00:00,2021-12-22 19:52:38+00:00,{},
806997905,Omit line-numbers from the .po files,stevecotton,2021-12-20 21:12:15+00:00,2021-12-21 20:38:20+00:00,"{'Backport': 1, 'Translations': 1, 'Building': 1, 'SCons': 1, 'CMake': 1}","The aim of this change is to reduce the number of changes in .po files caused
by a pot-update. For example, changes elsewhere in .cpp and .cfg files added
lots of changes just to change the line numbers.

This change is done on the final stage of creating the .pot files, so that the
same stage's `msgcat --sort-by-file` sorting still works as before, sorting by
both file and line.

Note: although the aim is reduce the number of changes in the long term, it
creates a huge diff on the very first pot-update. There are slightly more
deletions than insertions, as files with the same translatable string repeated
on multiple lines are now only listed once.

Estimated sizes for pot-update at the start of 1.16.2's string freeze. This
pot-update introduces (across all languages) 13438 new fuzzy strings, circa
60000 of the insertions are those fuzzies:

* 1.16.2 without this: 214795 insertions(+), 135146 deletions(-)
* 1.16.2 with this: 1283834 insertions(+), 1339266 deletions(-)
* 1.16.2 if this was in 1.16.1: 130824 insertions(+), 52728 deletions(-)

Estimates for master:

* 1.17.0 without this: 448590 insertions(+), 369170 deletions(-)
* 1.17.0 with this: 1356682 insertions(+), 1411589 deletions(-)"
806187989,Add build support for webp images.,Pentarctagon,2021-12-20 01:26:21+00:00,2022-03-12 19:47:46+00:00,"{'Graphics': 1, 'Building': 1, 'SCons': 1, 'Terrain': 1}",
805889517,Get the scenario_id from the addon content list sent by the server if it's not otherwise available.,Pentarctagon,2021-12-18 18:11:54+00:00,2021-12-19 23:50:36+00:00,"{'MP': 1, 'UI': 1}",Fixes #6285
804772926,"editor: Add ""Map Screenshot"" item to menu",soliton-,2021-12-16 19:24:13+00:00,2021-12-21 15:54:39+00:00,{'UI': 1},"I think we should add the `Map Screenshot` item to the menu so it's easier to discover. (See #6386)

Not sure where it fits best. I've put it below ""Save Map As"". The map menu could be another option."
803992006,"Various build changes, mostly cmake",Pentarctagon,2021-12-16 01:10:38+00:00,2021-12-19 23:51:48+00:00,"{'Graphics': 1, 'Building': 1, 'SCons': 1, 'CMake': 1, 'Terrain': 1}",
800471602,1.16 - some terrain graphics fixes,doofus-01,2021-12-11 13:55:39+00:00,2021-12-12 20:08:31+00:00,"{'Graphics': 1, 'Fwdport': 1, 'Terrain': 1}","This PR is for terrain-graphics issues I can fix this weekend, no particular plan outside of that.

* make X*^Efs sconce overlay rules symmetric, addresses #6381 and removes another glitch with catacombs candles in south-facing corners "
800460274,1.16 - Added attack icon to the nightblade's kick,Descacharrado,2021-12-11 12:33:50+00:00,2022-01-01 18:39:39+00:00,"{'Units': 1, 'Fwdport': 1}",Grabbed the image from #6339 solves #4145 partly.
800296444,SunOS 5.11/OpenIndiana build fixes,larb0b,2021-12-10 22:49:56+00:00,2021-12-13 02:20:29+00:00,"{'Building': 1, 'SCons': 1, 'CMake': 1}","With these changes, Wesnoth builds and runs on SunOS 5.11, tested on OpenIndiana 2021.10."
800280251,Print which campaign is causing the extra_defines warning,stevecotton,2021-12-10 22:12:04+00:00,2021-12-11 14:59:23+00:00,"{'WML': 1, 'Engine': 1}","Forward-port of #6375. Just running the CI and will then merge.

Whether or not it's the campaign being played, this warning
gets printed if any add-on has a [campaign]extra_defines=
attribute with one of the deprecated strings (a hardcoded
list about 20 lines above the line that's changed here).

(cherry picked from commit c1499e06b55eb109502f6ae4272f16ca6661181b)"
799941689,Print which campaign is causing the extra_defines warning,stevecotton,2021-12-10 13:56:54+00:00,2021-12-10 21:51:39+00:00,"{'WML': 1, 'Fwdport': 1, 'Engine': 1}","Whether or not it's the campaign being played, this warning
gets printed if any add-on has a [campaign]extra_defines=
attribute with one of the deprecated strings (a hardcoded
list about 20 lines above the line that's changed here)."
798726983,"Remove the nonfunctional ""title screen tutorial"" hotkey and binding",stevecotton,2021-12-09 11:23:53+00:00,2021-12-09 12:50:26+00:00,"{'UI': 1, 'Input': 1}","Backported from #6363 and the subsequent .cfg file cleanup.
I'm not intending to add a changelog entry for this (seems too trivial).

The code that it used to trigger was removed in
f86168ab26b3a74835575fcc732d0d63e43bfe62.

(cherry picked from commits 46fbe51a6fcdc939e5cad53f9faefbedb70f0577
and afd9bd1688626e22de14cb2843793ebacbd91d22)"
798520077,Add [terrain_type] to the list of top-level tags.,Pentarctagon,2021-12-09 06:59:43+00:00,2021-12-15 03:31:32+00:00,"{'Backport': 1, 'MP': 1}",Fixes #6285
797335383,UtBS S9: Turn rebels into loyal units,Wedge009,2021-12-07 23:19:05+00:00,2021-12-08 04:08:24+00:00,"{'Backport': 1, 'Campaign (any)': 1}","As per @nemaara's directive. Resolves #6365.

CC: @Descacharrado"
797320222,[1.17] [Core] Add Generalized Advancement Enabling and Disabling macros,knyghtmare,2021-12-07 22:48:42+00:00,2021-12-09 02:56:13+00:00,{'WML': 1},"Added two Generalized Advancement Enabling and Disabling macros.
Examples:
```ini
{ENABLE_ADVANCEMENT ""Great Mage"" ""Elder Mage"" (set_experience=299)}
{ENABLE_ADVANCEMENT ""Great Mage"" ""Elder Mage"" ()}
{DISABLE_ADVANCEMENT ""Great Mage"" ""Elder Mage"" (set_experience=150)}
{DISABLE_ADVANCEMENT ""Spearman"" ""Swordsman"" ()}
```
Considering if this should be backported as well?"
797237080,UtBS S06b Look at the blown charges and make sure no units get stuck,Descacharrado,2021-12-07 20:09:17+00:00,2021-12-08 22:56:58+00:00,"{'Backport': 1, 'Campaign (any)': 1}","After the charges are blown, the camera looks at the terrain (lines 1012 and 1089).
If a fast enough unit would get stuck in a wall, it gets teleported back (lines 1090-1103). There cannot be any other unit where the stuck one would get teleported, as that other unit would have triggered the event.

If this and #6368 are merged, #6196 could be closed."
797220825,UtBS S06b Fixed weird scout AI behaviour,Descacharrado,2021-12-07 19:41:22+00:00,2021-12-08 22:55:21+00:00,"{'Backport': 1, 'Campaign (any)': 1}","As commented in #6196 the pathfinder may prefer to go capture the hermit's village to fighting.
![Pathfinder issue](https://user-images.githubusercontent.com/30196839/145094695-dfc0a3d5-621b-4df1-a62d-b9ce55b18737.png)
So I added the behaviour to avoid the tunnels that lead outside (they are ai-trapped to fight, lines 189-193)
This behaviour is deleted when side 6 is activated in order to not create new AI weirdness (lines 1523-1528)"
797119835,Update changelog with my master PRs,Descacharrado,2021-12-07 17:02:09+00:00,2021-12-07 17:22:05+00:00,{},
797119174,Update 1.16 Changelog with my backported PRs,Descacharrado,2021-12-07 17:01:17+00:00,2021-12-07 17:21:56+00:00,{},"That should do it,. If I did something wrong I'll fix it later."
796684040,"Remove the nonfunctional ""title screen tutorial"" hotkey",stevecotton,2021-12-07 08:42:16+00:00,2021-12-08 11:21:47+00:00,"{'Backport': 1, 'UI': 1}","The code that it used to trigger was removed in
f86168ab26b3a74835575fcc732d0d63e43bfe62."
795782818,UtBS S9: Avoid 'punishing' the player for saving the rebels,Wedge009,2021-12-06 11:22:56+00:00,2021-12-07 11:55:31+00:00,"{'Backport': 1, 'Campaign (any)': 1}","Resolves #6229.

I debug-tested this and it seemed to work as intended, but of course, please point out any mistakes or any suggestions you have."
795453441,UtBS S8: Avoid counting encounters with the 'Cloaked Figure',Wedge009,2021-12-06 02:17:51+00:00,2021-12-07 11:54:31+00:00,"{'Backport': 1, 'Campaign (any)': 1, 'Prose': 1}","Resolves #6355.

The 'Cloaked Figure' that hounds Kaleh and friends can be encountered up to three times:
* S4 - guaranteed as his appearance is triggered by Kaleh entering the cave which is a scenario requirement.
* S5 - appearance is at a random turn during the battle between the dwarves and the trolls.
* S8 - final appearance is triggered when moving through the narrow passage.

It is possible to miss the encounter in S5 due to the randomised turn mechanic. Thus, it can be confusing when Kaleh says 'third time'. This is just a quick work-around - another option may be to make the appearance in S5 more deterministic."
795411296,Add a specific prompt for a moderator joining a password protected game.,Pentarctagon,2021-12-06 00:34:07+00:00,2021-12-06 05:30:57+00:00,"{'MP Lobby': 1, 'UI': 1}",
795391574,fix Did advancement,newfrenchy83,2021-12-05 23:05:17+00:00,2021-12-08 04:02:10+00:00,"{'Campaign (any)': 1, 'Units': 1}",another fix off https://github.com/wesnoth/wesnoth/issues/6351
795390958,fix advancement for Darken Volk,newfrenchy83,2021-12-05 23:02:09+00:00,2021-12-08 04:02:23+00:00,"{'Campaign (any)': 1, 'Units': 1}",
795352209,TRoW S19 Fix for the flying chocobones issue,Descacharrado,2021-12-05 18:57:30+00:00,2021-12-05 22:48:01+00:00,"{'Backport': 1, 'Campaign (any)': 1}","Fixed a bug reported on discord by @Konrad22 which made the chocobones spawn over a chasm as can be seen:
![Flycobones](https://user-images.githubusercontent.com/30196839/144759710-023c6271-eca7-43f9-950f-2e605b1c926e.png)
Using passable=yes, and with the previous code implementation, no undead should spawn over a chasm.
![No flybones](https://user-images.githubusercontent.com/30196839/144759741-09e7b42e-0a60-4a1b-945e-7b2d065af3ff.png)"
795343578,Prompt moderators to observe game with observers disabled.,Pentarctagon,2021-12-05 18:02:44+00:00,2021-12-05 22:09:13+00:00,"{'Backport': 1, 'UI': 1}","Fixes #4101

@vgaming 
![prompt](https://user-images.githubusercontent.com/3030250/144757977-dd3c256b-d572-4cec-8511-37443a40515e.png)
"
795238351,UtBS S8: Ensure humans are removed from display during their 'die' event,Wedge009,2021-12-05 06:41:42+00:00,2021-12-06 01:59:32+00:00,"{'Backport': 1, 'Campaign (any)': 1}","There appears to be another situation as with #6341, but for the human attackers:
![human](https://user-images.githubusercontent.com/13679322/144736016-be04f277-fb26-41e1-b8c5-e375f81adca8.png)

I tested this change directly in my current save file and it seemed to resolve the issue.

I also remove redundant phrasing and correct a commentary typo. @nemaara Please advise if you object to the former - I just find the phrasing of 'Hurry up already!' to be too modern (and redundant) compared with just 'Hurry up!'"
795120030,Fix MINGW build on Windows by splitting MSVC and WIN32,ddiefenthaler,2021-12-04 15:45:07+00:00,2021-12-12 19:03:23+00:00,"{'Building': 1, 'CMake': 1}","Fixes the MINGW build in the MSYS2 environment on Windows.

I've seen the previous PR #4728, but a more recent change to the CMakeLists-files introduced MSVC-specific compile and link flags for all WIN32 targets.
This PR splits `WIN32` and `MSVC` and keeps the `gcc`-flags if MSVC is not used.
With this I was able to build and run wesnoth in the UCRT64-environment of MSYS2 using CMake.

There is one more occurrence of `NOT WIN32` where I'm not sure if the section should apply for MSYS2.
~~I will try to add an inline comment for the relevant section.~~
Since there are no changes to this section a inline comment is not possible.
Here is a link to the section in question: [CMakeLists.txt line 81-95](https://github.com/wesnoth/wesnoth/blob/9d5271b98aebdb39631b98089f22f15d80c75a5a/CMakeLists.txt#L81-L95)
The POSIX-definition in line 94 breaks the build for me if applied on Windows.
I'm not sure if the other SDL-flags (line 90) are necessary. For me the build also worked without them."
794123786,Color name of abilities like weapon in attack prediction windows for specifie source(1.16),newfrenchy83,2021-12-02 22:34:50+00:00,2022-05-27 13:29:49+00:00,{'Units': 1},"

In case of specials abilities with value, the name will be colored after the benefit or not of special.

the mention ""Teacher: "" ![teacherstring](https://user-images.githubusercontent.com/31768074/144487591-0d3b9c79-41d8-443c-8a0d-4c7e4cef5a81.PNG)
and ""Opponent:""
![opponentstring](https://user-images.githubusercontent.com/31768074/144487645-353cb342-6523-46ee-978c-9b5112e59cb5.PNG)
will be used for what player know what unit attack is affected by Teacher or by opponent.
 I hope what this amelioration of feature can be pushed in 1.16 but i doubt."
794005464,Color name of abilities like weapon in attack prediction windows for specifie source,newfrenchy83,2021-12-02 19:25:28+00:00,2022-05-27 13:30:50+00:00,"{'Campaign (any)': 1, 'Translations': 1, 'Units': 1, 'Schema': 1}","
In case of specials abilities with value, the name will be colored after the benefit or not of special.

the mention ""Teacher: "" ![teacherstring](https://user-images.githubusercontent.com/31768074/144487591-0d3b9c79-41d8-443c-8a0d-4c7e4cef5a81.PNG)
and ""Opponent:"" 
![opponentstring](https://user-images.githubusercontent.com/31768074/144487645-353cb342-6523-46ee-978c-9b5112e59cb5.PNG)
will be used for what player know what unit attack is affected by Teacher or by opponent.




Remove abilities applied to=opponent is not easy and i want propose that in alternative."
793711641,UtBS Changed and documented the change of XP bar color to blue,Descacharrado,2021-12-02 13:45:38+00:00,2021-12-03 09:05:17+00:00,"{'Backport': 1, 'Campaign (any)': 1, 'Units': 1}","Effect ingame:
If the Dust devil still has the ""Taller"" and ""Stronger"" AMLAs available, the XP is blue.
![still has good amlas](https://user-images.githubusercontent.com/30196839/144433476-8aae9f93-96ef-44a2-91ff-b43ff7c51f92.png)
If it reaches all major AMLAs, it turns purple so the player does not waste XP on him.
![reaches all major amlas](https://user-images.githubusercontent.com/30196839/144433486-d5aa5239-7a6d-457b-beda-1a680e234021.png)

Also documented the changes in the files, so it is easier to understand, for future reference, why the XP bar is blue.

(Closes #6212)"
793277838,UtBS S4: Restrict who remarks about the dark underground tunnels,Wedge009,2021-12-02 02:33:04+00:00,2021-12-03 09:04:57+00:00,"{'Backport': 1, 'Campaign (any)': 1}","By happenstance, Elyssa was my first unit to enter the caves. It sounded really weird for her to complain about the darkness and then say that she can use her fireballs to defeat the orcs.

As per the code commentary, it seemed the intention was to have this dialogue be for the elves:
https://github.com/wesnoth/wesnoth/blob/4248738a3894df4a551debd4ff6afff4e68ffe49/data/campaigns/Under_the_Burning_Suns/scenarios/04_Descending_into_Darkness.cfg#L746

So I added `race=quenoth` to exclude Elyssa and focus on the elves as per the original intention.

Unfortunately - or perhaps fortunately - Kaleh was my next unit in line to enter the caves, and it sounded really bad for him to complain about the darkness and then tell himself 'we have no choice'. So I added `[not]id=Kaleh[/not]` to cover that case.

Potentially we could exclude Zhul as well, but it sounds fine to me if she complains about the darkness and then reminds Kaleh about the elves' disadvantage fighting in that environment."
792643392,UtBS S02 Added a ring icon for the immune unit,Descacharrado,2021-12-01 12:15:54+00:00,2021-12-06 01:59:10+00:00,"{'Backport': 1, 'Campaign (any)': 1, 'Graphics': 1}","Effect ingame:
![Sin título](https://user-images.githubusercontent.com/30196839/144232582-66754cb3-b2aa-4d46-a2bb-5cb9e2af5045.png)

As proposed in the issue, I used the silver ring from DW. 
If the image is wanted to be moved to core, I propose wesnoth\data\core\images\misc
(Closes #6126)"
792130621,UtBS S02 Ogre now dissappears before Nym starts moving or talking,Descacharrado,2021-11-30 22:48:23+00:00,2021-12-02 08:41:33+00:00,"{'Backport': 1, 'Campaign (any)': 1}","As said in the comments, a die event makes the unit linger. Applied what is said in https://wiki.wesnoth.org/Eventwml#die

> Note: The primary unit is not removed from the game until the end of this event. The primary unit can still be manipulated, will block other units from taking its hex, and will still be found by standard unit filters (except [have_unit]). To prevent this behavior, you can use [kill] to remove the unit immediately.

(Closes #6341)"
791404769,VS+Clang,Pentarctagon,2021-11-30 07:48:42+00:00,2021-12-12 07:53:14+00:00,"{'Building': 1, 'CMake': 1}","---

Not necessarily something I'm saying we should definitely do, but opening the PR to start a discussion about using Clang with Visual Studio on Windows rather than MSVC. The main idea being that it would mean we'd only need to deal with Clang and GCC rather than Clang, GCC, and MSVC, and that we'd be able to build with Clang on all the platforms we support."
790013834,1.16 - some attack icon work,doofus-01,2021-11-28 01:34:45+00:00,2021-12-11 12:13:35+00:00,"{'Graphics': 1, 'Units': 1, 'Fwdport': 1}","#6297 inspired me to look at the attack icons again.  So far, this PR adds some feet and changes some existing icons that looked off to me.  It also adds fangs that should fit the sea-serpent better than the snake fangs.

A few other things that could possibly be included:
1.  Tail for the big Icemonax, it currently uses the dragon tail
2.  Shadows currently use ghoul claws, they need their own version
3.  Possibly another spear version, less crude than the existing one.  The pike icon might be good enough for most cases (for example the spear branch in the dunefolk), so this is low priority.
4. Sometimes a single attack icon is used for two different attacks, which looks a bit odd.  For example the Giant Mudcrawler.  So, there are several icons which could use alternates, where the same thing may be depicted, but something like the camera angle is changed."
789923648,[WMLTools] Improve KeyboardInterrupt Handling and Style Refactor,max-torch,2021-11-27 12:13:29+00:00,2022-06-28 05:04:41+00:00,{'WML Tools': 1},"Uses a try-except clause instead of a signal listener to catch KeyboardInterrupt. Put all the contents of
```python
if __name__ == ""__main__"":
```
inside its own function called main() and then wrapped the call to main in try-except.

Additionally, some styling has been tweaked to be more pythonic as per PEP8 style guide.

The commits have been structured to try to make it clear everything that has been done in this PR."
789708226,Expand the reduce function to both fold and reduce,luther9,2021-11-26 16:52:10+00:00,2021-12-04 22:46:12+00:00,"{'Unit Tests': 1, 'Lua API': 1}","The file `data/lua/functional.lua` contains a `reduce` function which, when receiving a falsey `identity` argument, changes it to `0`. This makes it impossible to initialize the calculation with `nil` or `false`. `functional.reduce(t, 'or', false)` will always return `0`.

While changing the function to accept any 3rd argument, I decided to rewrite it to `fold`, which always includes the init value in the calculation, and `reduce`, which only looks at the identity value if the array is empty."
789332695,Ardonna should only call her own bats 'my pet',Wedge009,2021-11-26 07:33:41+00:00,2021-11-27 01:39:23+00:00,"{'Backport': 1, 'Campaign (any)': 1}","It's possible, however unlikely, for none of Ardonna's bats to have died before killing the hostile bats in 'Following the Shadow'. In such a case, when the 'You can now raise bat corpses!' event triggers, Ardonna will still refer to the enemy bat as her 'pet' so add this condition to avoid it."
789326459,Expand reduce function to both fold and reduce,luther9,2021-11-26 07:21:11+00:00,2021-11-26 16:40:56+00:00,{'Lua API': 1},"The file `data/lua/functional.lua` contains a `reduce` function which, when receiving a falsey `identity` argument, changes it to `0`. This makes it impossible to initialize the calculation with `nil` or `false`. `functional.reduce(t, 'or', false)` will always return `0`.

While changing the function to accept any 3rd argument, I decided to rewrite it to `fold`, which always includes the init value in the calculation, and `reduce`, which only looks at the identity value if the array is empty.

Since `functional.lua` is not documented on the wiki, I wonder if maybe this change can be merged with the stable branch."
788534720,SoF Finale: Allow for Gryphon Riders to trigger an event on the final runic tablet,Wedge009,2021-11-25 06:15:21+00:00,2022-04-20 01:41:02+00:00,"{'Backport': 1, 'Campaign (any)': 1}","Draft: needs actual dialogue that makes sense from a story perspective, explaining why it has to be Krawg to destroy the final tablet.

Relates to #6332.

Either Krawg or a Gryphon Rider/Master may trigger the first event, finding the tablet before the other two are destroyed. After they have been destroyed, Krawg and a Gryphon Rider/Master may trigger their respective event independently, though of course if Krawg goes first that's the end of the scenario.

Alternative is to trigger victory irrespective of who reaches the final tablet, but then dialogue needs to be rewritten for a Gryphon Rider/Master instead of Krawg."
787363375,ui: Fix 800x600 theme's sidebar tooltips,stevecotton,2021-11-23 21:47:21+00:00,2021-11-23 23:38:49+00:00,"{'Bug': 1, 'UI': 1}","Forward-port of #6304, intending to merge without further review after the CI run.

Two changes in the theme config for 1024x600, which is inherited by the config
for 800x600. Both are the same line but otherwise only loosely related to each
other; together these fix issue #6264, which was that trigger areas for some
tooltips overlapped.

Reduce the width for the unit's name, thus giving the side-flag and side-number
(which get the remaining horizontal space) enough space to display themselves.
128 pixels wide is the same as the name gets in larger themes, even though
those larger themes use larger font sizes. This means that the side number
doesn't get ellipsed, at least for games with up to 9 sides, with the
side-effect that the tooltip can be displayed when hovering over the flag.

Move the name, and thus the flag and side-number down by 1 pixel, so that they
don't overlap with the tooltip trigger areas for movement points and terrain
defense. The name's location is based on the placement of `unit-box-botleft`;
the theme for larger screen-sizes similarly adds 5 pixels of padding because
the `unit-box` is only 72x72 for the image, and the text areas for movement
points and defense go lower than that.

(cherry picked from commit 0d4854d5ffdcf265065d9519e2537dce14c8406e)"
787107386,Small revision keyboardinterrupt wmltools,max-torch,2021-11-23 15:48:50+00:00,2021-11-23 17:24:12+00:00,{'WML Tools': 1},"This is an addendum to the closed PR https://github.com/wesnoth/wesnoth/pull/6242
Changes the exit status from 0 to 1 and revises the printed message."
786968411,CMake: update the .po files before generating stats about them,stevecotton,2021-11-23 13:20:36+00:00,2021-11-24 12:10:08+00:00,"{'Backport': 1, 'Translations': 1, 'Building': 1, 'CMake': 1}","Fixes #6320.

About whether to backport it: it's not necessary for 1.16, but it's a bugfix that I'd test along with #6321, and it's a bug that caused unexpected differences between SCons and CMake when testing #6322, so I think it's worth backporting all three PRs together."
786480363,remove Utbs 'formation' name of attack prediction windows(master),newfrenchy83,2021-11-22 22:44:06+00:00,2021-12-02 17:12:52+00:00,{'Campaign (any)': 1},"Like description of Utbs formation abilities is opposite of what suggest name in attack prediction windows, it best to remove that."
786477952,remove Utbs 'formation' name of attack prediction windows,newfrenchy83,2021-11-22 22:39:23+00:00,2021-12-03 15:16:13+00:00,{'Campaign (any)': 1},"Like description of Utbs formation abilities is opposite of what suggest name in attack prediction windows, it best to remove that."
786473163,fix 'add' and 'sub' not added in leadership shema validation(1.16),newfrenchy83,2021-11-22 22:30:39+00:00,2021-12-09 17:16:19+00:00,"{'Unit Tests': 1, 'Schema': 1}","Like add and 'sub'can be used in [leadership] abilities now, it must add that to schema validation"
786469476,fix 'add' and 'sub' not added in leadership shema validation,newfrenchy83,2021-11-22 22:24:06+00:00,2021-12-09 17:04:25+00:00,"{'Unit Tests': 1, 'Schema': 1}","Like add and 'sub'can be used in [leadership] abilities  now, it must add that to schema validation"
786460465,Luacheck,Pentarctagon,2021-11-22 22:09:58+00:00,2021-11-28 20:26:02+00:00,"{'AI': 1, 'Campaign (any)': 1, 'MP': 1, 'Units': 1, 'Lua API': 1}",
785834782,wmlxgettext: sort-by-filename before processing files,stevecotton,2021-11-22 09:32:52+00:00,2021-12-02 08:54:26+00:00,"{'Backport': 1, 'Translations': 1, 'WML Tools': 1, 'Building': 1}","Add a sort inside wmlxgettext so that the order of filenames on the command
line doesn't affect the output. The sort is run unconditionally, because I
don't see a usecase for not enabling it. For consistency with xgettext and
msgcat, if there was an option to enable it then it would be called
`--sort-by-file`.

The aim of this change is to reduce the number of changes in .po files caused
by a pot-update. When multiple comments refer to the same translatable string,
separate runs of pot-update could generate them in a random order. If I've
understood the root cause correctly, wmlxgettext itself was deterministic, but
the order of the files on wmlxgettext's command line was not deterministic.

For testing, I tried reversing the sort order; the resulting reordering hit
lines that commonly swap order during pot-updates.

This affects the ordering of the lines beginning `#.` that are generated from
`#po:` comments and also those auto-generated from `[message]speaker=`, etc.

@AncientLich, it's only a one-liner, but it seems polite to ask you first.

Fixes #5989."
785806553,"CMake: run xgettext on the .cpp file with GETTEXT_DOMAIN ""wesnoth""",stevecotton,2021-11-22 09:02:17+00:00,2021-11-24 12:10:56+00:00,"{'Backport': 1, 'Translations': 1, 'Building': 1, 'CMake': 1}","Make the search for translatable strings include install_dependencies.cpp in the POTFILES.in file.

Exactly one (plural) string has been missing from .pot files build by CMake, presumably since 2017."
785485617,Remove apply_to = opponent from the opponent's attack prediction window(master),newfrenchy83,2021-11-21 22:23:49+00:00,2021-12-02 15:27:29+00:00,{'Units': 1},"
Showing the names of the abilities that apply to the opposing side with that opponent's attack is more confusing than anything else."
785483973,Remove apply_to = opponent from the opponent's attack prediction window,newfrenchy83,2021-11-21 22:14:31+00:00,2021-12-02 15:25:41+00:00,{'Units': 1},Showing the names of the abilities that apply to the opposing side with that opponent's attack is more confusing than anything else.
785336413,Replace std::regex by boost to temporary workaround for Mingw-w64's bug,fujimo-t,2021-11-21 06:59:35+00:00,2021-11-21 22:22:34+00:00,"{'Backport': 1, 'Network': 1, 'Editor': 1}","Temporary workaround for #6291.

It is an upstream bug but seems to take a long time to fundamental resolve, such as fix the bug at the upstream or move release toolchain to MSVC."
785102156,"UtBS: Use a lower-case letter for ""taurochs""",stevecotton,2021-11-20 00:02:04+00:00,2021-11-20 07:08:30+00:00,"{'Campaign (any)': 1, 'Units': 1, 'Prose': 1}","Backport of #6309. One of the CI builds for that PR failed for apparently unrelated reasons, so as a sanity check I'm waiting for the CI to finish before merging to the stable branch.

It's the name of a species, so lower-casing it is consistent with #6067.

(cherry picked from commit c4492327306cfdd81c34848219e57cb738868788)"
785075851,Capitalise references to the Academy of Magic on Isle of Alduin,Wedge009,2021-11-19 22:42:20+00:00,2021-11-23 03:08:02+00:00,"{'Backport': 1, 'Campaign (any)': 1, 'Prose': 1}",Resolves #6310.
784782662,color name of ability like weapon in attack prediction window and specifie when owned by opponent(master),newfrenchy83,2021-11-19 15:02:08+00:00,2021-12-02 17:13:33+00:00,"{'Translations': 1, 'Units': 1}","in case of specials abilities with value, the name will be colored after the benefit or not of special.
![color_name_abilitie_red](https://user-images.githubusercontent.com/31768074/142643456-b1ced83a-27bf-468b-8eeb-a4346442f3fd.PNG)
if abilitie give disaventage

![color_name_abilitie_green](https://user-images.githubusercontent.com/31768074/142643534-74131756-9620-4dc8-9faf-24eb17c0ec6f.PNG)

if give advantage.



![with_modification](https://user-images.githubusercontent.com/31768074/142643997-97e19115-8954-495a-933f-68213ea38df3.PNG)

if 'value' used or boolean 

"
784486381,"UtBS: Use a lower-case letter for ""taurochs""",stevecotton,2021-11-19 08:34:37+00:00,2021-11-19 23:54:53+00:00,"{'Backport': 1, 'Campaign (any)': 1, 'Units': 1, 'Prose': 1}","It's the name of a species, so lower-casing it is consistent with #6067.

I intend to backport this too, I spotted it while resolving fuzzy strings."
784382319,Add code comments stating what each unit test is testing.,Pentarctagon,2021-11-19 05:28:16+00:00,2022-02-18 01:32:04+00:00,{'Unit Tests': 1},"---

This PR is the start of three steps I'm going go through as I'm able:
1) Add code documentation to the existing unit tests.
2) Reorganize the existing unit tests into directories based on which APIs they are testing.
3) Add more tests to fill in the areas that don't have any unit test coverage."
784087565,Attempt to trim down the CI after getting caught in github's automate…,Pentarctagon,2021-11-18 20:20:58+00:00,2021-11-18 23:08:23+00:00,{'CI': 1},"…d platform abuse tool.

Removed:
* Two linux jobs - now only two combinations of the gcc/clang + scons/cmake matrix are run.
* Two macOS jobs - the Release configuration is now only run on ARM, and the Debug configuration is only run on Intel.

Also pinned vcpkg to a particular commit so it doesn't ignore the cache when new versions of dependencies come out. This does mean though that when dependencies or dependency versions change that the vcpkg commit and the cache ID will need to be manually updated. And while it's *probably* safe to have stable and master share the same vcpkg cache, this may become problematic if their dependencies and/or versions become incompatible."
783043490,ui: Fix 800x600 theme's sidebar tooltips,stevecotton,2021-11-17 19:22:24+00:00,2021-11-23 21:39:31+00:00,"{'Bug': 1, 'UI': 1, 'Fwdport': 1}","Two changes in the theme config for 1024x600, which is inherited by the config
for 800x600. Both are the same line but otherwise only loosely related to each
other; together these fix issue #6264, which was that trigger areas for some
tooltips overlapped.

Reduce the width for the unit's name, thus giving the side-flag and side-number
(which get the remaining horizontal space) enough space to display themselves.
128 pixels wide is the same as the name gets in larger themes, even though
those larger themes use larger font sizes. This means that the side number
doesn't get ellipsed, at least for games with up to 9 sides, with the
side-effect that the tooltip can be displayed when hovering over the flag.

Move the name, and thus the flag and side-number down by 1 pixel, so that they
don't overlap with the tooltip trigger areas for movement points and terrain
defense. The name's location is based on the placement of `unit-box-botleft`;
the theme for larger screen-sizes similarly adds 5 pixels of padding because
the `unit-box` is only 72x72 for the image, and the text areas for movement
points and defense go lower than that.

This file is currently identical in 1.16 and master, so forward-porting it will be
a simple cherry-pick.

![image](https://user-images.githubusercontent.com/101462/142268372-1bebae60-6629-439d-a25f-c33cf180dad0.png)"
781566533,UtBS Hide Dark Assassin's race until uncloacked,Descacharrado,2021-11-16 11:05:19+00:00,2021-12-04 19:35:24+00:00,"{'Backport': 1, 'Campaign (any)': 1, 'Units': 1}","Created a new race which displays the Unknown Unit help page (Lines 14-26 in units.cfg).

~~The only problem that can be seen is that Dark assassin is triplicated (as it is in the code)~~ I defined just one cloacked dark assassin and one uncloaked one and then modified via wml in the scenario cfg file.

Changed the base unit to be the Dark Assassin Uncloaked so less code is used overall (and less changes have to be made to the attack and hp stats).

Q: Why did I delete the hide_help=yes property?  A: It makes the player not be able to read the units description, which I though was not intended as it describes best the behaviour while cloaked:
![Why not hide_help=yes](https://user-images.githubusercontent.com/30196839/141973227-f78125fd-1f29-4666-941f-6dc5ad6ded7a.png)

So now players will be able to see the unit's description (clicking on top of the units type) without being spoiled and the ingame race will now be displayed as follows:
![Dark assassin cloaked](https://user-images.githubusercontent.com/30196839/141973431-7a64493c-88df-4e51-9ced-5336416cd993.png)
![Dark assassin uncloaked](https://user-images.githubusercontent.com/30196839/141973435-900ee544-6400-40f6-acf7-865b5ed856ea.png)

(Closes #6213)
"
781403361,Refactor handling of allies in UtBS (plus compatibility),Wedge009,2021-11-16 07:43:52+00:00,2022-03-14 00:29:52+00:00,{'Campaign (any)': 1},"Depends on / is super-set of #6165, which refactors ally dialogue, and attempts to (but incompletely) handle the variable name correction from `$ally_name` to `$ally_id`. The original variable name was confusing because the values it held referred to the `id` of the ally, not the `name`.

Outstanding issue: The final scenario does not work properly because the variable `$ally_id` is used in the `[side]` declaration."
781225057,Refactor the boarding events for TRoW S8 Clearwater Port,Wedge009,2021-11-16 01:46:38+00:00,2021-11-17 11:53:56+00:00,"{'Backport': 1, 'Campaign (any)': 1}",Resolves #6298
780634664,Eastern Invasion and Liberty Bone Knight attack image,Descacharrado,2021-11-15 12:13:55+00:00,2021-12-04 22:35:08+00:00,"{'Backport': 1, 'Campaign (any)': 1, 'Graphics': 1, 'Units': 1}","From #4145:

> [ ] Bone Knight has no attack icon for the ""trample"" attack

Bone Knight's image was added to core.

In-game it looks like this:

![Bone knight trample image in-game](https://user-images.githubusercontent.com/30196839/141858648-5591ab51-2b9e-4611-97a4-f0eb7b96a54a.png)

EDIT: removed kick-orcish.png in f79848e5 because this commit inspired doofus to work on better icons on #6339


"
780290987,Fix [store_unit]'s stored coordinates for recalls,stevecotton,2021-11-15 04:17:14+00:00,2022-01-11 14:23:47+00:00,"{'Unit Tests': 1, 'WML': 1, 'Lua API': 1, 'Fwdport': 1}","Units on the recall list might have x,y coordinates that are on the map, which
therefore need to be replaced with ""recall,recall"" within [store_unit]. The
existing code created a temporary variable, changed the coordinates, and then
returned the unchanged original instead of the temporary.

Add a new test that `[put_to_recall_list]` followed by `[modify_unit]`
doesn't move the unit back to the map.

Fixes #6295
Fixes #6315"
780127393,Check whether to display lobby joins in the game creation screen.,Pentarctagon,2021-11-14 17:22:16+00:00,2021-11-15 17:46:32+00:00,"{'Backport': 1, 'MP Lobby': 1}",Fixes #6234
779757499,Fix multi-account password saving,vgaming,2021-11-12 22:20:10+00:00,2021-11-13 17:14:53+00:00,{'Backport': 1},"Fixes GH-6288, and hopefully makes the code
more readable / easier to understand."
779714567,campaignd: Drop removed pbl attributes on upload if applicable,irydacea,2021-11-12 20:48:31+00:00,2022-07-19 06:40:04+00:00,{'Add-ons': 1},"This adds a `config::copy_or_remove_attributes()` method with the semantics needed to solve issue #6284 in campaignd, and uses it instead of `config::copy_attributes()` in campaignd. The latter is now unused in the overall codebase, but I'm leaving it intact with new documentation in case it's useful to someone else in the future."
776633559,"Show the id in the ""[race] '' is missing a plural_name"" warning",stevecotton,2021-11-09 15:03:44+00:00,2021-11-11 12:48:42+00:00,{'Units': 1},"In 1.16 with Ageless Era 4.28.0, the message `[race] '' is missing a
plural_name` is printed to the chat area. The message is not useful even to
add-on developers, because it only identifies which race is affected by
`[race]name`, and in the affected races the `name` attribute is also missing.

An unfortunate side-effect of making the warnings more useful is that more of
them are shown in-game - these messages go through the logging mechanism that
discards duplicate messages. Making them useful also makes them unique,
they are no longer duplicates.

Also log if a race lacks either a male or female singular name. This warning
will not trigger if the race has a non-empty `name`, as both gender-specific
options are documented to fall back to `name`.

Remove the warning about races that have a `name` but no `id`. Prior to 1.3.8,
[race]name= was the identifier, and there wasn't a [race]id= attribute. The
compatibility code for that change was removed in 1.7.6 (commit 160000a40), so
it seems unnecessary to keep the logging for missing ids.

I'm unsure about backporting this to 1.16, as it increases the number of messages
printed to the chat area. Keeping it as a tool on the master branch only seems reasonable.
The newly-traceable issues have been logged as ProditorMagnus/Ageless-for-1-14#28 and
ProditorMagnus/Ageless-for-1-14#29. At the time of writing it's possible to use the master
branch's binary with 1.16's data and Ageless; but Ageless 4.28.0 isn't compatible with master's
data (due to the removal of the SPECIAL_NOTES macro)."
776628166,fix bug in leadership abilities in 1.16,newfrenchy83,2021-11-09 14:58:24+00:00,2021-11-22 22:45:03+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1}","for reply to https://github.com/wesnoth/wesnoth/pull/6273#issuecomment-962649085 with new udate, the compatibilty don't break."
775553521,color name of ability like weapon in attack prediction window and specifie when owned by opponent(1.16),newfrenchy83,2021-11-08 13:24:38+00:00,2021-12-02 17:13:45+00:00,"{'Translations': 1, 'Units': 1}",equivalent 1.16 of https://github.com/wesnoth/wesnoth/pull/6312
775069741,HttT S05b - Added cracked temples,Descacharrado,2021-11-07 23:13:26+00:00,2021-11-17 11:53:31+00:00,"{'Backport': 1, 'Campaign (any)': 1, 'Graphics': 1}","Added some cracks to the temples so the scenario dialogue is more fitting (see #5576).

Result can be seen in the following image (top to bottom temple-cracked1, 3, 2):
![A](https://user-images.githubusercontent.com/30196839/140665307-7a967496-ea38-4170-95d1-39f3ca84a83f.png)

Changes can definitely be made on the location of each temple, the using of a normal temple (temple1.png) in some spot or the modification (by me or whomever) of the images.

(Closes #5576)."
775032996,revert extent addition of the names of the abilities used as weapons in the attack dialog window to apply_to=opponent(1.16),newfrenchy83,2021-11-07 19:18:02+00:00,2021-11-08 13:25:02+00:00,{'Units': 1},
775031066,fix cumulative=yes cancel negative value of some abilities(1.16),newfrenchy83,2021-11-07 19:06:05+00:00,2021-11-09 14:58:45+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1}",suggest an other resolve to https://github.com/wesnoth/wesnoth/issues/6269 issue
775030064,fix 'add' and 'sub' not added in leadership shema validation,newfrenchy83,2021-11-07 19:00:13+00:00,2021-11-09 14:59:21+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1}",
775017263,color 'name' in attack prediction windows for abilities used like weapon based on benefit(master),newfrenchy83,2021-11-07 17:41:08+00:00,2021-11-19 14:56:08+00:00,"{'Campaign (any)': 1, 'Units': 1, 'Schema': 1}",
775015112,color 'name' in attack prediction windows for abilities used like weapon based on benefit,newfrenchy83,2021-11-07 17:27:53+00:00,2021-11-07 18:28:00+00:00,"{'Campaign (any)': 1, 'Units': 1, 'Schema': 1}",
775013403,Fix leadership bug for 1.16,newfrenchy83,2021-11-07 17:16:53+00:00,2021-11-07 17:27:37+00:00,{'Unit Tests': 1},
775001321,Update changelog,stevecotton,2021-11-07 16:08:31+00:00,2021-11-07 16:17:26+00:00,{},"I haven't added changelog entries for:
* 297ee3d1 campaignd more args to setattr - not sure what to say here
* 08f1890b and 5f0d1848 - they're just clean-ups
* 02db53c9 UI for abilities with apply_to=opponent - I'm calling for it to be reverted
* 100045c0 string changes for MP - PR already opened to revert this"
774985647,"[1.16] Revert MP string changes, as string freeze is still in effect",stevecotton,2021-11-07 14:44:03+00:00,2021-11-07 16:51:28+00:00,"{'Translations': 1, 'UI': 1, 'Stable 1.16': 1}","This reverts 100045c0, ""Revert ""Revert this for 1.16.1"""", which in the end
reverts the string changes from b765c0be66c0f43e2eeedb0c1015a1f0ee81a7dd."
774967626,fix bug in leadership abilities in master,newfrenchy83,2021-11-07 12:59:51+00:00,2021-11-22 22:45:26+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1}",Fix https://github.com/wesnoth/wesnoth/issues/6269 issue
774597874,Fix tooltips on the sidebar,stevecotton,2021-11-05 21:28:15+00:00,2021-11-06 06:21:17+00:00,"{'Bug': 1, 'UI': 1, 'Regression': 1}","Forward-port of #6256. Will merge once the CI passes.

There's still a known issue with 800x600 resolution. At that resolution, the
side-flag is ellipsed (even if the unit has a short name), and the tooltips for
both the name and the flag are missing. The movement and defense tooltips (both
are on the line above the name and flag) are sometimes also missing in 800x600.
Given that, I'm considering leaving #6007 open to track it. Issue #6096 can be closed,
as it has ""fullscreen"" in the title.

Fix iterator-use-after-invalidation in tooltips
---

It's undefined behavior to access an iterator after calling std::map::erase(),
the correct method is to use the new iterator that erase() returns instead.

Fix pango_text::set_maximum_height
---

Change back to handling the height in our code instead of expecting Pango to
handle it. Pango is still expected to handle the maximum width, as Pango needs
to handle the word-wrapping.

While writing f282eb7, I had noticed that set_maximum_height called
PangoLayout's pango_layout_set_height, and removed the apparently unnecessary
enforcement of the maximum height from our wrapper code. The documentation
added in this commit explains why that was incorrect.

This fixes the bug that some tooltips on the sidebar stopped working. The text
on that sidebar is densely packed, and while this commit makes no visual
change, it removes a few blank pixels of padding below the text. That extra
padding was sufficient for the next line's area to overlap, making
tooltips::add_tooltip remove the previously-added tooltip."
774500053,Re-add html character escaping.,Pentarctagon,2021-11-05 18:47:09+00:00,2021-11-05 20:51:28+00:00,"{'MP': 1, 'Add-ons': 1}",
773948304,Added ability to add setter callbacks on preferences,Vultraz,2021-11-05 06:59:46+00:00,2023-06-10 20:02:12+00:00,{'Engine': 1},"A simple callback interface for pref setters required by @irydacea. This could honestly be used to replace functions like `set_music`, allowing one to simply call `set` and having the callback handle the side effects."
773558896,[1.16] Fix tooltips on the sidebar,stevecotton,2021-11-04 18:00:42+00:00,2021-11-05 20:42:30+00:00,"{'Bug': 1, 'UI': 1, 'Regression': 1}","Fix iterator-use-after-invalidation in tooltips
---

It's undefined behavior to access an iterator after calling std::map::erase(),
the correct method is to use the new iterator that erase() returns instead.

Fix pango_text::set_maximum_height
---

Change back to handling the height in our code instead of expecting Pango to
handle it. Pango is still expected to handle the maximum width, as Pango needs
to handle the word-wrapping.

While writing f282eb7, I had noticed that set_maximum_height called
PangoLayout's pango_layout_set_height, and removed the apparently unnecessary
enforcement of the maximum height from our wrapper code. The documentation
added in this commit explains why that was incorrect.

Fixes #6007 and #6096, both issues that some tooltips on the sidebar stopped
working. The text on that sidebar is densely packed, and while this commit
makes no visual change, it removes a few blank pixels of padding below the
text. That extra padding was sufficient for the next line's area to overlap,
making tooltips::add_tooltip remove the previously-added tooltip."
772816541,Convert Isar's Cross map background images to webp format,inferno8,2021-11-03 21:08:59+00:00,2022-03-25 23:56:28+00:00,"{'Graphics': 1, 'MP': 1, 'Terrain': 1}","I've reduced the size of Isar's Cross background images up to 77% (from 5.18Mb to 1.16Mb) by using the WebP image format instead of PNG. I used lossy compression with quality setting of 90, so there is no degradation in perceptible visual quality. 

Does Wesnoth support such format on all platforms? I am running BfW on Windows 10 and it works fine for me (the map background graphics are visible), but I am not sure about other OSes."
772636759,Check for potential duplicates before inserting.,Pentarctagon,2021-11-03 18:02:45+00:00,2021-11-10 16:34:47+00:00,"{'MP': 1, 'Add-ons': 1}","---

I had already fixed this issue on the client side a while ago, but perhaps WCII has another way of triggering it."
770970016,Add translation hints for time format strings,Wedge009,2021-11-01 23:21:39+00:00,2021-11-02 07:28:52+00:00,"{'Translations': 1, 'UI': 1, 'Add-ons': 1}",Resolves #6246
770886749,Fixes for broken gui.get_user_choice() function,Elvish-Hunter,2021-11-01 21:10:07+00:00,2022-01-08 21:41:14+00:00,{'Lua API': 1},"While updating the Wesnoth Lua Pack for the 1.16 series, I noticed that the `gui.get_user_choice()` function is unusable: all it does is throwing the following error.

    error scripting/lua: lua/core/gui.lua:38: bad argument #2 to 'insert' (number expected, got function)

This is caused by three commas that shouldn't be there, so the first commit of this PR removes them.
After having fixed this, I checked the function with the test scenario: while it was supposed to show an image column and two text columns, it still used the old syntax (the one with `&` and `=`, to be clear), instead of the current `image`, `label`, `description` and `default` keys used by `[option]` tags. Since support for the old syntax has been removed, the text shown to the user was just like this:

    *&items/potion-blue.png=Nice blue=Surely you’ll like that one

The second and third commit of this PR add support for the currently used keys (which can be in a table or vconfig object) and update the test scenario, respectively."
769975949,KeyboardInterrupt Handlers for wmltools,max-torch,2021-10-31 17:11:30+00:00,2021-11-17 22:08:40+00:00,{'WML Tools': 1},"Closes https://github.com/wesnoth/wesnoth/issues/3352.

wmllint and wmlscope already had KeyboardInterrupt Handlers. I just edited their displayed messages for consistency. wmlindent and wmlxgettext did not have interrupt handlers and it had to be defined in their scripts.

wmllint and wmlscope use try-except clauses to define the interrupt routine.
I used a listener, `signal.signal`, to handle the interrupt routine so that I wouldn't have to wrap all the existing code in a try-except clause and change all the indentation.

Approver, please try running all four scripts and then pressing ctrl-c to abort so that you can verify the new behavior."
769824366,Use the CI to generate artifacts that can be used for releases,Pentarctagon,2021-10-30 23:44:51+00:00,2021-11-18 18:32:18+00:00,"{'Docs': 1, 'CI': 1}",
769124584,[WC] [1.17] Three New factions to complete WC era.,knyghtmare,2021-10-29 10:44:13+00:00,2021-10-31 16:52:35+00:00,"{'Enhancement': 1, 'Campaign (any)': 1, 'MP': 1}","Will Fix #6175 

Currently
- [x] The Artisans - Dunefolk+Dwarves
- [x] The Marauders - Dunefolk+Northerners
- [x] The Defiance - Dunefolk+Undead

I am still open to name changes or pairing changes or any other suggestions.

Will be merging this within 36 hours if no complaints/remarks."
767647880,Make wmltools Forest avoid version control subdirectories,max-torch,2021-10-27 17:48:57+00:00,2021-11-06 22:19:14+00:00,{'WML Tools': 1},"Resolves #5949.

Seems more like a bug fix than a feature enhancement. The original code had a for loop that tried to modify the contents of `Forest.forest` but never actually updated it.

Tested by using wmlscope on a check out of A New Order:
Here's the output of `wmlscope --collision` before the fix:
[beforefix.txt](https://github.com/wesnoth/wesnoth/files/7428240/beforefix.txt)
And here's the output after. No more looking inside of .git:
[afterfix.txt](https://github.com/wesnoth/wesnoth/files/7428244/afterfix.txt)

So far this only makes wmlscope and anything else that uses the Forest class object inside wmltools actually avoid version control subdirectories. In #5949 there is also mention of other ""pesky"" subdirectories such as 
`.DS_Store`

Do we want to specifically also include `.DS_Store`, and do we want to also include all hidden folders?
Those things can be a separate commit since it expands existing functionality, while this can be its own commit since it fixes a bug/existing intended behavior."
766736313,changes for wc4p ,sevu,2021-10-26 18:30:05+00:00,2022-06-27 18:25:29+00:00,{'Campaign (any)': 1},Changes to WC2 to support a 4th side.
766704817,Lua: Fix nil-safety issues in location_set,CelticMinstrel,2021-10-26 17:44:32+00:00,2021-10-29 00:51:48+00:00,{'Lua API': 1},Fixes #6231
764884092,SotA S02: Add l10n hints about temple label and bats,stevecotton,2021-10-24 14:26:54+00:00,2021-10-25 02:56:49+00:00,{'Campaign (any)': 1},"The lines about bats were converted to typographic quotes in 3fcba6aa, so this
could be cherry-picked to the 1.16 branch along with that (but shouldn't be
cherry-picked without it)."
764837806,Remove the fast path of [modify_unit],stevecotton,2021-10-24 09:43:10+00:00,2021-11-05 20:39:39+00:00,"{'Unit Tests': 1, 'Lua API': 1}","Always use the ""slow path"", because it stores and unstores the unit, triggering
the desired side effects of unstoring a unit.

Fixes issue #5133, and tests that with the new unit test.

Fixes bug #4978, that changing the facing wasn't updating the display.

This corresponds to 1.16's commit 13c5d8a96ead8d2a7f0435f60b8ec7f7e0af0972,
that commit merely disabled the fast path to be a minimal change."
764721141,[1.16] Disable the fast path of [modify_unit],stevecotton,2021-10-23 17:45:14+00:00,2021-10-23 20:33:23+00:00,"{'Bug': 1, 'Unit Tests': 1, 'WML': 1, 'Lua API': 1, 'Regression': 1}","With these two lists emptied, is_simple() will always return false, and the
code will always use the slow path. The slow path is slow because it stores and
unstores the unit, triggering the desired side effects of unstoring a unit.

Fixes issue #5133, and tests that with the new unit test.

Fixes bug #4978, that changing the facing wasn't updating the display."
764709625,"For a [message] with options, zero-initialise the default selection int",stevecotton,2021-10-23 16:24:11+00:00,2021-10-25 12:12:36+00:00,"{'WML': 1, 'Lua API': 1, 'Regression': 1}","Forward-port of #6217, a less time-restricted place to discuss whether it's
good to switch to `auto` syntax; see https://github.com/wesnoth/wesnoth/pull/6217#pullrequestreview-787397620

I can't reproduce the issue (it selects the first option by default for me even
without this), but this probably fixes #6038 ""When you have a long list of
[message][option], it will default to highlighting the 3rd entry for some
reason.""

(cherry picked from commit 219f2c8f02215a1257ed4ac2a379b5833194f0ef)"
764177718,"[1.16] For a [message] with options, zero-initialise the default selection int",stevecotton,2021-10-22 13:01:37+00:00,2021-10-23 16:17:32+00:00,"{'WML': 1, 'Regression': 1}","@virtualghetto, please would you test this?

I can't reproduce the issue (it selects the first option by default for me even without this), but this probably fixes #6038 ""When you have a long list of [message][option], it will default to highlighting the 3rd entry for some reason.""

Adding @Vultraz as a reviewer, please would you say whether this is the best coding style for doing this?"
762552432,Error handling for corrupt .mo files,stevecotton,2021-10-20 17:13:04+00:00,2021-10-21 18:27:07+00:00,"{'Bug': 1, 'Translations': 1}","Fixes #6194

Previously, a corrupt .mo file caused the game to exit immediately. This meant
that a broken add-on could stop the user from reaching the main menu, a
situation that could only be recovered by editing the preferences file or by
deleting the add-on with a file browser.

The engine generates the locale 3 times:
* once with no .mo files loaded
* once with only the mainline .mo files loaded
* once with all .mo files loaded

This means that:
* starting Wesnoth with a corrupt .mo file in mainline will make the engine run
  showing en_US text
* changing language with a corrupt .mo file in mainline will make the engine
  stay in whatever language it had successfully loaded
* a corrupt .mo file in an add-on will disable .mo files in all add-ons, but
  leave mainline translations active, and will let the user play the game"
762552273,[1.16] Error handling for corrupt .mo files,stevecotton,2021-10-20 17:12:51+00:00,2021-10-21 18:27:02+00:00,"{'Bug': 1, 'Translations': 1}","Fixes #6194

Previously, a corrupt .mo file caused the game to exit immediately. This meant
that a broken add-on could stop the user from reaching the main menu, a
situation that could only be recovered by editing the preferences file or by
deleting the add-on with a file browser.

The engine generates the locale 3 times:
* once with no .mo files loaded
* once with only the mainline .mo files loaded
* once with all .mo files loaded

This means that:
* starting Wesnoth with a corrupt .mo file in mainline will make the engine run
  showing en_US text
* changing language with a corrupt .mo file in mainline will make the engine
  stay in whatever language it had successfully loaded
* a corrupt .mo file in an add-on will disable .mo files in all add-ons, but
  leave mainline translations active, and will let the user play the game"
760882755,UtBS S06b Grog spawn overhaul,Descacharrado,2021-10-18 21:42:14+00:00,2021-12-04 19:32:41+00:00,{'Campaign (any)': 1},"Addresses bug 3 in #6196 and suggestion 1 in #6197.

Addressing bug 3: Previously, Grog spawned when a unit stepped on (6-8,28-34) making a unit with more than 6 mp able to see that there is no Grog at (7,28) from 9,35 (or further if the unit has even more than 7 mp).

(outdated) The expected behaviour now is for Grog to be there the entire time (spawns in the prestart event, Lines 398 to 413), fighting with the dwarf without the possibility of either of them dying **before** he is discovered, as their chance to hit would be null (Lines 751 to 762). Everytime they fight, their xp is reset and 8 hp is drained from Grog (so he does not go above 25 hp before being found, Lines 765 to 851). Once Grog is discovered (event line 853), the variable defined in line 291 is cleared (Line 867), and thus none of the events previously described would make effect.

Addressing suggestion 1: previously, one could get unlucky and have Grog die (which is kind of common).

(outdated) This can be reduced in the easier difficulties as seen in line 868, making it less likely for grog to die in turns 2+ after he is discovered. (Has to be kept in mind that, even if recondite, the chance for him to die will always exist using this method), if it is really wanted for him not to die on, lets suppose, the first three turns he is discovered, more turn-by-turn code should be added or more hp should be added to grog in line 407 (I have already tested this option, but Grog always crushed the dwarf by himself, making the player's tactical choices feel irrelevant).

(update) Grog will now spawn at the start of the scenario, simulate fighting with the dwarf the entire time (even if off-screen, behind shroud) and when he is found, the experience restrictions would be lifted, so if many more turns pass, the dwarf would advance before a troll which most likely would have less than 25 hp, making it very easy for him to die."
760153604,SoF Add Rune Chest Objective Notes,max-torch,2021-10-18 07:35:18+00:00,2021-11-03 05:29:33+00:00,{'Campaign (any)': 1},"Resolves #6160 
Objective Notes are added to inform the player about the available rune chests that can be used to purchase rune upgrades."
760139132,Add Objective Note for Thursagan's Rune Mechanic,max-torch,2021-10-18 07:14:52+00:00,2021-11-03 05:59:41+00:00,{'Campaign (any)': 1},"Resolves #6153 
Adds an objective note to scenarios where Thursagan can upgrade units. This implementation is consistent with the design style set forth by Son of the Black Eye for its ""Great Horde"" mechanic, which displays an objective note for half of the scenarios in that campaign.

### Screenshot
SoF Thursagan's Rune Mastery:
![image](https://user-images.githubusercontent.com/41433185/137685133-7a40d7b1-65bf-42c2-b444-2ff0bfac280b.png)

### SotBE Comparison
SotBE Great Horde:
![image](https://user-images.githubusercontent.com/41433185/137684546-f91e2fdc-adcb-41b1-bcd8-7a1b49213b86.png)



"
760009574,Remove support for writing BMP screenshots,irydacea,2021-10-18 02:52:47+00:00,2021-10-21 19:31:16+00:00,"{'UI': 1, 'Editor': 1}","This is redundant now that PNG support is part of SDL_image and therefore always available to us on supported configurations. BMP files are horribly expensive to store and offer no advantages for this use case, to the point people are way more familiarized with the existence of PNGs than BMPs these days."
759819477,UtBS S06b hermit enhancement and tentacle fix.,Descacharrado,2021-10-17 11:37:58+00:00,2021-11-03 06:02:18+00:00,{'Campaign (any)': 1},"Two fixes have been bundled in this PR:

1. Tentacle spawning rework.

Previously, the tentacle spawning event would search for a suitable location to spawn the tentacles (and it would search for just the one location) so if it failed to find a Ww* or Wo* (shallow or deep water) tile then the location array (locs) would be empty and lowering the random variable by one (which is defined between 1 and the length of locs) would cause it to be below zero (-1) as seen in my comment in #6196 (Erased Lines 1268-1276). TL;DR [store_locations] would not store all matching locations.

The expected behaviour now is:

At the start of the scenario, in the prestart event, all the intended possible locations for spawn are stored in locs (Lines 293-306).
When tentacles have to be spawned, a random number is selected the same way as it was before (Lines 1248-1249).
The location variable is cleared when every tentacle is killed (Lines 1348-1349).

Note: I removed the #ifdef DEBUG_MODE lines I added for debug purposes in commit 2cc4457 in case someone wants to have a look at them.

Image used as demonstration:
![Nodebug](https://user-images.githubusercontent.com/30196839/137625576-923f70a4-4879-4361-ad3d-6cd49957ddd4.png)

2. Fix for hermit dialogue not triggering when he is lured into the water.

Previously the only way for the Dwarf Hermit's dialogue to trigger was to step on his island, but it makes way more sense for him to say it if you step on his island or if he engages in combat with side 1.

The expected behaviour now is:

A hermit_trigger variable is initialized at line 291.
If the player sets foot on the island before being attacked by the hermit the first event (Lines 1529-1542) and the variable is cleared, locking the other event (Lines 1544-1563) and vice versa.

Image used as demonstration:

![Hermit dialogue fix](https://user-images.githubusercontent.com/30196839/137625553-481d199e-c8df-4bd8-a092-0ab9c0815a68.png)

"
759672454,UtBS S06b Fix Dwarf Sergeant confusing a dust devil or human for a troll,Descacharrado,2021-10-16 14:59:41+00:00,2021-11-10 03:15:15+00:00,{'Campaign (any)': 1},"Fix for one of the tasks in Issue #6196. Used a [switch] instead of [if]-[elses] for clarity. **⚠New strings have been added ⚠** and have to be revisioned, make sure string freeze is lifted before merging/backporting.

Dust devil (monster) string: 

![Dust devil 1](https://user-images.githubusercontent.com/30196839/137592103-c9693961-547f-4dd7-ae7b-b053cb7945a5.png)
![Dust devil 2](https://user-images.githubusercontent.com/30196839/137592105-376b7454-24b1-4791-bd2e-46f778544a6c.png)

Elyssa (human) string:

![Human 1](https://user-images.githubusercontent.com/30196839/137592131-ee2d356e-2c0c-4753-98e9-3b71a5be5138.png)
![Human 2](https://user-images.githubusercontent.com/30196839/137592133-01c56a20-0522-4123-862f-5d0119652a7f.png)

In case other race is added to previous scenarios in the future:

![Other 1](https://user-images.githubusercontent.com/30196839/137592186-fc20e1ac-d4d7-4cf4-baad-125be2a5f80d.png)
![Other 2](https://user-images.githubusercontent.com/30196839/137592191-f676ed9b-efd3-4b0a-b95a-00e8ffa74cab.png)

Troll and Quenoth elf strings are unchanged.

"
758225617,TRoW S19 Chest is automatically collected at the end of the scenario,Descacharrado,2021-10-14 10:50:42+00:00,2021-11-03 05:54:39+00:00,{'Campaign (any)': 1},"The S19's gold chest close to the troll enemy leader will now be collected at the end of the scenario if the player misses it (which is unlikely but could happen). A new dialogue may be necessary in line 704.

The expected behaviour of the changes is:

- If the player moves a unit during the scenario to the chest, it opens and cannot be opened again and at the end of the scenario nothing will happen.
- If the player misses the chest, Haldric (Or the closest ally unit, if that is ever wanted to be implemented) moves to the chest and opens it, and the scenario ends.

(Closes #6141)"
757665557,DM S07 Fix for player having to pass turn in order to meet alternative win condition (#6173),Descacharrado,2021-10-13 18:26:05+00:00,2021-11-10 01:50:09+00:00,{'Campaign (any)': 1},"As stevecotton suggested a good way of tackling this kind of win condition is to have a counter which counts to 2 on EASY and NORMAL difficulty and 3 on HARD (Line 133). Every time a generator is destroyed one is added to the counter variable called generators_destroyed (L 126-129). The edited macro would now work like this:

- If the player destroys all the generators and there are no enemy units remaining the scenario would end (L 135 - 152)
- If the player destroys all the generators and there ARE enemy units remaining, then the objectives are updated and shown to the player (now the optional win condition is to defeat the remaining enemy units, L 154-179) and a child event (L 181-205) is spawned, which makes it so if the player defeats all enemy units he wins.
- Before any [endlevel] tag there has to be a {CLEAR_VARIABLE} clearing the created variable.

This has been tested on my machine and works in any case (in 1.16.0 too), but further testing and review would be beneficial.

EDIT: As suggested, the only use of this macro occurs in scenario 7, which made the definition inside the campaign.cfg possible. If the macro was wanted to be used somewhere else too many arguments would need to be added (and they would be pretty obscure, just imagine passing objectives, speakers and strings as arguments).

( Closes #6173 )"
757290216,UtBS S5: Avoid event taking away a village just captured by the player,Wedge009,2021-10-13 11:12:42+00:00,2021-10-14 14:18:14+00:00,"{'Backport': 1, 'Campaign (any)': 1}","Resolves #6187

Trivial to test, but I often seem to screw up _something_ when tinkering with WML, so asking for a review. I reckon it should be small enough to go to 1.16 if it's acceptable."
756676209,AToTB S01 and S02 mercenary spawn overhaul,Descacharrado,2021-10-12 20:54:07+00:00,2021-10-19 20:52:57+00:00,{'Campaign (any)': 1},"This makes the mercenary spawn in some place in the map and then move to Arvith's side by modifying the NEED_MERCENARY macro located in characters.cfg. Behaviour can be seen in the following gifs.

![S01 gif](https://user-images.githubusercontent.com/30196839/137025372-7ae7c02b-8202-4e11-815b-c3bbf47236fd.gif)
![S02 gif](https://user-images.githubusercontent.com/30196839/137025381-d573cd6b-4542-4b7c-92d5-9f55c39af4ba.gif)

Downside is that the macro needs the arguments in every situation (so when using the NEED_MERCENARY macro on a prestart event you need to have a valid location, for example, x=1 y=1 is always valid, even if the player would never see where the horseman came from).

Upside is that it is possible to make the unit appear from different places depending on the position of Arvith (or other factors) if that is so desired in the future. For instance:

```
[if]
        [variable]
		name=Arvithposition.y
		greater_than=28
	[/variable]
	[then]
		{NEED_MERCENARY 1 49}
	[/then]
	[else]
		{NEED_MERCENARY 1 6}
	[/else]
[/if]
```

Would make the mercenary in S02 appear at the north side of the map (as shown on the gif) if Arvith was north of the river (roughly) and west of the camp if Arvith was south of the river.

The NEED_MERCENARY macro would allow for a comma-separated list of coordinates aswell.

Closed previous PR (#6185) because: 

- There were previous commits in my fork repo which made the PR have 3 commits instead of just the one.
- Cooljeanius commented it would be better to pass the coordinates as an argument to the macro, which is a better approach to the variables in my opinion.

( Closes #6183 )"
756227941,AToTB mercenary spawn overhaul (Closes #6183),Descacharrado,2021-10-12 14:04:07+00:00,2021-10-12 19:21:01+00:00,{'Campaign (any)': 1},"This makes the mercenary spawn in some place in the map and then move to Arvith's side. Behaviour can be seen in the following gifs.

![S01 gif](https://user-images.githubusercontent.com/30196839/136970662-b2ac15c0-0234-474a-a4b6-c97bb42fc047.gif)
![S02 gif](https://user-images.githubusercontent.com/30196839/136970668-638e4ad7-05cc-45ff-83d4-51ad69256cbd.gif)

The defined coordinates could be edited or this PR could be used as inspiration for a similar fix.
(Closes #6183)"
754767368,SoF S4 Make mining gold and coal clearer,max-torch,2021-10-10 19:29:25+00:00,2021-11-03 05:37:50+00:00,"{'Campaign (any)': 1, 'Units': 1, 'Prose': 1}","Resolves #6154.

### Changes
- Adds a narrator-hint about the Dwarvish Miner
- Adds an event that highlights gold and coal upon sighting it on the map
- Rewords Scenario Objectives to be more concise

Test run replay on 1.15.18:
[Highlight_gold_coal.gz](https://github.com/wesnoth/wesnoth/files/7318073/Highlight_gold_coal.gz)
The replay only demonstrates the sighted event and doesn't include the narrator-hint and reworded objectives.
The testing of the feature was on 1.15.18 because there were Lua errors that messed things up in the latest 1.17 master branch.

### Screenshot
![image](https://user-images.githubusercontent.com/41433185/136710301-f496a40f-34b3-4ceb-b8d9-8e3387663a69.png)

### Method of Hex highlight

A hidden Dwarvish Fighter unit was placed on each of the gold and coal hexes. A `sighted` event was used to trigger the display of a message where `speaker=unit` so that the hex would get a red border. A `fire_event` containing `kill` was used to remove the hidden unit after the message. The hidden units were assigned to Side 2 but they were given the loyal trait so that they would not interfere with Side 2's income. The units were `petrified` so they would stay in place.

**UPDATE: If you scroll below and follow the conversation, a Map Labels implementation was applied instead of a hex sighted implementation.**"
754595436,SoF- S6 - fix #6146 and related side-storing issue causing auto-defeat,doofus-01,2021-10-09 22:35:14+00:00,2021-10-10 00:31:57+00:00,{'Campaign (any)': 1},
754188270,Tutorial: Suggested Proofread Edits,max-torch,2021-10-08 16:33:05+00:00,2021-10-11 16:49:50+00:00,"{'Campaign (any)': 1, 'Prose': 1}",Proofread pass of tutorial text. Used `wmlxgettext` to ensure all text was reviewed.
754029269,DM Proofread Pass,max-torch,2021-10-08 13:12:55+00:00,2021-10-17 23:43:38+00:00,"{'Campaign (any)': 1, 'Prose': 1}",Proofread and Copy Edit pass of Delfador's Memoirs. `wmlxgettext` was used to review all text.
753569271,SoF Proofread Pass and Campaign Prose edits,max-torch,2021-10-07 22:10:51+00:00,2022-01-26 07:48:57+00:00,"{'Backport': 1, 'Campaign (any)': 1, 'Units': 1, 'Prose': 1}",This is a proofread pass. But this also has edits that are more than just minor edits which try to improve the campaign text. `wmlxgettext` was used to review all the text.
752711392,TSG Epilogue: Minor revision,Wedge009,2021-10-06 23:55:54+00:00,2021-10-10 01:23:04+00:00,"{'Campaign (any)': 1, 'Prose': 1}",Resolves #6169.
751211862,SotA clarifications and prose edits.,max-torch,2021-10-06 08:55:56+00:00,2021-10-07 19:20:11+00:00,"{'Campaign (any)': 1, 'Prose': 1}","This pull request provides solutions for #6120, #6119, #6121, #6123."
750843794,SotBE Proofread Pass,max-torch,2021-10-06 04:30:01+00:00,2021-10-13 04:31:15+00:00,"{'Campaign (any)': 1, 'Prose': 1}",Proofread Pass of the campaign Son of the Black Eye. `wmlxgettext` was used to ensure that all text was reviewed.
750821554,Refactor handling of allies in UtBS,Wedge009,2021-10-06 04:10:14+00:00,2021-11-17 11:52:35+00:00,{'Campaign (any)': 1},"With four potential allies in the campaign, there is a lot of dialogue duplication. This refactoring attempts to consolidate the text. Additionally, the ally ID was recorded in the variable `ally_name` which can be confusing (it was to me, at least), so I renamed it to `ally_id` instead.

Unless I made a mistake somewhere, the dialogue itself should not be changed, this is just to avoid redundant duplication. Please keep in mind I'm still very much a novice with WML so be gentle in pointing out any errors. Thanks.

PS I tested a little bit but haven't done a thorough checking of S7 (where `ally_id` is introduced) onwards, for all four allies."
750815219,Refactor handling of allies in Sceptre of Fire,Wedge009,2021-10-06 04:04:44+00:00,2021-10-06 04:05:30+00:00,{'Campaign (any)': 1},"With four potential allies in the campaign, there is a lot of dialogue duplication. This refactoring attempts to consolidate the text. Additionally, the ally ID was recorded in the variable `ally_name` which can be confusing (it was to me, at least), so I renamed it to `ally_id` instead.

Unless I made a mistake somewhere, the dialogue itself should not be changed, this is just to avoid redundant duplication. Please keep in mind I'm still very much a novice with WML so be gentle in pointing out any errors. Thanks.

PS I tested a little bit but haven't done a thorough checking of S7b (where `ally_id` is introduced) onwards, for all four allies."
750156274,"Improve help entry of ""Mountains"" terrain. Resolves #5906",max-torch,2021-10-05 18:47:09+00:00,2021-10-07 19:16:44+00:00,"{'Prose': 1, 'Terrain': 1}","Improve help entry of ""Mountains"" terrain."
750131739,desktop/version: Attempt to identify Windows 11 GA,irydacea,2021-10-05 18:14:00+00:00,2021-10-21 19:27:06+00:00,"{'Enhancement': 1, 'Windows': 1}",This is based on current rumours circulating on Windows 11 release day. It needs to be fact-checked and tested on live systems.
750046220,Install certs so CI can download scons over https.,Pentarctagon,2021-10-05 16:32:11+00:00,2021-10-05 16:32:22+00:00,{'Building': 1},
749226647,"Reference SotA in SoF, closes #6151",max-torch,2021-10-04 19:09:34+00:00,2021-10-06 19:19:28+00:00,"{'Campaign (any)': 1, 'Prose': 1}",Add a reference to SotA North Knalga in Sceptre of Fire.
748192473,TRoW S08 - Add a way of smoothing the appearance of Naga in the map in case the player premoves a unit.,Descacharrado,2021-10-02 20:24:47+00:00,2021-10-07 19:23:05+00:00,"{'Backport': 1, 'Campaign (any)': 1}","Delay time can be changed. One second felt okey imo tho (sorry for the quality of the attached file).
Fix for issue #6140

https://user-images.githubusercontent.com/30196839/135730846-952fe630-27b9-4bfb-828e-78e3b04150db.mp4

"
748097310,TRoW Proofread Pass,max-torch,2021-10-02 10:14:15+00:00,2021-10-06 19:14:58+00:00,"{'Campaign (any)': 1, 'Units': 1, 'Prose': 1}",For the campaign The Rise of Wesnoth. For Approval. Minor edits and proofreads. `wmlxgettext` was used so as to ensure all text was reviewed.
748037778,Dead Water Proofread Pass,max-torch,2021-10-02 03:01:46+00:00,2021-10-07 19:17:36+00:00,"{'Campaign (any)': 1, 'Units': 1, 'Prose': 1}","For the campaign Dead Water. For Approval. Minor edits, proofreads, and translator notes. `wmlxgettext` was used so to ensure all text was reviewed."
747868036,1.16 - Map-Editor missing Units,FrostBlade5,2021-10-01 18:57:37+00:00,2021-10-01 18:59:09+00:00,"{'macOS': 1, 'AI': 1, 'Campaign (any)': 1, 'Docs': 1, 'Graphics': 1, 'MP': 1, 'Translations': 1, 'Unit Tests': 1, 'UI': 1, 'WML Tools': 1, 'Editor': 1, 'Units': 1, 'Lua API': 1, 'Add-ons': 1, 'Building': 1, 'WFL': 1, 'Packaging': 1, 'Help': 1, 'CMake': 1, 'Schema': 1, 'Terrain': 1}","Map-Editor missing Units

Hello, im here to make a Suggestion!
Excuse me if the Topic does not fit to this Thread, feel free to move it.
Personally i think this Suggestion fits into Developement.

When i open the ingame Map-Editor and create a new Scenario i am able
to place all types of Unites, expect the unit-list is incomplete.
See Screenshot: https://postimg.cc/bsxXgVM3 (i beleve those are called unit-variations)

Let me explain: when a Undead-unit kills another unit, instead of dying
they become infected and will also turn into an undead unit.

Those are some of the Units im talking about: https://postimg.cc/yD37PNVz
Can you add the missing Units into the Map-Editor, please?
Would be awesome to be able and use those units in the map-editor!!

I have already reported this request on the wesnoth forum here: https://forums.wesnoth.org/viewtopic.php?f=6&t=54937
But since nobody so far has replyed what is going to happen i will try my luck here on github.
"
747528015,Sota proofread,max-torch,2021-10-01 11:35:18+00:00,2021-10-01 20:18:40+00:00,"{'Campaign (any)': 1, 'Prose': 1}","Had to close #6129 because I messed with the branch that had changes (by pressing fetch upstream). Here is a new pull request of a clean branch of my changes. #6129 was already approved, so just go ahead and merge this."
746527225,Pinnacle rock map label covered during dialog fix,Descacharrado,2021-09-30 09:49:20+00:00,2021-09-30 14:28:01+00:00,"{'Backport': 1, 'Campaign (any)': 1, 'UI': 1}","Issue #6125 - UtBS S2 Across the Harsh Sands Pinnacle Rock is covered during dialog fix. Now the camera will scroll to the tile where the ""Pinnacle Rock"" map label is."
744847530,SotA Proofread Pass,max-torch,2021-09-28 14:05:03+00:00,2021-10-01 11:32:17+00:00,"{'Campaign (any)': 1, 'Prose': 1}","Only proofreading. No major edits to tone, meaning, or dialog. The `wmlxgettext` module was used so that no text would be overlooked. The writing is already high quality and there was not much to nitpick."
742956347,Simplifying the description of leadership,Discontinuum,2021-09-26 22:07:11+00:00,2021-10-11 17:10:31+00:00,"{'Units': 1, 'Prose': 1}","I think that the current description of leadership is too wordy and hard to understand for no reason. So my proposal is to rewrite it more concise. I propose this variant as a starter, but it's not final by any means and I'm glad to hear any further suggestion on that"
742758444,Allow enabling the VSync hint on SDL's software renderer,irydacea,2021-09-25 21:06:59+00:00,2021-10-06 04:39:06+00:00,"{'Enhancement': 1, 'Graphics': 1, 'UI': 1}","Adds a VSync option to Preferences -> Display above Limit FPS. Requires SDL 2.0.17 or later. If an earlier version of SDL 2 is detected at runtime, the option in Preferences is hidden and ignored entirely.

Requires restarting the game because it necessitates recreating the window.

CC #5018"
741491302,Main menu language button v3,irydacea,2021-09-23 15:14:44+00:00,2021-09-25 01:58:25+00:00,"{'Translations': 1, 'UI': 1}","Since @stevecotton expressed interest in the iteration of the Language button I mentioned [in the middle of the discussion in #4531](https://github.com/wesnoth/wesnoth/issues/4531#issuecomment-842665100), I decided to package that and that alone into a PR that could potentially be merged into 1.16 without any string changes whatsoever.

![Screenshot_20210923_120951](https://user-images.githubusercontent.com/489895/134533823-66d33645-ff3e-42d1-a49d-2856857ed36b.png)

This new iteration of the button displays the name of the currently selected (or *guessed*, if it's System Default) language as its label, while retaining the icon for aesthetic purposes. It also increases the bottom and edge margins for that UI grid row to make it slightly more elegant than the previous ""everything stuck in the corner"" approach. There are otherwise no changes in functionalityhere.

![image](https://user-images.githubusercontent.com/489895/134534232-d9dd2fb9-b75c-4fe4-8637-bc36ab0dee15.png)

![image](https://user-images.githubusercontent.com/489895/134534286-da1572da-5431-4624-8fad-1d58b6f0f550.png)

![image](https://user-images.githubusercontent.com/489895/134534499-d9c395ef-fd88-47fe-ae9a-b05add0ece2b.png)

(Paging @Vultraz and @nemaara as well.)

CC #4531"
741133219,TRoW S12: Always give Lord Typhon a storm trident,Asheviere,2021-09-23 07:39:57+00:00,2021-09-23 13:16:23+00:00,"{'Backport': 1, 'Campaign (any)': 1, 'Units': 1}",Solves #6103.
740548687,extent addition of the names of the abilities used as weapons in the attack dialog window to apply_to=opponent(1.16),newfrenchy83,2021-09-22 14:51:59+00:00,2021-10-31 15:50:22+00:00,"{'Campaign (any)': 1, 'UI': 1, 'Units': 1}","If a weapon with apply_to=opponent is used, this name will appear in opponent attack affected."
740542151,extent addition of the names of the abilities used as weapons in the attack dialog window to apply_to=opponent,newfrenchy83,2021-09-22 14:45:24+00:00,2021-10-20 21:27:01+00:00,"{'Campaign (any)': 1, 'UI': 1, 'Units': 1}","If a weapon with apply_to=opponent is used, this name will appear in opponent attack affected."
737172632,Avoid use of 'cool' and 'guys' (closes #6107),Wedge009,2021-09-20 00:29:14+00:00,2021-09-20 05:50:26+00:00,"{'Campaign (any)': 1, 'Prose': 1}","As discussed in #6107, have left 'guys' in Camerin's lines alone."
736936480,Fix Issue 5743 surronding unit checksum code caring about weapon spec…,cpranga,2021-09-18 17:07:27+00:00,2021-09-28 11:13:51+00:00,{'Units': 1},"…ial names, which causes OOS when changed locally; fix issue by clearing out respective values by following later code."
736757539,Editor: Work-around crash situation,Wedge009,2021-09-18 02:18:34+00:00,2021-09-25 05:26:36+00:00,"{'Backport': 1, 'Editor': 1}",Work-around crash situation caused by using scenario-specific tools in map context (closes #5883)
736533463,Clear dehydration status on victory (resolves #5687),Wedge009,2021-09-17 16:50:08+00:00,2021-09-19 04:48:51+00:00,"{'Backport': 1, 'Campaign (any)': 1}","Even though units are not dehydrated in subsequent scenarios, the dehydration icon may otherwise still appear in the side-bar without this."
736502070,UtBS: Correct inconsistency in Ring description,Wedge009,2021-09-17 16:01:25+00:00,2021-09-18 00:24:56+00:00,"{'Campaign (any)': 1, 'Prose': 1}",Resolves #6043.
736437421,Make the team Eryssa leads (if alive) have consistent colour,Wedge009,2021-09-17 14:34:05+00:00,2021-09-18 02:23:37+00:00,"{'Backport': 1, 'Campaign (any)': 1}","Resolves #5375.

I tested this as per the above request and it works as intended. I can't think of how it could cause any, but not sure if there could be any unintended side-effects"
736360099,Display Difficulty as em dash when it is not valid (resolves #5321),Wedge009,2021-09-17 12:58:38+00:00,2021-09-25 23:32:13+00:00,"{'Backport': 1, 'UI': 1}","Second attempt at resolving #5321 after first (naïve) attempt in #6092.

Also shows campaign-specific difficulty for MP games.

* Test scenario: No difficulty -> —
* Pre-1.15 Tutorial: No difficulty -> —
* SP Campaigns: Custom difficulty -> no change
* MP Campaigns: Plain difficulty -> Custom difficulty
* MP Scenario: No difficulty -> —

```
Save Game                Before              After
---------                ------              -----
Test scenario            Medium              —
Tutorial (1.14 Tutorial) Medium              —
Tutorial (1.17 Campaign) Tutorial (Beginner) Tutorial (Beginner)

MP single scenario       Medium              —

SP campaign (HttT)       Commander (Normal)  Commander (Normal)
MP campaign (HttT)       Medium              Commander (Normal)
SP campaign (LoW)        Lord (Challenging)  Lord (Challenging)
MP campaign (LoW)        Medium              Lord (Challenging)
```

~Unfortunately, because it introduces the string `N/A`, it needs to wait till after 1.16.0 release before back-porting.~"
736272649,"Make utils::format_timespan() use gettext plurals, simpler output by default",irydacea,2021-09-17 10:49:13+00:00,2021-09-18 08:48:58+00:00,"{'MP': 1, 'Translations': 1, 'UI': 1, 'Building': 1, 'WFL': 1, 'CMake': 1}","See #6036.

This also adds a new `N_n()` no-op marker to `gettext.hpp` that is to `_n()` as `N_()` is to `_()`.

**NOTE:**

This is **NOT** a string-freeze-compliant change. Changing the strings from being standalone to being part of a plural form set causes them to be automatically fuzzied by the pot-update target. Merging this in 1.16 will have to wait until after 1.16.0 is released."
736182600,LoW S4: Avoid use of 'men' with respect to female elves (resolves #4880),Wedge009,2021-09-17 08:41:17+00:00,2021-09-18 00:24:34+00:00,"{'Campaign (any)': 1, 'Prose': 1}",See issue #4880 for discussion.
735660410,i18n: Fix dsngettext() not stripping caret annotations from plural forms,irydacea,2021-09-16 17:09:28+00:00,2021-09-17 07:55:55+00:00,"{'Backport': 1, 'Translations': 1}","This affects operation of `dsngettext()` and its users (e.g. `_n()` and `VNGETTEXT()`) specifically when the plural version of a string is chosen.

Apparently back in 2007 in commit 4852283ab3e1916c66d7d6660d61f9dc2cae38c6, this function and its late sibling were made to only strip carets from singular forms under the probable assumption that disambiguation won't be needed for plurals because of the way GNU gettext pairs them with their singular msgid under a single unique entry. Like everything else related to our gettext functionality, this wasn't documented in the C++ code.

However, there's no guarantee that this will remain the case forever if we some day decide to replace the GNU gettext format with something without this guarantee. It's also likely to confuse more people later down the line (especially now that the Lua API exposes this functionality).

Closes #6093."
735591807,Only display difficulty for SP campaigns (resolves #5321),Wedge009,2021-09-16 15:35:18+00:00,2021-09-17 00:50:20+00:00,"{'Backport': 1, 'UI': 1}","There are four save game types encoded:
* SP campaigns (internally called 'scenario')
* Multiplayer
* Tutorial
* Test scenario

I think Tutorial type is the old style tutorial from 1.14 and earlier which was treated as separate from SP campaigns. From 1.15 the Tutorial is included in the SP campaigns list and seems to be treated as such because with this change, MP and Test scenario save games will no longer have difficulty displayed in the save game preview of the game load dialogue, but SP campaigns and the Tutorial will."
735549709,DM S7: Clarify objectives (resolves #5608),Wedge009,2021-09-16 14:47:03+00:00,2021-09-16 22:41:32+00:00,{'Campaign (any)': 1},"According to the bonus objective as it stands, it should be possible to end the scenario early by simply destroying the 'generator' stones even if leaving a few skeletons around. However, the way victory condition is established simply by counting the number of enemy units at the start of a turn - if there are no units left, then the stones are assumed to be destroyed. (No generator stones active -> no enemy units)

As a work-around, simply update the objectives to make it clear that all enemies need to be eliminated for early victory to be achieved."
735533557,UtBS: Silence the Dust Devil,Wedge009,2021-09-16 14:28:50+00:00,2021-09-17 02:45:54+00:00,"{'Backport': 1, 'Campaign (any)': 1}","Use existing macro to avoid situations where Nym's otherwise-mute Dust Devil pet might speak.

Resolves #4892.

Note: I'm not familiar with WML so I'm not sure if I've done this 'right'. But for a quick test, focusing on the Draug mentioned in the aforementioned issue, I did the following (GUI Debug Tools wasn't working for me - maybe not yet working for 1.17.0+dev):
* Start UtBS campaign and debug-skip to Battle for Zocthanol Isle.
* Debug-remove fog and shroud.
* Debug-create Mage of Light adjacent to Kelur and attack to bring its HP down (high probability of all three attacks hitting).
* Debug-create Dust Devil and use it to finish off Kelur.

Before: Dust Devil remarks about the key left behind.
After: Nym speaks on the Dust Devil's behalf."
735419379,Switch to hard-coded colours instead of relying on pango names,Wedge009,2021-09-16 12:15:06+00:00,2021-09-20 01:43:20+00:00,"{'Backport': 1, 'UI': 1, 'Units': 1, 'Help': 1}","Resolves #4348

Pango changed its definition of 'green' in version 1.32.2 to align with CSS specifications (see #4348 for details). This change focuses only on instances of `<span color=""green"">`, leaving instances of named colours that don't use 'green'. For example:
https://github.com/wesnoth/wesnoth/blob/f8a41624e3022947b6d7d9ac6b0311c4a7d1fee4/src/gui/dialogs/gamestate_inspector.cpp#L598

**Problem**: I cannot see how to use this approach with `<format>` so it breaks time-of-day bonus colour consistency. Then again, I'm not sure if the green used in `<format>` is the same as the green used in `<span>`...
https://github.com/wesnoth/wesnoth/blob/f8a41624e3022947b6d7d9ac6b0311c4a7d1fee4/src/help/help_impl.cpp#L398-L402
![tod-schedule](https://user-images.githubusercontent.com/13679322/133606593-e0fc09b4-075e-44d5-acab-a48815539fdc.png)

Also:
https://github.com/wesnoth/wesnoth/blob/f8a41624e3022947b6d7d9ac6b0311c4a7d1fee4/src/help/help_topic_generators.cpp#L63-L68
Plus coloured text for 'vision' and 'jamming' that I can't find in the GUI.

**Questions**:
* How might `<format>` colours be updated? (Edit: Is it a case of Help being stuck on GUI1?)
* Where is the formula debugger used? I didn't change this one because I can't find where to test it: https://github.com/wesnoth/wesnoth/blob/f8a41624e3022947b6d7d9ac6b0311c4a7d1fee4/src/gui/dialogs/formula_debugger.cpp#L49-L51

**Comparisons**:
![intelligent-before](https://user-images.githubusercontent.com/13679322/133606300-aae33d66-45b0-455d-81b8-c17be947179b.png)![intelligent-after](https://user-images.githubusercontent.com/13679322/133606313-09e829e2-11de-4197-bf1d-bfcc2e4add15.png)
![quick-before](https://user-images.githubusercontent.com/13679322/133606358-3e1f4e15-4551-4138-9856-49535506c532.png)![quick-after](https://user-images.githubusercontent.com/13679322/133606366-13a66602-1a8d-4370-87ff-e01b54adcee4.png)
![resilient-before](https://user-images.githubusercontent.com/13679322/133606383-e86ff137-d342-4028-921d-0d1c113e304d.png)![resilient-after](https://user-images.githubusercontent.com/13679322/133606387-8e18cbd9-bd14-4ae5-a437-21e408de9913.png)
![strong-before](https://user-images.githubusercontent.com/13679322/133606404-e24799cd-b1de-4f33-8330-8ea9ac76d98a.png)![strong-after](https://user-images.githubusercontent.com/13679322/133606407-9f9a02bb-bc6f-4ac2-9a5a-c573e01445d7.png)
![tod-before](https://user-images.githubusercontent.com/13679322/133606461-aa5fc06a-3e01-4c82-af9c-61db1e0a2e7c.png)![tod-after](https://user-images.githubusercontent.com/13679322/133606488-f1c5fedf-f019-4ef8-8f0c-f63706eb3a89.png)
"
735258959,Add the Skeleton Rider line and Death Squire to core,Asheviere,2021-09-16 08:40:43+00:00,2022-07-01 03:34:17+00:00,"{'Campaign (any)': 1, 'Graphics': 1, 'Units': 1}",as discussed with @nemaara 
734687582,fix possible bug in attack prediction windows,newfrenchy83,2021-09-15 15:38:07+00:00,2021-09-20 18:08:17+00:00,{'Units': 1},"if an weapon like abilitie with apply_to=opponent is used, then name appear in attack"
734687031,fix possible bug in attack prediction windows(116),newfrenchy83,2021-09-15 15:37:25+00:00,2021-09-20 18:08:15+00:00,{'Units': 1},
734503304,UtBS: Remove leading whitespace from Ethereal Shadow's special note,stevecotton,2021-09-15 12:07:47+00:00,2021-09-15 18:03:16+00:00,"{'Campaign (any)': 1, 'Translations': 1, 'Units': 1}","The Ethereal Nightgaunt's equivalent note was already fixed in f94d0bb80a425b02873f13e67ea856151a05ae6f.

Fixes #4480."
734241231,Apostrophe review,Wedge009,2021-09-15 05:52:14+00:00,2021-09-15 06:26:56+00:00,"{'Campaign (any)': 1, 'Units': 1, 'Prose': 1}","Replace 'straight' apostrophes with 'curly' or 'typesetter' apostrophes or quotes as per https://wiki.wesnoth.org/Typography_Style_Guide

Prompted by the first point in #4145, but I reviewed all campaigns not just Eastern Invasion. This is something that's easy to miss so it makes sense that it needs to be reviewed periodically. Unfortunately there will be the same impact to translation work as #6067.

I believe I was pretty thorough so unless there were omissions or other mistakes, I don't anticipate needing to make any further commits to this in the short-term."
734119851,Specify a non-zero value for nplayers.,Pentarctagon,2021-09-15 00:16:02+00:00,2021-09-17 03:47:15+00:00,{'Campaign (any)': 1},"Fixes #6077

---

While no errors/warnings are present anymore, changing the number of players does print to the terminal for some reason.  For example, changing from 1 player to 3 players printed:
```
1	1
2	1
3	1
```"
733399236,Add leader label to MP Staging/Join screens,Wedge009,2021-09-14 07:32:14+00:00,2021-09-25 23:09:08+00:00,"{'Backport': 1, 'MP Lobby': 1, 'UI': 1}","I'm not very familiar with the GUI code, but I'm just trying to help with #2405."
732721486,Remove scaling by zoom_factor in unit height adjustment calculation,Wedge009,2021-09-13 12:59:25+00:00,2021-09-25 23:30:12+00:00,"{'Backport': 1, 'Graphics': 1, 'Units': 1}","Resolves #5974... I think.

It appears double `zoom_factor` scaling results in units being drawn way off their actual hex at high zoom, for tiles with a large (~20 pixels) unit height offset parameter, for example on certain keeps and bridges.

I'm not super-confident this is the 'right' way to resolve the issue, but empirical testing does suggest removing at least one of the `zoom_factor` scalings produces the desired result."
732593005,Link side-bar unit defence rating to unit's Help page,Wedge009,2021-09-13 10:14:13+00:00,2021-09-20 01:43:27+00:00,"{'Backport': 1, 'Units': 1, 'Help': 1}",Partially resolves #1297 - I'm not sure if there's a way to auto-scroll to the Defence figures in the unit's Help page.
732271027,1.16 - terrain graphics variations and transitions,doofus-01,2021-09-12 23:14:30+00:00,2021-09-26 00:04:43+00:00,"{'Graphics': 1, 'Terrain': 1}","
![tents_001](https://user-images.githubusercontent.com/13510196/133006631-dfa976bb-ac46-46b5-bd30-0977efb7dceb.jpg)
- camp/tent village variations
- Great Dead Tree variations"
732070407,1.16 sprint - naga stuff,doofus-01,2021-09-12 03:25:59+00:00,2021-09-12 19:15:06+00:00,"{'Graphics': 1, 'Units': 1}","- various small fixups
- Zephyr defense animation"
731970340,Replace steadfast with resistance abilities special for Garak,newfrenchy83,2021-09-11 18:13:25+00:00,2021-09-17 21:29:00+00:00,"{'Backport': 1, 'Campaign (any)': 1, 'Units': 1}",if Garak have 0% or -10% resistance only then steadfeast don't usable here. Fix https://github.com/wesnoth/wesnoth/issues/6046
731970284,replace ability steadfeast by resistance ability for Garak in Utbs(1.16),newfrenchy83,2021-09-11 18:12:54+00:00,2021-09-11 18:23:23+00:00,{'Campaign (any)': 1},fix steadfeast don't work for Garack. Fix https://github.com/wesnoth/wesnoth/issues/6046
731924142,Rename kick attack for horses and wyverns,Wedge009,2021-09-11 12:16:09+00:00,2021-11-10 00:25:39+00:00,{'Units': 1},Makes attack name consistent with other weapon attacks and also avoids translation issues (resolves #6071).
729625468,Ignore auto-generated Steam file in save directory,Wedge009,2021-09-08 13:01:16+00:00,2021-09-15 16:29:14+00:00,"{'Backport': 1, 'UI': 1}","I haven't seen anyone else remark about this, which surprises me. But the `steam_autocloud.vdf` file that constantly gets updated and shown in my game load dialogue bothers me enough to make this small change.

I don't know if it's worthwhile ignoring any file that doesn't follow `*.gz` or other expected file format, but that's beyond the scope of this PR. In such a case, we may as well follow what seems to be customary in regular application load dialogues and have a filter under or next to name field, with `*.gz` as the default filter.

I also don't know if this change is small enough to be allowed into 1.16 branch, hence the back-port reminder label.

PS Any attempt to load `steam_autocloud.vdf` results in an error message 'The file you have tried to load is corrupt', so I can't imagine a normal real-world case where anyone would want to leave this file visible in the load dialogue."
728636721,Revise capitalisation,Wedge009,2021-09-07 13:18:33+00:00,2021-09-22 08:15:01+00:00,"{'Campaign (any)': 1, 'Units': 1, 'Prose': 1}","Felt compelled to review capitalisation after noticing quite a bit of inconsistency, even within a single scenario, let alone across a campaign or different campaigns...

As per https://wiki.wesnoth.org/ProseStyle, race names are generally lower-case unless part of unit or place names, or a specific group (such as 'Quenoth Elves'):
* Elf/Elves/Elvish/Elven
* Drakes
* Dwarf/Dwarves/Dwarvish/Dwarven
* Goblins
* Gryphons
* Humans
* Mer/Merfolk
* Nagas
* Ogres
* Orcs
* Saurians
* Trolls
* Woses

I substitute 'human' for 'men' on occasion to make it clear it's a reference to the race, not males (non-humans sometimes say 'men' when speaking to fellow male soldiers, for example).

Capitalisation of titles is a little less straightforward. Clearly cases such as King Haldric, Queen Asheviere, Prince of Wesnoth, Great Chief, etc, are capitalised.
However, use of a title alone can be valid with or without capital, eg 'the king/King'. I try to be consistent and consider the context:
* Title is used in place of the name, eg compare 'by the King's order' with 'by Garard's order'
* Would the speaker show respect to the person concerned as their leader, or a foreign dignitary? Contrast, 'Asheviere, that vile queen'.
* Compare 'my king' with 'my father' (latter is not usually capitalised in everyday English)
* Occasionally, when the speaker may not otherwise know a character's name or the correct protocol to address, may say something like 'Sir Elf'.

I apologise if I run counter to previous revisions - removal of 'princess' as a direct address in Northern Rebirth, for example, also dealt with the capitalisation issue, if I recall correctly.

Miscellaneous changes:
* Magi, as plural of mage, is not usually capitalised.
* Council may be capitalised when referring to a specific instance, such as the Elvish High Council in the Ka'lian, but not in instances such as 'making council'.

The review focused solely on campaign prose - there may be cases in other data files where capitalisation needs revising too."
728233611,1.16 Chasm terrain graphics updates,doofus-01,2021-09-07 00:41:52+00:00,2021-09-07 04:23:58+00:00,"{'Graphics': 1, 'Terrain': 1}","Toned down the blue in waterfalls for swamp-chasm transition - fixes #1616 (the waterfall part at least; like ln-zookeeper, I don't see what the OP problem is).

EDIT: Also cleaned up some less-than-stellar snow-chasm images."
728176326,2p_Aethermaw - fix sprit decorations above fog,doofus-01,2021-09-06 20:59:50+00:00,2021-09-06 23:21:17+00:00,{'MP': 1},"fixes #1406
I'm not sure if changing directories with ""../"" is allowed.
EDIT: looks like World Conquest does something similar, so I guess it's OK."
728001853,WC: Add a WC_ prefix to defines with generic names,stevecotton,2021-09-06 14:18:40+00:00,2021-09-06 17:53:18+00:00,{'Campaign (any)': 1},"Forward-port of #6063, will merge after CI passes.

Macros with very generic names such as ""STR_CASTLE"" were defined and not
undefined. This prefixes all of them to be WC_STR_CASTLE, etc.

Either fixes or reduces the severity of #6062.

(cherry picked from commit d3d21e59ee797cfe9eecd50aabae10a353547328)"
727909715,[1.16] WC: Add a WC_ prefix to defines with generic names,stevecotton,2021-09-06 12:15:43+00:00,2021-09-06 14:13:48+00:00,"{'Bug': 1, 'Campaign (any)': 1}","Macros with very generic names such as ""STR_CASTLE"" were defined and not
undefined. This prefixes all of them to be WC_STR_CASTLE, etc.

Either fixes or reduces the severity of #6062, going to treat this as fixing it."
727543236,Rephrase #6060,Wedge009,2021-09-06 02:45:19+00:00,2021-09-06 04:36:30+00:00,"{'Campaign (any)': 1, 'Prose': 1}",As per suggestion from @CelticMinstrel
727335141,Avoid contemporary phrasing,Wedge009,2021-09-05 04:17:49+00:00,2021-09-05 08:30:24+00:00,"{'Campaign (any)': 1, 'Prose': 1}","Introduced in #5382, discussion seems to agree that we should avoid this."
724358477,"Fix an off-by-one in mapgen's x and y filters, and add unit tests",stevecotton,2021-09-01 10:38:01+00:00,2021-09-01 13:48:33+00:00,"{'Bug': 1, 'Unit Tests': 1, 'Lua API': 1, 'Fwdport': 1}","Forward-port of 6055, fixes #5108 and closes #6051 (the question of how to test the mapgen filter).

(cherry picked from commit 30f50bac681fda1566f5cee5aad7be6b65cb0fdb)"
723795978,update NR difficulty,cooljeanius,2021-08-31 21:47:31+00:00,,"{'Postponed': 1, 'Ready for testing': 1, 'Campaign NR': 1}","NR is notoriously difficult and annoying, so this PR attempts to soften it a little bit on the easier difficulties (not on HARD, though). These changes were originally made during my 1.14 playthru of NR, and haven't been tested on 1.15/1.16/1.17 yet, although I'm really dreading having to test them again... I'm leaving this marked as a draft because there are rejects files for map files that I haven't managed to wiggle back in yet, because this should really wait for until after ~~1.16~~ ***1.18*** is released, and because I still need to do another pass at editing/testing. "
722046542,Naga Sicarius sprite,doofus-01,2021-08-30 00:16:19+00:00,2021-09-06 18:27:19+00:00,"{'Graphics': 1, 'Units': 1}","This one was still ambiguous, not a great look for the 1.16 release.  Hopefully it is OK to change the weapon name string for 1.16.1."
721991815,"[1.16] Fix an off-by-one in mapgen's x and y filters, and add unit tests",stevecotton,2021-08-29 17:41:11+00:00,2021-08-31 23:21:06+00:00,"{'Ready for testing': 1, 'Unit Tests': 1, 'Lua API': 1}","Fixes the currently suspected root cause of #5108, but requires further testing
to confirm that it fixes that issue.

Closes #6501 (the question of how to test the mapgen filter).

Opening the 1.16 PR first, will forward-port afterwards.
Ping @knyghtmare"
721989398,sprites update,doofus-01,2021-08-29 17:24:11+00:00,2021-08-29 17:24:54+00:00,"{'macOS': 1, 'AI': 1, 'Campaign (any)': 1, 'Docs': 1, 'Graphics': 1, 'MP': 1, 'Translations': 1, 'Unit Tests': 1, 'UI': 1, 'WML Tools': 1, 'Editor': 1, 'Units': 1, 'Lua API': 1, 'Add-ons': 1, 'Building': 1, 'WFL': 1, 'Packaging': 1, 'Help': 1, 'CMake': 1, 'Schema': 1, 'Terrain': 1}","for now, just updating/finalizing the naga sicarius"
721985194,[world conquest] [1.16] [lua] Check for wc2_scenario value before executing wc2_start_units function ,knyghtmare,2021-08-29 16:56:41+00:00,2021-08-31 15:36:26+00:00,{'Campaign (any)': 1},"What this does is just checks the value of wc2_scenario before executing the function, and executes it for the first scenario only as intended.
Same as #6052, Fixes #5900 for 1.16"
721984564,[world conquest] [master] [lua] Check for wc2_scenario value before executing wc2_start_units function,knyghtmare,2021-08-29 16:52:17+00:00,2021-08-31 15:36:20+00:00,{'Campaign (any)': 1},"What this does is just checks the value of wc2_scenario before executing the function, and executes it for the first scenario only as intended.

Fixes #5900 "
721776297,lower isolated pine trees within image,doofus-01,2021-08-28 12:11:57+00:00,2021-08-29 01:40:47+00:00,"{'Graphics': 1, 'Terrain': 1}",addresses #1153 (and #3600) in a simpler way than introducing new layers
720307974,UtBS S02: Don't move Nym if she's already adjacent to the bottle,stevecotton,2021-08-26 08:44:55+00:00,2021-08-26 12:21:13+00:00,"{'Bug': 1, 'Campaign (any)': 1}","Forward-port of #6048, just doing a CI check before merging. Fixes #6044.

(cherry picked from commit 8919c2e9482b6068db3f16b708628d7c5ba89ecd)"
720216410,[1.16] UtBS S02: Don't move Nym if she's already adjacent to the bottle,stevecotton,2021-08-26 06:19:40+00:00,2021-08-26 08:42:14+00:00,"{'Bug': 1, 'Campaign (any)': 1}",Fixes #6044
718044968,WC: End the campaign at the end of the final scenario,stevecotton,2021-08-23 17:59:17+00:00,2021-08-24 08:43:20+00:00,{'Campaign (any)': 1},"Fixes the campaign part of #5891.

(forward-port of #6039)"
717828339,WC: End the campaign at the end of the final scenario,stevecotton,2021-08-23 13:17:51+00:00,2021-08-23 17:52:16+00:00,"{'Bug': 1, 'Campaign (any)': 1}",Fixes the campaign part of #5891 (which is the main part of that bug).
713867428,Backports for CI,CelticMinstrel,2021-08-17 02:32:50+00:00,2021-08-17 17:56:23+00:00,"{'AI': 1, 'Lua API': 1, 'Schema': 1}",Commits from #6004 and #6029 that don't break feature freeze.
713404204,A few new AI features,CelticMinstrel,2021-08-16 12:43:51+00:00,2021-09-05 02:20:28+00:00,"{'AI': 1, 'Units': 1, 'Lua API': 1, 'Schema': 1}","Mostly AI stuff, partly related to the eventual removal of FormulaAI.

Without FormulaAI, there was no longer a way to set actions for a specific unit. This adds a new way to do that. It's essentially just syntax sugar but it should be useful sometimes.

Mostly not back-portable, but probably all the commits with ""fix"" in the message can be backported."
713251855,UtBS S09: Reveal the boss of the scenario at the end of part 1,stevecotton,2021-08-16 09:06:58+00:00,2021-08-17 13:32:27+00:00,"{'Campaign (any)': 1, 'Fwdport': 1}","Forward-port of #6024, fixes #5540. As it's a forward-port I'm just running the CI.

This foreshadows that the player will need to attack the north-west after
defeating the north-east enemy, which is a bit fairer to anyone playing this
scenario for the first time.

Removes a now-unused string (Darius' pre-sacrifice speech). There are no new
strings here, the others are just being moved around.

For clearing shroud, change to using radius= because clearing a circle looks
better than clearing a square.

There's no significance to whether the new plan is ""Plan B"" or ""Plan C"" - back
in Wesnoth 1.10 it seems to have been dependent on whether all the merfolk had
been rescued.

Fixes issue #5540 about Hekuba spawning on a water hex.

(cherry picked from commit 25163c06a258b2a9f4627a1345a83f52447165dd)"
713053833,naga sprite animations,doofus-01,2021-08-16 01:39:32+00:00,2021-08-23 00:50:51+00:00,"{'Graphics': 1, 'Units': 1}","Mostly just wanted to get this on the board, but it's looking like the ""jarid"" (javelin) attack for the Ophidian is going to be finalized.  I'll change it if LordBob comes up with something different in the next week, but otherwise, this is where Ophidian is headed.

EDIT: Jarid it is, for the ophidian at least.  I plan to change the level three to something else, but that's not for this PR."
713025526,Resolve #6019 - allied side not triggering failure condition when sighted (1.16),Wedge009,2021-08-16 00:11:01+00:00,2021-08-16 00:14:58+00:00,{'Campaign (any)': 1},Back-port #6025 to 1.16 branch.
713020834,Resolve #6019 - allied side not triggering failure condition when sighted,Wedge009,2021-08-15 23:39:55+00:00,2021-08-16 10:00:24+00:00,"{'Backport': 1, 'Campaign (any)': 1}","Issue #6019

Can be back-ported to 1.16 assuming corrections are still allowed at this time."
712933055,UtBS S09: Reveal the boss of the scenario at the end of part 1,stevecotton,2021-08-15 13:08:09+00:00,2021-08-16 09:04:08+00:00,{'Campaign (any)': 1},"Opening the PR on 1.16 as that's what I tested on, will cherry-pick to master afterwards.

This foreshadows that the player will need to attack the north-west after
defeating the north-east enemy, which is a bit fairer to anyone playing this
scenario for the first time.

Removes a now-unused string (Darius' pre-sacrifice speech). There are no new
strings here, the others are just being moved around.

For clearing shroud, change to using radius= because clearing a circle looks
better than clearing a square.

There's no significance to whether the new plan is ""Plan B"" or ""Plan C"" - back
in Wesnoth 1.10 it seems to have been dependent on whether all the merfolk had
been rescued.

Fixes issue #5540 about Hekuba spawning on a water hex."
712862633,MOUNTAINS_RESTRICTED ... snow-castle,doofus-01,2021-08-15 02:04:19+00:00,2021-08-15 05:42:24+00:00,"{'Graphics': 1, 'Terrain': 1}","Snow version of the small mountains for castles and chasms.  Fixes #6016

![Screenshot_20210814_snow-castles](https://user-images.githubusercontent.com/13510196/129464616-f40f57e6-f32d-4614-bba7-7b8114b83a32.jpg)
"
712681390,Format times in the add-on manager using utils::format_time_summary,stevecotton,2021-08-14 00:16:04+00:00,2021-11-10 08:14:43+00:00,"{'UI': 1, 'Add-ons': 1}","As it's a date, this needs to be a translatable string, and one that can be backported to 1.16 (so using a string that's already in 1.16). Possible choices for doing that are:
* using the utils::format_time_summary() function
* using one of the strings already used by the utils::format_time_summary() function
* using the strings from src/save_index.cpp's save_info::format_time_local()

DRAFT: The layout is broken in a way that causes these dates to often get ellipsed. That isn't a new issue introduced by the main (second) commit here, it's already an issue in 873946142fe73f4bf01d758e5cc4ad54182503a1 which will be addressed by @Vultraz's layout changes."
710045927,Add doxygen docs to wesnothd's game.hpp.,Pentarctagon,2021-08-12 02:51:46+00:00,2021-09-08 18:18:16+00:00,{'MP': 1},Also removed some methods/parameters that are not used.
709007000,[world conquest] World Conquest Era is only available for the campaign,knyghtmare,2021-08-11 14:06:49+00:00,2021-08-17 04:04:20+00:00,{'Campaign (any)': 1},"Until a proper solution is found for #5228 , this will have to do. It suppresses the appearance of the era in the era selection list for other scenarios, preventing the bug from happening.
Hmm, I guess the [campaign] tag should support the `allow_era=` key in future but for the moment, this will do.

Players can play WC with Default, Default+Dunefolk, Age of Heroes, AOH+Dunefolk and UMC eras for the time being. "
708971663,[world conquest] [master/1.17] Replacement of khalifate unit types with dunefolk unit types,knyghtmare,2021-08-11 13:45:31+00:00,2021-08-17 22:19:39+00:00,{'Campaign (any)': 1},"```
Arif -> Dune Soldier

Hakim -> Dune Herbalist
Jundi -> Dune Rover

Khaiyal -> Dune Piercer

Naffat -> Dune Burner

Rami -> Dune Rider
```

I have also substituted the ""Dune Piercer"" with ""Dune Rider"", since it's a non-existent unit in 1.16 and master."
706083613,[1.16] Allow the campaign selection to be bigger on HDPI screens,stevecotton,2021-08-08 18:04:21+00:00,2021-08-09 04:36:47+00:00,{'UI': 1},"This doesn't scale the campaign image (and the campaign images are generally
350x350 images anyway), so it looks a bit wrong, but it's a lot more useable
on HDPI than putting a 1050x750 limit on a treeview with a text panel.

(cherry picked from commit 62a8bad97c89c08f0b96d5f1728e60b3bee7ec34)"
705977269,August 8th animations,doofus-01,2021-08-08 03:31:55+00:00,2021-08-09 03:32:05+00:00,"{'Graphics': 1, 'Units': 1}","- try to fix dirkfang chakri sound (#6000)
- ringcaster defense anim
- ringcaster melee attack anim
- ringcaster ranged attack anim"
705898518,Add a new months tip to the main menu,kabachuha,2021-08-07 14:21:41+00:00,2022-06-27 18:22:52+00:00,"{'Prose': 1, 'Help': 1}","As quite a few players complained, the new months system in Liberty is pretty confusing. To lessen it a tiny bit I'm proposing to add a some sort of prose explanation to the list of random main menu tips. Both the months naming and the Liberty rework is @nemaara 's territory, so i'd be glad to hear any changes or a rewrite of this note.

Currently, it is a small teaching by Baldras to younger Harper:


_It starts with shiny Whitefire then darkens into Bleeding Moon. Scatterseed and Deeproot is when we care of our future food. The weeded growth in Scryer’s Bloom and Thorntress will thrive in Summit Star. In Kindlefire chills come amid the warmth. We harvest what the land gave us when leaves go red in Stillseed, under Reaper’s Moon and hope we'd have enough to hold the cold of Verglas Bloom and lift the darkness of Blackfire. And then, my son, the year starts all over._

_― Baldras, the magistrate of Dallben, 490 YW_

As for the length, it's few words longer than the longest tip, and shouldn't be a big problem.

If it passes, we can backport it to 1.16.1 when the string freeze ends."
701164013,[1.16] Tutorial S01: HDPI support,stevecotton,2021-08-02 06:25:04+00:00,2021-08-02 14:16:35+00:00,"{'Campaign (any)': 1, 'UI': 1}","Backport of #5996. All three files are identical to the master version, and I
tested on 1.16 prior to opening that PR, so intending to merge once the CI
check passes without further review.

Remove the maximum size for the character-select dialog, the window will
automatically choose the minimum size that fits the text.

Extend the map 1 hex south. This means that, if the full map fits on screen,
the horizontal center of the map (where the print statements appear) is between
the keep and the south village, thus their labels don't overlap the print
statements.

(cherry picked from commit 25052e967ea75471796aa3c00d92f86f809521b7)"
701119245,Stuff for CI,CelticMinstrel,2021-08-02 04:59:31+00:00,2021-08-16 03:48:18+00:00,"{'AI': 1, 'Lua API': 1, 'WFL': 1}",Mostly this is the fix for #4697 and some related fixes. I think all of this is backportable.
700911524,update codeblock projectfiles,newfrenchy83,2021-08-01 13:40:19+00:00,2021-08-01 15:05:33+00:00,{'Building': 1},
700749599,Missed some deprecated fungus on map edges.,Pentarctagon,2021-07-31 18:24:11+00:00,2021-07-31 23:45:54+00:00,{'MP': 1},
700652402,Update Dirkfang.cfg,MXB2001,2021-07-31 04:40:25+00:00,2021-08-09 03:34:37+00:00,{'Units': 1},Sound plays at -800 long before the missile anim begins and ends. I believe this should fix it to play at the correct time.
700614051,Backports for CI,CelticMinstrel,2021-07-30 23:34:27+00:00,2021-07-31 16:19:57+00:00,"{'AI': 1, 'Unit Tests': 1, 'UI': 1, 'Units': 1, 'Lua API': 1}","I _think_ all these commits are fine under feature-freeze, but a quick confirmation would be nice."
700593437,Have add-ons with no min version specified require the latest version.,Pentarctagon,2021-07-30 22:26:37+00:00,2021-08-02 21:01:47+00:00,{'Add-ons': 1},Fixes #5004
700483042,Allow the campaign selection to be bigger on HDPI screens,stevecotton,2021-07-30 18:15:09+00:00,2021-08-08 17:59:42+00:00,{'UI': 1},"This doesn't scale the campaign image (and the campaign images are generally
350x350 images anyway), so it looks a bit wrong, but it's a lot more useable
on HDPI than putting a 1050x750 limit on a treeview with a text panel.

Without this change:
![hdpi_old_campaign_selection](https://user-images.githubusercontent.com/101462/127694966-e4dc0aac-6d86-43a8-9c36-12df5451ba4f.jpg)

With this change:
![hdpi_new_campaign_selection_thot](https://user-images.githubusercontent.com/101462/127694962-2e1e4150-d89f-4809-820c-b67a11dc4ff0.jpg)
![hdpi_new_campaign_selection_tutorial](https://user-images.githubusercontent.com/101462/127694965-caf4ebec-78f1-40f7-aafb-7e5573441e36.jpg)
"
700439100,Tutorial S01: HDPI support,stevecotton,2021-07-30 16:47:09+00:00,2021-08-02 06:16:35+00:00,"{'Campaign (any)': 1, 'UI': 1}","Remove the maximum size for the character-select dialog, the window will
automatically choose the minimum size that fits the text.

Extend the map 1 hex south. This means that, if the full map fits on screen,
the horizontal center of the map (where the print statements appear) is between
the keep and the south village, thus their labels don't overlap the print
statements.

This backports cleanly (and has been tested on 1.16), it fixes 2 of the points in #5544.

Placement of `[print]` on HDPI:
![image](https://user-images.githubusercontent.com/101462/127685100-9a250999-cc45-47be-82ab-a7bafc8fa30f.png)

The character selection still looks good in a minimum-sized window:
![image](https://user-images.githubusercontent.com/101462/127684999-26ced045-836a-4830-ab21-d46c949e5318.png)"
699074000,[1.16] Tutorial S01 and SotA: Synchronise calls to gui.show_dialog,stevecotton,2021-07-28 23:17:32+00:00,2021-07-30 04:40:42+00:00,"{'Bug': 1, 'Campaign (any)': 1}","Backport of #5994. Fixes #5334, fixes #5926.

Cherry-picked cleanly, and (aside from whitespace differences) already tested on 1.16 before opening the PR for master."
698511434,Tutorial S01 and SotA: Synchronise calls to gui.show_dialog,stevecotton,2021-07-28 09:17:49+00:00,2021-07-28 23:12:14+00:00,"{'Bug': 1, 'Campaign (any)': 1}","Two related bugfixes, put into one PR because, if we find things to change on one, there may be things to change on the other one too. Both will backport cleanly and are already tested on the 1.16 branch.

Tutorial S01: Synchronise the choice of character
---

This avoids showing the dialog during replays, and thus avoids an
OOS if the person watching the replay chooses the other character.

Fixes (on master) #5926.

SotA: Synchronise the zombie recruitment dialog
---
    
This dialog works by setting variables in the postshow function,
so the code had to be moved around to ensure that those variables
were synchronised, not just the return value of the dialog.
    
The message about not having enough gold isn't necessary for the
replay, so that gets moved into the synchronised code too.

Fixes (on master) #5334."
698272333,Miscellaneous stuff for CI,CelticMinstrel,2021-07-28 00:31:46+00:00,2021-07-30 23:22:57+00:00,"{'AI': 1, 'Campaign (any)': 1, 'Unit Tests': 1, 'UI': 1, 'Units': 1, 'Lua API': 1, 'WFL': 1}","Mostly this contains my shroud fixes and FormulaAI deprecation messages, plus some little things that randomly occurred to me or things that popped up while I was writing inline documentation for the entire Lua library.
"
697554003,Re-add attribution to copyright notices.,Pentarctagon,2021-07-27 05:45:27+00:00,2021-07-28 01:20:34+00:00,"{'AI': 1, 'MP': 1, 'UI': 1, 'Editor': 1, 'Units': 1, 'Lua API': 1, 'Add-ons': 1, 'WFL': 1, 'Help': 1, 'Schema': 1, 'Terrain': 1}","These are mostly useless and outdated/wrong, but apparently it's probably illegal to remove them."
697509770,"Apply ""replay old saves"" patch to the 1.14 branch",cooljeanius,2021-07-27 03:50:03+00:00,2021-08-23 01:28:12+00:00,{},"This applies the patch from this forums thread to 1.14: https://forums.wesnoth.org/viewtopic.php?f=10&t=53824&start=15
Note that I realize that 1.14 is closed, and that there won't actually be any further changes to it, but I just wanted to get this open so we can see what a successful application of the patch looks like, so that we can then use that for getting it rebased upon a more up-to-date branch next. Hence, I am marking this as a draft.
"
697241462,Add a script to automatically update the copyright notice in source files.,Pentarctagon,2021-07-26 18:07:33+00:00,2021-07-29 16:42:51+00:00,{},
696888125,Resolve title-screen vs main menu inconsistency,Wedge009,2021-07-26 10:13:57+00:00,2021-11-10 00:20:33+00:00,{'UI': 1},"Discussed in #4390 and originally introduced in 7c8c3114.

I suppose can back-port to 1.16 when there's no string freeze."
696627575,Copyright update.,Pentarctagon,2021-07-26 02:13:08+00:00,2021-07-26 16:35:07+00:00,"{'macOS': 1, 'AI': 1, 'MP': 1, 'UI': 1, 'Editor': 1, 'Units': 1, 'Lua API': 1, 'Add-ons': 1, 'WFL': 1, 'Help': 1, 'Schema': 1, 'Terrain': 1}","This additionally:
* Makes all copyright notices identical aside from the starting year for Wesnoth-specific source files. Files not included: mariadbpp, lua, spirit po, xbrz, and bcrypt (crypt_blowfish).
* Removes all attribution from the files, since the vast majority of them are outdated or seemingly just outright incorrect. For example, I would guess that Dave is no longer the sole author of the majority of Wesnoth's current code."
696562356,"TRoW S04a: Typographic style is not to have a hyphen in ""un-life""",stevecotton,2021-07-25 20:50:02+00:00,2021-07-26 06:45:34+00:00,"{'Campaign (any)': 1, 'Prose': 1}","For consistency, there should also be no hyphen in ""un-death"".
The style was decided in PR #5525."
696514300,"IoM: Add translation hint about the ""Healing Keep""",stevecotton,2021-07-25 14:50:11+00:00,2021-09-15 13:13:17+00:00,"{'MP': 1, 'Translations': 1}","@knyghtmare I think this is needed because we're translating the role of that hex, rather than a terrain that acts like both a keep and an oasis."
696432983,1.16 animation update 7/24,doofus-01,2021-07-25 02:42:50+00:00,2021-07-26 01:58:41+00:00,"{'Graphics': 1, 'Units': 1}","Looks like it is just Nagas:

1. Cleanup of Naga Guard base frame and animation timings
2. Cleanup of Naga Shield Guard base frame and addition of 'shield' attack/defend anim
3. Defense animation for Naga High Guard"
696330171,Remove a leading space from the Silver Mage's [special_note],stevecotton,2021-07-24 10:30:24+00:00,2021-08-16 09:02:24+00:00,"{'Translations': 1, 'Units': 1}","The strings in special-notes.cfg don't have a leading space,
and this one causes a warning in poedit."
693103468,Tutorial S01: Don't let the first Quintain attack on turn 2,stevecotton,2021-07-20 04:22:59+00:00,2021-07-20 07:11:38+00:00,"{'Campaign (any)': 1, 'Fwdport': 1}","(cherry picked from commit b02b1ad2ff31d2e56828729cc9d2a952453b8761, so I'm just going to do a CI run and merge)

A player can follow Dacyn's instructions to the letter, yet get
killed if they choose a village 2 hexes away from the Quintain on
turn 2.

There are better suggestions about handling this in
https://r.wesnoth.org/t54644 , however during the string-freeze
let's simply make the Quintain stay on its starting spot on turn 1.

Add a CLEAR_PRINT because the player has just completed the
""End your turn"" instruction."
692341551,"[1.16] Title screen: move ""change language"" back to the text-button area",stevecotton,2021-07-19 07:17:59+00:00,2021-07-23 10:45:28+00:00,{'UI': 1},"Okay for the string-freeze - the necessary string was re-added in fc50458b.

No forward-port required, as master will have a full title screen redesign in
issue #4531. This commit is reverting acc96b16, which is a part of #4531,
because the redesign has paused at a place that causes problems with large
screens - the button added in acc96b16 moves further from the center of the
screen as the screen size increases, and it doesn't scale with screen size. On
an 800x600 window it's easily noticeable, but on 2560x1440 it's less obvious
than either Dan Tonk or Weldyn."
692109634,[1.16] Tutorial S01: Don't let the first Quintain attack on turn 2,stevecotton,2021-07-18 15:49:12+00:00,2021-07-20 04:15:36+00:00,{'Campaign (any)': 1},"A player can follow Dacyn's instructions to the letter, yet get
killed if they choose a village 2 hexes away from the Quintain on
turn 2.

There are better suggestions about handling this in
https://r.wesnoth.org/t54644 , however during the string-freeze
let's simply make the Quintain stay on its starting spot on turn 1.

Add a CLEAR_PRINT because the player has just completed the
""End your turn"" instruction.

Given the release timing, I'm opening this as a 1.16 PR, intending
to cherry-pick to master afterwards."
692076446,update codeblock for 1.16,newfrenchy83,2021-07-18 11:50:12+00:00,2021-07-18 16:49:07+00:00,{'Building': 1},
692074238,update codeblock projectfiles,newfrenchy83,2021-07-18 11:33:14+00:00,2021-07-18 16:48:58+00:00,{'Building': 1},
692028311,Prevents logging of duplicate deprecation messages and messages missing timestamps.,Pentarctagon,2021-07-18 04:40:42+00:00,2021-07-24 23:50:43+00:00,"{'AI': 1, 'UI': 1, 'Units': 1, 'Lua API': 1, 'Terrain': 1}","Fixes #5942

---

With the code:
```
[event]
    name=start

    [lua]
        code=<<wesnoth.alert(""hi"")>>
    [/lua]
[/event]
```
currently it logs:
```
20210717 23:25:58 info deprecation: wesnoth.alert has been deprecated indefinitely.;  (Note: You should use gui.alert instead in new code)
Invalid WML found: wesnoth.alert has been deprecated indefinitely.;  (Note: You should use gui.alert instead in new code)
```
after this PR it will log:
`20210717 23:29:42 error wml: Invalid WML found: wesnoth.alert has been deprecated indefinitely.;  (Note: You should use gui.alert instead in new code)`"
692014310,1.16 - Troll defense animations,doofus-01,2021-07-18 01:39:38+00:00,2021-07-19 03:48:35+00:00,"{'Graphics': 1, 'Units': 1}","Some of the trolls have really lazy defense animations, must have been placeholders.
(Not criticizing the previous Art Director, there's too much to keep track of for one person...)
"
690145739,[world conquest] [master/1.17] update to new mushroom terrain from the deprecated mushroom terrain,knyghtmare,2021-07-14 18:51:53+00:00,2021-08-11 18:08:39+00:00,{'Campaign (any)': 1},"same as #5960, addresses #5135 for the master branch."
690134816,[world conquest] [1.16] update to new mushroom terrain from the deprecated mushroom terrain,knyghtmare,2021-07-14 18:32:54+00:00,2021-08-11 18:11:09+00:00,{'Campaign (any)': 1},"addresses #5135 for the 1.16 branch
I shall do the one for master branch later on."
689939105,"[world conquest] [master/1.17] add credits, campaign icon(s) and image.",knyghtmare,2021-07-14 13:58:00+00:00,2021-07-31 17:15:52+00:00,{'Campaign (any)': 1},"Same as PR #5958 but for master branch

![Screenshot 2021-07-12 033809](https://user-images.githubusercontent.com/5283677/125634611-aa384c39-7ef4-4712-9c99-a5fdc63605e4.png)
"
689917810,"[world conquest] add campaign icons, campaign image and credits",knyghtmare,2021-07-14 13:31:00+00:00,2021-07-31 17:16:25+00:00,{'Campaign (any)': 1},"This PR addresses #5113 and #5112 for the 1.16 branch. I shall make a master branch PR of this later on. 

The credits can be left untranslated as of right now, since the priority is returning world conquest to be playable from start to finish.

![Screenshot 2021-07-12 033809](https://user-images.githubusercontent.com/5283677/125629999-72960761-1d5c-4d99-b5c8-108d0fb612ee.png)


"
689306427,Use the built-in difficulty selection for World Conquest,CelticMinstrel,2021-07-13 18:27:30+00:00,2021-07-13 23:42:56+00:00,"{'Campaign (any)': 1, 'Schema': 1}","1.16 version of #5882, plus backporting some other WC cleanup that it depended on."
688461425,Stuff for CI,CelticMinstrel,2021-07-13 05:23:55+00:00,2021-07-13 18:10:08+00:00,"{'Units': 1, 'Lua API': 1}","Forward-ports of the last batch, another random fix I stumbled across, and some small new features. I'll probably merge once CI passes."
687733730, add the names of the abilities used as weapons in the attack prediction window(UI) for 1.16,newfrenchy83,2021-07-12 10:58:47+00:00,2021-07-22 14:07:22+00:00,{'Units': 1},"same what https://github.com/wesnoth/wesnoth/pull/5864 but for 1.16. Like it is already 1.16 string, it is few chance what this PR was commited, but like to complete abilities used like weapon with UI, i hope."
687405781,PR on World Conquest patches,knyghtmare,2021-07-11 22:48:12+00:00,2021-08-17 13:12:10+00:00,"{'macOS': 1, 'AI': 1, 'Campaign (any)': 1, 'Docs': 1, 'Graphics': 1, 'MP': 1, 'Translations': 1, 'Unit Tests': 1, 'UI': 1, 'WML Tools': 1, 'Units': 1, 'Lua API': 1, 'Add-ons': 1, 'Building': 1, 'Packaging': 1, 'CMake': 1}","This is a very WIP on World Conquest bug fixes. Sort of depends on 5882.
I am going to get merge conflicts so opening this as draft PR as I can resolve them when they pop up as time passes.

- [ ] add placeholder textdomains from other mainline campaigns
- [ ] resolve merge conflicts
- [ ] adjust icons if better suggestions are offered/given.
- [x] update deprecated mushroom terrain in code
- [x] replace khalifate references with dunefolk
- [x] add icon and image for campaign


![Screenshot 2021-07-12 033809](https://user-images.githubusercontent.com/5283677/125211875-6f641300-e2cb-11eb-8a27-42090fbb924f.png)
"
687261280,Miscellaneous bug / deprecation fixes for CI,CelticMinstrel,2021-07-11 01:51:52+00:00,2021-07-11 18:03:07+00:00,"{'Units': 1, 'Lua API': 1}",
687223656,"Update dune explorer image path, closes #5945",ProditorMagnus,2021-07-10 18:49:31+00:00,2021-07-12 21:41:53+00:00,{'WML Tools': 1},
686441357,Fix custom synced commands not changing the AI game state,mattsc,2021-07-09 02:25:24+00:00,2021-07-10 02:37:33+00:00,"{'Backport': 1, 'AI': 1}","The old `ai.synced_command` function always set the AI-context game state to changed when executing such a command. This was inadvertently omitted when the implementation was changed to `invoke_synced_command` in fef953a4. While custom synced commands may or may not change the game state and the engine has no means of determining this correctly in all cases (meaning that neither behavior is technically wrong), the fact that the behavior was changed should be considered a bug. This commit changes it back to how it was before fef953a4.

There are a variety of places where setting the game state to changed could be added in the code. I chose this one, as it is analogous to what is done for the `replace_map` function [later in the same file](https://github.com/wesnoth/wesnoth/blob/master/src/game_events/action_wml.cpp#L646).

As I consider this a bug fix, I believe this should be backported to both 1.16 and 1.14."
685590960,Backports,CelticMinstrel,2021-07-08 00:17:09+00:00,2021-07-08 17:33:05+00:00,{'Lua API': 1},
685055086,TEST FAILS: Add a unit test that [select_unit]fire_event=yes works,stevecotton,2021-07-07 10:10:53+00:00,2021-07-07 12:57:41+00:00,"{'Bug': 1, ""Won't fix"": 1, 'Unit Tests': 1, 'WML': 1, 'Lua API': 1}","@CelticMinstrel following on from #5927, I looked at testing `[select_unit]fire_event` or `unit:select(true, true)`. This version of the test is written in WML so that it can be run on 1.14 too.

It doesn't appear to work, nor did it work on 1.14.

Running the test interactively doesn't make it work either.

Running the test interactively and manually clicking on Alice with the mouse
does fire the event."
684802682,[1.16] Make failure loading textdomains non-fatal,stevecotton,2021-07-07 02:11:36+00:00,2021-07-07 09:25:29+00:00,"{'Bug': 1, 'Translations': 1}","Prior to this, if any .po file included a \v (vertical tab), then the game
exited before reaching the title screen. It didn't have to be in a mainline
translation - any add-on could break the game, and would do so before the title
screen appeared, thus preventing the user from using the add-on manager or
language selection to avoid the problem.

Instead, treat a parsing error similarly to the .po file simply not existing.
Fixes #5923.

(cherry picked from commit 23a0377b56d5455c08a741d1457a5cb92fd39091)"
684759107,[1.16] Add a unit test for wesnoth.current.synced_state,stevecotton,2021-07-07 00:15:25+00:00,2021-07-07 02:41:56+00:00,{'Unit Tests': 1},"The edge-case of calling evaluate_single within an unsynced event was
surprising, and I'm not sure it's correct. However, as we're about to
release the 1.16 branch I think it's better to include that as a test
that the API doesn't change during the stable branch.

(cherry picked from commit f9fc806fd2955a5f9ac31803d429192c5fcfd478)"
684734188,Make failure loading textdomains non-fatal,stevecotton,2021-07-06 23:07:05+00:00,2021-07-07 02:07:18+00:00,"{'Bug': 1, 'Translations': 1}","Prior to this, if any .po file included a \v (vertical tab), then the game
exited before reaching the title screen. It didn't have to be in a mainline
translation - any add-on could break the game, and would do so before the title
screen appeared, thus preventing the user from using the add-on manager or
language selection to avoid the problem.

Instead, treat a parsing error similarly to the .po file simply not existing.
Fixes #5923."
684072642,Miscellanous stuff for CI,CelticMinstrel,2021-07-06 05:34:23+00:00,2021-07-07 05:32:06+00:00,"{'AI': 1, 'Campaign (any)': 1, 'Unit Tests': 1, 'Lua API': 1}",I'll merge this as soon as CI passes.
683605951,Add a unit test for wesnoth.current.synced_state,stevecotton,2021-07-05 11:09:30+00:00,2021-07-07 00:09:50+00:00,"{'Unit Tests': 1, 'Lua API': 1}","Note that this file gets formattedly badly by wmlindent, however it seems that wmlindent already skips the `data/test/scenarios` directory, the same issue affects `data/test/scenarios/recruit_facing.cfg`. Still working out if that is #1397 or if it should be a separate bug; I think it's a bug that needs fixing in wmlindent for 1.16, as it seems to break on any use of wesnoth.sync.evaluate_single in a `.cfg` file."
683186966,[1.16] Say what the error is when a broken .po file stops Wesnoth starting,stevecotton,2021-07-04 14:50:10+00:00,2021-07-04 20:55:36+00:00,{'Bug': 1},"Bug #5923 is that a broken .po file can make Wesnoth fail to start, not
even reaching the title screen. Additionally, the error message printed
to the console just said ""*timestamp* error general:"", and then missed
the details of what had broken.

This commit fixes the error message to show which add-on and which line
are causing the problem.

(cherry picked from commit eaa39d653bc067d48449852cb480dff1c69b22ac)"
683168767,Say what the error is when a broken .po file stops Wesnoth starting,stevecotton,2021-07-04 12:46:05+00:00,2021-07-04 14:45:43+00:00,{'Bug': 1},"Bug #5923 is that a broken .po file can make Wesnoth fail to start, not
even reaching the title screen. Additionally, the error message printed
to the console just said ""*timestamp* error general:"", and then missed
the details of what had broken.

This commit fixes the error message to show which add-on and which line
are causing the problem."
683132552,Fix untranslatable string in advancefrom deprecated message,fujimo-t,2021-07-04 07:59:17+00:00,2022-01-08 02:38:24+00:00,{'Translations': 1},"I noticed that second chunk is not marked to translatable while working 1.16 translation.

The target branch is set to master because I heard 1.16 is string freezed.
Is it possible to merge this also 1.16 and re-run pot update?"
683104200,Add a prompt to migrate data from previous versions of wesnoth.,Pentarctagon,2021-07-04 02:33:33+00:00,2021-07-16 01:06:56+00:00,"{'macOS': 1, 'UI': 1, 'Add-ons': 1, 'Building': 1}","Currently migrated, if existing:
* Add-ons (redownloaded if present on new add-ons server)
* Preferences file
* Credentials file

---

Re-PR of #5918 so it's on a mainline branch.

Note to self: make sure to review the comments there as well."
683104087,Add a prompt to migrate data from previous versions of wesnoth.,Pentarctagon,2021-07-04 02:31:32+00:00,2021-07-04 02:31:45+00:00,"{'UI': 1, 'Building': 1}","Currently migrated, if existing:
* Add-ons (redownloaded if present on new add-ons server)
* Preferences file
* Credentials file"
683063227,Add a prompt to migrate data from previous versions of wesnoth.,Pentarctagon,2021-07-03 18:44:18+00:00,2021-07-04 02:30:33+00:00,"{'UI': 1, 'Building': 1}","Currently migrated, if existing:
* Add-ons (redownloaded if present on new add-ons server)
* Preferences file
* Credentials file

---

Currently incompletely tested, but mostly seems to be working.  The current (I assume pretty terrible) prompt UI:
![Screenshot from 2021-07-03 13-42-52](https://user-images.githubusercontent.com/3030250/124364045-9d2ec500-dc04-11eb-8995-f3512c4ef816.png)

One thing I'm also unsure about is whether/how to have the prompt show up *after* the titlescreen is displayed rather than immediately before."
683022733,1.16 animation update,doofus-01,2021-07-03 13:13:36+00:00,2021-07-10 16:19:14+00:00,"{'Graphics': 1, 'Units': 1}",various animation updates for this weekend
682992775,Remove the 10ms delay before closing a window,stevecotton,2021-07-03 08:52:30+00:00,2021-07-07 09:25:43+00:00,{'UI': 1},"This delay is to stop the loop running continously, it isn't necessary to do
that when we're about to exit the loop anyway. I'm unsure whether this makes
any noticeable difference, but it seems reasonable to remove delays when
possible.

I'm tempted to change the enclosing loop to a `do ... while` instead of a `for`
that has an empty clause."
682547609,"Revert ""Updated a few places that didn't handle locations in the unified way""",stevecotton,2021-07-02 11:16:59+00:00,2021-07-03 08:48:28+00:00,"{'AI': 1, 'UI': 1, 'Lua API': 1}","While it might be a good idea, the code as committed fails the unit tests.
Reverting these changes also fixes the whitespace errors.

This reverts commit 5a9c24c4e79d624e34aa475949a4aa49b1984322."
680591053,Separate `import yaml` from other import statements in wmlunits,max-torch,2021-06-30 07:06:14+00:00,2021-06-30 16:18:58+00:00,{'WML Tools': 1},Make it clear that the `yaml` package is not part of Python's Standard Library and should be installed with a package manager as outlined in [this](https://pep8.org/#imports) section of PEP8.
680358392,Possible replacement for the depreciated AI_CONTROLLER,Adamant14,2021-06-29 20:59:15+00:00,2021-06-30 15:38:08+00:00,"{'Campaign (any)': 1, 'Docs': 1, 'Graphics': 1, 'MP': 1, 'Translations': 1, 'UI': 1, 'WML Tools': 1, 'Units': 1, 'Lua API': 1, 'Add-ons': 1, 'Building': 1, 'Packaging': 1, 'CMake': 1}","The deprecated AI Controller is removed from all mainline campaign scenarios without any replacement. Is that really a good idea? I think it's not. There was a good reason for creating and adding the AI_CONTROLLER.  If one plays scenarios in which you are dependent on AI-controlled allies, then it can be quite useful if you as a player have the opportunity to at least protect the AI side leader from suicidal actions. Otherwise there is often nothing left but to play the scenario again from the start, which is annoying. Especially when this can easily be avoided with the help of this simple and self-explanatory tool from Beetlenaut.
It is simple, and it is not as complicated, and as inscrutable for the simple gamer as the old AI controller. And this simplicity is what defines it. Most of the time it doesn't take more than that. Just three very simple commands:
1. DO NOT commit suicide!
2. Go here!
3. Do what ever you want!

I suggest not to remove the AI controller without a replacement, but replacing it with [Beetlenauts AI_Ally_Control](https://forums.wesnoth.org/viewtopic.php?f=8&t=54533).
"
679095765,Fix an intermittent crash with keyboard input during the load screen,stevecotton,2021-06-28 14:23:15+00:00,2021-06-28 14:25:30+00:00,"{'Bug': 1, 'Engine': 1}","Fixes #4447, and will be cherry-picked to the 1.16 branch too."
678980489,Fix whitespace from 16157e286bce,stevecotton,2021-06-28 11:59:16+00:00,2021-06-28 12:35:44+00:00,{'Lua API': 1},PR to run the CI before merging.
678679918,Jinn and horse graphics,doofus-01,2021-06-28 03:56:30+00:00,2021-07-17 12:36:52+00:00,"{'Campaign (any)': 1, 'Docs': 1, 'Graphics': 1, 'MP': 1, 'Translations': 1, 'UI': 1, 'WML Tools': 1, 'Units': 1, 'Lua API': 1, 'Add-ons': 1}",This is to add #5903 to master.
678679666,Add rc file to VS+cmake configuration.,Pentarctagon,2021-06-28 03:55:27+00:00,2021-06-28 14:10:23+00:00,"{'Building': 1, 'CMake': 1}","---

Testing123..."
678588101,various animations,doofus-01,2021-06-27 22:09:27+00:00,2021-06-28 03:52:21+00:00,"{'Graphics': 1, 'Units': 1}","whatever animations I get done today

- jinn attacks"
677315973,CI fixes,Pentarctagon,2021-06-24 17:51:39+00:00,2021-06-24 17:51:43+00:00,{},
676788643,Fix the issue with wesnoth.game_events.on_mouse_action,CelticMinstrel,2021-06-24 04:54:58+00:00,,{'Lua API': 1},"As described on the wiki, the action can trigger on the wrong hex if the mouse has moved during the callback.

In addition to directly fixing this, I've added a way for the callback itself to have some control over what happens, such as cancelling the action entirely ~or providing an alternate hex of its choosing~."
676346302,[IoM] [master] fixed non-existent textdomain in scenario file,knyghtmare,2021-06-23 14:31:49+00:00,2021-06-23 15:32:10+00:00,{'MP': 1},"Same as #5887 but for master branch.
"
676335484,[IoM] [1.16 branch] fixed non-existent textdomain in scenario file,knyghtmare,2021-06-23 14:19:08+00:00,2021-06-23 15:32:07+00:00,"{'Bug': 1, 'MP': 1, 'Translations': 1, 'Fwdport': 1}","Yeah, while reading the .pot file, I noticed these did not show up and saw this."
674517218,Use the built-in difficulty selection for World Conquest,CelticMinstrel,2021-06-21 12:40:04+00:00,2021-07-13 18:12:08+00:00,"{'Campaign (any)': 1, 'Lua API': 1}","Since there seems to be no way to put difficulty selection on a single scenario, this moves it to the MP campaigns section.

There are some kinks to work out with this still. I think possibly it may even end up collapsing the three WC scenarios into one? However, it seems to work at least on a basic level, so if anyone wants to try it out and point out anything that's broken that I missed…

Opened against master because this _does_ add one minor translatable string. For 1.16.0 we could probably just leave it untranslatable, since it's only a campaign abbreviation."
674119377,1.16 anims 20210620,doofus-01,2021-06-21 00:07:55+00:00,2021-06-21 00:51:16+00:00,"{'Graphics': 1, 'Units': 1}","same as #5880, but for master"
674116594,1.16 - some naga animations,doofus-01,2021-06-20 23:49:13+00:00,2021-06-21 00:05:15+00:00,"{'Graphics': 1, 'Units': 1}",Just attack/defend for guard and defend for shield guard.
673956052,1.16 graphics for new(ish) monsters,doofus-01,2021-06-20 00:57:39+00:00,2021-06-20 02:30:07+00:00,"{'Graphics': 1, 'Units': 1}","- revise fire wraith halo
- add LordBob's portraits for Jinn and Fire ghosts"
673951292,[UtBS] dustbok description for 1.16,doofus-01,2021-06-20 00:09:31+00:00,2021-06-20 02:10:17+00:00,"{'Campaign (any)': 1, 'Units': 1}","as advertised, nothing more."
673919888,Balance changes for 1.15.14,Hejnewar,2021-06-19 18:53:30+00:00,2021-06-19 19:05:19+00:00,{},"For changelog:
Dune Apothecary experience changed from 100 to 65.
Dune Captain experience changed from 86 to 75.
Dune Herbalist cost changed form 15 to 14.
Dune Horse Archer experience cost changed form 70 to 65.
Naga Sicarius hp changed form 55 to 53 and melee damage changed form 9 to 6, new special ""deflect"" added to melee attack.
Fire Guardian can now level into Fire Wraith.
Revised statistics of all animal horses in order for them to fit better within lore and not violate PIPLB. Bay Horse can now level into Great Horse.

Jinn - a lot changed within JInn, but the most impactful one is resistance change, it should allow for more wide use of this unit.
Fire Wraith cost changed from 25 ot 22.

Horses were changed a lot here are the most important changes:
Bay Horse can now level into Great Horse.
White Horse now has resistances and movement type very similar to elvish horses, it works well with its description.
Dark Horse now has ""whinny"" attack (in my opinion animation of this attack looks better on Dark Horse than it does on Black Horse), Dark Horse no longer violates RIPLB while leveling up.

I tried to make animal horses as distinct as possible while still staying horses in core. Bay and Great Horses are just plain old horses, Dark and Black are a bit nightmareish but still horses, White one is closest to elvish ones."
673874710,1.16 Unit descriptions,doofus-01,2021-06-19 12:40:40+00:00,2021-06-19 21:22:24+00:00,{'Units': 1},"Last minute description fixes/additions.  I'm getting a bit out of my lane, but I was involved in some of this stuff, so this is an attempt to fix a few unit descriptions before the beta freeze.

- correction to Frost Stoat description (fixes #5853 )
- Jinn needs some minimal description
- Dustbok needs some minimal description
- Horses need some minimal description"
673802417,Remove the wesnoth-test textdomain,CelticMinstrel,2021-06-19 01:56:50+00:00,2021-06-19 17:10:02+00:00,"{'Translations': 1, 'Packaging': 1}","This is related to #5800 and (assuming I didn't miss anything) should ensure that nothing from this textdomain ever gets translated.

This allows us to mark things translatable without having to violate schema validation that checks whether things should be translatable."
673792288,gui2/addon_manager: Add TLS connection indicator,irydacea,2021-06-19 00:38:24+00:00,2021-06-19 17:10:44+00:00,"{'Enhancement': 1, 'Graphics': 1, 'UI': 1, 'Add-ons': 1}","This implements the TLS status indicator for the add-ons manager UI.

Since this is a rather trivial feature with no real impact on anything else, I would like to work on the MP version of it and get it merged during the feature freeze reusing the strings from this PR to avoid bothering translators. For this purpose, however, I'd like input on the tooltips below asap since I don't think they are very good at the moment.

### Without TLS, small window

![Screenshot_20210618_203236](https://user-images.githubusercontent.com/489895/122625661-5376a400-d074-11eb-8563-70d103478f12.png)
Tooltip:
> Traffic between the game and the server is not secure

### With TLS, big window

![Screenshot_20210618_203342](https://user-images.githubusercontent.com/489895/122625706-799c4400-d074-11eb-9b64-5f24d26e4e11.png)
Tooltip:
> Traffic between the game and the server is encrypted

"
673557011,"Default [print]duration= to 5 seconds, tutorial uses ""unlimited""",stevecotton,2021-06-18 15:15:55+00:00,2021-06-19 05:08:17+00:00,"{'Campaign (any)': 1, 'Lua API': 1, 'Schema': 1}","In 1.14, the default was 50 frames, or around 1.7 seconds. In 1.15.4, commit
a9d9e48c72e70fd41ae9759e3894752eb9708596 changed the interpretation of that
number to milliseconds, but missed that this affected the [print] tag; this
left the default time that the text is shown as an unreadable 50ms.

All places in mainline that use [print] specify a duration, so the default
isn't used. Here I've plucked the new value from UtBS S09, where it was chosen
in f405b916a1141c2a4bc3bda3f88bbe0a8b8fe91b.

The tutorial is a special case - it originally displayed the text until the
player did the requested move (or almost, it used a duration of 10000 frames,
or around 40 minutes). That makes more sense to me than displaying it for 10
seconds, and as documented in floating_label.hpp the value -1 is already
supported to mean ""display until the label is removed"".

Relax the schema to accept the supported value of -1."
671877091,Add support for forum_auth when uploading to campaignd.,Pentarctagon,2021-06-16 20:37:04+00:00,2022-04-13 02:06:19+00:00,"{'MP': 1, 'Add-ons': 1}","---

Re-PR of #5836 so it's off my fork's master branch since it won't make it for 1.16.0.

@irydacea When you have some time, I'd appreciate an in depth description of what you're looking for in terms of UI changes and how the password would be stored.  I know we talked about it a bit on Discord, but I'm still having a hard time coming up with an implementation."
670450115,add the names of the abilities used as weapons in the attack prediction window,newfrenchy83,2021-06-15 14:16:48+00:00,2021-07-21 20:27:03+00:00,{'Units': 1},"
Now, if a weapon is affected by an ability used as a weapon, the name will appear as if it was a classic special."
670438595,Move path-related functions into a new wesnoth.paths module,CelticMinstrel,2021-06-15 14:03:55+00:00,2021-06-19 19:43:34+00:00,"{'AI': 1, 'Campaign (any)': 1, 'Lua API': 1}",
670438169,Add wesnoth.sync module for the synchronization-related commands,CelticMinstrel,2021-06-15 14:03:26+00:00,2021-06-19 19:39:10+00:00,"{'AI': 1, 'Campaign (any)': 1, 'Unit Tests': 1, 'Lua API': 1}",
670437961,Move the end level data accessors to wesnoth.scenario,CelticMinstrel,2021-06-15 14:03:11+00:00,2021-06-18 00:41:48+00:00,{'Lua API': 1},
669060554,Tips: remove hints about tooltips and the hotkey preferences,stevecotton,2021-06-13 14:15:44+00:00,2021-06-13 23:42:48+00:00,{'Help': 1},"Tooltips are such a common GUI feature that having a tip of the day about them
seems unnecessary. I'd expect a player to find out that we have them the first
time that the player wonders ""what does that button do?"".

While having hints about specific hotkeys seems logical, a general hint to
read the list of keybinds doesn't seem helpful."
669048069,Tutorial S02 and tips: Mention holding shift for accelerated speed,stevecotton,2021-06-13 12:48:52+00:00,2021-06-14 07:57:27+00:00,"{'Campaign (any)': 1, 'Help': 1}","One of these uses bold for the menu's name, the other uses italic, because that
seems more consistent with the other hints in the same context.

Re-attach the comment about upkeep to the correct [event], and move the comment
about the easter-egg event to the start of its [event]."
668993945,Add a method to clear and then add multiple items to a tree view.,Pentarctagon,2021-06-13 05:24:20+00:00,2021-06-19 00:12:05+00:00,{'UI': 1},"This addresses the lobby performance issue as far as the playerlist updating. Previously for every player an item was added and the size of the tree view recalculated, which led to an increasingly unresponsive UI when the number of players in the lobby got to around 150+. With this change, the replace_children() method adds all the players and then after that recalculates the tree view's size once.

---

With a -O0 build, it now takes a fraction of a second to update the playerlist, down from over 30 seconds previously, when adding/removing a player from a playerlist with 500 entries.

For reference with #5578, the profile with this change applied:
![prof](https://user-images.githubusercontent.com/3030250/121796289-72d98100-cbdd-11eb-85bf-1a5ec3ceccbc.gif)
"
668929798,Balance changes for 1.15.14,Hejnewar,2021-06-12 18:32:29+00:00,2021-06-19 18:53:26+00:00,{'Units': 1},"For changelog:
Dune Apothecary experience changed from 100 to 65.
Dune Captain experience changed from 86 to 75.
Dune Horse Archer experience changed form 70 to 65.
Naga Sicarius hp changed form 55 to 53 and melee damage changed form 9 to 6, new special ""deflect"" added to melee attack.
Fire Guardian can now level into Fire Wraith.
Revised statistics of all animal horses in order for them to fit better within lore and not violate PIPLB. Bay Horse can now level into Great Horse.

Jinn - a lot changed within JInn, but the most impactful one is resistance change, it should allow for more wide use of this unit.
Fire Wraith cost changed from 25 ot 22.

Horses were changed a lot here are the most important changes:
Bay Horse can now level into Great Horse. 
White Horse now has resistances and movement type very similar to elvish horses, it works well with its description. 
Dark Horse now has ""whinny"" attack (in my opinion animation of this attack looks better on Dark Horse than it does on Black Horse), Dark Horse no longer violates RIPLB while leveling up.

I tried to make animal horses as distinct as possible while still staying horses in core. Bay and Great Horses are just plain old horses, Dark and Black are a bit nightmareish but still horses, White one is closest to elvish ones. "
668925048,Last minute Naga things,doofus-01,2021-06-12 18:04:42+00:00,2021-06-14 03:51:38+00:00,"{'Campaign (any)': 1, 'Graphics': 1, 'Units': 1}","- [x] Add the guardian/mace nagas from UtBS to core (+ adding LordBob's portrait for them)
- [x] Revise the Dirkfang-Ophidian branch to something without the bow
- [x] Revise descriptions (and names?) for the mace & ophidian nagas
- [x] Revise mace naga sprites so they aren't just the regular fighters holding different things in their hands (base frames only, but animations can be added later)
"
667683538,Polishing off the map API,CelticMinstrel,2021-06-11 05:04:09+00:00,2021-06-19 15:07:53+00:00,"{'AI': 1, 'Campaign (any)': 1, 'Unit Tests': 1, 'Lua API': 1}","This covers shroud, fog, and time areas, three things that were only given a cursory pass in the previous map API pull request.

It's a draft because it still needs testing (some unit tests might be nice) and a few other things, but I wanted to get it out there for people to see as soon as possible."
667567251,Fix bug in AI state loading that could cause an error when the AI is initialized from a saved game,CelticMinstrel,2021-06-11 01:06:52+00:00,2021-06-11 19:49:28+00:00,{'AI': 1},"It's kind of hard to explain but basically the code was doing something like this:

```lua
if ai then
  return ai
else
  return wesnoth.debug_ai(side)
end
```

And `wesnoth.debug_ai(side)` is definitely not the same thing as `ai`."
665849877,Split styled_widget::update_canvas into ..._size,stevecotton,2021-06-09 12:14:34+00:00,2022-09-04 15:37:07+00:00,"{'UI': 1, 'WFL': 1}","Try and reduce GUI2's overhead of creating wfl::variants, by making a smaller function that only updates the size. Removes about three-quarters of the biggest box on those profile graphs in issue #5578, but avoids calling a virtual function that several subclasses have overridden.

WIP: Needs a careful check of the subclasses that haven't been changed in this commit, to see if any others should be changed. Going to open a draft PR as-is, to save anyone else looking at the same optimisation.

This is not the fix for #5578, the real issue there is how often this function gets called. But this will still be a general GUI2 optimisation, so worthwhile even without that issue.
"
665832139,Slight optimisation of canvas::set_variables using std::move,stevecotton,2021-06-09 11:49:35+00:00,2021-06-09 17:28:46+00:00,"{'UI': 1, 'WFL': 1}","Doesn't make much difference for release builds built with GCC,
it takes between 1% and 7% off the cost of std::update_canvas().
Calculated using the time taken by gui2::widget::get_best_size()
as a reference.

It's a tiny improvement, but it's also a tiny change, and the
improvement is in the loop that's MP lobby's performance problem,
as described in issue #5578."
665741952,Make the profiler configurable in CMake's UI,stevecotton,2021-06-09 09:44:03+00:00,2021-06-09 16:21:54+00:00,"{'Building': 1, 'CMake': 1}",
665324373,Combine profile build into release build.,Pentarctagon,2021-06-08 21:13:54+00:00,2021-06-09 02:23:38+00:00,"{'Building': 1, 'SCons': 1, 'CMake': 1}","---

Just letting the CI complete to make sure none of the configuration options broke."
665263373,font: Remove dead code and WML previously associated to SDL_ttf,irydacea,2021-06-08 20:19:20+00:00,2021-06-09 05:37:05+00:00,{'UI': 1},"The [fonts] [font] WML was only used to set up SDL_ttf fonts. The engine
code to read it was left in after
2dfdc0061d400ffad39f974d7fe9348204af0d08 in a dead state (some
structures are filled with data that never gets used)."
665224071,Updating README.md for contributors ,Anthonyklassen,2021-06-08 19:41:43+00:00,2021-09-06 02:21:53+00:00,{},Updating README.md for visibility for new contributors.
663761992,Add option to pre-populate wesnothd's user list with dummy users.,Pentarctagon,2021-06-07 17:23:33+00:00,2021-06-10 23:16:49+00:00,{'MP': 1},"None of the dummy players have an actual connection or client, so any attempt to interact with them will fail. The main usecase for this right now is testing the performance of the MP lobby UI updates when there are many players online."
663409704,"When starting or loading a game, warn if the next scenario is unknown",stevecotton,2021-06-07 10:01:18+00:00,2021-06-19 20:22:19+00:00,{'Unit Tests': 1},"Check that the scenario's next_scenario= exists, and display a warning
if it would lead to an ""Unknown Scenario"" error. This also checks any
[endlevel] tags in events.

The error message includes the id of the missing scenario. If there
are multiple branches and some should be okay then a slightly
different message is shown saying which ones should work, hopefully
the ids will be something that hints to the player how to reach the
working branches.

The warnings' translatable strings could have plural and singular
forms, but these errors should be rare enough that it seems excessive
to have those separate plural and singular forms.

Fixes #5530.

![wesnoth_unknown_next_scenario](https://user-images.githubusercontent.com/101462/120997964-ec114800-c787-11eb-90f6-5d342ee0040b.png)
![wesnoth_unknown_and_known_next_scenarios_800x600](https://user-images.githubusercontent.com/101462/120997971-eca9de80-c787-11eb-8ac1-385b3a75a5a3.png)"
663152074,Add addons to wesnoth.game_config,CelticMinstrel,2021-06-07 04:18:24+00:00,,{'Lua API': 1},"This adds:
- wesnoth.game_config.eras
- wesnoth.game_config.campaigns
- wesnoth.game_config.modifications
- wesnoth.game_config.resources

Each is an ID to config mapping of the particular addon type.

wesnoth.game_config.eras previously existed as just an array of all era IDs, so this is an incompatible change. However, the old API was never documented, and the comment said it was specifically for @sigurdfdragon who approved this change (although he couldn't remember why he used it).

I'm a little unsure if there are use-cases for this. It most likely won't show all installed add-ons, since @gfgtdf made changes awhile back to only load active add-ons. At most, it would show all eras, campaigns, modifications, and resources associated with an active add-on, regardless of whether said era, modification, or resource is actually active, plus all built-in core eras, modifications, and resources. The same is probably true of campaigns, but they normally don't load at all in multiplayer."
663150846,wesnoth.unit_types and wesnoth.terrain_types are now available in map generation scripts,CelticMinstrel,2021-06-07 04:15:22+00:00,,{'Lua API': 1},"For example, this could allow you to tailor a map to the movement of a specific unit type, or modify terrain based on properties rather than just the terrain code."
663150262,Add wesnoth.interface.add_floating_label as a replacement for wesnoth.print,CelticMinstrel,2021-06-07 04:14:05+00:00,2022-04-10 17:00:29+00:00,"{'Campaign (any)': 1, 'Unit Tests': 1, 'Lua API': 1, 'Schema': 1}","This returns a label handle which allows you to remove, reposition, or replace the label later.

In addition to all the features of wesnoth.print, you can now specify where the label appears onscreen,
as well as a fadeout time separate from the duration."
662700385,Add support for forum_auth when uploading to campaignd.,Pentarctagon,2021-06-06 01:47:39+00:00,2021-06-16 20:37:07+00:00,"{'MP': 1, 'Add-ons': 1}","---

Note that the `db_users_table` attribute now needs to be set in the campaignd server config file."
662628189,SoF - final scenarios,doofus-01,2021-06-05 22:14:16+00:00,2021-06-07 03:58:12+00:00,"{'Campaign (any)': 1, 'Graphics': 1, 'Units': 1}","(This is a clean restart of #5822 - I had git issues.)
Trying to clean up final scenarios.

-    Sometimes the orc with the tablet manages to avoid all the triggering events. I think the updated AI goals help avoid that, but it's hard to test
-    Minimal cleanup to the epilogue
-    added @nemaara to the credits
-   The ""Dragon"" scenario is odd, I think replacing the bats with some sort of flying reptile would make it less odd. New units are campaign-specific, not part of the mainline roster in BfW 1.16
"
662611494,Add a unit-test for the backstab ability,stevecotton,2021-06-05 21:29:11+00:00,2021-06-06 06:45:36+00:00,{'Unit Tests': 1},
662536480,Schema: Add lua_goal support,CelticMinstrel,2021-06-05 17:58:08+00:00,2021-06-06 03:20:20+00:00,{'Schema': 1},@doofus-01 Try pulling this and see if that fixes your validation issue. Pushing it to your PR would be fine if you're unable to validate locally.
662282548,Add Winds of Fate (Drake campaign) to mainline,Jonathan-Kelly,2021-06-05 03:27:26+00:00,2022-01-16 09:06:12+00:00,"{'Campaign (any)': 1, 'Graphics': 1, 'Audio': 1, 'Units': 1, 'Help': 1}",
661239916,fix codeblock projectfiles,newfrenchy83,2021-06-03 21:48:41+00:00,2021-06-03 23:53:16+00:00,{'Building': 1},
660288764,update codeblock projectfiles,newfrenchy83,2021-06-02 18:17:27+00:00,2021-06-02 18:18:21+00:00,{'Building': 1},
660256728,Attempt to fix xcode.,Pentarctagon,2021-06-02 17:30:56+00:00,2021-06-02 17:31:01+00:00,"{'macOS': 1, 'Building': 1}",
659719039,Remove nonce and double hashing as it's no longer needed.,Pentarctagon,2021-06-02 04:42:29+00:00,2021-06-02 14:28:59+00:00,"{'MP': 1, 'Add-ons': 1}","---

Tested as working locally with the password `password` when hashed as md5 (`$H$9ZDzPE45CDau6Dx3EgubHP5V77/Q3P/`) and bcrypt (`$2y$10$0xhi24E6CXeoICokaHKsA.qWrUDtzzCJGQD9W4Bhxyxv9rOD7pLfG`)."
659357847,Fix login error when user not registered.,Pentarctagon,2021-06-01 21:34:04+00:00,2021-06-01 21:34:09+00:00,{'MP': 1},
658606941,Update Skeletal_Dragon.cfg,ghost,2021-06-01 03:01:55+00:00,2022-06-27 18:19:42+00:00,{'Units': 1},"Addressing Issue fix #5703; making the Skeletal Dragon more manageable outside of EI. Removed flight and drain attack, adjusted resistances."
658401456,fix teleport message.,newfrenchy83,2021-05-31 15:44:48+00:00,2021-05-31 17:45:29+00:00,{},Fix https://github.com/wesnoth/wesnoth/issues/5816 issue . https://github.com/wesnoth/wesnoth/commit/04455c01b4649af8433924a1dca82ab4e2621653 commit forget second owner and unit.side in formula.
657856751,SoF - final scenarios,doofus-01,2021-05-31 00:51:27+00:00,2021-06-05 22:03:48+00:00,"{'macOS': 1, 'Campaign (any)': 1, 'Graphics': 1, 'MP': 1, 'Translations': 1, 'UI': 1, 'WML Tools': 1, 'Units': 1, 'Add-ons': 1, 'Building': 1, 'WFL': 1, 'Help': 1, 'CMake': 1, 'Schema': 1}","Trying to clean up final scenarios.  
 
- Sometimes the orc with the tablet manages to avoid all the triggering events.  I think the updated AI goals help avoid that, but it's hard to test
- Minimal cleanup to the epilogue
- added @nemaara to the credits
- (not done yert) - the ""Dragon"" scenario is odd, I think replacing the bats with some sort of flying reptile would make it less odd.  New units would be campaign-specific, not part of the mainline roster."
657738628,add items from Blarumyrran and run woptipng on the directory,doofus-01,2021-05-30 16:02:20+00:00,2021-05-30 20:18:17+00:00,{'Graphics': 1},
657727127,"Add-ons manager: Fix bugs that return to the title screen with an ""Invalid WML"" message",stevecotton,2021-05-30 15:14:50+00:00,2021-06-01 20:49:37+00:00,"{'UI': 1, 'Add-ons': 1}","This fixes two specific causes of #3059, where code assumes that all parts of
the add-ons manager's UI are accessible, an assumption that fails when the
dialog uses a stacked widget to handle small window sizes.

It would be better to redesign the C++ for this dialog, but a quick workaround
for the observed issues is much easier.

* Fixes #5810, triggered by using the version drop-down in small-screen mode.
* Adds a workaround for keyboard input changing the selected add-on on small screens."
657515172,add unslowable status to spectral or fire elemental units,newfrenchy83,2021-05-29 18:31:04+00:00,2021-05-30 15:53:05+00:00,{'Units': 1},"the units make of fire, or ghost don't must be slowable by attacks like bolas or entangle, because same if these attacks damage these units,
their non-corporal nature make impossible to slow their movements."
657487928,Add a dir() function to improve API discoverability,CelticMinstrel,2021-05-29 15:32:02+00:00,2022-06-21 00:54:29+00:00,"{'AI': 1, 'UI': 1, 'Lua API': 1}","This is intended to allow someone to explore the API right in the Lua console. The current commit implements the actual function, but there's a lot more work to support it throughout the API, which is why this is a draft. I don't expect this to be finished for 1.16."
657300827,"AToTB S02: The necromancer is leaving, not waiting for reinforcements",stevecotton,2021-05-29 01:20:28+00:00,2021-05-30 13:02:21+00:00,"{'Campaign (any)': 1, 'Prose': 1}","Also change a line from the elves, so that it changes from sympathy to defense
instead of a sudden swing from sympathy to aggression.

@Earth-Cake, @Konrad22, @Lordlewis6 and @nemaara: this is a follow-up to #5255. I'm assuming that AToTB won't be replaced with a rewritten version in time for 1.16, so want to improve up the existing dialogue."
655641892,"Refactor special notes for abilities, attack types, movetypes and weapon specials",stevecotton,2021-05-28 01:22:05+00:00,2021-06-01 12:29:57+00:00,"{'Campaign (any)': 1, 'WML Tools': 1, 'Units': 1, 'Help': 1, 'Schema': 1}","Many unit's files are changed here, but the main files to review are the C++ and those under data/core/macros.

An easier way of setting special notes in the most common use-cases. Text given
in the following attributes will be collected and added to the special notes
for units and unit types:

* [ability tag name]special_note=
* [language]special_note_damage_type_TYPE=
* [movetype][special_note]note=
* [attack][specials][special tag name]special_note=

It's no longer necessary to put these notes in each unit_type's .cfg file, and
the macros for doing so are now deprecated.

C++ changes
-----

Simplify both unit_type::special_notes and unit::unit_special_notes. Add
utils::stable_unique, similar to std::unique but accepts non-ordered input and
preserves the order in the output.

Remove unit_type::has_special_notes() - callers can instead call
special_notes() and then check if the returned vector is empty, which removes
the need for duplicating code in unit_type.

Trade-off: the new [language]special_note_damage_type_TYPE is likely deprecated in 1.19.
-----

Adding [language]special_note_damage_type_TYPE= uses the same existing design
as [language]type_TYPE=, however both are hacks that don't fit the general
style of WML. It could be better to define a new [damage_type] tag that
supercedes both and also provides a place for specifying the damage icon;
however that won't be done in time for the API freeze for 1.16.

Doing it in the way that this commit does it is a hack, but it's one where
replacing it with the better solution in 1.18 will affect very few UMCs (only
those that define additional damage types). Even in the UMCs that would be
affected, it would likely only be a few changes in a single central file.

Trade-off: NOTE_DEFENSE_CAP is not auto-added
-----

It might be better to auto-add NOTE_DEFENSE_CAP when movetype.cpp detects that
the type has capped values. However as NOTE_SPIRIT already requires
[movetype][special_note], it's simple to use the same mechanism. If we decide
to change it to being auto-added, the current commit greatly reduces the number
of places that would need to change again, as it's now in the [movetype]
instead of the many [unit_type]s using that movetype."
653400171,Include the new-style special notes in the sidebar's unit description,stevecotton,2021-05-26 08:26:08+00:00,2021-05-26 20:54:24+00:00,{'Engine': 1},"_@irydacea asked in https://github.com/wesnoth/wesnoth/pull/5798#discussion_r639428602_:
> Which function is used for the sidebar description tooltips? Considering that singular units having different attributes than their unit types is actually an extremely common thing.

There seems to be some bug about triggering this tooltip - for me hovering the mouse over the sidebar reliably shows other tooltips, but is very intermittent with this one. However, the subject of this PR is the content of the tooltip when it does show."
651332742,replace deprecated special= by special_id/type in Utbs and scenario-test,newfrenchy83,2021-05-24 13:31:09+00:00,2021-05-26 23:30:07+00:00,{'Campaign (any)': 1},special attribute is deprecated and must be replaced by special_id or special_type before 1.17
650730778,A few WFL updates,CelticMinstrel,2021-05-23 05:32:00+00:00,2021-05-23 17:46:37+00:00,{'WFL': 1},"Opening a PR to ensure CI passes; assuming it does, I'll merge tomorrow.

I don't expect much controversy in this PR, but it:

* Deprecates ""side"" in WFL formulas in favour of ""side_number"", which is consistently 1-based
* Adds tod_bonus and base_tod_bonus gamestate functions
* Adds ""terrain"" to unit objects, which looks up the terrain info for the unit's current location"
650628954, Create a [anti_special] ability who negate specifically some specials,newfrenchy83,2021-05-22 13:33:58+00:00,2021-05-27 12:44:22+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1}","With this ability, it is possible to negate the effects of specials without ipmlement filter in this special
and apply that to core specials or abilities used like specials.
Another advantage is the [affect_adjacent] but also to affect a special unique without affect special of same type who could be used in same attack.
an exemple can be to cancel the effect of magical chance_to_hit without affect the marsksman abilities or to create different type of poisons"
650627833,update codeblock projectfiles,newfrenchy83,2021-05-22 13:25:47+00:00,2021-05-22 17:26:01+00:00,{'Building': 1},
650553838,See about adding macOS TLS system cert loading.,Pentarctagon,2021-05-22 03:13:34+00:00,2021-05-22 20:06:51+00:00,{},"---

Tested by @singalen and confirmed he could connect to the TLS-enabled 1.15 add-ons server now with this code."
649608057,Move translation mark validation from wmllint to schema,CelticMinstrel,2021-05-21 02:39:13+00:00,2021-06-15 03:59:52+00:00,"{'AI': 1, 'Campaign (any)': 1, 'Unit Tests': 1, 'UI': 1, 'WML Tools': 1, 'Units': 1, 'Help': 1, 'Schema': 1, 'Terrain': 1}","With this, the schema validator can now distinguish between a translatable and a non-translatable string.

* The `t_string` type, which must be translatable, is now a schema built-in type (the only built-in).
* Type definitions now support an `allow_translatable` key, which defaults to false, meaning the value _must not_ be translatable. If set to true, the value is allowed to be translatable. Translatable values in this key will still be matched against the pattern."
649566564,An easier way of setting special notes in the most common use-case,CelticMinstrel,2021-05-21 00:30:17+00:00,2021-06-01 01:55:30+00:00,"{'Campaign (any)': 1, 'WML Tools': 1, 'Units': 1, 'Schema': 1}","Abilities and weapon specials now have a `special_note` attribute that automatically gets prepended to the list of special notes. The `[special_note]` tag is still supported for special notes not directly linked to an ability.

This deprecates all but 3 of the `{NOTE_*}` macros and even updates wmllint. The horses were missing `{NOTE_DEFENSE_CAP}` so I also added that."
648267098,Hash passwords server-side instead of client-side.,Pentarctagon,2021-05-20 00:51:55+00:00,2021-06-01 18:47:49+00:00,"{'MP': 1, 'Add-ons': 1, 'Building': 1}","This removes the need for the Wesnoth client to need to know how to hash the password to match what is expected by the forum database.

---

This does of course depend on TLS support being enabled and working first."
647141625,Scenario editor help: remove the warning about 1.14 bugs,stevecotton,2021-05-18 22:35:12+00:00,2021-05-19 04:36:29+00:00,{'Editor': 1},"The editor/help.cfg file was kept in sync between 1.14 and 1.16, it's now time
for 1.16-specific changes, starting with dropping this warning."
647118062,update codeblock projectfiles andfix lua_mathx not compiled with gcc 8.0 on windows7(in codeblock project),newfrenchy83,2021-05-18 21:44:01+00:00,2021-05-19 21:39:06+00:00,"{'Lua API': 1, 'Building': 1}",When i compile this file with gcc called with codeblock editor i have line 59: 'std::round is not a member of std'
646903341,Schema fixes and additions,mattsc,2021-05-18 16:16:32+00:00,2022-06-28 14:47:11+00:00,{'Schema': 1},This pull request is mostly meant to fix false positive error messages when variables are used for key values in ActionWML and filters.
646866321,"add an [anti_special] ability, which can negate the effects of certains specials weapons",newfrenchy83,2021-05-18 15:34:51+00:00,2021-05-18 23:03:58+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1}","
(slow, poison, drains, plague and petrifies) are the only ones affected.

They are not here to provide protection against all status changes, but rather to be able to cancel certain weapons.

like protect against certain poisons or slow attacks (but not all, whereas with the status unpoisonable, it is all or nothing)."
645368400,SotA - update walking corpses to mesh with mainline,doofus-01,2021-05-16 19:36:27+00:00,2021-05-16 22:11:47+00:00,"{'Campaign (any)': 1, 'Graphics': 1, 'Units': 1}",fixes #5761
645361207,Fire Wraith and Jinn,doofus-01,2021-05-16 18:47:19+00:00,2021-05-30 03:44:08+00:00,"{'Graphics': 1, 'Units': 1}","Just an initial base frame and config file, but still good to get something concrete up.  Lordbob already made the portrait for it,"
645340529,Last new terrains for 1.16,doofus-01,2021-05-16 16:22:24+00:00,2021-05-30 04:30:40+00:00,"{'Graphics': 1, 'Terrain': 1}","For now, it's snowy (^Feta) and dead oak (*^Feth) variations of great tree.  There might or might not be anything else, we'll see."
645330401,add 'unslowable' and 'unpetrifiable' status,newfrenchy83,2021-05-16 15:12:56+00:00,2021-05-27 17:35:50+00:00,"{'Unit Tests': 1, 'Units': 1, 'WFL': 1}",
645312749,Icemonax advances to Greater Icemonax,ForestDragon-wesnoth,2021-05-16 13:01:26+00:00,2022-06-27 18:19:04+00:00,{'Units': 1},"I think it is perfectly reasonable to be able to have icemonax advance to greater icemonax. This makes the units feel like a proper unit line, and gives UMC authors more freedom how to use the unit. To compensate for the fact that a lvl0 unit advances to lvl2, I set the exp quite high (53) to make this not something abusable"
645229470,adding seahorse graphics,doofus-01,2021-05-15 22:34:03+00:00,2021-05-23 01:43:12+00:00,"{'Graphics': 1, 'Units': 1}","I can't run woptipng, and optipng doesn't do much with this.  I might merge this later, but the image should cool off here for a while in case it needs fixing."
644635021,lua/gui2: Restore layout invalidation hack when setting widget labels,irydacea,2021-05-14 11:03:35+00:00,2021-05-15 10:15:43+00:00,"{'UI': 1, 'Lua API': 1}","Fixes #5755.

This is one of several layout invalidation hacks used in the old Lua
GUI2 API lost in the implementation of the new API (which the old API
now wraps).

It turns out that in the previous API (see 1.14 for reference if you
need easy access to the source) there were several calls to
invalidate_layout() that weren't there just to look pretty.

For wesnoth.set_dialog_value:

 * One prior to setting the value of a text_box
 * One prior to setting the value of a unit_preview_pane
 * One prior to setting the value of a styled_widget
 * One after changing a widget's visibility to hidden

All of these were removed by the new API implementation, with the last
one ending up commented out, restored now in commit
8989eb430311092e66177bc09e1b1c344000d5aa. All the other ones are
entirely gone, however.

It turns out that the dialog layout invalidation done for the
styled_widget case was essential to get listboxes working correctly
after clearing and adding rows to them (which was automatically done
right before in the implementation of wesnoth.set_dialog_value by the
find_widget() helper function). It was done for every single listbox
item, but without it the listbox would become completely useless under
certain conditions:

  20210501 03:24:37 error gui/layout: grid [_content_grid] place: Failed to place a grid, we have 39,30 space but we need 39,93 space. This happened at a grid with the id '_content_grid' in a 'N4gui27listboxE' with the id 'list' in a 'N4gui24gridE' with the id '_window_content_grid' in a 'N4gui24gridE' with the id '_content_grid' in a 'N4gui215scrollbar_panelE' with the id '' in a 'N4gui24gridE' with the id '' in a 'N4gui26windowE' with the id ''.

Now, it seems horribly inefficient to do this for every single new row
added to the listbox, but this solution *works*. We might want to
restore the hacks for the other 2 cases as well -- or figure out a
cleaner solution for the aforementioned bug."
644353946,Update how the icu libraries are linked.,Pentarctagon,2021-05-14 00:48:32+00:00,2021-05-14 00:48:36+00:00,"{'Building': 1, 'CMake': 1}",
644330669,Another round of Lua reorganization work,CelticMinstrel,2021-05-13 23:39:46+00:00,2021-06-19 17:09:46+00:00,"{'AI': 1, 'Campaign (any)': 1, 'Unit Tests': 1, 'Lua API': 1}","This currently contains the floating label change (already seen in the previous pull request) as well as a proposed new dir() function. Most likely, both of these will be subject to some renames before they're ready for merge.

I also plan to add modules for pathfinding and ~schedule management~ in this PR. They should be straight renames with no new functionality."
644317499,"Credits: move myself to Programming, add Sean Yeh, update Astrid",stevecotton,2021-05-13 23:00:48+00:00,2021-05-13 23:35:48+00:00,{},"* Move myself to the programming section
* Add Sean Yeh to the misc section
* Finish 287ec15c101b's update of Astrid's credits

[ci skip]

@Pentarctagon, I'm asking for a review because I'm moving myself upwards."
643543693,config: Don't create differently-typed copies of input in loops,irydacea,2021-05-12 22:31:37+00:00,2021-05-13 00:15:46+00:00,{},"This is prompted by 1f8101ef22bb23699421505235f4962802773c77. This
approach should still be correct while hopefully not bothering any
compilers *and* avoiding unnecessary copies or conversions until the
input actually needs to be converted to a different type (in this case
std::string_view, which is cheaper than std::string)."
643395751,update codeblock projectfiles,newfrenchy83,2021-05-12 18:16:49+00:00,2021-05-12 18:23:36+00:00,{'Building': 1},
643387548,Better handle unexpected return codes.,Pentarctagon,2021-05-12 18:05:59+00:00,2021-05-12 18:54:13+00:00,{},
641318636,Make callers of help::show_help not need a help_manager,stevecotton,2021-05-11 18:23:51+00:00,2021-05-14 09:38:35+00:00,"{'UI': 1, 'Lua API': 1, 'Help': 1}","Most of the places that created a help_manager did so just to call show_help on
the next line. Move knowledge of the internals out of those callers and into
help.cpp.

This leaves editor_controller and play_controller with knowledge of help_manager,
however both of those classes handle ownership of the game_config too.

@CelticMinstrel, I still have some `\todo` comments to check, but I think this is a better way to handle help_manager."
638981952,Add-ons manager: show tags in the details panel,stevecotton,2021-05-11 02:15:01+00:00,2021-05-15 15:18:19+00:00,"{'UI': 1, 'Add-ons': 1}","Show the contents of PblWML's ""tags"" attribute in the add-ons dialog. They're
shown at the bottom of the right-hand panel (only if the window size is large
enough to trigger that dialog's two-panel layout).

This started as part of #5765, I've split it because I think this part is ready to
merge, but the filtering-by-tags part needs an inspiration about the descriptive
strings."
637459151,Run woptipng on the new horses,stevecotton,2021-05-10 11:44:01+00:00,2021-05-12 13:33:20+00:00,"{'Graphics': 1, 'Units': 1}","57 of 57 files optimized, 678061 bytes reduced to 586300 bytes; -91761 bytes, -13.53%
This was running with the -t0 option, so that it considers any reduction good, even
if it's less than 10% on the big portrait images.

@doofus-01 sorry for not catching this before #5738 merged."
637269990,Remove remaining uses of wesnoth.special_locations and fix deprecation message,Hejnewar,2021-05-10 09:35:25+00:00,2021-05-10 17:00:58+00:00,"{'AI': 1, 'Lua API': 1}",Remove remaining uses of wesnoth.special_locations and fix deprecation message.
635911809,"add an [anti_special] ability, which can negate the effects of certains specials weapons",newfrenchy83,2021-05-09 14:17:38+00:00,2021-05-18 15:33:37+00:00,"{'Unit Tests': 1, 'UI': 1, 'Units': 1, 'WFL': 1, 'Schema': 1}","(slow, poison, drains, damage, attacks, chance_to_hit and petrifies) are the only ones affected.

They are not here to provide protection against all status changes, but rather to be able to cancel certain weapons.

for example, canceled the magic guidance of the projectiles launched by a magician, disturbed the charge of a rider, or still protect against certain poisons (but not all, whereas with the status unpoisonable, it is all or nothing)."
635824349,Credits: hide the blank section for Friulian,stevecotton,2021-05-09 12:50:11+00:00,2021-05-12 14:28:05+00:00,{},"When an [about] section has a title but no [entry] tags, it's automatically
hidden in the credits. The entry with name="""" was causing the title to show
up with a blank section under it.

Asturian and Friulian were removed in ad7699bffc16f7c982c95f1989ad6f932a1580b4
because they'd been added to the translation framework but hadn't received any
translated strings.

The reason that I'm leaving these in rather than completely removing them is
that the string ""Friulian Translation"" has already been translated into almost
all of the languages that Wesnoth supports. ""Asturian Translation"" has been
translated into around half of them, although the fuzzy-string support has put
the translation of ""Estonian Translation"" into the other half."
635767088,Credits: remove the i18n entries for languages that had no strings committed,stevecotton,2021-05-09 11:52:32+00:00,2021-05-09 11:58:21+00:00,{},"These were removed in ad7699bffc16f7c982c95f1989ad6f932a1580b4, but were reintroduced when the credits were synced with 1.14. Adding comments so that they don't get re-merged.

@ivanovic, I think these should be removed, but this PR is a question to you about whether you want to keep them. These strings themselves have already been translated into almost all languages, so it's not going to save effort for the other languages' translation teams.

Looking at the credits screen itself (you'll need a recent build with #3265 fixed), the heading for Asturian doesn't show up, but the one for Friulian does. Probably because Asturian has no `[entry]` tags, while Friulian has a blank one."
633474156,Filtering by tags in the add-on manager,stevecotton,2021-05-07 21:29:39+00:00,2021-05-15 22:53:20+00:00,"{'Enhancement': 1, 'UI': 1, 'Add-ons': 1}","Add a new drop-down filter to the add-ons manager, based on PblWML's
`tags` attribute.

The existing PblWML specification includes a comma-separated list of tags.
Until now there are no official tag names, but some of the 1.14 add-ons already
have some unofficial ones. If this feature is included in 1.16 then I assume
many UMC authors will use the newly-official tags.

For a larger add-on list than the dev server has, use port 15014 which will
connect to the 1.14 server instead (in the connect dialog change the address to
addons.wesnoth.org:15014)."
633427427,Some more cmake cleanups.,Pentarctagon,2021-05-07 20:53:16+00:00,2021-05-07 20:53:22+00:00,"{'Building': 1, 'CMake': 1}","Also moved boost and openssl to using the ""import targets"" (ie: https://cmake.org/cmake/help/latest/module/FindBoost.html#imported-targets) which are apparently the modern way to use cmake. Many of the other libraries don't support that however, and SDL is only fully(?) supported using this as of cmake 3.19."
631621114,"add [immune] abilitiy who protect unit affected again weapon- specials of poison,slow, drains or plague type",newfrenchy83,2021-05-06 16:37:29+00:00,2021-05-09 08:44:29+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1}","An issue for me with the core specials is what it can't be canceled without use a wml lua eencoding, and what in attack_prediction window, specials is showed active. An solution for addon develloper is to create specials similar but active under condition, but for core units, the issue remain. I propose to add new abilities for can canceled specials directly and simplify the work of addon develloper. I hpe what this idea is pertinent."
631124998,Use cmake to create VS project files.,Pentarctagon,2021-05-06 06:01:46+00:00,2021-05-07 05:02:02+00:00,"{'Building': 1, 'CMake': 1}","Due to an upstream change in vcpkg that breaks the simple integration previously available with `vcpkg integrate install`, building using that setup method is no longer possible. In order to work correctly, cmake must instead be used to generate the VS project files, since that is able to integrate with vcpkg, since vcpkg also uses cmake to build all the library dependencies.

An additional benefit of this is that it will no longer be necessary to separately update the VS project files since it will read the same source_lists files as cmake (on linux) and scons do.

This also enables running the WML unit tests on Windows with this in order to confirm that a valid wesnoth.exe is in fact being generated as well as fixes building the boost unit tests.

The warning level for both release and debug builds are now at level three, the remaining warnings have been fixed, and therefore strict builds have been enabled - any warning will now cause the build to fail, just like for the linux jobs.

Known issues:
* The boost unit tests don't actually run successfully - they fail on CI at least with an exit code on 201 - however I don't know if this is a real problem or just a problem with running headless on CI.
* The debug build doesn't quite work since the executables are built against the non-debug dlls but cmake copies over the debug dlls into the output directory. For now this can be worked around by copying the release dlls into the debug directory.
* The instructions in INSTALL.md are not very good since I don't use Windows and thus can't write anything more detailed. Ideally someone who uses Windows can add more detailed step by step instructions at some point.

Fixes #5741"
629415700,Rewrite the WML unit test for sighted events,stevecotton,2021-05-03 23:00:03+00:00,2021-05-05 23:21:59+00:00,{'Unit Tests': 1},"The old version's [event]name=sighted had a {RETURN} statement in it,
which meant the test stopped on the first sighting. Most of the test
wasn't testing anything."
628435219,Add files via upload,slaweks7,2021-05-01 13:40:56+00:00,2021-05-01 18:19:49+00:00,{'Translations': 1},updated Polish translation
627280828,Make woptipng's debug output about bigger images clearer,stevecotton,2021-04-30 11:25:19+00:00,2021-05-12 14:04:32+00:00,{'Graphics': 1},"If a tool made the image bigger, the debug message was the same as if the tool
had made the image's pixel change. Clarify that into two separate messages.

As each verify_images() call checks that the file became smaller, the removed
print statement would never be reached."
627280284,"Run woptipng on images with bad iCCP, and associated files",stevecotton,2021-04-30 11:24:41+00:00,2021-05-03 08:33:40+00:00,"{'Graphics': 1, 'Units': 1, 'Terrain': 1}","The files that had bad iCC profiles were the following subset. I ran woptipng
on the files that were checked in at the same time too.
* data/core/images/portraits/monsters/woodland_boar.png
* data/core/images/portraits/undead/zombie-boar.png
* data/core/images/terrain/castle/troll/tile.png
* data/core/images/units/human-loyalists/heavyinfantry-attack-8.png
* data/core/images/units/human-outlaws/bandit-idle-1.png
* data/core/images/units/human-outlaws/bandit-idle-2.png
* data/core/images/units/human-outlaws/bandit-idle-3.png
* data/core/images/units/human-outlaws/bandit-idle-4.png
* data/core/images/units/human-outlaws/bandit-idle-5.png
* data/core/images/units/human-outlaws/bandit-idle-6.png
* data/core/images/units/human-outlaws/trapper-bow-attack1.png
* data/core/images/units/human-outlaws/trapper-bow-attack2.png
* data/core/images/units/human-outlaws/trapper-bow-attack3.png
* data/core/images/units/human-outlaws/trapper-bow-attack4.png
* data/core/images/units/human-outlaws/trapper-bow-attack5.png
* data/core/images/units/human-outlaws/trapper-bow-attack6.png
* data/core/images/units/human-outlaws/trapper-bow-attack7.png
* data/core/images/units/human-outlaws/trapper-bow-defend.png
* data/core/images/units/human-outlaws/trapper-bow.png
* data/core/images/units/human-outlaws/trapper.png"
627248175,Remove the old PNG optimisation script,stevecotton,2021-04-30 10:49:19+00:00,2021-05-07 10:01:59+00:00,{'Graphics': 1},"A Python version was added in b3fe980d709add4fb8b3fb88faad946bfe55e477, the
main reason for removing the old one is that it's inconsistent to have two
tools where one does almost (but not quite) the same as the other.

Both versions check that the old and new images look the same. However, if any
tool changed the pixels' values then old script would discard the changes from
the other tools too. The new script checks the image after each tool is run, so
that the optimisations from the other tools can still be kept.

The indexed2rgb.sh script had a call to utils/wesnoth-optipng. It's deleted
instead of updated because both wesnoth-optipng itself (since 17c242a9f) and
the new woptipng both do what indexed2rgb.sh did (they all run ImageMagick with
option ""png:color-type=6"")."
625980544,Make command-line option --language never require --all-translations,stevecotton,2021-04-29 10:27:58+00:00,2021-04-29 14:50:34+00:00,{},"When the user supplies an exact locale identifier on the command line,
it doesn't make sense to check whether it's an incomplete translation."
625598370,[MP] Isle of Mists - a new 1p/2p Survival Scenario. ,knyghtmare,2021-04-28 21:16:57+00:00,2021-06-19 17:05:47+00:00,{'MP': 1},"Description:
_Isle of Mists is a survival scenario for solitaire or two-player team-based play against randomly-spawned AI units. Victory is achieved by surviving and defeating all enemy waves. During the course of play, the terrain will change based on random weather effects. You need to use the default map settings for the scenario to work right._

This PR contains:
1. Adds a new multiplayer survival scenario.
2. Lua (similar to Dark Forecast one) code file used for the enemy waves and weather change events
3. Comes with 6 weather conditions (6 maps)

Features:
1. Default difficulty is set at `0`.
2. Has 1p/2p modes
3. 5 final waves
4. 8 difficulty levels, ranging from `-30` to `+60`, with `+60` being catered especially for veteran/skilled players.

Replays: 
Default difficulty | 2player mode | Drakes + Rebels
[2p — Isle of Mists (Survival) replay 20210429-050016.gz](https://github.com/wesnoth/wesnoth/files/6395359/2p.Isle.of.Mists.Survival.replay.20210429-050016.gz)


Reviewers:
I would like to request reviews from nemaara, Pentarctagon and whoever is involved in MP scenario content development."
624844632,Write displayed fps values to disk.,Pentarctagon,2021-04-28 04:52:41+00:00,2021-04-29 03:59:49+00:00,{},
624699811,remove SDL2_ttf.a to codeblock projectfiles,newfrenchy83,2021-04-27 22:23:23+00:00,2021-04-27 22:53:49+00:00,{'Building': 1},
624576140,Add wesnoth.colors[name].pango_color and use it in the multiplayer turns-over dialog,stevecotton,2021-04-27 18:55:13+00:00,2021-04-28 08:44:19+00:00,"{'MP': 1, 'Unit Tests': 1, 'Lua API': 1}","The first of the two commits already has PR #5723, this PR will be for the second one once that merges. It's mainly about the unit test and whether `pango_color` is the right name.

Fixes #5722.

With Ravana's color changer mod:
![wesnoth_turns_over_with_popup_color](https://user-images.githubusercontent.com/101462/116296451-8b5f1a80-a79a-11eb-9a68-676147a48cb5.png)"
624359500,Keep the Windows CIs on a version of vcpkg that builds Wesnoth,stevecotton,2021-04-27 14:35:42+00:00,2021-04-27 18:03:57+00:00,{'Building': 1},"Quick workaround for #5741, the Windows builds weren't finding Pango's header
files when used with vcpkg version 546813ae7b9e2873dd3d38e78b27ac5582feae10
([glib up to gtk] update and make it work with meson).

Hopefully we can revert this workaround soon.

(Note: don't merge until the CI build has passed)"
622785113,add 'ability_id_active' attribute to filter,newfrenchy83,2021-04-25 15:22:47+00:00,2021-05-03 19:38:06+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1}","until now, only the tpe of ability could be filtered with activity, and id only for unit who have ability, same if she's inactive."
622688330,horse things,doofus-01,2021-04-25 03:44:39+00:00,2021-05-10 03:40:06+00:00,"{'Graphics': 1, 'Units': 1}"," - dunefolk cataphract touchups
 - basic horse
 - White Horse variation
 - zombie horses

Other horse things to come, as time permits."
622665463,Bump the minimum SDL2 version to 2.0.8 and remove workarounds which are no longer required,grz0,2021-04-24 23:46:06+00:00,2021-04-27 08:53:27+00:00,"{'Building': 1, 'SCons': 1, 'CMake': 1}","This PR bumps the minimum SDL2 version to 2.0.8.
Now we can remove:
* workarounds for a bug in SDL_FreeSurface() on SDL2.0.6
* surface::clear_without_free() method, now it has no users
* compile-time checks for SDL_CreateRGBSurfaceWithFormatFrom() availability
* a workaround for pre-SDL2.0.5 bug in SDL_BlitSurface()

`CVideo::~CVideo()` had the following version check:
`sdl_get_version() >= version_info(2, 0, 6)`
but it seems to me that it was incorrect, it should be `==`.
I think this is a workaround for the same issue as in `surface::free_surface()`, so I removed it.

Closes #5735 "
622650574,Don't check SDL version on each surface::free_surface() call,grz0,2021-04-24 21:17:31+00:00,2021-04-24 21:50:47+00:00,{},"While running Wesnoth under profiler I've noticed that  `free_surface()` always checks and compares SDL version to decide if
a workaround for SDL2.0.6 bug should be applied. This results in dynamic memory (de)allocations.
This check can be done only once and stored in a static variable, thus removing these memory allocations from the function which is called frequently in the rendering path.

Alternatively, the minimal SDL2 version could be bumped to 2.0.7, this would also allow removing some compile-time checks from the code.
"
622173766,[World Conquest] Last 2 deprecation code usage fixes.,knyghtmare,2021-04-23 15:59:07+00:00,2021-05-02 22:06:26+00:00,{'Campaign (any)': 1},"The Summary of this PR:
1. Fixed an un-added entry in the changelog
2. fixed the last 2 deprecation messages
3. removed instances of `wml.parsed` as it is no longer required.

Fixes #5650

Note: In regards to the last remaining error report, I want to open a fresh issue for it. So the existing one can be closed.


How do I request a review from CelticMinstrel and Soliton?"
621941824,Update the C++ version in CONTRIBUTING.md to C++17,stevecotton,2021-04-23 09:58:08+00:00,2021-04-23 14:07:54+00:00,{},
621212567,Add version to connection_history.,Pentarctagon,2021-04-22 15:37:33+00:00,2021-04-22 19:56:16+00:00,"{'MP': 1, 'Services': 1, 'Add-ons': 1}",
620329014,[World Conquest] multiple deprecated code fixes,knyghtmare,2021-04-21 15:43:25+00:00,2021-04-22 17:43:38+00:00,{'Campaign (any)': 1},"**Summary of this PR:**

1. Fixed most of the deprecated lua functions
2. Added new 1.15 Dunefolk enemy data Nested Array.
3. Re-added ""The Empire"" faction of World Conquest Era with ID fixes of 1.15 Dunefolk
4. Added Dunefolk units to the Heroes list
5. Replaced all Khalifate instances with Dunefolk
6. Reduced enemy strength by 25% (since I don't think it's winnable on the higher difficulty)
7. updated changelog

**Important Note on the deprecation code left:**
<https://forums.wesnoth.org/viewtopic.php?f=58&t=54219>

**Still existing bugs/crashes:**
1. It is possible to ""exploit"" the open gold, income, team, and controller settings in Side/Faction selection GUI menu and make Nightmare difficulty a joke.
2. After the completion of ""Final Battle"" scenario, there is an error message and it crashes to Main Menu. However, the campaign is completed and the replay is available.
[WC II 1 Final Battle -  replay 20210415-060343.gz](https://github.com/wesnoth/wesnoth/files/6352170/WC.II.1.Final.Battle.-.replay.20210415-060343.gz)


**Note:**
How do I add particular users to ask for a review? Possibly CelticMinstrel and/or gfgtdf (if he is still active)."
620198513,Add IntroWML support for text labels on maps,stevecotton,2021-04-21 13:08:14+00:00,2021-05-17 06:47:12+00:00,"{'Enhancement': 1, 'Campaign (any)': 1, 'Graphics': 1, 'UI': 1, 'WML': 1, 'WML Tools': 1, 'Schema': 1}","Opening as a draft to discuss whether this feature should be included in 1.16, the roadmap issue for it is #5041.

My plan is to merge the API change (the first commit) in time for 1.15.13, which would allow UMC to hand-code labels using it. The trackplacer change still needs work, but changes to that tool could still be done in the 1.16 branch. Making a journey in the current version of trackplacer will give the right coordinates to cut & paste for the label.

This adds a `[story][part][image]label=` attribute, allowing the `[image]` tag
to draw either images, text, or both. Putting both functionalities on the same
tag has tradeoffs - the tag name is now a bit inaccurate, however it allows
having landmarks with captions on the map such as

	[image]
		x,y=1030,391
		file=""map_icons/dwarven_door.png""
		label=_ ""map_label^Kal Kartha""
	[/image]

For the label, the x and y coordinates aren't the exact placement of the text,
instead they're the location of the place that the text should label.

I'm not expecting the IntroWML labels to reach mainline campaign quality, they're not going to be anywhere near a hand-kerned text by an artist fitting the lettering to the features of the map. I'm hoping that they'd be used by UMC.

Example image - Dead Water's map using only WML labels
---

The italic 'd' on 'Bildheld' gets cut, which is probably a bug in pango_text's width calculation. That's a problem which I would expect to fix as part of this.
![wesnoth_introwml_dw_map](https://user-images.githubusercontent.com/101462/115557230-cef4e880-a2b1-11eb-8de5-7d558ef18b00.png)
The text scales with the image size. I've cropped the edges off the larger screenshot."
619725413,fix text don't readable because duration not specified,newfrenchy83,2021-04-20 22:22:09+00:00,2021-04-21 19:38:39+00:00,{'Campaign (any)': 1},"When a enemy is killed in 23_Test_of_the_Clans.cfg of Httt, the show of number to enmy to vanquish is too breve for be read."
619547940,Multiplayer turns over dialog: stop using %d and %s in translatable strings,stevecotton,2021-04-20 17:57:45+00:00,2021-04-28 07:11:29+00:00,"{'MP': 1, 'Translations': 1, 'Low Priority': 1}","This should probably be changed into a table of GUI2 widgets, but this commit
is an improvement on what was here before. It removes the broken conjunct list
formatting for 3-way ties. However, it also means that there are 5 lines per
language to translate again.

Fixes #4274."
619273365,UtBS: Use $amount instead of %d in the teaching ability,stevecotton,2021-04-20 12:16:00+00:00,2021-04-23 07:57:12+00:00,"{'Campaign (any)': 1, 'Translations': 1}",Part of #4436
617400135,Fix save_index issues,grz0,2021-04-18 00:25:29+00:00,2021-04-22 05:23:11+00:00,"{'Bug': 1, 'Engine': 1}","This pull request fixes some issues related to save_index:
* fixes a bug in save_index_class::remove() method.
  The method incorrectly tries to remove an attribute from root config instead of removing 'save' children.
  In effect, save files were not being removed from the save_index file.
* removes call to save_index_manager_->remove() in savegame::finish_save_game
  This call to remove() is incorrect and has no effect except causing unneeded call to write_save_index().
* introduces a new clean_up_index() method in save_index_class.
  The method removes non-existing save files from the index. Clean up is triggered only during the first
  synchronisation of the index to disc and only if the index has more save files than found on disk.

Fixes  #5702."
617380604,Xcode: Disable hardened runtime on debug builds,CelticMinstrel,2021-04-17 21:05:24+00:00,2022-06-14 16:19:16+00:00,"{'macOS': 1, 'Building': 1}",These are the changes I needed to make to the project in order to build. I'm open to suggestions if there's a better way.
617339059,run_wml_tests: Print the correct test name when a test fails,stevecotton,2021-04-17 17:17:01+00:00,2021-04-19 05:41:03+00:00,"{'Unit Tests': 1, 'Building': 1}","The fix in 9535ed9 didn't work, the script still crashed on that line, the
logic for working out how many tests in the batch had passed wasn't correct.
This commit drops that logic, and drops the dependent feature of trying to
retry the next test in the batch, and simply says the entire batch failed.

The new logic for filtering the output of a failed batch is much simpler - the
script doesn't filter it and we assume the developer is just going to ignore
any line that starts ""PASS TEST"". Only tests that are expected to pass get
batched, so the output is going to look something like the following:

	PASS TEST: test_return
	PASS TEST: test_assert
	PASS TEST: test_return_2
	PASS TEST: test_assert_2
	Assertion failed: assert false
	FAIL TEST: test_assert_fail

	Failure, Wesnoth returned 1 FAIL but we expected 0 PASS

A set of constants is added defining how many -v arguments are needed to
enable a given set of debugging output. Expectation is that level 0 is normal,
and level 1 is for developers who like long-running build processes to print
something to show that they're not stuck.

Complete output when all tests pass, without `-v`:
```
WML Unit Tests Result: 246 of 246 tests passed
```

Output when a test times out during the main batch. This doesn't get the name directly, but searching through the list of what was in the batch shows that `recruit_facing_center` should be followed by `check_victory_basic_timeout`. That's a bit more work for the developer, but it's much better than printing the wrong name.
```
Timed out (killed by Python timeout implementation), while running batch (test_return, test_assert, fixed_lua_random_replay_with_sync_choice, test_end_turn, cve_2018_1999023, two_plus_two, order_of_nested_events, test_clear_one, test_clear_two, test_unit_map, unit_spawns_at_nearest_vacant_hex, units_offmap_goto_recall, recall_by_unit_tag, test_move, test_move_unit, test_move_unit_in_circle, sighted_events, sighted_on_opponents_turn, move_skip_no_sighted_no_share_view, move_skip_ally_sighted_no_share_view, move_skip_all_sighted_no_share_view, move_skip_no_sighted_yes_share_view, move_skip_ally_sighted_yes_share_view, move_skip_all_sighted_yes_share_view, set_gold_in_prestart_one, set_gold_in_prestart_two, modify_turns_one, modify_turns_two, modify_turns_three, modify_turns_four, replace_schedule_prestart, modify_unit_facing, event_handlers_in_events_1, event_handlers_in_events_3, event_handlers_in_events_2, event_handlers_in_events_4, event_handlers_in_events_5, event_handlers_in_events_6, event_handlers_in_events_7, event_handlers_in_events_8, event_handers_in_events__delayed, event_handlers_in_events__dynamic_filter, event_remove_test, event_repeat_test, event_test_auto_variables_side_turn, event_test_auto_variables_xy, event_test_auto_variables_units, event_test_auto_variables_weapons, event_test_auto_variables_damage, event_test_auto_variables_owner, event_test_filter_condition, event_test_filter_side, event_test_filter_unit, event_test_filter_attack, filter_vision, scatter_units, has_ally, xp_mod_1, xp_mod_2, xp_mod_3, test_role_1, test_role_2, test_role_3, test_role_lua, events-test_nonfilterable, events-test_filterable1, events-test_filterable2, events-test_filterable3, events-test_victory, events-test_defeat, events-test_die, test_store_unit_defense_on, test_terrain_mask_simple_nop, test_terrain_mask_simple_set, test_terrain_mask_simple_underlay, test_terrain_mask_simple_overlay, test_terrain_mask_simple_name, test_terrain_mask_simple_name_fail, test_terrain_mask_align_odd_on_odd, test_terrain_mask_align_odd_on_even, test_terrain_mask_align_even_on_odd, test_terrain_mask_align_even_on_even, test_terrain_mask_align_raw_on_odd, test_terrain_mask_align_raw_on_even, test_terrain_mask_deprecated_border_no, test_terrain_mask_deprecated_border_yes, test_terrain_mask_rule_basic, lua_dofile, lua_require, lua_get_sides, test_wml_actions, test_wml_conditionals, lua_wml_tagnames, test_scoped_vars, as_text, store_locations_one, store_locations_range, simple_find_path, characterize_pathfinding_reach_1, characterize_pathfinding_reach_2, characterize_pathfinding_reach_3, characterize_pathfinding_reach_4, characterize_pathfinding_reach_5, characterize_pathfinding_reach_6, characterize_pathfinding_reach_7, test_elf_movement, test_orc_movement, test_elf_fast_cave_movement, test_elf_fast_hills_movement, test_elf_fast_cave_and_hills_movement, test_orc_fast_cave_movement, test_orc_fast_forest_movement, test_elf_slow_cave_movement, test_elf_longsighted_movement, test_orc_longsighted_movement, test_elf_longsighted_fast_cave_movement, test_elf_fast_cave_longsighted_movement, test_elf_vision, test_elf_fast_cave_vision, test_elf_fast_hills_vision, test_elf_longsighted_cave_vision, test_elf_longsighted_cave_and_hills_vision, test_elf_longsighted_cave_slow_cave_vision, test_resistances, effect_move_affects_vision, effect_move_ignores_vision, effect_vision, store_reachable_locations_vision, test_grunt_tod_damage, test_time_area_damage, test_time_area_prestart, test_berzerk_firststrike, feeding, swarm_disables_upgrades, swarm_disables_upgrades_with_abilities, swarm_disables_upgrades_with_abilities_fail, swarm_disables_upgrades_with_abilities_adjacent, swarm_disables_upgrades_with_abilities_adjacent_fail, swarm_disables_upgrades_with_abilities_adjacent_leadership, swarm_disables_upgrades_with_abilities_adjacent_leadership_fail, test_force_chance_to_hit_macro, recruit_facing_enemy_one, recruit_facing_enemy_two, recruit_facing_leader, recruit_facing_center, check_victory_basic_timeout, test_wml_menu_items_1, test_wml_menu_items_3, check_conditionals_1, check_conditionals_2, filter_this_unit_wml, filter_this_unit_tl, filter_this_unit_formula, filter_formula_unit, check_interrupts_break, check_interrupts_return, check_interrupts_continue, check_interrupts_break_global, check_interrupts_return_nested, check_interrupts_continue_global, check_interrupts_elseif, check_interrupts_case, forloop_all_zero, forloop_step_zero, forloop_once_positive, forloop_once_negative, forloop_twice_matched, forloop_twice_unmatched, forloop_empty_array, forloop_array, forloop_array_reverse, forloop_step_large_positive, forloop_step_large_negative, for_defaults, for_start2, for_end2, for_end2_step2, for_end-2, for_end-2_step-2, test_basic_simplified_aspect, test_basic_abbreviated_aspect, test_basic_standard_aspect, test_basic_composite_aspect, test_basic_lua_aspect, test_basic_composite_facet, test_basic_lua_facet, test_basic_composite_default_facet, test_basic_lua_default_facet, test_modify_ai_delete_facet, test_modify_ai_change_facet, test_modify_ai_replace_facet, test_modify_ai_add_facet, test_modify_ai_change_default_facet, test_modify_ai_nested_facets, test_modify_ai_composite_default_facets, test_modify_ai_change_aspect, test_create_side, order_of_variable_events1, order_of_variable_events2, event_name_variable_substitution, heal)
PASS TEST: test_return
PASS TEST: test_assert
PASS TEST: fixed_lua_random_replay_with_sync_choice
... about 200 more PASS TEST lines ...
PASS TEST: test_force_chance_to_hit_macro
PASS TEST: recruit_facing_enemy_one
PASS TEST: recruit_facing_enemy_two
PASS TEST: recruit_facing_leader
PASS TEST: recruit_facing_center

Failure, Wesnoth returned 2 TIMEOUT but we expected 0 PASS
Passed 46 of 247 tests
Failed batches containing 201 tests: (test_return, test_assert, fixed_lua_random_replay_with_sync_choice, test_end_turn, cve_2018_1999023, two_plus_two, order_of_nested_events, test_clear_one, test_clear_two, test_unit_map, unit_spawns_at_nearest_vacant_hex, units_offmap_goto_recall, recall_by_unit_tag, test_move, test_move_unit, test_move_unit_in_circle, sighted_events, sighted_on_opponents_turn, move_skip_no_sighted_no_share_view, move_skip_ally_sighted_no_share_view, move_skip_all_sighted_no_share_view, move_skip_no_sighted_yes_share_view, move_skip_ally_sighted_yes_share_view, move_skip_all_sighted_yes_share_view, set_gold_in_prestart_one, set_gold_in_prestart_two, modify_turns_one, modify_turns_two, modify_turns_three, modify_turns_four, replace_schedule_prestart, modify_unit_facing, event_handlers_in_events_1, event_handlers_in_events_3, event_handlers_in_events_2, event_handlers_in_events_4, event_handlers_in_events_5, event_handlers_in_events_6, event_handlers_in_events_7, event_handlers_in_events_8, event_handers_in_events__delayed, event_handlers_in_events__dynamic_filter, event_remove_test, event_repeat_test, event_test_auto_variables_side_turn, event_test_auto_variables_xy, event_test_auto_variables_units, event_test_auto_variables_weapons, event_test_auto_variables_damage, event_test_auto_variables_owner, event_test_filter_condition, event_test_filter_side, event_test_filter_unit, event_test_filter_attack, filter_vision, scatter_units, has_ally, xp_mod_1, xp_mod_2, xp_mod_3, test_role_1, test_role_2, test_role_3, test_role_lua, events-test_nonfilterable, events-test_filterable1, events-test_filterable2, events-test_filterable3, events-test_victory, events-test_defeat, events-test_die, test_store_unit_defense_on, test_terrain_mask_simple_nop, test_terrain_mask_simple_set, test_terrain_mask_simple_underlay, test_terrain_mask_simple_overlay, test_terrain_mask_simple_name, test_terrain_mask_simple_name_fail, test_terrain_mask_align_odd_on_odd, test_terrain_mask_align_odd_on_even, test_terrain_mask_align_even_on_odd, test_terrain_mask_align_even_on_even, test_terrain_mask_align_raw_on_odd, test_terrain_mask_align_raw_on_even, test_terrain_mask_deprecated_border_no, test_terrain_mask_deprecated_border_yes, test_terrain_mask_rule_basic, lua_dofile, lua_require, lua_get_sides, test_wml_actions, test_wml_conditionals, lua_wml_tagnames, test_scoped_vars, as_text, store_locations_one, store_locations_range, simple_find_path, characterize_pathfinding_reach_1, characterize_pathfinding_reach_2, characterize_pathfinding_reach_3, characterize_pathfinding_reach_4, characterize_pathfinding_reach_5, characterize_pathfinding_reach_6, characterize_pathfinding_reach_7, test_elf_movement, test_orc_movement, test_elf_fast_cave_movement, test_elf_fast_hills_movement, test_elf_fast_cave_and_hills_movement, test_orc_fast_cave_movement, test_orc_fast_forest_movement, test_elf_slow_cave_movement, test_elf_longsighted_movement, test_orc_longsighted_movement, test_elf_longsighted_fast_cave_movement, test_elf_fast_cave_longsighted_movement, test_elf_vision, test_elf_fast_cave_vision, test_elf_fast_hills_vision, test_elf_longsighted_cave_vision, test_elf_longsighted_cave_and_hills_vision, test_elf_longsighted_cave_slow_cave_vision, test_resistances, effect_move_affects_vision, effect_move_ignores_vision, effect_vision, store_reachable_locations_vision, test_grunt_tod_damage, test_time_area_damage, test_time_area_prestart, test_berzerk_firststrike, feeding, swarm_disables_upgrades, swarm_disables_upgrades_with_abilities, swarm_disables_upgrades_with_abilities_fail, swarm_disables_upgrades_with_abilities_adjacent, swarm_disables_upgrades_with_abilities_adjacent_fail, swarm_disables_upgrades_with_abilities_adjacent_leadership, swarm_disables_upgrades_with_abilities_adjacent_leadership_fail, test_force_chance_to_hit_macro, recruit_facing_enemy_one, recruit_facing_enemy_two, recruit_facing_leader, recruit_facing_center, check_victory_basic_timeout, test_wml_menu_items_1, test_wml_menu_items_3, check_conditionals_1, check_conditionals_2, filter_this_unit_wml, filter_this_unit_tl, filter_this_unit_formula, filter_formula_unit, check_interrupts_break, check_interrupts_return, check_interrupts_continue, check_interrupts_break_global, check_interrupts_return_nested, check_interrupts_continue_global, check_interrupts_elseif, check_interrupts_case, forloop_all_zero, forloop_step_zero, forloop_once_positive, forloop_once_negative, forloop_twice_matched, forloop_twice_unmatched, forloop_empty_array, forloop_array, forloop_array_reverse, forloop_step_large_positive, forloop_step_large_negative, for_defaults, for_start2, for_end2, for_end2_step2, for_end-2, for_end-2_step-2, test_basic_simplified_aspect, test_basic_abbreviated_aspect, test_basic_standard_aspect, test_basic_composite_aspect, test_basic_lua_aspect, test_basic_composite_facet, test_basic_lua_facet, test_basic_composite_default_facet, test_basic_lua_default_facet, test_modify_ai_delete_facet, test_modify_ai_change_facet, test_modify_ai_replace_facet, test_modify_ai_add_facet, test_modify_ai_change_default_facet, test_modify_ai_nested_facets, test_modify_ai_composite_default_facets, test_modify_ai_change_aspect, test_create_side, order_of_variable_events1, order_of_variable_events2, event_name_variable_substitution, heal)
```

Output when a test fails during the main batch, without `-v`:
```
PASS TEST: test_return
PASS TEST: test_assert
PASS TEST: fixed_lua_random_replay_with_sync_choice
PASS TEST: test_end_turn
PASS TEST: cve_2018_1999023
... about 200 more PASS TEST lines ...
PASS TEST: test_force_chance_to_hit_macro
PASS TEST: recruit_facing_enemy_one
PASS TEST: recruit_facing_enemy_two
PASS TEST: recruit_facing_leader
PASS TEST: recruit_facing_center
FAIL TEST: check_victory_basic_fail

Failure, Wesnoth returned 1 FAIL but we expected 0 PASS
Passed 46 of 247 tests
Failed batches containing 201 tests: (test_return, test_assert, fixed_lua_random_replay_with_sync_choice, test_end_turn, cve_2018_1999023, two_plus_two, order_of_nested_events, test_clear_one, test_clear_two, test_unit_map, unit_spawns_at_nearest_vacant_hex, units_offmap_goto_recall, recall_by_unit_tag, test_move, test_move_unit, test_move_unit_in_circle, sighted_events, sighted_on_opponents_turn, move_skip_no_sighted_no_share_view, move_skip_ally_sighted_no_share_view, move_skip_all_sighted_no_share_view, move_skip_no_sighted_yes_share_view, move_skip_ally_sighted_yes_share_view, move_skip_all_sighted_yes_share_view, set_gold_in_prestart_one, set_gold_in_prestart_two, modify_turns_one, modify_turns_two, modify_turns_three, modify_turns_four, replace_schedule_prestart, modify_unit_facing, event_handlers_in_events_1, event_handlers_in_events_3, event_handlers_in_events_2, event_handlers_in_events_4, event_handlers_in_events_5, event_handlers_in_events_6, event_handlers_in_events_7, event_handlers_in_events_8, event_handers_in_events__delayed, event_handlers_in_events__dynamic_filter, event_remove_test, event_repeat_test, event_test_auto_variables_side_turn, event_test_auto_variables_xy, event_test_auto_variables_units, event_test_auto_variables_weapons, event_test_auto_variables_damage, event_test_auto_variables_owner, event_test_filter_condition, event_test_filter_side, event_test_filter_unit, event_test_filter_attack, filter_vision, scatter_units, has_ally, xp_mod_1, xp_mod_2, xp_mod_3, test_role_1, test_role_2, test_role_3, test_role_lua, events-test_nonfilterable, events-test_filterable1, events-test_filterable2, events-test_filterable3, events-test_victory, events-test_defeat, events-test_die, test_store_unit_defense_on, test_terrain_mask_simple_nop, test_terrain_mask_simple_set, test_terrain_mask_simple_underlay, test_terrain_mask_simple_overlay, test_terrain_mask_simple_name, test_terrain_mask_simple_name_fail, test_terrain_mask_align_odd_on_odd, test_terrain_mask_align_odd_on_even, test_terrain_mask_align_even_on_odd, test_terrain_mask_align_even_on_even, test_terrain_mask_align_raw_on_odd, test_terrain_mask_align_raw_on_even, test_terrain_mask_deprecated_border_no, test_terrain_mask_deprecated_border_yes, test_terrain_mask_rule_basic, lua_dofile, lua_require, lua_get_sides, test_wml_actions, test_wml_conditionals, lua_wml_tagnames, test_scoped_vars, as_text, store_locations_one, store_locations_range, simple_find_path, characterize_pathfinding_reach_1, characterize_pathfinding_reach_2, characterize_pathfinding_reach_3, characterize_pathfinding_reach_4, characterize_pathfinding_reach_5, characterize_pathfinding_reach_6, characterize_pathfinding_reach_7, test_elf_movement, test_orc_movement, test_elf_fast_cave_movement, test_elf_fast_hills_movement, test_elf_fast_cave_and_hills_movement, test_orc_fast_cave_movement, test_orc_fast_forest_movement, test_elf_slow_cave_movement, test_elf_longsighted_movement, test_orc_longsighted_movement, test_elf_longsighted_fast_cave_movement, test_elf_fast_cave_longsighted_movement, test_elf_vision, test_elf_fast_cave_vision, test_elf_fast_hills_vision, test_elf_longsighted_cave_vision, test_elf_longsighted_cave_and_hills_vision, test_elf_longsighted_cave_slow_cave_vision, test_resistances, effect_move_affects_vision, effect_move_ignores_vision, effect_vision, store_reachable_locations_vision, test_grunt_tod_damage, test_time_area_damage, test_time_area_prestart, test_berzerk_firststrike, feeding, swarm_disables_upgrades, swarm_disables_upgrades_with_abilities, swarm_disables_upgrades_with_abilities_fail, swarm_disables_upgrades_with_abilities_adjacent, swarm_disables_upgrades_with_abilities_adjacent_fail, swarm_disables_upgrades_with_abilities_adjacent_leadership, swarm_disables_upgrades_with_abilities_adjacent_leadership_fail, test_force_chance_to_hit_macro, recruit_facing_enemy_one, recruit_facing_enemy_two, recruit_facing_leader, recruit_facing_center, check_victory_basic_fail, test_wml_menu_items_1, test_wml_menu_items_3, check_conditionals_1, check_conditionals_2, filter_this_unit_wml, filter_this_unit_tl, filter_this_unit_formula, filter_formula_unit, check_interrupts_break, check_interrupts_return, check_interrupts_continue, check_interrupts_break_global, check_interrupts_return_nested, check_interrupts_continue_global, check_interrupts_elseif, check_interrupts_case, forloop_all_zero, forloop_step_zero, forloop_once_positive, forloop_once_negative, forloop_twice_matched, forloop_twice_unmatched, forloop_empty_array, forloop_array, forloop_array_reverse, forloop_step_large_positive, forloop_step_large_negative, for_defaults, for_start2, for_end2, for_end2_step2, for_end-2, for_end-2_step-2, test_basic_simplified_aspect, test_basic_abbreviated_aspect, test_basic_standard_aspect, test_basic_composite_aspect, test_basic_lua_aspect, test_basic_composite_facet, test_basic_lua_facet, test_basic_composite_default_facet, test_basic_lua_default_facet, test_modify_ai_delete_facet, test_modify_ai_change_facet, test_modify_ai_replace_facet, test_modify_ai_add_facet, test_modify_ai_change_default_facet, test_modify_ai_nested_facets, test_modify_ai_composite_default_facets, test_modify_ai_change_aspect, test_create_side, order_of_variable_events1, order_of_variable_events2, event_name_variable_substitution, heal)
```

With `-v` and all tests passing, it looks like this:
```
Running test test_return_fail
Running test test_assert_fail
Running test test_assert_fail_two
Running test empty_test
Running test break_replay_with_lua_random
Running test cve_2018_1999023_2
Running test check_victory_basic_timeout
Running test check_victory_basic_macro_check
Running test check_victory_basic
Running test check_victory_basic_fail
Running test check_victory_basic_two
Running test check_victory_basic_ai
Running test check_victory_basic_ai_fail
Running test check_victory_basic_ai_two
Running test check_victory_one_no_units_fail_one
Running test check_victory_one_no_units_fail_two
Running test check_victory_one_no_units
Running test check_victory_two_no_units_fail_one
Running test check_victory_two_no_units_fail_two
Running test check_victory_two_no_units
Running test check_victory_always_one
Running test check_victory_always_two
Running test check_victory_always_no_units_fail
Running test check_victory_always_no_units
Running test check_victory_always_fail
Running test check_victory_never_fail_one
Running test check_victory_never_fail_two
Running test check_victory_never_fail_three
Running test check_victory_never_pass
Running test check_victory_never_ai_fail
Running test two_plus_two_fail
Running test test_move_fail_1
Running test test_move_fail_2
Running test test_move_fail_3
Running test test_move_fail_4
Running test test_move_fail_5
Running test test_move_fail_6
Running test test_store_unit_defense_deprecated
Running test alice_kills_bob
Running test bob_kills_alice_on_retal
Running test alice_kills_bob_levelup
Running test bob_kills_alice
Running test alice_kills_bob_on_retal
Running test alice_kills_bob_on_retal_levelup
Running test test_wml_menu_items_2
Running test filter_formula_unit_error
Running 200 tests (test_return, test_assert, fixed_lua_random_replay_with_sync_choice, test_end_turn, cve_2018_1999023, two_plus_two, order_of_nested_events, test_clear_one, test_clear_two, test_unit_map, unit_spawns_at_nearest_vacant_hex, units_offmap_goto_recall, recall_by_unit_tag, test_move, test_move_unit, test_move_unit_in_circle, sighted_events, sighted_on_opponents_turn, move_skip_no_sighted_no_share_view, move_skip_ally_sighted_no_share_view, move_skip_all_sighted_no_share_view, move_skip_no_sighted_yes_share_view, move_skip_ally_sighted_yes_share_view, move_skip_all_sighted_yes_share_view, set_gold_in_prestart_one, set_gold_in_prestart_two, modify_turns_one, modify_turns_two, modify_turns_three, modify_turns_four, replace_schedule_prestart, modify_unit_facing, event_handlers_in_events_1, event_handlers_in_events_3, event_handlers_in_events_2, event_handlers_in_events_4, event_handlers_in_events_5, event_handlers_in_events_6, event_handlers_in_events_7, event_handlers_in_events_8, event_handers_in_events__delayed, event_handlers_in_events__dynamic_filter, event_remove_test, event_repeat_test, event_test_auto_variables_side_turn, event_test_auto_variables_xy, event_test_auto_variables_units, event_test_auto_variables_weapons, event_test_auto_variables_damage, event_test_auto_variables_owner, event_test_filter_condition, event_test_filter_side, event_test_filter_unit, event_test_filter_attack, filter_vision, scatter_units, has_ally, xp_mod_1, xp_mod_2, xp_mod_3, test_role_1, test_role_2, test_role_3, test_role_lua, events-test_nonfilterable, events-test_filterable1, events-test_filterable2, events-test_filterable3, events-test_victory, events-test_defeat, events-test_die, test_store_unit_defense_on, test_terrain_mask_simple_nop, test_terrain_mask_simple_set, test_terrain_mask_simple_underlay, test_terrain_mask_simple_overlay, test_terrain_mask_simple_name, test_terrain_mask_simple_name_fail, test_terrain_mask_align_odd_on_odd, test_terrain_mask_align_odd_on_even, test_terrain_mask_align_even_on_odd, test_terrain_mask_align_even_on_even, test_terrain_mask_align_raw_on_odd, test_terrain_mask_align_raw_on_even, test_terrain_mask_deprecated_border_no, test_terrain_mask_deprecated_border_yes, test_terrain_mask_rule_basic, lua_dofile, lua_require, lua_get_sides, test_wml_actions, test_wml_conditionals, lua_wml_tagnames, test_scoped_vars, as_text, store_locations_one, store_locations_range, simple_find_path, characterize_pathfinding_reach_1, characterize_pathfinding_reach_2, characterize_pathfinding_reach_3, characterize_pathfinding_reach_4, characterize_pathfinding_reach_5, characterize_pathfinding_reach_6, characterize_pathfinding_reach_7, test_elf_movement, test_orc_movement, test_elf_fast_cave_movement, test_elf_fast_hills_movement, test_elf_fast_cave_and_hills_movement, test_orc_fast_cave_movement, test_orc_fast_forest_movement, test_elf_slow_cave_movement, test_elf_longsighted_movement, test_orc_longsighted_movement, test_elf_longsighted_fast_cave_movement, test_elf_fast_cave_longsighted_movement, test_elf_vision, test_elf_fast_cave_vision, test_elf_fast_hills_vision, test_elf_longsighted_cave_vision, test_elf_longsighted_cave_and_hills_vision, test_elf_longsighted_cave_slow_cave_vision, test_resistances, effect_move_affects_vision, effect_move_ignores_vision, effect_vision, store_reachable_locations_vision, test_grunt_tod_damage, test_time_area_damage, test_time_area_prestart, test_berzerk_firststrike, feeding, swarm_disables_upgrades, swarm_disables_upgrades_with_abilities, swarm_disables_upgrades_with_abilities_fail, swarm_disables_upgrades_with_abilities_adjacent, swarm_disables_upgrades_with_abilities_adjacent_fail, swarm_disables_upgrades_with_abilities_adjacent_leadership, swarm_disables_upgrades_with_abilities_adjacent_leadership_fail, test_force_chance_to_hit_macro, recruit_facing_enemy_one, recruit_facing_enemy_two, recruit_facing_leader, recruit_facing_center, test_wml_menu_items_1, test_wml_menu_items_3, check_conditionals_1, check_conditionals_2, filter_this_unit_wml, filter_this_unit_tl, filter_this_unit_formula, filter_formula_unit, check_interrupts_break, check_interrupts_return, check_interrupts_continue, check_interrupts_break_global, check_interrupts_return_nested, check_interrupts_continue_global, check_interrupts_elseif, check_interrupts_case, forloop_all_zero, forloop_step_zero, forloop_once_positive, forloop_once_negative, forloop_twice_matched, forloop_twice_unmatched, forloop_empty_array, forloop_array, forloop_array_reverse, forloop_step_large_positive, forloop_step_large_negative, for_defaults, for_start2, for_end2, for_end2_step2, for_end-2, for_end-2_step-2, test_basic_simplified_aspect, test_basic_abbreviated_aspect, test_basic_standard_aspect, test_basic_composite_aspect, test_basic_lua_aspect, test_basic_composite_facet, test_basic_lua_facet, test_basic_composite_default_facet, test_basic_lua_default_facet, test_modify_ai_delete_facet, test_modify_ai_change_facet, test_modify_ai_replace_facet, test_modify_ai_add_facet, test_modify_ai_change_default_facet, test_modify_ai_nested_facets, test_modify_ai_composite_default_facets, test_modify_ai_change_aspect, test_create_side, order_of_variable_events1, order_of_variable_events2, event_name_variable_substitution, heal)
Passed 246 of 246 tests
```"
617308286,macOs/cmake build fix proposal.,devnexen,2021-04-17 13:35:39+00:00,2021-04-18 17:22:35+00:00,"{'Building': 1, 'CMake': 1}",
616379397,Fix teaching_anim not implmmented in variation_id=sceptre of Httt Princess and Battle Princess,newfrenchy83,2021-04-15 21:43:20+00:00,2021-05-03 00:40:49+00:00,"{'Campaign (any)': 1, 'Units': 1}","

I have forget to pull this in variation scpeter of unit_type"
615878750,Fix the indentation in test_lua_wml,stevecotton,2021-04-15 09:16:50+00:00,2021-04-15 18:32:43+00:00,{'Unit Tests': 1},"This main change here is moving tags to their own line, to avoid wmlindent
bug #1397. The lua gets a manual tabs-to-spaces conversion."
615701975,Scope exit utilities,CelticMinstrel,2021-04-15 04:23:15+00:00,2021-04-15 23:02:34+00:00,"{'macOS': 1, 'UI': 1, 'Units': 1, 'Building': 1}","This is for future use, especially in #5663 - since it wasn't directly related to events, I extracted it to a separate PR.

I'll merge this in a day or two unless there are any comments (for example, maybe someone has a better name than `guard_value`?).

"
615699348,Add a Lua unit_test module only available in [test] scenarios,CelticMinstrel,2021-04-15 04:15:17+00:00,2021-04-26 01:04:50+00:00,"{'Unit Tests': 1, 'Lua API': 1}","This is for future use, especially in #5663 - it was requested that it be extracted to a separate PR, so here it is."
615364396,Balance changes for version 1.15.12,Hejnewar,2021-04-14 16:04:28+00:00,2021-04-15 05:56:30+00:00,{'Units': 1},"Dunefolk:
Dune Blademaster gold cost changed from 52 to 57.
Dune Captain alignment changed from liminal to lawful.
Dune Cataphract gold cost changed from 61 to 62.
Dune Firetrooper gold cost changed from 50 to 41.
Dune Harrier gold cost changed from 46 to 47.
Dune Luminary gold cost changed from 53 to 38.
Dune Maruder gold cost changed from 52 to 60.
Dune Sky Hunter gold cost changed from 47 to 51.
Dune Spearmaster gold cost changed from 51 to 57.
Dune Wayfarer gold cost changed from 52 to 55.
Dune Windbolt gold cost changed from 50 to 49.
Dune Warmaster gold cost changed from 56 to 57, hp changed from 57 to 59, alignment changed from liminal to lawful.
Naga Ophidian gold cost changed from 24 to 22, melee damage changed from 7 to 6, ranged damage changed from 10 to 12.
Naga Ringcaster gold cost changed from 24 to 22.
Naga Sicarus gold cost changed from 46g, melee damage changed from 10 to 9, ranged damage changed from 12 to 13.
Naga Zephyr gold cost changed from 46g.

Woses:
Wose Sapling gold cost changed from 10 to 11.
Wose Shaman gold cost changed from 40 to 27, movement points changed from 3 to 4, melee damage changed from 9 to 12, ranged damage changed from 10 to 11, hp changed from 50 to 56.

Monsters:
Horned scarab gold cost changed from 12 to 11.
Update Rock Scorpion. 

Fix for #5701."
615266431,Make [store_reachable_locations]range=vision calculate vision,stevecotton,2021-04-14 13:58:53+00:00,2021-04-16 00:05:43+00:00,"{'Unit Tests': 1, 'WML': 1, 'Lua API': 1}","Previously it calculated max movement, and then added the adjacent hexes. This
version should correctly handle:
* units with vp different to max mp
* units with vision costs different to movement costs
* jamming by enemy units

An interactive test showing the before and after results is in #5704
Fixes #4179"
614979765,"scenario-test: Add a right-click ""show vision range"" option",stevecotton,2021-04-14 06:57:58+00:00,2021-04-15 10:58:37+00:00,{},"Make ""show attack range"" not overwrite the array for cleaning up
the ""show movement range"" command's display.

Add a label and tooltip about the enemy unit with jamming.

The new option shows the result of [store_reachable_locations]range=vision.
There are known issues (in #4179) with that for:
* units with vp different to mp
* units with vision costs different to movement costs
* jamming by enemy units"
613056033,Fix spelling errors in campain [german],FelixEngl,2021-04-11 11:23:07+00:00,2021-04-11 16:32:59+00:00,{'Translations': 1},"Hello everyone,

I fixed a few spelling errors/missing words/typos in the german dialogues and texts. 

Best regards

Felix"
613027062,Add warning if [variable] has multiple comparison attributes.,Pentarctagon,2021-04-11 07:43:42+00:00,2021-04-11 18:31:32+00:00,{},
612976609,Simplify canvas: renderer lifetime and only one list of shapes,stevecotton,2021-04-10 23:06:43+00:00,2021-04-15 01:50:07+00:00,{'UI': 1},"The renderer only needs to exist during draw(). The old implementation kept the
old renderer until the next call to draw(), but would then usually destroy the
old one and create a new one.

Canvas kept separate lists of what had already been drawn and what needed to be
drawn, but whenever changes happened all of the drawn_shapes_ were put back
into shapes_. No point in having two separate lists.

The list of shape needs pointers to support polymorphism, but doesn't need
shared_ptrs.

This is some cleanup to make #5681 slightly smaller."
612922392,Noticed some missing schema things,CelticMinstrel,2021-04-10 16:09:40+00:00,2021-04-10 22:18:48+00:00,{'Schema': 1},
612878481,Fixup 7cbc6c9d5d and 5bb0576e17,stevecotton,2021-04-10 10:53:12+00:00,2021-04-10 12:22:40+00:00,{'Unit Tests': 1},"Opening a PR just for the CI check, going to merge when it passes"
612830971,"When checking [variable] comparison attributes, return after checking the first one.",Pentarctagon,2021-04-10 04:19:17+00:00,2021-04-10 22:01:04+00:00,{},"The current implementation technically allows for there to be multiple comparison attributes present and it will return false if any of them are false or return true if all of them are true. This changes the implementation to only check the first comparison attribute found and return true or false based on that check, which is how the [variable] tag is documented as working on the wiki."
612786182,Fix better_attack evaluation for poison attacks,mattsc,2021-04-09 23:37:13+00:00,2021-04-10 16:26:44+00:00,{},"Poison is added to the attack damage when comparing attacks by the same unit with different weapons, but it should only be counted as a bonus if the enemy survives, otherwise it serves no purpose."
611917119,Use the database to store and retrieve login history for the searchlog command.,Pentarctagon,2021-04-08 20:48:37+00:00,2021-04-16 17:42:36+00:00,"{'MP': 1, 'Services': 1, 'Add-ons': 1}","This allows the history to be persisted across restarts, whereas right now it's lost."
611141547,More unit tests for events,CelticMinstrel,2021-04-08 01:30:00+00:00,2021-04-10 03:09:47+00:00,{'Unit Tests': 1},"This just exists to ensure CI passes, but if anyone wants to comment on the new tests, feel free."
610857982,Log an error if a [variable] is found that's not comparing any values.,Pentarctagon,2021-04-07 17:37:36+00:00,2021-04-07 22:08:46+00:00,{},
610817461,update codeblock projectfiles,newfrenchy83,2021-04-07 16:41:32+00:00,2021-04-07 16:47:01+00:00,{'Building': 1},
610630774,Rendering only a viewport area in pango_text,stevecotton,2021-04-07 12:38:49+00:00,2021-05-08 21:01:54+00:00,{'UI': 1},"This is meant to be an optimisation, which will reduce memory usage when
rendering text. It doesn't seem to reduce the amount of work done by Pango, but
the drawing will be clipped in the Cairo library.

The line-by-line workaround for rendering huge areas of text is dropped, as we
now only expect to be rendering screen-sized or smaller parts of the text.
Rendering huge texts (greater than 64kpixels high) requires the caller of
pango_text::render() to change to calling pango_text::render(SDL_Rect) instead.

This PR also changed text_shape to use the new render(SDL_Rect) function,
fixing the known crash when opening the credits screen. Fixes #3265, fixes #5043."
610630736,Only render the visible area in canvas.cpp,stevecotton,2021-04-07 12:38:45+00:00,2021-04-29 10:35:14+00:00,{'UI': 1},"If a widget is partially hidden or off-screen, this commit makes canvas.cpp
optimise and only draw the visible part.

Many of the asserts in canvas.cpp are removed, as the surface is no longer the
full canvas. The SDL_Render* functions do support the out-of-bounds and
negative values for x and y that are now passed to them, these are tested by
SDL2's testviewport.c.

Scrolling by a single pixel will force canvas::draw to do the full work of
redrawing the canvas. I had considered rendering a few of the off-screen lines
too, however it seems this isn't optimisable because the dirty flag is already
set on each redraw - that can be traced to window.cpp's push_draw_event()
causing canvas::set_is_dirty(true) to be called.

Refactor handling of the x, y, w, h variables with a common rect_bounded_shape
class, so that there are less code paths that might have unnoticed bugs."
610438373,Add check for illegal file names after the Save Game dialog,irydacea,2021-04-07 08:05:56+00:00,2021-04-08 21:12:54+00:00,"{'UI': 1, 'Add-ons': 1}","This moves the illegal file name logic out of the add-ons client/server code, refactors it a bit to allow whitespace by default, and adds the relevant check to the savegame code.

Closes #5679."
609894882,Fix building with ENABLE_DEBUG_WINDOW_LAYOUT,stevecotton,2021-04-06 14:21:42+00:00,2021-04-06 15:18:21+00:00,"{'UI': 1, 'Building': 1}","It turned out to not be the tool that I need, so please don't
ask me for any help using it."
609845287,Fix for Giant Scorpion having an empty variation name.,knyghtmare,2021-04-06 13:20:35+00:00,2021-04-06 16:01:58+00:00,{'Units': 1},"This PR restores the broken Help entry links for the unit and its sand scuttler variation.

Fixes #5676 "
609208761,fixed two grammatic mistakes in the sentences,wofwofwof,2021-04-05 21:07:14+00:00,2021-04-10 21:50:37+00:00,{'Translations': 1},
609046591,[MP] 2p - Dark Forecast scenario is now winnable in 2-player mode.,knyghtmare,2021-04-05 16:15:00+00:00,2021-04-05 19:02:26+00:00,{'MP': 1},"This PR makes Dark Forecast ""passable"" at default difficulty for 2 player mode. Initially, it was only passable if it was one-player-mode as one player could have 11 villages active and could get a good army built prior to the final wave.
2 player mode suffers from lack of resources to replace losses and would be unwinnable in some cases.

The change which has been made is that in 2-player-mode, the `village_support` has been set to 2.

The only 2 cases where it was won in 2 player mode was when the players were of _exceptionally high skill level_ but average skill-levelled players have yet to even win.

The enemy wave strength has been left untouched as the players can stand a chance now.

This PR fixes #5651 

Video Replays:
https://www.youtube.com/watch?v=w3VrWuS-IoU (Default Era)
https://youtu.be/zI3QCZr-1bg (UMC era)

[2p — Dark Forecast (Survival) replay 20210405-173408.gz](https://github.com/wesnoth/wesnoth/files/6258043/2p.Dark.Forecast.Survival.replay.20210405-173408.gz)"
608885190,Make the debug clock look right,stevecotton,2021-04-05 10:59:28+00:00,2021-04-06 15:57:01+00:00,{'UI': 1},"This is the only widget in mainline using GUI2's `[draw][circle]` tag. I'm
currently working on a change to the C++ `text_shape` class, and want to
be able to regression-test the placement of `[circle]`s after that change.

I'd be okay with deprecating both `[circle]` and `[round_rectangle]` as neither
seems to be used elsewhere, but this close to feature-freeze I'd prefer to keep
them in 1.16 rather than suggest removing them now.

To see the widget, start the game with `wesnoth --clock`, and then click the
button underneath ""Quit"" on the main menu.

Before and after:
![wesnoth_debug_clock_alignment](https://user-images.githubusercontent.com/101462/113567125-4f5aee80-960e-11eb-8f0f-5657ce4e7c2b.png)"
608678947,Various fauna-related things,doofus-01,2021-04-05 03:49:28+00:00,2021-04-19 01:07:39+00:00,"{'Graphics': 1, 'Units': 1}","For now, just rock scorpion pincer attack animation"
608624105,Unit tests for the various split functions,CelticMinstrel,2021-04-04 22:57:51+00:00,2021-04-05 17:35:52+00:00,"{'macOS': 1, 'Building': 1}","I want to modify these functions to take a string instead of a character as the separator, so these tests are intended to ensure they still work after the changes. This PR is just here for CI purposes; I'm not requesting a review on it. However, I'm still open to reviews if someone wants to take a look."
608578267,[MP] [2p - Dark Forecast] Make Survival scenario at least winnable in 2-player mode.,knyghtmare,2021-04-04 17:06:27+00:00,2021-04-05 16:14:43+00:00,{'MP': 1},"This PR makes Dark Forecast ""passable"" at default difficulty for 2 player mode. Initially, it was only passable if it was one-player-mode as one player could have 11 villages active and could get a good army built prior to the final wave.
2 player mode suffers from lack of resources to replace losses and would be unwinnable in some cases.

The change which has been made is that in 2-player-mode, the `village_support` has been set to 2.

The only 2 cases where it was won in 2 player mode was when the players were of _exceptionally high skill level_ but average skill-levelled players have yet to even win.

This PR fixes #5651 

Video Replays:
https://www.youtube.com/watch?v=w3VrWuS-IoU (Default Era)
https://youtu.be/zI3QCZr-1bg (UMC era)

[2p — Dark Forecast (Survival) replay 20210405-173408.gz](https://github.com/wesnoth/wesnoth/files/6258043/2p.Dark.Forecast.Survival.replay.20210405-173408.gz)
"
608577989,remove hard cut on convex walls of human castle ruins,doofus-01,2021-04-04 17:04:27+00:00,2021-04-04 19:08:48+00:00,"{'Graphics': 1, 'Terrain': 1}","This is to blend with sunken ruins, fixes #5611.  Not an exciting transition, but it removes the sharp vertical edge."
608502259,Update the animals Micro-AI demo with boars and piglets,stevecotton,2021-04-04 07:25:27+00:00,2021-04-04 18:23:46+00:00,{'AI': 1},"This adjusts to the change in e7b5996e988747c2b590852b4b461abe48857526.

The micro ai itself is unchanged, it's still controlled by `tusker_type` and
`tusklet_type`, it simply needed the new unit ids to be used in this scenario.

The demo can be run with `wesnoth -t animals`."
608489123,Refactor the game event system to be based on Lua at the core,CelticMinstrel,2021-04-04 05:16:46+00:00,2022-07-19 01:56:43+00:00,"{'macOS': 1, 'AI': 1, 'Campaign (any)': 1, 'MP': 1, 'Unit Tests': 1, 'UI': 1, 'Units': 1, 'Lua API': 1, 'Building': 1, 'WFL': 1, 'Schema': 1}","All events are now just a Lua function and a package of arguments that are passed to the function. A typical event added via WML (ie, with the `[event]` tag) is the function `wesnoth.wml_actions.command` with the contained ActionWML tags passed as the argument, so they work just the same as before. However, you can now add events in two other ways:

* ~Instead of using ActionWML, you can write the entire event inline as Lua code using `[event]code=`. Although this is similar to just using an event containing a single `[lua]` tag, there are some differences. The code is compiled when the event is added, rather than when it is executed, and the argument passed to the event code is a copy of the `[event]` tag with filter data and event name and ID stripped out.~
* You can now register an event directly from Lua using the new `wesnoth.game_events.add` function, which supercedes the `on_event()` system that World Conquest and a few other things depend on. Unlike `on_event()`, this interface supports everything that `[event]` does, such as `first_time_only=true` or giving the event an ID that will allow other events to remove it. It also supports some things that `[event]` doesn't, such as using an arbitrary Lua function to handle the event (although if you do this, the event becomes unserializable, just the same as if you used `on_event()`) or marking the event as a menu item event (meaning it will be removed if the menu item with the same ID is removed).

The other significant change in this PR is a refactor of the event filtering system, which would make it very easy to add a new type of filter if we wanted to in the future (although I'm not anticipating any new types). As part of that, two new ways of filtering in events have been added:

* The `filter_formula` key in `[event]` takes a WFL formula that determines whether the event should trigger. It can access all the event context info (like `loc1`, `event_id`, `unit1`, etc) as well as the game state (such as `map`, `units`, `turn`, and `time_of_day`). In particular, it exposes event context info that nothing else does in `event_data`, although there may not be any way to actually set that data yet in `[fire_event]`.
* ~The `filter` key in `[event]` takes Lua code that determines whether the event should trigger. If there is a `[filter_args]` tag, its contents is passed to this function.~
* In addition, when adding an event from Lua, you can pass an arbitrary Lua function as the filter. Doing this makes the event unserializable, of course.

One other thing I've done here is to divorce menu items from events at the Lua level. This was already the case in C++, and it seemed to make for a cleaner API. The relevant functions were never documented, so this is probably a minor thing, but basically: `wesnoth.interface.set_menu_item` adds or updates a menu item but does not make it do anything - the `[command]` tag is ignored. To make it do something, you need to use `wesnoth.game_events.add` to create the event that the menu item will trigger. Of course, `[set_menu_item]` still does both for you."
608474582,"remove reference to tusker, replace with boar or piglet",doofus-01,2021-04-04 02:21:11+00:00,2021-04-04 04:15:25+00:00,"{'Graphics': 1, 'Units': 1}","Mainline will no longer step on UMC use of ""Tuskers"".  Still using the tusker/gorer sprites for now."
608186078,Dark Forecast Lua file comment Typo fix,knyghtmare,2021-04-02 19:01:34+00:00,2021-04-02 19:51:47+00:00,{'MP': 1},"""cauculate"" does not seem to be any existing word and auto-corrects to ""calculate"" which seems more appropriate here."
608118028,Fix for weather change cheat in dark forecast,knyghtmare,2021-04-02 16:27:43+00:00,2021-04-02 23:19:03+00:00,{'MP': 1},"Adjusted the weather change effect from `side 3 turn` to `side 1 turn`. Side 1 is never empty so it would bypass the side 3 as empty cheat which impeded weather change.

Fixes #5653 

Also, I have playtested under the _cheat active_ conditions and found the weather change to working now."
608069398,Fix a typo,hexagonrecursion,2021-04-02 14:58:54+00:00,2021-04-02 15:19:52+00:00,{'Units': 1},"singular: brother; plural: brethren; plural possessive: brethren’s
granted: it is possible that this word is an exception. I'm not an expert"
608006244,Fix a typo in data/core/units/undead/Corpse_Necrophage.cfg,hexagonrecursion,2021-04-02 12:28:25+00:00,2021-04-02 15:20:09+00:00,{'Units': 1},"I can't find ""fratures"" in any dictionaries. I'm guessing the author intended to say ""creatures"""
602746531,[1.15] Make WFL's error-reporting machinery thread_local,stevecotton,2021-03-29 13:06:07+00:00,2021-04-01 14:19:49+00:00,"{'Bug': 1, 'WFL': 1}","To report the WFL call stack in the event of errors, a static stack is used to
record that call-stack. This wasn't thread-safe, and it intermittently crashed
when the game config was movetype patching (the other WFL thread involved is
the GUI2 layout code).

Also a Rule of Three fix for the call_stack_manager class. While this wasn't
the cause of the crash, it could also have lead to a call_stack.pop_back() on
an empty stack.

Fixes #5629."
602746511,[1.14] Make WFL's error-reporting machinery thread_local,stevecotton,2021-03-29 13:06:06+00:00,2021-04-01 14:19:41+00:00,"{'Bug': 1, 'WFL': 1}","To report the WFL call stack in the event of errors, a static stack is used to
record that call-stack. This wasn't thread-safe, and it intermittently crashed
when the game config was movetype patching (the other WFL thread involved is
the GUI2 layout code).

Also a Rule of Three fix for the call_stack_manager class. While this wasn't
the cause of the crash, it could also have lead to a call_stack.pop_back() on
an empty stack.

Fixes #5629."
602262836,pango_text: remove unused force options and single-character insertion,stevecotton,2021-03-28 15:55:30+00:00,2021-04-04 06:47:32+00:00,{'UI': 1},"The single-character insertion seems unlikely to be used in future. While
pango_text isn't a singleton, a few shared instances are created and then used
in a singleton-like way, with each caller assuming that it received it in an
unknown state and always calling set_text(), set_font_size(), set_font_style(),
etc.

This is a subset of the changes in #5617."
601991277,desktop/version: Use systemd's os-release file if available,irydacea,2021-03-27 03:17:35+00:00,2021-03-27 05:46:38+00:00,{},"(tl:dr ""run ci tests for me"" pr)

This allows us to obtain the OS version without blocking for a long amount of time waiting for lsb_release (which is deprecated anyway).

The parsing is intentionally basic."
601863633,modify overwrite_specials attributefor select the specials and weapon abilities who must be overwrited,newfrenchy83,2021-03-26 19:40:34+00:00,2021-04-21 04:30:23+00:00,"{'Units': 1, 'Schema': 1}","

The overwrite_specials attribute is limites to abilities/specials owned by fighter or teacher, the specials/abilities who affect fighter but owned by opponent(apply_to=opponent/both) not affected.
the new attribute is created for fix that bugbut also select the specials afected, if is apply_to=self or opponent or both"
601390306,Use the slow path for [modify_unit]facing=,stevecotton,2021-03-26 07:53:18+00:00,2021-03-26 19:29:09+00:00,"{'Bug': 1, 'Graphics': 1, 'WML': 1, 'Lua API': 1}","Fixes bug #4978, that changing the facing wasn't updating the display."
601150799,Fix units that should have zero max mp being given one mp,stevecotton,2021-03-25 23:13:08+00:00,2021-03-28 15:40:07+00:00,"{'Bug': 1, 'Unit Tests': 1, 'Units': 1, 'Regression': 1}","Fixes #5638 by correcting a cut & paste typo in 66a282a96be288a284d12a71625868cee5b2dc6b.

There's two commits here, the first of which is unit tests that are also in PR #5434. I'm not sure if it's too much testing for the amount of C++ changed in this PR, but it includes the framework I needed to test this code..."
600697874,"UtBS S01: Spawn the mystics on the island, not in the lake",stevecotton,2021-03-25 12:31:18+00:00,2021-03-27 15:19:38+00:00,{'Campaign (any)': 1},"They were both placed on the same hex, which meant the engine moved one of
them a hex north-west, into the water.

Fixes #5632 "
600675827,fix bug in overwrite_specials,newfrenchy83,2021-03-25 11:56:25+00:00,2021-03-26 19:40:51+00:00,{'Units': 1},I will see just now what if i use FORCE_CHANCE_TO_HIT macro against an unit with abilitie formation the cth is reduce then what i mustn't be the case.
598539981,TSG S05: Fix use of [modify_unit],stevecotton,2021-03-23 04:46:28+00:00,2021-03-26 18:46:06+00:00,"{'Bug': 1, 'Campaign (any)': 1}","TSG S05: Fix Urza's upkeep when taking the bandit branch. The `[trait]` shouldn't be inside a `[modifications]` block, as explained in #4137.

<strike>TSG S02: Simplify [store_unit]+[foreach] to [modify_unit]</strike>"
598398779,Remove obsolete FindSDL2_ttf cmake module,heirecka,2021-03-22 23:15:55+00:00,2021-03-23 00:13:03+00:00,"{'Building': 1, 'CMake': 1}",It's unused since 2dfdc0061d400ffad39f974d7fe9348204af0d08.
597577511,Remove Formula AI uses,mattsc,2021-03-21 22:45:28+00:00,2021-03-24 15:04:47+00:00,"{'AI': 1, 'Campaign (any)': 1, 'WML Tools': 1, 'Schema': 1}","Formula AI will probably be deprecated in Wesnoth 1.17.  As preparation for that, this PR removes uses of FAI in mainline, but does not yet remove or deprecate the existing FAI candidate actions or tools that can be used for UMC.

Instances to be removed:

- [x] Legend of Wesmere: S16 The Chief Must Die: replace the patrol FAI code with the Patrol Micro AI.  In order for the behavior to remain unchanged, two new optional parameters need to be added to the Patrol MAI (which will be generally useful as well):
  - [x] attack_range: the patrol interrupts its route to attack enemies within this distance, not just enemies that it happens to end up next to
  - [x] attack_invisible_enemies: include invisible enemies when considering whether there are enemies within attack_range
- [x] Remove FAI lurkers from Lurkers MAI test scenario
- [x] Remove FAI home guardian from Guardians MAI test scenario
- [x] Remove FAI dev AIs from MP computer player menu (available in debug mode only)
- [x] Macros using FAI: nothing to be done here; they are not used in mainline anymore and won't be deprecated until 1.17"
597317472,Rename functions managing special weapons to improve readability for engine devellopper,newfrenchy83,2021-03-20 16:40:18+00:00,2021-03-26 15:39:50+00:00,"{'AI': 1, 'UI': 1, 'Units': 1}","When I was looking at the special weapons extension to [abilities] tags, I didn't understand the concept of lists at first, until someone added the .append function to add a list to a list. other, but I kept the names I used for the functions. Now that this work is completed, I would like the function calls to find their original names (get_specials and get_special_bool) among other things to clarify the reading for a developer."
597256864,EI S07b: Wake the sea creatures with noise instead of magic,stevecotton,2021-03-20 10:31:19+00:00,2021-03-23 00:37:48+00:00,"{'Campaign (any)': 1, 'Audio': 1, 'Prose': 1}","This comes from a discussion about which archaic-sounding pronoun should be
used instead of ""you"" in ""Creatures from the deep, I summon you to destroy this
foe"". The conclusion with that was that ""thee"" or ""ye"" would sound better, but
""you"" is the correct archaic pronoun.

The .ogg file is copied from Northern Rebirth.

Part of #4145."
597237132,EI S7a S10 S11: Minor fixes,stevecotton,2021-03-20 07:51:57+00:00,2021-03-20 16:19:21+00:00,{'Campaign (any)': 1},"S7a: Improve how side 2 makes its entrance. Don't use [hide_unit], that's not what it's for.

EI S10: Make recall undoable: this event shows a warning about recalled units having low / no movement through mountainous terrain.

EI S10: Switch shroud to fog. The scenario was otherwise generally unwinnable on the first attempt. Although the extra turns in added in ab900b0093503809d91fc9c48ead19e388b63fe7 help with that, it's still worth changing to fog instead of shroud.

EI S11: Annotate bonus objectives as such.

Part of #4145."
596223991,Add a prompt to allow entering an add-on's password at upload time.,Pentarctagon,2021-03-19 05:37:42+00:00,2021-04-04 06:28:24+00:00,"{'UI': 1, 'Add-ons': 1, 'Building': 1}",This is an alternative to needing to store the plaintext password in the _server.pbl.
595216386,EI: minor fixes for S1 and S2,stevecotton,2021-03-18 05:01:28+00:00,2021-03-18 06:34:31+00:00,{'Campaign (any)': 1},"EI S1: Update objectives to reflect when an early finish bonus is given.

EI S1, S2: Fix typos

EI S2: Lift shroud (but not fog) around the amulet. Gives the player a hint to
explore around the amulet, despite the objectives saying ""Get moving quickly"",
which discourages that in the first playthrough. This might also prevent
players interpreting the revealed path directly through the trolls as the
suggested path through the level. By putting one of the dots in an obvious
dead-end, it's less of a surprise that the path shown by the other dots leads
to getting trapped between trolls and undead.

Part of #4145"
594991722,Update Codeblock projectfiles,newfrenchy83,2021-03-17 19:24:37+00:00,2021-03-17 19:42:18+00:00,{'Building': 1},
592787916,font: Work around chromatic aberration issue with Windows ClearType,irydacea,2021-03-15 06:36:13+00:00,2021-03-17 19:59:06+00:00,"{'Enhancement': 1, 'Windows': 1, 'UI': 1}","There's a long-standing issue with our usage of Cairo/ClearType on Windows that creates very noticeable chromatic aberration of rendered text (see the visual reference below) due to Wesnoth not respecting the industry recommendation of not using subpixel hinting when rendering text on transparent surfaces -- the latter being quite unfortunately something we always do because `pango_text` only generates transparent surfaces and most of the time has its output blitted onto more transparent surfaces.

This patch disables subpixel hinting, causing Cairo to render wispy text because of gamma issues when not rendering text directly onto an opaque surface. However, it also makes the implementation of pango_text overblend all transparent pixels to compensate like it was previously done before the revert in commit c91b200b7a10bf82fb13417a1267fcdf0fc4b2c1. This version uses alpha blending directly instead of forcing Pango to overdraw the entire text layout, however.

Overblending by 75% seems good enough for our purposes.

(Requesting @Vultraz's review since like all `pango_text`-related changes this is very much a UI related change and he's the current UI maintainer.)

## Visual reference

**Before:**

![pango-text-default-1](https://user-images.githubusercontent.com/489895/111112342-c38a0100-853e-11eb-98b6-a64f1300f832.png)
![pango-text-default-2](https://user-images.githubusercontent.com/489895/111112356-c97fe200-853e-11eb-9842-2dd95b8b873a.png)

**After (175% alpha):**

![pango-text-corrected-175-1](https://user-images.githubusercontent.com/489895/111216572-582e4680-85b3-11eb-8b80-4da38fa777c4.png)
![pango-text-corrected-175-2](https://user-images.githubusercontent.com/489895/111216604-62504500-85b3-11eb-9896-d795fe52ae66.png)

**After (300% alpha):**

![pango-text-corrected-1](https://user-images.githubusercontent.com/489895/111112570-2380a780-853f-11eb-8091-7c2fe837b76b.png)
![pango-text-corrected-2](https://user-images.githubusercontent.com/489895/111112745-72c6d800-853f-11eb-9805-1f53c0fed9ca.png)
"
592725763,"Simplify pango_text: surface is always dirty, remove unused functionality",stevecotton,2021-03-15 04:44:08+00:00,2021-04-06 11:33:49+00:00,{'UI': 1},"Every instance of pango_text had its own surface and dirty bit for caching the
result of rendering. However, pango_text is used as a singleton, so as soon as
there are two strings on screen then they're overwriting each others' cached result
and the dirty bit is always set. The loading screen is probably the only screen
where the dirty bit could be useful, as there's only one string on that screen.

The other parts removed were simply unused:
* the `force` options
* insert_unicode
* outlines

Co-ordination with the other currently open pango_text PRs:
* #5594 and this can be merged in either order, and won't have merge conflicts
* #5602 will have merge conflicts with both this and #5594, I'll keep rebasing it until the other PRs have merged"
592671439,Remove checks for stuff that aren't used anymore.,Pentarctagon,2021-03-15 01:39:06+00:00,2021-03-15 03:42:59+00:00,"{'Building': 1, 'SCons': 1, 'CMake': 1}","---

Opening a PR to make sure the CI completes before merging."
592644365,Handle hotkeys on non-Latin keyboards via transliteration,stevecotton,2021-03-14 23:47:34+00:00,,"{'Enhancement': 1, 'UI': 1, 'WML Tools': 1, 'Building': 1, 'Input': 1, 'Schema': 1}","Prototype: no UI is added for configuring this; at the moment it comes with
a Python script and you need to paste the output of that script into a .cfg
somewhere - for example data/core/hotkeys.cfg. The second commit in this PR
is just adding the script output. Fixes #5421.

Imagine a keyboard with Latin ""a"" and Greek ""α"" on the same key, ""b"" and ""β"" on
the same key, etc. This commit adds a fallback so that, when the user presses
ctrl+β, the engine first searches for ctrl+β and then falls back to searching
for ctrl+b.

The transliterations are only searched for when the original input doesn't
trigger a hotkey; if the user manually adds a hotkey for ctrl+β then it will be
found first when the keyboard is in Greek mode.

I'm using Greek for the examples because (looking at Wikipedia) there seems to
be consistency in which Greek letters match to which Latin letters. Cyrillic on
the other hand seems to have as many keyboard variants as Latin does (Qwerty,
Qwertz, Azerty, etc),

The Greek layout puts a semicolon on the Latin-q key, which has been omitted
from this conversion. Even if it was included, it would look for the semicolon
and colon based hotkeys before looking for the q hotkeys, that's a design
choice to avoid overriding existing hotkeys.

The syntax for the preferences file is like this:

```
[hotkey_transliteration]
		[substitute]
				src=α
				dst=a
		[/substitute]
		[substitute]
				src=β
				dst=b
		[/substitute]
		[substitute]
				src=ψ
				dst=c
		[/substitute]
		[substitute]
				src=δ
				dst=d
		[/substitute]
		...
[/hotkey_transliteration]
```

Many thanks to @Renom for investigating a different method of handling keyboard
layouts. Although that method ended up blocked by SDL issues, the work saved me
from trying to read the actual keyboard layouts via SDL for this method."
592600051,various small fixes,doofus-01,2021-03-14 19:11:24+00:00,2021-04-03 21:49:28+00:00,"{'Graphics': 1, 'Units': 1}","- fix incorrect tile extension for Scarab animation, reported on forums
- touch-up to zombie beast-rider"
592467292,Micro AIs: fix unit variables being lost in replays,mattsc,2021-03-14 03:40:43+00:00,2021-06-10 18:42:51+00:00,"{'Bug': 1, 'AI': 1}","Some Micro AIs save information in unit variables. Examples are the patrol and messenger AIs, which save the next waypoint for a unit. This needs to be done as a synced command, so that the information is not lost when continuing a game from a replay.

Making this a PR because, at the moment, this can cause Wesnoth to crash.  An explanation for that and proposed fix is in #5595, but as discussed in that PR, I don't know if that is the correct way of fixing the problem.  So this will have to sit here until #5595 is merged."
592304467,Fix a crash where a WFL object could go out of scope and be destroyed before the formula was finished with it,CelticMinstrel,2021-03-13 06:12:02+00:00,2021-03-23 13:29:13+00:00,"{'AI': 1, 'UI': 1, 'Units': 1, 'Lua API': 1, 'WFL': 1, 'Terrain': 1}",
592227145,Fix attack prediction assert,mattsc,2021-03-13 00:10:53+00:00,2021-03-13 18:34:22+00:00,{},"The corrections applied in calculate_probability_of_debuff() are already taken into account in the main attack outcome calculation for being slowed.  They do not need to be applied again, that only needs to be done for being poisoned.  Doing this for being slowed also can cause an assert, such as the one reported in issue #5533 (and probably also the one in issue #5002).

Fixes #5533

Note that this is a PR against Wesnoth 1.14, because that's where the issue was reported.  It should be ported to master also.

I would like to merge this tomorrow, so that it gets a week of testing before the 1.14 and 1.15 releases, just in case there are any adverse side effects."
592087364,Add the server id to wesnothd as well.,Pentarctagon,2021-03-12 22:33:09+00:00,2021-03-14 20:42:09+00:00,{'MP': 1},"The version when wesnothd is compiled may not match the client versions it serves when switching to a new stable branch, so that value must come from the server config. This also means that the value must be updated manually to match the intended version."
591468227,"Edit ""The Rise of Wesnoth"" difficulty",cooljeanius,2021-03-12 08:20:19+00:00,2021-04-15 07:58:43+00:00,{'Campaign (any)': 1},"So, this got rather hard near the end. I might want to go back and do a second pass at it. Includes some map edits to give more recruiting tiles and a better path to the water for your merfolk. I'm marking this as a draft because there's at least one FIXME left in it.
Note that the original diffs are from here: https://github.com/cooljeanius/wesnoth_mods/tree/master/campaigns/The_Rise_Of_Wesnoth/diffs "
591366390,Rendering only the visible area in text_shape,stevecotton,2021-03-12 04:42:28+00:00,2021-04-29 11:22:49+00:00,"{'Bug': 1, 'UI': 1}","Merge #5681's canvas viewport support with #5682's pango_text viewport support. Both of those seemed large enough to split into their own PRs, this is the small change that needs both together; if the canvas PR merges first then I could roll this into the pango_text PR.

Fixes #5043."
590662984,Remove strong trait from Elvish Lady trait pool.,knyghtmare,2021-03-11 08:13:42+00:00,2021-03-22 21:34:38+00:00,{'Units': 1},"She is a cutscene unit but has no melee attack. Inheriting the _strong_ trait would not benefit her in anyway.

This does not impact anything in particular but looks rather odd when you view the in-game help. Thus, I have fixed it.
![Screenshot 2021-03-11 044516](https://user-images.githubusercontent.com/5283677/110754972-9e616e00-8272-11eb-9b39-48362765b325.png)
"
590142389,ui: Drop SDL_ttf and FriBidi dependencies in GUI1 and GUI2 code,irydacea,2021-03-10 20:53:09+00:00,2021-03-13 16:51:48+00:00,"{'UI': 1, 'Editor': 1, 'Building': 1, 'Help': 1, 'SCons': 1, 'CMake': 1}","This patch series eliminates all dependencies on SDL_ttf and FriBidi in the Wesnoth codebase, including a forgotten dependency on SDL_ttf by GUI2 for obtaining font measurements, used by the textbox widget.

The bulk of the PR deals with reimplementing a few SDL_ttf wrapper APIs using Pango in `src/font/sdl_ttf_compat.cpp`. This includes some of the code used for the Help browser's layout strategy, which remains largely unchanged for the time being, providing identical functionality as before.

For the sake of simplicity, however, GUI1 markup is not implemented in this PR and it is instead dropped entirely, aside from the delimiters used to build GUI1 menus (such as the Help browser's menu). GUI1 markup became obsolete and was entirely phased out over the years leading up to 1.14 with the gradual adoption of GUI2 across the board since Wesnoth 1.6, and is not missed by anyone who wanted full control of how text is rendered due to its issues with variable line spans. Everyone agrees that GUI1 markup was a kluge and not a proper solution to the problem it was trying to solve. Once again, I must remind people that Help markup is not GUI1 markup. Help markup stays. GUI1 markup goes away.

As far as I know, there should be no functional differences compared to master. However, I would *greatly appreciate* double-checking from CJK translators either now or after the next development release as to whether the word-wrapping in the Help system is still sane. It *should* be, given how most of the work is done by Pango, which is a mature text layout API used by Gnome and others; but you never know when it comes to these things.

**Note:** Going forward, all the APIs in `sdl_ttf_compat.cpp` are meant to be removed. They are only supposed to exist for as long as their callers' architecture remains unchanged. For GUI1 widgets, that probably means forever. For the Help system, that means until a GUI2-based version is written, or the current one altered further to utilize Pango to its fullest potential."
589371042,Make hotkeys work in any layout,renom,2021-03-10 10:01:26+00:00,,"{'UI': 1, 'Input': 1}","This makes wesnoth hotkeys be bound to scancodes instead of keycodes and inputted text.
Fixes #5421."
586339807,Fix potential crash when running commands in synced context,mattsc,2021-03-07 22:22:25+00:00,2021-06-10 18:08:53+00:00,"{'Bug': 1, 'AI': 1, 'Engine': 1}","Function run() at the beginning of this same file asserts when a command is configured not to be undoable (use_undo=false), but the undo stack is not empty (resources::undo_stack->can_undo() returns true).  Thus, the undo stack needs to be cleared before executing commands that are not supposed to be undoable.

Most commands do this, but it is not necessarily guaranteed for commands that are otherwise unsynched and get put into synced context here.  An example are the AI recall/recruit actions.  Thus, we need to clear the undo stack before trying to run such a command."
586313695,modifications to pango_text for invalid markup,krazyfencer,2021-03-07 19:40:03+00:00,2021-05-08 21:07:51+00:00,"{'Bug': 1, 'UI': 1}","The problem here is that the set_markup method in src/font/text.cpp directly calls set_text() when invalid markup is encountered, however when handling line-by-line rendering, this causes two problems to happen.  First, it invalidates text_, which the processing is currently looping through.  Second, text_ is set to the line data, not the entire text.

I believe the solution is for set_markup not to modify the text via set_text when invalid markup is encountered.  It still reports the invalid text to debug, but it simply returns false indicating that setting the markup was unsuccessful.  The two places set_markup are called (set_text and rerender) have been modified to notice the failure of set_markup and use pango_layout_set_text in these cases to directly render the broken markup as text.

This will fix the loop invalidation, but I have changed the behaviour of wrapping the broken markup text in the string: '""The text contains invalid Pango markup: ""'.  This can be added back in if you want, but it seemed odd to be doing this while silently dropping invalid utf-8 in other places in the code.  It seemed to make more sense to report the errors to the error streams and make the gui output as close to the requested value as possible.

fixes #5043  "
586171028,Fixed single player campaign number of players marker,krazyfencer,2021-03-07 02:03:25+00:00,2021-03-08 16:41:18+00:00,{'Campaign (any)': 1},"The problem with the map generation showing 'Players: 2' on the local multiplayer generation of a single player campaign isn't a problem with the engine, but rather that all of the single player campaigns have not defined a min_players and max_players setting within their config.  Note that a campaign's min_players and max_players default to 2 (see src/game_initialization/create_engine.cpp).

Modified single-player campaign configurations to include min_players=1 and max_players=1.
This allows the correct number of players to be shown on the generation of a local
singleplayer campaign.

Please note that this is my first wesnoth update and one of my first PRs, so let me know if I clowned something up.

fixes #5361 "
586121686,scorpion variations,doofus-01,2021-03-06 19:31:54+00:00,2021-04-03 23:35:27+00:00,"{'Graphics': 1, 'Units': 1}","Some variations for scorpion.  I'll add to list as things progress. 

- derivative portrait for sand scuttler EDIT: this would close #4076
- zombie sprite frames and portrait
- new unit rock scorpion - base sprite, defense anim, and portrait"
586105779,Adds optional database support to campaignd.,Pentarctagon,2021-03-06 17:41:38+00:00,2021-03-12 22:12:10+00:00,"{'MP': 1, 'Services': 1, 'Add-ons': 1, 'Building': 1, 'SCons': 1, 'CMake': 1}","Also uses that support to insert data into the new ""addon_info"" table when an add-on is uploaded as well as adds validation of the topic_id to ensure it's a valid int before inserting.

One use case for this would be to be able to check how many people are using outdated add-ons when playing online multiplayer on the primary official server.  Others would be to let players know when they create/join a game with an outdated version of one or more add-ons that will be used as well as adding a way to open an add-on's feedback thread in their browser from the current game they are playing.

Addresses #5060
Addresses #5061

---

Implementing #5065 would be dependent on whenever #5567 is merged, since doesn't make sense to implement client-side hashing only to soon remove it when TLS support is added."
585348021,"Fix several Lua issues, mostly unintentional globals",CelticMinstrel,2021-03-05 06:06:00+00:00,2021-03-06 22:01:53+00:00,"{'AI': 1, 'Campaign (any)': 1, 'Lua API': 1}","Submitting as a PR because this touches a lot of AI code and I'm not 100% confident all these globals were indeed unintentional.

There's some typos and stuff fixed in here too."
583448319,UtBS - undead variations for the rider/mounted Quenoths,doofus-01,2021-03-03 00:50:45+00:00,2021-03-03 03:12:26+00:00,"{'Campaign (any)': 1, 'Units': 1}","This is pretty simple, but I always figure out a way to fail the CI tests, so let's park it here first.
(Revisiting the Quenoth elves made me realize the archers could use a touch-up, so they look less like Kenny from South Park.)
Fixes #5529"
583004328,[1.14] Fix [resistance_defaults] and [terrain_defaults] (issue #5308),stevecotton,2021-03-02 12:46:24+00:00,2021-03-05 17:09:19+00:00,"{'Bug': 1, 'WML': 1, 'Units': 1, 'Regression': 1}","The bug introduced in fcd0ceda is fixed by ensuring that movetype::merge() is
called with the strings ""movement_costs"", ""vision_costs"" and ""jamming_costs""
instead of ""movement"", ""vision"" and ""jamming"". Closes #5308.

Both [terrain_defaults][movement] and [terrain_defaults][movement_costs] are
supported and equivalent, as added to the master branch in 3522eb2c.

These now work again:

    [resistance_defaults]
        id=""special_res_for_test""
        default=""30""
    [/resistance_defaults]

    [resistance_defaults]
        id=""copy_of_arcane""
        default=""(arcane)""
    [/resistance_defaults]

    [terrain_defaults]
        id=""special_terrain_for_test""
        [movement]
            default=""(swamp_water + 1)""
            orcishfoot=""(swamp_water * 2)""
        [/movement]
    [/terrain_defaults]

Formulas can now access other parts of the movetype too, as this allowed the
code to be the same as in 1.15:

    [terrain_defaults]
        id=""special_terrain_for_test""
        [movement_costs]
            default=""(swamp_water + 1)""
            orcishfoot=""(vision_costs.swamp_water * 2)""
        [/movement_costs]
    [/terrain_defaults]
    [terrain_defaults]
        id=""special_terrain_for_test""
        [defense]
            default=""(20 + 7 * movement_costs.special_terrain_for_test)""
        [/defense]
    [/terrain_defaults]

The formula handling will recognise ""resistance"", ""movement_costs"",
""vision_costs"", ""jamming_costs"" and ""defense"". For [resistance_defaults], the
formula will recognise both ""(arcane)"" and ""(resistance.arcane)"" as equivalent,
similarly for [terrain_defaults] ""(swamp_water)"" is a shorthand for whichever
subtag is being patched.

A [terrain_defaults] tag may use data added in a previous [terrain_defaults],
as in the examples above where the second tag's [defense] is based on the first
tag's [movement_costs], this gives orcish grunts on the special terrain a 62%
chance to be hit. However, relying on data in the same [terrain_defaults] that
creates or changes it is unsupported - if the [movement_costs] and [defense]
were in a single [terrain_defaults] tag then the result would be implementation
defined, because no guarantee is made of the order in which the children of the
tag are processed.

The unit tests for [terrain_defaults] and [resistance_defaults] must stay
out-of-tree until we support some method of testing them without affecting the
core units' stats during other tests. The test added here is limited to
checking the ways that WML can read the stats, it's also a framework for the
out-of-tree parts to use.

This is a squashed cherry pick of these commits from 1.15:
* 72863e578ba2153520488f096f88d024d7795340 (the unit test)
* 0ba433203e508478fff7f79f7fcb64d186ba40e7
* 3522eb2c2a13c7d78480117a83f55946a0dee2d4 (adding the aliases)"
583004058,Handle empty children in patch_movetype,stevecotton,2021-03-02 12:45:58+00:00,2021-03-03 07:57:01+00:00,"{'Bug': 1, 'Units': 1}","In movetype::write, the children might not be created if that child has an
empty config; there might be no child at all for movetypes such as ""none"". The
movetype ""none"" is a real movetype defined in units.cfg for units that
shouldn't be able to move.

The original_cfg local variable was only used once anyway, removing it and the
comment made the code clearer.

This wasn't caught in the 1.15 testing, but with 1.14 it resulted in a
""mandatory WML child missing"" warning."
582177124,Support [terrain_defaults]'s original subtag names,stevecotton,2021-03-01 15:56:35+00:00,2021-03-01 23:22:33+00:00,{'Units': 1},"This is preparation for backporting 0ba433203e, with the idea that both sets
of names will be supported in both branches as part of fixing #5308.

No deprecation messages are added. While config::get_attribute_value() has a
config::get_old_attribute_value(), there isn't currently a similar utility for
config::child(); maybe I should add one now, but it feels too large a change
for a backport."
581553219,Some enhancements to the WML test runner,CelticMinstrel,2021-02-28 17:11:47+00:00,2021-03-14 01:49:26+00:00,{'Docs': 1},"This is a bunch of updates to the WML test runner that I did while trying to figure out the test failures in #4580. The general motivation is that I was unable to get the output from the test that failed or even identify _which_ test that failed when running on Windows.

The main purpose of this PR is to verify that the runner still works on POSIX systems, but I'm also open to review comments.

* The first commit just fixes the new command-line argument I recently added on master - apparently I forgot to test it and it didn't work, just crashed the runner.
* In order to reduce clutter when displaying test output, I've added a `--nobanner` flag to Wesnoth. This could be probably achieved with `tail` or similar tools on POSIX systems, but that won't work on Wesnoth. The flag suppresses all or most output up to the ""Checking lua scripts..."" line.
* Showing the numeric test return code is kind of silly, especially when you're using Python enums that know their own name, so now a failed test shows the actual meaning of the return codes (in addition to the number)
* The test runner now uses a pipe instead of a temporary file to capture the output. If you pass `-v` (which previously did nothing), you can see the full output from every test. This avoids cluttering the repository root directory with all the test result files. It doesn't use the `capture_output` parameter that the code comment mentioned because that captures stdout and stderr separately whereas I wanted to capture them merged together.
* The test runner was unable to capture the output from the test on Windows, due to the log redirection, so I've added `--wnoredirect` to Windows builds to disable it. I've also added `--wnoconsole` to disable the automatic console attachment if you're using a flag that normally implies it; I suspect that wasn't actually needed for my purpose but I figure it can't hurt to leave it in.
* The test runner can now limit the size of a test batch. If we ever run into a problem where we have so many tests that the batch times out, we can use this. At the moment, I don't think we have enough tests for it to matter.
* The test runner claimed to skip tests that expect timeout when timeout is disabled, but it didn't actually do so. This is fixed.
* The test runner now prints a summary of tests passed and failed at the end. It also includes a count of tests that crashed (due to a signal) or were skipped (due to expecting timeout when timeout is disabled).
* When told to run multiple tests, the Wesnoth executable exits on the first failure. The test runner now determines which test fails and starts a new batch to continue where it left off."
581328968,Unsubtly warn about subtle problems loading saved games from old versions,stevecotton,2021-02-27 13:26:21+00:00,2021-03-13 02:45:42+00:00,"{'Enhancement': 1, 'UI': 1}","This connects to issue #2710, although the main reasoning about it is in #5517.
The difficulty balance isn't the only problem with loading old saved games, but
it's a simple example to explain.

This warning is intended for the change between 1.14 and 1.16, but will be shown
to anyone loading 1.15.x saves into 1.15.y - that's something that they should
expect in a dev branch."
581220454,AI: Improve behavior of the retreat_injured CA,mattsc,2021-02-27 01:16:01+00:00,2021-03-03 16:22:21+00:00,"{'AI': 1, 'WML Tools': 1, 'Schema': 1}","The previous version of the CA had two massive problems:

- The threshold for retreating was based on the `caution` aspect.  This would make almost fully healthy units retreat if caution was set to a large value for other reasons.  This is fixed by introducing a dedicated aspect `retreat_factor`.  In addition, the retreat threshold is now based on the unit's hitpoints, rather than its level.
- In the presence of enemies, units sometimes retreated all the way to the edge of the map.  This is fixed by improving the retreat location evaluation, and by introducing an new aspect `retreat_enemy_weight`.  The new behavior is as follows:
  - Enemy threats are much less important, but their weight can be increased using `retreat_enemy_weight`
  - By default, only healing locations are considered as potential retreat locations; this can be overridden by setting `retreat_enemy_weight` to negative values, in which case all hexes are considered (and the previous behavior of running away from enemies may be restored, depending on the absolute value of `retreat_enemy_weight`
  - If `retreat_enemy_weight` is set to zero, enemies are not taken into account at all

In the process, I also found and fixed a bug that resulted in hexes next to healers (own and allied) not being counted as healing locations"
581046776,Add a Wesnoth MSVC visualization file for config and t_string,CelticMinstrel,2021-02-26 18:37:10+00:00,2021-02-27 06:08:31+00:00,{},"This should greatly improve the experience of debugging Wesnoth code in MSVC. It also works in VSCode if you configure it to run MSBuild, as I have done.

The natvis file added in this commit needs to be added as a reference in the Visual Studio project file in order to work in Visual Studio (according to the documentation). Since I don't have Visual Studio and don't know what the MSBuild code would look like to add this, I've left it to someone else who does."
578756613,Add [test] to list of tags with add-on id,mattsc,2021-02-23 21:09:50+00:00,2021-02-23 21:46:10+00:00,{},"As of PR #4963, the engine ignores all global tags defined by add-ons that are not active, that is, that are not used in the current game.  Whether an add-on counts as active is determined based on a list of possible tags with add-on ids.  The [test] tag is not included in this list, resulting in test scenarios in add-ons not working any more."
577829278,Support for TLS-encrypted connections,loonycyborg,2021-02-22 18:00:01+00:00,2021-05-18 09:02:52+00:00,"{'MP': 1, 'Add-ons': 1, 'Building': 1, 'SCons': 1, 'CMake': 1}","This adds backwards-compatible support for using TLS both to wesnothd and campaignd as well as appropriate clientside support.

To enable TLS support in servers extra config options to their config files are added:

tls_enabled=true
tls_fullchain=""path/to/fullchain.pem""
tls_private_key=""path/to/privkey.pem""
tls_dh=""path/to/dhparam.pem""

fullchain and private key files can be generated via let's encrypt using an acme protocol client. Acme domain must match server's domain name clients will connect to. dh file can be generated with appropriate openssl command.

if `tls_enabled=false` server will still accept unencrypted connections from clients both with and without this PR merged.
In any case servers are compatible with clients without this PR merged, at least as basic unencrypted connectivity is concerned.

Client always supports TLS and will use it whenever appropriate, using unencrypted connection if TLS cannot be used. Client  uses RFC 2818 host verification. So client won't try to use TLS when connecting to raw IP, or when connecting to loopback network interface."
577132661,Fixup WC2 validation (combination of 41b2b0b with e47b759),stevecotton,2021-02-21 15:47:27+00:00,2021-02-21 17:34:40+00:00,"{'Campaign (any)': 1, 'Building': 1, 'Schema': 1}","The combination of disabling and validating WC2 meant that the build failed,
so add another #def that will enable it for validation."
576999592,hotkey: Streamline some menu action labels,irydacea,2021-02-20 20:09:42+00:00,2021-02-20 22:26:42+00:00,{'UI': 1},"Something that people occasionally miss is that several hotkey actions double as menu items throughout the UI. Menu items have this particular quality to them that requires them to be as succinct as possible to make their meaning apparent without requiring excessive reading and parsing from users/players. Furthermore, in a UI like ours with large elements everywhere,  we want to avoid excessively wordy elements that can become ten times as long when translated into foreign languages.

Commit c42bf114249dcef5241327ca92214cf155ff89e8 replaced the Preferences label with a unnecessarily longer version despite it being pretty standard among most applications for it to be a single word (either Preferences or Options or Settings). This commit reverts that.

Clear Chat and Errors (also from the aforementioned commit) is relabeled Clear Chat rather than Clear Messages so it's clearer that it applies to chat messages in particular and not anything else. On that note, the fact that game diagnostics share real estate and infrastructure with chat is really unfortunate but there's not much that can be done about it at the moment. At least it is visually obvious that this is the case. It's also rarely relevant (and most people won't think of entering ""error"" into the hotkey filter before reporting the error somewhere).

View Chat Log is relabeled Chat Log since no other option deals with the Chat *Log* in particular.

Scenario Objectives is relabeled Objectives because there really isn't anything else that has objectives we can look at in the whole game.

Enter User Command is relabeled Enter Command so as to not sound superfluous (and also pretentious -- we are talking about players of a game here).

Additionally, the Quit to Main Menu action is relabeled just Quit to Menu, which is closer to what the option actually does in MP games (quit to lobby) without being inaccurate in either SP or MP (closes #2744)."
576998808,Fix the replay URL returned and the list of game content sent to the server,Pentarctagon,2021-02-20 20:03:29+00:00,2021-02-24 04:11:22+00:00,"{'MP': 1, 'Add-ons': 1}",
576762311,Improve the Load dialog's UX when there are no save files or corrupted files,stevecotton,2021-02-19 22:09:13+00:00,2021-02-24 20:18:49+00:00,{'UI': 1},"Re-add the popup that appears when ""Load"" is pressed on the title screen if
there are no files, but now check for files from previous versions too.

Improve handling of switching from a version with files to a version without
files, disabling buttons on the load dialog when there are no files in the
current directory.

This adds a \todo about the error path at the start of evaluate_summary_string,
this path is reached by creating empty files in the save dir. The dialog's state
is reasonable, so it seemed a low priority and I don't want to introduce new
bugs by refactoring this path now.

Fixes #5517 "
576605454,Replace [leading_anim] callable by abilities used like weapons by add of [teaching_anim],newfrenchy83,2021-02-19 17:26:54+00:00,2021-03-15 15:30:30+00:00,"{'Campaign (any)': 1, 'Units': 1, 'Schema': 1}","Now what abilities used like weapon could call[leading_anim] it is more carefull to limit the call
in core unit to [leadership] only for don't have unwanted call of animation if abilites special of leader type are added by [modifications]
in these units."
576118339,addon/client: Add file operation progress dialog for installing add-ons,irydacea,2021-02-19 02:00:49+00:00,2022-08-06 18:20:05+00:00,"{'UI': 1, 'Add-ons': 1, 'Building': 1}","This implements an add-on extraction progress dialog that does not actually run its own event loop, allowing the caller to take ownership of it (`display()` static method) and update its state using a callback function object.

The dialog is roughly identical to the network progress dialog, except for the greyed out Cancel button. This is intentional so that the dialogs can be transitioned more or less seamlessly into each other by the add-ons client code.

![image](https://user-images.githubusercontent.com/489895/108446452-e6c1d900-723c-11eb-8b1c-cb18894a7057.png)

In order to avoid stalling the extraction process in UI code, the callback is invoked for every single file, but the dialog's progress update method places a time restriction on GUI2 API calls of 120 milliseconds -- this is a good throttle interval that allows add-ons to be extracted in about the same amount of time as before while still updating the progress bar smoothly enough for add-ons that take longer than that.

(This is not the most trivial code to test, so it is suggested to add a sleep/delay API call in `unarchive_file()` in src/addon/manager.cpp to introduce artificial delays.)

One issue with this code, however, is that because `modeless_dialog` doesn't execute its own event loop, the only way to get the dialog to be updated is to force a draw event in ourselves via the new `gui2::dialogs::modeless_dialog::force_redraw()` method. This is really a side-effect of my design choice here to run the dialog in the middle of a blocking operation instead of somewhere where events are being processed normally. I'm not entirely sure if the draw events would be pushed even in that case, however."
575740982,revert c++20 to c++17 in codeblock projectfiles,newfrenchy83,2021-02-18 14:50:48+00:00,2021-02-18 20:14:35+00:00,{'Building': 1},"c++20  is under construct, i willl revert to c++17 in wait"
575295796,move_leader_to_keep CA: prevent error message,mattsc,2021-02-18 00:21:25+00:00,2021-02-19 04:10:46+00:00,{'AI': 1},"Previously, trying to move the leader toward an occupied keep hex caused an E_NOT_REACHED_DESTINATION error.

Fixes #5345"
574968722, upgrades codeblock to Lua 5.4.2 ,newfrenchy83,2021-02-17 14:42:51+00:00,2021-02-17 15:15:14+00:00,{'Building': 1},
573870518,units - Walking Corpse beast-rider (taurus) variation,doofus-01,2021-02-16 01:27:48+00:00,2021-03-01 04:09:52+00:00,"{'In-progress': 1, 'Graphics': 1, 'Units': 1}","This initial commit has just the base frame, I'll be working on the other frames and the portrait.  I'm not sure about the stats, but those would be easy to change later, assuming this is merged within the next couple months.
![Screenshot_20210215_3](https://user-images.githubusercontent.com/13510196/108007469-ef9f7a00-6fb2-11eb-947f-eb57d4984683.jpg)
"
573828442,Campaignd: cleaned up error reporting slightly,Vultraz,2021-02-15 22:55:54+00:00,2021-02-18 08:24:56+00:00,{'Add-ons': 1},This cleans up the awkwardness I introduced in 5de1f8d5ccda92e6e02df84146e85fd84d8fb241 and 78373d7c59e4876c27a6b14ae7ea2b308815eb24.
573822092,UtBS Sc8 - replace Iwr terrain with Ior,doofus-01,2021-02-15 22:32:38+00:00,2021-02-16 01:38:21+00:00,"{'Campaign (any)': 1, 'Graphics': 1, 'Stable 1.14': 1}","also remove custom rules for water transition
Addresses #5539 for BfW 1.14"
573821050,Take display zoom into account when rendering unit animation frames,irydacea,2021-02-15 22:29:02+00:00,2021-02-16 00:20:54+00:00,"{'Graphics': 1, 'Units': 1}","**Note:** I have tested the patch against the bug's test case, but I need to go over my own files to see if I can find a more elaborate test case involving progressive parameters.

It was already considered for registering halos, just not for rendering regular frames. This commit touches the halo code a little so we don't need to call get_zoom_factor() multiple times per frame.

Closes #5508."
573733305,UtBS - new terrain-graphics rules for flood water,doofus-01,2021-02-15 18:35:43+00:00,2021-02-15 23:05:31+00:00,"{'Campaign (any)': 1, 'Graphics': 1, 'Terrain': 1}","Fixes #5539
Makes the flood water in Sc8 have a fading overlap on floor terrains, instead of the usual banks and edges.
I think it works based on what I see in the editor, but still need to test in scenario.

I'm not sure if this should be back-ported to BfW 1.14, or maybe it's better to just remove the custom rules and live with the default transitions."
573173547,Extent special_id_active and special_type_active to abilities,newfrenchy83,2021-02-14 23:27:46+00:00,2021-02-19 00:19:35+00:00,"{'Campaign (any)': 1, 'Unit Tests': 1, 'Units': 1}",with the number of commit and conversation in https://github.com/wesnoth/wesnoth/pull/5239 it is more simle to add another PR for fix https://github.com/wesnoth/wesnoth/issues/4840 issue
572997815,Command history for in-game consoles,kabachuha,2021-02-13 21:36:56+00:00,2021-02-18 15:16:06+00:00,{'UI': 1},"Now it's possible to browse the command history with up/down keys in in-game consoles such as used by debug mode, ai and search floating textboxes. It stores all the entered commands in chronological order, but already existing items will be moved to the end instead. If the player jumps to the previous command with some unenterred text in the textbox, it will also be stored. Chat messages are not stored like this to avoid spam.

I added a video with a little showcase below.

Closes #1542 .


https://user-images.githubusercontent.com/14872007/108371136-7e5c0300-720e-11eb-9039-bea0882c196d.mp4


(or this link if it doesn't show on github)
https://drive.google.com/file/d/18oYwpW3vEs2VP5OOh2iAXgyiS2Pjb-Er/view?usp=sharing"
572982765,Various Lua reorganization work,CelticMinstrel,2021-02-13 19:30:13+00:00,2021-05-11 23:12:41+00:00,"{'macOS': 1, 'AI': 1, 'Campaign (any)': 1, 'MP': 1, 'Unit Tests': 1, 'UI': 1, 'Units': 1, 'Lua API': 1, 'Add-ons': 1, 'Building': 1, 'Help': 1}","I'm going to use this pull request for most of the API reorganization, but #4580 covers the game map refactor, and some other larger bits may get their own pull request.

For now, I'm interested in feedback on whether these two new modules are even a good idea. The versions module is intended to replace `wesnoth.compare_versions` while the mathx module is used as a dumping ground for various math-ish functions that were in the Wesnoth API."
572981795,Use to-be-closed variables to scope WML variables in tag definitions,CelticMinstrel,2021-02-13 19:22:12+00:00,2021-02-16 02:11:56+00:00,"{'Unit Tests': 1, 'Lua API': 1}","With this you no longer have to worry about forgetting to end the variable scope - Lua will do it for you automatically. This is a PR because I've only done a basic smoke test (making sure there are no errors when starting a game; for this test I chose Aethermaw). I didn't confirm that the variable is correctly set and unset, though I have no reason to expect it wouldn't be; I did do some testing to verify how to-be-closed variables work."
572848130,Upgrade to Lua 5.4.2,Vultraz,2021-02-13 00:27:28+00:00,2021-02-13 15:07:12+00:00,"{'macOS': 1, 'Lua API': 1, 'Building': 1}",Upgrades from 5.3.6 to 5.4.2.
572643494,Standardize cutscene and victory UX,hexagonrecursion,2021-02-12 16:51:38+00:00,2021-05-03 19:39:37+00:00,{'Campaign (any)': 1},"Fixes #5514

Your user experience gives me as a player certain expectations:
* When a cutscene ends the game automatically moves on to the next scenario without a victory popup or linger mode
* When a regular scenario ends:
  * The music changes to victory.ogg or victory2.ogg
  * A victory popup is shown
  * The game enters the linger mode

Scenarios that violate this expectations surprise and confuse me. This PR fixes every such scenario that I was able to find in the mainline campaigns."
571144548,[WIP] Make the Elemental units available in the core directory,Elvish-Hunter,2021-02-10 14:30:38+00:00,,"{'Graphics': 1, 'WML Tools': 1, 'Units': 1}","This PR has the purpose of mainlining the Elemental set of units.

### Why?

The Elementals are one of the most used additional factions, both in multiplayer (several eras feature them, like Era of Myths) and campaigns). Given that they're quite widely used, it makes sense to have them available in the core directory, as I proposed a while ago here: https://forums.wesnoth.org/viewtopic.php?p=657485#p657485.

### What has been done

What I did was pulling the Elementals from Era of Myths (which, IIRC, was the first era to feature them, excluding Path of Summoners from 1.0 - more on that later), then updating them to run correctly on the 1.15 series. I also reverted the L1 unit names to their old names (I like ""Animated Rock"" more than a rather generic ""Earth Elemental""), added back the L4 advancement (but guarding it with an `ENABLE_LIVING_VOLCANO` macro) for the Lava Beast unit, which was removed from the Era of Myths at a certain point, and updated the `QUICK_4MP_LEADER` to handle the Emerald trait (which is roughly equivalent to the Quick trait).
I didn't add them as a MP faction because I expect them to be kind of unbalanced, so I'd have needed to add them in an experimental era; given that we already have an experimental era with the Dunefolk, I'd also have needed to add a Default + Dunefolk + Elementals era. As you can easily see, that would've just caused confusion; the MP faction, if desired, can be added later anyway.

### What can be done after merging

- Obviously, we need to update the race's and units' descriptions (for example, the Vine Monster has just an ellipsis).
- We can also improve the regeneration (resurgence) abilities: currently they're fixed to 5 HPs. For example, if WFL allows it, these abilities can be reworked to heal 2 HPs + 1 HP per level, so a level 1 unit can regenerate by 3 HPs and a level 4 unit can regenerate by 6 HP.
- There might be some overlap between the already mainlined Jinn and the elemental Djinn. Maybe the last one should be renamed ""Air Djinn""? Or there's a better name for the Jinn?
- The units don't have portraits. However, they don't usually talk (I can't remember any add-on where an Elemental actually talked) and their dialogue can mostly be replaced with roar sounds, so making portraits for them can even be pushed to the 1.17/1.18 series without problems.

### Licensing

I tried tracking who drew the sprites (I didn't check the attack icons yet). It turns out that most of them were made by fmunoz for his Path of Summoners MP Era (for Wesnoth 1.0, so they're quite ancient); these are the other artists:
- Neoskel: titan.png
- Melon: air-djinn.png, living-volcano.png, water-tempest.png
- The_Gnat: life-vine-monster.png
- unknown: air-windherder-2.png, air-windherder-3.png, air-windherder-attack.png, air-windherder-ranged-1.png, air-windherder-ranged-2.png, brazier-creation-attack.png, brazier-creation-death1.png, brazier-creation-death2.png, brazier-creation-death3.png, brazier-creation-death4.png, brazier-creation-death5.png, brazier-creation-death6.png, brazier-creation-defend.png, firewisp-ranged-n-1.png, firewisp-ranged-n-2.png, life-vine-beast-recruit-1.png, life-vine-beast-recruit-2.png, life-vine-beast-recruit-3.png, life-vine-tiger-recruit-1.png, life-vine-tiger-recruit-2.png, life-vine-tiger-recruit-3.png, water-undine-attack-1.png, water-undine-attack-2.png.

Given that I was unable to find who made a fair amount of those sprites and that they're already on the add-ons server without any specific licensing (at least, I didn't see any), I think they should be added under the GPL license, instead of the usual CC-BY-SA.

### TODO

- [x] Make the Fire Wisp a level 0 unit
- [ ] Remove the level 3 Vine Monster
- [ ] Move the Unicorn line into the monsters race
- [ ] Rename the Djinn as Mistral"
571074927,Make the preferences window big enough for HDPI fonts,stevecotton,2021-02-10 12:44:45+00:00,2021-02-19 14:52:48+00:00,"{'Bug': 1, 'UI': 1}","The hardcoded size of the window was too small for the large fonts on HDPI
displays, this changes to almost-automatic sizing. It leaves an upper limit for
the height of 80% of the main window size, so that there's a border at top and
bottom. Fixes #5185

Buttons that were placed at the bottom of pages move up so that they aren't
too far from the other controls. The sub-tab-selector buttons on the
multiplayer tab move above the sub-tabs themselves.

With HDPI text, the checkboxes are placed a little too high to align with
the font, but that's a cosmetic detail; this commit fixes the usability issue.

![wesnoth_preferences_4k_comparison](https://user-images.githubusercontent.com/101462/107511492-d909b500-6ba5-11eb-8134-340f75edb917.png)"
569398464,"Editor help: make the named areas topic visible, make ""to load ..."" translatable",stevecotton,2021-02-08 11:30:15+00:00,2021-02-08 22:40:29+00:00,"{'Bug': 1, 'Docs': 1}","This corrects a pair of editing errors, thanks to @celerini for reporting them.

This is targeting the 1.14 branch, I'll cherry-pick to master when it merges."
569334005,Fix several typos in wml,hexagonrecursion,2021-02-08 09:58:59+00:00,2021-02-10 09:23:12+00:00,"{'Campaign (any)': 1, 'Units': 1, 'Prose': 1}",
569126516,Edit Scepter of Fire difficulty,cooljeanius,2021-02-08 03:35:41+00:00,2021-02-21 23:15:45+00:00,{'Campaign (any)': 1},"This is my attempt to apply patches from [my general mods collection](https://github.com/cooljeanius/wesnoth_mods/tree/master/campaigns/Sceptre_Of_Fire). Basically, I needed more turns in Gathering Materials, and I needed to make it easier for Alanin to escape in Towards the Caves. Tested on 1.14, not on 1.15 though."
569034476,"Show a two-color orb for the ""disengaged"" state (#5155)",stevecotton,2021-02-07 19:31:47+00:00,2021-02-13 17:28:33+00:00,"{'Ready for testing': 1, 'Campaign (any)': 1, 'Docs': 1, 'Graphics': 1, 'UI': 1, 'Units': 1, 'Help': 1, 'Schema': 1}","As the disengaged state is part-way between the ""partial"" and ""moved"" states,
the orb has parts in each color. On the minimap these units are shown in the
partial color (which is also the color that would be used before this change).

This will match the mounted Quenoth units' ""disengage"" skill, when they
can still move but can't attack. It should also trigger for some UMC abilities
that get extra moves after a character attacks.

During testing, I found that TSG allows some of the bandits to attack on the
first turn of the bandit branch. There's no gameplay change there, but the orbs
make it much clearer that some units can still attack.

I think there are already too many preferences for orbs, so reused the existing
settings for the colors. A new ""show disengaged orb"" preference is added, which
when disabled shows the old partial orb instead.

Update the orb and ellipse sections of doc/manual/.

Closes #5155."
568867486,various small sprite-related fixes,doofus-01,2021-02-06 23:15:04+00:00,2021-02-13 20:54:26+00:00,{'Units': 1},"fixes #5412
Also adds mounted undead variation to dunefolk
"
568803184,Fixed unstore_unit lua code (issue #5519),MrTitainin,2021-02-06 15:12:47+00:00,2021-02-13 14:42:50+00:00,{'Lua API': 1},"x,y were both binding to whole table instead of their expected values
#5519 should now be solved, although there still might be problem with location_id in teleport code"
567848882,change User to Custom to unify the help with the game,celerini,2021-02-04 19:01:33+00:00,2021-02-04 19:11:50+00:00,{},The same as #5513.
567131498,change User to Custom to unify the help with the game,celerini,2021-02-03 20:44:27+00:00,2021-02-04 01:12:08+00:00,{'Editor': 1},"I see no ""User Maps"" under the list box when loading previously saved map, but the ""Custom Maps"" appears here."
566970510,fix codeblock projectfiles and update instructions,newfrenchy83,2021-02-03 16:32:45+00:00,2021-02-03 18:58:36+00:00,{'Building': 1},
566042546,Cleanup wmllint: display on/off,hexagonrecursion,2021-02-02 15:37:27+00:00,2021-02-02 15:38:30+00:00,"{'Campaign (any)': 1, 'MP': 1, 'Help': 1}","https://github.com/wesnoth/wesnoth/pull/5481 removed the check that made wmllint: display on and wmllint: display off necessary. This PR removes now redundant wmllint comments.
```sh
find ./data/ -name '*.cfg' -exec sed -ri '/^ *# *wmllint *:? *display *(on|off) *$/d; s/ *# *wmllint *:? *display *(on|off) *$//' '{}' ';'
```"
564722097,Add NLS CI job.,Pentarctagon,2021-01-31 20:20:52+00:00,2021-01-31 21:00:26+00:00,{},Cmake only since scons fails with an encoding error on Ubuntu 16.04.
564574379,orcish grunt sprite animations,doofus-01,2021-01-31 03:24:03+00:00,2021-01-31 19:28:29+00:00,"{'Graphics': 1, 'Units': 1}","- [x] die animations (n/s)
- [x] defense frames

EDIT: I had attack animations on this list, but looking at it again, I think that's low priority for the effort involved.  Time better spent on other things"
564375959,Move [color_range] id=darkblue to core,hexagonrecursion,2021-01-30 07:16:57+00:00,2021-01-31 21:13:17+00:00,{'Campaign (any)': 1},Fixes #4670
564365239,Delete the list of hotkeys from the manual,hexagonrecursion,2021-01-30 05:33:16+00:00,2021-02-04 01:13:59+00:00,{'Docs': 1},As pointed out in #1038 the list of hotkeys is too hard to keep up to date.
564360298,NR S13: make all player sides have turns in sequence,hexagonrecursion,2021-01-30 04:48:32+00:00,2021-02-09 04:02:43+00:00,{'Campaign (any)': 1},"Fixes #5396

was: Player -> 5x AI -> Player -> AI -> Player
now: Player -> 6x AI -> 2x Player"
563961816,CMake: avoid unnecessarily remaking all .mo files on each build,stevecotton,2021-01-29 12:44:24+00:00,2021-02-13 10:43:28+00:00,"{'Translations': 1, 'Building': 1, 'CMake': 1}","All the .mo files had a dependency on the target directory, which meant that
every change to the timestamp of that directory caused all the files to be
remade; and each file remade caused a change to the directory's timestamp ...

Since CMake 3.0, ""cmake -E make_directory"" has been deprecated in favor of
""file(MAKE_DIRECTORY ...)"", so use that instead of the custom command. This
means the directories are created when the cmake config is generated, instead
of during the subsequent make steps.

Note: the mo-update target which builds the .mo files is only run when the
build is configured with ENABLE_NLS=ON. Both before and after this change,
none of the .mo files are rebuilt when ENABLE_NLS=OFF."
562940929,bi: Use Boost.Predef to detect and expose the build arch,irydacea,2021-01-28 03:03:04+00:00,2021-01-28 18:55:28+00:00,"{'Enhancement': 1, 'UI': 1}","This commit also adds this information to the startup banner on stderr, the output of --report, and the Game Version dialog's main UI and clipboard report.

(See also commits 9b1ea3078da2b2d874774bc631648d90a0f78433 and 15356f1db67b705686462bb077d0a39bc1f78791 previously merged.)"
561916278,Legend of Wesmere: update Cliffs of Thoria difficulty,cooljeanius,2021-01-26 16:49:25+00:00,2021-02-07 09:50:36+00:00,{'Campaign (any)': 1},"So, to be honest, I wanted to edit a lot more scenarios in Legend of Wesmere when I played thru it, but the fact that it's also playable in multiplayer kind of scared me off. I did manage to edit one scenario in it, though: Cliffs of Thoria. It's a pretty simple edit, just tweaking some turns/gold/income/aggression values.
"
560797872,Tweak Eastern Invasion difficulty,cooljeanius,2021-01-25 05:43:18+00:00,2021-01-26 08:49:59+00:00,{'Campaign (any)': 1},"These are mostly just changes to gold/income/turns values, so they should be pretty safe to merge. Note that I originally developed these changes against 1.14, and @nemaara has already made some of her own changes to Eastern Invasion as part of 1.15, so I just dropped the parts that didn't apply anymore, or that didn't make sense anymore. This means I haven't actually tested these changes in this form, just in the form that appears in [https://github.com/cooljeanius/wesnoth_mods/tree/master/campaigns/Eastern_Invasion](https://github.com/cooljeanius/wesnoth_mods/tree/master/campaigns/Eastern_Invasion). They should be similar enough that that shouldn't make much of a difference, though."
560702559,various small fixes,doofus-01,2021-01-24 23:34:18+00:00,2021-01-25 00:59:54+00:00,"{'Units': 1, 'Lua API': 1}","fixes #5445 and #5454, partial fix for #5446"
560401538,wmllint: cleanup two useless lines,hexagonrecursion,2021-01-23 11:09:22+00:00,2021-02-02 14:18:07+00:00,{'WML Tools': 1},"As far as I can tell this lines do nothing.
1. `file_handle = None` is NOT how to close a file in python
2. The file handle is already closed due to `with open() as file_handle:`"
560057526,[WIP] Add missing spellings to the dictionary,hexagonrecursion,2021-01-22 16:01:03+00:00,2021-02-08 10:00:26+00:00,"{'Campaign (any)': 1, 'WML Tools': 1, 'Editor': 1, 'Units': 1, 'Help': 1, 'Terrain': 1}",currently wmllint produces a a ton of spelling warnings. I'm going through them and so far most have turned out to be false positives.
559740161,Change mainline advancement modification,Pentarctagon,2021-01-22 06:15:21+00:00,2021-02-14 01:16:37+00:00,"{'Unit Tests': 1, 'Units': 1, 'Lua API': 1}","The two commits explain their own reasoning.  Beyond that, the remaining question would be whether an advancement planning mod would:
* be a mainlining of the existing Plan Unit Advance modification; or
* be something brand new

The first option also of course depends on whether @vgaming is fine with their modification being mainlined or not."
559601943,Switch to std::string_view,Vultraz,2021-01-21 23:21:06+00:00,2021-01-22 02:26:37+00:00,"{'Units': 1, 'Lua API': 1, 'Building': 1, 'Terrain': 1}",Uses std::string_view instead of boost::string_view. We don't need a wrapper since MacOS is fine with this.
558980508,wc: markcheck off due to campaign-specific attrs,hexagonrecursion,2021-01-21 08:45:33+00:00,2021-02-02 16:54:21+00:00,{'Campaign (any)': 1},"World_Conquest has a bunch of campaign-specific tags and attributes. This was causing wmllint to produce spurious errors (see below).

@soliton- suggested (https://github.com/wesnoth/wesnoth/pull/5484#issuecomment-763831678):
> support a wmllint directive to disable checks for a complete dir or so so we can exclude lua heavy stuff like WC

I think it would be easier to add `markcheck off`.

""data/campaigns/World_Conquest/resources/data/training.cfg"", line 305: info should not have a translation mark
""data/campaigns/World_Conquest/resources/data/training.cfg"", line 519: info should not have a translation mark
""data/campaigns/World_Conquest/resources/data/training.cfg"", line 533: info should not have a translation mark
""data/campaigns/World_Conquest/resources/data/training.cfg"", line 549: info should not have a translation mark
""data/campaigns/World_Conquest/resources/data/training.cfg"", line 565: info should not have a translation mark
""data/campaigns/World_Conquest/resources/data/training.cfg"", line 580: info should not have a translation mark
""data/campaigns/World_Conquest/resources/data/training.cfg"", line 596: info should not have a translation mark
""data/campaigns/World_Conquest/resources/data/training.cfg"", line 620: info should not have a translation mark
""data/campaigns/World_Conquest/resources/data/training.cfg"", line 652: info should not have a translation mark
""data/campaigns/World_Conquest/resources/data/training.cfg"", line 681: info should not have a translation mark
""data/campaigns/World_Conquest/resources/data/training.cfg"", line 692: info should not have a translation mark
""data/campaigns/World_Conquest/resources/data/training.cfg"", line 702: info should not have a translation mark
""data/campaigns/World_Conquest/resources/data/training.cfg"", line 727: info should not have a translation mark"
558457173,wmllint: remove commented out code,hexagonrecursion,2021-01-20 19:05:45+00:00,2021-01-31 21:09:12+00:00,{'WML Tools': 1},
558395116,wmllint: recognize a WC-specific translatable attribute,hexagonrecursion,2021-01-20 17:09:37+00:00,2021-02-02 16:56:07+00:00,{'WML Tools': 1},"World_Conquest has a bunch of campaign-specific tags and attributes. This was causing wmllint to produce spurious errors (see below).
I marked the ""info"" attribute as translatable.

""data/campaigns/World_Conquest/resources/data/training.cfg"", line 305: info should not have a translation mark
""data/campaigns/World_Conquest/resources/data/training.cfg"", line 519: info should not have a translation mark
""data/campaigns/World_Conquest/resources/data/training.cfg"", line 533: info should not have a translation mark
""data/campaigns/World_Conquest/resources/data/training.cfg"", line 549: info should not have a translation mark
""data/campaigns/World_Conquest/resources/data/training.cfg"", line 565: info should not have a translation mark
""data/campaigns/World_Conquest/resources/data/training.cfg"", line 580: info should not have a translation mark
""data/campaigns/World_Conquest/resources/data/training.cfg"", line 596: info should not have a translation mark
""data/campaigns/World_Conquest/resources/data/training.cfg"", line 620: info should not have a translation mark
""data/campaigns/World_Conquest/resources/data/training.cfg"", line 652: info should not have a translation mark
""data/campaigns/World_Conquest/resources/data/training.cfg"", line 681: info should not have a translation mark
""data/campaigns/World_Conquest/resources/data/training.cfg"", line 692: info should not have a translation mark
""data/campaigns/World_Conquest/resources/data/training.cfg"", line 702: info should not have a translation mark
""data/campaigns/World_Conquest/resources/data/training.cfg"", line 727: info should not have a translation mark"
558369592,wmllint(markcheck): Ignore values with macros,hexagonrecursion,2021-01-20 16:29:24+00:00,2021-02-08 10:23:47+00:00,{'WML Tools': 1},"wmllint tried to add translation marks in several places where they are unnecessary.
Example:
description=""-50% ""+{STR_EXPERIENCE} ---> description=_ ""-50% ""+{STR_EXPERIENCE}

Full list:
""data/campaigns/World_Conquest/resources/data/artifacts.cfg"", line 330: description needs translation mark
""data/campaigns/World_Conquest/resources/data/artifacts.cfg"", line 520: description needs translation mark
""data/campaigns/World_Conquest/resources/data/artifacts.cfg"", line 679: description needs translation mark
""data/campaigns/World_Conquest/resources/data/artifacts.cfg"", line 690: description needs translation mark
""data/campaigns/World_Conquest/resources/data/artifacts.cfg"", line 795: description needs translation mark"
558351086,TSG: Add missing NOTE_DEFENSE_CAP,hexagonrecursion,2021-01-20 16:03:54+00:00,2021-01-22 19:28:16+00:00,"{'Campaign (any)': 1, 'Units': 1}",Three units with movement_type=mounted were missing {NOTE_DEFENSE_CAP}
558333961,wmllint: remove check for nonstandard word-wrap style,hexagonrecursion,2021-01-20 15:39:23+00:00,2021-02-02 14:15:57+00:00,{'WML Tools': 1},"> I'm not convinced this test is doing anything useful. I really doubt this ever caught an error. I'd rather remove it.

@soliton- in https://github.com/wesnoth/wesnoth/pull/5479#issuecomment-763696081

While I'm at it I also removed an orphaned comment."
558309571,Add wmllint: display on/off where needed,hexagonrecursion,2021-01-20 15:03:52+00:00,2021-01-20 16:26:35+00:00,{'Campaign (any)': 1},Wrap wmllint display on/wmllint display off around several messages where manual line breaks are clearly inserted intentionally.
558295930,Fix wmllint error: double space after sentence end,hexagonrecursion,2021-01-20 14:46:04+00:00,2021-01-20 15:59:10+00:00,{'Campaign (any)': 1},
558239964,LOW: Don't forget to undefine local macros,hexagonrecursion,2021-01-20 13:25:20+00:00,2021-01-20 14:24:35+00:00,{'Campaign (any)': 1},"Fix preprocessor warning:
warning preprocessor: Redefining macro LEAVE_BEHIND_L3 without explicit #undef at campaigns/Legend_of_Wesmere/scenarios/chapter4/13_News_from_the_Front.cfg:105
    included from campaigns/Legend_of_Wesmere/_main.cfg:18
    included from _main.cfg:38
previously defined at campaigns/Legend_of_Wesmere/scenarios/chapter3/09_Bounty_Hunters.cfg:240
    included from campaigns/Legend_of_Wesmere/_main.cfg:17
    included from _main.cfg:38"
558212704,Avoid [var] inside lua code,hexagonrecursion,2021-01-20 12:39:08+00:00,2021-02-01 05:55:23+00:00,{'Campaign (any)': 1},"wmllint confuses [var] in an expression wml.variables[var] for an opening tag.
The easiest solution is to rewrite the lua code to not contain stuff that confuses wmllint.

Fixes:
""data/campaigns/Legend_of_Wesmere/scenarios/chapter3/09_Bounty_Hunters.cfg"", line 289: unbalanced [var] closed with [/lua].
""data/campaigns/Legend_of_Wesmere/scenarios/chapter3/09_Bounty_Hunters.cfg"", line 387: unbalanced [var] closed with [/command].
""data/campaigns/Legend_of_Wesmere/scenarios/chapter3/09_Bounty_Hunters.cfg"", line 388: unbalanced [var] closed with [/event].
""data/campaigns/Legend_of_Wesmere/scenarios/chapter3/09_Bounty_Hunters.cfg"", line 542: unbalanced [var] closed with [/scenario].
""data/campaigns/Legend_of_Wesmere/scenarios/chapter3/09_Bounty_Hunters.cfg"", line 544: tag stack nonempty ([('scenario', {'name': '_ ""Bounty Hunters""', 'id': '09_Bounty_Hunters', 'next_scenario': '10_Cliffs_of_Thoria', 'random_start_time': 'no', 'allow_new_game': 'yes', 'new_game_title': '_ ""Chapter Three: The Book of Crelanu""', 'force_lock_settings': 'yes', 'experience_modifier': '100', 'victory_when_enemies_defeated': 'no', 'save_id': 'Cleodil', 'disallow_shuffle': 'yes', 'no_leader': 'yes'}, ['story', 'side', 'unit', 'unit', 'unit', 'side', 'side', 'side']), ('event', {'name': 'start'}, []), ('command', {}, ['persistent_carryover_unstore', 'store_unit']), ('lua', {'code': '<<', 'args': '(...)', 'units': 'wml.child_array(args, ""units"")', 'empty_str': 'args.empty', 'var': 'args.variable'}, []), ('var', {}, ['args', 'objectives', 'message', 'message', 'message', 'message', 'message', 'message', 'message', 'message', 'message', 'message', 'message', 'message', 'event', 'event'])]) at end of file."
558207780,atempt to fix build,newfrenchy83,2021-01-20 12:30:21+00:00,2021-01-20 12:51:56+00:00,{'Editor': 1},attempt to fix build after https://github.com/wesnoth/wesnoth/commit/601c10cadfe14953c28e3ac9f21416d7299d1f09
557629702,wmllint: fix textdomain errors,hexagonrecursion,2021-01-19 18:34:49+00:00,2021-01-20 13:00:12+00:00,"{'Campaign (any)': 1, 'Units': 1, 'Terrain': 1}","Ibanovic wants all #textdomain declrations in line 1: c10cf2b68b6

Several files were missing an explicit textdomain declaration.
Three of them actually have translated strings that defaulted to ""wesnoth"" textdomain:
- data/campaigns/World_Conquest/resources/data/training.cfg
- data/campaigns/World_Conquest/era/campaign/heroes.cfg
- data/campaigns/World_Conquest/scenarios/WC_II_scenario.cfg"
557522453,Add side=1 in httt_utils.cfg to appease wmllint,hexagonrecursion,2021-01-19 15:43:12+00:00,2021-01-20 19:26:37+00:00,{'Campaign (any)': 1},"This PR fixes the following wmllint errors:
""data/campaigns/Heir_To_The_Throne/utils/httt_utils.cfg"", line 697: unit declaration without side attribute
""data/campaigns/Heir_To_The_Throne/utils/httt_utils.cfg"", line 712: unit declaration without side attribute
""data/campaigns/Heir_To_The_Throne/utils/httt_utils.cfg"", line 727: unit declaration without side attribute

As far as I understand this should be safe - side defaults to 1 anyway."
557456004,wmllint: Stop looking for wml tags inside [lua],hexagonrecursion,2021-01-19 14:08:42+00:00,2021-02-11 17:10:39+00:00,{'WML Tools': 1},"wmllint should not search for wml tags and keys inside [lua].
I caught it trying to add a translation mark in 23_Test_of_the_Clans inside a [lua] tag."
557426927,HTTT: add wmllint: recognize Kalenz Delfador Konrad Li'sar,hexagonrecursion,2021-01-19 13:22:48+00:00,2021-01-19 16:00:06+00:00,{},"wmllint tries to detect errors such as a scenario referencing the unit by id before it is introduced by via [recall], [unit] etc. The definition of ""before"" wmllint wants to check is chronological: ""does an event that introduces a unit happen before an event that references it?"", but the current implementation cheats by simply checking if the definition textually precedes the reference.

22_Return_to_Wesnoth contains two prestart events. The first prestart event defines an event that triggers on turn 4. The second prestart event introduces Kalenz, Delfador and Li'sar.
I could merge the prestart events and reorder the code to avoid the wmllint error, but since it does not actually make the code easier to read I chose a less disruptive option of simply adding ""wmllint: recognize""."
557392177,HTTT: add wmllint: recognize Simyr,hexagonrecursion,2021-01-19 12:20:44+00:00,2021-01-19 15:57:32+00:00,{'Campaign (any)': 1},"wmllint tries to detect errors such as a scenario author forgetting to introduce a unit via [recall], [unit] etc and then referencing the unit by id.

Simyr is added to your recall list if you beat 02_Blackwater_Port on HARD by killing the orc leader.

In this instance the scenario author not automatically recalling Simyr is clearly intentional."
557015653,HTTT: don't change unit id,hexagonrecursion,2021-01-18 20:07:44+00:00,2021-01-18 20:18:16+00:00,{'Campaign (any)': 1},"05b_Isle_of_the_Damned was using black magic: [store_unit] plus [set_variable] to change a unit's id. This confused wmllint. This is also just unnecessarily complicated since there are two more conventional ways to refer to the same unit: role=Advisor and id=$hidden_advisor.id. I chose the first option.

# Testing
- [x] Old save
  Before applying this PR:
  1. Start HTTT
  2. Create an easily identifiable unit that matches the role selector (eg Elvish Sylph)
  3. Optional: rename the unit
  2. :choose_level 05b_Isle_of_the_Damned
  3. Save & quit to desktop
  4. Apply the PR
  5. Load
  6. debug kill the liches
  7. See that the message works correctly
- [x] New save
  After applying the PR
  1. Start HTTT
  2. Create an easily identifiable unit that matches the role selector (eg Elvish Sylph)
  3. Optional: rename the unit
  2. :choose_level 05b_Isle_of_the_Damned
  6. debug kill the liches
  7. See that the message works correctly"
556845722,Fix wmllint error: no textdomain string,hexagonrecursion,2021-01-18 14:26:08+00:00,2021-01-18 19:58:05+00:00,{'Campaign (any)': 1},"""data/campaigns/Eastern_Invasion/utils/animations.cfg"", line 1: no textdomain string
"
556816098,"DiD: suppress: Inky speaks in his/her ""die"" event rather than ""last breath""",hexagonrecursion,2021-01-18 13:36:55+00:00,2021-01-18 19:57:57+00:00,{'Campaign (any)': 1},"It is a common mistake to have a unit speak in his/her ""die"" event (after the death animation is played). Wmllint tries to catch that. In this case, however, Inky does not actually die (as far as the plot is concerned) so it is a perfectly valid stylistic choice for her to make a ""Bloub"" sound as she dives into the water."
556638433,DiD: add wmllint: recognize Jaime,hexagonrecursion,2021-01-18 08:51:17+00:00,2021-01-18 19:57:28+00:00,{'Campaign (any)': 1},"This PR silences a wmllint error (unknown 'Jaime' referred to by id) in DiD caused by an intentional scenario design choice.

wmllint checks that every unit referred to in [event], [message] etc is first introduced by [unit], [recall] etc. It does this to catch errors where a scenario author forgets to recall a unit. Jaime is spawned by an easter egg in 07a_A_Small_Favor. Jaime may be on the recall list for this scenario if the egg was triggered and if Jaime survives 07a, 07b and 07c. I assume that in this case the scenario author intentionally counts on the player manually recalling Jaime instead of using [recall]."
556618475,Use wmllint: recognize instead of blanket wmllint: ignore in DiD,hexagonrecursion,2021-01-18 08:22:07+00:00,2021-01-18 19:57:03+00:00,{'Campaign (any)': 1},This is a follow-up for #5442. I have found a better way to suppress the wmllint error.
556452013,Convert relevant cases of lexical_cast to std::to_string().,Pentarctagon,2021-01-18 01:10:23+00:00,2021-01-18 06:51:42+00:00,"{'MP': 1, 'UI': 1, 'Add-ons': 1}","In general I think it's best to use std implementations unless there's a functional or performance reason not to, but also in a few cases this also allows removing the include of lexical_cast.hpp."
556441571,Unit: converted upkeep handling to std::variant,Vultraz,2021-01-18 00:27:46+00:00,2021-01-19 03:24:06+00:00,"{'Units': 1, 'Lua API': 1}","The upkeep_parser_visitor is still boost::variant-compatible since it's used by
const_attribute_value::apply_visitor, and configs still use boost::variant under the hood.

Additionally, these visitors are used in multiple places, so I can't convert them to lambas in-class.

Finally, I used brace-init for the upkeep types and visitors to make it clearer these are not functions."
556412097,Testing CI for structured bindings,Vultraz,2021-01-17 20:58:22+00:00,2021-01-17 22:44:42+00:00,"{'AI': 1, 'UI': 1, 'Lua API': 1}",Test test test
556378628,DiD: refactor scripted experience gain,hexagonrecursion,2021-01-17 17:00:05+00:00,2021-01-18 05:22:48+00:00,{'Campaign (any)': 1},"My primary motivation was internationalization: with one added string we can translate all these messages.
```
_ ""+$experience_gained| exp""
```

~This PR is currently in draft status pending testing.~ Testing was successful."
556344881,GUI2/Dispatcher: refactored [dis]connect_signal to use constexpr-if,Vultraz,2021-01-17 13:08:34+00:00,2022-04-01 09:30:17+00:00,{'UI': 1},"Opening as a PR for comments on the design, as well as waiting until we get the MacOS requirements sorted. Not 100% this is the correct use of `std::is_convertible`, but it does seem to work."
556326696,Update codeblock for recent changes ,newfrenchy83,2021-01-17 10:44:54+00:00,2021-01-17 10:45:32+00:00,{'Building': 1},
556317398,Upgrade to Lua 5.3.6,Vultraz,2021-01-17 09:21:10+00:00,2021-01-17 10:28:48+00:00,{},Resolves #5452. There were no official patches to apply.
556305255,Hide warnings from GCC 10 if compiling with LTO,sevu,2021-01-17 08:00:42+00:00,2021-01-18 19:53:06+00:00,"{'Building': 1, 'SCons': 1, 'CMake': 1}","That way we could hide the warning where necessary, without specifying for all build steps.
Should we?"
556246152,Large JPG backgrounds,doofus-01,2021-01-16 23:08:23+00:00,2021-05-31 00:35:42+00:00,"{'Graphics': 1, 'MP': 1, 'Terrain': 1}",Dealing with #5416
556241159,Update to require C++17.,Pentarctagon,2021-01-16 22:19:39+00:00,2021-01-16 23:05:48+00:00,"{'Building': 1, 'SCons': 1, 'CMake': 1}",This then also bumps the minimum GCC version to 7.
556226377,wmlxgettext: support double quotes in raw strings (fixes #4484),stevecotton,2021-01-16 20:05:51+00:00,2021-01-16 20:15:37+00:00,{'Translations': 1},"This adds support for _<<map=""{maps/01_First_Map.map}"">>, as used in the
editor file format documentation.

This doesn't require another .pot update, because both the workaround in
3d77d36 and this fix generate the same string in the .pot file. However, it
does change the string that the Wesnoth executable looks for so that it matches
the .pot file's contents.

Cherry picked from commit c30c30acfc3b8ba85742a449e2e65beec3dedfcd, and
additionally reverted commit 3d77d36bb0dc4db1afb3e3c1c0d2dbf7f4c6c77d."
556194696,update codeblock projectfiles,newfrenchy83,2021-01-16 16:00:48+00:00,2021-01-16 16:04:19+00:00,{'Building': 1},
556162009,Mention in  INSTALL.md that Vorbisfile is sometimes called libvorbis,hexagonrecursion,2021-01-16 11:39:48+00:00,2021-01-16 11:48:03+00:00,{},
556139733,DiD: fix some wmllint errors,hexagonrecursion,2021-01-16 09:23:37+00:00,2021-01-18 07:09:08+00:00,{'Campaign (any)': 1},"This PR:
1. adds `#wmllint: display on/off` in several places where line breaks inside messages are clearly intentional
2. Suppresses a wmllint false positive: `unknown 'YOgre2' referred to by id`"
556090562,Use gcc-9 in the Scout runtime instead of gcc-5.,Pentarctagon,2021-01-16 07:07:39+00:00,2021-01-16 21:44:00+00:00,{},"The gcc-9 shipped with the Scout runtime forces the use of -static-libstdc++ which is what allows this to work. However, LTO is not yet able to be enabled since as of right now it simply crashes immediately with `free(): invalid pointer`.

---

Note 1: Information about the Scout-provided `gcc-9` comes from https://github.com/ValveSoftware/steam-for-linux/issues/7430#issuecomment-761068435
Note 2: The updated docker image has not yet been uploaded for this PR."
555896835,Convert custom doc comments to doxygen.,Pentarctagon,2021-01-15 19:15:59+00:00,2021-01-16 14:26:58+00:00,"{'UI': 1, 'Editor': 1, 'Add-ons': 1, 'Schema': 1}",NOTE: This does not do any validation of the existing documentation for whether it's correct or complete.  That would be the job of someone who actually knows the code being documented.  This is simply a format conversion to have everything now use the doxygen format.
555619866,Silence warnings about a missing translation mark,hexagonrecursion,2021-01-15 10:52:22+00:00,2021-01-15 14:33:24+00:00,{'Campaign (any)': 1},There is nothing that needs translating here
555572085,Quote an attribute value,hexagonrecursion,2021-01-15 09:26:33+00:00,2021-01-16 09:20:08+00:00,{'Campaign (any)': 1},"~~1. According to this https://github.com/wesnoth/wesnoth/commit/6405507b2408fc79511c0210a7a39689d56a4b6f  `[message]` with `speaker=narrator` is supposed to have `image=wesnoth-icon.png`~~

2. https://github.com/wesnoth/wesnoth/blob/75271a824657b0be63369ed4fc55cf0cb3579429/data/tools/wmllint#L2583
"
555558711,Fix typo: team_name was used instead of user_team_name,hexagonrecursion,2021-01-15 09:01:18+00:00,2021-01-15 19:28:13+00:00,{'Campaign (any)': 1},
555558535,wmllint: Ignore location_id when checking for shroud and fog,hexagonrecursion,2021-01-15 09:01:01+00:00,2021-02-02 14:41:35+00:00,{'WML Tools': 1},"The following line was causing a wmllint error because it contains _s:
```
Irs, book_start Icr^Ii, Irs
```
```
""../../data/campaigns/Descent_Into_Darkness/maps/07c_A_Small_Favor3.map"", line 10: warning, fog or shroud in map file
```"
555423428,Add [effect]apply_to_vision= attribute to [effect]apply_to=movement,stevecotton,2021-01-15 05:56:33+00:00,2021-05-13 16:02:37+00:00,"{'Unit Tests': 1, 'WML': 1, 'Units': 1, 'Schema': 1}","Add attribute also_apply_to_vision to [effect]apply_to=movement

When processing [effect]apply_to=movement, if also_apply_to_vision is 'yes'
(which is the default) then the vision points will change by the same amount.
Previously, it sometimes affected vision and sometimes didn't; for most cases
where it makes a difference, I expect it to be a change from unanticipated
behavior to expected behavior.

Please refer to the new unit test added in this commit for more detailed docs;
that test is also a rough draft for the Wiki update needed when this merges.

The reason it sometimes affected vision was that the special value of -1 vision
points was interpreted as ""use the value of the max movement points instead"".
The special value of -1 is still supported and frequently used, and refactor that
is out of scope for this commit - it's easy to check when the code path changed
in this commit is used, however it's considerably more complex to find all
routes that create a unit with vision set to -1.

I'm expecting one add-on, Rebirth In Nature, to need a large update for this;
as well as a trivial change needed to the Add Creature Pack.

There are several mods that have their own handling for vision, recalculate the
values frequently, and are expected to continue working as before, as they'll
just overwrite any changes that the engine makes.
* Proper Flying Mod / Proper Vision Mod
* LotI
* Blessed Altar Mod
* Shards Era's `CALCULATE_WEAPONS_ONLY` macro
* Castle of Evil Spirit

Rebirth In Nature is an RPG-style campaign that expects the player's unit to
have vision separated from movement along with right-click menus that change
the character's movement, this will probably need `also_apply_to_vision=no` in
many places. OTOH, its `item_id=mobility` uses `apply_to=movement` followed by
`apply_to=vision` to implement in 1.14 what this change will make default
behavior in 1.16.

There are a few sharpshooter units which have vision better than their
movement. If given a buff which boosts their movement, this will give
them a buff to vision too; likely a change towards expected behavior.
* Archaic Era's Royal Ranger
* Ageless Era's Royal Ranger and Dwarvish Forest Sniper
* Eastern Europe at War's Yacht and Great Yacht
* Era of More Units's Lone Wolf
* Southernerns has several sharpshooters
* WWII Era has several sharpshooters
* War of Dominions has some guard towers with very low movement

Silver Age has abilities that modify vision based on time-of-day, but unlike
the Proper Flying Mod and LotI these are done by adding and removing objects
that add or subtract one vision point, these should be unaffected by this
change. Unrelated to that, it declares values for `[unit_type]vision=` even
when the value is the same as max moves - like the sharpshooters this means
that buffs to their movement wouldn't have buffed their vision but now do.

There are few units with vision less than movement. Generally these seem to be
missile weapons that are represented as units, and they probably won't meet any
apply_to=movement statements - even if a movement power-up is available, the
player would probably choose a different unit.

The Add Creature Pack has two creatures (the Cactose Elder and Carnivore Fatal
Plant) that have reduced vision, along with AMLAs that increase those units'
movement; these AMLAs will need to use `also_apply_to_vision=no`. These two
creatures are used in Castle of Evil Spirit, but they won't get enough
experience to get an AMLA there.

Fixes #3356."
555171772,Fix wrong comment handling in wmllint,hexagonrecursion,2021-01-14 20:00:04+00:00,2021-01-14 20:11:15+00:00,{'WML Tools': 1},"This PR fixes the following wmllint error:
```
../../data/campaigns/Dead_Water/scenarios/06_Uncharted_Islands.cfg, line 22: [advancefrom] needs to be manually updated to [modify_unit_type] and moved into the _main.cfg file
```

A comment containing a string [advancefrom] was causing wmllint to get confused

https://github.com/wesnoth/wesnoth/blob/92fedf8f2aa7a4b83fe0e59e7e0e4f2c16e3c207/data/campaigns/Dead_Water/scenarios/06_Uncharted_Islands.cfg#L22"
555154358,Silence wmllint error about a missing campaign id,hexagonrecursion,2021-01-14 19:33:28+00:00,2021-01-14 20:11:31+00:00,{'Campaign (any)': 1},"This PR fixes the following wmllint error:
```
""../../data/campaigns/Dead_Water/_main.cfg"", line 76: campaign requires an ID attribute but has none
```

This wmllint error was caused by the fact that the campaign definition is split into two and wmllint is not smart enough to understand that.

https://github.com/wesnoth/wesnoth/blob/92fedf8f2aa7a4b83fe0e59e7e0e4f2c16e3c207/data/campaigns/Dead_Water/_main.cfg#L7-L8
https://github.com/wesnoth/wesnoth/blob/92fedf8f2aa7a4b83fe0e59e7e0e4f2c16e3c207/data/campaigns/Dead_Water/_main.cfg#L74-L76

"
555143763,Fix comment parsing in wmllint,hexagonrecursion,2021-01-14 19:16:58+00:00,2021-01-14 22:24:10+00:00,{'WML Tools': 1},"wmllint saw [side] inside a comment and incorrectly assumed it is reading a side definition
This PR fixes the following wmllint errors:
```
""../../data/multiplayer/scenarios/4p_A_New_Land.cfg"", line 484: side number 5 is out of sequence (11 expected)
""../../data/multiplayer/scenarios/4p_A_New_Land.cfg"", line 488: side number 5 is out of sequence (11 expected)
""../../data/multiplayer/scenarios/4p_A_New_Land.cfg"", line 512: side number 6 is out of sequence (11 expected)
""../../data/multiplayer/scenarios/4p_A_New_Land.cfg"", line 516: side number 6 is out of sequence (11 expected)
""../../data/multiplayer/scenarios/4p_A_New_Land.cfg"", line 540: side number 7 is out of sequence (11 expected)
""../../data/multiplayer/scenarios/4p_A_New_Land.cfg"", line 544: side number 7 is out of sequence (11 expected)
""../../data/multiplayer/scenarios/4p_A_New_Land.cfg"", line 568: side number 8 is out of sequence (11 expected)
""../../data/multiplayer/scenarios/4p_A_New_Land.cfg"", line 572: side number 8 is out of sequence (11 expected)
""../../data/multiplayer/scenarios/4p_A_New_Land.cfg"", line 805: side number 1 is out of sequence (11 expected)
""../../data/multiplayer/scenarios/4p_A_New_Land.cfg"", line 818: side number 2 is out of sequence (11 expected)
""../../data/multiplayer/scenarios/4p_A_New_Land.cfg"", line 831: side number 3 is out of sequence (11 expected)
""../../data/multiplayer/scenarios/4p_A_New_Land.cfg"", line 844: side number 4 is out of sequence (11 expected)
```"
555121532,Replace fog and shroud in map files,hexagonrecursion,2021-01-14 18:31:45+00:00,2021-01-14 22:25:31+00:00,{'MP': 1},"This PR fixes the following wmllint errors:
```
""../../data/multiplayer/maps/6p_Team_Survival.map"", line 2: warning, fog or shroud in map file
""../../data/multiplayer/maps/Dark_Forecast_drought.map"", line 2: warning, fog or shroud in map file
""../../data/multiplayer/maps/Dark_Forecast_firstsnow.map"", line 2: warning, fog or shroud in map file
""../../data/multiplayer/maps/Dark_Forecast_secondsnow.map"", line 2: warning, fog or shroud in map file
```"
554709975,Fix wmllint confusing fake map border for fog,hexagonrecursion,2021-01-14 07:09:11+00:00,2021-01-14 07:22:02+00:00,{'WML Tools': 1},"This PR fixes a wmllint bug that causes it to complain about fog in maps that contain a fake map border terrain code.

To quote https://wiki.wesnoth.org/TerrainCodeTableWML :

name | string
-|-
Fake Map Border | ^_fme
Fog | _f

This bug causes the following wmllint error:
```
""data/multiplayer/maps/2p_Hornshark_Island.map"", line 2: warning, fog or shroud in map file
```"
554662227,Fix several wmllint errors in data/core/units,hexagonrecursion,2021-01-14 05:50:33+00:00,2021-01-14 05:54:10+00:00,{'Units': 1},"This PR fixes the following wmllint errors:
```
""../../data/core/units/monsters/Frost_Stoat.cfg"", line 35: double space after sentence end
wmllint: converting ../../data/core/units/monsters/Frost_Stoat.cfg
""../../data/core/units/monsters/Scarab.cfg"", line 25: double space after sentence end
wmllint: converting ../../data/core/units/monsters/Scarab.cfg
""../../data/core/units/monsters/Wild_Wyvern.cfg"", line 44: description needs translation mark
""../../data/core/units/monsters/Wild_Wyvern.cfg"", line 44: double space after sentence end
wmllint: converting ../../data/core/units/monsters/Wild_Wyvern.cfg
""../../data/core/units/nagas/Dirkfang.cfg"", line 18: double space after sentence end
wmllint: converting ../../data/core/units/nagas/Dirkfang.cfg
""../../data/core/units/nagas/Ophidian.cfg"", line 18: double space after sentence end
wmllint: converting ../../data/core/units/nagas/Ophidian.cfg
""../../data/core/units/nagas/Ringcaster.cfg"", line 17: double space after sentence end
wmllint: converting ../../data/core/units/nagas/Ringcaster.cfg
```"
554652546,Add missing NOTE_MARKSMAN to Dune Sky Hunter,hexagonrecursion,2021-01-14 05:24:00+00:00,2021-01-14 05:55:12+00:00,{'Units': 1},"Dune Sky Hunter has a {WEAPON_SPECIAL_MARKSMAN} but is missing {NOTE_MARKSMAN}
https://github.com/wesnoth/wesnoth/blob/cd833206b19bc2982e0d914b42fa2e785c7f4608/data/core/units/dunefolk/Sky_Hunter.cfg#L150-L161

This PR adds the missing {NOTE_MARKSMAN}"
554628913,Fix wmllint textdomain warnings in data/core/terrain-graphics,hexagonrecursion,2021-01-14 04:09:54+00:00,2021-01-14 05:54:45+00:00,{'Terrain': 1},"# Purpose of this PR
Fix wmllint errors:
```
""../../data/core/terrain-graphics/borders.cfg"", line 1: no textdomain string
""../../data/core/terrain-graphics/bridge.cfg"", line 1: no textdomain string
""../../data/core/terrain-graphics/editor.cfg"", line 1: no textdomain string
""../../data/core/terrain-graphics/gates.cfg"", line 1: no textdomain string
""../../data/core/terrain-graphics/new-macros.cfg"", line 1: no textdomain string
```

# Describe the solution
Add `#textdomain wesnoth` declaration to the files listed above. As far as I can tell this is just a formality: the files do not contain any strings that need a translation. I can see several other files in the same directory also defining `#textdomain wesnoth` as a formality. Example:

https://github.com/wesnoth/wesnoth/blob/cd833206b19bc2982e0d914b42fa2e785c7f4608/data/core/terrain-graphics/aquatic.cfg#L1"
554358339,Add #textdomain wesnoth to two files w/o explicit textdomain,hexagonrecursion,2021-01-13 17:49:30+00:00,2021-01-13 18:20:53+00:00,{},"# Purpose of this PR
Fix wmllint errors:
```
""../../data/core/macros/movetypes.cfg"", line 1: no textdomain string
""../../data/core/macros/optional_unit_advancements.cfg"", line 1: no textdomain string
```

# Describe the solution
Add `#textdomain wesnoth` declaration to this two files. As far as I can tell this is just a formality: the files do not contain any strings that need a translation. I can see several other files in the same directory also defining `#textdomain wesnoth` as a formality. Example:
https://github.com/wesnoth/wesnoth/blob/d9ec9b9b55a5063a7709c52e6f28edaedad918a3/data/core/macros/event-utils.cfg#L1"
554326335,Add #textdomain wesnoth to data/core/about_i18n.cfg,hexagonrecursion,2021-01-13 16:54:20+00:00,2021-01-13 16:56:53+00:00,{'WML': 1},"wmllint complained:
""../../data/core/about_i18n.cfg"", line 1: no textdomain string

Despite [data/core/about_i18n.cfg](https://github.com/wesnoth/wesnoth/blob/master/data/core/about_i18n.cfg) missing an explicit textdomain it appears to contain a number of strings marked for translation and I can see [translations](https://github.com/wesnoth/wesnoth/blob/master/po/wesnoth/af.po#L645) for those strings in the wesnoth textdomain folder."
554320828,Add a note about wmllint-1.4,hexagonrecursion,2021-01-13 16:45:45+00:00,2021-01-13 17:27:17+00:00,{'WML Tools': 1},Currently README does not document the purpose of wmllint-1.4
554265665,wmllint: fix typo in a comment,hexagonrecursion,2021-01-13 15:26:00+00:00,2021-01-13 15:41:39+00:00,{'WML Tools': 1},
553357094,Remove the unused completely_redrawn event,stevecotton,2021-01-12 10:34:17+00:00,2021-01-13 00:55:11+00:00,{'Engine': 1},"The main reason for opening the PR is to trigger a CI build; I'm expecting to merge this
within 24 hours unless it gets a negative review comment.

No observers attached themselves to this event. Commit ea257355 removed some
code that should have been triggered by the event, but which now (since
ea257355) uses the ""theme_reset"" event or update_enabled_buttons() instead."
552453065,more north-facing sprites,doofus-01,2021-01-11 02:49:54+00:00,2021-01-25 00:56:34+00:00,"{'Graphics': 1, 'Units': 1}","another small traunch of north-facing sprites, to include basic animations - setting a goal of four units
- [x] loyalist bowman (standing frame, melee defense anim, ranged defense/attack anims)
- [x] troll whelp (standing frame, defense anim, idle anim)
- [x] dunefolk skirmisher (standing frame, defense anim)
- [x] outlaw footpad (no idle anims, but the existing male idle anim seemed to be broken anyway - apparently since 2013)

I'll update this list as it progresses"
552278237,fix WFL variables aren't getting assigned correctly ,newfrenchy83,2021-01-10 12:49:27+00:00,2021-01-10 17:24:03+00:00,{'Units': 1},fix attacker and defender formula pointed both' self'. Fix https://github.com/wesnoth/wesnoth/issues/5414 issue.
551784773,Make wesnothd use iterators instead of socket_ptrs to keep track of players,loonycyborg,2021-01-08 15:07:17+00:00,2021-01-21 01:51:26+00:00,{},"Use `player_iterator` typedef instead of `socket_ptr` to refer to players once they're logged in. `player_iterator` points directly to player's record in `player_connections_` container allowing for access to any stats associated with player without searching by socket. Also this paves way to potentially remembering disconnected players for purpose of implementing player reconnect feature.

Interface conventions:
- `player_iterator` arguments should always refer to player existing in `player_connections_`. Potential past-the-end iterators should be checked for before passing the `player_iterator` to other functions.
- `utils::optional<player_iterator>` should be used in cases where actual player may not exist."
550026498,Add support for asynchronously querying a player's game history for display on the client.,Pentarctagon,2021-01-06 06:24:01+00:00,2021-01-16 18:48:08+00:00,"{'MP': 1, 'Services': 1, 'Add-ons': 1, 'Building': 1}","---

The server expects a request of (`search_for` optional):
```
[game_history_request]
    offset=NN
    search_for=""a_username""
[/game_history_request]
```
and will send a response with a [game_history_result] per game in the form of:
```
[game_history_result]
    game_name=""game name""
    reload=yes|no
    game_start=""some timestamp""
    scenario_name=""some scenario name""
    scenario_id=""some scenario id""
    era_name=""some era name""
    era_id=""some era id""
    [player]
        name=""p1""
        faction=""drakes""
    [/player]
    [player]
        name=""p2""
        faction=""loyalists""
    [/player]
    [modification]
        name=""some mod name 1""
    [/modification]
    [modification]
        name=""some mod name 2""
    [/modification]
    [modification]
        id=""some_mod_id_1""
    [/modification]
    [modification]
        id=""some_mod_id_2""
    [/modification]
[/game_history_result]
```

Also, I'm thinking it would make sense at this point to add an index to the game table's `START_TIME` (for the `order by` clause) and the player table's USER_ID (since it's used in the `exists` part of the statement)"
549073089,"[1.14] Re-enable the editor help, add docs about keyboard modifiers and the scenario editor",stevecotton,2021-01-05 13:59:55+00:00,2021-01-06 09:26:16+00:00,"{'Docs': 1, 'Editor': 1, 'Prose': 1}","A couple of warnings about the scenario mode being buggy are added to the
user-visible text, find these by looking for <bold> tags within the text.

This takes all the changes to the editor documentation that were made to master
up to and including a4711ebad9. There have been no changes at all to the editor
documentation in the 1.14 branch, while there have been several updates to the
master branch that would be good to backport if the help is displayed in the
1.14 branch - this commit simply pulls the entire file into the 1.14 branch
along with enabling the editor documentation (a small change to
data/core/help.cfg, as done in commit ed611f9438).

The sound source tool isn't mentioned at all in this documentation. There is a
button for it in the 1.14 UI, but that button's only function is to say that
it's not implemented, so documentation seems unnecessary.

Fixes #2964 for the 1.14 branch."
547904096,terrain-graphics - iron fence fix,doofus-01,2021-01-03 16:32:24+00:00,2021-01-03 17:22:05+00:00,{'Terrain': 1},"A better fix than dd322ccbf4f31545b2ff567565a274d629b49a0e
"
547734469,cave_map_generator.lua: limit find_path dimensions to inner board.,virtualghetto,2021-01-02 09:25:48+00:00,2021-02-16 18:46:03+00:00,{'Lua API': 1},"find_path last 2 arguments are the dimensions of the map.
If you create 2 chambers and a passage at the bottom edge of the map, the generated path will be impassable because it goes into the border.
This PR makes find_path consider the inner board only for its path calculation.
"
547728640,Store content names for game history viewer.,Pentarctagon,2021-01-02 08:05:28+00:00,2021-01-03 05:45:46+00:00,{'Services': 1},
547715613,SoF sound track,doofus-01,2021-01-02 04:58:35+00:00,2022-06-28 02:51:44+00:00,"{'Campaign (any)': 1, 'Audio': 1}","I guess this is subjective, but the sound track to this campaign seemed very ... default."
547706718,North-facing sprites,doofus-01,2021-01-02 03:11:26+00:00,2021-01-03 04:42:03+00:00,"{'Graphics': 1, 'Units': 1}","This PR is for some minor touch-ups to old sprites, and addition of north-facing frames.

North-facing frames might make unit recognition more difficult if not done well, but I think it does more to fight the sliding statue effect than the bobbing animations I am trying to remove or reduce."
547297055,Doxygen cleanup,Pentarctagon,2020-12-31 09:00:44+00:00,2021-01-01 05:59:29+00:00,"{'AI': 1, 'Docs': 1, 'UI': 1, 'Editor': 1, 'Units': 1, 'Lua API': 1, 'Add-ons': 1, 'Help': 1, 'Terrain': 1}","This PR:
* Updates the `Doxyfile`, in particular removing some configuration attributes that are obsolete.
* Fixes all warnings that were printed from doxygen.
* Changed all cases of `///` and `//!` to `/**` for consistency with the rest of the codebase.
* Added a CI check to fail if bad doxygen documentation is added.
* Changes the graph images generated by doxygen from PNG format to SVG."
547245761,Wesnothd: cleaned up usage of document smart pointers,Vultraz,2020-12-31 06:47:34+00:00,2020-12-31 09:27:38+00:00,{},"This removes the use of boost::ptr_vector and replaces it with a vector of unique_ptr<document>. document::clone was also made to return a unique_ptr, which allows for the unification of doc pointer management. We don't have stray document pointers anymore, there's no manual deletion, and it's clear who owns what when (ptr_vector maintains ownership of the pointers it holds, but it's clearer to have everything using unique_ptr).

This also changes usecases of shared_ptr to unique_ptr and makes accommodations accordingly. `handle_player_in_game` and `handle_player_in_lobby` now take a document reference instead of shared_ptrs (they don't do anything with said pointers, and I don't think there are any async ops there that need them to extend the documents' lifetime). The doc send queue also uses `unique_ptrs` now, too."
547073876,Remove ICCP chunk from PNGs,doofus-01,2020-12-30 20:16:01+00:00,2020-12-30 21:53:54+00:00,"{'Graphics': 1, 'Terrain': 1}","There were libpng warnings for some images, it wasn't always clear which ones.  This might not be the best way to fix it, but it seems to work.  I will have to re-optimize some of the files before this is merged, if it ever is."
547003771,Correct the editor help about loading editor-generated .cfg files,stevecotton,2020-12-30 16:15:25+00:00,2021-01-05 12:50:13+00:00,"{'Docs': 1, 'Editor': 1}",Somehow I forgot to test that it worked on 1.14.
546958709,Remove the editor's unused set_starting_position dialog,stevecotton,2020-12-30 14:06:54+00:00,2020-12-30 14:08:21+00:00,"{'macOS': 1, 'UI': 1, 'Editor': 1, 'Building': 1}",6424d79f489129791fedb23e267565922dba3751 changed to using an editor palette instead.
546296228,SoF - various clean-ups,doofus-01,2020-12-29 02:14:14+00:00,2020-12-30 23:31:59+00:00,"{'Campaign (any)': 1, 'Graphics': 1, 'Units': 1, 'Terrain': 1}","For now just deals with #5395 
Other issues may follow.
Probably do something with the last real scenario as well."
545930133,Remove python script converting custom doc syntax into MediaWiki pages.,Pentarctagon,2020-12-28 05:28:52+00:00,2020-12-31 07:48:52+00:00,{},"WIP: either delete the existing doc comments or convert them to doxygen.

---

The GUI2 wiki pages are currently generated automatically by the `wiki_grabber.py` script.  However they have not been updated in quite a while and based on previous discussion are of questionable value anymore in the first place.  Remaining TODO:

- [ ] Delete the wiki pages that are part of https://wiki.wesnoth.org/Category:GUI_WML_Reference (last update seems to have been a bit over 5 years ago).
- [ ] Convert the existing doc comments to doxygen.
- [ ] Fix all the warnings currently shown when running doxygen.
- [ ] Add a CI check to cause a failure when warnings reappear in the future."
545716525,allow 'traditional' special weapons to take priority over others,newfrenchy83,2020-12-26 17:22:26+00:00,2021-05-17 21:24:11+00:00,"{'Units': 1, 'Schema': 1}","Until then, if the abilities used as weapons can, thanks to overwrite_specials take priority over other abilities of the same type and even over traditional special weapons, the reverse could not be true, this commit should allow to rectify this imbalance in including overwrite_special in special 'traditional' weapons"
545653030,Revisions to bobbing animations,doofus-01,2020-12-26 03:34:49+00:00,2020-12-28 18:43:22+00:00,"{'Graphics': 1, 'Units': 1}","I've never been happy with the heaving motions in the standing/bobbing animations of some of the sprites, for example the spearman and orc archer.  However, the heavy breathing might make sense if the unit was physically failing, so in this PR I've got the filter to be < 1/2 HP-max (just to pick a number).

In principle, a similar distinction/filter could be made for healthy units, like the saurians dancing (just as an example of an existing standing animation that isn't heaving).

Filtering standing animations like this would multiply the needed animations by 2-3X, but we were never going to get all standing sprites animated anyway, and this would make future contributions more conceptually clear (dancing-->subtle shifting-->heaving).

In this PR, I've initially added the Orc Grunt and Archer.  Before committing, I'd move other existing animations similarly, and add some new standing animations.  But only if the concept makes sense, or if it would help the concept make sense."
544980739,ambusher don't workin httt 07_Crosroad.cfg,newfrenchy83,2020-12-23 18:49:03+00:00,2020-12-28 00:18:28+00:00,{'Campaign (any)': 1},fix https://github.com/wesnoth/wesnoth/issues/5383
544585037,Send the player forum ids to the client on the player list.,Pentarctagon,2020-12-23 05:50:48+00:00,2020-12-30 03:25:33+00:00,{},
544556405,Fauna Project - Wyverns,doofus-01,2020-12-23 04:08:20+00:00,2020-12-26 00:19:32+00:00,"{'Graphics': 1, 'Units': 1}","The Wild Wyvern seemed like an afterthought.  Most of the effort here is the sprite and animations, but I touched the attacks and wrote a draft description too."
543308433,Tweak Delfador's Memoirs difficulty,cooljeanius,2020-12-21 07:59:54+00:00,2021-01-25 04:16:30+00:00,{'Campaign (any)': 1},"This campaign mostly had a good difficulty level, there were just a few speedbumps. Specifically, Swamps of Illuven. I kind of went overboard with my changes to Swamps of Illuven at first (making Garrath actually honor his deal on EASY was kind of gamebreaking!), so I then had to go back and add a bunch of other events to reduce the benefit of having Garrath as an ally. Outside of that scenario, though, most of my changes were just basic tweaks to gold and turns amounts. I was kind of bothered by the starting gold being left implicit in many places, so I went and made sure to explicitly specify it in as many places as I felt was necessary. Marking this as a draft because the S06 changes are rather drastic and I am totally open to doing them in a different way. Also it's possible that some of my diffs didn't exactly apply entirely cleanly, so it might be worth trying to apply the patches from https://github.com/cooljeanius/wesnoth_mods/tree/master/campaigns/Delfadors_Memoirs with some different arguments to `patch(1)` to see if I missed anything. 
cc @nemaara "
543145182,Add CI jobs for macOS ARM configurations.,Pentarctagon,2020-12-20 23:00:42+00:00,2020-12-21 01:15:37+00:00,{},
543126653,Fix segfaults and a few other issues in wesnoth.find_path,CelticMinstrel,2020-12-20 20:21:57+00:00,2021-02-19 04:15:31+00:00,"{'AI': 1, 'Campaign (any)': 1, 'Lua API': 1}","This is what I have so far on the matter... I _think_ it addresses every possible case, but I'm quite not sure and I haven't yet tested it.

This includes an API change, deprecating the use of `viewing_side=0` to specify that fog, shroud, and hiding are ignored. Instead, you now use `see_all=true` for this purpose. The reason for this can be found in the issue discussion."
543113592,Include architecture info into wesnoth's informations,hrubymar10,2020-12-20 19:14:35+00:00,2020-12-21 11:33:42+00:00,{},"## Description
Because of universal wesnoth 1.15.8 package I wanted to have easy way to determine which arch user use. So I added this exact patch from commit cbe72f5 into official 1.15.8 package. Now it is good time to discuss it and maybe change it for all platforms.

## Ping
@shikadiqueen
@Pentarctagon "
543060507,"SotBE: fix pronoun (Inarix is an Ambusher, thus female)",celerini,2020-12-20 12:22:57+00:00,2020-12-20 18:56:46+00:00,{'Campaign (any)': 1},
543055617,SotBE S09: name opponent,celerini,2020-12-20 11:41:02+00:00,2020-12-20 18:56:32+00:00,{},
542892863,NEAREST_HEX: variable location_found is no longer used.,virtualghetto,2020-12-19 07:44:41+00:00,2020-12-19 07:57:56+00:00,{'Campaign (any)': 1},"The while loop no longer checks for location_found to stop.
location_found gets set inside the while loop and then gets cleared outside of it.
The variable itself can be safely removed, it serves no purpose."
542748977,SotBE S09: add user_team_name,celerini,2020-12-18 20:03:59+00:00,2020-12-20 00:29:38+00:00,{'Campaign (any)': 1},
542292437,cave_map_generator.lua: fix transform flip,virtualghetto,2020-12-18 05:14:43+00:00,2023-02-12 17:10:58+00:00,{'Lua API': 1},"Reported on the forum.
https://forums.wesnoth.org/viewtopic.php?f=4&t=53679"
542291848,[harm_unit] fix secondary_attack animation,virtualghetto,2020-12-18 05:12:50+00:00,2022-06-28 03:17:31+00:00,{'Lua API': 1},"Discussed on the forum.
https://forums.wesnoth.org/viewtopic.php?f=4&t=53620"
541248515,FS: removed use of Windows-specific error code,Vultraz,2020-12-16 15:30:57+00:00,2020-12-21 01:49:56+00:00,{},"The OS-specific error code headers were deprecated in Boost 1.75 (see #5359). This code was first added back in 2013
(see 037e1c12997fe92a2aed36c8b2a05ff31696e8de) but testing now on Windows 10 using Boost 1.73 at least shows that
`no_such_file_or_directory` is returned for both missing files and paths. Seems unnecessary to keep this case around
especially as the header is deprecated going forward."
540934261,Remove the ability to change a unit's ID from the editor.,Pentarctagon,2020-12-16 06:44:40+00:00,2021-04-09 06:55:12+00:00,"{'UI': 1, 'Editor': 1}","The reasoning being:
* Currently the editor will silently not save changes to the ID that match what the editor would assign - for example changing Mage-1 to Mage-99.
* If that were fixed, it's also quite trivial to have the editor create two units with identical IDs - place a Mage (assigned Mage-1), rename to Mage-2, place another Mage -> there are now two units with the ID Mage-2.
* More generally, given that many users of the scenario editor aren't at all familiar with WML and that the wiki says that having multiple units with the same ID ""may produce unpredictable results in many cases"", I feel like this isn't functionality that *should* be exposed in the editor."
540760018,Remove the editor option to assign a recruit list to a unit.,Pentarctagon,2020-12-15 22:30:29+00:00,2020-12-16 05:41:56+00:00,"{'UI': 1, 'Editor': 1, 'Units': 1}",The UI implementation of this is bad enough that I consider its presence to actively a detriment to anyone trying to use the editor.
540713739,gui2/addon_manager: Replace URL widgets with a single link label,irydacea,2020-12-15 20:56:52+00:00,2020-12-16 17:46:16+00:00,"{'UI': 1, 'Add-ons': 1}","**N.B. This PR as it is exposes an unusual bug where the link's events (click, mouse motion) reflect the label's **previous** state whenever the selection changes. This results in situations where the label says ""None"" but it's actually still a clickable URL, or the URL displayed doesn't match the URL that will actually be opened when clicking on it. The PR post here is primarily intended as a test case for @Vultraz.**

The URL widgets (textbox + copy button + browse button) predate the implementation of link-awareness in labels and they sort of got carried over into the new design magically without there being a real need for that. Now that we have a visible cursor change when hovering links it's even less necessary to draw unnecessary attention to the link with a clunky and unintuitive (greyed out textbox...) interface."
540371793,Unit: removed use of boost::ptr_vector,Vultraz,2020-12-15 16:22:12+00:00,2020-12-16 07:51:18+00:00,"{'Units': 1, 'Lua API': 1}",There really seems no reason to use this. Also removes a stray use of `boost::copy` in `game_lua_kernel`.
539952455,Campaigns menu overhaul,irydacea,2020-12-15 03:41:52+00:00,2020-12-19 06:47:55+00:00,"{'UI': 1, 'Engine': 1}","This overhauls the game's Campaigns menu following some of the directions previously suggested in issue #4543.

Requesting reviews from @Vultraz for the UI layout and code changes, @gfgtdf for the engine changes, and @Pentarctagon and @nemaara for the core changes to the single-player campaign UI flow.

## User interface changes

![Screenshot_20201215_002624](https://user-images.githubusercontent.com/489895/102167188-a9238700-3e6c-11eb-903e-5db72a93c7f4.png)
![Screenshot_20201215_003209](https://user-images.githubusercontent.com/489895/102167343-fdc70200-3e6c-11eb-8809-7e67cebe3ee8.png)
![Screenshot_20201215_003039](https://user-images.githubusercontent.com/489895/102167303-eab43200-3e6c-11eb-8664-0484ef1448b0.png)

* The main area of the dialog is rearranged into four distinct sections:
  * The caption row, with the dialog caption and search box
  * The main panel, with the list of campaigns on the left, the campaign description and image on the right, and an image background.
  * The settings row, with the Modifications, Combat (RNG) and Difficulty menus arranged in that order.
  * The control row, with the Play and Cancel buttons.
* The toggle buttons serving as the headers for the list of campaigns have their text centered in order to make the list header seem more tidy in general.
* The **Difficulty menu** is integrated into the dialog in the form of a dropdown menu button. The old standalone menu remains available for use by Load Game and others that may need it.
* The Save random seed option is replaced with a new **Combat** dropdown menu button allowing the player to choose between Default RNG, Predictable RNG (identical to Save random seed), and Biased RNG (identical to the Advanced Preferences experimental PRNG option, **removed** by this PR).

## WML changes

* A new attribute, `background=<image path>` is added to top-level `[campaign]` to allow specifying a custom background image for the main panel. In the absence of this, a default image is used (currently `story/landscape-battlefield_nohumans.jpg`).
* The `random_mode=` attribute in game classification has a new possible value, `biased`, which selects the predictable RNG as with the Save random seed option before but also enables the RNG bias logic in the attack engine (previously the experimental PRNG option). The logic in the `attack` constructor may now be slightly redundant since it shouldn't be possible for `random_mode` to be `biased` and `randomness::generator->is_networked()` to return true (@gfgtdf may want to confirm this).
* `toggle_button` widgets gain new definitions: `listbox_header_centered` (unused), `listbox_header_bg` (unused), `listbox_header_centered_bg` (used by this PR for the campaign list header row).
* `panel` widgets gain new definitions: `panel_listbox_bg` (used by this PR for the campaign list header row), `campaign_menu_bg` (used by this PR for the main campaign menu panel).

## Known issues

* The Difficulty menu button has to compose labels from the label proper specified in `[difficulty]` WML as well as the description in order for the labels to make sense (e.g. for HttT, the difficulty labels would be the rather meaningless ""Fighter"", ""Commander"", ""Lord"" otherwise). The problem arises from the possibility of `[difficulty]` descriptions using Pango markup that will look plain wrong on the menu button proper's label. We don't seem to have a function to unescape markup entities **and** strip Pango markup at the moment, so this is left unsolved in the PR for the time being.
* The Combat menu button has overlong descriptions resulting in a messy dropdown display as seen in the third screenshot above. I'm not entirely sure what to do about this without losing the intended conveyance of information — tooltips perhaps?
* The dialog has layout issues on low resolution (< 1024 px horizontal) modes and other situations where overlong text crops up.on the game settings row at the bottom. I want to fix this, **ideally before merging**.
* There is no way to set modification options from the dialog itself. If this is wanted it could be worked on at a later date, preferably with the help of someone who knows better how modifications work (such as @gfgtdf).
* The idea suggested in issue #4543 of adding a separate tab for tutorials is not implemented yet. There does not seem to be a use case for it yet either since the tutorial only has two scenarios at the moment. I also largely ignore if it's possible to instruct the game to skip to a scenario other than `first_scenario`. I would greatly appreciate some input on this particular point for this PR and others.
* Mainline campaigns have no custom backgrounds defined yet. Below is attached a patch I used to test the feature only, with no real thematic coherence intended ­— save perhaps for HttT, where my best option was the antiquated 1.0 story art used for the Battle for Wesnoth scenario.
* Campaign images (often portraits) are currently allowed to jump around even when the text doesn't take enough space for them to need to do so. Perhaps anchor them to the bottom of the right pane? (Note that @Vultraz seems to be of the opinion that we should do away with the images themselves. I do not agree with this.)
* Campaign descriptions may suffer from text contrast issues when a sufficiently bright background is selected. Currently this is partly alleviated by using a dark translucent overlay on the background (see the `campaign_menu_bg` definition for `panel`). I don't feel we can do anything about this short of adding shadows or (preferably) outlines to the text.
* Long campaign descriptions predictably cause a vertical scrollbar to appear. `multi_page` remembers the scrollbar position for each page and I can't quite decide if this is desirable behaviour or not.

## Reference/test material

### Original Experimental PRNG option patch

See commit 3f06813fcf597b63271e26c9a3a9aa1480020cca and the [forum thread](https://forums.wesnoth.org/viewtopic.php?f=6&t=48160), both by Dave.

### Background image test patch

See https://gist.github.com/shikadiqueen/e66d433d9ee0d6dd4915f986d6658c38."
539699287,dialogue when turns runs out NR S1 and S2,franschel,2020-12-14 17:58:36+00:00,2020-12-15 07:59:53+00:00,{'Campaign (any)': 1},Fixes  #5314 
539033518,fix codeblocks projectfiles,newfrenchy83,2020-12-13 22:30:47+00:00,2020-12-13 23:35:42+00:00,{'Building': 1},
536205339,Tell other clients about controller type changes from :droid,Pentarctagon,2020-12-10 19:41:48+00:00,2020-12-30 15:09:27+00:00,{},"If one client changes the controller type of a side it controls from human -> AI or vice versa, the other clients need to know about it in case there's WML/lua that uses the controller type to determine what to do. This also means that droiding a side you own can now only be done when it's your turn.

Fixes #4996"
536004781,update codeblocks projectfiles,newfrenchy83,2020-12-10 15:08:44+00:00,2020-12-10 15:21:30+00:00,{'Building': 1},
535220055,"Wesnothd: added a login response, including admin status",Vultraz,2020-12-09 14:28:40+00:00,2020-12-09 16:22:39+00:00,{},"This is instead of having the server send a message after the login is complete and before the initial gamelist.
Since we wait at the loading screen for the latter (e41534d114437b26c735915f530df2cbc28e6c15), this has needed
to be handled here (2b4ae206ab796934899a628be6d3808a4ccd6c60), but it doesn't make much sense to be handled this
way. Many years ago this message was meant to show up in chat, but after the former change that no longer happened,
(IIRC) and after the latter change it most certainly won't.

This adds a proper [login_response] response from the server on a successful login which includes an `is_admin`
key containing the user's admin status."
534733135,campaignd: Add strict version check on uploads,irydacea,2020-12-08 21:22:17+00:00,2020-12-09 13:07:00+00:00,{'Add-ons': 1},"This makes it so by default campaignd will reject uploads of existing add-ons without a version bump. A server-side configuration flag (strict_versions) can be optionally enabled to lower the strictness and allow re-uploading the same version -- while still disallowing going backwards.

The reason for making it possible to lower the strictness is that very often while testing campaignd itself it becomes necessary to reupload the same add-on over and over. We don't want to get rid of *that* particular use case.

The server does not currently have a mechanism to advertise the different strictness levels, unfortunately, so clients may in fact need to send a 100 MB rock before finding out it's not good enough for upload. Such is life. This might be solved after #5338 is merged into mainline.

Closes #5079."
533716064,pass documentation outside some macro for fix bugs in loading scenarios,newfrenchy83,2020-12-07 14:30:02+00:00,2020-12-08 04:26:07+00:00,{},this is a fix of https://github.com/wesnoth/wesnoth/issues/5346 issue
533230067,various work on new fauna,doofus-01,2020-12-06 16:57:43+00:00,2020-12-21 03:19:44+00:00,"{'Graphics': 1, 'Units': 1}",miscellaneous additions/fixes to the ongoing wesnoth fauna project
533080803,update test.cpp in codeblock projectfiles,newfrenchy83,2020-12-05 19:28:42+00:00,2020-12-05 20:12:42+00:00,{'Building': 1},
533080303,fix invalide initialisation of preprocess_file in wml_equivalence,newfrenchy83,2020-12-05 19:24:32+00:00,2020-12-05 20:15:32+00:00,{},
533024303,Use coroutines via boost::asio::spawn to improve overall code structure in servers,loonycyborg,2020-12-05 14:22:41+00:00,2020-12-30 16:08:34+00:00,"{'macOS': 1, 'Add-ons': 1, 'Building': 1, 'Packaging': 1, 'SCons': 1, 'CMake': 1}","This will add dependency on boost.coroutine and boost.context which in turn supports only particular arches and OSes, but all platforms that wesnoth would be realistically run on are supported afaict."
532283402,Don't show redundent details on push vs pull request.,Pentarctagon,2020-12-04 04:50:29+00:00,2020-12-04 06:20:11+00:00,{},
532191433,Removed patched boost::bind,Vultraz,2020-12-03 23:49:24+00:00,2020-12-04 00:45:16+00:00,"{'Building': 1, 'SCons': 1, 'CMake': 1}","This seemed to be a patch for older compilers (GCC 4.8/4.9, see https://github.com/boostorg/bind/commit/3c56630b5400c43d1a4393d685a407e68a69ce9e)
which we no longer support."
532169785,campaignd: [server_id] request,irydacea,2020-12-03 22:50:00+00:00,2020-12-10 03:15:18+00:00,"{'UI': 1, 'Add-ons': 1, 'Building': 1}","This new commands allows clients to request some identification and feature capability information from the server, intended to allow clients to find out what features the server supports and enable or disable UI elements accordingly while preserving compatibility where desired.

Currently this results in a response like this:

```
[server_id]
    version=""1.15.7+dev (c7643e0785b-Modified)""
    cap=""auth:legacy,delta""
[/server_id]
```

More information might be added later, such as a website URL and a link to a web listing for the particular server (e.g. <https://add-ons.wesnoth.org/1.16/>), more details on add-on licensing, or even doing away with the need to send `[request_terms]` before displaying the prompt on the client side.

Note: clients assume `cap=auth:legacy` for servers that can't respond to the query in this version. This accurately reflects the situation for Wesnoth 1.14 and earlier. The 1.15.x server will be updated once this feature goes live so that 1.15.8+ clients don't assume that delta packs are not supported even though they very much are since 1.15.6.

Also note that the client support is an early WIP right now. Ideally the code paths that prod the server to find out if delta uploads/downloads are supported will be replaced with a capability check instead. The API for this (`addons_client::server_supports()`) is not in the patchset yet."
532097998,wml/preprocessor: Reduce code duplication in preprocessor conditionals,irydacea,2020-12-03 20:29:00+00:00,2020-12-04 18:13:05+00:00,{'WML': 1},"The code handling `#if(n)def` and `#if(n)have` is largely the same in both the normal and the negated paths, making two code paths redundant. This commit unifies each pair as it should have been done from the beginning.

This commit also alters the implementation of `#if(n)ver` very slightly so we do a single char check instead of comparing against a whole string a second time (we definitely don't need to compare the full thing)."
532095782,Testing123.,Pentarctagon,2020-12-03 20:24:38+00:00,2020-12-04 00:52:50+00:00,{},
531960786,Move 1.14 over to github actions.,Pentarctagon,2020-12-03 17:47:02+00:00,2020-12-03 17:47:10+00:00,{},
531331035,MP: unique background graphics for Isar's Cross,sevu,2020-12-02 22:34:27+00:00,2021-01-10 00:50:47+00:00,"{'Graphics': 1, 'MP': 1, 'Terrain': 1}","Mainlines one of the two maps from VMP.
The graphics were already reviewed by @doofus-01.

TerrainGraphicsWML is black magic, this is mostly the code from VMP, without the need for a separate terrain code. Is there anything which could be done better about it or the wording of the text?
For storing the images, I put them into core, because unlike images elsewhere, ""terrain/"" is silently prefixed to the path. To store them somewhere else a new binary path would be needed.

I leave this open for a few days.."
530620902,update codeblock projectfiles ,newfrenchy83,2020-12-01 22:44:27+00:00,2020-12-01 22:53:10+00:00,{'Building': 1},
530339775,Refactored use of boost::mpl out of lexical_caster,Vultraz,2020-12-01 14:26:40+00:00,2020-12-01 21:13:22+00:00,{},"Essentially, strip the optional const and ptr types from `From` and check it against `char`."
530109181,Converted uses of boost::optional to utils::optional,Vultraz,2020-12-01 08:12:11+00:00,2020-12-01 21:16:06+00:00,"{'UI': 1, 'Editor': 1, 'Units': 1, 'Lua API': 1, 'Add-ons': 1, 'Help': 1, 'Schema': 1}",Coverts usecases of `boost::optional` to `utils::optional`. Doesn't touch the few optional references since those aren't supported with std::optional except via `std::reference_wrapper` which adds an extra layer of indirection that makes conditional compilation difficult.
529837209,Fix [resistance_defaults] and [terrain_defaults] (fixes #5308),stevecotton,2020-11-30 22:01:43+00:00,2021-01-09 08:13:42+00:00,"{'Bug': 1, 'Unit Tests': 1, 'Units': 1, 'Schema': 1}","The draft version included the testing which I'm going to keep out-of-tree, that's now in my stevecotton:debugging/testing_i2486 branch.

These now work:

	[resistance_defaults]
		id=""special_res_for_test""
		default=""30""
	[/resistance_defaults]

	[resistance_defaults]
		id=""copy_of_arcane""
		default=""(arcane)""
	[/resistance_defaults]

and so do these:

	[terrain_defaults]
		id=""special_terrain_for_test""
		[movement_costs]
			default=""(swamp_water + 1)""
			orcishfoot=""(vision_costs.swamp_water * 2)""
		[/movement_costs]
	[/terrain_defaults]
	[terrain_defaults]
		id=""special_terrain_for_test""
		[defense]
			default=""(20 + 7 * movement_costs.special_terrain_for_test)""
		[/defense]
	[/terrain_defaults]

For [terrain_defaults], I've approached it as a new feature rather than a
simple fix. The subtags now use the same names as the [movetype] subtags and
[effect]'s `apply_to` attribute, so [terrain_defaults][movement_costs] instead
of [terrain_defaults][movement].

The formula handling will now recognise ""resistance"", ""movement_costs"",
""vision_costs"", ""jamming_costs"" and ""defense"". For [resistance_defaults], the
formula will recognise both ""(arcane)"" and ""(resistance.arcane)"" as equivalent,
similarly for [terrain_defaults] ""(swamp_water)"" is a shorthand for whichever
subtag is being patched.

A [terrain_defaults] tag may use data added in a previous [terrain_defaults],
as in the examples above where the second tag's [defense] is based on the first
tag's [movement_costs], this gives orcish grunts on the special terrain a 62%
chance to be hit. However, if the [movement_costs] and [defense] were in a
single [terrain_defaults] tag then the result would be implementation defined,
because no guarantee is made of the order in which the children of the tag are
processed.

The schema gets fixed for [resistance_defaults] and [terrain_defaults], as it
only allowed one instance of each tag. The subtags of [terrain_defaults]
already had the new names."
529751689,Add '/roll N' command to games and game lobbies.,kabachuha,2020-11-30 19:09:10+00:00,2020-12-04 13:17:46+00:00,"{'Enhancement': 1, 'MP Lobby': 1}","Adds '/roll N' command which gets a random number between 1 and N and prints it as ""$username rolled a dice [1 - $N] and got a $value."" to the game creation lobby chat or just to the sender otherwise (so not to flood the main server chat and ensure a sense of privacy).

Closes #5221 ."
528882939,units - undead variation for sea serpent(ish) units,doofus-01,2020-11-28 03:10:49+00:00,2020-11-29 21:26:52+00:00,"{'Graphics': 1, 'Units': 1}","I see this working for Sea Serpent, Water Serpent, and Swamp Lizard (Crocodile), and similar UMC.  It's not going to be a perfect match, but it's better than the shark-head merman thing we've currently got (which is fine for mermen, nagas, whatever humanoid hybrids).

- [x] walking corpse sprite frames

- [x] soulless sprite frames

- [x] portrait"
528719058,"Unit test for resistances, could do with Lua advice",stevecotton,2020-11-27 17:11:06+00:00,2020-11-29 21:30:15+00:00,"{'Unit Tests': 1, 'Units': 1}","Add a unit test for resistances (using the standard 6 damage types)

I'm working on a bugfix for [resistance_defaults] (bug #5308), for which the
unit test is going to be out-of-tree until we support some method of testing
it without affecting other tests. The version here is the part of that which
can be in-tree, because it doesn't change the core unit's stats.

This uses some Lua to check that the units have only the expected
resistance types, but I feel there should be a better way to write it."
528596602,NR S2_1: remove rails from castle hexes; fixes #5317,IskarJarak,2020-11-27 12:51:56+00:00,2020-11-27 19:37:36+00:00,{'Campaign (any)': 1},"Removed rails from various castle hexes on the map, as that looked wrong."
527623706,Upload debug build artifacts,Pentarctagon,2020-11-25 18:24:25+00:00,2020-11-25 18:25:03+00:00,{},
526339103,SotA S10: Add some translation hints,stevecotton,2020-11-24 09:30:58+00:00,2020-11-25 13:01:21+00:00,"{'Campaign (any)': 1, 'Translations': 1}","@sevu, I was wondering if the de version of the line should be ""Wart ihr noch nie angeln?"". It sounds okay to me with ""du"", but I'm not a native speaker."
526326067,Test parsing of WML define and undef macros by the preprocessor & parser,ghost,2020-11-24 09:09:27+00:00,2020-11-28 19:52:49+00:00,{'Building': 1},"This commit adds tools to test parsing of WML macros by the preprocessor
and parser. The commit also adds two tests of the #define and #undef
WML macro as examples.

The tests consist of three steps:

1. Define one WML string containing macros and one WML string
   that lacks macros in each test. The two WML strings should be
   equivalent after preprocessing.

2. Transform each WML string into a syntax tree (represented by config
   objects) with the preprocessor and parser of Wesnoth.

3. Check if the two config objects are equal. Since the two WML strings
   are equivalent, the two configs object should be equivalent if the
   preprocessor and parsers are both correct.

The output of the preprocessor is in an undocumented format. Therefore,
this commit does not test the preprocessor as an isolated unit."
525873288,Document the public API of src/config.hpp,ghost,2020-11-23 17:05:39+00:00,2020-11-29 19:51:25+00:00,{},
525781414,"SotA S04: Run wmllint, which fixed some double-spaces in strings",stevecotton,2020-11-23 14:46:12+00:00,2020-11-25 17:30:46+00:00,"{'Campaign (any)': 1, 'Translations': 1}","These texts are only in the master branch, no need to backport to 1.14."
525558804,SotA: Fix translation hints,stevecotton,2020-11-23 08:37:24+00:00,2020-11-24 02:32:41+00:00,"{'Campaign (any)': 1, 'Translations': 1}","They need to be on the line above the string, instead of being a comment
following on the same line as the string."
525408621,Some refactoring of preprocessor macro definition parsing,CelticMinstrel,2020-11-23 02:23:39+00:00,,{'Engine': 1},"While trying to fix the schema test failure (by stripping out comments from the macro definition), I did some refactoring of the logic so it looks more sane and (in my opinion) easier to understand. Although the attempt at filtering out comments ended in failure, I figured the refactoring could still be worthwhile."
525311534,Test config::add_child,ghost,2020-11-22 16:40:24+00:00,2020-11-27 15:46:21+00:00,{},"This commit tests the three config::add_child in src/config.cpp.
The config::add_child are among the most popular methods and
have at least 150 usages."
525230734,Encrypt client/server communication using OpenSSL with Boost Asio.,Pentarctagon,2020-11-22 04:55:12+00:00,2020-12-27 21:36:00+00:00,"{'Add-ons': 1, 'Building': 1, 'CI': 1, 'SCons': 1, 'CMake': 1, 'Docker': 1}","Re-PR of #5287.

Currently implemented are the MP client connection and wesnothd+campaignd since they both use server_base.  I don't know how to run campaignd locally, but for wesnothd I was able to connect, disconnect, and play a short game between two players using my local instance.  I also confirmed that SSL/TLS was definitely being used via `echo """" | openssl s_client -connect localhost:11111` (11111 is the port my local wesnothd uses), the only issue reported being that the certificate used is self-signed.

Things left to do:

- [x] Implement for the add-ons server client.
- [x] See if I can find out why `shutdown: stream truncated` is printed out whenever a [shutdown()](https://github.com/boostorg/beast/issues/995#issuecomment-359507329) is called on the socket now, or whether it can be [ignored](https://github.com/boostorg/beast/issues/824).
- [ ] How to support either SSL or non-SSL?
- [x] Travis certs - see if it works to generate the necessary files during the travis runs rather than having them in the repo.
- [x] Fix the CI.
- [x] Make sure OpenSSL is ready and able to be packaged as part of the macOS release.
- [ ] Testing. In particular, it will need to be tested if macOS and Windows clients will need any OS-specific code to be able to load the system-provided certs.
- [x] Certs - How do we get or create the actual certs that will be used?  [See this comment.](https://github.com/wesnoth/wesnoth/pull/5299#issuecomment-734408639)
- [ ] A couple other TODO comments I left myself.

This is also the first part of addressing #5132."
524118820,Wrap owning editor_action pointers in unique_ptr,AI0867,2020-11-19 17:33:09+00:00,2020-11-20 21:08:59+00:00,{'Editor': 1},It was [recently noted](https://github.com/wesnoth/wesnoth/pull/5254#discussion_r516381049) that the editor works by passing raw owning `editor_action*` around. This PR changes that.
523741689,Add a unit test for the behavior of [unit]id= recalling units,stevecotton,2020-11-19 07:34:47+00:00,2020-11-19 15:07:48+00:00,"{'Unit Tests': 1, 'WML': 1}",Answers a question raised in PR #4999; the test also passes on 1.14.
523370934,Balance update,Hejnewar,2020-11-18 17:56:30+00:00,2020-11-20 04:33:00+00:00,{'Units': 1},"Dune Rider xp changed from 42 to 47.
Sunderer line dodge on hills changed form 60% to 50%.
Scorcher gold cost changed from 23 to 25.
Dragoon gold cost changed from 27 to 28.
Elvish Rider gold cost changed form 32 to 28.

There is no changelog entry in this PR in order to avoid merge conflicts."
522941140,campaignd: Fix broken Windows support,irydacea,2020-11-18 06:12:23+00:00,2020-11-22 02:58:50+00:00,"{'Bug': 1, 'Windows': 1, 'Campaign (any)': 1, 'Add-ons': 1}","This creates temporary files with the `FILE_SHARE_DELETE` sharing mode on Windows when using `filesystem::atomic_commit`,  thus allowing us to rename them to their final location without having to close them beforehand. Without these changes, campaignd gets really upset when trying to rename files created with `atomic_commit` since Windows by default will deny deletion/renaming of open files.

**UPDATE 2020-11-20:** Now it also makes it so the temporary files overwrite the destination in a POSIX-like fashion by using `SetFileInformationByHandle()`.

~~... Or at least so the theory goes.~~

~~`Wine (5.0) is being temperamental and campaignd doesn't work properly on it, with client requests not going completely through for some mysterious reason, and even occasionally crashing with a segmentation fault somewhere in Wine land. Maybe our network code does something that Wine *really* doesn't like. So for the time being, this code is almost completely untested. I may try using MSVC++ instead at some point when I feel like it, or someone else can do it for me.`~~

**Testing procedure:**

* Run `campaignd.exe` so it will generate its initial configuration (`server.cfg`) and data dir in the current working path (or somewhere else if using the `-s <PATH>` command line switch). Make sure it doesn't log any errors involving `server.cfg`.
* Restart `campaignd.exe`. Again make sure it doesn't print any errors involving `server.cfg`.
* Upload an add-on with the Wesnoth client.
* Reupload the same add-on, modified.
* Verify that no errors involving the add-on were printed and that the modified version is what clients get when installing it fresh.

**Caveats:**

~~This is not in a mergeable state right now due to lack of testing. Additionally, the `rename()` call in `atomic_commit::commit()` needs to be replaced with `_wrename()` for Unicode path safety.~~

~~A simpler alternative to calling `CreateFile()` ourselves would be to reset the underlying `ostream` pointer in `filesystem::atomic_commit::commit()` before renaming the temporary file to force it to be closed first. However, this would mean that callers would have to take care not to use any existing references to the `ostream` following a call to `commit()`.~~"
522710230,WIP: Encrypt client/server communication using OpenSSL with Boost Asio.,Pentarctagon,2020-11-17 21:13:45+00:00,2020-11-22 04:53:48+00:00,"{'Add-ons': 1, 'Building': 1, 'CI': 1, 'SCons': 1, 'CMake': 1, 'Docker': 1}","Currently implemented are the MP client connection and wesnothd+campaignd since they both use server_base.  I don't know how to run campaignd locally, but for wesnothd I was able to connect, disconnect, and play a short game between two players using my local instance.  I also confirmed that SSL/TLS was definitely being used via `echo """" | openssl s_client -connect localhost:11111` (11111 is the port my local wesnothd uses), the only issue reported being that the certificate used is self-signed.

Things left to do:

- [x] Implement for the add-ons server client.
- [x] See if I can find out why `shutdown: stream truncated` is printed out whenever a [shutdown()](https://github.com/boostorg/beast/issues/995#issuecomment-359507329) is called on the socket now, or whether it can be [ignored](https://github.com/boostorg/beast/issues/824).
- [ ] How to handle LAN servers/clients? - Probably this will need a runtime check to not use SSL for LAN.  Also this would apply for unofficial servers as well?
- [x] Travis certs - see if it works to generate the necessary files during the travis runs rather than having them in the repo.
- [ ] Fix travis.
- [ ] Make sure OpenSSL is ready and able to be packaged as part of the macOS release.
- [ ] Testing.
- [ ] Certs - How do we get or create the actual certs that will be used?
- [ ] A couple other TODO comments I left myself.

This is also the first part of addressing #5132."
521250943,animal zombie variations,doofus-01,2020-11-15 20:02:26+00:00,2020-11-27 03:19:17+00:00,"{'Graphics': 1, 'Units': 1}","The recently added fauna units and some existing core units, such as the rat, need better undead variations.  Maybe everything doesn't get a custom zombie, but all should get something that sort of makes sense.

Let's start with moving the SotA rat zombie to core.

EDIT:  A to-do list wouldn't hurt.

These are goals for this PR
- [x] move zombie rat to core and add portrait

- [x] zombie falcon (anim frames and portraits)

- [x] fixing gryphon zombie movement anims

- [x] zombie Gorer/Tusklet

These will probably be in a future PR, but we''ll see how it goes.
- [ ] zombie Bear

- [ ] zombie Yeti

- [ ] zombie Croc

- [ ] zombie water/sea serpent

- [ ] zombie cuttlefish"
521222287,"Make saved_game::expand_scenario() look correct, and add a const",stevecotton,2020-11-15 16:37:56+00:00,2020-11-16 03:52:25+00:00,{'Low Priority': 1},"This doesn't change the behavior - the changed line is in a conditional block
which tells us exactly which of scenario_id()'s code paths will happen, and it
will still end up using carryover_[""next_scenario""]. The change is just making
it consistent with the way that other lines in expand_scenario() find out which
scenario id to use; it's preparing to load the next scenario, so it should use
that scenario's id to load any metadata, not the current scenario's id.

Also, scenario_id() should be const. This helps with refactoring out the
existence of a de-facto singleton instance of saved_game."
521118894,Addon manager: Save the last sort order in a hidden preference,stevecotton,2020-11-14 23:47:55+00:00,2020-11-20 05:28:23+00:00,"{'UI': 1, 'Add-ons': 1}","This uses MAKE_ENUM for the listbox sort order, so that it can
be serialized to the preferences file.

This is @jostephd 's PR #4409, reopened as a new issue because it has a new author.
Fixes #1090 ."
521054261,campaignd: Add --timings command line option,irydacea,2020-11-14 20:09:22+00:00,2020-11-14 22:29:47+00:00,"{'Enhancement': 1, 'Add-ons': 1}",Allows reporting the timing for individual requests serviced by campaignd.
520969934,Editor - add top-level WML tag to generated scenarios and change file type detection,Pentarctagon,2020-11-14 06:47:35+00:00,2020-11-17 20:56:57+00:00,{'Editor': 1},Also removes a few typedefs that were defined and then not used at all or only used once.
520666359,fix campaignd in codeblock projectfiles,newfrenchy83,2020-11-13 15:59:12+00:00,2020-11-13 16:04:51+00:00,{'Building': 1},
520222698,SoF: fix #5278 in scenario 4 and a small fix for scenario 2p5,IskarJarak,2020-11-12 23:33:55+00:00,2020-11-17 20:56:27+00:00,{'Campaign (any)': 1},"SoF S2p5:
-  increased the turn limit by 1 because the scenario felt _very_ tight on time even on easy difficulty (and my changes in 1.15.4 slightly increased minimum travel distance).
- the victory event filters were only triggered by Rugnur's moveto events; this is inconsistent with the scenario objectives and could also lead to costing the player a full turn if Rugnur wasn't the last hero moved to the tunnels end. I changed the event to trigger on any player movement while the heroes reached their destination. Tested to work for all three heroes.

SoF S4:
- reverted my commit from 1.15.4 to fix #5278 
- re-added the functionality of that commit and extended it to also encompass rails
- tested this extensively..."
519464966,TSG S8b and epilogue: fix minor inconsistencies,IskarJarak,2020-11-11 21:37:48+00:00,2020-11-11 22:02:54+00:00,{'Campaign (any)': 1},"Fixes two minor inconsistencies reported by Konrad2 on discord.
TSG S8b: removed an impossible loss condition.
Epilogue: now correctly identifies Sir Gerricks weapon as a glaive."
519438743,SotA: Don't concatenate strings in the recruit dialog,stevecotton,2020-11-11 20:39:29+00:00,2020-11-19 06:47:59+00:00,"{'Campaign (any)': 1, 'Translations': 1, 'Units': 1}","Instead of trying to concatenate translatable strings, just make a single full
string to be shown in the recruitment dialog. This came from trying to update
the i18n hints, and realising my suggest of making the swimmers ""Merfolk"" in
f6dc83375 was causing problems when they could also be nagas.

These strings are stored in a variable at the start of the campaign (in
ZOMBIE_INIT), so won't appear when loading an existing save game. This is why
the Lua script keeps some support for the old names (although they're not going
to be translated in that case).

@ivanovic and @shikadiqueen I believe this is better for translators, but is it?
I'd also like to ask and apologise to our Polish translator, who has already translated
the 1.15.6 changes from f6dc83375."
519425309,SotA: Fix Ardonna's zombie list after Rastabahn's scenarios,stevecotton,2020-11-11 20:11:50+00:00,2020-11-16 03:54:09+00:00,"{'Bug': 1, 'Campaign (any)': 1}","Fixes #5256, which was that `{SAVE_ZOMBIE_LIST rastabahn_zombies}` overwrote
the ardonna_zombies variable.

Move the MERGE_ZOMBIE_LIST code to be next to the LOAD and SAVE code, as any
change to one of these functions should probably be done to all of them.

There's a unit test for this in a commit that's auto-attached itself to #5273, but there isn't the framework support to run it - instead it needs #define statements pushed into the toplevel data/_main.cfg file."
519321340,Show an error message when --preprocess-defines is ignored,stevecotton,2020-11-11 16:47:36+00:00,2020-11-13 22:27:39+00:00,"{'WML Tools': 1, 'Engine': 1}","While making it work would be better, this is a minimial change to at least
get the developer back on track instead of wasting time trying to work out
why putting this in a campaign's _main.cfg file doesn't work:

    #ifdef ENABLE_CAMPAIGN_TESTS
        {./test/}
    #endif

Context for this is in #5273. @Pentarctagon thanks for the suggestion, but don't worry I was already trying this and wasting the time before you posted it."
518729426,Update campaignd codeblock projectfiles,newfrenchy83,2020-11-10 19:56:43+00:00,2020-11-10 19:57:49+00:00,{'Building': 1},
518552502,update code block projectfiles,newfrenchy83,2020-11-10 15:03:04+00:00,2020-11-10 15:04:57+00:00,{'Building': 1},upadte after  https://github.com/wesnoth/wesnoth/commit/bbf22443c5ce9203beaf33c02fb366023ba62b7f
517468239,Tweak Dead Water difficulty,cooljeanius,2020-11-09 05:01:45+00:00,2020-12-15 07:44:02+00:00,{'Campaign (any)': 1},"I found Dead Water to be too hard for me when I first played it on EASY, so I tweaked the difficulty a bit. I realize that Dead Water is supposed to be one of the harder campaigns, but since my changes are mostly confined to the EASY difficulty, they shouldn't affect the harder ones too much. I'm marking this as a draft since I messed up the pattern that held between certain values that varied by difficulty, so I might want to re-edit to make that consistent (or not, if people don't want that). I might also want to do an entire second playthru where I edit all the scenarios and not just the ones that gave me trouble, so that's another reason for marking this as a draft. "
517462637,gitignore some additional patterns,cooljeanius,2020-11-09 04:44:01+00:00,2020-11-09 04:45:16+00:00,{},"This is just the gitignore part of #5164; the ignored files are generated and/or binary files that don't belong in the repository.
"
517374913,Add addon version selection dropdown list,kabachuha,2020-11-08 21:40:14+00:00,2020-11-09 18:10:32+00:00,"{'Enhancement': 1, 'UI': 1, 'Add-ons': 1}","Replaced the version display label in the addons manager with a dropdown list displaying all the downloadable versions in descending order with the latest version chosen by default. The selector is frozen for the pubishable addons on their .pbl set version.

The tooltips with useful data like the upload time and the pack size will be added later (not in this pr) as they require some work on the server side.

Tested on my Wesnoth instance."
517124988,"Colored attack type icons, resistances and movement costs. Reordered resistances.",walodar,2020-11-07 11:34:54+00:00,2022-08-01 22:57:47+00:00,"{'Graphics': 1, 'UI': 1, 'Units': 1, 'Help': 1, 'Schema': 1}","Using colors to make relevant information stand out at a quick glance.
The six attack type icons are recolored using the six equidistant hues cyan, green, yellow, red, magenta and blue, with the same saturation and lightness as the old icons. The images are optimized with woptipng.
Resistances and movement costs are colored using a gradient from red to green, like the defense values.
The resistance table in the help browser now also shows the attack type icons.
Previously, the resistance table was always ordered alphabetically by their original English names (not their translation, unlike the terrain modifiers). Now, the order is set to blade - pierce - impact - fire - arcane - cold, this corresponds with their frequency of occurrence and makes the attack type icons form an unrolled color wheel.
These changes are made in all relevant areas, including the help browser, tooltips, the sidebar and dialogs.

Example:
![comparison](https://user-images.githubusercontent.com/58367382/98439825-c68a6600-20f4-11eb-8563-64e8ce33c5f1.png)
"
517052223,Fix theme::operator= not copying width or height,stevecotton,2020-11-07 01:41:00+00:00,2020-11-07 04:39:01+00:00,{},"Detected by CppCheck, the cur_spec_width_ and cur_spec_height_ assignments
were missing from the move-assignment operator.

Trivial change, just wanting to check that the CI passes before merging."
516459480,Add help hotkey to mp lobby (fixes #4685),seanyeh,2020-11-06 02:52:17+00:00,2020-11-06 03:03:09+00:00,{'UI': 1},"https://github.com/wesnoth/wesnoth/issues/4685

Judging from the discussion in the issue, I guess we want this functionality? If we do, the fix seems pretty simple"
515790043,Only show notifications for visible mp games (fixes #4723),seanyeh,2020-11-05 04:43:44+00:00,2021-05-13 14:06:41+00:00,{'UI': 1},"https://github.com/wesnoth/wesnoth/issues/4723

Don't know if this approach is best, but I broke out a `is_game_visible` method from `apply_game_filter` to test if an individual game is visible.
I had originally considered adding some sort of check in
https://github.com/wesnoth/wesnoth/blob/1cdc4ef530835876621f74b681646271fc4646b0/src/gui/dialogs/multiplayer/lobby.cpp#L310-L313
 but it proved tricky because the game filter isn't actually applied until https://github.com/wesnoth/wesnoth/blob/1cdc4ef530835876621f74b681646271fc4646b0/src/gui/dialogs/multiplayer/lobby.cpp#L397 Making an additional call to `apply_game_filter` beforehand worked but didn't seem like a good idea to call it so many times. (the logic in `lobby.cpp` is messy enough already)
"
515788566,Convert the editor_action framework to use std::unique_ptr instead of raw pointers,stevecotton,2020-11-05 04:38:59+00:00,2020-11-20 10:51:10+00:00,"{'Enhancement': 1, 'Editor': 1, 'Units': 1, 'Building': 1}","When returning std::unique_ptr instead of raw pointers, the return type can't be a co-variant, which is why the clone() functions are all being changed to return the base class.   

Most of the dozen or so uses of editor_action_ptr where replaced with the `auto` keyword, but the reason that I didn't use in it the new code was that I find `std::unique_ptr<editor_action>` quicker to read than remembering if editor_action_ptr is a unique_ptr, a shared_ptr or a plain raw pointer."
514526579,Remove a few bits of never implemented editor features.,Pentarctagon,2020-11-03 06:53:12+00:00,2020-11-03 21:30:58+00:00,"{'UI': 1, 'Editor': 1}","The sound source tool in particular, since showing a button to players whose only function is to tell them it's not implemented makes no sense."
513924131,UtBS: add female variants to dehydration text,kabachuha,2020-11-02 09:30:30+00:00,2020-11-02 16:39:16+00:00,{'Campaign (any)': 1},"Added `""female^thirst""` and `""female^refreshed""` to the dehydration macro because otherwise it was creating translational problems in some languages. For example, we had to use `теперь легче` (`now it's easier`) phrase in Russian for the word `refreshed` whereas we could just have written `освежился` / `освежилась` if there were gender specific variants (as it is in the IftU translation)."
513720833,AToTB S02: Rewrite the script with the elves thinking the baddies are grey mages,stevecotton,2020-11-02 00:22:04+00:00,2020-11-02 20:32:57+00:00,"{'Campaign (any)': 1, 'Prose': 1}","@Earth-Cake and @Konrad22 
This is about 10 lines of translatable text, not sure if it's okay to backport to 1.14.
The storyline itself is going to have large changes by 1.18 (maybe 1.16), so I'm not sure if
this will ever be in a stable release. But having had the idea, I thought I'd make a PR for it.

If a player loads a start-of-S02 save without the `who_slew_mordak variable` then it will still
work, showing the ""I saw the killing blow with my own eyes"" version.

Explanation for what's going on (put in the commit message because this bit is non-canon):

There are some ""grey mages"" in the Grey Woods, who appear in the Liberty
campaign. Most of the details of these were removed from 1.15, but in 1.14's
Liberty S06 they don't tolerate necromancers. SotA mentions an ancient elvish
civil war in these woods, with the ghosts still haunting the battlefield. I'm
assuming a general truce between elves and grey mages, on the understanding
that the grey mages are doing exorcisms of ghosts from the ancient war."
513692193,Fix dragging labels in editor (fixes #3302),seanyeh,2020-11-01 21:03:15+00:00,2020-11-05 08:55:55+00:00,{'Editor': 1},"https://github.com/wesnoth/wesnoth/issues/3302

Currently in the scenario editor, dragging a label causes a crash. I rewrote the dragging functionality to be similar to how we do it with units, hope that's ok
"
513602402,AToTB: Changing a difficulty name,Konrad22,2020-11-01 11:15:00+00:00,2020-11-02 06:13:16+00:00,{'Campaign (any)': 1},'Knight' to 'Grand Knight' so it matches the sprite used.
513512369,Don't lose text focus on mp player join (fixes #3715),seanyeh,2020-10-31 23:34:07+00:00,2020-11-01 00:15:31+00:00,{'UI': 1},"https://github.com/wesnoth/wesnoth/issues/3715

To reproduce:
1. Player 1 hosts a multiplayer game
2. Player 2 joins the game. Player 2 focuses the chat input
3. Player 3 joins the game. Player 2 is no longer focused on the chat input

Does anyone know why we set keyboard focus here?
https://github.com/wesnoth/wesnoth/blob/6aa6c010e77eeded27dccbb200af06214363937f/src/gui/dialogs/multiplayer/mp_join_game.cpp#L348
I've looked through the commit history and it was there since the original version of the file. This takes away focus from the chat input when a player joins, and doesn't look like it does anything useful. But I could be wrong - I'm pretty new to the codebase.

"
512761520,"Fix hyperlink formatting in texts (fixes #4387, #2934)",seanyeh,2020-10-30 05:10:58+00:00,2020-10-30 12:40:11+00:00,"{'Bug': 1, 'MP Lobby': 1, 'UI': 1}","https://github.com/wesnoth/wesnoth/issues/4387 and https://github.com/wesnoth/wesnoth/issues/2934 basically revolve around 2 problems:

**Problem 1: formatting links is done by a naive search and replace**
If there are duplicates of a url, only the first is highlighted, since we are using `replace_first`.
https://github.com/wesnoth/wesnoth/blob/b8f03c40e6f25ad0fd2ae3c6c1d7360c76270ef0/src/font/text.cpp#L812-L817
We can't just do a `replace_all` either, since this won't work correctly when one url is a substring of another url (`http://a.com` and `http://a.com/b`)

To reproduce:
1. Go to multiplayer chat and type `http://a.com` twice. Only the first is highlighted.

**Problem 2: escaping problems with &**
The problems occur when we send unescaped text to
https://github.com/wesnoth/wesnoth/blob/b8f03c40e6f25ad0fd2ae3c6c1d7360c76270ef0/src/font/text.cpp#L773

To reproduce:
1. Go to multiplayer chat and type `http://a.com?a=1&b=2`. You can also type `http://a.com&` to see the chat completely glitch out due to a pango error because it ends with a `&`

**Solution:**
The thing is, in `pango_text::set_markup`, we already receive escaped text that is validated. So we can just use this already escaped text, search for urls, and replace them with the formatted links.

I'm not much of a C++ person so please let me know if I'm doing something weird/unidiomatic, thanks"
511989917,Fix crash from side not being reset in editor (fixes #4789),seanyeh,2020-10-29 03:42:13+00:00,2020-10-31 05:04:46+00:00,{'Editor': 1},"I was investigating https://github.com/wesnoth/wesnoth/issues/4789 and I'm pretty sure that the crash has nothing to do with attempting to place a 2nd unit in the same spot as theorized, but rather that the team index (`currentTeam_`) is not reset when creating or switching to a different scenario. The crash occurs when the team index you're currently on doesn't exist in the scenario you're switching to.

There are 2 ways to reproduce:

**new scenario**
1. In the map editor, create a new scenario.
2. Add a 2nd side and switch to it
3. Create another new scenario

**switching scenarios**
1. In the map editor, create a new scenario
2. Create another new scenario
3. Add a 2nd side and switch to it
4. Switch to the first scenario

My current fix is in two places. The fix in `refresh_on_context_change` is for ""switching scenarios"", and the one in `new_scenario` takes care of the ""new scenario"" case.

I had difficulty covering both cases with a fix in just one place - I would have liked to cover both cases within https://github.com/wesnoth/wesnoth/blob/b8f03c40e6f25ad0fd2ae3c6c1d7360c76270ef0/src/editor/map/context_manager.cpp#L97 since this method is called for both new scenarios and switching scenarios. Unfortunately, when a new scenario is created, `teams` is still empty, so setting the team here would fail.

I'm still pretty unfamiliar with the codebase so would love input on if this is the right approach, thanks

edit: on a second thought, is this something we can add to `init_flags()` instead? I wasn't exactly sure what that method was used for"
511640832,Allow users to set chat lines to 0.,Hejnewar,2020-10-28 15:35:49+00:00,2020-11-14 06:28:07+00:00,{'UI': 1},"Allow users to set chat lines to 0. #1082 fix.

This is really simple fix making me wonder if its correct, I tested it and it seems to work as intended without any bugs. If this wasn't done because of some internal reason or good of players this can be closed."
511274206,Add bounds checks for unit dismiss and recall (fixes #5171),seanyeh,2020-10-28 04:42:24+00:00,2020-10-28 05:26:01+00:00,{'UI': 1},"Turns out that https://github.com/wesnoth/wesnoth/issues/5171 is caused when index is -1, when no unit is selected in the list. I don't know if we want some certain error message to show, but otherwise this fix will basically make the buttons do nothing if no unit is selected.

To reproduce error: open recall window in any game and type in search filter so no units match. Clicking ""dismiss"" or ""rename"" will segfault"
510912476,Fix [store_unit_defense] and add a unit test for it,stevecotton,2020-10-27 17:04:47+00:00,2020-10-28 21:10:47+00:00,"{'Bug': 1, 'Unit Tests': 1, 'WML': 1, 'Lua API': 1, 'Schema': 1}",See https://r.wesnoth.org/t53448
510384619,DM and LoW: Remove '[story][part]delay=' attributes,stevecotton,2020-10-27 00:24:24+00:00,2020-10-27 18:44:08+00:00,{'Campaign (any)': 1},"None of these had any effect, either on 1.15 or 1.14. I doubt that they ever
had an effect, because if these story screens had 4 second or even 8 second
delays then it would surely have been treated as a bug.

A schema update for this will follow in PR #5242."
510384363,SotA S04: Remove some [image]scale=no attributes,stevecotton,2020-10-27 00:23:32+00:00,2020-10-28 19:04:19+00:00,{'Campaign (any)': 1},"While [background_layer] has a scale attribute, [story][part][image] doesn't. A schema update for that will follow in PR #5242."
510248791,add Polish lines to wesnoth.desktop [1.14],PiotrMakarewicz,2020-10-26 19:12:29+00:00,2020-10-26 19:32:59+00:00,{},As requested by Pentarctagon here: https://github.com/wesnoth/wesnoth/pull/5238#issuecomment-716693589
510246409,IntroWML code cleanup and fix for [image]scaled attribute,stevecotton,2020-10-26 19:08:02+00:00,2020-11-04 11:24:43+00:00,"{'UI': 1, 'WML': 1, 'Schema': 1}","Prior to this commit, the scaled= attribute was undocumented and had what I assume was a bug - when enabled the image was scaled up to the width and height of the background - not to the same ratio as the background, but to the full size. So if you had a 1000 pixel wide background in an 800 pixel wide window, then scaled=yes meant each journey-marker was an 800 pixel-wide blob.

However, if anyone was using it with background-size images as overlays then this commit will break that usage - that use case is still supported by having multiple [background_layer]s.

Closes #5223, which was a question about whether to fix or simply remove the scaled attribute. Given that [background_layer]scale= and [image]scaled= have different meanings (the background_layer one should and does cause it to be full-window), I've kept the 'd' on the end of 'scaled' too.

Use a loop instead of recursion. This cleanup is prompted by #5041 (drawing map labels in IntroWML), which will add more items to be drawn in this loop.  The old implementation would not have triggered tail-recursion optimisations, as the recursion site wasn't the final code in the function.

Correct documentation in the .hpp file about when the delay takes effect (this isn't a behavior change, just a documentation correction).

Review the schema, and remove attributes that aren't supported by the code.  Many of these attributes are supported for `background_layer` but not `image`."
510243840,add Polish lines to org.wesnoth.Wesnoth.desktop,PiotrMakarewicz,2020-10-26 19:03:05+00:00,2020-10-26 19:09:39+00:00,{'Packaging': 1},As requested by Pentarctagon here: https://github.com/wesnoth/wesnoth/pull/5238#issuecomment-716693589
510154970,Typo fix in shortcut of polish version. for 1.14.,Hejnewar,2020-10-26 16:31:43+00:00,2020-10-26 19:09:51+00:00,{},"""Bitwy"" means ""Battles"", in name there is clearly only single ""Battle"" thus it shouldn't be ""Bitwy"" but ""Bitwa"".

Copy of #5238 for 1.14."
510106867,Extent special_id-active and special_type_active to abilities,newfrenchy83,2020-10-26 15:20:56+00:00,2021-02-15 00:32:43+00:00,"{'Campaign (any)': 1, 'Unit Tests': 1, 'Units': 1, 'Schema': 1}","I know, you said many time to use command line instead of create new PR, but like my net connection is low(1Mb/s) i do not choice 
for resolve https://github.com/wesnoth/wesnoth/issues/4840 with the choice of make the implementation of special_tag_active call the special bool function with a bonuse"
510082771,Typo fix in shortcut of polish version.,Hejnewar,2020-10-26 14:47:04+00:00,2020-10-26 19:10:11+00:00,{'Packaging': 1},"""Bitwy"" means ""Battles"", in name there is clearly only single ""Battle"" thus it shouldn't be ""Bitwy"" but ""Bitwa""."
509657450,Move the game content info (scenario/era/modifications) into their own table.,Pentarctagon,2020-10-25 20:34:54+00:00,2020-10-26 14:51:22+00:00,{'Services': 1},"Fixes #5066

---

As a reminder to myself as well, the existing MAP_NAME and ERA_NAME columns will need to be given defaults prior to the updated wesnothd being rebuilt.  Then once the existing data is migrated to the new table, I intend to drop the era/map columns on GAME_INFO as well as the modification-specific table."
509531834,Fauna Revisited,doofus-01,2020-10-25 03:49:00+00:00,2020-11-15 05:03:21+00:00,"{'Ready for testing': 1, 'Graphics': 1, 'Units': 1}","Some revisions to the recently committed fauna.  Mostly to include graphics work, but some minor conceptual changes as well.
 

- [x] stoat attack animations and portrait
- [x] bear portrait
- [x] icemonax attack animations and portraits
- [x] falcon attack animation and portrait
"
509529703,Fix load game search filter for long filenames (fixes #5156),seanyeh,2020-10-25 03:21:32+00:00,2020-10-25 03:34:03+00:00,{'UI': 1},"I recently came across https://github.com/wesnoth/wesnoth/issues/5156 and decided to look into it.

Instead of comparing to the filename from the label widget, I've changed it to compare to the `games_` save_info list, which seems to have the full filenames (the `delete_button_callback` method in this file already uses `games_` to get the exact filename to delete, so this seems like a similar use case). I've tested my changes locally and searching for words in long filenames work now.

Let me know if this is the right approach, thanks"
509500251,boost::regex to std::regex take two,Vultraz,2020-10-24 21:55:27+00:00,2021-11-26 05:18:18+00:00,"{'AI': 1, 'Editor': 1, 'Units': 1, 'Schema': 1}",Testing what Travis does with this
509490281,Don't override default AR and RANLIB without LTO,DarthGandalf,2020-10-24 20:29:15+00:00,2020-10-24 22:31:51+00:00,"{'Building': 1, 'CMake': 1}","`ar` is not always available, and when it is, it's not always correct, e.g. during cross-compilation.

https://bugs.gentoo.org/732096"
509480634,"LoW S07: Revise the dialogue, as the dwarves don't turn up until the end",stevecotton,2020-10-24 19:15:10+00:00,2020-10-31 20:43:19+00:00,"{'Campaign (any)': 1, 'Prose': 1}","Change dialogue to address the bug reported in https://r.wesnoth.org/t53438

I'm expecting this to need some changes, but it seemed sense to start with a PR instead of an issue."
509330543,Some schema fixes,CelticMinstrel,2020-10-24 05:15:22+00:00,2020-10-24 17:26:19+00:00,"{'CI': 1, 'Schema': 1}",The commit descriptions should mostly be self-explanatory; I'm only opening this as a pull request because it adds something to the Travis task. This can be merged as soon as Travis passes (assuming of course that it _does_ pass).
509287585,campaignd: Implement basic command line interface,irydacea,2020-10-24 00:01:31+00:00,2020-11-10 00:22:01+00:00,"{'Enhancement': 1, 'Add-ons': 1, 'Building': 1, 'SCons': 1, 'Engine': 1}","Adds a basic command line interface to campaignd implementing options to change logging configuration and set the server dir and config file path. This uses Boost.program_options, so some changes to the SCons build recipe were required (CMake links wesnothd and campaignd against Boost.program_options regardless already).

This changes campaignd's startup behaviour slightly so that campaignd ensures that the directory containing the config file exists before doing anything else. Normally this wouldn't be noticeable since the default behaviour continues to be to use `./server.cfg` (pwd should exist, right?), but it's important in the event that the user passes `-c` with a nonexistent path.

Additionally, it moves the argv repackaging logic out of wesnoth.cpp, in particular all the Windows-specific code. I would like to make wesnothd use it as well later since it presumably also incorrectly assumes `argv` contains UTF-8 data on Windows like the game proper used to do."
508722803,Bump minimum gcc requirement to 5.4.,Pentarctagon,2020-10-23 05:15:01+00:00,2020-10-23 14:23:13+00:00,"{'Building': 1, 'SCons': 1}",
507885518,Fix codeblock projectfiles test,newfrenchy83,2020-10-21 21:54:24+00:00,2020-10-21 22:12:35+00:00,{'Building': 1},
506961274,Add travis check for WML indentation correctness.,Pentarctagon,2020-10-20 17:01:02+00:00,2020-10-20 19:57:28+00:00,"{'CI': 1, 'Docker': 1}",
506680268,Add docs about crowns and ellipses (fixes #4455),stevecotton,2020-10-20 10:37:51+00:00,2020-10-26 15:07:13+00:00,"{'Enhancement': 1, 'Graphics': 1, 'Translations': 1, 'Help': 1}","The image added here is a grass background to draw units on via Image Path
Functions. For the documentation, a square image looks better than a hexagon
that has black borders."
506192687,Fix initiative don't affect allied side in Httt,newfrenchy83,2020-10-19 18:26:52+00:00,2020-10-19 18:49:13+00:00,{'Campaign (any)': 1},
505527340,"Deprecate [event]remove=yes, recommend [remove_event]",stevecotton,2020-10-18 19:31:56+00:00,2020-10-18 22:05:46+00:00,{'Lua API': 1},"The remove attribute for [event] was never added to the validation schema,
and using [remove_event] seems easier to search WML for. Let's just recommend
the new key and deprecate the old one.

Tested with the current implementation of #5215"
505502411,SoF S9 - some cleanup to the final scenario,doofus-01,2020-10-18 16:43:44+00:00,2020-10-19 00:34:55+00:00,{'Campaign (any)': 1}," - slight update to the map
 - multiple ways to get the orc to break his tablet"
505072315,Make use of std::chrono consistent everywhere,Pentarctagon,2020-10-16 19:54:46+00:00,2020-10-19 21:49:33+00:00,{'UI': 1},
505039687,add overwrite_specials attribute to abilities like specials for superced other specials(abilities or traditionnal),newfrenchy83,2020-10-16 18:58:48+00:00,2020-12-14 20:58:00+00:00,"{'Unit Tests': 1, 'Units': 1, 'Schema': 1}","if force cth macro is used for impose an value less what value of cth specials, the macro, the value usd will be the cth specials value.
this PR is an alternate soluce to https://github.com/wesnoth/wesnoth/pull/5208 PR"
504238907,Clean up excessive use of this pointers in add-ons client,irydacea,2020-10-15 16:44:20+00:00,2020-10-18 17:03:52+00:00,{'Add-ons': 1},"I have no idea what code style statement past me was trying to make
here anymore."
503785780,.,Pentarctagon,2020-10-15 04:04:11+00:00,2020-10-15 04:04:25+00:00,{},
502993976,Refactoring the templates in distributor.cpp (makes PR #5198 build),stevecotton,2020-10-13 23:48:37+00:00,2020-10-15 03:30:04+00:00,{'UI': 1},"This is part-way though a refactor, but I'm not committing myself to completing
it; publishing for the comments and discussion.

This solves PR #5198's compile errors about undefined references, but the
solution here is to expand the templates into the multiple hardcoded copies
block starting with `switch(events_.sdl_button_down_event)`, which is the
first big block of changes in the diff."
502908898,revert Redesign force cth macro,newfrenchy83,2020-10-13 22:13:22+00:00,2020-10-16 19:04:51+00:00,{},"revert https://github.com/wesnoth/wesnoth/commit/866420adf85ec1da02f565f2efd1933bf27419c4#diff-ca2b2f3f52116e047fc943b701f7798e0008c99644d9edf7ade1daf66ae61b7d

when i replaced 1.12/1.14 version of FORCE CTH, the weapon abilities overwrited the regular cth specials but now the cth mike marksman or magical don't affected, i must place the 1.14 version of macro for fixing that."
501698404,Messenger Micro AI: add [avoid] tag functionality,mattsc,2020-10-12 17:01:27+00:00,2021-03-14 03:09:10+00:00,"{'Enhancement': 1, 'AI': 1}","This is complete as far as I am concerned, I just want to give a couple days for people to comment and for @Hejnewar to test.  I see no reason why this should not go into 1.15.6."
501405225,Fix tip for Oasis healing,vgaming,2020-10-12 08:14:29+00:00,2020-10-15 03:44:08+00:00,{'Help': 1},
501213190,Ensure units' orbs are red in linger mode (fixes #5187),stevecotton,2020-10-11 22:02:57+00:00,2020-10-12 00:22:10+00:00,{'Bug': 1},
501074337,Update editor cfg file to reflect earlier changes in scaling,gwhitney,2020-10-11 03:55:49+00:00,2020-10-11 03:57:30+00:00,{'UI': 1},"  Commit 43de778 made all themes scale from their base dimensions rather
  than from an arbitrary hard-coded 1024x768 pixel size. As a result, the
  800x600 layout for the editor needs its main map explicitly sized --
  the 843-pixel width no longer fits in 800x600, and it isn't being scaled
  down from 1024. (But once it is explicitly set for the 800x600 layout,
  it will scale up for pixel widths between 800 and 1024). This commit
  adds such an explicit sizing, analogous to the one found in default.cfg.

  Resolves #5193."
500972220,Reload the fonts (both GUI1 and GUI2) when changing language,stevecotton,2020-10-10 12:52:46+00:00,2020-10-10 13:10:16+00:00,"{'Bug': 1, 'UI': 1, 'Engine': 1}","Fixes #5194. If starting the game in a given language works properly, then
this PR makes changing to that language without restarting also works properly.
This can work with or without #5200 - I hope to get both of them in as #5200
has a lot of code cleanup; but this one has a better ratio of
bugs fixed vs lines of code to review.

Getting fonts in the correct order is important for CJK (Chinese, Japanese,
Korean), as the same codepoint may have different images even between
DroidSansJapanese and DroidSansFallbackFull (see discussion in issue #5194).

This method of calling load_font_config() to reload the fonts is already used
during startup - see the two calls to it in src/wesnoth.cpp."
500918121,MP: cleaned up mp workflow code,Vultraz,2020-10-10 06:01:34+00:00,2020-10-10 17:37:40+00:00,{},"This mainly consolidates the `enter_*_mode` functions under a single manager class with private members instead of relying on passing around a helper struct with data params.

One functional change is that lobby_info now also has the list of installed addons even in local mode, but I don't see any reason that shouldn't be the case. It keeps things consistent."
500854940,"Check which glyphs are in each font, instead of using a list hardcoded in WML",stevecotton,2020-10-09 22:47:43+00:00,2020-10-10 15:36:11+00:00,"{'Bug': 1, 'Engine': 1}","This is a ""it's known to be broken, so let's rip it out and put in a minimal
replacement"" change. Updated raw pointers to smart pointers just because,
updated the docs a bit, and ended up with a big change.

Fixes the most visible part of #5194, where Chinese needed DroidSansFallbackFull
to be loaded before DroidSansJapanese. The removed code in
`char_block_map::insert` and `char_block_map::compress` had a bug that
triggered when one font had a contiguous range of codepoints that was a
superset of several ranges in another font - this meant it treated the first
font containing U+4E00 as having the whole CJK Unified Ideographs block.

Remove the now-unused font codepoints WML. There is no schema change for this,
it seems the data/hardwired/fonts.cfg file isn't checked by the validation.

Optimise calling set_font_list with the same list (but possibly reordered), by
reusing the already-loaded fonts."
500594039,Add the 'Add-ons' tag to the pull-request labeler.,kabachuha,2020-10-09 13:35:06+00:00,2020-10-09 14:22:33+00:00,{},"Added support for the `Add-ons` tag to the pull-request labeler.
The file changes in the following directories will be marked as related to the addons system:
  - src/server/campaignd/**
  - src/addon/**
  - src/gui/dialogs/addon/**"
500351535,Thread-safe logging,CelticMinstrel,2020-10-09 05:21:59+00:00,2020-10-15 03:30:02+00:00,"{'Enhancement': 1, 'UI': 1, 'Add-ons': 1, 'Engine': 1}","The draft #5176 included a wish for thread-safe logging, which I think would be a good idea in general, so I tried implementing the thing I was describing in that thread.

This works in the most basic sense, which is to say it compiles on my computer with no errors. I have not yet done any testing whatsoever, not even just running the game to see if logging even slightly works. Thus, the draft status of this PR."
499813437,Removed Registered Users Only game config option (resolves #4980),Vultraz,2020-10-08 10:17:46+00:00,2020-10-09 00:32:09+00:00,{'UI': 1},Closes #4980. As @Pentarctagon suggested. Opening a PR to confirm removing that bit from wesnothd is ok.
498087472,Hint about the editor's shift+click and ctrl+click,stevecotton,2020-10-05 20:06:03+00:00,2020-10-09 13:57:23+00:00,{'Editor': 1},"This changes the legend at the bottom of the screen from

    FG: Savannah/Forest (Forest,) | BG: Green Grass/Grassland (Flat)

to

    Left-click: Savannah/Forest (Forest, ) | Right-click: Green Grass/Grassland (Flat)
    Shift + left-click: paint overlay layer only | Ctrl + click: copy terrain

or (with a non-overlay selected)

    Left-click: Desert Sands/Desert (Sand) | Right-click: Green Grass/Grassland (Flat)
    Shift + left-click: paint base layer only | Ctrl + click: copy terrain"
498031410,Solve #5145,Hejnewar,2020-10-05 18:17:21+00:00,2020-10-06 03:39:28+00:00,{'MP': 1},Solve #5145
497495867,SotA - revisions to units and possibly terrain,doofus-01,2020-10-04 20:42:26+00:00,2020-10-19 00:22:31+00:00,"{'Ready for testing': 1, 'Campaign (any)': 1, 'Graphics': 1, 'Units': 1, 'Terrain': 1}","This PR is mostly for some preliminary work to ghoul updates (#5067), plus whatever else I stumble across in SotA.  No intention to revise balance or text, except as it relates to the ghouls.

Revision to the undead sea captain was because I didn't see a skeleton matching the portrait, the ""fresh body"" concept, or the opening dialog of the _Blackwater_ scenario.  Maybe the zombie captain can turn into a skeleton captain later, if it really affects the later scenarios.

The intro of _Becalmed_ scenario contained the origin story of the ghouls, so I revised that.  The images are placeholders, but it is currently too verbose to just show the book image.

Other things under consideration:
 - ~~Touch-up to the ship graphics (shadows, mostly)~~ Second thoughts on this.
 - Move the graveyard fence to either a fence or wall terrain - **Done**
 - Fix the terrain codes so they don't use ""y"", which is reserved for UMC. - **Done**"
497467288,Refactor translatable strings for the SotA zombie recruit dialog,CelticMinstrel,2020-10-04 17:14:09+00:00,2020-10-12 19:38:54+00:00,"{'Campaign (any)': 1, 'Lua API': 1, 'Low Priority': 1}","I think it's easier for translators if each string is actually just one string. Using ""split"" on a translatable string just unnecessarily complicates things.

I also fixed a bug in `[set_variable]` which was referenced by a comment in the SotA zombie-utils file."
497425394,[Proposal] Extended Outro dialog with campaign-specific credits,Vultraz,2020-10-04 12:28:32+00:00,2020-10-06 03:07:51+00:00,{'UI': 1},"An idea to improve the credits experience. This doesn't do anything to deal with the larger issue over the massive surface in the credits dialog, but I think it presents the campaign-specific credits better.

In short, it extends the Outro sequence past the ""The End"" text to include the campaign name followed by the campaign-specific credits with each section split into groups of no more than 5 names at a time. The long-form credits are **no longer shown** after.

For instance:
![image](https://user-images.githubusercontent.com/3558659/95015512-0b0b8780-0699-11eb-95e3-775f75f1ed26.png)
"
497132649,"Use the new animals in the ""animals"" micro-ai demo",stevecotton,2020-10-02 20:59:11+00:00,2020-10-03 13:09:34+00:00,"{'AI': 1, 'Low Priority': 1}","Several new animals were added in PR #5039's cbad6f42492be5fcbf8c29a3d10cbc43598ba32c.

The micro-ai demo can be accessed by starting Wesnoth with the command-line
arguments `--test animals`. The scenario uses some stand-ins for animals that
weren't in mainline; the new bears and tuskers fit straight in. For the sheep,
the icemonax's graphics are a bit more sheep-shaped than the troll whelp's.

This demo doesn't need to be balanced, the changed unit stats are no problem.

UtBS's dustboks aren't in core, otherwise I'd use them as the deer stand-in.

@doofus-01 thanks for these new resources. Are the unit ids final (as in, should
I postpone this change in case they get renamed)?"
496174221,Changes in new monster units regarding experience and advancements,MarcusAichmayr,2020-10-01 11:11:43+00:00,2020-10-13 15:08:59+00:00,{},"Giant Stoat (L0), Giant Ant (L0), Gorer (L1), Cave Bear (L2) and Great Icemonax (L2) have no advancements.
I changed their experience to 50 times level (25 for L0) to match with similar units in mainline.

Tusklet and Gorer are of the same unit line. So I gave Tusklet the advancement to Gorer.

There are some things I am not sure about:
Should Giant Ant (L0) advance to Fire Ant (L1)? I don't think so because they appear in different faunas corresponding to the [forum post](https://forums.wesnoth.org/viewtopic.php?f=9&t=52894) of doofus-01.

Icemonax (L0) and Great Icemonax (L2) are obviously of the same unit line. But their levels differ by two. Hence, an advancement of Icemonax to Great Icemonax would not make much sense at this time.
Will there be a L1 unit between those or will one of them be changed to L1?"
496114962,Orb refactor and ally orb colors during allies' turns (#1424),stevecotton,2020-10-01 09:35:45+00:00,2020-10-17 12:11:11+00:00,"{'MP': 1, 'UI': 1, 'Units': 1, 'Building': 1, 'Help': 1}","Note: the build will fail on MacOS, as the new orb_status files still need
adding to the MacOS build.

Instead of using the allied orb during their turn, the unmoved, moved and
partial orbs are shown. The player's own units will be shown with the moved orb
during the ally's turn, which matches the previous behavior. This is intended for
co-operative MP campaigns, where it will make it easier for players to discuss
possible moves. The UX is also visible in SP scenarios with allied sides, HttT's
first scenario is an easy place to see what it does.

Updated the documentation about orb colors. In these docs I've moved all of
the images to a single line above the bullet-pointed list, as otherwise the
layout looked bad once a line wrapped - the first line appeared
horizontally-aligned with the center of the image, the second started under the
image.

Added documentation about the delay in multiplayer games, as the purpose of this
orb-coloring feature is to assist discussion in multiplayer games.

Refactoring the orb-coloring code, adding new units/orb_status.hpp

Instead of creating lots of image::locators and calling a family of
similarly-named preferences functions, this refactor encapsulates that logic
and uses an enum.

An assert has been added to `unit_drawer`'s constructor. There are two callers
- the `display` class guards it with an explicit check before constructing
unit_drawer. The `game_display` class doesn't have an explicit check, but it's
clear that other code in that class assumes the teams are already valid (and
would crash if they weren't).

Other issues connected with this PR
---

Issue #5155's proposed orb_status::disengaged has been tested with this, and
builds on the refactor in the first of this PR's two commits.

The orbs' help page suggests that there should be documentation about the crowns
too, however I want to separate any work on that from this PR. Issue #4455 tracks
the info about crowns."
496048256,Rename Fire-Ant.cfg to Fire_Ant.cfg,MarcusAichmayr,2020-10-01 07:53:40+00:00,2020-10-01 09:43:08+00:00,{},
494017107,Improve user-friendliness of the validation options,stevecotton,2020-09-28 09:39:43+00:00,2020-10-02 16:34:19+00:00,{'WML Tools': 1},"* Fixes #4223, by making the --validate and --validate-* options imply --nocache.

* Fixes #4224, showing an error if you misspell the id argument to
  --validate-addon. The application doesn't (but should) quit automatically to
  avoid the user spending time on a non-functional validation run, however it
  does at least disable all add-ons, which should have the same end result.

* Shows a warning that --validate-addon needs the user to play the add-on, it
  doesn't automatically check the add-on. This was my misunderstanding when
  logging issue #4225, which has now been repurposed into a feature request for
  a new tool that does what I thought --validate-addon did."
493896265,Add support for async queries.,Pentarctagon,2020-09-28 06:05:44+00:00,2020-10-15 00:38:50+00:00,"{'Building': 1, 'CI': 1, 'SCons': 1, 'CMake': 1, 'Docker': 1}","@soliton- @loonycyborg - while obviously this isn't remotely ready for review/merging yet, I would appreciate if you could take a quick look at what I have so far and make sure it makes sense.  Particular points of note:
* The `async_test_query()` is there as a query that will take a noticeable amount of time to complete, for testing purposes.
* In an actual async query implementation, the call to boost::asio::post that passes `io_service_` as the first argument would be where `async_send_doc_queued()` would be used (rather than just the cout that's there for the test query now).
* For the connection pool (`conn_pool_`), the idea is that [0] is what's used for all the existing, non-async queries.  [1] and above are used for async queries.
* `get_single_int()` was changed to `get_single_long()` since count(*) is returned as a long."
493583245,"Remove the wesnoth-ai textdoman, move a few strings to wesnoth-lib (#4669)",stevecotton,2020-09-26 14:24:44+00:00,2020-10-01 08:29:40+00:00,"{'AI': 1, 'Translations': 1}","Rename old AI to ""Old Default AI (1.14 version)"", as discussed in https://github.com/wesnoth/wesnoth/issues/4669#issuecomment-692699415

This whole textdomain is dedicated to localized strings revolving around the
game's AI engine and the AI demos/test scenarios, with around 370 strings in
it. Fixes #4669.

Other than a few strings near the start of the catalogue template, none of these
have any value for regular players since they are sourced from AI demos and
test scenarios in data/ai/micro_ais/ and data/ai/scenarios/. None of them will
be displayed to people who aren't tinkering with WML or contributing to AI
development as part of the Wesnoth dev team, and some of the language used in
them is very technical in nature.

This commit leaves the ""#textdomain wesnoth-ai"" lines in the AI demos, but
drops the .po and .pot catalogues for wesnoth-ai. The few strings that are
seen by regular players move to the wesnoth-lib textdomain."
493569260,Wall terrain graphics (Xo*) work ,doofus-01,2020-09-26 12:11:24+00:00,2020-10-04 00:38:19+00:00,"{'Graphics': 1, 'Terrain': 1}","trying to clean up some terrain graphics glitches, and possibly add some transitions"
493555182,"Update the docs for "":droid full"" in the help browser",stevecotton,2020-09-26 09:46:43+00:00,2020-09-27 18:58:58+00:00,{'Help': 1},"This command and the documentation provided by "":help droid"" were updated
in efd808ea842ff88174cc2e953c8b871b8c41dae0, but we missed that this command
is also documented in the help browser's (Commands, General Commands) page.

The docs here are more verbose than in "":help"", so the text is newly written
instead of being copied from the existing location."
493355049,Clean-up leftovers of the SCALING_ALGORITHM preference,stevecotton,2020-09-25 20:29:09+00:00,2020-09-25 21:57:00+00:00,{},"Opening a PR just to run the CI tests, going to merge once the CI is done. That's a sanity-check in case some platform-specific code is depending on an indirect `#include ""utils/make_enum.hpp""`.

The preference was removed in 15bf3bb25691c6ce71ac2a45bb4e5c06ea9239e6."
493124642,Changes in new units.,Hejnewar,2020-09-25 14:45:49+00:00,2020-09-26 18:46:09+00:00,{},These changes are supposed to make new units look natural (and balanced). For example Icemonax should have cold resistance and Gorer (Level 1 unit) shouldn't deal 26-2 damage even if with charge.
493101821,Changes in prices of monster units and Chocobone.,Hejnewar,2020-09-25 14:06:41+00:00,2020-09-26 18:44:02+00:00,{},"Solving #5058.

Changelog:
Cost of Gigant Rat changed from 6 to 5.
Cost of Gigant Scorpling changed from 13 to 12.

Cost of Fire Guardian changed from 16 to 11.
Cost of Gigant Mudcrawler changed from 11.
Cost of Gigant Scorpion changed from 22 to 16.
Cost of Wolf changed from 17 to 15.

Cost of Chocobone changed from 38 to 28.
Cost of Cuttle Fish changed from 40 to 36.
Cost of Great Wolf changed from 30 to 21.
Cost of Gryphon changed from 40 to 29.
Cost of Water Serpent changed from 26 to 23.

Cost of Direwolf changed from 36 to 33.
Cost of Sea Serpent changed from 40 to 55.
Cost of Wyvern changed from 54 to 75.
Cost of Wyvern Rider changed from 80 to 102."
492826049,Apply the deprecation standard to the new GUI2 API,CelticMinstrel,2020-09-25 04:29:33+00:00,2020-09-27 20:44:29+00:00,"{'UI': 1, 'Lua API': 1}","This also removes backwards-compatibility.lua altogether.
It's no longer correct in the general case to add backwards compatibility code to this file, so removing it entirely avoids situations where compatibility code is incorrectly added there.

This is ready to merge pending testing; I need to actually build master before I can test it."
492768598,Run the wmlindent and wmllint Makefile targets from data/tools ,cooljeanius,2020-09-25 00:37:31+00:00,2020-11-09 04:30:56+00:00,"{'AI': 1, 'Campaign (any)': 1, 'MP': 1, 'UI': 1, 'WML Tools': 1, 'Units': 1, 'Schema': 1}","I was just messing around seeing what different Makefile targets in different directories did, and it looks like the ones that ran `wmlindent` and `wmllint` from the data/tools directory did some useful tweaks, so maybe let's merge those? I might have screwed up some stuff when doing my own merge from master when I pulled to bring my own branch up-to-date, so if so, I'm sorry about that and can try to fix it. 
"
492605303,Fix #4961 (halo animations sometimes freeze),DisherProject,2020-09-24 17:50:52+00:00,2022-06-28 02:36:07+00:00,{'Graphics': 1},"As [this](https://github.com/wesnoth/wesnoth/blob/master/src/display.cpp#L2521-L2524) comment says, we are only redrawing haloes if anything else in the map is invalidating at least one hex.

`halo_man_->unrender(invalidated_)` actually invalidates the hexes covered by haloes which need to be updated, so i'm just moving the call outside the if-clause."
492186683,"WIP: Orb refactor, disengage orb and allies' orbs",stevecotton,2020-09-24 05:09:46+00:00,2020-10-01 08:31:53+00:00,"{'Enhancement': 1, 'MP': 1, 'UI': 1}","This is work-in-progress, particularly for the first of the three
commits. I've done a lot of moving code around, and it doesn't
feel right yet, so I'd welcome all suggestions, even ones that
throw these changes out and implement the two features in different ways.

The first commit is refactoring with no new features, and then the other
two are features using the refactored code's new abilities.

I'm expecting build failures on MacOS, as this adds a new .hpp and .cpp
file without adding them to the XCode project.

Refactoring the orb-coloring code, adding new units/orb_status.hpp
---

Instead of creating lots of image::locators and calling a family of
similarly-named preferences functions, this refactor encapsulates that logic
and uses an enum.

WIP: This needs the new orb_status files adding to the MacOS build.

WIP: Does it make sense to add the orb_status files instead of just
putting these bits in an existing file?

WIP: Should the pref_show_orb and get_orb_color functions move into
src/preferences/general.hpp?

WIP: Some of the changes here are just to reform and reorder lists, ready
to add the disengaged orb to those lists. Should they instead be left to
the disengage commit?

WIP: Add a new orb color for the ""disengaged"" state (#5155)
---

This will match the mounted Quenoth units' ""disengage"" skill, when they
can still move but can't attack. It should also trigger for some UMC abilities
that get extra moves after a character attacks.

WIP: The select_orb_colors dialog's layout no longer fits its window size.

WIP: Should addig the extra color (teal) be done here? I've ended up using
the existing white color for the default disengage orb.

WIP: During allies' turns, their units' orbs show the move status (#1424)
---

WIP: the orb-refactor commit that this depends on is WIP.
WIP: check for todos and WIPs, including further down this commit message.

Instead of using the allied orb during their turn, the unmoved, moved and
partial orbs are shown. The player's own units will be shown with the moved orb
during the ally's turn, which matches the previous behavior. This is intended for
co-operative MP campaigns, where it will make it easier for players to discuss
possible moves. The UX is also visible in SP scenarios with allied sides, HttT's
first scenario is an easy place to see what it does.

WIP: test this paragraph. When one player owns multiple sides, or when multiple
players are hot-seating, the usual handling still applies - the orbs are drawn
as if the one that has most recently had its turn is the only side that the
player owns.

The disengaged orb will also be supported, if that feature merges. The code in
this commit needs no further changes to support OrbStatus::disengaged."
489923967,avoiding unit placed events,sevu,2020-09-20 16:17:32+00:00,2022-10-27 04:32:10+00:00,{'Lua API': 1},"Guess after all this years I touch the Lua stuff behind the API …

One commit for #5158, other I found while testing for e3e80b4.

This all comes down to this comment:
https://github.com/wesnoth/wesnoth/blob/de9311e2622a9603834113cfd7f3fa2edb4de344/src/scripting/game_lua_kernel.cpp#L2583-L2584

It's the same method `[unstore_unit]fire_events=…` uses internally, just undocumented.

@CelticMinstrel, @gfgtdf can this go in as is?"
489690122,A minor Polish translation fix,PiotrMakarewicz,2020-09-19 08:14:03+00:00,2020-09-20 03:16:15+00:00,{},I would normally have sent it to ivanovic but it's so close to the release of 1.15.5 that he may not be in time to commit it.
488228755,Change most remaining cases of using async_send_doc to send_to_player for wesnothd,Pentarctagon,2020-09-16 20:30:41+00:00,2020-09-28 03:29:58+00:00,{},
488203495,UtBS S02: Recognise Beach Sands and embellishments when spawning ghosts,stevecotton,2020-09-16 19:37:15+00:00,2020-09-19 14:48:17+00:00,{'Campaign (any)': 1},"Fixes #5149.

@nemaara in terms of balance, without this fix I saw only 1 ghost during the first night; with this fix I had 3 ghosts spawn at end-of-turn-4, and another 2 at end-of-turn-5. They do attack the scorpions too, but it definitely needs a balance check."
487129783,"UtBS: Make ""quenoth"" a separate race to ""elf"" (fixes #4876)",stevecotton,2020-09-15 08:30:39+00:00,2020-09-19 14:47:57+00:00,"{'Enhancement': 1, 'Campaign (any)': 1, 'Help': 1}","# Main commit

UtBS: Make ""quenoth"" a separate race to ""elf"" (fixes #4876)

This is motivated by reorganising the help pages to split the Quenoth from the
""pointy ears, pale skin"" help text in data/core/units.cfg. It also means that
there's no reason to [hide_help] for the default era elvish units. The new help
text is just a short placeholder for now.

The new race has [race]help_taxonomy=elf.

If the player loads a mid-campaign save then their recalls and heroes will have
race=elf while new recruits have race=quenoth.  For that reason, I've changed
the scenarios' event triggers to recognise both races.

When levelling up, units with race=elf may change to race=quenoth.

Opening the help for a unit will show the help as if the unit has race=quenoth,
even when right-clicking on a race=elf unit. This is good.

For a few of these, I think another race might be better - they're converted to
Quenoth here, as they were Elves before. The Corrupted Elf is should probably be
considered undead, and the Divine Avatar should possibly be something else, more
like an elemental than a living creature. That those two are currently included
in the elves does have the side-effect of hiding a plot spoiler about the Dark
Assassin who is also included in the elves (the spoiler being that this one is
correct, he really is an elf).

# Second commit

UtBS S02: Make the warning about the tentacles an enter_hex instead of a moveto

If you try to move straight into the water, the explorer should stop at the
lake edge and comment about where they're going. Trivial change, mainly because
I was using a fast unit for debugging and wondered why I hadn't triggered the
lake monsters."
486226911,Item images contributed by Blarumyrran on Discord,doofus-01,2020-09-13 19:16:51+00:00,2021-05-30 16:03:44+00:00,"{'Enhancement': 1, 'In-progress': 1, 'Graphics': 1}","I trust Blarumyrran knows what he's doing, but I still want to see these in game before merging this.
I also don't want it to be forgotten, so I'll add the 1.16 milestone."
484951469,"Allow the player to recruit, even when some recruitable units aren't known",stevecotton,2020-09-11 11:12:05+00:00,2020-09-12 08:02:31+00:00,"{'Bug': 1, 'Engine': 1}","Fixes #5144 ""one missing unit in recruit list makes entire recruit list
unavailable"". The player will see an error dialog every time they try to
recruit, that seems good given that the limited recruitment options are likely
to severely affect game balance.

The `std::vector<t_string> unknown_units` uses t_string instead of std::string
because that's the class needed for format_conjunct_list. Those items aren't
translated - they're the values of [unit_type]id=, but the corresponding
[unit_type] is missing, so we can't get the translatable [unit_type]name=."
482572742,"Show [race]help_taxonomy= as ""This is a group of units, all of whom are $help_taxonomy""",stevecotton,2020-09-09 06:57:07+00:00,2020-09-13 13:20:49+00:00,"{'Enhancement': 1, 'Help': 1}","This allows the help browser to add links between [race]s. I've used the word ""group"" rather
than ""subrace"",  it seems less likely to have political overtones.

The code comments talk about both Dunefolk and Quenoth Elves - of these two, only the
Dunefolk's data is changed in this commit, the Quenoth still have race=elf at the moment.

Draft documentation for the Wiki:

```
* '''help_taxonomy''': {{DevFeature1.15|?}} in the help browser, show this
race as a group of units from another race; the value of this attribute should
be the other race's '''id''' attribute. This only affects the help browser, for
all other purposes (such as WML filters) the two races are completely separate.

How this is visualised in the help browser is a GUI design decision, this attribute
merely tells the engine that the relationship exists.
```

The PR provides a visualisation, even though the proposed Wiki-doc is non-specific.
Here's three vertically-sliced screenshots:
![wesnoth_help_taxonomy](https://user-images.githubusercontent.com/101462/92564833-175b1b00-f27a-11ea-90cc-b4b7f8874eb6.png)
"
481342887,Remove the evil path of Northern Rebirth (now tested),stevecotton,2020-09-07 12:23:23+00:00,2020-09-09 00:01:34+00:00,{'Campaign (any)': 1},"@Pentarctagon , @gfgtdf This isn't ready for merging (because it's untested), but it (slightly) simplifies your #5137 and #5131 .

Its inclusion in mainline is causing extra work in tasks roadmapped for 1.15.x.
It has some of the deprecated ^Uf mushrooms, and some use of the {MODIFY_UNIT}
macro.

If it comes back then it will likely start as UMC."
481062802,[WIP] Mass convert of *^Uf terrain to the balance equivalent Tb^Tf terrain.,Pentarctagon,2020-09-07 05:36:29+00:00,2020-09-15 14:26:01+00:00,{'Terrain': 1},"---

This is a mass-conversion of all remaining *^Uf terrain to Tb^Tf, since if we can't make sure that something that's deprecated isn't used by mainline anymore then it shouldn't have been deprecated in the first place.  It does not touch WC, since I assume @gfgtdf has his own plans to handle WC (#5135).  Marked WIP since I also noticed along the way that the Xol and Xuce terrains are deprecated but also still used in a few places, so I intend to review all the deprecated terrains and make sure they aren't used in any mainline maps anymore.

@gfgtdf I've requested your review as well to sanity check the changes to `data/multiplayer/scenarios/test_lua_mapgen.lua` in particular."
480939434,make mushrooms-small smaller,doofus-01,2020-09-07 00:07:54+00:00,2020-09-07 19:21:02+00:00,"{'Graphics': 1, 'Terrain': 1}","To fix the spillover shown in #5122 

@Hejnewar - I am not able to reproduce your third image in that issue.  Can you post that again with the terrain code overlay?"
480028417,misc wml cleanups,gfgtdf,2020-09-04 19:50:50+00:00,2022-06-27 18:06:26+00:00,{'WML': 1},"minor wml changes.

In particular we replace cases of multiple {MODIFY_UNIT} with one [modify_unit] call.

Also we add a few comments"
479825272,Add 'Delay Advancements [modification],gfgtdf,2020-09-04 15:52:40+00:00,2020-10-09 01:11:51+00:00,{'Units': 1},"Depsite being a [modification] this is actuall implemented
in the C++ code the [modification] just sets a flag.

With this modification active all advancements are delayed
until its the players (that controls the unit in question) turn
again.

This is meant as an alterntive to the preset advancement
type of mod.  want to play around with this alternative mod a a bit in 1.15
maybe we will remove it later if we find ot that it wasn't a good idea.

The problbme this is supposed to fix is that advancemnts
are done randomly during the enemeies turn. It has a few
advantages over the preset advancemnt approach:
1) It can easily handle Amlas and normal advancement
2) It doesn't need special code to handle the case that
   A unit advances multiple times. During an enemies turn.
3) It doesn't break in case that other wml code changed
   The advancements of a unit after the pre-selected advancement was chosen
4) It might be difficult for the user to know in advance which units
have a chance to advance during the next turn, if for example multiple of enemy units
unexpectedly attack one of the players units.
 

It also has a disadvantage: it changes the rules of the
game quite a bit, in particular if the units heals form
an advancement (which us usually the case), since now
with this 'healing the unit on advancement by retaliation'
during the enemies turn can no longer happen. I still
think its worth to think about this and test it though."
479495613,fix codeblocks project for lua widget,newfrenchy83,2020-09-04 09:22:39+00:00,2020-09-04 11:20:16+00:00,{},
479489622,Fix inverted logic in working out which resources are active,stevecotton,2020-09-04 09:15:49+00:00,2020-09-04 11:59:29+00:00,"{'Bug': 1, 'Engine': 1}","This line is meant to skip the rest of the loop for things that have previously
been inserted in to loaded_resources; but instead it skipped the rest of the
loop unless the id was already in loaded_resources. Fixes #5126."
479192884,Update the VC16 project files for Lua Widgets,stevecotton,2020-09-04 02:15:41+00:00,2020-09-04 03:44:16+00:00,{},"The VC project files are easy to hand-edit, just need Travis to check that this fixes the VC build. The Xcode build still needs to wait for @Hejnewar, it needs magic numbers for each file.

In source_lists/wesnoth, put the new files in alphabetical order."
479127919,Compress linux and windows debug information before uploading.,Pentarctagon,2020-09-04 00:21:30+00:00,2020-09-04 00:21:39+00:00,{},Also limit sftp to taking at most 5 minutes.
478763711,"Show the ""loyal"" trait in help",stevecotton,2020-09-03 16:55:37+00:00,2020-09-11 04:18:09+00:00,{'Help': 1},"Fixes #1935 for normal users, expanding on aac0941's fix which only showed
these abiities when Wesnoth was in debug mode.

The removed enum member ""NON_REVEALING_DESCRIPTION"" was unused, and all
existing callers effectively used description_type() as a boolean.

This does mean that the ""aged"" trait will be shown to all users, even if
they haven't played HttT, however that seems reasonable."
475953881,1.14 add-ons manager translated titles and description also for System default language,walodar,2020-08-30 19:36:18+00:00,2020-09-07 19:23:13+00:00,"{'Backport': 1, 'Translations': 1, 'Add-ons': 1}","Backport of pull-request #5109 from master to 1.14.
The nice new feature that allows translated add-on titles and descriptions in the add-ons manager works well when the language preference is explicitly set to some supported language, but not when ""System default language"" is selected, because this is represented by an empty string in language.hpp. This pull request fixes this by getting the effective locale (the actual translation target language) from gettext."
475867895,Help browser: fix behavior of clicking on icons of terrain sections,stevecotton,2020-08-30 05:49:53+00:00,2020-08-30 15:19:22+00:00,"{'UI': 1, 'Help': 1}","This commit uses the UI's calculated indent for the UI's event handling, and
removes section::level. The code generating the help sections still has its own
""level"", which is used to detect excessive recursion.

This fixes a UI quirk that I only noticed while working out what section::level
was for, while considering the subtopics needed for implementing a taxonomy
system. The help browser calculates indentation for its tree-view based on the
data tree given to it. However, the logic for deciding whether a mouse-click
was on the icon or the text used section::level, rather than any value
calculated in the UI classes. While section::level was often the correct
number, it was wrong for the terrain types' sections."
475783202,add-ons manager translated titles and description also for System default language,walodar,2020-08-29 14:21:30+00:00,2020-09-07 19:23:30+00:00,"{'Translations': 1, 'Add-ons': 1}","The nice new feature that allows translated add-on titles and descriptions in the add-ons manager works well when the language preference is explicitly set to some supported language, but not when ""System default language"" is selected, because this is represented by an empty string in language.hpp. This pull request fixes this by getting the effective locale (the actual translation target language) from gettext."
475749427,Remove hairline fonts variants,hrubymar10,2020-08-29 09:19:42+00:00,2020-08-29 14:51:24+00:00,{},Fixes #5009
475260942,new lua gui2 widget userdata,gfgtdf,2020-08-28 08:21:30+00:00,2020-09-03 20:08:54+00:00,{},"lua now has a widget userdata that can be used to set/get
widgets properties as one would expect, a lot of the
set/get_dialog_xy function were converted into
modifiable properties of the widget userdata. This
in particular allows us to get rid of the strange
'path to widget' type of arguments of gui2 functions.

This is not as good as i could be though, i'm still unsure about
quite some of the name of the properties, also this does not
yet allow multiple dialog obejcts, furthermore it currently
generates a lot of compiler wanrings

"
474128766,Resend the announcements and server info text when rejoining the lobby.,Pentarctagon,2020-08-26 20:12:43+00:00,2020-09-01 05:55:13+00:00,{},Fixes #5095
473628268,Update World Conquest II Strings,Wedge009,2020-08-26 04:00:23+00:00,2020-09-04 04:21:40+00:00,"{'Campaign (any)': 1, 'Prose': 1}","**Before** merging this I have some questions about some phrases in `data/campaigns/World_Conquest/lua/game_mechanics/wocopedia/help.lua` that I didn't know how to decipher (from a native English speaker's point of view):

Line 39:
> Carryover is 15%, comunitary and avoid negative amounts.

I don't know what 'comunitary' is supposed to mean. Communal? Also what does 'carry-over avoid negative amounts' supposed to mean? Gold will always be non-negative at the start of a scenario?

Line 45:
> Every chance will do different dice rolls

This is in the context of units' training. Every chance of what? Every time a new unit is recruited there will be a different chance of being trained?

Line 68 (partially edited):
> The World Conquest II era consists of factions that are build of pairs of mainline factions of which one has a healer available (Drakes, Rebels and Loyalists), and one does not (Orcs, Dwarves and Undead) the recruit list is also organized in pairs so that you sometimes have to recruit a different unit before you can recruit the units that you want. The available heroes, desertes, and random leaders also depend on your factions, the items you can get do not depend on the faction you choose.

I didn't understand what was meant by 'factions that are build of pairs of mainline factions'. Also... 'desertes'?

I'm guessing @gfgtdf as author (?) can help with the review. I found these while reviewing #5100 for @shikadiqueen."
473572199,WC: Implement internationalization with a mainline-style textdomain,irydacea,2020-08-26 00:20:50+00:00,2020-08-28 02:40:07+00:00,"{'Campaign (any)': 1, 'Translations': 1}","Although World Conquest was added to mainline in 1.15.4, apparently people forgot that mainline content needs translations. 😛

This PR takes care of renaming WC's textdomain to follow the format used for mainline textdomains, as well as setting up the necessary infrastructure for generating and updating catalogues. Based on discussions from around the time WoV was added, I understand that it's expected that the first pot update (included in this PR) will preseed the British English catalogue with the source strings. The Shavian script catalogue also gets preseeded since it's technically an English locale, but I blanked it out like it was done with WoV before since, you know, it uses a completely different and incompatible script.

I'm awaiting confirmation from @gfgtdf that the new textdomain name is appropriate and that there are no pre-existing translations of the add-on before considering the PR complete so I can merge it along with a gettext.w.o update. I'd also like @ivanovic and @loonycyborg to confirm that I didn't miss anything wrt CMake and SCons, and @Wedge009 to confirm that the preseeding of the British English catalogue is still desirable."
472020928,update DID_SHADOW_VEIL_HANDLER in DID campaign,newfrenchy83,2020-08-22 18:36:31+00:00,2020-09-09 19:12:23+00:00,"{'Campaign (any)': 1, 'WML': 1}",simplify DID_SHADOW_VEIL_HANDLER  in DiD and implement an did_shadow_veil_helper active in radius 5 of shadow_veil ability
470951832,Update the tournaments text every hour automatically.,Pentarctagon,2020-08-20 14:34:16+00:00,2020-08-20 17:03:27+00:00,{},
470824429,add moveto_item event,gfgtdf,2020-08-20 10:43:39+00:00,2020-08-26 12:53:08+00:00,{},"this event is fired whena unit steps on a [item], this basicially moves
the implementation of the wc2_drop_pickup event to mainline to reduce code duplication"
469007714,Update changelog,IskarJarak,2020-08-17 18:46:17+00:00,2020-08-17 18:46:58+00:00,{},Nothing more to see here.
468948573,fire theme_reset event after theme was changed,gfgtdf,2020-08-17 16:48:10+00:00,2021-09-06 03:21:47+00:00,{'UI': 1},"probably not the prettiest fix, 4004"
468832624,apply modifications in the same order as when they were originally ap…,gfgtdf,2020-08-17 13:28:48+00:00,2020-08-20 14:34:09+00:00,{},"…plies

Fixes #4419"
468349577,"Save-loading: remove ""under discussion"", add hint about accepting losses",stevecotton,2020-08-15 18:14:35+00:00,2020-08-19 14:52:51+00:00,"{'Prose': 1, 'Help': 1}","This removes some subtle todo text that didn't have a explicit ""TODO"" in
the text, although it was tracked as part of #4280. The discussion ended
without a conclusion about whether those statements were correct for all
mainline campaigns. This PR resolves two of the four subtasks of #4280.

The existing text in this help topic represented paragraphs by having
translatable strings that start with whitespace (two newlines), as described in
issue #4480. As this commit already needed to change all but two of the
paragraphs, I've switched them all to using non-translatable paragraph
separators.  Even though the whole save-loading topic is new in 1.15, it has
already been translated in some languages, and making this consistent means two
unnecessary fuzzy strings. Sorry to the translators, but I think it's
worthwhile. @ivanovic , this is why I've requested your review."
468302794,make slow duration to new turn instead to end turn,newfrenchy83,2020-08-15 12:50:27+00:00,2020-08-15 13:17:03+00:00,{},"

tis fix https://github.com/wesnoth/wesnoth/issues/1129 issue"
466632290,fix codeblock projectfiles,newfrenchy83,2020-08-12 09:08:15+00:00,2020-08-12 09:11:28+00:00,{},
466438131,Help dealing with losses: don't link to the forums,stevecotton,2020-08-12 01:02:57+00:00,2020-08-15 20:57:49+00:00,"{'Prose': 1, 'Help': 1}",This is part of resolving #4280.
466436830,Help about losing: remove reference to specific difficulties,stevecotton,2020-08-12 00:58:22+00:00,2020-08-15 15:49:22+00:00,"{'Prose': 1, 'Help': 1}","Part of resolving issue #4280.

This won't be true of all scenarios in all campaigns, but as a general rule it seems fine."
465418016,"text.cpp: throw if rendering needs more than 2GB, fix antialiasing with stride > width",stevecotton,2020-08-10 10:36:14+00:00,2020-09-01 02:17:50+00:00,{'UI': 1},"The main change here is avoid a crash, but there's also a fix for a possible UI issue with text looking bad. I've made the two changes in a single commit, because if we backport either we might as well backport both (in my opinion).

The effect of text looking bad might only occur with certain combinations of OS, debug/release builds, and potentially graphics card and driver; I don't know whether it ever occurs. The effect is similar to  #1568, #1744 and #1925, to the extent that I'd expect any reports of it to be treated as duplicates of those bugs, however it doesn't quite match the screenshots in those bugs; when this bug is the root cause.

Simulated screenshot, showing what happens if Cairo pads the stride to twice the width - the first half of the text (vertically) looks OK. For this bug to cause the screenshots in #1568, #1744 and #1925 would need an excessive amount of padding, which is why I doubt it's the cause of those bugs.
![half_stride_malin](https://user-images.githubusercontent.com/101462/89774326-f7fb9180-db05-11ea-872e-279a13c7c2e5.png)


Refactor text.cpp's buffer alloc, throw instead of crashing if it needs more than 2GB

The limit is arbitrary, and 2 gigabytes is very large. The new TODO comment
in the .cpp file gives a possible future refactor which would reduce the limit.

The old early-return for surface_buffer_.empty() moves upwards and changes to
testing for zeros before the allocation; it now also acts as a guard for
division by zero in the (height > int::max() / stride) test.

The loop around from_cairo_format() relied on stride being exactly
sizeof(uint32_t) * width, an assumption which would break if
cairo_format_stride_for_width added padding."
465192680,Have mainline content send [multiplayer][addon] info as well.,Pentarctagon,2020-08-09 19:30:59+00:00,2020-08-14 14:03:19+00:00,{},"This commit:
* sends the era and scenario as part of a [multiplayer][addon] in order to make it consistent with how add-ons' information is sent to wesnothd. this means all of the game's content information is now available in the [multiplayer][addon] data.
* correctly covers the case of there potentially being modifications added to mainline at some point. the current code looks at the [multiplayer]mp_scenario= and [multiplayer]mp_era attributes to cover the case of a mainline era/scenario being used, but looks for modifications only in the [multiplayer][addon] data, which wouldn't have any entry for a mainline modification right now if one were added."
465182123,Add more fauna resources,doofus-01,2020-08-09 17:54:18+00:00,2020-09-21 00:45:37+00:00,"{'Enhancement': 1, 'Ready for testing': 1, 'Graphics': 1, 'Units': 1}","Wesnoth has some fauna like giant rats and spiders, but the selection is pretty limited.

First commit to this is the tusker line by thespaceinvader a while back (needs some updates):
https://forums.wesnoth.org/viewtopic.php?p=338501#p338501

More to come, just wanted to get this PR kicked off.
EDIT:  Forum thread for this https://forums.wesnoth.org/viewtopic.php?f=9&t=52894"
464763201,Campaignd storage rework and incremental updates/uploads,kabachuha,2020-08-07 18:50:31+00:00,2020-10-15 13:39:20+00:00,"{'UI': 1, 'Add-ons': 1}","# Campaignd storage rework and incremental update packs

Hello, Wesnoth devs! The goal of this pull request is to solve multiple problems considering the `campaignd` (addons server) as well as to lay a path for some new useful features.

## Addon storage rework
Firstly, it divides the addon storage monofile into a set of folders containing the metadata, full installation packs and incremental update packs. That allows to save disk writing usage because only addons with modified data will be written when the server saves its configuration. Also, the runtime metadata model has changed from list (`config`) to hash-map (`std::unordered_map`) in order to guarantee a constant time access on average instead of checking every element's name. Moreover, that allows storing multiple addon versions, so the client will be able to grab the latest version satisfying its `min_wesnoth_version` (see @gfgtdf 's proposal) or migrate to a previous version in case of breaking changes. (_see future plans_) Old addons are to be converted on the first server setup.

The new addon storage structure on server:

```
server.cfg <- server configuration
data/ADDON_NAME_1/
data/ADDON_NAME_1/addon.cfg <- add-on title, icon, description, translations info, etc. (metadata) for the current version, including information on past versions and their packs
data/ADDON_NAME_1/update_pack_HASHHASHHASHHASHASH1.gz <- cached update pack from version X to version X+1
data/ADDON_NAME_1/update_pack_HASHHASHHASHHASHASH2.gz <- cached update pack from version X to version X+2
data/ADDON_NAME_1/update_pack_HASHHASHHASHHASHASH3.gz <- cached update pack from version X+2 to version X+3
data/ADDON_NAME_1/full_pack_HASHHASHHASHHASHASH4.gz <- the full WML pack at version X, no metadata
data/ADDON_NAME_1/full_pack_HASHHASHHASHHASHASH5.gz <- the full WML pack at version X+1, no metadata
data/ADDON_NAME_1/full_pack_HASHHASHHASHHASHASH6.gz <- the full WML pack at version X+2, no metadata
data/ADDON_NAME_1/full_pack_HASHHASHHASHHASHASH7.gz <- the full WML pack at version X+3, no metadata
```

The addon's metadata config gained two children: version and update_pack. There can be multible `[version]` and `[update_pack]` tags in the same metadata.

At the moment they consists of these attributes:

```
[version]
	filename=""/full_pack_HASHHASHHASHHASHASH4.gz""
	version=""0.1.1""
[/version]
[update_pack]
	expire= # the expiration timestamp. Outdated update packs will be removed and replaced with the new ones if they are still needed.
	filename=""/update_pack_HASHHASHHASHHASHASH3.gz""
	from=""0.1.0"" # the previous version
	to=""0.1.1"" # the new version
[/update_pack]
```

The `[version]` tag may be supplied with `min_wesnoth_version` attribute later (see _future plans_ and @gfgtdf).

## Incremental update packs

When a new addon upload is received by server and it's addon has already been published, the server will generate an update pack from the previous version to the new one (and from this new version to the next one if we're uploading an interim version, it's also possible). The update pack contains a list of files to be removed from the local version and a list (old style addon archive) of files to be installed. The client is now sending the version of the local addon if it's present and the desired version (if it is empty or not found, the latest version will be selected). Then the server will send a chain of addended updatepacks for each version gap (for example, if the client has version 0.1.0 and server has 0.1.1 and 0.1.2, and the client wants 0.1.2, we'll send 0.1.0->0.1.1 and 0.1.1->0.1.2 update packs combined). If it failed to find the initial version (or it was not specified like in the case with old clients), the server will send a full pack.

The justifications for incremenal updates is simple as said in an excerpt from https://wiki.wesnoth.org/NotSoEasyCoding:

```
Right now, whenever a new add-on version is published, players must download (or conversely, upload) the whole contents, even if the differences between both versions amount to a single line change. This is not a problem with small add-ons, but there is a substantial number of large (> 10 MiB) add-ons on the server. Large downloads and uploads are inconvenient for players on slow or metered connections, and also increase the server's traffic requirements. 
```

## Incremental upload packs
Now it's also possible to upload addons the same incremental way. When a client wants to update an addon on the server, the game request the list of file hashes from it and then forms the upload pack by checking the difference between the checksums. That addon hash list is generated during the upload process and then it's directly sent to the client. When the pack arrives on the server it is integrated into the update pack sequence and the next version full pack is formed. This mechanism will lower both the network and the CPU usage for the server.

## Future plans

This PR is generally completed (I'm looking for a review), but it can be adjusted now or with the future PR. I perceive the next steps as following:

- Add client side changes detection using hash verification with a client-side generated checksum on download or with a hash request from the server. If the changes has been detected, we can throw a warning message box.
- ~~Add partial **uploads** via client-generated (but server-validated) update packs (will require adding hash request from the server to the protocol).~~ (Done)
- Add client side version selection based on its `min_wesnoth_version` attribute (see @gfgtdf 's min version proposal in the roadmap).
- Add a gui list of avaible addon versions.
- Attach a changelog ?
- Cosmetic stuff

I think this rework may be added to the `1.16` roadmap along with @gfgtdf 's suggestion."
464667065,"Fix the build, separate fixes for VC16 and GCC-10",stevecotton,2020-08-07 15:28:53+00:00,2020-08-07 17:06:55+00:00,{'Building': 1},"I'm relying on Travis to check whether the VC16 fix is correct,
as I don't have a Windows install to test this locally. However,
I think having it building and running the unit tests would be
better than having the CI builds fail."
464483873,fix wesnothd and campaignd codeblock projectfiles after https://github.com/wesnoth/wesnoth/pull/5029,newfrenchy83,2020-08-07 08:57:42+00:00,2020-08-07 09:18:06+00:00,{},
464015359,update codeblocks projectfiles,newfrenchy83,2020-08-06 13:06:36+00:00,2020-08-06 17:21:03+00:00,{},
463578435,Add JPG support to VC++2019 build,DisherProject,2020-08-05 18:52:27+00:00,2020-08-06 04:43:39+00:00,{},"Related to #5030 

I have updated the list of the dependencies and the Visual Studio project, so that they also include `sdl2-image[libjpeg-turbo]:x64-windows`. This further library solved the issue."
463022077,Move campaignd and wesnothd files into more descriptive locations.,Pentarctagon,2020-08-04 21:38:08+00:00,2020-08-06 17:16:19+00:00,{},Also fix a few cases of not specifying the full path to header files.
462306118,New balance update,Hejnewar,2020-08-03 17:30:53+00:00,2020-08-04 17:35:56+00:00,{},"Changes:
Burner line cold resistance changed from -50% to -40%.
Heavy Infantryman cold resistance changed from -10% to 0.
Dwarvish Steelclad hp changed from 55 to 57.
Poacher hp changed from 32 to 33. 
Troll Rocklobber hp changed from 49 to 51.
Merman Hunter hp changed from 30 to 33.
Wose cold resistance changed from 10% to 0.
Shaman ranged damage changed from 3 to 4.
Ghost cost changed from 20 to 19."
462138550,"Final part of the Python 2 removal, including install-pytools",stevecotton,2020-08-03 12:06:15+00:00,2020-08-05 19:56:13+00:00,"{'WML Tools': 1, 'Building': 1}","Update the list of files installed by ""scons install-pytools"", dropping Python2
versions and adding their Python3 replacements. This doesn't update any
`import` statements, as the tools have already been ported to use the Python3
modules - the scons script was out of date and was still bundling the wrong
versions.

Note for anyone looking at the history - although most of the current
tools have a '3' in the name just to indicate that they're the Python 3 version,
there's a double-meaning to that number in wmlparser3.py's name. There was a
`wmlparser2.py`, where the `2` indicates a redesign of the original.

The data/tools/README.md file was renamed from plain README without being
converted to Markdown format. This commit touches about half of that file;
headings in that half are updated to be Markdown, but to reduce the diff the
other headings aren't updated.

Closes #1508 ."
461941725,Change mariadbpp includes to be quoted.,Pentarctagon,2020-08-03 04:56:36+00:00,2020-08-03 04:56:45+00:00,{},
461856289,Various minor graphics fixes/updates,doofus-01,2020-08-02 20:29:03+00:00,2020-08-10 00:29:15+00:00,"{'Enhancement': 1, 'In-progress': 1, 'Graphics': 1}","For now includes
1.  Adult version of scorpion portrait, so the scorpion and scorpling don't share a portrait
2.  Revised naga dirkfang portrait, in anticipation of LordBob's completion of the unit line
3.  dwarf castle floor transitions (only needed if mixed with non-dwarf castles)"
461824444,Fix SDL2 2.0.12 change in SDL_GetDisplayDPI,hrubymar10,2020-08-02 15:52:35+00:00,2020-08-06 04:44:40+00:00,"{'Unconfirmed': 1, 'macOS': 1}","As always, I want to ask somebody for code review. I am not C++ master but I tried my best.

Also I have to note that this code is probably correct but I cannot tell it for 100%. As always, `it works for me`.

Also wait for travis CI builds before merging.

Fixes #5019"
461803517,extent special_id_active and special_type active to abilities weapon and add two attributes for [specials] only,newfrenchy83,2020-08-02 12:57:02+00:00,2020-12-26 19:48:24+00:00,"{'Campaign (any)': 1, 'Units': 1, 'Schema': 1}","it is the same resolve of https://github.com/wesnoth/wesnoth/issues/4840 but with the number of commit in https://github.com/wesnoth/wesnoth/pull/4856 and the errrored build, i prefer put a new PR "
461787811,alterntivive min_addon_version fix,gfgtdf,2020-08-02 10:19:20+00:00,2021-07-30 22:26:48+00:00,{},"Fixes #5004

Now we have the following invariant: addon.min_version is set if and only if addon.required."
461457004,An add-on's min_version should be unset to indicate the latest version is needed.,Pentarctagon,2020-08-01 22:00:51+00:00,2020-08-03 03:54:09+00:00,{},"This changes the min_version logic to:
1) Unset the min_version if the add-on already exists with a set min_version.
2) Only check and potentially update the min_version if the add-on already has a min_version set.

Fixes #5004"
460928330,Make sure to reset the logging level to the default in tests that change the logging level.,Pentarctagon,2020-08-01 08:54:52+00:00,2020-08-01 19:03:56+00:00,{},Fixes #4898
459617431,Fix SDL assertion failed,hrubymar10,2020-07-30 21:36:13+00:00,2020-07-30 22:32:26+00:00,{},"I am openning this PR as I am not C++ expert.

I got SDL assertion failure with recent `master` branch and I found that this exactly same was discussed and solved there: http://forums.wesnoth.org/viewtopic.php?t=52296&start=15

My solution is based on this commit: https://github.com/wesnoth/wesnoth/commit/3545a3e48dec31abb651fd0b6ba4fb7052da5941

I want to ask someone to review my fix before accepting. Thank you"
459554727,Add lua attack_type:active_specials() api,gfgtdf,2020-07-30 20:01:30+00:00,2021-09-06 03:14:36+00:00,{},"this api can be used to query active attack and make them work 'just like mainline abilities'

This also contains a ability-related fix.

As a ""testcase"" this adds the new [feeding] ability implemented in lua:
> Now feeding is reconized by tagname instead of
id. This means in particular that umc authors
can use [feeding] abilities with filters now.
>
> Also [feeding] is now technicially a weapon
special, but sicne weapon speciasl can be used
in [abilities] it will work as before.
>
> Lastly [feeding] now takes a value, for example
`[feeding] value=(opponent.level)` should
increase the units max hp by the opponents level
(not tested)."
458768647,Remove the python2 rmtrans tool,stevecotton,2020-07-29 23:38:07+00:00,2020-07-30 20:19:53+00:00,{'Graphics': 1},"This is part of #1508. This tool seems unused, as there's:

 * Wiki: no mention of rmtrans
 * main Git repo: only the brief paragraph in the tools readme
 * resources repo: no mention of it
 * forums: only as part of a general list of Python files
 * Github issues and PRs: only as part of a general list of Python files

FWIW, I think it's already possible to do with Gimp's default tools (""Colors"",
""Curves ..."", select channel ""Alpha"", select curve type ""Freehand"", click in
the bottom-left of the box and sweep down, then to the left edge of the box,
then as far right as required)."
458669567,"Disambiguate some python shebang lines to be ""python3""",stevecotton,2020-07-29 20:16:50+00:00,2020-07-29 23:31:40+00:00,{'Building': 1},"I'm opening a PR to check that this builds on all of the platforms, but then plan
to merge without further review. @loonycyborg already uses these tools with
Python 3, and gave a green-light for this change in https://github.com/wesnoth/wesnoth/issues/1508#issuecomment-665119912 .

The python launcher tool for Windows has magic handling for some shebang lines,
however `#!/bin/env python` isn't recognised without the `/usr`. Had the `/usr`
been included with the old code then these scripts would likely have been run
with Python 2.
https://docs.python.org/dev/using/windows.html#shebang-lines"
458116197,readd changing the order of [terrain_graphics],gfgtdf,2020-07-28 23:52:12+00:00,2020-07-29 17:31:55+00:00,{},"before the 'ignore unused addons' commit the engine reordered [terrain_graphics] to make mainline [terrain_graphics] appear after umc [terrain_graphics] tags, this commit restores this behavior  (instead of using [terrain_graphics]precendence= in mainline which would be an alternative  fix). If we ever use game_config_view for anything else than the game_config we can also make this an optional ""bool put_first_source_last"" parameter."
457838479,"misc fixes, pr for travis check",gfgtdf,2020-07-28 14:13:40+00:00,2020-07-28 23:09:08+00:00,{},
457116750,WIP: Create log files on linux,lukasmalkmus,2020-07-27 11:59:29+00:00,2020-09-11 16:32:58+00:00,{'Linux': 1},"This is a WIP PR. I want to - step by step - fix #4805. The codebase is rather large and I need to get familiar with it. Also need to refresh my CPP knowledge (again).

The idea is to take the work from [src/log_windows.cpp](src/log_windows.cpp) and [src/log_windows.hpp](src/log_windows.hpp) and adapt for Linux in the respective files.

The first commit just makes sure stuff compiles and I didn't break anything major :)"
456748208,Fixed markup in notifications with regex,philippalexanderhaendler,2020-07-26 13:11:13+00:00,2020-10-26 02:11:01+00:00,{},This is a fix for the issue #4724 
456575861,Avoid prematurely generating bad color range/palette definitions,irydacea,2020-07-25 06:31:18+00:00,2022-07-30 14:31:52+00:00,"{'Bug': 1, 'WML': 1}","(PR against 1.14 because master refuses to read custom colour range/palette definitions at all right now? The forward port is trivial, though.)

Previously it was possible for the game to try to coerce any named color range/palette that hasn't been defined by WML yet into a range/palette with RGB `#000000` as its first entry, since `strtol()` (used by the `color_t::from_hex_string()` function) will return 0 if the input is not a valid hexadecimal number.

Now, normally this condition was *not* reached because `color_t::from_hex_string()` throws `std::invalid_argument` if the input
isn't exactly 6 chars (as in char, not Unicode characters) long. The problem is, in English, ""yellow"" is exactly 6 chars long.

The existing code suggests that we should be throwing in this case, and this is exactly what was already being done in the general case, so just do that immediately when:

 1. A named color range doesn't exist and it doesn't have at least one comma.
 2. A named color palette doesn't exist and it has characters that aren't hexadecimal digits or commas.

Reasoning:

 1. While `color_range`'s type definition in the engine suggests that only the first colour value is needed, this doesn't make much sense from the WML API standpoint so we might as well be stricter than the `color_range` constructor here.

 2. As for palettes, there's a possibility that someone may want to perform a palette substitution with exactly one colour (e.g. `~PAL(FF00FF>000000)`), so we just make sure that all characters in the ""name"" are hexadecimal digits. This means that using ""DEADED"" as a name might be a bad idea if the palette somehow finds itself being used before being defined (it will effectively create a new palette with `#DEADED` as its only entry) but it's either that or making the single colour case surprisingly clunky to write.

Ideally, we should be resetting colour info entirely (the `game_config::reset_color_info()` function) every time we enter a game,
but for *some* reason that's not done at the moment. It would also make more sense to allow `[color_range]` and `[color_palette]` definitions to be overridden under certain circumstances, but currently that's not the case (the first defined element with a given id remains a constant for the entire game session) and it's also more work to change that.

(Wow, I'm doing a terrible job at selling this commit, aren't I?)"
455858195,[1.14] Warn about manually editing files created by the scenario editor,stevecotton,2020-07-23 17:35:35+00:00,2020-07-27 01:14:52+00:00,{'Editor': 1},"Backport of #5001 to the stable branch.

This comment will be added at the start of any .cfg file written by the
scenario editor. Given that the only target audience is authors using text
editors, it's not translatable and uses plain ascii characters.

(cherry picked from commit 11d702225b5999919d742997e866a777ca29a3c3)"
454960620,Warn about manually editing files created by the scenario editor,stevecotton,2020-07-22 08:23:18+00:00,2020-07-23 17:18:09+00:00,{'Editor': 1},"This comment will be added at the start of any .cfg file written by the
scenario editor. Given that the only target audience is authors using text
editors, it's not translatable and uses plain ascii characters.

This is the easy part of #1380."
452858427,Don't insist that windows request nonzero height or width,gwhitney,2020-07-19 23:29:07+00:00,2020-07-20 15:33:24+00:00,{},"  Reverts the assertion concerning nonzero window dimensions in
  gui/widgets/window.cpp; it turns out that some windows do request zero
  dimension, and it doesn't hurt anything for them to.

  Fixes #4960."
452780915,Add help topics for the Editor (as it stands in the 1.14 branch),stevecotton,2020-07-19 21:18:50+00:00,2020-12-30 12:39:08+00:00,"{'Editor': 1, 'Prose': 1, 'Help': 1}","Add help topics for the Editor, as it stands in the 1.14 branch

This commit is on the master branch. There have been no changes at all to the editor documentation in the 1.14 branch, while there have been several updates to the master branch that would be good to backport if the help is displayed in the 1.14 branch - therefore my plan is to get this set of changes reviewed in the master branch, and then simply pull the entire file into the 1.14 branch along with enabling the editor documentation (a small change to data/core/help.cfg, as done in commit ed611f94385f608512da55d691d3c9753240d5d5).

A couple of warnings about the scenario mode being buggy are added to the user-visible text, find these by looking for <bold> tags within the text.

<strike>Original draft PR description follows:

I'm hoping that someone who uses the scenario editor will take over and write
the documentation. Without the knowledge of someone who uses the editor, the
only option is to leave a gap in the documentation; this commit is merely
hiding the problem to remove the ""Blocker"" tag from issue #2964.

This leaves dead links in the ""Editor Tools"" page, which I hope will be fixed
by someone else adding the relevant pages, rather than having to just remove
that section.</strike>"
448134762,Backport addon titles and descriptions made translatable,kabachuha,2020-07-13 09:35:58+00:00,2020-07-19 16:29:45+00:00,"{'Backport': 1, 'Translations': 1, 'Add-ons': 1}","Hello, wesnoth devs!

This is the backport of my previous pull-request (#4984) making addons titles and descriptions translatable to 1.14.
You can see the rationale and the discussion here: https://github.com/wesnoth/wesnoth/pull/4984 .

As for backwards-compatibility, I tested this build on my local server, and it works just as it had been before both when the new client connects to the old server or the old client connects to the new server. All the features worked fine when I tested them with an example addon."
447988486,Throw instead of crashing when handling extremely long text,stevecotton,2020-07-13 01:30:53+00:00,2020-07-13 08:45:10+00:00,"{'Bug': 1, 'UI': 1}","Both of these still result in the program quitting, they just make it a graceful quit with a hopefully useful diagnostic. 

The length of text required to trigger these is excessive; in one case the trigger is to make (width * height * 32 bits per pixel) exceed 2 gigabytes, for debugging I added a comment to the credits with 30000 short lines and a single 12000 character line. These changes are inspired by bug #3265, but I think the already-merged fix to that bug handles all sane input, the changes in this PR handle edge cases that need deliberately crafted input to trigger them."
446933223,Various fixes,Pentarctagon,2020-07-09 15:26:28+00:00,2020-07-12 20:37:44+00:00,{'MP': 1},"Tested locally:
* Starting a game with and without mods using 1.14.13 (Steam release).
* Starting a game with and without mods using 1.14.13+dev.
* Loading a saved game in MP."
445091832,Replace aitesting log domain with ai/testing,irydacea,2020-07-07 01:47:31+00:00,2020-07-07 23:39:53+00:00,{},"The former was added in commit 40a1e7d3fa74d59e7bba2d23fc535d9aa0a7f499. However, `ai/testing` predates it by several years (added in commit ab540dca1517e82d0f93153604cdb00f256becd6) and also follows the existing naming convention better.

I don't think this should break anything, but just in case I'm creating a PR for it to run unit tests, since apparently `aitesting` was at some point relevant for those."
444545365,Create Unit UI improvements & unit type variation selection,irydacea,2020-07-06 05:27:58+00:00,2020-07-09 21:42:16+00:00,"{'Enhancement': 1, 'UI': 1}","This is a bit of a messy pull request that touches both backend code (the synced commands functionality) and UI code (context menu, Create Unit) bringing a few improvements to the Create Unit dialog.

Firstly, smaller aspects of Create Unit should be more streamlined by removing redundant labels and caption text.

Secondly, the dialog now supports selecting the unit type variation for the unit that will be created.

![image](https://user-images.githubusercontent.com/489895/86558510-85582e80-bf27-11ea-8b1b-cc4b9dce5859.png)

In order to implement this functionality I had to touch a surprising amount of code in `menu_events.cpp`, the synced commands functionality, as well as a couple key methods of the `unit` class. As far as I can tell there shouldn't be unexpected side-effects for these changes, but just in case I want @gfgtdf's review in addition to @Vultraz's anyway since it's not code I am well familiarized with at the moment.

(Also, hopefully the UI implementation side of things conforms to the current UI coding style.)"
444460859,use shared_ptr for unit_ptr,gfgtdf,2020-07-05 21:09:06+00:00,2020-08-07 12:30:41+00:00,{},"This make the code a bit simpler, furthermore it
allows us to use weak_ptr to untsi shodul we ever
need that."
444455790,Addon titles and descriptions made translatable,kabachuha,2020-07-05 20:20:25+00:00,2020-07-09 10:19:45+00:00,"{'Translations': 1, 'UI': 1, 'Add-ons': 1}","**Addon titles and descriptions made translatable**

Hello, wesnoth devs!

The international wesnoth players had long been troubled by not being able to see what the addon is about without installing it or using external tools. So I decided to make it possible to see addon titles and descriptions in the addon manager.

I've done through `[translation]` tag modification because sending .mo file for the entire campaign is unnecesearily, and .mo and .po workflow just for .pbl file is redundant.

The feature is done on the `master` branch, but I'd like backporting it to 1.14 in after it's tested.

The original tag contains only the `language` attribute, the new one has the following structure. (If the declaration is abscent, but the .mo file is present, it'll be added with `supported=yes` attribute.):
```
[translation]
	description=""localized description""
	language=""ru"" #locale code
	supported=yes #is set to yes if the corresponding .mo file has been found, otherwise no. If the client receives the tag without the `supported` attribute, it's assumed as `yes` for backward compatibility.
	title=""localized title""
[/translation]
```

To upload the description translation insert it into the .pbl file.

<details>
  <summary>The example .pbl file</summary>
  
  ```
	author=""kabachuha""
	title=""Hello World""
	icon=""units/monsters/gryphon.png""
	version=""0.1.0""
	description=""Checking the translation of the addon!""
	type=""campaign""
	email=""artemkhrapov2001@yandex.ru""
	passphrase=""iloveasaltycucumber""
	translate=true

	[translation]
		language=""ru""
		title=""Здравствуй, мир!""
		description=""Проверка перевода описания аддона""
	[/translation]

	[translation]
		language=""zh_CN""
		title=""你好，世界!""
		description=""检查插件的翻译 (translated online)""
	[/translation]
  ```
  Notice: My testing addon also has a .mo file for the Japanese translation which isn't declared in this file. But you'll see it in the server database with `supported=yes`.
  
</details>

The deal with the `supported` attribute is to protect against an edge case when the translation is declared without the .mo file (as pointed out by Iris (@shikadiqueen) and against duplicate translations.

The server stores the addon info as usual except for the appended `translation` tags.

<details>
  <summary>The server.cfg from my testing addon server</summary>
  
  ```
	compress_level=6
	[campaigns]
		[campaign]
			author=""kabachuha""
			description=""Checking the translation of the addon!""
			downloads=1
			email=""artemkhrapov2001@yandex.ru""
			filename=""data/Hello_World""
			icon=""units/monsters/gryphon.png""
			name=""Hello_World""
			original_timestamp=1593893863
			passhash=""hs3F0Q1wNL2b2xWTn5ODS1""
			passsalt=""nfOLTKWsrjS/s6v2""
			size=776987
			timestamp=1593899194
			title=""Hello World""
			translate=true
			type=""campaign""
			upload_ip=""127.0.0.1""
			uploads=7
			version=""0.1.0""
			[translation]
				description=""Проверка перевода описания аддона""
				language=""ru""
				supported=yes
				title=""Здравствуй, мир!""
			[/translation]
			[translation]
				description=""检查插件的翻译 (translated online)""
				language=""zh_CN""
				supported=no
				title=""你好，世界!""
			[/translation]
			[translation]
				language=""ja""
				supported=yes
			[/translation]
		[/campaign]
		[campaign]
			author=""kabachuha""
			description=""Addon with no translation for Russian!""
			downloads=0
			email=""artemkhrapov2001@yandex.ru""
			filename=""data/Status_Quo_Addon""
			icon=""units/monsters/gryphon.png""
			name=""Status_Quo_Addon""
			original_timestamp=1593894760
			passhash=""E6D1VGjAb5bXqxK/KAWKH0""
			passsalt=""oMGowk3uSHic9QY0""
			size=3656
			timestamp=1593894760
			title=""Status Quo""
			translate=true
			type=""campaign""
			upload_ip=""127.0.0.1""
			uploads=1
			version=""0.1.0""
			[translation]
				description=""检查插件的翻译 (translated online)""
				language=""zh_CN""
				supported=no
				title=""你好，世界!""
			[/translation]
		[/campaign]
	[/campaigns]
  ```
  
</details>

The client side will check if the translation exists for the current locale and will use the translated title (the original title is shown slightly below the title for players who had known the addon by the English name) and the translated description in that case.

Also, I made possible to search both for the original and the translated strings in the manager.

***Demos***

<details>
  <summary>Pictures</summary>

The changes are fully backwards compatible with the old server/client.

![backward_compatible](https://user-images.githubusercontent.com/14872007/86541427-7e282500-bf15-11ea-9c60-dc27ee661df2.png)

Addons on my pet server.

![2020-07-05-005141_1920x1080_scrot](https://user-images.githubusercontent.com/14872007/86541455-c2b3c080-bf15-11ea-9743-5cdd07145fb5.png)

Chinese translation is rendered fine too.

![2020-07-05-005233_1920x1080_scrot](https://user-images.githubusercontent.com/14872007/86541462-d65f2700-bf15-11ea-8650-56a8f96e28db.png)

Uploadable addons are also translated and the search is possible.

![2020-07-05-004724_1920x1080_scrot](https://user-images.githubusercontent.com/14872007/86541486-060e2f00-bf16-11ea-8f79-0745f77fb39f.png)

</details>

***Known issue***

The addon's name may not be fully shown in the dependecies window if it's very long. (According to Iris and Vultraz, its the fault of the gui even without the translation, so it belongs to another issue)."
444204484,update codeblock projectfiles,newfrenchy83,2020-07-03 22:15:15+00:00,2020-07-03 22:16:27+00:00,{},
443685971,add a function [affect_distant] to the abilities,newfrenchy83,2020-07-02 18:45:36+00:00,2020-08-22 18:41:37+00:00,"{'WML': 1, 'Units': 1}",
442990226,Remove VC14 (VS2015/VS2017 project files).,Pentarctagon,2020-07-01 21:07:09+00:00,2020-07-03 17:23:35+00:00,{'Building': 1},"Reasons:
* These projectfiles are still 32-bit, whereas all other builds for all other OSes are now 64-bit.
* Relatedly, these projectfiles are dependent on the libraries kept at the aquileia/external repository.
* VS2019 is still listed as supporting Windows 7, so there is a minimal likelihood of developers not being able to use VS2019.
* The VS2019 projectfiles instead use vcpkg to get the required dependencies, which is easier to setup than the aquileia/external prebuilt libraries.
* It's one less thing that needs to be updated whenever source files are added/moved/removed.
* It's two fewer jobs that Travis needs to run, which means Travis builds will finish more quickly."
441717478,Remove the UMC IDE plugin.,Pentarctagon,2020-06-30 00:40:09+00:00,2020-07-08 03:59:07+00:00,{},"The reasons being:
* It's been unmaintained for several years now, so any bugs that might be reported against it will almost certainly not be fixed.
* Having been unmaintained for so long, even if someone wanted to create a custom Wesnoth IDE plugin, it's unlikely this would be a good foundation to continue with anymore.
* There are at this point better alternatives that people are actually using and maintaining (such as the VSCode plugin).
* Having this be present can give the impression that this IDE plugin is something UMC authors should still be using, which I think makes it actively harmful. Case in point, the current version of this available on SourceForge (2.0.1) was downloaded twice as of the current week; however the most recent version (2.0.2 in the changelog, or 2.0.3 based on some git commits) is not available on SourceForge at all, nobody apparently ever uploading it."
441662696, updated codeblock projectfile ,newfrenchy83,2020-06-29 21:36:41+00:00,2020-06-29 21:48:26+00:00,{},
441096300,UtBS and Quenoth rebalance,nemaara,2020-06-28 18:33:50+00:00,2020-07-19 23:54:56+00:00,"{'Ready for testing': 1, 'Campaign (any)': 1, 'Units': 1}","@Hejnewar I've started this PR, please feel free to put any comments you have. This is only a first draft, I haven't playtested it at all yet."
440940349,Scale fixed-size dialogue window capped by screen size percentage,gwhitney,2020-06-27 17:37:11+00:00,2020-06-29 23:18:40+00:00,{'UI': 1},"Changes the GUI_WINDOW_PERC_FIXED_SIZED_CENTERED macro used by the load game dialogue to scale the nominal pixel size of the window by exactly the same scaling used for font sizes at large pixel dimensions, but (a) capped by a percentage of the screen size and (b) no smaller that it would have been under older code. Provision (b) is important to avoid the dialogue becoming any smaller on lower-pixel-dimension screen sizes where the label font scaling is not in effect.

Resolves #4969 
"
440487391,Add Earthy Rockbound Cave terrain,irydacea,2020-06-26 09:43:40+00:00,2020-07-02 11:04:44+00:00,"{'Enhancement': 1, 'Terrain': 1}","Adds an earthy version of the Rockbound Cave terrain I made over half a decade ago for my add-on campaigns Invasion from the Unknown and After the Storm.

![image](https://user-images.githubusercontent.com/489895/85843863-d6219780-b76f-11ea-8b7b-2af35f2d3350.png)

The colour shift I used doesn't 100% match the one eleazar used for the Earthy Cave Floor terrain, but I believe I may be one of the very few people who will ever notice the difference and personally it doesn't bother me. Adding this terrain variation is long overdue and the images can be changed later if necessary.

(See also the forum thread: <https://r.wesnoth.org/t52616>)"
440029417,fix {WEAPON_SPECIAL_INITIATIVE_EVENTS} not in scepter_variation(1.14 version),newfrenchy83,2020-06-25 13:42:29+00:00,2020-06-26 06:45:39+00:00,{},this macro must be present in scepter_variation of Princess and Battle_Princess unit_type for what initiative abilitie function in 1.14 when Li'sar have the Scepter of fire
438653226,WIP fix crash when reading chinese -po files,gfgtdf,2020-06-23 15:36:01+00:00,2020-06-23 22:12:51+00:00,"{'Translations': 1, 'Engine': 1}","you may _never_ use the std:: file io functions
in wesnoth since they only support acii characters.
wes have fixed this mayn times already but apparently
the preson that added -po file support didn't knew
that."
437974385,WIP only load active add-ons fixes #4832,gfgtdf,2020-06-22 14:17:19+00:00,2020-06-29 13:16:06+00:00,{'Add-ons': 1},"With this, the engine will ignore all global tags defined by addons that are not used in the current game, The main purpose is to solve OOS. The addons that are uses in the current gam are the addons that defines one the the [campaign],[modification] etc. tags that are uses in the current game."
437854109,Add missing includes of units/types.hpp to the unit tests,stevecotton,2020-06-22 10:48:05+00:00,2020-06-22 15:46:39+00:00,{'Building': 1},"Some indirect inclusion paths were removed in 194b903918db4405862028ed4ab2eb2ae6fc91c2.

Creating a PR to check that this builds everywhere."
437203983,Store additional information in the database:,Pentarctagon,2020-06-19 16:47:40+00:00,2020-06-23 17:34:14+00:00,{},"* mp_scenario_addon_id
* mp_scenario_addon_version (host's version)
* mp_era_addon_id
* mp_era_addon_version (host's version)
* active_mod_addon_ids
* active_mod_versions (host's versions)"
435549577,Update @iKevinY's credits entry,iKevinY,2020-06-17 01:30:09+00:00,2020-06-17 02:00:55+00:00,{},Noticed that I was added into the credits for some PRs from a few years back; just going and updating the entry with my name. 😄
435426756,bi: Add sound configuration to the clipboard report,irydacea,2020-06-16 19:37:30+00:00,2020-06-17 02:52:04+00:00,{'Enhancement': 1},Also refactored the display driver formatting code since SDL enumerates audio drivers in the exact same format.
435386317,Send scenario/era/modification source add-ons and addon versions to wesnothd.,Pentarctagon,2020-06-16 18:08:29+00:00,2020-06-18 15:33:32+00:00,{},"This adds the additional attributes under the multiplayer information sent to wesnothd:
* mp_scenario_addon_id
* mp_scenario_addon_version (host's version)
* mp_era_addon_id
* mp_era_addon_version (host's version)
* active_mod_addon_ids
* active_mod_versions (host's versions)

---

This doesn't contain the part to actually insert the data, since I don't want to create a conflict with #4884."
434706798,[WIP] allow ./../ in wml file inclusion,gfgtdf,2020-06-15 18:38:09+00:00,2021-09-06 03:24:22+00:00,{'WML': 1},"to do that the Preprocessor code was refactored to use the new ""wml_path"" class which basically splits the path into two parts of which the second might be traversed upwards but the first part not, security is guaranteed exactly the same way as before since we still call the same get_wml_location function.

This in particular allows s me  to make  the WC2 code easier by since i can hopefully do something like `#ifhave  ./../../campaigns to check whether the code  is currently inside the mainline directory or not. ` "
434184313,core - terrain - fix Rb/Ias transition,doofus-01,2020-06-14 18:36:37+00:00,2020-06-21 00:17:38+00:00,"{'Graphics': 1, 'Terrain': 1}",
434168090,Updates of Russian translation for A Tale Of Two Brothers,dmitryash,2020-06-14 16:22:13+00:00,2020-06-14 18:03:32+00:00,{},
434165328,Some additions and work on UtBS,doofus-01,2020-06-14 16:01:21+00:00,2020-06-27 12:18:34+00:00,"{'Enhancement': 1, 'Ready for testing': 1, 'Campaign (any)': 1}",includes the fix to #4949 
434040134,bi: Refactor clipboard report formatting logic,irydacea,2020-06-13 18:28:27+00:00,2020-06-16 02:50:59+00:00,{'Enhancement': 1},"This makes all sections use a formatter class to deal with the issue of keeping the first column's width consistent within each section (but not across all sections), so that we don't run into inconveniences later in the future if any section's entry labels change. It also allows us to change the list formatting entirely in a single place rather than multiple places if we ever decide to do so.

The video and add-ons report sections are also made to use the new formatter, making them look more consistent than before compared to the rest of the report:

```
Current video settings
======================

Current pixel resolution: 1920x1015
Refresh rate: 60
SDL reports: 92.5389x92.6757 dots per inch.

Installed add-ons
=================

After_the_Storm : 0.10.0-dev
AtS_Music : 0.3.1
IftU_Music : 0.3.1
Invasion_from_the_Unknown : 2.1.1+dev
Millennium_Era : 1.2.1.0
Wings_of_Valor : 2.0.0
World_Conquest_II : 0.7.10.3
```

→

```
Current video settings
======================

Window size:             1610x794
Screen refresh rate:     60
Screen dots per inch:    92.538902x92.675674
Screen dpi scale factor: 0.963947x0.965372

Installed add-ons
=================

Creep_War_Dev: 1.5.8
pick_advance:  1.11.0
```"
432743953,"Changes description of ""righteous rage""",123chess456,2020-06-10 22:59:22+00:00,2020-06-14 16:54:54+00:00,{},"In Under the Burning Sun scenario 3, Garak is given the ability ""righteous rage"" on both of his attacks. This effectively makes those attacks behave the same as berserk when Garak is fighting an enemy ""champion"", i.e. two undead units named Grak and Zur. I believe this was unclear and raised #4945 because I didn't understand that this ability only applies to fights against Grak and Zur, so I've made this PR to hopefully make the description a little clearer. "
432179487,Add installed addons and addon versions to the build report.,Pentarctagon,2020-06-10 03:34:33+00:00,2020-06-10 23:47:27+00:00,{},"This would be useful since often one of the things asked when a user reports issues is if they have any addons installed.

---

Tested locally with two addons (first with an _info.cfg, second with a _server.pbl):
```
Installed Add-ons
=================

Ally_Village_Modification : 1.0.3
Ally_Village_Modification_pbl : 0.1.80
```

If there are no issues, I'd like to get this merged and backported prior to 1.14.13's release.

Edit-
Fixes #4873 as well."
430332608,Make the fix for #4730 more targetted.,Pentarctagon,2020-06-07 19:52:52+00:00,2020-06-08 17:38:44+00:00,{},Fixes #4936 by only adding the timestamp to the replay's filename rather than *all* save filenames.
429396750,Ancient Stone masonry,doofus-01,2020-06-06 19:32:55+00:00,2020-06-07 22:51:17+00:00,"{'Ready for testing': 1, 'Graphics': 1, 'Terrain': 1}","I was going through UtBS campaign, it occurred to me some ancient/weathered stone floor and wall terrains could make a nice addition.

Terrain - ""Ias"" - stone floor variation
Also plan to put an ancient stone wall variation in here, but just the floor for now.

![Screenshot_20200606](https://user-images.githubusercontent.com/13510196/83952941-73cd1b00-a7f1-11ea-82aa-1fe4f835a0b1.jpg)
"
429139207,UtBS - some minor polishing,doofus-01,2020-06-06 11:19:52+00:00,2020-06-07 22:54:30+00:00,"{'Ready for testing': 1, 'Campaign (any)': 1, 'Low Priority': 1}","Minor map edits, unit placement edits, and polish for scenarios 4 and 5. "
426622963,Add the ability to output preprocessed WML as XML.,Pentarctagon,2020-06-02 14:28:03+00:00,2020-06-02 17:08:05+00:00,{},"This commit:
* Renames config's debug() method to as_text() to be more descriptive.
* Adds two as_xml methods to config.
* Also writes the XML out when using the --preprocess command line option."
426130685,Fix [filter_weapon] that doesn't work in filter_opponent,newfrenchy83,2020-06-01 18:00:03+00:00,2020-06-02 19:53:54+00:00,{},"@gfgtdf without other_attack_ in special_active_impl, the opponent's attacks cannot be filtered and the use of filter_weapon filter_opponent always returns a null result."
425552409,core - terrain - dwarf castle and tall encampment keep transition fixes,doofus-01,2020-05-31 02:56:47+00:00,2020-05-31 20:21:46+00:00,"{'Bug': 1, 'Ready for testing': 1, 'Graphics': 1, 'Terrain': 1}","fixes #4923 
@Earth-Cake or anyone willing to test- if you don't want to bother with testing a PR, it's easy enough to modify the `core/terrain-graphics.cfg` file manually and test."
425271259,don't hardcode plague contraint,gfgtdf,2020-05-29 18:56:46+00:00,2021-09-06 16:56:11+00:00,{'Units': 1},"as the title says.

There is no reason why we should have the 'plague doesn't work on villages' restruction encoded into the cpp engine

This is not really a priority of mine i justfound this weird when looking at the c++ code"
425268445,attack code fixes,gfgtdf,2020-05-29 18:50:05+00:00,2022-06-27 18:04:51+00:00,"{'WML': 1, 'Units': 1}","wml code that changes the number of strikes during an attack should now work properly.
In particular this fixes an segfault reported on the forum when attacks were removed during an event.

I have to think about it first, whether this is really a good idea, because it also changes when the number of strikes is calcualted."
422971463,Append the timestamp to the save/replay file name.,Pentarctagon,2020-05-26 03:49:43+00:00,2020-05-27 18:08:55+00:00,{},
422531513,UtBS - units - sprites for Tauroch Rider line,doofus-01,2020-05-25 03:53:56+00:00,2020-05-31 20:23:35+00:00,"{'Ready for testing': 1, 'Campaign (any)': 1, 'Graphics': 1, 'Units': 1}","Jetrel's Quenoth Tauroch riders were unfinished, and have been that way for a while.  This PR aims to finalize the base sprites without radically changing the design, and then at the very least get defense animations done.

For first commit, it's just the rider and stalwart line."
422459423,add lua_function in side filters,gfgtdf,2020-05-24 19:36:22+00:00,2020-05-24 20:50:15+00:00,{},"Im not 100% sure whether its better to pass a side object or the number...

anyways will merge myself, mostly created this pr for the travis check.  "
422365053,Scale buttons and toggle buttons with screen pitch also.,gwhitney,2020-05-24 05:15:22+00:00,2020-05-26 21:20:54+00:00,{},"This is a follow-on to PR #4860 -- it extends the scaling initiated in that PR to most of the buttons and toggle buttons in the game. Somewhat mysteriously, the ""Menu,"" ""Actions,"", and ""End Turn"" buttons in the main gameplay window are still not scaling. Hopefully that can be tracked down in the future."
422342064,Add current video settings to the game_config::full_build_report.,gwhitney,2020-05-23 23:56:28+00:00,2020-05-24 14:49:37+00:00,{},As requested by Pentarctagon in #4911.
421882913,add weapon abilities in unit_type analysis for simulation,newfrenchy83,2020-05-22 12:05:12+00:00,2021-08-01 18:07:20+00:00,{'AI': 1},This changes must be add abilities like UtBs formation to be added in unit_type simulation but not the 'aura' abilities(Httt initiative).
421880359,"add ""damage"" ability in damage calculation window(UI)",newfrenchy83,2020-05-22 11:58:54+00:00,2020-05-28 18:43:46+00:00,{},"In damage calculation window, the ""damage"" weapons specials were used in calculation but not the abilities equivalent."
421416809,Fix divide by zero when SDL can't get DPI for scale factor.,fluffbeast,2020-05-21 15:25:49+00:00,2020-05-21 19:29:30+00:00,{},"SDL_GetDisplayDPI  returns zero if it can't determine the DPI scale factor.

This fix will fall back to a 1.0 scale factor instead of dividing by zero when this happens."
421177631,Work around issue #4908.,gwhitney,2020-05-21 06:34:04+00:00,2020-05-21 09:23:25+00:00,{},"PR #4860 scales fonts by the observed screen pitch in microns when the main window is 1200x900 or larger. However, it seems based on the issue report #4908 that in some cases, the reported pixel pitch is not correct, and the scaling was shrinking fonts intolerably. This PR ensures that the scaling will never decrease font sizes, although it does not address why or under what circumstances the screen_pitch_microns may be incorrect."
421164282,Fix issue #4909.,gwhitney,2020-05-21 05:51:26+00:00,2020-05-22 18:33:20+00:00,{'Graphics': 1},"As Pentarctagon suggested, before PR #4851 the lower resolutions of the default theme were still calculating off of a base resolution of 1024x768. After PR #4851, they were calculating off of their specified resolutions. This is more sensible, but given the scaling code and the old theme specification, could cause the main map to disappear via a bug complementary to the one that PR #4851 fixed (that the main map was disappearing when the resolutions were *too high*). This PR tweaks the rescaling to handle these cases when the screen resolution is small, and tweaks the definition of the 800x600 resolution of the default theme to specify the main map at a reasonable size for that resolution (formerly it was specified as larger than the screen (!) which was only working due to the quirks of location and size scaling). "
419204931,UtBS - units - Replacing inconsistent Dark Assassin unit/sprite data,doofus-01,2020-05-18 00:57:10+00:00,2020-05-24 05:38:07+00:00,"{'Campaign (any)': 1, 'Graphics': 1}","#4875 and #4879 mention the inconsistency of the Dark Assassin, seems like a placeholder that was never updated.  This PR is to address that.

Just base sprite for now, but I plan to (minimally) animate the new unit and wire into the relevant scenarios."
419176741,[WIP] add World Conquest II to mainline,gfgtdf,2020-05-17 21:28:17+00:00,2020-08-19 20:22:15+00:00,{'MP': 1},"See Also https://github.com/wesnoth/wesnoth/issues/4895 for the issue, 

This is not done yet things to do:


1. Check which terrains we really want in mainline and remove the yz letters in them. DONE
2. Maybe fix https://github.com/wesnoth/wesnoth/issues/4894 LATER
3. Make sure it translates well. (in particular make sure there is no strings appear in hosts language bug) DONE
4. Maybe mainline the ""step on item"" event. LATER?
5. Run optiong over the images before merging  them. DONE
6. It probably has some unused strings in the cfg files FIXED

There is also some space left for improvement for things that shodul better be done after its merged:

1. Improve the random names generator
 
What i am currently wondering is: this addon used the 1.10 tropical forest terrain because the original author says it looks better near wamt or just for soem variation, but it feels wrong to readd a deleted terrain back to wesnoth, any opinion on how to handle this?"
415708136,Fixed a bug with rezising in the recall unit window,RFeuerhack,2020-05-10 11:44:21+00:00,2022-02-18 06:00:59+00:00,{'UI': 1},"As described in issue #4877 sometimes the recall unit window would layer on top of another one after dismissing a unit. I noticed that only happens if you dismiss a unit that you aren't asked whether you are sure to dismiss said unit. by adding a else case and always asking if the user is sure to dismiss the unit I fixed that problem. I'm not sure if that is the best solution for this problem, but so far I haven't come up with a better fix."
415692424,Add 2p - Minervan Gate map and scenario,a-nop,2020-05-10 09:21:44+00:00,2020-05-11 22:32:02+00:00,"{""Won't fix"": 1}","This map is [discussed in a forum thread](https://forums.wesnoth.org/viewtopic.php?f=15&t=52475).

I've created a scenario based on the other maps.  I added localizations for English only, assuming there is some automation to generate the rest?"
415438416,Add additional translations steps for cmake to travis.,Pentarctagon,2020-05-08 21:19:25+00:00,2020-05-08 21:19:31+00:00,{},
413455560,"Add comments about minimap.cpp's use of ""team colors""",stevecotton,2020-05-05 11:23:28+00:00,2020-05-07 13:12:36+00:00,{},"A comment-only change, opening as a PR because I'm still wondering whether to
make it a code-change as well. Maybe the ""team_rgb_range"" should be renamed as ""named_color_range"", because
it's used for everything defined by the WML `[color_range]` tag. In addition to
the ones normally used for teams (`red`, `lightblue`, etc) it has the minimap
colors for `reef`, `cave`, etc.

Separating the team colors from the terrain colors probably shouldn't be done.
Looking from the opposite perspective, using the terrain colors as team colors
has been discussed on the forums and found to be a useful feature:

* https://r.wesnoth.org/p627592
* https://r.wesnoth.org/p627588"
412674702,Fixes for clang warnings for Ubuntu 20.04,Pentarctagon,2020-05-03 22:08:08+00:00,2020-05-04 03:46:20+00:00,{},"The first commit changes two uses of `python` -> `python3`, since 20.04 doesn't come with the `python` link by default.

Clang fix for `-Wdeprecated-copy` adds a copy constructor due to it warning about having an assignment operator defined but no copy constructor defined is deprecated.

Clang fix `-Wstring-plus-int` silences a warning from the lua source code stating that `<string> + <int>` does nothing.  This sounds... incorrect, but the lua code isn't ours and it doesn't seem to be breaking anything.

Everything else is for `-Wrange-loop-construct` warnings."
412645582,Announcements and mariadbpp,Pentarctagon,2020-05-03 18:31:56+00:00,2020-07-30 18:17:24+00:00,"{'MP Lobby': 1, 'Network': 1}",Moved from #4867 since it will be a bit until this can be merged.
412258761,Sceptre of Fire: bug fixes and small tweaks to dialogue,IskarJarak,2020-05-01 19:06:07+00:00,2020-05-20 20:51:38+00:00,{'Campaign (any)': 1},"I was previously asked to do one commit per file, they can be squashed for a merge.

I have added a macro to clear to rune variables added by @doofus-01 to `utils/rune-equip` and applied it to all scenarios where the player can buy runes.

Small dialogue tweaks were done for scenarios 1, 2t, 3, 5, and epilogue. This includes changing all mentions of ""tribe"" to ""clan"".

S8 map was slightly changed to keep the dragon from suiciding into the AI ulfserkers, which was actually not that improbable before and resulted in none of his dialogue lines triggering (and a scenario named ""The Dragon"" with no sign of a dragon whatsoever from the players perspective)."
411589368,fix inversion of [filter_weapon] and [filter_second_weapon] for anima…,newfrenchy83,2020-04-30 14:50:08+00:00,2020-05-17 17:40:52+00:00,{'WML': 1},"…tion

i forgeted to inverse value for animation"
409493919,New Poacher & Trapper (ranged) Sprites/Animations,ghype,2020-04-27 13:15:50+00:00,2020-05-24 00:55:21+00:00,"{'Graphics': 1, 'Units': 1}","This are [Jetrel's new base sprites](https://www.wesnoth.org/jetrel/Wesnoth/trapper-line.png) I started animating.

**What I have done:**
- animations as seen below
- adjusted the naming system as the current for the poacher/trapper was just so confusing
- adjusted the codes
- replaced the missing animations with base frames. melee animations soon to follow


Remaining animations/codes soon to follow.

**Poacher**
- [x] ranged attack
- [x] ranged defense

![Poacher-Ranged-Animtaiton-9](https://user-images.githubusercontent.com/38769187/80538075-5fe9fa00-89a5-11ea-871e-a2fdcf22325f.gif)

**Trapper**
- [x] trapper ranged attack
- [x] trapper ranged defense

![_trapper-bow-attack+defense-3](https://user-images.githubusercontent.com/38769187/80538037-4fd21a80-89a5-11ea-8c10-e6e2d80f64c1.gif)

EDIT:
I decided to public this PR as it is without the melee animations for the Poacher and Trapper as I will make a new PR for that one. I have some animations for that already, but will need some more feedback before I commit them
"
408915455,"add ""damage"" ability in damage calculation window and to AI analysis of battle",newfrenchy83,2020-04-25 14:22:47+00:00,2020-05-22 12:05:42+00:00,{'UI': 1},"In damage calculation window, the ""damage"" weapons specials were used in calculation but not the abilities equivalent. For the AI analysis and statistics_dialog, i don't know if it will be change."
408697754,fix segfault in abilities.cpp in using commit of @gfgtdf,newfrenchy83,2020-04-24 18:20:01+00:00,2020-04-25 20:05:13+00:00,{},"copy the https://github.com/gfgtdf/wesnoth/commit/d3ad23f5f8198661271ea2dbc8c716387a694ac1 commit of @gfgtdf for resolve https://github.com/wesnoth/wesnoth/issues/4862 minus the ifdef 0 loop because i don't like the idea to remove the if(self/other == nullptr) {
loop, else this is fine for me"
408024254,Move most of the motd into its own window/button,Pentarctagon,2020-04-23 16:12:01+00:00,2020-05-03 18:32:03+00:00,{'MP Lobby': 1},"Also prevents the motd from being displayed to the user every time they log out then log back in.

The Windows and macOS jobs will of course fail, as this adds a new source file.

I'm not sure about the boost unit tests, though.  I added it to the omitted list of widgets since there's quite a few there already and I don't know what would need to be done to add it, but ideally it would be included in the tests.

Beyond that, the relevant information is in the commit message.

---

The window and buttons on screens larger than 800x600:

![buttons-not-800x600](https://user-images.githubusercontent.com/3030250/80121448-ee97ea80-8551-11ea-97c0-1e8793e3ea41.png)
![window-not-800x600](https://user-images.githubusercontent.com/3030250/80121461-f192db00-8551-11ea-9a2f-075887b8d2e3.png)
---

And on screens that are 800x600:

![buttons-800x600](https://user-images.githubusercontent.com/3030250/80121468-f48dcb80-8551-11ea-9749-c7b70e9bc4f3.png)
![window-800x600](https://user-images.githubusercontent.com/3030250/80121477-f6578f00-8551-11ea-9f80-77d9f9c330fd.png)
"
406355552,fixUtBS - Segfault in The Morning After (in vicinity of recent abilities code),newfrenchy83,2020-04-20 23:26:52+00:00,2020-04-21 08:56:54+00:00,{},this is a fix of https://github.com/wesnoth/wesnoth/issues/4862
406335279," revert simplify cpp code in abilitie.cpp fix UtBS - Segfault in The Morning After bug,engine high priority",newfrenchy83,2020-04-20 22:26:58+00:00,2020-04-24 18:20:56+00:00,{},it is a try to fix https://github.com/wesnoth/wesnoth/issues/4862
405853948,Gui2 font scaling,gwhitney,2020-04-20 06:25:57+00:00,2020-05-16 20:01:02+00:00,{'UI': 1},"This is pull request is independent of, but related to, #4851. That one addresses the fonts and layout controlled by the theme. This one allows for, and implements, the ability to scale the text font size and layout of GUI2 visual elements according to the screen pixel pitch. Specifically, over 1200x900 pixel dimensions, text_font_size is computed proportional to the pixel pitch. Also certain dialogs are allowed to take up a certain fraction of the screen size, rather than be limited to a numerically fixed number of pixels high or wide. The primary mechanism for facilitating these scalings is to allow the values for the keys text_font_size, maximum_width, and maximum_height to be formulas rather than just numerical constants. In addition, the SDL pixel pitch is exposed in the variable screen_pitch_microns, within GUI2."
405695690,Real ranged attacks,lipk,2020-04-19 16:46:52+00:00,2022-07-30 05:35:59+00:00,{'Engine': 1},"Reintroduce real ranged attacks to Wesnoth.

[Forum thread](https://forums.wesnoth.org/viewtopic.php?f=12&p=654394#p654394)

What the PR does:
* Allows targeting enemies from multiple tiles away
* Applies distance-based penalties to hit chance and damage of a weapon
* Exposes penalties and ranges to WML and Lua
* Displays information about ranged attacks on the unit's help page

Necessary actions after this PR is merged:
- [ ] Update UnitTypeWML docs with new weapon attributes
- [ ] Update FilterWML docs with new weapon filters
- [ ] Update EffectWML docs with new weapon modifiers

I believe this is a viable minimal implementation and can be merged back to allow content creators to experiment. Nonetheless, there are a couple more things that need to be done before this feature can be deemed ready.

TODO:
* Proper animation support for multihex attacks
* Make the AI aware of real ranged attacks

Things that may need further consideration:
* How the new information is displayed on the help page 
* Visual aid to indicate which units will be in range when moving to a certain tile
* Different attack marker for ranged attacks"
405518269,Add a new attribute that checks calls special_bool for weapon specials abilities were filtered like weapon specials,newfrenchy83,2020-04-18 15:47:41+00:00,2020-08-10 11:45:44+00:00,{'WML': 1},This PR resolves https://github.com/wesnoth/wesnoth/issues/4840 by adding two new attributes to [filter_weapon] for special weapons implemented in [abilities] is also filtered.
405469375,NR S5a: fix issue #4853 naga triggers door,IskarJarak,2020-04-18 09:02:27+00:00,2020-04-18 10:08:40+00:00,{},"Small fix for issue #4853 .

Edit: Should probably be backported to 1.14 as well."
403962323,Allow theme resolutions based on an arbitrary base resolution.,gwhitney,2020-04-15 20:04:04+00:00,2020-05-16 20:00:49+00:00,{'UI': 1},"  Prior to this change, the 1024x768 base resolution (found in the default theme)
  was hard-coded into theme.cpp; resolutions beyond that were always scaled as if they
  had been defined on a 1024x768 base resolution, even if the width and height specified
  in the theme file were different. Combined with the scaling arithmetic in theme.cpp,
  this assumption resulted in bugs such as panels disappearing whenever their width in the
  base resolution specified in the theme exceeded 1024 pixels or their height exceeded 768
  pixels. This change records the base resolution from the theme in the theme and all of
  its objects, so the scaling computation can be done correctly.

This change would resolve issue #4850 -- see also the prototype high res theme posted at http://forums.wesnoth.org/viewtopic.php?p=654226#p654226
 "
403339683,simplify code for ability used like weapon,newfrenchy83,2020-04-14 18:16:36+00:00,2020-04-17 21:40:36+00:00,{},the use to special_active in attack_type::list_ability permit me to remove the static functions and to simplify the engine.
402634713,Update base terrain for deprecated *^Uf*,leonardoInf,2020-04-13 13:03:39+00:00,2020-04-24 01:38:04+00:00,{},I mistakingly deleted my fork so I had to open this PR instead of https://github.com/wesnoth/wesnoth/pull/4838.
401188847,Backport of cba53cd471e1b4bb44b2a57d477cf3401422219c,Pentarctagon,2020-04-09 03:35:49+00:00,2020-04-10 13:58:10+00:00,{},"Since it seems that the 64-bit enabled projectfiles for Visual Studio were added without also being tested that they generate a working executable.

---

Related: https://forums.wesnoth.org/viewtopic.php?p=653865#p653865"
401179588,"SotBE S15: Check if Kapou'e is at 1,18 when killing last boss",UnwiseOwl,2020-04-09 02:58:17+00:00,2020-04-09 03:04:15+00:00,{},Fix for #4841
398641919,Update base terrain for deprecated ^Uf,leonardoInf,2020-04-04 17:08:46+00:00,2020-04-13 13:04:11+00:00,{'Terrain': 1},"In project [Mushroom](https://github.com/wesnoth/wesnoth/projects/5]) it is a Todo to update the base terrain for the deprecated ^Uf mushrooms to align it with the behavior of the newer Tb^Tf terrain. The transition has been updated too.

This fixes https://github.com/wesnoth/wesnoth/issues/4798."
397911294,Separate unit test results from scenario victory/defeat.,Pentarctagon,2020-04-03 03:13:09+00:00,2020-04-07 21:45:35+00:00,{},"This adds an additional `test_result` attribute to [endlevel], intended for use with the automated unit tests. This allows for the unit tests to differentiate a pass/fail result separately from scenario victory or defeat, which allows for more accurately determining the outcome of a test as well as addresses the potential, for example, for a scenario to be expect to pass because of the {SUCCEED} macro but instead passes because the scenario ended as a victory through some other method.

Additional unit tests which were the original motivation for this change are also added as part of this.  They test, as much as possible, that events are executed at all, and are then also executed in the expected order."
396568749,Some balance,Hejnewar,2020-03-31 20:03:28+00:00,2020-04-05 21:03:22+00:00,{'Units': 1},"Changes:
Dragonguard hp changed from 59 to 63.
Bone Shooter hp changed from 40 to 42.
Banebow hp changed form 50 to 52.

Many adjustments for Falconer and Sky Hunter. 
Falconer added to AoH as recruitable unit.
Diversion changed from 15 to 20%. "
395851556,wip add student variable to ability formulas,gfgtdf,2020-03-30 19:28:50+00:00,2020-04-18 22:29:05+00:00,{'Units': 1},"This can be different from 'other' in case of a
an ability that effects the enemy, where 'other'
should be the unit that receives the effect
(here: the enemy), studend is the unit that
matches the [affect_adjacent], and the unnamed
unit is the unit that has the ability.

I think it'd be nice to have even more variables
available so that for example the effect could
depend on the opponent even when it doesn't
effect the opponent."
395415732,Add Calendar to Wesnoth encyclopedia,nemaara,2020-03-30 05:31:55+00:00,2020-04-02 18:07:51+00:00,{'Help': 1},"For #4822, I may look at adding a small tidbit about each month later."
395188484,Adjust travis uploads,Pentarctagon,2020-03-29 03:09:28+00:00,2020-03-29 03:09:34+00:00,{},
394816276,HttT S23: change misleading dialogue,IskarJarak,2020-03-27 15:22:11+00:00,2020-03-27 17:23:53+00:00,{},"Change a misleading word because of some confusion that came up on Discord.

(Someone actually tried to kill all horse lords with Konrad personally)."
393174210,Add scripts to pull various pieces of information from the MP database.,Pentarctagon,2020-03-24 18:11:39+00:00,2020-03-26 19:54:54+00:00,"{'MP': 1, 'Add-ons': 1}","The intent being that I plan to run these once a month and post the results on the forum.

---

Attached are the results from the previous month(Feb 2020).
[MP-Activity-Report-Feb-2020-2.xlsx](https://github.com/wesnoth/wesnoth/files/4378105/MP-Activity-Report-Feb-2020-2.xlsx)

I plan to merge this probably by Thursday or Friday and post these to the forums then, assuming no one finds any errors in the SQL queries."
392104096,Add the VS2019 Debug configuration job to travis.,Pentarctagon,2020-03-23 00:53:57+00:00,2020-03-23 00:54:03+00:00,{},
392103949,More Dunefolk sprite work,doofus-01,2020-03-23 00:52:54+00:00,2020-04-05 02:14:50+00:00,"{'In-progress': 1, 'Graphics': 1, 'Units': 1}","Nothing ambitious here, just some sprite work."
390650804,Improve log messages,soliton-,2020-03-18 20:34:44+00:00,2020-03-19 03:26:25+00:00,{},"Commit 702a98d accidentally put the campaign size on its own line. This commit
prints the complete log message only if the campaign is actually sent out.

No changes in program logic. Just an early return added to reduce indentation."
390621106,Remove obsolete includes,soliton-,2020-03-18 19:22:48+00:00,2020-03-18 20:46:31+00:00,{},
390562404,Add help text for the ping command,soliton-,2020-03-18 17:13:19+00:00,2020-03-18 19:23:59+00:00,{},Fixes #2487.
390481911,Add Release VS2019 job to travis.,Pentarctagon,2020-03-18 14:49:56+00:00,2020-03-20 21:07:19+00:00,{},"The first run of the 2019 jobs will fail, since that run will be used to build and cache the vcpkg dependencies - there's no way to get enough time to build wesnoth and build the dependencies in a single job.

---

Debug job will be added as well once I can get the linking to work."
389232307, fix cb projecfile after #4797,newfrenchy83,2020-03-16 13:23:18+00:00,2020-03-16 13:31:27+00:00,{},
388913801,Fix the MP Create Dialog's handling of unplayable maps (1.14 branch),stevecotton,2020-03-16 01:27:03+00:00,2020-03-16 02:12:40+00:00,"{'Bug': 1, 'MP': 1, 'Engine': 1}","The UX seems to already be prepared for this - if the map doesn't load then
the create_engine class puts an error message in the map description, which
is shown on the top-left of the MP Create Dialog when the map is selected.

Fixes bugs #3149, #4395 and #4545.  The block deleted in this commit skipped
adding an entry to the games_list listbox, which broke assumptions elsewhere
that the indices returned by create_game_.get_filtered_level_indices()
correspond to the indices in the listbox."
388912941,Fix the MP Create Dialog's handling of unplayable maps,stevecotton,2020-03-16 01:24:55+00:00,2020-03-16 02:12:26+00:00,"{'Bug': 1, 'MP': 1, 'Engine': 1}","The UX seems to already be prepared for this - if the map doesn't load then
the create_engine class puts an error message in the map description, which
is shown on the top-left of the MP Create Dialog when the map is selected.

Fixes bugs #3149, #4395 and #4545.  The block deleted in this commit skipped
adding an entry to the games_list listbox, which broke assumptions elsewhere
that the indices returned by create_game_.get_filtered_level_indices()
correspond to the indices in the listbox."
388581716,Also log the db_id.,Pentarctagon,2020-03-15 05:34:39+00:00,2020-03-15 05:34:48+00:00,{},
388561378,Use the vcvarsall bat script.,Pentarctagon,2020-03-15 04:20:07+00:00,2020-03-15 04:20:13+00:00,{},
388391266,support scenario files in map_file,gfgtdf,2020-03-14 18:21:48+00:00,2020-03-15 12:24:27+00:00,{'Engine': 1},"Now a scenario generated by teh scenario editor can be loaded
just like a simple map file
fixes #4803"
388148323,gui2/addon_manager: Re-read add-on versions after each update batch,irydacea,2020-03-14 04:21:54+00:00,2020-03-15 08:33:18+00:00,"{'Bug': 1, 'UI': 1, 'Add-ons': 1}","The Update All codepath is unique in that it doesn't trigger a re-read of add-on versions until the very end, once the full run has completed. The problem with this is that `install_addon_with_checks()` may update dependencies of individual add-ons in the process, resulting in redundant downloads of any affected add-ons if the player isn't paying attention.

Address this by triggering a re-read of add-on versions after every single update batch that results in a download.

Closes #3273.

Needs to be backported to 1.14 as well."
387497527,Misc travis fixes,Pentarctagon,2020-03-12 22:06:07+00:00,2020-03-12 22:06:13+00:00,{},
386343040,add wesnoth.colors,gfgtdf,2020-03-10 20:16:30+00:00,2020-03-15 23:29:59+00:00,{'Lua API': 1},"see https://github.com/wesnoth/wesnoth/issues/3706

the main usecase to be able to print messages and dialog labels in the color of a specific team.
Im still not 100% sure about the exact interface thougfh"
385236681,Small fix to troll race description,IskarJarak,2020-03-08 07:33:18+00:00,2020-03-08 07:52:56+00:00,"{'Prose': 1, 'Help': 1}","Edit: oops, forgot description; only fixing a missing word."
385205531,remove [advancefrom] from mainline,gfgtdf,2020-03-07 23:37:53+00:00,2020-03-12 18:15:19+00:00,{'WML': 1},"See issue #3955
the intention is to deprecate [advancefrom] in
favour of [modify_unit_type], because it was a
common source of OOS errors, and it is less flexible.

As a secondary effect this also fixes issue #4402 :
""changing units via extra_defines sometimes not working
because extra_defines had bugs"".
Now we no longer use extra_defines for that.

Addon authors should now no longer use these extra_defines,
instead put the new core marcos with the same name directly
into [campaign]."
385041216,UtBS S1: Use undead camp,UnwiseOwl,2020-03-06 22:02:29+00:00,2020-03-07 01:59:20+00:00,{},"There's nothing to update in WoV, and making any changes to MP maps, even cosmetic, feels like a can of worms that I do not want to open, so this concludes my changes for #4121 ."
384797863,SoTBE: New terrains,UnwiseOwl,2020-03-06 12:33:21+00:00,2020-03-06 17:27:49+00:00,{},"Adding troll camps to S3 and S14, and undead camp to S5.
This is further progress on #4121 

Note: S14 was recently changed but my fork is not up to date. I think I've done this commit right but it's possible that I've goofed it."
384296655,Add new terrains to TRoW and LoW,UnwiseOwl,2020-03-05 14:08:35+00:00,2020-03-05 14:25:37+00:00,"{'Campaign (any)': 1, 'Terrain': 1}","Further progress on #4121.

L, THoT, TRoW and LoW can now be ticked off."
384026926,Small typo fixes Diviner and Sicarius,IskarJarak,2020-03-05 02:05:57+00:00,2020-03-05 02:35:53+00:00,{'Units': 1},"The Sicarius unit can be female as well, so I changed the description from male to neutral wording, but I'm not sure if that works stylistically. Otherwise change it to plural?

The whole description should probably get an overhaul at a later date anyway..."
383555581,Fix the occasional mp unit tests travis failure.,Pentarctagon,2020-03-04 13:28:53+00:00,2020-03-04 13:29:01+00:00,{},"Probably could be written more succinctly, but should work."
382935358,Use new terrains in campaigns (#4121) - WIP,UnwiseOwl,2020-03-03 12:56:02+00:00,2020-03-04 17:38:50+00:00,"{'Campaign (any)': 1, 'Terrain': 1}","Response to #4121 
AToTB, Liberty and EI done so far.
No changes needed in HoT."
382562675,New Xcode README.md steps,hrubymar10,2020-03-02 19:23:11+00:00,2020-03-07 12:52:51+00:00,{'macOS': 1},All described steps are accurate. I only ask native speakers to correct my english please. Thank you
382387550,A couple travis VS tweaks/fixes,Pentarctagon,2020-03-02 13:35:02+00:00,2020-03-02 13:35:11+00:00,{},
382178431,Units - Dunefolk - Falconer branch of Skirmisher line,doofus-01,2020-03-02 05:16:03+00:00,2020-03-24 00:59:54+00:00,"{'Enhancement': 1, 'Ready for testing': 1, 'Graphics': 1, 'Units': 1}","First draft, not even close to being ready.  Mostly just planting a flag in the ground for now.
EDIT: Relevant forum thread: https://forums.wesnoth.org/viewtopic.php?p=652466#p652466"
381986344,SoF - Replace S1 map,doofus-01,2020-03-01 03:20:37+00:00,2020-03-19 03:45:16+00:00,"{'Enhancement': 1, 'In-progress': 1, 'Campaign (any)': 1}","Map is now smaller, does not have a long slog of moving caravans and nothing else.  Otherwise, I think it's the same scenario, the story isn't really changed. ...except for the next scenario, which can currently start with the two leaders shouting at each other while facing away, like spatting lovers.

I have a replay attached.  I think it's better than the current version, but still needs some adjustments.
[SoF-A Bargain is Struck replay.gz](https://github.com/wesnoth/wesnoth/files/4271276/SoF-A.Bargain.is.Struck.replay.gz)
"
381945502,Fix instances of multiple [avoid]s in [side]s,UnwiseOwl,2020-02-29 21:13:44+00:00,2020-02-29 23:35:25+00:00,{'Campaign (any)': 1},
381864962,Minor fixes for DM,UnwiseOwl,2020-02-29 15:14:42+00:00,2020-03-14 18:03:58+00:00,{'Campaign (any)': 1},Responds to issues raised in #4614 mostly through dialogue changes
381847078,gitignore data/**/layered_WIP_files,doofus-01,2020-02-29 12:59:54+00:00,2020-02-29 13:44:31+00:00,{},"I'm reluctant to touch a file like this one, but this would make life a little bit simpler."
381631513,Changes to dehydration (UtBS 2),UnwiseOwl,2020-02-28 22:45:37+00:00,2020-02-29 19:59:14+00:00,{'Campaign (any)': 1},"Fixes for issues raised in #4206 in two commits.
Part one, which I think is fine, prevents sun shyde from dehydrating herself by changing the dehydration macro.
Part two, which may change both the feel and the difficulty of the level but brings it into line with the current story text, makes dehydration only affect the player side."
381543133,Beserker teamcolor fix,UnwiseOwl,2020-02-28 18:58:05+00:00,2020-02-29 19:44:22+00:00,{'Units': 1},Fixes #4252
381509624,Make debug builds instead of -O0 builds.,Pentarctagon,2020-02-28 17:34:56+00:00,2020-02-28 17:35:05+00:00,{},"Rename OPT -> CFG.
Rename LTS -> IMAGE.
Reorder travis jobs."
380215827,Wyverns and other units,Hejnewar,2020-02-26 12:31:27+00:00,2020-03-24 02:43:52+00:00,{'Units': 1},"Changes:
Falcon, Elder falcon, Roc - changed charge attack into ""blade - claws"" and normal attack into ""pierce - beak"" 
Reason - birds do not attack while descending from skies with their beak. They use claws for that because if thier beak gets broken they can eat anymore.

Wild Wyvern and Wyvern Rider - overhaul of statistics. 

Roc - Decreased hp from 56 to 44, charge attack damage from 12 to 10 and cost from 45 to 36. This unit was just looking too strong for me on level 2. No as strong as Jinni looks but I decided to not touch him for now because I dont have clear vision for this unit. 

Next thing that I would like to talk about are descriptions that are missing for Wild Wyvern, Wyvern Rider and Roc. During times of dunefolk rework I created some lore for Wyverns and Rocs thus I want to show it here in shorter fashion and ask if you like it. If yes I would try to write something for their descriptions (I'm not good at that but I guess it could be helpful for someone better). If not I would like to try to improve what is here and do that then. 

Rocs:
-Are smart enough to comunicate.
-They hunt in packs or alone depending on type of prey present.
-Smallest prey would be around size of small deer.
-They even hunt wyverns if they are in pack and target is isolated.
-They don't appear much on deserts.
-Their favorite nesting terrain are mountains, they appear a lot in hilly regions.
-They can even threaten not well protected caravans.

Wyverns:
-They are omnivores.
-Females and males live in separation for most of the time.
-Males are tasked with protection of females within thier territory, if females are not protected well enough they will go to other male.
-Females try to scare their opponents and if that doesn't work they prefer to run instead of fighting. They only fight when they have no other choice, need to protect eggs or feel safe (eg. when male wyvern or friendly humans are present), they still are very dangerous.
-Females mostly eat plants but they wouldn't refuse free meat and also hunt from time to time.
-Males eat meat and plants.
-Females and humans can live near eachother if humans are not perceived as threat (touching fertilized eggs or wyverns if they don't do that first is strictly forbidden).
-Males and humans are at best neutral, humans like to live within territory of wyverns mostly because many other threats are eliminated.
-If males had bad experiences with humans they can attack them instantly.

-Wyverns don't forget favors easily (eg. if you protected them they can stop male from attacking you) (optional) (good as plot point).
-There are many types of wyverns with various sizes eg. Wyverling - small wyvern born from eggs that weren't cared for, they adapt very well and dont need to eat as much, they usually travel in packs and help male wyvern protect his territory (optional - work intensive) (good for gameplay variety).

Wyvern Rider:
-It takes long time to tame wyvern.
-Being able to ride wyvern is sing of royality or family very trusted by them (if royality exists).
-Hatchlings are trained since very first day together with thier rider. 
-Riders can only ride thier wyvern, wyverns will carry only thier rider. 

This is basically how I imagine these units. Sorry for wall of text."
379818202,Use an independent ID for the database's GAME_ID column.,Pentarctagon,2020-02-25 21:42:23+00:00,2020-02-26 13:38:44+00:00,"{'MP': 1, 'Network': 1}","Currently, wesnothd uses the game instance's `id_` value when inserting into the game_info, game_player_info, and game_modification_info tables.  However, this value is unique only per game instance, not per scenario.  This then results in problems when handling MP campaigns, which re-use the same game instance for multiple scenarios.  Incrementing the game instance's `id_` was determined to not be suitable since it's used in a boost multi-index, and instead creating a brand new game instance for each scenario in an MP campaign is complex without being especially useful beyond this case.

This commit instead adds a separate `db_id_` value to each game instance, which can be incremented without causing any issues since it's used nowhere else, and is what will be inserted into the database.  This means the `db_id_` is unique per scenario, and therefore resolves the below two issues.

Fixes #4281
Fixes #4341"
378663856,Run the pre-release translation targets on travis.,Pentarctagon,2020-02-23 05:01:50+00:00,2020-02-25 02:45:08+00:00,{},"This will then catch errors on the commit it happens instead of usually much later.

---

Also removes the `--tty` and `unbuffer` command usage, since for some reason their presence causes `po4a-translate` to hang ([example](https://travis-ci.org/Pentarctagon/wesnoth/jobs/653932887#L15095-L15098) - in this case cancelled by me early, but this job has the `--verbose --debug` options enabled for it).

If anyone knows of a solution then great, otherwise I'll fully remove the logic for coloring the output since I think running the additional translation targets is more important."
378640251,fix leadership animation played when weapon don't matche [filter_weapon],newfrenchy83,2020-02-22 23:00:35+00:00,2020-04-04 19:30:35+00:00,{'Units': 1},"if a unit under leadership use a weapon don't matched with [leadership] [filter_(second_)weapon], then leader_anim of leader is played, or the attack not helped in that case, it musn't be like that."
378039361,Create macOS debug dmg image on travis.,Pentarctagon,2020-02-21 00:05:14+00:00,2020-02-22 04:20:09+00:00,{},"Also uploads it to SourceForge.  This is also set to be UDBZ(bzip2) rather than UDZO(zlib), since it shrinks the dmg size for 30-40 MBs.

---

There was also some discussion on Discord about changing the backgroundImage, so I'll wait for that to be decided before merging this."
377531009,Various macOS travis changes,Pentarctagon,2020-02-20 03:32:07+00:00,2020-02-20 03:32:14+00:00,{},
376297607,"proposed new resistances for Giant Scorpion, fix to SotBE 7",IskarJarak,2020-02-17 20:09:54+00:00,2020-02-23 23:17:25+00:00,"{'Campaign (any)': 1, 'Units': 1}","The addition of a variation for the Giant Scorpion and respective resistance change in #4015 left the unit with the uninspired values of standard humans.

I propose to change the resistances back to something more interesting that builds on their carapace (hard to hurt with normal blades, but you can crush or cook them). Note, that especially the impact resistances go in the _opposite_ direction of the Scuttle variation. Didn't want to overdo it, but I'd also be open to add +10% pierce resistance.

Also added a fix to SotBE scenario 7 to use the variation because scenario dialogue clearly talks about the old resistance values.


Edit: updated the commit with resistances as discussed below and according modifications to the unit description.
I pulled the changes to the Scuttler, because simply reducing the extremes of good ol' Mudcrawler resistances doesn't make it much better and doesn't help for scenarios currently balanced around it - might as well keep it as is, we have the standard Scorpion for a more realistic (and mundane) representation.

Edit: also fixed a continuity error between SotBE scenarios 5 and 9 (scenario 5 says: `Leaving most of his people at Barag Gór, Kapou’e, accompanied by the shamans and his warriors, set off to Tirigaz`) which I caught multiple times over the years but now have the means to remedy..."
375889302,"Changes UtBS 9 and Liberty 6,7,8",IskarJarak,2020-02-16 23:47:18+00:00,2020-02-17 02:30:41+00:00,{'Campaign (any)': 1},"Liberty scenario 6:
- added victory event when the player defeated all patrols
- this is to prevent the player having to end turn (for two sides) for a couple turns to wait for victory on _time over_.

UtBS scenario 9:
- fix a dialogue attribution error (if alive, Esanoo speaks of his imprisonment despite never being captured)
- add further merfolk dialogue attribution as flavor

Edit:
- Liberty scenario 7: fixed a small number error, added flavor text to the army arrivals.
- Liberty scenario 8: added a victory event (display credits and add laurel in campaign menu), small text adjustments"
375853335,Minor adjustments and typo fixes for Liberty scenarios 4 and 6,IskarJarak,2020-02-16 17:55:33+00:00,2020-02-16 20:50:38+00:00,{},"Scenario 4:
- prevented the enemy lieutenant from premature suiciding

Scenario 6:
- fixed a few typos; minor dialogue adjustments"
375841618,Upload .tar.bz2 from travis.,Pentarctagon,2020-02-16 15:56:40+00:00,2020-02-16 15:56:45+00:00,{},"While it can't be used currently, it's there and functioning in case that changes in the future."
375792088,Upload the debug output of the VS job.,Pentarctagon,2020-02-16 06:11:52+00:00,2020-02-16 11:27:11+00:00,{},
375194145,Create Windows installer on tag commits,Pentarctagon,2020-02-14 03:28:28+00:00,2020-02-16 00:41:02+00:00,{},This PR will upload a windows installer to https://sourceforge.net/projects/bfw-travis-upload/files/ along with the wesnoth and wesnothd executables that get uploaded with each commit.
375183544,Test run for request-pull workflow with small fixes,IskarJarak,2020-02-14 02:39:28+00:00,2020-02-14 02:41:59+00:00,{},"Fixed a continuity error in DW, and some typos in UtBS."
374618550,Resolve #4736 (XP always displayed in light blue),Wedge009,2020-02-13 01:06:46+00:00,2020-02-17 23:57:15+00:00,"{'Backport': 1, 'UI': 1}","Alternative to #4738, also resolves #4736 and also should be applicable to 1.14 branch. If one is accepted the other can be closed.

This one avoids the performance concerns of #4738 but retains the problem of hard-coded colour values."
374578973,Deprecate using [set_specials] without specifying mode=,stevecotton,2020-02-12 22:48:36+00:00,2020-02-15 20:41:48+00:00,"{'WML': 1, 'Units': 1}","This will show a warning for bugs similar to the UtBS one that
was fixed in 74ad400900eb5264b0485e9f84b90c968c1aba77."
374034848,Avoid hard-coding of HP/XP colours for unit types (resolves #4736),Wedge009,2020-02-12 01:10:21+00:00,2020-02-14 06:47:38+00:00,"{'Backport': 1, 'UI': 1}","Attempt to resolve #4736 by removing hard-coding. I'm not sure this is the right way to go about it though - a couple of questions to start with:
* Is the side number 0-based or 1-based?
* Does the unit get destroyed automatically afterwards or do I need to clean up manually?

Either way, this seems to work for me, and should equally apply to 1.14 branch."
373042393,fix chat focus loss when re-assigning sides,vgaming,2020-02-10 10:02:36+00:00,2020-09-12 01:34:52+00:00,{'MP Lobby': 1},"Fixes GH-2817

Patch originally provided by @jostephd at github: https://github.com/wesnoth/wesnoth/issues/2817"
372673423,Remove AppVeyor support.,Pentarctagon,2020-02-08 03:12:48+00:00,2020-02-09 18:11:51+00:00,{},"Since Travis has support for Windows jobs now, the external CI services Wesnoth uses can be consolidated from AppVeyor and Travis to just Travis.

Fixes #4727 "
372593897,Misc travis fixes,Pentarctagon,2020-02-07 20:46:32+00:00,2020-02-07 22:49:52+00:00,"{'CI': 1, 'CMake': 1}",
371387569,Upload executables from travis.,Pentarctagon,2020-02-05 13:57:42+00:00,2020-02-07 14:18:41+00:00,{},"This will SFTP the wesnoth and wesnothd executables from Travis (`UPLOAD_ID=<something>`) to SourceForge.

---

The files are SFTPed to the [bfw-travis-upload](https://sourceforge.net/projects/bfw-travis-upload/files/) project on SourceForge using the independent `bfw-uploader` ID, so it doesn't compromise the main Wesnoth project's files on SourceForge if the password used here were leaked.  The password is encrypted in the `travis.yml` via travis' support for [encrypted environment variables](https://docs.travis-ci.com/user/environment-variables/#defining-encrypted-variables-in-travisyml).  This means is should work for all branches, but not for PRs from forks."
369472860,Fix MINGW (with MSYS2) build in Windows,Adriankhl,2020-01-31 08:47:33+00:00,2020-01-31 15:44:10+00:00,{},"Previously, only scons build in MSYS2 is possible. Now cmake also works with this fix.

`cmake .. -G ""MSYS Makefiles"" -DCMAKE_BUILD_TYPE=Release -DARCH=native`"
367752157,make mode=append value by default in set_specials,newfrenchy83,2020-01-27 23:17:54+00:00,2020-02-12 19:02:52+00:00,"{'WML': 1, 'Units': 1}","in set_specials, mode=append is more used what mode=replaced an din utbs mode no specified because the author blelieved what mode=append was already value by default. if mode=replace is few used then it don't must be used by default,like @gfgtdf said."
367685078,Fix for bug #4379 (wmllint issues with defense cap),Elvish-Hunter,2020-01-27 20:22:17+00:00,2020-01-27 23:07:22+00:00,{},"As reported in issue #4379, wmllint has problems handling correctly defense caps in units. This PR fixes the issue in a few ways.
First of all, wmllint's magic comment `# wmllint: match ... with ...` was able to overwrite abilities-notes pairs in the dictionaries derived from the `notepairs` list, thus leading to false positives; this is handled by replacing the `notetrait` dictionary with a sort-of multimap (Python doesn't really have them, although they can be simulated by using `collections.defaultdict(list)`), so any such comment merely adds a new association to the same key, instead of destroying the existing one.
The second problem was that the `notepairs` list was actually designed to handle only pairs of macros; using that list to look for certain key=value lines has been a hackish way to sanity-check a few special notes. This is fixed by handling these notes (`{NOTE_ARCANE}`, `{NOTE_SPIRIT}` and `{NOTE_DEFENSE_CAP}`) as special cases that require special checks. Most notably, now wmllint warns about needing the defense cap note both on finding the `mounted` movetype and on finding a negative value inside a `[defense]` tag (both must be inside a `[unit_type]` tag).
Finally, this PR removes some wmllint magic comments that the fix makes no longer necessary."
367204558,Drop support for the l10n-track file (#4716 and #4717),stevecotton,2020-01-26 10:39:08+00:00,2020-08-08 03:08:00+00:00,{'Translations': 1},"This is for the master branch, #4721 has a minimal workaround for 1.14.

The file only had a run-time effect if it listed any files as ""fuzzy"", which it
hasn't since the last change in 2015. However, that isn't a reason for removing
it.

The reason for removing it is that it doesn't make sense to automatically mark
images as fuzzy when an image changes, because fuzzy is often much better than
untranslated. This is different to the logic for strings, where a single word
can negate the meaning of a sentence. The decision has to be a manual process,
and at that point it might as well be done with the source-control tool's
delete-file function.

Even considering the previous times that l10n-track was used, I can't see a
scenario where it would be useful.

* Scenario: a screenshot needs to be replaced. In this case the new images are
  going to be screenshots too. If the old images are out of date, better to
  just delete them instead of needing the fuzzy mechanism; either option would
  have the same effect of showing the up-to-date-but-untranslated image.

* Scenario: a map is completely redrawn. This seems unlikely, as a completely redrawn
  image could be added as a new map rather than replacing the old one. Even if
  it does happen, it's probably best to just delete the old --overlay.png
  files.

* Scenario: a new landmark is added to a map. Using the existing overlay file
  is still going to be good, as it means the rest of the map is shown
  translated. There's surely new dialogue in the WML files commenting on this
  new landmark, which would be a good place to say
```
    # po: Lorem's Ipsum was added to the map on 24 Jan 2020, please add a label to your language's --overlay file.
```

* Scenario: an old feature is removed from the map. Using the existing overlay
  will have an out-of-date label, and the significance of that would depend on
  how it affects the storyline. This could be significant enough to make
  showing the English labels be a better option than showing the translated
  ones. However, the translated maps could be updated without knowledge of the
  language, so if it's such a significant change then the developer writing the
  new WML should probably do that.

* Scenario: a feature moves slightly on the map. This is an example where the
  l10n-track file has been used, it happened with the Bitter Swamp on the
  bottom-right corner of the title screen. I think it would have been better to
  show the slightly-out-of-date overlay instead of showing the English.

Note about cherry-picking: in the 1.14 branch, the change needs to be applied
to src/picture.cpp instead of src/filesystem.cpp."
367203909,"Workaround for the warning about conflicting files called ""l10n-track""",stevecotton,2020-01-26 10:29:33+00:00,2020-01-31 16:08:23+00:00,"{'Bug': 1, 'Translations': 1}","I think the correct fix is to simply delete the localized_file_uptodate
function, however this commit is the minimal change to avoid #4716
for 1.14.11.

The functionality still works, which can be tested by:

1. set Wesnoth to French
2. note the logo on the title screen says ""Bataille pour Wesnoth""
3. change l10n-track
    -ok        ¦images/misc/l10n/fr/logo.png¦  f13ab03e31b1aaeec3036ebfe049e78f  6e0af4f77ed425d62ae06ce7157a5b37f67c8f7
    +fuzzy        ¦images/misc/l10n/fr/logo.png¦  f13ab03e31b1aaeec3036ebfe049e78f  6e0af4f77ed425d62ae06ce7157a5b37f67c8f7
4. exit and re-launch Wesnoth (just pressing F5 does not work)
5. note the logo on the title screen is in English"
367149700,utbs add mode=append to fix set_specials erase specials already there,newfrenchy83,2020-01-25 20:01:27+00:00,2020-02-05 20:41:13+00:00,{},
367050465,fix other_attack conditional generate bug in abilities used like specials,newfrenchy83,2020-01-24 23:08:00+00:00,2020-01-31 23:41:57+00:00,{},resolve https://github.com/wesnoth/wesnoth/issues/4718. if other_attack condition for adding of abilitie applied to opponent then abilitie function what for attack to same range what owned by owner of abilitie and weapon like abilities must be applied to all attack matched
366091688,Remove redundant macro,AI0867,2020-01-22 22:19:56+00:00,2020-01-22 22:21:08+00:00,{},Remove redundant macro that adds a defeat event before triggering [endlevel]. The defeat event is already added at the end of the file.
365941997,Remove references to WoV in tips and remove unnecessary Khalifate files,Earth-Cake,2020-01-22 16:17:16+00:00,2020-02-05 00:06:00+00:00,{},No description given.
365150340,EI S11: Trigger the guards if an undisguised unit moves into the throne room,stevecotton,2020-01-21 08:18:38+00:00,2020-01-22 03:56:02+00:00,"{'Bug': 1, 'Campaign (any)': 1}","Add an enter_hex event for moving into the throne room, and modify the ""attack""
event so that the undisguised units can trigger it too. For reviewing, note that
the diff shows these as if the existing ""attack"" was changed to a ""enter_hex"",
but in fact it's the existing `[filter_wml]` moving from ""attack"" to ""enter_hex"".

Add L2 Trolls to various lists, as they're used on easy/normal difficulties.

The main bug fixed here is #4674 ""When a guard sees one of the two units not
disguised as an orc, it chases after the unit, but no other enemies are
alerted. This allows a player to pick off each enemy unit individually, then
release the prisoners."""
365101043,Delete utils/update-language-percent as it's obsolete,stevecotton,2020-01-21 05:25:26+00:00,2020-01-21 05:25:50+00:00,{'Translations': 1},"When this utility was written, the list of languages was hardcoded in
src/language.cpp, an example of running it is shown in c2e397e07d.
That hardcoded list was removed by 3fbe2a5863 and b5270e41b9."
364703868,GDB (Gnu C++ debugger) pretty printers,stevecotton,2020-01-20 08:20:50+00:00,2020-01-22 18:34:02+00:00,"{'Low Priority': 1, 'Engine': 1}","Updates to the utility that adds support for showing Wesnoth's `config` class in the Gnu C++ debugger.

Two commits doing two separate tasks:
* Support GDB linked with Python3; has the side-effect of dropping support for GDB linked with Python2.
* Support `config.hpp` from b6e398fdb1a7fde15e6c6941c0d21a9eb5bd2ed9 (Wesnoth 1.13.9) or later; has the side-effect of no longer supporting earlier versions.

Given the time since b6e398fd, I assume that anyone using this is using a locally fixed version; therefore I'm not concerned about breaking support for GDB linked with Python2 pretty-printer support. Just going to leave the PR open for a couple of days, and merge unless someone objects."
364601908,ui: Backport I-beam cursor + Textbox hover and border changes,irydacea,2020-01-20 00:47:40+00:00,2020-01-23 04:30:47+00:00,"{'Enhancement': 1, 'Backport': 1, 'UI': 1}","This backports the I-beam cursor feature from master to 1.14, along with the addition of the textbox hover effect. It also adds on top of everything else a re-do of vultraz's textbox border changes from commit cfd7d0e4e56ffb83e97ea0d58c0117a348e5d355, in order to address an issue with the MP chat input textbox becoming basically invisible when not currently focused because of it having no border."
364549159,i18n: Use <game dir>/translations on Windows,irydacea,2020-01-19 15:54:13+00:00,2020-01-21 13:35:10+00:00,"{'Windows': 1, 'Translations': 1}","This replaces the previous behaviour of using `<pwd>/translations`, which could break on certain edge cases (e.g. if Wesnoth is launched from the command line from a different dir)."
364345511,Fix team color in Utbs quenoth shyde.png,newfrenchy83,2020-01-17 22:33:47+00:00,2020-01-19 03:47:59+00:00,{},
364289062,Misc wesnothd tweaks,Pentarctagon,2020-01-17 19:35:15+00:00,2020-01-22 00:02:29+00:00,{'MP': 1},
363016347,Simplify help's logic for terrain_types that should be hidden in help,stevecotton,2020-01-15 08:34:45+00:00,2020-01-17 10:14:13+00:00,{'Help': 1},"Even when a terrain has hide_help=yes, its help should still be shown if the
player right-clicks on a hex of that type and selects ""Terrain description"".

This commit changes lines that have inconsistent logic, and the main reason for
doing it was to work out whether that inconsistency was something that needed
to be kept when refactoring the terrain code.

The inconsistency was a bug, help would fail to open the topic.  However, the
bug is so obscure that I only found it when considering the edge case that the
commit is removing, and there's no terrain in core that would trigger it.  The
edge case requires a terrain to be:

* defined by a [terrain_type] tag, so is_combined()==false
* hide_help=yes
* hidden=no (or is the default value)

To replicate the bug, try changing the definition of Gg to have hide_help=yes."
362425896,i18n: Convert POSIX/Win32 locale table file into a map,irydacea,2020-01-14 03:28:30+00:00,2020-01-19 15:40:04+00:00,"{'Windows': 1, 'Translations': 1}",This removes the need for the separate file and the giant if chain by using a `std::map` instead.
362318690,Do not use SDL render API for certain drawing operations,irydacea,2020-01-13 20:59:15+00:00,2020-01-14 01:35:31+00:00,{'Graphics': 1},"With the introduction of batched rendering in SDL 2.0.10, the behaviour of the render API appears to have changed so that certain operations forcibly queue a renderer clip rectangle set operation, using a default rectangle if necessary. The command queue does not clean after itself since it appears that the operating assumption is that you either use the renderer API or you don't, and Wesnoth performs drawing operations both with and without it in a few places.

With commit 4cbd6529e3d5f378d4dd0080dda8a47025b0d50d, our drawing primitives were changed (""refactored"") so that the render API is forcibly used by them. When combined with contexts that use the `clip_rect_setter` object, things get weird since the clipping rectangle is reset behind the code's back.

As I see it, there's two solutions to this:

1. Make `clip_rect_setter` use `SDL_RenderSetClipRect()`. The problem with this is that there are at least 3-4 places using `clip_rect_setter` on a target that isn't the screen framebuffer. Finding out whether the target surface *is* the screen seems like an inconvenient chore.
2. Don't use the render API ever.
3. Keep using the render API (a lot of other things do use it, such as the GUI2 canvas implementation) and change the few contexts where we use `clip_rect_setter` together with drawing primitives to call the SDL_Surface drawing primitives directly instead of using the render API.

This patch goes with option 3 since it seems the least intrusive. While this fixes the two known cases of bug #4510 as of this writing (help browser and minimap outline), I am not entirely sure if there are any other users of `clip_rect_setter` hiding drawing primitive calls somewhere underneath.

Also added relevant source comments in case someone decides to refactor the involved code and break it again. It's especially necessary in the minimap's case since we need to draw a grand total of 4 different rectangles at once.

Fixes #4510."
362276761,sdl: Prevent undefined behaviour in clip_rect_setter,irydacea,2020-01-13 19:13:17+00:00,2020-01-14 01:35:07+00:00,{'Graphics': 1},"(Found while investigating issue #4510.)

Unlike what the constructor's documentation says, passing a null `SDL_Rect*` does have unexpected consequences. First, one of the first two arguments to `SDL_IntersectRect` will be a null pointer, which results in `SDL_IntersectRect` returning SDL_FALSE without ever touching the output `SDL_Rect`:

```c
SDL_bool
SDL_IntersectRect(const SDL_Rect * A, const SDL_Rect * B, SDL_Rect * result)
{
    int Amin, Amax, Bmin, Bmax;

    if (!A) {
        SDL_InvalidParamError(""A"");
        return SDL_FALSE;
    }

    if (!B) {
        SDL_InvalidParamError(""B"");
        return SDL_FALSE;
    }
```

In this context that means that next `SDL_SetClipRect` will receive a pointer to a fresh `SDL_Rect` full of uninitialized values and all kinds of weirdness could ensue next depending on the phase of the moon.

Additionally, while the SDL functions called here will do nothing on a null pointer to a surface, the check introduced here requires dereferencing the surface's members, so we need to explicitly do nothing if the surface is null.

Both cases don't seem to ever happen in practice, judging from a cursory glance at how `clip_rect_setter` is currently used in the codebase, but that doesn't mean they will never turn up in the future.

This issue applies to both master and 1.14."
361907213,Units - Dunefolk Nagas - first revisions,doofus-01,2020-01-13 02:51:43+00:00,2020-02-03 01:21:32+00:00,"{'Ready for testing': 1, 'Graphics': 1, 'Units': 1}","The Naga line of the Dunefolk didn't make much sense to me, but I realize it may have been done with an eye to MP balance, so I tried to be conservative in revisions.  The biggest issue was that the bow seemed to be a reason to use the hunter naga portrait, but was very forced.  Maybe it was for MP balance as well?

In any case, I plan to get basic animation (defense at the very least) for these, but that's not started yet."
360098412,weapon_special_daze_event with abilities,newfrenchy83,2020-01-07 17:39:53+00:00,2020-01-12 22:18:36+00:00,{},"now what changes in abilities used like specials are merged, i can propose that for simpplify WEAPON_SPECIAL_DAZE_EVENTS code"
359697142,HttT - Fix Li'sar not being loyal in S17,Earth-Cake,2020-01-06 20:16:49+00:00,2020-01-11 01:19:39+00:00,{},Closes [#4498 ](url=https://github.com/wesnoth/wesnoth/issues/4498).
359268195,"SoF - Thursagan as ""effect crafter""",doofus-01,2020-01-05 03:36:53+00:00,2020-01-12 02:40:27+00:00,"{'Ready for testing': 1, 'Campaign (any)': 1}"," _Initial commit of Thursagan rune-shop addition_
This is to deal with the issues in https://forums.wesnoth.org/viewtopic.php?f=38&p=650382
Rather than a new unit type, resources can be spent to temporarily (scenario) buff a standing unit.   
 - Costs are supposed to make it competitive with just recruiting another unit.
 - UI is probably the first issue to tune, I tried to make it more available than just an obscure [set_menu_item], without being too annoying.
 - Balance will be an issue for a while, probably, but it should be easy to adjust code-wise."
359266774,Move Quenoth Elves to mainline (WIP),Earth-Cake,2020-01-05 03:04:20+00:00,2020-01-08 18:16:22+00:00,{'Units': 1},"No description given.

Known issues:
- Formation ability in help shows a few commas after the ability name"
359187223,Travis windows misc improvements,Pentarctagon,2020-01-04 06:12:09+00:00,2020-01-05 07:35:10+00:00,{},
358524512,various dunefolk sprites and animations,doofus-01,2020-01-01 23:01:49+00:00,2020-01-03 01:34:11+00:00,"{'In-progress': 1, 'Graphics': 1, 'Units': 1}","Just as many as I can get done within the next few days, no overall checklist."
358515327,Tutorial - minor improvements,Earth-Cake,2020-01-01 20:27:29+00:00,2020-01-11 15:18:37+00:00,{'Campaign (any)': 1},"- Removal of unnecessary events, adding another PRINT messages event, changing coordinates in one message, if hero has attacked Dumbo provide another dialogue, and change highlighted village on turn 6 if player still hasn't captured it in S2
- Adding a macro and add [cancel_action] tag in utils.cfg"
358450486,SoF - Rewrite of last scenario,doofus-01,2020-01-01 04:56:30+00:00,2020-01-02 00:03:30+00:00,"{'Ready for testing': 1, 'Campaign (any)': 1}","This doesn't change the plot in any significant way, but it should be a more credible way to end things.  There are two concerns I have:
1.  It may be too easy.  Or it may require too much ""behind the scenes knowledge"".  I don't know how to test that aside from getting other people to play it.
2.  The micro_ai for the special orc didn't work at all.  I don't know if it is because I was using it wrong or there was a conflict with the new filtering*. I've got a work around, but it should be replaced when possible.

*(https://wiki.wesnoth.org/Wesnoth_AI_Framework#The_.5Bcandidate_action.5D_Tag)"
358439232,Remove WindowsTimeout.cpp and related.,Pentarctagon,2020-01-01 00:43:30+00:00,2020-01-01 00:43:38+00:00,{},"This is no longer needed, as the WML unit tests are now handled by the python script."
358425955,"Tutorial S2 - Capturing village bug-fix, add more instructions about capturing and recruiting",Earth-Cake,2019-12-31 21:48:23+00:00,2020-01-01 17:28:42+00:00,{},"Add more reminding PRINT messages, disallow_end_turn messages, and fix a bug where player can just capture village and end turn without recruiting/recalling units."
358375346,"Filter weapon in [filter student/opponent/etc] ,rework [filter_(secon… …d_)weapon and adding [swarm],[heal_on_hit] and plague to abilities used like specials(pre1.16 string)",newfrenchy83,2019-12-31 15:17:09+00:00,2020-01-04 23:27:56+00:00,{},"This PR resolves https://github.com/wesnoth/wesnoth/issues/4629 with the addition of the latest special weapons to abilities,
https://github.com/wesnoth/wesnoth/issues/4475 (the display bug in the combat prediction window) and https://github.com/wesnoth/wesnoth/issues/4389. and replace https://github.com/wesnoth/wesnoth/pull/4659"
358261465,Travis windows and flatpak jobs,Pentarctagon,2019-12-31 02:41:42+00:00,2019-12-31 23:17:35+00:00,"{'Building': 1, 'CI': 1}",Note: this supercedes #4668
358152073,"Fix #4135 - add the ""Advances to"" tooltip to the recruit and recall dialogs",rjframe,2019-12-30 16:06:27+00:00,2020-01-24 20:48:58+00:00,{'UI': 1},"Moves creation of the advancement tooltip text when you mouseover the ""Lvl [number]"" in the sidebar to a helper function and convert's the recruit/recall dialog's `level_label_` to a `gui2::implementation::styled_widget` so we can add the tooltip.

I merged the two ""User Interface"" sections for master in the changelog.

There's a lot of duplication in `unit_preview_pane::set_displayed_type` (recruit list) and `unit_preview_pane::set_displayed_unit` (recall list); they've diverged a bit over time, but I haven't looked closely enough to see how much of that is intentional versus forgetting to update both."
357830116,Fix multi-line deprecation messages,stevecotton,2019-12-29 20:46:34+00:00,2020-01-05 08:35:34+00:00,"{'Bug': 1, 'Engine': 1}","Several of the deprecated macros have two or three lines of explanation, but
only the last one was printed. This change fixes a cppcheck warning that the
value of deprecation_detail was overwritten without being used.

For example:

    #define SOUND:POISON
        #deprecated 3 1.15 This was used to play a sound when poisoning a unit, it had to
        #deprecated 3 1.15 be placed inside an attack animation. Now this sound is played
        #deprecated 3 1.15 automatically, there is no other use for this macro.
    #enddef

Ended up printing:

    20191229 21:39:36 error deprecation: SOUND:POISON has been deprecated and will be removed in version 1.15.0.
      automatically, there is no other use for this macro."
357763115,Error handling for campaigns without id (fixes #4664),stevecotton,2019-12-29 17:29:45+00:00,2019-12-29 20:37:14+00:00,"{'Bug': 1, 'WML': 1, 'Engine': 1}","Can be cleanly cherry-picked between 1.14 and master, and tested on both. Sample output:
```
20191229 18:22:08 error config: Found a [campaign] with neither a name nor an id attribute, ignoring it
20191229 18:25:18 error config: Ignoring a [campaign] with no id attribute, but name 'Tactics Puzzles'
```"
357577440,Backport map_file feature fixes for 1.14,fluffbeast,2019-12-28 19:48:27+00:00,2019-12-29 00:52:24+00:00,{},"This branch combines fixes needed for using map_file.

See issues #4407, #4397, #4519, and #4652 for details."
356870263,Add a flatpak travis job.,Pentarctagon,2019-12-26 04:43:59+00:00,2019-12-31 02:41:59+00:00,{'Building': 1},"NOTE: This doesn't sign/upload/etc the output anywhere.

---

The lines:
```
""cflags-override"": true,
""cppflags-override"": true,
""cxxflags-override"": true,
""cflags"": """",
""cppflags"": """",
""cxxflags"": """",
```
are there in order to clear out the default compiler flags that flatpak seems to put there.  Those being:
CFLAGS/CXXFLAGS - `-O2 -g -pipe -Wp,-D_FORTIFY_SOURCE=2 -Wp,-D_GLIBCXX_ASSERTIONS -fexceptions -fstack-protector-strong -grecord-gcc-switches -fasynchronous-unwind-tables -fstack-clash-protection -fcf-protection`
With those gone (I'd guess mostly the `-g`), a full build of scons, boost, wesnoth, and wesnothd can be done within travis' time limit.

There's also:
LDFLAGS - `-L/app/lib -Wl,-z,relro,-z,now -Wl,--as-needed`
however I left those alone."
356125596,Backport unit test framework changes (fixes #4471),stevecotton,2019-12-22 22:19:30+00:00,2019-12-24 22:02:29+00:00,"{'Bug': 1, 'Backport': 1, 'Unit Tests': 1}","Note: needs to wait for the AppVeyor build to confirm that it fixes #4471.

The main reason for backporting all of this is to have separate unit test
statuses for WML exceptions and strict warnings, so that this mechanism can be
used instead of a793bce96's method of running the cve_2018_1999023 test in
non-strict mode, which means that the test now passes without making
equivalent-to-a793bce96 changes to projectfiles/VC12/WML_tests.cmd and
projectfiles/VC16/WML_tests.cmd.

The final commit, converting run_wml_scripts to Python, could be omitted. To
allow this, commit 7359fddecb8dafdb8bec33660259ec5e2fec4141 was reordered
slightly, with the changes to the script (adding the new statuses) in a
separate commit to the C++ changes.

Cherry-picked from the commits:
* 657629322884286f938e9a25e5f7300d52536601
* 63bb076b971a4724c05659e3c59b23d4cdf7f38c
* 7359fddecb8dafdb8bec33660259ec5e2fec4141
* eb7f3674dc40ecc8102f5ae451f80cf9e86f103a
* 38a49ad068d3ed092ef2e8d759b08f6871640e21
* 7345ca7b0f3b61ae669233fd9fd89f6fb2a27fc1"
356122027,Fixes a warning about scons builds with multiple threads.,Pentarctagon,2019-12-22 21:25:27+00:00,2019-12-23 19:06:44+00:00,{'Packaging': 1},"Currently both on jenkins and locally building Wesnoth's flatpak gives the warning:

scons: warning: parallel builds are unsupported by this version of Python;
	ignoring -j or num_jobs option.

This is apparently due to an issue between scons 3.0.1 and python 3.7+, which was reported at https://github.com/SCons/scons/issues/3145, fixed in https://github.com/SCons/scons/pull/3150, and is therefore first included in scons 3.0.2.

---

As far as running a flatpak job on travis, it is technically possible and I have a working docker image for it, however it takes longer than the 50 minute limit we have on travis to build the boost libraries, scons, and then Wesnoth."
356050910,More wesml.vim fixes,Chergnobarp,2019-12-22 03:11:45+00:00,2019-12-29 00:52:49+00:00,{'WML Tools': 1},Hopefully this is all of them.
356042026,More SoF revisions,doofus-01,2019-12-22 00:20:27+00:00,2019-12-30 20:14:13+00:00,"{'Ready for testing': 1, 'Campaign (any)': 1, 'Graphics': 1, 'Prose': 1}","I had paused revisions to SoF to work on some terrain I thought would be useful for this campaign, so this PR will include some cosmetic map updates, as well as some more basic map revisions.  I'm also trying to put a little more effort into tuning the AI parameters."
356038617,Miscellaneous fixes and additions to tips.cfg,Earth-Cake,2019-12-21 23:13:52+00:00,2019-12-23 05:33:16+00:00,{'Help': 1},No description given.
356036501,fix #4626 ai advacement aspects regression,gfgtdf,2019-12-21 22:37:03+00:00,2019-12-22 00:11:35+00:00,{},"the list returned by `ai_advancement.get_advancements` is a priority list, so we use the first valid entry instead of a random one."
356016457,"Filter weapon in [filter student/opponent/etc] ,rework [filter_(secon… …d_)weapon and adding [swarm],[heal_on_hit] and plague to abilities used like specials(pre1.16 string)",newfrenchy83,2019-12-21 17:13:33+00:00,2020-01-01 10:22:57+00:00,{},"This PR resolves https://github.com/wesnoth/wesnoth/issues/4629 with the addition of the latest special weapons to abilities,
https://github.com/wesnoth/wesnoth/issues/4475 (the display bug in the combat prediction window) and https://github.com/wesnoth/wesnoth/issues/4389.

"
356012979,[1.14] Log a warning if a file is found in more than one [binary_path],stevecotton,2019-12-21 16:23:06+00:00,2019-12-22 10:29:32+00:00,"{'Enhancement': 1, 'Engine': 1}","The Boost-based C++ unit tests generate three messages about duplicates,
however as those tests don't run in strict mode this doesn't cause a
failure (and it's not the only warning-level message in those tests).

The 1.15 version of this will be in PR #4654 .

Example output:
```
20191221 17:18:31 warning filesystem: Conflicting files in binary_path: '/home/USER/.local/share/wesnoth/1.14/data/add-ons/Desert_Map-Pack/images/maps/background.jpg' and '/home/USER/development/other-source/wesnoth/branch_1_14/data/core/images/maps/background.jpg'
```"
356003640,"Filter weapon in [filter student/opponent/etc] ,rework [filter_(secon… …d_)weapon and adding [swarm],[heal_on_hit] and plague to abilities used like specials(pre1.16 string)",newfrenchy83,2019-12-21 14:10:33+00:00,2019-12-21 17:14:38+00:00,{},"@CelticMinstrel This PR must resolve https://github.com/wesnoth/wesnoth/issues/4629, but also https://github.com/wesnoth/wesnoth/issues/4475"
355806624,Make map_file= search for a maps directory in the [binary_path] (#4633),stevecotton,2019-12-20 16:36:16+00:00,2019-12-26 18:01:29+00:00,"{'Campaign (any)': 1, 'WML': 1}","For both [scenario]map_file= and [replace_map]map_file=, this allows both of
these to have the same effect:

* map_file=campaigns/Heir_To_The_Throne/maps/01_The_Elves_Besieged.map
* map_file=01_The_Elves_Besieged.map

This allows a lot of copies of the campaign/add-on's name to be omitted. Thus
it's no longer necessary to change every scenario's .cfg file to rename an
add-on, or to move a campaign between UMC and mainline.

This makes [binary_path] a misnomer, as it now also handles a text-based type
of file, however that's going to be the correct path for campaigns or add-ons
that use the standard layout with images/, maps/, scenarios/, etc.

This commit has the change itself, in filesystem_common.cpp, and the updates
for most of the campaigns. DM, LoW, UtBS and WoV are omitted from this, as they
all use a macro to do the same effect:

 #define MEMOIRS_MAP NAME
-    map_file=campaigns/Delfadors_Memoirs/maps/{NAME}
+    map_file={NAME}
 #enddef

There are several comments on a previous version of this: https://github.com/stevecotton/wesnoth/commit/96e8077a5a02b58e7ea0e980225b55cbece66a59"
355591296,Liberty: merge S6 and S7 into one scenario,nemaara,2019-12-20 07:48:43+00:00,2019-12-20 16:04:28+00:00,{},
355489008,Fix Map size: 0x0 in multiplayer create game menu,fluffbeast,2019-12-20 02:51:59+00:00,2020-01-02 22:03:43+00:00,{'UI': 1},"The multiplayer create game menu shows scenarios as having map size 0x0.

To reproduce this bug, select ""Multiplayer"" from main menu, then ""Local Game"".  After ""OK"" button pressed, select any scenario, and the map size is shown as ""0x0"".

This short fix loads the map data and collects metadata about it before displaying map size."
354836317,HttT - Change sprites in difficulty-choosing screen from Elves' to Konrad's sprites,Earth-Cake,2019-12-18 21:56:19+00:00,2019-12-19 07:45:46+00:00,{},Inspired by this: http://forums.wesnoth.org/viewtopic.php?f=32&t=49357
354422730,Typo fix in wesml.vim.,Chergnobarp,2019-12-18 04:45:21+00:00,2019-12-18 13:13:12+00:00,{},"store_village and story had no space between them, so they didn't
highlight correctly.

Sorry if chose the wrong branch to merge to, I didn't see anything about that in the wiki."
354067720,Fix [replace_map]map_file= when called in a prestart event,stevecotton,2019-12-17 11:59:35+00:00,2019-12-17 22:42:24+00:00,"{'Bug': 1, 'Campaign (any)': 1, 'WML': 1}","Fixes 8080271231adddb3a3e88297d5fc52d37e3de7d7's Eternal Night. The northern
parts of both 10 and 10a are the same, but 10a is extended southwards; this
caused some confusion thinking that the map-load hadn't changed anything.

The regexp code is removed, as @gfgtdf comments in #4633: ""I'm quite sure that I
wrote that code but I don't remember why, I was probably just extra cautious.
In particular with the existence of wesnoth.read_file nowdays there is little
point in these checks.""

Removing the regexp code allowed merging with the codepath for handling
[scenario]map_file=, which will allow the main issue of #4633 (searching other
folders for maps) to automatically affect [replace_map] too."
353238279,Terrain Cf* - dwarf castles under normal castle rules,doofus-01,2019-12-15 04:14:52+00:00,2019-12-16 03:51:41+00:00,"{'In-progress': 1, 'Graphics': 1, 'Terrain': 1}"," - first non-cave dwarf castle reivision (includes snow version)

The goal here is to get something that plays well with other castles, and has decent transitions to Cf* versions, such as snow or ruin/abandoned.

This is a screenshot of the current version.  Some work still to do, but I believe it's an improvement.
EDIT: The classic dwarf castle is just there for contrast, I'm not going to try to make the transitions work.  Cf*/Cud seems really low priority, but a huge PITA.
![Screenshot_20191214_](https://user-images.githubusercontent.com/13510196/70858007-24470b80-1eae-11ea-8317-ec01fc9dc5df.jpg)
"
353221249,Tutorial S2 map overhaul,Earth-Cake,2019-12-14 23:05:57+00:00,2019-12-17 22:47:42+00:00,{},Some players have commented on the tutorial S2 being too hard. This PR aims to make it easier by redoing the map.
353107395,Tutorial - remove repeating help messages,Earth-Cake,2019-12-13 23:11:29+00:00,2019-12-16 02:31:57+00:00,{},No description given.
352528719,Dunefolk usage attributes and recruitment patterns,walodar,2019-12-12 17:26:45+00:00,2019-12-15 06:54:48+00:00,{},"Hello,
the usage attributes for AI recruitment of some dunefolk units are odd. Additionally, the current recruitment_pattern includes scout but does not include healer, while the Dune Herbalist has usage=healer and no dunefolk unit has usage=scout at the moment.

More details on the values that the proposed new usage attributes are based on can be found below.

I do not know if the suggested new recruitment_pattern is optimal, but it includes all occurring usage attributes, with weights according to the number of default era recruits of that type (2:2:1:1:1). In the few simple AI versus AI tests I did, the win ratio against other factions was quite okay.


Details:
each entry: level, id (ratio melee damage/ranged damage, some relevant abilities and weapon specials)

total: 33 (counting Paragon)
default recruits: 7
aoh recruits: 20

fighter
total: 13 (counting Paragon)
default recruits: 2
aoh recruits: 7
1 Soldier (22/0=inf)
_2 Captain (27/0=inf)
__3 Warmaster (36/0=inf)
_2 Spearguard (32/0=inf)
__3 Spearmaster (46/0=inf)
_2 Swordsman (30/0=inf)
__3 Blademaster (45/0=inf)
___4 Paragon (52/0=inf)
1 Skirmisher (16/6=2.667)
_2 Sunderer (33/15=2.2)
__3 Cataphract (42/18=2.333)
_2 Ophidian (24/12=2)
__3 Dervish (40/18=2.222)

mixed fighter
total: 8
default recruits: 2
aoh recruits: 5
1 Dirkfang (12/12=1)
1 Rover (12/15=0.8)
_2 Explorer (24/24=1)
__3 Wayfarer (32/32=1)
_2 Strider (24/14=1.714, ranged slows)
__3 Harrier (32/18=1.778, ranged slows)
_2 Alchemist (27/14=1.929, ranged poison)
__3 Firetrooper (27/36=0.75)

archer
total: 6
default recruits: 1
aoh recruits: 4
_2 Horse Archer (14/28=0.5)
__3 Windbolt (20/40=0.5)
_2 Ringcaster (12/24=0.5)
__3 Zephyr (18/35=0.514)
1 Burner (12/21=0.571)
_2 Scorcher (18/27=0.667)

healer
total: 3
default recruits: 1
aoh recruits: 2
1 Herbalist (12/0=inf, heals +4)
_2 Apothecary (24/0=inf, heals +8)
__3 Luminary (36/0=inf, cures, heals +8)

scout
total: 3
default recruits: 1
aoh recruits: 2
1 Rider (10/15=0.667)
_2 Raider (24/21=1.143)
__3 Marauder (33/30=1.1)"
352278859,WIP (test fails) : Test [move_unit] moving back to the starting hex,stevecotton,2019-12-12 07:55:09+00:00,2019-12-14 17:12:15+00:00,{},@CelticMinstrel should this be supported?
352026848,Fix: incorrect dunefolk image path in multiplayer factions and Dune A…,walodar,2019-12-11 17:18:36+00:00,2019-12-11 17:45:20+00:00,{},…pothecary attack animation
351387381,"Filter weapon in [filter student/opponent/etc] ,rework [filter_(secon… …d_)weapon and adding [swarm],[heal_on_hit] and plague to abilities used like specials(pre1.16 string)",newfrenchy83,2019-12-10 13:21:56+00:00,2019-12-21 14:10:53+00:00,{},"Like i said in https://github.com/wesnoth/wesnoth/issues/4629, this PR is here for what ALL specials could be used in abilities. resolve alos  other problem solved by https://github.com/wesnoth/wesnoth/pull/4593."
351321073,Update scons codeblock projectfile,newfrenchy83,2019-12-10 10:44:49+00:00,2019-12-10 11:07:53+00:00,{},
351320327,update codeblock projectfiles,newfrenchy83,2019-12-10 10:43:08+00:00,2019-12-10 11:07:13+00:00,{},
350408380,Additional special notes (suggestion),walodar,2019-12-08 12:41:27+00:00,2019-12-10 05:35:15+00:00,"{'Enhancement': 1, 'Units': 1, 'Prose': 1}","Hello, I have a suggestion for additional special notes for a number of units, similar to the recently added ones (for example for the Spearman advancements).
Thanks for considering this!"
350280295,Improves the WML unit test script's error reporting.,Pentarctagon,2019-12-07 05:50:02+00:00,2019-12-12 02:14:16+00:00,{},"This commit:
* Adds the new `bt` (batch timeout) option, to limit the maximum time batched unit tests can take.  Otherwise, if for whatever reason they take longer than 10 minutes, travis will error the job due to not receiving any output for too long.
* Writes the test output to files rather than trying to get it from the stderr, and then output's the log from the failed test.  Currently if a test unexpectedly times out, there is nothing printed indicating the error or which test encountered the problem (in case of batched tests)."
348343757,git-subtree like tool for exporting campaigns,stevecotton,2019-12-03 13:55:59+00:00,2021-03-25 17:30:18+00:00,{},"As with git-subtree, it creates reproducible SHA1 ids for the new branch, the
pre-removal history of An Orcish Incursion will appear as the branch with head
d45d9e7562e407d3b934c0eb88b40c891a963942.

Added to the utils directory rather than data/tools, as it makes no sense to have
without the full Git history."
347942398,adding resistance_anim to shema validation,newfrenchy83,2019-12-02 19:39:37+00:00,2020-04-20 02:31:23+00:00,{'Schema': 1},"If a day, a resistance abilities applied to adjacent unit is added in the core, with a proper animation, it can be validated."
347423992,Snowy Terrain,doofus-01,2019-12-02 03:54:33+00:00,2019-12-15 02:02:46+00:00,"{'Ready for testing': 1, 'Graphics': 1, 'Terrain': 1}","This is for a collection of miscellaneous snowy terrain.  Plan is for:
 - [x] Snowbits  - similar to the scattered stone embellishment
 - [ ] Frosted grass, dirt, and cobbles.
 - [x] Snowy deciduous forest
 - [x] Snowy version of Elf and Dwarf castles
 - [ ] (maybe) some ""frost fern"" overlay.  Something like the desert cactus overlays, but for snow."
347341025,wip use ai advancement asepect also during [event]s,gfgtdf,2019-12-01 15:32:34+00:00,2019-12-02 02:41:33+00:00,{},"fixes #4605
previously advancements invoked by [event]s for example
by unstoring a unit with enough xp would alwas do a
purely random advancement even if they happend during
the ais own turn. Now the advancemt_aspect is considered
i don't really know how the code inside ai/ works so i
just took the easiert way to get a advancements_aspect
from the manager. In particular this leaves a TODO comment
about whether the advancemnts_aspect of advance_unit_at
(and thus of attack_and_advance) can not be removed or not
because i don't know whether the advancement aspect is
effectively a sinbgleton or not."
347320626,Fix: Dune Alchemist used Dune Apothecary image in both attack animations,walodar,2019-12-01 11:46:13+00:00,2019-12-01 16:39:13+00:00,{},
347296274,lua: Simplify the __index and __newindex wrappers in wesnoth.deprecate_api,jostephd,2019-12-01 06:11:33+00:00,2019-12-14 14:15:10+00:00,"{'Enhancement': 1, 'Lua API': 1}","I posted this on https://github.com/wesnoth/wesnoth/issues/4584#issuecomment-560029352 but posting again as a PR for ease of tracking. Testing instructions are on that comment too, I haven't done any testing yet."
347147338,Liberty S2 - bug fix,Earth-Cake,2019-11-29 19:44:49+00:00,2019-12-02 13:19:10+00:00,{'Campaign (any)': 1},Fix a bug regarding enemy leader leaving starting position and going with his soldiers.
346898806,SoF: Revisions to S1-S3t,doofus-01,2019-11-29 05:23:26+00:00,2019-12-09 03:33:26+00:00,"{'Enhancement': 1, 'Ready for testing': 1, 'Campaign (any)': 1}","For now is only the first two scenarios and the cut-scene.  
 - For the first scenario, the player has to move the caravan - just going and squashing the elf isn't really an option.  Also made a closer keep and a guard under player control, so player doesn't have to rely on idiot AI ally to save caravan.
 - Second scenario isn't really changed, just elf leader is the same one from first scenario.  Animation for gate could be improved.
 - cut-scene is just some dialogue revisions.

Going forward, I think there should be something between this cut-scene and the Thursagen peekaboo scenario.  They march a long distance and the opening dialogue mentions fighting orcs etc.  Maybe this is chance for something new - a dwarvish subway train that gets stopped by some orcs messing with the tracks.  An easy scenario, a chance to gain XP if needed."
346877519,WIP: Use the Python run_wml_tests on Windows too,stevecotton,2019-11-29 03:05:52+00:00,2019-12-26 02:23:06+00:00,"{'Windows': 1, 'Unit Tests': 1}","Not tested locally, just creating a PR to run the AppVeyor tests and see if this works."
346764222,add tests projectfile to codeblock workspace,newfrenchy83,2019-11-28 15:59:22+00:00,2019-11-29 22:28:54+00:00,{},
346344519,fix test projectfiles,newfrenchy83,2019-11-27 17:04:19+00:00,2019-11-27 17:53:53+00:00,{},
346019251,Port run_wml_tests to Python and add batch support (part of #4535),stevecotton,2019-11-27 02:24:57+00:00,2019-12-01 07:25:11+00:00,"{'Enhancement': 1, 'Unit Tests': 1}","The verbosity settings are a bit different, but other than that it
should be a drop-in replacement for the old shell script.

Wesnoth's --validcache option isn't used any more, which is part of
the cleanup for #4587 (it didn't speed anything up, because all of
the calculation for the checksum was still done).

@CelticMinstrel please would you test the xcode support? I think
I've implemented it correctly, but don't have a Mac to test on."
345434695,wip support [time_area] with no specific timezone,gfgtdf,2019-11-25 21:51:17+00:00,2020-02-21 21:27:33+00:00,{},"now the c++ code does no longer add a dummy time when
there are no times defines for an [time_area]. this is
in particular useful when one wants to define areas in
the map editor that is then used ingame for exampel in
filters.
We should consider renamaing [time_area] to just [area]
[time_area]s that dont define their own times are now
ignored during tod calculation."
344981932,Merge Experimental AI candidate actions into the default AI,mattsc,2019-11-25 02:02:49+00:00,2019-12-15 22:15:56+00:00,{'AI': 1},See Feature Request #4598 for details.
344870990,Separate unit test statuses for WML exceptions and strict warnings,stevecotton,2019-11-24 04:11:37+00:00,2019-12-22 18:11:49+00:00,{'Unit Tests': 1},"This is part of working out whether a subset of the ""fail"" tests could be run in one Wesnoth instance. To run a test that returns TEST_FAIL_BROKE_STRICT with any other test would require a mechanism to reset lg::broke_strict()'s flag.

All tests that fail with an {ASSERT} will also set the lg::broke_strict() flag, the tests with the new status are only those that would pass without the strict flag.

In the SUF tests, change a test from fail-on-success to breaks-strict, rename the formula tests and add some comments. The rename is because ""fai"" is ""Formula AI"", an obsolete name for WFL."
344870185,Convert some fail-on-success unit tests to pass-on-success,stevecotton,2019-11-24 03:55:00+00:00,2019-11-25 13:28:03+00:00,{'Unit Tests': 1},
344867631,Changed failed replays to regular failure for the WML unit tests.,Pentarctagon,2019-11-24 03:04:38+00:00,2019-11-24 04:24:03+00:00,{},"This changes ""FAIL TEST (INVALID REPLAY)"" and ""FAIL TEST (ERRORED REPLAY)"" into ""FAIL TEST"".  The INVALID REPLAY case isn't used anymore though, regardless.

---

Successful travis run is available [here](https://travis-ci.org/Pentarctagon/wesnoth/builds/616154542/), since master's isn't passing at the moment."
344855415,"Filter weapon in [filter student/opponent/etc] ,rework [filter_(secon…  …d_)weapon and fix sidebar show(pre 1.16 string)",newfrenchy83,2019-11-23 23:40:56+00:00,2019-12-21 17:16:32+00:00,{},"this th 4th PR for resolve https://github.com/wesnoth/wesnoth/issues/4389, but also resolve https://github.com/wesnoth/wesnoth/pull/3642 for abilities used like specials.

i see what sidebar weapon don't follows mouseover when i use weapon abilities for ""damage"" or ""attacks"""
344829650,[AOI]: Remove from mainline,nemaara,2019-11-23 17:56:04+00:00,2019-12-02 00:47:51+00:00,{'Campaign (any)': 1},See here: http://forums.wesnoth.org/viewtopic.php?f=2&t=51139.
344572977,Implement various AI feature requests,mattsc,2019-11-22 15:29:50+00:00,2020-01-02 00:47:58+00:00,{'AI': 1},This takes care of three of the remaining four open items in #3450.
343746383,Select the correct item in a filtered and sorted generator,stevecotton,2019-11-20 22:08:35+00:00,2019-11-25 17:48:48+00:00,{'UI': 1},"In the load-game dialog, this makes deleting a file select the next
visible game save, thus it fixes #4125.

Credit and many thanks to @DisherProject for the inspiration and hard
work of debugging where to fix this."
342765825,"Fix ""wmllint: no translatables"" magic comment",ProditorMagnus,2019-11-19 16:18:05+00:00,2019-11-19 17:21:16+00:00,{},Noticed from https://lgtm.com/projects/g/wesnoth/wesnoth/
342498852,Support running multiple expected-to-pass unit tests,stevecotton,2019-11-19 05:43:41+00:00,2019-11-22 22:14:54+00:00,"{'Enhancement': 1, 'Command Line': 1, 'CI': 1, 'Engine': 1}","The C++ part of issue #4535

This allows batching all of the tests that are expected to return status zero,
which is currently 161 tests, and running the batch with a single instance of
Wesnoth.  It doesn't include the changes to the run_wml_tests script to use
this new feature (and I'd welcome someone else refactoring that script).

Timing on my PC:
* 4 seconds to run a single test on a debug build
* 90 seconds to run the whole batch of 161 on a debug build
* 1.2 seconds to run a single test on a release build
* 31.2 seconds to run the whole batch of 161 on a release build

I feel it's hacking more complexity on top of the wesnoth.cpp / game_launcher.cpp / commandline_options.cpp / title_screen.cpp spaghetti, but faster testing means people are more likely to run the tests.

The main output is still that Wesnoth returns the status code of the last test run - if all the tests pass then the final status code returned is zero. It will also print `PASS TEST: test_name` for each individual test.

Example of a fail on test 3 of a set of 4 - the run stops after the failed test, and the status is returned.
```
steve@lisar:~$ wesnoth-main.dev.debug -u test_assert -u test_assert -u test_assert_fail -u test_assert
Battle for Wesnoth v1.15.2+dev
... paths ...

Checking lua scripts... ok
PASS TEST: test_assert
PASS TEST: test_assert
FAIL TEST: test_assert_fail
steve@lisar:~$ echo $?
1
steve@lisar:~$ 
```"
341944621,AI: add [filter_own] to all candidate actions,mattsc,2019-11-18 03:18:01+00:00,2019-11-22 04:26:25+00:00,{'AI': 1},"This allows restricting the CA to only a subset of the units. It is a first step toward solving Issue #2349, which calls for adding `[filter_own]` tags to all candidate actions. In my experience, it is one of the most serious shortcomings of the default AI. See #2349 for more information and additional comments.

So far, this is only implemented for the move-to-targets CA, as I want to see if there are comments before I add it to the other CAs as well.

`[filter_own]` is chosen as the tag name, because that's what is used for the only CA (combat) for which this exists already."
341937533,Refactor the game map to permit exposing it to Lua,CelticMinstrel,2019-11-18 02:41:34+00:00,2021-03-04 19:00:59+00:00,"{'AI': 1, 'Campaign (any)': 1, 'Docs': 1, 'MP': 1, 'Editor': 1, 'Lua API': 1, 'Engine': 1, 'Terrain': 1}","Basically what this does is add `wesnoth.get_map()` which returns the same thing as the mapgen kernel's `wesnoth.create_map()` only referring to the actual map currently in use by the game.

I haven't had a chance to test it yet, but I'm opening it up for code review now."
341802683,AoH balance. ,Hejnewar,2019-11-16 23:43:51+00:00,2020-02-24 23:33:02+00:00,"{'MP': 1, 'Units': 1}","Drakes:
Cost of Drake Warrior changed from 30 to 32
Cost of Drake Arbiter changed from 31 to 32
Cost of Drake Trasher changed from 31 to 32
Cost of Flare Drake changed from 35 to 33
Cost of Fire Drake changed from 35 to 35
Cost of Sky Drake changed from	30 to 28
Cost of Saurian Ambusher changed from 30 to 24
Cost of Saurian Oracle changed from	27 to 28
Cost of Saurian Soothsayer changed from 27 to 25

Knalgan Alliance:
Cost of Dwarvish Steelclad changed from 32 to 36
Cost of Dwarvish Thunderguard changed from 30 to 27
Cost of Dwarvish Stalwart changed from 32 to 30
Cost of Dwarvish Berserker changed from 33 to 30
Cost of Outlaw changed from 28 to 26
Cost of Trapper changed from 27 to 21
Cost of Gryphon Master changed from 37 to 38

Loyalists:
Cost of Swordsman changed from 25 to 29
Cost of Knight changed from 40 to 38
Cost of Lancer changed from 40 to 44
Cost of Dragoon changed from 34 to 27
Cost of Duelist changed from 32 to 29
Cost of Merman Warrior changed from 28 to 26
Cost of Ogre changed from 33 to 30
Cost of Lieutenant changed from 35 to 29

Northerners:
Cost of Goblin Knight changed from 32 to 28
Cost of Goblin Pillager changed from 32 to 28
Cost of Troll changed from 29 to 27
Cost of Troll Rocklobber changed from 29 to 25
Cost of Naga Warrior changed from 27 to 24
Cost of Orcish Crossbowman changed from 26 to 21
Cost of Orcish Slayer changed from 33 to 26

Rebels:
Cost of Elvish Hero changed from 30 to 26
Cost of Elvish Captain changed from 32 to 28
Cost of Elvish Marksman changed from 37 to 31
Cost of Elvish Ranger changed from 38 to 31
Cost of Elvish Rider changed from 31 to 32
Cost of Elvish Druid changed from 34 to 27
Cost of Elvish Sorceress changed from 34 to 32
Cost of Elder Wose changed from 31 to 27
Cost of Merman Spearman changed from 27 to 27, movement changed from 6 to 7 and hp changed from 40 to 43.
Merman Javelineer - movement increased by 1 and hp increased by 3 in order to match Merman Spearman.

Undead:
Cost of Revenant changed from 28 to 31
Cost of Deathblade changed from 28 to 34
Cost of Dark Sorcerer changed from 32 to 33
Cost of Blood Bat changed from 21 to 22

Cost of Red Mage changed from 40 to 38
Cost of White Mage changed from 40 to 38

Forum link:
[here](https://forums.wesnoth.org/viewtopic.php?f=15&t=51028&p=648246#p648246)"
341794940,wip add wesnoth.create_side,gfgtdf,2019-11-16 21:48:16+00:00,2019-11-18 17:56:40+00:00,{},
341785621,Add steam runtime job to travis.,Pentarctagon,2019-11-16 19:42:12+00:00,2019-11-19 01:28:17+00:00,{},
341785618,Trackplacer as a read-only animation preview application,stevecotton,2019-11-16 19:42:11+00:00,2019-11-18 17:27:08+00:00,"{'Enhancement': 1, 'WML Tools': 1}","Combined with tmx_trackplacer, this now has feature-parity with the old version,
without the reliance on python2 or pygtk (fixes #4365).

Shows the journey without needing to start Wesnoth and refresh the cache.
Currently this does not have editing functions, instead it's a support program
which assumes you're either editing the .cfg file with a text editor or using
Tiled with tmx_trackplacer.

At least on Linux you can have both Tiled and this open on the same file. Save
the file in Tiled, alt+tab to this, and press enter to reload the file."
341784861,[WIP] some dunefolk sprite updates,doofus-01,2019-11-16 19:32:32+00:00,2019-11-28 15:31:00+00:00,"{'Graphics': 1, 'Units': 1}","So far includes soldier group, mostly.  Existing spearmen looked OK, this touches the swordsmen more. 
EDIT:  Adding a checklist.  I don't know if it's best to pack all sprites in here, I might commit this before the list is complete, if there are no objections.

- [x] Soldier - Swordsman branch
- [x] Soldier - Leader branch
- Soldier - Spearman branch needs no edits
- [x] Skirmisher line
- [ ] Healer line
- [x] Burner line
- [ ] Naga - melee branch
- [ ] Naga - ranged branch
- [ ] Horseman - Archer branch
- [x] Horseman - Sunderer branch
- [ ] Horseman - Raider branch
- Rover line needs no edits"
341735173,MP Connect dialog overhaul and server management UI for #4564,irydacea,2019-11-16 08:20:20+00:00,2019-11-17 21:05:30+00:00,"{'Enhancement': 1, 'UI': 1}","There has been functionality to manage custom servers in the player's preferences file since as far back as commit 5fb0b2a91123474d147c9de4918fc11a1b4c15ac in June 2007, but there's never been a user interface for it.

![image](https://user-images.githubusercontent.com/489895/68990311-a7822c80-0830-11ea-85d1-ce1dcec9db16.png)

This commit removes the current server list dialog attached to the MP Connect dialog and replaces it with the same functionality embedded into the latter, as well as the ability to edit the server list in the player's preferences file. There's some code movement in a few other places since the previous function in the preferences namespace doesn't suit the new code (it always returned a combined list of game and player-defined servers).

There's some disabled code referencing a situation where the listbox with the list of servers allows the code (and the player) to clear the selection. It's disabled because there are some UX issues with it noted in the code comments associated to it.

Fixes #4564."
341644553,Add mingw crosscompile job to travis.,Pentarctagon,2019-11-15 21:21:59+00:00,2019-11-16 00:54:50+00:00,{},"Of note:
* The image now created by Dockerfile-base-mingw is available on wesnoth's Docker Hub.
* Strict building is disabled, as there are a couple warnings that show up when crosscompiling.

---

Said warnings:
https://travis-ci.org/Pentarctagon/wesnoth/jobs/612518109#L449-L467
https://travis-ci.org/Pentarctagon/wesnoth/jobs/612518109#L1135-L1136
https://travis-ci.org/Pentarctagon/wesnoth/jobs/612518109#L1170"
340835690,Title screen: move language button to icon,nemaara,2019-11-14 07:52:21+00:00,2019-11-18 00:22:42+00:00,{'UI': 1},"For #4531. There's not much of a reason to have a big language button. @shikadiqueen suggested making it a globe icon in the lower right, so that's what this is for. Screenshot: 

![Capture](https://user-images.githubusercontent.com/13598479/68837117-e45fef00-0689-11ea-8c47-b7245c30e5f6.JPG)
"
340797109,Tutorial: move from title screen to campaign menu,nemaara,2019-11-14 05:37:02+00:00,2019-11-17 23:06:07+00:00,{'UI': 1},As discussed in #4543. Tagging @stevecotton for comments.
340748729,Move travis' dockerfiles to common directory.,Pentarctagon,2019-11-14 01:48:09+00:00,2019-11-14 01:48:15+00:00,{},
339744437,Backport #4362 and #4444,Wedge009,2019-11-12 06:10:54+00:00,2019-11-13 10:43:31+00:00,"{'Backport': 1, 'UI': 1}","Attempts to resolve #4469 for @jostephd. Looking at the two original PRs, it makes sense to me to keep them together."
339264725,gui2/text_box: Add hover effect,irydacea,2019-11-11 05:48:29+00:00,2019-11-11 06:16:40+00:00,"{'Enhancement': 1, 'UI': 1}",This gives GUI2 textboxes (and password boxes since they are a subclass) a simple hover effect by extending the canvas definitions for the widget accordingly.
339117466,Add a separate toggle for if a replay should be public.,Pentarctagon,2019-11-10 05:04:01+00:00,2019-11-12 00:13:52+00:00,{},"This makes it possible for a game to allow observers but have the replay not be public.

---

This resolves the second part of #3909"
337260836,Added tip of the day regarding changing difficulty level in a mid-campaign,slavrenyuk,2019-11-06 09:37:50+00:00,2019-11-06 20:04:37+00:00,{'Help': 1},"""The Wesnoth Tactical Guide"" is chosen because it is also used for these tips:
- Read the Hotkeys list in the Preferences menu ...
- You can see how far enemy units can move by moving the mouse cursor over them ...
- Nearly every button and icon in the Wesnoth game has a tooltip ...
- You cannot undo a move that uncovers hexes hidden by fog or shroud ..."
336955090,fix scons-codeblock project,newfrenchy83,2019-11-05 19:47:37+00:00,2019-11-05 20:49:34+00:00,{},
336954116,Fix codeblock project,newfrenchy83,2019-11-05 19:45:16+00:00,2019-11-05 20:49:14+00:00,{},
336595838,"Make ""Quit"" the only mandatory widget on the title screen",stevecotton,2019-11-05 04:57:31+00:00,2019-11-07 01:41:46+00:00,{'UI': 1},"Everything else is optional, so the UX can be changed simply by removing
buttons and the tips widget from the title_screen.cfg file."
336550411,Campaigns Menu: Make descriptions and abbreviations search terms,irydacea,2019-11-05 01:03:55+00:00,2019-11-06 17:32:41+00:00,{'UI': 1},"This should extend the dialog's usefulness in a way that is more or less consistent with the Add-ons Manager's search function. Although one issue is that abbreviations are often found floating around in their English form (""HttT"") instead of the various localized versions (""HaT"")."
336157588,TRoW: Fixed Haldric's defense animations,slavrenyuk,2019-11-04 08:09:59+00:00,2019-11-04 23:30:02+00:00,{'Units': 1},"Fixes https://github.com/wesnoth/wesnoth/issues/4541

When sword or ruby of fire is used, second animation will not pass filter and first one will be selected. When bow is used, second animation earns additional point for filter matching (see https://wiki.wesnoth.org/AnimationWML#Generic_animation_filters_available_for_all_animations) and will be selected."
336102279,Dunefolk - revisions to some base frame images,doofus-01,2019-11-04 02:29:58+00:00,2019-11-04 05:33:41+00:00,"{'Graphics': 1, 'Units': 1}","Some (not all) of the dunefolk need touch-ups, and any sprite design changes should be done now before there are animations.
Forum post for this:
https://forums.wesnoth.org/viewtopic.php?f=9&t=49075&p=648770#p648770"
336071411,Fix the add_completed_campaign() call for the tutorial,stevecotton,2019-11-03 21:31:17+00:00,2019-11-04 05:36:38+00:00,{},"When completing the tutorial, the preferences file's [completed_campaigns]
recorded that """" had been completed at difficulty NORMAL. This is an old
bug, unrelated to the other tutorial changes that I'm making, but would
cause problems if we want to change the UI based on whether the tutorial
has already been completed."
336071360,Replace the [tutorial] tag with [scenario],stevecotton,2019-11-03 21:30:52+00:00,2019-11-04 06:09:11+00:00,{},"The title screen's ""tutorial"" button will use the tag name from game_classification,
as would anything else that calls game_launcher::set_tutorial()."
336057777,[Dwarves] Buff some level 2 units,nemaara,2019-11-03 18:59:49+00:00,2019-11-12 17:58:43+00:00,{'Units': 1},"The counterpart to https://github.com/wesnoth/wesnoth/pull/4516, the steelclad/lord line was too strong, while other dwarvish level 2s are often too weak. Namely, Pathfinder and Thunderguard have too little HP (Pathfinder only has 42 and Thunderguard 44, compared to something like the Longbowman's 51, Pikeman/Swordsman 55). Additionally, the Stalwart and Sentinel do too little damage to justify their exp and costs (Stalwart has 7-3 melee pierce, the same as the level 1 Spearman,  but without even the firststrike special). Hopefully we can tweak their stats a bit to make them a bit better.

List of changes:
Pathfinder HP 42 -> 45
Thunderguard HP 44 -> 47
Stalwart Melee 7-3 -> 8-3
Sentinel Melee 9-3 -> 10-3

Tagging @soliton- and @Krogen2 for comments."
335911130,TRoW: added hint about Burin the Lost,slavrenyuk,2019-11-02 18:43:58+00:00,2019-11-07 10:54:14+00:00,{'Campaign (any)': 1},"Hint about Burin the Lost.

At the beginning of turn 2 Burin exits his house, silently chops some firewoods (winter is coming) and goes back to the house.

Suggestions are welcome (e.g. should Haldric say something about the dwarf?)"
335850370,Schema: attempt to fix specials used as abilities,newfrenchy83,2019-11-02 14:42:24+00:00,2019-11-11 06:19:14+00:00,{'Schema': 1},
335197815,[WIP] Add easter eggs to Liberty,Earth-Cake,2019-10-31 22:58:39+00:00,2019-11-29 19:36:57+00:00,{'Campaign (any)': 1},Adding easter eggs to Liberty and fixing a bug.
334986762,Dunefolk balance update. ,Hejnewar,2019-10-31 15:47:27+00:00,2019-11-08 06:43:27+00:00,{'Units': 1},"List of changes:
Level 1
Burner - Ranged damage increased from 6 to 7, melee damage decreased from 7 to 6.
Soldier line cold resistance increades from -10 to 0.
Herbalist hp increased from 29 do 32.

Level 2
Cost of Dune Explorer changed from 35 to 29.
Cost of Dune Swordsman changed from 38 to 30.
Cost of Dune Captain changed from 38 to 30, hp changed form 45 to 48.
Cost of Dune Spearguard changed from 38 to 30.
Cost of Dune Scorcher changed from 35 to 21.
Cost of Dune Raider changed from 36 to 35, (very unusual unit)
Cost of Dune Swiftrider changed from 36 to 38.
Cost of Dune Sunderer changed from 36 to 38, hp changed form 58 to 55.
Cost of Dune Apothecary changed from 33 to 26, hp changed from 39 to 43.
Cost of Dune Alchemist changed from 33 to 26.
Cost of Dune Strider changed from 33 to 23.
Cost of Naga Bladewhirler changed from 27 to 22.
Cost of Naga Ringcaster changed from 27 to 22, hp changed from 37 to 40.

Related form post:
https://forums.wesnoth.org/viewtopic.php?f=15&t=49627&start=90#p648535"
334887433,Corrected SotBE S11 objectives,slavrenyuk,2019-10-31 13:13:17+00:00,2019-10-31 15:24:06+00:00,{},"Per comment from @Konrad22 
> Hey, I've got a small issue with SotBE S11. Or rather with the scenario objectives. The defeat condition is 'Enemies control any villages on the north side of the river when turns run out' At least, that's what it says. The actual defeat condition is 'You don't control all villages on the north side of the river when turns run out' (There is one leaderless enemy side, so those two sentences don't mean the same thing.)"
332944673,new stone wall terrain variation -> catacombs,doofus-01,2019-10-28 04:26:34+00:00,2019-11-10 21:23:49+00:00,"{'Graphics': 1, 'Terrain': 1}","A modified stone wall, goal is to have overlays, animations, or something to make this useful for undead scenarios, but for now it's just the base terrain graphics images.
![catacombs1](https://user-images.githubusercontent.com/13510196/67651935-0aeaff80-f900-11e9-93d1-7c938caea446.jpg)
 "
332888455,Select correct game save after deletion,DisherProject,2019-10-27 20:05:14+00:00,2019-11-20 22:26:01+00:00,{'UI': 1},"This addresses #4125 
I tried saving some games, sorting them by name and deleting them, and this seemed to solve the issue, but I'm not 100% sure this works in all scenarios yet.
Unless i'm mistaken, game saves are displayed in a `listbox`-like object, but `delete_item` is called by `multi_page`s too, and i didn't test this piece of code in the latter case. If someone could help me understand where `multi_page`s are used i'll make some more checks."
332874352,revisions to mushroom terrain graphics,doofus-01,2019-10-27 17:10:53+00:00,2019-11-10 21:34:30+00:00,"{'Graphics': 1, 'Terrain': 1}","Addresses #4453, mostly by deleting the DISABLE_TRANSITION lines.  Also a couple other touch-ups."
332840015,Add other versions of Wesnoth to the Load Game dialog,stevecotton,2019-10-27 09:45:58+00:00,2019-11-03 11:21:02+00:00,"{'Ready for testing': 1, 'Engine': 1}","This has only been tested on Linux so far, I don't have the other OSes
to test on.

If a save directory from another version is found, a drop-down list of
directories is added below the filter box in the Load Game dialog.

Refactor save_index_class to allow instances for other directories.

Design idea: all new saves go in to the main save directory. Games can be
loaded from other directories, but those directories are treated as read-only.
When building an index for other directories, the index is kept in memory and
not written to disk - this results in some noticeable lag in the UI when opening
the other versions' directories, but not the usual save dir.

![wesnoth_load_old_dir](https://user-images.githubusercontent.com/101462/67632642-6b4d5300-f8a6-11e9-8e10-b1448560cda5.png)"
332835949,Added mushroom defense cap to mounted and several flying units,slavrenyuk,2019-10-27 08:45:03+00:00,2019-10-27 11:26:21+00:00,{},"PR for https://github.com/wesnoth/wesnoth/issues/4454

Adding mushroom defense cap to human mounted units, dunefolk mounted units and several flying units (Gryphon, Wyvern and Roc)

I noticed that dunefolk mounted units don't have forest defense cap. I will communicate to Hejnewar (who was working on the Dunefolk rebalancing) regarding that.

P.S. Hejnewar shared an idea of adding mushroom defense cap to orcs. However, that is debatable, so I am not adding it here."
332823256,Store additional fields in the database.,Pentarctagon,2019-10-27 04:14:49+00:00,2019-10-28 05:40:25+00:00,"{'MP': 1, 'Services': 1}","* Whether the game allows observers.
* Whether the game's replay should be publicly available (currently the same as whether observers are allowed pending the second part of #3909).
* Whether the game had a password set.
* The side's name - this differs from what can be retrieved from USER_ID since it will have the name of any AI used."
332754839,Changed Draug portrait in The Rise of Wesnoth,slavrenyuk,2019-10-26 10:10:00+00:00,2019-10-27 05:51:48+00:00,{'Units': 1},Fixes https://github.com/wesnoth/wesnoth/issues/4518
332736524,Rename some Dunefolk units,nemaara,2019-10-26 05:02:34+00:00,2019-11-09 00:52:09+00:00,"{'Units': 1, 'Prose': 1}","Like the title says. Some of the names could match stats a bit better (and descriptions, I suppose). Tagging @CelticMinstrel for any comments for fun."
332413780,Enforce and disable 'registered users only' option when connecting to official MP server,Wedge009,2019-10-25 09:07:38+00:00,2019-10-27 11:32:42+00:00,{'MP Lobby': 1},"Resolves #2939.

May not make sense to add this to master (see issue for discussion)."
332290604,Nerf Dwarvish Steelclad and Lord,nemaara,2019-10-25 00:15:34+00:00,2019-10-31 15:34:51+00:00,{'Units': 1},"Based on Krogen's argument here: http://forums.wesnoth.org/viewtopic.php?f=15&p=648448&sid=f2e07511b458d64bdb1b650c47a70651#p648335. I actually feel like there needs to be a slight HP nerf as well, but that might end up being overkill. "
332272239,Restore co-ordinates to classic theme,Wedge009,2019-10-24 22:48:00+00:00,2020-01-19 21:32:17+00:00,"{'UI': 1, 'Stable 1.14': 1}","Resolves #4053.

Classic theme lost co-ordinates since at least 1.14.6 - apparently due to work on the battery indicator. Tested to work with both battery and no battery indicator, as well as SP and MP.

No need for master, so I understand, because classic theme is supposed to be dropped in 1.15 (it doesn't look like it has been yet, though).

I don't know how classic theme used to look so it probably doesn't match how it used to be before the battery indicator was added."
331994480,Log a console error message when a parse_error closes the help,stevecotton,2019-10-24 11:20:31+00:00,2019-10-24 17:12:12+00:00,{'Help': 1},"Related to issue #4507, which is asking for better handling of the parse_error.
This commit doesn't improve the handling, but it will hopefully avoid anyone
spending time debugging to work out what text triggered #4507."
331265909,Move tool-tips to below-right,Wedge009,2019-10-22 23:25:05+00:00,2019-11-04 06:11:35+00:00,{'UI': 1},"Committing on behalf of @Landiss

Resolves #3274"
331262075,Disable game name for local MP,Wedge009,2019-10-22 23:11:32+00:00,2019-10-24 22:21:58+00:00,{'MP Lobby': 1},"Also remove redundant disablement of registered_users_ option.

Resolves #1122"
331243687,Fixed issue #4080,MeltedHyperion7,2019-10-22 22:19:02+00:00,2019-10-22 23:14:20+00:00,{},"I added a simple check before printing side name in the statistics dialog. I could not find a way to get leader name, so I simply print nothing if side name is not set."
330925768,po update of pr_BR translation,Alexandreae,2019-10-22 10:52:11+00:00,2019-11-21 00:45:11+00:00,{'Translations': 1},Fixes many of the errors on the current version of the pt_BR translation.
330806462,Add Time of Day Bonuses to Help (master),Wedge009,2019-10-22 05:01:23+00:00,2019-11-05 23:35:29+00:00,{'Help': 1},"Also mark 'Time of Day Schedule' and bonus strings for translation, to synchronise with what 1.14 branch has.

Resolves #3064"
330806446,Add Time of Day Bonuses to Help (1.14),Wedge009,2019-10-22 05:01:20+00:00,2019-11-05 23:35:20+00:00,{'Help': 1},"Also remove the string-freeze hacks.

Resolves #3064"
330173177,Orcish Ruler: Fix grammar in description,jostephd,2019-10-21 00:06:29+00:00,2019-11-19 06:59:48+00:00,"{'Bug': 1, 'Units': 1, 'Prose': 1}","In the construct ""not X, but Y"", it's not valid to have a preposition in X but not in Y.

@CelticMinstrel @Vultraz I revisited this and checked with @nemaara and I think that the existing text is incorrect after all."
330009854,Translations: drop languages with 3 or less translated strings,stevecotton,2019-10-19 11:14:15+00:00,2019-10-19 18:41:51+00:00,{'Translations': 1},"* Old English (ang)
* Friulian (fur_IT)
* Asturian (ast)

The ""Old English (Latin chars) (ang@latin)"" translation is not dropped.

The manpage uses ang_EN in the example of the command-line --language
option, which is then copied in to other translations. That isn't changed
in this commit.

To run pot-update, the wmlxgettext changes in #4485 are also needed.

Although the po4a scripts are updated, the update-po4a target currently
fails because of a typo in the pt_BR translation. (#4490)

Two scripts have a special case for ignoring ang_GB, both of these are
left unchanged on the assumption that old versions of Wesnoth may be
parsed with the latest version of the tools:
* data/tools/unit_tree/helpers.py
* data/tools/wmlunits"
329999474,update coeblocks projectfiles,newfrenchy83,2019-10-19 08:51:08+00:00,2019-10-19 09:02:49+00:00,{},
329973360,Fix schema rejecting top-level color range/palette tags,CelticMinstrel,2019-10-19 02:16:56+00:00,2019-10-19 02:18:18+00:00,{},Self-explanatory
329634381,wmlxgettext: support double quotes in raw strings (fixes #4484),stevecotton,2019-10-18 09:03:32+00:00,2019-10-19 18:37:40+00:00,"{'Blocker: New Stable': 1, 'Translations': 1, 'WML Tools': 1}","This adds support for _<<map=""{maps/01_First_Map.map}"">>.

@AncientLich , please would you review?"
329391216,Filter weapon in [filter student/opponent/etc] and rework [filter_(second_)weapon(pre 1.16 string),newfrenchy83,2019-10-17 18:03:35+00:00,2019-11-24 11:27:03+00:00,"{'Ready for testing': 1, 'WML': 1}","this is the third request for resolve https://github.com/wesnoth/wesnoth/issues/4389.

This time [filter(_second)_weapon] code is reworked and new syntax have priority."
329115032,[DiD]: add AMLAs to Mal Keshar and special units,nemaara,2019-10-17 07:44:39+00:00,2019-11-01 03:00:25+00:00,"{'Campaign (any)': 1, 'Units': 1}","Like the title says. Not quite done yet, but planning to finish by 1.15.3."
329060312,test,Pentarctagon,2019-10-17 04:31:58+00:00,2019-10-17 04:34:18+00:00,{'MP': 1},
329042740,units: Add custom [special_note]s.,jostephd,2019-10-17 03:03:11+00:00,2019-10-19 02:56:44+00:00,"{'Enhancement': 1, 'Docs': 1, 'Units': 1, 'Help': 1}","Add special_notes that summarize the movetype differences between level 2 units and their respective level 1 forms, to make the differences easy to discover."
328839870,Upgrade special=* uses in master,newfrenchy83,2019-10-16 16:03:30+00:00,2019-10-19 01:46:18+00:00,"{'Enhancement': 1, 'Campaign (any)': 1}",now what special is deprecated it must replace in master for resolve https://github.com/wesnoth/wesnoth/issues/3915
328610369,"Display translated string for ""random"" in MP staging",Wedge009,2019-10-16 07:24:43+00:00,2019-10-16 07:38:01+00:00,{'MP Lobby': 1},"Resolves #2954

If acceptable, can go to 1.14 branch too."
328455659,Make a unit respond to mouse-clicks after end_unit_turn (fixes #4466),stevecotton,2019-10-15 20:40:29+00:00,2019-10-16 05:24:12+00:00,"{'Bug': 1, 'UI': 1, 'Input': 1}","This was an edge-case when the player had only one unit, logged as #4466.

This change looks fairly straightforward, will merge it tomorrow if it doesn't have any comments."
328021873,"Update credits: add Earth-Cake, update octalot, newfrenchy83",stevecotton,2019-10-15 00:24:00+00:00,2019-10-15 14:46:40+00:00,{},"* add @Earth-Cake
* add my nickname (octalot)
* correct the number in @newfrenchy83's name

Earth-Cake and newfrenchy, are these both as you want them?"
327651790,Contributing.md: Mention UTF-8 and remove the Tolken references,stevecotton,2019-10-14 05:52:50+00:00,2019-10-16 10:44:24+00:00,{'Docs': 1},
327638133,trackplacer3 a utility to export and import tmx files (#4365),stevecotton,2019-10-14 04:36:02+00:00,2019-11-14 12:49:07+00:00,{'WML Tools': 1},"The python2 trackplacer included both the handling of the file format, and the
GUI application. This trackplacer3 is a library for the file format, without
the GUI.

The tmx_trackplacer is a command-line tool for exporting the data to Tiled's
.tmx format, and re-importing it back to .cfg files, so that the GUI of Tiled
can be used to avoid reimplementing the GUI of Trackplacer in Python 3.

The implementation uses Tiled's Object Layers (not Tile Layers).  This allows
additional journey markers to be added with the ""Insert Tile"" tool, and
additional journeys to be added as new layers.

It can also read in a .cfg and then re-export it to a new .cfg file, to see if
the data is preserved. The format is chosen by the output filename.

----- Comments on the mainline campaigns: -----

AToTB, DM, LoW, NR and THoT will work with this. But:

Northern Rebirth's bigmap.cfg has a track RECOVERY whose STAGE1 starts with
an OLD_REST - that isn't handled by trackplacer, it must have been hand-edited.
That OLD_REST will be lost when read by either trackplacer2 or trackplacer3,
similarly the OLD_BATTLE of LoW's SAURIANS track will be lost.

Delfador's Memoirs SEARCH_STAGE1 is omitted from all subsequent parts of
SEARCH. Also in DM, SEARCH_STAGE3 has a point which is then moved in STAGE4
onwards - I guess a hand edit. Both of this will be overwritten if the file
is edited with either this tool or with the python2 trackplacer.

SotA's journey_chapter*.cfg files and WoV's bigmap.cfg file have some of the
trackplacer comments removed, they won't be handled by this tool, at least not
until better error handling is added."
327586252,Fix #4456: Sidebar abilities display leaks shrouded information,blaf,2019-10-13 19:41:24+00:00,2022-08-31 22:23:48+00:00,{'UI': 1},
327512358,lua: Add __tostring to units,jostephd,2019-10-13 00:45:49+00:00,2019-10-16 04:13:31+00:00,"{'Enhancement': 1, 'Ready for testing': 1, 'Lua API': 1}",Makes it easier to test SUFs with wesnoth.get_units{} in the lua console.
327014769,Changes to deprecation logging and deprecate --userdata-dir=relative-path,jostephd,2019-10-11 03:42:46+00:00,2019-10-15 01:12:31+00:00,"{'Bug': 1, 'Command Line': 1, 'Engine': 1}","See individual commit messages for details.

I'd like to backport the wesnoth.cpp and deprecated.cpp parts. I'm not sure if I should backport the filesystem.cpp changes too.

The filesystem.cpp part is for issue #2000."
326521902,Store the client version in the database.,Pentarctagon,2019-10-10 02:33:23+00:00,2019-10-20 18:57:47+00:00,"{'Services': 1, 'Packaging': 1}",This will now store the version of the client playing a side in `game_player_info`.
326505560,recruit dialog: Gray out units that will not be able to be recruited,jostephd,2019-10-10 00:59:55+00:00,2019-10-16 03:52:49+00:00,{'Ready for testing': 1},"Fixes #4443. This doesn't add or remove any units to the recruit dialog, it simply makes units that will fail to be recruited be listed in gray.

See the individual commits for details."
326463170,Display: Don't move the center of the viewport when zooming in when the map is narrower/shorter than the viewport,jostephd,2019-10-09 21:49:48+00:00,2019-10-15 01:10:19+00:00,"{'Enhancement': 1, 'UI': 1}","In the test scenario, toggling between 50%/100% zoom on 1920x1080 will now correctly switch between ""Show the entire map"" (50%) and ""Show just the center of the map"" (100%).

Fixes #1951"
325805358,Experimental AI: make AI recruit higher level units,mattsc,2019-10-08 14:38:12+00:00,2019-10-17 14:09:54+00:00,{'AI': 1},"The ExpAI recruits almost no higher level units. In the scenarios I tested with default era units, there's maybe one L2 unit recruited every dozen or so recruits.  Yet, it's reasonable to assume that if scenario designers give the AI higher level units to recruit, they expect that to happen not just sporadically.

The reason why almost no L2s or higher are recruited might be partially because unit cost is not as well balanced for the higher level units.  But mostly it happens because cost is penalized by the ExpAI recruiting.  This is in order ""to avoid recruiting many expensive units -- there is a requirement for bodies in order to block movement"" as per a comment in the code. I don't want to change that, as it would mess up the recruiting ratios of L1 units of different cost, so instead I am adding a bonus for higher level units that increases as the high-to-low-level units ratio decreases.  A few comments on that:

- The code tries to recruit so that the ratio of level i+1 to level i units is _approximately_ `high_level_fraction`.  The evaluation could be set up so that that this ratio is exact, but I actually think it is better to make it an approximate ratio, it adds a bit variety and unpredictability.
- `high_level_fraction` could be made a configurable parameter.  The current value of 0.33 is chosen because having 1 L2 for every 2 L1 units ""sounds about right"", but this is clearly somewhat dependent on the scenario.  I don't currently know how to do that when setting up the ExpAI using `ai_algorithm=` though (I do know how to do it when it is set up as rush recruiting Micro AI), but I am sure I can figure it out.
- The factor 0.25 in the equation for the bonus is chosen because in my tests this was roughly the average rating difference between L1 and L2 units of the same advancement tree.  The exact value does not matter all that much though because of the square on `unit_deficit`.
- I only start the bonus at L2 units.  There's no such bonus for the relative ratio of L1s to L0s, as those are handled pretty well already (likely because their cost is balanced better in the default era).

@sevu You brought this up.  Any comments?
@Alarantalara Pinging you in case you are still around and interested in following this."
325207824,Insert [filter weapon] in filter student/opponent/etc.] for weapon like abilities(1.15/1.16),newfrenchy83,2019-10-07 09:30:50+00:00,2019-10-17 18:00:51+00:00,{},i doing stupid thing in old PR and a post another in replacement for resolve https://github.com/wesnoth/wesnoth/issues/4389
325013837,"Tutorial S02: Show ""recruit the right units"" when the player has gold",stevecotton,2019-10-06 08:46:39+00:00,2019-10-08 17:39:55+00:00,"{'Ready for testing': 1, 'Campaign (any)': 1}","It's confusing when it pops up on turn 12, regardless of the game state. My
leader is normally on the other side of the river from my keep, and I always
wonder ""what about my play triggered that?""

Move the message to be part of the ""I now have enough gold to recruit more
units"" hint."
324977470,Preprocessor: Add {LEFT_CURLY} and {RIGHT_CURLY} escape sequences,jostephd,2019-10-05 21:22:44+00:00,2019-10-15 01:08:47+00:00,"{'Enhancement': 1, 'Ready for testing': 1, 'WML': 1}",See #4414
324969759,Simple Attack Micro AI Demo: Update dialogue for 1.14's AI improvements,stevecotton,2019-10-05 19:37:30+00:00,2019-10-06 04:46:01+00:00,{},"@mattsc a suggestion for https://github.com/wesnoth/wesnoth/issues/3450#issuecomment-538598827

The default 1.14 already considers high-XP attacks.  Other than the dialogue,
the only change is to reduce the AI's default aggression, so there's more
contrast between what the Micro AI does compared to what the default AI does.

Switched to typographic quotation marks in the dialogue, and removed double
spaces between sentences."
324944094,fix float_label too fast in some cases,gfgtdf,2019-10-05 14:25:23+00:00,2020-03-19 02:07:33+00:00,{},"fixes https://github.com/wesnoth/wesnoth/issues/4347

the fix kinda works but for some reason it created errors, when undrawing out-of-map  parts. Also i feel dirty after touching the drawing  code."
324854944,Fix the MP lobby reloaded indicator always saying the game isn't reloaded.,Pentarctagon,2019-10-04 21:23:46+00:00,2019-10-06 15:31:22+00:00,{},"Currently, the value of `game[""savegame""]` is one of `mp_game_settings::SAVED_GAME_MODE`.  However, the `to_bool()` function doesn't recognize any of those values as being true, so a game is always shown in the MP lobby as not being a reload, even if it actually is."
324480440,Tutorial S02: Make the grunt cross the bridge without bait,stevecotton,2019-10-04 02:16:39+00:00,2019-10-05 18:26:56+00:00,{'Campaign (any)': 1},"Not a code-revert, but a behavior-revert of the switch of this unit to use the guardian AI, which was done in 26327a5bdc41180ae1a4b73bffbaf668ca2c31da.
@Vultraz , was the guardian AI used simply because of the crash-on-village-capture bug that's mentioned in that commit?

@beetlenaut , @jostephd, @Earth-Cake this PR seems the minimal change to solve the difficulty bug discussed in #4399. I agree that bigger changes could be better, but this makes the situation better than before."
324281953, resolve Check whether special is active by tag name or by id (bis),newfrenchy83,2019-10-03 15:40:48+00:00,2019-10-16 02:59:55+00:00,{},replace https://github.com/wesnoth/wesnoth/pull/3920 PR for resolve https://github.com/wesnoth/wesnoth/issues/3915
323607963,Remember tile_size/zoom factor between play sessions,Wedge009,2019-10-02 06:47:02+00:00,2019-10-16 04:27:51+00:00,{'UI': 1},"Resolves #1518

I don't know if this is the 'right' way to do things - there are a lot of places where preferences are set. There is a display preferences class and a display class, but also most things seem to be recorded in general preferences class. `tile_size` is referred to in `game_config.cpp` and the actual zooming is done inside the display class, using `game_config::tile_size` as the `DefaultZoom`. The default `tile_size` seems to be hard-coded to 72 in a few places.

Regardless, this seems to work for me."
323526486,Rename [unit_type_fix] to [modify_unit_type] for clarity.,Pentarctagon,2019-10-02 00:11:58+00:00,2019-10-04 16:17:42+00:00,{},
323498482,EI: Miscellaneous small changes,jostephd,2019-10-01 22:12:32+00:00,2021-03-20 07:55:11+00:00,{'Campaign (any)': 1},
323449767,"Tutorial S2: When a second Shaman is recruited, say that the healing doesn't stack",stevecotton,2019-10-01 19:57:49+00:00,2019-12-28 18:38:48+00:00,"{'In-progress': 1, 'Campaign (any)': 1, 'Prose': 1}",
322992773,"Re-enable the editor help, and use it to document the keyboard modifiers",stevecotton,2019-09-30 21:57:51+00:00,2019-10-08 17:28:21+00:00,"{'Ready for testing': 1, 'Docs': 1, 'Editor': 1, 'Help': 1}","... with the idea that these pages will either be improved or hidden again before 1.16.0. I think the terrain-editor part is good enough to stay in 1.16. The scenario editor part would have to be updated by someone familiar with that part.

This puts the two tips that are currently in https://wiki.wesnoth.org/MapEditor in to the in-game text."
322872272,Help for the ^Uf mushrooms terrains + display carets to the user (#4359),stevecotton,2019-09-30 16:35:29+00:00,2019-10-06 21:55:39+00:00,"{'Translations': 1, 'Editor': 1, 'Prose': 1}","Two commits, which I've put in the same PR because the new mushroom text will be the first text displaying carets to the user. Will happily merge just the .cpp change if the prose needs more work.

Allow translatable strings to display carets to the user (#4359)
---

Treat `editor^The overlays '^Uf' and '^Ufi' are deprecated because ...` as a having translation hint `editor`, and show ""The overlays ..."" to the user. This disallows using carets inside the translation hint itself.

Code already reviewed in the discussion in #4359.

Help for the ^Uf mushrooms terrains, including an editor-only hint
---

As the terrain is hidden in help, these hints can only be seen by using the ""Terrain Description"" command on a ^Uf or ^Ufi mushroom hex, and then switching to the overlay's own page.

A hint for players about how these mushrooms behave, and an editor-only hint about replacing the ^Uf mushroom terrains with ^Tf."
322867995,Improve the terrain code's encapsulation,stevecotton,2019-09-30 16:24:55+00:00,2019-10-03 12:30:05+00:00,{'Engine': 1},"Change terrain_type_data's documentation and some methods to avoid exposing
implementation details, for example renaming try_merge_terrains to is_known.

Move the code to load all the [terrain_types] in to the terrain_type_data
class's own .cpp file, and out of terrain.cpp.

Add documentation about ""underlying"", and why worst(best(a,b),c,d) terrains don't work
The commented-out code for merging pluses and minuses in the middle of an alias
was commented out in 1.5's d2edbe118a5f49ca96268c6b5f6a4b2110df7cc2, but the
concept of pluses and minuses in the middle of an alias seems broken anyway
(see comments added to merge_alias_lists in this commit).

Descriptions are t_strings, avoid converting them to std::string and back."
322862032,"Status table: In replays with ""View: Full Map"", show all sides' gold status",jostephd,2019-09-30 16:10:09+00:00,2019-10-10 02:22:21+00:00,"{'Enhancement': 1, 'Replays': 1}","Note that all sides' gold status is already shown whenever debug mode is active.

Fixes part of #4134"
322853980,Addon manager: Save the last sort order in a hidden preference,jostephd,2019-09-30 15:51:28+00:00,2020-11-14 23:48:38+00:00,"{'Enhancement': 1, 'Add-ons': 1}",Is this okay? I assume there's a better way to do the conversions from SORT_ORDER to int and back.
322736050,mp_create_game: Show preview if map_file is set,jostephd,2019-09-30 11:40:51+00:00,2019-10-10 21:33:12+00:00,{'Ready for testing': 1},"Fixes the second bullet of https://github.com/wesnoth/wesnoth/issues/4397#issuecomment-536357310.

Could someone double check the change to the generator_assigned condition? Is it about the case that a scenario file defines both map_file and a map generator? I would have expected that to be an error, actually."
322538667,Add debug command :terrain.,jostephd,2019-09-29 20:39:00+00:00,2019-10-10 02:08:27+00:00,"{'Enhancement': 1, 'Engine': 1}",Usage: `:terrain <terrain type> [both|base|overlay]`
322457856,Tutorial menu (S3): Add a scenario where the player can choose the next tutorial,stevecotton,2019-09-29 00:53:35+00:00,2019-11-04 16:18:50+00:00,{'Campaign (any)': 1},"This is meant to make it clear to the player that they've finished the
""required"" tutorial, and are now ready for the campaigns, but also to allow
additional scenarios that are along the lines of the Tactic Puzzles addon."
322415213,THoT: fix bigmap for the removed Troll Bridge,stevecotton,2019-09-28 13:51:40+00:00,2019-09-28 15:44:18+00:00,{'Campaign (any)': 1},"@nemaara, please would you review this?"
322260122,"HttT: Avoid ""Prince"" as a direct address",jostephd,2019-09-27 17:34:27+00:00,2020-09-12 01:29:42+00:00,"{'Enhancement': 1, 'Needs more info': 1, 'Campaign (any)': 1, 'Prose': 1}","As suggested in #4367.

Konrad is addressed sometimes by his units, sometimes by Kalenz/Delfador, and sometimes by leaders of allied or enemy sides. I tried to get it right but please review.

@nemaara, are there any further changes you want to make beyond these?

I've also renamed Konrad and Li'sar to `Prince Konrad` and `Princess Li’sar`, to make it clear why he's addressed as a highness."
322241080,Store in the database whether the game is a reload or not.,Pentarctagon,2019-09-27 16:35:10+00:00,2019-09-28 07:27:21+00:00,{'Network': 1},
321979104,Replace hot-key markers with initials,Wedge009,2019-09-27 02:59:08+00:00,2019-09-29 18:07:06+00:00,{'UI': 1},Suggested in https://github.com/wesnoth/wesnoth/issues/1152#issuecomment-535022785 and mitigates #1499.
321081426,Remove config-dir/path CLI compatibility,Wedge009,2019-09-25 06:27:23+00:00,2019-09-27 14:46:03+00:00,{'Command Line': 1},#1466
321076391,Disable replay saving based on preferences,Wedge009,2019-09-25 06:09:30+00:00,2019-09-27 01:21:30+00:00,{'Replays': 1},"Feel free to close this if I'm doing this the 'wrong' way, but given the information in #1457 this is what I came up with.

Tested:
- Saving with replay saving enabled retains existing functionality of including replays in save games.
- Saving with replay saving disabled excludes replay sections from save games.
- Switching a game in progress from save-replays to do-not-save-replays functions as expected.
- Switching a game in progress from do-not-save-replays to save-replays functions as expected.
- Finishing a scenario where the start of the game did not have replays saved, but replay saving was introduced mid-game results in a functional replay albeit one which has no information prior to where replays were enabled (of course)."
320814660,fix negative value of [defense],newfrenchy83,2019-09-24 14:55:40+00:00,2019-09-24 15:28:19+00:00,{},the negative value of forest in mounted movetype was origins of a bugs. Fix https://github.com/wesnoth/wesnoth/issues/4379?_pjax=%23js-repo-pjax-container
320654560,backport wesnoth_addon_manager port mapping,vgaming,2019-09-24 08:47:48+00:00,2019-09-24 09:17:43+00:00,{},"this allows using wesnoth_addon_manager from the stable
branch to upload addons to 1.15.

I think it makes sense because wesnoth_addon_manager is
a tool that by design works with multiple wesnoth versions.

CC @soliton- "
320372872,"TRoW S04a S04b: From Midlands, make Swamp the next scenario",stevecotton,2019-09-23 16:12:24+00:00,2019-11-03 11:56:40+00:00,"{'Campaign (any)': 1, 'Prose': 1}","Originally two commits, the first one is now merged. I expect debate and possibly rejection of the remaining commit in this PR.

TRoW S04a S04b: Move Sir Ladoc / Sir Ruddry to the victory event

This means that they join even when debugging with the :next_level command.

The enemies_defeated event could be replaced by victory_when_enemies_defeated
and the appropriate carryover amounts, but that should probably be done as a
single commit updating the entire campaign.

@nemaara - this is similar to #3801, please would you review it?

TRoW S04a S04b: From Midlands, make Swamp the next scenario
---

The Midlands is the more challenging option, but means missing out on an auto-recalled loyal white mage. The journey map also shows that The Oldwood is east of The Swamp of Esten, and it makes little sense that they reach Oldwood without passing through the swamp. Solve both problems by making The Midlands an optional detour which still ends up going through the swamp.

If the player took the extra XP by going through The Midlands, the turn limit on The Swamp is much tighter. Sir Ruddry will appear during the start event, tell Haldric about the road ahead, and then die - Sir Ladoc gets an exposition that only one of the two knights can survive.

I've left the scenario number unchanged, although this means that 04b will occur (if the player chooses to go there) before 04a."
320362160,Lua wesnoth.deprecate_api bug when deprecating tables with metatables,jostephd,2019-09-23 15:47:15+00:00,2019-09-26 12:17:06+00:00,{'Lua API': 1},"See commit messages for details.

Fixes #4079 

Test case: start the test scenario, click on the petrified Elvish Avenger, and see whether the ""petrified"" icon appears in the sidebar."
320063270,"Overlay deprecated terrains in the editor with a magenta ""D""",stevecotton,2019-09-22 16:58:52+00:00,2019-09-27 20:55:12+00:00,"{'Enhancement': 1, 'Editor': 1}","Fixes #4354. Some of the deprecated terrains look similar to their replacements, for example the stone walls with sconces (Xol vs Xos^Efs) or the mushrooms (^Uf vs ^Tf). This is a feature to make the deprecated terrains easily visible in the editor.

The image is a fully opaque letter, but leaving many completely transparent pixels to see the underlying hex. When replacing the old mushroom overlay, it's helpful to be able to easily recognise the base terrain.

optipng has been run.

Sample image, showing mushrooms and two `Xol`, one of them with an impassible overlay on top:
![wesnoth_d_for_deprecated](https://user-images.githubusercontent.com/101462/65391514-63ac0300-dd6a-11e9-996f-547a27a73c7b.png)
"
319966030,"add ""filter_weapon"" inside filter_special tags for weapon like abilities(enhancement)",newfrenchy83,2019-09-21 14:52:58+00:00,2019-10-07 08:09:21+00:00,{},"Until now, in the similarity to the special weapons, filter_weapon had to be placed outside [filter_ (student, oponent, attacker, defender)], this PR offers a solution to complete these abilites so that their codes are identical to the weapons special minus the tags specific to the ability. Resolve https://github.com/wesnoth/wesnoth/issues/4389"
319815840,Fix [leave_game] being ignored by clients during linger.,Pentarctagon,2019-09-20 17:33:22+00:00,2019-09-25 19:58:00+00:00,{'MP': 1},"This affects the stopgame command and :kick, for example.

Fixes #4370"
319753781,NR S06a: Fix the filter for Tallin complaining that they're sitting in the caves,stevecotton,2019-09-20 14:42:28+00:00,2019-10-03 13:52:54+00:00,"{'Bug': 1, 'Campaign (any)': 1}","Now it only triggers if five or less units are outside. Every unit in the cave but illuminated by a MoL is counted as inside, not outside."
319463425,HttT: dialog tweaks and additions,jostephd,2019-09-19 21:07:56+00:00,2019-10-10 02:17:13+00:00,"{'Enhancement': 1, 'Ready for testing': 1, 'Campaign (any)': 1, 'Prose': 1}","Originally from [this forum post](https://forums.wesnoth.org/viewtopic.php?f=38&t=43099&p=647379#p647362), although there's very little resemblance between the suggestions there and this PR.

Does the `Timber!` line work? I'm not sure. If it doesn't, I'll just delete that line so the flow is (thunderstick sound) (Konrad: What was that?) and then Delfador's line. Maybe have a dwarf say that it must be Lord Geldar's clan up ahead."
319408377,"Add color names to the Status Table, sidebar and top bar",jostephd,2019-09-19 18:31:40+00:00,2019-09-26 15:58:03+00:00,{},Fixes #1217
319372858,Clean up some Cppcheck warnings by passing args as const refs,stevecotton,2019-09-19 16:55:03+00:00,2019-09-20 07:34:19+00:00,{},"Opening a PR to check the CI builds on all platforms, but not expecting any problems."
318882632,unit_recall: Show unrecallable units grayed out.,jostephd,2019-09-18 15:48:44+00:00,2019-09-26 16:07:45+00:00,"{'Enhancement': 1, 'UI': 1}","Part of issue #1282.

Looks like this:

![2019-09-18-154113_1024x768_scrot](https://user-images.githubusercontent.com/24784687/65163884-58379f80-da2b-11e9-8428-7c0441f00530.png)

- [x] add a tooltip with the reason the unit is grayed out

<details>

<summary>
test case
</summary>

```
diff --git a/data/campaigns/An_Orcish_Incursion/scenarios/01_Defend_the_Forest.cfg b/data/campaigns/An_Orcish_Incursion/scenarios/01_Defend_the_Forest.cfg
index 53ea5f5be8e..596689ec975 100644
--- a/data/campaigns/An_Orcish_Incursion/scenarios/01_Defend_the_Forest.cfg
+++ b/data/campaigns/An_Orcish_Incursion/scenarios/01_Defend_the_Forest.cfg
@@ -50,7 +50,7 @@
     [side]
         side=1
         controller=human
-        {GOLD 200 150 100}
+        gold=20
         income=0
         team_name=Elves
         user_team_name= _ ""Elves""
@@ -61,6 +61,10 @@
 
         facing=nw
 
+        {UNIT 1 Mage recall recall ()}
+        {UNIT 1 Mage recall recall (recall_cost=25)}
+        {UNIT 1 Peasant recall recall ()}
+
         [unit]
             side=1
             type=Elvish Rider
```

</details>"
318745372,Avoid overwriting an invalid/corrupt preferences file.,jostephd,2019-09-18 10:40:04+00:00,2019-11-11 06:25:27+00:00,"{'Regression': 1, 'Engine': 1}","For #1326

Example:

```
$ mkdir /tmp/foo
$ echo '[foo]' > /tmp/foo/preferences
$ ./wesnoth --userconfig-dir=/tmp/foo
```

Before this patch, /tmp/foo/preferences would be overwritten.  With this patch, it would be preserved."
318720163,Added translation prefix to female saurian unit types.,slavrenyuk,2019-09-18 09:39:20+00:00,2019-09-18 16:43:11+00:00,{},This PR adds `female^` prefix to the female saurian unit types to help with proper translation. See also https://github.com/wesnoth/wesnoth/commit/7027930cf1766e4c3d0c9e0138dbbc55adc4bfbe
318421522,fix shema validation for all weapon like abilities,newfrenchy83,2019-09-17 16:22:39+00:00,2019-09-21 18:01:22+00:00,{'Schema': 1},I commit a separate PR because https://github.com/wesnoth/wesnoth/pull/3920?_pjax=%23js-repo-pjax-container don't merged before 1.16 (i put this in april)
318283283,Fix grammatical error,newfrenchy83,2019-09-17 11:04:19+00:00,2019-09-17 11:06:05+00:00,{},
317656579,Remove support for legacy menu markup,CelticMinstrel,2019-09-15 17:34:27+00:00,2019-09-19 02:48:54+00:00,{},"Since it was removed from `[message][option]` already, perhaps we should remove it entirely. After all, the deprecation message does say it'll be removed in 1.15.x."
317648139,Update to new special notes syntax in campaigns,CelticMinstrel,2019-09-15 15:34:12+00:00,2019-09-15 17:40:35+00:00,{},"This is just here to make Travis run a build. As soon as it passes (well, assuming it does), this can be merged. (Preferably not squash-merged.)"
317554329,Hide the Suppose Dead hotkey from the preferences,jostephd,2019-09-14 11:13:19+00:00,2019-09-18 14:05:59+00:00,"{'Bug': 1, 'UI': 1, 'Whiteboard': 1}",
317525759,Restore localised load dialogue (master),Wedge009,2019-09-14 02:01:08+00:00,2019-09-16 06:25:35+00:00,{'Translations': 1},See #1709.
317524825,Restore localised load dialogue (1.14),Wedge009,2019-09-14 01:51:48+00:00,2019-09-16 05:47:50+00:00,{'Translations': 1},See #1709.
317497069,add deprecated terrain to wmllint,sevu,2019-09-13 22:04:10+00:00,2022-06-27 20:39:19+00:00,"{'Enhancement': 1, 'WML Tools': 1}","This code is not offered in the map editor anymore. Are there more cases?
And where else could we communicate that this is deprecated?"
317470802,Add UI button to stop a game.,Pentarctagon,2019-09-13 20:23:17+00:00,2019-09-14 16:10:07+00:00,{'MP': 1},"This adds a button along side the kick/kickban/ban buttons to stop the game the selected user is in.

Fixes #3635"
317368563,Add optional reason when using the stopgame command.,Pentarctagon,2019-09-13 15:08:47+00:00,2019-09-13 15:08:54+00:00,{},"So now: `/query stopgame <nick> [<reason>]`. The reason is displayed to the players of the game on the savegame prompt dialog.

Backport of 14c0272948acee6003185f6f585990785c724980"
316736929,Clarify descriptions of income and upkeep.,jostephd,2019-09-12 05:34:57+00:00,2019-09-14 07:58:13+00:00,"{'Enhancement': 1, 'Prose': 1, 'Help': 1}",
316483458,UtBS: Replacing ^Uf mushrooms with ^Tf mushrooms,stevecotton,2019-09-11 14:38:43+00:00,2019-09-12 20:41:52+00:00,"{'In-progress': 1, 'Campaign (any)': 1}","Using #4299's mushrooms in Under the Burning Suns.

The code for flooding in 08_Out_of_the_Frying_Pan uses a list of impassible terrains,
anything not in that list can flood so there's no change needed to that code.

The Sun Sylph's animation code now recognises both types of mushroom, in case the
Quenoth elves are used in UMC campaigns."
316478796,EI: Replacing ^Uf mushrooms with ^Tf mushrooms,stevecotton,2019-09-11 14:29:03+00:00,2019-09-12 20:41:23+00:00,{'Campaign (any)': 1},Using #4299's mushrooms in Eastern Invasion.
316469902,HttT S15: Improve dialog flow when Geldar survives,jostephd,2019-09-11 14:11:29+00:00,2019-09-14 07:57:38+00:00,"{'Campaign (any)': 1, 'Prose': 1}",Fixes #4333
316390900,backport SConstruct have_fortify change,vgaming,2019-09-11 11:00:55+00:00,2019-09-11 12:32:17+00:00,{},See 7437b3992e3de4467bd76659b684285442d578d9
315458955,HttT S23: Give a more explicit hint on EASY,jostephd,2019-09-09 10:17:53+00:00,2019-09-14 07:57:13+00:00,"{'Enhancement': 1, 'Campaign (any)': 1, 'Prose': 1}","There's a dialog hint just above the diff:

https://github.com/wesnoth/wesnoth/blob/57668733a26e04671025905935cea00555cd06a5/data/campaigns/Heir_To_The_Throne/scenarios/23_Test_of_the_Clans.cfg#L299-L302

But on EASY, make the hint explicit.

Come to think of it, the dialog hint is actually ambiguous: ""defeat me personally"" can be understood as though Konrad has to attack Lord Bayar, can't it? So how about removing the word ""personally"" from that line?"
315316070,Various bug fixes,Earth-Cake,2019-09-08 23:15:56+00:00,2019-09-10 13:05:26+00:00,{},"Corrected a typo, added unit file to Wose Sapling (full, before was base unit Wose), and added special notes to unit in NR."
315314314,Merge pull request #1 from wesnoth/master,Earth-Cake,2019-09-08 22:46:55+00:00,2019-09-08 22:47:11+00:00,{},Update
315226180,Tutorial damage dealt numbers fixes,Earth-Cake,2019-09-07 21:26:13+00:00,2019-10-14 23:21:31+00:00,{'Units': 1},"There have been ""irregularities"" in damage dealt numbers, depending on was an elf strong / dexterous, or not. If unit has strong / dexterous trait, attack damages are adjusted, which wasn't included in tutorial text before."
315163557,Add optional reason when using the stopgame command.,Pentarctagon,2019-09-07 03:49:24+00:00,2019-09-13 07:32:21+00:00,{'MP': 1},So now: `/query stopgame <nick> [<reason>]`. The reason is displayed to the players of the game on the savegame prompt dialog.
315151361,UtBS S09: Non-merfolk get in the ships before they sail off,stevecotton,2019-09-07 00:37:30+00:00,2019-09-07 02:02:13+00:00,{'Campaign (any)': 1},"At the end of S09, the heroes have four ships. The narrative is that all the
elves are on the ships, but the in-game visuals were that the ships move while
all the player's units are standing on the shore.

The heal=yes isn't needed since 74c2398f6, but adding it here avoids
a possible bug if this commit is backported to 1.14."
314879109,Resolving date inconsistency,clockback,2019-09-06 09:47:24+00:00,2019-09-26 20:36:02+00:00,{},"This bug was a problem: https://github.com/wesnoth/wesnoth/issues/4314
The discussion regarding it can be found here: https://forums.wesnoth.org/viewtopic.php?f=8&t=50702"
314490555,Show current acceleration speed when activating,Wedge009,2019-09-05 13:02:52+00:00,2019-09-07 02:07:56+00:00,{},"Quick attempt to give some sort of feedback for #1311. I'm sure there are better ways to handle this, though, plus I recognise there's no translation handling (I was trying to avoid breaking existing strings). If it is acceptable, however, it can also go in master."
314333892,Restore defence modifier display in side-bar,Wedge009,2019-09-05 05:40:32+00:00,2019-09-07 12:50:03+00:00,{'Fwdport': 1},"Tested against master, already resolved for 1.14, resolves #3693.

May be good for @hrubymar10 to double-check this. Submitting as PR because I'm not sure what the figures mean for the theme configuration plus I don't know if the second of the three lines changed (which conflicts with later changes in master) needs further adjustments."
314277598,Fixes the droid command's options not all being optional.,Pentarctagon,2019-09-05 00:13:00+00:00,2019-09-05 08:16:16+00:00,{},"Now, if no action is provided and the current side's controller or proxy controller is the AI, the side is changed to fully human control (same as `:droid <side> off`). If no action is provided and neither the controller or proxy controller of the current side are controlled by the AI, then the controller is set to human and the proxy controller set to AI(same as `:droid <side> on`).

Fixes #4308"
314019650,Add a MP mod command to stop a game.,Pentarctagon,2019-09-04 12:50:40+00:00,2019-09-05 06:58:08+00:00,{},This command is of the form `/query stopgame <nick>`.  wesnothd then retrieves the id of the game that person is in and calls delete_game(<id>).
313598967,wmlxgettext: fix #4275: not handle objectives.lua's turn counter,AncientLich,2019-09-03 13:42:22+00:00,2019-09-11 12:32:17+00:00,{'Translations': 1},"The original fix for #3469 introduced some bugs I did not notice as reported on issue #4275. So I reverted back the code to it's previous status and I re-fixed the bug #3469 with a regexp more similar to the original one and less simplified. This time it sees that wmlxgettext actually work as expected, and seems it is able to handle both mentioned corner cases. The new fix also allow again to recognize lua plural strings. I will attach a test.lua file I use to test the features and the resulting test.pot.     

  >   ./wmlxgettext --domain=""test"" -o test.pot test.lua

[test.zip](https://github.com/wesnoth/wesnoth/files/3569691/test.zip)

"
313095208,Special notes,CelticMinstrel,2019-09-02 03:10:39+00:00,2019-09-12 12:51:06+00:00,{'Help': 1},"As mentioned in my comment on #4297, this adds a `[special_note]` tag as a way to make special notes neater.

For backwards compatibility, the old `{SPECIAL_NOTES_*}` macros are deprecated and new `{SPECIAL_NOTE_*}` macros have been added that produce a `[special_note]` tag... I admit this is confusing, but there's not a lot of options here, so...

I even updated wmllint to handle this, though I'm not 100% confident in my changes there.

On the one hand, this should render #4297 obsolete (because the strings have been reverted to once more omit the bullet), but on the other hand, it moves a whole slew of  strings from ""wesnoth"" to ""wesnoth-help"" by adding a gettext domain declaration in _help_topic_generators.cpp_. I figure this is acceptable since it's a dev branch, though.

I only migrated core units to use the new system, but I'm willing to do it for all the campaigns as well."
313084480,heal units on recall list at scenario end,gfgtdf,2019-09-02 01:42:37+00:00,2019-09-05 13:14:31+00:00,{'Units': 1},
312926755,Add new mushroom base terrain and make the overlay have mixed defense,CelticMinstrel,2019-08-31 03:42:23+00:00,2019-09-11 13:07:15+00:00,"{'Enhancement': 1, 'Engine': 1}","Addresses #4213 / #4214 since no-one else seemed interested in doing it. Graphics courtesy of @doofus-01.

Probably needs work on the transitions. I started with the original (now-reverted) commit and tweaked it to create new terrains instead of modifying the old terrain. Also, if anyone has a better terrain code than `Tb`, please suggest it.

I didn't fiddle with any existing maps, as I'm not sure whether it would be preferred to replace `*^Uf` with `Tb` or with `*^Tf`. That should be left to someone who cares about MP balance."
312921211,Help: Add <underline> and <strikethrough> markups.,jostephd,2019-08-31 01:48:39+00:00,2019-11-11 06:21:46+00:00,"{'Enhancement': 1, 'Ready for testing': 1, 'Help': 1}","I've verified that TTF_STYLE_UNDERLINE / TTF_STYLE_STRIKETHROUGH are defined in SDL_ttf 2.0.12 (the oldest we support).

No uses of underline/strikethrough are added, though @Pentarctagon suggested one on discord.

The wiki is https://wiki.wesnoth.org/HelpWML#Help_System_Topic_Markup, ~~it's a little out of date~~."
311513744,"[1.14] Use multiple lines for help, and replace ""do not translate part"" with translation notes",stevecotton,2019-08-27 18:37:50+00:00,2019-08-29 19:22:52+00:00,"{'Translations': 1, 'Help': 1}","Backport of #4276

This removes all of the ""do not translate part^string part"" strings, replacing
them with more help in English and a place for translators to explain what the
untranslatable ""all"" means. For commands where the usage has notes about the
arguments, this embeds the \n in the strings passed to register_command; that
seems a reasonable balance between usability and effort to implement it.

Cherry-picking between 1.14 and 1.15: In 1.14.x, the ""droid"" command only has
options ""on"" and ""off"". The ""full"" option was only added in 1.15."
311381846,objective update #4254,PiotrMakarewicz,2019-08-27 13:22:25+00:00,2019-08-27 13:23:23+00:00,{},#4254
311366695,remove bonus objective once it's completed,PiotrMakarewicz,2019-08-27 12:47:31+00:00,2019-08-27 13:17:30+00:00,{},https://github.com/wesnoth/wesnoth/issues/4262
311107548,[WIP] Update a game's ID when advancing to the next scenario.,Pentarctagon,2019-08-26 21:45:25+00:00,2019-09-04 12:48:17+00:00,{},"On receiving ""store_next_scenario"", increment wesnothd's game id counter and assign the game the new id.
Currently this is relevant for when an MP campaign advances to the next scenario, in order to avoid primary key conflicts as well as insert a new game_info row for the new scenario.

Also fixes #4281 by adding a db call in ""store_next_scenario"" to insert the next scenario's game_info row."
310658347,Trigger an L4 deprecation message for [terrain_type]vision_alias=,stevecotton,2019-08-25 04:55:59+00:00,2019-09-10 07:51:51+00:00,"{'Bug': 1, 'WML': 1}","The feature was never added, a deprecation message saying that it's been
removed is the closest option to the situation. While terrain.cpp itself
supports vision_alias, it was never added to the calculations in movetype.cpp,
therefore it never affected units' vision. It's also not shown in the help
about the terrain.

This doesn't affect the features of units having vision costs different to
movement costs, or of units having a different number of vision points to
movement points, both of which are still supported.

While I'd encourage anyone who wants to implement vision_alias to do so, at the
moment I feel that the still-supported features in the same area haven't been
explored yet, and that vision_alias isn't going to developed before 1.16.0 is
released.

Issue #3148 would be closed by this, as it's a report that the feature isn't implemented.
Would remove the question of support for terrain_vision and terrain_jamming from #4227 ."
310656989,Remove non-functional methods from player.hpp.,Pentarctagon,2019-08-25 04:18:36+00:00,2019-08-25 16:18:47+00:00,{},"Attempting to call them results in an error during linking, for example:
undefined reference to `wesnothd::player::set_game(wesnothd::game*)'"
310623674,"[1.15] Use multiple lines for help, and replace ""do not translate part"" with translation notes",stevecotton,2019-08-24 15:54:21+00:00,2019-08-29 19:22:58+00:00,"{'Translations': 1, 'Help': 1}","This was inspired by @Wedge009 's #4271 , where these were one of the hotspots for problems.

However, I'm wondering if we should suggest that the translators add translations of what the non-translated English parts mean. For example:
> en: `[all|<command>]`
> de: `[all|<Befehl>]` <i>(»all« = Hilfe für jedem Befehl)</i>

For the `droid` command's `on` and `full`, that might be useful for English too."
310595824,fix for sample_user_handler removal. ,newfrenchy83,2019-08-24 09:10:22+00:00,2019-08-24 12:26:32+00:00,{},
310590200,Remove description prefixes from translated strings (master),Wedge009,2019-08-24 07:12:40+00:00,2019-08-27 02:09:29+00:00,{'Translations': 1},master version of #4271.
310590159,Remove description prefixes from translated strings (1.14),Wedge009,2019-08-24 07:12:02+00:00,2019-08-27 02:09:19+00:00,{'Translations': 1},Clean-up as described in #2965. See commit message for details.
310531877,Print an error message when the mp_mod_group is not a valid int.,Pentarctagon,2019-08-23 20:57:11+00:00,2019-08-24 17:52:56+00:00,{},Fixes #4266
310519150,fix #4256 wesnoth.require with relative paths,gfgtdf,2019-08-23 20:12:11+00:00,2019-08-24 16:52:16+00:00,{},"now wesnoth.require is able to detect when the same file is
required two times using different names (like a/../a/b.lua
a/b.lua) and will only execute it once.

for this a new function wesnoth.canonical_path was added"
310440900,Backport the MP Moderator group check and storing game information to 1.14.,Pentarctagon,2019-08-23 15:45:06+00:00,2019-08-24 12:28:42+00:00,{},
310032460,WoV: Set up for translations,stevecotton,2019-08-22 15:54:09+00:00,2019-08-27 18:58:53+00:00,"{'Campaign (any)': 1, 'Translations': 1, 'SCons': 1, 'CMake': 1}","The next scons or cmake pot-update will create all of the empty .po files. Edit: this doesn't match our workflow - they have to be added as part of the PR, otherwise validation files.

This pushes the Portuguese translation below the 70% threshold.

For the en_GB translation, AFAICS only ""honor"" and maybe ""overwatch"" need to change."
309305695,MP Lobby Game Notification for master,Wedge009,2019-08-21 03:14:29+00:00,2019-08-27 03:41:02+00:00,{'MP Lobby': 1},"master version of #4259 

Original author: @lilinitsy"
309305376,MP Lobby Game Notification for 1.14,Wedge009,2019-08-21 03:12:31+00:00,2019-08-26 05:36:35+00:00,{'MP Lobby': 1},"Clean-up of #3246. Re-inviting the original reviewers of @stevecotton, @CelticMinstrel, @GregoryLundberg, @jostephd.

Original author: @lilinitsy"
309136932,Allow '1-infinity' in ranges,stevecotton,2019-08-20 16:36:59+00:00,2019-08-30 16:45:15+00:00,{},Fixes #4253.
308361704,"resolveHttT, Konrad's portrait is not used after he is lvl 2",newfrenchy83,2019-08-18 12:50:05+00:00,2019-08-18 13:49:49+00:00,{},this is another solution for resolve https://github.com/wesnoth/wesnoth/issues/4248 bug without regression of https://github.com/wesnoth/wesnoth/commit/66a282a96be288a284d12a71625868cee5b2dc6b#diff-8dd74f653e8c20d19565e37121f74e9fR1018
308360042,"resolveHttT, Konrad's portrait is not used after he is lvl 2 ",newfrenchy83,2019-08-18 12:23:23+00:00,2019-08-18 12:53:03+00:00,{},this is an partial regression of https://github.com/wesnoth/wesnoth/commit/66a282a96be288a284d12a71625868cee5b2dc6b for resolve https://github.com/wesnoth/wesnoth/issues/4248 in wait to best solution.
308308515,Remove sample_user_handler and other unimplemented/unused bits.,Pentarctagon,2019-08-17 17:58:10+00:00,2019-08-22 08:41:52+00:00,{},"This PR remove the sample user handler; the unimplemented nickserv functionality for register, set, details, and drop; unused/unimplemented email-related functionality, and unused user handler cleanup functionality."
308295051,"Display settings: Adjust ""Limit FPS"" tooltip",madmax28,2019-08-17 14:21:17+00:00,2019-08-17 18:12:07+00:00,{},"The tooltip now mentions that the game must be restarted for the setting to take effect. Restart is required because the setting is stored in a static variable:

https://github.com/wesnoth/wesnoth/blob/b9246dc6b4fee54751fcb37ad3ec97f751e7926a/src/display.cpp#L1662

I also removed ""to 100%"" and ""at high resolutions"". These bits provide little information and aren't always accurate."
308252776,Revert network_transmission.cpp/hpp to its 1.14.7 version,stevecotton,2019-08-17 00:33:01+00:00,2019-08-24 16:05:31+00:00,"{'UI': 1, 'Add-ons': 1}","I re-ran the timing test discussed in PR #4201 (comment linked to below), and
saw similar numbers.  The old, simpler code downloads an 86.1MB addon in 25
seconds, the code with the extra thread takes 29 seconds.

https://github.com/wesnoth/wesnoth/pull/4201#issuecomment-517856090"
308222915,Add a flag to record if the game encountered an OOS error.,Pentarctagon,2019-08-16 21:22:50+00:00,2019-08-17 12:42:37+00:00,{},
307882187,Dunefolk extra define,Earth-Cake,2019-08-15 22:41:26+00:00,2019-08-17 01:30:33+00:00,"{'Enhancement': 1, 'Units': 1}",Since 1.15.0 ENABLE_WARMASTER in [campaign] tag is false. This PR should fix that.
307751460,Dunefolk bug fixes,Earth-Cake,2019-08-15 15:31:23+00:00,2019-08-15 18:47:23+00:00,{},Fixing a few bugs regarding Dunefolk unit files and sprites.
307695463,DM S22: Apply the weapon-change from S21 to S22 too,stevecotton,2019-08-15 12:55:37+00:00,2019-08-17 16:21:34+00:00,"{'Bug': 1, 'Campaign (any)': 1}",Fixes #4221 
307661683,Add either heals= or [heals] to Standard Location Filter,stevecotton,2019-08-15 10:43:45+00:00,2019-10-01 16:42:13+00:00,"{'Enhancement': 1, 'WML': 1, 'Low Priority': 1}","One of the features requested in #4227.

The core terrains' villages and oases all heal 8 HP per turn, but the
engine supports other values. So the expected usage to match all
healing terrains is:

    heals=1-{INFINITY}

This doesn't support filtering for negative values of heals, however
I believe no-one is using them (see #4232 ). A harms= key could be
added, but if this is needed then maybe this PR should add a `[heals]`
child to SLF. Or ranges could be expanded to support negative numbers."
307515904,"Add a line break between ""Special Notes:"" and the bullets.",jostephd,2019-08-14 22:07:47+00:00,2019-08-31 21:07:01+00:00,"{'Enhancement': 1, 'Prose': 1, 'Help': 1}",
307515136,fixup! Show the turn dialog before updating the GUI for the incoming player,jostephd,2019-08-14 22:04:37+00:00,2019-08-16 00:48:20+00:00,"{'Ready for testing': 1, 'Replays': 1, 'Regression': 1}","Fix a regression caused by #4188 (the fix to #4187): the turn dialog would show during replays as well.

I've tested this but it would be great if someone could review this and make sure that #4188 didn't introduce any _other_ regressions.

@linaio"
307511346,Adding Wose Shaman animations to mainline,Earth-Cake,2019-08-14 21:50:11+00:00,2019-08-17 23:50:43+00:00,{},"There are some existing animation sprites for Wose Shaman, used in WoV and DM, so basically this Pull Request is made to get these sprites in those campaigns. I have also updated unit files that they match sprites and corrected sound errors."
307463908,campaignd: Assign port 15015 to 1.15.x,soliton-,2019-08-14 19:21:21+00:00,2019-08-14 19:26:16+00:00,{},
307445616,Move the wose sapling and shaman to mainline,stevecotton,2019-08-14 18:27:14+00:00,2019-08-15 21:57:27+00:00,{},"The ranged-halo images are unused, the elven/nature halo is used
for the Shaman's ranged attack instead.

This was part of #3414, but please re-review it."
307319828,Rule of Five for event::sdl_handler,stevecotton,2019-08-14 13:04:33+00:00,2019-08-14 14:39:46+00:00,{},"This fixes the default implementations of widget's copy constructor and copy
assignment, which was root cause of the regression in 4139b43cc900 (#4215).

This reverts commit f46ed66f2c9a8acf8d88338d8433fc35689d4c39."
306575070,Draft 'Why did I lose?' help topic,jostephd,2019-08-12 16:43:50+00:00,2019-08-16 00:30:51+00:00,"{'Enhancement': 1, 'Prose': 1, 'Help': 1}",Based on discussion in https://forums.wesnoth.org/viewtopic.php?f=3&t=18640
306485860,Replace problematic mushroom base terrain,slavrenyuk,2019-08-12 13:01:58+00:00,2019-08-17 14:09:28+00:00,{},"This PR is an update to this one https://github.com/wesnoth/wesnoth/pull/4185

It replaces problematic base terrains (namely `Ss`, `Ha` and `Mm`) which are incorrectly displayed under the `^Uf` overlay. Instead of those terrains, `Uu` is used now. The issue is described here https://forums.wesnoth.org/viewtopic.php?p=646099#p645168

Screenshot of the problematic base terrains before the fix. `Ss` and `Mm` base is not hidden. `Ha` has incorrect (snowy) transition.
<img width=""1147"" alt=""problematic_mushroom_base_terrains"" src=""https://user-images.githubusercontent.com/5528718/62866700-27709600-bd1a-11e9-8368-fe05ce44b902.png"">


"
306219876,"Handle unit overlays as modifications, allow [effect] to remove them",stevecotton,2019-08-10 15:36:28+00:00,2019-08-10 21:49:43+00:00,{'UI': 1},"Possible fix for #4058, with the following logic (and no WML changes needed):

* If non-empty, [unit]overlay= is handled by adding modifications
* unit::write will always output an empty overlay=
* The Lua API's get_units() will still provide the list of overlays
* [effect]apply_to=overlay can now remove as well as add overlays
* [remove_unit_overlay] is implemented with [effect]apply_to=overlay

Using [object]s with durations hasn't been tested, but expected effects:
* An expired add= followed by a non-expired remove= will simply cause the remove=
    to have no effect when std::remove(overlays_ ...) is called.
* A remove= followed by [remove_unit_overlay] cause the [remove_unit_overlay] to be a no-op,
    and the overlay will reappear when the first remove= expires. This edge case is already
	documented as unsupported on the wiki."
306215253,theme: Add optional argument to REPLAY_THEME for the benefit of user-defined themes,jostephd,2019-08-10 14:16:14+00:00,2019-08-10 20:09:38+00:00,"{'Enhancement': 1, 'UI': 1, 'WML': 1}","No change for master, but this will allow me to package the asymmetric theme (#4184) as an addon.

<details>

<summary>

Screenshot with the argument at a **non-default** value:

</summary>

![Screenshot_2019-08-10_14-12-51](https://user-images.githubusercontent.com/24784687/62822882-2eac6e00-bb79-11e9-8d9c-910ad54eed06.png)

</details>"
305291736,"If text is too long to render, fall back to line-by-line (fixes: #3265)",stevecotton,2019-08-07 19:38:55+00:00,2019-08-18 05:23:07+00:00,"{'Bug': 1, 'Engine': 1}","This still requires a huge surface to render all of the text on to,
but is an easier fix for #3265 than redesigning the credits screen.

This removes the only caller of utils::vertical_split, which is why
that utility function is also removed."
304093408,"WIP: Tutorial scenario: Mirror of S2, playing the Orcs vs AI Elves",stevecotton,2019-08-04 20:29:54+00:00,2019-11-04 16:18:53+00:00,"{'Enhancement': 1, 'Campaign (any)': 1}","WIP: for debugging, waits for the player to select ""normal_start"" from the right-click menu instead of doing many changes in a start event

WIP: it's way too hard for a tutorial, needs to be made easier

WIP: currently leaves elves in the recall list

Includes:
* fog of war
* encircling units with ZoC
* using fire vs a Wose (but tries to avoid the ambush ability)
* accepting that some of your units will die
"
304084713,Add support for storing game information in wesnoth's mysql database.,Pentarctagon,2019-08-04 18:00:25+00:00,2019-08-12 11:04:27+00:00,{},"This requires three more tables to be added to any database with the forum user handler enabled, the structures of which are defined in the wesnothd man page:
* `db_game_info_table` - stores information about each game.
* `db_game_player_info_table` - stores information about each player in the game.
* `db_game_modification_info_table` - stores information about any modifications that are enabled for the game."
303729507,"Try to optimize network_transmission, assuming the problem was CPU usage",stevecotton,2019-08-02 10:22:51+00:00,2019-08-04 08:48:23+00:00,{},"The download speed seemed reasonable to me, but this does improve it slightly
(from 1.2MB/s to 2MB/s, testing connected via my phone). The optimization here
is assuming that redrawing the window is causing another event to be pumped,
and so making this loop a busy loop that is pumping itself.

The PR is created against the old code, so it's easier to review what changed."
303523204,"WIP: Add a hint about not save-loading, and link to it from the ""Back to"" menu",stevecotton,2019-08-01 19:31:11+00:00,2019-08-03 18:06:54+00:00,"{'Enhancement': 1, 'Docs': 1, 'Prose': 1, 'Help': 1}","This adds a new section to the ""Gameplay"" help topic, and puts an item that opens that help in the list of save games that's in the ""Back to ..."" menu.

I'm expecting this to need changes to the prose, and maybe move it to the bottom of the menu.

Can be cleanly cherry-picked back to 1.14."
303503557,Fix overlay removed after advancement,newfrenchy83,2019-08-01 18:31:13+00:00,2019-08-13 12:04:20+00:00,{},"i hope resolve https://github.com/wesnoth/wesnoth/issues/4058 issue this time.

For that, i had added two variables for overlays, a variable for modifications, overlays_ who is limited to non modifications case, and meta_overlays, where the data of two others are assembled.
i hope what @gfgtdf will be satisfied."
302925733,"Refactoring [movetype] to deprecate the ""flies"" key, use ""flying"" instead",stevecotton,2019-07-31 12:17:40+00:00,2019-08-01 20:06:58+00:00,{},"This makes [movetype] consistent with [unit]. The code in movetype.cpp is used
for handling both of those tags and so already had support for ""flying"" in the
merge() and write() functions.

This shouldn't be backported to 1.14. For this reason, it also includes
handling the C++ todos to use C++14's std::make_unique."
302117691,Dunefolk rework,Vultraz,2019-07-29 15:18:09+00:00,2019-08-10 19:54:33+00:00,{'Blocker: New Stable': 1},@Earth-Cake tells me this is feature-complete. Awaiting description of changes and list of people to credit. 
301928711,EI S15: Fix typo,18praveenb,2019-07-29 06:40:22+00:00,2019-07-29 06:41:58+00:00,{},
301852438,Fix remove overlay by addition of bis_overlay non persistent,newfrenchy83,2019-07-28 18:55:12+00:00,2019-08-01 18:31:37+00:00,{},"THIS PR must be resolve https://github.com/wesnoth/wesnoth/issues/4058 issue.
the main problem that came from the accumulation of a copy of the same image in overlays after each advancement, the best way is to limit the addition to images that are not already present rather than to make overlays non persistent."
301788640,Show a more recent game list when returning to the lobby (fixes #4148),stevecotton,2019-07-27 22:10:39+00:00,2019-07-28 00:51:05+00:00,"{'Enhancement': 1, 'MP Lobby': 1, 'UI': 1, 'Low Priority': 1}",
300035125,Fix units fading in or out affecting other units of the same type,stevecotton,2019-07-22 20:53:44+00:00,2019-07-22 22:54:35+00:00,{},"@Vultraz , please would you review this?"
299830742,"Add [find_path] option ""nearest_by"", and simple_find_path test",stevecotton,2019-07-22 11:15:15+00:00,2019-09-11 09:17:57+00:00,{},"Adding this is issue 2 of #4177, changing the behavior when [find_path]
is given a SLF which matches multiple hexes. Issue 1 of #4177 is to convert
the unit test and PR docs to wiki documentation about the current behavior.

The map and tests here should be easy enough for manually editing them. It
duplicates some of the functionality of the existing characterize_pathfinding
tests, however those tests need their expected values to be calculated and
can't be changed by hand.

'''nearest_by''': {DevFeature1.15|2} possible values ""movement_cost""
(default), ""steps"", ""hexes"". If the [destination] SLF matches multiple hexes,
the one that would need the least movement points to reach may not be the one
that's closest as measured by '''hexes''', or closest as measured by steps,
from the starting point.

In the image, imagine an Elvish Scout standing on the Player 1 start, this unit has
9MP and needs 3MP for each shallow water tile, so it can reach every village without
needing a multi-turn move. Each village might be considered to be the ""nearest"":
* ""lake"" is 3 hexes, 7 MP and 4 steps away
* ""spur"" is 5 hexes, 5 MP and 6 steps away
* ""u_turn"" is 2 hexes, 8 MP and 9 steps away

Behavior in 1.14 depended on which hex was checked first.

![find_path_six_villages](https://user-images.githubusercontent.com/101462/64565741-b6da8a80-d354-11e9-9c5c-5f491950ebef.png)"
299658886,Show the turn dialog before updating the GUI for the incoming player.,jostephd,2019-07-21 19:21:29+00:00,2019-08-10 13:21:01+00:00,{},"In hotseat games, the main map and minimap were updated and healing was animated
before blacking out the display for the turn dialog.

Fixes #4187."
299630532,Cleaned up various surface-related backend things,Vultraz,2019-07-21 11:54:30+00:00,2019-07-21 13:09:23+00:00,{},"* Removed create_neutral_surface in favor of a surface ctor that takes w/h dimensions.

* Removed make_neutral_surface in favor of a surface::make_neutral function. Most usecases of this were
  to make a copy of a surface anyway, so I added a new surface::clone function

* Moved the pixel format validation and conversion to the surface class. Now *all* surfaces should be
  guaranteed to be in the 'neutral' format. Any new surface that is created (with clone() or the dimension
  ctor will be in that format, and any time a raw SDL_Surface* ptr is assigned, it is also converted. This
  applies both to the ctor and assignment operators.

* Removed create_compatible_surface. All surfaces should be compatible in the first place.

* Removed surface::assign was in favor of simple assignment operators. The existing assignment operators
  already just called assign().

* Removed surface::null in favor of the implicit SDL_Surface* conversion operator for consistency. We were
  already using null and implicit pointer bool conversion, so I decided to go with the latter. I was going
  to add an operator bool(), but it was ambiguous in surface-to-surface comparisons."
299592202,Make mushrooms hide base terrain,doofus-01,2019-07-20 21:31:46+00:00,2019-08-04 01:52:44+00:00,"{'Graphics': 1, 'Stable 1.14': 1}","Visual change to mushroom forest overlay that hides the base terrain
This is to address this:
https://forums.wesnoth.org/viewtopic.php?f=6&t=49996

Probably better to make two terrains in 1.15, this PR is pretty much a compromise working in constraints of no API changes."
299461704,Refactor movetype and terrain_costs for 1.15,stevecotton,2019-07-19 19:41:44+00:00,2019-07-31 11:58:17+00:00,{},"Refactoring movetype and terrain_costs (#2486)

Simplify the public interface for movement, vision and jamming costs to only
the movetype class and a read-only interface called ""terrain_costs"".  Changes
to terrain_costs now need to be done through the movetype instance, so logic
about how movement, vision and jamming interact with each other can be handled
in movetype.  This fixes a possible dangling-pointer issue: the default
copy/move implementation in movetype::terrain_info would have copied raw
pointers, without ensuring that those pointers remained valid.

This feels too complex, but also feels like time to merge it and do any further
cleanup as a separate commit.  For example, there's only one place that calls
make_data_unique, and one place that calls make_data_shareable. Merging the
functions should make it clearer.

The terrain_info class is now a private class implementing the terrain_costs
interface, previously it was a public class with raw pointers to other
instances of itself, and a copy constructor which copied the raw-pointers
as-is. One of the raw pointers is still there, but it's only non-null when both
instances involved are owned by one instance of movetype.

=== To cherry-pick back to 1.14 ===

Cherry-pick the tests from 358f564301273f32338a00508f5121063ae800b1.

* units.cpp: needs a manual merge. Remove the `set_attr_changed(UA_MOVEMENT_TYPE)`
  call from the master version.
* movetype.cpp: take the changes in this commit, in each case the conflict is
  the change of std::shared_ptr::unique() to std::shared_ptr::count(), which
  has been replaced with make_data_shareable() and make_data_writable().
* movetype.hpp: take the changes in this commit, deleting the old terrain_costs
  class and adding functions to movetype."
298980805,Add unit tests for changing movement and vision costs,stevecotton,2019-07-18 15:52:39+00:00,2019-07-22 15:29:40+00:00,"{'Enhancement': 1, 'Unit Tests': 1}","This was driven by #2486 (which is still work-in-progress), but already passes on both 1.14 and master (which it can be cleanly cherry-picked to).

It doesn't test jamming, but might be a helpful baseline for writing a jamming test."
297825115,"[1.14] Fix Wdeprecated-copy in wfl::variant, and add move operations",stevecotton,2019-07-15 23:44:49+00:00,2019-07-16 00:12:32+00:00,{},"Fixes the majority of the warnings in issue #4166.

This class already shared copies of value_ between instances,
it seems to be the immutable design pattern so can share from
const to non-const instances safely."
297734311,"Fix Wdeprecated-copy in wfl::variant, and add move operations",stevecotton,2019-07-15 18:23:01+00:00,2019-07-15 22:53:48+00:00,{},"Fixes the majority of the warnings in issue #4166.

This class already shared copies of value_ between instances,
it seems to be the immutable design pattern so can share from
const to non-const instances safely.

Cherry-picking this to 1.14 needs a trivial conflict to be
resolved, the next line in the .cpp file has changed from
size_t in 1.14 to std::size_t in 1.15."
297704296,Convert help_impl's ref-counting to std::shared_ptr,stevecotton,2019-07-15 16:51:08+00:00,2019-07-16 14:14:06+00:00,{},"This is part of #4166, as topic_text wasn't consistent with
the Rule of Three.

Can be cleanly cherry-picked to 1.14, although there are other unrelated changes on the master branch."
297415772,Prepend 'SDL2/' to all SDL includes,Vultraz,2019-07-14 17:53:52+00:00,2019-07-20 00:16:58+00:00,{},"This was needed to get the build working with vcpkg's version of SDL, where all the SDL files are
in their own SDL folder. However, our cmake config also has a note saying it was a deliberate choice
to move our SDL files *out* of their SDL2 folder due to certain distros (FreeBSD is mentioned) not
putting the files in said folder in the first place.

Testing here to see what breaks..."
297089984,Fixes incorrect handling of Xue transitions. ,Pentarctagon,2019-07-12 14:15:07+00:00,2019-07-12 18:14:45+00:00,{},"The transitions from the Xue terrain to the Xoc / Xos / Xoi / Xom terrains were displayed incorrectly.

Fixes #4154."
297088050,Command line --preprocess missing some macros. ,Pentarctagon,2019-07-12 14:10:23+00:00,2019-07-17 00:15:30+00:00,{},"Command line --preprocess doesn't process macros in data/core/units.cfg.

Fixes #4152."
296713754,"SoF S2: Dialogue fixes (no dwarves outside, repeated comment about side entrances)",stevecotton,2019-07-11 15:42:35+00:00,2019-07-15 18:50:01+00:00,{'Campaign (any)': 1},"If all the dwarves are inside when the gate closes, don't say there were some lost outside.

Make the dialogue about the north and south side entrances only trigger once. This dialogue seems OK even if it's Baglur talking to himself."
295104765,Fix a crash playing a replay with an add-on theme that doesn't have button-nextmove,stevecotton,2019-07-07 13:39:15+00:00,2019-07-28 18:46:23+00:00,"{'Bug': 1, 'Replays': 1}","Remove code from replay_controller that's already handled by the hotkey system

Fixes a crash when playing a replay that includes a theme, when that theme doesn't
have all of the buttons that the removed code expected. For example, this replay
from SXRPG 5.2.3 has two replay themes, of which one lacks button-nextmove:
* https://replays.wesnoth.org/1.14/20190701/SXRPG_TempleOfBones_Turn_8_(53897).bz2

All of the button::enable() calls were unnecessary logic, because the hotkey
system will query replay_controller::can_execute_command() and enable or
disable the buttons to match. However, the enable() calls appear to have had
the side-effect of triggering the hotkey system to check the buttons' required
states and redraw.

Should be cherry-picked to master too."
295063581,Fix ambiguous ternary operator (fixes #4153 compile error with GCC),stevecotton,2019-07-06 21:20:55+00:00,2019-07-07 13:53:11+00:00,{},
294907288,Tutorial S2: Warn about orcs crossing the river when they cross,stevecotton,2019-07-05 15:00:08+00:00,2019-07-14 14:55:21+00:00,"{'Enhancement': 1, 'Campaign (any)': 1}","Closes issue 2a of #1584

Previously the warning was always given on turn 7. It will still trigger even
if the player has units ready to defend that crossing, because I think it's
better to show the message and let the player think ""I'm already ready"" than to
have it pop up once some fighting has already happened; and it seems easier to
test this logic than to test logic for not showing the message if the crossing
is currently guarded.

Also add a first_time_only=no to the check_income event, so that it can trigger
on turn 7 if it doesn't trigger on turn 6."
293974145,Add FULL action to :droid command.,Pentarctagon,2019-07-03 02:01:04+00:00,2019-07-07 23:54:45+00:00,{},":droid FULL will also set the side controller to AI, whereas ON only sets the proxy_controller.
This results in a situation where if an opponent leaves and is droided, the host will have vision to the side of the player who left.
This also results in the host *not* having vision to their original side again until it's their turn.

Fixes #3665"
293160114,Schema: Fix travis error by allowing additional keys in two situations,sigurdfdragon,2019-07-01 02:46:24+00:00,2019-07-03 03:19:39+00:00,{},"1. Allow carryover_percentage & carryover_add with
victory_when_enemies_defeated=no. Code from newfrenchy83 (taken from previous discussion)

2. Allow use of current_time in [time_area]. (wiki says it's valid & it works in-game)

The errors are in this report for Wings of Victory
https://travis-ci.org/wesnoth/wesnoth/jobs/552459607
"
293128952,"On game creation, use the name ban list to pre-ban usernames on the host's ignore list.",Pentarctagon,2019-06-30 20:11:16+00:00,2019-07-05 07:09:42+00:00,{},Fixes #3892
293069249,Zombie Spiders,doofus-01,2019-06-29 23:54:32+00:00,2019-07-01 04:10:56+00:00,"{'Graphics': 1, 'Units': 1}","Adding spider `undead_variation` for Giant Spider.  This comes from here:
https://forums.wesnoth.org/viewtopic.php?f=9&t=49119&p=639116#p639116
Reading that again, I see I had forgotten about the fangs attack...  Well, no reason that campaign can't use a custom unit, as it already does for the other zombies.  The zombie attack animations are minimal, they could work just as well for fangs as for mindless flailing.

The stats may need changing, I went with what looked reasonable compared to what was in SotA and mainline.  SotA version has dwarvishfoot movetype, but the Giant Spider has mountainfoot movetype.  I just kept mountainfoot, I didn't compare them."
292985723,Display when observers share IP addresses as well.,Pentarctagon,2019-06-28 22:29:32+00:00,2019-06-29 10:05:42+00:00,{'MP': 1},"Currently, if someone observes with two accounts and then one account becomes a player, at no point is any message displayed about the two accounts having the same IP.
With this change a message will now also be displayed when two observers share an IP address."
292969218,Enforce game-level bans by username as well.,Pentarctagon,2019-06-28 21:07:02+00:00,2019-06-29 09:19:02+00:00,{'MP': 1},This will have each game track a list of banned usernames in addition to currently tracking banned IPs.
292935618,Also require observers to enter a game's password.,Pentarctagon,2019-06-28 18:55:15+00:00,2019-06-29 08:56:01+00:00,"{'Enhancement': 1, 'MP Lobby': 1}","Current situation:
* All observers allowed (Observers checked).
* No observers allowed (Observers unchecked).

New situation:
* All observers allowed (Observers checked, no password set).
* Some observers allowed (Observers checked, password set).
* No observers allowed (Observers unchecked)."
292931506,Use the MP Moderators forum group to check for mod authority.,Pentarctagon,2019-06-28 18:40:33+00:00,2019-08-15 12:36:17+00:00,{'MP': 1},"People who have MP mod authority for testing or other reasons can continue to use the existing user_is_moderator column check, but for people who are supposed to moderate the server, now the forum group will be used.

This will make it easier to add/remove people to/from the group, and also ensure that the list of actual moderators matches up with the list available to users.

New config attributes added for this are:
* db_group_table - should be, based on the phpbb documentation I found, phpbb_user_group
* mp_mod_group - should be set to Multiplayer Moderators group ID

---

Re-PR of #3964 so I can put this in a separate branch of my fork.

I am also waiting for this before continuing with some additional changes I would like to implement/enforce such as [this](https://github.com/wesnoth/wesnoth/pull/3964#issuecomment-502334805)."
290818564,adding zombie rider portrait,doofus-01,2019-06-22 11:46:45+00:00,2019-06-22 17:27:53+00:00,{},#4095 for master
290660871,Color range picking,AI0867,2019-06-21 15:51:07+00:00,2022-06-27 20:12:59+00:00,{'UI': 1},"Fixes a long-standing bug regarding color range picking, factors out the logic involved, adds interpolation and a `red_grey_green` function for when 50% is neutral, which is used in the statistics.

Possibly other color ranges should also move from picking to interpolation.

Various other places that do coloring:
- unit::hp_color
- unit::xp_color
- attack_predictions::draw_hp_graph
- probably more

Color choices could perhaps be improved, I picked them rather quickly."
290130355,fix carryover_percentage not valid when victory_when_enemies_defeated=no,newfrenchy83,2019-06-20 09:32:23+00:00,2019-06-24 08:20:30+00:00,{},this is another version of https://github.com/wesnoth/wesnoth/pull/4126
289393860,fix carryover_percentage not valid when victory_when_enemies_defeated=no in shema test,newfrenchy83,2019-06-18 18:09:10+00:00,2019-06-20 09:36:28+00:00,{},put carryover_percentage in begining of scenarion cause a bug in travis compilation in DM testing.
288794141,fix berserk continue the fight to almost infinite if value negative(1.14),newfrenchy83,2019-06-17 10:53:37+00:00,2019-07-25 06:49:22+00:00,{'In-progress': 1},….14 version)
288577720,"Make it possible to use the ""unit description"" command in replay mode on fogged/shrouded units.",jostephd,2019-06-15 19:41:51+00:00,2019-06-22 17:25:56+00:00,{},Fixes #3687
288022881,[1.15] wmllint: Handle nested events and other filters in the death check,stevecotton,2019-06-13 17:22:23+00:00,2019-06-13 17:26:52+00:00,{},"Cherry-pick of 1.14's #4089 to 1.15, will close #4085 ."
287152611,Restore 3-significant-digit si_string (closes #3871),AI0867,2019-06-11 15:46:16+00:00,2019-06-21 21:09:25+00:00,{},"Behaviour for MSVC remains the same (fixed with 1 decimal).
Fix a corner-case where [999.5, 1000) would not trigger 4-digit precision,
but would be rounded to 1000 during printing, resulting in 1e+3."
286283911,Fixed weapon specials text not displaying in correct color: Issue #4071,Leonard03,2019-06-07 18:05:50+00:00,2019-06-08 05:02:18+00:00,{},
285994694,ANL improvements,sevu,2019-06-06 22:41:35+00:00,2019-06-14 02:41:53+00:00,{},"ready for merge, but there are two things I'd like to ask for feedback:

- the wording of the objectives
<s>- undoing events if nothing was done: The loop variables are now cleared – Is there any reason left which would cause OOS if the [allow_undo] is used. E.g. in the research case (in this case the code is prepared). The event itself is synced.</s>"
284757414,Make the cache directory configurable too,GuillaumeLestringant,2019-06-03 22:47:25+00:00,2022-08-26 05:20:13+00:00,{'Command Line': 1},"This PR adds a pair of command-line options (`--usercache-path` and `--usercache-dir`), that allow to define a custom directory for the cache or view the current cache directory.

They are exact counterparts of the `--userconfig-dir` and so on options and work in the exact same way.

The goal is to make the application fully portable by not letting any unnecessary hard-coded path."
283707985,Added '/utf-8' character set option to Visual Studio project file,Leonard03,2019-05-30 15:48:59+00:00,2019-06-03 08:19:39+00:00,"{'Bug': 1, 'Windows': 1, 'Building': 1, 'Help': 1}","Fixed bug where Visual Studio would incorrectly interpret non-breaking
space characters, leading to being unable to open the unit help window.

Visual studio documentation here: https://docs.microsoft.com/en-us/cpp/build/reference/utf-8-set-source-and-executable-character-sets-to-utf-8?view=vs-2015"
283627339,"Loyal units always get the ring overlay, fix #4058",spixi,2019-05-30 11:59:53+00:00,2019-08-25 20:33:55+00:00,{},
282824811,resolve color active/inactive colors similars,newfrenchy83,2019-05-28 13:13:11+00:00,2019-08-21 02:01:25+00:00,{'UI': 1},"This is an resolve to https://github.com/wesnoth/wesnoth/issues/4094 issue.

and the result is here:
![colorsspecials](https://user-images.githubusercontent.com/31768074/58480617-fe992580-815a-11e9-8fb4-aa0e7ac79d07.png)
where backstab (coup  dans le dos)is inactive and poison(empoisonnement) is active."
282622854,portrait for mounted version of walking corpse,doofus-01,2019-05-27 22:26:21+00:00,2019-06-22 11:21:53+00:00,"{'Graphics': 1, 'Units': 1}",
282210609,"SotA: Fix some wmllint warnings by adding ""wmllint: who"" commands",stevecotton,2019-05-25 06:47:59+00:00,2019-05-29 03:23:40+00:00,{},
282210567,SotA S21: Fix the side= in the paladin's move_unit_fake,stevecotton,2019-05-25 06:47:09+00:00,2019-05-29 03:14:12+00:00,{},"Side 3 is the Saurians, the effect of this is just to have the very first
enemy that appears have blue reins instead of green reins during the
move_unit_fake. Only noticed it because I was adding wmllint:recognize
lines for each side's leader."
282206109,HttT S11: Correct two places where a typographic quote was used in Li'sar's id,stevecotton,2019-05-25 05:03:00+00:00,2019-05-25 18:35:27+00:00,{},"In S11, if the player tries to attack Li'sar then there are supposed to be four
events adding extra guards. Two of them didn't trigger, because the [have_unit]
calls were trying to match her id with a typographic quotation mark.

One change in the opposite direction, where the displayed name could have a
non-typographic quotation mark; this might only happen when using choose_level
to reach a scenario with NEED_LISAR before her unit is on Konrad's recall list.

Remove a CLEAR_VARIABLE that was obsolete since 7778e6f4."
282205514,"THoT S12: After breaking down a door or teleporting, clear the shroud",stevecotton,2019-05-25 04:50:58+00:00,2019-05-25 19:35:40+00:00,{},"Otherwise the shroud doesn't update until the unit moves again.  When
teleporting that could lead to the unit being stuck in a shrouded location,
although that's unlike to happen except when running around the map using debug
commands.

The two teleports from the center to the north and south don't need this,
because they're only enabled after a unit has stood on the destination rune."
281855391,wmllint: Handle nested events and other filters in the death check (closes #4085),stevecotton,2019-05-24 03:34:27+00:00,2019-06-03 08:00:09+00:00,"{'Enhancement': 1, 'WML Tools': 1}","The main reason for moving this to a separate function was to make the
per-event variables local to that function."
280450978,Fix remove overlay,gfgtdf,2019-05-20 15:56:18+00:00,2019-08-25 20:33:17+00:00,{},fixes LOYAL overlay disappearing from units after levelup.
280372250,WIP add documentation for bool_ability and combat_ability(for 1.15/16 version),newfrenchy83,2019-05-20 12:35:44+00:00,2019-10-17 22:52:09+00:00,"{'Enhancement': 1, 'Docs': 1, 'Engine': 1}",
280361208,fix berserk continue the fight to almost infinite if value negative(1.15/16 version),newfrenchy83,2019-05-20 12:02:53+00:00,2020-01-05 10:44:22+00:00,{'Units': 1},"if berserk value<0 in both special or abilitie then the fight continue until death of combattant, and the number limit of turn may be infinite. for fix that, the value must be be null or positive only."
280082770,Merfolk: increase HP of initiate advancements,nemaara,2019-05-18 06:43:05+00:00,2019-05-29 23:18:09+00:00,"{'Bug': 1, 'Units': 1}","Like the title says, the HP of initiate advancements is extremely low compared to other mages (see elves and humans), so this aims to correct that. Since these units are very hard to get in MP, I don't think we need to worry about MP balance. For SP, this won't throw off campaign balance very much; if anything, it makes merfolk a bit more viable (since they are weak right now)."
279688436,Add pre attack event #4075,spixi,2019-05-16 22:16:03+00:00,2022-08-07 06:38:53+00:00,{'WML': 1},This implements #4075
279294217,make overlays contain simple image and add mp_overlays for contains multiple image,newfrenchy83,2019-05-15 23:08:43+00:00,2019-07-29 13:02:08+00:00,{},"i hope what this PR will be resolve https://github.com/wesnoth/wesnoth/issues/4058

The common method is to assign overlays a single image to avoid image accumulation without compromising persistence when a unit moves one level. To allow the addition of new images, I propose to create a mp_overlays benefiting from the effect apply_to = overlay instead of the original applicable for the addition of images that are not called to replace hero-icon, loyal -icon or similar. If this does not dispense with reworking the wml code, then the workload for the devellopeur only concerns the addition of these extra and rarely used (in the core) images. When replacing [unit_overlay] by [unit_mp_overlay], it is precisely not to rework all the scenarios where this function is used, but only those where images are added in addition to any crowns to the units."
278699542,create a simple overlay tag for resolve overlays bug,newfrenchy83,2019-05-14 14:05:56+00:00,2019-05-17 12:58:39+00:00,{},"To solve the problem in the https://github.com/wesnoth/wesnoth/issues/4058 issue, I had the idea to create a simple overlay that could contain only one image and use it for icon 'hero' and 'loyal' instead of overlays multiple that is no persist now. I also reassign unit_overlay and remove_unit_overlay to this unique overlay and add unit_overlays to multiple overlays.
"
278167979,Fix crash when adding/removing hotkeys with no matches,rocketBANG,2019-05-13 08:18:53+00:00,2019-06-11 14:40:00+00:00,"{'Bug': 1, 'UI': 1}",fixes #3970 
278070636,create a persistent_overlay for resolve overlays bug,newfrenchy83,2019-05-12 18:11:24+00:00,2019-05-14 14:06:11+00:00,{},it is another solution for resolve https://github.com/wesnoth/wesnoth/issues/4058 
277734812,Add actual/expected hit count stats to stats dialog,jostephd,2019-05-10 11:32:07+00:00,2019-06-11 08:51:03+00:00,{},"Fixes #4066, see https://github.com/wesnoth/wesnoth/issues/4066#issuecomment-490973775 for an explanation.

Currently looks like this:

![2019-05-10-112557_1920x1080_scrot](https://user-images.githubusercontent.com/24784687/57524313-f8abe380-7316-11e9-96b4-96c696a446d5.png)

The screenshot shows the status after a single attack by a Silver Mage (9x4 magical) that hit 3/4."
277572592,fix level up emove overlay from unit,newfrenchy83,2019-05-09 22:27:33+00:00,2019-05-12 18:14:25+00:00,{},this fix https://github.com/wesnoth/wesnoth/issues/4058 in hope to not generate another bug
277430045,"DiD S09: Unblock the book if one of DV's units is standing on it, clarify objectives",stevecotton,2019-05-09 15:02:05+00:00,2019-05-11 18:27:30+00:00,{},"Refactor to using location_id for the location of the book, because it appears
multiple times in the .cfg file.

An edge case to this edge case: if DV's turn starts with DV next to the book
and one of DV's units on the book, DV doesn't move until the next turn.  This
was also true if the unit moved to attack something, and works in the player's
favor, as it gives Malin an extra turn to grab the book, so I'm treating it as
a feature.

If DV does grab the book, explicitly say in the objectives that it's now a race
to the escape tunnel. This means that the objectives dialog is shown twice:
* DV takes the book (no messages at all)
* start of player's turn: objectives shown (escape to win, deaths to lose)
* player ends turn
* DV moves, Malin asks if he's going to be left behind
* start of player's turn: objectives shown (race to win)

@nemaara , please would you comment on this? Should I drop the changes that aren't specifically about unblocking the book?"
276524809,"tips: Clarify that these are about the editor, fix quotes",stevecotton,2019-05-07 09:45:30+00:00,2019-05-08 09:34:38+00:00,{'Prose': 1},"The ""User Scenarios"" label changed to ""Custom Scenarios"" in ae6ed8e71."
276040451,"Mudcrawler, Great Wolf, Cuttlefish, and Bloodbat Portraits",doofus-01,2019-05-06 00:59:08+00:00,2019-06-06 19:41:37+00:00,"{'Graphics': 1, 'Units': 1}","I'm not opposed to touching these up if someone else thinks it's needed, but I consider them good enough.  I'll make another PR for master."
275238624,Prose updates for orcs eating other sapient races,nemaara,2019-05-02 05:29:28+00:00,2019-05-04 16:43:56+00:00,"{'Campaign (any)': 1, 'Prose': 1}",For #4007. 
274186353,Dark forecast backport,sevu,2019-04-28 15:06:04+00:00,2019-04-29 20:37:38+00:00,{},"1.14 OOS save backport of 05cd152

Don't merge yet, as it's not tested. Closes #3890.

@Vultraz might rename 1.14.8 milestone to 1.14.9"
274176863,Fix two typos in comments.,stikonas,2019-04-28 12:32:54+00:00,2019-04-28 12:33:40+00:00,{},
272579863,Add/move around mainline unit portraits,nemaara,2019-04-23 04:32:51+00:00,2019-05-02 02:05:46+00:00,{},For #4020. Right now I've moved the Fire Dragon portrait from TRoW and SoF to core and added the proposed water serpent portrait. I'll move around some of the orc portraits in this PR later on.
272246055,adding wolf portraits (#4041 to master),doofus-01,2019-04-21 22:48:37+00:00,2019-04-21 22:50:37+00:00,"{'Graphics': 1, 'Units': 1, 'Fwdport': 1}",This is same as #4041 but for master. It's new PR because I don't know how to merge a 1.14 PR to master without making a mess.
272187023,adding wolf portraits,doofus-01,2019-04-21 01:15:59+00:00,2019-04-21 22:49:31+00:00,"{'Graphics': 1, 'Units': 1}","I'd had in mind something more like what LordBob did with all the orc grunts, but I only have three images for now.  Since there are three wolves, I assigned the images a certain way, but they weren't really designed with the level progression in mind.  Hopefully there will be a few variations later, including a more obviously ""Great"" or ""Dire"" wolf."
270426491,Swedish translation update,mattiasmun,2019-04-15 08:54:18+00:00,2019-04-15 10:36:42+00:00,{},I have updated file po/wesnoth/sv.po
270307089,Campaign/core prose fixes,nemaara,2019-04-14 15:57:23+00:00,2019-04-16 23:29:22+00:00,{},For #2940 and #3322.
270124933,UtBS: few more fixes after refactor,DisherProject,2019-04-12 19:20:32+00:00,2019-04-21 14:45:27+00:00,{'Campaign (any)': 1},
268219747,Portraits for Monsters,ghost,2019-04-08 07:47:01+00:00,2019-04-09 01:49:18+00:00,{},"I noticed there are several sprites lacking portraits, and many well-done portraits have been made for these units. However, they have not been mainlined.
There is also plenty of Wesnoth Fanart, which seems realistic based on standards set by Jetryl, Lord Bob, Kitty and others.
I know not all may be acceptable, but please consider some of them, since I don't think we'll be getting many portraits anytime soon. At the very least, these could be placeholders for the time being.


**Units Lacking Portraits**
Here are some:

Royal Warrior
https://forums.wesnoth.org/download/file.php?id=43501
Made by LordBob. Used to be used for Eldaric from 'The Rise of Wesnoth'.

Cuttlefish
https://forums.wesnoth.org/download/file.php?id=75827
Made by doofus-01. Looks pretty good but not mainlined for some reason.

Fire Dragon
https://vignette.wikia.nocookie.net/wes ... 0329101334
Used in 'The Sceptre of Fire'. Could be used for the default portrait as very few of this unit are encountered in the first place.

Fire Guardian
https://forums.wesnoth.org/download/file.php?id=50119
I know LordBob had some issues with this one, but it doesn't seem totally unacceptable, more so as we don''t seem to be getting many contributions as of late.

Water Serpent
https://www.wesnoth.org/forum/download/ ... &mode=view
A great portrait. I know there were some issues, but I think it's better than having no portrait.

Wolf
https://wesnoth.org/forum/download/file.php?id=51877
Made by doofus-01.

Great Wolf
http://units.wesnoth.org/1.12/pics/add- ... lf-day.png
Found this from the 1.12 UMC 'Swamplings'. We could ask the artist for their permission.

Direwolf
https://units.wesnoth.org/1.12/pics/add ... rewolf.png
A photoshop of the wolf from the Direwolf Rider.


**Replacements for Repeat Portraits**

Elvish Rider
https://forums.wesnoth.org/download/file.php?id=83483
Lomarfel, the loyal Rider from 'An Orcish Incursion', who speaks only twice in the whole campaign, has his own portrait. Couldn't this be used for the Elvish Rider mainline portrait instead?

Elvish Outrider
https://forums.wesnoth.org/download/file.php?id=83484
In 'The Hammer of Thursagan', there is an enemy Rider who speaks only one line in a single scenario and does nothing more; he has his own portrait. It looks like one for a strong Rider, so we could use that for the Outrider mainline portrait. This portrait looks kinda evil, so maybe the expression could be slightly altered. Might be a controversial one, but I think it might work out.

Elder Mage
https://units.wesnoth.org/1.14/pics/add ... perrin.png
This is the portrait of Master Perrin from 'The Hammer of Thursagan', who speaks only in one scenario, and doesn't even cause defeat when he dies. He seems to look viable for the aforementioned unit's portrait.

Great Troll and Troll Hero
https://www.wesnoth.org/forum/download/ ... p?id=50932 (Proposed Great Troll)
https://forums.wesnoth.org/download/file.php?id=57422 (Proposed Troll Hero)
Can we not use the Troll Hero Alternate for the Level 2 and the Default for the Level 3, since the latter looks stronger than the former (and so more fitting to be a Great Troll portrait), instead of merely keeping it an alternate and repeating the same portrait for the two units?

Bat Line
https://ibb.co/nw4kWX8 (Vampire Bat)
https://ibb.co/S5LfsYJ (Blood Bat)
https://ibb.co/p3h824Q (Dread Bat, Existing Portrait)
Since the sprites for the Blood Bat and Vampire Bat are identical, I did a quick hue filter and made a blood bat portrait from the original, as well as a lighter version of the existing one to look more like the Level 0 Bat. The current Bat portrait could be used solely for the Dread Bat, as its colours better match the sprite."
268048962,Do a better job of catching pbl parse errors for addons,drzaal,2019-04-06 17:11:18+00:00,2019-04-24 23:46:01+00:00,{},"#3971 
Fail gracefully when an addon has an invalid pbl file, and make sure to push errors to the log and addon errors.

Should I include the pbl path somewhere in the logging?"
268014112,unit-database: issues/3949,drzaal,2019-04-06 05:24:16+00:00,2019-05-14 16:13:04+00:00,{'Units Database': 1},"This should be a resolution  for #3949 
The unit database list should include range and type icons
and the details summary page should include the type and range icons inline in the attack line item"
268011787,Change Giant Scorpion/Scorpling resists,nemaara,2019-04-06 04:22:15+00:00,2019-04-13 01:12:40+00:00,{'Units': 1},For #1299. Also adding a recolored scorpion sprite with the original resists as discussed on the issue (I'll add the frames and corresponding unit later if people think the coloring is fine). 
268008559,[THoT] Remove filler scenarios and add character,nemaara,2019-04-06 03:07:53+00:00,2019-04-27 14:33:44+00:00,{'Campaign (any)': 1},"(I got to this earlier than I thought) For #4009, I removed S4, S6, and S7 (which were mostly just filler scenarios), and added another character. This still needs a rebalancing pass and I need to change the new S5 (Fear), so marking WIP for now. "
267708253,Visual Studio 2019 Compilation - 1.14,Wedge009,2019-04-05 06:48:35+00:00,2019-04-06 06:20:21+00:00,{'Building': 1},I'm not sure if this is the best way to resolve the compilation errors (how was std::string defined previously?) but maybe it's a case of MSVC compiler being more strict somewhere.
267708238,Visual Studio 2019 Compilation - master,Wedge009,2019-04-05 06:48:32+00:00,2019-04-06 06:20:15+00:00,{'Building': 1},I'm not sure if this is the best way to resolve the compilation errors (how was std::string defined previously?) but maybe it's a case of MSVC compiler being more strict somewhere.
265899840,Fix some typos in the wesnoth-tb/ru.po,MaxGorr,2019-03-30 00:30:14+00:00,2019-03-30 07:27:56+00:00,{},
265119933,Unhide recruited unit when both the recruiter and recruitee are invisible to the viewing team,jostephd,2019-03-27 22:11:56+00:00,2019-03-30 16:20:01+00:00,"{'Needs more info': 1, 'UI': 1, 'Engine': 1}","The `return;` prevents the `set_hidden(false);` later in the function from being reached. This looks wrong, as though it would be a regression introduced by #3559, but I found no difference in my testing.

I found this while auditing code in search of a bug reported by @Konrad22 on discord. (In a nutshell, he played EI S17a and at the start of turn 6 an enemy Shadow was adjacent to Konrad's units but had `hidden=yes`.)"
263830952,Test scenario High XP Attack: use the map that it expects,stevecotton,2019-03-23 12:51:51+00:00,2019-03-23 14:08:12+00:00,{},"This scenario uses the huge final map from THoT, with different situations
split across different rooms of the map. THoT's final scenario was redesigned
with a completely new map in 457d9d17f, so this gives the test code its own
copy of the map.

There's a one-hex change to the original: the test puts side 1's leader in a
wall, isolated from the action. To clarify that that's intentional, the map
copy changes that hex to be passable, still surrounded by wall."
263614855,Fix #2852: Reset statistics when rewinding a replay to the beginning.,jostephd,2019-03-22 13:36:59+00:00,2019-03-25 13:37:59+00:00,{},
261854346,Misc more api,gfgtdf,2019-03-17 16:22:20+00:00,2019-11-19 01:20:21+00:00,{},
261853241,NR S02: Neater way to check that there's not a cave wall between Tallin and Hamel,stevecotton,2019-03-17 16:07:11+00:00,2019-03-22 22:24:42+00:00,{},
261700917,Spelling fixes in German translation of the tutorial,Ordoviz,2019-03-15 21:14:33+00:00,2019-03-18 23:04:38+00:00,{},"Feel free to ask me about the changes I made.

Some other small issues (not fixed with this PR):
- Space before ’%’: https://de.wikipedia.org/wiki/Prozent#Schreibweise
- Spelling of numbers is inconsistent and doesn’t seem to follow any logic"
260216507,String Updates (post-1.14.7 freeze),Wedge009,2019-03-12 04:32:09+00:00,2019-04-17 03:29:58+00:00,"{'Enhancement': 1, 'Prose': 1, 'Fwdport': 1}","Obviously not to be merged till after the 1.14.7 freeze is over (I tend to find stuff only while doing localisation updates, which happen to be during freezes...).

Happy to consider alternatives if you disagree, or even if you want to leave things as they currently stand. Just let me know constructively. ;)

Can be added to master as well, assuming no conflicts."
259814377,Campaigns: Add Wings of Victory (Drake Campaign),sigurdfdragon,2019-03-11 02:28:06+00:00,2019-05-01 22:32:18+00:00,"{'Enhancement': 1, 'Campaign (any)': 1}","Will leave this up for at least 2 weeks.

The contents of this PR match the current state of:
https://github.com/sigurdfdragon/Wings_of_Victory/tree/1.15
and will be updated as needed.

The current version of the campaign on the 1.14 add-on server is here:
https://github.com/sigurdfdragon/Wings_of_Victory

Forum Thread:
https://forums.wesnoth.org/viewtopic.php?f=8&t=49140

I left the version number in for now. Would prefer to leave it in during the 1.15 cycle to help keep track of changes ported from the 1.14 add-on version."
258723380,Print error messages in red,soliton-,2019-03-06 13:40:46+00:00,2019-03-06 13:42:01+00:00,{},"Use unbuffer to work around a travis issue when a secret is set in .travis.yml: travis-ci/travis-ci#7967
As a bonus colored output of for example cmake now works again.
Also streamline test execution."
258342201,Fix crash after hitting enter when no units match the recruit list filter,addaleax,2019-03-05 14:17:25+00:00,2019-03-05 14:21:39+00:00,{},"This is essentially the same as https://github.com/wesnoth/wesnoth/pull/3476, except that it is applied to the recruit dialog rather than the recall dialog."
258220730,[AToTB] S4: add dialogue between Baran and Tairach,nemaara,2019-03-05 08:00:03+00:00,2019-03-05 16:54:41+00:00,{},For #3388.
258052584,print error messages in red,soliton-,2019-03-04 18:56:22+00:00,2019-03-06 13:21:33+00:00,{},Also streamlined test execution and simplified execution timing.
257800722,NR: require Eryssa to survive if she joins the player,nemaara,2019-03-04 03:27:48+00:00,2019-03-04 16:21:46+00:00,{},This fixes #3121 and #3122 (and also makes a reasonable amount of sense story-wise).
257695245,Use the MP Moderators forum group to check for mod authority.,Pentarctagon,2019-03-02 21:59:01+00:00,2019-06-28 18:28:48+00:00,{},"People who have MP mod authority for testing or other reasons can continue to use the existing user_is_moderator column check, but for people who are supposed to moderate the server, now the forum group will be used.
This will make it easier to add/remove people to/from the group, and also ensure that the list of actual moderators matches up with the list available to users.

New config attributes added for this are:
* db_group_table - should be, based on the phpbb documentation I found, phpbb_user_group
* mp_mod_group - should be set to 6651"
257695011,[Tutorial] Small fixes,nemaara,2019-03-02 21:55:07+00:00,2019-03-04 16:17:00+00:00,{},"For #3390, see my comment there (https://github.com/wesnoth/wesnoth/issues/3390#issuecomment-468960279)."
257669018,"UI: Highlight enemy units in ""Show Enemy Moves"" mode",jostephd,2019-03-02 14:42:45+00:00,2019-03-05 17:09:14+00:00,{},"Fixes #1989 

Screenshot:
![screenshot_2019-03-03_15-01-33](https://user-images.githubusercontent.com/24784687/53697089-70b0d700-3dc5-11e9-96fb-798af64f0d48.png)

Does the implementation look right? I put the new member function in `game_display` next to the other reach functions, but then I had to use a `dynamic_cast` in unit_drawer because it can be constructed from a plain `display`: https://github.com/wesnoth/wesnoth/blob/53baf3514a8db2a96c6c5fae4d40af76b7e164f4/src/display.cpp#L2536"
257653391,[DiD] Patch fixes,nemaara,2019-03-02 09:17:32+00:00,2019-03-09 17:37:27+00:00,{},"I missed some small things with the other PRs, so this one will address those issues."
257497983,"Revert ""Fix parser crash in defined multi line str test""",soliton-,2019-03-01 16:08:26+00:00,2019-03-01 16:09:20+00:00,{},Reverts wesnoth/wesnoth#3948
257358286,[UtBS] Quenoth unit descriptions,nemaara,2019-03-01 08:27:50+00:00,2019-03-08 15:30:44+00:00,{},"For #2961, I'll base this PR partially on what's in the forum currently."
257191679,[DiD] Update unit descriptions,nemaara,2019-02-28 19:06:28+00:00,2019-03-03 17:58:54+00:00,"{'Campaign (any)': 1, 'Prose': 1}",As the title says.
257175529,Allow previewing enemy attacks,jostephd,2019-02-28 18:14:34+00:00,2020-09-12 01:18:53+00:00,{'UI': 1},"@beetlenaut https://forums.wesnoth.org/viewtopic.php?f=12&t=49404

This allows simulating enemy attacks ~~in planning mode~~. Select an enemy unit and mouseover an own unit, you'll see a blue attack indicator arrow similar to the usual red one, and if you have highlighted_unit_weapons or selected_unit_weapons in your theme you'll see the CTH histogram in the sidebar.

(See https://forums.wesnoth.org/viewtopic.php?f=12&t=49404&p=639014#p639014 for how to add those to the theme and https://forums.wesnoth.org/viewtopic.php?f=12&t=49404&p=639014#p638934 for screenshots)

Known issues:

- [x] account for the timeofday changes between your turn and your enemy's
- [x] (should be done, but test) it should be possible to get the blue arrow and histogram even when not in planning mode
- [x] check the `if(!wb_active)` restrictions if they can be relaxed/lifted
- [x] reword commit messages
- [ ] Figure out attack indicator arrow coloring issue https://github.com/wesnoth/wesnoth/pull/3956#issuecomment-471114209
- [ ] Let the attack dialog be opened so the CTH histogram can be viewed in the default theme too https://github.com/wesnoth/wesnoth/pull/3956#issuecomment-474907377

Please review/test"
256863042,Fix parser handles textdomain directives incorrectly,LovCAPONE,2019-02-27 22:26:04+00:00,2019-02-28 09:40:45+00:00,{},"The problem is that when parsing #textdomain directives, the parser
expects the directive to be at the start of the line. So if the directive
is preceded by spaces or tabs then it is treated as an attribute.

The solution is to strip all spaces and tabs on the left side of the
parsed line string when checking for #textdomain directive.

Closes #3951"
256077366,Fix parser crash in defined multi line str test,LovCAPONE,2019-02-25 22:52:33+00:00,2019-02-28 15:24:22+00:00,{},"The problem is that if we have a ""#define"" directive followed with an
empty line ending with a newline character then the parser presumes the
value is the newline character instead of the actual value (which is
located on a subsequent line).

The solution is that when parsing an empty line, if ""self.in_string"" is
False and ""self.temp_key_nodes"" is not None then we ignore the line
instead of parsing it with the ""parse_outside_strings"" function.

Closes #3947"
255721403,some basic animations - forwardporting PR#3896,doofus-01,2019-02-24 23:15:15+00:00,2019-02-24 23:19:42+00:00,{},"These were merged into 1.14, this PR is to merge them into master."
255682293,Help: Show damage type and range icons in unit help pages,jostephd,2019-02-24 12:58:08+00:00,2019-03-20 14:54:19+00:00,"{'Enhancement': 1, 'Ready for testing': 1, 'UI': 1}","Following up on #3732, also use the icons in the unit help pages:

![screenshot_2019-02-24_12-55-42](https://user-images.githubusercontent.com/24784687/53299541-86f1ec80-3833-11e9-982c-1498338a5c2e.png)

- [x] add icons to the table
- [x] don't put the icons in their own column but in the existing column
- [x] test it looks right when damage type or range or both have no icon"
255678450,Typo fixes,jostephd,2019-02-24 11:46:22+00:00,2019-03-03 15:36:55+00:00,"{'Bug': 1, 'Prose': 1}",
255654982,Defense anims - forwardporting PR#3896,doofus-01,2019-02-24 02:31:47+00:00,2019-02-24 23:12:50+00:00,"{'Graphics': 1, 'Fwdport': 1}","content from da4afc7 applied to master/1.15
It may take me some time to figure this out...
EDIT:  Maybe this isn't worth the effort.  But I'll leave this PR here as a reminder."
255618127,Extend the image localization system to sounds and music,CelticMinstrel,2019-02-23 14:47:52+00:00,2019-03-03 21:13:30+00:00,{},"This is a pretty simple change, and is necessary in order to create localized voice tracks. Including music probably isn't strictly necessary, but music _can_ have words in it, so I figured it wouldn't hurt."
255383985,Fix issue #3859,hrubymar10,2019-02-22 12:50:07+00:00,2019-02-23 13:31:24+00:00,{},"This fixes issue described here: #3859

I would like if somebody more skilled in C++ could check, if is this correct."
255216768,fix wmlunits crash,elias-pschernig,2019-02-21 23:09:52+00:00,2019-02-25 09:29:43+00:00,{},
254396264,Fix parser opens tmp file 2 times then crashes,LovCAPONE,2019-02-19 20:23:59+00:00,2019-02-21 19:18:49+00:00,{},"When parsing binary data in the wmlparser3 script, a temporary file is
created and opened. The problem is that the temporary file is never
closed and in subsequent functions it is reopened.

The solution is first, create a list of temporary file paths to delete at
program’s exit. In the atexit’s registered cleaning function, all the
files in this list are deleted.

Then in the function that creates the temporary file, we simply close
the file after the binary data has been written in it.

Closes #3927"
253747491,Fix of issue #3912,blaf,2019-02-17 23:03:20+00:00,2019-02-18 17:45:26+00:00,{},"Hello,

Submitting a fix for issue #3912 .

This is my first contribution to wesnoth repository.

David Slaby (blaf)
"
253671425,"Main menu ""Campaigns"" button pt_BR translation fix",samirph,2019-02-16 22:06:24+00:00,2019-02-22 06:51:07+00:00,{},"The ""Campaigns"" button in the main menu is the only button that the Brazilian Portuguese translation is not working."
251846013,Add quick-start instructions on building Wesnoth in Windows,Adriankhl,2019-02-11 09:30:16+00:00,2019-08-10 20:17:37+00:00,"{'Windows': 1, 'Building': 1}","The INSTALL.md file contains only the instructions of CMake and Scons, but neither of the default options works in Windows, even after the listed dependencies are installed using MinGW-w64. Therefore, I have added a quick instruction on the essential options needed by Scons in MinGW-w64. "
251764455,Fix issue #3831: Broken unit movement animations (1.14),madmax28,2019-02-10 20:44:38+00:00,2019-02-10 21:09:12+00:00,{},See #3919 
251760633,resolve  Check whether special is active by tag name or by id,newfrenchy83,2019-02-10 19:43:31+00:00,2019-10-03 15:41:04+00:00,{},resolve https://github.com/wesnoth/wesnoth/issues/3915 with add of special_id and special_tags( and idem for special_active)
251757862,Fix issue #3831: Broken unit movement animations,madmax28,2019-02-10 18:56:40+00:00,2019-02-10 21:09:16+00:00,{},"This fixes Issue #3831. The problem was that the appearance_changed attribute was set in set_facing() even if the direction the unit faces did not change.

The flag is passed to the unit_mover: https://github.com/wesnoth/wesnoth/blob/095edb36a1b4d06d8ab904e3d622e94ac9d65308/src/actions/move.cpp#L544-L545
Which causes the fake unit to be replaced: https://github.com/wesnoth/wesnoth/blob/095edb36a1b4d06d8ab904e3d622e94ac9d65308/src/units/udisplay.cpp#L328-L330"
251736939,Infinite loop with berserk weapon special if value is negative,newfrenchy83,2019-02-10 12:59:28+00:00,2019-05-20 12:36:18+00:00,{},"In weapon special berserk value by default is 1 and value less to 1 are exclude, i must be do what is the same in berserk ability."
251694661,Don't append ICU libs to LIBS,equal-l2,2019-02-09 19:52:50+00:00,2019-02-12 15:09:15+00:00,{},"Boost locale should not require the ICU libs linked manually.
This also causes a false-negative failure (cannot detect any backend) on macOS because macOS doesn't provide the ICU libs and the ICU libs from Homebrew requires special care to link."
250619807,Bug #3903 Fix.,LovCAPONE,2019-02-06 02:51:08+00:00,2019-02-11 19:48:01+00:00,{},"The problem was that in the WML parser, when parsing the outside of a string that is translatable, the code only assumed “spaces” characters could precede it. If there are “tabs” characters the code parses the “_” character as an attribute value.

The solution is to add a stripping code for “tabs” characters.
"
250618468,Bug #3862 Fix.,LovCAPONE,2019-02-06 02:39:24+00:00,2019-02-12 20:06:25+00:00,{},"The problem was that in the wml parser, when a node creation spans multiple lines, the code doesn’t take in account that one of those line can contain a #textdomain directive.

In the method “parse_outside_strings” (line 501), the code that processes the #textdomain directive is inside an if block that is true only if the node creation doesn’t span across multiple lines (self.temp_key_nodes is null).

The solution implemented is that in the method “parse_outside_strings” (line 501), the code that check if a line starts with #textdomain is moved from inside the block that is true only if the node creation doesn’t spans across multiple lines and put in the method scope after the first if block that checks if the line is empty."
249862924,[DiD] Revised S12,nemaara,2019-02-03 08:21:39+00:00,2019-03-07 02:32:58+00:00,{},"Not strictly finished yet with this revision, josteph has recommended a way to make the scenario a bit more engaging after several repetitions, and I will try to implement that after playtesting a little bit."
249352871,Send forum-based MP ban duration remaining to clients,irydacea,2019-01-31 18:29:28+00:00,2019-03-01 05:36:54+00:00,"{'Backport': 1, 'MP': 1, 'UI': 1}","See issue #3766.

![image](https://user-images.githubusercontent.com/489895/52076504-93a15e80-256d-11e9-87de-d0e0d25500f2.png)

This has the side-effect of extending the MP server protocol a bit by adding a `[data]` subtag to `[error/warning/message]` responses that can contain an arbitrary set of data in k/v form, used in this PR to send the remaining duration of the ban as a `time_t` value. It could potentially be used for other purposes in the future.

Also note that this introduces around 17 new translatable strings. "
249316163,Bug 3862 fix,LovCAPONE,2019-01-31 16:33:30+00:00,2019-02-05 23:43:22+00:00,{},"The problem was that in the wml parser, when a node creation spans multiple lines, the code doesn’t take in account that one of those line can contain a #textdomain directive.

In the method “parse_outside_strings” (line 501), the code that processes the #textdomain directive is inside an if block that is true only if the node creation doesn’t span across multiple lines (self.temp_key_nodes is null).

The solution implemented is that in the method “parse_outside_strings” (line 501), the code that check if a line starts with #textdomain is moved from inside the block that is true only if the node creation doesn’t spans across multiple lines and put in the method scope after the first if block that checks if the line is empty."
249026485,[DiD] Rewritten S11 scenario,nemaara,2019-01-30 20:57:26+00:00,2019-03-06 01:04:12+00:00,{'Campaign DiD': 1},"As the title states, a new scenario for S11 at @jostephd's suggestion."
248249420,Fix a typo in micro_ai simple_attack demo: you -> your.,stikonas,2019-01-28 18:55:09+00:00,2019-03-06 16:40:10+00:00,{'Prose': 1},[ci skip]
248007534,Some sprite animations (WIP),doofus-01,2019-01-28 03:20:30+00:00,2019-02-24 02:04:12+00:00,"{'In-progress': 1, 'Graphics': 1}","We've got some sprites with no animations at all.  I can't commit to supplying all needed animations, but here I will supply some very basic frames, so there is at least some motion.

I'm not sure what the release schedule is, or what my ability to work on anything will be, so if needed this can be merged anytime (at least as far as I'm concerned). 
 
 - defense animations for elf horse units and melee attack for Elf Outrider
 - Cavalryman, Dragoon, and Cavalier defense animations
 - Lancer defense animations - The ""hits"" filter doesn't seem to be working, possibly I made a mistake, but I'm not seeing it right now.
 - Grand Knight and Paladin defense animations
 - Merfolk defense anims: Hoplite, Entangler, Enchantress, Diviner, Netcaster

Looking at the existing frames of units that have been stalled for years, I see many loyalist horsemen/cavalrymen, many merfolk, dwarf arcanister, and fire dragon as candidates for this PR.  Dunefolk are relatively new and have enough attention, they don't need to be part of this.

EDIT:  I believe the fire dragon base sprite, or at least a default standing frame, needs revision.  That would need to be done before any animation.  It should be a different PR, I won't try to address it here."
247925543,[TRoW] S22: cuttlefish animations use different facing filters,nemaara,2019-01-27 01:29:52+00:00,2019-01-27 21:03:06+00:00,{},To address #3855. 
247457204,LoW S22: Single-player objectives should include Cleodil surviving,stevecotton,2019-01-24 19:56:23+00:00,2019-01-25 22:29:17+00:00,{},"@gfgtdf , I think the logic in ae5414d67 was the wrong way round."
247163762,Spelling corrections for 1.14.6,Wedge009,2019-01-24 00:32:26+00:00,2019-01-27 06:00:21+00:00,"{'Campaign (any)': 1, 'Translations': 1, 'Units': 1, 'Stable 1.14': 1, 'Fwdport': 1}","I realise we're in a string freeze for 1.14.6 at the moment - this can wait till it's released. In fact, I only found these _because_ I was reviewing the string changes for the 1.14.6 release.

Sending as a PR because I always seem to get things wrong with relation to string updates, especially if pofix is involved. Aside from maybe 'right click', I think these warrant an actual po update because translators may not necessarily know the intended word from the mis-spelled word."
247155416,[DW] S12 rebalance,nemaara,2019-01-23 23:45:52+00:00,2019-01-26 23:58:59+00:00,{'Campaign (any)': 1},"Addresses #3399, gives the enemy some more useful reinforcements, but reduces ai gold/income to compensate. @Konrad22, would you mind playtesting this to see if you think this is of reasonable difficulty?"
247103410,[TRoW] Small bugfixes,nemaara,2019-01-23 20:21:13+00:00,2019-01-26 21:53:45+00:00,{'Campaign (any)': 1},"As the title states, to address #3819. "
246774072,"codeblock: link to libogg, libvorbis and libvorbisfile for stable branch",newfrenchy83,2019-01-22 22:25:51+00:00,2019-01-22 23:05:24+00:00,{},Required for pull request #3851 that was recently merged.
246717127,"codeblock: link to libogg, libvorbis and libvorbisfile",newfrenchy83,2019-01-22 19:02:25+00:00,2019-01-22 19:14:31+00:00,{},Required for pull request #3851 that was recently merged.
246703530,DW S3: added event for storm trident,nemaara,2019-01-22 18:14:16+00:00,2019-02-26 06:57:10+00:00,"{'Enhancement': 1, 'Campaign (any)': 1}","As the title says, implemented @CelticMinstrel's suggestion for #3400 (subtracted 30g from the enemy side to compensate for the extra wild wolf).

(Has string changes in it, don't merge for 1.14.6)."
246696857,[AToTB] Added castle ToD to S3,nemaara,2019-01-22 17:51:07+00:00,2019-02-26 06:29:59+00:00,"{'Enhancement': 1, 'Campaign (any)': 1}","Implemented @stevecotton's fix to #3389 with some slight modifications for gameplay rebalancing (I've playtested, don't know if anyone else wants to?). I didn't modify the lit stone walls to sconces, since scones don't seem to work right now. For 1.15/1.16, once those terrains work, we can fix them then. 

This has some string changes, so probably needs to go in 1.14.7."
246438625,Remove a stray foo.,stikonas,2019-01-21 23:42:27+00:00,2019-01-21 23:54:29+00:00,{},
246135373,[DiD] Gameplay update to S4 and S5,nemaara,2019-01-20 21:17:40+00:00,2019-01-31 03:06:31+00:00,{},A small change to S4 and S5 to rebalance them a bit. 
245974776,[DiD] S10 revision,nemaara,2019-01-18 21:16:38+00:00,2019-03-02 18:45:42+00:00,{},Extra dialogue for S10.
245367303,[DiD] Gameplay update for S2,nemaara,2019-01-17 03:49:29+00:00,2019-01-31 02:49:04+00:00,{},Corresponding gameplay update for DiD S2. The original was a bit challenging for a second scenario (and supposedly just a small goblin scenario) so I made it a bit easier and reduced the size of the map. Should take fewer turns to play through now too.
244640353,Fix addon manager crash if not finding the add-on,LovCAPONE,2019-01-15 00:56:50+00:00,2019-01-17 23:43:52+00:00,{},"In the addon manager, there was no validation code for paths in the file system for uploading addons. This fix adds validation at the parsing level, so that the original code is left unchanged."
244234196,"[WIP] SotA: Fixes, Updates, & Zombies",sigurdfdragon,2019-01-12 18:11:34+00:00,2019-01-15 01:05:18+00:00,{},"Several minor improvements,
Slight gameplay changes in S01 & S02
Ability to recruit different kinds of walking corpses

From @beetlenaut "
244228030,Add string representation to wmlparser3 nodes,ProditorMagnus,2019-01-12 16:21:01+00:00,2019-01-18 08:57:59+00:00,{'WML Tools': 1},"I reverted wml fragment formatting currently, not sure if those may be changed."
244226322,Escape markdown in README.md,ProditorMagnus,2019-01-12 15:49:06+00:00,2019-01-12 16:22:27+00:00,{},
244085936,"New description for the Goblin Knight, minor change to the Wolf Rider",stevecotton,2019-01-11 16:51:31+00:00,2019-03-07 22:13:10+00:00,{},"From the ""revisiting Wesnoth unit descriptions"" forum thread,
https://r.wesnoth.org/t48137 .

The Wolf Rider's new text is the collated version in
https://r.wesnoth.org/p628443

The Goblin Knight text is a new revision of my own proposal."
243577693,[DiD] S7-S9 revisions,nemaara,2019-01-10 06:30:24+00:00,2019-03-02 09:06:59+00:00,{},"As the title states, updates the dialogue in DiD S7."
243247955,[DiD] S6 Gameplay and dialogue revision,nemaara,2019-01-09 08:29:33+00:00,2019-03-01 05:11:34+00:00,{},"Gameplay and dialogue revision for DiD S6, I still need to fix the bigmap so that it shows the correct path to match the new dialogue. This one also needs a bit of playtesting; I only did a very quick test on hard mode to ensure that it was playable, but I'll need to go back later to confirm that it's reasonably balanced (some help here would be appreciated). 

This should address issue #3710."
242789690,"mp_staging: Build all teams, not only those that have a side assigned to them (#3849)",jostephd,2019-01-07 21:38:17+00:00,2019-03-03 16:15:52+00:00,{},"I just moved the team initialization to another function and made it initialize all teams, not only those that some side was on."
242550327,Cross-platform music track reading,Wedge009,2019-01-07 04:31:23+00:00,2019-01-22 00:26:06+00:00,{'Audio': 1},Related to #3773 discussion. Should apply just as easily to 1.14 branch.
242522028,[DiD] Revisions for S4 and S5,nemaara,2019-01-06 22:35:53+00:00,2019-02-28 04:45:13+00:00,{},"As the title says. Right now I've finished S4, S5 will come soon."
242501373,Campaign selection: Add search functionality,dvladf,2019-01-06 15:46:19+00:00,2019-01-27 12:32:23+00:00,"{'Enhancement': 1, 'Ready for testing': 1, 'UI': 1}","Added search functionality for campaign selection (issue [#3829](https://github.com/wesnoth/wesnoth/issues/3829)).
![screenshot_20190106_233133](https://user-images.githubusercontent.com/46393722/50738153-ea847400-120b-11e9-8ab4-81d8c0ac4daa.png)
Initially, I did as it was in the unit_recruit.cpp, but the search there is case-sensitive for Russian locale."
242480494,[DiD] S3 Dialogue and Gameplay rewrite,nemaara,2019-01-06 07:27:01+00:00,2019-02-27 05:38:00+00:00,{},"An update to the dialogue for DiD S3, again not meant for 1.14.6. There is a slight gameplay change, I've made it so that you can now recruit skeletons."
242470174,[DiD] S2 revision,nemaara,2019-01-06 01:27:33+00:00,2019-02-27 05:05:35+00:00,{},"As the title says, this updates the dialogue for the second scenario of DiD. Not meant to be merged into 1.14.6."
242462133,[DiD] Dialogue and slight gameplay revisions to S1 ,nemaara,2019-01-05 21:42:58+00:00,2019-02-27 04:39:32+00:00,{},"Addresses #3161, #3308, and #3310 now the river fort is on the side of the ford that's closer to the town, so it actively blocks the orcs' path toward Parthyn. The signpost marks the limit of where you need to guard (i.e. if they reach the signpost line, you lose). 

I gave the orcs a little bit of income since if you played well, it was actually fairly easy to kill all their units, then your allied side could actually just charge the orcs and kill their leader.

Turn limit reduction is because the objective says ""defend for two nights"", and the last turn of the second night is actually turn 12, not 14 or 15. 

I also updated the dialogue for this scenario, Dela now makes an appearance here.

(This isn't meant to be merged into 1.14.6, but could go into 1.14.7, perhaps, or just 1.15.0). 

Map screenshot:

![image](https://user-images.githubusercontent.com/13598479/50729522-71045d00-1109-11e9-98ec-a6db94bebe1d.png)
"
242307477,update CB scons project,newfrenchy83,2019-01-04 16:19:46+00:00,2019-01-04 17:06:29+00:00,{},
242307055,update CB projectfile,newfrenchy83,2019-01-04 16:18:10+00:00,2019-01-04 17:06:04+00:00,{},
241606405,optipng run: ./utils/woptipng.py -d 15 images/,edwardspec,2018-12-31 22:44:50+00:00,2019-01-02 17:26:49+00:00,{},"It has been a while since the last optipng run (it was in 2015),
and many non-optimized PNG files have accumulated in the repository.

288 of 1666 files optimized, 258992 bytes reduced to 156258 bytes; -102734 bytes, -39.66%

To avoid unnecessarily increasing the size of Git repository for minor
size reductions, we skip images that weren't reduced by at least 15%."
241544190,Fix typo in menu_button: active icon was used instead of pressed icon,edwardspec,2018-12-31 09:42:28+00:00,2019-01-02 17:10:36+00:00,"{'Bug': 1, 'UI': 1}","Icon `short_arrow_left_25-pressed.png` exists, but is not used anywhere.
Widgets in `menu_button_default.cfg` and `multimenu_button_default.cfg` were using active icon (`short_arrow_left_25-active.png`) for the ""pressed"" state."
241484127,Note dependencies on OpenGL and GLEW in INSTALL.md,equal-l2,2018-12-30 10:02:18+00:00,2018-12-31 08:41:35+00:00,{},They are required to build wesnoth client but not noted.
241209110, resolve negative value problem,newfrenchy83,2018-12-27 19:14:37+00:00,2019-01-02 19:29:53+00:00,{},this is the same PR what https://github.com/wesnoth/wesnoth/pull/3788 except what tod-manager not changed for bugs in illuminates will be tested. (when an unit with normal illuminates and another with darkens (value=-25 min_value=-25) are adjacent).
241025714,resolve problems of negative value for heals,newfrenchy83,2018-12-26 19:26:37+00:00,2018-12-28 22:09:34+00:00,{},This is the only option to solve this problem without breaking add and sub tags. Fix for https://github.com/wesnoth/wesnoth/issues/3811 issue
241025143,pofix: Strip msgstr's when checking for duplicate msgid's,jostephd,2018-12-26 19:21:18+00:00,2018-12-27 12:35:56+00:00,{},"Fixes some false positive warnings such as

```
pofix: po/wesnoth-aoi/en_GB.po already includes the new string
	""the bodies of both sides. ""
but also the old
	""the bodies of both sides, ""
this needs handfixing for now since it likely creates duplicate msgids.
pofix: po/wesnoth-aoi/en_GB.po already includes the new string
	""There was no hale orc in sight,""
but also the old
	""there was no hale orc in sight,""
this needs handfixing for now since it likely creates duplicate msgids.
```

in current master. This occurs when one of the duplicates is in the msgid and one in the msgstr. This example is en_GB but it also affects the drake race description in pl.po in 1.14, where some of the paragraphs in the msgstr are in English.

Okay to merge?"
240868147,[SoF] Minor bugfixes,nemaara,2018-12-25 11:59:44+00:00,2019-01-05 05:18:32+00:00,{'Campaign (any)': 1},"Added some snow for #3416. Gameplay and other things should be exactly the same as before, I only swapped out some tiles that don't affect the player at all. "
240865930,[SoF] Clarified objective for S5 Hills of the Shorbear Clan,nemaara,2018-12-25 11:28:09+00:00,2019-01-06 15:46:58+00:00,{'Campaign (any)': 1},Implemented the fixes suggested in #2080 as is (added a label and put in zookeeper's suggested objective text). 
240856996,Liberty: Modified map and ai gold in S2 Civil Disobedience ,nemaara,2018-12-25 09:45:39+00:00,2019-01-05 02:29:47+00:00,{'Campaign (any)': 1},"This PR addresses #3376 by setting the ai gold to zero and changing the enemy captain's starting location to a non keep-hex (actually there are no more enemy keeps, since I modified the map very slightly). I left the ai leader with the attribute canrecruit=yes since the gold bar will make it clearer to the player that Tarwen is in fact the enemy leader (if it wasn't clear enough from the fact that he's a level 3, but anyway the gold bar is nice to have). "
240850150,[TRoW] Moved wesfolk leader variable storage events,nemaara,2018-12-25 08:40:20+00:00,2019-01-05 03:26:06+00:00,{'Campaign (any)': 1},Simply moved storing storing the wesfolk leader unit variable to victory events to address #2752. This should allow one to quickly debug using :n now.
240833620,"Make defender's ""first strike"" inactive if the attacker also has ""first strike"", fixes #3784",seanyeh,2018-12-25 05:22:47+00:00,2019-02-09 12:53:16+00:00,{},"Here is a commit to address issue #3784 . This will make a defender's ""first strike"" inactive if the attacker also has ""first strike""."
240718574,[EI] Modified some player shroud and fog settings for #3782,nemaara,2018-12-24 04:26:19+00:00,2019-01-06 15:57:15+00:00,{'Campaign (any)': 1},"This PR addresses #3782; I've changed the player side to have fog at all times now. On the first turn, the player can see the path where the trolls are (parts of the path are unshrouded, but fogged). Upon seeing the dwarves (turn 2 or 3 ish, typically), the map becomes unshrouded including the amulet and treasure rooms. This should keep the player from going the wrong way due to lack of information."
240702800,[TSG] Update changelog for TSG revisions,nemaara,2018-12-23 22:08:26+00:00,2018-12-24 15:07:06+00:00,{},"As the title says, just wrote slightly more detailed notes for the changelog regarding the TSG update."
240216541,MP load game: do not overwrite saved AI,mattsc,2018-12-20 15:51:08+00:00,2018-12-23 21:26:17+00:00,{},"When an MP game is saved and then reloaded from the MP Create Game screen, one goes through the Game Lobby screen which gives the option of changing controllers and AIs for the different sides. Previously, this added an AI stage in front of the already existing AI for all computer player sides. This effectively replaced the existing AI.

This commit adds an option ""Keep saved AI"" to the Computer Player selection menu (when loading games only) and makes it the default. It does nothing to the AI config if this is chosen, otherwise it uses the new AI and also removes the old AI stages from the config.

This fixes #3791."
240052388,[DiD] Small fixes to address #3710,nemaara,2018-12-20 04:57:49+00:00,2019-01-09 19:57:01+00:00,"{'Bug': 1, 'Campaign (any)': 1}","Like the title says, two small fixes to address issue #3710. Killing a unit on side 3/4 no longer causes you to instantly lose if Drogan is still alive. Killing the orc leader also does not result in victory; you still need to move to the signpost after. However, the objectives do state that as a bonus objective, you can kill the orc leader, but you don't actually get anything for doing so. Perhaps I could add a small gold reward?"
239590484,wmllint: don't analyze WML within [filter_wml] blocks (most checks are not applicable to its contents),edwardspec,2018-12-18 18:38:21+00:00,2019-11-04 11:14:59+00:00,{},"This fixes situation when wmllint tried to add `description=_""fireball""`
to the following WML code:

```
[filter]
    [filter_wml]
        [not]
            [attack]
                name=fireball
            [/attack]
        [/not]
    [/filter_wml]
[/filter]
```

Tags within `[filter_wml]` don't need to have all mandatory arguments
(like ""description""), because:
1) they are temporary constructs and this description is never used,
2) such WML code expects that results will be filtered ONLY by name.
Adding description will remove results that have the same attack name
but different description."
238986258,Fix for wesnoth#3235: screenshots in titlescreen,mstrebel,2018-12-16 19:48:03+00:00,2018-12-17 17:58:11+00:00,{},"Registers hotkey in titlescreen, adds code for taking screenshot with
choosing a filename."
238984157,resolve problem of negative value for all abilities,newfrenchy83,2018-12-16 19:07:03+00:00,2018-12-28 22:07:23+00:00,{},"i know, i must wait what https://github.com/wesnoth/wesnoth/pull/3774 will be commited. Heals is not the only ability with leadership who was affect by that problem but also weapon like abilities like drains where use of add and sub is not an good idea for resolve problem of negative value, use value=-value is more easy for umc develloper if efect constructor is fixed."
238973948,Recruit Unit: Add search functionality,jostephd,2018-12-16 15:50:34+00:00,2018-12-23 16:42:38+00:00,"{'Enhancement': 1, 'UI': 1}","Will be useful, particularly for [certain](https://github.com/ProditorMagnus/Ageless-for-1-14/commit/a016fc9058afeeba05e148a7116a6c4116d4875b) large factions, but also for quickly searching the recruit list for a particular unit type.

In the test scenario (which allows you to recruit several dozen unit types) it looks like this:
![screenshot_2018-12-16_14-40-28](https://user-images.githubusercontent.com/24784687/50055702-156a3380-014a-11e9-870a-1f72438abb1c.png)

The search uses the localized name."
238962959,"wmllint: fix ""local variable 'unit_id' referenced before assignment""",edwardspec,2018-12-16 12:22:54+00:00,2019-01-22 00:56:38+00:00,{},"In global_sanity_check(), variables ""unit_id"" and ""base_unit"" can be
used before assignment. This happens, for example, in this WML file:
https://github.com/Dugy/Legend_of_the_Invincibles/blob/master/utils/amla.cfg#L65
... where there is a [/unit_type] tag without the matching [unit_type].

(these variables are normally initialized when [unit_type] is found)"
238922510,"Revision for The Hammer of Thursagan Scenario 12 ""The Underlevels""",Pentarctagon,2018-12-15 17:27:04+00:00,2018-12-15 17:27:45+00:00,{},See: #3126
238918166,Help: Document campaign 'level' and 'difficulty'.,jostephd,2018-12-15 15:55:17+00:00,2018-12-29 17:11:57+00:00,"{'Enhancement': 1, 'Prose': 1, 'Help': 1}",
238918063,Sidebar: In the tooltip of 'lvl 1' show modifications advancements as well as type advancements,jostephd,2018-12-15 15:52:56+00:00,2018-12-17 17:14:16+00:00,"{'Enhancement': 1, 'UI': 1}","For example, for a Quenoth Youth, show this:
![screenshot_2018-12-15_15-42-16](https://user-images.githubusercontent.com/24784687/50044824-619d7100-0081-11e9-8b44-58f6ece6d5df.png)
instead of ""No advancement""."
238917075,Fix #3744: Changing theme twice,mstrebel,2018-12-15 15:29:45+00:00,2018-12-15 16:24:43+00:00,{},"After std::move, source (known_themes) can't be used.
Because it is a static variable, i removed std::move."
238825013,resolve Weapon special abilities need to pass other_unit to the filters and add filter_student,newfrenchy83,2018-12-14 19:52:06+00:00,2019-02-21 04:19:51+00:00,{},"now, filter_opponent usable for backstab abilities and issue https://github.com/wesnoth/wesnoth/issues/3771 fixed"
238153717,resolve problem of negative value for leadership,newfrenchy83,2018-12-12 19:23:48+00:00,2018-12-23 15:37:09+00:00,{},this is the fix what i propose for the https://github.com/wesnoth/wesnoth/issues/3770 issue.
237088153,resolve (yet) the problem of negative value.,newfrenchy83,2018-12-08 19:57:00+00:00,2018-12-09 22:37:18+00:00,{},"this time, i resolve this what for leadership and for the other, only sub is fixed."
237015765, resolve problem of negative value without alterate illuminates ,newfrenchy83,2018-12-07 22:53:19+00:00,2018-12-08 14:37:28+00:00,{},i replace https://github.com/wesnoth/wesnoth/pull/3754 by this PR for more readibility. The new rule of calculation is used by default. illuminates abilities are an exception and old rule of calculation in the effect constructor must be used for not modify the final values when two units with illuminates but with opposites values are adjacent.
236927078,Clean up old AI TODOs,mattsc,2018-12-07 16:41:13+00:00,2018-12-18 14:25:57+00:00,{},This addresses many of the AI TODOs in #3695
236356157,update CB scons project,newfrenchy83,2018-12-05 23:17:06+00:00,2018-12-06 07:29:00+00:00,{},
236354839,update codeblock project,newfrenchy83,2018-12-05 23:10:45+00:00,2018-12-06 07:27:59+00:00,{},
235992459,fix value={CTH_NUMBER} forget in force CTH macro,newfrenchy83,2018-12-04 23:12:32+00:00,2018-12-14 14:28:14+00:00,"{'Blocker: New Stable': 1, 'Engine': 1}","i don't see before what value was forget, sorry about that."
235708184,Filter hotkeys,rocketBANG,2018-12-04 07:41:58+00:00,2019-01-06 18:04:09+00:00,"{'Enhancement': 1, 'UI': 1}",Add the ability to filter hotkeys by description to make it easier to find specific hotkeys
235694433,Filter hotkeys,rocketBANG,2018-12-04 06:31:22+00:00,2018-12-04 07:11:39+00:00,{},Added a filter for hotkeys so that specific hotkeys can be found more easily
235510104,AI schema validation additions,mattsc,2018-12-03 16:29:27+00:00,2018-12-04 14:29:26+00:00,{},This is a small PR adding some AI keys to the schema validation.  I'll also add the fix to the unit tests once I figure out what is going on there.
235474819,fix units no used,newfrenchy83,2018-12-03 14:52:36+00:00,2018-12-03 18:58:15+00:00,{},fix https://github.com/wesnoth/wesnoth/commit/16927f9508115614fab4fe46f28649982bf49d4b
235294326, resolve negative value for leadership and alternate for heal ,newfrenchy83,2018-12-02 23:31:33+00:00,2018-12-16 19:07:28+00:00,{},"i post an alternate PR to https://github.com/wesnoth/wesnoth/pull/3748 for not broken heals where ""value"" not used. i let both PR open because i can't choice a solution"
235272013,fixup! DiD S1: Add a dialog hint about the loyals staying behind.,jostephd,2018-12-02 17:19:52+00:00,2018-12-17 16:58:29+00:00,"{'Bug': 1, 'Prose': 1}",Fixup the dialog added in 39f26950c3a30f449e7c378dc94ebb26cc992cfb which is part of #3711. (#3711 has been merged to master but it's open because its target is 1.14.)
235271236,fix compile error in 16927f9,newfrenchy83,2018-12-02 17:05:32+00:00,2018-12-03 14:29:31+00:00,{},perhaps what i could don't suppress static bool but i will fix that in priority.
235270146,place backstab option in weapon_abilities,newfrenchy83,2018-12-02 16:47:31+00:00,2018-12-04 16:29:48+00:00,{},"backstab option is deprecated, i put this in weapon like abilities for could continue to use after remove to weapon special because formula in filter_opponent don't match in abilities. (self and other point self and opponent in weapon special and self and student in abilities)."
234696279,Fix problem of negatives value in heals andleadership abilities,newfrenchy83,2018-11-29 16:10:51+00:00,2018-12-03 15:12:59+00:00,{},"I prefer modify the abilities function for resolve this problems instead to alter effect constructor because i don't want what chance_to_hit, berserk damage or attacks abilities could be affected. This fix resolve problems of value= negative_value but add, sub multiply or divide don't concerned.  I eventually post an test case in this PR but i post the code immediately for what you're read this. replace https://github.com/wesnoth/wesnoth/pull/3725"
233581628,resolve problem of negative value in heals,newfrenchy83,2018-11-26 14:43:23+00:00,2018-11-29 09:17:11+00:00,{},"Modify effect constructor is crazy, i prefer applicate an modified version of @jostephd suggestion for create an viable solution. replace https://github.com/wesnoth/wesnoth/pull/3739"
233345547, add attacker and defender option to apply_to in weappons abilities,newfrenchy83,2018-11-24 23:12:56+00:00,2018-12-02 15:22:02+00:00,{},"
To complete the resemblance to the real weapon specials, I add these two tags"
233212592,"change ""under"" to ""self"" in weapon abilities",newfrenchy83,2018-11-23 14:16:03+00:00,2018-11-23 19:11:37+00:00,{},i changes that for apply_to identical to weapon specials
233107397,Add attack icons to unit_preview_pane,jostephd,2018-11-23 05:01:22+00:00,2019-03-08 17:20:14+00:00,"{'Enhancement': 1, 'Ready for testing': 1, 'UI': 1}","This adds range and damage type icons to the unit preview pane, like #3732 did to the sidebar.

Depends on #3732 for finding the the `blade` icon (#3732 renamed blades.png to blade.png).

Currently this is a work in progress, not ready to be merged yet. This is how far I got, does anyone know how to stop that line from stretching to fill the width of the pane?

![screenshot_2018-11-23_04-53-40](https://user-images.githubusercontent.com/24784687/48928954-f88c6880-eedb-11e8-8c9d-3210d3b18d3e.png)

cc @CelticMinstrel "
233059768,"fix problems of negatives values for heals, leadership and resistance abilities",newfrenchy83,2018-11-22 19:10:41+00:00,2018-11-24 22:51:36+00:00,"{'Bug': 1, 'Engine': 1}","@CelticMinstrel  had suggest what i modifie the rules of calculation for resolve problem of negative values in heals. if value of heals adjacent to patient are negative, the lowest value is used, if an value is positive and another negative, the difference is applied. PR pulled in place of https://github.com/wesnoth/wesnoth/pull/3725"
232906020,Run WML schema validation in travis. Fixes #3709,Pentarctagon,2018-11-22 09:15:18+00:00,2018-11-24 16:35:23+00:00,{},This adds running the WML schema validation in travis.  It also updates the schema itself and fixes a few WML errors so that core and all campaigns under all difficulties pass the schema validation.
232778207,UtBS: code refactor,DisherProject,2018-11-21 19:36:51+00:00,2019-04-01 22:14:10+00:00,"{'Enhancement': 1, 'Campaign (any)': 1}","In general, i wouldn't find refactoring code very useful, but UtBS has very long files and sometimes reading them is not that easy. What i have tried to do is mainly:

- Renaming variables, so that their aim is clearer

- Moving code from macros to custom events, since macros must be defined before they are used. Custom events can be written in ""chronological"" order

- Updating code (`filter_condition` instead of if-then, `repeat` instead of `while` ...)

There aren't any variations in what the code does: this refactor doesn't affect the ""result"" of the code, but just how it is achieved."
231798138,"AoI S1: Hint about recruiting a healer, if the player doesn't have any",stevecotton,2018-11-18 16:23:30+00:00,2019-01-06 22:07:20+00:00,"{'Enhancement': 1, 'Ready for testing': 1}","This is just a hint on the general principle that it's good to have a healer,
based on the review comments of #3683.

When playing on easy, there's not much experience available in this first
scenario. Any hints about leveling units probably belong in S2 or later,
which also has the advantage of being able to talk about the enemies in S2."
231787404,Show range and damage type icons,jostephd,2018-11-18 13:11:39+00:00,2019-02-24 13:07:02+00:00,"{'Enhancement': 1, 'Ready for testing': 1, 'UI': 1}","From https://github.com/wesnoth/wesnoth/issues/3197#issuecomment-395845639 @CelticMinstrel 

This makes the sidebar look like this:

![screenshot_2018-11-16_00-16-47](https://user-images.githubusercontent.com/24784687/48589783-f2731680-e934-11e8-83e6-f0938f67a2df.png)

The new icons have tooltips ""longbow"" ""ranged"" ""pierce"".

If we wanted the attack icon (first one) to be larger, we could make it look like this:

<details>
<summary>Larger attack icons - can be implemented</summary>

![screenshot_2018-11-18_13-01-07](https://user-images.githubusercontent.com/24784687/48672795-60d0f800-eb32-11e8-8aa5-bf219a25a0e6.png)

</details>

<details>

<summary>Larger attack icons - better looking, but don't know how to implement</summary>

![screenshot_2018-11-18_05-09-14](https://user-images.githubusercontent.com/24784687/48668962-ff3c6980-eaf0-11e8-92d7-3d8290f2a3f9.png)

_This is not a screenshot_, it's a mock-up created in gimp. If would be great to be able to implement this, but as CelMin said on the other issue:

> But I'm not sure if the ThemeWML can do that within a single report? (And if weapon icons were a separate report you'd have alignment issues, because a weapon description's length depends on the number of specials.)

</details>


- [x] Use icons in sidebar
- [x] Move the icons a few pixels down to align them with the text
- [x] Delete the words ""melee-impact"" in the sidebar
- [x] Use icons in unit_preview_pane - #3740
- [x] Use icons in generated help pages - #3940
- [x] Document in the wiki how to supply custom icons for custom ranges/damage types - added to https://wiki.wesnoth.org/Unittypewml#Attacks
- [ ] Use attack icons in the sidebar - not done, opened #3941 for it"
231785248,Several sidebar changes,jostephd,2018-11-18 12:28:02+00:00,2019-01-07 21:05:40+00:00,"{'Enhancement': 1, 'UI': 1}","A bunch of small changes. The ones that affect the default theme are:

1. Don't truncate the abilities and traits lines before the ""lvl"" label
2. Make terrain defense follow mouseover, like the rest of the sidebar does.
3. Change the trait tooltip format"
231547285, add harm abilities,newfrenchy83,2018-11-16 14:28:05+00:00,2018-11-23 23:08:53+00:00,{},this harms ability must resolve problem of negative value in heals without bug in calculate because using proper function
231270962,Default AI changes,mattsc,2018-11-15 17:11:46+00:00,2018-12-02 16:42:42+00:00,{},"This PR collects some of the changes to the default (RCA) AI listed in #3450 and #3695.  So far it only contains a few simple removals of unused items, more will be added as I get around to it."
230706495,Add a command-line interface to the WML diff functionality,CelticMinstrel,2018-11-14 04:27:51+00:00,2019-08-31 03:44:53+00:00,{},"The diff functionality is there, so I figured it could be useful to expose it.

I would've just pushed straight to master instead of making a pull request, but I noticed output redirection doesn't seem to be working, so I decided to see if anyone had any idea why.

To be precise, the following command:

```
wesnoth.exe --diff test1.cfg test2.cfg > diff.cfg
```

outputs the diff to the console and not to diff.cfg. I tried both in VSCode's integrated terminal and in a standard Windows command prompt. I imagine it'll probably work as expected on Linux, but I'd like it to work on Windows too."
230666724,Wip Fix #3717,gfgtdf,2018-11-13 23:59:33+00:00,2021-09-06 03:06:49+00:00,{'Fwdport': 1},
229992712,DiD tweaks,jostephd,2018-11-12 00:56:42+00:00,2018-12-17 17:06:05+00:00,"{'Enhancement': 1, 'Campaign (any)': 1}","Some dialog/objective clarifications. The only gameplay change is that if you create walking corpses in A Small Favor 2, you get to carry them over to the next scenarios. I'm not sure about the new dialog in S9 but I don't have anything better right now."
229965341,Redesign force cth macro,newfrenchy83,2018-11-11 17:21:05+00:00,2018-11-16 02:17:15+00:00,"{'Bug': 1, 'Ready for testing': 1}",Is second version of https://github.com/wesnoth/wesnoth/pull/3704
229946077,fix modify_unit split_to_array function,ProditorMagnus,2018-11-11 11:27:46+00:00,2018-11-11 16:30:29+00:00,{},Fixes some 3c63b1e6de8ae913f7aa2c6b3d06021f29382787 issues.
229942356,Redesign cth macro,newfrenchy83,2018-11-11 10:04:06+00:00,2018-11-11 13:29:00+00:00,{},I add cth ability with object for revert modifications was more easy
229889069,Revert cth test because bug not expected,newfrenchy83,2018-11-10 13:16:09+00:00,2018-11-10 13:36:01+00:00,{},
229010926,Fix grammar in cth macro,newfrenchy83,2018-11-07 12:25:29+00:00,2018-11-07 21:38:02+00:00,{},
228625743,Fix mingw cross-compile for master,newfrenchy83,2018-11-06 09:35:56+00:00,2018-11-06 20:35:31+00:00,{},
228442110,EI S02: Dialogue improvement,Gtara,2018-11-05 18:07:18+00:00,2018-11-07 21:10:23+00:00,"{'Enhancement': 1, 'Campaign (any)': 1}","Implemented long-standing TODO. The trolls are now hidden until sighted by the player. When interacting with the dwarfs, Gweddry will now respond according to whether the trolls have been sighted or not."
228136588,"Attack Enemy: Don't show ""poison"" in the attacks list if the enemy is unpoisonable",jostephd,2018-11-03 19:26:36+00:00,2018-11-30 16:39:55+00:00,"{'Enhancement': 1, 'UI': 1}","This PR removes the ellipsed word.

![screenshot_2018-11-03_19-16-14](https://user-images.githubusercontent.com/24784687/47956546-d61ec380-df9d-11e8-8f17-ecec9c9cafb8.png)

Is this right? It tested okay but I am not completely sure."
228109295,Fix bug in teleport anim,newfrenchy83,2018-11-03 09:35:33+00:00,2018-11-06 23:39:32+00:00,"{'Confirmed': 1, 'UI': 1, 'Regression': 1}",Temp_unit.set_location necessary else pre and post teleport animation played in same place(arrival). It is unuse ro place 'don't scrolling 'if this bugs not fixed.
227655726,Tutorial S2: Hint that it's better to keep units about-to-level,stevecotton,2018-11-01 15:20:41+00:00,2019-01-06 16:58:28+00:00,"{'Enhancement': 1, 'Prose': 1, 'Help': 1}","A couple more lines of dialogue after your tutor says ""You are close to killing their leader! The unit who finishes him will gain 16 xp..."""
227597065,Add battery_info to codeblock project,newfrenchy83,2018-11-01 12:02:30+00:00,2018-11-01 12:03:00+00:00,{},
227084244,Compare to `None` using identity `is` operator,janisozaur,2018-10-30 21:15:45+00:00,2018-10-31 01:21:03+00:00,{},"This is a trivial change that replaces `==` operator with `is` operator, following PEP 8 guideline:

> Comparisons to singletons like None should always be done with is or is not, never the equality operators.

https://legacy.python.org/dev/peps/pep-0008/#programming-recommendations"
226762543,HttT S6: Point out exactly where the ford is.,jostephd,2018-10-30 01:18:23+00:00,2018-11-03 18:11:11+00:00,"{'Enhancement': 1, 'Campaign (any)': 1}","Also scroll to it, in case the viewport is elsewhere.

Suggested on the forums https://forums.wesnoth.org/viewtopic.php?p=634718#p634718

{REMOVE_LABEL} doesn't remove the label, from a brief look that seems to be a bug in that macro?"
226751946,Update 1_A_Bargain_is_Struck.map,Gtara,2018-10-30 00:03:10+00:00,2018-11-06 21:03:46+00:00,{'Campaign (any)': 1},"SoF S01a Add snow to map

Implemented long-standing TODO, adding some snow to the map by hand, without altering the difficulty."
226726921,Sceptre of Fire's TODO S1,Gtara,2018-10-29 21:56:38+00:00,2018-10-29 22:41:22+00:00,"{'Campaign (any)': 1, 'Needs Rebase': 1}",
226702653,Tutorial S2: Don't allow the orc to recruit wolves on turn 1,stevecotton,2018-10-29 20:29:07+00:00,2018-11-06 21:07:01+00:00,"{'Enhancement': 1, 'Campaign (any)': 1}","If the wolves are recruited on the first turn then Galdrad's turn 3 hint about
getting to the island before them is too difficult for a tutorial, and his hint
about holding the village on turn 4 hint may be a turn too late.

Some have to be recruited on turn 2 to fit the turn 3 hint about them, so rig
the AI's recruitment to do that."
226487396,Fix halo remain while event don't finish,newfrenchy83,2018-10-29 09:24:57+00:00,2018-11-02 20:45:19+00:00,"{'Bug': 1, 'Engine': 1}",When an unit with halo is killed by kill function them halo don't clear before end of event.
226403210,Remove the 'Mandatory WML Child missing but untested for' error,CelticMinstrel,2018-10-28 22:40:28+00:00,2020-10-12 16:50:14+00:00,{'WML': 1},"Pushing for preliminary review, not quite done yet. Basically I'd like _everyone_ to look it over and see if I need to change how the missing child is handled in some of the cases (particularly those labelled by `TODO`).

This addresses #3647."
226389676,Allow players to choose Kaleh or Nym in the tutorial,stevecotton,2018-10-28 19:04:24+00:00,2018-10-29 18:57:16+00:00,{},"Could be separated in to two branches, one making the strings use
""$student_name"" to allow any character, and one for adding Kaleh
and Nym to the selectable characters.

Inspired by LienRag's work on black protagonists for HttT.
https://r.wesnoth.org/t48990"
226370046,Fix Code::Blocks project,newfrenchy83,2018-10-28 14:14:05+00:00,2018-10-28 14:14:50+00:00,{},
226366034,Fix rare bug in FORCE_CHANCE_TO_HIT,newfrenchy83,2018-10-28 13:12:12+00:00,2018-11-07 12:26:19+00:00,"{'Bug': 1, 'Ready for testing': 1, 'WML': 1}","If in attack end in FORCE_CHANCE_TO_HIT macro, unit or second unit doesn't exist anymore because rare case where unit disapear before attack end event was called then we have an error message like ""Invalid WML found: [unstore_unit]: variable 'second_unit' doesn't exist"" because presence of unit not condition of execution of event."
226335309,Revised timer code due to crashes on some iPads.,singalen,2018-10-28 01:01:26+00:00,2022-06-27 17:59:49+00:00,{'iOS': 1},"It's mostly a request for help.

Frankly, I still don't see how the mutex a `timer_callback()` takes can be already taken by the SAME thread. If anyone can see why else the lock guard could abort in `timer_callback()`, please let me know.

What's done here:
* Bury dead code, 
* the lock cam be R/W, 
* use atomic counter to avoid locking it, 
* std::unordered_map is faster than a std::ordered_map.

"
226333867,Liberty S6: Give the cave underground time of day.,jostephd,2018-10-28 00:20:36+00:00,2019-01-06 22:22:16+00:00,"{'Ready for testing': 1, 'Campaign (any)': 1}",Added underground time_area because the terrain suggests it's a cave. Needs playtesting.
226187040,Minor changes to DW and DiD,DisherProject,2018-10-26 18:27:48+00:00,2019-01-05 22:59:48+00:00,"{'Enhancement': 1, 'Campaign (any)': 1}","Since i'm doing just few variations here, i'm putting DiD and DW together in a single pull request. "
226012523,"Fix bug in CHANCE_TO_HIT macro ""Invalid WML found: [unstore_unit]: variable 'second_unit' doesn't exist""",newfrenchy83,2018-10-26 08:16:42+00:00,2018-10-28 13:14:36+00:00,{},"If in attack end in FORCE_CHANCE_TO_HIT macro, unit or second unit doesn't exist anymore then we have an error message like ""Invalid WML found: [unstore_unit]: variable 'second_unit' doesn't exist"" because presence of unit not condition of execution of attack end event."
225965352,"#3634, #3557: Port from iOS: Compile with Apple crypto framework instead of OpenSSL",singalen,2018-10-26 03:25:40+00:00,2018-10-26 06:20:05+00:00,{},port from 1.14
225643511,"After and #3634, #3557, this switch is excess.",singalen,2018-10-25 06:57:50+00:00,2018-10-26 03:10:10+00:00,{},Another libcrypto reference can be skipped on Mac.
225613912,Lua AI changes,mattsc,2018-10-25 03:36:45+00:00,2018-11-08 15:31:59+00:00,{},"This PR implements more Lua AI tasks from issue #3450. Unlike #3506, it includes functionality changes. This is just the beginning, I'll add to it as I work my way through the tasks, but I figured I open this while there is not much yet, rather than overwhelming everybody with a gazillion commits all at once."
225581910,Scale before blitting green '+',JGelfand,2018-10-24 23:34:05+00:00,2018-11-06 21:33:33+00:00,{},Small change for #3488. Scales the icons to the same size as the green plus before blitting. 
225248775,Port the help browser to GUI2,CelticMinstrel,2018-10-24 02:55:06+00:00,2024-09-23 23:49:45+00:00,"{'macOS': 1, 'MP': 1, 'UI': 1, 'Editor': 1, 'Building': 1, 'Help': 1, 'Schema': 1}","Reopening #994 as a new PR because GitHub won't let me actually reopen the old one.

This is a rebase which adds a bunch of commits from @Vultraz from the previous master branch. There were a bunch of conflicts, so these added commits may not be entirely what _should_ be on this branch."
225219871,Game Load: The dialog shall be usable even if the auto-selected savefile is invalid.,jostephd,2018-10-23 23:33:45+00:00,2018-10-27 20:58:25+00:00,"{'Bug': 1, 'UI': 1}",Fixes #3647.
225202320,don't write unchanged unit attributes to savefiles,gfgtdf,2018-10-23 22:04:11+00:00,2018-11-10 21:33:48+00:00,{},"Unit attribues that unchanged
(except with object/advancement/trait) are no longer written
to savefiles, this not only greatly reduce savefile size on
some cases it also makes savefiles more comptible with newer
versions because it reduced the chance that old/incompatible
code is stored in savefiles.

Note that changes via [object] (`wesnoth.add_modification()`) also
count as changes but changes done via object in advance_to does not.
This is intentional as at add_modification an objects might have
an effect dependent on a filter that depends on directly changed
arrtibutes which would then be lost on rebuild if we wouldn't mark
them as 'changed'."
224936893,"#3634, #3557: Port from iOS: Compile with Apple crypto framework instead of OpenSSL",singalen,2018-10-23 08:10:16+00:00,2018-10-25 05:43:45+00:00,{},"Didn't test scons, so let's wait for Travis. The changes are pretty straightforward though.

I don't use MacCompileStuff project, but use MacPorts, so my environment is quite different.

Should fix both #3634 and #3557."
224915452,[TSG] Scenario redesign,nemaara,2018-10-23 06:49:21+00:00,2018-12-15 15:51:44+00:00,"{'Enhancement': 1, 'Ready for testing': 1, 'Campaign (any)': 1}","Since I already redid most of TSG's dialogue, I figured I might as well make the maps prettier too. I'm not doing a redraw from scratch; I'm only making the map prettier by using embellishments and different terrain varieties (and avoiding adding villages or changing terrain in combat areas significantly, that way the gameplay/scenario design should stay pretty much the same). I'm planning to redo all of them, and will remove the [WIP] tag when done.

Edit: this is now a PR for a trial TSG revision (including gameplay). I'll be playtesting all of my scenario revisions, although anyone else is welcome to come and playtest as well."
224614893,Update codeblock projectfile,newfrenchy83,2018-10-22 08:20:21+00:00,2018-10-22 13:38:55+00:00,{},
224613262,Fix bug in bool implemened weapon when active_on used.,newfrenchy83,2018-10-22 08:10:53+00:00,2018-10-22 13:16:14+00:00,{},"If i use active_on=defense in poison ability, and i  attack with poisoned attack of an Assasin, the enemy was not poisoned."
224572717,"Healing: Display healing animation if the healer is visible but the patient is not (due to fog, shroud, nightstalk...)",jostephd,2018-10-21 22:13:17+00:00,2018-11-30 17:18:25+00:00,"{'Bug': 1, 'UI': 1}","<details><summary>Diff for testing</summary>

```
diff --git a/data/campaigns/Heir_To_The_Throne/scenarios/01_The_Elves_Besieged.cfg b/data/campaigns/Heir_To_The_Throne/scenarios/01_The_Elves_Besieged.cfg
index a2b5cfc3093..1c4587f63fa 100644
--- a/data/campaigns/Heir_To_The_Throne/scenarios/01_The_Elves_Besieged.cfg
+++ b/data/campaigns/Heir_To_The_Throne/scenarios/01_The_Elves_Besieged.cfg
@@ -6,7 +6,7 @@
     victory_when_enemies_defeated=no
     map_data=""{campaigns/Heir_To_The_Throne/maps/01_The_Elves_Besieged.map}""
     {TURNS 16 14 12}
-    {DEFAULT_SCHEDULE}
+    {SECOND_WATCH_HOUR1}
 
     {SCENARIO_MUSIC ""battle.ogg""}
     {EXTRA_SCENARIO_MUSIC ""casualties_of_war.ogg""}
@@ -23,8 +23,14 @@
     [/avoid]
 #enddef
 
+    turn_at=2
     [event]
         name=prestart
+        {UNIT 2 (White Mage) 18 19 (max_moves=0)}
+        {UNIT 2 (Skeleton) 17 18 (max_moves,hitpoints=0,1)}
+        {UNIT 2 (Shadow) 17 19 (max_moves,hitpoints=0,1)} # invisible patient
+        {UNIT 2 (White Mage) 17 17 (max_moves=0)}
+
         {VARIABLE besieged_enemies_killed 0}
         {NEED_DELFADOR (x,y=19,23)}
         [objectives]
@@ -72,6 +78,8 @@
         unrenamable=yes
         profile=portraits/konrad-elvish.png
         side=1
+        fog=yes
+        {UNIT 1 Gryphon 18 21 (vision=2)}
         canrecruit=yes
         controller=human
         recruit=Elvish Scout,Elvish Fighter,Elvish Archer,Elvish Shaman
```

</details>
"
224565132,Sidebar alignment follows mouseover,jostephd,2018-10-21 19:59:35+00:00,2018-10-27 22:10:22+00:00,"{'Bug': 1, 'UI': 1}","This PR makes the alignment and weapon info in the sidebar show information for the mouseover hex, not for the unit's present position. For example, in the test scenario click the Footpad (14,6) and mouseover one of the empty hexes adjacent to the Dark Adept that has darkens; with the PR you'll see the sidebar show ""chaotic (+25%)"", compared to ""chaotic (+0)%)"" currently. Fog and shroud are honored."
224533611,Update wesnoth.cbp,newfrenchy83,2018-10-21 11:09:16+00:00,2018-10-21 13:24:20+00:00,{},
224506588,Little changes to NR,DisherProject,2018-10-20 23:02:18+00:00,2018-11-07 21:40:57+00:00,"{'Enhancement': 1, 'Campaign (any)': 1}","Here are some possible improvements to Northern Rebirth. 

Some notes about these commits:
- c0f0bda Should fix #3432 
- 7db23a5 Should fix #3433 except from the first point
- 0bafb32 Should fix #3141 and #3133"
224492328,Don't show time of day under shroud,jostephd,2018-10-20 18:25:30+00:00,2018-10-21 17:09:42+00:00,"{'Bug': 1, 'UI': 1}","In the test scenario mouseover (4,19) to see the difference.

In master, the tod image and tod schedule indication in the sidebar show:

- ""dusk 4/6"" outside the cave
- ""dusk 1/1"" on (4,19) in master - leaking the fact that the tod schedule under the shroud consists of one timezone
- ""dusk 4/6"" on (4,19) with this patch - on a shrouded hex it shows what it shows on a non-shrouded hex, regardless of the time area of the shrouded hex. Is that good or would it be better to show, say, a black image and ""?/?"" instead, when mouseover'ing a shrouded hex?

(tagging ""bug"" because showing dusk and 1/1 is _definitely_ incorrect)"
224066781,Forward port some of the 174,jostephd,2018-10-18 19:10:19+00:00,2018-10-30 00:27:32+00:00,{'Fwdport': 1},This fwdports 89 of the 174 commits in #3614. I'll update that issue with what happened to the rest.
223911834,Fix animation truncated after message in both master and stable branch,newfrenchy83,2018-10-18 10:56:30+00:00,2018-10-20 15:43:12+00:00,{},
223874507,Emulate weapon special for master except swarm and plague,newfrenchy83,2018-10-18 08:55:21+00:00,2018-10-22 01:15:36+00:00,{},
223773580,SoF 7: explain the reinforcements,sevu,2018-10-17 22:32:39+00:00,2018-10-18 20:20:31+00:00,"{'Enhancement': 1, 'Campaign (any)': 1}",">I'm closing this, because for now, I'll try again once I've finally have a better idea.
maybe tomorrow.

This has happened, continuation of #3591.
Prose by Konrad, WML by me."
223505262,Fix CB projectfiles,newfrenchy83,2018-10-17 08:07:35+00:00,2018-10-18 13:45:39+00:00,{},
223442679,[DiD] S10 time over defeat scene,nemaara,2018-10-17 01:28:31+00:00,2018-10-17 16:47:53+00:00,"{'Enhancement': 1, 'Campaign (any)': 1, 'Good first issue': 1, 'Prose': 1}",Added a defeat scene for DiD S10 where there was not previously one.
222825853,Fic VC project,newfrenchy83,2018-10-15 08:45:58+00:00,2018-10-16 11:25:54+00:00,{},
222813461,[DO NOT MERGE] Emulate weapon special for old master branch,newfrenchy83,2018-10-15 07:59:00+00:00,2018-10-19 08:04:52+00:00,{},Because fail of check i restore this PR. I prefer have a PR ny branch.
222747920,Crossport 7767902261e60f64a541cac11d647b0075ea1049 to try and fix unit tests on travis,jostephd,2018-10-14 22:31:58+00:00,2018-10-15 00:22:51+00:00,{},Port from master to development. This should fix unit tests on travis
222734045,Update wesnoth.vcxproj,newfrenchy83,2018-10-14 18:32:05+00:00,2018-10-14 22:12:59+00:00,{},
222724826,Emulate weapon specials in abilities for development,newfrenchy83,2018-10-14 16:02:57+00:00,2018-10-18 08:56:00+00:00,{},
222720649,Update libraries.md,newfrenchy83,2018-10-14 14:54:05+00:00,2018-10-14 14:57:06+00:00,{},
221903712,[WIP] add lua gamemap object for map generation.,gfgtdf,2018-10-10 19:21:00+00:00,2018-10-20 18:21:01+00:00,{},"this pr does two things:

1) Add a lua gamemap object whihc can be used in lua map generators which has the following funcions
1.1) set_terrain, get_terrain, like the  usualy set/get_terrain functions, `map:set_location(loc, ""*^Gg"", ""overlay"")`
1.2) a data fiels that basiciall serializes the map to a string `` local res = map.data
1.3) get_locations, which accepts a custom lua filter table which is not wml, but similar to the usual filters
```
-- assuming lua helper functions f_terrain etc are defined properly.
local locs = wesnoth.get_locations(
  f_and(
    f_terrain(""Gg""),
    f_or(
      f_adjacent(f_terrain(""Mv""), ""n""),
      f_x(""0-1"")
    )
  )
)
```
but is easier to use form lua and has a clear tree structore that avoids certain hard to understand behviour of old location filter in particular wrt to `radius` and `not` etc.
1.4) function to deal with startign locations.

2) `wesnoth.generate_default_map` that invokes the default map generator from lua.

Ofc both things can easiyl be used together that is, by first letting the default mapgenerator do it's job and the do the finetuning with custom gamemap actions, this in in particual what some umc addons currently do and this code would make it very easy to do suhc things right in the mapgeneration code.
"
221653048,Elvish unit description edits,nemaara,2018-10-10 04:07:44+00:00,2018-10-24 19:55:21+00:00,{},"Editing some of the elvish unit descriptions because I recall people complaining about these being super ultra biased toward the elves (after reading them, I'm very much inclined to agree). I'm going edit the archer and fighter lines in this PR, and I'll remove the [WIP] tag after I'm done.

(Actually, it looks like the Avenger description is fine, so I won't touch that for now)."
221402908,Removes redundant run_event_loop call,timothyqiu,2018-10-09 11:29:40+00:00,2018-10-15 00:58:15+00:00,{},"The duplicated `events::run_event_loop()` call was introduced in https://github.com/wesnoth/wesnoth/commit/441ec38adfe0295fb7881e198b1e191da16cc92c, redrawing the screen after scaling algorithm customization.

https://github.com/wesnoth/wesnoth/blob/441ec38adfe0295fb7881e198b1e191da16cc92c/src/wesnoth.cpp#L679-L688

The scaling algorithm customization code was removed in https://github.com/wesnoth/wesnoth/commit/dd69107c9b03017ccf2eb586dfbee158f816659d, leaving two successive calls to the same function, which is unnecessary.

https://github.com/wesnoth/wesnoth/blob/dd69107c9b03017ccf2eb586dfbee158f816659d/src/wesnoth.cpp#L673-L675"
221355383,Fix animation truncated immediately after message,newfrenchy83,2018-10-09 08:49:34+00:00,2018-10-18 10:58:02+00:00,{},
221157720,Fix animation truncated immediately after message,newfrenchy83,2018-10-08 15:26:13+00:00,2018-10-08 15:26:59+00:00,{},
220954646,Update codeblock and Vc project for 1.14,newfrenchy83,2018-10-07 15:23:33+00:00,2018-10-09 15:51:33+00:00,{},
220900086,Working master branch,jostephd,2018-10-06 17:31:25+00:00,2018-10-14 09:14:46+00:00,{},"As we all know, `master` is unplayable (#3538).

This PR is a replacement master branch, built by cherry-picking a subset of all commits in current master onto the 1.13.12 tag, which is the point where 1.14 forked from master.

I may have excluded too many or too few commits. If such mistakes have happened please send corrections (and don't bite my head off, it was a _huge_ chunk of work and it's inevitable that mistakes will have been made).

There were quite a few conflicts in the rebase. It is not unlikely that in resolving those conflicts I introduced some bugs. From memory, there were non-trivial conflicts in unique_ptr/shared_ptr changes (particularly in ai/actions.cpp), boost::thread/std::thread changes, boost filesystem / std::filesystem changes. The lua vulnerability fix conflicted too.

The best way to review this branch is by diffing the commits in this branch to the corresponding commits in master.

The project files for VS/XCode/CBP may need to be updated to account for files that have been added/deleted/renamed on master.

_This branch should be force-pushed as a new `master` branch, not merged._ Current `master` should be copied to another name beforehand. Afterwards, any bugs that were fixed on master but are not fixed on this branch should be reopened. Then we should release a 1.15.0 development version from this branch.

edit:

[List of commits that differ between `master` and this branch](https://github.com/wesnoth/wesnoth/pull/3603#issuecomment-427623409)
"
220879022,Fix #3594,gfgtdf,2018-10-06 10:41:17+00:00,2018-10-07 11:52:27+00:00,{},"after that's fixed it has multiple advantages:;
1) it fixes #3594, an assertion failue that happend when a unit with
only one attack attacked when that one attack was disabled.
2) It now creates each pair or battle_context_unit_stats only once for
each pauir of attacks, previsouly the coud would create multiple
temporary battle_context_unit_stats objects to for exampel check
""disabled""
3) It simplifies the code by removing special handling of some cases."
220367125,Update codeblock for stable branch only,newfrenchy83,2018-10-04 12:59:19+00:00,2018-10-07 15:24:30+00:00,{},
220267798,[TSG] Campaign dialogue and story text revisions,nemaara,2018-10-04 06:53:25+00:00,2018-10-20 17:36:28+00:00,{},Revising The South Guard campaign text partially based on #3499. This is a WIP right now; I'm planning to revise all of the scenarios and story text and I'll remove the [WIP] tag once it's done. Comments/suggestions as I go are welcome.
220177111,[WIP] [TSG] Campaign dialogue and text revisions,nemaara,2018-10-03 20:55:42+00:00,2018-10-03 21:24:37+00:00,{},"Revising text (dialogue and story) for The South Guard, in part using suggestions from #3499. Still a WIP, I'm planning to revise all scenarios. (I messed up, so there's some commits pertaining to THoT here for my other PR, but they should no longer edit anything in THoT in this PR).

Forgot to mention that I'm making the PR now so that people can see my progress as I go and make suggestions if there are any. I'll remove the [WIP] tag once I think I'm all done."
220167412,[WIP] TSG campaign dialogue/text revisions,nemaara,2018-10-03 20:21:39+00:00,2018-10-03 20:22:36+00:00,{},"Working on revising the campaign dialogue, in part using suggestions from issue #3499. I'm planning to revise all scenarios and story text."
219277794,Make the reinforcements (SoF-S7) less unexplained,Konrad22,2018-10-01 07:08:04+00:00,2018-10-15 09:34:21+00:00,"{'Enhancement': 1, 'Campaign (any)': 1}","I added a line to the reinforcements event, so Alanin will say something when they appear, instead of them just quietly arriving.
I'm absolutly open for ideas to make him sound more natural."
218888569,Updaye codeblock for master branch,newfrenchy83,2018-09-28 08:19:18+00:00,2018-09-28 08:23:42+00:00,{},
218848006,Made Blitting more permissive,JGelfand,2018-09-28 04:01:35+00:00,2018-10-06 14:32:01+00:00,{},"SDL_BlitSurface's documentation (https://wiki.libsdl.org/SDL_BlitSurface) notes that ""Blits with negative dstrect coordinates will be clipped properly"".

Looking at the source code for SDL_UpperBlit() made me think that dstrect coordinates that were too big would also be handled appropriately.

I also managed to build wesnoth and run it. 
```units/goblins/rouser-lead-2.png~TC(1,magenta)~BLIT(data/core/images/halo/misc/leadership-flare-5.png, 15, -20)```
worked, and had no errors. This path tests both the negative handling and the overflow handling, so I thought it was probably good enough.

My second attempt at fixing #2225. Hopefully this goes better than the first one."
218386421,Some cleanup and fixes for TRoW,DisherProject,2018-09-26 16:52:09+00:00,2018-10-18 17:24:33+00:00,"{'Enhancement': 1, 'Campaign (any)': 1}",Here are some possible changes to TRoW.
218371465,Maintainance for SotBE,DisherProject,2018-09-26 15:59:27+00:00,2018-10-18 17:43:19+00:00,"{'Enhancement': 1, 'Campaign (any)': 1}",I had a lot of fun in playing this campaign: i've found it well balanced and really challenging. Here are a few updates to the syntax.
217810731,Don't scroll to a teleporting unit that's invisible at the source or destination,jostephd,2018-09-24 22:51:24+00:00,2018-10-14 17:43:04+00:00,{},"Like #3559, but for teleporting.

<details><summary>Diff for testing</summary>

```
diff --git a/data/campaigns/An_Orcish_Incursion/scenarios/01_Defend_the_Forest.cfg b/data/campaigns/An_Orcish_Incursion/scenarios/01_Defend_the_Forest.cfg
index f4d83db542..93a4dc3426 100644
--- a/data/campaigns/An_Orcish_Incursion/scenarios/01_Defend_the_Forest.cfg
+++ b/data/campaigns/An_Orcish_Incursion/scenarios/01_Defend_the_Forest.cfg
@@ -12,6 +12,7 @@
     turns=24
     next_scenario=02_Assassins
 
+    {SECOND_WATCH}
     {DEFAULT_SCHEDULE}
 
     {SCENARIO_MUSIC       knolls.ogg}
@@ -82,13 +83,13 @@
         side=2
         controller=ai
         recruit=""Orcish Archer,Orcish Grunt,Wolf Rider""
-        {GOLD 100 125 150}
+        {GOLD 0 0 0}
         income=0
         team_name=Orcs
         user_team_name= _ ""Orcs""
         {FLAG_VARIANT6 ragged}
 
-        type=Orcish Warrior
+        type=Shadow
         id=Urugha
         name=_ ""Urugha""
         canrecruit=yes
@@ -101,8 +102,6 @@
         [/ai]
     [/side]
 
-    {STARTING_VILLAGES 1 6}
-
     [event]
         name=prestart
 
@@ -159,6 +158,21 @@
             message= _ ""Yes, my lord!""
         [/message]
 
+        {UNIT 1 (Elvish Lady) 5 17 (hitpoints=1)}
+        {UNIT 2 (Silver Mage) 12 2 ()}
+        [+unit]
+            [modifications]
+                [object]
+                    [effect]
+                        apply_to=new_ability
+                        [abilities]
+                            {ABILITY_NIGHTSTALK}
+                        [/abilities]
+                    [/effect]
+                [/object]
+            [/modifications]
+        [/unit]
+
         [kill]
             id=Lomarfel
         [/kill]
@@ -170,6 +184,13 @@
         [/move_unit_fake]
     [/event]
 
+    [time_area]
+        {QUANTITY x,y 5-15,1-5 1-10,10-20 1,1}
+        {AFTERNOON}
+    [/time_area]
+
+    {STARTING_VILLAGES 2 999}
+
     [event]
         name=turn 2
 
```

The three cases in the `[time_area]` are when only the teleporting unit is visible at the source hex only, at the destination hex only, or at neither.

</details>"
217539946,[WIP] add wesnoth_min_version,gfgtdf,2018-09-24 00:20:56+00:00,2021-09-06 03:08:08+00:00,{},"Addons can now specify a min_wesnoth_version attribute, addons with a
high min_wesnoth_version are hidden users with older wesnoth version in
the addon server, also users with older wesnoth wesnoth cannot join
addons with a high addon_min_version.

We need something like this if we want to add new apis to stable releases as we want to do, but also withotu new apis this can be useful if addons make heavily use of apis that are borken in older wesnoth version.


While this is a good starting step, it's not 100% clear how to continue: It wodul make sense to allow using new api only when the wesnoth_minversion attribute was specified accoringly, but that does no work in all cases, for example if a code woudl like to use wesnoth1.14.7 api but also has a fallback code for older api we shdoul allow that aswell.
"
217523680,Another fix for animation truncated after message in stable branch,newfrenchy83,2018-09-23 18:30:13+00:00,2018-10-09 08:50:24+00:00,{},I post this PR for propose a fix of animate for master branch
217451992,Create an harms ability independent of healings system for resolve problems of negative value,newfrenchy83,2018-09-22 11:03:08+00:00,2018-10-15 08:48:37+00:00,{},This time harms ability don't interfete with healing system and has this harming_anim.
216728335,Simple_wml: support embedded quotes in strings,jyrkive,2018-09-19 18:07:24+00:00,2018-09-22 09:22:08+00:00,{},"This pull request implements support for quotes in WML strings, fixing #3567."
216703534,Commandline: Fix documentation of --render-image,jostephd,2018-09-19 16:34:55+00:00,2018-09-22 13:15:52+00:00,{},"`wesnoth --render-image $foo $bar` writes a png image to $bar, if $bar has a png extension, otherwise it dies with no error message."
216365863,Upfate cb projectfiles for both master and stable branch,newfrenchy83,2018-09-18 16:15:29+00:00,2018-09-26 03:59:58+00:00,{},
215843043,Healing: Do heal on turn 1.,jostephd,2018-09-16 20:21:17+00:00,2018-10-21 17:37:38+00:00,{},Discussed on the forums: https://r.wesnoth.org/t48817
215842497,Game Load: Restore the ability to select 1.12.6 savegames in the list,jostephd,2018-09-16 20:08:59+00:00,2018-09-28 18:08:06+00:00,{},"In 1.14 since 14abecb2df9f94b4a4438156f9808596d223864b (#3495), selecting a 1.12.6 savegame in Game Load results in

> The file you have tried to load is corrupt: 'Mandatory WML child missing yet untested for. Please report.'

This PR fixes that."
215841288,"make it safe to dofile(""on_event.lua"")",vgaming,2018-09-16 19:40:37+00:00,2018-09-19 16:09:51+00:00,{},"make it safe to dofile(""on_event.lua"")"
215832320,"Unit Display: When an invisible enemy unit recruits another invisible unit, don't scroll to their location",jostephd,2018-09-16 16:34:13+00:00,2018-09-24 17:07:36+00:00,{},"Scrolling to them would leak their location to the player.

edit: To test this:

```
diff --git a/data/campaigns/Heir_To_The_Throne/scenarios/01_The_Elves_Besieged.cfg b/data/campaigns/Heir_To_The_Throne/scenarios/01_The_Elves_Besieged.cfg
index 805f25cc67..4c9fb338bc 100644
--- a/data/campaigns/Heir_To_The_Throne/scenarios/01_The_Elves_Besieged.cfg
+++ b/data/campaigns/Heir_To_The_Throne/scenarios/01_The_Elves_Besieged.cfg
@@ -6,7 +6,8 @@
     victory_when_enemies_defeated=no
     map_data=""{campaigns/Heir_To_The_Throne/maps/01_The_Elves_Besieged.map}""
     {TURNS 16 14 12}
-    {DEFAULT_SCHEDULE}
+    {SECOND_WATCH}
+    {DAWN}
 
     {SCENARIO_MUSIC ""battle.ogg""}
     {EXTRA_SCENARIO_MUSIC ""casualties_of_war.ogg""}
@@ -160,13 +161,14 @@
 #enddef
 
     [side]
-        type=Orcish Warlord
+        {QUANTITY type Nightgaunt Nightgaunt Lich}
         id=Urug-Telfar
         name= _ ""Urug-Telfar""
         side=2
+        x,y=31,3
         canrecruit=yes
         profile=portraits/orcs/grunt-2.png
-        recruit=Orcish Warrior,Goblin Knight,Goblin Pillager,Orcish Crossbowman,Orcish Assassin,Troll
+        {QUANTITY recruit Shadow Skeleton Shadow}
         gold=400
         [ai]
             recruitment_pattern=scout,fighter,mixed fighter,archer
@@ -187,6 +189,7 @@
         id=Knafa-Tan
         name= _ ""Knafa-Tan""
         side=3
+        x,y=9,4
         canrecruit=yes
         recruit=Orcish Warrior,Wolf Rider,Orcish Crossbowman,Orcish Assassin,Troll
         {EBESIEGED_RECRUITMENT}
@@ -208,6 +211,7 @@
         id=Maga-Knafa
         name= _ ""Maga-Knafa""
         side=4
+        x,y=9,5
         canrecruit=yes
         recruit=Orcish Warrior,Wolf Rider,Orcish Crossbowman,Troll Warrior,Orcish Slayer
         {EBESIEGED_RECRUITMENT}
```"
215780705,Add changelog entries,jostephd,2018-09-15 17:43:26+00:00,2018-09-15 18:00:12+00:00,{},Changelog entries for my PRs since 1.14.4.
215724057,Fwdport b7cb36a7116d687e4bbaeae32336c0d1dd7e2e0b,jostephd,2018-09-14 22:16:49+00:00,2018-09-21 08:02:50+00:00,{'Fwdport': 1},"Fwdport b7cb36a7116d687e4bbaeae32336c0d1dd7e2e0b (#3546)

Fixes #3544."
215658828,Right portrait for master,jostephd,2018-09-14 17:17:06+00:00,2018-09-14 18:36:20+00:00,{},"for @GregoryLundberg https://github.com/wesnoth/wesnoth/pull/3529#issuecomment-421167263

edit: Please label Fwdport"
215650995,MP Create Game: Increase slider step size,jostephd,2018-09-14 16:42:38+00:00,2018-09-23 14:02:02+00:00,{},Requested on the forums https://forums.wesnoth.org/viewtopic.php?t=48680
215512005,Fix error in attack dialog when not 0<chance_to_hit<100,newfrenchy83,2018-09-14 08:01:47+00:00,2018-09-23 13:54:57+00:00,{},"If weapon special sub tje value to chance_to_hit to an negative value then chance_to_hit equals 100%. Illogic, this must be 0."
215239617,Fix Animations immediately following a message get truncated (issue #1617),newfrenchy83,2018-09-13 10:44:25+00:00,2018-09-27 10:58:12+00:00,{'Bug': 1},When unit with staff of tighteous die in s9 forbidden forest the animatiom is'nt played. The same problem with Dacyn disapear in S1 of EI. Insert wesnoth.delay fix this.
215112318,Reevaluate [show_if] conditions and delayed variable expansions before displaying objectives at start.,jostephd,2018-09-12 22:18:38+00:00,2018-09-13 18:41:11+00:00,{},"Fixes #3544.

Is this a good approach?"
214164713,General maintainance for SoF,DisherProject,2018-09-09 21:01:29+00:00,2018-09-14 21:32:46+00:00,{},"Here are some possible changes for the ""Sceptre of Fire"".

About the commits:

Commit 3) Would close #3373 .
Commit 5) Would close #3393 .
Commit 8) Would close #3403 following stevecotton's and Konrad22's suggestion.

Commit 9) I've wrapped some parts around `__UNUSED__` because it is stated [here](https://github.com/wesnoth/wesnoth/blob/a12feb93d3ab90063b7f1c24184b888cfec56115/data/campaigns/Sceptre_of_Fire/scenarios/9_Caverns_of_Flame.cfg#L640-L642) that the user doesn't have to kill the elves anymore, and i've added some more consistent objective (some help with prose would be great :) ).
I've also removed [this line](https://github.com/wesnoth/wesnoth/commit/a12feb93d3ab90063b7f1c24184b888cfec56115#diff-9ccb7ea3f778c87dfaecbbf5df90896fL667) because it could make the player lose by killing some heroes with lava, while on that turn the volcano should erupt, killing everyone and making you win.

Commit 10) It's just a proposal. If merged, should fix #3379 and #3380 , but i don't really know if it's the best way to solve the problem."
214145944,Find a way to negate need of anim:clear() in lua files,newfrenchy83,2018-09-09 13:42:33+00:00,2018-09-09 15:47:57+00:00,{},I propose a way to resolve https://github.com/wesnoth/wesnoth/issues/3534#issuecomment-419709950. I hope what is best
214113974,WML: Support [filter_side] in [item].,jostephd,2018-09-08 20:52:10+00:00,2018-09-22 01:11:09+00:00,{},"If [filter_side] is present then ""team_name"" is ignored.

Fixes #1477.

Constructing a comma-separated set of team names is ugly but I didn't want to change `add_overlay` and the `overlay` struct. https://github.com/wesnoth/wesnoth/blob/cc98bcd9d015a852dbec2053f300ce4682c4765d/src/overlay.hpp#L23-L26"
214002016,Add left padding to messages with right portrait,jostephd,2018-09-07 18:11:30+00:00,2018-09-14 16:53:34+00:00,{},"Fixes #1938. Tested on 800x600 and 1920x1080. This brings the left edge of the message (title and text) away from the left edge of the map. When the screen is wide enough, the text is placed at the same position regardless of whether the portrait is on the left, on the right, or on both sides. To test this start AToTB and read the dialog."
213958773,Add --skip-story option,jostephd,2018-09-07 15:11:25+00:00,2018-09-21 09:13:38+00:00,{},"Fixes #3472. [story] and [message] through the end of the `start` event will be skipped.

Try it: `./wesnoth -cThe_South_Guard --campaign-difficulty=1 --campaign-scenario=01_Born_to_the_Banner --campaign-skip-story`

"
213920420,Clear animation in heal_unit for fix halo remain,newfrenchy83,2018-09-07 12:59:24+00:00,2018-09-07 16:35:40+00:00,{},"@jyrkive same problem og halo. This time if i modify an unit afyer heal_unit animated, the halo remain."
213762081,gui2: indicate that unit cannot advance,hryniuk,2018-09-06 21:56:54+00:00,2018-09-13 15:43:54+00:00,{},Fixes #1244
213338863,Fix compile error for hardening a debug build,GregoryLundberg,2018-09-05 15:35:27+00:00,2018-09-06 12:48:30+00:00,"{'Building': 1, 'Regression': 1, 'SCons': 1, 'CMake': 1}","One cannot use _FORTIFTY_SOURCE without also using an optimization (-O).

When compiling a hardened Debug build, we'll use -Og. This provides only debug-safe optimizations."
213220244,Fix bug report for halo trmain afyer frath animation,newfrenchy83,2018-09-05 09:07:43+00:00,2018-09-06 17:16:26+00:00,{},@jyrkive i'm sorry to recycle an old PR but an bugs is teported in https://github.com/wesnoth/wesnoth/issues/3509 and i fear what put clear haloes in unit_die display is necessary in windows 10. If you find another soluce thank you else...
213090014,Bugfix generate random map unique names,rikardfalkeborn,2018-09-04 20:11:52+00:00,2018-09-08 15:25:33+00:00,{},"The used names was never set so the check for duplicated names did not
work. Detected by cppcheck."
212365993,EI: Some minor changes,DisherProject,2018-08-31 12:20:39+00:00,2018-09-02 12:00:32+00:00,{},"It's been a while since i last played this campaign, and i really enjoyed how some scenarios have been reworked (like ""Captured""). There are just a couple of things that, imo, shoud be changed."
212358496,AOI: Some minor changes,DisherProject,2018-08-31 11:46:46+00:00,2018-09-02 12:04:49+00:00,{},"These scenarios' structure is not that complex, and i've found it generally correct. For this reason, i'd like to propose some syntactic changes."
211450009,Lua AI Cleanup,mattsc,2018-08-28 14:47:43+00:00,2018-09-22 13:18:34+00:00,{},"This PR collects the Lua AI Cleanup tasks from issue #3450.  In other words, it excludes functionality and C++ code changes.  It is incomplete at this time, I'll add to it as I work my way through the tasks."
211269821,Minor pedantic fixes for 1.14,GregoryLundberg,2018-08-28 00:41:31+00:00,2018-08-28 10:51:28+00:00,{},"I decided 1000 commits was enough lag and brought my repo up-to-date. CMake, using GCC 8.2.0, with strict and pedantic options, flagged a few warnings. I'm not looking at Master until someone claims it's working and playable. If these need to be there, too, someone else will have to do it."
211190537,MP: Use listbox to choose leader,jostephd,2018-08-27 18:27:44+00:00,2018-09-10 23:57:28+00:00,{},"Change the widget for choosing a leader in the MP ""Choose Your Faction"" dialog to a listbox.

![screenshot_2018-08-27_18-12-09](https://user-images.githubusercontent.com/24784687/44677219-eefe7c00-aa24-11e8-9ade-e611dfab6db9.png) ![screenshot_2018-08-27_18-12-59](https://user-images.githubusercontent.com/24784687/44677222-f2920300-aa24-11e8-85d8-3382de86deea.png)

With the _next-to-last_ commit there is a redrawing problem. You can reproduce it by starting an MP game with the AoH era. Open the CYF dialog, select the drakes faction then select the random faction. The dialog will become shorter and narrower but it will be drawn, not over the underlying screen but over the previous, longer and wider version of itself. The issue does not reproduce with the last commit, only with the one before it, but I am not sure the solution in the last commit is good."
211183348,Liberty S3: Play orcish war drums,jostephd,2018-08-27 17:59:19+00:00,2018-08-29 14:52:05+00:00,{},Previously discussed on #3377.
211182180,Lua Console: Print an error message when not opening the console,jostephd,2018-08-27 17:54:51+00:00,2018-08-30 04:34:30+00:00,{},
211035972,Create a harms ability to resolve negative value of heals ability,newfrenchy83,2018-08-27 08:08:09+00:00,2018-09-22 07:52:49+00:00,{},I hope what this soluce is best what harming option. Alas the same healing_anim is used by the two abilities. But the unit with harms use that on ennemies ( diffetent side what allied). An same unit both adajacent to healer and harmer will be healed in healer turn and harmed in harmer turn.
210964530,Add harming option to heals abilities,newfrenchy83,2018-08-26 18:34:05+00:00,2018-08-27 15:14:32+00:00,{},Some wml develloper said they can't use heals abilities for harm enemies because theu use of negative value doinf what the low harm wpuld inflited if two 'harmers' with negative heals value different are adjacent to same unit to harm. If one value is -4 and the other -8 then the unit would have -4 hp. This option permit to harm with heals abilities with positive value. 
210909387,GUI2 Schema: Add missing parentheses to regexps.,jostephd,2018-08-25 16:09:40+00:00,2018-08-26 12:12:52+00:00,{},The '|' operator has lower precedence than ^ and $.
210817897,Game Load: Show list of enabled modification.,jostephd,2018-08-24 18:39:41+00:00,2018-08-27 16:42:48+00:00,{},"![screenshot_2018-08-24_18-33-20](https://user-images.githubusercontent.com/24784687/44601673-c11efa80-a7cc-11e8-9d79-817c0bec86f8.png)

This PR adds the ""Modifications:"" header and bulleted list. It shows the mod name if the mod is installed, else mod id, as done for campaigns.

Similar to #3478."
210743088,Fix two typos in Russian translations for Northern Rebirth campaign,alexitkes,2018-08-24 13:38:17+00:00,2018-08-27 07:36:49+00:00,{},Some words should be written a bit differently in Russian.
210583479,Don't scroll to an enemy leader that has an effective [hides] ability.,jostephd,2018-08-23 21:39:14+00:00,2018-08-27 07:31:06+00:00,{},"Two cases are handled:

1. At start of side turn of the enemy
2. When the player presses 'l' during the enemy's turn

One case is not handled:

3. When loading a save that starts at a side turn of the enemy"
210224763,Add pofix entries for the recent typo fixes (#3377).,jostephd,2018-08-22 18:32:23+00:00,2018-08-26 09:08:43+00:00,{},Fixes #3487.
209369886,wmlxgettext: fix #3469: lua plural strings not recognized in some context,AncientLich,2018-08-19 17:11:28+00:00,2018-08-22 04:10:31+00:00,{},"wmlxgettext couldn't recognize lua plural strings in some context. More in details the underscore marker ( _ ) originally required to be located at the beginning of the line or preceded by a space.
Now string maker is recognized without the requirement of an extra space, so syntax like: 
`local var = wesnoth.format(_(""one thing"",""$count things"",count), {count = count})`
now can be recognized as plural string, even if the underscore marker is not preceded by a space, but is preceded, for example, by a parenthesis"
209324014,Game Load: Show the user-name difficulty name instead of the internal name,jostephd,2018-08-18 18:12:01+00:00,2018-08-25 13:56:38+00:00,{},"This PR changes ""Difficulty: Medium"" to ""Difficulty: Hero (Normal)"" in the game load screen.

![before](https://user-images.githubusercontent.com/24784687/44302092-04332680-a312-11e8-89e1-34654e21c509.png) ![after](https://user-images.githubusercontent.com/24784687/44302093-072e1700-a312-11e8-89eb-489f8c1fed8f.png)
"
209220192,Fix crash after hitting enter when no units match the recall list filter,jostephd,2018-08-17 18:10:15+00:00,2018-08-17 20:56:56+00:00,{},Fixes #3475
209176766,HttT S17: Explain the lava mechanic,jostephd,2018-08-17 15:07:18+00:00,2018-09-08 07:22:33+00:00,{},"Gameplay is not affected. The player can still lose units to {EXPAND_LAVA}.

The [story] text mentions volcanic fumes and unsteady footing, but an additional mention in dialog should make it clear that there's a custom gameplay mechanic in this scenario.

I welcome critique of the dialog, particularly of the dwarvish line."
208585726,"SoF- Sc8, made Thursagens words fit the timeframe better (closes #3404)",Konrad22,2018-08-15 14:51:42+00:00,2018-08-17 16:52:42+00:00,{},"(It's about the time he needs to smith the Sceptre.)
I literally just changed 'a few days' to 'a day or two', because 'few' implies more than two (unlike the 1.6 days he needs).

#3404 "
208308281,Update codeblock project for master,newfrenchy83,2018-08-14 14:49:09+00:00,2018-08-19 07:55:05+00:00,{},I updated projectfiled for master branh. For the 7z file i don't want put in wesnoth but i like what omeone put this in sourceforge.net for use boost 1_68 to compile. Thanks.
208196589,Update wesnoth.cbp master branch only,newfrenchy83,2018-08-14 07:51:52+00:00,2018-08-14 12:05:48+00:00,{},I fix an error in typo.
208026997,[WIP] Automatic update checking,hrubymar10,2018-08-13 16:06:05+00:00,2020-03-09 13:10:34+00:00,"{'Windows': 1, 'macOS': 1}","For SourceForge versions it would be really usefull to have update checking system.

## TODO
- [x] Add command line argument - (9586dfa)
- [ ] Implement update checking itself https://github.com/wesnoth/wesnoth/blob/ddeb9a7aef3beb56a062c5a7fba2ed7a4efb5f70/src/desktop/update_check.cpp#L31
- [x] Upload file containing actual version number on f.w.o - ([link](https://files.wesnoth.org/wesnoth_1.14_version))
- [ ] Fix this issue https://github.com/wesnoth/wesnoth/blob/ddeb9a7aef3beb56a062c5a7fba2ed7a4efb5f70/src/desktop/update_check.cpp#L40
- [ ] Find solution for https://github.com/wesnoth/wesnoth/blob/ddeb9a7aef3beb56a062c5a7fba2ed7a4efb5f70/src/gui/dialogs/title_screen.cpp#L397"
207875922,Fixes track titles not being set from WML.,Pentarctagon,2018-08-13 05:53:28+00:00,2018-08-14 06:57:27+00:00,{},"The current implementation of the [music] tag [sets the title](https://github.com/wesnoth/wesnoth/blob/master/data/lua/wml-tags.lua#L297) after adding the track, however the title field was read only.  This makes the field writeable.

---

Fixes #3461 

I can merge and cherry-pick this if there are no concerns."
207837920,Fix building with Xcode 10 on master,hrubymar10,2018-08-12 20:04:36+00:00,2018-08-16 12:06:01+00:00,"{'macOS': 1, 'Fwdport': 1}","Fwdport #3458 of PR #3451 

## TODO
- [x] Fix Xcode 10 build - (965aeb3)
- [x] Fix Scons, Cmake and CodeBlocks builds - (965aeb3)
- [x] Fix Visual Studio build - (bb72d55)"
207833061,"HttT S6: Cancel attacks, support alt cave entrance",jostephd,2018-08-12 18:02:13+00:00,2018-09-10 16:34:48+00:00,{},"If the player ordered a unit to move and attack, allow the attack to be canceled, as done in #3227 for DiD. And change the undead reinforcements triggering."
207827340,Make the fire terrains actually illuminate their hex,CelticMinstrel,2018-08-12 15:49:01+00:00,2018-10-20 20:38:14+00:00,{'Needs Rebase': 1},"Fire illuminates, so it's always weird to see one of these without a corresponding gameplay effect."
207823825,"A cleaner fix for ""iOS interfering with Mac: Mac touchpad generates touch events""",singalen,2018-08-12 14:27:25+00:00,2018-08-18 20:28:00+00:00,{'macOS': 1},"Compatible with MacOS 10.14.
Rollback of previous one.
Subtask of #3455"
207773065,Fix building with Xcode 10,hrubymar10,2018-08-11 12:38:43+00:00,2018-08-12 15:39:40+00:00,"{'Bug': 1, 'Blocker: New Stable': 1, 'macOS': 1}","# Problem description
Whole problem is described in issue #3350 

# TODO
- [x] Rename problematic files - 49f6736798842c4613e2ab8a7c7c1dfafa734422
- [x] Fix Visual Studio project - ac43a2d3ed9b855f932278a6f88cab1cffae20e1
- [x] Fix CMake, Scons and CodeBlocks builds - ef7a24e74b88d6179db0b5f8856d9482e57f203a
- [ ] Fix issue 1) Load screen missing - NOT CAUSED BY XCODE 10
- [x] Fix issue 2) Blurry video in window mode - 5a89822caa93481f37a9d4b61f524d34f9932ed0
- [x] Fix issue 3) Bad resolution in fullscreen - 5a89822caa93481f37a9d4b61f524d34f9932ed0

# New bugs introduced by XCode 10
## 1) Blank screen on start
Game starts with blank screen. You can click elements (you can hear click sound) but you won't see anything until you move window. When you move window or resize it video appears. This issue is not caused by Xcode 10 but by macOS 10.14 api changes. I'll create new issue for tracking macOS 10.14 specific problems.
<img width=""1552"" alt=""image"" src=""https://user-images.githubusercontent.com/2218817/43991656-19693dd2-9d72-11e8-8223-ced3d150e3c8.png"">

## 2) Blurry video in window mode
![2018-08-11 at 14 33](https://user-images.githubusercontent.com/2218817/43991753-bb57f06a-9d73-11e8-9ed5-c4640a04b9c2.png)


## 3) Bad resolution in fullscreen
When I switch game to fullscreen display starts to be cropped. Click coordinates works as expected (means that when you click somewhere in bottom right side, you will got window with credits or game quits or preferences appears (depends on where exactly you click)
<img width=""1440"" alt=""image"" src=""https://user-images.githubusercontent.com/2218817/43991690-968280bc-9d72-11e8-963d-c7022bee9279.png"">

(Before click)
![2018-08-11 at 14 27](https://user-images.githubusercontent.com/2218817/43991703-dcbf731e-9d72-11e8-9cce-2391ab9a919c.png)

(After click)
<img width=""1440"" alt=""image"" src=""https://user-images.githubusercontent.com/2218817/43991705-f531ac82-9d72-11e8-86c2-f25c7c9e7774.png"">"
207725806,Fix for issue #3444,hrubymar10,2018-08-10 21:24:14+00:00,2018-08-11 03:52:40+00:00,{'Translations': 1},"Fix for issue #3444 

Please verify that it will work this way"
207697432,Better os version handling,hrubymar10,2018-08-10 19:05:02+00:00,2018-08-11 11:33:07+00:00,{},"Old os version detection was in case of macOS buggy so I reworked it. It is faster now and native.

## TODO
- [x] Create new os version handler for macOS
- [x] Prepare apple specific code for iOS implementation

## Idea
I used `desktop::apple::os_version()` namespace. It may be nice to rework rest of platform specific code to use this namespace style (not only os_version, but also notifications, ...)"
207367932,Allow ties when the turn limit is hit (fixes #1341),joeylmaalouf,2018-08-09 16:07:27+00:00,2018-09-03 03:40:42+00:00,{},"Fixes #1341.

Worth noting is that this only affects the message displayed about which side held the advantage when the turn limit was hit; it doesn't address the related issue of showing the victory/defeat alert to the tied players when they then enter linger mode, since draws currently don't really exist in the game.
"
207322235,NR S14: Update epilogue map to match previous scenario (fixes #3385),joeylmaalouf,2018-08-09 13:47:06+00:00,2018-08-17 15:11:52+00:00,{},"Fixes #3385.

S13: https://i.imgur.com/0g2RTAL.jpg

Old S14: https://i.imgur.com/87Byp0H.jpg

New S14: https://i.imgur.com/u7H1Lh6.jpg
"
207023429,Add battery percentage into game view (next to current time),hrubymar10,2018-08-08 14:16:24+00:00,2018-08-21 15:56:29+00:00,{'Enhancement': 1},"I am working on new feature. I want add current battery percentage next to current time in game view:
![2018-08-08 at 16 07](https://user-images.githubusercontent.com/2218817/43842250-3a9f41b2-9b25-11e8-8bda-3be812410418.png)

## TODO
- [x] Create `battery_info` class
- [x] Add function to check if is battery present
- [x] Add function to get battery percentage
- [x] Port to macOS
- [x] Port to iOS
- [x] Port to Linux
- [x] Port to Windows
- [x] Create/Find nice battery icon (e1aefce)
- [x] Ask someone to create Windows port (probably jyrkive)
- [x] Ask someone to create Linux port (probably jyrkive)
- [x] Move battery icon on right from current time (b1c12acb8ee9b82c088114dfe00cf1a7ceff9c33)
- [x] Ask someone to fix CMake build on macOS (add `-framework IOKit` linker option) (827063d)
- [x] Find way to hide GUI element (if battery not present) - (16a44b25f1bf3f00efdc8e55cf8c107ede8fdca3)

## Example usage (patch):
```
diff --git a/src/wesnoth.cpp b/src/wesnoth.cpp
index fc78252d34..2a7c53ab32 100644
--- a/src/wesnoth.cpp
+++ b/src/wesnoth.cpp
@@ -17,6 +17,7 @@
 #include ""commandline_options.hpp"" // for commandline_options, etc
 #include ""config.hpp""              // for config, config::error, etc
 #include ""cursor.hpp""              // for set, CURSOR_TYPE::NORMAL, etc
+#include ""desktop/battery_info.hpp""
 #include ""editor/editor_main.hpp""
 #include ""filesystem.hpp"" // for filesystem::file_exists, filesystem::io_exception, etc
 #include ""floating_label.hpp""
@@ -1112,6 +1113,10 @@ int main(int argc, char** argv)
 		std::cerr << ""Battle for Wesnoth v"" << game_config::revision << '\n';
 		const time_t t = time(nullptr);
 		std::cerr << ""Started on "" << ctime(&t) << ""\n"";
+        
+        if (desktop::battery_info::does_device_have_battery()) {
+            std::cerr << ""Battery level is "" << desktop::battery_info::get_battery_percentage() << ""%\n"";
+        }
 
 		const std::string& exe_dir = filesystem::get_exe_dir();
 		if(!exe_dir.empty()) {
```"
206561937,Menu: re-order and re-rank campaigns (including new ranks) (fixes #1222),joeylmaalouf,2018-08-07 02:16:59+00:00,2018-09-14 13:44:31+00:00,{'Enhancement': 1},"Fixes #1222.

Note that the wiki's description of ""rank"" on the CampaignWML page will need to be updated, though I don't have a wiki account or the knowledge of how that's supposed to go (I suppose it'd be the addition of one of those ""if version XYZ or later:"" blocks?).

For ease of comparison, here's a before and after summary of each campaign's rank and category, along with the wiki text:

BEFORE
```
Novice:
    5 A Tale of Two Brothers
   10 An Orcish Incursion
   15 The South Guard
   20 Heir to the Throne
Intermediate:
  110 Liberty
  125 Legend of Wesmere
  130 Eastern Invasion
  140 The Hammer of Thursagan
  150 Descent into Darkness
  160 Delfador's Memoirs
  170 Dead Water
  180 Secrets of the Ancients
Expert:
  215 The Sceptre of Fire
  220 Son of the Black-Eye
  230 The Rise of Wesnoth
  240 Northern Rebirth
  250 Under the Burning Suns
```

CampaignWML:
  rank: a number that determines the order of campaigns in the campaign selection menu. Lower rank campaigns appear earlier, with unranked campaigns at the end. Currently the mainline campaigns use multiples of 10 from 0 to 399, with 0-99 for Novice campaigns, 100-199 for Intermediate campaigns, and 200-399 for Expert campaigns; if you specify this, it should not be less than 400. (Note: This replaces an older convention that topped out at 50.)

AFTER
```
Rookie:
    5 A Tale of Two Brothers
   10 The South Guard
   15 An Orcish Incursion
Novice:
   50 Heir to the Throne
   55 Liberty
   60 Eastern Invasion
Intermediate:
  100 Descent into Darkness
  105 The Hammer of Thursagan
  110 Dead Water
  115 Delfador's Memoirs
Hard:
  150 Legend of Wesmere
  155 The Sceptre of Fire
  160 Secrets of the Ancients
Expert:
  200 Son of the Black-Eye
  205 The Rise of Wesnoth
  210 Under the Burning Suns
  215 Northern Rebirth
```

CampaignWML:
  rank: a number that determines the order of campaigns in the campaign selection menu. Lower rank campaigns appear earlier, with unranked campaigns at the end. Currently the mainline campaigns use multiples of 5 from 0 to 249, with 0-49 for Rookie campaigns, 50-99 for Novice campaigns, 100-149 for Intermediate campaigns, 150-199 for Hard campaigns, and 200-249 for Expert campaigns; if you specify this, it should not be less than 300.
"
206288102,Updates the Title field of a few tracks.,Pentarctagon,2018-08-06 04:47:23+00:00,2018-08-08 04:56:39+00:00,{},"defeat2: Defeat -> Defeat 2
elvish-theme: Elvish theme -> Elvish Theme
frantic-old: Frantic -> Frantic Old
silence: silence.ogg -> Silence
victory2: Victory -> Victory 2

---

This is pretty straight forward, but I don't know if there are any other considerations when making changes to music.  The titles were edited and saved through VLC."
206238923,SoF S9: Rephrase the intro text (fixes #3405),stevecotton,2018-08-05 13:30:40+00:00,2018-08-06 05:35:38+00:00,{},"The original text that referred to Knalga was confusing if the
player thought of Knalga as ""dwarvish territory"", and most of
the campaign's scenarios have been somewhere in Knalga."
206238298,Slightly rewrite dialogue (fixes #3386),Wedge009,2018-08-05 13:15:32+00:00,2018-08-22 12:45:55+00:00,{},"Some non-native English readers may find use of the word 'disposed' confusing.

(Using PR because I'm not sure of the process surrounding string freezes.)"
206198895,Saurian Race Description,sigurdfdragon,2018-08-04 16:15:44+00:00,2018-08-15 03:06:16+00:00,{},"Fixes #3372  (fix for #3392 to be later for master only)

Gives the Saurians a race description (taken from the wiki, with the minor change of comparing height against humans instead of drakes) The wiki description has been around for several years.

Has the Saurian warrior line be female, in accordance with the new race description, some lore in SotA and some UMC campaigns, which have likely gotten this from the wiki."
206197037, Make Dune Burner line naphtha icons consistent and remove outdated comment,joeylmaalouf,2018-08-04 15:26:15+00:00,2018-08-18 06:05:28+00:00,{},"Fixes #2974 as well as a TODO that I noticed in the same file.
"
206186828,Updating (my) contributions,Konrad22,2018-08-04 10:32:59+00:00,2018-08-04 10:34:31+00:00,{},"Just added my name and my contribution for translating. (Yes, that's more commits than I should have needed. It's messy. ._.)"
206022933,Add categories to appdata,rrigby,2018-08-03 12:59:03+00:00,2018-08-03 13:07:52+00:00,{},"following https://standards.freedesktop.org/menu-spec/latest/apas02.html

added to provide better filtering support in software utilizing the appstream."
206017646,GUI: Fix check for no usable weapons.,jostephd,2018-08-03 12:36:38+00:00,2018-08-03 12:41:10+00:00,{},Fixes #3424.
205947057,Fix halo remain with pur recall unit,newfrenchy83,2018-08-03 07:26:56+00:00,2018-08-03 09:03:17+00:00,{},I use clear_haloes for what halo cleared before unit on map put in recall list. I not yry with other soluce.
205233817,SoF S4: Remind the player to recruit miners before their gold runs out,stevecotton,2018-07-31 20:33:17+00:00,2018-08-04 05:46:09+00:00,{},Responding to @konrad22's #3394
205210808,Droid toggle and feedback,jostephd,2018-07-31 19:01:22+00:00,2018-07-31 20:26:43+00:00,{},Fix a condition that was always false and add feedback (#2819).
205210507,"Addon Manager: Don't use ""ascending"" and ""descending"" to describe how dates are sorted.",jostephd,2018-07-31 19:00:20+00:00,2018-08-04 09:46:21+00:00,{},~Everyone is not a programmer.~
204677737,Move generally-useful units to core so addons can use them,CelticMinstrel,2018-07-30 02:12:57+00:00,2023-01-25 05:45:26+00:00,"{'Campaign (any)': 1, 'Graphics': 1, 'Units': 1}","This moves many units from campaigns to core, allowing addons to safely use them without having to copy them into their own addon directory.

The following units have been moved (or are planned):

* [x] ~Quenoth faction (all units except Youth, Corrupted Elf, and Incarnation) - note that this is a total of 21 units~
* [x] Naga Hunter and ~Naga Guardian line~ (4 units total)
* [x] Merman Citizen and Brawler
* [x] Great Ogre (with optional define to enable it advancing from ogre; NOTE this define still needs to be added to LoW's extra_defines)
* [x] ~Wose Sapling and Shaman~ (with optional define to enable the shaman advancing from wose)
* [x] ~Skeleton Rider, Bone Knight, and Death Squire (with optional define to enable the death squire advancing from skeleton)~
* [x] Dwarvish Miner
* [x] Orcish Shaman
* [x] ~(new) Riderless tauroch, if I can find a sprite for it.~

This hasn't been tested yet, but for now it's up here for general review. I'll test it at some point once I get master built (which I think just means switching out libraries)."
204651434,"THoT S6: Now that the player is told which hut to look at, don't trigger Ratheln if the player ignores the hint.",jostephd,2018-07-29 17:00:39+00:00,2018-07-30 12:20:33+00:00,{},"From https://github.com/wesnoth/wesnoth/pull/3395#issuecomment-408688252

The radius values may need balancing."
204645274,Modified map for Sceptre of Fire - Sc1,Konrad22,2018-07-29 14:37:56+00:00,2018-08-01 07:10:08+00:00,{},"New map for SoF - Sc1 to fix #3383 (removing the fastest way to reach the elvish leader, by replacing some regular mountains with snowy mountains). (Only changes are on the left side of the map.)
The players army is effectively slowed by 1-2 turns, giving the elves enough time to recruit new units and survive until they get more gold for reinforcements.
New:
![map-screenshot_000](https://user-images.githubusercontent.com/39015360/43367468-bb623622-934d-11e8-837e-39ad377a8bf9.png)

Old:
![map-screenshot_001](https://user-images.githubusercontent.com/39015360/43367511-5f4d399e-934e-11e8-82c5-ad0b25f642dc.png)

"
204630100,THoT S6: Let a Scout be the first to smell Ratheln's cooking.,jostephd,2018-07-29 07:56:13+00:00,2018-07-29 15:49:33+00:00,{},
204524700,"Liberty S3, S8: Add dialogs",jostephd,2018-07-27 19:50:50+00:00,2018-08-21 05:22:19+00:00,{},"S3: Add a story instead of Relana saying ""our secret meeting place"" to Baldras, that broke the fourth wall for me. Not sure which `background` to use.

S8: Two minor dialog changes."
204523191,Fix various typos.,jostephd,2018-07-27 19:43:39+00:00,2018-08-22 13:34:05+00:00,{},"AOI S3: Address Erlornas as ""lord"" in lowercase as done elsewhere in the
scenario."
203750632,Fix sorting of units by level in Recall List and Unit List.,jostephd,2018-07-25 07:53:25+00:00,2018-07-27 07:26:22+00:00,{},Now the triangle points down when the list is sorted by level descending.
203715682,iOS interfering with Mac: Mac touchpad generates touch events too.,singalen,2018-07-25 04:05:17+00:00,2018-07-25 04:11:24+00:00,{},Ignore them until Macs have a touchscreen: https://forums.libsdl.org/viewtopic.php?p=45758
203628504,Make /q sl and status case insensitive,ProditorMagnus,2018-07-24 19:20:09+00:00,2018-07-24 19:24:28+00:00,{},"With case insensitive status if same case insensitive name is connected from multiple IP, it only outputs results for first IP. I believe that is acceptable. That problem does not affect sl."
203555132,"Show ""failed to fit"" message with single timestamp",ProditorMagnus,2018-07-24 14:52:29+00:00,2018-07-24 14:54:39+00:00,{},"Before 20180724 17:21:37 error gui/layout: Failed to fit vertical list to requested rect; expected bottom edge was 27720180724 17:21:37 error gui/layout: , actual bottom edge was 19520180724 17:21:37 error gui/layout:  (top edge is 113)
After 20180724 17:34:30 error gui/layout: Failed to fit vertical list to requested rect; expected bottom edge was 277, actual bottom edge was 195 (top edge is 113)"
203412955,Tutorial S1: display an undo message if impossible to reach next target,aszell,2018-07-24 05:23:20+00:00,2018-09-15 21:44:57+00:00,{},"Fixes #3039

Until the elves attack the quintain it is not allowed to end turns before
completing the given tasks. Display a message how to undo if there is
not enough MP remaining to reach the current destination by either unit."
203234763,Fix 3339dfbf4d687a389d7f056289ac82d6374f02b8 typos,ProditorMagnus,2018-07-23 14:18:59+00:00,2018-07-23 14:31:39+00:00,{},[ci skip]
203034121,"NR S7-8: make Stalrag ""healthy"" for consistency, and avoid re-creating him from scratch",joeylmaalouf,2018-07-22 01:10:39+00:00,2018-08-02 23:51:50+00:00,{},"Fixes issue #3140, and addresses something brought up by @sevu down below."
203007678,Help: Hide abilities with empty names.,jostephd,2018-07-21 12:21:20+00:00,2018-07-22 21:46:46+00:00,{},"Fixes empty name abilities in help in Liberty S1.

I thought of adding support for `hide_help` for custom abilities but that might be overkill."
201564517,Migrate links to https if available - Fwd #3332,hrubymar10,2018-07-16 08:06:23+00:00,2018-07-16 08:07:10+00:00,{'Fwdport': 1},Fwd of commit c18537edc0678f40a209797d72dfaba3e5e88545 from PR #3332
201477070,[terrain graphics] Additional village variations,doofus-01,2018-07-15 02:02:38+00:00,2018-07-27 10:26:27+00:00,"{'Graphics': 1, 'Stable 1.14': 1}","Started this because of request by @sevu in #3335 .  Initial commit is for snow and nighttime snow variations of primitive hut that matches the regular versions.  There are other variations (snow/nighttime) of other villages that are missing, I can add those here later.

(BTW:  Why do _all_ the villages have a fire at night?  Originally, I'd had it to show up randomly, but I guess the denizens of Wesnoth are very conformist?  Looks strange, and it would have looked less glaring to have missing variations if there were some randomness to it.) "
201472303,Small fixes to Liberty,DisherProject,2018-07-14 22:47:33+00:00,2018-07-28 00:01:30+00:00,{},"I'd like to propose some small changes to Liberty. I really enjoyed the storyline and the dialogues, and i don't think they need much enhancement. Instead, imo the code may be improved a bit.
(Some notes about the commits...)

About `Liberty S1` and `Liberty S1-S7`: they are not exactly necessary, the changes i'm suggesting there are just syntactic.

About `Liberty S8`: the changes here are a bit more. The AI needed some changes because [some](https://github.com/wesnoth/wesnoth/commit/6761a5ed5352c8ed307376b43a69789a20f0e1d1#diff-fa253fecea71dd5002097d2f5a406394L81) [goal] tags were misused, not producing the expected behaviour. I've also condensed the other ones, so that they have the same effect as before, but in a shorter way. Here are two replays, so you can see the difference between the current implementation and the one i'm proposing
Now: [Liberty-Glory replay2.gz](https://github.com/wesnoth/wesnoth/files/2195312/Liberty-Glory.replay2.gz)
New: [Liberty-Glory replay.gz](https://github.com/wesnoth/wesnoth/files/2195302/Liberty-Glory.replay.gz)
"
201469644,Rename in recall window,hryniuk,2018-07-14 21:21:07+00:00,2018-07-15 21:16:52+00:00,{},Fixes #3212 
200800633,Add WML unit test for unupgradable,ProditorMagnus,2018-07-11 19:20:38+00:00,2018-07-22 21:51:23+00:00,{},"Current implementation of unupgradable relies on [swarm] overwriting all strike modifications. That is not documented behavior, so it makes sense to add a test for it."
200490946,THoT: Tweak four scenarios,jostephd,2018-07-10 18:50:48+00:00,2018-07-27 21:01:04+00:00,{},
200099910,Migrate links to https if available,hrubymar10,2018-07-09 13:29:47+00:00,2018-07-15 02:23:52+00:00,{},"I believe that it would be good to convert all old `http` links to `https`. So I bulk searched and replaced following strings and created this PR.

| searched string | replaced by |
|-----------------|-------------|
| http://wesnoth | https://wesnoth |
| http://www.wesnoth | https://www.wesnoth |
| http://wiki.wesnoth | https://wiki.wesnoth |
| http://bugs.wesnoth | https://bugs.wesnoth |

This PR is for `1.14` branch but I could do it also in `master` branch"
200077290,THoT S9: Implement a victory condition closer to the one described in the objectives.,jostephd,2018-07-09 12:00:29+00:00,2018-07-15 14:28:18+00:00,{},As suggested on the forums [feedback thread](https://www.wesnoth.org/forum/viewtopic.php?f=55&t=20274&start=15)
200056625,WML: Support the the 'jamming' key in [unit].,jostephd,2018-07-09 10:30:28+00:00,2018-07-15 13:43:06+00:00,{},"From https://github.com/wesnoth/wesnoth/pull/3327#issuecomment-403287078

When this is merged https://wiki.wesnoth.org/SingleUnitWML will need to be updated to document the `jamming` key. That key is also missing from https://wiki.wesnoth.org/UnitTypeWML."
199897091,UI: Prefix tooltips with what kind of information they show,jostephd,2018-07-07 13:29:39+00:00,2019-02-24 19:16:40+00:00,{},"Having these prefixes is consistent with all other tooltips in the sidebar.

Also add a tooltip to vision because the label is truncated and there is no other way for the player to get the vision value."
199889384,THoT S7: Select Darchas so the narrator's reference to him isn't dangling.,jostephd,2018-07-07 09:38:27+00:00,2018-07-08 04:46:22+00:00,{},"The narrator says ""the presence of Darchas"" without explaining who or what Darchas is."
199295579,Delfador Memoirs: some possible changes,DisherProject,2018-07-04 16:47:11+00:00,2018-07-14 00:28:24+00:00,{},"Recently i had the opportunity to play this campaign again. Here are some possible fixes to the known code issues and few changes that, imho, could help improve DM.

About DM S21: i gave elves orcish bows just because, to me, it felt strange to see rough swords and elegant bows together in the attack dialogue."
199090873,"Fix the unit name and unit side flag tooltips (Thanks, Landiss!)",ghost,2018-07-03 21:45:15+00:00,2018-07-05 00:12:14+00:00,{},"https://github.com/wesnoth/wesnoth/issues/3306
Fixes this rectangle box breaking the tooltips for the unit_side flag and the unit name."
199088104,Fix team chat not being marked as such on remote clients,ghost,2018-07-03 21:30:58+00:00,2018-07-05 00:14:56+00:00,{},"https://github.com/wesnoth/wesnoth/issues/3119
Fixing the lack of stars on the remote client when sending a team/observer message.
This commit didn't modify the necessary lines in replay.cpp:
6aa3b3b
(of which the chat_msg::chat_msg one has already been fixed)"
199085998,Bugfix for issue 3119,ghost,2018-07-03 21:20:44+00:00,2018-07-03 21:29:09+00:00,{},"Fixing the lack of stars on the remote client when sending a team/observer message.
This commit didn't modify the necessary lines in replay.cpp:
https://github.com/wesnoth/wesnoth/commit/6aa3b3bc9a920638b68e6ceebd96a23822767c8d
(of which the chat_msg::chat_msg one has already been fixed)"
198929362,WML: Don't add a \n before condition=lose objectives if there are no objectives listed before them.,jostephd,2018-07-03 11:14:39+00:00,2018-07-05 00:16:00+00:00,{},"Remove the blank line that shows above the ""Defeat:"" header when there are `condition=lose` objectives but no `condition=win` objectives.
![screenshot_2018-07-03_10-45-30](https://user-images.githubusercontent.com/24784687/42216645-1772243c-7eb2-11e8-83bc-f59a0418f01e.png)"
198897768,Update CB project,newfrenchy83,2018-07-03 09:12:09+00:00,2018-07-03 09:50:37+00:00,{},
198576751,Sort the movement costs in the tooltip in ascending order,lilinitsy,2018-07-02 05:35:55+00:00,2018-07-22 21:49:54+00:00,{},"Sort the movement costs in the tooltip in ascending order costs. First bases on movement costs, then alphabetically. Addresses https://github.com/wesnoth/wesnoth/issues/2673."
198534081,TSG win conditions,jostephd,2018-07-01 17:28:19+00:00,2018-07-02 22:45:34+00:00,{},"Fixes #3031.

The objectives look funny in linger mode after killing both Urza Afalas and the lich, there's no condition=win objective shown at all, I'm not sure what to do about that.
![screenshot_2018-07-01_17-25-37](https://user-images.githubusercontent.com/24784687/42136964-d981c5d8-7d53-11e8-8d36-b9d235cf1615.png)"
198518847,"Tutorial S1: prevent getting stuck next to Delfador, unable to end turn",aszell,2018-07-01 10:58:34+00:00,2018-07-15 14:23:39+00:00,{},"Fixes #1584 1c - Delfador summons the puppet, you have 0 MP left but the
                 puppet is not adjacent to you, and can't attack or undo

Changed Delfador's initial position to match the quintain's, and made him
step away to summon in the original place next to us, so we don't need to
move again to attack after we reach him.
The movement points of the mage are now updated and he gained quick trait
to fit for the more movements he does.
Final movement also touched, so he does not seem to sidestep the new
enemies when leaving the map."
198481261,Tutorial: provide more detail about the Status Table,joeylmaalouf,2018-06-30 15:23:33+00:00,2018-07-25 23:22:44+00:00,{},"Simple text change addressing issue #2883.
"
198466874,Update CB to c++17,newfrenchy83,2018-06-30 08:41:10+00:00,2018-06-30 08:42:45+00:00,{},
198414741,Remove unused images from Dead Water.,Pentarctagon,2018-06-29 20:18:18+00:00,2018-06-29 20:35:23+00:00,{},"Also confirmed via PM with beetlenaut that they can be removed, and aren't supposed to still be there."
197968839,Emulate weapon specials in abilities except plagues and swarm,newfrenchy83,2018-06-28 09:27:08+00:00,2018-10-14 19:26:31+00:00,{},This time i added apply_to opponent and filter_opponent. Ihope what it is good this time.
197723483,Help: Use `female_name` and `name` as fallback when `male_name` is empty and don't list hidden traits.,jostephd,2018-06-27 12:56:11+00:00,2018-07-08 04:52:14+00:00,{},"This algorithm was lifted from help::generate_trait_topics().

Fixes #3284"
196963162,Fix: add redraw to narrator's message so village count is refreshed,aszell,2018-06-24 18:29:23+00:00,2018-06-26 07:44:09+00:00,{},"Fixes: https://forums.wesnoth.org/viewtopic.php?f=21&t=48370

In the tutorial when we occupy the first village the message tells us the
village count got incremented, but in the old version it was incremented
only afterwards. Non-narrator messages were updated properly. By adding the
redraw, narrator messages triggered by capture event produce the same
result as other speakers."
196032921,Remove unused test file and images.,Pentarctagon,2018-06-20 06:23:53+00:00,2018-06-20 07:46:03+00:00,{},"As far as I can tell, the images in `data/test/test/image/` are only used in `test_sdl_utils.cpp`/`test_sdl_utils.hpp`, neither of which have used for [over 4 years now](https://github.com/wesnoth/wesnoth/commit/d3814b84412c37503597bf670d0a5e5a46631496).  This PR therefore removes them."
195834261,Spelling fixes in German translation of ‘Two Brother’ campaign,Ordoviz,2018-06-19 13:48:54+00:00,2018-06-19 21:02:21+00:00,{},
195754701,Rename filledystem_boost to filesystem in CB projectfile,newfrenchy83,2018-06-19 08:54:48+00:00,2018-06-19 10:03:27+00:00,{},
195590357,"iOS changes. part 1: touchscreen support, touch interface",singalen,2018-06-18 17:06:55+00:00,2018-07-08 21:02:54+00:00,{},"This is a first portion of iOS changes, the ones essential for touchscreens.
I have verified that it compiles and runs, and the changes were verified by many users of iOS release.

Not 100% sure how it interacts with a touch screens AND a mouse."
195508068,GUI: Fix the direction of the arrow on a listbox sort column header.,jostephd,2018-06-18 12:25:24+00:00,2018-06-20 07:46:17+00:00,{},"The arrow direction is now ""up"" for ascending order and ""down"" for descending order."
195506762,Unit List: Sort by XP as second criterion when sorting by level.,jostephd,2018-06-18 12:19:48+00:00,2018-06-22 17:39:37+00:00,{},Fixes #3260.
195346280,disallow attacking with disabled attacks via [do_command],gfgtdf,2018-06-16 19:46:17+00:00,2018-06-17 20:56:51+00:00,{},this fixes some rare cheats in mp.
195330410,[UtBS] various small things,doofus-01,2018-06-16 12:22:07+00:00,2018-06-16 13:32:53+00:00,"{'Campaign (any)': 1, 'Stable 1.14': 1}","I tried to fix the commit messages in PR #3146.  In the process, it seems I accidentally got some translation update included.  If that's easy to fix, great.  If not, the project won't end if this PR is just closed.  The amount of effort required to successfully do something so minor is pretty discouraging."
195326574,Turbo slider,jostephd,2018-06-16 10:14:49+00:00,2018-06-16 23:41:08+00:00,{},Fixes #2741.
195247020,"help: Prevent line breaks within the ""Required XP: 80"" block by using non-breaking spaces",jostephd,2018-06-15 18:07:18+00:00,2018-10-13 21:12:15+00:00,{},"On 1.14, the help page for Shadow has a a line break between ""Required XP"" and the value:

![shadow](https://user-images.githubusercontent.com/24784687/41482948-c7ddf8f4-70c6-11e8-8442-90abe767ee1f.png)

This patch makes sure the ""Required XP: 100"" block is never split across a linebreak."
195088705,Conditional jump or move depends on uninitialised value,ghost,2018-06-15 06:37:39+00:00,2018-06-28 03:38:42+00:00,{},in init_mouse_location. I've found that using Valgrind.
194925432,Fix 'scons dist',jostephd,2018-06-14 15:06:37+00:00,2018-06-23 06:33:31+00:00,{},
194673693,allow non hosts to change factions later.,gfgtdf,2018-06-13 18:20:55+00:00,2018-06-29 22:57:32+00:00,{},"previously players had to leave an rejoin the game to change their faction.
this was most annoying in coop games where you want might want to choose
your faction in consultation with the other players. Also you previously could
not even checkout the different available factions again after you joined
the game."
194429396,1.14: Enable MP lobby to play sounds and display desktop notifications when a new game is created,lilinitsy,2018-06-12 22:53:13+00:00,2019-08-26 05:38:25+00:00,{},"Addresses the enhancement described at issue 2016 #2016.
The lobby will play a sound and display desktop notifications when a new game is played.

I couldn't figure out how to add it as a menu preference, so it currently can't be disabled.

Reopening because I'd screwed up my branches on my fork earlier."
194398144,1.14: Enable MP lobby to play sounds and display desktop notifications when a new game is created,lilinitsy,2018-06-12 20:27:32+00:00,2018-06-12 22:17:42+00:00,{},"Addresses the enhancement described at issue 2016 https://github.com/wesnoth/wesnoth/issues/2016.
The lobby will play a sound and display desktop notifications when a new game is played.

I couldn't figure out how to add it as a menu preference, so it currently can't be disabled."
194370948,"DW S05: Add a po hint about the orc saying ""mermen"" (part of #2940)",stevecotton,2018-06-12 18:37:31+00:00,2018-06-13 11:53:48+00:00,{},"The orc calls them fish-men several times, so changing it to ""merfolk""
wouldn't fit.

Also a whitespace fix from wmlindent."
194212719,Add weapon specials equivalent abilities for 1.15(yet),newfrenchy83,2018-06-12 09:07:08+00:00,2018-06-28 09:27:54+00:00,{},I know i already post a similar PR and my method was not liked but i retry after have corrrcted the bugs.  This time there abilities musthave affect_adjacent tags for activate for use in leadership terror omly. The idea of supply tags is not possible and i have abandon this.
193870273,[UtBS] Finale things,doofus-01,2018-06-11 04:09:42+00:00,2018-06-11 05:43:00+00:00,"{'Campaign (any)': 1, 'Graphics': 1}","This is to deal with what I saw as confusing and underwhelming aspects of the end of UtBS:
1.  The citadel shouldn't be just a hex donut of cave-wall.
2.  There should be some cue to the player about what is going on with the alien central body.

There may be other improvements available, but I think this is an improvement over status quo."
193848352,Don't interrupt the event after a WML error,CelticMinstrel,2018-06-10 21:49:39+00:00,2020-09-13 00:59:43+00:00,{'WML': 1},"People have been complaining recently about how events are interrupted if a Lua error occurs, leaving the game in an unexpected state. This patch works around that by calling WML tags in a protected context, allowing the game to continue executing the event even if a single tag fails. While it would still be possible to end up in an unexpected state (for example if a tag was misspelled or a variable is missing in insert_tag), this should at least greatly reduce the chances.

Of course, this also risks the game trying to execute things that depended on earlier things that were skipped due to an error, but... that's probably less undesirable than wholesale dropping the event.

~~I'm not sure whether this should go into 1.14 (but I've opened the PR against 1.14 because that's where I worked it out). If it's decided to put it only in master, this will have to be merged (or rather, cherry-picked) manually.~~"
193848040,Partial fix of weapon special marked as inactive,DisherProject,2018-06-10 21:42:15+00:00,2018-06-26 01:30:54+00:00,{},"Related to #3178 

This should fix weapon specials with ""active_on"" and ""[filter_self] formula="" marked as inactive in the tooltips. 

I couldn't fix backstab because i didn't know what to do :p let me explain why in this example:

![capture](https://user-images.githubusercontent.com/29802612/41206584-6b5bc7c8-6d06-11e8-942e-96e3c912a8de.PNG)

The Thief will have backstab enabled vs the Sergeant, but not vs the Troll Whelp. So what should the tooltip say in this case? That backstab is active because there is _at least_ one enemy who satisfies the skill's requirements? Or should it say something else?
Afaik such issue may occur with any weapon special having ""[filter_opponent]"" or ""[filter_defender]"" as filters.
 "
193833284,"Dead Water and core's Storm Trident: Change ""mermen"" to ""merfolk""",stevecotton,2018-06-10 16:00:03+00:00,2018-06-15 19:01:29+00:00,{},"* Dead Water: Change ""mermen"" to ""merfolk"" (part of #2940)
    This commit excludes changes to S05 Tirigaz, I think changing the dialogue
    there is going to be more complicated, and it's better for that to have a
    separate PR.

* Prose: the Storm Trident's description uses ""merfolk"" (issue #2936)
    Also update Dead Water's copy of it to use race= instead of a
    list of unit types (as done for the core object in 613dd431)."
193828143,"Update core/about.cfg to use ""merfolk"" instead of ""mermen"" (part of #2940)",stevecotton,2018-06-10 14:10:19+00:00,2018-06-10 14:20:04+00:00,{},[ci skip]
193807000,Attack animation updates for Peasant and Ruffian,doofus-01,2018-06-10 03:33:15+00:00,2018-06-10 03:34:22+00:00,"{'Graphics': 1, 'Units': 1}","The timing seemed off for the Ruffian, and the Peasant frames must be ancient.  I'm not entirely sure the Peasant attack animation is finished, but I think it is still better than the current version."
193722392,DiD S02: Stop when ambushed,stevecotton,2018-06-08 21:01:20+00:00,2018-06-08 21:25:35+00:00,{},"This happens in a village-capture event, so the unit has finished
moving for this turn in any case."
193699926,Statistics dialog: preserve selected line when switching tab.,jostephd,2018-06-08 19:11:51+00:00,2018-06-10 03:50:33+00:00,{},Fixes #3223. Sorry for the double submission.
193043283,Efficiency improvements to Lua AIs,mattsc,2018-06-06 14:58:51+00:00,2018-06-07 13:40:24+00:00,{},"There is probably more that can be done along these lines and I am planning to do a general clean-up of the Micro AIs later.  In the meantime, this is specifically for the Goto Micro AI (although it affects some other Lua AIs as well) in response to [this forum thread](https://forums.wesnoth.org/viewtopic.php?f=21&t=48125).  For one of the test cases from that thread, it improves the evaluation time from close to a second (on my computer) to a milli second.

I don't have time for the more comprehensive clean-up right now, but it would be good to get this into 1.14.3."
192214210,add player_version mp command,gfgtdf,2018-06-02 19:33:42+00:00,2018-06-03 00:55:33+00:00,{},to tell you what wesnoth version another player is using.
190814528,[UtBS] graphics update for giant ant unit,doofus-01,2018-05-28 00:28:37+00:00,2018-06-07 08:43:31+00:00,"{'Campaign (any)': 1, 'Graphics': 1}",
190795941,Add a couple missing things from the PR that added the units.,Pentarctagon,2018-05-27 16:33:02+00:00,2018-05-31 06:22:14+00:00,{},"Added the elemental trait to the Jinn. Added the undead_variation key to the Jinn, Wyvern Rider, and Wild Wyvern."
190707218,DiD S12: Alternative campaign finish by letting the hero take the book,stevecotton,2018-05-25 22:37:00+00:00,2018-10-21 19:31:44+00:00,"{'Enhancement': 1, 'Campaign (any)': 1}","On the third and subsequent playthroughs of Endless Night, Mal Keshar
has learned from the ending of SotA, and can leave the book to be
taken by the foolish hero's army.  This text doesn't handle the unit
that picks up the book being the hero themselves, but the hero seems
to be using the normal boss AI of staying near the castle so that
probably won't happen anyway.

He learns how to lichify level 3 necromancers at the start of the
first playthrough, which fits better with the backstory of the book.

This would close issues #3165 and #3167."
190697142,Updated goblin spearman description.,Pentarctagon,2018-05-25 21:23:57+00:00,2018-05-31 06:49:59+00:00,{},See: https://forums.wesnoth.org/viewtopic.php?f=32&t=48137&start=60#p628424 and related posts.
190684083,"Replay: Don't disable the ""Point of view"" button after reset",jostephd,2018-05-25 20:11:08+00:00,2018-06-24 15:47:04+00:00,{'Replays': 1},"Fixes #3107 

The PR is for 1.14 because I couldn't test it with master. It compiled after changing the new constructor overload but I couldn't even load the replay UI in master."
190665309,MP Faction Select dialog: Show leader unit details.,jostephd,2018-05-25 18:36:25+00:00,2018-06-21 03:27:58+00:00,{},"If the leader hasn't been discovered, the ""Unknown Unit"" topic will be shown.

Fixes #1491.

This is for 1.14. I tried to rebase it to master but the help system in master doesn't work for me at all right now even without the patch."
190293920,Fix halo flash when unit advance,newfrenchy83,2018-05-24 13:40:46+00:00,2018-05-26 05:55:12+00:00,{},
189817552,Changed and added hotkeys,ancestral,2018-05-22 23:16:19+00:00,2022-08-01 19:48:31+00:00,{'Input': 1},"This prevents unneeded collisions.

No keys are changing with this PR."
189742850,Changes to hotkeys,ancestral,2018-05-22 17:48:56+00:00,2018-05-22 23:14:27+00:00,{},"Many changes have been made to the hotkeys file, and about 8 keys have been re-assigned.

It has also been re-organized so that keys with modifiers are earlier in the file, otherwise they may not get triggered."
189601321,NR5_1: Fixes to Malifor attack and secret door events,UnwiseOwl,2018-05-22 09:36:25+00:00,2018-06-04 16:52:21+00:00,{'Campaign (any)': 1},"Fix for #3117: Malifor damage event now occurs on defence as well as attack
Fix for #3116: doors to the study can now be opened from inside"
189265105,[UtBS] various small things,doofus-01,2018-05-21 01:32:52+00:00,2018-05-29 03:50:48+00:00,"{'Campaign (any)': 1, 'High Priority': 1, 'Stable 1.14': 1}","A mostly accurate list of changes follows, I will update as necessary:
 - S4 & S5:  some variations for scenery
 - S5:  give trolls troll camps, instead of orc castles
 - some cosmetic map changes to the dwarf-killing branch.
 - make sure dwarf sergeant is facing the right way in S6b
 - some very minor updates to Quenoth elves

... well, there is more I could add, but I'm out of time for now.  I'll pick it up again next week.
"
189231553,Add new abilities for 1.15,newfrenchy83,2018-05-20 12:21:28+00:00,2018-06-07 16:07:50+00:00,{},"In htt.utbs andthe addon  loti ,  abilities type chance_to_hit or initiative exist with massive code in wml then. Why don,t create true abilities for addon developper work wiil more easy.
And yes it is a massive tan peoblem in attack
Cpp what i will correct in few days but i lokw had comment in the idea also crazy was it."
189217819,[UtBS] Kaleh sword animation,doofus-01,2018-05-20 03:50:19+00:00,2018-05-20 03:54:19+00:00,"{'Campaign (any)': 1, 'Graphics': 1}",
189199844,[UtBS] Scenario 3 adjustments,doofus-01,2018-05-19 18:07:14+00:00,2018-10-19 22:35:58+00:00,"{'Campaign (any)': 1, 'Stable 1.14': 1}","I don't intend to add anything more here, but I can make corrections.

I've tried to avoid string changes, but there at least two (I will add to this list if needed):

- berserk and magical weapon specials for Garak don't become invisible for non-""champion"" combat, so it just ends up looking broken. (But maybe it is fixed?  I have updated recently, but not recompiled in a while.)  I changed the names and texts slightly to make it look more deliberate.

Other than that:  
 - I added a Scout in the turn 1 random recall-from-tents, for the easy and normal difficulty, because the RNG can leave you with undefended tents you can't reach before the ghost champion can.
 - I thought the teleporting, healthy Garak looked odd in the death events for the corrupted elf, so I tried to come up with an alternative. "
189047204,Experimental AI fixes,mattsc,2018-05-18 14:40:47+00:00,2018-05-20 21:48:54+00:00,{},"This started because of a report of the Experimental AI not working on Dark Forecast.  The reason was that recruiting crashed when there are no enemies on the map _and_ there is no enemy recruit list.  The first commit fixes that.

Btw, that commit looks like it's a lot of changes, but it's mostly just additional indenting.  If you add `?w=1` to the URL, it will just show you the non-whitespace changes.

In the process, I also found some other problems with the Experimental AI in scenarios where the situation changes (such as Dark Forecast).  I will work on those next and add them to this PR."
188643874,Add new units as discussed on the forums.,Pentarctagon,2018-05-17 07:20:01+00:00,2018-05-19 20:28:43+00:00,{},"See https://forums.wesnoth.org/viewtopic.php?f=32&t=47721&start=450#p625660

All images but the young roc/roc would remain under the GPL, since Kwandulin based them on images by Sleepwalker and I wasn't able to contact him about using the CC BY-SA for them.  The young roc base and attack sprites are under the CC BY-SA, and are by Vyncyn(forum username).

---

I wasn't sure what to do with the L2 Roc, since it still needs a sprite, so it uses the L1's sprite.

todo: Vyncyn has not yet replied about what name he'd prefer in the credits."
188618395,[UtBS] Nym sword attack animation,doofus-01,2018-05-17 04:05:15+00:00,2018-05-17 05:40:37+00:00,"{'Campaign (any)': 1, 'Graphics': 1}",melee attack animation for female variation of Quenoth Youth.
188613354,"Revision for The Hammer of Thursagan Scenario 12 ""The Underlevels""",nemaara,2018-05-17 03:17:22+00:00,2018-12-15 19:26:58+00:00,"{'Enhancement': 1, 'Campaign (any)': 1}",Reworked the last scenario of THoT to be more similar in difficulty and scope with the rest of the campaign.
188613003,"Revision for The Hammer of Thursagan Scenario 12 ""The Underlevels""",nemaara,2018-05-17 03:14:11+00:00,2018-05-17 03:15:30+00:00,{},Reworked the last scenario of THoT to be more similar in difficulty and scope with the rest of the campaign.
187983752,Wesnothd formatting cleanup,Vultraz,2018-05-15 00:16:59+00:00,2018-05-15 10:49:49+00:00,"{'Enhancement': 1, 'MP': 1}",@shikadiqueen told me to make this a PR.
187919623,Replace remaining uses of FOREACH macro,mattsc,2018-05-14 18:57:44+00:00,2018-05-15 00:20:55+00:00,{},Making this a PR because it changes one of the unit tests.  I want to make sure all the checks pass before I merge this.
187707100,[UtBS] quenoth fighter attack animation,doofus-01,2018-05-14 02:30:05+00:00,2018-05-14 02:50:24+00:00,"{'Campaign (any)': 1, 'Graphics': 1}","Not the best, but not the worst, and better than nothing."
187695873,UtBS 5: changes to scenario locations,UnwiseOwl,2018-05-13 23:24:07+00:00,2018-06-08 14:40:23+00:00,{'Campaign (any)': 1},"From #3077:
* Moved AI leader spawns to keeps
* Changed spawn of trolls that were spawning in walls
* Sanity-checked village ownership in cavern

From #3078:
* Changed spawn of Eastern Troll Flamecaster
* Fixed entry routes of Troll Flamecasters

From author notes:
* Made 'Wounded Dwarf' a wounded unit"
187695855,DW 5 Tirigaz - Changes to orc leader death event,UnwiseOwl,2018-05-13 23:23:40+00:00,2018-06-11 12:40:49+00:00,{'Campaign (any)': 1},"Fixes #3092 - Now updates objectives if orc leader is killed first, and gives additional dialogue
Fixes #3093 - Gold event now won't fire if ghosts kill the orc leader"
187695763,Change layering of stone bridges,doofus-01,2018-05-13 23:21:02+00:00,2018-06-20 07:58:02+00:00,{},"This is to deal with #1274 
The results aren't perfect, but I don't see how to make it perfect without drawing new images.
I didn't see anything broken by changing the layer from -80, but it must have been -80 for a reason, so certainly test this before merging.
![screenshot_009](https://user-images.githubusercontent.com/13510196/39972687-87d2c8c8-56c9-11e8-8f5d-4ee951a719f1.jpg)
"
187653641,[UtBS]1.14 quenoth defense animations,doofus-01,2018-05-13 05:42:28+00:00,2018-05-14 00:41:12+00:00,"{'Campaign (any)': 1, 'Graphics': 1}","pathfinder and outrider, for now."
187599062,Nr S2: edited map:,sevu,2018-05-12 01:51:13+00:00,2018-05-12 20:01:41+00:00,{},"* make north gate obvious to players
* mitigate bridges transition (#1274)
* use less human castles
* don't break northern train line
"
187593876,DW 5 - Tirigaz : Changes to orc leader death,UnwiseOwl,2018-05-12 00:11:55+00:00,2018-05-13 01:00:27+00:00,{},"Fixes #3093 - If ghosts kill the orc, gold event does not fire and there's alternate dialogue.
Fixes #3092 - Objectives update on death of orc leader.

NB: learning pull requests, let me know if I'm doing it wrong "
187585661,NR S05a_01: changed SE path to remove 1-hex bottlenecks,UnwiseOwl,2018-05-11 22:46:22+00:00,2018-05-14 00:56:20+00:00,{},"Fix for #3043

This allows player 3 to send more enemies against the human player sooner. If this is an issue, may be necessary to  consider changing the scenario wml to delay this player spawning by a turn.

Note: This is my first pull request and as usual I don't know what I'm doing so if I'm doing it wrong please let me know"
187433470,[WIP] filesystem::sanitize_path: fix getting $USER env var.,matthiaskrgr,2018-05-11 11:04:06+00:00,2018-05-11 11:07:34+00:00,{},"The code was getting the $USER env var and then replacing it with string literal ""USER"" if it was NOT a nullpointer.
However we only want to replace if it IS a nullpointer.

Fixes #3082"
187348629,Cmake fixes,Pentarctagon,2018-05-11 01:50:00+00:00,2018-05-11 16:22:22+00:00,{},"Fixes #3071.
Fixes #3083.

Also travis is now able to run osx+cmake, since that's the only way I have to test that these work."
187199461,Replace deprecated Lua code,mattsc,2018-05-10 13:55:25+00:00,2018-05-13 23:57:18+00:00,{},"There are three deprecated Lua functions that still need to be replaced in 1.14: wesnoth.tovconfig(), wesnoth.get_variable() and wesnoth.set_variable().  tovconfig() is done and the deprecation message disappears.

get_variable() is mostly done, but I've hit a problem that I do not know how to solve.  It's the [definition of wml.variables in data/lua/core.lua](https://github.com/wesnoth/wesnoth/blob/master/data/lua/core.lua#L260) itself that causes the remaining deprecation message.  Obviously, this is the one instance where the old function is still needed, and I am not familiar enough with how this works at this time to know what to do.  Any advice?

I'll do set_variable() once I have figured this out."
186880893,fixes Issue #3051 (Recruitable Peasants in TSG),Byteron,2018-05-09 10:31:31+00:00,2018-05-30 19:44:51+00:00,{'Campaign (any)': 1}," Deoran is able to recruit peasants during the whole campaign, it was discussed to remove them from the recruit list after they leave Westin (Sc2)."
186566375,Tutorial: add labels to villages and keep,Ferk,2018-05-08 08:49:59+00:00,2018-05-13 03:01:31+00:00,{},"There have been reports of players who mistakenly went back to the keep when they were instructed to go to the village, and vice-versa (see #3039).
This confusion leads them to assume there's a bug in the game when they see they cannot end the turn, sometimes even retrying/undoing but consistently repeating the same thing without realizing they were going to the wrong tile. 
Examples:
- https://steamcommunity.com/app/599390/discussions/0/1696046342853921782/
- https://steamcommunity.com/app/599390/discussions/0/1696046342859863684/

This is just adding labels to make sure people don't confuse where to go.
Some new players might find confusing that what looks like a single house is considered a village."
186457861,more debug information in icompare,gfgtdf,2018-05-07 20:38:26+00:00,2018-05-07 23:52:42+00:00,{},pr because its untested
186407564,editor: don't allow bad location id strings,gfgtdf,2018-05-07 17:04:49+00:00,2018-05-07 19:23:23+00:00,{},"because using spaces or commas here results in invalid map files when the map is written to disk. (repoted on the forum)

pr because its untested."
186248257,[UtBS] replacing horses with dustboks,doofus-01,2018-05-07 03:34:10+00:00,2018-05-13 20:32:48+00:00,"{'Campaign (any)': 1, 'Stable 1.14': 1}","Renaming the ""horses"" to ""dustboks"" (which was discussed here: https://forums.wesnoth.org/viewtopic.php?f=32&t=48117)  Turns out this only affects first scenario, as determined by grepping for horse; I did not play through the whole campaign so I might have missed something.  

I've also included a riderless dustbok, it might be useful in future revisions.

This PR should address #2854"
186229678,Fix dialogue not triggering in TSG 'Into the Depths',catagent101,2018-05-06 22:23:12+00:00,2018-05-13 21:00:43+00:00,{},"Closes #3030. Since the trolls are on a different side, the event wouldn't trigger if they spotted Mal M'brin."
186211751,Warn about use of trampolines for nested functions.,Pentarctagon,2018-05-06 15:37:15+00:00,2018-05-09 07:38:24+00:00,{},Use of this feature with GCC in particular causes the stack to become marked as executable.
186200124,Fix excessive mp lobby refreshing.,lipk,2018-05-06 11:09:00+00:00,2018-05-06 11:42:34+00:00,{},Hopefully fixes #3034 
186185199,"[UtBS]-Graphics Update, mostly sprites ",doofus-01,2018-05-06 02:38:31+00:00,2018-05-07 00:40:21+00:00,"{'Enhancement': 1, 'In-progress': 1, 'Campaign (any)': 1, 'Graphics': 1, 'Stable 1.14': 1}","This PR will be for images only, plus whatever WML I need to wire them in.  No string changes intended."
186105707,Reject bad data URIs,AI0867,2018-05-04 21:14:49+00:00,2018-05-06 10:12:27+00:00,"{'Bug': 1, 'Graphics': 1, 'Stable 1.14': 1}",
186074522,Add option to build wesnoth with hardening options.,Pentarctagon,2018-05-04 19:07:03+00:00,2018-05-05 15:05:54+00:00,{},"Which results in the following:
```
hardening-check wesnoth
wesnoth:
 Position Independent Executable: yes
 Stack protected: yes
 Fortify Source functions: yes (some protected functions found)
 Read-only relocations: yes
 Immediate binding: yes

```"
185994773,1.14: run woptipng png compression script.,matthiaskrgr,2018-05-04 14:08:28+00:00,2019-01-26 11:38:13+00:00,{'Needs Rebase': 1},"992 of 14223 files optimized, 5242590 bytes reduced to 3878424 bytes; -1364166 bytes, -26.02%
Optimization threshold was 10.0%
(size reductions below 10% compared to original size were discarded).

run imagemagick, optipng, advdef and optipng on png images."
185899261,Fix cmake compiling with spaces in directory names.,Pentarctagon,2018-05-04 06:11:36+00:00,2018-05-04 06:30:45+00:00,{},Fix for an issue reported [here](https://forums.wesnoth.org/viewtopic.php?f=5&t=48065#p627097).  I assume this should be cherry-picked over to 1.14 as well.
185822148,AToTB Chase: add custom AI controlling Muff Toras,mattsc,2018-05-03 20:00:12+00:00,2018-05-05 15:42:19+00:00,{},"I've disabled the elves and put a bunch of player's units close to the undead, so that one can test the new AI right from the beginning, without having to play through the first part of the scenario.  Those changes will be removed before merging, of course."
185624877,Text Updates (1.14),Wedge009,2018-05-03 06:17:51+00:00,2018-05-06 16:06:37+00:00,"{'Docs': 1, 'Prose': 1, 'Stable 1.14': 1}",Implementing text changes suggested in #2882 and #2950.
185624719,Text Updates (master),Wedge009,2018-05-03 06:16:24+00:00,2018-05-06 16:40:36+00:00,"{'Docs': 1, 'Prose': 1}",Implementing text changes suggested in #2882 and #2950.
185583277,Add a way to disable _on leaving_ confirmations if wanted.,ghost,2018-05-02 23:04:31+00:00,2018-06-12 16:49:38+00:00,{},"The default behavior is to confirm everything as it has been for years.

Add the feature as an advanced preference.

At the editor: only close without confirmation if there are no changes pending save.
"
185507577,Bump program version.,ghost,2018-05-02 17:26:25+00:00,2018-05-02 18:28:34+00:00,{},"I had to read this file and still found a 1.13 reference.

Is it relevant?
"
185507566,Bump program version.,ghost,2018-05-02 17:26:20+00:00,2018-05-02 18:28:20+00:00,{},"I had to read this file and still found a 1.13 reference.

Is it relevant?
"
184824616,#2971 Scrolling with arrow keys can get stuck,singalen,2018-04-29 08:48:38+00:00,2018-04-30 17:13:26+00:00,{},"Phew, seems to fix it for me."
184806159,Change year numbers in SotBE according to timeline tweaks,Byteron,2018-04-28 21:24:50+00:00,2018-05-15 22:30:23+00:00,"{'Enhancement': 1, 'Campaign (any)': 1, 'Prose': 1}","To fit the tweaks suggested in this thread: (https://forums.wesnoth.org/viewtopic.php?f=12&t=46460#p614551), there are three changed to make in the campaign Son of the Black Eye.

1. In the story of Scenario 1, it says ""fourth year of his leadership"" (from Rahul). It need to be changed to the fourteenth.

2. & 3. In Scenario 17, Kapou'e says, the killing of his father was twenty seven years ago. According to the tweaked timeline, it is just seventeen years ago.

I checked the surrounding campaigns, but didn't find anything else to be tweaked due to the timeline changes.
Why exactly I suggested the changes in the first place, can be read in the linked thread.

If these changes get accepted, then the timeline in the wiki has to be updated accordingly."
184798667,Add OpenGL checks to master,Pentarctagon,2018-04-28 18:09:38+00:00,2018-04-30 14:14:20+00:00,{},Seeing as the dependencies have been added to master's docker images.  This would also be a couple fewer things to need to do when the opengl branch is periodically rebased against master.
184775141,Update wesnoth.cbp (sorry for the late),newfrenchy83,2018-04-28 09:19:58+00:00,2018-04-28 09:36:49+00:00,{},
184770862,addon_manager: add 1.15.x server,vgaming,2018-04-28 07:48:40+00:00,2018-04-28 07:50:22+00:00,{},
184760384,[UtBS] 1.14 various graphics updates,doofus-01,2018-04-28 03:04:00+00:00,2018-05-02 18:33:33+00:00,"{'Campaign (any)': 1, 'Graphics': 1, 'Stable 1.14': 1}","This is for various graphics updates.  I will try to stay away from string changes and balance changes, though there may be some minor trespasses.  I think any changes here will be compatible with 1.14.1 and later."
184717529,Make CMake error-out if required libraries aren't found,stevecotton,2018-04-27 20:15:02+00:00,2018-04-27 20:56:33+00:00,{},"It seems that FIND_PACKAGE_HANDLE_STANDARD_ARGS is doing a case-sensitive
search for whether the find_package flags included REQUIRED."
184645635,Travis nls both,Pentarctagon,2018-04-27 14:54:02+00:00,2018-04-27 21:00:05+00:00,{},Not copying in the `po/` directory ends up saving ~30-40 seconds per non-NLS linux job.
184507111,Add support for disabling log domains in the Logging Options UI,irydacea,2018-04-27 02:07:52+00:00,2018-04-27 04:52:41+00:00,"{'Enhancement': 1, 'UI': 1}","This adds a fifth radio button for disabling individual log domains in the Logging Options dialog from Advanced Preferences.

Once approved and merged I can backport it to 1.14 if this is something that would be deemed useful to have there."
183366992,Update wesnothd.cbp,newfrenchy83,2018-04-23 08:59:25+00:00,2018-04-23 08:59:54+00:00,{},
183313770,"[UtBS] Sprite updates, some other updates, WIP",doofus-01,2018-04-23 02:46:19+00:00,2018-04-23 06:07:11+00:00,"{'Ready for testing': 1, 'Campaign (any)': 1, 'Graphics': 1}","This is for Quenoth sprites and some random things I notice as I go through the campaign.  I'll keep the string revisions (like removing references to horses) out of this, but there might be some new strings, like for a new terrain name.

(I'm not sure if I'm doing this PR correctly, I am tracking 1.14 branch since I couldn't run master last time I tried.)"
183292486,Backport Merfolk race name change and associated prose corrections to 1.14,irydacea,2018-04-22 20:28:33+00:00,2018-05-02 07:49:02+00:00,"{'Enhancement': 1, 'Backport': 1, 'Units': 1, 'Prose': 1, 'Stable 1.14': 1}","This backports the Merfolk race name change from commit 296894c5155ca6c2e77bfa92dee65a98e6797318 to 1.14. This should be merged once the string freeze on 1.14 is lifted, along with a changelog entry not currently provided by this PR.

See also issue #2940."
183289861,Tutorial: fix the overall translation hint comment,stevecotton,2018-04-22 19:31:48+00:00,2018-04-22 19:51:46+00:00,{},"The comment at the start of 01_Tutorial_part_1.cfg wasn't immediately
before a string, so the hint for translators wasn't in the file that
goes to the translators. Fix it so that the tutorial shows working
usage of ""# po:"" style comments; this is probably more help to people
using the tutorial as a reference for WML, rather than the translators
themselves."
183267496,"cmake: if sanitizers are enabled, also add -fno-omit-frame-pointer and -fno-optimize-sibling-calls.",matthiaskrgr,2018-04-22 11:06:18+00:00,2018-04-26 00:08:15+00:00,{},"Otherwise, if we build with sanitizers and optimizations, the sanitizer stacktraces can become quite hard to read."
183264969,Add filter_weapon for leadership residtance in 1.14,newfrenchy83,2018-04-22 09:54:39+00:00,2018-04-22 09:58:01+00:00,{},Sorry. I don't see what master branch was already for 1.15 dev.
183249358,Allow specifying a sanitizer with cmake.,Pentarctagon,2018-04-22 00:50:44+00:00,2018-04-22 00:51:50+00:00,{},
183248998,Allow specifying a sanitizer with cmake.,Pentarctagon,2018-04-22 00:36:24+00:00,2018-04-22 00:41:53+00:00,{},
183235823,Update wesnoth.cbp,newfrenchy83,2018-04-21 18:26:16+00:00,2018-04-23 02:52:20+00:00,{},
183213295,Enable building with mysql support on travis.,Pentarctagon,2018-04-21 08:40:20+00:00,2018-04-21 09:31:54+00:00,"{'Enhancement': 1, 'Building': 1, 'CI': 1, 'SCons': 1, 'CMake': 1}",
183196075,Falcons & Wolves Race Descriptions,sigurdfdragon,2018-04-21 00:32:36+00:00,2018-05-06 16:48:22+00:00,"{'UI': 1, 'Stable 1.14': 1, 'Help': 1, 'Fwdport': 1}","Race descriptions for falcons & wolves from:
https://forums.wesnoth.org/viewtopic.php?f=32&t=43721&p=593757#p593757
&
https://forums.wesnoth.org/viewtopic.php?f=32&t=43721&start=75#p597028

Posting for review and will merge with 1.14 & master after 1.14.0 is out.

"
183146538,Give optimization level separate handling for scons/cmake,Pentarctagon,2018-04-20 19:10:19+00:00,2018-04-21 06:32:23+00:00,"{'Enhancement': 1, 'Building': 1, 'SCons': 1, 'CMake': 1}",See commit message.
182996355,[WIP] wesnothd: Support for matching forum bans,irydacea,2018-04-20 08:44:59+00:00,2018-05-06 08:21:07+00:00,"{'Enhancement': 1, 'In-progress': 1, 'MP': 1, 'Stable 1.14': 1}","This series of patches adds support for verifying users joining the MP server with authenticated forum accounts against the forums' ban table (including user ids, email addresses, and IP addresses).

**Progress status:**

- [x] Basic support for matching account, email address and IP address bans
- [x] Report type of ban in effect
- [ ] Support glob patterns in email address and IP address bans
- [x] i18n support for the messages emitted by the server (cannot be merged before 1.14.0 is announced)
- [x] Exclude MP moderators, warning them in the chat about active bans instead (**note:** see issue #2920)
- [ ] Exclude board founders, warning them in the chat about active bans instead (**note:** see issue #2920)
- [ ] Optimise user table queries in `fuh::user_is_banned()`
- [ ] Count bans towards the authentication failure limit (undecided, see below)
- [ ] Report user-visible ban reason set in the ban table (undecided, see below)

I am undecided about reporting the ban reasons set by the forum moderators since those will be invariably in English and may look a bit strange at the client end upon adding i18n support, not to mention that passing them across will require replacing the error message with the ban reason text, making the error message parseable (which is icky), or extending the protocol (not a great idea for 1.14). In reality people seeing this message will probably check the forums to get the support email address from the ban message page, or they may not speak English and won't understand the reason provided.

Additionally, counting bans towards the auth failure limit is an idea that occurred to me along the way, but it's not a thing that is done for native wesnothd bans at the moment — so it might fall outside the scope of this PR and not really be necessary in the first place.
"
182986796,#2782 Crash when using composing like ˇ and ' in lobby on macOS.,singalen,2018-04-20 08:00:36+00:00,2018-04-21 12:37:54+00:00,"{'Bug': 1, 'UI': 1, 'Stable 1.14': 1, 'Input': 1}","Some backstory: https://github.com/wesnoth/wesnoth/pull/2644#issuecomment-382298822
Most IME functionality reverted for non-`libibus` (read: macOS and Windows) IMEs.

Shouldn't change Linux functionality, but who knows.

Needs testing on Linux and Windows, tested on MacOS."
181719742,fix typo in german translation (for master),ePaul,2018-04-15 20:42:32+00:00,2018-04-15 20:43:30+00:00,{},"This string appears in the status dialog.
I hope editing this file is the right way to go – if not, please tell me what is the correct one.

(This is the same change as #2899 – that one is for 1.14, this one is for master.)"
181719498,fix typo in german translation,ePaul,2018-04-15 20:36:58+00:00,2018-04-16 03:16:16+00:00,{'Translations': 1},"This string appears in the status dialog.
I hope editing this file is the right way to go – if not, please tell me what is the correct one.
"
181680778,SotA: Restore fixes for issues #2844 and #2846 on 1.14,irydacea,2018-04-15 04:48:27+00:00,2018-05-02 07:39:04+00:00,"{'Bug': 1, 'Backport': 1, 'Campaign (any)': 1, 'Prose': 1, 'Stable 1.14': 1}","**(NOTE: a changelog patch is not provided in order since it's going to become a merge conflicts minefield in a matter of days.)**

This restores the changes from the following commits:

 * ""SotA S2: fixed inconsistency between unit name and dialog (fixes #2844)"" - commit ab9f29a7a44372a3e3703fd842740a9b425b6f5f
 * ""SotA S8: fixed inconsistent Ghost name (fixes #2846)"" - commit fc6c3ac04b899b4c7f629a1cd8d80101c7cbb20c"
181668487,Fix custom cost functions being unable to consider teleport locations,CelticMinstrel,2018-04-14 21:40:19+00:00,2018-07-15 14:56:18+00:00,{},Also fixes the leader goal candidate action ignoring teleport locations
181664461,finish renaming of the Horseman to Pathfinder,sevu,2018-04-14 19:56:28+00:00,2018-04-16 13:37:42+00:00,{},"This will break some saves, is that fine?
I guess sooner or later this change should happen, and now seems like a good time."
181643611,Update wesnoth.cbp removesdl_ttf,newfrenchy83,2018-04-14 11:32:46+00:00,2018-04-14 11:58:09+00:00,{},
181643377,Update wesnoth.cbp,newfrenchy83,2018-04-14 11:26:10+00:00,2018-04-14 11:42:31+00:00,{},
181641410,Adds a c++17 build using the pre-release Ubuntu 18.04.,Pentarctagon,2018-04-14 10:25:41+00:00,2018-04-17 07:36:15+00:00,{},"Though given 00d87f8fe4078ffd84fcdc0d73fcc2104efef1e7 I would say this is better than nothing.

---

The checks for `Could not initialize SDL_video` were added since, for whatever reason, that error was [showing up at random](https://travis-ci.org/Pentarctagon/wesnoth/jobs/363709778#L2586) for everything *except* the mp tests.  The error never occurs twice in a row, [Xvfb](https://travis-ci.org/Pentarctagon/wesnoth/jobs/365380422#L2350) is running, and explicitly setting [SDL_VIDEODRIVER](https://wiki.libsdl.org/FAQUsingSDL#Linux) to x11 results in it instead saying that [x11 is not available](https://travis-ci.org/Pentarctagon/wesnoth/jobs/365380422#L3099).

Suffice it to say, I assume this is not a Wesnoth issue."
181636316,Travis misc2,Pentarctagon,2018-04-14 07:59:51+00:00,2018-04-14 08:39:21+00:00,{},See commit messages.
181326548,stun special edit,sevu,2018-04-12 21:10:09+00:00,2018-04-13 00:03:13+00:00,{},"This looks trivial, and looking through the docs it should work this way.
But I see that 001fcdc changed only one event, which makes me wonder if the 2nd was missed or if there was a reason for it.
"
181309883,"Moves a nice, but unused macro from anl to deprecated",sevu,2018-04-12 19:59:50+00:00,2018-04-13 00:50:27+00:00,{},"Nice macro, but it's not used in ANL.
Moving to deprecated for now, since ANL has lot's of macros and is maybe not the best place for dead code.

I guess it could be useful to content creator if it were in core. How about that?
And in case we do, is it possible to change the textdomain during string freeze with the pot fix scrip?
"
181304837,Adjust the weapon names of the heroes to better fit their portraits,sevu,2018-04-12 19:38:08+00:00,2018-04-25 17:28:23+00:00,{},"... Quite some time ago I had a few PRs about weapon name changes for core units, mostly bandits.

This adjusts the weapon names of the campaign heroes to better match their portraits:
Harpers weapon is called club on the higher levels as well.
Baldras weapon is clearly a mace.
The female village leader .... ... well, what is it? I changed it for mace too, instead of a morning star."
181058563,AI recruitment: fix units on recall list interfering with recruiting,mattsc,2018-04-12 00:00:59+00:00,2018-04-13 22:25:04+00:00,{},"Units on the recall list are treated as recruits by the AI. The code
previously did not check whether a unit it worth being recalled until
after it makes the decision which unit type to recruit/recall. If it
then can only recall, but not recruit units of that type and all of
them are deemed not worth it, the entire recruitment CA is disabled
(via black listing), meaning recruiting is abandoned also.

This commit fixes this by checking the unit value vs. the recall cost
before putting recalls on the recruitment list."
180998126,Drop duplicate hotkey commands,jyrkive,2018-04-11 19:02:00+00:00,2018-04-12 16:30:29+00:00,{},"This is a fix for #1736. I have verified locally on GNU/Linux that the commit fixes it.

The underlying problem in #1736 is that two input events are generated for the same keypress, and this pull request drops the duplicates at the hotkey manager level.

Because the hotkey manager has traditionally received input events one-by-one, I needed to add a queue of input events. `controller_base` is now a pump monitor: when the event pump is done sending events, `controller_base` tells the hotkey manager to run queued commands. The hotkey manager drops duplicate commands at that point, before running the remaining commands."
180781492,Fix #2745,CelticMinstrel,2018-04-11 03:29:38+00:00,2018-04-12 01:04:57+00:00,{},
180776906,Fix 2745,CelticMinstrel,2018-04-11 02:47:43+00:00,2018-04-11 03:29:04+00:00,{},
180773575,Misc internationalization fixes,CelticMinstrel,2018-04-11 02:17:55+00:00,2018-05-05 01:37:15+00:00,{},This fixes two open issues as well as one that was not reported.
180773499,Fix internationalization issues,CelticMinstrel,2018-04-11 02:17:13+00:00,2018-04-11 02:17:36+00:00,{},This fixes two open issues as well as one that was not reported.
180715332,Fixed spelling mistakes,golimarrrr,2018-04-10 20:15:45+00:00,2018-04-10 20:31:25+00:00,{'Invalid': 1},
180101158,Update wesnoth.cbp remove libpng,newfrenchy83,2018-04-07 11:16:13+00:00,2018-04-14 11:34:21+00:00,{},It's correct?
180097397,Update wesnoth.cbp,newfrenchy83,2018-04-07 09:19:06+00:00,2018-04-07 10:01:23+00:00,{},
180004046,gui2/log_settings: Make log options tooltips translatable,irydacea,2018-04-06 17:07:35+00:00,2018-05-02 07:51:27+00:00,"{'Backport': 1, 'Translations': 1, 'Stable 1.14': 1}","Fixes #2837 on 1.14. This cannot be merged in 1.14 until after 1.14.0 is tagged and announced because of the active string freeze.

The master version is already merged (see commit 3967fd190e60b59cb9017bf4013a177dfcb44fdd)."
179855277,LoW S09 Fix a bug introduced in Lua cleanup 3783693cb,stevecotton,2018-04-06 05:04:04+00:00,2018-04-07 00:37:12+00:00,{},"3783693cbe95be6c51553dfa71bf0ecd5ed8116f was a general rename of
'V' to 'vars', and this line was missed. It caused an error at the
start of S09.

[ci skip]"
179850055,LoW: Fix translation error in conjunct list (fixes #2833),CelticMinstrel,2018-04-06 04:04:07+00:00,2018-04-08 22:55:51+00:00,{},"This uses the new `wesnoth.format_conjunct_list` function to implement the functionality. Needs to be tested, but there's no hurry since it's destined for 1.14.1."
179667017,Fixed typo,hrubymar10,2018-04-05 12:54:52+00:00,2018-04-05 13:00:42+00:00,{},
179397958,Convert custom unicode type aliases to proper C++11 types,Vultraz,2018-04-04 13:53:20+00:00,2018-04-04 15:54:31+00:00,{},"This changes:
```
utf8::char_t   ->  char
utf8::string   ->  std::string
utf16::char_t  ->  char16_t
utf16::string  ->  std::u16string
ucs4::char_t   ->  char32_t
ucs4::string   ->  std::u32string
```

utf16::string and ucs4::string are now proper strings instead of vectors of characters too.

In order to get this change to compile at all, I needed to add a ucs4_convert_impl::convert_impl
specialization for wchar_t alongside the new char16_t specialization; both point to the same
conversion implementation type.

This commit doesn't do any additional cleanup. I'm sure if we looked, we could get rid of a
lot of the custom conversion code and probably a bunch of stuff that might have had to do with
supporting utf16::string and ucs4::string being vectors instead of basic_string specializations.
Either way, I don't know the code (or encoding handling in general) to make a call as to what's
needed or not. I'll let someone else do that."
179103080,Update wesnoth.cbp,newfrenchy83,2018-04-03 13:44:14+00:00,2018-04-03 13:46:37+00:00,{},
179097202,fix filter not working in [disable],gfgtdf,2018-04-03 13:23:30+00:00,2018-04-03 21:57:10+00:00,{},"this removes what seems to be a rather useless opinition in
battle_context::battle_context since choose_attacker_weapon woudl
basicially just return 0 in that case.

fixes #2801"
178752200,Relative movement with [move_unit],CelticMinstrel,2018-04-01 23:11:56+00:00,2018-04-12 02:46:50+00:00,{},This is a PR because it's untested and a little complex.
178750635,"THoT S12 Fix some ""x="" tests that should be ""x,y="" tests (for master branch)",stevecotton,2018-04-01 22:25:26+00:00,2018-04-02 20:59:27+00:00,{},"Taking the chest south of the start hid the door and chest that are
north of the start.

The sneak-door opened much earlier in the level, allowing the undead
from the south-east lich to go north to the spider room.  The ghosts
and nightstalkers that are supposed to ambush the player's forces in
the south (after opening the 3-hex door) instead go north and end up
joining the spider fight.  The slower-moving undead also go north,
and are easily fought one-by-one in the sneak passage instead of the
south-east.

[ci skip]"
178749781,"THoT S12 Fix some ""x="" tests that should be ""x,y="" tests (and changelog)",stevecotton,2018-04-01 22:01:14+00:00,2018-04-02 21:03:20+00:00,{},"The change itself should cherry-pick without conflicts to the master
branch, but as this starts the 1.13.13+dev changelog, the changelog
update will need a manual merge.

THoT S12 Fix some ""x="" tests that should be ""x,y="" tests

Taking the chest south of the start hid the door and chest that are
north of the start.

The sneak-door opened much earlier in the level, allowing the undead
from the south-east lich to go north to the spider room.  The ghosts
and nightstalkers that are supposed to ambush the player's forces in
the south (after opening the 3-hex door) instead go north and end up
joining the spider fight.  The slower-moving undead also go north,
and are easily fought one-by-one in the sneak passage instead of the
south-east."
178744294,Create travis dockerfile in the travis script step.,Pentarctagon,2018-04-01 19:43:59+00:00,2018-04-01 20:05:21+00:00,{},This allows having multiple Dockerfile-base-* files without also needing to add a separate Dockerfile-travis-* file due to the FROM line changing.
178728167,THoT S12 Put the sneak-passageway's door on the right hex (fixes #2804),stevecotton,2018-04-01 13:03:34+00:00,2018-04-01 13:04:17+00:00,{},"This matches with the ""Another old caved-in passageway..."" event
around line 835, the trigger is on 55,33 and the walls that open are

        [terrain]
            x=55,55
            y=34,35
            terrain=Uu
        [/terrain]

Debian bug #483893, for which the original fix in
4c473187e658607b17c113d66b2bf549e48e41e5 changed the wrong digit.

This is a cherry-pick from 1.14 to master (fixes #2804) of
bcaac1ef (the change) and 5b7aca97 (the changelog).

[ci skip]"
178708193,THoT S12 Put the sneak-passageway's door on the right hex,stevecotton,2018-04-01 01:31:43+00:00,2018-04-01 02:52:00+00:00,{},"This matches with the ""Another old caved-in passageway..."" event
around line 835, the trigger is on 55,33 and the walls that open are

        [terrain]
            x=55,55
            y=34,35
            terrain=Uu
        [/terrain]

Debian bug #483893, for which the original fix in
4c473187e658607b17c113d66b2bf549e48e41e5 changed the wrong digit."
178693458,Remove redundand cp from Fix_Xcode_Dependencies,hrubymar10,2018-03-31 18:02:38+00:00,2018-03-31 18:03:30+00:00,{},This can be also merged to 1.14
178693149,Enable Testability for macOS DEBUG builds,hrubymar10,2018-03-31 17:55:09+00:00,2018-03-31 17:59:44+00:00,{},"Merge this also to 1.14 branch

This doesn't break anything. It only enable testability framework for Wesnoth."
178692816,Fix Wesnoth's Application Support dir name,hrubymar10,2018-03-31 17:46:13+00:00,2018-03-31 17:52:51+00:00,{},
178682442, fix gui2 dialog disappearing after [change_controller],gfgtdf,2018-03-31 13:28:44+00:00,2018-03-31 17:39:51+00:00,{},"1.14 only, no masterport, fixes #2794"
178678261,Remove rest of Growl things and CodeSign everything after copy,hrubymar10,2018-03-31 11:25:56+00:00,2018-03-31 11:27:49+00:00,{},"Same as #2786 but for `1.14` branch.

Growl is already removed and it does not break anything."
178665681,Fix errors found by schema validation (fixes #2779),CelticMinstrel,2018-03-31 04:29:50+00:00,2018-05-19 20:36:33+00:00,{},"Not done yet, but I'd like feedback on the LoW changes in particular. I may have made some incorrect choices there."
178644983,pull remote user input even if we are doing a local choice.,gfgtdf,2018-03-30 22:15:50+00:00,2018-03-31 00:25:45+00:00,{},"this mainly effects wesnoth.synchronize_choices:
previously the client would not process incoming choices from other
players while it was exeucting its own local choice (usually a dialog).
The problem this commit fixes is that with the old behaviour any choice
from another player would block the incoming queue, in particular
chatmessages after that command would be delayed until the
wesnoth.synchronize_choices is finished."
178599286,simplify code,vgaming,2018-03-30 17:19:49+00:00,2018-03-30 17:23:40+00:00,{},simplify code and remove `indentity or 0` VS `indentity` inconsistency.
178591318,Remove rest of Growl things and CodeSign everything after copy,hrubymar10,2018-03-30 16:27:53+00:00,2018-03-30 23:42:08+00:00,{},"This should be merged also to `1.14` and `OpenGL` branches.

If is codesigning enabled then it codesign all resources on copy (necessary for signed packages) but when you don't have codesign enabled then it does nothing (Except copying ofc) ."
178580007,Give 1.14 its own docker image.,Pentarctagon,2018-03-30 15:22:41+00:00,2018-03-30 16:18:39+00:00,{},
178546220,Fixed Xcode Project for OpenGL,hrubymar10,2018-03-30 11:48:02+00:00,2018-03-30 12:23:02+00:00,{},"Once more.
It is working now 😊"
178504638,Add using dockerfiles based on the LTS and BRANCH env vars,Pentarctagon,2018-03-30 06:49:30+00:00,2018-03-30 09:08:57+00:00,{},"This makes it simpler in the future to have branches that have dependencies that are different from master, rather than having a single image with all necessary dependencies installed, which may at some point end up not being possible to do."
178473695,Remove slows notes for Quenoth Scout,catagent101,2018-03-30 00:50:43+00:00,2018-04-16 02:22:03+00:00,{},"Since they have no slows attack. Also ""riding skill"" needed to be plural."
178318225,Adds OpenGL/GLEW checks to scons.,Pentarctagon,2018-03-29 12:47:47+00:00,2018-03-29 14:16:07+00:00,{},Taken mostly verbatim from 3e2eba22a96cb2c6c69ee5109059b806f22a372f
178231134,Don't copy the .git directory into docker.,Pentarctagon,2018-03-29 05:35:17+00:00,2018-03-29 06:28:18+00:00,{},
178171369,Credits for Chinese translation of iOS announcements,singalen,2018-03-28 21:36:50+00:00,2018-03-28 21:43:50+00:00,{},nuff said
177975459,Fixed Xcode Project for OpenGL,hrubymar10,2018-03-28 09:15:58+00:00,2018-03-28 09:19:34+00:00,{},
177895150,Remove tools-external-libs.,Pentarctagon,2018-03-27 23:48:35+00:00,2018-03-28 00:21:17+00:00,{},"Also put Boost_RANDOM_LIBRARY, CRYPTO_LIBRARY, and MYSQL_LIBS into server-external-libs."
177757376,Add Czech translator,hrubymar10,2018-03-27 14:23:27+00:00,2018-03-27 22:01:21+00:00,{'Invalid': 1},Please merge this also to `1.14`
177652074,"cmake, scons: Drop option to enable or disable the removed SDL_SavePNG code",irydacea,2018-03-27 07:24:41+00:00,2018-03-27 21:56:04+00:00,"{'Bug': 1, 'Backport': 1, 'Building': 1, 'Stable 1.14': 1, 'SCons': 1, 'CMake': 1}","Commit dfc42e8a8dd550ca04ae16e2d2d7ebffbba0bc21 removed said code since Wesnoth can use `IMG_SavePNG()` from SDL_image 2.0 instead. However, the author left the build-time configuration options intact, and also part of the necessary code for CMake to link Wesnoth against libpng.

Note that this change also eliminates an unnecessary direct link-time dependency on libpng using both CMake and SCons."
177550418,Updated Xcode's README.md,hrubymar10,2018-03-26 19:54:27+00:00,2018-03-28 19:36:27+00:00,{},This probably could be also merged to `master`
177436006,Update wesnoth.cbp remove sdl2_ttf,newfrenchy83,2018-03-26 12:52:05+00:00,2018-03-26 14:49:31+00:00,{},
177411033,Add a filter_second_weapon to leadership and tesistancrs abilities,newfrenchy83,2018-03-26 11:02:38+00:00,2018-04-03 03:56:23+00:00,{},The ennemy wrapon can be also filtered.
177352978,Fixed Xcode project and removed SDL2_ttf,hrubymar10,2018-03-26 06:30:13+00:00,2018-03-26 06:33:54+00:00,{},
177351400,Fixed Xcode project and removed SDL2_ttf,hrubymar10,2018-03-26 06:17:44+00:00,2018-03-26 06:18:10+00:00,{},
177340422,Remove SDL2_TTF,Pentarctagon,2018-03-26 04:33:06+00:00,2018-03-26 06:56:37+00:00,{},
177337769, UtBS: Fix Nym's hit sound to be female,fujimo-t,2018-03-26 04:02:38+00:00,2018-03-26 06:27:19+00:00,{'Ready for testing': 1},"Nym's sound is male now, so this commit fix it."
177315990,Revert opp_ctx in attack_prefiction( impossible to compile),newfrenchy83,2018-03-25 22:43:29+00:00,2018-03-25 23:44:18+00:00,{},The compiler show an error message . i must retry this line. Sorry @CelticMinstrel .
177285174,Update wesnoth.cbp,newfrenchy83,2018-03-25 11:40:22+00:00,2018-03-25 12:31:50+00:00,{},
177279803,Drop OS X 10.7 and Growl support,hrubymar10,2018-03-25 09:05:40+00:00,2018-03-25 12:48:24+00:00,{},On more test running now and also wait for Travis
177261859,fix chat during chat & animations,gfgtdf,2018-03-24 22:21:14+00:00,2018-03-25 12:47:09+00:00,{},"this add a process_network_data in play_slice() whihc is called quite often, in particular during animations and [delay] so you can now see chat of other players. #1856"
177253901,Explicitly set osx_image for osx+scons job.,Pentarctagon,2018-03-24 19:15:00+00:00,2018-03-24 20:38:06+00:00,{},"This is the current default, and even though the job uses scons this also sets the osx version to use.  Therefore it's better to set it explicitly in case the default changes at some point.

---

https://docs.travis-ci.com/user/reference/osx/#OS-X-Version"
177236437,Update wesnothd.cbp,newfrenchy83,2018-03-24 13:09:51+00:00,2018-03-24 13:10:58+00:00,{},
177233631,Add new unit_tests dependencies,hrubymar10,2018-03-24 11:50:21+00:00,2018-03-24 13:27:42+00:00,{},"To be exact, `libboost_timer-mt.dylib` is new dependence of `libboost_unit_test_framework-mt.dylib` and `libboost_chrono-mt.dylib` is dependence of `libboost_timer-mt.dylib`"
177228045,Fixed Xcode Project after 5ece7ac5b71032ec2c6f9bccb57be9a0a863c5ba,hrubymar10,2018-03-24 09:04:21+00:00,2018-03-24 09:12:54+00:00,{},
177198779,fix #2683,gfgtdf,2018-03-23 22:35:43+00:00,2018-03-24 11:05:53+00:00,{},"as the title says, fixes #2683. Commits will be squashed."
177127001,Travis script cleanup,Pentarctagon,2018-03-23 16:49:35+00:00,2018-03-23 23:59:29+00:00,{},See commit messages.
177116300,update mingw project,newfrenchy83,2018-03-23 16:09:49+00:00,2018-03-24 13:34:07+00:00,{},
177071600,add a filter_weapon filter for targetting the attacks affected by leader,newfrenchy83,2018-03-23 13:36:57+00:00,2018-03-25 21:16:23+00:00,{},"With that, i want extent the use of leadership to other unit what mixed fighter like leader. By example
a mage could helped this apprentice in battle with his magical attack but not the physical attack.
Or an melee fighter with the melee attack only. I hope permit to addon devellopper to create new unit lines with this new leaderships in example."
176987272,Remove debugging symbols from Travis xcode build.,Pentarctagon,2018-03-23 06:55:16+00:00,2018-03-23 08:10:29+00:00,{},"This removes the -g option from the xcode travis build, since debugging information isn't needed and the increased size was causing the cache to timeout when compressing and uploading it.  ccache max cache size is also decreased from 2 GBs to 200 MBs, which matches the linux+cmake builds.  Fixes #2670.

---

This also supersedes #2714, since I didn't know I could set this myself."
176892966,Preparation for #2670 fix,hrubymar10,2018-03-22 19:58:18+00:00,2018-03-23 08:05:40+00:00,{},"Do not merge until @Pentarctagon in #2670 will agree with it. If he will agree, then merge it also to 1.14 branch."
176849380,Made blitting error handling less aggressive,JGelfand,2018-03-22 17:12:20+00:00,2018-07-20 20:17:19+00:00,{},"Intended to fix #2225. I can't compile wesnoth, so this is untested right now.  "
176714298,Replace all instances of naked vgettext() calls with VGETTEXT(),irydacea,2018-03-22 09:12:42+00:00,2018-03-23 05:37:51+00:00,"{'Bug': 1, 'Translations': 1, 'UI': 1, 'Stable 1.14': 1}","**BIG CAVEATS, DO NOT MERGE WITHOUT READING THIS FIRST:**

This **breaks the string freeze in one specific case**, and it also seems it cannot be cleanly merged into master at this point, so I will need to provide a version specifically for master separately later. This is intended to be merged into 1.14 first, although I’ll probably do so myself after review from others.

--------------------------

The `vgettext()` function, while declared in `src/formula/string_utils.hpp`, actually has its implementation out-of-line in `src/formula/string_utils.cpp` where `GETTEXT_TEXTDOMAIN` is defined to `""wesnoth-lib""`. Because `vgettext()` is implemented in terms of the `_()` function (an inline wrapper around `translation::dsgettext()`), it passes the textdomain defined in the file where it was implemented as a parameter.

This means that every case of `vgettext()` being used in other code units where `GETTEXT_TEXTDOMAIN` is not defined to `""wesnoth-lib""`, is broken if the string being looked upon doesn’t coincidentally exist in the wesnoth-lib textdomain.

Ages ago, to work around this limitation, an overload of `vgettext()` that takes the textdomain name as a parameter was introduced (see commit 0ba3d05204abff72f7d95cf11a91536dab5aa20a). Since this form of `vgettext()` is rather unwieldy to use (and in particular, the `xgettext` message extraction tool mistakes the first argument for the msgid, see below), a `VGETTEXT()` macro was also added that uses the `GETTEXT_TEXTDOMAIN` symbol defined in the file where the call is made, and thus we get the correct string from the correct textdomain instead of the English original.

Switching all cases of naked `vgettext()` in mainline to `VGETTEXT()` fixes a myriad of situations where an interpolated string that has an extant translation does not actually get translated in practice because of the mismatched textdomain reference (see issue #2709 for an example with MP game titles). I couldn’t find any cases of the companion `vngettext()` function (which handles plurals) being used in the wild naked, but for future reference it also has a companion `VNGETTEXT()` macro to pass the correct textdomain to its textdomain-parameter overload.

One caveat is that this commit **does break the string freeze in one particular case** — `src/units/unit.cpp` has a case where the textdomain-parameter version of naked `vgettext()` was in use with
`""wesnoth""` as the first parameter, and `xgettext` misidentified this as a translation entry for a `""wesnoth""` string in the file’s assigned textdomain (which is the default textdomain, wesnoth). So this will result in the next pot-update both removing the spurious `""wesnoth""` string **and** adding the correct string to the relevant catalogue template (`""<span color=\""$color\"">$number_or_percent</span> HP""`) to that textdomain.

Other than that, I believe this does not break the string freeze in any other fashion and it shouldn’t result in any regressions for i18n.

It might be worth considering in the future renaming `vgettext()` and `vngettext()` to names that make people less likely to misidentify them as functions they can freely call directly without regard to the textdomain assignment issue."
176394475,Fixed Xcode Project,hrubymar10,2018-03-21 06:58:26+00:00,2018-03-21 07:01:22+00:00,{},@Pentarctagon 
176391837,Adds a flag to globally enable or disable unit tests.,Pentarctagon,2018-03-21 06:35:01+00:00,2018-03-21 07:48:32+00:00,{},"This flag is set from the Travis settings page, so in the future this value can be flipped on or off without needing to make a commit.  This is mostly motivated by the fact that running the unit tests on master at the moment is fairly pointless, and disabling unit tests until fixing them is a priority will allow the builds to succeed if there are at least no compile errors rather than always failing every single time like they are now, as well as in some cases erroring out entirely which results in the cache not being uploaded."
176178624,Dunefolk race description,Pentarctagon,2018-03-20 12:45:54+00:00,2018-03-23 23:42:12+00:00,{},"This removes the deprecated Khalifate compatibility code, and adds the race description from the forum."
176115496,Fixed Xcode Project,hrubymar10,2018-03-20 08:16:23+00:00,2018-03-20 08:16:49+00:00,{},
176069045,"Fix #2694, text_box: deleted text is restored during input method is activated",fujimo-t,2018-03-20 01:47:40+00:00,2018-03-25 13:41:58+00:00,{},"The cause of #2694 is that ime_in_progress_ is not disable when text is deleted by Backspace or Delete key.

This PR fixes it and several code cleanup:
* Remove ime_length_
* Rename ime_in_progress_ to ime_composing_
* Use is_composing() instead of raw ime_in_progress_ 

The cleanup above shouldn't affect behavior of text_box."
176029239,Fixed Xcode project,hrubymar10,2018-03-19 21:22:32+00:00,2018-03-20 04:10:07+00:00,{},
175910909,Fixed campaignd Xcode target,hrubymar10,2018-03-19 14:10:28+00:00,2018-03-19 14:18:35+00:00,{},Theoretically this can be also merged to 1.14 branch. I don't know if it will be useful there.
175858092,Fix InfoPlist.strings encoding,hrubymar10,2018-03-19 10:30:19+00:00,2018-03-19 10:31:49+00:00,{},Same description as #2692
175857381,Fix InfoPlist.strings encoding,hrubymar10,2018-03-19 10:27:19+00:00,2018-03-19 10:28:02+00:00,{},"Before it used UTF-16 and for some reason after compiling `InfoPlist.strings` was filled with subsequence of Chinese characters.

After switching to UTF-8 it started working.

@ancestral found this issue first and I have problems because of that in codesigning process @singalen .

After merging to master, I'll also PR it to wesnoth-1.14 branch"
175770009,Wesnoth codesigning script,singalen,2018-03-18 20:01:08+00:00,2018-03-19 01:08:06+00:00,{},"Automates a part of app packaging and signing with Wesnoth, Inc certs"
175767176,Stop hard-coding cmake's -std version.,Pentarctagon,2018-03-18 18:59:40+00:00,2018-03-18 19:59:53+00:00,{},Adds the CXX_STD variable which can be set.  Currently defaults to 14.  This also now makes cmake honor the CXXSTD env variable set on travis.
175761105,Set travis use c++14.,Pentarctagon,2018-03-18 16:53:16+00:00,2018-03-18 16:54:25+00:00,{},
175759860,Change SCons and CMake to C++14,GregoryLundberg,2018-03-18 16:27:51+00:00,2018-03-18 16:29:24+00:00,{},
175758789,Fixed Xcode Project for new Wesnoth 1.15,hrubymar10,2018-03-18 16:04:33+00:00,2018-03-18 16:06:45+00:00,{},
175741571,Updated changelog style,hrubymar10,2018-03-18 09:04:24+00:00,2018-04-03 03:38:31+00:00,{},"I have to do that because maximum size for textfield is 1000x1000 so full changelog doesn't fit there.

This should be also merged to 1.14 branch"
175729888,[UtBS] Quenoth elf animations,doofus-01,2018-03-18 01:17:55+00:00,2018-03-30 11:35:26+00:00,"{'Ready for testing': 1, 'Campaign (any)': 1, 'Graphics': 1}","This incorporates Jetrel's revisions.  the -fly1.png image is actually closer to what he had, the dress billowing sort of like Superman's cape for heroic dynamism.  I thought it looked odd to have it frozen like that, so I'm trying to get it animated for cases where it makes sense.  The fly/float animation filtering probably needs revision.

Of course, more than just the dress should move, but the dress has to be finished first."
175722853,Pre-release Xcode version bump,hrubymar10,2018-03-17 21:43:11+00:00,2018-03-18 06:20:15+00:00,{'Blocker: New Stable': 1},Merge this right before 1.13.12 tag
175706254,add bar_offset_x/y to [unit_type],gfgtdf,2018-03-17 15:41:18+00:00,2018-03-17 18:47:30+00:00,{},"this should probably be opimized later so that it does not need the config lookup on each redraw, but that can be done 1.13.12"
175603748,Fixed Xcode project after #2647,hrubymar10,2018-03-16 17:50:08+00:00,2018-03-16 17:51:42+00:00,{},
175504349,text_box_base: Fix segfault when type characters more than limit by IME,fujimo-t,2018-03-16 11:16:09+00:00,2018-03-17 10:14:19+00:00,{},"This commit fixes segfault when type characters more than limit by Input Method Editor.

pango_text.set_text() is not check whether the text over the maximum length, so change it to insert_text()"
175474504,Implement Liminal as a twilight bonus instead of night and day malus,holius-fr,2018-03-16 09:05:39+00:00,2018-11-17 18:05:24+00:00,{'Enhancement': 1},"The first introduction of liminal was a twilight bonus. It didn't work, and was reintroduced as a malus, which works but seems to be considered bad (see [Dunefolk balance discussions](https://forums.wesnoth.org/viewtopic.php?f=15&t=47831&start=15) on the forum). 

This change takes custom schedules into account, liminal bonus is computed as a bonus that is as close as possible to the best of fearless chaotic and fearless lawful averages."
175406872,No synced command,gfgtdf,2018-03-15 23:40:17+00:00,2018-03-16 12:48:23+00:00,{},
175337248,Use xBRZ in unit preview widget and faction selection dialog,grz0,2018-03-15 18:14:59+00:00,2018-03-18 16:34:25+00:00,{},"xBRZ scaling looks much better than currently used. Works well for all sprites sizes.

Resolves #1609 "
175188137,Fixed Xcode Project after dfc42e8,hrubymar10,2018-03-15 09:17:56+00:00,2018-03-15 09:18:31+00:00,{},
175053604,Update wesnoth.cbp (and sorry for tab and indent or space),newfrenchy83,2018-03-14 18:55:59+00:00,2018-03-14 19:09:12+00:00,{},I usr smartphone i cannot erase a line without bug and crash
175004970,Allow saving screenshots as JPGs,Vultraz,2018-03-14 16:04:43+00:00,2018-03-14 17:31:32+00:00,{'Enhancement': 1},See commit messages for more details.
174955269,Explicitly link to ICU libraries for Linux.,Pentarctagon,2018-03-14 13:30:45+00:00,2018-03-15 07:07:57+00:00,{},This works around some issue when statically linking against boost for builds for flatpak and the steam runtime.  Follows the logic added to scons in e637c55 - APPLE is excluded explicitly here since ICU isn't supported there.
174949572,"add a"" alignment"" weapon_special",newfrenchy83,2018-03-14 13:09:29+00:00,2018-03-15 12:13:48+00:00,{},"This new weapon special permit to an attack allow an alignment different to unit alignment by default.
"
174840806,Attempt at implementing proposed Dunefolk balance tweaks,CelticMinstrel,2018-03-14 02:45:22+00:00,2018-03-17 18:27:30+00:00,{},This implements most of the proposed tweaks in [this forum thread](https://forums.wesnoth.org/viewtopic.php?f=15&t=47831). Further discussion is probably required before merging.
174779815,Base64 refactor,AI0867,2018-03-13 20:25:36+00:00,2018-03-16 14:44:40+00:00,{},Centralize base64 implementation.
174688676,reset units upkeep on type change,gfgtdf,2018-03-13 15:03:15+00:00,2018-03-14 02:48:41+00:00,{},"this fixes 2 issues:
1) previously code like
```
[object]
  x,y=5,5
  id=a
  [effect]
    apply_to=loyal
  [/effect]
[/object]
[remove_object]
  x,y=5,5
  object_id=a
[/remove_object]
```
would leave the unit at 5,5 with a loyal upkeep even though the object was removed

2) fixes #1779"
174560095,"Fix #2619, text_box_base: adapt to separated SDL_TextEditingEvent",fujimo-t,2018-03-13 05:14:53+00:00,2018-03-13 05:40:24+00:00,{},"In SDL_TextEditingEvent, size of editing_text is limited.
If length of composition text is more than the limit, it is separated to multiple SDL_TextEditingEvent.

Current code don't assume the multiple event so this requests fix it."
174535558,Add support for mouse forward/back button in Help,neoedmund,2018-03-13 01:21:06+00:00,2018-03-13 07:56:49+00:00,"{'Enhancement': 1, 'UI': 1, 'Help': 1}",Add support for mouse <kbd>forward</kbd> <kbd>back</kbd> buttons in Help 
174402812,Add support for mouse forward/back buttons in Help ,neoedmund,2018-03-12 15:24:10+00:00,2018-03-13 01:23:35+00:00,{},Add support for mouse <kbd>forward</kbd> <kbd>back</kbd> buttons in Help 
174268778,translation hint for planning mode,sevu,2018-03-12 04:10:09+00:00,2018-03-12 23:33:45+00:00,{'Translations': 1},"... since I saw one language translating it literally.
Any remarks to the wording?"
174266419,Add a way to launch the map editor with the same desktop file,sevu,2018-03-12 03:42:25+00:00,2018-03-12 07:37:41+00:00,"{'Enhancement': 1, 'Linux': 1, 'Packaging': 1}","similar to the extra options which Firefox has
with an right click one can launch the editor now
one could as well add an ""cheating mode"" option for -d
Maybe to some Developers an desktop action for the test scenario is useful too?
(just for inspiration, not to be added to the PR)

Many distributions use modified desktop files, and add a 2nd
to launch the map editor. I think that's a better idea, because
it's less hidden than this feature. However, I think one doesn't
out-rule the other.

The translations are taken from downstream's desktop files for
the map editor - unfortunately they aren't complete

Basically I think this can go in as is.

![actions](https://user-images.githubusercontent.com/21158813/37265070-4c7ac44a-25b1-11e8-814d-71abbfd71f81.png)"
174247842,LoW save the persistent multiplayer data for chapter 2 (fixes #2637),stevecotton,2018-03-11 23:01:15+00:00,2018-03-12 02:50:12+00:00,{},"In multiplayer mode, the LoW campaign has multiple start points, and some
persistent storage that stores the characters at the end of a chapter, so that
a new game starting from the next chapter starts with those stats.

The data for chapter 2 wasn't saved, because the campaign tried to create it in
a cutscene scenario that doesn't have the expected sides."
174236100,"Change more mentions of ""Shadow Master"" to ""shadowm""",stevecotton,2018-03-11 18:55:02+00:00,2018-03-11 21:25:41+00:00,{},"The one that needs a two-word name changes to Shikadi_Queen instead.

Was code-reviewing LoW, and spotted the comment for the RANDOM_PLACEMENT macro.
I also checked if that could be replaced with the core SCATTER_UNITS macro, but
SCATTER_UNITS seems to be overcomplex for the case of placing a single unit."
174233265,Lua API reorganization,CelticMinstrel,2018-03-11 17:56:31+00:00,2018-11-16 02:06:57+00:00,{'Lua API': 1},"This continues work on the Lua API reorganization as proposed [on the wiki](https://wiki.wesnoth.org/LuaWML/Reorganization). I don't necessarily expect it to be merged for 1.14; it would be totally fine if it were left until post-1.14. However, it shouldn't cause any compatibility problems (with one caveat) since it's merely adding new access points to existing functions. The deprecations are all level 1 as well, so they should have no visible effect unless someone cranks up the deprecation log level.

I also rewrote some helper functions to not use intermediate WML variables. I haven't tested these rewrites, so if we _do_ merge this for 1.14, we should revert the rewrites. That doesn't mean reverting the rewrite commits though, as what I did was rewrite them and then copy that rewritten version to _core.lua_; so, reverting them would mean copying the old version into _core.lua_ instead."
174233179,Fixed Xcode Project,hrubymar10,2018-03-11 17:54:36+00:00,2018-03-11 17:58:44+00:00,{},
174215352,Fix for DEBUG_WINDOW_LAYOUT_GRAPHS macro,hrubymar10,2018-03-11 10:57:18+00:00,2018-03-11 15:51:14+00:00,{},With big help from @jyrkive and @Vultraz
174189543,make [cancel_action] work in attack related events,gfgtdf,2018-03-10 21:04:47+00:00,2018-03-11 17:19:35+00:00,{},"as title says, not sure if this is good for 1.14. But i think it's a rather small and harmless change, so i'm making a pr"
174182050,Fix 2615,gfgtdf,2018-03-10 18:09:53+00:00,2018-03-11 06:37:35+00:00,{},
174174699,make sure units are always stored in unit_ptr ,gfgtdf,2018-03-10 15:22:04+00:00,2018-03-11 06:37:49+00:00,{},
174153319,campaignd: Set port allocation for version 1.14,irydacea,2018-03-10 04:42:15+00:00,2018-03-18 06:25:24+00:00,"{'Blocker: New Stable': 1, 'Add-ons': 1, 'Stable 1.14': 1}",**Do NOT merge until right before tagging RC 1.**
173997069,help messages fix,AncientLich,2018-03-09 12:47:26+00:00,2018-03-09 19:31:06+00:00,{},"This new ""release"" of wmlxgettext will only contain minor changes:
- fixed some help text messages (--help option).
- the help message will not show anymore the --DMode option, wich is now hidden. This option flag, infact, does nothing useful for an end-user, and listing it and explaing what it does could be only confusing for the end-user. A (very) brief explaination of what --DMode does is now moved from the help message to the source comment.
- wmlxgettext --version is changed (to 2008.03.09) even if the changes are very very minimal."
173695774,Update wesnoth.cbp,newfrenchy83,2018-03-08 10:16:19+00:00,2018-03-08 12:31:30+00:00,{},"And sorry for tabulation but i can,t correct that myself"
173548312,Add missing scenario-story.cfg in data,hrubymar10,2018-03-07 19:19:45+00:00,2018-03-07 19:59:53+00:00,{},
173392109,Travis improvements,Pentarctagon,2018-03-07 09:16:13+00:00,2018-03-08 13:40:06+00:00,{},"A few minor travis cleanups/improvements.

As far as LTO goes, it couldn't actually be enabled yet due to causing build timeouts and also the boost unit tests fail with c++14, but now the switch is there at least."
173318845,Fix Xcode Project after 078f61c,hrubymar10,2018-03-07 00:12:17+00:00,2018-03-07 07:01:46+00:00,{},
173288185,fix no_leader having no effect,gfgtdf,2018-03-06 21:36:09+00:00,2018-03-07 11:35:27+00:00,{},"it previously only worked if both leader_lock and no_leader were set to yes.

from looking at the code i wonder what currently is the point of no_leader at all. I think no type= attribute together with leader_lock=yes should have the same effect? 

#2604"
173282722,don't generate [side]s if the [multiplayer] has at least one [side] defined,gfgtdf,2018-03-06 21:13:20+00:00,2018-03-09 18:56:54+00:00,{},"as suggested in #2604 this prevents the engine form adding more [side]s if the scenario has at least one [side] defined. The usecase given in #2604 is that one migth for example want to reuse one map with 6 starting positions in multiple different [multiplayer] tags, one with 6 sides and one with 3 sides.

But there might also be usecases where the old bahviour is helpful, so i'm leaving this open for now."
173189737,Upgrade and improve Blowfish password hashing (bcrypt),GregoryLundberg,2018-03-06 15:22:09+00:00,2018-03-14 00:58:45+00:00,"{'Bug': 1, 'Blocker: New Stable': 1, 'MP': 1, 'Network': 1, 'Security': 1}","Primary phases:

- [x] Switch upstream origin for crypt_blowfish.[ch] to PHP for compatibility
- [x] Use cryptographic-strength random numbers for password nonce

---

The reference implementation for crypt_blowfish is at OpenWall. PHP, however, has made a few minor changes to support their legacy use of short password salts. Strict comparison shows PHP's other changes are noise (accidental change of copyright year and whitespace changes in comments). We should track PHP's changed version because we're more concerned about compatibility with PHP than strict tracking of the reference implementation.

PHP (and crypt_blowfish) support four versions of the hashing function. In actual use, we should only every see $2b$ and $2y$ (they are identical except for the version letter). But users doing their own authentication database might still use $2a$ or even $2x$ (which are $2a$ hashes known to have a sign-extension bug).

None of these changes have an operational effect. They simply improve and harden the password handling. The only observable effect is the increased size of the password nonce.

---

edited to eliminate replacement of RC4 local password storage, and replacement of add-on server MD5 password hashing."
173028022,NR Fixes,sigurdfdragon,2018-03-06 00:41:35+00:00,2018-03-08 00:51:57+00:00,{},"Commits in here fix 3 of 4 items in #2569 (the other appears unreproducible on master)

Also, note that the strings added are all duplicates of existing strings in the campaign, so not a string freeze violation.

Mostly posted here as a heads-up

I'll merge this in a day or two when I add changelog entries.
"
172766566,defense animation for Quenoth Warrior (will add Champion later),doofus-01,2018-03-05 03:30:13+00:00,2018-03-18 02:06:16+00:00,"{'Campaign (any)': 1, 'Graphics': 1}",
172744729,Attempt to fix suspected race condition when running MP tests.,Pentarctagon,2018-03-04 22:10:37+00:00,2018-03-05 04:49:47+00:00,{},"Currently the MP unit tests will randomly fail due to one of the two background wesnoth instances failing video initialization.  All unit tests require the display server to be initialized however, or they fail with the same error as the MP tests sometimes fail with.  However, the MP tests are the only tests to randomly fail due to video initialization, while for the same travis job the WML unit tests (which run before) and the boost unit tests (which run after) are still able to be successfully completed.

Therefore, the video initialization failures are not entirely random, and the MP tests are also the only tests that experience this failure while also being the only tests that have more than one instance of wesnoth running simultaneously.

tl;dr: the attempted solution here is to sleep for 5 seconds between starting background processes in the mp unit test script.

Also removes starting the display server prior outside of the docker container, since that's not needed anymore.

---

Example of MP test failure: https://travis-ci.org/wesnoth/wesnoth/jobs/345776363#L2276-L2282
Example of what happens for non-MP tests when the display server isn't started: https://travis-ci.org/Pentarctagon/wesnoth/jobs/348985371#L1138"
172734536,campaignd: Add support for free-form tags on add-ons,irydacea,2018-03-04 18:54:50+00:00,2018-03-06 02:00:47+00:00,"{'Enhancement': 1, 'UI': 1, 'Add-ons': 1}","This adds a `tags=` attribute to the pbl WML that can be used to specify comma-separated tags to let users filter on them on the Add-ons Manager.

We don't do anything fancy with the tags at the moment since they can be matched with the existing filter algorithm without any changes, with the caveat that the word separator the filter box uses is whitespace instead of commas -- meaning that to match multiple tags they must be specified with spaces between them, in any order, and that pasting the tags from the WML into the filter box will not yield a match as some people might expect.

There is also no UI for the tags right now other than the filter box, so they are little more than an implementation detail hidden from the user.

See also issue #2565."
172709329,Don't source steps/script.sh.,Pentarctagon,2018-03-04 08:50:54+00:00,2018-03-04 21:48:01+00:00,{},"Travis runs all commands in .travis.yml in its own wrapper script, so by sourcing steps/script.sh and then using exit explicitly, it resulted in the entire travis wrapper immediately terminating.  With steps/script.sh no longer sourced, using exit works as expected again, and only exits steps/script.sh rather than quitting everything.

With that addressed, it's also possible to re-add printing the ccache statistics after the build ends.

---

An example of when it quit immediately: https://travis-ci.org/wesnoth/wesnoth/jobs/348757536
A test with this fix where I hard-coded it to exit with 0: https://travis-ci.org/Pentarctagon/wesnoth/jobs/348801187
And another test hard-coded to exit with 65(xcodebuild's compile failure exit code): https://travis-ci.org/Pentarctagon/wesnoth/jobs/348805244"
172697154,LoW S14 Objectives and edit repetitive dialog (ok for string freeze),stevecotton,2018-03-04 01:31:38+00:00,2018-03-17 18:53:26+00:00,{},"Objectives: note that the death of Galtrid is a losing condition

Dialog: the following conversation happened on both turn 1 and turn 9.
Having 6 repeated messages in a row gave a strong sense of deja vu,
and I thought that a bug had repeated an event. This commit cuts the
repetition.

* Elf: ""Kalenz! We come to fight beside you!""
* Kalenz: ""Where is the rest of the elvish army? ...
* Elf: ""The Great Council has decided it was too risky ...
* Landar: ""That is well! If the Ka’lian is too fearful or blind ...
* Cleodil: ""It is not well that we have become so divided as this.""
* Kalenz: ""No, it is not. But ..."
172693851,Update Fix_Xcode_Dependencies,hrubymar10,2018-03-03 23:49:22+00:00,2018-03-04 00:36:51+00:00,{},Update SDL2 to 2.0.8 and SDL2_image to 2.0.3
172686016,Fix for failed ccache builds being considered successful.,Pentarctagon,2018-03-03 20:31:49+00:00,2018-03-03 22:46:07+00:00,{},"Travis looks at the return code of the final command run, and since printing the ccache statistics never fails, building would never be considered as failing."
172648772,"[UtBS, WIP] Initial pass at Sun Singer animations",doofus-01,2018-03-03 04:01:46+00:00,2018-03-17 17:50:17+00:00,"{'Campaign (any)': 1, 'Graphics': 1}","Don't commit, this is just a first pass, but I'd still like to see what anyone who cares thinks of the flame and the base sprite.  I tried not to change the design too much.  Ideally, the flame animation can be more generalized than it is now.  If the base looks OK, I can do flying and defense animations."
172492052,fix #2571,gfgtdf,2018-03-02 12:31:17+00:00,2018-03-02 14:41:35+00:00,{},
172453603,Issue 2564,Pentarctagon,2018-03-02 09:11:15+00:00,2018-03-02 19:55:24+00:00,{'Building': 1},Fixes #2564.  Also organizes the travis scripts a bit and makes scons' mysql handling more sensible.
172301945,fix continue play in replays of mp games #2522,gfgtdf,2018-03-01 17:26:58+00:00,2018-03-01 17:47:31+00:00,{},
171778753,gui2/lua_interpreter: Maintain a raw console log for copy-to-clipboard,irydacea,2018-02-27 20:42:42+00:00,2018-02-28 14:26:23+00:00,{'UI': 1},"Fixes #2434.

Not much to say here since the code is pretty self-explanatory. The regular log is still needed since the UI needs to display text with markup enabled."
171280141,Implement validation of the core game config WML,CelticMinstrel,2018-02-26 04:27:39+00:00,2018-11-11 18:53:52+00:00,{'Ready for testing': 1},"The schema validator has been around for who knows how long, but it was only ever used for the GUI2 WML. I decided it would be useful to extend it to work for the game data WML as well. This commit adds some additional features to the schema validator as well as creating a schema definition that covers about 90% of the core game data structure.

In other words, it's not done yet, but I'm opening it up for preliminary review.

Through this work I uncovered several errors which I will eventually push fixes for. For one example, a Dwarvish Thunderer who killed an enemy with his blade will then blow the smoke off of his firearm, which is not the intent of that animation."
171262763,more defense animations for the Quenoth,doofus-01,2018-02-26 00:54:27+00:00,2018-02-28 18:11:36+00:00,"{'Campaign (any)': 1, 'Graphics': 1}",
171244490,LoW Prevent the 'generic loyal' last breath triggering for main chars,stevecotton,2018-02-25 18:40:51+00:00,2018-02-26 19:40:44+00:00,{},"For example, when Kalenz died he'd say to himself ""I grieve that
I have failed you, my lord Kalenz..."" followed by ""Farewell Kalenz"".
I'm sure that I've already seen this bug reported somewhere, but
can't find it now.

Also use speaker= instead of id=."
171229879,LoW Some loyal units were missing the IS_LOYAL overlay,stevecotton,2018-02-25 13:20:58+00:00,2018-02-25 16:01:33+00:00,{},
171212137,defense animations for Quenoth Elves,doofus-01,2018-02-25 04:18:02+00:00,2018-02-25 11:59:27+00:00,"{'Campaign (any)': 1, 'Graphics': 1}","Using the two-frame macro.  Fighter and scout only for now, gotta start somewhere.  I'll try to get as many of the elves in here as I can, but I doubt I'll get them all done before BfW 1.14 is out."
171206558,Hide minor translations (<80%) from language selection menu.,singalen,2018-02-25 01:15:02+00:00,2018-03-14 02:51:37+00:00,{},"In place of #2466, now pure Python, Python 2-compatible, to make things easier for Windows users.
Still needs to be integrated into `po_update` procedure, I'm unsure how to do it right."
171201324,fix reset_gamestate_exception not inheriting from std::exception,gfgtdf,2018-02-24 22:38:08+00:00,2018-02-24 23:11:02+00:00,{},pr to make sur ethis doesn't contain any syntax errors.
171185628,Moves the ccache clang wrapper scripts to utils/travis/.,Pentarctagon,2018-02-24 16:26:53+00:00,2018-02-24 16:56:07+00:00,{},"Also clears the ccache statistics after printing them. This means the hit/miss count will be shown per run, rather than cumulatively."
171182286,Don't consider input events as keypresses without release in between,jyrkive,2018-02-24 15:04:59+00:00,2018-02-27 17:04:51+00:00,{},"When the player holds a key down, the OS generates multiple key press and text input events. We can't assume that every such event is a real key press; instead, we need to track whether there has been a key up event since we last sent a key press event.

This PR fixes bug #1711.

I also moved `hotkey::execute_command()` into the `hotkey::command_executor` class, and renamed the existing member function of same name to `do_execute_command()`. I did that because the `command_executor` class was the best place to store the ""press event already sent"" flag."
171132167,Enable use of ccache for xcode build.,Pentarctagon,2018-02-23 22:32:29+00:00,2018-02-23 23:51:09+00:00,{},"Also sets it to use clang rather than gcc.

---

[Without cache](https://travis-ci.org/Pentarctagon/wesnoth/builds/345424715)
[With cache](https://travis-ci.org/Pentarctagon/wesnoth/builds/345439211)(best case scenario, no recompiling needed)

`CCACHE_MAXSIZE` is set to 2 GBs here, rather than the 200 MBs used for the cmake+ccache builds, because xcode's Release build contains the `-g` flag.  As a result, the size of ccache's cache (before travis compresses it) is [1.3 GBs](https://travis-ci.org/Pentarctagon/wesnoth/builds/345439211#L5902)."
171128490,Add support for data URIs as images,AI0867,2018-02-23 22:10:43+00:00,2018-02-26 15:33:26+00:00,{},"Add support for using a [Data URI](https://en.wikipedia.org/wiki/Data_URI_scheme) in place of a filename. Addresses #1098.

There are currently 2 test add-ons on the 1.13 server using this for their icons (1 along with an IPF)."
171003972,update wesnoth.cbp,newfrenchy83,2018-02-23 12:30:04+00:00,2018-02-23 12:32:30+00:00,{},
170980506,Update wesnoth.cbp,newfrenchy83,2018-02-23 10:27:29+00:00,2018-02-23 10:33:48+00:00,{},Sorry for the tab error but i cannot corrected this myself. Smartphone in extern area by -5°C
170801060,Updated README.md for Xcode project,hrubymar10,2018-02-22 16:33:21+00:00,2018-02-22 17:10:01+00:00,{},"I discussed it with @ancestral .

New `README.md` describes how to use `Fix_Xcode_Dependencies` script or how to make widely compatible Wesnoth RELEASE using MCS (MacCompileStuff)."
170757517,Fixed Xcode project,hrubymar10,2018-02-22 13:59:21+00:00,2018-02-22 14:46:44+00:00,{},Please wait for travis build before merging
170481992,Fix missing explicit keyword [WIP],GregoryLundberg,2018-02-21 14:17:07+00:00,2018-03-22 14:23:13+00:00,{},"cppcheck (via Codacy) reports several hundred instances of the following class of error:
```
Class 'classname' has a constructor with 1 argument that is not explicit.
```

Failing to use the explicit keyword can lead to subtle, hard-to-find, errors.

This Pull Request is broken down into several commits.

The first adds the explicit keyword to all constructors where it has no other effect. These are perfectly safe and all we're doing is noting that we no longer want implicit instantiation of temporaries.

The remaining commits handle the changes constructor-by-constructor, chasing down the effects. In most cases, the simplest fix is to actually use the temporary, but document it. For all of these, I am open to suggestions to simplify or improve the changes.

As a result of the full set of commits, here, we remain with one specific case I could not easily fix, and a class of cases which I have not looked at.

The general class is every use of the MAKE_ENUM macro. I question why we're using C in a C++ project, but we do. There are not that many places the macro is used, so eliminating it may be an option. My first pass, however, will be to adjust the macro to eliminate the issue.

My main problem is the specific case. This is in `src\config.hpp`, line 205:
```
const_child_iterator(const child_iterator &i): i_(i.i_) {}
```
This has several hundred downstream effects. All but a few may be eliminated by explicitly using a temporary object. The problem is `src\variable_info.cpp` and its headers `src\variable_info.hpp`, `src\variable_info_detail.hpp`, and `src\variable_info_private.hpp`. Specifically, in the private header I ran afoul of template type inference. I will be making another pass at it."
170371577,Fix deprecation spam,CelticMinstrel,2018-02-21 04:01:50+00:00,2018-03-05 02:21:34+00:00,{},"This fixes the deprecation spam in the log/console by piping it into a brand-new logdomain which by default doesn't output anything at all, effectively adding a new log level below ""error"".

~The fourth commit is unrelated and would ideally be either discarded or cherry-picked separately, though if the PR is rebased against master it wouldn't really matter.~ It has already been cherry-picked, thanks!"
170294841,disable unit advancement dialog for droided side,vgaming,2018-02-20 20:06:00+00:00,2018-02-20 20:07:32+00:00,{},fixes GH-1963
170139232,Touch-up for xcode build.,Pentarctagon,2018-02-20 09:32:03+00:00,2018-02-20 13:45:19+00:00,{},"This fixes the xcodebuild version error, since `gcc` is actual compiler being used, and gets rid of the `BUILDER` env variable since it was redundent with `TOOL`.

It also puts the xcode build first, since it is uncached and will likely run the longest - having the longest running build start last doesn't make a whole lot of sense.  That said, a quick google seems to indicate that xcode and ccache should be able to work together, so I'll probably poke at that this weekend.

If there are no objections, I'll merge this."
170092383,Don't assume unit is on the map when testing ability active,CelticMinstrel,2018-02-20 03:05:48+00:00,2018-03-05 05:10:01+00:00,{},"This refactors ability tests to use a passed-in unit instead of
searching for the unit on the map based on its location.

While it does fix #2247, I am not confident that this won't also
have some undesirable side-effects."
170074896,Code cleanups,Vultraz,2018-02-20 00:00:57+00:00,2018-02-20 02:54:53+00:00,{},
170023010,Add Xcode Travis build,hrubymar10,2018-02-19 17:56:24+00:00,2018-02-19 21:10:14+00:00,{},
169987721,Add missing pango dependence,hrubymar10,2018-02-19 15:19:30+00:00,2018-02-19 15:25:16+00:00,{},
169825500,Networked MP replay: move to end before returning to play mode (#2508),jyrkive,2018-02-18 11:10:54+00:00,2018-02-19 17:21:49+00:00,{},"This appears to fix an assertion failure I got while trying to reproduce #2508.

I'm not very familiar with MP code, and therefore I'd appreciate a code review before merging."
169748726,Use ccache with cmake on travis.,Pentarctagon,2018-02-16 23:21:42+00:00,2018-02-17 09:16:33+00:00,{},"This replaces the custom python script which manipulated various files' mtime with ccache for allowing cmake builds to not need full recompiles every travis run.

---

This supercedes #2506, and before merging the base travis image will need to be rebuilt with `ccache` rather than `python3`.  I'd also suggest clearing out all the existing caches that exist for master and any branches immediately before this gets merged.

ccache's max cache size I set to 200 MBs, from the default of 5 GBs, since when I compiled locally the ccache size didn't get above 100 MBs, so it didn't make sense to me to have it too much higher. A 5 GB cache would also take a fair amount of time to download.

I also set ccache to use a hash of the compiler to determine if it's changed, rather than mtime (which is the default), since when updating the docker image everything is installed from scratch which would invalidate ccache's cache.

---

As far as testing goes, I ran it through several builds:
- [The last good commit before the bad commit that caused the corrupted cache.](https://travis-ci.org/Pentarctagon/wesnoth/builds/342480279)
- [The bad commit.](https://travis-ci.org/Pentarctagon/wesnoth/builds/342500856)
- [An unrelated commit following the bad commit.](https://travis-ci.org/Pentarctagon/wesnoth/builds/342511869)
- [The fix for the bad commit.](https://travis-ci.org/Pentarctagon/wesnoth/builds/342526010) Previously this was where the cmake builds started getting the corrupt memory errors, however now both cmake and scons fail with the same unit test errors.
- [A subsequent, good build from a more recent commit.](https://travis-ci.org/Pentarctagon/wesnoth/builds/342536080)
- [A re-run of the above commit, to show the caching working.](https://travis-ci.org/Pentarctagon/wesnoth/builds/342558314)"
169304763,Fixes cmake's cache getting corrupted in certain situations.,Pentarctagon,2018-02-15 07:56:49+00:00,2018-02-16 23:19:12+00:00,{},"This adds functionality to check if a failed build used cmake, and if it did, clear out everything that was compiled during the failed run so that they will be treated as new and will be guaranteed to be rebuilt on the next run.

It also adds an inverted grep match on make to filter out the thousands of ""is newer than"" messages that can occasionally appear and clog up the log.

To verify that this did actually fix the issue, I re-ran the commits that originally caused the problem:
[The commit before the failed commit.](https://travis-ci.org/Pentarctagon/wesnoth/builds/341701475)
[The commit that failed.](https://travis-ci.org/Pentarctagon/wesnoth/builds/341706516)
[An unrelated commit that followed.](https://travis-ci.org/Pentarctagon/wesnoth/builds/341711673)
[The fix that caused the corrupted cache to corrupt memory](https://travis-ci.org/Pentarctagon/wesnoth/builds/341718261)(Check the raw log - I hadn't put the inverted grep match in, but the raw log shows that with the fix it fails by the same unit test error as scons did in the original commit) compared to the travis run of the [original commit](https://travis-ci.org/wesnoth/wesnoth/builds/340537853?utm_source=github_status&utm_medium=notification).

------

Alternatively, on failure `make clean` could be used along with deleting `build/cmake_mtime_crc.txt`, so a failure always triggers a full rebuild of everything."
169156817,Add missing files to Xcode project,hrubymar10,2018-02-14 16:24:45+00:00,2018-02-17 20:52:28+00:00,{},"Full message:
Add missing files to Xcode project and include system libraries as absolute path. Don't include system libraries into .app bundle, it is bad idea."
169070761,Update wesnoth.cbp,newfrenchy83,2018-02-14 10:24:21+00:00,2018-02-14 10:25:12+00:00,{},
168838806,Add a major_report option in [damage] in some case. for report attack will be like leadership or tod case,newfrenchy83,2018-02-13 13:02:23+00:00,2018-03-14 11:22:34+00:00,{},"In some addons, some [damage] simulate the time-of-day, i propose what the color in report can simulate an true tod or leadership influence for an attack only.
![simulate_tod](https://user-images.githubusercontent.com/31768074/36151138-739494f2-10c6-11e8-9849-3cf35f9649cf.png)
![simulate_leadership](https://user-images.githubusercontent.com/31768074/36151143-77a131cc-10c6-11e8-8820-e31b7c6f1ac8.png)
![simulate_without_leader](https://user-images.githubusercontent.com/31768074/36151147-7f4cf97e-10c6-11e8-8eb3-8db51731fbed.png)


"
168599469,addon_manager: allow uploading . dir,vgaming,2018-02-12 14:54:49+00:00,2018-02-20 11:41:30+00:00,{},fixes GH-2494
168482622,addon_manager: allow overriding keys,vgaming,2018-02-11 23:59:50+00:00,2018-02-14 19:49:44+00:00,{},"allow overriding keys in _server.pbl

Example usage:
```
wesnoth_addon_manager \
	--port 1.13.x \
	--upload ~/.local/share/wesnoth/1.13/data/add-ons/example \
	--pbl-override version ""$(git describe --tags)"" \
	--pbl-override description ""$(cat avoid_copy_paste_with_WML)"" \
	--pbl-override passphrase ""in contrary to server.pbl, this is secret""
```

Downsides: user has to be aware that specifying
passwords as CLI arguments is not safe in multi-user environment.
If we're really-really serious about it, we should parse
values from environment variables then..
I wouldn't bother though.

fixes GH-2485

EDIT: fixed typo."
168479555,addon_manager: fix default ign file,vgaming,2018-02-11 22:53:14+00:00,2018-02-11 23:11:27+00:00,{},
168477757,Update the description of orcs to include goblins,stevecotton,2018-02-11 22:16:56+00:00,2018-02-12 01:23:48+00:00,{},@CelticMinstrel an addition for your #2478 
168477363,addon_manager: simplify usage,vgaming,2018-02-11 22:09:13+00:00,2018-02-12 20:00:57+00:00,{},"To remove an add-on, you now have to use:
--remove ADD_ON PASSPHRASE
instead of:
--password 123 --remove NAME

Also, this commit fixes the badly documented --password field.
It could previously be read as it can be applied to any operation, not only removal.
But in fact it could only be used for removal.

Fixes GH-2445"
168445972,Remove duplicated headers search path,hrubymar10,2018-02-11 09:58:36+00:00,2018-02-11 10:06:21+00:00,{},`$(PROJECT_DIR)/Headers` is included in `System Header Search Path` so this is just redundant duplicate.
168436477,revert b98cbe31cc861cc10a326ba14c7ac0a5e7b637d8,GregoryLundberg,2018-02-11 04:52:38+00:00,2018-02-11 23:45:33+00:00,{},"While apparently an excellent idea, the change caused a race condition to appear when using LTO."
168435496,Fixes event scrolling per issue #2218,ancestral,2018-02-11 04:14:20+00:00,2018-02-11 04:26:00+00:00,{},"UNIXes (namely, Linux and other non-Windows, non-macOS) were scrolling horizontally the incorrect direction on the game map. This addresses a problem that was introduced in #1754. Windows and macOS keep the new behavior where other platforms keep the original behavior."
168435441,"CC should be checked for gcc, not CXX.",Pentarctagon,2018-02-11 04:11:38+00:00,2018-02-11 08:46:12+00:00,{},
168434346,Tweak the race descriptions of orcs and goblins,CelticMinstrel,2018-02-11 03:34:04+00:00,2018-02-12 05:03:15+00:00,{},There was some questionable wording which could be easily misunderstood.
168429763,campaignd: Reject empty passphrases,irydacea,2018-02-11 01:01:03+00:00,2018-02-11 12:22:37+00:00,"{'Enhancement': 1, 'Add-ons': 1}","Fixes issue #2444.

Clients may send an empty passphrase, especially if they do not do as the mainline client and generate a random one to substitute in the .pbl. An empty string is still hashable, but the server is really not supposed
to allow an empty passphrase so we should just reject those. It's also a good warning sign against broken clients -- like wesnoth_addon_manager right now."
168396572,Implement workaround for cmake using mtime to determine what to rebuild.,Pentarctagon,2018-02-10 10:40:58+00:00,2018-02-11 23:47:43+00:00,{},Example of the best case scenario(no changes) [before](https://travis-ci.org/Pentarctagon/wesnoth/builds/339779456) the cmake cache is created and then [after](https://travis-ci.org/Pentarctagon/wesnoth/builds/339797570).
168395691,Reorder names after last PR,hrubymar10,2018-02-10 10:13:10+00:00,2018-02-10 10:13:40+00:00,{},I forgot reorder names before so I did it now
168169248,Fixes LTO/PGO options not being used when ccache is enabled.,Pentarctagon,2018-02-09 07:18:07+00:00,2018-02-09 17:33:48+00:00,{},"When ccache is enabled, env[""CC""] becomes - `'CC': '$CCACHE gcc'`"
168151308,Script to generate a WML with translations % status,singalen,2018-02-09 04:30:01+00:00,2018-02-21 19:43:14+00:00,{},"Now this can be run as a part of the build and generate a WML.
Functionally repeats https://github.com/wesnoth/website/blob/master/gettext.wesnoth.org/includes/functions.php#L57

Intended for use with #1278 (""_Translations below [...] 80% for the main`po` file [...] shouldn't appear in the language selection menu_"").

Update `po_stat.sh` to only read main `wesnoth` `.po`, or to sum up `wesnoth`, `wesnoth-lib`, `wesnoth-tutorial` and `wesnoth-units`; maybe `wesnoth-multiplayer` and `wesnoth-tb` and `wesnoth-tsg` too."
168044384,Fixed WML parser not properly handling unquoted keys with variables (…,Vultraz,2018-02-08 17:56:44+00:00,2018-02-08 19:21:35+00:00,{},"…fixes #1236)

In cases such as `name=turn $var`, the key value would get parsed and serialized as
`turn$var`. The reason for this was that that string was broken down into 3 tokens:
""turn"", ""$"", and ""var"". parser::parse_variable() handled these tokens, and the issue
was that ""$"" was considered a ""misc"" token instead of a string one. In cases where
two string tokens were added consecutively, a space would be added between them
(manually added spacing was not preserved). Since ""$"" did not count as a string, the
space was not added, which resulted in ""turn$var"". To fix that, I made the tokenizer
consider ""$"" a string token, so the spacing is correctly preserved.

For the record, despite what the bug report above says, wrapping the value in quotes
did work in lieu of this fix."
167935192,codespell fixes to /src,matthiaskrgr,2018-02-08 10:43:51+00:00,2018-02-08 10:54:11+00:00,{},
167916479,Update about.cfg,hrubymar10,2018-02-08 09:25:00+00:00,2018-02-08 09:28:40+00:00,{},Update for `about.cfg` for fulfill @kallaballa 's wish https://github.com/wesnoth/wesnoth/commit/61aad57dbd80bb2565f289c26fd1c953ed1b1179
167851435,Fix 2p - Clearing Gushes team names,catagent101,2018-02-08 01:00:41+00:00,2018-02-09 14:58:53+00:00,{},"On this map, side 1 starts at the bottom, while side 2 starts at the top. The naming of the teams assumed the opposite. Another check mark on issue #2453."
167345909,Enables travis to cache scons' build/ directory.,Pentarctagon,2018-02-06 08:17:29+00:00,2018-02-09 15:05:27+00:00,{},"Scons makes this simple - all the object files are placed in `build/release/`, and the `build/sconsign.dblite` file keeps track of the md5 sum of each file built. This then means all that's necessary to prevent scons from doing a full rebuild each time is to cache the `build/` directory.

Keep in mind however, that this does not make the actual compiling faster, it just means that most of the time fewer things will need to be compiled. Any change that would trigger a rebuild of most or all of the source files will still take just as long as before.

---

The (c)make builds do not benefit from this partially because they put their compiled object files into a different directory(so they aren't being picked up right now anyways), but also because to my understanding git does not preserve the last modified timestamp when cloning and `make` uses the last modified timestamp to determine when it needs to recompile something.  It wouldn't be impossible to get this same sort of speedup with the (c)make builds - there are custom scripts and things like mtime_cache that would be able to restore the last modified timestamp - but it would also be a fair amount easier to just use scons on travis for all builds instead.

In any case though, as an example, [this](https://travis-ci.org/Pentarctagon/wesnoth/builds/337837617) is the time taken when there is no cache for a push, and then [this](https://travis-ci.org/Pentarctagon/wesnoth/builds/337879609) is the time taken for the next push(triggered from within travis, so it would represent a best case scenario of there being no C++ changes)."
167231722,Fixed Xcode project,hrubymar10,2018-02-05 19:21:04+00:00,2018-02-11 03:37:44+00:00,{},"This PR include:

- fixed `unit_tests` target in Xcode project
- fixed project itself

Xcode project required OpenSSL 1.1 before but libraries path in project targeted OpenSSL 1.0 which caused version mismatch. I rework it to OpenSSL 1.1 so libcrypto.dylib and OpenSSL headers in mac compile stuff must be updated to make it work.

This project works for me but I asked @singalen to test this project before merging."
167192196,Update wesnoth.cbp,newfrenchy83,2018-02-05 16:32:27+00:00,2018-02-05 16:55:29+00:00,{},
167165029,Codespell data and doc dirs,matthiaskrgr,2018-02-05 14:55:15+00:00,2018-02-06 12:03:08+00:00,{},"run codespell on data and doc directory (src is in progress)
https://github.com/lucasdemarchi/codespell"
167125035,Update Xcode project,hrubymar10,2018-02-05 11:54:34+00:00,2018-02-05 11:55:02+00:00,{},
167028008,Downgrade Xcode project back to C++11,hrubymar10,2018-02-04 20:26:14+00:00,2018-02-04 20:30:31+00:00,{},Downgrading Xcode project to C++11 until 1.14 release
167019183,Fix and Upgrade Xcode project,hrubymar10,2018-02-04 17:03:40+00:00,2018-02-04 17:05:17+00:00,{},
166997375,Add real name to about.cfg,hrubymar10,2018-02-04 06:32:01+00:00,2018-02-04 06:36:42+00:00,{},Add my real name
166943738,Make [cancel_action] set_action_canceled (fixes #2430),stevecotton,2018-02-03 03:22:32+00:00,2018-02-03 03:25:09+00:00,{},It was calling the getter instead of the setter.
166939960,Fix the Elvish Outrider description,catagent101,2018-02-03 01:59:11+00:00,2018-02-04 00:51:48+00:00,{},"There are at least three units that do a better job, all of them in the Dunefolk faction, and one possible unit in the form of Pelias from THoT (unless he has a side job as a bowman)."
166936069,Renames the Dunefolk(formerly Khalifate) units based on forum discuss…,Pentarctagon,2018-02-03 01:00:23+00:00,2018-02-04 00:46:51+00:00,{},"…ions.

See this thread, along with a few linked within:
https://forums.wesnoth.org/viewtopic.php?f=12&t=47704

The purpose of this is both to:
a) Make the unit names more descriptive, so new players especially will have an easier time learning them and knowing what they do.
b) Make them eligible for translation, like the units of other factions are."
166783393,Update Copyright year,hrubymar10,2018-02-02 11:49:44+00:00,2018-02-02 11:50:49+00:00,{},
166381767,core: Fix grammar and punctuation,jostephd,2018-01-31 21:32:17+00:00,2018-02-03 03:04:43+00:00,"{'Enhancement': 1, 'Ready for testing': 1}",Split from #2390 at @GregoryLundberg's request.
165843936,MP: Simplify Dunefolk faction and era description,sigurdfdragon,2018-01-29 23:09:37+00:00,2018-01-29 23:16:28+00:00,{},"Other factions lack magic users, so mentioning here it is superfluous
information. Also associated with the previous identity of the faction.

Posting here for comments."
165662587,update codeblock projectfilrs to c++14,newfrenchy83,2018-01-29 10:12:13+00:00,2018-01-29 10:13:25+00:00,{},"Now what tdmgcc is replced by mingw64, the project can support compile in c++14"
165616947,[UtBS] - New Quenoth sprites,doofus-01,2018-01-29 05:04:25+00:00,2018-02-10 12:12:19+00:00,{},"Initial commit for quenoth fighter-line sprites.  Level 1 & 2 only, so far.  They might be a bit too small at the moment."
165615277,Fix bug introduced in code cleanup commit 5e0c3056d,fluffbeast,2018-01-29 04:43:08+00:00,2018-01-29 04:45:53+00:00,{},"The previous cleanup didn't handle the case when w or h is zero,
but resize_mode is not stretch."
165607764,Made display class no longer inherit from filter_context,Vultraz,2018-01-29 03:09:49+00:00,2018-01-29 04:54:47+00:00,{},"The only function that display meaningfully implemented was get_disp_context. It did implement
get_tod_man, but only meaningfully in its two derived classes (it returned the result of
resources::tod_manager in display). Additionally, the long-ass comment in the header stated the
display class should *not* inherit from filter_context.

Upon further investigation, I found that there were only two places where the display class was
passed to unit_filter. All others passed resources::filter_con. The editor_display class was also
assigned to resources::filter_con in editor::context_manager. So, I removed the second filter_context
argument from unit_filter and initialized it from resources::filter_con in all cases.

unit_filter only used the filter_context to get its display_context and the unit_map within anyway.
When using display::get_disp_context in-game, that would return a game_board object. Using
resources::filter_con in the same context would return the game_state object that owned the
aforementioned game_board, and calling get_disp_context on that game_state would return the board
as well. So we end up in the same place.

To be complete, I also made editor::context_manager inherit from filter_context. It makes much more
sense, since it can nicely implement 2/4 of the fc functions. It also ensures resources::filter_con
is valid in the editor, in case it's needed. I'm not 100% sure it is, but since it was assigned
before (to editor_display), it's very likely.

Another side effect of the above is that get_tod_man is now implemented in a more apropos class
in the editor. Essentially, editor_display (where it was implemented before by reaching into the
context_manager) holds an editor_controller which holds a context_manager (where it's now implemented).
It wasn't even really needed in editor_display and was only called once.

Similarly, get_tod_man has been removed from game_display. Again, it was only present to ""properly""
implement the function in display, which only existed because display inherited from filter_context.
And get_tod_man wasn't even needed in display, game_display, or editor_display (save for the one
aforementioned call)!!! AND in game_display, it simply dereferenced a pointer to the *actual* ToD
manager in the game_state class, WHICH IN AND OF ITSELF INHERITS FROM FILTER_CONTEXT!!!

I have removed the tod_manager pointer in game_display and replaced its use with resources::tod_manager,
which in the context of the game (where game_display) would be use, point to the same thing the class
pointer did. I suppose I could have left it, since I'm trying to remove/improve the use of the
resources pointers, but I felt it better to decouple the two classes (game_display and game_state)
slightly, especially since its main purpose for existing (overriding display::get_tod_man) no longer
exists.

Finally, some of the instances where a unit_filter object is created had to be changed to use brace
initialization or else the build failed. @celticminstrel tells me this is because of some ""most vexing
parse"" issue, whatever that means.

Some formatting and virtual/override specifiers were also applied/added.

*huffs*"
165592387,"tips: add tips that villages can be lures, and losses are necessary",stevecotton,2018-01-28 22:52:20+00:00,2018-02-03 13:24:42+00:00,{},"From oaq's post https://forums.wesnoth.org/viewtopic.php?f=3&t=47702

Kai Laudiss is Kai Krellis' dad, and the quote would be 3 years
before Dead Water."
165583916,Enable LTO by default.,Pentarctagon,2018-01-28 19:52:24+00:00,2018-02-02 06:56:09+00:00,{},"LTO for Windows is disabled for now, as TDM-GCC does not work well with it.
LTO for Travis is also disabled, due to the extra time linking with LTO takes.

---

From the Discord discussion, @loonycyborg is planning to look into using a different compiler starting with 1.15, so at that point LTO might be able to be enabled for the Windows releases as well.

As for Travis, short of going to the paid version of the service, which has a 120 minute build time limit compared to the free version's 50 minute limit, there just isn't enough time to be able to enable LTO on travis builds."
165580265,Remove checking for a different SDL2 minimum version.,Pentarctagon,2018-01-28 18:30:58+00:00,2018-01-28 18:53:27+00:00,{},"I removed this from scons a while ago, though it looks like I forgot or didn't notice that cmake does the same."
165577056,Make wesnoth.unit_types a real table,jyrkive,2018-01-28 17:17:57+00:00,2020-09-12 01:14:08+00:00,{'Lua API': 1},"This is a fix for bug #2339. If `wesnoth.unit_types` is a real Lua table, it isn't any slower to iterate than any normal table once it has been generated.

The time to generate the table is quite significant, though, especially with Ageless Era active. My most recent measurement shows 1418 ms with AE activated, i.e. 580 microseconds per unit type. (This is faster than in my older measurements because I upgraded to faster hardware in between.) Therefore the entire table is generated lazily on first access: there is no performance penalty to level loading if UMC doesn't access `wesnoth.unit_types`. And if it does, all subsequent access will be fast.

For reference, @vgaming 's testing on master showed that *iterating* `wesnoth.unit_types` took 38 seconds with AE active, i.e. 14 milliseconds per unit type, or 24 times longer. And it didn't get any faster in subsequent rounds, either.

With only mainline units active, generating the table in this branch takes about 100 ms in total.

This implementation is now theoretically complete, but I haven't tested it yet."
165279478,Align default quit hot-key with conventions (fixes #2397),Wedge009,2018-01-26 02:47:49+00:00,2018-01-26 03:12:04+00:00,{},Switch quit to title-screen from Ctrl+Q to Ctrl+W (OSX already uses Cmd+W) and quit-to-desktop from Ctrl+Shift+Q to Ctrl+Q.
164695944,Make AI manager a singleton,jyrkive,2018-01-23 21:35:26+00:00,2018-01-24 03:29:02+00:00,{},"The AI keeps references to the Lua state, and because it's global, it can outlive Lua. That can result in dangling references: such a reference is the cause of bug #2372.

The best way to avoid it is to ensure that game_state, which already owns the Lua state, also owns the AI. That way, the AI will be destroyed before the Lua state.

This is obviously a quite big change, and for that reason I'm submitting it as a pull request instead of pushing it directly to master."
164290434,remove executable flag from images,vgaming,2018-01-22 12:10:09+00:00,2018-01-22 12:11:15+00:00,{},
164201956,Have cmake not copy over everything for server-only installs.,Pentarctagon,2018-01-21 23:41:14+00:00,2018-01-23 19:26:35+00:00,{},Fixes #2392.  This PR prevents cmake from copying over all data/sounds/images when doing a server-only installation.
164187587,Hide 'Rails' and 'Fake Shroud' terrains in the unit help pages when impassable,jostephd,2018-01-21 18:21:08+00:00,2018-01-22 00:54:10+00:00,{'Enhancement': 1},Fixes #1399. Supersedes #536.
164186678,English fixes to HttT,jostephd,2018-01-21 17:58:18+00:00,2018-02-03 14:00:34+00:00,"{'Enhancement': 1, 'Ready for testing': 1}","The new text in Bay of Pearls is copied from elsewhere in the same scenario. Added it there in order to make Konrad's next line (""I must do this?"") flow better."
164184148,Rename the Khalid's shield bash to pommel strike.,Pentarctagon,2018-01-21 16:58:54+00:00,2018-01-22 01:04:43+00:00,{},"The sprite has two swords, not a shield."
164168321,fix code problems found by luacheck,vgaming,2018-01-21 10:13:53+00:00,2018-01-23 19:35:04+00:00,{},"Second iteration of the process, now handling data/lua/wml/*.lua

luacheck command used to find bugs:
`luacheck ./*.lua --globals wesnoth wml --codes --ignore 542 213`
Additionally, error code 211 (unused variables) could be ignored,
as using underscore convention `_` is controversial in
wesnoth ( see https://github.com/wesnoth/wesnoth/pull/2380#discussion_r162519341 )

Actual bugs found:
* items.lua, access of global `write_name` instead of local `cfg.write_name`
* kill.lua, typo `primary_unit` -> `primary`
* bad code style: global `i` instead of local `i`
  (would conflict with 3-rd party code if it would use global `i`, too)"
164152971,Made more use of std::isalnum and std::isalpha (std::locale versions),Vultraz,2018-01-21 00:29:31+00:00,2018-02-02 06:42:07+00:00,{},
164126954,update wesnoth codeblock projectfiles,newfrenchy83,2018-01-20 13:11:37+00:00,2018-01-20 15:04:39+00:00,{},"
[dll.zip](https://github.com/wesnoth/wesnoth/files/1648822/dll.zip)
[SDL2-devel-2.0.7-mingw32.zip](https://github.com/wesnoth/wesnoth/files/1648823/SDL2-devel-2.0.7-mingw32.zip)
i post also an the dll for sart .exe compiled with mingw64(32bits) and sdl 2.0.7 in hope what Cb files will be updated

"
164126503,Update wesnoth.cbp,newfrenchy83,2018-01-20 12:57:57+00:00,2018-01-20 12:59:27+00:00,{},
164111677,"Made more use of std::isalnum, std::isalpha, and std::isdigit (std::l…",Vultraz,2018-01-20 05:08:34+00:00,2018-01-21 00:29:40+00:00,{},"…ocale versions)

I'm wondering if maybe I should make these util functions to avoid having to specify the classic locale constantly."
164082205,"Revert part of ""GUI2 Textbox: Remove the other two emacs keybindings""",jostephd,2018-01-19 22:23:24+00:00,2018-01-20 00:40:41+00:00,{},"This reverts part of commit 468c6e0f494793d57b0b1264894cd7f0b0383fa2.

Ctrl+A was removed because its emacs meaning is surprising to some
people.  Ctrl+E was removed because it was the counterpart of Ctrl+A.
Ctrl+U however doesn't conflict with anything else, and it's useful
to some people (me), so reinstate it.

Discussed with @CelticMinstrel."
163695818,fix code problems found by luacheck,vgaming,2018-01-18 12:13:39+00:00,2018-01-21 04:05:59+00:00,{},"actual bugs found:
* core.lua (undeclared global ""helper"")
* wml_tags.transform_unit had wrong code to deal with recall_cost

Also, there is cave_map_generator,
which seems to have a bug with `items` and `chamber_items` variables.
I want to confirm that with other developers before including in PR."
163604649,Used a deque instead of a vector for active event handlers,Vultraz,2018-01-18 02:31:05+00:00,2018-01-18 09:48:53+00:00,{},"Since events can be added and removed constantly, this should be more performance-friendly than
a vector since it avoids reallocations. Though, since this container only holds shared_ptrs instead
of the objects themselves, it probably doesn't make that much difference right now, but I might
switch to object-direct storage in the future. Not sure."
162821830,Lua: add variables metatable,vgaming,2018-01-14 11:57:49+00:00,2018-01-18 22:53:08+00:00,{},"The implementation differs from already-existing
wml.variable.proxy in that it does not try to proxy table sub-fields,
and is fast & simple.

Example usage:
```lua
wesnoth.variables.test = 123
print(wesnoth.variables.test)
```"
162609053,Reachmap ai turn fix,AI0867,2018-01-12 11:32:51+00:00,2022-06-27 20:10:43+00:00,{'UI': 1},This should address issue #2197.
162588199,HttT S04: Have Oceania point out the storm trident in dialog.,jostephd,2018-01-12 09:52:11+00:00,2018-01-19 04:50:06+00:00,{},"This is the first time in the novice campaigns that there's an item to pick up, so explain it in dialog."
162306817,Renames the Khalifate to Dunefolk.,Pentarctagon,2018-01-11 07:05:54+00:00,2018-01-19 22:28:41+00:00,{},"Based on the discussion that happened on the forums regarding the Khalifate's [faction name](https://forums.wesnoth.org/viewtopic.php?f=12&t=47643) and [race name](https://forums.wesnoth.org/viewtopic.php?f=12&t=47703), this PR renames the Khalifate to the Dunefolk.

Also, as a side note, while the poll in the race name thread was(barely) won by `Human (Dunefolk)`, I realized while creating this PR that the in-game Help entry for races uses the `plural_name` attribute of [race] rather than (as I had incorrectly assumed) a separate attribute for the Help category.  As such, I decided the in-game Help menu will instead use `Dunefolk` rather than `Human (Dunefolk)`, seeing as the latter isn't a plural name and wouldn't make sense in other places where it might be used."
161832658,Update changelog,newfrenchy83,2018-01-09 10:20:05+00:00,2018-01-13 15:46:35+00:00,{},"I know for tab problem but that file is too heavy for my smartphone. I cannot fix that myself
  "
161767640,"update the addon manager for ""simple WML""",elias-pschernig,2018-01-09 01:44:52+00:00,2018-01-09 08:23:51+00:00,{},
161497350,Fix formatting of invalid characters for #2043.,Pentarctagon,2018-01-06 21:46:08+00:00,2018-01-06 23:18:25+00:00,{},"This places the invalid characters on their own line, as per @GregoryLundberg's suggestion.

Current: https://i.imgur.com/FkKTnHQ.png
With this PR: https://i.imgur.com/v2yapfi.png"
160886298,Game Display: Show correct defense modifier for unreachable terrain.,jostephd,2018-01-03 10:51:21+00:00,2018-01-03 19:04:11+00:00,{},"Fixes #2353. I copied the idiom from the position report (REPORT_GENERATOR(position)), I'm not sure if that's the best fix."
160794409,Addon client: close connection if the player cancels the download,jyrkive,2018-01-02 20:08:20+00:00,2018-01-13 12:59:59+00:00,{},"This pull request is a fix for bug #2203.

The approach is to close the connection when the player cancels the download. This is the same thing that Wesnoth was doing before the GUI2 port of the addon manager, and it has zero overhead if the player *doesn't* cancel the download (unlike some other options which were suggested)."
160581235,UI: Sort the 'damage versus' tooltip by unit type.,jostephd,2017-12-30 06:50:59+00:00,2018-01-19 03:33:13+00:00,{},"I have been using this locally but @Pentarctagon suggested to post it as a PR.  Here's the tooltip it changes, the image shows the listing both before and after the patch:

![damage-tooltip](https://user-images.githubusercontent.com/24784687/34451976-5b1e2eb8-ed2d-11e7-82ac-60951197a85a.png)

_edit_: The ""by unit"" code is commit 5af12fb6ca73bd75b598e019394cd3f592cbc6e."
160438849,document use_markup widget property,vgaming,2017-12-28 20:28:03+00:00,2017-12-28 20:29:44+00:00,{},follow-up to this issue: https://github.com/wesnoth/wesnoth/issues/2336
160321186,Misleading comment,GregoryLundberg,2017-12-28 01:20:11+00:00,2017-12-28 20:27:30+00:00,{},"'toward zero' is confusing since it can round up or down.

The correct comment is 'round half up, to the nearest integer'.

Closes #2330"
160310583,Further reworking of event iteration interface to try to fix #2312,Vultraz,2017-12-27 22:32:46+00:00,2018-01-11 18:12:29+00:00,{},"Turns out constructing a list of matching handlers breaks some undocumented behavior, namely events being executed in the order they're added (usually the order in which they appear in the WML). It also broke certain variable substitution by moving variable interpolation wholly before any event execution, as opposed to between each event.

This commit is an experiment with an even simpler method: simply iterating through every registered handler in order, checking for a name match on each one, and if it passes, immediately executing the provided handler.

Not ready yet, still needs some polishing."
160283944,make macro definitions accessible from Lua,vn971,2017-12-27 18:05:53+00:00,2017-12-28 20:38:28+00:00,{},"The goal is to make some of the macro definitions
easily accessible from Lua code.

Not all definitions were handled --
only some of those that are expected
to be used in real Lua addon code.

--
Tested locally by overriding --data-dir

UPD: I had to use `_final.cfg` to make sure this macro runs when others were already initialized. I could of course place it in a correct file by checking alphabet order of existing files, but I'm not sure which approach is better here."
160278403,allow specifying the next player number in end_turn #1392,gfgtdf,2017-12-27 17:16:03+00:00,2018-02-26 02:28:01+00:00,{},"as title says.

Old post:
> doesn't work yet since the wesnothd code still needs to be updated. also i'm still unsure about the best api, i coul eigher make it a parameter to wesnoth.end_turn or add  seperate function set_next_playerr_number"
160190855,Implement MP Moderation,GregoryLundberg,2017-12-27 04:00:39+00:00,2018-01-12 14:50:20+00:00,"{'Bug': 1, 'Confirmed': 1, 'Ready for testing': 1, 'Blocker: New Stable': 1, 'MP': 1, 'Regression': 1}","Issue #2327 raises the issue that MP moderation was never implemented. So far the following action-items have been identified:

 - [x] Implement /q ban as documented
 - [x] Implement /q kick as documented
 - [x] Implement /q kickban (/q kban) as documented
 - [x] Correct kban syntax error from administrative user info dialog
 - [x] Check the ip is not banned during login and kick the client if it is
 - [x] Expire the ban
 - [x] Persist the bans across server crashes, cold- and warm-restarts
 - [x] Implement the per-IP connection limit
 - [x] Display the error message when banned or at the connection limit
 - [x] Fail directly to the main menu instead of a second error because the server closed
 - [x] Send handshake in network byte order

Not all of the above were actual code issues. They are listed to note they've been checked and corrected, if needed.

Issues not addressed:

 * Administrators can kick and ban themselves. This is fixable but more work than I'm willing to put in at this time. In the meantime, hey, don't shoot your foot off, OK?

 * The per-IP connection limit is very weak and easily bypassed. This is fixable but more work than I'm willing to put in at this time. If someone is that determined to abuse the server, then let them or ban them.

 * File handling when persisting bans is not crash-resistant in all cases. There is a short period where, should a crash occur, the file may become corrupt. This is fixable but more work than I'm willing to put in at this time, especially considering the extremely low probability of the proper conditions ever arising.

 * Wesnothd can not handle large numbers of concurrent players. This is a system limit. The solution is to run multiple instances of wesnothd. This will require a minor change to the listening socket setup. I'm leaving that to a future Issue/PR since it requires coordination with the server administration team.

 * The client does not check the server handshake is the expected value.

 * There is no way to differentiate the handshake from normal traffic. This is not fixable without completely breaking the ability to redirect clients to version-specific servers.

 * The entire protocol implementation is fragile. This is fixable but far too large a scope for this stage. Perhaps for 1.15, or 2.0 if we want to fix the protocol as well as its implementation and can abandon all 1.x clients.
  "
160158242,DiD Touchups,sigurdfdragon,2017-12-26 19:01:10+00:00,2017-12-30 00:50:55+00:00,{},"@ln-zookeeper 
These are all straight bugfixes, but I was slightly unsure about:

DiD S03: Slightly change gameplay to better match objectives
DiD S04: Fix dialog so it better fits with if malin_used_necromancy or not

which is why I made a pr. I'll merge in 3 days if no issues."
160120114,L S8 Give Harper a loyal overlay in Liberty's final scenario,stevecotton,2017-12-26 11:45:35+00:00,2017-12-26 14:30:02+00:00,{},"He's been a silver-crowned hero until this scenario, and in
the final scenario he's still loyal with dialogue if he dies,
so make him easily visible to the player."
160019977,base sprites for Quenoth scouts,doofus-01,2017-12-25 03:18:58+00:00,2018-01-18 23:28:39+00:00,{},replacing the horses with some desert antelope thing.
159946538,add clear_halo in erase_unit to prevent halo reamain after animate [kill],newfrenchy83,2017-12-22 23:37:48+00:00,2017-12-25 16:36:46+00:00,{},"When function clear_halo supress, halo persist after kill an unit after dialog"
159802090,Game Events/Manager: refactor event iteration interface,Vultraz,2017-12-22 05:21:16+00:00,2017-12-22 09:14:37+00:00,{},"Instead of trying to iterate over two lists at once, just construct a new list of matching
handlers. This should fix #2310 too, since it ensures any additional events added after
iteration begins don't get executed."
159561837,whiteboard: Don't clear the undo stack in SP mode.,jostephd,2017-12-21 02:23:38+00:00,2017-12-21 05:34:38+00:00,{},"Fixes #2303.

I left the preferences as a todo since this patch as it stands is already an improvement for SP."
159497649,make images not executable,vn971,2017-12-20 19:21:09+00:00,2017-12-20 20:01:09+00:00,{},make images not executable
159447785,addon_manager: fix append_tag usage,vn971,2017-12-20 15:39:05+00:00,2017-12-20 20:23:54+00:00,{},"Note that this still doesn't allow the --upload
functionality to work. After this fix,
wesnoth still complaints about unordered WML.

It is believed that this is a separate issue though,
happened because of the latest simple_wml changes."
159411083,"Make some functions static in display.{cpp,hpp}",rikardfalkeborn,2017-12-20 13:02:00+00:00,2017-12-22 17:48:46+00:00,{},
158834054,Do not access non-existent unit,GregoryLundberg,2017-12-18 05:46:00+00:00,2017-12-19 21:05:25+00:00,{},"The [kill] tag can run animations. But it can also fire the `last breath` event, which can call [kill]. When we get back to the original [kill], the unit is gone, causing an error attempting to run the animations.

Added a check to ensure the unit is still on the map before we attempt to run the animations.

The Issue also requested that [harm_unit] pass the unit causing the harm into the [kill] tag so that `last breath` could use the secondary (killing) unit available like it does elsewhere.

Closes #2298"
158769850,Deprecation handling for the wesnoth preprocessor,CelticMinstrel,2017-12-17 03:29:27+00:00,2018-02-12 05:09:49+00:00,{},"This extends the deprecation functionality (formerly implemented only in Lua) to the C++ core and adds a `#deprecated` preprocessor directive which, when used in a macro definition, will mark it deprecated so that a warning is printed on each use. (I'm not sure the implementation is quite the best; in particular, it doesn't currently give you the file and line number where it's used.) If used outside of a macro definition, the directive instead prints a deprecation warning applying to the entire file.

This is not ready to merge for one other reason: the second commit breaks the `$(...)` formula substitution syntax. The reason is that I need to be able to use string substitution syntax from the wesnothlib target (because the preprocessor is part of that target, and it depends on deprecation which depends on string substitution), but the formula engine is not part of the wesnothlib target. I'm not sure what the best course of action is here; moving the formula engine to wesnothlib seems like a poor choice as that would mean it's compiled into the servers."
158768026,Translate damage types in the unit_preview_pane tooltip.,jostephd,2017-12-17 02:02:07+00:00,2017-12-17 04:28:20+00:00,{},"To reproduce:

1. Run `wesnoth -t`
2. Open the 'recruit' dialog
3. Mouseover the green ""HP:"" value
4. Observe that the attack types (""arcane"", ""blade"", etc.) appear in English.

With this patch, the attack types are translated."
158441108,HttT: Fix OOS when redoing a recall and Li'sar is allied,jostephd,2017-12-14 19:21:31+00:00,2017-12-14 20:09:14+00:00,{},For #2216.
158261450,appdata file for appstream software centers,sevu,2017-12-14 03:38:22+00:00,2018-02-02 22:47:01+00:00,{},"With the adition of this wesnoth will show more information in software centers on linux.
Here an example from gnome-software:

![bildschirmfoto von 2017-10-13 06-15-52](https://user-images.githubusercontent.com/21158813/33972967-a10d1f38-e080-11e7-999a-b5001dc6bd2a.png)

The text shown is from the wiki (and thus the file is under GFDL license)
We would still need an email for the `update_contact` field, it should be an valid email address.

The 'Localized in your Language' is not properly detected for languages other than English, I wonder if it is related to #2213 or some other black magic.

As for the id:
It should ideally be of the scheme tld.developer.product
It seems like the comments and the rating in the software centres are bound to the id, so, if the id would be org.wesnoth.wesnoth-1.xy then each new release will start from scratch again.
Linux packagers will need more than one, maybe this is an alternative:
org.wesnoth.wesnoth (in the default repository)
org.wesnoth.wesnoth-devel (not in repos)
org.wesnoth.wesnoth-new (for backports of the new release)"
157772580,Removed some unnecessary boost includes,Vultraz,2017-12-12 09:12:43+00:00,2017-12-12 10:06:14+00:00,{},"Just running this through CI to see if it builds, given that comment."
157400572,Two crashes on iOS,singalen,2017-12-09 19:19:07+00:00,2017-12-10 18:17:57+00:00,{},"#1759 and a completely original one, that happens only in some addons."
157378032,Fix #2281 (lua console formatting can be broken),CelticMinstrel,2017-12-09 07:37:45+00:00,2017-12-13 13:53:44+00:00,{},This should fix the possibility of broken markup in the Lua console.
157363383,Restructured and cleaned up GUI2 initialization process,Vultraz,2017-12-09 00:51:02+00:00,2017-12-11 03:49:59+00:00,{},
156859402,[TESTING] Cleanup GUI2 Widget forced linkage,GregoryLundberg,2017-12-06 22:42:31+00:00,2017-12-09 03:27:42+00:00,{},"This is code-complete for Visual Studio, CMake and SCons. Sorry, I can't fix CodeBlocks or XCode at all.

Note that Visual Studio required no changes since it does not use a library for the vast majority of the modules in Wesnoth. It uses a library for Lua, and it uses one for the few modules common to both wesnoth and wesnothd. It does not build campaignd or boost_unit_tests. It's the shared modules between wesnoth and boost_unit_tests which are the library where the GUI2 Widgets originally appeared on GCC/Clang targets and which necessitated the link-time options this PR introduces.

Note also that Visual Studio has an option prior to VS 2015 which would cause ALL modules of ALL libraries in the projects to be included. This would work but would require a very careful organization of the projects.

With Visual Studio 2015, the option /WHOLEARCHIVE:<libname> works similar to the Apple linker: specify it once for each library to be effected.

Still to be done:

- [x] find someone to fix SCons
- [x] verify the CLang linker (lld) can be used instead of the GCC linker (ld)
- [x] have someone check CMake and SCons on macOS
- [x] check CMake and SCons on MinGW
- [ ] have someone update the XCode project files
- [x] have someone update the CodeBlocks project files.
"
156616449,"Revert ""Fix travis osx build.""",GregoryLundberg,2017-12-06 01:09:36+00:00,2017-12-10 13:45:59+00:00,"{'macOS': 1, 'Regression': 1}",This reverts commit 489eed776091b65ab3ebe0ade2e1d0405658a375.
156208125,Adds cmake's pedantic option to scons.,Pentarctagon,2017-12-04 14:18:38+00:00,2017-12-04 15:23:34+00:00,{},"This PR:
- Adds the `pedantic` option to scons, which matches cmake's `ENABLE_PEDANTIC_COMPILATION` functionality.
- Removes the `-Wnon-virtual-dtor` and `-Wmismatched-tags` flags from cmake's `ENABLE_PEDANTIC_COMPILATION` option, since they are already included in the default build flags.

Alternatively, these flags could be added to scons' and cmake's default build flags, and cmake's separate `ENABLE_PEDANTIC_COMPILATION` option removed."
156085242,Remove logic from cmake forcing lua to be compiled as c++ for clang.,Pentarctagon,2017-12-03 22:40:56+00:00,2017-12-04 02:06:38+00:00,{},"Wesnoth's lua files are all already `*.cpp`, so this forcing is redundant.  It also for some reason is only being done for the cmake+clang combination."
156082545,Remove the scons workaround for Travis only having SDL 2.0.2,Pentarctagon,2017-12-03 21:46:00+00:00,2017-12-03 22:35:59+00:00,{},"This is no longer needed, as Travis now has SDL 2.0.4 available via the docker image."
156073396,Fix shell injection,soliton-,2017-12-03 18:27:05+00:00,2017-12-03 20:30:25+00:00,{},Also quote some variable expansions that weren't and fix some unnecessary bashism.
156059701,add hidden_amla option in amlas,newfrenchy83,2017-12-03 13:05:57+00:00,2017-12-09 07:18:59+00:00,{},"With the apply_to=type in effect the amla allow an unit to upgrade without specifing in advances_to. Different amlas can be associate with upgrade but color xp bar remain purple.
In utbs the wml is use for hide this but is no perfect when the youth upgrade( purple is briefly seeing). I propose an change in source for simplify the work of addons developer who want create an unit line similar."
156055868,Switch AppVeyor notifications to webhook w/ irker-appveryor-collector,AI0867,2017-12-03 11:09:33+00:00,2017-12-04 02:04:33+00:00,{},"Instead of using the custom script for IRC notifications, which may result in up to 6 notifications, reporting only failures, in order to keep down the volume, appveyor now sends a webhook to a server that processes the data first and outputs up to two notifications (final result and first failure), through irker.

Example output:
> 08:42 < irker439> wesnoth/wesnoth:appveyor-collector Alexander van Gessel 01e77a6206 Switch AppVeyor notifications to webhook vs2017/Debug Failed
> 08:42 < irker439> Details: https://ci.appveyor.com/project/wesnoth/wesnoth-605wt/build/Wesnoth-VS2017-appveyor-collector-524
> 09:47 < irker439> wesnoth/wesnoth:appveyor-collector Alexander van Gessel 01e77a6206 Switch AppVeyor notifications to webhook 1/6 Failed
> 09:47 < irker439> Details vs2017/Debug: https://ci.appveyor.com/project/wesnoth/wesnoth-605wt/build/Wesnoth-VS2017-appveyor-collector-524

The collector server: https://github.com/AI0867/irker-appveyor-collector"
156045946,[WIP- don't commit!] - Giant Scorpion unit images,doofus-01,2017-12-03 04:59:18+00:00,2017-12-15 03:48:44+00:00,{},"The goal of this PR is to get complete SE facing animations for Giant Scorpion, as well as a replacement for the portrait.
For now, we just have defense animation and completely flat (unusable, WIP) portrait."
156032081,Add strict warning options to the default build options.,Pentarctagon,2017-12-02 21:23:45+00:00,2017-12-03 21:30:53+00:00,{},"This PR:
- Moves all the flags from the scons/cmake `strict` build into the regular build flags, except for `-Werror`.  This means that the only difference between `strict` builds and non-strict builds will be if warnings are turned into errors.
- Removes `-std=c99` from scons' `CFLAGS`, since cmake does not set that flag.  This affects `src/SDL_SavePNG/savepng.c`, since it's the only C source file Wesnoth has.
- Removes the `-Wno-pointer-bool-conversion` flag from scons' lua build, since cmake does not use that flag.

Additionally, cmake has another option used to add additional warning flags, `ENABLE_PEDANTIC_COMPILATION`:
- `-Wlogical-op` - Warn about suspicious uses of logical operators in expressions. This includes using logical operators in contexts where a bit-wise operator is likely to be expected. Also warns when the operands of a logical operator are the same.
- `-Wmissing-declarations` - Warn if a global function is defined without a previous declaration. Do so even if the definition itself provides a prototype. Use this option to detect global functions that are not declared in header files. In C, no warnings are issued for functions with previous non-prototype declarations; use -Wmissing-prototypes to detect missing prototypes. In C++, no warnings are issued for function templates, or for inline functions, or for functions in anonymous namespaces.
- `-Wredundant-decls` - Warn if anything is declared more than once in the same scope, even in cases where multiple declaration is valid and changes nothing.
- `-Wctor-dtor-privacy` - Warn when a class seems unusable because all the constructors or destructors in that class are private, and it has neither friends nor public static member functions. Also warn if there are no non-private methods, and there’s at least one private member function that isn’t a constructor or destructor.
- `-Wnon-virtual-dtor` - Scons and cmake already turn this specifically into an error for all builds.
- `-Wdouble-promotion` - Give a warning when a value of type float is implicitly promoted to double. CPUs with a 32-bit “single-precision” floating-point unit implement float in hardware, but emulate double in software. On such a machine, doing computations using double values is much more expensive because of the overhead required for software emulation.
- `-Wuseless-cast` - Warn when an expression is casted to its own type.
- `-Wnoexcept` - Warn when a noexcept-expression evaluates to false because of a call to a function that does not have a non-throwing exception specification (i.e. throw() or noexcept) but is known by the compiler to never throw an exception.

(Warning descriptions copied from [here](https://gcc.gnu.org/onlinedocs/gcc/Warning-Options.html) and [here](https://gcc.gnu.org/onlinedocs/gcc/C_002b_002b-Dialect-Options.html))

Are any of the pedantic flags useful/does anyone actually use `ENABLE_PEDANTIC_COMPILATION`?  If not, then there isn't any really point to keeping it around.  Alternatively, if any of the pedantic flags are worth keeping, then it seems to me like they should be added to the main build flags so they are warned about and fixed."
156022744,Attempt to implement experiment to fix edge-of-hex artifacts with fractional zooming,sigurdfdragon,2017-12-02 17:34:48+00:00,2020-09-12 01:07:04+00:00,{'Graphics': 1},"This is an adaptation of PR #318 by cbeck88 & my attempt to help close the pr.

However, I'm not sure what this is fixing if it is or if it is still relevant
I thought  it might fix the sceenshot I posted there, but my implementation does not. It is quite possible that I screwed up the implementation of #318



The idea is, when scaling a hex to zoom, instead of masking it
first and then scaling it up, it should be scaled to zoom and
then masked with a scaled up terrain mask image, because it will
be more precise.

I find that if this is done, and scale to hex algorithm is set to
nearest neighbor, then I no longer get any artifacts from this."
155799157,Updates to licensing info and makes a link https.,Pentarctagon,2017-12-01 07:29:13+00:00,2017-12-01 08:59:42+00:00,{},"This PR updates README.md to:
- Point to the [updated wiki page](https://wiki.wesnoth.org/Wesnoth:Copyrights) for licensing/copyright related information.  The various forum threads have also been updated to point to the wiki page, rather than having information scattered across multiple different places.
- Updated ""Free"" to ""Open Source"".  This is how it has been updated to be stated on Wesnoth's website, and it should be consistent here as well.
- Change the Manual link to be able to use HTTPS like the other links."
155690279,fix leader image not always tc_colored,newfrenchy83,2017-11-30 18:53:53+00:00,2017-12-02 20:05:54+00:00,{'UI': 1},Sometimes in last saves of scenario the leader image is magenta. 
155621527,fix tc_color image_leader =default color in load window,newfrenchy83,2017-11-30 14:27:31+00:00,2017-11-30 17:14:03+00:00,{},"When in a scenario the color of player side is different of defaut color the tc_color of leader image is ever the color side by defaut.
"
155560283,Test commit nothing to see here,Vultraz,2017-11-30 09:46:14+00:00,2017-11-30 09:46:59+00:00,{},[ci skip]
155041679,Game Events: refactored event handler storage,Vultraz,2017-11-28 11:10:26+00:00,2017-11-28 21:04:09+00:00,{},"This throws out the custom smart_list class in favor of a plain std::list. It also greatly simplifies
a few things. First, event handlers no longer remove themselves from the main list in event_handlers.
Now they just flag themselves as disabled (which means they will never execute once marked) and cleaned
up later in a newly added cleanup stage. This means a handler no longer needs to keep its index in the
active handler vector.

This removal of reliance on indices also means I could add the aforementioned cleanup stage. With the
smart_list code, event handlers were never actually removed from the active vector, nor any weak_ptrs
pointing to them removed either. This wasn't exactly a problem, since the handlers were stored via
shared_ptrs which would then simply be null after one deleted itself. Still, it's cleaner to drop any
invalid ones (and unlockable weak_ptrs) from any relevant containers. I've opted to do this in
manager::execute_on_events. Seems a good enough place as any.

The net result of this is the code is much cleaner. We're able to get rid of a bunch of unnecessary
feelers into various classes. This also makes the manager::iteration dereference code a lot easier
to understand. There certainly could be further refactoring, but I think this is a good start.

This also supersedes PR #1714."
154976169,HttT S17: Fix lava issues,sigurdfdragon,2017-11-28 04:15:31+00:00,2017-11-29 22:25:23+00:00,{},"1. Undo now works again in the scenario.
2. Lava now works again.
3. Triggering on a moveto event was not good, as several shorter moves
   would make rate of lava grow much faster than fewer longer moves."
154937232,Gender refactor,AI0867,2017-11-27 22:50:55+00:00,2022-03-04 11:36:19+00:00,"{'WML': 1, 'Units': 1, 'Lua API': 1}","unit_gender is now no longer a member of unit_race.

I'm not entirely sure the full set of commits are the right direction, but part of the branch can also be used. `MAKE_ENUM` is another option."
154648538,Have travis use a Ubuntu 16.04 docker image.,Pentarctagon,2017-11-25 19:01:00+00:00,2017-12-02 03:04:06+00:00,{},"This PR is meant to have Wesnoth's linux travis builds use the Ubuntu 16.04 docker image, rather than the Ubuntu 14.04 default OS that travis provides.  This will also allow upgrading to future versions of Ubuntu simply by editing the `Dockerfile`.  Current todo list:

- [x] See if building still works or not.
- [x] Check that travis' error reporting still works when a compile error is encountered while building in docker.
- [x] Re-add the unit tests to the docker builds.
- [x] See if errors encountered in the unit tests are still noticed by travis.  They are, since [the exit code of the last command is used as docker's return code](https://github.com/moby/moby/issues/354).  However this also means that the building and unit tests must be part of a single script that returns a single success or failure code.
- [x] Re-test that a compiling/linking failure is caught by travis as a failure. [It is.](https://travis-ci.org/wesnoth/wesnoth/builds/309253429?utm_source=github_status&utm_medium=notification)
- [x] Re-test that a unit test failure is caught by travis as a failure.  [It is.](https://travis-ci.org/wesnoth/wesnoth/builds/309347557?utm_source=github_status&utm_medium=notification)
- [x] Create a custom base image on [Docker Hub](https://hub.docker.com/) with Wesnoth's dependencies pre-installed. [Done](https://hub.docker.com/r/wesnoth/wesnoth/tags/).

This PR also:
- Fixes the Mac build declaring the `opt` variable rather than the `OPT` variable.  As a result, it will build with `-O3 -O0` rather than `-O3` and use the `strict` option, like I assume it was originally meant to.
- Changes the GCC `1y` build to `c++14`, since GCC 5.4 supports that option now.
- Re-enables cmake building `campaignd` and `boost_unit_tests`, since those can successfully be built as of #2208.
- Removes leftover Mac code from when Wesnoth used SDL1."
154608552,Remove MSVC support from cmake.,Pentarctagon,2017-11-24 21:19:27+00:00,2017-11-25 18:01:50+00:00,{},"This PR:
- Removes MSVC support from cmake.
- Removes the two unused options `ENABLE_TOOLS` and `ENABLE_SDL2_TOOLS`."
154466512,[UtBS] updating Ixthala Demon unit,doofus-01,2017-11-24 03:01:34+00:00,2017-11-25 19:43:50+00:00,{},"I changed the description, but it may have been more of a lateral pass than an improvement.  I believe the sprite and animation are an improvement though.  Could be better, but it's a one-off unit, I don't think the flaws apparent in the individual frames are visible ""in game""."
154459550,"""Show Enemy Moves"": Don't show hexes enemy can reach only through the player's shroud",jostephd,2017-11-24 01:09:08+00:00,2017-12-02 02:47:48+00:00,"{'Bug': 1, 'UI': 1}",Fixes #2199.  See https://github.com/wesnoth/wesnoth/issues/2199#issue-273977945 for a test case.
154407382,Spelling fix: replaced recieve with receive,kallaballa,2017-11-23 15:48:43+00:00,2017-11-23 15:50:45+00:00,{},"I encountered a number of misspelled instances of the word ""receive"". fix it"
154288767,Bump min Pango version to a saner value,Vultraz,2017-11-23 02:17:05+00:00,2017-11-27 18:09:29+00:00,{},"The previous min version (1.21.3) is almost 10 years old at this point (release archives indicate a
release date of June 2008). The current pangocairo package available in Debian oldstable (Jessie,
which we still support since we're still supporting GCC 4.8...) is 1.36.8 (from September 2014), so
I made that the new minimum."
154251447,Eliminate use of string_view::at,GregoryLundberg,2017-11-22 20:43:12+00:00,2017-11-29 00:01:26+00:00,{},"We only use it in once place. At that point we can guarantee we stay in-bounds. So there is no need to use at() to check we remain in-bounds.

This eliminates a warning when building Debug for Windows (quieting Appveyor).

AI0886 had a similar issue building using GCC 6.3 on Boost 1.62

Reverting ca03818fa897a558d9ad5d9c3729404f5959029f and 0cbab6eeedff676a57191440c0b2b89b923bfaad since this changeset should correct both issues."
154248851,Make strict builds consistent between scons and cmake,Pentarctagon,2017-11-22 20:27:49+00:00,2017-11-24 21:00:02+00:00,{},"This PR:
- Fixes an issue @singalen found when the string passed to `RemoveFlag` is empty.
- Removes the `check_compiler_has_flag` macro from cmake.  I have no particular opinion on specific flags, but the flags used should at least be consistent.
- Sets the same flags to be used by scons and cmake for `strict` builds.

More specifically, for cmake's `strict`:
- Changes -W to -Wextra.  -Wextra is the new name for -W, and has been supported since at least GCC 4.3.
- Removes -Wnostrict-aliasing.  The -Wstrict-aliasing warning is only used when -fstrict-aliasing is also used, and -fstrict-aliasing is not used anywhere.
- Removes -Wno-overloaded-virtual.  As per the comment in cmake, it was used to silence a warning from clang 3.3 and earlier.
- Restricts -Wmismatched-tags to clang, since GCC [doesn't implement this warning](https://gcc.gnu.org/wiki/FAQ#Why_GCC_does_not_warn_for_mismatch_between_struct_and_class_.28-Wmismatched-tags.29_.3F).  Clang implements it for compatibility with MSVC.
- Removes -Wnonull-conversion.  Scons does not use it, and I couldn't find a good explanation of what it actually does.
- Restricts -Wno-literal-suffix to clang, since it's explicitly used by one of the clang travis builds.
- Removes -Wno-deprecated-register.  The `register` keyword is [deprecated as of C++11](http://en.cppreference.com/w/cpp/language/storage_duration) and will be removed in C++17, so if this warning is popping up anywhere in Wesnoth's code then it probably shouldn't be suppressed.
- Restricts -Wconditional-uninitialized to clang.  GCC doesn't implement this warning.

Additionally for cmake's `pedantic` option:
- Removes -Winit-self and -Wc++11-compat, since they are already enabled by -Wall.
- Removes -Wextra-semi, since it is not supported until later versions of GCC and is not used by scons.
- Restricts -Wmismatched-tags, -Wdocumentation, and -Wnodocumentation-deprecated-sync to clang.

For scons' `strict`:
- Adds in the clang-specific flags -Wmismatched-tags, -Wno-literal-suffix, and -Wconditional-uninitialized from cmake."
154156568,"Implementation of a ""Surrender Game"" feature ",kallaballa,2017-11-22 13:43:36+00:00,2018-02-04 23:35:36+00:00,"{'Enhancement': 1, 'MP': 1}","I implemented a ""Surrender Game"" feature which resides in the in-game main menu. When clicked it opens a confirmation dialog. On confirmation it records a surrender command in all parties replays and the issuing player quits the game."
153588226,Attempt to fix Travis GCC warnings for f2b31ba082e1 ,Vultraz,2017-11-20 10:07:50+00:00,2017-11-20 12:48:04+00:00,{},
153570255,Remove -rdynamic from the linker.,Pentarctagon,2017-11-20 08:36:49+00:00,2017-11-22 05:19:42+00:00,{},"This PR:

- Adds the RemoveFlag() function.
- Replaces the existing logic removing the `-DNDEBUG` flag with RemoveFlag().
- Removes the [-rdynamic](https://gcc.gnu.org/onlinedocs/gcc/Link-Options.html) flag from the linker.  Cmake adds this by default while scons does not, and it adds close to 5 MBs to the executable."
153541840,"Removed CVideo parameters from dialog show() functions, simplified display/execute implementation",Vultraz,2017-11-20 04:24:30+00:00,2017-11-20 08:25:36+00:00,{},
153508591,Macros: Tweak sceptre damage for story reasons,sigurdfdragon,2017-11-19 18:24:14+00:00,2017-11-27 11:46:58+00:00,{},"Sceptre (15x4) is now stronger than the uncut ruby of fire (14x4) for
regular mainline users Thursagan and Konard II. Level 3 Konrad & Li'sar
in HttT are still exceptional users of the sceptre (18x4 & 16x4).

From discussions with zookeeper in irc."
153467275,"Implementation of a ""Surrender Game"" feature",kallaballa,2017-11-18 20:48:33+00:00,2017-11-22 12:36:17+00:00,{},"I implemented a ""Surrender Game"" feature that resides in the main in-game menu. When clicked a confirmation dialog will be opened and when confirmed all units of the current side are killed and ""check_victory()"" is called to end the game. "
153464191,Rewrite the link detection code,jyrkive,2017-11-18 19:28:03+00:00,2017-11-21 04:44:34+00:00,{},"As @Vultraz mentioned in Discord, the existing link detection code may sometimes detect Pango markup as parts of links and therefore produce invalid Pango markup. For example, if we have

\<span color='white'\>\<i\>Test **https://www.example.com/</i\>\</span\>**

automatic link detection will detect the part I bolded above as a link and add the following markup:

\<span color='white'\>\<i\>Test **\<span underline='single' color='#ffff00'\>** https://www.example.com/\</i\>\</span\>**\</span\>**

And that's invalid markup, because it attempts to open tags in the order `<span><i><span>` but close them in the order `</i></span></span>`.

To fix the problem, my code takes a completely different approach. Instead of scanning for links and replacing them in one go, the steps are performed separately... and with separate strings: the link scanning step uses the raw text **without markup**. Therefore markup can't be interpreted as a part of a link, and producing incorrect markup is no longer possible.

The code needs more testing before it can be merged. In particular, I'm worried about the possibility of memory leaks: it might be that the raw text that `pango_parse_markup()` gives us needs to be freed. (But when I tried that, the game crashed on startup because of a double-free. Still, I want to test with Address Sanitizer to be sure.)"
153453713,Bring back `LOCALEDIR`,SoapGentoo,2017-11-18 15:11:21+00:00,2017-11-18 16:36:13+00:00,{},"* The current infrastructure relies on `LOCALEDIR`
  in places beyond CMake, hence we need to keep
  it for the time being.

Fixes #2211"
153239265,Have scons and cmake link against same static libs,Pentarctagon,2017-11-17 08:23:31+00:00,2017-11-20 05:57:44+00:00,{},"This PR makes the following changes:

- Reorganizes cmake's and scons' static libraries so they create and link against the same five static libraries.
- Renames some source lists to match the static libraries created from them.
- Removes cmake's check for librt.  Librt was merged into glibc starting with version 2.17, so linking to it is not needed.  Scons also already does not link to librt.
- Fixes cmake not being able compile the wesnoth client when building with `-DENABLE_GAME=yes -DENABLE_TESTS=yes`
- Fixes cmake not being able to compile campaignd."
153080863,"Make the ""Delay Shroud Updates"" option apply to recalls.",jostephd,2017-11-16 16:03:38+00:00,2017-12-02 03:30:08+00:00,{},"Fixes #2196 (in addition to ca0b5033f06ad83868dc569e973897083042f90b
which was HttT-specific)."
152990309,Fix the scons Wesnoth Windows executable icon.,Pentarctagon,2017-11-16 09:32:39+00:00,2017-11-16 13:19:39+00:00,{},Fixes #2204.
152850675,DiD S01-S04 fixes,GregoryLundberg,2017-11-15 18:27:03+00:00,2017-11-29 22:32:45+00:00,{'Campaign (any)': 1},"Long ago I started a code-read and walk-through of DiD, but had to drop it due to RL.

@sigurdfdragon has been working on DiD S12 in #2188, which reminded me of these changes. Turns out, even though it has been a year, there were no merge conflicts; so I rebased and pushed, and am putting up this PR to clear the completed work off my queue."
152306693,"fix mp depckeck (#1887, #2092)",gfgtdf,2017-11-13 18:01:04+00:00,2017-11-15 22:49:07+00:00,{},"just like in the gui1 version opf mp create we just call a 'sync'
function whenever the user changed the selected era/scenario/mod. This
commit currently only fixes the check for era/scenario compability not
for mods.

it might also create an ininite recursion sometimes, have to investigate that."
152129896,Rug fixes to address #2088,doofus-01,2017-11-12 23:22:18+00:00,2017-11-12 23:33:19+00:00,{},fixes to issues noted in #2088
152096150,Add extra_flags to cmake.,Pentarctagon,2017-11-12 09:31:09+00:00,2017-11-12 13:23:04+00:00,{},Fixes #2165.
152072254,HttT S20b UC touchups,sigurdfdragon,2017-11-11 19:50:13+00:00,2017-11-12 03:36:41+00:00,{},"The main thing here is the adding of underground time to cave areas, and a slight reduction in Saurian strength to somewhat compensate.

Tested with min gold (200) on hard with recruits only (& no gryphons) and heroes on max level. Appears to be beatable with completing the side quest, though the player needs to know what they are doing."
152037399,DiD S12 fixes,sigurdfdragon,2017-11-11 02:31:56+00:00,2017-12-05 00:36:14+00:00,{'Campaign (any)': 1},"Based on irc discussion https://www.wesnoth.org/irclogs/2017/10/%23wesnoth-dev.2017-10-05.log

The objective is to prevent players from playing forever or looking up in wiki/forums to complete the campaign. And also improve dialog & feel.

Comments especially wanted on the race-specific ending dialog & Change and improve objectives commit."
151596007,Minor code cleanup.,Pentarctagon,2017-11-09 09:12:41+00:00,2017-11-14 17:52:14+00:00,{},"- Removes some unnecessary lists.
- Removes `env[""wesnoth_res""]` and `env[""wesnothd_res""]`, since neither of those are referenced anywhere else.
- Changes how `SDLMain.mm` is added so the `wesnoth_objects` variable can be reused between `wesnoth` and `boost_unit_tests`."
151247773,Respect lua_next constraints,GregoryLundberg,2017-11-07 22:41:53+00:00,2017-11-13 01:48:58+00:00,{},"The key value returned by lua_next, on the Lua stack, cannot be modified.

Certain tests such as lua_isstring will convert the value.

The solution is, instead of testing if they key can be converted to a string, test if it actually is a string by using lua_type."
150751898,Set skip animation checkbox,jostephd,2017-11-06 00:29:33+00:00,2017-11-07 05:39:54+00:00,{},Fixes #2176.
150745895,AToTB: Tweak hint to not assume the AI will make mistakes,jostephd,2017-11-05 22:22:27+00:00,2017-11-13 03:31:38+00:00,{},As discussed at https://github.com/wesnoth/wesnoth/pull/2105#pullrequestreview-72671256.
150745716,Lua API: Add advances_from and advances_to to unit type getter,jostephd,2017-11-05 22:18:47+00:00,2017-11-06 00:32:21+00:00,{},Fixes #2169.
150732205,Weight RGB values by alpha when blurring,AI0867,2017-11-05 17:14:48+00:00,2017-11-06 06:07:26+00:00,{},"Builds on PR #2172.

Pixel RGB values are weighted by their alpha channel. This means that fully transparent pixels do not contribute to the average, while partially transparent pixels contribute less than fully opaque ones.

Unlike PR #2172, this definitely does change the semantics of `~BL()` functor and `shadow_image` (used by `floating_label`).

Regarding performance, it adds a few integer multiplications, which are unlikely to have much effect."
150726498,Blur refactor,AI0867,2017-11-05 15:07:13+00:00,2017-11-06 04:58:23+00:00,{},Refactor the blurring code to use more modern C++. Fixes a bug for blur values larger than 127 and may quiet some coverity issues.
150666160,Add ability to not create the .scons-option-cache file.,Pentarctagon,2017-11-04 07:31:47+00:00,2017-11-08 17:52:05+00:00,{},"Scons will use the values saved in the .scons-option-cache to fill in values that I do not provide myself.  For example, if I execute:
`scons wesnoth build=release enable_lto=yes ctool=gcc cxxtool=g++ jobs=6`
then
`scons wesnoth build=release ctool=gcc cxxtool=g++ jobs=6`
the second run will still have LTO enabled.

This change will allow specifying `--option-cache=""""`, so that the values provided for previous runs are not saved and reused."
150622809,Quell CMake Warning CMP005 Deprecated,GregoryLundberg,2017-11-03 20:33:53+00:00,2017-11-06 18:32:49+00:00,{},
150613439,Quell CMake Reserved Target Warning,GregoryLundberg,2017-11-03 19:43:19+00:00,2017-11-06 18:32:28+00:00,{},"Renamed the target and binary for the Boost unit tests from `test` to `boost_unit_tests`

This quells warnings from CMake about reserved target names, and reduces confusion about which `test` is intended: the wesnoth executable or the standard shell command."
150400099,help: Handle traits with empty names or descriptions.,jostephd,2017-11-02 20:48:10+00:00,2017-11-03 07:11:09+00:00,{},"Fixes #2108.

`print_trait_list` is used for ""Traits (2): strong, quick, intelligent, resilient"" listing in the unit help pages."
150376221,Pathfind indexer,AI0867,2017-11-02 18:55:54+00:00,2017-11-21 18:12:43+00:00,{},
149795646,Fix Scons for SDL2_mixer 2.0.2,GregoryLundberg,2017-10-31 14:08:14+00:00,2017-11-01 08:54:18+00:00,{},"With the change from SDL_mixer 2.0.1 to 2.0.2, we cannot simply check if SDL_mixer can open an OGG/Vorbis file, we must first open an audio device. [This is probably a mistake, since the documentation implies simply initializing the codec should be enough.] To avoid future problems, upgrade the feature-test program to perform a full initialization and shut-down; everything except actually playing the sound.

Closes #2137"
149665002,"When movement points > vision points, don't reveal in the minimap hexes that can be moved to but aren't yet visible.",jostephd,2017-10-30 23:48:55+00:00,2017-10-31 16:20:10+00:00,{},"Fixes #1645.

It would be nice to have some UI indication (in the main map + minimap) that the unit can move into the shrouded area."
149640394,Fix highlighting reachable hexes when deselecting a moved unit.,jostephd,2017-10-30 21:19:00+00:00,2017-10-30 22:12:34+00:00,{},"If reach_map_ had been empty to begin with, reach_map_changed_ would
have been reset to false before display::process_reachmap_changes()
acted on it.

Fixes #2132."
149421115,Fix #2135: Honour the show_all_units_in_help preference during scenarios,jostephd,2017-10-30 01:46:04+00:00,2017-10-30 17:47:57+00:00,{},"Adding this overload removes a silent type conversion from 'enum scope'
to 'hk_scopes' (std::bitset<3>) in the src/help/help_impl.cpp callsite.

Fixes #2135."
149395046,Add missing autodoc comment,GregoryLundberg,2017-10-29 17:01:57+00:00,2017-10-29 17:02:05+00:00,{},[ci skip]
149394193,Fix editor help incomplete sentence.,GregoryLundberg,2017-10-29 16:44:34+00:00,2017-10-29 16:45:15+00:00,{},"Replace the sentence to make it clear the Starting Tool marks both the team leader, and named special, locations.

Closes #2085.

[ci skip]"
149392012,Remove unused function: set_visible_if_exists,GregoryLundberg,2017-10-29 16:00:30+00:00,2017-10-29 16:32:53+00:00,{},
149364257,Fix syntax and autodoc errors,GregoryLundberg,2017-10-29 02:07:41+00:00,2017-10-29 02:12:30+00:00,{},
149361211,T S02: Add a message about the status table,sigurdfdragon,2017-10-29 00:04:14+00:00,2017-10-29 17:41:00+00:00,{},Something I've thought would be useful to include in the Tutorial. Leaving open for a while for comments.
149360597,Tsg touchup,sigurdfdragon,2017-10-28 23:42:26+00:00,2017-11-15 12:46:16+00:00,{},@ln-zookeeper Let me know if you want any of these changed/removed.
149353975,[WIP]Slider refactor,gfgtdf,2017-10-28 20:32:52+00:00,2017-10-28 23:13:49+00:00,{},"this fixes #1539, #1641, #1656 and #1767

It also decouples the sliders class from the scrollbar class, the main reason for that is actually that there are some things about the scrollbar class that i am unsure about and i don't want to risk breaking them.


hmm ok there seems to be a off-by-one error somewhere, so this is not yet ready to be merged."
149334621,HttT S22: Grammar fix in Li'sar's dialog,jostephd,2017-10-28 13:01:54+00:00,2017-10-28 18:19:33+00:00,{},"Li'sar would use the nominative pronoun here, right?

Also, would Li'sar use the royal we here?  She considers herself the rightful queen."
149302357,Replace base build with use_srcdir option.,Pentarctagon,2017-10-27 23:01:45+00:00,2017-10-29 12:50:28+00:00,{},"This PR replaces the `base` build with the `use_srcdir` option, which can then be applied to all of the remaining build types.  It also replaces the use of `env` for the compiler/linker flag variables to make it consistent with what was initially requested [here](https://github.com/wesnoth/wesnoth/pull/2081#discussion_r143444015)."
149286501,HttT: fix grammar in Moremirmu's farewell,jostephd,2017-10-27 21:07:59+00:00,2017-10-28 00:24:35+00:00,{},"Add missing comma.  Also remove the word ""here"" because it felt redundant."
149032834,ignore Xcode 9 Index storage,hrubymar10,2017-10-26 20:08:11+00:00,2017-10-26 22:43:06+00:00,{},New Xcode 9 creates Index storage inside project dir. This commit makes this index ignored by GIT
148959782,Suppress unchecked return warning,GregoryLundberg,2017-10-26 14:58:24+00:00,2017-10-27 01:50:44+00:00,{},"Coverity has been complaining that a few uses of show_message do not have their return value checked.

Casting to void supresses these warning be documenting the value is intentionally not  checked.

This closes

CID 1380185
CID 1380186
CID 1380258"
148951393,Suppress warning about const variable,GregoryLundberg,2017-10-26 14:29:06+00:00,2017-10-27 00:58:21+00:00,{},Supress CID 1134314 about 'code' being constant. Remove 'const' if the TODO is ever done.
148759001,Finish switch to MT19937 for randomness,GregoryLundberg,2017-10-25 19:27:56+00:00,2017-10-25 22:28:25+00:00,{},"Coverity has been complaining about using rand() as an insecure function. As we're using it, this function is not insecure; but is also not a very good RNG. We're using MT19937 in a system-independant manner. But some uses of rand() were never converted. This converts them.

This closes the following Coverity issues:

CID 1356297
CID 1356299
CID 1356303
CID 1356304
CID 1356306
CID 1356312
CID 1356314
CID 1380163
CID 1380173
CID 1380179
CID 1380191
CID 1380198
CID 1380201
CID 1380210
CID 1380214
CID 1380215
CID 1380219
CID 1380230
CID 1380241"
148666942,Add support for PGO builds.,Pentarctagon,2017-10-25 13:26:05+00:00,2017-10-27 17:43:38+00:00,{},"Adds support for compiling with Profile Guide Optimization enabled to cmake and scons using GCC and Clang.  Before submitting I tested:
- the regular release build(-O3)
- LTO
- PGO
- LTO+PGO

On Mint 18.2:
- GCC 5.4: LTO+PGO failed with a compiler segfault.

On Ubuntu 17.10:
- GCC 7.2: All builds succeeded.
- Clang 5.0: LTO+PGO failed with a compiler error, `duplicate symbol: __llvm_profile_filename`"
148297025,campaignd: Blacklist standard reserved DOS Device Names,irydacea,2017-10-24 04:50:35+00:00,2017-10-24 21:39:56+00:00,"{'Enhancement': 1, 'Add-ons': 1}","Windows XP and later* define DOS device names for several system devices that will be handled as if they had directory entries everywhere. Their names may not be used on the left side of a file name if a dot is present, otherwise the read or write operation in progress (if applicable) is redirected to the device in question, with unexpected results (e.g. writing to `CON` writes to a console that may or may not be
attached, writing to `COM1` will send data through the first enumerated serial port, and so on).

Thus, we really don't want add-on authors to either intentionally or accidentally use them on non-Windows platforms and cause Windows-based clients to do unexpected things.

Emitting special messages for the UI in this case seems unnecessary and it'll be a waste of space most of the time since these names should crop up extremely rarely. Better just tell people what's up on a case-by-case basis if they decide to post in the forums about it.

\* (Yes, all Windows versions, really, although the DOS-based versions could have an arbitrary number of additional devices.)"
147974453,Deploy Cutscene Themes,sigurdfdragon,2017-10-22 03:59:02+00:00,2017-10-27 21:52:17+00:00,{},"Makes use of Cutscene and Cutscene_Minimal themes for all scenarios in mainline that I am aware would benefit from it.

There seems to be a slight graphical hiccup when switching to Cutscene mid scenario in the third commit."
147972480,Three carpet terrains ,doofus-01,2017-10-22 02:37:34+00:00,2017-11-12 02:15:23+00:00,{},"This initial commit is for terrain-graphics WML, image alignment, and demo only; images are unshaded place-holders.  This is in reference to issue #2088 . I tried to make the carpet a pseudo-overlay, so that true overlays (*^Blah) can still be used, as shown in this screenshot.
![carpets_000](https://user-images.githubusercontent.com/13510196/31857552-1a4868ae-b696-11e7-81a2-5c411c684c48.jpg)
I'll not try to make elaborately patterned Persian rugs, the purple will just have noisy texture.  I do plan to put more effort into shading the border, especially the right-angles, where some tassels would make sense.
"
147966601,desktop_entry: include high resolution icons,sevu,2017-10-21 22:56:53+00:00,2017-11-27 00:52:37+00:00,{},"I placed the new images in `packaging` and removed  the `icons` folder.
In case of scons the whole directory is copied, so the .desktop file had to go somewhere else.
16x16 is not using a downscaled icon, but a pixelart icon, which is wesnoth.org's favicon for this size.

It's temping to rename the icon to just wesnoth.png, however, this would have an effect on existing icon-themes on some distributions (which call the icon exactly like that, e.g. arch, but not debian/ubuntu)"
147964628,Add const to member functions,rikardfalkeborn,2017-10-21 21:55:42+00:00,2017-10-26 18:09:49+00:00,{},
147871800,Fix variable hides variable,GregoryLundberg,2017-10-20 18:59:12+00:00,2017-10-21 06:26:46+00:00,{},Introduced by 49d0af34
147091549,Case conflict filenames,AI0867,2017-10-17 16:30:39+00:00,2017-10-19 13:43:32+00:00,{},
146884393,AToTB: Full Set of Hints,sigurdfdragon,2017-10-16 20:45:35+00:00,2017-10-28 23:50:40+00:00,{},"Uses an expanded form of the hint macro from AOI and adds hints for each objective in the campaign.

S01-04 are separate commits in case changes are needed, I'll squash them later.

I'll leave this up at least a week for comments or suggestions on the hints."
146633685,[WIP] generalized sconce images - mostly ironing out mechaics at this point,doofus-01,2017-10-15 04:22:21+00:00,2017-10-16 15:47:33+00:00,{},"
![sconce_shot_009](https://user-images.githubusercontent.com/13510196/31581695-f3e5ec7e-b125-11e7-9d1e-08c0431fa055.jpg)
I'm not terribly proud of the individual images, but I'm wondering if there are objections to the overall mechanics.  If moving the formulaic animations into the engine (rather than exporting the images as was done for the original torch-lit stone walls) isn't too expensive, that's probably better for future modifications and is more in the 'open source' spirit. 
EDIT: Attaching a screenshot"
146617022,HttT: minor grammar tweak,jostephd,2017-10-14 19:12:49+00:00,2017-10-29 17:41:37+00:00,{},
146600956,extent fix for use team_color default without use numeric palette IDs.,newfrenchy83,2017-10-14 12:29:05+00:00,2017-10-25 22:34:42+00:00,{},"I know, a fix has be commits in game_initialisation\connect_engine.cpp but when i reload a scenario start save after delete numeric palette
	then i have not anymore default color but base color(magenta for image unit, green for flags).
	I propose to complete this fix in team.cpp.
	Save_index.cpp is modified equally for the same reason, but if i add leader_image_tc_modifier_alt,it's in case to leader image team_color is not magenta
	Then, as unknow-unit.png team color is always magenta i duplicate leader_image_tc_modifier.
"
146598686,Reconfigure 'select all' for texts in macOS.,ghost,2017-10-14 11:16:31+00:00,2017-10-27 04:15:05+00:00,{},Use the idiomatic combination.
146584627,Fix error: control may reach end of non-void lambda,GregoryLundberg,2017-10-14 03:27:28+00:00,2017-10-14 04:23:58+00:00,{},"If by_name and by_relation are both omitted, behave as if both were given: sort first by relation then by name."
146317068,Fix candidate visual bug in the announces system.,ghost,2017-10-12 21:17:10+00:00,2017-10-27 08:39:28+00:00,{},"I suspect there might be a bug in `master` since rev ad809a87571f. About a label that I remember from when I was young, and I am missing now.

Compare `master` behavior at 'https://youtu.be/h_cA_UDTGKQ' with the intention of the feature branch at 'https://youtu.be/eVxK8uNWOsg'.

See also http://github.com/wesnoth/wesnoth/pull/999 to which this follows up.

Cheers and regards,"
145888393,Add additional profilers to scons and the Profile build to cmake,Pentarctagon,2017-10-11 08:45:15+00:00,2017-10-21 17:54:50+00:00,{},"Adds the `profiler` option, which allows specifying:
- gprof (existing)
- gcov
- [gperftools](https://github.com/gperftools/gperftools)

gperftools also has a heap profiler/checker, but I wasn't sure if that was worth adding in as well."
145422950,Make Jarek from TSG loyal for consistency.,Arcanister,2017-10-09 10:53:38+00:00,2017-10-11 03:16:28+00:00,{},"All other units, which you get without recruiting in The South Guard are loyal. I think Jarek should be loyal too for consistency and because he is recalled by default in almost every single scenario. It should not affect difficulty significally."
145366419,Updated included Lua lib from 5.3.3 to 5.3.4,Vultraz,2017-10-09 02:29:36+00:00,2017-10-10 07:04:11+00:00,{},I followed the very helpful instructions provided by @GregoryLundberg to update to Lua 5.3.4. Also applied all currently available patches for [5.3.4 bugs](https://www.lua.org/bugs.html#5.3.4) on Lua.org (the second and third bugs listed had no patches).
145324325,some night-time village images,doofus-01,2017-10-08 07:34:25+00:00,2017-10-09 04:27:50+00:00,{},"Night-time TOD variations for villages, as well as some general variations. 
![screenshot_007](https://user-images.githubusercontent.com/13510196/31314849-0c50a440-abc0-11e7-9b01-f8251e0c56f4.gif)
"
145323684,Disallow backslashes in file paths,jyrkive,2017-10-08 07:07:19+00:00,2017-10-15 07:41:00+00:00,{},"The intent is to avoid UMC authors on Windows from accidentally using backslashes and making add-ons that won't work correctly on GNU/Linux and macOS.

IMO, this change is risky enough that we should merge it for 1.13.11, not 1.13.10."
145311476,terrain.cfg: Fix grammar in Rockbound Cave,jostephd,2017-10-07 22:23:58+00:00,2017-10-14 16:06:02+00:00,{},"Remove ""who"", add full stop."
145304352,"Remove Solaris support, improve glibcxx_debug support",Pentarctagon,2017-10-07 19:03:21+00:00,2017-10-09 16:58:25+00:00,{},"This PR:
- Removes support for building on Solaris from scons.  This support is currently non-functional.
- Replaces the `glibcxx_debug` separate build with a `glibcxx_debug=yes|no` option for the existing `debug` build.
- Adds building with the `glibcxx_debug` option to cmake.
- Adds a description of what the `profile` build is for to scons."
145187147,Do local checks before uploading to the addon server,AI0867,2017-10-06 15:52:03+00:00,2017-10-10 16:31:21+00:00,{},
145126513,Blacklist filename chars,AI0867,2017-10-06 11:07:31+00:00,2017-10-18 14:46:42+00:00,{},This PR (alternative to #2070) extends and expands the blacklist with the parts we could mostly agree on.
144816029,lol,ghost,2017-10-05 02:18:37+00:00,2017-10-05 03:25:06+00:00,{},
144599612,Mp test fixes,AI0867,2017-10-04 07:33:13+00:00,2017-10-05 12:35:09+00:00,{},
144291435,Fix crash when unable to find closest enemy.,PointMeAtTheDawn,2017-10-02 21:45:19+00:00,2017-10-04 03:10:50+00:00,{},"Sanity check - is it better to vet both levels? [if target && if target.x] ?

Or not necessary?"
144260150,Add case conflict check,AI0867,2017-10-02 19:12:09+00:00,2017-10-17 14:50:48+00:00,{},
144248030,Change allowed filename characters to whitelist,AI0867,2017-10-02 18:14:03+00:00,2017-10-27 21:00:43+00:00,{},
144115286,Add *.so to .gitignore,Arcanister,2017-10-02 06:02:02+00:00,2017-10-02 08:26:00+00:00,{},Shared Objects files should be ignored by git as well as DLL files.
144095234,Return to Wesnoth .ogg file,doofus-01,2017-10-02 00:10:06+00:00,2017-10-02 01:33:48+00:00,{},"Placing return_to_wesnoth.ogg (new main theme by Mattias Westlund) file in music folder for BfW 1.14, not wired in anywhere though."
144081176,new terrain variation - Elf castle ruins,doofus-01,2017-10-01 18:04:14+00:00,2017-10-08 07:29:05+00:00,{},"A few of the images need revision, but it's basically done.
![screenshot_elf_ruins](https://user-images.githubusercontent.com/13510196/31057472-33b4546e-a698-11e7-8dbd-c81d3f6434c2.jpg)
"
144055457,Delfador’s Memoirs Round 3 Fixes,sigurdfdragon,2017-10-01 04:21:11+00:00,2017-10-11 21:34:23+00:00,{},"I still have rebalancing for S09, 10, 18, and maybe 19 to add.
Otherwise this is mostly done, & I'll merge at that point if there are no issues.

"
144043038,"Removed Optimized build, improved gcc LTO support, add clang LTO support.",Pentarctagon,2017-09-30 20:23:40+00:00,2017-10-07 06:53:31+00:00,{},"This PR removes the `Optimized` build, instead allowing adding the same flags to the `cmake` and `scons` Release build.  This PR also therefore supercedes #2042 .

The `-s -flto` flags can be added to the Release build with the existing `enable_lto` option.  There is also a new option, `arch`, which allows setting what value to use for the `-march` flag.  If `arch` is not set, and the build is on Windows, then it will continue to default to `pentiumpro`, due to a previously found issue when using `tdm-gcc` and the `-O3` flag.

Clang is now also supported for building with LTO, using the `lld` linker.  In my testing however, this requires at least clang and lld version 5.  The latest Ubuntu LTS does not support building Wesnoth with clang at all, due to an ABI incompatibility with the system packages that were built with gcc.  Recent clang versions prior to version 4 will not work, due to someone apparently forgetting to include the required `LLVMgold.so` shared library.  Clang 4 also will not work due to some bug in clang, where the linker is not able to read the LTO files the compiler generated.

Additionally, the LTO stage is now multi-threaded, which should speed up build times considerably.  For `scons` and gcc, it will re-use the `jobs` option when setting up `-flto=n` where `n` is the number of threads LTO will use.  For `cmake` and gcc, there is the new `LTO_JOBS` variable, since the number of jobs for compiling is passed to `make` rather than set by `cmake`.  For clang, it will use `-flto=thin`, [which is not just a multi-threading change](https://clang.llvm.org/docs/ThinLTO.html), but should provide most-to-all of the same benefits.

I have tested these as building a working a working executable for:
- Mint 18.x(based on Ubuntu 16.04), with gcc 5.4
- Ubuntu 17.10(the daily iso, since it hasn't been released yet), with gcc 7 and clang 5."
144031049,[terrain_graphics] fill in Ke* gaps,doofus-01,2017-09-30 14:46:21+00:00,2017-09-30 23:02:15+00:00,{},"Fills in some gaps with Ke* terrains, so they are more like Ce*.  Basically replace C* filter with !,Ket,!,C*,Ke*
![screenshot_campwalls_fix](https://user-images.githubusercontent.com/13510196/31046757-5f692660-a5b3-11e7-971a-8f772f385e0b.gif)
"
144028024,[terrain_graphics] chasm transitions to lower layer,doofus-01,2017-09-30 13:08:57+00:00,2017-09-30 23:39:47+00:00,{},"moving all chasm transitions to lower layer -290 from -90, not just those next to I* or Xo* terrain"
144009040,Fix enemy [best] moves vanish on mouse move when mouse landed on unit,ghost,2017-09-30 02:23:54+00:00,2017-10-12 07:28:33+00:00,{},"When selecting in UI, using mouse, `show [best] enemy moves`, on a cluttered battlefield, probably mouse will land on an unit.

That be the case, when the user moves the mouse, even just a single pixel; best enemy moves highlights vanish.

This is a first try to cope with the problem. When cursor is landing on an unit, unit normal highlight gets prevented until mouse reaches an hex where there is no unit. The user can now be sure best enemy moves will not accidentally vanish when dealing with cluttered battles, while s/he can still de-highlight them straightforwardly whenever wanted.

There are field visibility and protection decisions here, that I decided not to take but delegate on the PR reviewer, that in the end of the day is more used to cope with these classes and will know better if the changes in field protection in 668363318d are desirable.

Cheers and regards,"
143862945,Fix Jarek last breath message,Arcanister,2017-09-29 11:10:46+00:00,2017-09-29 11:59:30+00:00,{},"There is a scenario, where you have Gerrick as leader, while Deoran is left behind. Perhaps dialogue could be made better, so Jarek tells something to Gerrick instead."
143854928,Teach wmlscope to ignore frame durations. Fixes #2045,AI0867,2017-09-29 10:23:23+00:00,2017-10-15 18:40:11+00:00,{},
143751473,wmlscope: Fix the output by --progress.,ePaul,2017-09-28 20:45:31+00:00,2017-10-05 16:35:39+00:00,{},"Previously, this just printed the last file name again and again.
Now we are printing the file name we are currently looking at.

This can be observed e.g. by `wmlscope --progress`.
Potentially other WML tools are affected too."
143216968,On Boost: update build scripts and documentation.,ghost,2017-09-26 19:02:34+00:00,2017-10-06 17:38:51+00:00,{},"At branch 'doc-from-discord-boost-discussion-20170926'.

The build documentation and scripts were slightly out of date about
Boost. This commit makes an interim update to them.

(CMakeLists.txt|SConstruct): `wesnoth` won't build using Boost lesser
than '1.50.0'. Boost 1.50.0 changed the location of version 3 of Boost
filesystem, from 'boost/filesystem/v3/' (e.g. for
'using boost::filesystem::v3::path;') to 'boost/filesystem/' (e.g. for
'using boost::filesystem::path;', enforced since the very introduction
of 'src/filesystem_boost.cpp'), making it incompatible unless using
precompiler directives for supporting backwards versions of Boost
filesystem prior than '1.50.0'. Using Boost 1.50.0 builds, but
segfaults on start up (in my mileage) (Valgrind hints about
'boost::detail::sp_counted_base'). I have not yet checked any more
than a single mileage, so I am not completely sure 1.50.0 is to be
discarded. In my mileage using Boost 1.51.0 makes the game boot and
saves able to load normally.

(INSTALL|projectfiles/VC12/README).md: Requirement of Boost libraries
 up to date.

.gitignore: Add KDevelop backup documents."
143211483,campaignd: Send uploading clients a list of illegal names when any are found,irydacea,2017-09-26 18:39:10+00:00,2017-10-05 00:32:32+00:00,"{'Enhancement': 1, 'Add-ons': 1}","(See issue #2043.)

It wouldn't be proper to stuff the full list into the conventional error response, so in order to provide clients with the means to report it in a better fashion in the future (a la WML load errors report dialog, with a fancy scrolling box and an option to copy the report to clipboard and stuff), we're attaching it as an `extra_data` attribute in the `[error]` response. Naturally, only clients that are aware of its existence can handle it, so this whole patch is completely unsuitable for 1.12.

Still, some level of backwards compatibility is retained -- the `[error]` continues to be perfectly functional for incompatible clients (e.g. 1.13.10), and the details are simply missing for them.

The list would currently look like this:

```
Test_Addon_420/~illegalname
Test_Addon_420/testdir/illegal name 2
Test_Addon_420/testdir/illegal~dir~name/
```

The required client-side changes for handling the `extra_data` attribute and displaying its contents are included in this patch, but the GUI changes are very rudimentary and should be considered more of a proof-of-concept than a final solution, which I'll leave to someone who actually groks GUI2 as it is right now and is an active developer in the first place, which I am not.

![fdfsdfds](https://user-images.githubusercontent.com/489895/30878158-5fa96150-a2d2-11e7-8b83-940a989b3a5c.png)

Also note that the only reason the second parameter for `check_names_legal()` is optional is that the function is also used client-side by `addons_client::install_addon()`, which really doesn't need to waste time building a full report of invalid names -- add-ons containing those aren't supposed to make it to the server in the first place, and the client-side check only exists as an extra safeguard."
142954322,Added clarification for enable_lto at shadowm's request,Pentarctagon,2017-09-25 18:38:33+00:00,2017-09-30 06:10:57+00:00,{},Not much else to say about it.
142800312,"[terrain_graphics] Castle neighbor bleed-through (sand, snow) ",doofus-01,2017-09-25 05:53:11+00:00,2017-09-30 23:03:37+00:00,{},"This should fix some graphics glitches, where neighbor terrain transitions bleed through under the castle walls.  Example in the attached image.
![castle_transitions_dust](https://user-images.githubusercontent.com/13510196/30794039-c58f0154-a17a-11e7-9bef-f6c230f1efdc.gif)

And yeah, the commits should be squashed.
"
142776559,Troll (or rough stone?) encampment terrain variation,doofus-01,2017-09-24 23:45:09+00:00,2017-10-01 00:00:22+00:00,{},"There may be some touch-ups needed in the future, but I don't think there is anything broken, and it should be safe to commit.  One thing that's just occurring to me now is that the terrain code is Cte/Kte, which might be too similar to the ""terrain archetype"" Ct/Kt.  Or maybe it doesn't matter.

EDIT:  Forum post with screenshot -> https://forums.wesnoth.org/viewtopic.php?f=9&t=24491&p=617606#p617606"
142714470,adding hide_help key to gates terrains,doofus-01,2017-09-23 13:39:37+00:00,2017-09-24 02:37:46+00:00,{},"this should fix issue #1990 
I'll merge it and close that issue, if no one objects soon."
142647966,fix filters using this_unit in [hides],gfgtdf,2017-09-22 19:03:10+00:00,2017-10-16 15:56:11+00:00,{},"args.loc is the location we use for 'filter as if the unit woudl be there', still the unit is curently at args.u.get_location() so to make scoped_xy_unit  find the unit we have to give args.u.get_location()"
142559249,don't throw network_error if we still have incoming data queued,gfgtdf,2017-09-22 11:40:40+00:00,2017-09-22 14:18:53+00:00,{},previously if the the server closed the connection it could happen that wesnothd_connection::receive_data threw an exception before the last package was processed which would break wesnothd redirection.
142455784,fix hitpoints being restored by heal_full after modifications expire,newfrenchy83,2017-09-21 21:59:56+00:00,2017-10-07 06:58:14+00:00,{}," when an object expire in mid scenario, then hp=max_hp, it's not very logic and use of object duration turn  end turn is impossible."
142392533,extent fix halo to advance debug and create_unit and put_unit,newfrenchy83,2017-09-21 16:43:51+00:00,2017-10-04 04:35:10+00:00,{},i expect what it is not spacing problem
142370850,"fix halo remain for advancement, normal kill and lua function",newfrenchy83,2017-09-21 15:13:16+00:00,2017-09-21 16:38:58+00:00,{},"jyrkive did'nt apply his soluce for all kill unit, and advance unit and unstore_unit are also an problem to remain halo."
142288655,Fix for error: unused typedef in Xcode builds,hrubymar10,2017-09-21 08:53:47+00:00,2017-09-21 18:26:22+00:00,{},"This PR fixes this:
```
10:43:06 In file included from /Users/user/.jenkins/workspace/Wesnoth/src/color_range.cpp:24:
10:43:06 In file included from ../../src/map/map.hpp:22:
10:43:06 In file included from ../../src/terrain/translation.hpp:29:
10:43:06 In file included from Headers/boost/multi_array.hpp:21:
10:43:06 In file included from Headers/boost/multi_array/base.hpp:28:
10:43:06 Headers/boost/multi_array/concept_checks.hpp:42:43: error: unused typedef 'index_range' [-Werror,-Wunused-local-typedef]
10:43:06       typedef typename Array::index_range index_range;
10:43:06                                           ^
10:43:06 Headers/boost/multi_array/concept_checks.hpp:43:37: error: unused typedef 'index' [-Werror,-Wunused-local-typedef]
10:43:06       typedef typename Array::index index;
10:43:06                                     ^
10:43:06 Headers/boost/multi_array/concept_checks.hpp:53:43: error: unused typedef 'index_range' [-Werror,-Wunused-local-typedef]
10:43:06       typedef typename Array::index_range index_range;
10:43:06                                           ^
10:43:06 Headers/boost/multi_array/concept_checks.hpp:54:37: error: unused typedef 'index' [-Werror,-Wunused-local-typedef]
10:43:06       typedef typename Array::index index;
10:43:06                                     ^
10:43:06 4 errors generated.
```"
142090132,Implement RWops write functionality,AI0867,2017-09-20 12:48:17+00:00,2017-09-21 10:42:28+00:00,{},
141974319,"extent the fix halo remain to advance, attack kill_unit debug_unit,create_unit and put_unit",newfrenchy83,2017-09-19 22:47:52+00:00,2017-09-21 15:14:09+00:00,{},"jyrkive forget to extent the fix halo remain to advance and attack.cpp, or all modification calling and units().erase function. I request this commit for repair this."
141506638,"add an ""optional objective"" caption",sevu,2017-09-17 23:06:13+00:00,2017-11-01 01:45:22+00:00,{},"This adds one more caption macro for [objective]s

Currently there are:
 - no caption, shows under ""Victory""
 - ""alternative objective""
 - ""bonus objective""

Scenario 7a in TSG is an example where none of them fits:
_""Meet with and pay the troll leader 100 gold to receive their help""_
- it's not a win condition (it was set up like this previously)
- nor an alternative to the win condition 
- bonus sounds like you should do this, everybody wants a ""bonus"".

Optional would be the right word. Though I'm not sure about the wording, if ""optional objective"" or just ""objective"". Into German I would translate it as just ""optional""."
141506054,fixes to some tiles Irs and addition of basic clean walls variation Xoc,doofus-01,2017-09-17 22:48:51+00:00,2017-09-21 02:24:48+00:00,{},"![clean-shot](https://user-images.githubusercontent.com/13510196/30525659-8d3680cc-9bbf-11e7-8e9e-765b7325a43c.jpg)I think this fixes the problems with Irs terrain, and adds a stone walls variation that goes with the stone tiles.
"
141440635,Wrap SDL_RWops* in std::unique_ptr,AI0867,2017-09-16 09:43:57+00:00,2017-09-20 03:46:51+00:00,{},
141249913,Add new Czech translators,hrubymar10,2017-09-15 07:58:00+00:00,2017-09-17 11:14:29+00:00,{},This PR adding 2 additional Czech Translators into credits section.
141228995,TSG S3: fixes in the story logic,sevu,2017-09-15 05:01:38+00:00,2017-09-16 21:28:49+00:00,{},"- Ethiliel's sprite is a Shyde
- On easy difficulty the player didn't fight undeads

What do you think about this string changes?
Please post if you have an better wording in mind."
141069790,Add coverity badge to README.md,AI0867,2017-09-14 13:08:25+00:00,2017-09-15 00:19:33+00:00,{},
140962358,DM fixes round 2,sigurdfdragon,2017-09-14 01:07:14+00:00,2017-09-18 18:08:40+00:00,{},"This improves scenario difficulty on S21 & 22, though it is still quite beatable on hard with a reasonable recall.

The last breath added for S21 works but seems unlikely to get used in normal play.

I'd like thoughts on the missing book commit as far as story goes.

I may have more, though I could get these changes for S21 & 22 in for 1.13.9"
140551754,corecction of error writing and fix expire_modification in unit.cpp,newfrenchy83,2017-09-12 11:15:53+00:00,2017-09-12 14:29:09+00:00,{},when expires modifications hitpoints =max_hitpoints. In mid-scenario is illogic; i propose a fix for correcting this.
140216907,Fix text keys bound to scrolling hotkeys causing stuck scrolling (#1864),CelticMinstrel,2017-09-10 17:15:13+00:00,2017-09-13 23:58:06+00:00,{},This appears to fix the scrolling hotkey issue.
140182092,Fix Coverity null dereferenced warning,GregoryLundberg,2017-09-09 19:34:16+00:00,2017-09-17 12:53:33+00:00,{},"It is probably not possible for cur to be nullptr, but best check anyway.

Closes CID 1380176"
140181789,Fix Coverity divide-by-zero warning,GregoryLundberg,2017-09-09 19:24:40+00:00,2017-09-17 12:53:20+00:00,{},"Closes CID 1380221

Instead of assert() simply skip the animation."
140181001,Fix Coverity Warning: dead code,GregoryLundberg,2017-09-09 19:00:33+00:00,2017-09-10 04:53:37+00:00,{},Closes CID 1380203
140177312,Fix Coverity Uninitialized Scalar Warnings,GregoryLundberg,2017-09-09 17:11:14+00:00,2017-09-17 12:52:53+00:00,{},"Coverity notes that SDL_UserEvent.windowID is never initialized. Initializing to 0 on the assumption that it means 'no window' (SDL comment says 'if any', which indicates there may be a 'none' value and zero is a good guess for that).

This closes

    CID 1380246
    CID 1380234
    CID 1380159
    CID 1380152
    CID 1356356

Earlier commit for these warnings only fixed the timestamp. Checked there are no additional scalars for this commit and it should not expose additional warnings."
140175005,halo persistent and alternate soluce for Mage of light halo,newfrenchy83,2017-09-09 16:08:17+00:00,2017-09-11 18:39:30+00:00,{},"
after ac.unit_halo_ = halo_man.add( 0, 0, u.image_halo()+u.TC_image_mods(), map_location(-1, -1));
paste halo_man. set_location (ac.unit_halo_, x, y - height_adjust); and halo bug resolve without artefact when 2 mage of light adjacent after move."
140162621,Credits: move Jyrki to the list of primary developers,jyrkive,2017-09-09 09:00:31+00:00,2017-09-09 11:40:20+00:00,{},"Quite simply I find I have done enough to warrant being there instead of the long list of ""Miscellaneous Contributors""."
140131886,resolve halo persistent,newfrenchy83,2017-09-08 21:46:46+00:00,2017-09-09 15:46:30+00:00,{},"When a unit die, this halo is not erased but persist until another unit select.  The weird spacing are accident. Please ignore or correct this and forgive me but github is new for me"
140131378,Display actual FPS,AI0867,2017-09-08 21:43:22+00:00,2017-09-11 05:38:22+00:00,{},"That is, not calculated FPS, but the actual number of frames rendered during the previous second."
140092311,other resolves for Mage of Light halo and persistant halo when unit die or advance,newfrenchy83,2017-09-08 17:54:07+00:00,2017-09-08 18:46:03+00:00,{},"When 2 mage of light ate adjecent, halos are affected, reverse the change and modify drawer.cpp resolve this bug"
139408049,Fix Coverity Warning - Uninitialized,GregoryLundberg,2017-09-05 19:58:55+00:00,2017-09-05 20:25:51+00:00,{},"Closes
    CID 1380147

Message was date_result.month was not initialized. Added initialization."
139152795,"wreath images snipped, according to level",doofus-01,2017-09-04 12:59:45+00:00,2017-09-05 04:14:46+00:00,{},"This is just a tweak to two of the wreath images, so the wreath branches get longer as you move from bronze->silver->gold"
139067412,stone tile floor terrain,doofus-01,2017-09-04 00:17:49+00:00,2017-09-17 19:06:47+00:00,{},"Take 2 at the stone floor.  This isn't finished, it only has the most basic transitions so far.
But I think the problems with #1936 are addressed, at least.
EDIT: and here is a forum link with screenshot:https://forums.wesnoth.org/viewtopic.php?f=9&t=24491&p=616880#p616880
EDIT2:  With the second commit, the transitions are improved, the base images are more varied.  I think this terrain is usable now, even if more transitions would be nice."
139052395,prevent crash in case of faulty WML in mainline content (#1899),sevu,2017-09-03 16:06:09+00:00,2017-09-04 10:29:09+00:00,{},"proposed fix for #1899 
Crashes don't happen again.
Still getting the wml error message thrice.
Aside from that, are there code formatting issues?"
139031601,"new terrrain: light flagstones (or ""rough"" flagstones?)",doofus-01,2017-09-03 00:54:03+00:00,2017-09-03 16:38:27+00:00,{},"I thought there could be more variation in floor-types.  I was trying for something other than a square version of the cobbles, but these might be too slab-like.

Only the six basic transitions so far, not yet ready to merge.  

EDIT: Forum post with screenshot: https://forums.wesnoth.org/viewtopic.php?f=9&t=24491&p=616829#p616829"
139027806,HttT: Remove no longer needed trait_undead,sigurdfdragon,2017-09-02 21:59:12+00:00,2017-09-02 22:17:56+00:00,{},"This used to be needed here so trait order would be in harmony when other
undead units were made with LOYAL_UNDEAD_UNIT, but that macro has been
deprecated and replaced here with LOYAL_UNIT. Thus, the removal
restores the harmony.

Assigned to current maintainer."
139019066,AToTB S01: Grammer Fix,sigurdfdragon,2017-09-02 16:59:00+00:00,2017-09-02 19:21:38+00:00,{},"Suggested here: https://forums.wesnoth.org/viewtopic.php?f=40&t=10334&start=45#p586212


I'm not sure if this is correct or not, can be merged if someone else agrees with it."
139018969,Coverity Fixes - Uninitalized SDL_UserEvent timestamp field,GregoryLundberg,2017-09-02 16:56:22+00:00,2017-09-04 10:30:02+00:00,{},"Closes
    CID 1380246
    CID 1380234
    CID 1380159
    CID 1380152
    CID 1356356"
138340008,Preprocessor cleanup pass 2,Vultraz,2017-08-30 05:32:46+00:00,2020-09-22 22:17:54+00:00,{},
137974410,Preprocessor cleanup,Vultraz,2017-08-28 15:33:13+00:00,2017-08-29 12:11:11+00:00,{},"Ignore the first commit (and don't view the unified diff, you won't get anything out of it). Mostly some work to make the memory management of the preprocessor saner, as requested by @jyrkive. Currently crashes on startup :("
137850657,ruined version of encampment terrain,doofus-01,2017-08-27 22:18:51+00:00,2017-08-27 23:40:30+00:00,{},"Not sure if the contrast is too high, especially the skulls.  Maybe the skulls shouldn't even be there.
EDIT: forum link with screenshot
https://forums.wesnoth.org/viewtopic.php?f=9&t=24491&p=616688#p616688"
137809493,Starting from 10.12 was 'OS X' renamed to 'macOS',hrubymar10,2017-08-26 19:34:43+00:00,2017-09-02 07:47:41+00:00,{},
137782132,Fix autodoc error: missing tparam name,GregoryLundberg,2017-08-26 02:27:02+00:00,2017-08-26 02:29:28+00:00,{},
137587458,Fix warning: extra semicolon,GregoryLundberg,2017-08-25 02:12:30+00:00,2017-08-25 04:30:55+00:00,{},
137292660,fix [random_placement] distance key,gfgtdf,2017-08-23 18:57:06+00:00,2017-08-23 20:14:08+00:00,{},"currently distance=n means: 'when a location was selected remove all loctions that have distance at most n to the selected location from further results'. This imples that all remaining locations  have distance _more_ that n (instead of '_at_least_ n'). This commit fixes that.

This pr is not not complete since mainline cfg files still need to be updated. It's ust for the discussion of this change"
136673122,Fix grammar in Merman Netcaster description,jostephd,2017-08-21 03:05:27+00:00,2017-08-21 12:31:36+00:00,{},Similar to #908.
136649771,Tutorial part 2: resolving conflicting attack_end events,sevu,2017-08-20 16:40:34+00:00,2017-09-04 10:26:43+00:00,{},"There are two conflicting attack_end events in the 2nd part of the tutorial, one of them is first_time_only. 
The way it was first the dumbo event was triggered, and afterwards an _Ouch, I got retaliation damage_  event.

In the hope to keep the code more readable I moved some filters to the manually fired event."
136630686,Quite a lot of GUI2 refactoring,Vultraz,2017-08-20 04:41:47+00:00,2017-08-25 23:49:07+00:00,{},Mostly related to widget initialization.
136345460,Fixed Xcode project build,hrubymar10,2017-08-17 20:25:40+00:00,2017-08-20 02:38:13+00:00,{},"I added new source files and removed old ones.
Xcode project now works"
136327869,Filter refactor,gfgtdf,2017-08-17 18:53:05+00:00,2017-08-27 20:05:46+00:00,{},"This refactors the unit filter so that it now parses as much as possible when the filter is created to speed up the filter::matches function. This also make the provious optimisation of havign a 'nil' filter unnecessary.

Also i did comepletey reworite these files so looking at the diff probably won't be handy.
"
135899532,Mark member functions const,rikardfalkeborn,2017-08-15 21:47:39+00:00,2017-08-19 21:50:08+00:00,{},
135482019,Enable sorting campaign list in chronological or lexicographical order,CelticMinstrel,2017-08-13 04:51:24+00:00,2017-08-14 16:40:14+00:00,{},"I wasn't planning to open a PR for this, but I discovered that it won't build on Travis due to link errors, and I'm not sure how to fix them. Does anyone have any suggestions? I added the new source file to the ""wesnoth"" source list, but that doesn't seem to be sufficient?"
135242356,New player guidance,sigurdfdragon,2017-08-10 23:18:46+00:00,2017-08-26 01:13:33+00:00,{},"Posting for comments on suitability, especially for tutorial change.

This goes along with beginner campaign reordering in a273a8df25f1721b0029e83d9d2b17dfb3127f11

Will merge in about a week if no objections.
"
134660879,[1.12] cmake: Fix 'missing-DSO' error when linking against boost_filesystem,susnux,2017-08-08 13:30:50+00:00,2017-08-09 08:18:21+00:00,{},"When building on Linux I ran into this error:

> error: error adding symbols: DSO missing from command line
> -1: error: main.o: undefined reference to symbol '_ZN5boost6system15system_categoryEv'

So this means you have also to link against boost_system when linking against boost_filesystem (boost 1.54, tested on openSUSE Leap 42.2, 42.3 and Tumbleweed with gcc 4.8 and 7)."
134502856,save current gui location in savegames,gfgtdf,2017-08-07 18:52:07+00:00,2017-08-08 13:43:19+00:00,{},
134300351,Reorder beginner campaigns to be more friendly to new players,sigurdfdragon,2017-08-05 18:23:04+00:00,2017-08-07 14:20:41+00:00,{},"Order of AToTB, AOI, TSG, HttT

Based on discussions from IRC & https://forums.wesnoth.org/viewtopic.php?f=12&t=46102

I'm planning to add dialog about use of impact weapons in AToTB S1, & make comments about beginner campaigns more generalized in tutorial S2"
134290667,Fix a few messages from VC static analysis,GregoryLundberg,2017-08-05 12:38:03+00:00,2017-08-05 16:34:54+00:00,{},"Using ""Microsoft All Rules"" but not enabling lifetime evaluation results in just a few warnings which can be fixed.

The remaining messages are in the upstream Lua and Boost packages. A couple are related to Visual C/C++ static analysis bypassing checks on OpenMP-specific code."
134263571,Center viewport on zoom,DisherProject,2017-08-04 22:43:28+00:00,2017-08-05 17:13:37+00:00,{},This should fix issue [#1845](https://github.com/wesnoth/wesnoth/issues/1845).
134206292,Fix warnings about missing function prototypes,GregoryLundberg,2017-08-04 16:38:17+00:00,2017-08-05 01:36:39+00:00,{},
133511061,better tracking of the units vialos need to be updated during a move fixes #1565,gfgtdf,2017-08-01 16:01:46+00:00,2017-08-01 21:20:10+00:00,{},
133144144,"[Complete in first approximation] iOS and general touchscreen support, pass 4",singalen,2017-07-30 21:43:21+00:00,2017-12-02 03:24:01+00:00,{},"Applied review notes from PR #1742, #1748. Reincarnation of PR #1752 rebased onto current master.

It is STILL not in a shape I'd like to see it, but it's playable on a touchscreen.

Known problems: https://github.com/singalen/wesnoth/labels/bug"
133115179,Updates to ancient scenery and items images,doofus-01,2017-07-30 03:51:03+00:00,2017-07-30 15:53:36+00:00,{},"This PR isn't a grand project, but its purpose is to touch-up some very, very, old images in core/images/scenery/ & items/ directories.  There are some new variations as well.  The shipwreck and castle-ruins images were used heavily in two mainline scenarios, so I added the variations to those, so there isn't a repeating pattern, like there currently is."
133109437,travis: switch to trusty,matthiaskrgr,2017-07-29 23:00:30+00:00,2017-07-30 11:31:22+00:00,{},"Travis is going to migrate from ubuntu precise (current default) to ubuntu trusty (to-be default) soon.
Switch to trusty now to make sure nothing gets broken by accident."
132874233,Unused expression result,GregoryLundberg,2017-07-28 00:43:25+00:00,2017-07-28 02:46:03+00:00,{},clang reports a warning. This appears to be a missing return. Originally fell through resulting in null pointer reference.
132873649,[store_unit_defense] WML tag,Smok94,2017-07-28 00:36:28+00:00,2017-07-29 00:34:55+00:00,{},"Stores in variable the defense of a unit on a particular terrain. If terrain is not specified, the terrain on which the units currently stands is used. (Note: it is a WML defense, so the higher it is, the weaker unit's defense is.)

* StandardUnitFilter
* loc_x, loc_y: x and y of terrain location.
* terrain: alternatively, the character of terrain.
* variable: the name of the variable into which to store the defense. default: ""terrain_defense"""
132655532,Use UTF8 length to decide if a TEXTINPUT is a hotkey (should fix #1855),CelticMinstrel,2017-07-27 02:53:04+00:00,2017-08-02 17:10:52+00:00,{},"This is an attempt to fix #1855 which is caused by non-ASCII characters being produced by single keys. I'm not entirely sure this is the right approach, however."
132425468,DM Minor Fixes,sigurdfdragon,2017-07-26 03:50:26+00:00,2017-07-29 18:21:09+00:00,{},A first round of fixes.
132421227,Corrections for clang autodoc comments,GregoryLundberg,2017-07-26 03:01:13+00:00,2017-07-27 02:16:21+00:00,{},
131955808,"add [cancel_action], implements #1427",gfgtdf,2017-07-24 00:47:55+00:00,2017-07-25 19:19:06+00:00,{},"this adds a new tag [cancel_action], it currently only has an effect in
move actions. It can be used in enter_hex/exit_hex events to abort the
current movement, It can also be used in moveto events there is just
cancels possible following attacks if the user issued a move+attack
action.

This also changes the behaviour of moveto and enter/exit_hex event so
that they now no longer cancel the movement automatically, also
[allow_undo] no longer has an effect on whether the move is cancelled,
it only allows undoing of the move."
131940398,Updated Xcode project.,hrubymar10,2017-07-23 16:37:02+00:00,2017-07-23 17:02:05+00:00,{},I added missing function_gamestate.*pp files inside Xcode project.
131939752,Add revision info inside macOS releases.,hrubymar10,2017-07-23 16:15:21+00:00,2017-07-25 23:56:23+00:00,{},"I added 'autorevision.sh' script inside Xcode project. Now all targets (Release and DEBUG) will contain revision number.
I can remove it for Release targets if you want.
This script is used in CMAKE 'project' and I just added it also to Xcode project."
131929361,Removed duplicates inside project file.,hrubymar10,2017-07-23 10:26:41+00:00,2017-07-23 14:56:04+00:00,{},Xcode gaves me long time ago hint that these duplicates exists in project. So I removed them.
131913993,Updated Xcode project for macOS targets,hrubymar10,2017-07-22 21:51:05+00:00,2017-07-22 23:28:51+00:00,{},I updated Xcode project for building accelerated_rendering branch on macOS.
131910240,touch-ups and variations to desert mountains terrain,doofus-01,2017-07-22 19:32:59+00:00,2017-07-26 08:58:18+00:00,{},"Screen shot on forums:
https://forums.wesnoth.org/viewtopic.php?f=18&p=615594#p615594"
131910193,attempt to fix #1473: cannot step on hexes with high movecosts,gfgtdf,2017-07-22 19:31:38+00:00,2017-07-25 19:11:10+00:00,{},
131603398,Set village income and support to their expected default values in mp games,DisherProject,2017-07-20 16:58:24+00:00,2017-07-26 14:31:23+00:00,{},"This should fix issue [#1814](https://github.com/wesnoth/wesnoth/issues/1814). 
Village gold and village support are given their values here, so in case one has map settings enabled these two variables wouldn't be set. If this happens, they assume their default value (= 1) [when the teams are built](https://github.com/wesnoth/wesnoth/blob/master/src/team.cpp#L187). 
Anyway, ""use_map_settings"" is already checked by the [gui](https://github.com/wesnoth/wesnoth/blob/master/src/gui/dialogs/multiplayer/mp_create_game.cpp#L716) in the lobby, so removing this if-clause should still produce the expected behaviour."
130726877,revisions to portals or gates terrain,doofus-01,2017-07-15 19:24:47+00:00,2017-07-30 17:22:18+00:00,{},"I think the ""auto-orientation"" of the gates terrain was a nice idea, but it wasn't really working.  I've split the orientations into separate terrains, like the bridges.  That is annoying in how it occupies 3 x 2 x (# of types) buttons in the terrain selection panel, but it gives the map-maker more control, so I believe it is a net improvement.

I've added end-caps for if the gate isn't next to a wall (affects nw, ne).

The old terrain codes still exist, so maps can still be loaded and updated, if necessary.

Known issues:
~~Some of the images here are place-holders.~~
Putting rusty and wooden gates next to each other can clash, but I don't know how much that matters.
EDIT: these formatting codes are annoying."
130003993,Fix insert index of the text edited by IME,fujimo-t,2017-07-11 20:57:39+00:00,2017-07-12 01:09:05+00:00,{},"First argument of std::string::insert() is byte index but ime_start_point_ is num of characters.
So, if multi-byte characters is included text_cached, the text edited by IME is inserted wrong position.

This fixes the problem above."
129501778,Fixed Bug#1829 Name filters are applied with type and status filters,donovanamitchell,2017-07-07 22:53:28+00:00,2017-07-12 10:36:11+00:00,{},Fixes #1829. Additionally fixes issue where changing the type or status filters would ignore name filters and vise versa. I don't think there is an existing issue for this. Creates a get_name_filter_visibility function which returns the set of addons with a matching name. The apply_filters function applies name filters in addition to type and status.
128534636,Fixes to Code::Blocks compilation,DisherProject,2017-07-02 21:28:10+00:00,2017-07-09 06:26:50+00:00,{},"I recently tried to compile Wesnoth using Code::Blocks and i got stuck due to a couple fo issues. 
Anyway, i'm not completely sure that replacing ""strnlen"" in this way is the best chioce."
128288806,[don't merge] [animate_unit] Insure a direction is returned if locations are identical,sigurdfdragon,2017-06-30 03:22:15+00:00,2017-06-30 16:16:21+00:00,{},"This is to fix an issue with SotA S10 & S15 and likely other campaigns or add-ons, by restoring 1.12 behavior. (providing a direction if locations are the same)

S 15_Mountain_Pass.cfg line
if Ardonna (line 190) is located at 16,21 (line 194)
This error happens: https://forums.wesnoth.org/viewtopic.php?f=4&t=46480

There's also a version in S10.

This may not be the best way to fix this.

"
127375196,Fix variable hides variable,GregoryLundberg,2017-06-25 19:32:56+00:00,2017-07-25 23:56:48+00:00,{},
127373765,Bug#1800,donovanamitchell,2017-06-25 18:47:06+00:00,2017-07-26 16:41:22+00:00,{},"Fixed Bug #1800 
The addon list is no longer redownloaded every time an addon is added or removed. The addon list is downloaded once when the addon manager is opened."
127325013,Added support for a facing= key in [recall],ln-zookeeper,2017-06-24 09:54:39+00:00,2017-07-12 19:02:16+00:00,{},"Seems to work, but review wouldn't hurt, especially that I didn't miss anything as far as syncedness goes.

P.S. Should be squash-merged to get rid of the extraneous merge pull request commit I used to bring the fork's master up-to-date."
127133776,[Don't Merge Yet] Fix unit_placed firing in lua put_unit,sigurdfdragon,2017-06-23 04:46:49+00:00,2017-06-26 14:18:53+00:00,{},"wesnoth.put_unit(unit, cfg.x, cfg.y) will not trigger unit placed
wesnoth.put_unit(cfg.x, cfg.y, unit) will trigger unit placed (but is deprecated)

wiki says unit placed should fire for all uses of lua put_unit (except erase obviously)
However, the put_unit code makes a distinction between new units and already existing units (and seems to intend to fire unit_placed for only for existing units) so I'm thinking maybe the wiki should be changed slightly.

I'm not sure if this is the correct fix, & haven't tested it yet.

"
127132311,Fixup lua unit.upkeep getter,sigurdfdragon,2017-06-23 04:25:28+00:00,2017-06-24 00:19:34+00:00,{},"Without this, values full, loyal, & free will cause ""unknown upkeep value of unit: "" error

This currently fails to build because 'free' handling is incorrect, but I tested that loyal & full work.

Any thoughts on how to handle free?"
126830250,Bug in [for] missing step,GregoryLundberg,2017-06-21 18:27:50+00:00,2017-06-22 02:27:39+00:00,{},"https://forums.wesnoth.org/viewtopic.php?t=46450 reports a Lua crash if end is given but step is not. The wiki says the default step is 1. Note that if end is negative, the [for] does nothing (per sanity check).
"
126829286,Fix Lua for CMake with clang,GregoryLundberg,2017-06-21 18:22:48+00:00,2017-07-25 23:57:38+00:00,{},"When using CMake with clang, the wesnoth_lua_config.h was omitted causing problems with exception handling (among other unreported issues).

This closes Issue #1669
"
126445335,"Use WFL formulas instead of Lua for leadership, backstab, and teleport abilities",CelticMinstrel,2017-06-20 04:30:59+00:00,2017-06-25 04:45:01+00:00,{},"The Lua implementation adds drops functions into the global namespace, which is the unfortunate downside of how `lua_function` is implemented and something which in my opinion is not acceptable for core functionality. This replaces it with a WFL implementation, adding the necessary features to the formula engine in order to get the required effects.

~At the moment this is _completely untested_. I've put it here in case someone else can find the time to test it before I do, which could be tomorrow but might be as late as the weekend.~

As a bonus, I also discovered and fixed a rather nasty crash in the WFL engine."
126382099,Fix Lua for CMake with clang,GregoryLundberg,2017-06-19 19:44:05+00:00,2017-06-21 18:17:38+00:00,{},"When using CMake with clang, the wesnoth_lua_config.h was omitted causing problems with exception handling (among other unreported issues).

This closes Issue #1669"
126203312,[WIP; DONTMERGE] Implement #1436,gfgtdf,2017-06-18 21:39:16+00:00,2017-06-25 04:45:04+00:00,{},"Implements #1436

Not complete yet, do not merge it. 

This adds support to use lua and formula in abilitites attributes. The original suggestion in #1436 was to allow variable subsitution but i decided against that since variable substitution in objects (in which abiltites often appear) is a rather messy thing and in most cases one would use formula anyways.

"
126158682,address two cppcheck findings,matthiaskrgr,2017-06-17 15:38:33+00:00,2017-07-25 23:58:27+00:00,{},
125780298,wmlxgettext: fix UTF-8 issue: #1785,AncientLich,2017-06-15 09:35:00+00:00,2017-08-01 02:29:47+00:00,{},"This code should fix the issue reported at
https://github.com/wesnoth/wesnoth/issues/1785

I tested my code with an older file of my own campaign wich contained an invalid UTF-8 byte 

https://github.com/AncientLich/wmlxgettext-unoff/blob/master/wmlxgettext/test/reports/2017.06.15/05_The_Underground_Path.cfg

The invalid byte is located on the comment at line 272

>  \# da modificare - devo aggiungerci la condizione ""se il turno 23 non è stato raggiunto""

That is an italian comment (the meaning is not important). What it is import is that the 'è' character wasn't UTF-8 compatible, becouse I wrote that file with a wrong text encoding while I was a windows user (now I use Ubuntu).

Now the code manage the UTF-8 decode error, and will show a proper error message, wich is, in this case:

> error: DrakeStory/scenarios/05_The_Underground_Path.cfg:272: UTF-8 Format error.
> Can't decode byte 0xe8 (invalid continuation byte).
> You must edit the file, replacing that byte with a valid UTF-8 character.
> 
> Text preceding the invalid byte (line 272):
> 	\# da modificare - devo aggiungerci la condizione ""se il turno 23 non 

You can notice 2 commits. On the first one I forgot to delete some debugging code (create a temporary file wich I used to understand how to display all the informations I need from the exception class). This file should never be created on an actual usage of wmlxgettext."
125456449,use lua filter in {ABILITY_TELEPORT},gfgtdf,2017-06-13 20:40:21+00:00,2017-06-13 21:44:15+00:00,{},this way it no longer uses variable substitution
125356130,"make [resolution] window_width/height=, the minimum required window size",gfgtdf,2017-06-13 12:53:58+00:00,2017-06-13 18:25:48+00:00,{},"…window size

previously the game would always choose resolutions that were too big for the screen, in particular in the mp_create window.
"
125285921,Add some doc comments to src/units/types.hpp,luther9,2017-06-13 06:19:14+00:00,2017-06-14 16:29:06+00:00,{},I wanted to write a few doc comments so I could get used to looking at the code.
125238851,fix #1783,gfgtdf,2017-06-12 21:57:53+00:00,2017-06-13 14:20:11+00:00,{},
125005541," 	use a worker thread to send packages in wesnothd_connection, fixes #1674",gfgtdf,2017-06-10 21:48:32+00:00,2017-06-13 14:18:08+00:00,{},"TODO: remove the first commit ( testing just get erros from travis faster) before merging.

fixes #1674
This fixed a problem where at game start the host sends first a [scenario_diff]
and then a [start_game] but then the host loads the scenario config (during loadingscreen before game) and
wesnothd_connection::poll isn't called while the loadingscreen is showing. so
the other players receive the [start_game] with a lot delay since
wesnothd_connection won't send it before the the loadingscreen has finished.

At least for me this solution is also easier to implement than the alternative which would be calling poll() regulary form inside the drawing (gui2 and gamemap) code."
124917554,"#1763: crash in ""poisoning"" Formula AI (affects mainline campaign)",singalen,2017-06-09 17:46:18+00:00,2017-06-22 00:15:35+00:00,{},"This piece fixes an actual problem:

	if(res.is_empty())  {
		throw formula_error(""min(list): list is empty"", """", """", 0);
	}

This one is a preventive care:

	if(v.is_empty()) {
		continue;
	}

Reproduces in first mission of Legend of Wesmere. Just move some units in the attack range of bottom left orcs' assassins."
124354019,Issue #1738: Changed unit_recall dialogue box ,pranav-deshpande,2017-06-07 07:36:10+00:00,2017-06-07 20:08:26+00:00,{},"Changed unit_recall dialogue box to sort by
1. Level
2. Experience to advance
"
123966097,Implement IME support for GUI2 textboxes,CelticMinstrel,2017-06-05 12:16:05+00:00,2017-06-11 20:47:47+00:00,{},"This implements support for input method editors in GUI2 textboxes, using SDL2's facilities for them.

There seems to be one bug that I haven't been able to squash. I've found the composition is remembered when you close the dialog. For example, on the Mac, with standard US or US extended keyboard layout, press alt+E in a textbox, close the dialog, then open another dialog and press E. You should see ""e"", but I'm seeing ""é"". This sort of thing also happens with the Japanese IME.

In addition to review, I'd like it if people who actually use IMEs more regularly could test this."
123891816,Boost Test changed internals for 1.64,GregoryLundberg,2017-06-04 20:52:36+00:00,2017-06-04 23:04:12+00:00,{},
123877692,[WIP] Accelerated rendering,Vultraz,2017-06-04 13:25:57+00:00,2018-03-18 15:17:47+00:00,{},WIP work to get the game using textures and/or accelerated rendering. Opening a PR for feedback as I go along. GUI2 almost entirely works except for some alpha issues with the text in the story viewer and the minimap not showing up.
123861917,"[Complete in first approximation] iOS and general touchscreen support, pass 3 ",singalen,2017-06-04 01:28:11+00:00,2017-07-21 08:41:38+00:00,{},"Applied review notes from PR #1742, #1748.

It is STILL not in a shape I'd like to see it, but it's playable on a touchscreen.

Known major problems:

* in gui2, first touch is registered as a hover, only second one works.
* context menu is hard to invoke (by long-press, on finger-up). I intend to replace it with both long-press timer and a touble-tap.
* on-screen keyboard pops up too often.
* crash in «Server executable» preference.
* Whiteboard is not tested"
123854011,Atttempt to fix repeated fireing of first_time_only=yes events,gfgtdf,2017-06-03 19:44:03+00:00,2017-06-03 19:45:48+00:00,{},"fixup be665e29f111ad6c8ef1e8410a08608a405554cc

This isn't the best fix, ideally the code wouldn't use weak_ptr::expired to check whether an event was already handled."
123834701,"[Don't merge, deprecated] iOS and general touchscreen support, pass 2",singalen,2017-06-03 08:23:41+00:00,2017-06-25 05:01:57+00:00,{},"It is STILL not in a shape I'd like to see it, but it's playable on a touchscreen.

Likely addressed the notes from the previous PR. Rebasing was hard (I learned how to do it to squash commits and make prettier history!), something might have got lost.

Known major problems:

* in gui2, first touch is registered as a hover, only second one works.
* context menu is hard to invoke (by long-press, on finger-up). I intend to replace it with both long-press timer and a touble-tap.
* on-screen keyboard pops up too often.
* crash in «Server executable» preference.
* Whiteboard is not tested"
123409903,THoT fixes,sigurdfdragon,2017-06-01 03:02:56+00:00,2017-06-24 00:03:25+00:00,{},
123099039,"[Don't merge, deprecated] iOS and general touchscreen support ",singalen,2017-05-30 17:08:15+00:00,2017-06-25 05:01:57+00:00,{},"It is not in a shape I'd like to see it, but it's playable on a touchscreen.

The primary goal of this PR is to get a code review. 

Known problems:
* on-screen keyboard is not supported yet.
* in gui2, first touch is registered as a hover, only second one works.
* context menu is hard to invoke (by long-press, on finger-up). I intend to replace it with both long-press timer and a touble-tap.
* panning works even outside the map.
* editor doesn't is disabled on iOS."
122813473,fix wml tags using side.controller,gfgtdf,2017-05-28 23:40:55+00:00,2017-05-29 09:58:30+00:00,{},
122804343,"Allow showing [chat] to observers, fixes #1735",ProditorMagnus,2017-05-28 18:32:21+00:00,2017-05-29 07:54:52+00:00,{},"Fixes https://github.com/wesnoth/wesnoth/issues/1735
Implements https://forums.wesnoth.org/viewtopic.php?f=12&t=46029
[chat] has key observable=yes/no, default yes, which controls, if the message should be visible to observers."
122791039,update dates in the manpages,sevu,2017-05-28 10:33:36+00:00,2017-05-30 09:49:04+00:00,{},"closes #1619 
"
122775277,Fix warnings from VC15 (VS 2017),GregoryLundberg,2017-05-27 21:31:47+00:00,2017-05-28 07:16:27+00:00,{},
122775109,move --core entry in the manpage down to have it in alphabetical order,sevu,2017-05-27 21:25:11+00:00,2017-05-28 07:15:28+00:00,{},... and to have the --campaign... options grouped together
122736059,Add lua functions music_list.get_current() and music_list.get_previous(),Pentarctagon,2017-05-26 23:44:40+00:00,2017-05-29 12:51:07+00:00,{},Adds lua functions to get a config of the currently playing song and of the song that played before the current song.
122538535,CMake fixes,SoapGentoo,2017-05-25 22:23:09+00:00,2017-11-17 19:41:33+00:00,{},
122453828,test: Use a better error message when code.lua doesn't exist,luther9,2017-05-25 14:40:09+00:00,2017-06-06 11:55:50+00:00,{},"Bug #1690. This is hopefully a better error message when the user clicks ""Reload and execute Lua code"", and lua/code.lua doesn't exist."
122423102,fix -Winconsistent-missing-override warnings by clang.,matthiaskrgr,2017-05-25 11:36:16+00:00,2017-05-27 00:23:15+00:00,{},"was:
````
[  0%/4/4/515,14.101] Building CXX object src/CMakeFiles/wesnoth-game.dir/ai/composite/aspect.cpp.o
In file included from ../src/ai/composite/aspect.cpp:19:
In file included from ../src/ai/composite/aspect.hpp:25:
../src/scripting/game_lua_kernel.hpp:196:22: warning: 'my_name' overrides a member function but is not marked 'override' [-Winconsistent-missing-override]
        virtual std::string my_name() { return ""Game Lua Kernel""; }
                            ^
../src/scripting/lua_kernel_base.hpp:56:22: note: overridden virtual function is here
        virtual std::string my_name() { return ""Basic Lua Kernel""; }
                            ^
In file included from ../src/ai/composite/aspect.cpp:19:
In file included from ../src/ai/composite/aspect.hpp:25:
../src/scripting/game_lua_kernel.hpp:213:15: warning: 'log_error' overrides a member function but is not marked 'override' [-Winconsistent-missing-override]
        virtual void log_error(char const* msg, char const* context = ""Lua error"");
                     ^
../src/scripting/lua_kernel_base.hpp:66:15: note: overridden virtual function is here
        virtual void log_error(char const* msg, char const* context = ""Lua error"");
                     ^
2 warnings generated.
````"
122021464,Clarify the man page for options that take optional arguments (bug 1670),luther9,2017-05-23 15:03:08+00:00,2017-05-24 00:27:24+00:00,{},This relates to bug #1670.
121689078,Add command line switch for printing info to be included in bug reports,irydacea,2017-05-22 02:37:32+00:00,2017-05-22 04:05:12+00:00,{},"This add a new `--report`/`-R` switch that generate an info dump for bug reports.

This is intended to be used instead of the Game Version dialog's clipboard text report in the event that Wesnoth cannot reach the titlescreen or the dialog for some reason.

Unlike the `--version` info dump, it performs various calls to the filesystem API which have potential side-effects on the environment (namely, creating a user data directory structure if none existed before running the command). It seems highly improper for a program's `--version` switch to perform any actions other than printing text to its parent terminal, hence I thought it would be better to add a new switch with a more active phrasing, also reflected in its accompanying documentation.

Ultimately, this and its UI counterpart should be used by 1.14 players as part of the bug reporting process, preferably as a mandatory step before submitting new reports on GH or the forums."
121668194,giant rat portrait,sevu,2017-05-21 17:06:05+00:00,2017-05-23 10:38:06+00:00,"{'Enhancement': 1, 'Graphics': 1}","committed portrait for Giant Rat made by ZygoUgo and added him to the credits
Did I add him at the right place in the about file?
It's from here: http://r.wesnoth.org/p603819 "
121644128,[DON'T MERGE YET] Game Events: throw out custom handler_list implementation,Vultraz,2017-05-21 01:19:30+00:00,2017-11-28 11:11:21+00:00,{},"This replaces it with the standard std::list interface. I've attempted to make this change as least invasive
as possible, so I have not touched the manager::iteration class implementation. It can probably be refactored further later, but the crux of this change is simply to allow the removal of the custom smart_list container while keeping the chance of breakage to a minimum.

The new implementation cannot be an std::forward_list since that only has front-insertion capabilities
while back-insertion is needed."
121612468,fix cmake compile error on macOS,Ged0,2017-05-20 06:03:45+00:00,2017-05-21 19:53:34+00:00,{},"https://github.com/wesnoth/wesnoth/issues/1613
fix this error.
https://forums.wesnoth.org/viewtopic.php?f=5&t=44455

before this commit:
```
[  3%] Built target wesnoth-core
[  7%] Built target wesnothd
[ 13%] Built target wesnoth-lua
[ 24%] Built target wesnoth-game
[ 25%] Built target wesnoth-sdl
[ 25%] Linking CXX executable ../wesnoth
Undefined symbols for architecture x86_64:
  ""apple_notifications::send_notification(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, desktop::notifications::type)"", referenced from:
      desktop::notifications::send(std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, std::__1::basic_string<char, std::__1::char_traits<char>, std::__1::allocator<char> > const&, desktop::notifications::type) in notifications.cpp.o
ld: symbol(s) not found for architecture x86_64
clang: error: linker command failed with exit code 1 (use -v to see invocation)
make[2]: *** [wesnoth] Error 1
make[1]: *** [src/CMakeFiles/wesnoth.dir/all] Error 2
make: *** [all] Error 2
```

after fix:
```
[  3%] Built target wesnoth-core
[  7%] Built target wesnothd
[ 13%] Built target wesnoth-lua
Scanning dependencies of target wesnoth-game
[ 13%] Building CXX object src/CMakeFiles/wesnoth-game.dir/desktop/apple_notification.mm.o
[ 13%] Linking CXX static library libwesnoth-game.a
[ 24%] Built target wesnoth-game
[ 25%] Built target wesnoth-sdl
[ 25%] Linking CXX executable ../wesnoth
[100%] Built target wesnoth
```"
120886080,SotA S21: Improve speed & readability of code,sigurdfdragon,2017-05-16 17:44:46+00:00,2017-05-25 21:27:26+00:00,{},"The speed improvement comes from not storing recall list units.
Use of [break] is for readability, it doesn't seem to have a significant effect on speed.

See also https://github.com/wesnoth/wesnoth/issues/1706"
120473613,Improved ANL recruitment setup,pydsigner,2017-05-14 05:07:52+00:00,2017-06-01 17:16:45+00:00,{},"Removes use of faction_lock, allowing full control over faction/leader choice.

Addresses bug #1479"
120462796,fixes frames of a few attack icons,sevu,2017-05-13 20:49:19+00:00,2017-05-13 22:47:20+00:00,{},"Some things which I had on the lowest layer of my git stash for ages

fixes frames of a few attack icons
(While fixing the frames in ageless I came across a few mainline images where the three pixel frame differs from the others)

removes a duplicated readme file

~marks the .desktop file as executable~
(some desktop environments require it for starters on the desktop)"
120461595,Refactor variable_info impl,Vultraz,2017-05-13 20:08:45+00:00,2017-05-15 06:33:44+00:00,{},"Don't merge yet.

Copied from commit message:

First off, this doesn't touch the actual functionality of variable_info. Instead, it refactors how its all
put together:

* Comments have been cleaned up and improved.
* Formatting has been fixed.
* Class/type names have been improved.
* All info visitor and range helpers have been moved to a separate file.
* apply_visitor now takes a parameter pack and owns its own visitor object.
* as_range_visitor_base  now takes a parameter pack and owns its own visitor object (not fully working yet)
* The variable_info policy types have been split into their own helper classes and their respective functionality
  implemented with static functions. This makes it clearer exactly how each policy works.
* Simplified the use of type traits. The weird enable_if_non_const metastruct has been removed and a static_assert
  added to ensure variable_info_mutable is specialized correctly."
120455502,Update it.po,ivanalberotanza,2017-05-13 17:04:34+00:00,2017-12-02 03:09:57+00:00,"{'Invalid': 1, 'Translations': 1}",
120454894,Update it.po,ivanalberotanza,2017-05-13 16:46:23+00:00,2017-06-25 15:48:55+00:00,"{'Invalid': 1, 'Translations': 1}",
120454563,Update it.po,ivanalberotanza,2017-05-13 16:36:36+00:00,2017-06-25 15:48:55+00:00,"{'Invalid': 1, 'Translations': 1}",error <I> tag corrected with <i> tag
120453371,Update it.po,ivanalberotanza,2017-05-13 15:59:32+00:00,2017-06-25 14:07:31+00:00,"{'Invalid': 1, 'Translations': 1}",there is one </small> tag on line 100 without the <small> tag in the lines above
119867735,about asymetric projectiles ... (refactoring),sevu,2017-05-10 12:11:57+00:00,2017-05-21 15:01:18+00:00,{},"Instead of having the south set of images for the wail animation being upside-down
and letting the engine flip them the image files themselves are now the same like shown ingame.

I think it's simpler if you can see the differences to the other files in the filemanager.

Inspired by this thread https://r.wesnoth.org/t45562."
119344171,"Allow paths with "".."" in macro inclusions",CelticMinstrel,2017-05-07 16:09:56+00:00,2020-09-12 23:35:06+00:00,{},"I have made this safe (I think) by resolving any "".."" components manually while the path is still a relative path to the gamedata or userdata directory. If there are "".."" components left over that can't be resolved (ie, at the beginning of the path), then it's an error. Otherwise, resolution then proceeds as normal, depending on whether it's a WML path (which is also used by Lua) or binary path.

I think this could use an audit to determine if it's truly safe. I did add some unit tests to make sure it would be safe, but I'm not sure if it covers every possible case.

With this it should be possible to make any addon not depend on the name of its folder."
119334813,multiplayer maps: descriptions: cleanup,matthiaskrgr,2017-05-07 11:08:26+00:00,2017-05-10 00:11:52+00:00,{},"don't include mape size in the description since map selection screen already displays map size by itself.
canonicalize ""XvsY"" and ""X vs Y"" to ""X vs. Y"".
work around pango_text::set_markup_helper warnings about unescaped ampersands."
119306768,Double maximum height of text labels,jyrkive,2017-05-06 16:21:10+00:00,2017-06-02 11:29:05+00:00,{},"Currently a text label is limited to a height of about 32 000 pixels. @Vultraz has tried to increase the text size of credits, but doing so exceeds the limit and causes the credits to disappear completely.

This branch doubles the limit by splitting the label into two Cairo surfaces. I measured that changing the credits label definition from `default_small` to `default_large` increases the label height to about 40 000 pixels (without any add-on campaigns installed), which is about two thirds of the new limit. In other words, my changes are enough to allow the text size increase. :)

Note that this pull request depends on aquileia/external#7, aquileia/external#8 and aquileia/external#9. Don't merge this PR before those three are merged."
118852441,Allow negative maximum slider values,rikardfalkeborn,2017-05-03 20:53:04+00:00,2017-10-30 19:45:54+00:00,{},"Previously, the initialization of minimum_value to 0 prevented
setting negative maximum values, since the negative value would
always be less than 0, triggering an assert. Initializing it to the
least int possible avoids this.

This fixes https://gna.org/bugs/?25618.

If someone only calls slider::set_maximum_value() and not slider::set_minimum_value(), this would obviously lead to unexpected results (previous value of 0 was probably a saner default in that aspect), but there are currently no such place in the code base. I pondered whether I should add a function for setting both the min and the max in the same call (it's somewhat awkward to be unable to set minimum unless maximum is already set), but I went for the simpler solution."
118699594,Improve the wesnoth.require implementation,CelticMinstrel,2017-05-03 06:50:15+00:00,2017-05-04 06:11:26+00:00,{},"The primary motivation for this is so that we can add new WML tags by simply adding a new file under _data/lua/wml_ containing all the code for the tag, as the main _data/lua/wml-tags.lua_ file would contain the line `wesnoth.require ""lua/wml""`.

The secondary motivation is to allow omitting the "".lua"" file extension and, for the main core Lua files, the ""lua/"" prefix. It may be worth adding other similar cases, but I couldn't think of anything useful.

This supersedes #1017."
118481664,[WIP] Allow wesnoth.require to load a whole directory in one call,CelticMinstrel,2017-05-02 03:52:55+00:00,2017-05-03 06:50:37+00:00,{},"The primary motivation for this is so that we can add new WML tags by simply adding a new file under _data/lua/wml_ containing all the code for the tag, as the main _data/lua/wml-tags.lua_ file would contain the line `wesnoth.require ""lua/wml""`.

I think it basically works right now, but there are a few things to work out; in particular, requiring a directory will currently load a different copy of the files therein than if you required a specific file, so you could end up with two copies of a file."
118455408,Tutorial - the player can't end turns after attacking,sevu,2017-05-01 22:43:44+00:00,2017-05-04 04:57:28+00:00,{},"There are a few situations where the player ends up being unable to do anything when he attacked with the leader. He should't do that, but he can, and it may sometimes even look tempting to do that. Two solutions come to mind, either a) allowing him to end the turn or b) _somehow_ aborting the attack.

The related bugreport is [bug #25111](https://gna.org/bugs/?25111), the cases where the player has to reload. In the other cases the player could undo the moves _if he would know about that possibility._
"
118445485,Tutorial - small refactoring,sevu,2017-05-01 21:31:42+00:00,2017-05-02 12:29:29+00:00,{},
118284997,Config refactor,gfgtdf,2017-04-29 18:24:19+00:00,2017-05-15 00:28:04+00:00,{},
118284426,use clang for c++14 tests,gfgtdf,2017-04-29 18:09:39+00:00,2017-09-02 13:45:50+00:00,{},the used clang version supports more c++14 features than the used gcc version so its better suited for testing whether the code still works with those features enabled.
118278004,remove 'allow_failures' from c++14 build,gfgtdf,2017-04-29 15:07:14+00:00,2017-04-30 09:53:47+00:00,{},this was intially added brecause it didnt compile whne it was added.
118271476,deployed some range for loops on gameboard::teams(),gfgtdf,2017-04-29 11:15:29+00:00,2017-04-29 14:08:45+00:00,{},
118271230,bring back unit_map::replace,gfgtdf,2017-04-29 11:05:54+00:00,2017-04-29 14:06:42+00:00,{},
118271227,use boost::string_view in config class ,gfgtdf,2017-04-29 11:05:48+00:00,2017-04-29 17:42:05+00:00,{},"this replaced the older heterogenous lookup optmisation in config.?pp,
the advantage  is that it no longer requires different overloads for c
strings and std::string so it can easily be aplied to all config memeber
functions witout code dublication."
118256219,Fix base animation showing in zombie bats,sigurdfdragon,2017-04-29 00:52:06+00:00,2017-05-01 20:30:07+00:00,{},"Fixes https://gna.org/bugs/?25673


I figure it's either this fix, or I can split the bat's [attack_anim] into 3 tags instead of 2"
118251285,Composed hotkeys,aginor,2017-04-28 23:31:57+00:00,2017-04-29 02:52:45+00:00,{},"This adds support for composed hotkeys and fixes the GUI2 create-hotkey dialog that @Vultraz introduced.

The command-hotkey is also reverted back to "":"", ensuring that all help documentation is now relevant again. "
118071803,Fixed bug #24644: Units moving after in game help exit ,qmo2015,2017-04-28 03:04:42+00:00,2017-05-01 06:37:28+00:00,{},"Fixed bug #24644: Units moving after in game help exit 
https://gna.org/bugs/index.php?24644
"
118069750,Merge pull request #1 from wesnoth/master,qmo2015,2017-04-28 02:39:40+00:00,2017-04-28 02:40:24+00:00,{},update my repo
118069605,Merge pull request #1 from wesnoth/master,qmo2015,2017-04-28 02:38:00+00:00,2017-04-28 02:39:03+00:00,{},update my repo
118057219,Fix for 21634,binarycoder,2017-04-28 00:11:02+00:00,2017-04-29 15:42:32+00:00,{},
117966187,Various Bug fixes and change to mouse scroll function,binarycoder,2017-04-27 15:27:14+00:00,2017-04-28 00:00:25+00:00,{},"Fiixes for:
24644
25217
21634
24383
Additional changes to satisfy 25591"
117547929,[wip dontmerge] misc refactors,gfgtdf,2017-04-25 18:14:15+00:00,2017-04-29 11:06:33+00:00,{},"contains a 3 unrelated refactor commits, main point of this pr is to have the travis check."
117384998,Peter shadow patch 1,jesse597,2017-04-25 00:45:11+00:00,2017-04-25 03:24:12+00:00,{},This branch fixes the bug addressed at https://gna.org/bugs/index.php?14503
116991188,ported wescamp and libgithub to python3,sevu,2017-04-21 13:57:58+00:00,2017-05-13 19:36:20+00:00,{},"However, there's still a problem left which didn't occur with python2:
calling wescamp -l would crash at [line 49.][link]
I's just a debug message and could be left out, but does someone have an idea why?

[link]:https://github.com/sevu/wesnoth/blob/a92eb2465c402c1f00f8bcc8ddf34eea5c19481b/data/tools/wesnoth/wescamp.py#L49

> Exception ignored in: <bound method tempdir.__del__ of <__main__.tempdir object at 0x7f72de2fcac8>>
> Traceback (most recent call last):
>   File ""data/tools/wesnoth/wescamp.py"", line 49, in __del__
> AttributeError: 'NoneType' object has no attribute 'debug'
> "
116936488,[WIP] Port the help browser to GUI2,CelticMinstrel,2017-04-21 08:36:40+00:00,2018-04-11 04:06:06+00:00,{},"At this point, the dialog is nearly fully-functional. There are two main problems remaining:

* [ ] Support for hiding topics, and displaying hidden topics. (Currently they can be displayed only because they are not hidden as they should be.)
* [ ] Support for embedded images. May require a custom GUI2 widget."
116935110,Improvements to the Lua map generator,CelticMinstrel,2017-04-21 08:28:19+00:00,,"{'MP': 1, 'UI': 1, 'Lua API': 1, 'Schema': 1, 'Campaign WC': 1}",
116932760,Fix objectives with variables,CelticMinstrel,2017-04-21 08:12:24+00:00,2017-05-13 17:20:33+00:00,{},"Apparently they're supposed to be able to resubstitute variables each time they're shown; even if that wasn't the original intent, it would be quite useful.

The way to do this is not parse the `[objectives]` config instantly, and then substitute variables later. There are two possible implementations of this:

* The first implementation (e9895f8a102f) runs before any time the objectives show, whether explicitly requested by the user or by simply setting `team.objectives_changed = true`. However, this has the disadvantage that `[insert_tag]` will not be reparsed, as the objectives have already been reduced to a string by this point.
* The second implementation (699853dfc3a1) instead resubstitutes the variables as part of `[show_objectives]`, which means the entire `[objectives]` config is reparsed whenever the objectives are explicitly viewed by the user. This has the advantage that `[insert_tag]` will also be reparsed, but means variables are not resubstituted if the objectives are shown naturally as a result of setting `team.objectives_changed = true`.

I'm not sure which is the better implementation. Also, there's the question of whether to support `delayed_variable_substitution` and, if so, what it should default to. In order for this to work at all, not supporting it would mean assuming it to be true; the current implementation effectively assumes it to be false."
116676238,Mute Music Hotkey Feature,thomasvanhaastrecht,2017-04-20 01:57:38+00:00,2017-04-20 02:01:09+00:00,{},"Feature Request to implement a default hotkey, which mutes the in-game music but not the sound effects. Originally requested here: https://gna.org/bugs/index.php?23192

The default hotkey binding is set to CTRL+ALT+S."
116474834,Don't store the user's password in plaintext in the prefs file,CelticMinstrel,2017-04-19 06:04:32+00:00,2017-05-22 17:11:32+00:00,{'Enhancement': 1},"Currently, if you tell Wesnoth to remember your password, it's stored in plaintext in the preferences file, which is very insecure. This is intended to change that. However, it's still not very secure since I only used basic XOR encryption; we'd have to swap that out for something else before merging.

That aside, comments on how this works are welcome and, in fact, required.

As a ""bonus"", this also allows the game to store separate passwords for any server/username combination you use.

Not sure if @GregoryLundberg is still around, but if you are, please consider commenting.
"
116158694,destro mp dialog objects before starting the game.,gfgtdf,2017-04-17 16:32:11+00:00,2017-04-17 19:40:04+00:00,{},"at least this should save some ram.

pr for travis check before merging."
116065969,SotA: Fix altar lighting,sigurdfdragon,2017-04-16 18:02:29+00:00,2017-04-28 03:07:29+00:00,{},"Proper wml item lighting behavior restored in 478c75bdb5bc914fcd71469a2ae6967cadc99e11, so a change is needed

This PR is an attempt to use [item] image adjusted properly, so Ras-Tabahn will pass in front of the alter.

The adjustment to counteract underground lighting seems slightly off.

[item] halo could be used( & was used previously), but that would have Ras pass behind the alter.

"
116007857,Reduce invisible units' transparency,Wedge009,2017-04-15 00:54:41+00:00,2017-05-04 06:11:11+00:00,{},"Units are rendered at 0.5 alpha when they are invisible (for example, Elvish Avengers' Ambush ability). An issue arises with the Shadow (and Nightgaunt) ghost unit which has the Nightstalker ability allowing it to be invisible at night time - in combination with its fluctuating alpha animation, it can be quite hard for the player to see at night time (https://gna.org/bugs/?14503). @beetlenaut suggests that the global alpha level for invisible units be slightly increased from 0.5 to 0.6.

So this is related to PR #984, but we are keeping this separate as this change affects more than just Shadows and I don't know the full implications of changing this value."
115981478,Add const to some functions,rikardfalkeborn,2017-04-14 19:59:30+00:00,2017-04-17 05:51:31+00:00,{},
115978841,less unit copying,gfgtdf,2017-04-14 19:37:51+00:00,2017-04-14 21:45:14+00:00,{},"we use unit_map::insert instead of unit_map::add/unit_map::replace, to minimize copying of units."
115928782,Invert alpha animation for Shadow (bug #14503),Wedge009,2017-04-14 13:07:41+00:00,2017-05-04 06:10:59+00:00,{},"Another adjustment as part of bug #14503. Idea is to make the Shadow alpha level spend more time between 0.6-0.8 instead of 0.4-0.6. So when the Shadow's Nightstalker ability becomes active at night time, the alpha level is mostly between 0.3-0.4 instead of 0.2-0.3, making it marginally more visible."
115871612,AOI: Inform the player that Linaera can recruit,sigurdfdragon,2017-04-14 01:31:51+00:00,2017-05-04 09:38:37+00:00,{},See last two comments in https://github.com/wesnoth/wesnoth/pull/969 conversation for the rational.
115660630,improve listbox::clear() performance.,gfgtdf,2017-04-13 00:07:49+00:00,2017-04-13 14:53:40+00:00,{},"previously listbox::clear() removed all elements one by one.
This was quite ineffective since due to the listbox always-one-element-selected behviour this required calculating which is the next element in this list in the current order. Which then again requires resorting of the whole list since due to the list content change (removal) the order cache is cleared.

this could also fix https://gna.org/bugs/?25504"
115656643,Updated links to wesnoth.org to use https,mbrickn,2017-04-12 23:30:22+00:00,2017-04-14 12:52:07+00:00,{},"I just changed URLs to the wesnoth.org webpages to use https instead of http.

This will make users go directly to the webpages linked, instead of automatically being redirected to the https version by the website. 

Should be very slightly better for user experience! 😊

Please note: http://manual.wesnoth.org/ redirects to https://wiki.wesnoth.org/WesnothManual, but https://manual.wesnoth.org/ breaks, so I left it unchanged.

PS: Thank you for making an awesome game!"
115320392,allow multi_page to contienr differnt type of pages,gfgtdf,2017-04-11 13:29:00+00:00,2017-04-12 13:16:21+00:00,{}," 	

although stacked_widget supports similar functionality this is currently
not easily doable from the lua gui2 api. In particular
1) stacked_widget cannot add pages dynamically
2) multi_page can only contain one type of widget.
3) a stacked_widget inside a multi_page is ineffective since it
generates many unused widgets
4) a multi_page inside a stacked_widget is just unhandy to use

this also contains some unrelates commits in actions/move.cpp that just happend to be on that branch."
115226387,Fix behaviour of [heal_unit]amount= for negative/zero values,CelticMinstrel,2017-04-11 01:58:22+00:00,2017-04-11 01:58:46+00:00,{},
115205681,wesnoth.set_dialog_value can now unfold treeview nodes,gfgtdf,2017-04-10 22:29:54+00:00,2017-04-11 01:59:23+00:00,{},
114972629,Walking Corpse variation portraits,doofus-01,2017-04-09 04:42:08+00:00,2017-04-18 12:38:00+00:00,{},"This PR is to give portraits for Walking Corpse variations.  At this time, the ""swimmer"" and ""wolf"" variation are not done.  (The ""gryphon"" variation is cheaply done, but I think that is all that variation deserves.)"
114954667,WML: Add base_income key to [store_side],sigurdfdragon,2017-04-08 17:57:27+00:00,2017-04-08 23:05:50+00:00,{},"Discussed on IRC on 2017-04-08
"
114709140,support container variables in [options],gfgtdf,2017-04-06 22:30:30+00:00,2017-04-07 04:06:59+00:00,{},"options settigns attributes in a contianer like
```
[options]
  [slider]
    id=""container.attribute""
    ....
  [/slider]
[/options]
```
were broken in  a previous refactor in 1.13.0. This commit should restore them."
114599690,[NFC] remove dead code found by cppcheck,matthiaskrgr,2017-04-06 13:22:09+00:00,2017-04-09 00:34:16+00:00,{},Not sure why the compilers didn't warn about this though.
114203603,Master,michael-r-kolar,2017-04-04 17:34:46+00:00,2017-04-04 20:10:26+00:00,{'Invalid': 1},
113860083,Add fallback_human() action to the Lua AI,CelticMinstrel,2017-04-03 05:30:08+00:00,2017-04-09 00:36:49+00:00,{},"Just like the FormulaAI fallback() function, this temporarily transfers control of the side to a human player.

I simply used the same exception that the FormulaAI uses for this, making it inherit from `lua_jailbreak_exception`. I have not tested it, however, which is part of why this is a PR rather than being pushed straight to master."
113818656,floating label: remove dead code. Found by cppcheck.,matthiaskrgr,2017-04-02 13:41:34+00:00,2017-04-02 19:26:16+00:00,{},"````
[src/floating_label.cpp:261]: (style) Condition 'screen!=nullptr' is always false
[src/floating_label.cpp:281]: (style) Condition 'screen!=nullptr' is always false
````"
113813066,resolve -Wunused-lambda-capture warning (clang),matthiaskrgr,2017-04-02 10:33:56+00:00,2017-04-02 10:35:01+00:00,{},"Was:
````
[ 45%/256/3/557,1168.424] Building CXX object src/CMakeFiles/wesnoth-game.dir/formula/variant.cpp.o
../src/formula/variant.cpp:647:68: warning: lambda capture 'this' is not used [-Wunused-lambda-capture]
        return value_cast<game_logic::variant_list>()->list_op(v.value_, [this](variant& v1, variant& v2) { return v1 + v2; });
                                                                          ^
../src/formula/variant.cpp:653:68: warning: lambda capture 'this' is not used [-Wunused-lambda-capture]
        return value_cast<game_logic::variant_list>()->list_op(v.value_, [this](variant& v1, variant& v2) { return v1 - v2; });
                                                                          ^
../src/formula/variant.cpp:659:68: warning: lambda capture 'this' is not used [-Wunused-lambda-capture]
        return value_cast<game_logic::variant_list>()->list_op(v.value_, [this](variant& v1, variant& v2) { return v1 * v2; });
                                                                          ^
../src/formula/variant.cpp:665:68: warning: lambda capture 'this' is not used [-Wunused-lambda-capture]
        return value_cast<game_logic::variant_list>()->list_op(v.value_, [this](variant& v1, variant& v2) { return v1 / v2; });
                                                                          ^
4 warnings generated.
````"
113759860,AOI: Remove unnecessary trait,sigurdfdragon,2017-04-01 02:44:47+00:00,2017-04-01 04:39:49+00:00,{},Leaders don't need loyal.
113759669,MP: Use title case for all use_map_settings options,sigurdfdragon,2017-04-01 02:40:34+00:00,2017-04-01 04:37:44+00:00,{},
113647307,Variant refactor,Vultraz,2017-03-31 13:17:00+00:00,2017-04-02 06:56:12+00:00,{},"~~Don't merge yet. Still crashes at start.~~

Main crash fixed."
113107986,[don't merge yet] Generalizing the FAI concept of action objects,CelticMinstrel,2017-03-29 02:51:15+00:00,2017-04-03 05:08:30+00:00,{},"This is still not quite finished for a couple of reasons; in particular, the infinite loop protections around `set_var()`, `set_unit_var()`, and `'continue'` have been removed, which might be a problem. I don't understand how these could _cause_ infinite loops, but I assume the protection had been there for a reason.

The goal of this is to generalize the idea of a WFL object that the engine can execute to produce some effect. The concept already existed in the FormulaAI engine, but was not generally available to code using the WFL APIs. Vultraz wishes to use action objects in other contexts, such as GUI2 or perhaps even ActionWML, so I've attempted to disentangle it from the FormulaAI code. I'm not sure I've succeeded, and the API currently feels a little wonky as well (particularly the difference between the `execute_variant` function in `variant` and `formula_callable` and the `execute` function in `action_callable` - they roughly do the same thing, but take their arguments in opposite order)."
112593400,changed morningstar to morning star,sevu,2017-03-25 16:54:00+00:00,2017-03-25 20:03:02+00:00,{},"With the intention to use the same spelling like in core.

Previously discussed on [GNA #25013](http://gna.org/bugs/index.php?25013) and PR #915.

This would be the last change of that kind."
112348493,HttT 19c,sevu,2017-03-23 22:04:36+00:00,2017-03-25 20:56:41+00:00,{},"Although unlikely, Konrad could reach this location before

& hide the injured sergeant in the help, so the lieutenant isn't shown as advancing from it."
111879026,Partial relayout,jyrkive,2017-03-21 21:04:13+00:00,2017-03-21 23:13:36+00:00,{},"This pull request is a response to [bug #25523](https://gna.org/bugs/index.php?25523).

Debugging immediately showed me that changing the text of any label (e.g. add-on author name, or description) causes the whole window to be laid out, which is expensive. In addition, it's unnecessary in the add-on manager, as the containing grid has plenty of space available.

To improve performance, this branch implements **partial relayout**, where only the containing grid is laid out. If laying out the grid fails, then the function calls itself on the parent grid recursively. Finally, if even the root grid doesn't have enough space, then it falls back to laying out the window like before.

My testing shows that this branch is a **huge improvement** for add-on manager responsiveness. In theory, it can speed up other dialogs as well, but I didn't notice any other improvements in quick testing. It is possible that other dialogs trigger full relayouts in other ways (not via `scrollbar_container`) and thus don't make use of partial relayout."
111616373,Porting WML tags to Lua (part 2),CelticMinstrel,2017-03-20 18:10:00+00:00,2017-04-29 06:25:11+00:00,{},"Continuation of #881.

This is a branch dedicated to porting WML tags to Lua, mainly focusing on ones that are nominally implemented in Lua but actually just defer to an API call that does all of the work.

It's not ready for merge yet, but could use a lot of testing for each affected tag to ensure that things still work as they should.

Things to be tested:
* [ ] kill
* [x] scroll
* [x] music
* [x] volume

Tags to evaluate:
* [x] music
* [ ] set_menu_item
* [ ] time_area
* [ ] replace_schedule"
111554106,Prevent alpha underflow and reduce Shadow translucency (bug #14503),Wedge009,2017-03-20 13:40:27+00:00,2017-04-08 23:04:47+00:00,{},"Attempt to compromise between day and night visibility for the Shadow sprite, due to the Nightstalker ability making it nearly invisible at night, otherwise.

Ghost -> Shadow (Nightstalker) -> Nightgaunt (Nightstalker)
Ghost -> Wraith -> Spectre

Ghost units have translucency animations to simulate their ethereal nature - currently all of the above units except for Nightgaunt because it only has one sprite frame.

Nightstalker units are invisible at night-time, invisibility producing a dimming of the sprite to 50% (https://github.com/wesnoth/wesnoth/blob/master/src/units/drawer.cpp#L108). This applies to any unit deemed 'invisible', not just Nightstalkers. Combining this with the alpha reduction for the ghost translucency animation produces long periods of non-visible sprites (https://gna.org/bugs/?14503).

Edit: In fact, with recent builds (March 2017) the alpha animation for Shadow actually results in an underflow, causing an unsightly blinking effect.

So, without making a special exception for ghost units, leaving the sprites marked as invisible at 50%, the best compromise I can come up with is to reduce the translucency on the Shadow. A similar alpha level should be applied to Nightgaunt too, should it ever become animated with variable alpha levels.

Open to other ideas, this is a strong request from @beetlenaut."
111449474,replace wesnoth.set_next_scenario() with wesnoth.game_config.next_sce…,gfgtdf,2017-03-19 13:15:29+00:00,2017-03-20 01:48:03+00:00,{},…nario setter/getter
111424944,"changed weapon name= key to flail, like it is for the shock trooper",sevu,2017-03-18 20:47:20+00:00,2017-03-18 21:38:44+00:00,{},An perfect example of the confusion about these weapon names. He has all names for it.
111206112,Fixup cfc4c5c425819fd9650864195e71f13613ff88fe,sigurdfdragon,2017-03-17 03:11:24+00:00,2017-03-17 04:23:55+00:00,{},
111179281,SotA: Reorder traits so loyal is first,sigurdfdragon,2017-03-16 22:30:42+00:00,2017-03-17 00:33:46+00:00,{},To match convention in mainline.
111177089,Make negative gold in Current Status show red like negative income,sigurdfdragon,2017-03-16 22:15:33+00:00,2017-03-16 23:05:21+00:00,{},"This works, but is it correct?"
111161924,SotA: Comment fixes,sigurdfdragon,2017-03-16 20:47:54+00:00,2017-03-16 20:49:29+00:00,{},
110732265,Allow wesnoth.select_unit() to deselect the unit,CelticMinstrel,2017-03-14 22:32:32+00:00,2017-03-18 06:35:52+00:00,{},"Since @vultraz recently decided to remove this feature from wesnoth.deselect_hex, there is now a need to support this behaviour in some other way,

Should probably also search all uses of deselect_hex in master to decide if they should also deselect the unit."
110683842,Fixup [unstore_unit] Lua port,sigurdfdragon,2017-03-14 18:07:13+00:00,2017-03-15 14:02:14+00:00,{},"Restores check_passability default of yes.
Fixes 50a9a25ae7a84da43a0bcc80287a3a9c119adc22"
110104133,Fix #24681: Use composed hotkeys where appropriate and revert help to be ':',aginor,2017-03-10 10:48:17+00:00,2017-04-08 12:02:31+00:00,{},"This enables textinput events in SDL and adds handling of them. The events
are processed for hotkeys if the length of the hotkey string is 1 (which is the
case for all straightforward hotkeys)."
109990190,HttT: don't kill Gryphons in the recall list,jostephd,2017-03-09 19:42:11+00:00,2017-03-09 21:40:36+00:00,{},"The player can't have recruited Gryphons yet, but may have summoned them using `:create'.  Don't kill any such Gryphons, only the one added by the event.

I ran into this when I tried going through HttT with dwarves rather than elves.  I had edited the savefile by hand to permit Konrad to recruit Gryphon Riders, but my level 1 Gryphon Riders disappeared between The Dwarven Doors and The Lost General."
109469627,resolve compile warning (clang),matthiaskrgr,2017-03-07 12:32:57+00:00,2017-03-07 13:00:30+00:00,{},"In file included from ../src/game_initialization/flg_manager.cpp:15:
../src/game_initialization/flg_manager.hpp:108:13: warning: private field 'use_map_settings_' is not used [-Wunused-private-field]
        const bool use_map_settings_;
                   ^"
109408860,Fix bug #25360: variants name in help is not displayed.,fujimo-t,2017-03-07 05:23:57+00:00,2017-03-08 19:18:36+00:00,{},Fix bug #25360: https://gna.org/bugs/index.php?25360
109095384,help(editor): fix duplication of text attribute,fujimo-t,2017-03-04 05:40:58+00:00,2017-03-04 05:58:21+00:00,{},"There are duplication of text attribute, so some sentence is not displayed."
109089230,Changed description of the alternative plague ability.,sevu,2017-03-04 02:26:24+00:00,2017-03-18 18:40:13+00:00,{},"This ability gives content creator complete freedom on what unit type to create. (It's also only used in UMC)  While it's probably mostly the lvl0 version of the unit who used the ability, the current description is not fitting.

Credits for spotting and changing this go to Ravana."
109086237,Add more keys to store_side,sigurdfdragon,2017-03-04 01:24:55+00:00,2017-03-17 23:46:26+00:00,{},"The question I have with this is that it will add values not present in :inspect
Should we be doing that?

Also I may want to add a changelog entry"
108867708,MP Aethermaw: Move message info into objectives notes,sigurdfdragon,2017-03-02 22:39:30+00:00,2017-03-02 23:41:04+00:00,{},
108458755,moved {SOUND:POINSON} and {SOUND:SLOW} to deprecated-utils,sevu,2017-03-01 03:07:30+00:00,2017-03-08 23:51:28+00:00,{},
108456632,changed texdomain for cleaver in legend of wesmere,sevu,2017-03-01 02:44:08+00:00,2017-03-01 08:41:03+00:00,{},already provided by the ogres in core
108241081,Change std::string::length() to utf8::size() for unicode characters,fujimo-t,2017-02-28 01:43:06+00:00,2017-02-28 01:46:54+00:00,{},related to bug #25543 : https://gna.org/bugs/index.php?25543
108238777,Fix a Lua error in [modify_side],sigurdfdragon,2017-02-28 01:22:07+00:00,2017-02-28 01:29:19+00:00,{},
108047070,zombies,sevu,2017-02-27 04:56:41+00:00,2017-03-18 18:41:00+00:00,{},"fix regression of a701a2e (movement/defense on deep water for some variations)
since da255ab all death animations use exactly 4 specific frames, simplyfied macros
NBASE_NAME -> BASE_NAME
#undef soulless macros too

What would be possible too is the wolf variation using some wolf sounds. This is the bat doing with the die sound. But I don't have a specific suggestion here."
107986463,manual: remove description about default weapon choice,fujimo-t,2017-02-26 02:14:11+00:00,2017-03-18 21:40:17+00:00,{},"Recent wesnoth don't choose default weapon only by the maximum taking damage, so change description.

But I'm not English native, the new description may have English mistakes."
107964358,Added translators comments to src/units/attack_type.cpp and pick them up the CMake way too,gunchleoc,2017-02-25 15:21:03+00:00,2017-02-27 18:07:29+00:00,{},
107952625,"Fix bug #25332, some sentences are not shown in help pages",fujimo-t,2017-02-25 08:22:56+00:00,2017-02-28 20:21:38+00:00,{},"fix bug #25332  https://gna.org/bugs/index.php?25332

render_text() separates sentences which use plural fonts to plural surfaces, but render_text() makes the surfaces invisible when blit surfaces."
107678166,use the original action codepath when redoding,gfgtdf,2017-02-23 17:56:30+00:00,2017-03-10 11:34:50+00:00,{},"Previously when redoing an action each action had a seperate action::redo function that handled redioing that action. Now when redoing an action we just use the replaywml (that we cut form the replay when undoing that action) to redo the action, and call synced_context::run() just liek when we executed the action for the first time.

The main advantage is that [on_redo] is no longer nesasary since the
game will ow just fire the action related wml events again when redoing
the actions.

See also http://gna.org/bugs/?25472"
107525981,Delete old ability's description:Unpoison,fujimo-t,2017-02-22 23:47:51+00:00,2017-02-25 05:17:52+00:00,{},"There is ""Unpoison"" in the manual, but I don't know the ability such name.
It has almost same description as ""Cure"".
I think it is an old ability, so it should be deleted."
106886792,Add an alterntive redo code,gfgtdf,2017-02-19 03:18:25+00:00,2017-02-19 03:21:43+00:00,{},
106409085,WIP: SotA Fixes,sigurdfdragon,2017-02-15 22:01:23+00:00,2017-03-16 20:15:42+00:00,{},This pr is for various minor fixes to the Secrets of the Ancients campaign.
106273356,Fixed translation markup in unit::describe_builtin_effect(),gunchleoc,2017-02-15 09:40:53+00:00,2017-02-17 03:11:56+00:00,{},"Replaced hard-coded word order and N_ for all strings in
unit::describe_builtin_effect() with vgettext/vngettext using
placeholders."
105798075,add wml_actions.make_tag as proposed at #1503,gfgtdf,2017-02-12 17:08:49+00:00,2017-11-01 01:40:28+00:00,{},
105785960,Sql prepared statements,loonycyborg,2017-02-12 10:02:51+00:00,2017-03-03 11:27:17+00:00,{},"This makes forum_user_handler use prepared statements mysql api. This has following advantages:
1. Better security. We don't concatenate values into sql queries directly. Instead  we designate placeholders   for values in the query and provide values separately so that they never will be parsed as sql.
2. Prepared statements api can extract data directly in native types instead of as strings only. Thus there's no need to call atoi/stoi on numeric values obtained from the database since we get them directly as ints."
105527446,WML: Add additional members to [store_side] results,sigurdfdragon,2017-02-09 22:29:15+00:00,2017-02-18 03:24:54+00:00,{},"Most were only possible to add since 1.13.5

Not sure if 'lost' should be here.

I still need to add a changelog entry
"
105435487,Fixed hard-coded word order in attack_type::describe_modification,gunchleoc,2017-02-09 14:18:43+00:00,2017-02-11 17:40:57+00:00,{},"- Replaced _ with vgettext
- Replaced _n with vngettext
- Set_damage now uses set_damage rather than increase_damage
- Add missing utils::print_modifier to increase_movement

Fixes https://gna.org/bugs/?25468"
105192054,Tutorial adjustments,sevu,2017-02-08 10:52:52+00:00,2017-03-10 13:00:54+00:00,{},"Do not show traits in the wiki for Li'sar and Konrad, since they can't get them.
Li'sars new sprite seems to use rather a sword than a saber.
Copied defense animation for Li'sar from HttT.
Changed lua due to deprecation warning."
105060217,MP: Change handling of recruitment_pattern to match other factions,sigurdfdragon,2017-02-07 17:59:21+00:00,2017-02-16 18:18:39+00:00,{},
104725862,drop/death animation for Dark Queen,doofus-01,2017-02-06 01:52:16+00:00,2017-02-11 22:55:06+00:00,{},"Testing this with a debug unit with 1HP results in the unit not dying.  So, either the WML has a bug or there needs to be an explicit [kill] in the scenario CFG.  But the animation works about as intended."
104599809,Install dependencies dialog: Use _n() to fetch a translation string,jyrkive,2017-02-03 19:50:52+00:00,2017-02-11 16:07:52+00:00,{},"Soliton said in IRC that translation strings with plural forms should be fetched with `_n()`, `sngettext()` or `vngettext()`.

The reason why I made this a pull request instead of pushing directly to master is that I'm unsure on whether it's a good idea at all to convert a _translated string_ into a `t_string`, as the code is doing. Since `_n()`, `sngettext()` and `vngettext()` all return `std::string`, the conversion is inevitable if the code has to use those functions."
104342242,"fix bug #25334, segmentation faults in CJK help page",fujimo-t,2017-02-02 13:58:10+00:00,2017-02-03 11:20:45+00:00,{},"https://gna.org/bugs/index.php?25334

help_text_area::add_text_item() checks width of string before split it by split_in_width().
But, that check don't consider no_break_after() and no_break_before() used inside of split_in_width().
So, if there is no_break_after() or before() character in line breaking point, split_in_width()'s first return string is  empty and it cause infinity recursive call."
104224993,manual: update hotkey of command mode,fujimo-t,2017-02-01 21:24:40+00:00,2017-03-18 21:40:17+00:00,{},"Default hotkey of command mode is changed from "":"" to "";""."
103920828,Do not load Markov name generator if a CFG generator could be loaded,gunchleoc,2017-01-31 11:53:15+00:00,2017-02-05 21:23:51+00:00,{},"name_generator_factory::add_name_generator_from_config now only falls
back to loading a Markov-chain generator if the loading of the context-
free grammar generator fails or there is none available.

Motivation for the change: Until now, the CFG generator would be ignored for the base names. The Markov generator can't be adapted to my locale. c.f. [Forum discussion](https://forums.wesnoth.org/viewtopic.php?f=12&p=607975#p607889)."
103835950,Added an option to skip replays entirely when joining MP games,madmax28,2017-01-30 22:38:47+00:00,2018-08-04 10:47:32+00:00,{},"This adds a new replay mode to the MP lobby options that allows skipping replays entirely when joining games. It works by locking video updates completely while the game catches up.

I kept the old version around that allows viewing a quick version of the replay. It still doesn't address the issues gfgtdf addressed in #919, which should still be dealt with in a future commit:

- Breaks if [modify_turns] is present in scenario WML
- Still shows the most recent turn using a regular, slow replay"
103662043,"Stop ""quick replay"" mode in MP games once the client caught up",madmax28,2017-01-29 21:56:10+00:00,2017-01-30 20:51:42+00:00,{},"After #916, quick replays worked again when joining MP games but the ""quick replay"" mode was not deactivated when the client caught up.

This takes note of the joined game's current turn at the time of joining, and disables quick replay mode once that turn is reached.

"
103655791,fix OOS when redoing certain action with choices,gfgtdf,2017-01-29 18:57:41+00:00,2017-01-29 19:00:52+00:00,{},https://gna.org/bugs/?25473
103647532,fix bug 25292 to support scaled font in help pages,fujimo-t,2017-01-29 14:24:04+00:00,2017-01-31 03:09:45+00:00,{},"help_text_area::add_text_item() doesn't support scaled font, so help pages crash when font scale is changed from 100%.
This is fix of bug: https://gna.org/bugs/index.php?25292"
103643486,"Fix an issue with ""quick replay"" when joining multiplayer games",madmax28,2017-01-29 11:56:55+00:00,2017-01-29 15:44:10+00:00,{},"Hey,

I noticed that replays were not skipped when joining a multiplayer game with ""Quick Replay"" being selected. This fixes the issue.

In addition, I changed the `skip_replay_until_turn` option to a boolean, since specific turn numbers are never specified and have no effect."
103554765,Use core strings in campaigns,sevu,2017-01-27 19:48:03+00:00,2017-02-26 17:49:37+00:00,{},".
This is the continuation of PR #902 
The code style is not everywhere the same, I switched mostly back to the original textdomain after the relevant strings, though this is not necessary. If there Is some preferred variant, I'm happy to make it the same everywhere.
 
Before merging this PR, there are a few edge cases: 
1) There exists ""morningstar"" and ""morning star"" - what is the better variant?
2) In some languages ""entangle"" in wesnoth-units (the entangle of the elves) and ""entangle"" in wensoth-dm (the entangle of the wose shaman) is translated differently. I can kind of understand it. Should we maybe use different words in english for it? Otherwise I would unify it too.

Talking about that... there were two similar string changes which I would wish for:
3) Khalifate units have ""shield bash"" - the south guard has a unit with ""shield"" as attack.
Switching to ""shield bash""?
4) There exists ""long sword"" and ""longsword"", has been discussed at [gna #25013]. And, if changed, ""short sword"" would then be ""shortsword"". (used by orcish/loyalist bowman and the mages in liberty/main character in DiD)

One last idea regarding that topic:
Some attacks are used by different campaigns, but not in core. E.g. ""trample"", is used by the new utbs, eastern invasion and liberty. Can I move it to the wesnoth-units domain too?

[gna #25013]: <https://gna.org/bugs/index.php?25013>"
102518798,[wmlunits] use scons as cmake seems broken right now,elias-pschernig,2017-01-20 19:12:20+00:00,2017-01-20 19:24:26+00:00,{},
101924697,fix OOS in case that [do_command] was used on the wrong client.,gfgtdf,2017-01-17 18:59:12+00:00,2017-01-17 21:21:20+00:00,{},pull request for travis check before pushing this webpage commit.
100584170,Fix the unit portrait being displayed with only second_image is provided,Pentarctagon,2017-01-07 22:15:51+00:00,2017-01-29 16:45:26+00:00,{},"Currently, if only second_image is provided, the unit portrait gets displayed as well."
100568067,fixed a typo,Lightgazer,2017-01-07 12:43:06+00:00,2017-04-06 20:59:12+00:00,{},
100338170,Stop replacing listboxes with panes with --new-widgets,jyrkive,2017-01-05 18:19:42+00:00,2017-01-10 15:36:10+00:00,{},"I don't see the point of such a change. More important, it breaks all dialogs which search a listbox with `find_widget<listbox>()` and don't have a separate code path for `--new-widgets`, such as the new add-on manager. In particular, testing the new add-on manager without code changes is impossible because it is disabled without `--new-widgets` and fails to find the add-on list with it.

Besides, list boxes have been improved over the years with useful features such as an easy way to register sortable columns (commit a30d816ac7995ca6a2382de2268e765b9292f7ee). Writing pane codepaths for all the places where those features are used would be significant effort for no benefit.
"
100219680,Fix CPPDEFINES for scons build,Pentarctagon,2017-01-05 01:26:18+00:00,2017-01-06 11:22:33+00:00,{},"Fix CPPDEFINES orphaned during #882.
Also rename a few loop variables to not shadow the existing 'env' variable.

Issue reported [here](https://forums.wesnoth.org/viewtopic.php?f=4&p=607035#p607026)."
100057772,Fix grammar in Drake Flare description,jostephd,2017-01-04 03:28:46+00:00,2017-01-04 03:32:33+00:00,{},
99833767,Quotation marks in mountains WML so wmlparser.py outputs proper results,BlueWinds,2017-01-02 00:16:07+00:00,2017-03-18 18:31:52+00:00,{},"Previously, running `wmlparser2.py -k` (or wmparser3.py) resulted in rules containing text like this:
```
    {
     ""name"": ""mountains/dry_range35.png"",
     ""base"": ""306,144""
    }
```
dry_range35.png doesn't exist. Adding quotes around the image suffix results in this:
```
    {
     ""name"": ""mountains/dry_range3_5.png"",
     ""base"": ""306,144""
    }
```
dry_range3_5.png does exist. Things work properly in-game either way - this issue is only visible in wmlparser[2|3].py.

Suggested fix courtesy of @ln-zookeeper on the forums (https://forums.wesnoth.org/viewtopic.php?f=21&t=44945&sid=da79aff862f7f997abb8be22734cfe31)

------

My first attempt at a commit / pull request for wesnoth. Please let me know if there's anything I should change or do differently. :)"
99618517,Tutorial improvenments,sigurdfdragon,2016-12-29 04:55:44+00:00,2016-12-29 04:58:08+00:00,{},"S1 change is intended to simply for player by eliminating option to end early in order to make it more likely the player receives all the advice given in later turns. Also matches objectives better.
S2 change adds turn limit reminder."
99403096,HttT: Add Lisar's speech about power to CoT/UC branch,sigurdfdragon,2016-12-27 03:54:44+00:00,2016-12-27 20:23:48+00:00,{},Slight variant of speech in 19 a & b.
98448222,Ability to shrink composite widgets below the default size,jyrkive,2016-12-17 16:22:58+00:00,2016-12-27 17:12:37+00:00,{},"Composite widgets, i.e. widgets which inherit container_base, such as the unit preview pane, can have an explicit minimum size set in their definition. The widget will request either that size or however much space the child widgets want, whichever is higher.

If an explicit minimum size is set, the composite widget can't shrink below that size even if there isn't enough space. That limitation has annoyed at least @Vultraz : he wants to specify a minimum size for the unit preview pane but still allow it to shrink below that size before scrollbars show up.

This commit implements ability for composite widgets to shrink below the explicit minimum size, if set. I tested it locally: I set the minimum width of unit preview pane to 1000 pixels by editing [this line](https://github.com/wesnoth/wesnoth/blob/f5e0d38f02e2eb21529b4e5babfccb80b1e7680c/data/gui/widget/unit_preview_pane.cfg#L386). After that, the pane took all available space up to 1000 pixels, but if that much space wasn't available, it shrunk instead of causing a scrollbar to appear."
98441624,"Deletes unused, unbuildable tools",Pentarctagon,2016-12-17 11:34:17+00:00,2016-12-19 04:07:12+00:00,{},"Deletes create_images, cutter, exploder, schema_generator, schema_validator, and wesmage as suggested [here](https://github.com/wesnoth/wesnoth/pull/874#issuecomment-266810917) in #874.

This only deletes the above targets for scons and cmake, and removes any files they were using which are not used by any other source list.  I did not attempt to determine if any of the source files that are used elsewhere are actually necessary, or if they should be moved to a different location (such as `src/tools/schema/tag.cpp`)."
98253534,UTBS: use textdomain wesnoth-units for attacks which exist already there,sevu,2016-12-15 23:42:41+00:00,2016-12-16 10:44:19+00:00,{},
97829946,styled_widget: respect minimum size even for non-text widgets,jyrkive,2016-12-13 20:34:23+00:00,2016-12-20 17:22:36+00:00,{},"For widgets which don't contain text (`label_` is empty),
`request_reduce_width()` and `request_reduce_height()` can be implemented in a
way that respects the minimum size set in widget definition. However,
neither of those functions do anything for non-text widgets.

This pull request simply implements the request_reduce_* functions for non-text
widgets, and overrides the implementation for spacers because ingame WML
messages break otherwise.

This is the only commit I intend to have in this PR."
97439564,"DW, scenario 1: minor improvements",sevu,2016-12-10 21:59:31+00:00,2017-01-05 19:29:29+00:00,{},"Previously, the unit did get hidden, then teleported to the village (and captured it), and then the fake unit moved there and did unhide the unit afterwards.
One may think swapping the teleport and fake move block may solve this. At least so did I. But this causes that there is for a moment no picture shown for the unit. :(
Now, the unit itself moves to the village. However, there is sth. strange about [move_unit]. The unit will never move away in the further game. It just stays on that place. That's why the units gets killed and placed again. This also captures the village finally."
97405911,"wml cleanups, add terrain data in [random_placement]",gfgtdf,2016-12-10 01:04:01+00:00,2016-12-10 13:07:13+00:00,{},replacing some [while] with [repeat] or [random_placement]
97362118,de-cap village_support,MPagel,2016-12-09 19:02:32+00:00,2017-01-04 03:39:12+00:00,{},"There should be no functional limit on village_support.

Reason: other workarounds for setting no cost/no income do not work reliably. e.g. in LotI, your cash may decrease even when taking a snapshot of gold at `side turn` and restoring at `turn refresh`. See  Dugy/Legend_of_the_Invincibles/utils/utils.cfg at `#define DISABLE_UPKEEP` and recent patch pulls there.

Further, I have a request that a standard config setting for a map be, `player_support` or `base_side_support` for a given side. This would make it possible to have a base level of support not tied to villages on-map.

See also discussion at https://github.com/Dugy/Legend_of_the_Invincibles/pull/11"
97040186,add unit preview pane hp xp mp tooltips,gfgtdf,2016-12-08 01:02:22+00:00,2016-12-08 17:25:54+00:00,{'Enhancement': 1},wip dontmerge
96667500,Add SotA to Mainline,sigurdfdragon,2016-12-06 06:19:45+00:00,2016-12-16 00:54:03+00:00,{},"Adds the campaign 'Secrets of the Ancients' by beetlenaut (Dan Gerhards) to mainline.

Not yet ready for merging.
"
96591780,add lua add_widget_definition function,gfgtdf,2016-12-05 19:21:12+00:00,2016-12-07 03:14:04+00:00,{},"known issues:
1) the lua kenel sould unregister the definition upon descruction
2) we migth want to add a mutex somehwere to amke sure this doesnt casue issues when those widgets are added in th worder thread of the loadingscreen."
96383878,VC14 Cleanup,GregoryLundberg,2016-12-03 02:58:35+00:00,2016-12-04 02:26:39+00:00,{},"These commits should get us to 0 errors / 0 warnings for both Release and Debug builds for Visual Studio 2015.

In general there were three classes of error:

    * A local name hiding another. Renamed the local name

    * The poorly-written logging macro causing a duplicated name to hide an earlier name. Removed the duplicate macro. This eliminated some inner log scopes. A better fix would be to completely replace the lame macro with a better one; but that is too much work for today.

    * Bugs in spirit_po and certain Boost libraries. These were names-hides-name errors. Some could have been fixed by renaming some Wesnoth global variables; some are true bugs in the libraries. Since these are libraries, they messages were suppressed rather than correcting the library."
96382443,bug #25323,sevu,2016-12-03 02:13:20+00:00,2016-12-03 23:40:51+00:00,{},"Should be fixed, but can be confusing when trying to load broken add-ons."
96349853,un-cut the bow of the female ranger/avenger,sevu,2016-12-02 20:45:57+00:00,2016-12-02 23:58:21+00:00,{},
96270649,UtbS S1: Fix objectives if Necro appears early,adrianheine,2016-12-02 12:20:32+00:00,2016-12-03 00:00:37+00:00,{},"If the necromancer appears before Garak or Zhul are found, the objectives are wrong."
96205523,Fix GNA 25348,GregoryLundberg,2016-12-02 01:33:04+00:00,2016-12-02 02:54:02+00:00,{},
96163856,Fix bug: Upgrade tests/test_image_modifications.cpp for color_t,GregoryLundberg,2016-12-01 20:26:35+00:00,2016-12-01 21:18:27+00:00,{},
95974209,Fix YML for AppVeyor IRC,GregoryLundberg,2016-11-30 21:09:35+00:00,2016-12-01 04:27:45+00:00,{},"Use proper escapes for command line

Add to VS2015"
95825295,const-correctness,CelticMinstrel,2016-11-30 04:18:07+00:00,2016-11-30 04:21:55+00:00,{},[ci skip]
95791474,Adjust AppVeyor configurations,GregoryLundberg,2016-11-29 22:42:19+00:00,2016-11-30 14:14:58+00:00,{},"Do not build branches with an open PR.

Use ZIP and clone only the commit in question. This should significantly reduce the time needed to download the repository. Live testing was exceeding 40 minutes and forcing a quota-exceeded timeout."
95710304,Fix warnings in spirit_po,GregoryLundberg,2016-11-29 15:09:57+00:00,2016-12-02 05:50:26+00:00,{},"This fixes the 2 warnings during a Visual Studio Release build.

It does not fix the other 24 warnings from a Debug build."
95708726,Add support for AppVeyor Continuous Integration for Visual Studio,GregoryLundberg,2016-11-29 15:02:20+00:00,2016-11-29 17:45:43+00:00,{},"    0) Visit https://appveyor.com
    1) Sign in using your GitHub account.
    2) Under projects tab: New Project
    3) Click Add for wesnoth
    4) Click back to Projects
    5) Hover to right of wesnoth, click gear icon (Edit Project Settings)
    6) Set project name ie., ""Battle for Wesnoth (Visual Studio 2013)""
    7) Enter custom configuration .yml name: .appveyor.vs2013.yml
    8) Check to skip branches without appveyor.yml
    9) Click Save
    A) If desired, repeat 2 through 9 for Visual Studio 2015

Total run time for both toolsets is about 3.75 hours.

Note that each configuration builds both Debug and Release. Edit the .yml to only choose one.

There is a one-hour quota per build. Each build takes approximately 50 minutes. Cloning the repository takes from 5 to 20 minutes. Using a shallow clone zip file, reverting spirit_po and eliminating the Boost tests are the best ways to decrease runtime.

At present, AppVeyor does not support IRC notification. There is an open github issue requiresing the feature. It may be possible to add IRC notification as a build step."
95512004,Update fr.po,bbarbe,2016-11-28 14:50:43+00:00,2017-12-02 03:10:57+00:00,"{'Invalid': 1, 'Translations': 1}",Adding some translation to the wesnoth-nr/fr.po file
95417677,Have cmake and scons use same lists of source files,Pentarctagon,2016-11-27 21:40:33+00:00,2016-12-15 20:51:29+00:00,{},"Move lists of source files into their own directory
Make scons use the lists of source files
Move lua build step to src/SConscript and delete src/lua/SConscript
Make cmake use the separate file with the list of lua sources to build

@CelticMinstrel @GregoryLundberg @gfgtdf This is essentially a re-submission of #879 due to me screwing stuff up enough with git while trying to fix something that I decided to just try deleting all the commits, and then resubmitting them.  Unfortunately, a PR with no commits is automatically closed, so I renamed the branch to something more fitting, and made this PR."
95393021,Porting WML tags to Lua,CelticMinstrel,2016-11-27 05:35:03+00:00,2017-02-27 00:33:13+00:00,{},"This is a branch dedicated to porting WML tags to Lua, mainly focusing on ones that are nominally implemented in Lua but actually just defer to an API call that does all of the work.

It's not ready for merge yet, but could use a lot of testing for each affected tag to ensure that things still work as they should. Since the first two commits touch AI stuff to a great extent, @mattsc should probably take a look when he has time.

Things to be tested:
* [ ] modify_side shroud/fog ops
* [ ] modify_side general ops
* [X] modify_side AI ops ([ai], switch_ai)
* [X] modify_ai
* [x] heal_unit
* [x] animate_unit

Other tags to port:
* [ ] kill
* [ ] shroud
* [ ] scroll

Tags to evaluate:
* [ ] music
* [ ] set_menu_item
* [ ] time_area
* [ ] replace_schedule"
95380451,skip mp wait if the game already started,gfgtdf,2016-11-26 19:26:07+00:00,2016-11-26 20:25:52+00:00,{},
95359087,Moves the lists of sources into their own files,Pentarctagon,2016-11-26 03:00:24+00:00,2016-11-27 20:58:23+00:00,{},"Moves the lists of source files out of src/SConscript and src/lua/SConscript and into their own individual files under scons/sources/

This also directly adds files which were being unconditionally added to source lists, such as game_config.cpp, filesystem_common.cpp, filesystem_boost.cpp, and gettext_boost.cpp being added to libwesnoth_core_sources via the .extend() method."
95286603,update wesnoth-lib/fr.po,kannebankai,2016-11-25 11:04:15+00:00,2017-12-02 03:11:47+00:00,"{'Invalid': 1, 'Translations': 1}","I added, upgraded and changed some french translation since some were missing, outdated, false or ""bad""
I checked from line 1 to 3844"
95278610,Adding some French translation ,FckanneBankai,2016-11-25 10:08:59+00:00,2017-12-02 03:12:03+00:00,"{'Invalid': 1, 'Translations': 1}","I've seen some blanks for some French translation. I'm a student, I study Battle For Wesnoth with my Faculty,  and I would contribute to the project."
94871182,Implemented support for optional macro arguments,ln-zookeeper,2016-11-22 18:27:53+00:00,2016-12-03 18:29:44+00:00,{},"Some code review for this wouldn't hurt.

Example:

```
#define SET_LABEL X Y STRING

#arg TOOLTIP
""default ""+{STRING}+"" tooltip""
#endarg

#arg COLOR
255,255,255#endarg

    [label]
        x={X}
        y={Y}
        text={STRING}
        tooltip={TOOLTIP}
        color={COLOR}
    [/label]
#enddef

{SET_LABEL 25 23 ""test label 1""}

{SET_LABEL 26 23 ""test label 2"" COLOR=0,0,255}

{SET_LABEL 27 23 ""test label 3"" (TOOLTIP= _ ""this is a
multiline tooltip"") COLOR=255,0,0}

{SET_LABEL 28 23 ""test label 4"" TOOLTIP=_""a single-line tooltip""}"
94540815,Terrain:  wooden or mine variation (Xom) of the stone walls (Xos),doofus-01,2016-11-21 00:52:23+00:00,2017-02-17 03:19:13+00:00,{},"Also working on a somewhat derivative 'whitewashed' interior wall version, but for now it is only these wooden walls."
93688023,SCons and CMake all tools,GregoryLundberg,2016-11-15 02:12:07+00:00,2016-12-19 03:14:16+00:00,{},"Refactor sdl/utils.cpp into two files. This allows building all tools without pulling in the entire engine.

Note that the size of some targets could be further reduced by additional refactoring in other areas.

SCons and CMake can now build all of the following targets:

* campaignd
* create_images
* cutter
* exploder
* schema_generator
* schema_validator
* test
* wesmage
* wesnoth
* wesnothd"
93391784,Fix error from b6c88df9e7da58921cd00813b7d99e41352bb03f,GregoryLundberg,2016-11-11 20:20:25+00:00,2016-11-11 20:33:49+00:00,{},Parameter name 'filter' masked struct name 'filter'
93246001,Reduce dead code,GregoryLundberg,2016-11-10 22:43:12+00:00,2016-11-15 02:11:20+00:00,{},"This added a compile-time and a link-time option for gcc and clang. -ffunction-sections causes each function to be placed in a separate section of the object file. -Wl,-gc-functions tells the linker to delete any function sections which are not referenced. The net effect is if a source file has a function which is not used in the final executable program, that function is not present.

While a feature of many modern compilers, function-level linking is a potential source of problems. An example of a potential problem is linking a shared object library (such as a .so .dll or .dylink). In this case, the linker might not see any references to a function and eliminate it from the shared library; in fact, it might eliminate all functions in the shared library.

A better solution, generally used by most major software projects, is to use the ""one function, one file"" rule. Unfortunately, such a rule seems anethema to wesnoth."
92913415,SCons and CMake all tools,GregoryLundberg,2016-11-09 06:55:32+00:00,2016-11-10 20:48:22+00:00,{},"Refactor sdl/utils.cpp into two files. This allows building all tools without pulling in the entire engine.

Note that the size of some targets could be further reduced by additional refactoring in other areas.

SCons and CMake can now build all of the following targets:

* campaignd
* create_images
* cutter
* exploder
* schema_generator
* schema_validator
* test
* wesmage
* wesnoth
* wesnothd

----

This PR duplicates a commit from PR 863 to add missing targets to .gitignore.
"
92911943,Rename classes and types (mainly GUI classes) to avoid the t- prefix,CelticMinstrel,2016-11-09 06:35:56+00:00,2016-11-11 15:09:10+00:00,{},"As promised, the mass-rename that everyone has been anticipating (or possibly dreading). I tried to avoid instances of variables hiding types as a result of this, but there are probably still some that I missed.

### General Strategy

The general pattern in these renames was to loosely follow these rules:

* Types of the form `txxx` or `t_xxx` where xxx is a noun were renamed to just `xxx`.
* For some typedefs where xxx was likely to cause confusion with variable names, `xxx_t` was used instead.
* Where xxx was a verb, often a -er suffix was added so as to make it a noun.
* The GUI framework had several abstract base classes called `txxx_` with a trailing underscore; these became `xxx_base`.
* GUI2 dialog classes were placed in a new `dialogs` namespace. Helper classes and functions for GUI2 dialogs were also mostly placed in this namespace, with the exception of the widely-used `show_message` and `show_transient_message` functions.

There are several exceptions, and a few classes renamed on request to something that doesn't follow the pattern. Some examples:

* `game_events::t_pump -> game_events::wml_events_pump`
* `gui2::tcontrol -> gui2::styled_widget`
* `t_translation::t_terrain -> t_translation::terrain_code`
* `font::ttext -> font::pango_text`
* In the unit tests, `twrapper -> dialog_tester`
* GUI2 Canvas internal types gained a `_shape` suffix, eg `ttext -> text_shape`
* `gui2::tips::ttip -> gui2::tip_of_the_day::game_tip`
* `gui2::tdialog -> gui2::dialogs::modal_dialog`
* `gui2::tpopup -> gui2::dialogs::modeless_dialog`
* `gui2::twidget::tvisible -> gui2::widget::visibility`

In several cases, typedefs beginning with t- were removed altogether, either because they were only used for one declaration or because they could be easily replaced with auto."
92717653,Remove LOW_MEM,GregoryLundberg,2016-11-08 05:33:22+00:00,2016-11-11 17:20:01+00:00,{},"Per @Vultraz 

----

Hold for @CelticMinstrel to finish rename PR"
92687333,Delete support for Google Native Client (NaCL).,GregoryLundberg,2016-11-07 23:36:23+00:00,2016-11-11 15:14:27+00:00,{},"This is Chrome-only and W3C is said to be working on a portable alternative.

There is an x86-64/i686 version 1.10 of BfW on the Chrome web store. There appears to be no interest in upgrading to curret versions of NaCL and supporting the Chrome-only plugin.

----

Hold for @CelticMinstrel to finish renaming PR."
92684564,Delete ancient test of SDL keyboard handling.,GregoryLundberg,2016-11-07 23:14:32+00:00,2016-11-07 23:15:57+00:00,{},
92684133,Delete last vestiges of old networking code.,GregoryLundberg,2016-11-07 23:11:02+00:00,2016-11-07 23:16:08+00:00,{},"These files are not referenced in SCons or CMake, or any place in the source tree (except amonst themselves).

@loonycyborg missed these in commit b1d110b95eb941e921c82ddd9577a1d5e4048bc0 from 14SEP2016 ""Remove old networking stack"""
92671787,CMake unit tests,GregoryLundberg,2016-11-07 21:52:30+00:00,2016-11-07 21:57:15+00:00,{},"CMake omitted a unit test. Adding it so it runs the same tests as SCons.

CMake now runs 158 tests, the same as SCons."
92656332,Lua cleanup,GregoryLundberg,2016-11-07 20:20:39+00:00,2016-11-07 21:57:34+00:00,{},"Deleted two files we NEVER want to allow ANYONE to use.

Updated the howto markdown document."
92491145,A lot of little stuff,GregoryLundberg,2016-11-06 15:34:36+00:00,2016-11-11 18:16:57+00:00,{},"Although this is all really minor stuff having to do with cleaning up the #includes. I started this too late to offer for 1.13.6.

The idea is that every #include should fully specify the header. As a contrived example, assume a header ""manager"" in both gui/dialogs and gui/widgets. While it is legal to simply #include ""manager"" in each sub-system, it is confusing. Instead say #include ""gui/dialogs/manager"" or #include ""gui/widgets/manager"" and avoid problems.

This was build using a custom out-of-tree system where the headers are in a separate directory from the sources, using -pedantic -Wall -Wextra -Werror. The only errors or warning suppressed are those in the code, itself."
92467766,Fix size reduction of grids,jyrkive,2016-11-05 21:22:11+00:00,2016-11-08 20:42:51+00:00,{},"Currently `tgrid::request_reduce_width()` and `tgrid::request_reduce_height()` call `calculate_best_size()` at the end, which [clears saved sizes](https://github.com/wesnoth/wesnoth/blob/5984daae6e1c008ffc32e52c671a1cc66270dc55/src/gui/widgets/grid.cpp#L387-L391) of rows and columns. In addition, after calculating sizes for rows and columns the functions don't do anything useful with that information.

This pull request fixes both issues, and stops the infamous ""failed to place a grid"" message from being shown with the default log level. Failing to place a grid initially isn't an error because the size of the grid can be reduced."
92461006,Changed Shebang line of python scripts and terrain2wiki,sevu,2016-11-05 17:44:27+00:00,2016-12-06 19:52:03+00:00,{},"It's mostly about making the scripts run if python defaults to python3.
Has been tested for each script.

I hope this doesn't lower the motivation to port things to python 3."
92235206,removed DRAKE_FLYING_ANIM,sevu,2016-11-03 20:37:05+00:00,2016-11-05 08:42:19+00:00,{},"This macro isn't used anywhere in 1.12, probably even since the drakes animations have been remade.
Not even Ageless Era uses it.
DRAKE_STANDING_ANIM is the macro which gets used instead."
92231929,Size lock widget,jyrkive,2016-11-03 20:18:11+00:00,2016-11-18 14:33:54+00:00,{},"# Motivation

http://i.imgur.com/2b8urXq.png

The chat box in the MP lobby is in a grid.

```
|-----------|
|filter area|
|-----------|
| game list |
|-----------|
|  chatbox  |
|-----------|
```

On `invalidate_layout()`, a grid determines the size of all child widgets by querying their optimal sizes with `get_best_size()` and distributing any surplus space according to the grow factors.

For a chatbox, the optimal size is however much is enough to show all the existing messages at once, without a scrollbar.

As a result, the chatbox randomly grows way too large. It looks ugly, takes space away from the game list, and when it gets even larger, breaks the layout system itself.

# Size lock

This pull request introduces a new GUI2 widget called **size lock**. A size lock wraps an arbitrary widget. Its `get_best_size()` function returns the values the developer has set with a formula. As a result, the preferred size of the wrapped widget is completely ignored.

Note that a size lock can still grow beyond the allocated size if the *containing grid* decides to give additional space to the size lock. However, at least in the case of the chat boxes, it's actually an advantage because it allows the chat box to take all available horizontal space while still having a fixed height.

I locked the size of all chat boxes except the one in low-resolution MP lobby.

I left the low-resolution MP lobby one alone because trying to lock its size resulted in the lower grid disappearing completely. Further investigation showed that the player list in the lower grid wants to be initially higher than available height, and thus layout of the lower grid fails. I plan to fix that by allowing GUI2 to retry layout with minimum sizes if it fails with preferred sizes.

Since the oversized chatbox problem occurs in the 800x600 lobby as well, this PR is not yet a complete fix for that bug."
92184684,Create oc.po,Cedric31,2016-11-03 16:01:11+00:00,2016-11-03 16:35:05+00:00,{},"Please add occitan file.
Regards"
92159986,Create oc.po,Cedric31,2016-11-03 14:06:51+00:00,2016-11-03 14:31:44+00:00,{},"Add occitan file, please"
92159617,Update LINGUAS,Cedric31,2016-11-03 14:05:00+00:00,2016-11-03 16:35:47+00:00,{},"Add occitan language, please"
91955845,Fix bug: use of undeclared identifier LOCALEDIR,GregoryLundberg,2016-11-02 11:54:35+00:00,2016-11-02 12:02:19+00:00,{},"While given by the toolset, the default is set in wesonfig.h and should be used."
91697070,Add port for 1.13 in the UMC addons preferences,shemuwel,2016-10-31 21:47:03+00:00,2016-10-31 22:55:16+00:00,{},
91696473,Fix xtext javadoc path,shemuwel,2016-10-31 21:43:33+00:00,2016-10-31 22:55:08+00:00,{},Seems xtext moved their javadoc
91695717,Fix typo in readme,shemuwel,2016-10-31 21:38:12+00:00,2016-10-31 21:39:03+00:00,{},
91681061,Fix VC14 Warnig for unreachable code,GregoryLundberg,2016-10-31 20:10:22+00:00,2016-11-05 08:57:08+00:00,{},@Vultraz commented he didn't want the throw
91530357,"wesnoth.format(string str, table symbols) lua API",karatakis,2016-10-30 18:15:33+00:00,2016-11-13 16:40:43+00:00,{},"example: format('foo $var', {['var'] = 'bar'}) => 'foo bar'
"
91524031,SCons Fix bug: Git Hash,GregoryLundberg,2016-10-30 14:53:12+00:00,2016-10-30 14:54:27+00:00,{},"SCons failed to rebuild game_config when the Git hash changes. The newer version was not copied into the source tree.
"
91508053,Stone_walls transitions,doofus-01,2016-10-30 01:45:49+00:00,2016-10-30 15:48:55+00:00,{},"I've got a first draft of a default stone_wall-to-castle transition.  It doesn't work very well for dwarf castle, but it's OK for most others.  (The shading isn't finished, it is too sharp right now)
"
91480729,Add build which uses higher level of optimization,Pentarctagon,2016-10-29 06:27:45+00:00,2016-11-25 22:18:22+00:00,{},"Adds a build to scons which uses a higher level of optimization than available by default with build=release.  Anecdotally, I can say that it does seems to make Wesnoth create the cache and start a scenario a bit faster, and for whatever reason creates an executable ~4MBs smaller than build=release(16 vs 20.1).  I am unaware if there's a good way to actually benchmark to test for any speed improvements though, or what kind of WML/lua operations would make good candidates for benchmarking.

Currently only works for building on Linux, as far as I know.  Tested using g++ 5.4.0 (default for Ubuntu 16.04/Mint 18).

I have no access to testing on Macs.

As for Windows, -O3/-O2 plus LTO fails to compile when setup according to [my guide](https://forums.wesnoth.org/viewtopic.php?f=5&t=40694) due to reporting (for some reason) finding earlier definitions of methods.  -O1 plus LTO compiles, but creates a non-working executable (immediately crashes on launch).  Removing LTO allows compilation to complete, however -O3 somehow also ends up creating a non-working executable, though has been happening for some time now.  LTO without any of the -Ox options does produce a working executable, but it seems to be slower than the -O2 of build=release.
"
91091199,Don't mix new and free in lua_interpreter.cpp,rikardfalkeborn,2016-10-26 21:22:41+00:00,2016-10-27 20:07:48+00:00,{},"In practice, it probably doesn't matter since cmd_string is a char array and not a complex data type, but nevertheless it is wrong to mix new and free. Also, this seemed like a good sized change to figure out how to send PRs. Appologies if it is too minor to bother about.
"
91062996,Improvements to the Lua cave map generator,CelticMinstrel,2016-10-26 18:40:52+00:00,2016-10-27 19:48:58+00:00,{},"This branch contains some improvements to the Lua cave generator. I still have several things I want to add, but I'd like to get at least the first two commits into 1.13.6, which is why I've opened this PR now.
"
90942389,This removes references to blit_surface and introduces masks for colours,aginor,2016-10-26 06:15:19+00:00,2017-03-26 08:15:46+00:00,{},"blit_surface is slow compared to the SDL functions and is something we want to remove in order to add hardware rendering.

colours are currently defined by people manually typing out the bit masks, this
lays the groundwork for defining them manually each time. This also starts to acknowledge that alpha is a part of colours.
"
90930899,Adjust PR 841,GregoryLundberg,2016-10-26 03:32:41+00:00,2016-10-26 04:51:38+00:00,{},"@CelticMinstrel requests the flag not be exposed to Lua.
"
90774584,Fix bug: Slow narrator (Partial 25186),GregoryLundberg,2016-10-25 09:54:51+00:00,2016-10-25 09:57:30+00:00,{},"No need to deselect when it was already done.

While this is the fix for the specific complaint, it does not address the larger issue of [message] being generally slow.
"
90692307,[text_input] Fix bug 25173,GregoryLundberg,2016-10-24 21:03:31+00:00,2016-10-25 04:12:38+00:00,{},"Added an internal flag to indicate [text_input] appeared so we no longer require label= to be present.
"
90676154,SCons Fix bug: Git Hash,GregoryLundberg,2016-10-24 19:25:35+00:00,2016-10-27 13:08:13+00:00,{},"SCons failed to rebuild game_config when the Git hash changes. The newer version was not copied into the source tree.
"
90508365,AI Controller Fix bug: infinite recusion,GregoryLundberg,2016-10-23 08:08:07+00:00,2016-10-23 08:08:35+00:00,{},"Make a copy of just the header for use in sub-menus.
"
90502898,Completed deprecation of [option]message=,GregoryLundberg,2016-10-23 02:44:20+00:00,2016-10-23 02:45:41+00:00,{},"[option]message= has been deprecated, use label=

This completes deprecation of [option]message= in mainline.
"
90466111,Lua integer indices,GregoryLundberg,2016-10-22 01:50:06+00:00,2016-10-22 17:26:06+00:00,{},"@gfgtdf requested assistance with a crash in MP scenario 2p_Dark_Forecast

The cause turned out to be a change from Lua 5.2 to 5.3 which converts numbers to always have a fractional part. This means integer values will have "".0"" at the end. The unexpected input caused the engine to crash.
1. Changed all mainline which builds similar indices to conform to Lua 5.3
2. The MP startup is not complete, worked around this with a temporary fix
3. There were two issues with the Wesnoth API in the scenario
4. Updated the Lua configuration to enable compatibility with 5.2 for this error

2p_Dark_Forecast can now be played to victory/defeat although there is an error which appears complaining about an audio track being duplicated. (This may be due to my rapid play-through and is not a real error.)

The Lua compatibility should prevent errors in UMC, but will mask any remaining errors in mainline.
"
90315897,Fix Lua stack corruption,GregoryLundberg,2016-10-21 03:01:30+00:00,2016-10-21 16:41:27+00:00,{},"Do NOT pop the error message off the stack.
It has already been popped.
"
90291683,[DON'T MERGE YET] Convert boost::regex to std::regex attempt 2,Vultraz,2016-10-20 22:17:51+00:00,2016-10-20 23:49:26+00:00,{},"Convert uses of boost::regex and related functions/types to their stdlib counterparts

This covers:
- boost::regex
- boost::regex_match
- boost::smatch
- boost::sregex_iterator
- boost::sregex_token_iterator

boost::regex_constants::match_not_dot_null doesn't have a stdlib counterpart, but according to
@celticminstrel it should be alright to remove it.
"
90284665,Fix bug: Illegal index,GregoryLundberg,2016-10-20 21:28:29+00:00,2016-10-20 23:20:03+00:00,{},"This caused a Lua PANIC and crashed the game. You can NOT use the result from lua_absindex() as an index parameter for ANY Lua API function.

This ONLY fixes that SPECIFIC crash.

The game will now segfault within the Lua code.
"
89848755,Fix bug: CMake out of tree,GregoryLundberg,2016-10-18 16:10:21+00:00,2016-10-20 07:20:20+00:00,{},"Fix how wesnoth_lua_config.h is specified to allow out-of-tree builds.

I don't do out-of-tree builds so all I can say is it didn't break my build.
"
89822145,Fix a unit test,GregoryLundberg,2016-10-18 14:04:31+00:00,2016-10-18 15:22:03+00:00,{},"For some reason the macro RESULT causes the test to crash Lua.

Don't see why. Don't know why this fixes it. But this gets the tests working.
"
89749692,Ensure [endlevel] only happens once.,GregoryLundberg,2016-10-18 05:37:03+00:00,2016-10-18 06:59:24+00:00,{},"First come, first served.

This was causing many failures on Travis/CI

Use &w=1 to ignore white space viewing the diff.
"
89565209,Add ability to horizontally align story text,pydsigner,2016-10-17 06:06:53+00:00,2016-10-17 06:21:09+00:00,{},"Adds an optional attribute `text_alignment` to the [part] tag for story text alignment.

```
[story]
    [part]
        story= _""Blah""
        text_alignment=center
    [/part]
[/story
```

![](http://imgur.com/F8KLl57l.png)
"
89519749,Test for Travis and only require SDL 2.0.2,GregoryLundberg,2016-10-16 08:38:11+00:00,2016-10-16 09:22:06+00:00,{},
89517048,Require SDL2 2.0.4 on all target platforms.,GregoryLundberg,2016-10-16 05:58:15+00:00,2016-10-16 05:58:58+00:00,{},"Per @Vultraz 
"
89488268,refactor font code,cbeck88,2016-10-15 09:54:54+00:00,2016-10-16 00:47:17+00:00,{},"Try to simplify the font code, by splitting up into smaller files and organizing it more finely.

Also add code comments, and put all font-related code in font folder.
"
89424413,[DO NOT MERGE] Travis/CI Tests for Lua Upgrade,GregoryLundberg,2016-10-14 17:38:11+00:00,2016-10-14 20:43:20+00:00,{},"This is a rollup of my PRs so I can throw them against Travis/CI and try to figure out what is failing, and how to fix it, for the Lua Upgrade PR.

DO NOT MERGE.
"
89143621,Clean up some issues compiling with clang and gcc,GregoryLundberg,2016-10-13 06:31:28+00:00,2016-10-16 18:02:07+00:00,{},"The missing override qualifiers are noise warnings because override was assumed but should have been stated.

The maybe-uninitialized was to quell a warning from GCC which clang didn't produce.

The big change here is applying a patch to Boost Bind. Links to the ticket and patch are in the patched file. I was going to do this as a local change by putting the patched file into my /usr/local/include but gfgtdf requested it be put into master with a version check so when Boost 1.63 comes out we'll stop using the patched header. I checked and Boost has tagged 1.62, but this patch was not tagged.
"
89035169,Made Drake Flying Animations working on more terrains.,sevu,2016-10-12 15:13:10+00:00,2016-10-26 20:41:35+00:00,{},"E.g. they weren't working on water with water lilies before.
The terrain codes are now more generic too, for the case somebody wants to make an UMC variation.
Also had a look on other places where terrain codes get used.

There is also the DRAKE_FLYING_ANIMATION macro. It's not getting used, seems to be an old Artifact. DRAKE_STANDING_ANIMATION does the same thing.
I guess I can't just remove it but have to move it to macros/deprecated-utils?
The onliest reference to that macro is in data/tools/emacs_mode/wesnoth-wml-data.el
"
88992364,Suppress NO_FIFO_DIR message on WIN32,GregoryLundberg,2016-10-12 10:39:26+00:00,2016-10-13 16:36:28+00:00,{},"Clean up the #if guards to suppress the message and code which does not execute on Windows because it has no FIFO support.
"
88959645,Upgrade to Lua 5.3.3+,GregoryLundberg,2016-10-12 06:20:42+00:00,2016-10-18 01:58:12+00:00,{},"We begin with a series of changes to move aside as much as possible in the goal of returning to a clean source kit for Lua 5.2.3; this completes with moving all Wesnoth-specific local changes to luaconfig.h to the area reserved from them.

This initial process creates two new files: wesnoth_lua_config.h and wesnoth_lua_config.md and updates the tool-set project files accordingly. The header is injected into ONLY the Lua sources and makes those changes required for Wesnoth which do not need to be in the source kit for Lua. At present, the markdown file is empty. I intend to document the upgrade process, any local patches, etc., in that file.

Once the Lua 5.2.3 source kit has revered and matches the as-released files, the commit ""Replace Lua 5.2.3 with Lua 5.3.3"" effectively deletes the entire Lua source kit and copies in the clean, unchanged source files from http://www.lua.org/

Next follows a series of patches to the source kit. The first is mine, two minor changes to correct compiler warnings. The next three apply patches from http://www.lua.org/ for known problems in Lua 5.3.3

The remaining commits complete the upgrade by updating the Lua libraries exposed to scripting, and the tool-set project files for Visual Studio, CMake and SCons, and document changes.

At present, the only testing performed was a clean build using SCons and a play-test of Heir to the Throne. Both completed without any unexpected messages. I will be testing CMake and Visual Studio builds.

NOTES

At present, all compatibility with Lua versions 5.0, 5.1 and 5.2 is DISABLED. This can be selectively re-enabled, as indicated by testing.

Lua ""bit32"" library has been deprecated and removed. This can be returned if needed by enabling Lua 5.2 compatibility and loading the library during Lua startup.
"
88760249,GUI2 File Dialog bookmarks bar,irydacea,2016-10-11 02:09:08+00:00,2016-10-12 06:11:01+00:00,{'Enhancement': 1},"This adds a bookmarks bar to the file dialog. ~~Support for adding and removing user-defined bookmarks is not implemented yet~~ (**EDIT:** As of 24 hours later, now it is), but predefined bookmarks are already in place for things like the core data dir, user data dir, user prefs dir, user home dir, drives, and so on.
"
88754878,Supress warnings,GregoryLundberg,2016-10-11 00:50:50+00:00,2016-10-16 01:54:25+00:00,{},"Replacing fribidi_log2vis looks like more work than it's worth.

Checking the fribidi mailing list, I see remarks that it's not likely to go away and recommending people who hit the warnings ignore them and continue using the function.
"
88736199,helper.lua: set __metatable field to guard against external access to metatables,CelticMinstrel,2016-10-10 21:42:49+00:00,2016-10-16 07:10:14+00:00,{},"Defender1031 noticed that the helper metatables are not guarded against external access via `getmetatable()`, allowing other code to arbitrarily change them and potentially break things. This commit fixes that.
"
88605183,Safer campaignd file commits,irydacea,2016-10-10 02:48:54+00:00,2017-09-14 22:26:45+00:00,"{'Bug': 1, 'Backport': 1}","See first commit message.
"
88601230,Revised square walls,doofus-01,2016-10-10 00:43:32+00:00,2016-10-24 02:04:39+00:00,{},"Only **d1ca049** is supposed to be here, the earlier crap commits are there because I've given up trying to get git to do what I want.  I hope they are not too much of a headache.
"
88564295,Time of day variants,doofus-01,2016-10-09 01:09:39+00:00,2016-10-09 01:15:58+00:00,{},"The lights are on at night, but off during the day.
This is currently for merfolk villages, but eventually could be for other villages too, and other things like the aquatic castle towers.
"
88556187,Lua integration cleanup,GregoryLundberg,2016-10-08 19:21:09+00:00,2016-10-10 17:11:30+00:00,{},"This branch cleans up some of the current integration of Lua into Wesnoth.

This work is in preparation for upgrading the Lua engine. These changes reduce the future work needed for the upgrade. Additional changes will be forthcoming. This is being put forward as a PR for inclusion in 1.13.6.
"
88547598,some variations and better cropping for aquatic castle walls,doofus-01,2016-10-08 14:30:31+00:00,2016-10-08 19:46:05+00:00,{},"The images should just work as drop-in replacements.  I'm not sure this is done yet.
"
88533385,some edits to images/attacks and images/icons images,doofus-01,2016-10-08 04:25:47+00:00,2016-10-08 05:14:02+00:00,{},"These are mostly just some simple touch-ups to attack icons and (general?) icons that I thought looked a bit out of place compared to the other images.  For the most part, it meant increasing contrast and dirtiness.
"
88206207,Avoid hidden variable warnings produced in MSVC compilation,Wedge009,2016-10-06 06:41:24+00:00,2016-10-06 17:03:44+00:00,{},"An extension of af73336, hopefully this will remove some more of the warnings which pop up in MSVC compilation. Also try to use more explanatory variable names as code should generally be self-documenting and easy to read.

(Not that I think the names I picked are necessarily easier to read, but some of the older code is hard for me to interpret. Especially those single-character variable names!)
"
87713301,wmlxgettext: added support for plural forms (used on lua files),AncientLich,2016-10-03 13:08:38+00:00,2016-10-09 11:49:10+00:00,{},"# wmlxgettext support for plural

Changelog:
- Added **--version** option (wmlxgettext version number is written in 
  _YYYY.MM.DD.py3_ format, where ""_py3_"" underline the language used on 
  wmlxgettext: python 3.x)
- Added **--DMode** option --> I introduced a ""stable"" debugging code that can
  be executed only using this option. It will write an extra file (_debug.txt_)
  wich will record all the state sequences. It is a really useful option that
  helps me to debug wmlxgettext if something doesn't work as expected.
  Obliouvsly this option is useless for an end-user.
- Added lua plural support
## tests successfully passed
### lua different string type, but no textdomain changes

The first test I did was focused to find and fix possible bugs on basic usage.
I tested wmlxgettext using this [lua source file](https://github.com/AncientLich/wmlxgettext-unoff/blob/master/wmlxgettext/test/reports/2016.10.03/tlua1.lua)

`wmlxgettext --domain=test1 -o tlua1.pot tlua1.lua`

And this is the [resulting pot file](https://github.com/AncientLich/wmlxgettext-unoff/blob/master/wmlxgettext/test/reports/2016.10.03/tlua1.pot)
Wich is exactly the desired result file.

**NOTE**: As you can notice, header file doesn't have the `nplurals` info, and
all plural sentences are associated to `msgstr[0]` and `msgstr[1]`.
Those settings, infact, higly change from language to language. They will be
""fixed"" by the gettext tool _msginit_ .

`msginit -i input.pot -o dest_language.pot -l LOCALIZATION_CODE`
### Old vs new release on pot-update

This test was focused to check if the code I needed to add to allow the support
for plural forms on wmlxgettext introduced or not new bugs on the previous
features.
What we wanted to see here is that there are **NO** differences from the pot
files created by pot-update wesnoth target build, comparing the results created
by current implementation of wmlxgettext vs the new one.

For personal setup I cannot use directly the official pot-update, so why I 
developed a tool called _wescheck.py_ wich is available on my wmlxgettext
personal repository.

_wescheck.py_ originally was intendent to run _perl_ wmlxgettext, then _python_
wmlxgettext, comparing the results and error logs.

Test was performed against wesnoth 1.13.4 source directory

I will omit to write here all the tecnical details about the test, wich can be
[readed here](https://github.com/AncientLich/wmlxgettext-unoff/blob/master/wmlxgettext/test/reports/2016.10.03/wescheck.txt) if you are really interested.

What is important is the [resulting diff file](https://github.com/AncientLich/wmlxgettext-unoff/blob/master/wmlxgettext/test/reports/2016.10.03/test2.diff).

As you can check, the result is the desired one (all the differences, except ù
one, are related to file time creation, wich is expected). 

There is only an actual difference: on line 197 of the diff file you can notice
that the NEW wmlxgettext implementation captured another translatable string 
previously ignored

``` lua
local wait_description = cfg.wait_description or _(""input"")
```

The new captured string (_input_) comes from this lua line code
(under data/lua/wml/message.lua:233, as marked by the diff file)
### testing updates on the same sentences

This test want to verify that the plural form is successfully updated on the
same sentence. This is the [lua test file](https://github.com/AncientLich/wmlxgettext-unoff/blob/master/wmlxgettext/test/reports/2016.10.03/tlua3.lua) we used as source. 

We have to test different scenarios:

1) Sentence that originally doesn't have a plural form, but later will have it.
Desired result: sentence with plural form, with references of every time
the sentence was met (regardless if plural form was specified or not)
**on pot file:** sentence1 (singular), sentence1 (plural)
2) Sentence that originally HAVE a plural form, but later not.
It is the opposite of case 1, but the expected result is the same.
**on pot file:** sentence2 (singular), sentence2 (plural)
3) Sentence that, for any reason, definde different plural values in different
points. Desired result: we want that the FIRST plural occurrence will be used
and other implementations will be discarded
**on pot file:** sentence3 (singular), sentence3 (plural)
4) Case 1 and 3 combined.
**on pot file:** sentence4 (singular), sentence4 (plural)

`./wmlxgettext --domain=test3 -o tlua3.pot tlua3.lua`

will produce [this pot file](https://github.com/AncientLich/wmlxgettext-unoff/blob/master/wmlxgettext/test/reports/2016.10.03/tlua3.pot), wich is exactly the result we expected.
### testing plural form and multiple textdomain

This test will focus to verify if the pot file will contain ONLY the desired
translations contained into the desired textdomain.

This is the [lua test file](https://github.com/AncientLich/wmlxgettext-unoff/blob/master/wmlxgettext/test/reports/2016.10.03/tlua4.lua) I used, and this is the
[pot file](https://github.com/AncientLich/wmlxgettext-unoff/blob/master/wmlxgettext/test/reports/2016.10.03/tlua4.pot) produced.
### testing mixed WML-lua file

This is the final test with a custom file. 
Here the [WML test file](https://github.com/AncientLich/wmlxgettext-unoff/blob/master/wmlxgettext/test/reports/2016.10.03/test5.cfg) used for the test, and here the
[generated POT file](https://github.com/AncientLich/wmlxgettext-unoff/blob/master/wmlxgettext/test/reports/2016.10.03/test5.pot)
"
87707527,UtBS: Integrate the redesigned Quenoth elves,ln-zookeeper,2016-10-03 12:26:56+00:00,2016-10-26 09:12:40+00:00,{},"Because they are still a work-in-progress, they exist alongside the old ones and can be selected via the campaign difficulty menu. The old ones will be replaced once the work is complete enough.
"
87700662,Clarify the display of the remaining ban duration to banned users,ln-zookeeper,2016-10-03 11:28:17+00:00,2016-10-06 15:38:21+00:00,{},"Note: this hasn't actually been tested, so extra proofreading (or even testing, if someone feels up to it) would be good.
"
87697135,Remove SDL_GPU #idfefs and library,aginor,2016-10-03 10:57:30+00:00,2016-10-03 17:53:49+00:00,{},"As requested by @Vultraz  and @shikadilord .

Commands run:
find . -type f -name ""_.hpp"" | xargs coan source --replace --no-transients -U""SDL_GPU""
find . -type f -name ""_.cpp"" | xargs coan source --replace --no-transients -U""SDL_GPU""

This was followed by grepping and a bit of manual editing to remove
defunct TODO items and the empty sdl/gpu.hpp file.
"
87619874,Improve move times for AI sides with many guardians,mattsc,2016-10-02 00:12:29+00:00,2016-10-04 00:18:10+00:00,{},"This PR contains two changes which significantly improve AI move times for AI sides with many guardian units.  The first commit improves evaluation times for the guardian units themselves.  The second improves times for the other AI units.
"
87612437,Pentarctagon two portraits fix,Pentarctagon,2016-10-01 19:35:39+00:00,2016-10-01 22:36:56+00:00,{},"The implementation of [this](https://gna.org/bugs/?12098) feature request resulted in the content of a message being [squished](http://cubeupload.com/im/Pcxsvs.png).  The change to wml_message.cfg fixes that issue.

[With no text](http://i.cubeupload.com/7GTS22.png)
[With text](http://i.cubeupload.com/inCkod.png)
[With text and options](http://i.cubeupload.com/ET1bjV.png)
[With text and text input](http://i.cubeupload.com/C4q4po.png)
[With text, text input, and options](http://i.cubeupload.com/7CkSRJ.png)

The change to message.lua then allows the [message] tag to display and mirror two portraits.
"
87246195,include ctime header for time_t,lv-zheng,2016-09-29 04:53:27+00:00,2016-09-29 04:59:33+00:00,{},"Missing #include causes compilation error with clang++.
"
86903160,add woptipng png compression script,matthiaskrgr,2016-09-27 10:33:13+00:00,2017-01-15 20:53:16+00:00,{},"An improved version of the wesnoth-optipng shell script.

Supports multiple jobs at a time. ( -j )
Accepts a threshold for discarding images which were only reduced by a few bytes. ( -t 15 will only save images that were reduced in size by at least 15 %)
Niceness can be set using the -n switch.

Usage:
cd directory
woptipng . ../some/dir  ../some/some_file.png

The script should achive better compression ratios than the previous script.
The previous script was running optimizations in an unconditional loop and, at the end, did not save the image if pixel colors changed.
This implies if _one_ of the crushers did a bad job and changed the images content in a bad way, _none_ of the possibly good optimizations by the other crushed would be saved.
Woptipng checks the image every time after a crusher touched it and only reverts a single optimization if it was bad leaving possibility for the other tools to still perform a good job and reduce size of the image.

I played around with different thresholds, here are the results (default is 10 % )

942 files optimized, 6100565 bytes reduced to 5033442 bytes; -1067123 bytes, -17.49%
Optimization threshold was 5.0%

580 files optimized, 3568925 bytes reduced to 2673265 bytes; -895660 bytes, -25.09%
Optimization threshold was 10.0%

490 files optimized, 2833893 bytes reduced to 2023989 bytes; -809904 bytes, -28.57%
Optimization threshold was 15.0%

update
-----------------
numbers as of dec 24 / 5c6902f3a84ad20eb30530392c5f3f0049faf405

1111 of 13636 files optimized, 6799220 bytes reduced to 5667176 bytes; -1132044 bytes, -16.64%
Optimization threshold was 5.0%

680 of 13636 files optimized, 3827739 bytes reduced to 2895860 bytes; -931879 bytes, -24.34%
Optimization threshold was 10.0%

555 of 13636 files optimized, 2973476 bytes reduced to 2141802 bytes; -831674 bytes, -27.96% Optimization threshold was 15.0%"
86836602,refactored Troll Shaman animation,sevu,2016-09-26 23:18:31+00:00,2016-09-27 08:46:30+00:00,{},
86625809,clean up wooden floor terrain transitions,doofus-01,2016-09-24 18:10:57+00:00,2016-09-26 10:47:36+00:00,{},"Transition images were clipped to one hex and some chasm/lava/wood_floor transition glitches were fixed.
"
86620235,Fix GUI2 multiplayer tests,jyrkive,2016-09-24 14:57:31+00:00,2016-09-25 17:16:27+00:00,{},"These changes get the GUI2 multiplayer tests to pass. They broke when @Vultraz added the GUI2 MP staging dialog.

Instead of pushing directly, I made a PR about these changes because I'm unsure if having the test plugin explicitly tell the game to process incoming test data (host-gui2.lua:80) is anywhere near the right approach. Any thoughts, @Vultraz?
"
86613298,Resolve sides in editor not having a proper side number (bug #25093),Wedge009,2016-09-24 09:38:42+00:00,2016-09-24 13:14:06+00:00,{},"Regarding the method commentary in context_manager.hpp, these are the kind of comments which are (mostly) useless - well-written method names should obviate the need for an explanatory comment. However, I replaced the 'TODO' and followed existing convention in this case.

This resolves https://gna.org/bugs/?25093 by replicating missing behaviour from 1.12 branch, however @Vultraz mentioned that he has 'an idea' and 'will investigate later' (#wesnoth-dev - 2016-09-24 07:08 UTC), so this may not be the 'proper' way to go about resolving the bug.
"
86442210,The Hammer of Thursagan (THoT) Corrections,GregoryLundberg,2016-09-23 01:40:56+00:00,2016-10-11 19:40:43+00:00,{},"This completes my code-read and play-test of THoT.

Most changes were minor. The changes effecting game-play are:

The treatment of the Mages obtained from Master Perrin’s academy has been adjusted. The ability to recruit mages is now gained when they appear, and lost immediately upon the death of the last one rather than lingering until the start of the next scenario.

In S08 ('Fear') it was possible to meet the enemy without previously capturing a village and having Ollin appear. This rendered the closing scene difficult to understand. Now, meeting the enemy also triggers Ollin's appearance.

And the following other major changes were made:

The Lua function used to spawn indigenous units which appear when capturing villages during S05 ('Invaders') has been corrected, debugged and revised to reduce the [message] chatter.

The treatment of Ratheln has been adjusted to show him as a victory condition when appropriate, and to ensure he is available to deliver his lines.

**NOTE**

The final scene, S12 ('The Underlevels') has feedback which indicates a major problem with balance. I have made some minor corrections. Vultraz and/or Aeth have been talking about a major rework. So, I will be doing no more work on S12.
"
86420174,Refactor of menus to remove old markup,CelticMinstrel,2016-09-22 21:44:09+00:00,2016-11-15 17:11:57+00:00,{},"Not quite finished yet (all the editor menus I tested work, but most in-game menus are currently unresponsive).

If anyone wishes to test the editor menus or review the code (which still needs to be cleaned up to remove commented stuff, etc), then feel free. I tested most of them, but couldn't test unit facing (since units can't be placed to access it) and skipped recent maps (in the file menu).
"
86387671,images: crush pngs,matthiaskrgr,2016-09-22 18:15:31+00:00,2016-09-24 13:12:41+00:00,{},"Current version of the wesnoth-optipng script runs different optimizations on an image.
The problem is, if one of these optimization changes pixel color, all other optimizations are discarded as well.

In this commit I ran the optimizations independently (semi-manually) to optimize images that could not be optimized before.
Only images that were reduced by at least 10% in size, or if the reduction was larger than 1000 bytes should be included and since and all images were run through compare_images.py by the script while crushing.
 For the record, without the 10%/1000b  restriction, 11974 file would have been changed.

```
stats:
  1133 binary files changed 94949833 b (90 Mb) -> 93233125 b (88 Mb) => [-1716708 b (-1 Mb)]
```

I remember there were some problems once where a big crush commit had to be reverted, so it would be nice if people from different platform (windows/mac) could check that this briefly and give an ok. :)
"
86386428,wesnoth-optipng: only save new file if size was reduced by 10% or at least 1000 bytes,matthiaskrgr,2016-09-22 18:07:40+00:00,2016-09-24 00:08:46+00:00,{},"This avoid a lot of noise due to images being reduced only by a couple of bytes.
"
86221428,tips: add tip to recall units instead of recruiting them if costs > 20,matthiaskrgr,2016-09-21 18:59:18+00:00,2016-09-23 09:52:12+00:00,{},
86164422,"reports: remove unused variable ""str""",matthiaskrgr,2016-09-21 13:41:16+00:00,2016-09-21 13:42:07+00:00,{},"Remove unused variable, probably a leftover from when the function was originally copied from another function.
Found with cppcheck.
"
85892103,Fix bug: Debug|Kill [have_unit] error,GregoryLundberg,2016-09-20 00:20:41+00:00,2016-09-20 00:23:34+00:00,{},"Set the killed units hit points to zero so [have_unit] does not find it.

This prevents adding [kill] to [event]name=die simply to support Debug|Kill.
"
85882846,Fix bug: Lua harm_unit,GregoryLundberg,2016-09-19 22:43:02+00:00,2016-09-19 23:41:53+00:00,{},"Missing local T.

cf https://forums.wesnoth.org/viewtopic.php?f=21&t=44567
"
85720275,new terrain:  aquatic castles,doofus-01,2016-09-18 19:36:57+00:00,2016-10-06 20:09:24+00:00,{},"Not quite ready for committing, because it still needs keep-castle images.
"
85711865,Tunnels: fix issues with vision,mattsc,2016-09-18 14:32:18+00:00,2016-09-20 13:52:08+00:00,{},"I think this is ready for testing and merging now.

There are some remaining questions about what should happen when there is an invisible unit on the tunnel exit hex, either because it's an enemy ambusher or because vision is not shared with an allied side.  Should the unit be revealed through the tunnel?  Should a message be displayed on-screen?  Etc.  But those are general questions as to what the correct behavior should be and have nothing specific to do with this PR.
"
85701420,HttT S23 Fix bug: Unclear objective,GregoryLundberg,2016-09-18 07:55:09+00:00,2016-09-18 09:31:35+00:00,{},"The bonus is (1) recruit Knights and (2) the defeated leaders join you for the Battle for Wesnoth. You do not need to defeat all four for this.
"
85695852,HttT units: Review needed.,doofus-01,2016-09-18 03:46:53+00:00,2016-09-26 11:00:20+00:00,{},"These are some updates to some units in HttT.  For now it is Ashevier, Lisar, and the Sea Orc.  They aren't the greatest animations, but I think they good enough for units that aren't encountered often.  Sea Orc is a joke unit, sorry if I ruined the joke.  If I didn't ruin the joke, I can come up with a portrait (based off some mainline unit, this guy doesn't really deserve a new or commissioned portrait).  Let me know, either way.
"
85667876,Enable GUI2 lobby in GUI2 MP test,jyrkive,2016-09-17 08:13:54+00:00,2016-09-25 17:18:47+00:00,{},"This PR makes automatic multiplayer tests enable or disable the GUI2 lobby depending on if they require the new lobby to be enabled or disabled. As a result, it is now possible to run both GUI1 and GUI2 multiplayer tests in Travis CI. 👍 
"
85667836,Expose preferences to plugins,jyrkive,2016-09-17 08:11:36+00:00,2016-09-25 16:50:23+00:00,{},"This pull request allows plugins to read and change game preferences.

It's a dependency for #787 .
"
85662163,Add test button to title screen in debug mode,CelticMinstrel,2016-09-17 03:16:51+00:00,2017-05-09 19:30:58+00:00,{},"This makes tests a little more accessible for the average user, I suspect (which might be particularly good for the AI test scenarios). On the other hand, the button will appear if you start a campaign, enable debug mode, and then exit. Maybe that's fine, not sure. There's no hotkey for this button, though that could easily be added later.
"
85658515,move Httt 17 mapgen (cave_map_generator.cpp) to lua.,gfgtdf,2016-09-17 00:54:39+00:00,2016-09-17 19:08:12+00:00,{},
85648813,HttT Player changelog,GregoryLundberg,2016-09-16 22:26:42+00:00,2016-09-19 21:13:50+00:00,{},"Hold for merge until all PRs merge.
"
85479098,Fix issues with tunnels when exit hex is occupied by an allied unit,mattsc,2016-09-15 20:58:22+00:00,2016-09-16 13:51:05+00:00,{},"Previously, units on the tunnel exits blocked tunnels, but this was not checked until the move execution, resulting in inconsistencies between displayed and possible moves even without fog. It also caused such units effectively to act as ambushers. This PR removes these inconsistencies.

It also adds a new boolean parameter, pass_allied_units, to the [tunnel] tag, which lets the scenario designer choose whether units can move through allied units on the tunnel exit.
"
85461839,Change most vector<bool> to dynamic_bitset,CelticMinstrel,2016-09-15 19:07:52+00:00,2016-09-16 02:59:16+00:00,{},"A few cases were skipped, most of which involved 2D bitsets (eg shroud) or uses that could not be easily translated (eg GUI1 multimenu).

In a few cases, code needed to be updated for the different API that the dynamic_bitset provides, but in most cases, this change is entirely transparent.

There are probably a few unnecessary dynamic_bitset.hpp includes.

One use of vector<bool> was replaced instead with std::bitset, since the dynamic size was not required.
"
85439759,Change colors of ToDs,Asheviere,2016-09-15 16:47:13+00:00,2016-09-24 13:22:48+00:00,{},"This mostly makes night darker and makes dusk more red.

It also makes the summer and winter schedule have more of a use, since they now have slightly different colors.
"
85393847,add wml_x/y() getter & setter in map_location,gfgtdf,2016-09-15 12:24:33+00:00,2016-09-17 22:48:34+00:00,{},"The intention here was to change map_location to use the same format as the wml code, meaning (1,1) refers to the upper-left corner of the walkable area and (0,0) to the upper-left corner of the border.

Not sure if that can be done, in any case this is step towards that.
"
85340565,GUI2 File Dialog,irydacea,2016-09-15 03:29:08+00:00,2016-10-05 06:06:43+00:00,{},"Port of the file dialog to GUI2.
"
85223893,use boost locale for strftime,gfgtdf,2016-09-14 13:06:38+00:00,2016-09-19 11:50:50+00:00,{},"Do not merge, not complete yet.

this should fix http://gna.org/bugs/?24927 

I locally have boost locale build with icu backend and i am not sure wther it also works of boost locale wasn't build with icu backen.

Since i dont really know what that other stuff in strftime did i am also not sure whther it might break other things.

This also still needs soem cleanup before merging.
"
84957315,Various surface handling cleanups,Vultraz,2016-09-12 22:38:05+00:00,2016-09-24 06:33:44+00:00,{},"Bunch of cleanup to our surface utility functions, especially geared towards creating fewer temporary surfaces.
"
84955552,Honor special locations in terrain mask,GregoryLundberg,2016-09-12 22:22:41+00:00,2016-09-16 00:04:02+00:00,{},"Added overlay_special_locations=yes|no, default no, to [terrain_mask]. When yes, side starting locations and special locations marked in the mask replace those in the effected area of the underlying map by removing any from the underlying map, and applying only those given in the mask.
"
84805517,[WIP] initialize the lua kernel earlier,gfgtdf,2016-09-12 01:35:37+00:00,2016-09-12 17:09:07+00:00,{},"This allows user defined [effect]s to be used in [unit]s in [side],
previously those units were created before sutom effects were added,
"
84801622,new terrain: Merfolk or aquatic camp,doofus-01,2016-09-11 23:30:54+00:00,2016-09-18 10:23:38+00:00,{},
84801518,Fix bug: Map may not have starting positions,GregoryLundberg,2016-09-11 23:26:38+00:00,2016-09-16 20:12:25+00:00,{},"Look before you leap ...
"
84774711,Fix bug: Crash loading replay,GregoryLundberg,2016-09-11 02:31:50+00:00,2016-09-11 11:40:34+00:00,{},"For reproduce: play a scene, when the next settles down use Menu|Load to load the replay just created for the previous scene.

gtgftd suggested this patch. Seems to work. PR to document change for review.
"
84773495,Snub warnings,GregoryLundberg,2016-09-11 01:22:57+00:00,2016-09-11 01:47:51+00:00,{},"Add some initializers to quiet GCC warnings about missing initializers.

This fixes the warnings on GCC, don't know what it does with other compilers.
"
84765356,Fix bug: 'text' is nil,GregoryLundberg,2016-09-10 19:28:20+00:00,2016-09-10 21:13:59+00:00,{},
84726062,Fix some Travis compile errors,CelticMinstrel,2016-09-09 22:00:09+00:00,2016-09-10 02:55:42+00:00,{},
84403196,Allow screen resolution to change in fullscreen (Bug #24583),IamTechknow,2016-09-08 02:03:37+00:00,2016-09-08 17:48:31+00:00,{},"When support was added for SDL2, the UI did not allow the screen resolution to change while in full screen. Here I restore this functionality by changing the full screen flag instead of the flag used that makes the full screen take on the desktop resolution.

https://gna.org/bugs/?24583
"
83907155,Fix bug: user_team_name is wrong,GregoryLundberg,2016-09-03 21:56:44+00:00,2016-09-04 19:04:46+00:00,{},"When pressing End Scenario and proceeding to the next scenario, the user_team_name shown on Menu|Status Table is incorrect.

If you Load (from the title screen) the saved scenario-start, the correct user_team_name appears.

This is caused by the random-shuffle feature for multi-player scenario. This fixes it for Single-Player campaigns and tries not to break it too badly for randomized Multi-Player campaigns.
"
83885298,Fix bug: Error typically means error,GregoryLundberg,2016-09-03 04:02:39+00:00,2016-09-03 04:16:40+00:00,{},"grep'd and didn't find any other places this massively stupid mistake appeared.

rather than change behavior, after correcting the definition, changed the calls.
"
83885072,New high_xp_attack candidate action for default AI,mattsc,2016-09-03 03:50:35+00:00,2016-09-04 14:02:40+00:00,{},"This CA performs attacks on enemy units so close to leveling that the
default AI's combat CA would not attack them (with some exceptions).
It is meant to keep players from being able to exploit this known
weakness of the default AI.

There is a test scenario that demonstrates a lot of different cases of when/how this AI attacks (and some when it does not attack), including several rarely occurring border cases.  It can be started with the ‘-thigh_xp_attack’ command-line option.
"
83732398,[role] always error on missing role=,GregoryLundberg,2016-09-02 01:19:54+00:00,2016-09-02 02:26:35+00:00,{},"I changed my Felony Abuse of a Feature to use role="""" to suppress the wml_error message.

It's best to always issue the error, even if we're going to auto_recall
"
83552513,Errors during Load if the save file has non-standard terrain,GregoryLundberg,2016-09-01 00:29:45+00:00,2016-09-01 00:36:34+00:00,{},"To start this off, this first patch stops duplicated messages about the error.
"
83499434,Fix bug [role] missing role=,GregoryLundberg,2016-08-31 17:56:03+00:00,2016-08-31 18:23:05+00:00,{},"Missing role for [role] caused runtime errors. Do NOT report an error on this; using an empty string is intentional. It allows type-prioritized recalls!

""I want to recall the two highest-level bowmen and, if needed, will recruit them. They don't have a role, and won't need one later.""

```
    [repeat]
        times=2
        [do]
            [role]
                search_recall_list=only
                type=Master Bowman,Longbowman,Bowman
                [auto_recall][/auto_recall]
                [else]
                    [unit]
                        placement=leader
                        side=1
                        type=Bowman
                    [/unit]
                [/else]
            [/role]
        [/do]
    [/repeat]
```
"
82997936,Fix crash on placing a unit with the scenario editor,jyrkive,2016-08-27 20:35:34+00:00,2016-09-06 20:27:03+00:00,{},"The `unit::get_ability_bool()` function accessed `resources::gameboard` that
is not set in the editor. Now the function receives the display context
as a parameter instead.

I also fixed two crashes on editor startup in MSVC debug builds (both
caused by indexing the teams vector when there aren't any teams), and the
GUI2 unit list dialog showing wrong status icons.

The change ended up larger than I thought. Do you think I should make the `get_ability_bool()` function use `resources::gameboard` by default, and only use a different display context if it's passed explicitly?
"
82640772,Add mode=replace to [modify_unit],GregoryLundberg,2016-08-25 00:39:17+00:00,2016-08-30 16:31:23+00:00,{},"When specified, replace rather than merge the [unit] sub-tags. Does not effect [object], [trait], [effect] or [advancement].

For example:

```
[modify_unit]
    [filter]
        id=Deoran
    [/filter]
    mode=replace

    [filter_recall]
        [not]
            id=""Sir Gerrick""
        [/not]
    [/filter_recall]
[/modify_unit]
```

will replace the current contents of [filter_recall] with the given contents. Without mode=replace, the contents would be appended to the previous contents.
"
82592976,Fix error unstoring a unit to the recall list,GregoryLundberg,2016-08-24 18:26:06+00:00,2016-08-24 19:11:34+00:00,{},
82590356,Fix networked commands only appearing in non-networked games.,Ekdohibs,2016-08-24 18:09:11+00:00,2016-08-24 18:10:24+00:00,{},
82200437,Remove dead code,GregoryLundberg,2016-08-22 14:25:31+00:00,2016-08-22 14:25:58+00:00,{},"Tested with just cfg.message and it comes out as info/wml which seems just fine.
"
82123762,AToTB S02 Improve AI,GregoryLundberg,2016-08-22 01:15:53+00:00,2016-08-30 16:27:31+00:00,{},"This tells the AI for side 3 to ignore villages as candidate actions. This finishes the changes making side 3 move toward the player (side 1) without distraction.

I just learned of this, and tested it. Works great.
"
82092315,New wood transitions,doofus-01,2016-08-20 23:23:44+00:00,2016-08-21 02:00:59+00:00,{},"Terrain and Terrain Graphics:  adding wooden floor variation and new transitions to chasm, water, and lava
"
82065305,Fix bug with gender-specific messages in [message],GregoryLundberg,2016-08-20 01:45:21+00:00,2016-08-20 01:59:41+00:00,{},
82064228,HAS_NO_TURN_LIMIT objectives macro,GregoryLundberg,2016-08-20 01:08:23+00:00,2016-08-20 01:59:24+00:00,{},"A convenience macro to add a standardized note to the objectives pointing out there is no turn limit.

I considered going through all the mainline scenario with turns=-1 and adding this, but decided it would be best to wait and change each, after consideration for each case, when reviewing them.
"
82032962,Make wesnothd build with Visual Studio,jyrkive,2016-08-19 19:27:56+00:00,2016-08-22 18:57:36+00:00,{},"I'm trying to investigate the problem that causes our multiplayer tests to hang in Travis. It would be much easier if I was able to build wesnothd locally with MSVC. Thus, I made the necessary changes to make it build.

The `room` and `room_manager` classes can't be compiled (they use nonexistent functions) and already aren't compiled in Travis according to the logs, so I just removed them.
"
81413916,Show correct number of attacks when using swarm weapon special (bug #24978),Wedge009,2016-08-16 04:46:10+00:00,2016-08-16 04:47:06+00:00,{},"I'm not sure if this is the correct use of the various weapon objects, but this is the best I could work out from what I can see of the code. Please review and merge when satisfied or let me know what needs to be corrected.
"
81234167,"Revert ""Add new event handlers to a staging area""",GregoryLundberg,2016-08-14 04:50:29+00:00,2016-08-14 08:50:09+00:00,{},"This reverts commit f621d7fa46025300a314da3004db8ddc53982c18.

```
pure virtual method called
terminate called without an active exception
[Thread 0x7fffe36e9700 (LWP 10938) exited]

Thread 1 ""wesnoth"" received signal SIGABRT, Aborted.
0x00007ffff290f04f in raise () from /usr/lib/libc.so.6
(gdb) backtrace
#0  0x00007ffff290f04f in raise () from /usr/lib/libc.so.6
#1  0x00007ffff291047a in abort () from /usr/lib/libc.so.6
#2  0x00007ffff32264bd in __gnu_cxx::__verbose_terminate_handler () at /build/gcc/src/gcc/libstdc++-v3/libsupc++/vterminate.cc:95
#3  0x00007ffff3224276 in __cxxabiv1::__terminate (handler=<optimized out>) at /build/gcc/src/gcc/libstdc++-v3/libsupc++/eh_terminate.cc:47
#4  0x00007ffff32242c1 in std::terminate () at /build/gcc/src/gcc/libstdc++-v3/libsupc++/eh_terminate.cc:57
#5  0x00007ffff3224e2f in __cxxabiv1::__cxa_pure_virtual () at /build/gcc/src/gcc/libstdc++-v3/libsupc++/pure.cc:50
#6  0x000000000215b5ac in events::pump () at /home/lundberg/wesnoth/src/events.cpp:550
#7  0x00000000017e9199 in gui2::twindow::show (this=0x3088320, restore=false, auto_close_timeout=0) at /home/lundberg/wesnoth/src/gui/widgets/window.cpp:675
#8  0x0000000001c481e3 in gui2::tdialog::show (this=0x7fffffffd300, video=..., auto_close_time=0) at /home/lundberg/wesnoth/src/gui/dialogs/dialog.cpp:51
#9  0x0000000001c8e506 in gui2::tloadscreen::display(CVideo&, std::function<void ()>) (video=..., f=...) at /home/lundberg/wesnoth/src/gui/dialogs/loadscreen.cpp:202
#10 0x0000000001beea20 in game_launcher::launch_game (this=0x2d38790, reload=game_launcher::NO_RELOAD_DATA) at /home/lundberg/wesnoth/src/game_launcher.cpp:994
#11 0x00000000015f55f6 in do_gameloop (args=std::vector of length 1, capacity 1 = {...}) at /home/lundberg/wesnoth/src/wesnoth.cpp:858
#12 0x00000000015f6028 in main (argc=1, argv=0x7fffffffe9e8) at /home/lundberg/wesnoth/src/wesnoth.cpp:1072
(gdb) quit
```
"
81218767,Staging area for event handlers,jyrkive,2016-08-13 15:43:15+00:00,2016-08-13 20:56:59+00:00,{},"This is what @aginor suggested as a way to fix the ; issue in the comments for commit 3d8c29bc.
"
81205125,Add result variable to [message] tag,GregoryLundberg,2016-08-13 02:53:20+00:00,2016-08-14 17:16:09+00:00,{},"If [message] includes one or more [option] choices, store the choice index in the result variable. If [option] has value=, use that instead of the index number.

Simple example of use:

```
[message]
    variable=choice
    speaker=narrator
    message=""Choose option 1 through 4""
    [option]
        label=""Option 1""
        value=""One""
    [/option]
    [option]
        label=""Option 2""
    [/option]
    [option]
        label=""Option 3""
        value=""Tres""
    [/option]
    [option]
        label=""Option 4""
    [/option]
[/message]
[message]
    speaker=narrator
    message=""You chose option number $choice|""
[/message]
{CLEAR_VARIABLE choice}
```

In examining AToTB, there is a lot of work in [command] blocks which can be eliminated if we simply know which of 1..4 was chosen. I imagine this is not all that unusual a use case.
"
81162306,Fix the fix,GregoryLundberg,2016-08-12 18:29:20+00:00,2016-08-12 18:32:55+00:00,{},"I have SO got to check I pressed Save before I press Commit! This time it bit me because it got merged so quickly.
"
81159704,Do not select unit in silent object,GregoryLundberg,2016-08-12 18:10:40+00:00,2016-08-12 18:20:53+00:00,{},"This causes, for example, units the player does not control to be selected at the start of HttT S08, S11 and S16.
"
81159404,Refactor some Lua stuff and reduce const_cast usage,CelticMinstrel,2016-08-12 18:08:35+00:00,2016-08-24 07:19:02+00:00,{},"I started out with the goal of reducing the use of const_cast and ended up shifting around some large chunks of the Lua code. I did some testing and didn't notice anything broken, but I'm opening this as a PR instead of pushing directly because it's quite a big change and might have broken something I didn't think of testing.

This also fixes two Lua bugs that I happened across while refactoring.
"
80956038,Gyra_Solune's unit description updates,ln-zookeeper,2016-08-11 13:20:50+00:00,2016-11-15 17:34:04+00:00,{},"I'm putting these in PR form to make it easier for more people to review them.

Note: don't merge. I can merge this myself after I've pushed all the ones I intend to and they've been reviewed.

Source: https://forums.wesnoth.org/viewtopic.php?f=32&t=43721
"
80893297,Use info level,GregoryLundberg,2016-08-11 01:21:00+00:00,2016-08-11 22:11:43+00:00,{},"The cave map generator displays the seed on stderr. Move it to the logging system at 'info' level.
"
80859319,Reverse commit 18d7736,GregoryLundberg,2016-08-10 20:12:26+00:00,2016-08-10 20:15:42+00:00,{},"Commit 18d7736 caused an infinite loop.

In HttT S14 we have a sighted event which includes [teleport] tags. This commit causes the sighted event to run to completion, then re-fire, in an infinite loop. Removing the [teleport] tags stopped the loop. Reversing this commit does, as well.
"
80455846,Allow hotkeys dialogue to be sorted by Hotkey column again. (Bug #24933),Wedge009,2016-08-08 14:00:06+00:00,2016-08-08 18:20:07+00:00,{},"Sorting by hot-key was something that we could do in 1.12, but this is lost with current implementation of the redesigned dialogue. This is my attempt to restore this function.

https://gna.org/bugs/?24933
"
80368769,Beautified name generation,spixi,2016-08-07 14:42:50+00:00,2016-08-07 22:16:05+00:00,{},"This makes the name generator use the features of context free grammars and adds a few more diversity (e. g. Loch for lakes and Creek for rivers).
"
80363430,"ttext: tweaks to rendering, especially on Windows",Vultraz,2016-08-07 10:13:45+00:00,2016-08-07 18:19:32+00:00,{},"This restores some code that wasn't being used on Windows to strip pre-multiplied alpha
from the text render before passing it to SDL_CreateRGBSurfaceFrom. Despite the code comment
to the contrary, enabling this code doesn't seem to mutilate the text output unless
pango_cairo_show_layout is called _after_ stripping.

Unless I'm misunderstanding, pango_cairo_show_layout would get called 4 times on Windows.
Removing 3 of those calls meant the use of CAIRO_ANTIALIAS_GRAY as a fix for bug #21648
now resulted in horrible-looking text. Changing the AA method to CAIRO_ANTIALIAS_GRAY now
seems to produce acceptable results.

The resulting text is only slightly different from that produced before this change, though
very slightly more anti-aliased and a little grayer.
"
80358965,HttT S22 Gryphons Return,GregoryLundberg,2016-08-07 05:42:59+00:00,2016-09-16 20:04:54+00:00,{},"This Pull Request is part of a series of corrections and improvements to the HttT ('Heir to the Throne') campaign.

When merging or testing, please be aware that a PR deeper in the hierarchy will have merge conflicts unless each higher PR has already been applied. If this presents a problem, contact me and I will re-factor the hierarchy as required. At present, the best options to contact me are either as comments on one of these pull requests, or by creating an Issue on my personal fork.

**Hierarchy**

```
master
|
+-- GregoryLundberg:GL_HttT_general_improvements ( PR #730 )
    |
    +-- GregoryLundberg:GL_HttT_S05b_use_advisor ( PR #731 )
    |
    +-- GregoryLundberg:GL_HttT_S05b_randomize_temples ( PR #732 )
    |
    +-- GregoryLundberg:GL_HttT_S06_logical_thieves ( PR #733 )
    |
    +-- GregoryLundberg:GL_HttT_S07_ambushers_reduced ( PR #734 )
    |
    +-- GregoryLundberg:GL_HttT_S13_snow_detritus ( PR #735 )
    |
    +-- GregoryLundberg:GL_HttT_S20b_wose_assistance ( PR #736 )
    |
    +-- GregoryLundberg:GL_HttT_S22_gryphons_return ( PR #737 )
```

**GregoryLundberg:GL_HttT_general_improvements**
These are general improvements of my own. Each patch is fairly localized and should be easy to follow. Individual patches should be easy to cherry pick, if desired. The only complex patch is the last, which touches many files, and gets the debug command 'choose_level' working.

**GregoryLundberg:GL_HttT_S05b_use_advisor**
This implements a TODO item. It selects the advisor Konrad will have at the start of S06 ('The Siege of Elensefar') and uses that advisor for a comment, apparently coming from inside the ship, when it arrives.

**GregoryLundberg:GL_HttT_S05b_randomize_temples**
This implements a TODO item. It randomizes the temple contents.

**GregoryLundberg:GL_HttT_S06_logical_thieves**
This is an improvement of my own. It handles the Thieves' Guild in a more logical manner. Mainly, they will simply join forces in cases where Konrad has already passed the point where an offer of help makes sense.

**GregoryLundberg:GL_HttT_S07_ambushers_reduced**
This implements a TODO item. The number of ambushes reduces based upon the number of enemy leaders killed in S01 ('The Elves Besieged').

**GregoryLundberg:GL_HttT_S13_snow_detritus**
This implements a TODO item. It adds random snow on up to 1/3rd the non-snow tiles, based upon the snow coverage (that is, turns to completion) from S12 ('Northern Winter').

**GregoryLundberg:GL_HttT_S20b_wose_assistance**
This implements a TODO item. It adds a bonus sub-quest assisting the wose in dealing with the undead. The reward is a book which, when read, grants forest movement cost 1, forest defense 70%, and forest ambush (as with an Elvish Ranger). This reward was chosen because it offers some assistance in S22 ('Return to Wesnoth') and has limited, or no, use in the following scenarios.

**GregoryLundberg:GL_HttT_S22_gryphons_return**
This implements a TODO item. If Konrad did not injure or kill the gryphons in S10 ('Gryphon Mountain'), a flight of gryphons return to assist Konrad in S22 ('Return to Wesnoth'). Remember, for the gryphons to arrive, Konrad must have forgone their eggs and, therefore, has no Gryphon Riders. This lack of Gryphon Riders will be most felt in the final two scenario, and especially on the large, open plains of S23 ('The Test of the Clans').

**KNOWN BUGS**

Multiple-tile units with animation leave visual artifacts as they move. This is most noticeable with the Gryphons and Gryphon Riders as they move using move_unit_fake in S10 ('Gryphon Mountain'), S14 ('Plunging into Darkness') and S22 ('Return to Wesnoth'). The artifacts clear fairly quickly, and are all removed at the end of the movement.

The game engine appears to have memory-leak issues. When play-testing, after loading several dozen scenario, memory usage will have grown quite large. This can cause the system to begin to swap (if your system has swap space), which severely degrades performance. To work around the issue, I keep an eye on memory use and restart the engine when it approaches the limit.

There are a few remaining user-interface issues such as the popup messages sometimes not appearing.

**NOTES**

I have tested each fork to ensure no merge conflicts occur, provided the required upper-level forks have already been merged. I found no problems using simple merges. I did, however, run into problems with rebase. If you need to rebase after merging these forks and get merge conflicts, abort your rebase (git rebase --abort). In general, such merge conflicts occur because git can re-order the commits; but that re-ordering can be avoided, preventing merge conflicts, with an interactive rebase. Contact me if you need assistance using rebase.

The debug command choose_level works well, now. In general, when testing, you can switch from any scenario to any other. Internal state, such as which path you took from S04 ('The Bay of Pearls') .. S05a ('Muff Malal's Peninsula') or S05b ('The Isle of the Damned') .. or the amount of snow which fell in S12 ('Northern Winter') is maintained until you visit the scenario which sets the state. Thus, if you want to test with the various incarnations of Moremirmu in S09 ('The Valley of Death'), you simply need to use choose_level to jump to S05a or S05b, then jump back to S09 once you have the desired state.

The debug command next_level also works well. But, since there is no way to know if you used next_level command, it always advances to the default next level. At points where there is a branch, S04 ('The Bay of Pearls') and S18 ('A Choice Must Be Made'), you must either play through, or use the choose_level command if you do not want to follow the default choice.

When using the choose_level command, be aware that game state, such as your gold balance, and your recall list (including your Heros) is NOT CHANGED. This means, yes, it is possible to advance your Heros and jump to S01 ('The Elves Besieged') and have Konrad, Li'sar and Kalenz, along with a host of other L3 units, even Gryphon Riders or Gryphons, if you have always wanted to clear the board of those pesky orcs.

There are times when a Hero (generally Delfador or Li'sar) cannot be on the map, either for story purposes or because that Hero is already in that scenario. In these cases your Hero is saved and, if you are using choose_level to jump around, will be restored once you leave the area.

Similarly, there are times when a unit will join Konrad's forces. For example, Haldiel in S02 ('Blackwater Port'). If you already have Haldiel in your recall list and choose_level to jump to Blackwater Port, Haldiel will be removed from your recall list, and a new Haldiel will appear at the appropriate time. For those units which only appear depending upon your actions, they will only be removed from your recall list (or the map) should you take the action which causes their appearance.

**CHANGES**

_07AUG2016_

GL_unique_items has been merged to master.

Spelling and grammar corrections on this document and PR titles. Unfortunately, the typo in a branch name has to stay.

Spelling and grammar corrections on commit messages.

Removed underscores in custom event names 'home destroyed' and 'victory dance'.

Spelling and grammar corrections in commit 'HttT S20a Fix bug: El'rien might be dead'

Spelling and grammar corrections in commit 'HttT S20b Fix bug: Bona-Melodia may be dead'

Corrected filter for moving side in commit 'HttT S08 Adjust closing-in area'

Spelling and grammar corrections, and eliminated po comments in commit 'HttT S20b Wose assistance quest'

_08AUG2016_

Clean up [objectives] handling for commit 'HttT S10 Change objectives'

Clean up the hidden advisor to use a galleon unit instead of a shallow copy for commit 'HttT S05b Use an Advisor'

Moved lua inline, removing custom tag, for commit 'HttT S13 Add some random snow'

Clean up [objectives] handling for commit 'HttT S19c Fix bug: Wrong objectives'

_10AUG2016_

Sync to master v1.13.5+dev (6235e18-Clean) and re-tested

_11AUG2016_

Removed commit 'HttT S21 Fix bug: No save'

Sync to master v1.13.5+dev (cf4f488-Clean) and re-tested

Finally got commit 'HttT S05b Use an Advisor' working just the way I always envisioned

_12AUG2016_

Removed workaround commit for [object] issues on S08, S11 and S16.

Sync to master v1.13.5+dev (265e41d-Clean)

_12AUG2016_

GL_HttT_errors has been merged to master

Sync to master v1.13.5+dev (12f7107-Clean) and re-tested

_13AUG2016_

Cleanup since [hide_unit] now works for commit 'HttT S05b Use an Advisor'

Audited and corrected state variables for 'HttT Debug choose_level works'

Clean up [objectives] handling for commit 'HttT S20b Wose assistance quest'

Only leaders count for commit 'HttT S07 Ambushers reduced'

Changed the subject from you to the unit in commit 'HttT S19a Improve Flaming Sword'

Changed the subject from you to the unit in commit 'HttT S19b Improve Void Armor'

Sync to master v1.13.5+dev (3cc2d09-Clean) and re-tested

_19AUG2016_

Removed commit 'HttT S12 Added ambiance (fog)'

Updated commit 'HttT S19a Improve Flaming Sword' for typo and [message] big fixed

Updated commit 'HttT S14 Consistent objectives' for new {HAS_NO_TURN_LIMIT} macro

Sync to master v1.13.5+dev (7fab085-Clean) and re-tested

_30AUG2016_

Sync to master v1.13.5+dev (b24fdbc-Clean) and re-tested

_06SEP2016_

Updated commit 'HttT Debug choose_level works' removing macro RECALL_ELSE

Sync to master v1.13.5+dev (206096c-Clean) and re-tested

_10SEP2016_

Re-enabled Paladin to use Flaming Sword.

Switched to using unit for speaker when taking Void Armor to allow gender-specific messages.

Sync to master v1.13.5+dev (eb3e27b-Clean) (only tested for the changes)

_13SEP2016_

Removed [kill] before [unit] and cleaned up Li'sar changing sides for choose_level

Sync to master v1.13.5+dev (1af1932-Clean) and re-tested.
"
80358964,HttT S20b Wose Assistance,GregoryLundberg,2016-08-07 05:42:55+00:00,2016-09-16 20:25:43+00:00,{},"This Pull Request is part of a series of corrections and improvements to the HttT ('Heir to the Throne') campaign.

When merging or testing, please be aware that a PR deeper in the hierarchy will have merge conflicts unless each higher PR has already been applied. If this presents a problem, contact me and I will re-factor the hierarchy as required. At present, the best options to contact me are either as comments on one of these pull requests, or by creating an Issue on my personal fork.

**Hierarchy**

```
master
|
+-- GregoryLundberg:GL_HttT_general_improvements ( PR #730 )
    |
    +-- GregoryLundberg:GL_HttT_S05b_use_advisor ( PR #731 )
    |
    +-- GregoryLundberg:GL_HttT_S05b_randomize_temples ( PR #732 )
    |
    +-- GregoryLundberg:GL_HttT_S06_logical_thieves ( PR #733 )
    |
    +-- GregoryLundberg:GL_HttT_S07_ambushers_reduced ( PR #734 )
    |
    +-- GregoryLundberg:GL_HttT_S13_snow_detritus ( PR #735 )
    |
    +-- GregoryLundberg:GL_HttT_S20b_wose_assistance ( PR #736 )
    |
    +-- GregoryLundberg:GL_HttT_S22_gryphons_return ( PR #737 )
```

**GregoryLundberg:GL_HttT_general_improvements**
These are general improvements of my own. Each patch is fairly localized and should be easy to follow. Individual patches should be easy to cherry pick, if desired. The only complex patch is the last, which touches many files, and gets the debug command 'choose_level' working.

**GregoryLundberg:GL_HttT_S05b_use_advisor**
This implements a TODO item. It selects the advisor Konrad will have at the start of S06 ('The Siege of Elensefar') and uses that advisor for a comment, apparently coming from inside the ship, when it arrives.

**GregoryLundberg:GL_HttT_S05b_randomize_temples**
This implements a TODO item. It randomizes the temple contents.

**GregoryLundberg:GL_HttT_S06_logical_thieves**
This is an improvement of my own. It handles the Thieves' Guild in a more logical manner. Mainly, they will simply join forces in cases where Konrad has already passed the point where an offer of help makes sense.

**GregoryLundberg:GL_HttT_S07_ambushers_reduced**
This implements a TODO item. The number of ambushes reduces based upon the number of enemy leaders killed in S01 ('The Elves Besieged').

**GregoryLundberg:GL_HttT_S13_snow_detritus**
This implements a TODO item. It adds random snow on up to 1/3rd the non-snow tiles, based upon the snow coverage (that is, turns to completion) from S12 ('Northern Winter').

**GregoryLundberg:GL_HttT_S20b_wose_assistance**
This implements a TODO item. It adds a bonus sub-quest assisting the wose in dealing with the undead. The reward is a book which, when read, grants forest movement cost 1, forest defense 70%, and forest ambush (as with an Elvish Ranger). This reward was chosen because it offers some assistance in S22 ('Return to Wesnoth') and has limited, or no, use in the following scenarios.

**GregoryLundberg:GL_HttT_S22_gryphons_return**
This implements a TODO item. If Konrad did not injure or kill the gryphons in S10 ('Gryphon Mountain'), a flight of gryphons return to assist Konrad in S22 ('Return to Wesnoth'). Remember, for the gryphons to arrive, Konrad must have forgone their eggs and, therefore, has no Gryphon Riders. This lack of Gryphon Riders will be most felt in the final two scenario, and especially on the large, open plains of S23 ('The Test of the Clans').

**KNOWN BUGS**

Multiple-tile units with animation leave visual artifacts as they move. This is most noticeable with the Gryphons and Gryphon Riders as they move using move_unit_fake in S10 ('Gryphon Mountain'), S14 ('Plunging into Darkness') and S22 ('Return to Wesnoth'). The artifacts clear fairly quickly, and are all removed at the end of the movement.

The game engine appears to have memory-leak issues. When play-testing, after loading several dozen scenario, memory usage will have grown quite large. This can cause the system to begin to swap (if your system has swap space), which severely degrades performance. To work around the issue, I keep an eye on memory use and restart the engine when it approaches the limit.

There are a few remaining user-interface issues such as the popup messages sometimes not appearing.

**NOTES**

I have tested each fork to ensure no merge conflicts occur, provided the required upper-level forks have already been merged. I found no problems using simple merges. I did, however, run into problems with rebase. If you need to rebase after merging these forks and get merge conflicts, abort your rebase (git rebase --abort). In general, such merge conflicts occur because git can re-order the commits; but that re-ordering can be avoided, preventing merge conflicts, with an interactive rebase. Contact me if you need assistance using rebase.

The debug command choose_level works well, now. In general, when testing, you can switch from any scenario to any other. Internal state, such as which path you took from S04 ('The Bay of Pearls') .. S05a ('Muff Malal's Peninsula') or S05b ('The Isle of the Damned') .. or the amount of snow which fell in S12 ('Northern Winter') is maintained until you visit the scenario which sets the state. Thus, if you want to test with the various incarnations of Moremirmu in S09 ('The Valley of Death'), you simply need to use choose_level to jump to S05a or S05b, then jump back to S09 once you have the desired state.

The debug command next_level also works well. But, since there is no way to know if you used next_level command, it always advances to the default next level. At points where there is a branch, S04 ('The Bay of Pearls') and S18 ('A Choice Must Be Made'), you must either play through, or use the choose_level command if you do not want to follow the default choice.

When using the choose_level command, be aware that game state, such as your gold balance, and your recall list (including your Heros) is NOT CHANGED. This means, yes, it is possible to advance your Heros and jump to S01 ('The Elves Besieged') and have Konrad, Li'sar and Kalenz, along with a host of other L3 units, even Gryphon Riders or Gryphons, if you have always wanted to clear the board of those pesky orcs.

There are times when a Hero (generally Delfador or Li'sar) cannot be on the map, either for story purposes or because that Hero is already in that scenario. In these cases your Hero is saved and, if you are using choose_level to jump around, will be restored once you leave the area.

Similarly, there are times when a unit will join Konrad's forces. For example, Haldiel in S02 ('Blackwater Port'). If you already have Haldiel in your recall list and choose_level to jump to Blackwater Port, Haldiel will be removed from your recall list, and a new Haldiel will appear at the appropriate time. For those units which only appear depending upon your actions, they will only be removed from your recall list (or the map) should you take the action which causes their appearance.

**CHANGES**

_07AUG2016_

GL_unique_items has been merged to master.

Spelling and grammar corrections on this document and PR titles. Unfortunately, the typo in a branch name has to stay.

Spelling and grammar corrections on commit messages.

Removed underscores in custom event names 'home destroyed' and 'victory dance'.

Spelling and grammar corrections in commit 'HttT S20a Fix bug: El'rien might be dead'

Spelling and grammar corrections in commit 'HttT S20b Fix bug: Bona-Melodia may be dead'

Corrected filter for moving side in commit 'HttT S08 Adjust closing-in area'

Spelling and grammar corrections, and eliminated po comments in commit 'HttT S20b Wose assistance quest'

_08AUG2016_

Clean up [objectives] handling for commit 'HttT S10 Change objectives'

Clean up the hidden advisor to use a galleon unit instead of a shallow copy for commit 'HttT S05b Use an Advisor'

Moved lua inline, removing custom tag, for commit 'HttT S13 Add some random snow'

Clean up [objectives] handling for commit 'HttT S19c Fix bug: Wrong objectives'

_10AUG2016_

Sync to master v1.13.5+dev (6235e18-Clean) and re-tested

_11AUG2016_

Removed commit 'HttT S21 Fix bug: No save'

Sync to master v1.13.5+dev (cf4f488-Clean) and re-tested

Finally got commit 'HttT S05b Use an Advisor' working just the way I always envisioned

_12AUG2016_

Removed workaround commit for [object] issues on S08, S11 and S16.

Sync to master v1.13.5+dev (265e41d-Clean)

_12AUG2016_

GL_HttT_errors has been merged to master

Sync to master v1.13.5+dev (12f7107-Clean) and re-tested

_13AUG2016_

Cleanup since [hide_unit] now works for commit 'HttT S05b Use an Advisor'

Audited and corrected state variables for 'HttT Debug choose_level works'

Clean up [objectives] handling for commit 'HttT S20b Wose assistance quest'

Only leaders count for commit 'HttT S07 Ambushers reduced'

Changed the subject from you to the unit in commit 'HttT S19a Improve Flaming Sword'

Changed the subject from you to the unit in commit 'HttT S19b Improve Void Armor'

Sync to master v1.13.5+dev (3cc2d09-Clean) and re-tested

_19AUG2016_

Removed commit 'HttT S12 Added ambiance (fog)'

Updated commit 'HttT S19a Improve Flaming Sword' for typo and [message] big fixed

Updated commit 'HttT S14 Consistent objectives' for new {HAS_NO_TURN_LIMIT} macro

Sync to master v1.13.5+dev (7fab085-Clean) and re-tested

_30AUG2016_

Sync to master v1.13.5+dev (b24fdbc-Clean) and re-tested

_06SEP2016_

Updated commit 'HttT Debug choose_level works' removing macro RECALL_ELSE

Sync to master v1.13.5+dev (206096c-Clean) and re-tested

_10SEP2016_

Re-enabled Paladin to use Flaming Sword.

Switched to using unit for speaker when taking Void Armor to allow gender-specific messages.

Sync to master v1.13.5+dev (eb3e27b-Clean) (only tested for the changes)

_13SEP2016_

Removed [kill] before [unit] and cleaned up Li'sar changing sides for choose_level

Sync to master v1.13.5+dev (1af1932-Clean) and re-tested.
"
80358961,HttT S13 Snow Detritus,GregoryLundberg,2016-08-07 05:42:50+00:00,2016-09-16 22:03:05+00:00,{},"This Pull Request is part of a series of corrections and improvements to the HttT ('Heir to the Throne') campaign.

When merging or testing, please be aware that a PR deeper in the hierarchy will have merge conflicts unless each higher PR has already been applied. If this presents a problem, contact me and I will re-factor the hierarchy as required. At present, the best options to contact me are either as comments on one of these pull requests, or by creating an Issue on my personal fork.

**Hierarchy**

```
master
|
+-- GregoryLundberg:GL_HttT_general_improvements ( PR #730 )
    |
    +-- GregoryLundberg:GL_HttT_S05b_use_advisor ( PR #731 )
    |
    +-- GregoryLundberg:GL_HttT_S05b_randomize_temples ( PR #732 )
    |
    +-- GregoryLundberg:GL_HttT_S06_logical_thieves ( PR #733 )
    |
    +-- GregoryLundberg:GL_HttT_S07_ambushers_reduced ( PR #734 )
    |
    +-- GregoryLundberg:GL_HttT_S13_snow_detritus ( PR #735 )
    |
    +-- GregoryLundberg:GL_HttT_S20b_wose_assistance ( PR #736 )
    |
    +-- GregoryLundberg:GL_HttT_S22_gryphons_return ( PR #737 )
```

**GregoryLundberg:GL_HttT_general_improvements**
These are general improvements of my own. Each patch is fairly localized and should be easy to follow. Individual patches should be easy to cherry pick, if desired. The only complex patch is the last, which touches many files, and gets the debug command 'choose_level' working.

**GregoryLundberg:GL_HttT_S05b_use_advisor**
This implements a TODO item. It selects the advisor Konrad will have at the start of S06 ('The Siege of Elensefar') and uses that advisor for a comment, apparently coming from inside the ship, when it arrives.

**GregoryLundberg:GL_HttT_S05b_randomize_temples**
This implements a TODO item. It randomizes the temple contents.

**GregoryLundberg:GL_HttT_S06_logical_thieves**
This is an improvement of my own. It handles the Thieves' Guild in a more logical manner. Mainly, they will simply join forces in cases where Konrad has already passed the point where an offer of help makes sense.

**GregoryLundberg:GL_HttT_S07_ambushers_reduced**
This implements a TODO item. The number of ambushes reduces based upon the number of enemy leaders killed in S01 ('The Elves Besieged').

**GregoryLundberg:GL_HttT_S13_snow_detritus**
This implements a TODO item. It adds random snow on up to 1/3rd the non-snow tiles, based upon the snow coverage (that is, turns to completion) from S12 ('Northern Winter').

**GregoryLundberg:GL_HttT_S20b_wose_assistance**
This implements a TODO item. It adds a bonus sub-quest assisting the wose in dealing with the undead. The reward is a book which, when read, grants forest movement cost 1, forest defense 70%, and forest ambush (as with an Elvish Ranger). This reward was chosen because it offers some assistance in S22 ('Return to Wesnoth') and has limited, or no, use in the following scenarios.

**GregoryLundberg:GL_HttT_S22_gryphons_return**
This implements a TODO item. If Konrad did not injure or kill the gryphons in S10 ('Gryphon Mountain'), a flight of gryphons return to assist Konrad in S22 ('Return to Wesnoth'). Remember, for the gryphons to arrive, Konrad must have forgone their eggs and, therefore, has no Gryphon Riders. This lack of Gryphon Riders will be most felt in the final two scenario, and especially on the large, open plains of S23 ('The Test of the Clans').

**KNOWN BUGS**

Multiple-tile units with animation leave visual artifacts as they move. This is most noticeable with the Gryphons and Gryphon Riders as they move using move_unit_fake in S10 ('Gryphon Mountain'), S14 ('Plunging into Darkness') and S22 ('Return to Wesnoth'). The artifacts clear fairly quickly, and are all removed at the end of the movement.

The game engine appears to have memory-leak issues. When play-testing, after loading several dozen scenario, memory usage will have grown quite large. This can cause the system to begin to swap (if your system has swap space), which severely degrades performance. To work around the issue, I keep an eye on memory use and restart the engine when it approaches the limit.

There are a few remaining user-interface issues such as the popup messages sometimes not appearing.

**NOTES**

I have tested each fork to ensure no merge conflicts occur, provided the required upper-level forks have already been merged. I found no problems using simple merges. I did, however, run into problems with rebase. If you need to rebase after merging these forks and get merge conflicts, abort your rebase (git rebase --abort). In general, such merge conflicts occur because git can re-order the commits; but that re-ordering can be avoided, preventing merge conflicts, with an interactive rebase. Contact me if you need assistance using rebase.

The debug command choose_level works well, now. In general, when testing, you can switch from any scenario to any other. Internal state, such as which path you took from S04 ('The Bay of Pearls') .. S05a ('Muff Malal's Peninsula') or S05b ('The Isle of the Damned') .. or the amount of snow which fell in S12 ('Northern Winter') is maintained until you visit the scenario which sets the state. Thus, if you want to test with the various incarnations of Moremirmu in S09 ('The Valley of Death'), you simply need to use choose_level to jump to S05a or S05b, then jump back to S09 once you have the desired state.

The debug command next_level also works well. But, since there is no way to know if you used next_level command, it always advances to the default next level. At points where there is a branch, S04 ('The Bay of Pearls') and S18 ('A Choice Must Be Made'), you must either play through, or use the choose_level command if you do not want to follow the default choice.

When using the choose_level command, be aware that game state, such as your gold balance, and your recall list (including your Heros) is NOT CHANGED. This means, yes, it is possible to advance your Heros and jump to S01 ('The Elves Besieged') and have Konrad, Li'sar and Kalenz, along with a host of other L3 units, even Gryphon Riders or Gryphons, if you have always wanted to clear the board of those pesky orcs.

There are times when a Hero (generally Delfador or Li'sar) cannot be on the map, either for story purposes or because that Hero is already in that scenario. In these cases your Hero is saved and, if you are using choose_level to jump around, will be restored once you leave the area.

Similarly, there are times when a unit will join Konrad's forces. For example, Haldiel in S02 ('Blackwater Port'). If you already have Haldiel in your recall list and choose_level to jump to Blackwater Port, Haldiel will be removed from your recall list, and a new Haldiel will appear at the appropriate time. For those units which only appear depending upon your actions, they will only be removed from your recall list (or the map) should you take the action which causes their appearance.

**CHANGES**

_07AUG2016_

GL_unique_items has been merged to master.

Spelling and grammar corrections on this document and PR titles. Unfortunately, the typo in a branch name has to stay.

Spelling and grammar corrections on commit messages.

Removed underscores in custom event names 'home destroyed' and 'victory dance'.

Spelling and grammar corrections in commit 'HttT S20a Fix bug: El'rien might be dead'

Spelling and grammar corrections in commit 'HttT S20b Fix bug: Bona-Melodia may be dead'

Corrected filter for moving side in commit 'HttT S08 Adjust closing-in area'

Spelling and grammar corrections, and eliminated po comments in commit 'HttT S20b Wose assistance quest'

_08AUG2016_

Clean up [objectives] handling for commit 'HttT S10 Change objectives'

Clean up the hidden advisor to use a galleon unit instead of a shallow copy for commit 'HttT S05b Use an Advisor'

Moved lua inline, removing custom tag, for commit 'HttT S13 Add some random snow'

Clean up [objectives] handling for commit 'HttT S19c Fix bug: Wrong objectives'

_10AUG2016_

Sync to master v1.13.5+dev (6235e18-Clean) and re-tested

_11AUG2016_

Removed commit 'HttT S21 Fix bug: No save'

Sync to master v1.13.5+dev (cf4f488-Clean) and re-tested

Finally got commit 'HttT S05b Use an Advisor' working just the way I always envisioned

_12AUG2016_

Removed workaround commit for [object] issues on S08, S11 and S16.

Sync to master v1.13.5+dev (265e41d-Clean)

_12AUG2016_

GL_HttT_errors has been merged to master

Sync to master v1.13.5+dev (12f7107-Clean) and re-tested

_13AUG2016_

Cleanup since [hide_unit] now works for commit 'HttT S05b Use an Advisor'

Audited and corrected state variables for 'HttT Debug choose_level works'

Clean up [objectives] handling for commit 'HttT S20b Wose assistance quest'

Only leaders count for commit 'HttT S07 Ambushers reduced'

Changed the subject from you to the unit in commit 'HttT S19a Improve Flaming Sword'

Changed the subject from you to the unit in commit 'HttT S19b Improve Void Armor'

Sync to master v1.13.5+dev (3cc2d09-Clean) and re-tested

_19AUG2016_

Removed commit 'HttT S12 Added ambiance (fog)'

Updated commit 'HttT S19a Improve Flaming Sword' for typo and [message] big fixed

Updated commit 'HttT S14 Consistent objectives' for new {HAS_NO_TURN_LIMIT} macro

Sync to master v1.13.5+dev (7fab085-Clean) and re-tested

_30AUG2016_

Sync to master v1.13.5+dev (b24fdbc-Clean) and re-tested

_06SEP2016_

Updated commit 'HttT Debug choose_level works' removing macro RECALL_ELSE

Sync to master v1.13.5+dev (206096c-Clean) and re-tested

_10SEP2016_

Re-enabled Paladin to use Flaming Sword.

Switched to using unit for speaker when taking Void Armor to allow gender-specific messages.

Sync to master v1.13.5+dev (eb3e27b-Clean) (only tested for the changes)

_13SEP2016_

Removed [kill] before [unit] and cleaned up Li'sar changing sides for choose_level

Sync to master v1.13.5+dev (1af1932-Clean) and re-tested.
"
80358959,HttT S07 Ambushers Reduced,GregoryLundberg,2016-08-07 05:42:45+00:00,2016-09-19 16:24:20+00:00,{},"This Pull Request is part of a series of corrections and improvements to the HttT ('Heir to the Throne') campaign.

When merging or testing, please be aware that a PR deeper in the hierarchy will have merge conflicts unless each higher PR has already been applied. If this presents a problem, contact me and I will re-factor the hierarchy as required. At present, the best options to contact me are either as comments on one of these pull requests, or by creating an Issue on my personal fork.

**Hierarchy**

```
master
|
+-- GregoryLundberg:GL_HttT_general_improvements ( PR #730 )
    |
    +-- GregoryLundberg:GL_HttT_S05b_use_advisor ( PR #731 )
    |
    +-- GregoryLundberg:GL_HttT_S05b_randomize_temples ( PR #732 )
    |
    +-- GregoryLundberg:GL_HttT_S06_logical_thieves ( PR #733 )
    |
    +-- GregoryLundberg:GL_HttT_S07_ambushers_reduced ( PR #734 )
    |
    +-- GregoryLundberg:GL_HttT_S13_snow_detritus ( PR #735 )
    |
    +-- GregoryLundberg:GL_HttT_S20b_wose_assistance ( PR #736 )
    |
    +-- GregoryLundberg:GL_HttT_S22_gryphons_return ( PR #737 )
```

**GregoryLundberg:GL_HttT_general_improvements**
These are general improvements of my own. Each patch is fairly localized and should be easy to follow. Individual patches should be easy to cherry pick, if desired. The only complex patch is the last, which touches many files, and gets the debug command 'choose_level' working.

**GregoryLundberg:GL_HttT_S05b_use_advisor**
This implements a TODO item. It selects the advisor Konrad will have at the start of S06 ('The Siege of Elensefar') and uses that advisor for a comment, apparently coming from inside the ship, when it arrives.

**GregoryLundberg:GL_HttT_S05b_randomize_temples**
This implements a TODO item. It randomizes the temple contents.

**GregoryLundberg:GL_HttT_S06_logical_thieves**
This is an improvement of my own. It handles the Thieves' Guild in a more logical manner. Mainly, they will simply join forces in cases where Konrad has already passed the point where an offer of help makes sense.

**GregoryLundberg:GL_HttT_S07_ambushers_reduced**
This implements a TODO item. The number of ambushes reduces based upon the number of enemy leaders killed in S01 ('The Elves Besieged').

**GregoryLundberg:GL_HttT_S13_snow_detritus**
This implements a TODO item. It adds random snow on up to 1/3rd the non-snow tiles, based upon the snow coverage (that is, turns to completion) from S12 ('Northern Winter').

**GregoryLundberg:GL_HttT_S20b_wose_assistance**
This implements a TODO item. It adds a bonus sub-quest assisting the wose in dealing with the undead. The reward is a book which, when read, grants forest movement cost 1, forest defense 70%, and forest ambush (as with an Elvish Ranger). This reward was chosen because it offers some assistance in S22 ('Return to Wesnoth') and has limited, or no, use in the following scenarios.

**GregoryLundberg:GL_HttT_S22_gryphons_return**
This implements a TODO item. If Konrad did not injure or kill the gryphons in S10 ('Gryphon Mountain'), a flight of gryphons return to assist Konrad in S22 ('Return to Wesnoth'). Remember, for the gryphons to arrive, Konrad must have forgone their eggs and, therefore, has no Gryphon Riders. This lack of Gryphon Riders will be most felt in the final two scenario, and especially on the large, open plains of S23 ('The Test of the Clans').

**KNOWN BUGS**

Multiple-tile units with animation leave visual artifacts as they move. This is most noticeable with the Gryphons and Gryphon Riders as they move using move_unit_fake in S10 ('Gryphon Mountain'), S14 ('Plunging into Darkness') and S22 ('Return to Wesnoth'). The artifacts clear fairly quickly, and are all removed at the end of the movement.

The game engine appears to have memory-leak issues. When play-testing, after loading several dozen scenario, memory usage will have grown quite large. This can cause the system to begin to swap (if your system has swap space), which severely degrades performance. To work around the issue, I keep an eye on memory use and restart the engine when it approaches the limit.

There are a few remaining user-interface issues such as the popup messages sometimes not appearing.

**NOTES**

I have tested each fork to ensure no merge conflicts occur, provided the required upper-level forks have already been merged. I found no problems using simple merges. I did, however, run into problems with rebase. If you need to rebase after merging these forks and get merge conflicts, abort your rebase (git rebase --abort). In general, such merge conflicts occur because git can re-order the commits; but that re-ordering can be avoided, preventing merge conflicts, with an interactive rebase. Contact me if you need assistance using rebase.

The debug command choose_level works well, now. In general, when testing, you can switch from any scenario to any other. Internal state, such as which path you took from S04 ('The Bay of Pearls') .. S05a ('Muff Malal's Peninsula') or S05b ('The Isle of the Damned') .. or the amount of snow which fell in S12 ('Northern Winter') is maintained until you visit the scenario which sets the state. Thus, if you want to test with the various incarnations of Moremirmu in S09 ('The Valley of Death'), you simply need to use choose_level to jump to S05a or S05b, then jump back to S09 once you have the desired state.

The debug command next_level also works well. But, since there is no way to know if you used next_level command, it always advances to the default next level. At points where there is a branch, S04 ('The Bay of Pearls') and S18 ('A Choice Must Be Made'), you must either play through, or use the choose_level command if you do not want to follow the default choice.

When using the choose_level command, be aware that game state, such as your gold balance, and your recall list (including your Heros) is NOT CHANGED. This means, yes, it is possible to advance your Heros and jump to S01 ('The Elves Besieged') and have Konrad, Li'sar and Kalenz, along with a host of other L3 units, even Gryphon Riders or Gryphons, if you have always wanted to clear the board of those pesky orcs.

There are times when a Hero (generally Delfador or Li'sar) cannot be on the map, either for story purposes or because that Hero is already in that scenario. In these cases your Hero is saved and, if you are using choose_level to jump around, will be restored once you leave the area.

Similarly, there are times when a unit will join Konrad's forces. For example, Haldiel in S02 ('Blackwater Port'). If you already have Haldiel in your recall list and choose_level to jump to Blackwater Port, Haldiel will be removed from your recall list, and a new Haldiel will appear at the appropriate time. For those units which only appear depending upon your actions, they will only be removed from your recall list (or the map) should you take the action which causes their appearance.

**CHANGES**

_07AUG2016_

GL_unique_items has been merged to master.

Spelling and grammar corrections on this document and PR titles. Unfortunately, the typo in a branch name has to stay.

Spelling and grammar corrections on commit messages.

Removed underscores in custom event names 'home destroyed' and 'victory dance'.

Spelling and grammar corrections in commit 'HttT S20a Fix bug: El'rien might be dead'

Spelling and grammar corrections in commit 'HttT S20b Fix bug: Bona-Melodia may be dead'

Corrected filter for moving side in commit 'HttT S08 Adjust closing-in area'

Spelling and grammar corrections, and eliminated po comments in commit 'HttT S20b Wose assistance quest'

_08AUG2016_

Clean up [objectives] handling for commit 'HttT S10 Change objectives'

Clean up the hidden advisor to use a galleon unit instead of a shallow copy for commit 'HttT S05b Use an Advisor'

Moved lua inline, removing custom tag, for commit 'HttT S13 Add some random snow'

Clean up [objectives] handling for commit 'HttT S19c Fix bug: Wrong objectives'

_10AUG2016_

Sync to master v1.13.5+dev (6235e18-Clean) and re-tested

_11AUG2016_

Removed commit 'HttT S21 Fix bug: No save'

Sync to master v1.13.5+dev (cf4f488-Clean) and re-tested

Finally got commit 'HttT S05b Use an Advisor' working just the way I always envisioned

_12AUG2016_

Removed workaround commit for [object] issues on S08, S11 and S16.

Sync to master v1.13.5+dev (265e41d-Clean)

_12AUG2016_

GL_HttT_errors has been merged to master

Sync to master v1.13.5+dev (12f7107-Clean) and re-tested

_13AUG2016_

Cleanup since [hide_unit] now works for commit 'HttT S05b Use an Advisor'

Audited and corrected state variables for 'HttT Debug choose_level works'

Clean up [objectives] handling for commit 'HttT S20b Wose assistance quest'

Only leaders count for commit 'HttT S07 Ambushers reduced'

Changed the subject from you to the unit in commit 'HttT S19a Improve Flaming Sword'

Changed the subject from you to the unit in commit 'HttT S19b Improve Void Armor'

Sync to master v1.13.5+dev (3cc2d09-Clean) and re-tested

_19AUG2016_

Removed commit 'HttT S12 Added ambiance (fog)'

Updated commit 'HttT S19a Improve Flaming Sword' for typo and [message] big fixed

Updated commit 'HttT S14 Consistent objectives' for new {HAS_NO_TURN_LIMIT} macro

Sync to master v1.13.5+dev (7fab085-Clean) and re-tested

_30AUG2016_

Sync to master v1.13.5+dev (b24fdbc-Clean) and re-tested

_06SEP2016_

Updated commit 'HttT Debug choose_level works' removing macro RECALL_ELSE

Sync to master v1.13.5+dev (206096c-Clean) and re-tested

_10SEP2016_

Re-enabled Paladin to use Flaming Sword.

Switched to using unit for speaker when taking Void Armor to allow gender-specific messages.

Sync to master v1.13.5+dev (eb3e27b-Clean) (only tested for the changes)

_13SEP2016_

Removed [kill] before [unit] and cleaned up Li'sar changing sides for choose_level

Sync to master v1.13.5+dev (1af1932-Clean) and re-tested.
"
80358957,HttT S06 Logical Thieves,GregoryLundberg,2016-08-07 05:42:40+00:00,2016-09-19 21:11:51+00:00,{},"This Pull Request is part of a series of corrections and improvements to the HttT ('Heir to the Throne') campaign.

When merging or testing, please be aware that a PR deeper in the hierarchy will have merge conflicts unless each higher PR has already been applied. If this presents a problem, contact me and I will re-factor the hierarchy as required. At present, the best options to contact me are either as comments on one of these pull requests, or by creating an Issue on my personal fork.

**Hierarchy**

```
master
|
+-- GregoryLundberg:GL_HttT_general_improvements ( PR #730 )
    |
    +-- GregoryLundberg:GL_HttT_S05b_use_advisor ( PR #731 )
    |
    +-- GregoryLundberg:GL_HttT_S05b_randomize_temples ( PR #732 )
    |
    +-- GregoryLundberg:GL_HttT_S06_logical_thieves ( PR #733 )
    |
    +-- GregoryLundberg:GL_HttT_S07_ambushers_reduced ( PR #734 )
    |
    +-- GregoryLundberg:GL_HttT_S13_snow_detritus ( PR #735 )
    |
    +-- GregoryLundberg:GL_HttT_S20b_wose_assistance ( PR #736 )
    |
    +-- GregoryLundberg:GL_HttT_S22_gryphons_return ( PR #737 )
```

**GregoryLundberg:GL_HttT_general_improvements**
These are general improvements of my own. Each patch is fairly localized and should be easy to follow. Individual patches should be easy to cherry pick, if desired. The only complex patch is the last, which touches many files, and gets the debug command 'choose_level' working.

**GregoryLundberg:GL_HttT_S05b_use_advisor**
This implements a TODO item. It selects the advisor Konrad will have at the start of S06 ('The Siege of Elensefar') and uses that advisor for a comment, apparently coming from inside the ship, when it arrives.

**GregoryLundberg:GL_HttT_S05b_randomize_temples**
This implements a TODO item. It randomizes the temple contents.

**GregoryLundberg:GL_HttT_S06_logical_thieves**
This is an improvement of my own. It handles the Thieves' Guild in a more logical manner. Mainly, they will simply join forces in cases where Konrad has already passed the point where an offer of help makes sense.

**GregoryLundberg:GL_HttT_S07_ambushers_reduced**
This implements a TODO item. The number of ambushes reduces based upon the number of enemy leaders killed in S01 ('The Elves Besieged').

**GregoryLundberg:GL_HttT_S13_snow_detritus**
This implements a TODO item. It adds random snow on up to 1/3rd the non-snow tiles, based upon the snow coverage (that is, turns to completion) from S12 ('Northern Winter').

**GregoryLundberg:GL_HttT_S20b_wose_assistance**
This implements a TODO item. It adds a bonus sub-quest assisting the wose in dealing with the undead. The reward is a book which, when read, grants forest movement cost 1, forest defense 70%, and forest ambush (as with an Elvish Ranger). This reward was chosen because it offers some assistance in S22 ('Return to Wesnoth') and has limited, or no, use in the following scenarios.

**GregoryLundberg:GL_HttT_S22_gryphons_return**
This implements a TODO item. If Konrad did not injure or kill the gryphons in S10 ('Gryphon Mountain'), a flight of gryphons return to assist Konrad in S22 ('Return to Wesnoth'). Remember, for the gryphons to arrive, Konrad must have forgone their eggs and, therefore, has no Gryphon Riders. This lack of Gryphon Riders will be most felt in the final two scenario, and especially on the large, open plains of S23 ('The Test of the Clans').

**KNOWN BUGS**

Multiple-tile units with animation leave visual artifacts as they move. This is most noticeable with the Gryphons and Gryphon Riders as they move using move_unit_fake in S10 ('Gryphon Mountain'), S14 ('Plunging into Darkness') and S22 ('Return to Wesnoth'). The artifacts clear fairly quickly, and are all removed at the end of the movement.

The game engine appears to have memory-leak issues. When play-testing, after loading several dozen scenario, memory usage will have grown quite large. This can cause the system to begin to swap (if your system has swap space), which severely degrades performance. To work around the issue, I keep an eye on memory use and restart the engine when it approaches the limit.

There are a few remaining user-interface issues such as the popup messages sometimes not appearing.

**NOTES**

I have tested each fork to ensure no merge conflicts occur, provided the required upper-level forks have already been merged. I found no problems using simple merges. I did, however, run into problems with rebase. If you need to rebase after merging these forks and get merge conflicts, abort your rebase (git rebase --abort). In general, such merge conflicts occur because git can re-order the commits; but that re-ordering can be avoided, preventing merge conflicts, with an interactive rebase. Contact me if you need assistance using rebase.

The debug command choose_level works well, now. In general, when testing, you can switch from any scenario to any other. Internal state, such as which path you took from S04 ('The Bay of Pearls') .. S05a ('Muff Malal's Peninsula') or S05b ('The Isle of the Damned') .. or the amount of snow which fell in S12 ('Northern Winter') is maintained until you visit the scenario which sets the state. Thus, if you want to test with the various incarnations of Moremirmu in S09 ('The Valley of Death'), you simply need to use choose_level to jump to S05a or S05b, then jump back to S09 once you have the desired state.

The debug command next_level also works well. But, since there is no way to know if you used next_level command, it always advances to the default next level. At points where there is a branch, S04 ('The Bay of Pearls') and S18 ('A Choice Must Be Made'), you must either play through, or use the choose_level command if you do not want to follow the default choice.

When using the choose_level command, be aware that game state, such as your gold balance, and your recall list (including your Heros) is NOT CHANGED. This means, yes, it is possible to advance your Heros and jump to S01 ('The Elves Besieged') and have Konrad, Li'sar and Kalenz, along with a host of other L3 units, even Gryphon Riders or Gryphons, if you have always wanted to clear the board of those pesky orcs.

There are times when a Hero (generally Delfador or Li'sar) cannot be on the map, either for story purposes or because that Hero is already in that scenario. In these cases your Hero is saved and, if you are using choose_level to jump around, will be restored once you leave the area.

Similarly, there are times when a unit will join Konrad's forces. For example, Haldiel in S02 ('Blackwater Port'). If you already have Haldiel in your recall list and choose_level to jump to Blackwater Port, Haldiel will be removed from your recall list, and a new Haldiel will appear at the appropriate time. For those units which only appear depending upon your actions, they will only be removed from your recall list (or the map) should you take the action which causes their appearance.

**CHANGES**

_07AUG2016_

GL_unique_items has been merged to master.

Spelling and grammar corrections on this document and PR titles. Unfortunately, the typo in a branch name has to stay.

Spelling and grammar corrections on commit messages.

Removed underscores in custom event names 'home destroyed' and 'victory dance'.

Spelling and grammar corrections in commit 'HttT S20a Fix bug: El'rien might be dead'

Spelling and grammar corrections in commit 'HttT S20b Fix bug: Bona-Melodia may be dead'

Corrected filter for moving side in commit 'HttT S08 Adjust closing-in area'

Spelling and grammar corrections, and eliminated po comments in commit 'HttT S20b Wose assistance quest'

_08AUG2016_

Clean up [objectives] handling for commit 'HttT S10 Change objectives'

Clean up the hidden advisor to use a galleon unit instead of a shallow copy for commit 'HttT S05b Use an Advisor'

Moved lua inline, removing custom tag, for commit 'HttT S13 Add some random snow'

Clean up [objectives] handling for commit 'HttT S19c Fix bug: Wrong objectives'

_10AUG2016_

Sync to master v1.13.5+dev (6235e18-Clean) and re-tested

_11AUG2016_

Removed commit 'HttT S21 Fix bug: No save'

Sync to master v1.13.5+dev (cf4f488-Clean) and re-tested

Finally got commit 'HttT S05b Use an Advisor' working just the way I always envisioned

_12AUG2016_

Removed workaround commit for [object] issues on S08, S11 and S16.

Sync to master v1.13.5+dev (265e41d-Clean)

_12AUG2016_

GL_HttT_errors has been merged to master

Sync to master v1.13.5+dev (12f7107-Clean) and re-tested

_13AUG2016_

Cleanup since [hide_unit] now works for commit 'HttT S05b Use an Advisor'

Audited and corrected state variables for 'HttT Debug choose_level works'

Clean up [objectives] handling for commit 'HttT S20b Wose assistance quest'

Only leaders count for commit 'HttT S07 Ambushers reduced'

Changed the subject from you to the unit in commit 'HttT S19a Improve Flaming Sword'

Changed the subject from you to the unit in commit 'HttT S19b Improve Void Armor'

Sync to master v1.13.5+dev (3cc2d09-Clean) and re-tested

_19AUG2016_

Removed commit 'HttT S12 Added ambiance (fog)'

Updated commit 'HttT S19a Improve Flaming Sword' for typo and [message] big fixed

Updated commit 'HttT S14 Consistent objectives' for new {HAS_NO_TURN_LIMIT} macro

Sync to master v1.13.5+dev (7fab085-Clean) and re-tested

_30AUG2016_

Sync to master v1.13.5+dev (b24fdbc-Clean) and re-tested

_06SEP2016_

Updated commit 'HttT Debug choose_level works' removing macro RECALL_ELSE

Sync to master v1.13.5+dev (206096c-Clean) and re-tested

_10SEP2016_

Re-enabled Paladin to use Flaming Sword.

Switched to using unit for speaker when taking Void Armor to allow gender-specific messages.

Sync to master v1.13.5+dev (eb3e27b-Clean) (only tested for the changes)

_13SEP2016_

Removed [kill] before [unit] and cleaned up Li'sar changing sides for choose_level

Sync to master v1.13.5+dev (1af1932-Clean) and re-tested.
"
80358956,HttT S05b Randomize Temples,GregoryLundberg,2016-08-07 05:42:35+00:00,2016-09-15 09:44:00+00:00,{},"This Pull Request is part of a series of corrections and improvements to the HttT ('Heir to the Throne') campaign.

When merging or testing, please be aware that a PR deeper in the hierarchy will have merge conflicts unless each higher PR has already been applied. If this presents a problem, contact me and I will re-factor the hierarchy as required. At present, the best options to contact me are either as comments on one of these pull requests, or by creating an Issue on my personal fork.

**Hierarchy**

```
master
|
+-- GregoryLundberg:GL_HttT_general_improvements ( PR #730 )
    |
    +-- GregoryLundberg:GL_HttT_S05b_use_advisor ( PR #731 )
    |
    +-- GregoryLundberg:GL_HttT_S05b_randomize_temples ( PR #732 )
    |
    +-- GregoryLundberg:GL_HttT_S06_logical_thieves ( PR #733 )
    |
    +-- GregoryLundberg:GL_HttT_S07_ambushers_reduced ( PR #734 )
    |
    +-- GregoryLundberg:GL_HttT_S13_snow_detritus ( PR #735 )
    |
    +-- GregoryLundberg:GL_HttT_S20b_wose_assistance ( PR #736 )
    |
    +-- GregoryLundberg:GL_HttT_S22_gryphons_return ( PR #737 )
```

**GregoryLundberg:GL_HttT_general_improvements**
These are general improvements of my own. Each patch is fairly localized and should be easy to follow. Individual patches should be easy to cherry pick, if desired. The only complex patch is the last, which touches many files, and gets the debug command 'choose_level' working.

**GregoryLundberg:GL_HttT_S05b_use_advisor**
This implements a TODO item. It selects the advisor Konrad will have at the start of S06 ('The Siege of Elensefar') and uses that advisor for a comment, apparently coming from inside the ship, when it arrives.

**GregoryLundberg:GL_HttT_S05b_randomize_temples**
This implements a TODO item. It randomizes the temple contents.

**GregoryLundberg:GL_HttT_S06_logical_thieves**
This is an improvement of my own. It handles the Thieves' Guild in a more logical manner. Mainly, they will simply join forces in cases where Konrad has already passed the point where an offer of help makes sense.

**GregoryLundberg:GL_HttT_S07_ambushers_reduced**
This implements a TODO item. The number of ambushes reduces based upon the number of enemy leaders killed in S01 ('The Elves Besieged').

**GregoryLundberg:GL_HttT_S13_snow_detritus**
This implements a TODO item. It adds random snow on up to 1/3rd the non-snow tiles, based upon the snow coverage (that is, turns to completion) from S12 ('Northern Winter').

**GregoryLundberg:GL_HttT_S20b_wose_assistance**
This implements a TODO item. It adds a bonus sub-quest assisting the wose in dealing with the undead. The reward is a book which, when read, grants forest movement cost 1, forest defense 70%, and forest ambush (as with an Elvish Ranger). This reward was chosen because it offers some assistance in S22 ('Return to Wesnoth') and has limited, or no, use in the following scenarios.

**GregoryLundberg:GL_HttT_S22_gryphons_return**
This implements a TODO item. If Konrad did not injure or kill the gryphons in S10 ('Gryphon Mountain'), a flight of gryphons return to assist Konrad in S22 ('Return to Wesnoth'). Remember, for the gryphons to arrive, Konrad must have forgone their eggs and, therefore, has no Gryphon Riders. This lack of Gryphon Riders will be most felt in the final two scenario, and especially on the large, open plains of S23 ('The Test of the Clans').

**KNOWN BUGS**

Multiple-tile units with animation leave visual artifacts as they move. This is most noticeable with the Gryphons and Gryphon Riders as they move using move_unit_fake in S10 ('Gryphon Mountain'), S14 ('Plunging into Darkness') and S22 ('Return to Wesnoth'). The artifacts clear fairly quickly, and are all removed at the end of the movement.

The game engine appears to have memory-leak issues. When play-testing, after loading several dozen scenario, memory usage will have grown quite large. This can cause the system to begin to swap (if your system has swap space), which severely degrades performance. To work around the issue, I keep an eye on memory use and restart the engine when it approaches the limit.

There are a few remaining user-interface issues such as the popup messages sometimes not appearing.

**NOTES**

I have tested each fork to ensure no merge conflicts occur, provided the required upper-level forks have already been merged. I found no problems using simple merges. I did, however, run into problems with rebase. If you need to rebase after merging these forks and get merge conflicts, abort your rebase (git rebase --abort). In general, such merge conflicts occur because git can re-order the commits; but that re-ordering can be avoided, preventing merge conflicts, with an interactive rebase. Contact me if you need assistance using rebase.

The debug command choose_level works well, now. In general, when testing, you can switch from any scenario to any other. Internal state, such as which path you took from S04 ('The Bay of Pearls') .. S05a ('Muff Malal's Peninsula') or S05b ('The Isle of the Damned') .. or the amount of snow which fell in S12 ('Northern Winter') is maintained until you visit the scenario which sets the state. Thus, if you want to test with the various incarnations of Moremirmu in S09 ('The Valley of Death'), you simply need to use choose_level to jump to S05a or S05b, then jump back to S09 once you have the desired state.

The debug command next_level also works well. But, since there is no way to know if you used next_level command, it always advances to the default next level. At points where there is a branch, S04 ('The Bay of Pearls') and S18 ('A Choice Must Be Made'), you must either play through, or use the choose_level command if you do not want to follow the default choice.

When using the choose_level command, be aware that game state, such as your gold balance, and your recall list (including your Heros) is NOT CHANGED. This means, yes, it is possible to advance your Heros and jump to S01 ('The Elves Besieged') and have Konrad, Li'sar and Kalenz, along with a host of other L3 units, even Gryphon Riders or Gryphons, if you have always wanted to clear the board of those pesky orcs.

There are times when a Hero (generally Delfador or Li'sar) cannot be on the map, either for story purposes or because that Hero is already in that scenario. In these cases your Hero is saved and, if you are using choose_level to jump around, will be restored once you leave the area.

Similarly, there are times when a unit will join Konrad's forces. For example, Haldiel in S02 ('Blackwater Port'). If you already have Haldiel in your recall list and choose_level to jump to Blackwater Port, Haldiel will be removed from your recall list, and a new Haldiel will appear at the appropriate time. For those units which only appear depending upon your actions, they will only be removed from your recall list (or the map) should you take the action which causes their appearance.

**CHANGES**

_07AUG2016_

GL_unique_items has been merged to master.

Spelling and grammar corrections on this document and PR titles. Unfortunately, the typo in a branch name has to stay.

Spelling and grammar corrections on commit messages.

Removed underscores in custom event names 'home destroyed' and 'victory dance'.

Spelling and grammar corrections in commit 'HttT S20a Fix bug: El'rien might be dead'

Spelling and grammar corrections in commit 'HttT S20b Fix bug: Bona-Melodia may be dead'

Corrected filter for moving side in commit 'HttT S08 Adjust closing-in area'

Spelling and grammar corrections, and eliminated po comments in commit 'HttT S20b Wose assistance quest'

_08AUG2016_

Clean up [objectives] handling for commit 'HttT S10 Change objectives'

Clean up the hidden advisor to use a galleon unit instead of a shallow copy for commit 'HttT S05b Use an Advisor'

Moved lua inline, removing custom tag, for commit 'HttT S13 Add some random snow'

Clean up [objectives] handling for commit 'HttT S19c Fix bug: Wrong objectives'

_10AUG2016_

Sync to master v1.13.5+dev (6235e18-Clean) and re-tested

_11AUG2016_

Removed commit 'HttT S21 Fix bug: No save'

Sync to master v1.13.5+dev (cf4f488-Clean) and re-tested

Finally got commit 'HttT S05b Use an Advisor' working just the way I always envisioned

_12AUG2016_

Removed workaround commit for [object] issues on S08, S11 and S16.

Sync to master v1.13.5+dev (265e41d-Clean)

_12AUG2016_

GL_HttT_errors has been merged to master

Sync to master v1.13.5+dev (12f7107-Clean) and re-tested

_13AUG2016_

Cleanup since [hide_unit] now works for commit 'HttT S05b Use an Advisor'

Audited and corrected state variables for 'HttT Debug choose_level works'

Clean up [objectives] handling for commit 'HttT S20b Wose assistance quest'

Only leaders count for commit 'HttT S07 Ambushers reduced'

Changed the subject from you to the unit in commit 'HttT S19a Improve Flaming Sword'

Changed the subject from you to the unit in commit 'HttT S19b Improve Void Armor'

Sync to master v1.13.5+dev (3cc2d09-Clean) and re-tested

_19AUG2016_

Removed commit 'HttT S12 Added ambiance (fog)'

Updated commit 'HttT S19a Improve Flaming Sword' for typo and [message] big fixed

Updated commit 'HttT S14 Consistent objectives' for new {HAS_NO_TURN_LIMIT} macro

Sync to master v1.13.5+dev (7fab085-Clean) and re-tested

_30AUG2016_

Sync to master v1.13.5+dev (b24fdbc-Clean) and re-tested

_06SEP2016_

Updated commit 'HttT Debug choose_level works' removing macro RECALL_ELSE

Sync to master v1.13.5+dev (206096c-Clean) and re-tested

_10SEP2016_

Re-enabled Paladin to use Flaming Sword.

Switched to using unit for speaker when taking Void Armor to allow gender-specific messages.

Sync to master v1.13.5+dev (eb3e27b-Clean) (only tested for the changes)

_13SEP2016_

Removed [kill] before [unit] and cleaned up Li'sar changing sides for choose_level

Sync to master v1.13.5+dev (1af1932-Clean) and re-tested.
"
80358955,HttT S05b Use Advisor,GregoryLundberg,2016-08-07 05:42:29+00:00,2016-09-16 22:07:31+00:00,{},"This Pull Request is part of a series of corrections and improvements to the HttT ('Heir to the Throne') campaign.

When merging or testing, please be aware that a PR deeper in the hierarchy will have merge conflicts unless each higher PR has already been applied. If this presents a problem, contact me and I will re-factor the hierarchy as required. At present, the best options to contact me are either as comments on one of these pull requests, or by creating an Issue on my personal fork.

**Hierarchy**

```
master
|
+-- GregoryLundberg:GL_HttT_general_improvements ( PR #730 )
    |
    +-- GregoryLundberg:GL_HttT_S05b_use_advisor ( PR #731 )
    |
    +-- GregoryLundberg:GL_HttT_S05b_randomize_temples ( PR #732 )
    |
    +-- GregoryLundberg:GL_HttT_S06_logical_thieves ( PR #733 )
    |
    +-- GregoryLundberg:GL_HttT_S07_ambushers_reduced ( PR #734 )
    |
    +-- GregoryLundberg:GL_HttT_S13_snow_detritus ( PR #735 )
    |
    +-- GregoryLundberg:GL_HttT_S20b_wose_assistance ( PR #736 )
    |
    +-- GregoryLundberg:GL_HttT_S22_gryphons_return ( PR #737 )
```

**GregoryLundberg:GL_HttT_general_improvements**
These are general improvements of my own. Each patch is fairly localized and should be easy to follow. Individual patches should be easy to cherry pick, if desired. The only complex patch is the last, which touches many files, and gets the debug command 'choose_level' working.

**GregoryLundberg:GL_HttT_S05b_use_advisor**
This implements a TODO item. It selects the advisor Konrad will have at the start of S06 ('The Siege of Elensefar') and uses that advisor for a comment, apparently coming from inside the ship, when it arrives.

**GregoryLundberg:GL_HttT_S05b_randomize_temples**
This implements a TODO item. It randomizes the temple contents.

**GregoryLundberg:GL_HttT_S06_logical_thieves**
This is an improvement of my own. It handles the Thieves' Guild in a more logical manner. Mainly, they will simply join forces in cases where Konrad has already passed the point where an offer of help makes sense.

**GregoryLundberg:GL_HttT_S07_ambushers_reduced**
This implements a TODO item. The number of ambushes reduces based upon the number of enemy leaders killed in S01 ('The Elves Besieged').

**GregoryLundberg:GL_HttT_S13_snow_detritus**
This implements a TODO item. It adds random snow on up to 1/3rd the non-snow tiles, based upon the snow coverage (that is, turns to completion) from S12 ('Northern Winter').

**GregoryLundberg:GL_HttT_S20b_wose_assistance**
This implements a TODO item. It adds a bonus sub-quest assisting the wose in dealing with the undead. The reward is a book which, when read, grants forest movement cost 1, forest defense 70%, and forest ambush (as with an Elvish Ranger). This reward was chosen because it offers some assistance in S22 ('Return to Wesnoth') and has limited, or no, use in the following scenarios.

**GregoryLundberg:GL_HttT_S22_gryphons_return**
This implements a TODO item. If Konrad did not injure or kill the gryphons in S10 ('Gryphon Mountain'), a flight of gryphons return to assist Konrad in S22 ('Return to Wesnoth'). Remember, for the gryphons to arrive, Konrad must have forgone their eggs and, therefore, has no Gryphon Riders. This lack of Gryphon Riders will be most felt in the final two scenario, and especially on the large, open plains of S23 ('The Test of the Clans').

**KNOWN BUGS**

Multiple-tile units with animation leave visual artifacts as they move. This is most noticeable with the Gryphons and Gryphon Riders as they move using move_unit_fake in S10 ('Gryphon Mountain'), S14 ('Plunging into Darkness') and S22 ('Return to Wesnoth'). The artifacts clear fairly quickly, and are all removed at the end of the movement.

The game engine appears to have memory-leak issues. When play-testing, after loading several dozen scenario, memory usage will have grown quite large. This can cause the system to begin to swap (if your system has swap space), which severely degrades performance. To work around the issue, I keep an eye on memory use and restart the engine when it approaches the limit.

There are a few remaining user-interface issues such as the popup messages sometimes not appearing.

**NOTES**

I have tested each fork to ensure no merge conflicts occur, provided the required upper-level forks have already been merged. I found no problems using simple merges. I did, however, run into problems with rebase. If you need to rebase after merging these forks and get merge conflicts, abort your rebase (git rebase --abort). In general, such merge conflicts occur because git can re-order the commits; but that re-ordering can be avoided, preventing merge conflicts, with an interactive rebase. Contact me if you need assistance using rebase.

The debug command choose_level works well, now. In general, when testing, you can switch from any scenario to any other. Internal state, such as which path you took from S04 ('The Bay of Pearls') .. S05a ('Muff Malal's Peninsula') or S05b ('The Isle of the Damned') .. or the amount of snow which fell in S12 ('Northern Winter') is maintained until you visit the scenario which sets the state. Thus, if you want to test with the various incarnations of Moremirmu in S09 ('The Valley of Death'), you simply need to use choose_level to jump to S05a or S05b, then jump back to S09 once you have the desired state.

The debug command next_level also works well. But, since there is no way to know if you used next_level command, it always advances to the default next level. At points where there is a branch, S04 ('The Bay of Pearls') and S18 ('A Choice Must Be Made'), you must either play through, or use the choose_level command if you do not want to follow the default choice.

When using the choose_level command, be aware that game state, such as your gold balance, and your recall list (including your Heros) is NOT CHANGED. This means, yes, it is possible to advance your Heros and jump to S01 ('The Elves Besieged') and have Konrad, Li'sar and Kalenz, along with a host of other L3 units, even Gryphon Riders or Gryphons, if you have always wanted to clear the board of those pesky orcs.

There are times when a Hero (generally Delfador or Li'sar) cannot be on the map, either for story purposes or because that Hero is already in that scenario. In these cases your Hero is saved and, if you are using choose_level to jump around, will be restored once you leave the area.

Similarly, there are times when a unit will join Konrad's forces. For example, Haldiel in S02 ('Blackwater Port'). If you already have Haldiel in your recall list and choose_level to jump to Blackwater Port, Haldiel will be removed from your recall list, and a new Haldiel will appear at the appropriate time. For those units which only appear depending upon your actions, they will only be removed from your recall list (or the map) should you take the action which causes their appearance.

**CHANGES**

_07AUG2016_

GL_unique_items has been merged to master.

Spelling and grammar corrections on this document and PR titles. Unfortunately, the typo in a branch name has to stay.

Spelling and grammar corrections on commit messages.

Removed underscores in custom event names 'home destroyed' and 'victory dance'.

Spelling and grammar corrections in commit 'HttT S20a Fix bug: El'rien might be dead'

Spelling and grammar corrections in commit 'HttT S20b Fix bug: Bona-Melodia may be dead'

Corrected filter for moving side in commit 'HttT S08 Adjust closing-in area'

Spelling and grammar corrections, and eliminated po comments in commit 'HttT S20b Wose assistance quest'

_08AUG2016_

Clean up [objectives] handling for commit 'HttT S10 Change objectives'

Clean up the hidden advisor to use a galleon unit instead of a shallow copy for commit 'HttT S05b Use an Advisor'

Moved lua inline, removing custom tag, for commit 'HttT S13 Add some random snow'

Clean up [objectives] handling for commit 'HttT S19c Fix bug: Wrong objectives'

_10AUG2016_

Sync to master v1.13.5+dev (6235e18-Clean) and re-tested

_11AUG2016_

Removed commit 'HttT S21 Fix bug: No save'

Sync to master v1.13.5+dev (cf4f488-Clean) and re-tested

Finally got commit 'HttT S05b Use an Advisor' working just the way I always envisioned

_12AUG2016_

Removed workaround commit for [object] issues on S08, S11 and S16.

Sync to master v1.13.5+dev (265e41d-Clean)

_12AUG2016_

GL_HttT_errors has been merged to master

Sync to master v1.13.5+dev (12f7107-Clean) and re-tested

_13AUG2016_

Cleanup since [hide_unit] now works for commit 'HttT S05b Use an Advisor'

Audited and corrected state variables for 'HttT Debug choose_level works'

Clean up [objectives] handling for commit 'HttT S20b Wose assistance quest'

Only leaders count for commit 'HttT S07 Ambushers reduced'

Changed the subject from you to the unit in commit 'HttT S19a Improve Flaming Sword'

Changed the subject from you to the unit in commit 'HttT S19b Improve Void Armor'

Sync to master v1.13.5+dev (3cc2d09-Clean) and re-tested

_19AUG2016_

Removed commit 'HttT S12 Added ambiance (fog)'

Updated commit 'HttT S19a Improve Flaming Sword' for typo and [message] big fixed

Updated commit 'HttT S14 Consistent objectives' for new {HAS_NO_TURN_LIMIT} macro

Sync to master v1.13.5+dev (7fab085-Clean) and re-tested

_30AUG2016_

Sync to master v1.13.5+dev (b24fdbc-Clean) and re-tested

_06SEP2016_

Updated commit 'HttT Debug choose_level works' removing macro RECALL_ELSE

Sync to master v1.13.5+dev (206096c-Clean) and re-tested

_10SEP2016_

Re-enabled Paladin to use Flaming Sword.

Switched to using unit for speaker when taking Void Armor to allow gender-specific messages.

Sync to master v1.13.5+dev (eb3e27b-Clean) (only tested for the changes)

_13SEP2016_

Removed [kill] before [unit] and cleaned up Li'sar changing sides for choose_level

Sync to master v1.13.5+dev (1af1932-Clean) and re-tested.
"
80358951,HttT General Improvements,GregoryLundberg,2016-08-07 05:42:25+00:00,2016-09-15 09:21:13+00:00,{},"This Pull Request is part of a series of corrections and improvements to the HttT ('Heir to the Throne') campaign.

When merging or testing, please be aware that a PR deeper in the hierarchy will have merge conflicts unless each higher PR has already been applied. If this presents a problem, contact me and I will re-factor the hierarchy as required. At present, the best options to contact me are either as comments on one of these pull requests, or by creating an Issue on my personal fork.

**Hierarchy**

```
master
|
+-- GregoryLundberg:GL_HttT_general_improvements ( PR #730 )
    |
    +-- GregoryLundberg:GL_HttT_S05b_use_advisor ( PR #731 )
    |
    +-- GregoryLundberg:GL_HttT_S05b_randomize_temples ( PR #732 )
    |
    +-- GregoryLundberg:GL_HttT_S06_logical_thieves ( PR #733 )
    |
    +-- GregoryLundberg:GL_HttT_S07_ambushers_reduced ( PR #734 )
    |
    +-- GregoryLundberg:GL_HttT_S13_snow_detritus ( PR #735 )
    |
    +-- GregoryLundberg:GL_HttT_S20b_wose_assistance ( PR #736 )
    |
    +-- GregoryLundberg:GL_HttT_S22_gryphons_return ( PR #737 )
```

**GregoryLundberg:GL_HttT_general_improvements**
These are general improvements of my own. Each patch is fairly localized and should be easy to follow. Individual patches should be easy to cherry pick, if desired. The only complex patch is the last, which touches many files, and gets the debug command 'choose_level' working.

**GregoryLundberg:GL_HttT_S05b_use_advisor**
This implements a TODO item. It selects the advisor Konrad will have at the start of S06 ('The Siege of Elensefar') and uses that advisor for a comment, apparently coming from inside the ship, when it arrives.

**GregoryLundberg:GL_HttT_S05b_randomize_temples**
This implements a TODO item. It randomizes the temple contents.

**GregoryLundberg:GL_HttT_S06_logical_thieves**
This is an improvement of my own. It handles the Thieves' Guild in a more logical manner. Mainly, they will simply join forces in cases where Konrad has already passed the point where an offer of help makes sense.

**GregoryLundberg:GL_HttT_S07_ambushers_reduced**
This implements a TODO item. The number of ambushes reduces based upon the number of enemy leaders killed in S01 ('The Elves Besieged').

**GregoryLundberg:GL_HttT_S13_snow_detritus**
This implements a TODO item. It adds random snow on up to 1/3rd the non-snow tiles, based upon the snow coverage (that is, turns to completion) from S12 ('Northern Winter').

**GregoryLundberg:GL_HttT_S20b_wose_assistance**
This implements a TODO item. It adds a bonus sub-quest assisting the wose in dealing with the undead. The reward is a book which, when read, grants forest movement cost 1, forest defense 70%, and forest ambush (as with an Elvish Ranger). This reward was chosen because it offers some assistance in S22 ('Return to Wesnoth') and has limited, or no, use in the following scenarios.

**GregoryLundberg:GL_HttT_S22_gryphons_return**
This implements a TODO item. If Konrad did not injure or kill the gryphons in S10 ('Gryphon Mountain'), a flight of gryphons return to assist Konrad in S22 ('Return to Wesnoth'). Remember, for the gryphons to arrive, Konrad must have forgone their eggs and, therefore, has no Gryphon Riders. This lack of Gryphon Riders will be most felt in the final two scenario, and especially on the large, open plains of S23 ('The Test of the Clans').

**KNOWN BUGS**

Multiple-tile units with animation leave visual artifacts as they move. This is most noticeable with the Gryphons and Gryphon Riders as they move using move_unit_fake in S10 ('Gryphon Mountain'), S14 ('Plunging into Darkness') and S22 ('Return to Wesnoth'). The artifacts clear fairly quickly, and are all removed at the end of the movement.

The game engine appears to have memory-leak issues. When play-testing, after loading several dozen scenario, memory usage will have grown quite large. This can cause the system to begin to swap (if your system has swap space), which severely degrades performance. To work around the issue, I keep an eye on memory use and restart the engine when it approaches the limit.

There are a few remaining user-interface issues such as the popup messages sometimes not appearing.

**NOTES**

I have tested each fork to ensure no merge conflicts occur, provided the required upper-level forks have already been merged. I found no problems using simple merges. I did, however, run into problems with rebase. If you need to rebase after merging these forks and get merge conflicts, abort your rebase (git rebase --abort). In general, such merge conflicts occur because git can re-order the commits; but that re-ordering can be avoided, preventing merge conflicts, with an interactive rebase. Contact me if you need assistance using rebase.

The debug command choose_level works well, now. In general, when testing, you can switch from any scenario to any other. Internal state, such as which path you took from S04 ('The Bay of Pearls') .. S05a ('Muff Malal's Peninsula') or S05b ('The Isle of the Damned') .. or the amount of snow which fell in S12 ('Northern Winter') is maintained until you visit the scenario which sets the state. Thus, if you want to test with the various incarnations of Moremirmu in S09 ('The Valley of Death'), you simply need to use choose_level to jump to S05a or S05b, then jump back to S09 once you have the desired state.

The debug command next_level also works well. But, since there is no way to know if you used next_level command, it always advances to the default next level. At points where there is a branch, S04 ('The Bay of Pearls') and S18 ('A Choice Must Be Made'), you must either play through, or use the choose_level command if you do not want to follow the default choice.

When using the choose_level command, be aware that game state, such as your gold balance, and your recall list (including your Heros) is NOT CHANGED. This means, yes, it is possible to advance your Heros and jump to S01 ('The Elves Besieged') and have Konrad, Li'sar and Kalenz, along with a host of other L3 units, even Gryphon Riders or Gryphons, if you have always wanted to clear the board of those pesky orcs.

There are times when a Hero (generally Delfador or Li'sar) cannot be on the map, either for story purposes or because that Hero is already in that scenario. In these cases your Hero is saved and, if you are using choose_level to jump around, will be restored once you leave the area.

Similarly, there are times when a unit will join Konrad's forces. For example, Haldiel in S02 ('Blackwater Port'). If you already have Haldiel in your recall list and choose_level to jump to Blackwater Port, Haldiel will be removed from your recall list, and a new Haldiel will appear at the appropriate time. For those units which only appear depending upon your actions, they will only be removed from your recall list (or the map) should you take the action which causes their appearance.

**CHANGES**

_07AUG2016_

GL_unique_items has been merged to master.

Spelling and grammar corrections on this document and PR titles. Unfortunately, the typo in a branch name has to stay.

Spelling and grammar corrections on commit messages.

Removed underscores in custom event names 'home destroyed' and 'victory dance'.

Spelling and grammar corrections in commit 'HttT S20a Fix bug: El'rien might be dead'

Spelling and grammar corrections in commit 'HttT S20b Fix bug: Bona-Melodia may be dead'

Corrected filter for moving side in commit 'HttT S08 Adjust closing-in area'

Spelling and grammar corrections, and eliminated po comments in commit 'HttT S20b Wose assistance quest'

_08AUG2016_

Clean up [objectives] handling for commit 'HttT S10 Change objectives'

Clean up the hidden advisor to use a galleon unit instead of a shallow copy for commit 'HttT S05b Use an Advisor'

Moved lua inline, removing custom tag, for commit 'HttT S13 Add some random snow'

Clean up [objectives] handling for commit 'HttT S19c Fix bug: Wrong objectives'

_10AUG2016_

Sync to master v1.13.5+dev (6235e18-Clean) and re-tested

_11AUG2016_

Removed commit 'HttT S21 Fix bug: No save'

Sync to master v1.13.5+dev (cf4f488-Clean) and re-tested

Finally got commit 'HttT S05b Use an Advisor' working just the way I always envisioned

_12AUG2016_

Removed workaround commit for [object] issues on S08, S11 and S16.

Sync to master v1.13.5+dev (265e41d-Clean)

_12AUG2016_

GL_HttT_errors has been merged to master

Sync to master v1.13.5+dev (12f7107-Clean) and re-tested

_13AUG2016_

Cleanup since [hide_unit] now works for commit 'HttT S05b Use an Advisor'

Audited and corrected state variables for 'HttT Debug choose_level works'

Clean up [objectives] handling for commit 'HttT S20b Wose assistance quest'

Only leaders count for commit 'HttT S07 Ambushers reduced'

Changed the subject from you to the unit in commit 'HttT S19a Improve Flaming Sword'

Changed the subject from you to the unit in commit 'HttT S19b Improve Void Armor'

Sync to master v1.13.5+dev (3cc2d09-Clean) and re-tested

_19AUG2016_

Removed commit 'HttT S12 Added ambiance (fog)'

Updated commit 'HttT S19a Improve Flaming Sword' for typo and [message] big fixed

Updated commit 'HttT S14 Consistent objectives' for new {HAS_NO_TURN_LIMIT} macro

Sync to master v1.13.5+dev (7fab085-Clean) and re-tested

_30AUG2016_

Sync to master v1.13.5+dev (b24fdbc-Clean) and re-tested

_06SEP2016_

Updated commit 'HttT Debug choose_level works' removing macro RECALL_ELSE

Sync to master v1.13.5+dev (206096c-Clean) and re-tested

_10SEP2016_

Re-enabled Paladin to use Flaming Sword.

Switched to using unit for speaker when taking Void Armor to allow gender-specific messages.

Sync to master v1.13.5+dev (eb3e27b-Clean) (only tested for the changes)

_13SEP2016_

Removed [kill] before [unit] and cleaned up Li'sar changing sides for choose_level

Sync to master v1.13.5+dev (1af1932-Clean) and re-tested.
"
80358949,HttT Errors,GregoryLundberg,2016-08-07 05:42:20+00:00,2016-08-12 22:20:33+00:00,{},"This Pull Request is part of a series of corrections and improvements to the HttT ('Heir to the Throne') campaign.

When merging or testing, please be aware that a PR deeper in the hierarchy will have merge conflicts unless each higher PR has already been applied. If this presents a problem, contact me and I will re-factor the hierarchy as required. At present, the best options to contact me are either as comments on one of these pull requests, or by creating an Issue on my personal fork.

**Hierarchy**

```
master
|
+-- GregoryLundberg:GL_HttT_errors ( PR #729  )
    |
    +-- GregoryLundberg:GL_HttT_general_improvements ( PR #730 )
        |
        +-- GregoryLundberg:GL_HttT_S05b_use_advisor ( PR #731 )
        |
        +-- GregoryLundberg:GL_HttT_S05b_randomize_temples ( PR #732 )
        |
        +-- GregoryLundberg:GL_HttT_S06_logical_thieves ( PR #733 )
        |
        +-- GregoryLundberg:GL_HttT_S07_ambushers_reduced ( PR #734 )
        |
        +-- GregoryLundberg:GL_HttT_S13_snow_detritus ( PR #735 )
        |
        +-- GregoryLundberg:GL_HttT_S20b_wose_assistance ( PR #736 )
        |
        +-- GregoryLundberg:GL_HttT_S22_gryphons_return ( PR #737 )
```

**GregoryLundberg:GL_HttT_errors**
These correct bugs and errors in the existing code-base.  Each patch is fairly localized and should be easy to follow. Individual patches should be easy to cherry pick, if desired.

**GregoryLundberg:GL_HttT_general_improvements**
These are general improvements of my own. Each patch is fairly localized and should be easy to follow. Individual patches should be easy to cherry pick, if desired.

The only complex patch is the last, which touches many files, and gets the debug command 'choose_level' working. I have this patch last because there may be some issues which need working out. It works, but it may reset some states which someone debugging might not want reset; so there may be a few corrections needed for it.

**GregoryLundberg:GL_HttT_S05b_use_advisor**
This implements a TODO item. It selects the advisor Konrad will have at the start of S06 ('The Siege of Elensefar') and uses that advisor for a comment, apparently coming from inside the ship, when it arrives.

**GregoryLundberg:GL_HttT_S05b_randomize_temples**
This implements a TODO item. It randomizes the temple contents.

**GregoryLundberg:GL_HttT_S06_logical_thieves**
This is an improvement of my own. It handles the Thieves' Guild in a more logical manner. Mainly, they will simply join forces in cases where Konrad has already passed the point where an offer of help makes sense.

**GregoryLundberg:GL_HttT_S07_ambushers_reduced**
This implements a TODO item. The number of ambushes reduces based upon the number of enemy leaders killed in S01 ('The Elves Besieged').

**GregoryLundberg:GL_HttT_S13_snow_detritus**
This implements a TODO item. It adds random snow on up to 1/3rd the non-snow tiles, based upon the snow coverage (that is, turns to completion) from S12 ('Northern Winter').

**GregoryLundberg:GL_HttT_S20b_wose_assistance**
This implements a TODO item. It adds a bonus sub-quest assisting the wose in dealing with the undead. The reward is a book which, when read, grants forest movement cost 1, forest defense 70%, and forest ambush (as with an Elvish Ranger). This reward was chosen because it offers some assistance in S22 ('Return to Wesnoth') and has limited, or no, use in the following scenarios.

**GregoryLundberg:GL_HttT_S22_gryphons_return**
This implements a TODO item. If Konrad did not injure or kill the gryphons in S10 ('Gryphon Mountain'), a flight of gryphons return to assist Konrad in S22 ('Return to Wesnoth'). Remember, for the gryphons to arrive, Konrad must have forgone their eggs and, therefore, has no Gryphon Riders. This lack of Gryphon Riders will be most felt in the final two scenario, and especially on the large, open plains of S23 ('The Test of the Clans').

**KNOWN BUGS**

Multiple-tile units with animation leave visual artifacts as they move. This is most noticeable with the Gryphons and Gryphon Riders as they move using move_unit_fake in S10 ('Gryphon Mountain'), S14 ('Plunging into Darkness') and S22 ('Return to Wesnoth'). The artifacts clear fairly quickly, and are all removed at the end of the movement.

move_unit_fake leaves a visual artifact when moving under fog. This is extremely noticeable in S20a ('Home of the North Elves') when, in the opening sequence, Telerandor appears in the fog and moves to Konrad: it appears as if an Elvish Rider remains unmoving back at the start of the path, and remains there until the end of his movement.

GL_HttT_errors includes a workaround for a user-interface bug caused by the custom initiative feature for Li'sar. This causes the last unit processed to be selected at the start of the scenario. It appears in S08 ('The Princess of Wesnoth'), S11 ('The Ford of Abez'), and S16 ('Hasty Alliance'). Without the workaround, the user must de-select the unit (which, in general, is not theirs and, so, cannot be moved) before they can begin their movement phase.

The game engine appears to have memory-leak issues. When play-testing, after loading several dozen scenario, memory usage will have grown quite large. This can cause the system to begin to swap (if your system has swap space), which severely degrades performance. To work around the issue, I keep an eye on memory use and restart the engine when it approaches the limit.

There are a few remaining user-interface issues such as the load selection list being to short for its contents, and popup messages sometimes not appearing.

**NOTES**

I have tested each fork to ensure no merge conflicts occur, provided the required upper-level forks have already been merged. I found no problems using simple merges. I did, however, run into problems with rebase. If you need to rebase after merging these forks and get merge conflicts, abort your rebase (git rebase --abort). In general, such merge conflicts occur because git can re-order the commits; but that re-ordering can be avoided, preventing merge conflicts, with an interactive rebase. Contact me if you need assistance using rebase.

The debug command choose_level works well, now. In general, when testing, you can switch from any scenario to any other. Internal state, such as which path you took from S04 ('The Bay of Pearls') .. S05a ('Muff Malal's Peninsula') or S05b ('The Isle of the Damned') .. or the amount of snow which fell in S12 ('Northern Winter') is maintained until you visit the scenario which sets the state. Thus, if you want to test with the various incarnations of Moremirmu in S09 ('The Valley of Death'), you simply need to use choose_level to jump to S05a or S05b, then jump back to S09 once you have the desired state.

The debug command next_level also works well. But, since there is no way to know if you used next_level command, it always advances to the default next level. At points where there is a branch, S04 ('The Bay of Pearls') and S18 ('A Choice Must Be Made'), you must either play through, or use the choose_level command if you do not want to follow the default choice.

When using the choose_level command, be aware that game state, such as your gold balance, and your recall list (including your Heros) is NOT CHANGED. This means, yes, it is possible to advance your Heros and jump to S01 ('The Elves Besieged') and have Konrad, Li'sar and Kalenz, along with a host of other L3 units, even Gryphon Riders or Gryphons, if you have always wanted to clear the board of those pesky orcs.

There are times when a Hero (generally Delfador or Li'sar) cannot be on the map, either for story purposes or because that Hero is already in that scenario. In these cases your Hero is saved and, if you are using choose_level to jump around, will be restored once you leave the area.

Similarly, there are times when a unit will join Konrad's forces. For example, Haldiel in S02 ('Blackwater Port'). If you already have Haldiel in your recall list and choose_level to jump to Blackwater Port, Haldiel will be removed from your recall list, and a new Haldiel will appear at the appropriate time. For those units which only appear depending upon your actions, they will only be removed from your recall list (or the map) should you take the action which causes their appearance.

**CHANGES**

_07AUG2016_

GL_unique_items has been merged to master.

Spelling and grammar corrections on this document and PR titles. Unfortunately, the typo in a branch name has to stay.

Spelling and grammar corrections on commit messages.

Removed underscores in custom event names 'home destroyed' and 'victory dance'.

Spelling and grammar corrections in commit 'HttT S20a Fix bug: El'rien might be dead'

Spelling and grammar corrections in commit 'HttT S20b Fix bug: Bona-Melodia may be dead'

Corrected filter for moving side in commit 'HttT S08 Adjust closing-in area'

Spelling and grammar corrections, and eliminated po comments in commit 'HttT S20b Wose assistance quest'

_08AUG2016_

Clean up [objectives] handling for commit 'HttT S20b Wose assistance quest'

Clean up [objectives] handling for commit 'HttT S10 Change objectives'

Clean up the hidden advisor to use a galleon unit instead of a shallow copy for commit 'HttT S05b Use an Advisor'

Moved lua inline, removing custom tag, for commit 'HttT S13 Add some random snow'

Clean up [objectives] handling for commit 'HttT S19c Fix bug: Wrong objectives'

_10AUG2016_

Sync to master v1.13.5+dev (6235e18-Clean) and re-tested

_11AUG2016_

Removed commit 'HttT S21 Fix bug: No save'

Sync to master v1.13.5+dev (cf4f488-Clean) and re-tested

Finally got commit 'HttT S05b Use an Advisor' working just the way I always envisioned

_12AUG2016_

Removed workaround commit for [object] issues on S08, S11 and S16.

Sync to master v1.13.5+dev (265e41d-Clean)
"
80352737,Fixed name generation in map generator,spixi,2016-08-06 22:36:40+00:00,2016-08-06 23:14:52+00:00,{},"This fixes the generation of the names in the map generator
"
80343128,Missed ending /foreach -> /for,GregoryLundberg,2016-08-06 15:38:29+00:00,2016-08-06 17:01:47+00:00,{},"I tested this and don't see why it missed being in the PR
"
80341910,Emergency fix for commit #25e46473d2bdb0a2bb7577373c216efa5b631847,GregoryLundberg,2016-08-06 14:52:11+00:00,2016-08-06 15:24:52+00:00,{},"When a Drake base is killed it needs to be removed from the list of active Drake bases.
"
80184591,Fix bug: libpng warning: iCCP: known incorrect sRGB profile,GregoryLundberg,2016-08-05 03:41:02+00:00,2016-08-05 10:01:28+00:00,{},"Some changes in libpng 1.6+ cause it issue warning or even not work correctly with the original HP/MS sRGB profile. You will notice this in stderr:

```
libpng warning: iCCP: known incorrect sRGB profile
```

The old profile uses a D50 whitepoint, where D65 is standard. This profile is not uncommon, being used by Adobe Photoshop, although it was not embedded into images by default.

The simplest solution is simply to remove the embedded profile from your image. This can cause a slight shift in color _IF_ have have a properly calibrated system, monitor, and software.
"
79753508,Add [else] sub-tags for [recall],GregoryLundberg,2016-08-02 15:14:13+00:00,2016-08-05 04:35:17+00:00,{},"This allows us to write

```
[recall]
    id=Delfador
    [else]
        {DELFADOR}
    [/else]
[/recall]
```

rather than

```
[recall]
    id=Delfador
[/recall]
[if]
    [not]
        [have_unit]
            id=Delfador
        [/have_unit]
    [/not]
    [then]
        {DELFADOR}
    [/then]
[/if]
```
"
79720010,Add override specifier to derived virtual methods,PoignardAzur,2016-08-02 11:38:06+00:00,2016-08-02 12:18:09+00:00,{},
79612587,Unique items: don't be a pig,GregoryLundberg,2016-08-01 18:24:53+00:00,2016-08-07 22:22:00+00:00,{},"And the Lord said, ""Thou hast already consumed My Holy Water, thou needest another not.""

And, hearing the Word of the Lord, Posieden said, ""Yo! Storm Trident! Dude, look in your hand!""
"
79506871,objectives.lua show_turn_counter in white,GregoryLundberg,2016-08-01 02:53:47+00:00,2016-08-05 10:00:56+00:00,{},"This matches the style used for OBJECTIVE_FOOTNOTE and makes the turn count more apparent.

The turn count really is not part of the win/lose condition. The show_turn_counter option adds it as an informative footnote. Other such footnotes are created using OBJECTIVE_FOOTNOTE, which sets the color 'white'. This change makes the show_turn_counter footnote consistent with that macro.
"
79501052,give formatter an x-value conversion to std::string (C++11),cbeck88,2016-08-01 00:32:23+00:00,2016-08-04 20:01:57+00:00,{},"`formatter` is one of these classes that Dave has put into every project that he worked on it seems.

In wesnoth, the `formatter` class still has a copyright to ""The Silvertree Project"" which has long been defunct.

It's commonly used as

``` c++
    string result = (formatter() << ""blah "" << n << x << "" blah"").str();
```

In [anura](https://github.com/anura-engine/anura/blob/trunk/src/formatter.hpp), Dave modified it to be more aggressive, by giving it an `operator std::string()` implicit conversion.

This allows a terser syntax:

``` c++
    string result = formatter() << ""blah "" << n << x << "" blah"";
```

but it creates some room for compiler shenanigans. Usually programmers agree that implicit conversions like this are evil. But it's also pretty convenient.

In another project, I modified it as shown in this pull request, using C++11 features.
- Make a version of `operator <<` which works with r-value reference to the formatter.
- Make an `operator std::string` which is ref-qualified so that it can only work with an expiring value.

This basically means that a `formatter` instance which is a nameless temporary can be converted to `std::string`, but an `l-value` formatter is not so convertible, you would have to use `.str()`.

Typically, rvalue-references arise as return values from functions, temporaries, or as result of `std::move`. I never saw a function that returns `formatter`, its sort of not what this idiom is for. So I consider that this operator usually just avoids you having to add extra parens and write `str()` and isn't usually invoked otherwise, which is the intent.

It's debatable whether this is still evil or not, but I think it's somewhat more safe. I leave it to you to decide if its worth it. :-)
"
79494416,Fade out music on scenario start and on disabling it,jyrkive,2016-07-31 20:05:46+00:00,2016-08-07 18:12:54+00:00,{},"@Vultraz requested something like this in IRC.

> 20160730 12:44:41< vultraz> JyrkiVesterinen: I have a small task for you, if you're up to it: make it so music fades out (such as when you toggle it off, or a scenario ends) instead of stopping abruptly.

I implemented fading out when the player disables music in preferences. I also edited the SCENARIO_MUSIC and INTRO_AND_SCENARIO_MUSIC macros by turning on fade-out of previous music (i.e. the storyscreen music) when the scenario starts.

I assume that the ""scenario ends"" condition @Vultraz mentioned means the victory or defeat situation, when the game plays the victory/defeat music. I didn't implement fade-out of previous music in that situation because I _oppose_ it. (I prefer the ""abrupt"" switch to the victory/defeat music.)
"
79461695,unit.cpp Fix bug: Ellipse is lost,GregoryLundberg,2016-07-30 16:35:22+00:00,2016-07-31 16:19:01+00:00,{},"When advancing or an object (say, the Scepter of Fire) selects a unit variation, the ellipse is lost. This causes a unit with {ISHERO} to convert to {ISLOYAL}, changing the hero ellipse to the default.

I consider this a Work In Process because I view the issue as symptomatic of a general error and would prefer someone better invested in the engine, and unit.cpp specifically, to review the code for other instances.

This problem was first noticed in HttT S17 when Li'sar obtains the Scepter of Fire. The Scepter operates by selecting a unit variation.

The problem was then confirmed to also effect any {ISHERO} unit who was not canrecruit and not at AMLA such as Kalenz when first able to advance in HttT S07 and confirmed with additional checks in other campaigns.

The problem was also confirmed to NOT exist in 1.12.5.

Examining the commit history indicates this probably resulted from a refactor back around Feb by @gfgtdf but this could not be confirmed (I got compile errors attempting to roll back and, so, gave up). But, using that as a clue, I attempted this patch and it appears to work in both the normal advancement case and the Scepter case selecting a unit variation.
"
79351062,Fix bug #24553: Prevent the display from drawing over the storyscreen.,aginor,2016-07-29 12:22:32+00:00,2016-08-05 11:23:20+00:00,{},"This also adds a call to stop flips during a full redraw as a consequence of a window event.
"
79177243,Boost-related cleanups,Vultraz,2016-07-28 11:10:18+00:00,2016-07-30 04:51:30+00:00,{},"This branch contains various code cleanups and slight refactoring, mostly focused on transitioning uses of boost types to their standard library equivalents.
"
78957941,Generate trait help instead of hardcoding,Asheviere,2016-07-27 02:54:36+00:00,2016-07-29 22:45:57+00:00,{},"Introduces a new key ""help_text="" in [trait]
"
78953709,"Improve the unit help topics, especially on smaller monitors",Asheviere,2016-07-27 01:51:05+00:00,2016-07-27 02:34:15+00:00,{},
78865281,Kill floating_point_emulation.hpp with fire,jyrkive,2016-07-26 14:48:16+00:00,2016-07-26 15:45:15+00:00,{},"**This PR is against the boost_trimming branch.**

Ability to emulate floating point calculations makes sense only if we
intend to support platforms without native floating point support. Such
platforms haven't been relevant since mid-1990s or so. Besides, supporting
such platforms would require converting the entire codebase to use the
`tfloat` class instead of native `float` and `double` types, which would be
outright Herculean effort.

As a bonus, killing floating_point_emulation.cpp also eliminates two uses
of `boost::enable_if_c`.

I also removed the nonexistent file SDL_SavePNG/savepng.hpp from the
Visual Studio project, and added `#include <string>` to
formula/debugger_fwd.hpp because the build failed otherwise
(maybe compilation order changed when I removed
floating_point_emulation.hpp?).
"
78695408,Missing newline on stderr,GregoryLundberg,2016-07-25 14:53:12+00:00,2016-07-25 14:55:31+00:00,{},
78591635,Implement tod_manager::resolve_random() without Boost.Range,jyrkive,2016-07-24 07:09:38+00:00,2016-07-25 05:12:36+00:00,{},"This gets rid of yet another use of Boost.Bind. After this, only server.cpp remains. :smiling_imp: 
"
78567414,Allow firing an event by id instead of name.,spixi,2016-07-23 08:49:16+00:00,2016-07-30 05:23:07+00:00,{},"I implemented a feature request mentioned in [https://wiki.wesnoth.org/EasyCoding], which allows you to raise events by id instead of name.

This adds the lua functions `wesnoth.fire_event_by_id` and `wesnoth.fire_event_by_name`. The old `wesnoth.fire_event` is now an alias of `wesnoth.fire_event_by_name`.

The WML tag `[fire_event]` has now an extra key `ìd=`, which fires an event by id. When `id=` is empty or missing, the event is fired by name. If neither `ìd=` nor `name=` are given, nothing happens (like the current behavior).
"
78517501,Fix undefined behavior on destroying an event context,jyrkive,2016-07-22 18:09:35+00:00,2016-07-22 23:09:34+00:00,{},"Quoting the corresponding messages in IRC:

> [19:49:36] <JyrkiVesterinen> FYI: the game crashed when I tried to open the Preferences dialog ingame. Looks related to the event context changes.
> [19:49:37] <JyrkiVesterinen> https://gist.github.com/jyrkive/3992782bfb0c7b6bea6f9dd2ac6b9dad
> [19:49:42] <JyrkiVesterinen> I'm investigating.
> [20:10:19] <hk238> :o
> [20:21:54] \* stikonas (~gentoo@wesnoth/translator/stikonas) has quit IRC (Quit: Konversation terminated!)
> [20:30:50] <JyrkiVesterinen> All right, the problem is in the destructor of the context class.
> [20:30:51] <JyrkiVesterinen> https://github.com/wesnoth/wesnoth/blob/681322bf2935ce08e2526d92b842aad86302afe6/src/events.cpp#L133-L146
> [20:31:43] <JyrkiVesterinen> It performs ""it = handlers.erase(it);"" followed by ""++it"" in every iteration. It other words, it increments it twice.
> [20:32:24] <JyrkiVesterinen> If the number of handlers happens to be odd, the second increment increments the end iterator, which is undefined behavior.
> [20:32:46] <JyrkiVesterinen> Microsoft's debug CRT is guaranteed to crash in that situation, fortunately.
> [20:32:46] <celticminstrel> I think logically the ++it is not supposed to be there.
> [20:33:14] <JyrkiVesterinen> It doesn't make sense to manually remove the handlers from the list anyway.
> [20:33:16] <celticminstrel> Yeah, MSVC tends to be pretty good about crashing in these sorts of situations.
> [20:33:29] <celticminstrel> Hmm.
> [20:33:42] <JyrkiVesterinen> This is the destructor of the context class. The destructor of the list is just about to be executed, and that would clear the list for us.
"
78171580,Visual Studio: enable multi-processor compilation,jyrkive,2016-07-20 15:48:17+00:00,2016-07-20 19:13:21+00:00,{},"Pretty self-explanatory. Visual Studio can use multiple processor cores to speed up compilation, but the feature is not enabled in our VS project files.

I also disabled ""minimal rebuild"" (attempting to avoid rebuilding .cpp files when a .h file is changed) because it can't be used together with multi-processor compilation. At least in my experience, building is faster with multi-processor compilation than with minimal rebuild. (My processor is Intel Core i5-4430 [four physical cores, hyperthreading not supported]).

My guess as for why multi-processor compilation wasn't enabled already is that it probably wasn't supported by older versions of Visual Studio that Wesnoth supported until spring 2016. As of today, the oldest supported version is VS2013 that does support the feature.
"
78055202,Clean up the debug output for unit animations,CelticMinstrel,2016-07-19 21:48:11+00:00,2016-07-29 22:54:42+00:00,{},"Incorporates (and thus supercedes) PR #705
"
78012680,Update Visual Studio project files,jyrkive,2016-07-19 17:01:22+00:00,2016-07-19 18:08:55+00:00,{},"I added `name_generator_factory.hpp` and `name_generator_factory.cpp` to the Visual Studio project. While I was at it, I also removed the nonexistent file `boost_function_guarded.hpp` from the project.
"
78004573,Fix compiler warnings,GregoryLundberg,2016-07-19 16:07:49+00:00,2016-07-20 00:13:13+00:00,{},"Use a more meaningful variable name and make the usage more clear while we're snubbing the compiler warnings.
"
77987347,Map generator code cleanups,Vultraz,2016-07-19 14:35:34+00:00,2016-07-20 02:57:41+00:00,{},"General code cleanups for the map generator. No deep refactoring included.
"
77903336,TSG Bug fixes,GregoryLundberg,2016-07-19 01:00:08+00:00,2016-09-02 18:55:32+00:00,{},"This PR was updated 30AUG2016 to include all my work EXCEPT changes to TSG S05 conversation, objectives and victory paths.

I believe it is ready for final review and merging.

I have made a personal Issue to remind myself I do want to take a hard look at TSG S05 but the changes there are looking to take longer than I want, so I've updated this PR will all the rest.
"
77734769,Monte Carlo damage calculation,jyrkive,2016-07-17 12:54:36+00:00,2016-08-01 10:06:15+00:00,"{'Enhancement': 1, 'Engine': 1}","In short: I implemented the Monte Carlo damage calculation mode requested in https://wiki.wesnoth.org/NotSoEasyCoding#Add_a_new_damage_stats_calculation_mode_to_support_scenarios_with_extremely_high_stats . :+1: 

As explained in the wiki, the advantage of this mode is that its time requirement is almost fixed: the only things which can make it slower are the number of strikes and the berserk ability. I benchmarked the code using the built-in benchmark functionality (which simulates thousands of battles with hard-to-calculate units): the simulation takes, on average, four milliseconds per battle.

Also, like the wiki page requested, the Monte Carlo simulation mode is disabled by default. The player can enable it with an advanced preference.
"
77719641,Delfador's Memoirs fixes,GregoryLundberg,2016-07-16 21:14:10+00:00,2016-10-20 17:43:56+00:00,{},"This replaces PR #694 consolidating patches, there are some changes:

I have implemented a fix for Chantal dying before Delfador ever meets her in S11

There are some logic changes in how I handle Arpus and all her students being dead before activated in S12.

And I don't recruit a bowman at the end of S03 any more, but still recall one if there is one available.
"
77715993,A Tale of Two Brothers fixes,GregoryLundberg,2016-07-16 18:16:03+00:00,2016-08-19 23:44:12+00:00,{},"Same changes as PR #688 but consolidated.
"
77713282,Liberty fixes,GregoryLundberg,2016-07-16 16:20:28+00:00,2016-07-19 13:31:53+00:00,{},"Same changes as PR #687 but consolidated.
"
77666709,New features for [role],GregoryLundberg,2016-07-15 19:35:18+00:00,2016-07-30 02:53:59+00:00,{},"This builds upon [CelticMinstrel's changes](https://github.com/wesnoth/wesnoth/commit/d4b8fec953ca81531d323774a39da90445dfd3d6) from a few days ago.

On code-reading, I see he made allowances to bypass searching the map. Also, he asked about whether a [role] would re-assign the role if a better match was found. On testing, I found, it did. As a result, I added the following new attributes for the [role] tag.

```
search_map=yes|no (optional, default yes)
reassign=yes|no (optional, default yes)
```

The search_map attribute determines whether units presently on the map should be considered for the role. Note that if both search_map and search_recall_list are specified as 'no' the [else] sub-tag always executes; if there also is no [else] tag the [role] tag does nothing at all. (These might be cases for wmllint to check for, someday.)

The reassign attribute determines whether, if a unit already has the role, the role should be re-assigned to a 'better' unit. Here, 'better' means either appears earlier in the listed types, or earlier in whatever the order happens to be in the list of units matching the filters.

Consider one use case: a map with a number of Mages and one Red Mage.

1) Use [role] in the normal way to assign role=MageAdvisor to the Red Mage using types=""White Mage,Red Mage,Mage"".

2) Advance some of the Mages to Red Mage, some to White Mage.

3) Use [role] with the same type list and reassign=no. The same Red Mage will still have the role MageAdvisor without regard to whether 'better' advisors might now be available.

4) Kill the Red Mage with the role MageAdvisor

4) Use [role] with the same type list and reassign=no. Now, there is no unit with the role, so it must be assigned. One of the White Mages will be selected.
"
77602163,Hacky fix for the flickering when a screen is fully redrawn.,aginor,2016-07-15 11:34:08+00:00,2016-07-16 07:05:08+00:00,{},"The fix supresses the call to flip() while a full redrawn
is performed. The flip calls are instead deferred to
then next draw-cycle.
"
77525705,Refactored event contexts to use lists instead of vectors,Vultraz,2016-07-14 21:04:39+00:00,2016-07-18 11:50:21+00:00,{},"Refactored some code to use std::list instead of std::vector to avoid problems where the vector could be modified externally.

This is an improved version of PR #691.

Big thanks to celticminstrel and aginor.
"
77522282,Missing end-of-line showing seed on stderr,GregoryLundberg,2016-07-14 20:42:26+00:00,2016-07-14 21:01:15+00:00,{},
77403998,Delfador's Memoirs fixes,GregoryLundberg,2016-07-14 06:05:31+00:00,2016-07-16 21:14:39+00:00,{},"With Zookeeper's and CelticMinstrel's changes to remove the on-screen warning about no unit for role, and add functionality to the [role] tag, this is my cleaned-up changes to Delfador's Memoirs. It replaces my previous PR for that campaign. This patch set includes the following changes:

```
S01     No changes

S02     No changes

S03     At turn 4, it is OK if there is no unit for the line.
     ** At victory, recall or recruit a bowman to deliver the lines.

S04     No changes

S05     Remove unused variable: bought_protection
        Did TODO, added gold.ogg for sound when taking the chest of gold

S06     No changes

S07  ** Correct early completion: do not remove the generators.
        Correct [if] logic

S08     No changes

S09  ** Allow victory. Use boolean_equals for boolean values.
        Remove artifact: met_Rorthin
        Remove unused variable: Rorthin
        Undefine local macros at end of file.

S10     Use auto_recall for role
        Let the player see the gateway openning.

S11     Noted logic error. Not corrected; too much work, probably can never happen.

S12     Delfador knows what undead are, no need to ask.
     ** Niktor might die. The conversation makes no sense when he does. (Actually had this happen.)
        Scroll to the mage school instead of the bottom of the map.
     ** Arpus might die. So might all the mages. The conversation makes no sense when she does.
        No need to clear a variable which was never set
        Undefine local macros at the end of file.
     ** Loyalists and Mages should have full movement and attacks. Changed in utils/sides.

S13  ** Missing id for side. This causes the scenarion WML to dump to stderr.
        Have Chantal enter from the south-west and run directly to Kalenz.

S14  ** Move attributes from the macro to the [side] to prevent errors on stderr

S15     No changes

S16     No changes

S17     No changes

S18     Correct [if] logic
        No need to clear a variable which was never set.
        Undefine local macros at the end of file.

S19  ** Correct failure condition. Don't fail on first undead death if there are more undead available.
        On victory, it's OK to skip the line if there is no admirer to deliver it (Delfador is the sole survivor)
        Delfador speaks his line releasing the undead if there are any in the recall list, too.
     ** Loyalists should have full movement and attacks. Changed in utils/sides.
     ** Kalenz should be fully healed at start. Changed in utils/sides

S20  ** Fix cascading errors resulting from how Kalenz takes over.
     ** Chantal should be fully healed at start. Changed in utils/sides

S21     Remove unused variable: door_open
     ** Complete the new objectives to show {TURNS_RUN_OUT} and carryover

S22     No changes

S23     No changes

utils/characters
     ** Remove attributes from Kalenz' macro (see S14 and S20 for related changes)

utils/generators
     ** No need to automatically turn off generators
        Remove artifacts: random, monoliths

utils/misc
        Remove unused macro: MEMOIRS_SIDEKICK

utils/sides
     ** Loyalists and Mages should have full movement and attack when they join Delfador (S12 and S19)
        Remove artifact: kalenz_store
     ** Kalenz should be fully healed when he joins Delfador (S19)
     ** Chantal should be fully healed when she joins Kanlenz (S20)
```

*\* These are the important changes.
They either correct crashes, errors and warnings on stderr, or the conversational flow.

Each change is a separate commit, should you choose to cherry-pick.
"
77401185,bugfix: wmlxgettext '--recursive'  option and symlinks,AncientLich,2016-07-14 05:21:00+00:00,2016-07-15 09:23:55+00:00,{},"During a test I noticed that the pywmlx.autof.autoscan function could work (very) wrongly if the path contains a symlink somewhere.

The bug is now fixed, and autoscan work correctly also if the input path (with symlinks) and the real path (where symlinks are translated to actual path) differs.

This issue was strictly related to the '--recursive' option (wich makes the life easier for UMC authors :) )
"
77399795,Appropriately handle std::stoi exceptions,Vultraz,2016-07-14 04:55:55+00:00,2016-07-18 14:39:03+00:00,{},"Adds try/catch statements to most cases of std::stoi, except ones which should be safe.
"
77396193,WIP: some refactoring of event handling w/ celticminstrel,Vultraz,2016-07-14 03:50:33+00:00,2016-07-14 21:05:02+00:00,{},"Refactored some code to use std::list instead of std::vector to avoid problems where the vector could be modified externally.
"
77183630,"AOI Linaera should recruit Mages, not Elves",GregoryLundberg,2016-07-12 20:14:19+00:00,2016-07-19 13:30:53+00:00,{},"This seems more logical, plus it allows the player to recover from losing all their Mages in S06 and S07. Mages really help in S07.

Originally part of my fixes to AOI, separated since it's completely independent.

N.B. When testing you must start a fresh campaign for the changed recruitment lists to fully take effect. If you see Linaera recruiting Elves **AND** Mages, that's the reason.
"
77176104,An Orcish Incursion fixes,GregoryLundberg,2016-07-12 19:24:03+00:00,2016-07-19 08:25:14+00:00,{},"With Zookeeper's and CelticMinstrel's changes to remove the on-screen warning about no unit for role, and add functionality to the [role] tag, this is my cleaned-up changes to An Orcish Incursion. It replaces my previous PR for that campaign. This patch set includes the following changes:

```
S01     No changes

S02     No changes

S03  ** On victory, ensure a unit has the advisor role
     ** On time over, if needed, re-assign the advisor role to a unit on the board

S04  ** On enemies defeated, ensure a unit has the advisor role
     ** On die (Erlornas), if needed, re-assign the advisor role to a unit on the board
     ** On time over, ensure a unit has the advisor role

S05     No changes

S06  ** During prestart, ensure a unit has the mage role
     ** On enemies defeated, ensure a unit has the mage role

S07  ** On die (Rualsha), ensure a unit has the advisor role

utils/macros

     ** Update RECALL_ADVISOR to use the new [rule] features
     ** Add PROMOTE_ADVISOR for cases where recall/recruit is not needed
     ** Add RECALL_MAGE to ensure a unit has the mage role, prefer higher level mages
```

*\* These are the important changes. They correct the conversational flow.

This is a unified patch set since cherry-picking would be as much work as doing it by-hand.
"
77064414,A Tale of Two Brothers fixes,GregoryLundberg,2016-07-12 05:45:53+00:00,2016-07-16 18:16:28+00:00,{},"With Zookeeper's and CelticMinstrel's changes to remove the on-screen warning about no unit for role, and add functionality to the [role] tag, this is my cleaned-up changes to A Tale of Two Brothers. It replaces my previous PR for this campaign. This patch set includes the following changes:

```
S01  ** For the Mercenary role:
            Do not assign the Mercenary role so early
            Allow advanced units to the role, but not Arvith
            Use the new [role] features:
                Use search_recall_list=no to document on-board only (recall list is empty)
                Use [role][else] to recruit a replacement Horseman if none live at the time

     ** For the Reporter role:
            Allow advanced units to the role, but not Arvith
            Use the new [role] features:
                Use search_recall_list=no to document on-board only (recall list is empty)
                Use [role][else] to recruit a replacement Spearman if none live at victory

S02  ** For the speaker role:
            Use a local macro for this role.
            Allow advanced units to the role, but no Arvith
            Use the new [role] features:
                Use auto_recall=yes to ensure a unit is on-board
                Use [role][else] to recruit a replacement Horseman if none live at victory

S03  ** Fix a typo which caused the second set of guards to appear too early
        Clear variables when no longer needed to prevent artifacts.

S04     No changes

S05     No changes
```

 *\* These are the important changes.
    They either correct implementation errors, or the conversational flow.

The S03 patches can be cherry-picked. The S01 and S02 main patches may depend upon earlier changes in this patch set.
"
77052062,Liberty fixes,GregoryLundberg,2016-07-12 02:20:30+00:00,2016-07-16 16:23:14+00:00,{},"With Zookeeper's and CelticMinstrel's changes to remove the on-screen warning about no unit for role, and add functionality to the [role] tag, this is my cleaned-up changes to Liberty. It replaces my previous PR for this campaign. This patch set includes the following changes:

```
S01     Use positive logic: [if] must have [then]
        Remove the artifact variable 'any_villagers_died'

S02  ** Use a consistent type list for the Advisor role
     ** Baldras cannot be the Advisor
     ** Pass the Advisor role along to S03 when converting unit types

S03  ** No need to search for the Advisor, S02 set it.
     ** Use role= for roles in [message], not speaker=

S04  ** Use a consistent type list for the Advisor role
     ** Neither Harper nor Baldras may be the Advisor
        Remove the artifact variable 'temp'
        Use auto_recall for Advisor [role]

S05  ** Misplaced attribute, move 'ai_algorithm=idle_ai' inside [ai] tag

S06     No changes

S07     Use positive logic: [if] must have [then]
        Remove the artifact variable 'stored_Archarel'

S08  ** Baldras cannot be the 'farseer', this makes the converastion irrational
     ** No manifest constant 'FOREVER', use 99999 intead
        Remove unused variables 'harper_dead' and 'dommel_dead'
        Remove the artifact variables 'Helicrom_status' and 'supports_destroyed'

utils/utils.cfg
        Remove unused macros 'CHG_TYPE' and 'OBJ_HOLY_ANKH'
```

 *\* These are the important changes.
    They either correct crashes, errors and warnings on stderr, or the conversational flow.

Each change is a separate commit, should you choose to cherry-pick.
"
76986922,Add .vscode to .gitignore,GregoryLundberg,2016-07-11 16:52:28+00:00,2016-07-11 18:11:28+00:00,{},"Add .vscode to .gitignore
"
76875752,Remove Horse_Archer from Legend_of_Wesmere,PoignardAzur,2016-07-10 15:16:24+00:00,2016-07-10 22:01:23+00:00,{},"As per issue #23883 on gna, Horse_Archer was added for experimental purposes and never removed. This commit removes the Horse_Archer.cfg file, and all occurences of ""Horse_Archer"" in the Legend_of_Wesmere directory.
"
76859459,Support loading translations from PO files,CelticMinstrel,2016-07-09 23:08:52+00:00,2016-11-18 17:51:30+00:00,{},"This makes things easier for addon campaigns to ship portable translations, since ~~the MO format is platform-dependent (although it should be compatible on all main platforms), and as I understand would eliminate the need for ""wescamp""~~ MO files require the gettext tools to create.

~~Before merging, steps need to be taken to ensure that scons and CMake builds correctly result in a _translations_ directory containing po files, instead of mo files. In the XCode project I did this with rsync; scons and CMake could perhaps make do with simply renaming the _po_ directory in the repo to _translations_.~~
"
76835246,AToTB Fix errors,GregoryLundberg,2016-07-09 02:40:24+00:00,2016-07-12 05:47:14+00:00,{},"S01 ""Rooting Out a Mage""

On Mordok's last breath, a speaking part goes to one of the units on the board. Some of the units are not considered, nor are unit advancements. In addition, there may be no units other than our leader, Arvith. These errors result in the WML error ""no unit for role"" to appear on-screen. Improve the storyline a bit by not selecting for the role but, instead, creating a loyal spearman to run in from the north to deliver this line, avoiding the entire mess.

On turn 10 a mercenary horseman delivers a line. Originally, this role was assigned at the start. If that unit died, the line would be omitted, which interrupts the flow of the script. Instead, assign the role when the line is neeeded and, if no horsement survive to deliver the role, give the player a free loyal horseman to deliver the line. Have the horseman come running in from the south-east corner.

The above to changes create new translatable strings for the unit names. Since these should rarely actually be translated, this should not create an issue. For both, the units run into the scene and move to be adjacent to our leader, Arvith.

S02 ""The Chase""

On the last breath of the Dark Adept, there are speaking lines for a unit. If these are skipped the script makes no sense. At the beginning a speaker was assigned. If that speaker has died, another unit on the board is assigned the role. But, if there are no other units, the WML error ""no unit for role"" appears on the screen. Fix this by bringing in a loyal named spearman to deliver the lines. Try from the recall list and, if none are there, create a new one. This new speaker runs in from the right side of the board to join the leader.

In relation to this change, sumplified the WML a bit as well by removing an unneeded [NOT] tag.

This change creates a new translable string for the new loyal spearman. Again, this should not be an issue.
"
76780555,"HttT Fix errors and warnings, and misc. improvements",GregoryLundberg,2016-07-08 16:40:14+00:00,2016-08-07 06:07:06+00:00,{},"[REWRITE]

This is a result of a careful code reading and walk-through in an attempt to find and fix as many issues as possible.

Items marked 'Fix bug' are the most important as they correct obvious errors.

Items marked 'Workaround' avoid an error in the game engine and should be reversed when corrected.

All other items are discretionary. They represent only my opinion of an improvement. Most notable of these is the addition of a sub-quest for to assist the wose in scenario 20b (""Underground Channels"").
## 

To shorten this stream, I have gone through and deleted a bunch of my comments which have been addressed elsewhere or are no longer germane. 
"
76095620,"[option]message= deprecated, use label=",GregoryLundberg,2016-07-03 18:46:15+00:00,2016-07-05 18:14:55+00:00,{},"According to the Wiki, since 1.13.2 message= is an alias for label=.

Using message= provokes a warning about it being deprecated.

This replaces message= with label= in the entire mainline (where it had not already been changed).
"
76092943,DM S03 Fix WML unit not found for role,GregoryLundberg,2016-07-03 16:33:46+00:00,2016-07-14 06:07:32+00:00,{},"Turn 4: simply skip the message if there is no bowman

Victory: Use the same bowman as turn 4, promote one if not present, recruit one if none present at all.

AOI and Liberty used macros. But only needed once, here, so coded inline.
"
76085784,Liberty Fix WML unit not found for role,GregoryLundberg,2016-07-03 10:26:28+00:00,2016-07-12 02:24:51+00:00,{},"In 1.13.4+dev I noted WML errors in S02 through S04 when attempting to locate a unit for use as an advisor.

I moved the macros over from AOI for locating, promoting and recalling an advisor. For this campaign, the unit types dynamically change; so I added a paramter which specifies the unit type to recruit if no suitable unit could be found. For this, I chose Thug and Thug_Peasant.

As with AOI, these macros select the eldest unit from the board or, of none exist there, from the recall list. This is a slight change from the original: my change allows the Footpad_Peasant to be an advisor, the original omitted this unit as a possibility. I did this so I could simply select a unit which was not one of the two heros and not worry about the specific unit types.

I also changed ""Advisor"" to ""advisor"" to align with AOI.

In S03 a [message] used ""speaker=Advisor"" and never appeared as a result. I changes this to ""role=advisor"" to have the message appear now that there is reliably an advisor available to deliver the message.

Finally, while testing, I ran into a but in 1.13.4+dev having to do with string-to-integer conversion. This affected S08, only. I changed the word 'FOREVER' to specify '99' turns, instead, to work around this bug. Since the scenario should end on turn 48 (or earlier), that is effectively the same. I can add a revert patch to this PR if a fix appears in the master; but it should not matter if this is never reverted.
"
76068526,AOI Fix WML unit not found for role,GregoryLundberg,2016-07-02 16:13:36+00:00,2016-07-12 19:26:43+00:00,{},"My original goal was simply to suggest Linaera should be able to recruit Mage instead of using Erlornas' recruit list. But, in 1.13.4+dev, I hit some bugs which were not in 1.12. So, this is an omnibus which fixes those bugs.

One of those WML bugs was in S06 on victory where Linaera's student wants to speak but there is no surviving student. The fix for the advisor was to promote, recall or recruit. So that was what I did here. But, if Linaera can recruit here, why not let her recruit all the time? So fixing the bugs seems to lead to my original intention of allowing the player to use Linaera to recruit Mages, anyway.

1) In S05, using 1.13.4+dev, [teleport] for Linaera silently fails. Use [modify_unit] instead as a workaround. Added a TODO comment as a reminder to revert this. But it may be better if all four units (Linaera and her three student Mages) used the teleport arrival animation .. simultaneously, if possible .. I just don't know how to do this.

2) Traditionally, Linaera uses Erlornas' recruit list. Give each leader their own recruit list. Allow Linaera to recruit only Mage

3) Fix the WML unit not found for role errors when the advisor recalled (or recruited) at the beginning of the scenario does not make it to the end. Promote a surviving unit as the new advisor. If no units survive, recall or recruit one.

4) In cases where the advisor was not used, messages at the end of a scenario would be silently dropped. Change those messages to the advisor and promote one, if needed.

5) In S01, time over event, Erlornas would always be the eldest surviving elf. The intent appears to be that another elf deliver the message of hopelessness. So change this to the advisor. This aligns the time over here to be more like that in other scenarios, where used.
"
76066703,Modernize the MD5 hash calculation API,jyrkive,2016-07-02 14:47:46+00:00,2016-07-10 11:17:57+00:00,{},"I modernized the MD5 calculation API to use `std::array` and `std::vector` instead of raw C arrays. This way, in particular, the length of the MD5 hash is shown right in the function signatures, and it's no longer possible to accidentally pass an incorrect length to `MD5::update()`.

The internal API of the MD5 class I left intact to the extent I could. I needed to add the `const` qualifier to a couple of function parameters, though.
"
75904274,AOI Workaround [teleport] not working.,GregoryLundberg,2016-06-30 23:00:11+00:00,2016-07-01 00:15:33+00:00,{},"Just move Linaera instead.
"
75884812,AOI: Fix WML no unit for role errors,GregoryLundberg,2016-06-30 20:26:03+00:00,2016-07-01 23:38:40+00:00,{},"On playing AOI, I see WML errors on screen for several scenarios.

In most cases, these occur at the beginning of the scenario, where message should be displayed for an 'adviser' and no adviser can be found. For instance, if, at the end of the previous scenario, the recall list was empty an no units remain alive. In these cases, I replace the 'adviser' role, simply attributing the message to the eldest unit available.

A similar message appears in S06 where no apprentice mage can be recalled alongside Lenaera. Here, the fix is to simply avoid attempting the recall.

In fixing these errors, I noted a number of other edge conditions where, for example, Erlornas is delivering his half of a conversation but no unit exists to deliver the other half. In these cases, I suppressed Erlornas' half, as well.

This left some end-of-scenario conditions with no viable messages. Some scenarios simple omitted any messages on some end conditions. For these, I added narration so the player does not simply go from ending a turn to success or failure.
"
75223744,Mute the music when the game loses focus,jyrkive,2016-06-26 07:47:39+00:00,2016-07-30 05:49:21+00:00,{},"When I play any game, I tend to take a break once in a while: Alt-Tab out of the game and listen to some music for a while.

For that reason, it annoys me when a game continues to play music in background. In such a situation I either have to quit the game or mute it using the Windows volume mixer.

Wesnoth plays music in background, too.

This commit implements automatic muting of music on focus loss, and restarting it when Wesnoth regains focus.
"
75205909,Fix bug #23712: Mage of Light halo not drawing correctly,jyrkive,2016-06-25 14:29:35+00:00,2016-06-28 07:33:45+00:00,{},"The bug was caused by overly aggressive performance optimizations.

When a unit is moving, it's replaced with a temporary unit. If the moving unit is a Mage of Light, its halo is recreated. The recreated halo is originally placed in the top-left corner of the screen (exactly the position where it actually stayed in practice).

The game attempts to correct the position of the halo on the next frame by calling `halo::manager::set_location()`, that eventually calls `halo_impl::effect::set_location()`. Since the overlayed hexes (`overlayed_hexes_`) aren't known after moving the halo, `set_location()` clears the list of overlayed hexes. The idea is that the overlayed hexes will be determined when the halo is drawn next time, in `halo_impl::effect::render()`.

`Halo_impl::render()` only draws invalidated haloes.

Haloes are invalidated in `halo_impl::unrender()`. It only invalidates haloes which overlay invalidated hexes.

But the list of overlayed hexes is empty because the halo hasn't been drawn in the correct position yet. Thus, the halo won't be invalidated, or later drawn. The result is a kind of deadlock: the halo is never drawn in the correct position because it's never invalidated, and it's never invalidated because it's never drawn in the correct position.

My new code detects the situation in `halo_impl::unrender()` and invalidates haloes whose positions are not known.
"
75084379,Fix build with Visual Studio 2013,jyrkive,2016-06-24 09:04:36+00:00,2016-06-24 11:18:32+00:00,{},"I got these compiler errors when trying to build Wesnoth:

> 4>i:\battle for wesnoth\wesnoth\src\utils\context_free_grammar_generator.hpp(37): error C2061: syntax error : identifier 'uint32_t'
> 4>....\src\utils\context_free_grammar_generator.cpp(131): error C2511: 'std::string context_free_grammar_generator::print_nonterminal(const std::string &,uint32_t *,short) const' : overloaded member function not found in 'context_free_grammar_generator'
> 4>          i:\battle for wesnoth\wesnoth\src\utils\context_free_grammar_generator.hpp(25) : see declaration of 'context_free_grammar_generator'
> 4>....\src\utils\context_free_grammar_generator.cpp(133): error C2228: left of '.find' must have class/struct/union
> 4>....\src\utils\context_free_grammar_generator.cpp(134): error C2228: left of '.end' must have class/struct/union
> 4>....\src\utils\context_free_grammar_generator.cpp(148): error C2660: 'context_free_grammar_generator::print_nonterminal' : function does not take 3 arguments
> 4>....\src\utils\context_free_grammar_generator.cpp(159): error C2660: 'context_free_grammar_generator::print_nonterminal' : function does not take 3 arguments

To me, it looks like uint32_t is a different type in the header and the implementation file, and thus the compiler complains that the `print_nonterminal()` function (or more accurately, this particular overload) hasn't been declared.

Adding `#include <cstdint>` to the header fixes the issue.

I am using Visual Studio 2013.
"
74344418,Port campaignd to asio,loonycyborg,2016-06-18 18:45:42+00:00,2016-09-15 13:36:13+00:00,{},"campaignd, the addon server is the last part of wesnoth that needs porting, merging this pr will drop SDL_net as dependency. This port is aiming to keep full functionality of campaignd.
"
73995716,[game_config]: new keys for logo,dorng,2016-06-15 22:34:24+00:00,2016-07-20 03:14:47+00:00,{},"remove hardcoded path for logo image
add 'game_logo' & 'game_logo_background' keys in [game_config]
this allows [core] authors to define their own game logo to appear on the title screen
this does not (yet) affect the loadscreen
"
73492615,terminal colored text extended to windows,AncientLich,2016-06-12 10:14:10+00:00,2016-06-12 16:26:02+00:00,{},"Thanks to Elvish Hunter, wmlxgettext now have colored text not only on posix system, but also on windows (I'm speaking about the text that appears on terminal).
I did some little changes from that original code.
"
72985289,MP Random map (Desert): Use new desert mountains.,sigurdfdragon,2016-06-08 04:30:48+00:00,2016-06-08 05:43:55+00:00,{},"Replaces the Md with Mdd.
"
72943705,"wmllint: add missing instructions for ""#wmllint: skip-side"".",sigurdfdragon,2016-06-07 20:35:36+00:00,2016-06-07 22:16:16+00:00,{},"Thanks to Elvish_Hunter for telling me what it supposed to do.
"
72661223,Added new checkbox to multiplayer game configure dialog to allow only registered users to join the game,pubudug,2016-06-06 06:26:39+00:00,2016-07-12 12:33:25+00:00,{},"Implemented ""Make it possible to host a game which only registered players are allowed to join"" from https://wiki.wesnoth.org/Easycoding
"
72433950,Htt t journey 19c 20b,sigurdfdragon,2016-06-02 23:29:56+00:00,2016-06-08 05:40:14+00:00,{},"Adds journey tracks for the Cliffs of Thoria / Underground Channels path.
"
72416333,Port the client code to boost asio.,gfgtdf,2016-06-02 20:58:07+00:00,2016-06-05 18:14:05+00:00,{},"This has still some issues:
1) It makes the gui2 lobby travis test fail beascue it cannot find the remote server.
2) when there are multiple documents (configs) in the send queue and it finshed to send a document, then sending the next document will be delayed until the next poll()/send_data()/receive_data() call.
3) config docuemnts ar enow parded in the main thread instead of the netowrk orker threads

1) Is sureley not a blocker since the problemaic travis test can just be disabled in the worst case. I dont consider 3) a blocker eigher since it had no noticable effect when i tested this. 2) could be annying in theory in some situations, but casues no prblems when i tested my testings.

this pr also contains some commits unrelted to this issue, like a fix for http://gna.org/bugs/?24718 and some code cleanups.
"
72391725,MP - Aethermaw: Fix image not found errors.,sigurdfdragon,2016-06-02 18:08:44+00:00,2016-06-02 18:34:10+00:00,{},"Due to Revenant & Skeleton Archer animations moved to subdirectories.
"
71677389,fix [transform_unit],dorng,2016-05-27 08:28:52+00:00,2016-05-27 13:16:00+00:00,{},
71310699,Improvements in the name and map generators,spixi,2016-05-24 23:43:51+00:00,2016-07-18 05:12:49+00:00,{},"This commit contains several improvements in the name generator and map generator:
- factory class to simplify creation of name generators and removing dependencies from concrete name generator classes
- the `is_valid()` method has been replaced by an exception, because that is more meaningful than using a shared pointer to delete the object, if it is not valid
- the context-free grammar based name generator now supports variables
- the map generator now uses the new features of the cfg name generator
- the redundant wml tag `[village_naming]` has been removed
- village and terrain generating rules have been ported from`/data/english.cfg` to `/data/core/macros/names.cfg`
"
70950965,"Added new functions sgn(), int() and frac()",spixi,2016-05-21 14:33:51+00:00,2016-06-07 02:15:07+00:00,{},"This adds some new useful functions to the Wesnoth Formula Language.

Finally, I know how branches work ...
"
70948209,Make the multiplayer faction accessible via Lua and simplified Hornshark Island,spixi,2016-05-21 12:21:44+00:00,2016-05-22 19:08:52+00:00,{},"Successor of #658

I hope, I finally have it.

The attribute _faction_ was already used to set the default faction in a scenario. I think, it would be save to override it, however. So here it is.
"
70937051,Make the multiplayer faction accessible via Lua and simplified Hornshark,spixi,2016-05-21 02:12:22+00:00,2016-05-21 12:21:55+00:00,{},"Successor of #657, now squashed into one commit (thanks to git reset, git diff and git apply)
"
70922070,Make the multiplayer faction accessible via Lua and simplified Hornshark,spixi,2016-05-20 21:49:40+00:00,2016-05-21 02:12:41+00:00,{},"Now the same thing like in #643, but instead of checking against the translatable string, we check against the id.
"
69960720,Fix bug #24234: Add Boost 1.60.0 support to unit tests,irydacea,2016-05-13 08:37:37+00:00,2016-05-13 20:27:09+00:00,"{'Bug': 1, 'Backport': 1}","This backports Aginor's commit ff29581baa74dbc6ce1923e1352f4fd6d423a67d from master to 1.12 to solve compiler errors found when trying to build Wesnoth 1.12's unit tests against Boost 1.60.
"
69416005,HttT S10: Add changlog entries for objectives clarification.,sigurdfdragon,2016-05-09 21:43:09+00:00,2016-05-09 21:48:43+00:00,{},
69346730,Improve the control reassignment dialog when a player leaves,ln-zookeeper,2016-05-09 13:41:35+00:00,2016-05-22 20:58:04+00:00,{},"This moves the options for giving control to an ally/observer to the top of the list, labels them more descriptively, and prevents the dialog from appearing during linger mode if there is no next scenario.

Old:
Replace with AI
Replace with local player
Set side to idle
Save and abort game
Replace with (observer1)
Replace with (observer2)
Replace with (ally1)
Replace with (ally2)

New:
Give control to their ally (ally1)
Give control to their ally (ally2)
Give control to observer (observer1)
Give control to observer (observer2)
Replace with AI
Replace with local player
Set side to idle
Save and abort game
"
68726585,wmlxgettext: added support for _ << translatable string >> on WML,AncientLich,2016-05-03 15:38:55+00:00,2016-06-06 01:55:58+00:00,{},"This commit contains also some changes in comments made by aquileia.
"
67996848,HttT S19c undead removal,sigurdfdragon,2016-04-27 04:56:47+00:00,2016-05-09 21:30:34+00:00,{},"This removes the undead (and their xp exploit) from HttT: Cliffs of Thoria, and changes dialog, wml, and the .map to compensate.

Here are screenshots of the map changes in the map editor:

Before:
![screenshot_002](https://cloud.githubusercontent.com/assets/4020484/14842152/8f6c6f0c-0c12-11e6-82a1-d237acbdd119.png)

After:
![screenshot_004](https://cloud.githubusercontent.com/assets/4020484/14842163/9d935672-0c12-11e6-8a72-3d679b7b5d9a.png)
"
66780872,Add color=value to [message],Pentarctagon,2016-04-17 20:50:21+00:00,2016-06-06 16:50:49+00:00,{},"Made [this](https://gna.org/bugs/?24576) request, then realized I could do it myself.
"
66693016,gui2: new logging dialog,ScegfOd,2016-04-15 19:30:59+00:00,2016-06-06 16:48:45+00:00,{},"I kept getting weird errors when trying to rebase the old fork (probably related to me not using the git commandline from the start)
SO I tried doing things right this time around and there's now only one commit it seems...

sorry about any confusion ^^;;

On the bright side, I think I'll be able to use the terminal git from here on out :D
Also: everything is squashed into a single not-badly-named commit :D
"
66683516,Name generator tweaks + Lua API,CelticMinstrel,2016-04-15 18:19:09+00:00,2016-04-15 19:52:40+00:00,{},"This is a PR primarily to ensure that the scons build works before merging to master.
"
66408526,HttT s10 fixes,sigurdfdragon,2016-04-13 23:32:30+00:00,2016-04-14 08:43:06+00:00,{},"@ln-zookeeper

Let me know if these are ok, or if other changes should be added.
When it's good, I'll add changelog entries.
Also, should gryphon behavior be changed? Should 'defeat enemy leader' be 'defeat Ashivere's forces', or is the contrast between my proposed objective change sufficient?
"
66260933,Allow explicit use of any CC license for UMC assets,pydsigner,2016-04-13 03:28:04+00:00,2017-05-13 05:21:18+00:00,"{'Add-ons': 1, 'High Priority': 1}","The mandatory use of the GPL for all things Wesnoth has long been a sticky point for contributors, especially those not contributing to core (i.e. creating UMC add-ons).  [Here](https://forums.wesnoth.org/viewtopic.php?f=2&t=42966&p=588491#p588491) are a few [examples](https://forums.wesnoth.org/viewtopic.php?f=6&t=42975&p=588173#p588173) of forum [discussion](https://forums.wesnoth.org/viewtopic.php?f=14&t=41454&p=579487#p579340), and [an explanation](http://shadowm.ai0867.net/blog/archives/54-Original-music-in-Wesnoth-content.html) of why the current state of affairs is not ideal.

There's been much talk about addressing the issue, but no action, and the only actual planned solution is to allow use of Creative Commons licensing, which still forces content creators to give up some rights beyond simple redistribution of the unified work. Some authors wishing to use non-GPL resources have gone so far as to [attempt to disanull the upload agreement by asserting licensing terms within the add-on itself](https://github.com/wescamp/A_New_Order-1.10/blob/master/A_New_Order/LICENSE.important.txt).

This PR seeks only to allow content authors to not agree to sign away all their work under the GPL, instead only requiring that they allow distribution through the official add-on server, while still maintaining current behavior for all content not explicitly licensed. Changing the default license is far beyond the scope of this PR. Any discussion of the exact text changes is welcomed.
"
65939752,"""Easy Coding"" GUI menu for activating loggers",ScegfOd,2016-04-11 04:43:06+00:00,2016-04-15 19:32:19+00:00,{},"here is the stuff to make a dialog that can activate logging from a gui menu (in advanced preferences)
At the moment it only prints to the command line that launched wesnoth, but I figured that would be fine for now.
"
65758392,Make wesnothd use asio network api instead of SDL_net,loonycyborg,2016-04-08 09:21:09+00:00,2016-05-31 17:49:08+00:00,{},"This removes SDL and SDL_net dependency from wesnothd. This is part of general plan to drop SDL_net, though this PR is only about wesnothd, the multiplayer server.

Reasons for dropping SDL_net are:
- Supporting  IPv6
- Removing dependency on SDL from server components
- Doing networking using proper asynchronous os primitives, which allows avoiding the use of threads and making code less hackish overall.
"
65553308,Unit name generator using context-free grammar,Dugy,2016-04-06 23:35:28+00:00,2016-04-11 21:22:55+00:00,{},"Added a new way to generate unit names, using rules of a context-free grammar. It is much more configurable than the current system, so it's possible to prevent extremely long or otherwise funny and awkward names. If it can't find its entries in the race definition, it falls back to the old Markov chains.
"
65201280,Added faction_name field for unit table in Lua API,spixi,2016-04-04 19:43:31+00:00,2016-05-20 21:51:34+00:00,{},"Hi there,

I added a possibility to access the multiplayer faction via Lua. This makes faction-based scenarios like Hornshark Island easier to determine the faction of a side.
"
65199479,Ported [set_variable] to Lua,Elvish-Hunter,2016-04-04 19:30:18+00:00,2016-06-06 16:47:15+00:00,{},"This PR converts the WML tag [set_variable] from C++ to Lua, just like it has been done for several other WMLAction tags.
"
64896454,Code cleanup on engine initialization functions,Ershany,2016-04-01 05:13:22+00:00,2016-04-10 00:01:25+00:00,{},"Shuffled around the structure to of some of the functions in engine initialization, to increase readability and made the function contain less lines of code.
"
64858048,typo in log.hpp,ScegfOd,2016-03-31 21:00:39+00:00,2016-04-01 12:11:46+00:00,{},"fixed a typo:
ourput -> output
"
64581566,New default game typeface: Lato,ancestral,2016-03-30 07:18:23+00:00,2016-04-06 17:45:12+00:00,{},"After discussion amongst developers in #wesnoth-dev on IRC, we are considering Lato to be the new game typeface.

This has several benefts over Deja Vu Sans:
- Having been created from scratch, Lato stylistically is more interesting and flavorful than Deja Vu Sans, which is a modification from Bitstream's venerable Vera Sans family.
- Lato is offered in 9 weights, which allows us flexibility with growth in the future.
- Lato is receiving periodic updates.
- Although Lato does not include quite as many supported languages, it still notably offers over 100 Latin languages, over 50 Cyrillic languages and Greek. (Aside from CJK, every language represented in Wesnoth with over 50% translated strings is still directly supported.)

At first, while we work out the details with GUI1 sizing and the in-game theme, this will be a GUI2 specific feature. _You may notice text appearing slightly larger._ This is intentional, as it also serves to address legibility and complaints of the interface being too small.

Please test this out on your machine. If it does not look or behave well, please take a screenshot and tell me what system you’re using.
"
64577793,New game font: Lato ,ancestral,2016-03-30 06:31:50+00:00,2016-03-30 06:47:04+00:00,{},"Lato is now the new game font. Initially, this will be limited to GUI2, but as tech is updated in the project, we hope to make Lato the new default everywhere in the game.
"
64127706,Fix cmake reference to make_enum.cpp.,rcorre,2016-03-25 03:30:47+00:00,2016-03-25 04:01:29+00:00,{},"make_enum.cpp was moved to utils/make_enum.cpp, and src/CMakeLists.txt
wasn't updated.
"
64001634,VC Project Update,Wedge009,2016-03-24 08:14:31+00:00,2016-03-24 08:46:28+00:00,{},"Another update for VC project files including AI file movements and removing user-specific files.
"
63841388,VC Project Update,Wedge009,2016-03-23 07:26:41+00:00,2016-03-23 07:51:14+00:00,{},"Remove deleted files and move map directory into its own filter.
"
63562927,VC Project Update,Wedge009,2016-03-21 13:25:14+00:00,2016-03-21 13:29:41+00:00,{},"Properly update VC9 project file after CelticMinstrel's moving of files. Put those files into appropriate filters and ensure their compiled objects are placed in appropriate directories.
"
63494860,Remove GPLv3 translations and use standard GPLv2 instead (bug #24519),Wedge009,2016-03-20 13:03:15+00:00,2016-03-23 09:09:33+00:00,{},"See https://gna.org/bugs/?24519 for details. Essentially GPLv3 should not be used even if it has translations not available for GPLv2.
"
63469716,VC Project Update,Wedge009,2016-03-19 14:58:46+00:00,2016-03-19 15:26:59+00:00,{},"Fix broken VC build.
"
63319251,Add preference for WASD scrolling.,rcorre,2016-03-18 02:11:11+00:00,2016-04-11 05:16:58+00:00,{},"I'd prefer to scroll the map with WASD instead of the arrow keys, yet there was no option to configure this.
At first I thought it would make sense in the hotkey menu, but the scrolling keys aren't really handled the same way as hotkeys (which only check for a press and not a release).

A disadvantage of this is that it won't check if WASD conflicts with existing bindings the way hotkey mappings do. It also doesn't allow mapping arbitrary keys, though I figure WASD and arrow keys are the most likely candidates.

Let me know what you think, I could try to implement as hotkeys, hack it into the hotkey menu without actually creating hotkeys, or just check if existing hotkeys conflict with WASD.
"
63203680,Ported hexometer from Bash to Python 3,Elvish-Hunter,2016-03-17 10:48:53+00:00,2016-03-20 10:12:44+00:00,{},"This PR converts the `hexometer` script (whose purpose is to report if an image has pixels that won't fit inside a hex) from Bash to Python 3.
While from my tests the output stays the same, there are some important effects to keep in consideration:
- The script is now _much_ faster. A run on the `data/core/images/units/elves-wood` directory takes on my system about 5,163 seconds with the Bash version, but only 0.562 seconds with the Python version.
- It can now run on Windows, while the Bash version cannot (except maybe when installing Cygwin).
- Since Python has no image processing facilities included in its standard library, it's required to install the Pillow library (which is the successor of the PIL library).
- The mask image is now embedded in the script as a base64 string - this point can be reverted, but it guarantees that there is always at least one mask available.
"
63140412,Easier portrait variants,CelticMinstrel,2016-03-16 21:39:59+00:00,2016-05-25 04:30:04+00:00,{},"It's common in campaigns for major characters to have several different portraits, eg for different emotions. Often these are named things like ""leader.png"", ""leader-mad.png"", etc. This is an idea to make it simpler to select a portrait variant without needing to repeat the entire file path.

Here's how it works: Suppose the base portrait is ""leader.png"", and you want the ""mad"" variant which is at ""leader-mad.png"". You write your message tag like this:

``` wml
[message]
   speaker=leader
   image_variant=mad
   message=_""I'm really mad right now!""
[/message]
```

And the `[message]` tag automatically inserts the string ""-mad"" right before the file extension. (It currently assumes the file extension is "".png"".)

But what if you have a similar situation, but the base portrait is called ""leader-neutral.png""? This is easy too. Instead of setting `profile=leader-neutral.png`, you set `profile=leader-%neutral%.png`, and write your message tag just like above. The string between the two percent signs will be replaced with the image variant, resulting in ""leader-mad.png"". If no image variant is specified, the percent signs are removed.
"
62787968,Several location-related Lua things,CelticMinstrel,2016-03-14 17:41:16+00:00,2016-03-16 19:50:12+00:00,{},"- luaW_\* utility functions for dealing with locations
- wesnoth.select_hex() -> wesnoth::select_unit(), because it turns out this does nothing useful if there's no unit (though this PR does not prevent it from being called without a unit)
- additional argument to wesnoth.match_unit(), for asking ""will it match if it moves here""

This is a PR instead of being pushed directly because I'm not 100% sure that the first change broke nothing, so I'm hoping that if it did, it's something Travis will catch. (The most likely areas for breakage would be in the Lua pathfinding API, if anyone wants to test themselves.)
"
62654501,Remove sdl 1.2,aginor,2016-03-12 22:32:13+00:00,2016-03-12 23:36:39+00:00,{},"This removes SDL 1.2 support from Wesnoth. This leaves all SDL2 code in place, having removed all #ifs.
"
62631166,Avoid tstring/string conflict error in team_info.,rcorre,2016-03-12 04:38:34+00:00,2016-03-12 13:16:00+00:00,{},"Declare team_name as a std::string rather than a tstring to avoid a
compilation error when used in a ternary expression with another
std:string.

Translate by calling .str() after reading from the config file.

I'm a new contributor here and ran into this as soon as I tried to build. Let me know if this is the correct approach -- the contributor guide had some warnings with regards to the proper handling of `std::string` vs `t_string`.

The error was

```
In file included from src/actions/../display.hpp:57:0,
                 from src/actions/../game_display.hpp:28,
                 from src/actions/attack.cpp:29:
src/actions/../team.hpp: In member function ‘const string& team::side_name() const’:
src/actions/../team.hpp:306:72: error: operands to ?: have different types ‘const string {aka const std::__cxx11::basic_string<char>}’ and ‘const t_string’
  const std::string& side_name() const { return info_.side_name.empty() ? info_.current_player : info_.side_name; }
                                                                        ^
src/actions/../team.hpp:306:72: note:   and each type can be converted to the other

```
"
62349974,Add files missing from VC project,Wedge009,2016-03-10 07:32:20+00:00,2016-03-10 07:33:25+00:00,{},
62124764,Many new features in the formula engine,CelticMinstrel,2016-03-08 19:43:38+00:00,2016-03-18 16:52:05+00:00,{},"This adds several new features to the [Wesnoth Formula Language](https://wiki.wesnoth.org/Wesnoth_Formula_Language) and engine. See the link for a fairly detailed coverage of the state of the language prior to this PR.

This is not entirely finished, but I'd like to hear feedback on the general content of the PR. There are a couple of things that I'm uncertain of - for example, is the hypot() function really worthwhile? (Especially since it's limited to two arguments.) Does string interpolation really need to support entire subformulas? (The main use-case I can think of for this is conditional interpolation.) On the other hand, I'd also be open to ideas of other things to add.
- The formula engine had an undocumented syntax which allowed arbitrary formulas to be interpolated into strings - `'some string with {interpolated_formula}'`. Since the `{}` causes problems with the WML preprocessor, I've changed this to use `[]` instead. In addition, the same syntax is now used for three escape sequences - `[']` expands to a single quote, `[]` expands to an open bracket, and `[.]` expands to a close bracket. (See the commit for some alternative escape syntaxes if you think this sounds weird - I may change it.)
- Four new operators have been added. The `..` operator performs string or list concatenation (there was already an undocumented function for string concatenation, but I didn't know about it when I added the operator, and I think the operator is more convenient anyway). The `~` operator creates a range - a list of consecutive numbers. The `xor` operator does exactly what it says, but can also be thought of as a boolean `!=`. Similarly, the `xnor` operator can be thought of as a boolean `=`.
- In order to emphasize that the Wesnoth Formula Language and FormulaAI are two different things, I've changed the `fai` and `faiend` keywords to `wfl` and `wflend`. (The old keywords are still silently supported.)
- Lists can now be indexed by a list. This functions as a ""select"" mechanism, returning a list containing only those elements of the list whose index is listed in the indexing list. In other words, `[1,2,3,4,5][ [1,3] ]` returns `[2,4]`. I'm not sure how useful this is in the general case, but in conjunction with the range operator it allows for list slicing - eg `[1,2,3,4,5,6][2~4]` returns `[3,4]`.
- New math functions: tan(), asin(), acos(), atan(), sqrt(), cbrt(), root(), log(), exp(), hypot(), pi() - all return null in the event of a NaN error
- New string functions: reverse(), find_string(), replace()
- New list functions: tail(), union(), intersection(), set_diff(), symmetric_diff(), zip() - the four set operations also work on maps
- New higher-order functions: take_while()
- Changes to existing functions: head() takes optional size argument; reduce() takes an optional initial accumulator; substring() function allows negative size to count backwards from offset
- The dice operator now uses the synced RNG whenever possible. I haven't tested that this truly eliminates out-of-sync errors, though.
- Decimals can now implicitly convert to integers, though in practice this will probably rarely happen since most things that accept both have special cases for each.
- abs() and the modulus operator now work on decimal values
- Logical `and` and `or` operators now short-circuit
- Function definitions can now be used outside of FormulaAI code.

Some functions that I considered but rejected are:
- replicate - can now be implemented as `def replicate(val, times) reduce(map(1~times, val), a .. b)`
- replace_string taking a string to replace rather than a range - can now be impleneted as `def replace_string(str, key, repl) if(contains_string(str, key), replace(str, find_string(str, key), repl), str)`
- scalar multiplication and division (multiplying a list by a number) - can be implemented as `def scalar_mult(V, n) map(V, self * n)` and `def scalar_div(V, n) map(V, self / n)`
- vector magnitude - can be defined as `def norm(L) sqrt(sum(map(L, self ^ 2)))`
- vector dot product - can be defined as `def dot_prod(u, v) sum(map(zip(u, v), reduce(self, 1, a * b)))`
- vector cross product - of extremely limited use in a game in 2D space, and could probably be defined if really needed
- cartesian product - limited use, inefficient
- power set - limited use, inefficient
- reverse acting on lists - may still add this, not sure
- contains (test if an element is in a list) - can be implemented as `def contains(L, key) if(find(L, self = key) = null(), 0, 1)`
- foreach - identical to map, except ignoring the return value
"
62113307,GUI2: Unit preview pane,Vultraz,2016-03-08 18:23:32+00:00,2016-03-09 09:43:43+00:00,{},"This adds a dedicated GUI2 unit preview pane widget, using the same design from the Unit Create dialog.
"
62102094,Side name,gfgtdf,2016-03-08 17:04:32+00:00,2016-03-08 19:23:24+00:00,{},
62053860,Resolve translated logo images not being used (bug #24357),Wedge009,2016-03-08 10:47:18+00:00,2016-03-19 07:27:23+00:00,{},"I recognise that translations are normally supposed to go through Ivanovic. But since this pertains to the code's handling of translated images and not translated text, I think this should be an acceptable exception.
"
61825894,1.12 Mute most common case of mp illegal whiteboard data warning.,gfgtdf,2016-03-05 22:09:50+00:00,2016-03-06 13:08:50+00:00,{},
61819376,Fixed bug #24496: story maps show all markers in journey trails again,alexpersico-1988,2016-03-05 18:13:30+00:00,2016-03-05 18:23:08+00:00,{},"I created a loop to redraw all markers because the background hid them.
"
61815979,Include built-in effects in wesnoth.effects,CelticMinstrel,2016-03-05 16:07:34+00:00,2016-03-19 06:50:32+00:00,{},"This allows them to be called by Lua code or even overridden.

In addition, the effect functions have changed a little:
- They now return a string value which can be used to describe the effect, for building descriptions of traits.
- They now receive a boolean value; if false, they should _only_ build the description without altering the unit (used when `times=per level` but the unit is level 0).
- The config passed to the function by Wesnoth will always have `times=1`, no matter what the original `[effect]` tag had. This is something of a safeguard against coders manually implementing this when Wesnoth already calls the function several times if needed.

Needs testing still.
"
61799199,VC9 Project Update,Wedge009,2016-03-05 03:27:52+00:00,2016-03-05 03:29:37+00:00,{},
61625258,bootstrap.py - script to get Windows dependencies,techtonik,2016-03-03 21:07:57+00:00,2018-11-24 18:14:47+00:00,{},"This downloads all dependencies required to build Wesnoth
with GCC on Windows (including SCons). Run, wait for Boost
build to complete, then execute complile.bat to build.
"
61518582,AI refactor for easier configuration and coding,CelticMinstrel,2016-03-03 07:04:44+00:00,2016-03-22 14:41:30+00:00,{},"This is a fairly extensive refactor of the AI system, mainly geared towards making it easier to configure. It breaks compatibility with some things and removes most of the unused aspects and a few other old, unused, and very deprecated things.

Some highlights:
- All aspects can be added using `[aspect_name]...[aspect_name]` syntax, which for scalar aspects allows specifying things like `time_of_day`. For non-scalar aspects, if you want to do this, you need a nested `[value]` tag. Simplified aspects of this form are automatically converted to a facet (standard aspect) which is appended to the main composite aspect.
- The AI listing in the gamestate inspector is now split up by root component type.
- The way Lua AI components (stages, aspects, goals, candidate actions) are called has been radically changed. External candidate actions should work with no changes; non-external ones that used an `[engine]` tag with startup code should be able to work with minimal changes to that code. (Non-external CAs that did not use an engine tag should still work, though since the wiki claimed that to be impossible, I doubt there are any.) Other Lua components probably have no problems. All components share an AI-local data table, and each component can be passed arbitrary parameters with the `[params]` tag.
- An ai.aspects table has been added that allows Lua AI code to access any aspect that exists, including all those that were previously inaccessible. The older ai.get_*() functions for getting aspects will be marked deprecated at some point and eventually removed.
- Lua aspects can now be defined as a facet rather than a top-level aspect. (Of course, top-level aspects are still supported.)
- Recruitment jobs in the recruitment_instructions aspect can now be added and removed using `[modify_ai]`.

More details are available in some of the individual commit messages.

The commit history needs to be cleaned up a little (there are a few unrelated commits and fixup commits), and I have at least one more thing to do (writing unit tests), but I'm opening this now to give interested people time to review.
"
61398502,Force console on Windows when --help is specified,techtonik,2016-03-02 13:19:34+00:00,2016-03-03 21:28:37+00:00,{},
61349379,Spelling corrections,Wedge009,2016-03-02 04:20:58+00:00,2016-03-02 04:23:36+00:00,{},
61248724,SConstruct: Mention how to build Windows installer,techtonik,2016-03-01 14:23:52+00:00,2016-03-02 08:20:36+00:00,{},
61167992,Fixed removing of autosaves when they contain spaces (for translations),alexpersico-1988,2016-02-29 23:52:54+00:00,2016-03-04 18:06:19+00:00,{},"Some translations can contain spaces in the suffix and the option ""Maximum autosaves"" doesn't work properly. This fixes the issue.
"
60638923,Fix broken build in VC,Wedge009,2016-02-25 07:55:48+00:00,2016-02-25 08:54:14+00:00,{},"# include <iterator> is needed for back_insert_iterator. This was included in config.hpp, but inclusion of that header here was removed in the previous commit. It might not be needed in Linux, but it looks like it's required for VC/Windows.
"
60574938,Tutorial fixes 2016 02 24,sigurdfdragon,2016-02-24 20:43:34+00:00,2016-02-24 21:01:36+00:00,{},
60493168,"Revert ""AOI: Make the named loyal units unnameable.""",Vultraz,2016-02-24 11:17:51+00:00,2016-02-24 11:18:07+00:00,{},"Reverts wesnoth/wesnoth#607
"
60456394,AOI: Make the named loyal units unnameable.,sigurdfdragon,2016-02-24 04:55:02+00:00,2016-02-24 05:21:26+00:00,{},"Somebody went to the trouble of giving them specific names, Similar is done in spots in HttT, and it seems silly to allow Lomarfel to be renamed.
"
59849483,Restore loading of user hot-keys at start-up (bug #24427),Wedge009,2016-02-18 19:24:25+00:00,2016-02-20 03:12:14+00:00,{},"Loading of user preferences - or user hot-keys at the very least - were broken with the deletion at https://github.com/wesnoth/wesnoth/commit/28be388d6d59783e140aeaad1f3410766212d056#diff-fce7a1e6525522f3e4ab47349051a806L770

This restores loading of user preferences at start-up.
"
59726343,Change id of broken ai to get it off the top of list in mp debug.,sigurdfdragon,2016-02-17 23:23:17+00:00,2016-02-18 01:27:41+00:00,{},"A quick fix to get Default RCA to top of list in debug mode, so add-on development is easier.

It's a quick fix, as there's the possibility that the abandoned ai's might be removed.
"
59719489,help.cfg: healing clarification,vn971,2016-02-17 22:27:33+00:00,2016-03-03 02:59:49+00:00,{},
59596712,Font scaling and reimplemented orb colors,CelticMinstrel,2016-02-17 05:00:11+00:00,2016-02-21 06:34:57+00:00,{},"This implements a new preference which scales all fonts in the game up by a chosen factor (up to 200%; 300% caused the title screen to crash from lack of space), and reimplements the orb colour selection options as a new GUI2 dialog. I also added a minor feature to the friends list pane - clicking an entry copies it into the text box for easy editing.

The orb colour selection needs someone else to verify that it works correctly, since recolouring doesn't work on my build for some reason. I also want to make some changes to the layout.

There's still a minor bug with the font scaling preference as well. I already know what causes it and how to fix it, so I'll push that in the next day or two.
"
59528984,Lua read file,gfgtdf,2016-02-16 17:59:11+00:00,2016-02-18 22:09:41+00:00,{},"this adds a function wesnoth.read_file() to read a files contents intoa  string.

This also contains some unrelaed changes to 2p dark forecast mp map.
"
59446527,AOI Cleanup 2,sigurdfdragon,2016-02-16 05:51:32+00:00,2016-02-16 06:20:22+00:00,{},
59432092,Tutorial cleanup and typo fixes,sigurdfdragon,2016-02-16 01:26:23+00:00,2016-02-16 02:57:04+00:00,{},
59429756,T S2: Make Galdrad an Elvish Champion without traits.,sigurdfdragon,2016-02-16 00:44:01+00:00,2016-02-16 02:56:47+00:00,{},"So he has identical stats to his appearance in HttT S1.

If it's though better to make him an Elvish Marshal, let me know and I'll redo this.
"
59413293,Updated DejaVu fonts to version 2.35,Elvish-Hunter,2016-02-15 21:03:56+00:00,2016-02-15 22:31:05+00:00,{},"Our current version is 2.34.
"
59268740,[WIP] initial prototype for new full-window GUI2 addons manager,Vultraz,2016-02-13 14:53:34+00:00,2016-03-10 14:58:14+00:00,{},"Will be working to try to get this functional.
"
59258760,Fixed deprecated code in ANL,rwallac,2016-02-13 04:54:31+00:00,2016-02-23 19:24:18+00:00,{},"Converted all the worker options to the new format in 1.13.2a.
I also changed any tabs in the files to four spaces.

I have fixed the code (with spacing), but I am wondering how to get rid of the old commits.

I hope I did everything correctly, because I am very new at this.
My Wesnoth forum name is Robertdebrus
"
59243729,SDL2 related guifixes,aginor,2016-02-12 23:01:23+00:00,2016-02-28 19:39:45+00:00,{},"This tries to mop-up all remaining major GUI related flaws from the SDL2 merge.

These changes adds primitive layering to the drawing. It is done using event contexts in GUI1, and event dispatchers in GUI2.
Upon certain events, it triggers a full redraw of every context, in order, starting bottom up.

It fixes the following bugs, and most likely a number of unreported ones too.

https://gna.org/bugs/?24294
https://gna.org/bugs/?24212
https://gna.org/bugs/?19666
https://gna.org/bugs/?24260
https://gna.org/bugs/?24261
"
58981508,Help: Fix typo in Help -> Encyclopedia -> Geography -> Great Ocean.,sigurdfdragon,2016-02-11 01:23:53+00:00,2016-02-11 05:54:26+00:00,{},"Fixes a typo reported on https://wiki.wesnoth.org/SpellingMistakes

@Vultraz: Should I clear the entry in the wiki? Or do we wait until a release is made?
Also, this one can be backported to 1.12 if that's still being done.
"
58837946,AOI cleanup & fixes,sigurdfdragon,2016-02-10 01:46:35+00:00,2016-02-10 02:05:51+00:00,{},"Some cleanup and making Lomarfel & the rangers have a listed loyal trait to follow convention in the other novice campaigns.

Not sure if any of this warrants a changelog entry
"
58837831,AOI: Fix unreported bug of advisor dialog not showing in S4 & S5.,sigurdfdragon,2016-02-10 01:44:57+00:00,2016-02-10 02:05:36+00:00,{},"Changes a few more occurrences than needed for standardization.

Not sure if this warrants a changelog entry.
"
58826628,Help: Fix typo in Trolls description.,sigurdfdragon,2016-02-09 23:34:01+00:00,2016-02-10 02:04:34+00:00,{},"I went with ""cannot"" instead of ""can't"", as there were no other contractions in the trolls description.

...of other races or sometimes cannot even tell them apart...
"
58826017,Help: Fix typo in Orcs description.,sigurdfdragon,2016-02-09 23:27:41+00:00,2016-02-10 02:03:12+00:00,{},
58660012,Russian Translation for Tutorial Part 1 Updated,ilanacarra,2016-02-08 20:08:04+00:00,2016-02-08 22:56:35+00:00,"{'Invalid': 1, 'Translations': 1}","This is my first update for the Game. I've added missing parts of the Russian translation to the Tutorial Part 1.
"
58641947,gui2: implement widget groups,Vultraz,2016-02-08 17:39:50+00:00,2016-02-25 11:20:22+00:00,{},"A group is a window-unique named vector of widgets. Different widget classes can
use tgroup::execute_group_actions() to iterate over the group members, and pass
a setter function of their own to operate on each group member.

Currently, the code is specialized for the tselectable_ class, but could be
expanded later for other base types if necessary. Out of the tselectable_
inheritors, only ttoggle_button makes use of groups so far (for radio groups).
"
58502838,vcproj: Add missing combobox and drop_down_list files.,Wedge009,2016-02-06 00:19:05+00:00,2016-02-07 00:21:46+00:00,{},"Had some trouble compiling in VC14 - added the missing files and did the same here for VC9.
"
58229293,Tutorial part 2 typo fixes & text changes,sigurdfdragon,2016-02-04 01:31:36+00:00,2016-02-04 06:26:33+00:00,{},"Some typo fixes & minor text cleanup in Tutorial Part 2. Let me know what's usable & I'll delete/squash commits as appropriate.
"
57743009,Added names for wolves,spixi,2016-01-30 16:07:32+00:00,2016-03-02 09:02:59+00:00,{},
57558726,Add CURRENT_FILE proprocessor macro,gfgtdf,2016-01-28 20:13:33+00:00,2016-01-29 21:50:21+00:00,{},"this adds a new proprocessor macro called as {CURRENT_FILE}/{CURRENT_DIRECTORY} whcih expands to the current file/directory name. the intention is to use for example as

```
[lua]
code = ""wesnoth.dofile({CURRENT_DIRECTORY}lua/myfile.lua)""
[/lua]
```

This also contains 2 other (unrelated) changes:
It cleans up the units cdfg_ field so that it only contains atributes, no child tags. This also Fixes a savefiles bloat becase the [variation]s, specially of walking corpses aren't stored in the [unit] wml anymore.

It adds ""./dir/file.lua"" support to lua dofile/require, this is also not optimial yet, becase lua chunknames shoudl only contains teh relative name (~add-ons/..  ../myfile.lua) while it currently contains the complate path (C:\users..    ../add-ons/..   ../myfile.lua)
"
56511608,comboboxes for gui2,gfgtdf,2016-01-19 19:16:21+00:00,2016-01-20 18:00:56+00:00,{},"This adds a combobox widget which is more or less a button that shows a popup list dialog next to the button when you click on it.

scons/cmake isnt updated yet, also it still used c++11 features so that it doesnt build on travis yet. Will fix that before i merge.
"
55783783,wmltools: removal of git wrapper functions,Elvish-Hunter,2016-01-12 16:44:10+00:00,2016-01-22 19:38:05+00:00,{},"In these days, I was trying to update the `wmlmove` script to Python 3. Updating it was quite easy (in fact, 99% of the work consisted of merely updating the print() calls). However, while doing so, I triggered two obscure bugs - and this PR is about one of them.
The `wmltools` module contains four functions that should act as wrappers for some git commands. ""Should"" being the keyword here, because they don't actually work.
First of all, we must make a distinction between Linux/BSD-based and Windows-based systems.
On Windows, there's simply no way to fix those functions, because the availability of git commands from the command line depends on your Git setup (adding to PATH environment variable, etc.), so they're guaranteed to _not_ work on most systems.
On Linux and BSD, the functions were updated when we moved from SVN to Git, but were never tested - as a result, they broke and always return `echo 'cannot <action to perform>, .git is missing'`.
I managed to fix them for Linux, but a grep shows that they're used only in two scripts: wmllint-1.4 and wmlmove. Given that wmllint-1.4 is a script of general use and shouldn't rely on a possibly not installed Git, I want to remove them and replace them with os.rename().
As for wmlmove... I was thinking of removing the entire script, as it cannot be used for moving units between add-ons (only between core and mainline stuff, and we don't do that often enough to justify its existence); even in the case that it supported add-ons, UMC authors usually copy (instead of moving) units from one add-on to another, so the script is useless to them anyway. Also, wmltools' CrossRef function prints to stdout several messages, thus clobbering wmlmove's output (which should be a Bash script, and as such it cannot be usually run on Windows).
"
55777992,GUI2 prefs dialog refactor,Vultraz,2016-01-12 16:05:34+00:00,2016-02-10 10:09:18+00:00,{},"WIP effort to reimplement the preferences dialog in GUI2 using @shikadilord 's layout. Right now I'm just focusing on getting all the buttons working; there's probably a lot of code simplification that could be done for the similar functions.

CURRENT STATUS:
- [x] **General Panel**
- [x] **Display Panel**
- [x] **Sound Panel**
- [x] **Multiplayer Pane**
- [x] **Advanced Panel**
"
55592863,[WIP] remove GUI1 reliance on display class,Vultraz,2016-01-11 07:27:13+00:00,2016-01-12 03:15:26+00:00,{},"…ton instead
"
54917909,Fix [for] loop not iterating the correct number of times,CelticMinstrel,2016-01-03 03:26:15+00:00,2016-01-04 01:31:17+00:00,{},"This fixes the `[for]` loop (and by extension, the `{FOREACH}` macro) not iterating the correct number of times if the array length changes during the loop. It does this by re-evaluating the endpoint and step size on each loop iteration, meaning that if someone uses variables in these fields, both the step size and endpoint could change during iteration.
"
54917872,Fix [message] issues,CelticMinstrel,2016-01-03 03:23:02+00:00,2016-01-09 05:50:14+00:00,{},"This fixes some issues with the Lua implementation of `[message]`.
- The last unit who spoke ends up selected after the event ends.
- The speaking unit is not correctly highlighted on the map
- Units without portraits show non-team-coloured sprites.

My build doesn't have team colour at all for some reason, so I need someone else to test the TC part of this.
"
54912663,missing unistd.h including for F_OK for non Linux oses.,devnexen,2016-01-02 21:12:28+00:00,2016-01-03 03:34:47+00:00,{},
54903888,Make the story screen resize aware,aginor,2016-01-02 09:44:41+00:00,2016-01-03 03:35:13+00:00,{},"These changes make the storyscreen resize aware by adding an event
handler to the UI component and giving it its own event context. On an
window-event it'll restart relayout the entire scene and re-start the
drawing of the text.

Known issue: Gamescreen buttons appear when you move over them. This is beyond the scope of this commit and will be fixed in other changes.
"
54902149,Updated version number; set High Resolution Capable per SDL2 guidelin…,ancestral,2016-01-02 06:41:50+00:00,2016-01-02 06:42:51+00:00,{},"Updated version number; set High Resolution Capable per SDL2 guidelines; updated copyright date
"
54901948,Updated version number; set High Resolution Capable per SDL2 guidelines,ancestral,2016-01-02 06:19:15+00:00,2016-01-02 06:37:01+00:00,{},
54892863,gui2: removed never accessed code path and related functions,Vultraz,2016-01-01 16:06:18+00:00,2016-01-01 16:48:37+00:00,{},"According to a comment in the code, the functions with only a frame_buffer as a argument could be removed. Since they were never called before, this shouldn't break anything, but PR-ing it so travis can run through.
"
54886716,Fix bug #24209 and add a global event context,aginor,2016-01-01 02:56:42+00:00,2016-01-01 07:02:49+00:00,{},"This adds a global event scope that an sdl_handler can register to in
order to receive all current events, regardless of the current
scope. Care should be taken to not be registerd in a local event
context and the global context at the same time as it will lead to the
event handler potentially being invoked twice.

This also adds the workaround needed for #24209 in the new event
handler in the video class.
"
54816629,Fix some startup crashes,jyrkive,2015-12-30 17:43:43+00:00,2016-01-25 03:46:19+00:00,{},"I compiled Battle for Wesnoth from source code, and attempted to launch it with this batch file (placed into the folder which contains the ""wesnoth"" and ""external"" folders):

```
SET PATH=%PATH%;%~d0%~p0external\dll
START """" ""%~d0%~p0wesnoth\wesnoth.exe""
```

It crashed on startup.

Debugging showed me that this code right in main() is the culprit:

``` c++
#ifdef _OPENMP
    // Wesnoth is a special case for OMP
    // OMP wait strategy is to have threads busy-loop for 100ms
    // if there is nothing to do, they then go to sleep.
    // this avoids the scheduler putting the thread to sleep when work
    // is about to be available
    //
    // However Wesnoth has a lot of very small jobs that need to be done
    // at each redraw => 50fps every 2ms.
    // All the threads are thus busy-waiting all the time, hogging the CPU
    // To avoid that problem, we need to set the OMP_WAIT_POLICY env var
    // but that var is read by OMP at library loading time (before main)
    // thus the relaunching of ourselves after setting the variable.
#if !defined(_WIN32) && !defined(__APPLE__)
    if (!getenv(""OMP_WAIT_POLICY"")) {
        setenv(""OMP_WAIT_POLICY"", ""PASSIVE"", 1);
        execv(argv[0], argv);
    }
#elif _MSC_VER >= 1600
    if (!getenv(""OMP_WAIT_POLICY"")) {
        _putenv_s(""OMP_WAIT_POLICY"", ""PASSIVE"");
        _execv(argv[0], argv);
    }
#endif
#endif //_OPENMP
```

In the first launch, argv contains only the EXE path:

> argv[0] = ""I:\Battle for Wesnoth\wesnoth\wesnoth.exe""

When the game relaunches itself, it passes argv to _execv(), unmodified. _execv() splits the path on spaces. That behavior is mentioned here: https://msdn.microsoft.com/en-us/library/431x4c1w.aspx

> Spaces embedded in strings may cause unexpected behavior; for example, passing **_exec** the string `""hi there""` will result in the new process getting two arguments, `""hi""` and `""there""`. If the intent was to have the new process open a file named ""hi there"", the process would fail. You can avoid this by quoting the string: `""\""hi there\""""`.

On the second launch, argv is like this:

> argv[0] = ""I:\Battle for Wesnoth\wesnoth\wesnoth.exe""
> argv[1] = ""I:\Battle""
> argv[2] = ""for""
> argv[3] = ""Wesnoth\wesnoth\wesnoth.exe""

Boost::program_options thinks that argv[1] through argv[3] are positional options, and crashes the game because only one positional option is allowed.

The first of these commits fixes that crash by quoting argv[0] before passing it to _execv().

After fixing the issue, the game continued to crash. Automatic detection of the data directory wasn't working.

``` c++
        const std::string& exe_dir = filesystem::get_exe_dir();
        if(!exe_dir.empty()) {
            // Try to autodetect the location of the game data dir. Note that
            // the root of the source tree currently doubles as the data dir.
            std::string auto_dir;

            // scons leaves the resulting binaries at the root of the source
            // tree by default.
            if(filesystem::file_exists(exe_dir + ""/data/_main.cfg"")) {
                auto_dir = exe_dir;
            }
            // cmake encourages creating a subdir at the root of the source
            // tree for the build, and the resulting binaries are found in it.
            else if(filesystem::file_exists(exe_dir + ""/../data/_main.cfg"")) {
                auto_dir = filesystem::normalize_path(exe_dir + ""/.."");
            }

            if(!auto_dir.empty()) {
                std::cerr << ""Automatically found a possible data directory at ""
                          << auto_dir << '\n';
                game_config::path = auto_dir;
            }
        }
```

The problem with this code is that, on Windows, filesystem::get_exe_dir() returns the working directory instead of the directory where the EXE is. The second commit in this pull request fixes that.

Unfortunately Windows debug builds were relying on filesystem::get_exe_dir() returning the working directory. In the third commit, I added code that explicitly checks if the working directory is the data directory.

**Summary:** these commits fix a crash on startup on Windows if the game is located into a path with spaces, and another crash on startup on Windows if the game is launched with the working directory set to something other than the data directory.
"
54776598,Fix window event handling,aginor,2015-12-30 04:18:55+00:00,2015-12-31 02:36:56+00:00,{},"This is my merge request for fixing a lot of the window handling (such as resize, hiding/unhiding) issues and rendering order problems under SDL2.

It fixes bugs:
#23934
#24211
#24214
#24213
#19666
#23534

And attempts to fix bug:
#24212
"
54771945,New hi-res icon using new logo for OS X,ancestral,2015-12-30 01:37:05+00:00,2015-12-30 01:39:52+00:00,{},"New hi-res icon using new logo for OS X
"
54770838,Moved video related functions from preferences to CVideo,Vultraz,2015-12-30 01:04:50+00:00,2015-12-31 03:54:33+00:00,{},"Simple PR split off from PR #566 for @aginor to use.
"
54728486,Fix SDL2 crash; update mouse_handler_base.cpp for OS X to look for ctrl-click instead of cmd-click,ancestral,2015-12-29 14:00:25+00:00,2015-12-29 21:00:03+00:00,{},"Two patches:

**First:**
For OS X, control is the default modifier key that is used for contextual menus throughout the system

KMOD_CTRL will check for a control-click instead of a command click. This fixes [#15259](https://gna.org/bugs/?15259).

I’ve built and verified with this patch, and it works correctly. Native secondary-clicking (like two-finger clicking on a trackpad) still works, and is unaffected.

**Second:**
Delete two lines in SDLMain.m to fix an SDL2 crash. Tested successfully.
"
54675009,Refactor window state handling,Vultraz,2015-12-28 18:43:07+00:00,2016-01-01 09:30:17+00:00,{},"This PR refactors and simplifies the handling of window states in SDL2. It also improves behavior on changing states such as fullscreen/maximized/resolution and the saving of said states between sessions.
"
54646997,Fix bug #24234: Add Boost 1.60.0 support to unit tests,aginor,2015-12-28 10:50:03+00:00,2015-12-29 21:15:08+00:00,{},"The unit test part in boost has changed a few header files and
function signatures between previous versions and 1.60.0. These
changes adds a version check and two different versions of the
affected code, as well as introducing semicolons after the global text
fixtures (which doesn't appear to do harm) but otherwise requires more
version checks.
"
54595386,Resolve preferences file polluted with null-command hot-keys (Bug #21969),Wedge009,2015-12-26 01:21:17+00:00,2016-02-28 02:35:35+00:00,{},"Re-open PR #530 but now based on master.

Only save non-default hot-keys to the preferences file if the hot-key is active (ie command != 'null').

Clearing hot-keys in memory (via the hot-key functions in the game) only sets the command to 'null', which currently gets written to the preferences file if it is a custom, ie non-default, hot-key. Over time, creating and clearing hot-keys results in a lot of redundant hot-key entries. The nice thing about this update is that it will remove redundant command='null' entries for existing preferences files as well as prevent it from being included in future ones..

To do: while this change achieves the intended result there is extra work to be done to allow the clearing of default hot-keys (bugs #21983, #22218, #23981).
"
54045490,"Added event type ""unit placed""",ln-zookeeper,2015-12-17 23:15:55+00:00,2016-01-12 16:57:40+00:00,{},"This is intended to allow event-driven abilities and other modifications to immediately take action when any unit appears on the map.

Still needs some more testing in context of replays and multiplayer.
"
53941529,Revert all recent improvements to SDL1.2 hot-key handling (1.12),Wedge009,2015-12-17 07:06:41+00:00,2016-04-10 00:03:58+00:00,{},"Unfortunately, the US/QWERTY-centric nature of SDL 1.2 keyboard handling means that the previous commit breaks character-based hot-keys for non-US/QWERTY keyboard layouts. (Bug #24186)

This reversion wipes out all improvements to hot-key handling introduced for US/QWERTY keyboards.
"
53401103,Readd string_to_color function using map label implementation,Vultraz,2015-12-11 14:51:18+00:00,2015-12-15 15:08:05+00:00,{},
53385122,Spelling Corrections,Wedge009,2015-12-11 12:06:27+00:00,2015-12-12 00:25:51+00:00,{},
53088640,Disable Planned Recruits (Bug #24022),Wedge009,2015-12-09 08:19:31+00:00,2016-10-19 04:42:23+00:00,{},"Bug #24022 highlights one of many issues with planned recruits. gfgtdf suggests it might be worthwhile to simply disable recruits in planning mode.

This change will no longer allow fake recruits, but a normal recruit will still take place on attempting to do so during planning mode. It can be applied to 1.12 as well, if accepted, but I can understand if it is not as this is not an ideal solution.
"
53070596,Add code to compare the local wesnoth version with the latest available wesnoth version,gfgtdf,2015-12-09 02:56:12+00:00,2018-02-23 14:38:37+00:00,{},"The intention is to use it for an automatic updater.
currently this unfornately only compares the first 2 parts of the
wesnoth version but this shouldn't be hard to fix.
"
52856264,add tag [random_placement],gfgtdf,2015-12-07 15:12:29+00:00,2015-12-07 20:53:15+00:00,{},"and use it to implement SCATTER_IMAGE, SCATTER_EMBELLISHMENTS and
SCATTER_UNITS
"
52051837,Clean up grammar in two brother's 01,jrmiller82,2015-11-29 00:45:21+00:00,2015-11-29 01:06:59+00:00,{},"I cleaned up some grammer to make it read more naturally. There is so
much passive voice and weak verbs in the original. However, I've tried
to retain the same events; I just made it read a bit better. I'm also
open to any suggestions you may have; just wanting to make Wesnoth the
best it is.
"
50904404,Test and potentially merge Sdl2 branch with Master,aginor,2015-11-17 04:55:07+00:00,2015-12-19 00:55:00+00:00,{},"I would like help with testing this and see if more people can break it. If we can get some sort of consensus that this is stable/good enough I think it would be good to have it merged into master.

If you test it and have a crash, please raise a bug in the tracker and attach a stack trace. I'd also like to know which version of SDL2 you are using if you see any issues, and which operating system/distribution and video-card. We have had both AMD and Nvidia specific issues so it matters :)

Currently open bugs for SDL2:
https://gna.org/bugs/?23934 - Since resize items are funky even on master with SDL1 I don't see a reason treat this as a blocker.
https://gna.org/bugs/index.php?23857 - Trivial enhancement, I do not think this should be a blocker.

Bugs that should not be fixed:
https://gna.org/bugs/?23909
"
50749540,Mute false positive OOS reports when recalling,gfgtdf,2015-11-15 16:05:51+00:00,2015-11-15 18:32:48+00:00,{},
50579986,dont show OOS error on unit checksum mismatch,gfgtdf,2015-11-12 22:48:56+00:00,2015-11-13 00:53:38+00:00,{},
50033924,bug #9742 tab completion makes use of offline friends no more,niegenug,2015-11-07 11:19:39+00:00,2015-11-15 22:55:10+00:00,{},
50031959,respect CMAKE_MODULE_PATH provided by user,starius,2015-11-07 09:05:19+00:00,2016-04-10 02:55:28+00:00,{},"Cross-compiling to Windows with [MXE](http://mxe.cc/) requires providing custom CMAKE_MODULE_PATH variable for CMake:

```
$ cmake -DCMAKE_MODULE_PATH=/file/provided/by/mxe.cmake
```

As Wesnoth's CMakeLists.txt resets CMAKE_MODULE_PATH, the effect of CMAKE_MODULE_PATH provided by MXE is disabled and the build fails with [linking errors](https://gist.github.com/starius/abfb9033d92f21ef521d).

This commit changes CMakeLists.txt to respect the value of user provided CMAKE_MODULE_PATH, so both MXE and Wesnoth customizations of CMake variables are applied.
"
49806695,wmllint: team_name -> team_id and user_team_name -> team_name rules,Elvish-Hunter,2015-11-05 10:36:44+00:00,2015-12-20 20:03:11+00:00,{},"Like the title of this PR says, I added to wmllint a set of rules to manage the conversion of team_name and user_team_name to team_id and team_name respectively.
These rules are quite complex, in order to handle the [modify_side] case, which supports [filter_side] and as such may have two team_name= keys with different meanings, and also due to the amount of tags checked. Let me know if you can think of any other tag that I should add to the rules.
A point worth noticing is the fact that the translation mark check happens before the call to hack_syntax(), so the mark check has no way to guess if the tag was updated or not, and that currently requires a second wmllint run to fix the missing marks.
"
49646458,[WIP] Windows patch installer,aquileia,2015-11-04 04:08:52+00:00,2020-09-12 01:03:14+00:00,{'Windows': 1},"- A few issues have to be ironed out (scons target, uninstaller)
- The translations need to be proof-read
- The MSVC related commits have to be merged separately
"
49513167,Added user's leave notification for ingame players,niegenug,2015-11-03 02:22:22+00:00,2015-11-05 03:01:28+00:00,{},
49155442,remove accuracy and parry form [attack],gfgtdf,2015-10-29 15:29:34+00:00,2015-11-04 02:07:50+00:00,{},
49138128,Properly correct the broken Desert Sands / Oasis help entry (bug #23023) [1.12],Wedge009,2015-10-29 13:23:41+00:00,2015-10-31 23:09:04+00:00,{'Backport': 1},"Reverts the previous change to the terrain.cfg and allows the terrain code to fall back to name if editor name is unavailable.

Back-ports PR #545 to 1.12 branch.
"
49136951,Properly correct the broken Desert Sands / Oasis help entry (bug #23023),Wedge009,2015-10-29 13:12:28+00:00,2015-10-31 23:08:31+00:00,{},"Reverts the previous change to the terrain.cfg and allows the terrain code to fall back to name if editor name is unavailable.

This is a proper fix and supersedes PR #537.
"
49122002,MSVC Settings (1.12),Wedge009,2015-10-29 10:36:00+00:00,2015-11-04 04:04:12+00:00,{'Backport': 1},"I had some trouble with MSVC and 1.12 branch. Copying these settings from master seemed to help.
"
49116875,Resolve incorrect fake unit types (bug #20299) [1.12],Wedge009,2015-10-29 09:46:00+00:00,2015-10-31 23:17:20+00:00,{'Backport': 1},"Back-port of PR #523 for 1.12 branch. Tested and seems to be working as it already is for master.
"
48948004,Ingame tab completion works with friendlist (bug #9742),niegenug,2015-10-27 23:42:10+00:00,2015-10-28 20:37:08+00:00,{},
48852462,Bug Fixes from Master (1.12),Wedge009,2015-10-27 10:31:49+00:00,2015-10-27 10:44:48+00:00,{},"Add a couple of bug fixes from master. I thought I'd be able to get the MP Load Game Cancel Orders fix into this as well but it looks like there was some rewriting of the load game dialogues for 1.13.x.

Also a couple of updates to get compilation working in MSVC14/2015 (adapted from changes already in master).
"
48721675,Change Logs (master),Wedge009,2015-10-26 10:23:31+00:00,2015-10-26 10:34:25+00:00,{},"Adding log entries for changes already in master.
"
48687917,fix preferences dialog for loadgame hotkey,gfgtdf,2015-10-25 21:08:18+00:00,2015-10-26 08:29:48+00:00,{},"Some hotkeys (like the loadgame hotkey) are present in some, but not all hotkey scopes and teh hotkey preferences dialog was unable to handle that. One of the results was that it was not possible to assign the same hotkey to the loadgame hotkey and the loadmap hotkey, this commit attempts to fix that.
"
48676676,Resolve Bug #23215,Wedge009,2015-10-25 11:31:53+00:00,2015-10-25 12:06:20+00:00,{},"Enable Load Game hot-key in main menu.

Apparently a regression from 1.10.
"
48675813,Resolve incomplete Oasis terrain help entry (bug #23023),Wedge009,2015-10-25 10:29:11+00:00,2015-10-25 10:47:53+00:00,{},"Correct Desert Sands / Oasis help entry.

From what I can tell of show_terrain_description(), the oasis terrain help entry is meant to be combined with the desert terrain help entry. But it incorrectly shows just 'Desert Sands /' in the title - explicitly adding the editor_name seems to resolve this.

In contrast, the nearby rubble and crater terrain types don't have a editor_name presumably because they will re-use the name string, and these seem to work because they are stand-alone help entries.
"
48441828,Work-around 0% defence listing for Rails terrain (issue #1399),Wedge009,2015-10-22 10:38:19+00:00,2018-01-22 00:54:57+00:00,{},"Rails terrain listing can be confusing with 0% defence - it never appears on its own and so depends on other terrain layers' defence and movement ratings.

See discussion in #1399 for more details.

(Admittedly, special case conditions aren't really a good thing.)
"
48213249,Concede button,DaJulian,2015-10-20 15:04:33+00:00,2016-07-01 11:50:21+00:00,{},"Adds a concede button that can be added to a theme's menu via WML ""concede""
"
48188045,Resolve Bug #22133,Wedge009,2015-10-20 11:30:32+00:00,2015-10-24 10:56:49+00:00,{},"Resolving bug #22133, stating Cancel Orders does not work when loading a MP game.

Modelled from the Cancel Orders functionality in the single-player Load Game, game_launcher::load_game() of game_launcher.cpp.
"
48025757,Improve hot-key handling for SDL 1.2 builds,Wedge009,2015-10-19 02:20:16+00:00,2015-10-25 02:03:40+00:00,{},"This is an extension of #450 and a correction of #470. The sdl2 branch already contains a superset of the improvements made here and will eventually be merged into master, thus overriding this work. So only include these changes in the current 1.12.x release branch.

To ensure we don't have a repeat of the mistakes in #470 I tested the following combinations (mostly Windows, some in Linux):
letter (a, b, c, etc)
punctuation (;, ., etc)
function (F1, F2, F3, etc)
Shift+letter
Shift+punctuation
Shift+function
Ctrl+Return
Ctrl+Enter
Ctrl+j
Ctrl+m
Ctrl+function
Ctrl+`
Ctrl+Shift+2 (@ on US keyboards)
Ctrl+;
Ctrl+Shift+; (colon on US keyboards)
Ctrl+Tab
Ctrl+PrintScreen
Ctrl+Pause
Ctrl+Insert
Ctrl+Delete
Ctrl+Home
Ctrl+End
Ctrl+PageUp
Ctrl+PageDown
Ctrl+Alt
Ctrl+Ctrl
Ctrl+Space
Ctrl+Alt+Space
Ctrl+direction
Ctrl+Shift
Ctrl+CapsLock
Ctrl+NumLock
Ctrl+ScrollLock

Revision of notes from #470:
Instead of specifically checking for Ctrl+j and Ctrl+m, I now make this a general check: that letters should match their respective key codes. This will still cover the Ctrl+Return/Enter combination fixed in #450, but also some of the combinations noted by others testing that PR.

Ctrl+Tab was one combination noted to not work in Linux (though it did in Windows) as it was being mis-read as Ctrl+i. Ctrl+Tab will now work correctly in Linux.

Strangely, Ctrl+Scroll Lock and Ctrl+Pause (while working in Linux) were both being mis-read as Ctrl+c in Windows. This change will cover Ctrl+Scroll Lock but Ctrl+Pause will also be read as Ctrl+Scroll Lock, because of the key code SDL detects. Similarly, Ctrl+Num Lock becomes Ctrl+Pause instead. I don't think this can be resolved because the key code is simply being read incorrectly (this includes SDL 1.2 and SDL 2.0 in Windows).

Unfortunately, I cannot test whether there will be any improvement or regression in OS X.

With hot-key handling being rewritten for SDL2 this change may seem moot, but it will still improve things for the current 1.12 release. This change also resolves concerns some have had regarding the special-case nature of the Ctrl+j/Ctrl+m check previously used.
"
48023647,attempt to fix saves from replay,gfgtdf,2015-10-19 01:11:30+00:00,2015-12-29 00:01:05+00:00,"{'Bug': 1, 'Backport': 1}","https://gna.org/bugs/23310
"
47988657,fix selected item after deletion in a ordered list,gfgtdf,2015-10-17 15:32:12+00:00,2015-10-17 15:32:20+00:00,{},
47987001,Resolve preferences file polluted with null-command hot-keys (bug #21969) [sdl2],Wedge009,2015-10-17 14:01:43+00:00,2015-12-26 00:33:21+00:00,{'Bug': 1},"Only save non-default hot-keys to the preferences file if the hot-key is active (ie command != 'null').

Clearing hot-keys in memory (via the hot-key functions in the game) only sets the command to 'null', which currently gets written to the preferences file if it is a custom, ie non-default, hot-key. Over time, creating and clearing hot-keys results in a lot of redundant hot-key entries. The nice thing about this update is that it will remove redundant command='null' entries for existing preferences files as well as prevent it from being included in future ones..

I am making this change against the sdl2 branch instead of master because the sdl2 branch already contains a lot of rewriting of the hot-key functionality.
"
47975591,Tab-completion added for in-game whispers,niegenug,2015-10-17 01:10:06+00:00,2015-10-17 22:52:59+00:00,{},"In the game lobby you can tab-complete ANY nick, both from the lobby or from a match running. While playing you can only tab-complete ingame players and observers.
This patch works in the match, it helps answering whispers from people in lobby or in other games.
The nick will be added to a string (in the same way as observers already work) and get recalled with TAB key.
"
47778707,"Revert ""Added Death of Galtrid to losing conditions for the Human All…",tranceitionalMynd,2015-10-15 12:21:34+00:00,2015-10-25 10:04:28+00:00,{},"Reverts wesnoth/wesnoth#526

Sorry, this should be reverted.  Galtrid is removed from the scenario in 1.13, so this applies to branch 1.12 (pr #527).
"
47778517,Added death of Galtrid to defeat conditions for Human Alliance.,tranceitionalMynd,2015-10-15 12:19:18+00:00,2016-06-06 16:59:55+00:00,"{'Bug': 1, 'Backport': 1}","Equivalent to pr #526 in the master branch.

Addresses https://gna.org/bugs/?23919.
"
47663399,Added Death of Galtrid to losing conditions for the Human Alliance.,tranceitionalMynd,2015-10-14 14:06:18+00:00,2015-10-14 15:42:23+00:00,{},"Verified in debug mode that the death of Galtrid is the only death missing from the losing conditions.  Rebuilt and verified death of Galtrid is listed in the objectives as a losing condition.
"
47536338,Updated embedded Lua library to 5.3.1,Vultraz,2015-10-13 13:59:10+00:00,2016-05-29 15:25:28+00:00,{},"This constitutes a copy of the src directory of the 5.3.1 source, with extension
changes (.c -> .cpp). Applicable function names were changed.

Additionally, luaL_typeerror was manually readded, as this  function is no longer
included in the source as of 5.2.

The changes from the following commits were manually reapplied:
- 6655b18
  LUAI_EXTRASPACE

The following patches were applied:
- http://www.lua.org/bugs.html#5.3.1
  io.lines does not check maximum number of options.
"
47517193,Resolve hang on command-line screenshot of non-existent map (bug #20900),Wedge009,2015-10-13 10:46:29+00:00,2015-10-27 11:24:49+00:00,{},"Bug report refers to a more thorough patch #3972 which seems to have never been accepted. All I'm trying to do here is add the file_exists check which fixes the hanging while minimising the changes needed.

(MSVC debug mode still fails due to a vector assertion failure (teams vector reference), which makes testing/debugging the editor difficult.)

If anyone feels like adding all the error messages/handling included from the patch, go right ahead.
"
47346258,Resolve incorrect fake unit types (bug #20299),Wedge009,2015-10-10 14:08:59+00:00,2015-10-27 12:31:44+00:00,{},"Check IDs match before re-using an existing fake_unit. IDs can be different in the situation described by bug #20299, where the user selects the next unit while planning a move.
"
47345654,scons/sdl.py: Escape backslashes on path substitution,techtonik,2015-10-10 13:31:10+00:00,2015-10-12 09:18:26+00:00,{},"This clears warnings on Windows
https://github.com/wesnoth/wesnoth/pull/481#issue-104760195
"
47336790,Ensure var_end is not beyond res.end(),Wedge009,2015-10-10 03:46:15+00:00,2015-10-10 04:52:22+00:00,{},"MSVC debug mode complains that var_end cannot be dereferenced if it hits the end of the string.
"
47202678,side specific variables.,gfgtdf,2015-10-08 20:33:20+00:00,2015-10-11 16:51:21+00:00,{},"http://gna.org/bugs/?23490

This makes it possible to store variables inside the side with the lua
functions get/set_side_variable. These variables are carried over along
other side specific data(units, gold)

It is currently not possible to write these variables without lua.

There are some advantages over storing these variables in the normal variables as found out in the bugerport:
1) It not trivial to store this data asociated with the sides save-id in wml variables, mainly because sides side id might be unsiuted to act as a variablename since it miight contain spaces or other unsuitable characters.
2) by storing these variables inside the side cvarryover data the variables are automatically removed along with the side if the side is removed (for exampple becase they have persistent=no or becasue they lost)
"
47115045,Make Edit Side dialog to use new share_vision tristate,Vultraz,2015-10-08 06:12:01+00:00,2015-10-09 04:06:43+00:00,{},
46979869,Make closing | mandatory in $var?default| syntax,CelticMinstrel,2015-10-07 02:02:31+00:00,2015-10-07 18:20:04+00:00,{},"This breaks less existing strings and wasn't as complicated to implement as I had initially thought it would be.
"
46905017,Fix for,CelticMinstrel,2015-10-06 13:51:07+00:00,2015-10-06 18:43:21+00:00,{},"Some more issues fixed with the [for] tag.
"
46870044,Add [replace_map] file= which will load the specified map at runtime,Vultraz,2015-10-06 07:30:16+00:00,2015-10-07 02:16:22+00:00,{},"This has an advantage over the map key behavior, where the contents of the map
file were preprocessed and written to savefiles.
"
46732720,Merge pull request #1 from wesnoth/master,jkassman,2015-10-04 20:40:48+00:00,2015-10-04 21:39:44+00:00,{},"update jkassman fork
"
46557113,Some fixes to the looping tags,CelticMinstrel,2015-10-01 18:10:18+00:00,2015-10-02 02:01:49+00:00,{},"I noticed a few errors in the implementation of [for], and also reimplemented {FOREACH} and {REPEAT} to use [for] and [repeat], respectively.
"
46363339,New syntax for [message][option]message= similar to new [campaign][difficulty],CelticMinstrel,2015-09-30 05:42:07+00:00,2015-09-30 19:12:06+00:00,{},"This is a PR instead of being pushed directly to master mainly because I expect it to break unit tests.
"
46214993,New syntax for campaign difficulty.,Vultraz,2015-09-28 22:13:52+00:00,2015-09-29 23:46:59+00:00,{},"This replaces the current difficulties/difficulty_descriptions syntax with a new one using a [difficulty] tag with the following syntax

```
[difficulty]
    define=
    image=
    label=
    description=
    default=
[/difficulty]
```

The old syntax is still completely supported and is translated to the new syntax at runtime.

Note that the old format doesn't have a deprecation warning right now, since I'm not sure where best to display it.
"
46129692,Spelling corrections,Wedge009,2015-09-28 08:09:55+00:00,2015-09-28 08:26:46+00:00,{},"Yes, more spelling corrections. These ones are from http://wiki.wesnoth.org/SpellingMistakes
"
46092432,add optional fire_event parameter to get_village,gfgtdf,2015-09-27 00:23:38+00:00,2015-09-27 00:23:43+00:00,{},
46086949,Realign translated logo images.,Wedge009,2015-09-26 18:34:01+00:00,2015-10-27 11:58:07+00:00,{},"Ever since the logo was split into separate image (swords and shield) and text, as well as the dimensions being modified, translated logos have been misaligned. While it's true the translated logo images should be remade so that it the image and text are similarly separated, we can still align the existing logos with the current logo background image.

In many cases, the translated logos were not even showing on the loading screen because its dimensions broke a check in blit_modification::operator() (translated logo height > background logo height). After this change, all translated logos should display again (and are even nicely aligned on top of the current logo background image).
"
46081150,Fix capture event on undoing,gfgtdf,2015-09-26 12:36:50+00:00,2015-09-27 00:24:49+00:00,{},
46076889,Lua vconfig iteration,CelticMinstrel,2015-09-26 06:50:04+00:00,2015-09-30 19:22:53+00:00,{},"This patch adds metamethods for the vconfig userdata to allow you to iterate over them just as if they were a plain WML table. It also adds a couple of config utility functions to the helper module.
"
46073023,attempt to backport 'Fix capture event fired when undoing' WIP,gfgtdf,2015-09-26 01:59:47+00:00,2015-09-26 02:00:29+00:00,{},"https://github.com/wesnoth/wesnoth/commit/db54a8dce543af9224dd79cd72e416b7f617aeb5
"
46072240,ignore [allow_undo] in wml menu handlers since it casues OOS,gfgtdf,2015-09-26 01:21:04+00:00,2015-09-26 12:33:59+00:00,{},"https://gna.org/bugs/?23903
"
46072152,backport sighted events fix,gfgtdf,2015-09-26 01:17:45+00:00,2015-09-26 12:33:48+00:00,{},"https://gna.org/bugs/?23600

https://github.com/wesnoth/wesnoth/commit/5ecc629c2c3e5cd15d68e70025edeffb95fe7210
"
45997430,SDL2 Minor Changes,Wedge009,2015-09-25 10:26:04+00:00,2015-09-25 11:59:50+00:00,{},"Some minor changes:
- Clarity on opaqueness definition vs hard-coded 255 value.
- Avoid potentially breaking SDL changes in implicit boolean conversion.
"
45861562,XCode: Getting unit tests to run,CelticMinstrel,2015-09-24 05:50:56+00:00,2016-02-19 02:44:46+00:00,{'Bug': 1},"This should remove the need for -Wno-unused-local-typedefs, so I've also removed that, but this change is submitted as a pull request in case I'm wrong.
"
45858626,Use native colour cursors,CelticMinstrel,2015-09-24 04:39:08+00:00,2015-09-24 13:23:40+00:00,{},"This fixes bug #18112 and re-enables colour cursors on OSX
"
45857462,Bugfix #23820 - Fix alpha blending under SDL2,aginor,2015-09-24 04:07:29+00:00,2015-09-24 13:04:09+00:00,{},"This commit introduces a new function, sdl_copy_portion that should be
used when copying portions of the screen area for later copying back
onto the screen area. The function does a copy without alpha blending,
thus emulating the functionality that SDL1.2 provides.
"
45829794,Lua API changes (mainly relating to units),CelticMinstrel,2015-09-23 20:51:32+00:00,2015-10-04 01:13:04+00:00,{},"The commit messages are pretty self-explanatory. This allows you to call functions involving units using the syntax `u:function(args)` instead of `wesnoth.function(u, args)` (the function names are also different in most cases, omitting the word ""unit"").
"
45815890,backport bug #23201,gfgtdf,2015-09-23 18:45:42+00:00,2015-09-23 19:22:33+00:00,{},"https://github.com/wesnoth/wesnoth/commit/552a6ce6191272ee55f08dc5877aab43b448da9a
"
45785868,Work-around for planning moves on planned recruits (bug #18637),Wedge009,2015-09-23 14:30:38+00:00,2015-11-05 03:03:00+00:00,{'Backport': 1},"Attempt to work-around bug #18637, where planning moves on planned recruits results in a crash (because get_unit() is null when move::init() is called).

This isn't a comprehensive fix because clicking on a planned recruit will still result in the usual display feedback for planning a move. The difference here is that attempting to place a planned move will result in nothing happening when the mouse button is clicked (as opposed to the assertion failure or crash which happens currently). It is better than nothing, I believe, unless there are negative side-effects of which I am unaware of.
"
45783546,Resolve crash on unit killed before planned actions are completed (bug #20071),Wedge009,2015-09-23 14:12:02+00:00,2016-09-24 13:14:20+00:00,{'Bug': 1},"Attempt to resolve bug #20071 where a unit with planned actions is killed before those actions can be completed. This would otherwise result in an assertion failure or crash to desktop because sa.find_last_action_of() would be making a null pointer reference (get_unit() returns null when the unit is killed).

I have tested this with one unit killed before planned actions are completed, two units killed before planned actions are completed, and a mixture of live units with planned actions completed, live units with planned actions incomplete, and units killed before planned actions are completed. The catch is that planned actions painted on the screen get left behind after their respective units are killed off, until the mouse cursor hovers over the actions and triggers a redraw. But it is better than nothing and at the very least the game should not crash any more.

I'm not familiar with all the code, but at a high level I suppose a solution to the above is to do a check on side_actions whenever a unit is killed. (I think last_action_redraw() is only called when the mouse cursor hovers over a planned action or its unit.) I think this would be more work, in places outside of the whiteboard area of code used for action planning.
"
45494536,Reverting some spelling/grammar changes from #483,Wedge009,2015-09-20 11:17:10+00:00,2015-09-20 20:37:12+00:00,{},"This is an update to #483. celticminstrel raised some points relating to some hyphenations, as well as reverting to 'me and x' phrasing on the basis that spoken contexts do not necessarily need to be formal, grammatically correct language.
"
45349738,Prefer pass by reference,midzer,2015-09-17 22:26:40+00:00,2015-09-18 22:20:14+00:00,{},"Minor performance enhancements by passing arguments as a (const) reference and not by value
"
45317408,Enhanced looping tags,CelticMinstrel,2015-09-17 17:22:05+00:00,2015-09-23 04:50:30+00:00,{},"This commit adds three new control flow structure tags to WML: [for], [repeat], and [foreach].

The [for] tag is a general range-for loop, with special support for the common case of running over an array. It can be used as a drop-in substitute for the {FOREACH}/{NEXT} macros.

The [repeat] tag is a drop-in substitute for the {REPEAT} macro, with the added bonus that it doesn't break down if nested.

The [foreach] tag is an opaque foreach loop. It disallows adding or removing elements during iteration (though the contents of elements can be changed). If you need to add or remove elements, you can use [for] instead.
"
45255544,Port [message] and [object] ActionWML to Lua,CelticMinstrel,2015-09-17 06:20:31+00:00,2015-09-19 16:14:19+00:00,{},"This branch ports the [message] tag to Lua as part of some preparation for eventual [break] and [continue] tags. I also plan to port the [object] tag, which may be added to this PR later or to a separate one.
"
45224425,split wesnoth.get_user_choice function,gfgtdf,2015-09-16 21:07:29+00:00,2015-09-20 20:34:18+00:00,{},"previously there was one function which sometimes returned a wml table
and sometimes a map integer to wml tables dependent on its parameters.

Now there are 2 different functions: wesnoth.get_user_choice and
wesnoth.get_user_choices. the first one handles the case where you just
want to get a choice from one side and thus it returns just one wml
table. The second function handles the case where you want to get
choices from multiple sides. that function retruns a table of wml
tables.

I also added an optional string parameter to that function specifying
the type of that choice (this is useful to make replays more robust and
readable)
"
44852880,Resolve Bug #20036,Wedge009,2015-09-12 12:54:01+00:00,2015-09-12 15:54:28+00:00,{},"When a map is generated, the labels for the player starting locations are correctly set. However, generating another map (or even loading a map and then generating a new one) results in the old labels remaining even after the new map has been generated and displayed.

Issue appears to be that the reset labels flag is not being set after a map generation. This change sets the reset labels flag and the subsequent perform_refresh() function then includes a reset of the map labels.
"
44794405,Correct Surface Alpha Blending in SDL2,Wedge009,2015-09-11 15:18:34+00:00,2015-09-13 10:28:25+00:00,{},"alpha.cpp was apparently written as a compatibility wrapper for SDL2, as SDL_SetAlpha() has been replaced with other functions in SDL2. As it currently stands, it neglects to set the alpha blend mode which is now required when in SDL2.

A quick check of the code indicates that in most places where SDL_SetAlpha() is called, the alpha parameter is only set as SDL_ALPHA_OPAQUE, or the flag input parameter does not include SDL_SRCALPHA. So in either case there is no alpha blending anyway and so this omission didn't make a difference.

However, alpha blending _is_ used in fill_rect_alpha of rect.cpp. This is most noticeable in dialogues with sorted lists, such as the hot-key bindings in the preferences, where the background colour of the headings turns opaque white instead of the alpha-blended grey that it is in an SDL1.2 build. There is at least one graphical blending issue resolved with this change as well - it's possible others may be included with this.
"
44630183,Generalize backstab weapon special,CelticMinstrel,2015-09-10 05:49:45+00:00,2015-09-19 19:45:26+00:00,{},"This pull request generalizes the backstab weapon special by extending the `[filter_adjacent]` tag, as well as a few other related changes (see commit list for details). The core backstab special has been rewritten in the new syntax.

The implementation uses a combination of two new features:
1. A new `relative_to=` key in the adjacency filters which specifies the unit to whom a unit or location must be adjacent to match. It defaults to ""self"", which is the original behaviour of `[filter_location]` and `[filter_adjacent_location]`. For backstab, it's set to ""opponent"", which means the matched unit or location must be adjacent to the opponent rather than the unit with the special weapon. Other possible values are ""attacker"" and ""defender"".
2. Five new possible directions for the `adjacent=` key. These directions use the primary unit (by default, the unit with the special weapon) as a centre point and the secondary unit as a boundary point and find a location relative to both units. Currently, the five directions are cw (clockwise from the secondary unit), ccw (counter-clockwise from the secondary unit), opp (opposite, ie the primary unit lies directly between the secondary unit and the matched unit), -cw (clockwise from the opposite point), -ccw (counter-clockwise from the opposite point). I'm not entirely keen on these names, and if anyone has a better idea, I would welcome it.

This commit also makes `[filter_adjacent]` and `[filter_adjacent_location]` work more like their counterparts in standard unit and location filters, respectively - supporting the `count=` key and, in the case of `[filter_adjacent]`, the `is_enemy=` key (the latter being crucial for the new implementation of backstab). This change is applied to unit abilities as well as weapon specials.

The only thing left to do on this branch is show deprecated messages for the use of the `backstab=` key and possibly change the names of the relative directions.
"
44565180,Replay turns in networked multiplayer,gfgtdf,2015-09-09 15:34:10+00:00,2015-09-09 21:54:06+00:00,{},"The patch enables the ""Back to turn"" buttons in networked mp so that when you press the ""back to turn X"" button, the gamestate will be reset to turn X and the theme will be changes to teh replay theme which allows you to replay the game until the current turn, when the current turn is reached the replay I disappears and the game continues normally.
"
44529387,Change the ordering of the CMakeLists so options comes first.,aginor,2015-09-09 09:44:57+00:00,2015-09-13 04:28:02+00:00,{},"This changes the ordering of the compile time options so the options
comes before any before any flags or checks that may depend on them.
"
44404911,Correct transparent damage graphs in SDL2,Wedge009,2015-09-08 08:29:55+00:00,2015-09-09 10:04:44+00:00,{},"Alpha channel was set to 0, which means that these graphs are not displayed under SDL2. Changed alpha values to 255 to restore the graphs.

SDL1.2 builds are unaffected because they (at least going by the struct definition) ignore the value fourth colour channel.

Other changes are just white-space formatting.
"
44307265,"remove support for [terrain_graphics][tile]loc=x,y",gfgtdf,2015-09-06 18:23:54+00:00,2015-09-06 19:40:55+00:00,{},"loc=x,y was previously undocumented so it's unlikeley that someone used it.
loc=4,2 had the same effect as x,y=4,2
"
44277139,Spelling and Grammar Corrections,Wedge009,2015-09-05 05:31:00+00:00,2015-09-19 20:07:00+00:00,{},"Various spelling (not related to American vs non-American English differences) and grammatical corrections picked up over the course of reviewing the translation files.

If you have any objections or questions about any of the changes let me know, but I think most of them should appear sensible to at least native-English speakers, regardless of their particular dialect.
"
44146187,SConstruct: Check all SDL libs together,techtonik,2015-09-03 19:19:51+00:00,2015-09-04 11:29:26+00:00,{},"This speeds up troubleshooting of OGG dependencies
"
44144093,scons/sdl.py: Absolute filename gives C++ warnings on Windows,techtonik,2015-09-03 18:59:57+00:00,2015-09-21 08:40:47+00:00,{},"```
scons: Configure: Checking for Ogg Vorbis support in SDL...
build\sconf_temp\conftest_25.c <-
  |#include <SDL_mixer.h>
  | #include <stdlib.h>
  |
  | int main(int argc, char **argv)
  | {
  | Mix_Music* music = Mix_LoadMUS(""E:\r\wesnoth-old\data\core\music\main_menu.ogg"");
  | if (music == NULL) {
  |            exit(1);
  |        }
  |        exit(0);
  |    }
gcc -o build\sconf_temp\conftest_25.o -c -D_GNU_SOURCE -I.locally\SDL-1.2.15\include\SDL -I.locally\boost_1_57_0 build\sconf_temp\conftest_25.c
build\sconf_temp\conftest_25.c: In function 'main':
build\sconf_temp\conftest_25.c:6:33: warning: unknown escape sequence: '\w'
  Mix_Music* music = Mix_LoadMUS(""E:\r\wesnoth-old\data\core\music\main_menu.ogg"");
                                 ^
build\sconf_temp\conftest_25.c:6:33: warning: unknown escape sequence: '\d'
build\sconf_temp\conftest_25.c:6:33: warning: unknown escape sequence: '\c'
build\sconf_temp\conftest_25.c:6:33: warning: unknown escape sequence: '\m'
build\sconf_temp\conftest_25.c:6:33: warning: unknown escape sequence: '\m'
```
"
43808204,show confirmation dialog when quitting,gfgtdf,2015-08-31 20:46:41+00:00,2015-09-01 11:43:28+00:00,{},"when quitting (for example by clicking on the red cross in the corner) the
game now asks for a confirmation, if there is currently a (re-)play or
the editor running.
"
43754401,Travis: Build on Ubuntu 14.04,aquileia,2015-08-31 11:19:47+00:00,2015-09-04 21:03:09+00:00,{},"`sudo: 9000`
triggers the use of the docker infrastructure, which is on Trusty.

xvfb, scons, gettext
aren't available on a vanilla Ubuntu, thus we install them.

The first commit is sufficient, the second commit adds compatibility with container-based builds; however, these aren't available for Trusty (`sudo: false` is incompatible with `sudo: 9000`).

As the `ubuntu-trusty` whitelist currently is a stub, the second commit might need to be reverted when travis fixes the whitelist bug... thus, we might want to cherry-pick the first commit now and apply the second when that upstream bug is fixed.
"
43674089,Fix problems with animation-based status sounds,ln-zookeeper,2015-08-28 21:29:30+00:00,2015-09-08 08:01:01+00:00,{},"This adds a customizable list of status sounds (poison, slow, petrify) to game_config, which are then played automatically when the status is inflicted in combat (or by anything which goes through unit_attack()).

This fixes the long-standing problems with playing the status sounds from within attack animations not always working right (see bug #23024), and also makes the sounds customizable from game_config.cfg.

For now this only includes the engine-side changes. If this is deemed ok to merge, I'll add commits for changelog entries, the game_config.cfg additions (not needed to test; the same defaults are hard-coded) and removal of the sounds from mainline animations.
"
43479902,Movetype patching,CelticMinstrel,2015-08-27 05:07:07+00:00,2015-09-05 02:58:15+00:00,{},"This introduces a way for custom terrains or damage types to be patched into pre-existing movetypes; previously the only way (as far as I know) to get this sort of effect would've been to use `[base_unit]` to make duplicates of all the unit types with the movetype you wanted to change. It uses the formula engine to allow you to set the new resistance/defence/cost base on the value of one or more resistances/defences/costs from the original movetype; for example, if you added a new ""sonic"" damage type, you could declare that the sonic resist level is equal to half the impact resist level for some movetypes.

Although the purpose is for adding custom damage type and terrain support to existing movetypes, this could in theory be used for any kind of tweaking of existing movetypes.

An example of the syntax (this goes inside `[units]`):

```
[damage]
    type=sonic
    default=""(impact - 10)""
    smallfly=""(impact / 2)""
[/damage]
[terrain]
    type=fire
    [defense]
        default=""(unwalkable)""
        largefoot=30
    [/defense]
    [movement]
        default=""(unwalkable)""
        largefoot=8
    [/movement]
    # [jamming] and [vision] subtags also supported here
[/terrain]
```
"
43372151,Spelling corrections,Wedge009,2015-08-26 07:32:19+00:00,2015-08-26 07:34:05+00:00,{},"recieve -> receive
intepolate -> interpolate
"
43330086,Allow exiting map editor with Esc and show some non-rebindable keystrokes,CelticMinstrel,2015-08-25 20:05:33+00:00,2015-09-11 06:56:42+00:00,{},"This supercedes #467 - instead of hacking into the event handling to process SDL_QUIT, I have modified the terminate method to pass the key event into the SDL event queue (instead of pushing a quit event). This does have the weird side-effect that the OSX menu will lie about the key shortcut if someone decides to reassign Cmd+Q to something else, but I think that's probably not a major issue.

Also, unlike #467, this does not change the behaviour of clicking the close button on the window decorations. Since the main issue stems from how Cmd+Q is easy to hit by mistake, I don't think that's a major problem. Furthermore, Cmd+Q now does nothing while a dialog is up, which also differs from both #467 (where I attempted to have a confirmation in that event) and original behaviour (instant quit), but I think this actually makes sense - most apps can't be quit while a modal dialog is open.

There is one thing here that I'm not quite sure how to deal with - in SDLmain.m, I have constructed a pair of key events and pushed them into the SDL event queue, but I wonder if there's a better way to do this. In particular, the scancode probably shouldn't be -1 (aka 255) and it would be good if it could properly pass on which of the two command keys was pressed (though in practice the latter probably won't matter).
"
43166227,Resolve colour cursor blending issue in SDL 2.0,Wedge009,2015-08-24 11:50:34+00:00,2015-08-26 06:29:43+00:00,{},"With the way surface blending is implemented in SDL2, having colour cursors enabled results in a faint trail of mouse cursors being left behind. It is stronger when the mouse moves more slowly and definitely noticeable when the cursor is locked for the adding new hot-key function.

This is related to https://github.com/wesnoth/wesnoth/pull/473 but unlike that issue, this was a problem for me in Windows. I do not know if it is also an issue with Linux and OS X builds.
"
43160795,Fix cmake on OSX and fix alpha blending issue with SDL2 while scrolling,aginor,2015-08-24 10:35:13+00:00,2015-08-24 21:51:21+00:00,{},"SDL2 has a workaround for a broken blitting operation, and on some
hardware accelerated systems this led to an alpha blending issue where
map regions that were frequently redrawn would grow progressively
darker until the alpha blended aspects are black. This disables
alpha-blending on the copy of the scrolled map area as no further
alpha composition should be done without a complete redraw of the
affected area.
"
43115828,Let [effect]apply_to=new_advancement add multiple AMLAs,CelticMinstrel,2015-08-23 05:23:07+00:00,2015-08-23 05:56:15+00:00,{},"This was originally in the previous pull request but somehow got lost when applying style fixes.
"
43114076,Fix hidden/empty sides showing in Label Settings,CelticMinstrel,2015-08-23 02:13:59+00:00,2015-08-24 00:37:06+00:00,{},"No further description necessary.
"
43056776,More corrections for hot-key detection in SDL1.2,Wedge009,2015-08-21 16:37:24+00:00,2015-10-17 09:00:00+00:00,{'Backport': 1},"This is an extension of https://github.com/wesnoth/wesnoth/pull/450.

Instead of specifically checking for Ctrl+j and Ctrl+m, I now make this a general check: that letters should match their respective key codes. This will still cover the Ctrl+Return/Enter combination fixed in PR 450, but also some of the combinations noted in that PR.

Ctrl+Tab was one combination noted to not work in Linux (though it did in Windows) as it was being mis-read as Ctrl+i. Ctrl+Tab will now work correctly in Linux.

Strangely, Ctrl+Scroll Lock and Ctrl+Pause (while working in Linux) were both being mis-read as Ctrl+c in Windows. This change will cover Ctrl+Scroll Lock but Ctrl+Pause will also be read as Ctrl+Scroll Lock, because of the key code SDL detects. Similarly, Ctrl+Num Lock becomes Ctrl+Pause instead. I don't think this can be resolved with SDL1.2 because the key code is simply being read incorrectly.

Unfortunately, I cannot test whether there will be any improvement or regression in OS X.

With hot-key handling being rewritten for SDL2 this change may seem moot, but it will still improve things for the current 1.12 release. This change also resolves concerns some have had regarding the special-case nature of the Ctrl+j/Ctrl+m check previously used.
"
43003839,Quck fix for textbox input under SDL2,aginor,2015-08-21 04:45:27+00:00,2015-08-22 10:19:58+00:00,{},"This is a quick fix to get input working, but it's sadly not foolproof. The correct way to deal with this would be to use SDL_TextInputEvent events under SDL2 instead.
"
42989453,Two AMLA changes,CelticMinstrel,2015-08-20 23:18:43+00:00,2015-08-24 00:42:07+00:00,{},"The first change (using `[modifications][advancement]` instead of `[modifications][advance]`) makes it possible to use the same macro (eg `{AMLA_DEFAULT}`) both for adding an advancement possibility to a unit type and for adding that an advancement to a specific placed unit. The implementation is designed to be backwards compatible.

The second change allows making AMLA possibilities mutually exclusive. There is currently no way to indicate to the player that this is the case though; it would be nice to have some indication so that the player knows that certain choices will be eliminated by the choice they've made. However, I think that's a separate issue (in fact, it already affects 1.12 if you use strict_amla=no).
"
42988316,Fix lack of confirmation when quitting via Cmd-Q,CelticMinstrel,2015-08-20 23:00:52+00:00,2015-08-26 16:57:25+00:00,{},"This shows a confirmation dialog when either pressing Cmd-Q (I'm guessing it also works for Alt-F4) or clicking the close button on the titlebar while a game is in progress.

This is not a complete fix for the mishandling of Cmd-Q - for example, if you press it while the recruit dialog is open, there will be no confirmation and the game will quit. Similarly, no confirmation dialog has been added to the editor. However, I think in the middle of a game is probably the most important place to require a confirmation.
"
42913483,This reworks the hotkey system to rely on scancodes.,aginor,2015-08-20 10:21:46+00:00,2015-09-06 08:51:33+00:00,{},"There is a new class introduced, hotkey_base, that is the public interface to the hotkey bindings. It is an abstract class that relies on concrete classes hotkey_keyboard and hotkey_mouse to do the device specific hotkey work via the template method pattern. Please note that joystick support is removed for now. I would prefer to re-introduce that in a later PR/commit.

There are two factory methods introduced, load_hotkey and create_hotkey that should only be used to instantiate new objects.

This commit also changes the hotkey "":"" and ""+"" to "";"" respective ""="" because "":"" and ""+"" are not valid keycodes.
"
42733232,Add female_text key to [animate_unit] and [unstore_unit],CelticMinstrel,2015-08-18 18:40:24+00:00,2015-08-19 00:35:17+00:00,{},"Many other places make use of a female_XXX key to specify differing text for a female unit, and at least one place in mainline requires differing text for a female unit in this context. It's a convenience mainly, but it also feels more consistent.

I've also updated Dead Water to make use of this feature in the code for the stun weapon special. There may be other places in campaigns that could make use of it.
"
42732851,XCode: Copy translations to target if they have been built,CelticMinstrel,2015-08-18 18:36:34+00:00,2015-08-26 03:02:32+00:00,{},"You still need to build them manually first by running 'scons translations' in the repo root dir.
"
42717210,New possibilities for [effect],CelticMinstrel,2015-08-18 16:09:34+00:00,2015-08-23 00:57:44+00:00,{},"The changelog commit summarize it fairly well, but I'll still list them here - this allows effects to modify alignment, vision, jamming, recall cost, attack movement, attacks per turn, and advancement choices.
"
42674353,Addon version validation,Vultraz,2015-08-18 08:46:06+00:00,2015-08-19 01:08:34+00:00,{},"This will inform an uploaded whether the version of an addon they are attempting to upload is equal or smaller than one already published.
"
42652907,"Improvements in wmlvalidator, wmlgrammar and wmldata",macabeus,2015-08-18 01:28:44+00:00,2016-03-22 10:23:44+00:00,{},"- Now it checks translatable lines
- Checks if it is a valid symbol
- Improvement in error checking and return feedback in lists
- Some fairs updates in schema.cfg

And some more things
"
42631242,Improvement to the bundled GUI.py icon,Vultraz,2015-08-17 20:37:28+00:00,2015-08-18 18:40:09+00:00,{},"Opening this as a PR for Elvish Hunter to see if he prefers this version. It's based on the new-style logo, and I think looks a bit cleaner, but I'll leave it to him to decide.
"
42540598,Fetch Mac OS X version instead of Darwin version,CelticMinstrel,2015-08-16 18:16:57+00:00,2015-08-16 18:32:21+00:00,{},"With this change, the version dialog shows the current Mac OSX version instead of the Darwin kernel version. It works on 10.7 and, based on what I hear from @mattsc, will also work on 10.10.
"
42538742,"Add SDL2 support to CMake, advertise clipboard availabilty and remove a small piece of dead code",aginor,2015-08-16 16:09:41+00:00,2015-08-17 00:29:56+00:00,{},"This adds support for doing SDL2 builds with CMake, as well as the required modules to find SDL2 and its dependencies.
To enable:
`-DENABLE_SDL2=TRUE`
SDL2 is disabled by default.

I have also made sure that clipboard is properly enabled for SDL2, and remove a piece of dead code for the defunct ttexture class.
"
42522841,[DO NOT MERGE] Fixup pass on gamemap::overlay() internals,pydsigner,2015-08-15 17:38:11+00:00,2015-08-16 03:58:18+00:00,{},
42516598,Fix the graphics corruption when scrolling with SDL2 enabled,aginor,2015-08-15 09:14:05+00:00,2015-08-15 17:56:29+00:00,{},"SDL2 has issues with overlapping surfaces when blitting, it seems to trigger an internal bug in SDL2. This causes the blitted surface to be incorrectly filled, causing a graphics corruption. This introduces a workaround that does a copy of the original surface before blitting, thus avoiding the bug. This behaviour seems to only occur while scrolling so it's a reasonably rare occurence.
"
42510938,Minor Windows Updates,Wedge009,2015-08-15 01:22:36+00:00,2015-08-22 22:09:33+00:00,{},"Can use static inline in Visual C++ 2015

Also add WindowsTImeout to .gitignore.
"
42510643,SDL2 Update for Windows Tray Notification,Wedge009,2015-08-15 01:08:27+00:00,2015-08-22 22:05:01+00:00,{},"The only update I needed to make to get SDL2 compiling with VC14/2015.
"
42492035,"(Rquesting feedback, don't merge) Several new WML features and some bugfixes",CelticMinstrel,2015-08-14 19:58:33+00:00,2015-08-24 02:21:37+00:00,{},"First of all, don't merge this branch since it's technically incomplete (lacking changelog updates).

I'm opening this to discuss the changes herein; in particular, `[effect]apply_to=advances_to` and `[for]` have had mixed reception in #wesnoth-dev. If some features are acceptable but others aren't, I can split those off and add changelog entries for a separate pull request. (Or I suppose someone could cherry-pick them and make the changelog themselves.)

---

I added `[for]` instead of `[foreach]` because a lot of people seem to have ideas of what `[foreach]` should be that are incompatible with what the `{FOREACH}` macro already is. The `[for]` tag as I have coded it is a ""for i in range(start, stop, step)"" loop, but to make it easy to substitute it for `{FOREACH}`, I have added a mode that populates start, stop, and step so that it runs over all valid indices of a WML array. Sample usages that print output to the chat area:

```
# Will print out 0, 2, 4, 6, 8, 10
[for]
  start,stop,step=0,10,2
  variable=q
  [do]
    [lua]
      code=""wesnoth.message($q)""
    [/lua]
  [/do]
[/for]
# Will print out all the values in my_array, in reverse order
[for]
  array=my_array
  reverse=yes
  variable=n
  [do]
    [lua]
      code=""wesnoth.message($my_array[$n].value)""
    [/lua]
  [/do]
[/for]
```

Some people have suggested omitting the `[do]` tag and just placing ActionWML straight in the `[for]` tag. This is certainly possible and may be simpler. The only reason I can think of not to do it is that having the `[do]` tag could allow a later extension using `[array]` instead of `array=` to embed the iterated array right in the for-loop, but I don't think that's actually a good use-case.

---

For `[effect]apply_to=advances_to`, I'm open to other names; ""`advances_to`"" feels a bit strange. I'm also open to other names for `exclude_amla=`.

The purpose of the `[advance]` --> `[advancement]` change is so that macros defining an AMLA can also be used in `[unit][modifications]` to give a specific unit the AMLA.
"
42436245,Fix all compile warnings when SDL2 is enabled,aginor,2015-08-14 09:02:36+00:00,2015-08-14 11:16:03+00:00,{},"This fixes all compile warnings by performing the correct typecasts or by modifying types to be suitable. The code has been compiled with and without SDL2 enabled to make sure there are no regressions.
"
42426081,Fix TODO by removing workaround for a resolved SDL issue.,aginor,2015-08-14 05:53:17+00:00,2016-03-13 08:56:57+00:00,{},"https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=462794 was reported and fixed in 2008. The issue was reported fro libsdl 1.2.13, the latest/last version was 1.2.15. Debian is still shipping 1.2.13, but have applied a patch to fix the issue. I would also expect that other platforms will also have resolved this issue since if they are still shipping that version of the library.
"
42356779,Correct handling of Ctrl+Return/Enter hot-key.,Wedge009,2015-08-13 14:30:16+00:00,2015-08-17 03:50:52+00:00,{},"Added special handling for j and m characters, where their respective key codes do not match the j and m buttons on the keyboard.
This most likely means that they have come from Ctrl+Return/Enter keys, which resolves to Ctrl+j and Ctrl+m characters.

As a bonus, also corrected unexpected behaviour when attempting combinations such as Ctrl+: or Ctrl+F1. Previously they would resolve to Ctrl+` or Ctrl+@, at least in Windows.
"
42016416,Added password hashing to campaignd,JohnAnthony,2015-08-10 12:51:59+00:00,2015-08-22 05:32:54+00:00,{},"As suggested here:

http://wiki.wesnoth.org/NotSoEasyCoding#Passphrase_hashing

Currently the hashing function is 10-iteration MD5, but should really be something like scrypt (best) or bcrypt (acceptable), but it means pulling in a dependency and Wesnoth already includes an MD5 utility.
"
41963789,Reorganize XCode project,CelticMinstrel,2015-08-09 01:45:33+00:00,2015-08-15 05:31:19+00:00,{},"This basically makes it possible to find a file in the project window given its path, and removes some duplicate and defunct references. Note: Although it builds and runs without issue on my machine, I'd recommend verifying that it can produce a distributable build (that will run on any machine, including wesnothd) before merging it.
"
41942981,Interface to fine-tune displayed labels (and some other label stuff),CelticMinstrel,2015-08-07 23:43:37+00:00,2015-08-08 04:29:15+00:00,{},"I decided to take on the task to make ""Map label ""groups"" which can be selectively turned on and off by the user"". A new `category=` attribute is added to the `[label]` WML tag, and support in the map editor for setting the category as well. A new ""Show/Hide Labels"" option is added to the Actions menu, allowing the user to choose which categories are shown. It also allows them to hide labels placed by specific players, and team labels. (Hiding team labels still doesn't show any global labels on the same space, similar to what [this bug](https://gna.org/bugs/index.php?21708) covers.)

I've also addressed [bug #1627](https://gna.org/bugs/index.php?16274) using the above framework - labels placed by sides controlled by an ignored player will be hidden by default. Also, I added colour sliders to the Edit Label panel in the map editor. I don't think it's an ideal way to set the colour, but it certainly works.
"
41674739,sortable gui2 listboxes,gfgtdf,2015-08-05 12:49:27+00:00,2015-08-07 11:52:21+00:00,{},"This attempts to make gui2 listboxes sortable (similar to gui1 listboxes)

To test this feature i actiavated the gui2 loadgame dialog temporary (Which doesnt mean i consier the current gui2 loadgame dialog good enough to replace the current one.)

This feautre still suffers from http://gna.org/bugs/?15763 which tunred out be be hard to fix so i'll put my attempt to fix it in a sperate pr. But for small listboxes without scrollba this is already a good feature.
"
41673463,*DON'T MERGE* Pre-load all images needed for the map when building terrains,ln-zookeeper,2015-08-05 12:34:37+00:00,2016-05-09 13:22:29+00:00,{},"This is intended for review and testing. There may be better ways or places to implement the behavior.

The idea is to make sure that when building the terrains for a map, all the necessary images get loaded as well to avoid image loading at rendering time, which is what causes skipping and stuttering when scrolling around a newly-loaded map.
"
41526993,Added VC14 support,midzer,2015-08-04 01:36:46+00:00,2015-08-04 03:38:34+00:00,{},"I managed to compile wesnoth using Visual Studio 2015 Community Edition.
Minor changes are necessary though.
"
41522638,VC14 Support,midzer,2015-08-04 00:02:38+00:00,2015-08-04 01:03:18+00:00,{},"I managed to compile wesnoth using Visual Studio 2015 Community Edition.
Some changes are necessary though.
"
41489568,Prefix `apt-get -qq  with `travis_wait`,pquentin,2015-08-03 17:22:11+00:00,2015-08-04 12:27:17+00:00,{},"`apt-get -qq` is completely quiet. If `apt-get` takes more than 10
minutes to execute, nothing will be outputted for 10 minutes, and travis
will kill the build. Using `travis_wait` ensures the commands will not be
killed for 20 minutes. See [the documentation](http://docs.travis-ci.com/user/build-timeouts/#Build-times-out-because-no-output-was-received%29) for details.
"
41480053,Add wesnoth.random and sync helper.shuffle,gfgtdf,2015-08-03 15:40:47+00:00,2015-08-04 21:33:13+00:00,{},"This might break compbility for people that relied on helper.shuffle beeing unsynced even in synced events but i think it makes muhc more sense this way.
"
41469306,Fix get_exe_dir on OS X,pquentin,2015-08-03 13:57:20+00:00,2015-08-31 05:12:42+00:00,{'Backport': 1},"This allows ./wesnoth to work out of the box on OS X: it will use the git checkout as the data directory.
"
41455093,"An Easter Egg in HttT, Konrad wins loyalty",chisquare130,2015-08-03 10:49:09+00:00,2015-08-26 02:10:19+00:00,{},"Coded a planned easter egg in HttT, that enables Konrad to win loyalty
from a heavily wounded unit by immediately killing the attacker.

Note: Heavily wounded means hp<=8, 50% chance to trigger, only happen once.
"
41422064,Fix a compilation error with XCode Version 6.2 on OSX 10.9,PBechon,2015-08-02 18:25:53+00:00,2015-08-03 14:51:11+00:00,{},"The error was that `server_choice` is a class with virtual functions but no virtual destructor.
"
41415511,Make the game compile with SDL2.,aginor,2015-08-02 10:10:45+00:00,2015-08-04 14:12:28+00:00,{},"This does the bare minimum to get the game compiling and running again with SDL 2. It fixes all of the compile errors, adds a missing seek operation to the SDL_RWops. The missing seek operation caused a NULL pointer dereference during game start.
"
41400561,Revisions to SoF,doofus-01,2015-08-01 11:33:34+00:00,2015-08-22 19:47:34+00:00,{},"These are some revisions to first scenario so that the player is a little more involved, instead of just the AIs.  The scenario length and difficulty are not changed.  There are some minor changes to the map associated with the scenario changes.
"
41131230,South Guard text change,chisquare130,2015-07-29 14:44:57+00:00,2015-07-30 23:21:47+00:00,{},"1. Swap option positions to make Elf Path the default choice;
2. Made it slightly less obvious that Epilogues are outdated reference
   to Eastern Invasion
3. Added a delay at victory in 9a, to make it less abrupt
"
41086133,adding location of macro definition to preprocessor argument error message,ghost,2015-07-29 04:24:39+00:00,2015-07-30 05:58:43+00:00,{},"This is the first bullet item under [this wiki section](http://wiki.wesnoth.org/NotSoEasyCoding#Improve_WML_error_reporting). Planning on tackling the rest of them shortly.
"
41078786,Fix bug 22264: wmlindent cannot handle more than one closer on the same line,jstitch,2015-07-29 01:22:46+00:00,2015-08-27 03:11:20+00:00,{},"Fixed by counting the closers found per line, then retreating indent by
that amount on the proper places.

Tested with the sample given on the bug ticket and also with the attached file there
"
41076603,[WIP] Upgrade windows installer,aquileia,2015-07-29 00:37:06+00:00,2015-08-08 02:26:16+00:00,{},"Pull request so that loonycyborg can test each commit with his toolchain.

WIP status as I plan to add further features:
- link the localized manual instead of maual.en.html
- upgrade patches
"
40971861,"Use with statements to open/close files on wml{indent,lint,scope}.",jstitch,2015-07-28 03:17:53+00:00,2015-07-28 09:57:06+00:00,{},"with statement is the recommended way to open/close files on Python.
Some lines of code are saved, and readability is increased.
"
40904497,Tweaked Elf Path of The South Guard,chisquare130,2015-07-27 13:45:08+00:00,2015-07-28 21:59:18+00:00,{},"Increased the difficulties of scenario 3 and scenario 8a in the South
Guard;
Fixed the objective display after killing the naga queen in scenario 6a
"
40889692,Make Deoran the grandson of Haldiel,chisquare130,2015-07-27 10:31:41+00:00,2015-07-27 11:41:49+00:00,{},"Changed Deoran to be the grandson of HttT Haldiel, instead of son,
because the 2 campaigns has 87 years between them.
"
40870647,Improve idiomaticity of wmllint,iKevinY,2015-07-27 05:00:57+00:00,2015-08-01 08:20:00+00:00,{},"I'm currently working through `wmllint` to see what simple improvements can be made before doing some more involved refactoring. I plan on adding a few more commits to this PR, but I figured submitting it early will make it easier to review in chunks (especially some of the more rote changes, such as changing `for i in xrange(len(foo))` to `for f in foo` or `for i, f in enumerate(foo)`).
"
40863607,Various Python cleanup in wmltools-related code,legoktm,2015-07-27 01:05:29+00:00,2015-07-27 08:47:08+00:00,{},"Small things I noticed while trying to read and understand the code.
"
40861435,Display an error if trying to upload an addon with an invalid icon,Vultraz,2015-07-26 22:52:53+00:00,2015-07-30 02:02:27+00:00,{},
40860450,"Balance Tweak of ""Into the Depths""",chisquare130,2015-07-26 21:47:19+00:00,2015-07-27 08:49:34+00:00,{},"Made map a little more friendly, with more flat and lit hexes.
Increased enemies money, especially when in easier difficulties.
Decreased troll_help_cost.
"
40849306,Fix bug #23711 about selecting last map generator used in editor,Ryckes,2015-07-26 07:21:16+00:00,2015-07-26 07:50:36+00:00,{},"It just modifies `pre_show()` to call `do_generator_selected()` after selecting the last map generator used in the list. It would not be called even if the callback was set before selecting the row with `list.select_row()`.
"
40848642,tSG text change,chisquare130,2015-07-26 06:09:10+00:00,2015-07-26 12:02:39+00:00,{},"Make Deoran the grandson of Haldiel in HttT.
Silently delete the objective after killing Queen Xeila in scenario 6a. 
- Fixed tabstop problem in previous pull request.
"
40848435,A few story text changes,chisquare130,2015-07-26 05:46:10+00:00,2015-07-26 06:05:08+00:00,{},"1. Deoran become the grandson of Haldiel instead, for there are 87 years between HttT and tSG.
2. Added a silent Objective change in scenario 6a.
"
40846867,Improve colour search in pangoize(),iKevinY,2015-07-26 02:41:44+00:00,2015-07-26 08:42:31+00:00,{},"I can't contribute much to the Wesnoth's C++ codebase, but I'm looking to contribute to the Python toolchain. I'll be working my way through `wmllint` first to look for improvements, but here is a simple change I noticed right off the bat.
"
40833159,Remove outdated and likely broken utils/mediawiki.py,legoktm,2015-07-25 07:59:32+00:00,2015-07-25 08:10:45+00:00,{},"This script apparently predates MediaWiki's api.php interface, and
resorts to screen-scraping, which most likely no longer works due to
changes in form submission.

Nothing else appears to be using it.
"
39802482,fix mp scenario transitions bugged in scenarios that change controllers WIP,gfgtdf,2015-07-13 11:34:35+00:00,2020-09-12 19:03:55+00:00,"{'Bug': 1, 'MP': 1}","Currently, when a player advances to the next scenario the server will send him information about starting side controllers generated form the current side controllers of that game. This causes multiple bugs:
#1483 becasue current controllers might not match the stating controller of that game.
and
https://gna.org/bugs/?23679

Also note that it is not possible to store the starting controllers when the game starts because if we used connection numbers or player names for that it would cause bugs if a player reentered the game.

There are 2 solutions of that problems that i know:
1) Add a new (integer) player_game_id that is unique for that player in that game (so that the player gets a new id when he rejoins)
2) Make All players joining from previous scenario observers at the beginning. and give them controller updates later.

This pr uses approach 2) The main problem is that when a player joins as observers they also get vision form the other team in that time. To fix this we'd have to seperate 'vision' form 'controlling' which would alo give of features like 'observe as player' (idk if thats useful).

The advantages of this approach over 1) approach are:

We don't change the wml interface of controller= not sure if this is really an advantage.
We are a little more robut against OOS that might appear if a side was deassigned controll before it advance to the next scenario.
We get an 'observe as player' feature

The advantages of approach 1) are
We don't need to seperate 'vision' form 'controlling'  which might be easier
We the side contorller fiels gets simpler becasue we wouldnt need 'network' and 'network_ai' controllers
The serversided code might be easier because teh server can send the same data to all clients
"
39771324,Multiplayer Campaign Issue,delgadillouski,2015-07-12 23:48:34+00:00,2015-07-13 04:15:18+00:00,{},"Campaign: Legend of Wesmere; Official campaign.
scenario: 05, 06
Multiplayer: 2 players (Linux, Windows), network, official server.
Battle for Wesnoth version: 1.12.2 in both computers.
Mods used: none.

Issue: duplicated characters, *missing characters, *missing gold, *non-elvish random units, enemy allies, *unable to recall units, other player scenario campaign it's in english (she uses spanish as default language).

The ones marked with \* apply only for me.

Duplicated characters Assumption: We experienced some unstable connection errors while playing the 3rd and 4th scenario, so I guess that created the main characters twins in the 4th scenario. Restarted from a previous save game and everything went fine, no twins.

The worst errors started in the 5th scenario (We started from a save game), I played as Landar, the other player as Kalenz and the game forced me to also play as Cleodil. <b>We all were enemies</b>, tried setting up Cleodil as an ai (regular ai) and in the first turn it was attacking us.
Tried to play the scenario several times, being enemies made us go slow.
Every time I <b>started the scenario with 80 gold</b> (I used to have more); I was able to <b>create random units</b>, sometimes dragons, lizards, knights, orcs or dwarfs mixed units; The other player wasn't able to understand (since the 2nd scenario) <b>the story game due to it being in english</b>.

After that I managed a way to solve the issue, located the save game and made some modifications: added missing gold (counting my missing horse), ability to exclusively create 2 normal units and elvish scouts, elvish alliance. We played the scenario with minor issues.

> The 6th scenario started
> Where is Landar and Cleodil? There are their places, but those characters are missing. I wasn't able to play (as Landar) and in the upside bar stated 1280 gold (my gold was duplicated) and I had the orange colour (6th player) but I was only able to see 5 players; Everything else was fine.

Even if I would fix the issues in the save game, we possibly could be facing the same or more issues in the next scenario.

Here are the save games: Original and modified save games.
<b>05 Original</b> <a>http://1drv.ms/1HpbDpr</a> (Not exactly the same file, but the issues are visible)
<b>05 Modified</b> <a>http://1drv.ms/1HpbDWF</a>

<b>06 Original</b> <a>http://1drv.ms/1HpbJxo</a>
<b>06 Modified</b> <a>http://1drv.ms/1HpbJ0g</a>

All save games (ZIP file) <a>http://1drv.ms/1L0Cex6</a>

<b>something else:</b>
Ubuntu Linux 14.04.04
Usual ping: 223ms
usr system folder stored in /home/.system/usr mounted through fstab in /usr (has caused several trouble with some software)
some other extras installed on the system that I don't think really matter.

Excuse me for the savefiles but are necessary (exclusively to open as a text or xml file).
If there's something else you need, let me know.
"
39750186,New animated water and the features needed for it,ln-zookeeper,2015-07-11 18:31:30+00:00,2015-07-28 17:17:34+00:00,{},
39218283,UtBS: teaching ability for Garak,Elvish-Hunter,2015-07-05 09:30:14+00:00,2015-07-18 18:28:50+00:00,{},"This PR introduces a new ability in UtBS, called _Teaching_. Its purpose is to avoid that players waste XPs on Garak, whom is available only for the first three scenarios, by redistributing his XPs to adjacent units (on the same side) at the start of each turn. If there are no suitable units, his experience will go back to zero, as discussed on IRC.
There are also two related changes:
- Garak becomes a Desert Marshal. This, combined with the aforementioned ability, should suggest the players that it isn't a good idea to give him XPs.
- Lua now supports a `unit.level` read-only field. This is needed, because the ability is coded in Lua for performance reasons (the alternative was performing at least three `[store_unit]`, one for each level that adjacent units may have, and several `[set_variable]`). This means that, to check a unit's level from Lua, it won't be required any more to read the `unit.__cfg.level` field.
"
39044544,tutorial: No moves for the dummy,Oreolek,2015-07-02 03:02:05+00:00,2015-07-28 08:08:38+00:00,{},"The dummy in the tutorial could move and block your way to the village.
Fixed.
"
38717346,DM S19: Add defeat condition for losing last undead (bug #23668),gregorygauthier,2015-06-27 23:35:06+00:00,2015-07-07 02:55:43+00:00,{},"This change to DM S19 adds a defeat condition for losing the last undead veteran before Iliah-Malal is destroyed.  This fixes bug #23668.
"
37930230,Add synced=yes(default)/no to [set_menu_item],gfgtdf,2015-06-17 18:13:33+00:00,2015-06-22 17:07:40+00:00,{},"Unested.

Allows to add 'unsynced' wml menu hotkeys which are not sended to other
players and are also clickable off-turn.

This can for example used for help menus and similar.
"
37646286,Re-enabled the passive OpenMP mode under OS X,a-square,2015-06-14 18:48:18+00:00,2015-06-14 19:44:35+00:00,{},"Tested with the clang-omp package from Homebrew. Performance and
CPU usage is abysmal with or without the change, but it changes
nothing when compiled with the stock compiler, and it does compile
"
37598965,disable most mp_configure settings when force_lock_settings=yes,gfgtdf,2015-06-12 20:00:48+00:00,2015-06-13 00:26:28+00:00,{},"When using force_lock_settings=yes that game now not only forces
use_map_settings to on, instead if doest show these options and doesn't
thouch those attributes in the scenario.
This implements http://gna.org/bugs/?23037
and might also fix some bugs related to spmp patch ( specially
https://gna.org/bugs/?23509) since force_lock_settings default to yes
for campaigns.
"
37444177,Move [role] to lua (fix for bug #23630),Elvish-Hunter,2015-06-11 09:26:51+00:00,2015-06-15 09:30:22+00:00,{},"This PR converts the [role] tag from C++ to Lua.
In order to ensure that the patch has the intended effect, I also added a new unit test which checks if the role is assigned according to the order specified in the type= list.
"
37040964,ImagePathWML: added ~SWAP() function,Elvish-Hunter,2015-06-05 15:16:53+00:00,2015-06-06 09:30:34+00:00,{},"This PR adds a new ImagePath function, called **~SWAP()**.
This functions performs the channel swap operations that can be found in several image manipulation programs. It accepts three or four arguments (one for each RGBA channel of the image), and each of them can be one of _""red""_, _""green""_, _""blue""_ and _""alpha""_.
The attached image is an example of the effects that can be achieved by using this function.
- Top-left corner: original image `(portraits/elves/captain.png)`
- Top-middle: `~SWAP(red,blue,green)`
- Top-right: `~SWAP(blue,green,red)`
- Bottom-left: `~SWAP(blue,red,green)`
- Bottom-middle: `~SWAP(green,red,blue)`
- Bottom-right: `~SWAP(green,blue,red)`

![swap channels](https://cloud.githubusercontent.com/assets/4049668/8009039/2b43952c-0ba6-11e5-83ef-4e40b6419476.jpg)
"
36892467,team::shareviosion tristate,gfgtdf,2015-06-04 00:32:17+00:00,2015-07-23 13:19:30+00:00,{},
36753114,Removed share_maps. share_view should now handle both fog and shroud,Vultraz,2015-06-02 17:24:45+00:00,2015-07-13 02:21:31+00:00,{},"This also removes a related ancient delayed map sharing feature

PR for gfgtdf to review.
"
35892135,Add [event] remove_on_fire,Vultraz,2015-05-21 01:21:06+00:00,2015-05-21 10:09:48+00:00,{},"This (should be) equivalent to a nested event with remove = yes, id = id_of_parent.

Creating a PR as I'm not sure I'm doing this right. Putting the block after the command causes segfaults. This seems to work fine with the desired behavior without crashing, but it could probably be done better.
"
35104769,add FreeBSD packager to about.cfg,t-zuehlsdorff,2015-05-11 07:56:23+00:00,2015-05-29 12:27:17+00:00,{},"Hello, i'm Torsten Zühlsdorff. I'm taking care about the Wesnoth package at FreeBSD. Therefore i've added my contacts to the about.cfg file, so that FreeBSD user which wishes/problems/etc could contact me.
"
34273952,Update lua_kernel_base.cpp,cbeck88,2015-04-28 14:42:52+00:00,2015-04-29 17:36:00+00:00,{},"Add spaces in between outputs of the lua print function when used with multiple arguments
"
33591554,Show on which difficulty levels a campaign was completed,abacabadabacaba,2015-04-17 23:51:51+00:00,2015-06-21 15:26:04+00:00,{},"Currently, users can see which campaigns they completed, but they don't see on which difficulty levels they were completed. This feature was [requested](http://forums.wesnoth.org/viewtopic.php?f=12&t=19757) [multiple](http://forums.wesnoth.org/viewtopic.php?f=12&t=29387) [times](http://forums.wesnoth.org/viewtopic.php?f=12&t=36061) on the forums.
"
33129758,Bug fix23060: unit status tooltips do not show.,Randypk,2015-04-13 00:35:58+00:00,2015-09-20 22:22:43+00:00,{},"The rectangle for the unit_stats in default.cfg (not a problem in classic.cfg) was overlapping other rectangles, making it not function properly.  Just resized it to fit. Tested with single poison effect, both poison and slow, and no effects, all worked.
"
33122497,add [resource] tag simlar to mp modifications.,gfgtdf,2015-04-12 16:38:25+00:00,2015-12-08 16:34:17+00:00,{},"[scenario], [multiplayer], [era], [modification] and [campaign] can now
contain [load_resource] tags that will load [resource]s that are
toplevel tags similar to [modification] whose child tags will be copied
into the scenario.

These are mainly intended to load resrouces like new wml tags or similar. This adresses https://gna.org/bugs/?22974 . This is a rather basic implementation and im not sure whether it  would be better to make it part of mp depcheck or similar. Spcially becasue this for example has no features like ""require_resource"" (whether all clients need the resource) yet which i sthink it still important.
"
33015242,Bug fix23201: Toggle icons display error in replay.,Randypk,2015-04-10 03:20:12+00:00,2015-04-23 20:24:17+00:00,{},"Enable hotkeys from replay controller so they show the correct status when the replay is loaded.
"
32921317,"add ""disallow_shuffle"" attribute to [side]",cbeck88,2015-04-09 02:55:33+00:00,2015-04-09 04:40:52+00:00,{},"which causes them to be ignored by the ""shuffle_sides"" phase,
regardless of the heuristic used by the connect engine
"
32790108,"add ""require_scenario"" for single scenarios. track addon metadata.",cbeck88,2015-04-07 18:12:31+00:00,2015-04-09 05:00:52+00:00,{},"This is an extension of PR #284.

Need testing! But I really would like to merge.
"
32773135,try to fix scons sdl.py by marking strings as unicode,cbeck88,2015-04-07 15:08:37+00:00,2015-04-07 18:20:49+00:00,{},"Still fails though:

```
Checking for Boost regex library version >= 1.35.0... yes
Checking for C library vorbisfile... yes
UnicodeEncodeError: 'ascii' codec can't encode characters in position 164-168: ordinal not in range(128):
  File ""/home/chris/wesnoth-src/.a-a-áÇØßÜ/wesnoth/SConstruct"", line 405:
    conf.CheckPNG() & \
  File ""/usr/lib/scons/SCons/SConf.py"", line 640:
    ret = self.test(context, *args, **kw)
  File ""scons/sdl.py"", line 108:
    (result, output) = context.TryRun(test_program, u"".c"")
  File ""/usr/lib/scons/SCons/SConf.py"", line 811:
    return self.sconf.TryRun(*args, **kw)
  File ""/usr/lib/scons/SCons/SConf.py"", line 619:
    ok = self.TryLink(text, extension)
  File ""/usr/lib/scons/SCons/SConf.py"", line 611:
    return self.TryBuild(self.env.Program, text, extension )
  File ""/usr/lib/scons/SCons/SConf.py"", line 569:
    result = self.BuildNodes(nodesToBeBuilt)
  File ""/usr/lib/scons/SCons/SConf.py"", line 496:
    jobs.run()
  File ""/usr/lib/scons/SCons/Job.py"", line 111:
    self.job.start()
  File ""/usr/lib/scons/SCons/Job.py"", line 227:
    task.failed()
  File ""/usr/lib/scons/SCons/SConf.py"", line 235:
    self.targets[0])
  File ""/usr/lib/scons/SCons/Node/Python.py"", line 63:
    return str(self.value)
Checking for Ogg Vorbis support in SDL... chris@chris-KLR650 ~/wesnoth-src/.a-a-áÇØßÜ/wesnoth $
```
"
32723496,Enable tree_view gui2 widget for lua,gfgtdf,2015-04-07 00:15:26+00:00,2015-04-08 18:31:59+00:00,{},"wesnoth.add_dialog_tree_value to add nodes to a tree_value
wesnoth.set_dialog_callback support for tree_views (triggers when the
selected node was changed)
wesnoth.get_dialog_value support for tree_views returns an array of
integers that describe the path to the currebntly selected node.
"
32651804,"Revert ""don't reload config when selecing campaigns""",gfgtdf,2015-04-05 17:45:26+00:00,2015-04-09 03:01:38+00:00,{},"This reverts commit 61a8de3d946487abe3e1826a476666e23fd01053.

This fixes https://gna.org/bugs/?23399 but not in the way i'd like to have it fixed. still this should be merged before 1.13.0 release (onless teh bug is fixed otherwise)
"
32631155,ImagePathWML: improvements to NEG() and new function BW(),Elvish-Hunter,2015-04-04 09:02:10+00:00,2015-05-16 10:33:11+00:00,{},"After discussing it with zookeeper on IRC, I modified the NEG function, which now accepts zero, one or three parameters.
If used with zero parameters it behaves exactly like before (full negative effect).
If used with one parameter (a threshold), it inverts a channel only if its current value is greater than the supplied threshold. This can be used to perform solarization effects (like it's done in The GIMP).
If used with three arguments, it allows inverting single channels only if their value is greater than the corresponding threshold, with -1 completely inverting the channel and 255 being a no-op value.
For example, this is the result of NEG used with a single threshold of 63 on the Elvish Captain's portrait:
![screenshot solarized](https://cloud.githubusercontent.com/assets/4049668/6992073/5d56e0d2-dab9-11e4-8113-055dcf1fc7ad.png)
I also added a new function called BW. It means black and white, and reduces an image to these two colors. It requires a threshold: if the value of the grayscale pixel is greater than that, said pixel becomes black, otherwise it becomes white.
Example of the same image converted to black and white with a threshold of 63:
![screenshot black and white](https://cloud.githubusercontent.com/assets/4049668/6992075/6a7a355c-dab9-11e4-81c2-b2818e2efb32.png)
"
32567952,add crash reporting module (WIP),cbeck88,2015-04-03 03:24:27+00:00,2020-04-25 18:52:52+00:00,{},"update: 
- using ""libunwind"" seems to generate great stacktraces on linux
- the signal handler registration mechanism does not seem to work consistently. about 50% of the time it is called in case of segfault, and otherwise it seems just to be ignored.
  i have been able to reproduce the ignoring in gdb. i have also been able to observe in gdb that just before the signal handler is ignored, it is also not registered, according to sigaction (using it manually from gdb as described here: 
  http://stackoverflow.com/questions/6892252/how-to-get-process-signal-information-in-gdb
- possibly related to threading? does it need to assign a signal handler for every thread?
"
32184167,add getter for unit attacks info in lua.,gfgtdf,2015-03-29 16:37:28+00:00,2015-03-29 19:46:12+00:00,{},"works now
"
32170656,add wesnoth.advane_unit lua function,gfgtdf,2015-03-28 20:27:59+00:00,2015-03-28 21:33:56+00:00,{},"previously this was only possible by storing the unit and then unstoring
with advance=yes. Unstoring a unit can cause a lot of overhead if the
unit is complicated. so i added a way to do it without [unstore_unit]
"
31980464,Bug Fix #23117: Invert breaks lobby filtering if Apply Filter is off.,Randypk,2015-03-26 00:47:06+00:00,2015-03-27 20:18:02+00:00,{},"Only pop games off the list if the apply filter box is checked.
"
31674123,allow putting units on recall list for nonpersistent sides,gfgtdf,2015-03-21 16:50:40+00:00,2015-03-24 15:44:47+00:00,{},"persistent=no does not imply that the side does not have a recall list:
1) persisent=no did prevent units from this scenario to be carried over
to a next scenario but it did not prevent units from a previous scenario
to be carried over to this scenario.
2) [unit] in [side] and [unit] in action wml can give recall units to
nonpersistent sides.
3) The wiki does not mention that a side with persistent=no cannot have
recall units.

So i removed checks for [side]persistent= so that [unstore_unit] and
wesnoth.put_recall_unit can put units to the recall list and also tidied
up some other code that assumed sides with persistent=no to not have a
recall list.
"
31665363,Bugfix 22987 - Game filter does not work.,Randypk,2015-03-21 03:33:16+00:00,2015-03-22 17:33:55+00:00,{},"Changed the search filter in the mulitplayer lobby to
search on era and mod as well as title and description.
"
31582184,Bug fix #23060: unit status tooltips do not show,Randypk,2015-03-20 01:43:44+00:00,2015-04-13 00:09:26+00:00,{},
31477190,addon/manager.cpp update,aquileia,2015-03-18 22:03:35+00:00,2015-04-08 00:10:37+00:00,{},"As iceiceice already started dropping support for single file addons, the code can be simplified considerably.

Additionally, the _server.ign now considers empty lines and lines beginning with '# ' as comments. This doesn't change functionality, as both these patterns can't match allowed filenames.
"
31001658,Random faction mode,cbeck88,2015-03-12 01:35:29+00:00,2015-03-13 20:23:40+00:00,{},"This PR makes ""no mirror random"" modifications as a core feature implemented in C++ and selected on the mp configure screen. It also adds ""no ally mirror"" mode, which is nice for team games.

It also switches us to use the Mersenne Twister rng instead of rand for all ""resolve random"" operations in the connect engine, e.g. random faction selection, and shuffling of sides.
"
30949924,New ImagePathWML functions: ~SEPIA() and ~NEG(),Elvish-Hunter,2015-03-11 14:49:47+00:00,2015-03-12 10:04:42+00:00,{},"This PR adds two new ImagePath functions.
The first one is called **~SEPIA**, and adds a sepia tone to the image. When applied to the portrait of an Elvish Captain, for example, this is the result:
![screenshot sepia](https://cloud.githubusercontent.com/assets/4049668/6598684/9cf936b6-c805-11e4-9767-19f1fd73dc0b.jpg)
The second one is called **~NEG** (short for _negative_), and makes an image negative. When applied to the same portrait, this is the result:
![screenshot negative](https://cloud.githubusercontent.com/assets/4049668/6598719/dc540462-c805-11e4-93c5-48fec3b834a8.jpg)
None of these two functions accepts additional arguments.
"
30725326,change mp_game_settings to default experience modifier to 100,cbeck88,2015-03-08 19:57:35+00:00,2015-03-09 01:58:37+00:00,{},"This appears to fix tutorial scenario two. Bug #23366.
I'm not sure if this should be related to loading the tutorial at
all though, so it might not be the real cause of the bug.
"
30707627,"add support for styled font families in GUI1, help dialogs",cbeck88,2015-03-07 19:13:49+00:00,2015-03-08 00:42:18+00:00,{},"This PR adds the Bold, Oblique versions of DejaVuSans to the fonts/ folder, and refactors the font database in font.cpp so that bold and oblique versions of fonts may be specified, overriding SDL_TTF's runtime glyph-transformation styling when these are available. The styled fonts are specified in data/hardwired/fonts.cfg in the `[font]` tags using `bold_name`, `italic_name` optional attributes.

This fixes bug #22376.
"
30687808,Fixup time to load saves selected from in-game menu (bug #23359),cbeck88,2015-03-06 23:05:41+00:00,2015-03-06 23:48:57+00:00,{},"Fixes a significant inefficiency introduced to master in earlier PR #344 .
"
30636553,"fixup server controller tweaks, dont tweak host",cbeck88,2015-03-06 11:03:25+00:00,2015-10-25 10:01:58+00:00,{},"In 1.11.x cycle, we moved all ""client-side controller tweaks"" to
be effected by the server, so that clients won't on their own
change the data they find in a level config at game start. This
had some benefits:
- Only host and server are ever modifying the level data
- Easier to keep observers and clients synced correctly
- Easier to change client behavior with server side patches

The server-sided tweaks happened at the following point in time:
1. Host clicks start game button, a [start] signal is sent to
server.
2. Server now checks the level config and tries to make sense of
it, making sure every side has an owner and such. Then it issues
controller change commands to all clients, making sure they match
its picture of what is going on.
3. Server passes the [start] signal on to the other clients.

This introduced some bad behaviors, however, because the host
does not wait to recieve [start] and instead goes right into the
game.
- When host gets controller change signals for AIs it controls, it
  would overwrite the names of their leaders with the host names.
  (bug #23021)
- It would cause some GUI flashing at game start for the host
  (bug #21156)

In this commit, we make sure not to send controller tweak messages
to the host about sides that it controls.

We still may send messages to the host about sides it doesn't
control. If there is the possibility that a game may start and
an AI side is assigned to someone other than the host, then this
commit won't fix the resulting renaming problems. (However afaik
that cannot happen at this revision.)

Conflicts:
    src/server/game.cpp
"
30636095,"fixup server controller tweaks, dont tweak host (1.12)",cbeck88,2015-03-06 10:55:49+00:00,2018-02-28 14:40:17+00:00,{'Bug': 1},"In 1.11.x cycle, we moved all ""client-side controller tweaks"" to
be effected by the server, so that clients won't on their own
change the data they find in a level config at game start. This
had some benefits:
- Only host and server are ever modifying the level data
- Easier to keep observers and clients synced correctly
- Easier to change client behavior with server side patches

The server-sided tweaks happened at the following point in time:
1. Host clicks start game button, a [start] signal is sent to
server.
2. Server now checks the level config and tries to make sense of
it, making sure every side has an owner and such. Then it issues
controller change commands to all clients, making sure they match
its picture of what is going on.
3. Server passes the [start] signal on to the other clients.

This introduced some bad behaviors, however, because the host
does not wait to recieve [start] and instead goes right into the
game.
- When host gets controller change signals for AIs it controls, it
  would overwrite the names of their leaders with the host names.
  (bug #23021)
- It would cause some GUI flashing at game start for the host
  (bug #21156)

In this commit, we make sure not to send controller tweak messages
to the host about sides that it controls.

We still may send messages to the host about sides it doesn't
control. If there is the possibility that a game may start and
an AI side is assigned to someone other than the host, then this
commit won't fix the resulting renaming problems. (However afaik
that cannot happen at this revision.)
"
30618203,Replay save DO NOT MERGE YET,gfgtdf,2015-03-06 03:20:46+00:00,2015-03-21 16:19:28+00:00,{},"The intention is to speedup saving/loading and to fix saved made durign replay mode.

But for some reasony that i really don't know i keep getting segfault when loading a game during a game after this commit
"
30585976,Fixup sliders 1.12,cbeck88,2015-03-05 19:11:08+00:00,2015-03-05 20:00:17+00:00,{},"Backport of #376
"
30528304,fix bug #22984: sliders not adjustable with arrow keys,cbeck88,2015-03-05 03:51:37+00:00,2015-03-05 19:37:39+00:00,{},"This commit causes sliders to attract focus properly when their
grips are clicked on, and to respond to left and right arrow
presses again. It partly reverts two earlier commits that
affected this functionality.

cf84e1d8aae84b76e7e9adc15847089bdc940632
49614599fa5211e0bc3fdba43c6255509da66022

It causes the zoom slider to behave slightly badly, because it
does not lose focus when the user clicks elsewhere on the map.
But this bug should be fixed at the source and not by disabling
wanted functionality for all sliders.
"
29777041,NR S5a: Minor textual edits,8573,2015-02-22 21:18:24+00:00,2015-02-23 03:18:31+00:00,{},"This commit makes some minor (non-semantic) textual edits in the
mainline campaign ""Northern Rebirth""’s scenario 5a, ""The
Pursuit"", mostly miscellaneous edits for correctness or clarity.

As far as edits that might need explanation:
- The change of “Lich Lord(s)” to “Lich-Lord(s)” matches
  usage in the mainline campaign ""The Rise of Wesnoth"".
- The change of “the land of the dead” to “the Land of the
  Dead” matches usage in the mainline campaign ""Delfador’s
  Memoirs"".
- The “I am Lord Abhai” change is because “Lord Abhai” isn’t a
  _name_ exactly.

r? @Vultraz
"
28246783,Remove checks for usage= and border_size= in map files,Vultraz,2015-01-29 01:35:37+00:00,2015-01-29 03:13:52+00:00,{},"Updates wmllint to cease adding usage= and border_size= keys to map files, as the editor no longer writes them as of 1.13.x.

PR-ing this since I don't know python and someone who does should probably look this over. I've tested it, and it appears to work, but it would be good to be sure to avoid yet another fixup commit.
"
28226395,add [sync_variable] tag,gfgtdf,2015-01-28 20:26:15+00:00,2015-01-29 23:16:05+00:00,{},"used as 

```
[sync_variable]
    name=my_variable
[/sync_variable]
```

it sets my_variable to the same value as on all clients, it uses the value from the currently active side.

The main intention is to replace needs_select=yes for wml menu items somewhen because needs_select is slightly bugged: needs_select=yes causes the event to be fired again when the wml menu item is triggered so the select event it fired 2 times in total on the currently active client.
The most common usecase of needs_select are wml menus like this:

```
[event]
    name=start
    [set_menu_item]
        id=move_unit
        description= _ ""Move!""
        image=buttons/WML-custom.png
        needs_select=yes
        [command]
            {MOVE_UNIT x,y=$moving_unit_x,$moving_unit_y $x1 $y1}
            {VARIABLE moving_unit_x $x1}
            {VARIABLE moving_unit_y $y1}
        [/command]
    [/set_menu_item]
[/event]

[event]
    name=select
    first_time_only=no
    {VARIABLE moving_unit_x $unit.x}
    {VARIABLE moving_unit_y $unit.y}
[/event]
```

With the new tags it now not much harder to do it woithout needs_select:

```

[event]
    name=start
    [set_menu_item]
        id=move_unit
        description= _ ""Move!""
        image=buttons/WML-custom.png
        [command]
            [sync_variable]
                name=moving_unit_x,moving_unit_y
            [sync_variable]
            {MOVE_UNIT x,y=$moving_unit_x,$moving_unit_y $x1 $y1}
            {VARIABLE moving_unit_x $x1}
            {VARIABLE moving_unit_y $y1}
        [/command]
    [/set_menu_item]
[/event]

[event]
    name=select
    first_time_only=no
    {VARIABLE moving_unit_x $unit.x}
    {VARIABLE moving_unit_y $unit.y}
[/event]
```

Unrelated to this specific usecase, Ravana suggested to add this tag to core.
Also note that it's currently possible to archieve similar behaviour with wml by using set_global_variable and get_global_variable in the same event.
"
27987890,"NR bigmap and cutscenes, LoW track",aquileia,2015-01-25 05:27:23+00:00,2015-01-28 02:34:53+00:00,{},
27954237,Port THoT tracks to the SoF bigmap,aquileia,2015-01-23 20:50:19+00:00,2015-01-24 13:30:58+00:00,{},
27369132,don't write blank attribute values when serializing a config,gfgtdf,2015-01-14 17:54:46+00:00,2015-03-24 15:35:09+00:00,{},"previously they were serialized as """" which is the same as empty strings.

blank attributes are usually created when using operator[] on a a non-const config with an nonexsistent key. for example 

```
if(cfg[""a""].to_bool()) {/*some code*/} 
```

might create a blank attribute value with key 'a' if cfg is non const.
"
27299768,"Bigmaps for TB, DM, NR, THoT and LoW S24, NR dialogue fix",aquileia,2015-01-13 19:59:52+00:00,2015-01-29 23:58:49+00:00,{},
27294907,Port TB tracks to the Liberty bigmap,aquileia,2015-01-13 18:56:35+00:00,2015-01-19 12:12:57+00:00,{},
27294505,Backport gitignore merge to 1.12,aquileia,2015-01-13 18:51:11+00:00,2015-01-15 07:29:02+00:00,{},"I see no reason why these shouldn't be applied to the stable release.
"
27176664,Allow [message] image= to have 'none' as a value,Vultraz,2015-01-12 06:18:16+00:00,2015-01-12 08:59:33+00:00,{},"This eliminates the need for image=misc/blank-hex.png

NOTE: Currently, you CAN just leave out the image= key when you use [message], and this
produces the same behavior, but wmllint complains about that, so there must have been some
reason to always use an image= key.

Shadowm suggested this method was a better solution than having it directly in gui2::twml_message.
"
27150084,"Fix typo in ""Return to Oldwood"" campaign",joeljpa,2015-01-10 15:12:24+00:00,2015-01-10 16:23:40+00:00,{},
27044159,Fixed a bug in which not defeated sides without a leader couldn't capture villages,Elvish-Hunter,2015-01-08 17:21:44+00:00,2015-01-24 11:06:39+00:00,{},"Following a discussion that happened on the Wesnoth Italian Forum, I and Xalzar found out that, after the introduction of the new [side] defeat_condition key, the engine's behaviour when capturing a village has become inconsistent.
Before, a side was considered defeated just when it didn't have a leader. But now, a side with _defeat_condition=no_units_left/never_ may not have a leader and be active; in the same manner, a side with _defeat_condition=always_ may have five leaders, and still be defeated.
In my opinion, the expected behaviour from the game should be the following:
- **no_leader_left:** the side can capture villages as long as it has a leader; upon losing it, the side loses all its villages
- **no_units_left:** the side can capture villages as long as it has a unit; upon losing all the units, the side loses all its villages
- **never:** the side can always capture villages (in case that it doesn't have any units, villages can still be captured via WML or Lua), and loses them only through events or enemy captures
- **always:** the side cannot capture villages at all, not even programmatically

Instead, what happens now is the following: it doesn't matter if a side is defeated or not, it can only capture villages if it has a leader. It's really simple to test it:
- Install _A Simple Campaign_
- Modify the side 2 to have a human controller and _defeat_condition=no_units_; also comment out the corresponding canrecruit=yes
- Try capturing a village with the only blue unit: it fails.

This pull request should fix the capturing behaviour, at least on the 1.13 series. It compiles correctly and I tested it, but I didn't yet test the case when a defeated side captures an allied village.
I'm not sure if this should be backported on the 1.12 series, if possible, due to the obvious incompatibilities that it introduces.
"
27002047,OOS debug,gfgtdf,2015-01-08 01:38:50+00:00,2015-01-08 18:06:10+00:00,{},"the game sometimes does some checkup to test whether the calculated results in a replay match the ones calculated during the original game.
This data was stored in the replay inside the [command] for that action. The problem is that this doesn't work in networked mp because we often send the [command] before calculating the results.
I added an alternative mode that used get_user_choice to compare the results, this also works in networked mp but it causes a little more network traffic.
"
26992195,Update changelog for bug #18926 in 1.12,mstrebel,2015-01-07 22:14:37+00:00,2015-01-07 22:57:09+00:00,{},"Also add Michael Strebel to misc. contributors.
"
26992108,Update changelog for bug #18926 in 1.13+dev,mstrebel,2015-01-07 22:12:59+00:00,2015-01-07 22:56:39+00:00,{},
26864512,"add lua function ""fire_wml_menu_item"" and unit tests for menu items",cbeck88,2015-01-06 01:35:02+00:00,2015-01-07 19:03:41+00:00,{},
26832678,Changes registration of hotkeys for tips on titlescreen.,mstrebel,2015-01-05 16:11:03+00:00,2015-01-07 16:37:30+00:00,{},"Removes the static const from wrapper methods.
Take binding function as copy in register_hotkey.

Fixes bug #18926
"
26807715,Update wesnoth.vcproj,aquileia,2015-01-05 06:06:32+00:00,2015-01-05 06:09:16+00:00,{},
26751541,Fix openmp,cbeck88,2015-01-02 07:50:39+00:00,2015-01-02 09:16:04+00:00,{},"Attempts to fix openmp assertion failures reported in #23131
"
26735516,Bug 23108: expected damage for aborted attacks,pelmers,2014-12-31 21:04:42+00:00,2015-12-15 21:21:05+00:00,{},"[ref](https://gna.org/bugs/index.php?reload=1&func=detailitem&item_id=23108)

This commit moves the expected damage calculation from before the attack loop to during the perform_hit phase, since it's possible to abort from the attack loop prematurely via WML actions like teleporting a unit or changing its side. Now each strike adds its expected damage to the total expected.

I also refactored the replay validation into its own function to cut down on the complexity of perform_hit (still almost 200 lines).
"
26711777,maybe fix 23115,cbeck88,2014-12-31 01:12:20+00:00,2015-01-05 18:15:22+00:00,{},"Don't merge yet, needs more testing...

this commit causes wml menu items to have their events registered
not during construction but only when ""init_handler"" is called.
it refactors the wmi_container object to do this when it
constructs new items via the [set_menu_item] path.

this is necessary because the items might be constructed before
the event queue even exists, and we want them to be able to
persist and be reactivated when a new campaign scenario starts.

more testing is necessary to determine if all code paths, including
carryover and reloading, are still working after this commit, and
the earlier commit 6fc1ac1bb224cddec5ccbb7f7865b69b1b093a01

See also discussion of bug #23115.
"
26674417,Fix: Era carryover in Tutorial doesn't work,mstrebel,2014-12-30 05:54:52+00:00,2014-12-30 23:32:05+00:00,{},"Resolves the era carryover bug in the tutorial. Set the default era for the tutorial and hides the multiplayer connect screen.

See https://gna.org/bugs/index.php?23126
"
26638675,Lua: Fix uses of `tostring` calls as LHSs to `or`,8573,2014-12-29 10:24:27+00:00,2014-12-29 11:43:47+00:00,{},"This commit changes occurrences of the pattern `tostring(x) or y` to
`tostring(x or y)` in the following Lua scripts:
- `data/lua/wml-tags.lua`
- `data/lua/wml/items.lua`

`tostring(x) or y` is unlikely to do what the author intended (and is
pointless unless `x` is an object of a custom type with unusual
behavior), because `tostring` returns a string (`""false""` or `""nil""`)
if `x` is a falsy value (`false` or `nil`), and all strings are truthy
in Lua — thus, `tostring(x) or y` will (unless `x` is of a custom
type) _always_ evaluate to `tostring(x)`, never to `y`.

`tostring(x or y)` should, I expect, give the intended behavior.
"
26625581,Backport of classic theme,Vultraz,2014-12-28 16:36:10+00:00,2015-01-04 02:11:39+00:00,{},"Attempt at backporting the classic theme from master. Here for shadowm's review.
"
26618125,"scons: remove boostfilesystem build option, replace with ""libintl""",cbeck88,2014-12-27 21:13:00+00:00,2015-01-02 19:34:40+00:00,{},"This option cleans up some of the compatibility path code from the
1.12 release. After this commit:
- boost::filesystem becomes a hard dependency, for scons
- boost::locale is a soft dependency, a build flag ""libintl"" allows to swap boost::locale out for libintl.
- The libintl option cannot be used when building for windows

This decision is made based on gfgtdf's comments in this forum thread:
http://forums.wesnoth.org/viewtopic.php?f=10&t=41196

and the fact that the boost filesystem code currently assumes the presence of boost locale, for windows.

It also incorporates techtonik's patch:
#347

It is left to backport the same patch for cmake, but the libintl code there
seems messed up already...
"
26618116,Mp 1.12 fixes,gfgtdf,2014-12-27 21:11:59+00:00,2015-01-04 02:11:38+00:00,{},"These commits  could fix https://gna.org/bugs/index.php?23036 and https://gna.org/bugs/?22968

all commits are untested and made with github web interface.

The failing build is a travis problem, and this very similar build here  https://travis-ci.org/gfgtdf/wesnoth-old/builds/45240117 compiled.
"
26617153,"scons: remove boostfilesystem build option, replace with ""libintl""",cbeck88,2014-12-27 19:12:38+00:00,2014-12-27 21:06:17+00:00,{},"This option cleans up some of the compatibility path code from the
1.12 release. After this commit:
- boost::filesystem becomes a hard dependency, for scons
- boost::locale is a soft dependency, a build flag ""libintl""
  allows to swap boost::locale out for libintl.
- when cross compiling for windows, using the ""libintl"" flag
  results in a warning

This decision is made based on gfgtdf's comments in this forum thread:
http://forums.wesnoth.org/viewtopic.php?f=10&t=41196

It also incorporates techtonik's patch:
https://github.com/wesnoth/wesnoth/pull/347

It is left to backport the same patch for cmake, but the libintl code there
seems messed up already...
"
26601470,"Require SDL 1.2.15, which has important bug fix for Wesnoth",techtonik,2014-12-26 15:29:28+00:00,2014-12-31 01:18:53+00:00,{},"https://bugzilla.libsdl.org/show_bug.cgi?id=894
http://forums.wesnoth.org/viewtopic.php?f=5&t=41237
"
26600224,Fix compilation with MinGW on Windows,techtonik,2014-12-26 14:13:37+00:00,2014-12-31 01:18:04+00:00,{},"This removes linking to `gettext` and adds link to `iconv`. I don't know why `iconv` is absent, because I am not an expert, so a better explanation is appreciated. This PR enables me to compile `wesnothd.exe`
"
26536825,"move ""set_menu_item"" to be implemented via lua rather than C++",cbeck88,2014-12-23 22:56:00+00:00,2014-12-24 00:46:12+00:00,{},
26425037,Fix incorrect stringstream syntax.,awleffew,2014-12-21 06:51:25+00:00,2014-12-21 18:24:12+00:00,{},"The str() function is not being used to pull data out of stringstream mgs.  This causes the build to fail when trying to apply mgs to the << operand.
"
25898820,*DON'T MERGE* Optimize and improve loadgame interface,Vultraz,2014-12-11 13:19:07+00:00,2014-12-15 06:11:38+00:00,{},"**WIP**

This is a joint effort between myself and iceiceice (@cbeck88). The goal is to improve some of the exception-based interface involved in game saveing/loading, as well as some minor bugs that result because of it.

So far, the game falling back to menu when declining to load a game from a different version has been fixed, and cases of the two independent struct exceptions (_load_game_canceled_exception_ and _illegal_filename_exception_) have been removed.
"
25837931,make force_lock_settings default to true for [scenario],gfgtdf,2014-12-10 17:07:15+00:00,2014-12-19 20:42:35+00:00,{},"In most cases the campaigns designer don't want the use to be able to
overwrite scenario properites like ""turn limit"" or ""use fog"".

It is easiert to do this here in the code that loads the config than in
the code that reads that value becasue there are multiple codes that
read it and it's not clear that all of then know whether teh scenario
was a [multiplayer] or a [scenario].

Partly implements http://gna.org/bugs/?23037 which suggests to remove
the ability to overwite those settings in capaigns completely.
"
25591214, preserve traslatable strings in simple_wml.,gfgtdf,2014-12-05 18:50:05+00:00,2018-07-18 22:49:37+00:00,{'Bug': 1},"This still has problmes especially related to chaching of simple_wml. But it fixes the most commen cases of ""translatability lost in networked mp""
"
25459095, don't send [create_game],gfgtdf,2014-12-03 22:52:07+00:00,2015-12-06 21:12:45+00:00,{},"see commit descriptions.
"
25225840,use boost::ptr_vector for wesnothd::game::history_,gfgtdf,2014-11-29 18:43:11+00:00,2014-12-02 22:33:39+00:00,{},"boost::ptr_vector is what we want in this case, it gives us a nicer interface and also does the deleting for us.
I think there are also other cases, especially in wesnothd where we want ptr_vector.
"
25167941,generalize the boolean expression wml handler code,cbeck88,2014-11-27 19:51:46+00:00,2015-10-25 10:22:26+00:00,{},"WIP

Intended to also use this in the side filter / unit filter / location filter code.
"
25104955,add plugins and mp unit test system,cbeck88,2014-11-26 18:32:56+00:00,2014-12-20 01:49:34+00:00,{},"This collection of classes provides a framework whereby the engine
may provide scripting capabilities in any ""context"". A C++
function may declare a plugin context by providing a list of names
function objects, then may call ""play_slice()"" on this context to
transfer control to lua. A lua script may generate some arguments
and request to call some of these, then yield to the engine. C++
will run them until one of them signals an error, or that the
context is now invalid (using a boolean return value).

The intended semantics is that lua may only make requests
corresponding to the current context. As soon as a new context
is used (play_slice() is called again) the old context is invalid
from lua's point of view -- calling those functions is a lua
error but not undefined behavior. This should be the case even if
the old context has not been destroyed yet in C++, for instance
if a lua request resulted in a new context being created. There is
a system of locks in place to ensure that when old contexts are
invalidated, stale requests are discarded.

We also add the coroutine library to our lua base. This because
threads are run as coroutines, and writing them requires the use
of coroutine yield from the standard library.
"
25050660, simplyfy :controller logic,gfgtdf,2014-11-25 23:49:05+00:00,2014-11-26 03:22:04+00:00,{},
25045508,Fix spelling in destructor,naclander,2014-11-25 22:20:49+00:00,2014-11-25 22:32:38+00:00,{},
25027436,check properly if a config attribute value is not a boolean,cbeck88,2014-11-25 17:56:28+00:00,2014-12-01 00:26:58+00:00,{},"I don't know if this commit is related to or fixes any bugs, but
there are many bugs reported about fog / shroud / mp campaigns it
seems, and these lines always looked a bit squirrely to me. Since
boolean config values can be indicated by ""yes"", ""no"", ""true"" or
""false"", testing for the presence of ""yes"" / ""no"" only seems like
it won't work in general, even if it works oftentimes. This commit
replaces it with a test for whether the to_bool function is
selecting the default boolean value.
"
24909071,allow every client to ask for random seed.,gfgtdf,2014-11-24 00:04:25+00:00,2014-11-25 18:16:06+00:00,{},"assume this scenaio:

```
[scenario]
## human sides 1,2
  [event]
    name = prestart
    [message]
      speaker = narrator
      message = ""Hello""
    [/message]
    {GENERIC_UNIT .....}
  [/event]
[/scenario]
```

previously, in this scenario client 2 would have to wait for side 1 to click away the [message] because of the random seed required by {GENERIC_UNIT ..} because only client 1 was allowed to ask the server for a random seed (Note that waiting during prestart event means black screen), this patch is intended to fix such situations.
"
24494880,don't limit server max sides,gfgtdf,2014-11-15 22:23:45+00:00,2014-11-16 15:24:24+00:00,{},"there are 2 reasons why the maximum side number is limited in some
contexts:
1) The map format can only store 9 starting positions
2) only the first 9 sides have default colors.

However, 'color' and 'starting position' are both sideproperties that
can explicitly given by wml if needed. And the server doesn't use any of
them, so i see no reason why the server should reject them.
"
24475536,Disable start of scenario saves in multiplayer,cbeck88,2014-11-14 22:32:51+00:00,2014-11-15 06:49:09+00:00,{},"Relevant irc logs: http://www.wesnoth.org/irclogs/2014/11/%23wesnoth-dev.2014-11-12.log
http://www.wesnoth.org/irclogs/2014/11/%23wesnoth-dev.2014-11-14.log

Tested with SigurdFD's random campaign, further testing would be appreciated.
"
24182224,Fixup lua,cbeck88,2014-11-10 22:15:19+00:00,2014-11-11 00:16:44+00:00,{},"This fixes up some loose ends from pull request #330 
"
24123101,New lua kernel i,cbeck88,2014-11-10 01:50:52+00:00,2014-11-10 02:31:53+00:00,{},"This is the first part of PR #280 , I merge it because it will be helpful to simplify the code for lua random map generation, also because I think I want to refactor the second part, although the first part is good, and will get most of the conflicts out of the way.
"
24121607,Fix linking issues for cmake,RolandHoGH,2014-11-10 00:09:00+00:00,2014-11-10 02:39:48+00:00,{},
24037124,split off terrain data caches from the gamemap object,cbeck88,2014-11-07 07:19:00+00:00,2014-11-08 04:06:45+00:00,{},"This commit splits some of the functionality of the gamemap object
into a new class, the ""terrain_type_data"" object. This class is
intended to hold a record of known terrains and the terrain code ->
terrain type map. It handles merging in new terrain definitions,
and it is shared between map objects. It is also cached by the game
config manager, so that we only recalculate this data when we
change configs.

There is in fact a _semantic_ change going on here, which is that
when a scenario introduces a new terrain type by merging, this gets
added to the global cache. The alternative is to make a copy of the
global cache, only for the this scenario, as soon as we have to
dirty the cache. However since I didn't see any downside to putting
the merged terrains together and carrying them across scenarios,
I opted not to do that here.
"
24023840,cache minimap images in mp create screen,cbeck88,2014-11-07 00:04:03+00:00,2014-11-08 04:06:59+00:00,{},"When we are actually in the game, the image.cpp file uses an
elaborate collection of caches to make sure that all images are
cached and reloaded rather than redoing work (even scaling). It's
questionable whether the amount of caching going on there is
appropriate, it seems it might even be faster if we did less. But
one place that we don't do any caching and performance is bad is
in the mp create screen. There was a bug report in 1.12:

https://gna.org/bugs/?func=detailitem&item_id=21801

In this commit, I implement quick and dirty caching for scenario
minimap images. Each scenario record holds a surface (an SDL
reference counted pointer to image data), and when a minimap is
rendered this gets saved, along with the md5 hash of the map that
got rendered. Whenever a minimap is requested, we hash it first
and check if the cache is dirty. If so we recalculate, otherwise
we return the cached image.

The code is also cleaner and a bit less convoluted than the
previous code -- the previous author seemed to think that surfaces
are ""object"" types and not ""pointer"" types, that require an
additional layer of memory management with boost scoped pointer
etc. This was in fact redundant.

I don't know if this commit will actually help report 21801,
the profiling seemed to suggest that it's the minimap rendering
code that is actually slow. But it seems that this can't hurt,
and may at least mitigate the slowness, since except for random
maps it means the minimap calculation won't be repeated.
"
23951916,Cmake cosmetics,RolandHoGH,2014-11-06 01:03:29+00:00,2016-04-09 23:49:28+00:00,{},"My warm up round with pull requests ;-)
"
23951796,fix issue where wml unit tests run in the presence of addon WML,cbeck88,2014-11-06 00:59:46+00:00,2014-11-06 01:52:52+00:00,{},"Any scenario of type ""test"", indeed the generation of the  entire
""TEST"" game-config mode, skips all add-ons.

When tests are run, we want them to run in a clean place where
errors and warnings from add-ons don't cause test failures. This
seems to be the simplest way to achieve this right now.

A possible drawback is that if a user defines their own wml unit
tests, they need to move them to their data/test/ folder and
cannot put them in their add-on or they won't be found.

See irc discussion:
http://www.wesnoth.org/irclogs/2014/11/%23wesnoth-dev.2014-11-06.log
"
23881129,Lua map generator,cbeck88,2014-11-05 02:51:19+00:00,2014-11-06 01:23:15+00:00,{},"This branch adds a ""lua"" map generator type, which takes a lua script to generate a map as an argument. This is desirable because then map generation can be developed as umc independently from the release cycle.

Along the way we also solve bug #22484, wherein the mp create dialog behaves badly with respect to map generators.
"
23861792,Staging/lua 5.2.3,irydacea,2014-11-04 20:43:47+00:00,2015-01-16 21:33:12+00:00,{},"PR for running tests on Lua 5.2.3. **DO NOT MERGE**
"
23739486,"use boost mersenne twister rng, add boost::random dependency",cbeck88,2014-11-03 01:00:52+00:00,2014-11-03 23:22:51+00:00,{},"This is a squash of work done in april, see closed github pull
request #160 .
"
23737513," remove ""network_ai"" and ""network"" controllers",gfgtdf,2014-11-02 22:29:15+00:00,2014-11-15 22:32:40+00:00,{},"DO NOT MERGE, has still bugs

Instead of having ""network"" and ""network_ai"" controller types to know whether we locally controll a side, we now have a ""controller_client_id"" attribute, and the cleints know whether a side is locally controlled by comparing ""controller_client_id == local_controller_client_id"". This has some advantages:
1) It very simplifies the serversided controller tweaks since the server can now send the same data to all clients if a controller client changes.
2) We dotn't show the information whether a side is local or networked in [stote_side]controller= this is useful becasue for most aplications people just want to know whether a side it human or ai, for example checks like controller == human work good in sp but not in mp. For those situation where one wants to know whether a side is local i want to add a seperate wesnoth.is_local(side) lua function.

TODO: remove side ""name"" attribute
"
23728706,backport scons changes,cbeck88,2014-11-02 06:37:38+00:00,2014-11-02 14:02:53+00:00,{},"This is an attempt to fixup our scons pkg-config code, following
issue raised by homebrew folks
"
23728387,test to fix travis,cbeck88,2014-11-02 05:43:34+00:00,2014-11-02 06:45:56+00:00,{},"This reverts commit 9f93831a2397d45560a9f1e36a40aac38d4affc3.
"
23713679,experiment to fix edge-of-hex artifacts with fractional zooming,cbeck88,2014-11-01 00:40:31+00:00,2020-09-12 01:00:49+00:00,{'Graphics': 1},"The idea is, when scaling a hex to zoom, instead of masking it
first and then scaling it up, it should be scaled to zoom and
then masked with a scaled up terrain mask image, because it will
be more precise.

I find that if this is done, and scale to hex algorithm is set to
nearest neighbor, then I no longer get any artifacts from this.
"
23471720,"commit a patch to our fribidi cmake, from downstream (macports)",cbeck88,2014-10-28 16:53:23+00:00,2014-10-30 02:43:15+00:00,{},"see here:
https://trac.macports.org/browser/trunk/dports/games/wesnoth/files/patch-cmake-FindFriBiDi.cmake.diff

i tested that cmake still works and finds fribidi for me (linux)

edit: actually for some reason its failing on linking but it seems unrelated
"
23433593,"when zooming in, use scale_surface_sharp for units, terrain (1.12 branch)",cbeck88,2014-10-28 04:14:35+00:00,2014-11-06 06:28:20+00:00,{},"Previously we were using scale surface. The result is that sprites
look blurry, terrain looks blurry, and for fractional zoom values
""hex tearing"" artifacts are more visible. It seems that zookeeper
and others also prefer a more traditional, just-give-me-the-pixels
look anyways.

lipk even thought that we had been using scale_surface_sharp on
units ""since forever"", so here we treat the fact that we weren't
as a bug.

Before and after screenshots from 1.12 (but also note, the differences are more visible in playtesting, especially the hex-tearing artifcats):
http://imgur.com/a/sSlpT#0

Related discussion:
http://forums.wesnoth.org/viewtopic.php?f=12&t=41109#p576979
"
23354704,Backport reorder gettext,cbeck88,2014-10-26 19:11:29+00:00,2014-10-26 21:26:00+00:00,{},
23348064,Fixup ansi win api and fs,cbeck88,2014-10-26 06:29:52+00:00,2014-10-26 19:12:19+00:00,{},
23347436,Backport sdl rw ops,cbeck88,2014-10-26 04:51:32+00:00,2014-10-26 16:36:01+00:00,{},
23346667,AI BFS part II,cbeck88,2014-10-26 02:50:35+00:00,2014-10-26 03:58:53+00:00,{},"This PR extends branch AI BFS PART I version ii, #307 ,
by cherry-picking this merge-commit into master:

https://github.com/wesnoth/wesnoth/commit/e038938a730c3e7f14d9e3ecb4c5b4ad1cc90aac
"
23319106,reorder gettext.hpp,gfgtdf,2014-10-24 19:30:59+00:00,2014-10-25 20:54:22+00:00,{},"I think that libintl/gnugettext has no support for unicode filenames on windows. Thats why i want to replace it with boost locale, at least for our windows builds.

The the plan is to move all dependencies of libint.h to gettext.cpp and then add an alternative implementation gettext_boost.cpp. The boost gettext version return std::strign in the default  implementation, that why i changes the gettext.hpp functions to return std::string.

i want to put add ""libintl.hpp"" into the gettext.cpp file
I assumes that it doesnt matter whether i have # define GETTEXT_DOMAIN ""wesnoth"" or not since that's the default textdomain so i added a 

```
#ifndef GETTEXT_DOMAIN
# define GETTEXT_DOMAIN PACKAGE
#endif
```
"
23202100,"add SDL_SavePNG, write files as png if possible, unless ending .bmp",cbeck88,2014-10-23 01:38:36+00:00,2014-10-31 13:16:37+00:00,{},"This commit adds a ""minimal interface to lib png to support writing
png files from SDL surfaces"", to the codebase. It adds a save_image
function to namespace image, and this checks compiler flags to see
if lib png is available. The function will save as a png if png
support is included and save file name doesn't have bmp extension,
and otherwise it will save as a BMP as usual.

This makes sense because the whole project is based on png files,
we'd rather save as png unless we can't or the user actually wants a
bmp.

PNG saving is better because SDL doesn't support saving the alpha
channel of sprites to bmp files, whereas this PNG saving code does
support the alpha channel.

We already had lib png as a dependency to build the tools, just not
the main game. This commit changes cmake and scons but makes the
dependency only optional, changing nothing if lib png is not
available.

See here: https://github.com/driedfruit/SDL_SavePNG
"
23062410,xBRZ trial commit,cbeck88,2014-10-21 04:46:51+00:00,2014-10-31 05:49:36+00:00,{},"(See screenshots here: http://imgur.com/a/VPALw#0)
(Description of xBRZ here: http://en.wikipedia.org/wiki/Image_scaling#xbr_family)

This commit adds the xBRZ algorithm to the codebase, and adds
an imagepath modification to use it, and adds a bunch of extra
images showcasing it to the unit help pages.

xBRZ was obtained from sourceforge (xBRZ.zip):
http://sourceforge.net/projects/hqmame/files/

It is modified, the original program wants to be compiled as
C++11, so I had to make minor changes so that it can compile as
C++98 w/ boost.

Main changes: Main changes: get boost/cstdint and typedef uint32_t from there,
comment out all static asserts
change all cases of lambda functions to boost bind instances or
otherwise.
Fix non-utf8 characters.
dos2unix on all new files
Renanme files .h -> .hpp, as config.h is in our .gitignore
Suppress warnings from unused functions.
Fixup warnings from negligible initialization of POD types
Mark some templates results with attribute unused
"
23051127,Fixed minor defects in Polish translation,pjackowski,2014-10-20 22:49:59+00:00,2014-10-22 15:47:49+00:00,{},"Fixed defect in Polish translation in wesnoth-did and wesnoth-units.
"
22989057,AI BFS PART I (version ii),cbeck88,2014-10-20 01:22:13+00:00,2014-10-26 03:58:53+00:00,{},"This is a cherry-pick of the substantive commits from PR #296 , to 1.12 branch. Each commit was tested to compile locally. (`scons wesnoth wesnothd campaignd test; ./test`)
"
22988415,Move everything in src/filesystem.hpp into its own namespace,cbeck88,2014-10-20 00:34:22+00:00,2014-10-20 03:08:44+00:00,{},"ignore me, what you really want is #307 

Conflicts:
    src/addon/manager.cpp
    src/campaign_server/campaign_server.cpp
    src/editor/map/context_manager.cpp
    src/editor/map/map_context.cpp
    src/font.cpp
    src/game.cpp
    src/game_config_manager.cpp
    src/gui/dialogs/editor/custom_tod.cpp
    src/gui/dialogs/lobby/lobby_data.cpp
    src/gui/dialogs/mp_create_game.cpp
    src/gui/widgets/settings.cpp
    src/hotkeys.cpp
    src/multiplayer_create_engine.cpp
    src/multiplayer_lobby.cpp
    src/network.cpp
    src/playcampaign.cpp
    src/savegame.cpp
    src/serialization/preprocessor.cpp

I produce this by cherry-picking gfgtdf's commit of AI's original
commit, from master to 1.12 as usual. git figured out about 2/3
of the file correctly, the rest I mostly had to do by hand. I have
now inspected each line of the diff, it looks good to me.
"
22987043,Istream fix,gfgtdf,2014-10-19 22:48:33+00:00,2014-10-23 21:59:42+00:00,{},
22976390,Fixup exception handlers,cbeck88,2014-10-19 03:58:34+00:00,2014-11-04 21:24:23+00:00,{},"Some exception types, specifically `mapgen_exception`, and the more generic `game::error` weren't being caught anywhere (except void main). I add handlers to game_launcher.cpp and playcampaign.cpp as appropriate. It's possible though that the `game::error` catch will break some things, a little hard to be sure.

This is vaguely relevant to this bug report: https://gna.org/bugs/?22828
although it might not really fix that, nor is that the full scope of this PR.

This PR also changes the solution to this bug: https://gna.org/bugs/?22611
instead of changing the exception type that the buttons throw, it properly catches that type.
"
22946056,"SDL RW Ops (master, new)",cbeck88,2014-10-17 19:10:50+00:00,2014-10-17 21:55:11+00:00,{},"This is a new version of PR #155 rebased after the first filesystem parts were committed, and with updated travis configuration.
"
22933201,Ai boost filesystem,gfgtdf,2014-10-17 15:40:46+00:00,2014-10-17 20:11:38+00:00,{},"AI's the boost filesystem branch contains 2 parts:
1) replace our filesystem.cpp with a boost based version (filesystem_boost.cpp) which supports utf8 on all systems. (that's in this pr)
2) make SDL use our filesystem functions (that's not in this pr)
in order to gain utf8 support on window we need both.

the filesystem_boost.cpp file replaces the filesystem.cpp but just like in ai's original branch this still leaves the original filesystem.cpp file so one can choose whether to compile filesystem.cpp or filesystem_boost.cpp. Thats also why i have less concerns abouth merging this untested (at lest not very tested by me) branch.

Also note that this doesnt contain updates to any other build mechanism than scons so and other build sytem will still use filesystem.cpp unless you change it manually.
"
22893672,fix bug 21400: image_icon being selected as default frame image,cbeck88,2014-10-16 23:09:20+00:00,2014-10-17 00:09:12+00:00,{},"This is the master branch version of PR #298 .
"
22831683,Clickable hyperlinks in gui2 labels,cbeck88,2014-10-16 04:17:23+00:00,2014-10-19 01:11:46+00:00,{},"This branch adds support to open hyperlinks that are sent in chat messages, or placed in add-on descriptions, and to render them as hyperliks.

More specifically, it adds link awareness as a property of all gui2 labels, including those in a scroll label, such as the chat history box or an add-on description. (In those cases it is enabled by default.)

A new `get_token` method is added to `font::ttext` objects, which dereferences a pixel location to a string index, using pango, and returns the largest token containing that character. Elaborating on this, a `get_link` method is added also which checks if the token looks like a hyperlink (starts with ""http://"" or ""https://""). `font::ttext` objects also have an added boolean property `link_aware`. This causes hyperlink tokens to be rendered as links, using a preprocessing step before passing the string to pango.

The gui2 tcanvas ttext object is configured to look for a `text_link_aware` property of text and to respect it when rendering, and gui2 `tcontrol` also gains a link aware property which indicates if its text should be link aware. gui2 `tcontrol` also exposes the get link and get token methods of its text.

Finally, gui2 `tlabel` is configured to be link aware, for the ""default"" definition values, and the left click handler asks the underlying `font::ttext` to dereference the click location to a url. If successful, it prompts the user if they would like to open the link. If they do, it runs `desktop::open_object(link)`, which on (all?) platforms should result in the default web browser being used to view the link. A right click handler is also added, which copies the link to the clipboard.

A parallel property `link_color` is also added, which permits the color of formatted links to be customized by label definition.
"
22727119,fix a check in move_unit,cbeck88,2014-10-14 17:10:05+00:00,2014-10-18 19:56:36+00:00,{},"The logic is supposed to be, if (x,y) == (prev_x, prev_y), then
skip the ""find_vacant_hex"" function call because we don't have to 
move. Instead we effectively had, if (x == prev_x OR y == prev_y), 
then we can skip that call.

This revises a commit
72f138c54414bc0349def0271ec1ccbad984a28b

in the hopes to fix a bug reported here:
http://forums.wesnoth.org/viewtopic.php?f=4&t=41084
"
22683603,fix bug 21400: unit::absolute_image being used for unit animations,cbeck88,2014-10-14 01:51:40+00:00,2014-10-17 00:10:55+00:00,{},"When an animation frame had no defined image, it was using ""absolute_image""
which yields the unit's `image_icon` if available, and `image` otherwise.

This causes undesirable behavior in cases highlighted by doofus1.

We fix it by replacing use of absolute image with an expression given by Coffee,
which prioritizes `image` over `image_icon`.
"
22612029,Mp ui sounds options,cbeck88,2014-10-12 04:40:22+00:00,2014-10-15 04:56:01+00:00,{},"These commits refactor the way mp ui sounds work, and create an options dialog to customize the behavior. Individual sounds for individual events may be enabled and disabled, and desktop notifications in response to these events may also be enabled or disabled. The user can also check to block notification of the events in the main lobby context.

Additionally, the mp ui sounds are set to be dynamically loaded at run time from the game_config.cfg file, so they may be changed easily without swapping out files or recompiling. The entries corresponding to each event are indicated by a tooltip in the lobby sounds options dialog.
"
22606927,Ai boost filesystem part 1 strict refactor,gfgtdf,2014-10-11 18:44:48+00:00,2014-10-14 15:19:12+00:00,{},"this is part 1 of AIs boost filesystem branch it is (except 65431971482b055d39f222e6c65318494729b66d) a strict refactor (renaming, moving of functions). Even though it does nothing (nothing that the user would notice) it causes the most merging conflicts so in order to not have to resolve them again, i think it's best to pull this into master now.

I had to rebase a lot of these commits in order to make every commit compilable then i merged the corresponding commits from AIs branch whith ""merge -s ours"" to make git know that it can treat those commits as merged. Since im not that much of a git expert i'd be happy if someone could rewiew it.
"
22562640,Fixed missing message in 'The Siege of Elensefar',abacabadabacaba,2014-10-10 14:09:08+00:00,2014-10-10 16:24:34+00:00,{},
22466283,fix default login on windows,gfgtdf,2014-10-09 01:13:54+00:00,2014-10-09 16:12:15+00:00,{},"getenv(""USER"") doesn't work on windows. Also winapifunctions use utf16 strings.
"
22445026,Add Utf16 conversion functions,gfgtdf,2014-10-08 18:46:33+00:00,2014-10-09 01:08:06+00:00,{},"adds utf16 -> utf32 and utf16 -> utf8 conversion functions.
"
22301727,Fix Bug 22251 (map labels not appearing in multiplayer),cbeck88,2014-10-06 17:56:26+00:00,2014-10-08 19:29:54+00:00,{},"**\* NOTE: This commit has not been adequately tested yet, and I don't understand _why_ it fixes the bug, only that it appears to. Please don't merge this yet. ***

This reverts commit 90501cf87254d3d87f876beb504f8734535d1dea.

This issue was bisected to this commit. This commit claims to just
be a harmless cleanup commit, but it completely breaks the map
labels, causing MP map labels not to be visible, and also breaking
the coloration. I'm not sure what assumptions in this apparently
inoccuous commit are wrong, but it seems that all of this is fixed
and nothing is lost by just reverting it.
"
22234368,Fix bug #22745: choose_track function crashes the game in certain cases,LovCAPONE,2014-10-03 22:39:04+00:00,2014-10-04 01:21:54+00:00,{},"This concerns https://gna.org/bugs/index.php?22745

In certain cases, in the function ""choose_track"" (sound.cpp"" member ""current_track_index"" can be greater than
""current_track_list.size()"" thus causing an ""index out of range"" error.

For more details see the bug report linked above.
"
21830409,Fix bug #22650: nontranslatable strings displayed in tooltips for terrain icons,LovCAPONE,2014-09-26 06:15:23+00:00,2014-10-04 01:39:25+00:00,{},"This concerns https://gna.org/bugs/index.php?22650

The string for the tooltip of the terrain icon was the underlying terrain id (same string as the one used to retreive the image). ""gamemap::get_terrain_string"" method is used as string for the tooltip in order to have a correct translatable string.
"
21797038,Don't generate mp data for start-of-scenario saves.,Rift-Walker,2014-09-25 17:00:42+00:00,2014-11-13 10:03:27+00:00,{},"https://gna.org/bugs/?22546
"
21629242,Fix bug #22628: status orbs wrong in replay if not side 1,LovCAPONE,2014-09-23 07:47:40+00:00,2015-06-22 17:34:12+00:00,{},"This concerns https://gna.org/bugs/index.php?22628

In the replay code, the viewing side was always set to 0 if it was a single player game.

Also, ""show_team_"" was replaced with the boolean ""is_multiplayer_"" as there was no reason to use an int in
this case.
"
21438335,remove replay viewer text label,cbeck88,2014-09-18 14:47:54+00:00,2014-10-06 19:02:50+00:00,{},"This label didn't seem to contribute much of anything, and it
caused big problems for translators because we don't have
dynamically resizing text labels, and that would have provoked
intractable layout problems anyways, so we decide just to remove
it and rely on the tooltips / media controller icons on the buttons
to tell the user what is going on.

See also discussion here:
http://forums.wesnoth.org/viewtopic.php?f=9&t=24598&start=120#p575851
"
21438320,remove replay viewer text label,cbeck88,2014-09-18 14:47:42+00:00,2014-10-06 19:02:34+00:00,{},"This label didn't seem to contribute much of anything, and it
caused big problems for translators because we don't have
dynamically resizing text labels, and that would have provoked
intractable layout problems anyways, so we decide just to remove
it and rely on the tooltips / media controller icons on the buttons
to tell the user what is going on.

See also discussion here:
http://forums.wesnoth.org/viewtopic.php?f=9&t=24598&start=120#p575851
"
21407282,"disable ""alpha thresholding"" in our bilinear interpolation algo",cbeck88,2014-09-18 01:25:13+00:00,2014-10-10 22:12:09+00:00,{},"In this commit from late 2005, boucman added a bilinear interpolation
routine for scaling images which we use everywhere.

https://github.com/wesnoth/wesnoth/commit/2df60619

It is a modified bilinear interpolation -- one of the tweaks is that
at the very end an ""alpha thresholding"" step occurs. If the alpha
of a pixel is less than half of the average alpha of its neighbors,
it is discarded and set to fully transparent. Boucman writes that
this was done to combat a gametime artifact that would occur when
moving the hexagonal selector around with the mouse -- however, it
creates a small loss in image quality. Boucman writes that skeleton
archer bowstrings don't look as good -- I notice also that the edges
of the wings of drakes seem a bit sharper / more pixelated somehow.

In this commit I tried disabling the alpha thresholding, since the
way that the hex selector works has been changed since 2005, so this
might no longer be an issue. Sure enough the ""hexagonal haloes"" are
gone now, so it seems that we can safely get rid of the alpha
thresholding.
"
21199482,automatically download needed addons in mp lobby,cbeck88,2014-09-14 01:54:44+00:00,2015-03-15 17:40:02+00:00,{},"*\* Experimental **

A new feature: If one cannot join a game in the mp lobby because of missing addons, prompt the user to try to download those addons and whatever dependencies they have.

Four parts:
1.) Refactor some of the addon client code so that there is a simple ""try to fetch and install this addon"" function.
2.) In the game config manager, annotate certain top-level tags ""era"" and ""modification"" with ""addon_id"" attributes (generally, the addon folder name).
3.) In saved_game::expand_mp_events, when iterating over the mods and eras, also take note of their addon_id, and add these to a comma separated list in mp_game_settings, ""addon_ids"". Indirectly, this results that [multiplayer] tags now have an ""addon_ids"" attribute which becomes part of the server-side [game] children of [gamelist] and are sent to clients in the lobby.
4.) In the mp lobby, add methods to check if we are missing addons for the currently selected game, and if we try to join or observe it, then prompt the user whether to try to download these, using the ""ad hoc"" addon download session function from step 1.

Issues:
- I don't know if I think that step 2 should be done differently, it might be nicer to do this earlier in the process, because it could get confusing if someone works at an earlier part and expects to find these addon_ids. It was much easier to add this in at game config manager than in the preprocessor somehow though. 
  
  It also means that, what is represented in the cache is not _exactly_ faithful to what configs are ultimately generated...
- When I started working on this, I didn't know about ""require_scenario = yes"", I thought that only mods and eras could require a download generally. But the code in step 4 in the mp lobby makes this clear, so probably should go back and fetch the addon ids for that as well.
- Get addon versions as well as ids? I didn't do this in part yet...
"
21083449,allow chat_log to be opened even when not in networked games,cbeck88,2014-09-11 12:17:00+00:00,2014-09-21 21:21:47+00:00,{},"This is the master branch version of PR #282. (not merged yet in case of objections)
"
21083224,allow chat_log to be opened even when not in networked games,cbeck88,2014-09-11 12:12:30+00:00,2014-09-21 21:21:31+00:00,{},"I would like to merge this to address issue #5 reported by Bob_the_mighty here:
http://forums.wesnoth.org/viewtopic.php?f=5&t=40745#p575541

Please voice any objections to this.
"
21031478,dont delete a side from carryover if it came back to life,gfgtdf,2014-09-10 16:07:42+00:00,2014-09-20 20:41:13+00:00,{},"the previous behaviour was inconsitent, since [team]lost= wasn't read when loading a savegame. So this doesn't break previous behaviour.

This especialy fixes the scenario ""Stolen Gold"" from ""Northern Rebirth"" (http://gna.org/bugs/?22601)
"
20547012,New lua kernel,cbeck88,2014-08-31 16:20:55+00:00,2014-12-03 01:35:39+00:00,{},"**\* Experimental, no merge please ***

See here for description: http://forums.wesnoth.org/viewtopic.php?f=2&t=40934
"
20214201,Map generator refactor,gfgtdf,2014-08-23 21:53:10+00:00,2014-08-26 21:36:58+00:00,{},"the intentions/plans are:
1) fix the 'single use' cave map generator to work in mp.
we fix this by splitting the cave_map_generator into 
cave_map_generator and cave_map_generator _job from which the later is a temporary object used during generate_scenario/map

2) allow to pass a (platform independent) seed to all map generators, this is not completely implemented yet. I implemented this for the cave_map_generator_job and it was already implemented for the yamg. Is still needs to be implemented for the default_map_generator
"
20183508,Fixed bug #22324: team name in turn dialog untranslateable.,LovCAPONE,2014-08-22 16:53:56+00:00,2016-03-15 22:52:51+00:00,{'Bug': 1},"This concerns https://gna.org/bugs/index.php?22324

In the turn dialog, instead of using the ""current_player"" attribute of the side tag, we use the name of the current side leader (the same string used in the status table). This string is translateable.
"
20183195,Fix bug #22465: Minimap not redrawn after turn dialog.,LovCAPONE,2014-08-22 16:48:16+00:00,2014-09-05 19:50:35+00:00,{},"This concerns https://gna.org/bugs/index.php?22465

In playsingle_controller::show_turn_dialog added a call to redraw the minimap in addition to the call to redraw
everything.
"
20179078,Fix16075,gfgtdf,2014-08-22 15:36:55+00:00,2014-08-23 17:19:40+00:00,{},
19689758,Fix bug #22443: Scenario Settings table has inaccurate Start Gold info in certain cases,LovCAPONE,2014-08-12 21:05:17+00:00,2014-10-08 00:48:39+00:00,{},"This concerns https://gna.org/bugs/index.php?22443

In the method play_controller::fire_start, added start gold amount update for all teams. This makes the start_gold initialization in team::team_info::read useless.
"
19635124,Update Spanish translations,jorge-barroso,2014-08-11 23:42:01+00:00,2014-10-22 15:54:04+00:00,{},"Some translations were a bit hard to understand or not fully correct, this in, in my opinion, the full translations with the corrections I thought necessary
"
19631016,Update es.po,jorge-barroso,2014-08-11 22:03:53+00:00,2014-10-22 15:53:59+00:00,{},"Little updates of (just in my opininion) some improvable translations
"
19629894,Update es.po,jorge-barroso,2014-08-11 21:43:22+00:00,2014-10-22 15:53:53+00:00,{},"Little updates of (just in my opininion) some improvable translations
"
19628426,Update Spanish translation,jorge-barroso,2014-08-11 21:18:45+00:00,2014-10-22 15:53:22+00:00,{},"Some updates in spanish translations, hope I'll be able to finish it soon, just to support the project in the way I am able to.
"
19492045,"First attempt at https://gna.org/bugs/?9354 , create single move option in replay mode",Zappaman,2014-08-07 20:25:50+00:00,2014-08-29 19:37:02+00:00,{},"I've been trying my hand at this for some time now, but I've hit a sort of dead end here. I've created this pull request to show the work I've done so far, and to ask for advice on how to tackle the issue further, if someone has the time and patience to help me out a bit here.

To show what I've tried, I've altered the behavior of 'play side' button, to play only a single move, (treats only ""move"" or ""recruit""). It works for a while, but the thing is, after a few iterations, the replay breaks, saying it is corrupt. 

I suspect I am not treating the actions exhaustively, but I've also seen that the return values of do_replay_handle() are used in playturn.cpp, in turn_info::replay_to_process_data_result, to return some other specific flags (PROCESS_CONTIN|UE, PROCESS_FOUND_DEPENDENT) . I'd like to know how those return values are used more exactly, and what exactly the implications of adding another option are(RETURN_FOUND_END_MOVE I called it there).

The way this mechanism works is a bit foggy for me right now, if someone could please give me some hints on the matter so I know what approach I should take next, I would be very grateful.
"
19473346,Fix bug #22306: move_unit moves a unit even when it shouldn't,LovCAPONE,2014-08-07 15:15:19+00:00,2014-09-05 20:56:21+00:00,{},"This concerns https://gna.org/bugs/index.php?22306

Modified the lua script for wml_action.move_unit. In the loop to check for vacant tile, if the current location
is equal to the previous location we don't look for a vacant tile since our location is free (where we are).
"
19383777,scons: improve dependencies detection on Windows (MinGW),techtonik,2014-08-06 03:56:46+00:00,2014-08-19 15:57:03+00:00,{},"This PR makes SCons run all checks before failing and reports all checks result in one run. Previous behavior was to run until the first fail. This helps to resolve problems in one iteration, especially if you ask help remotely.

PR also changes the order of checks, so that the C++ compiler is checked before trying to compile SDL. This makes people like me, who don't possess knowledge about different C++ tools spend less time on troubleshooting compilation issues.
"
19363506,Fix travis gcc build,Rift-Walker,2014-08-05 19:24:19+00:00,2014-08-06 04:10:26+00:00,{},"This reverts commit c9c75e9933c2b94cd7a965200eae42970b541867.

the -O2 flag causes gcc to fail with the error:

src/replay.cpp: In function ‘void verify(const unit_map&, const config&)’:
src/replay.cpp:62:13: internal compiler error: Segmentation fault
"
19312946,Sp advanced settings,Rift-Walker,2014-08-04 22:50:55+00:00,2014-08-13 18:44:59+00:00,{},
19259722,"add music shuffle, second attempt at https://gna.org/bugs/?19653 ",Zappaman,2014-08-03 21:48:52+00:00,2014-08-10 12:15:15+00:00,{},"This pull request is my second attempt at https://gna.org/bugs/?19653 , taking into consideration all the previous discussions from https://github.com/wesnoth/wesnoth/pull/255  and suggestions given by Soliton and zookeeper. 

I decided to start a new pull request, and close the old one ( https://github.com/wesnoth/wesnoth/pull/255 ) for two reasons: the main one is that the other pull request got really messy and secondly, I changed the implementation altogether in my last commit there, so I figured a new pull request would make sense.

Each [music] WML tag gets the option to include the [shuffle] key or not. This key refers to each music track individually(not including the shuffle key defaults to shuffle=yes, because that was the previous behaviour). The steps in choosing a new track are the following:
- In the beginning an external index, current_track_index, referring to the position of the current track in the playlist, is initialized to 0. ( Sadly, I couldn't see a way to avoid this being external to sound::music_track; adding a field to the class meant that somewhere, probably in play_music_config, that field had to be set to a counter which in turn, had to have global scope, and fulfill an identical role ). If current_track_index exceeds the size of the playlist, it resets to 0.
- After the playlist is made, every time choose_track is called, we look at the element at current_track_index in the current playlist and: 
       - If it has ""shuffle"" on it, then we randomly choose a track, just like we would normally do, say track at position x in the playlist, return it and play it; the track to be inspected in the next iteration shall be the x + 1'th (current_track_index = x + 1) 
       - if it doesn't have ""shuffle"" on it, then we simply return it, play it, and increment the current_track_index.

This works regardless of whether the [music] tags are enclosed in an [event] tag or not.

Again, I'm open to any suggestions, any feedback is appreciated!
"
19258329,implement pre_advance event,gfgtdf,2014-08-03 19:09:21+00:00,2014-08-05 20:25:33+00:00,{},"pre advance event fires before the user sees the advancement dialog.
Implements fr https://gna.org/bugs/?21464
"
19242914,"In the dialog layout code, fixed the button padding for the bug #22379",LovCAPONE,2014-08-02 04:40:41+00:00,2014-10-04 13:36:14+00:00,{},"This concerns https://gna.org/bugs/index.php?22379 (Top of buttons in statistics dialog cut off)

There was no check if the ""text_and_image_height"" variable was equal to zero. If so, the buttons were placed 6 units too high.
"
19189111,Modified the game state inspector for the bug #22337,LovCAPONE,2014-08-01 01:25:24+00:00,2014-10-06 22:55:11+00:00,{},"This concerns https://gna.org/bugs/index.php?22337 (Bug in inspect long array)

To fix this bug, in this code when an array is more than 20000 characters, its label on the left-side of the inspect dialog is duplicated for the number of ""pages"" that needs to display its content.
"
19174637,Updated the Galician (gl) translation,Gallaecio,2014-07-31 19:57:18+00:00,2014-10-10 15:56:52+00:00,{},
19002655,Added preference to disable automatic movements at the begining of turn,LovCAPONE,2014-07-29 00:36:27+00:00,2014-09-12 16:55:07+00:00,{},"It was a feature in the ""Engine related features"" of the EasyCoding section
"
18886922,Get rid of duplicate bigmap macros,aquileia,2014-07-25 09:51:22+00:00,2015-01-13 03:23:10+00:00,{},"All mainline campaigns that currently use bigmaps are handled now.
"
18688089,partly revert e454252f2,gfgtdf,2014-07-22 00:01:26+00:00,2014-07-29 19:34:11+00:00,{},"there are multiple reasons why i think this should be reverted:
1) this wasn't tested enough, especialy we don't even know, whether all mainline campaigns are compatible
(this can be easily fixed, but only if one know which campaigns are effected which requires testing)
2) after renaming remove_from_carryover_on_leaders_loss to remove_from_carryover_on_defeat it sounds wrong that this can result in removing units on victory.
3) this seemed to break many UMC addons.

Note that this only removes one check for defeat_condition before [endlevel].
Especialy if for example side 1 gets defeated by defeat_condition in turn 1 but the game still goes on due to multiple other non defeated sides, but then the game ends with [endlevel] result=victory in turn 2, the units will be removed from carryover (unless specified otherwise)
This was also the pre 1.11.13 behaviour.
Also note that we cannot remove the 'defeated' side in case of [endlevel]result=victory, becasue [endlevel] doesn't sepcify which sides have victory/defeat.
"
18627140,add remarks about the illuminated underground Times of Day to help,cbeck88,2014-07-20 06:13:18+00:00,2015-03-22 19:08:38+00:00,{},"I'm not sure if this stuff actually belongs on this page, because
this page is very fundamental, and this is added detail that may
distract of confuse a beginner. But I think these remarks belong
somewhere in the help, just so that the pictures are explained,
even if this page isn't the right place.

Crits welcome of course.
"
18625908,revert movement of unit alignment init to initializer list,cbeck88,2014-07-20 01:59:07+00:00,2014-07-20 22:23:29+00:00,{},"**\* Please don't merge! This appears to break something. ***

This change was suggested by gfgtdf, it partially reverts

https://github.com/wesnoth/wesnoth/commit/30c179b92da29bb03541e8e0c7dfaf1c3c401b35#diff-af3fd7e884f8ab9f39f9088ca4010d0dR1738

It fails unit tests on my machine and so I don't think it should
be committed.
"
18624974,support for shuffled music playlist . Attempt at https://gna.org/bugs/?19653,Zappaman,2014-07-19 23:06:03+00:00,2014-08-03 20:44:07+00:00,{},"This is my first attempt at https://gna.org/bugs/?19653 .

What I did to implement the desired functionality:
- added code to treat another key in the [music] tag, namely ""shuffle"". Possible values are ""yes"", and ""no"", any other value is completely ignored. Whenever you add the shuffle key with a value of ""no"", the current track list will play in order. The default behavior is to shuffle.
- replaced the local variable ""track"" with a global track counter; this counter is incremented only when shuffle is off, and choose_track() is called. This way, every time a new track is to be chosen, the ""next"" track in the list is played. The counter resets when the entire list has been played.

Just to illustrate the functionality, I decided to add the ""shuffle"" key in the default music playlist macro. I'll remove it eventuality.

Any kind of feedback or advice on what could be done to improve this would be greatly appreciated.

Thanks in advance!
"
18624485,Config converters,cbeck88,2014-07-19 21:52:26+00:00,2015-09-30 20:17:50+00:00,{},"*\* Please don't merge, this is still a draft. **

This commit adds a macro ""CONFIG_CLASS"", the idea is to create a syntax to define a struct which can be converted to and from a config, and where each member's declaration specifies how it is converted to and from a config attribute. It enforces that attributes should correspond to a member variable of the same name with an underscore appended. 

This macro might be useful to ease the creation of classes / structs like team::team_info. This is a good thing because, while configs are convenient to use and easy to extend, they are much bigger and slower than structs, and errors resulting from misnamed identifiers / typos become runtime errors instead of compile time errors. 
"
18615204,add healthy and fearless [effect]s,gfgtdf,2014-07-19 00:20:58+00:00,2014-07-19 21:59:36+00:00,{},"so we don't have to treat these traits specialy.
"
18586864,Update projectfiles,aquileia,2014-07-18 13:57:15+00:00,2014-07-19 08:09:29+00:00,{},
18453461,"Add defense caps for mushroom terrain type, tweak some fluff",cbeck88,2014-07-16 07:39:55+00:00,2014-07-23 07:05:00+00:00,{},"*\* Note: Please don't merge this, this is being actively discussed on the forums. This is not even my favored way to resolve the issue, its just a way to see hands on what the new settings / help descriptions might look like with such a change. **

This Pull request adds negative defense modifiers to fungus, (thus establishing
a defense cap for mushroom mixed terrain types) for Dwarves,
Gryphon Riders, and Loyalist and Khalifate cavalry.

Pretty much it works along the lines I suggested here:
http://forums.wesnoth.org/viewtopic.php?f=15&t=40753&sid=5f6460f6567081ae62d5c9d0cf80357f#p573355

It also updates the ""fluff"" associated to fungus terrains to explain
in a different manner why dwarves and gryphon riders are weakened
here.

Feedback is very much welcome.

One extension of this which appeals to me is to also add negative modifiers
for the ""swimmer"" type, thus giving all mermen poor defense on mushrooms.
This might make swamp+mushroom a more interesting terrain type, as most
land units and mermen would be very weak and slow there but saurians 
would be fast and strong. However this change isn't strictly important for
balancing out the (Flat / Hill / Cave) + Mushroom so it isn't included here.
"
18331659,Changelog update,ancestral,2014-07-14 04:45:22+00:00,2014-07-14 05:52:06+00:00,{},"Changelog update for pull request #240.
"
18331564,Changelog update,ancestral,2014-07-14 04:38:28+00:00,2014-07-14 05:52:17+00:00,{},"Changelog update for pull request #239.
"
18325273,check lobby_sounds preference for the GUI 1 lobby also,cbeck88,2014-07-13 17:35:50+00:00,2014-07-14 06:15:32+00:00,{},"fixes a bug reported on forums here:
http://forums.wesnoth.org/viewtopic.php?f=4&t=40660#p572131
"
18314680,"Add command mode access from context menu, alternative",Zappaman,2014-07-12 14:46:45+00:00,2014-07-16 05:04:55+00:00,{},"This patch implements the first feature presented in the ""Engine related features"" section, from here: http://wiki.wesnoth.org/EasyCoding
To implement this feature, I added the command field in the configuration for the context menu.

This comes as an alternative to https://github.com/wesnoth/wesnoth/pull/246
"
18313749,add command mode access from context menu,Zappaman,2014-07-12 12:34:35+00:00,2014-07-12 21:17:19+00:00,{},"This patch adds a feature mentioned in http://wiki.wesnoth.org/EasyCoding,
namely the first one in ""Engine related features"".
To do this I've added a new hotkey command, COMMAND_MODE, and edited the corresponding
config and source files.
This could have been done more easily by simply adding the pre-existing 'command' field
in the context menu configuration in defaults.cfg, but that would have meant using the string ""Enter user command"" in the context menu; I thought that another string, ""Command mode"" is more suitable.
"
18305633,use animation speed set in preference for wml [delay] tag,cbeck88,2014-07-11 22:32:28+00:00,2015-04-05 23:36:59+00:00,{},"This addresses a bug report #21335 https://gna.org/bugs/?21335
"
18198029,revert PR 98,cbeck88,2014-07-10 02:31:24+00:00,2014-08-28 20:57:49+00:00,{},"This is a parallel commit to PR 243, on master instead of 1.12
branch.

The commit is significantly different because this feature got
swept up in a different refactor of playcampaign / carryover. I
didn't test the feature extensively on this branch, this might not
be necessary at all. I'm simply making the sister commit anyways
so that we have something concrete to discuss when deciding
whether to merge either or both of these pull requests.

I do think the feature is of questionable value and adds
complexity to an already confusing part of the engine, and should
therefore be considered for removal.
"
18197627,revert PR 98,cbeck88,2014-07-10 02:11:35+00:00,2014-08-28 18:33:44+00:00,{},"This commit removes the ""carryover_wml"" feature which was added
just before 1.12 was branched off.

I added this feature at a time when I didn't have as good an
understanding as I do now of the networked mp code, I now believe
that it was poorly concieved and should not be implemented this
way if at all. There are better ways to achieve what was meant to
be achieved here, we are better off to remove it as it currently
exists.
"
18190871,Merge single- and multi-player codepaths,Rift-Walker,2014-07-09 22:29:23+00:00,2014-07-14 18:08:33+00:00,{},"This PR contains a fully functional implementation of sp campaigns using the mp create, configure, and connect engines. There should be no noticeable change to gameplay. Code for launching singleplayer games (handling the engines) is contained in singleplayer.*pp, similarly to multiplayer.
Once this is merged, we can begin to introduce some mp-specific options (eras, observers, etc) to sp. My plan is to make these available through an ""Advanced Settings"" dialog accessible from the current sp campaign selection dialog.
"
18054249,Sdl r wops 1.12,AI0867,2014-07-07 16:28:02+00:00,2014-10-26 16:36:43+00:00,{},"Backport of PR #155
"
18029035,Updated default window size for Macs,ancestral,2014-07-07 06:54:52+00:00,2014-07-07 14:50:00+00:00,{},"Make the default window size 800 x 600 for Macs. This is a workaround for bug #20332.
"
18029013,Updated default window size for Macs,ancestral,2014-07-07 06:54:17+00:00,2014-07-07 14:49:50+00:00,{},"Make the default window size 800 x 600 for Macs. This is a workaround for bug #20332.
"
18026052,"add [has_ally],[has_enemy] tags for standard side filter",cbeck88,2014-07-07 03:54:05+00:00,2014-07-12 15:14:10+00:00,{},"I wrote an email about this to the dev-list, please don't merge unless that is resolved.

This is intended as a bugfix for [allied_with], [enemy_of] tags.

See forum post for background: http://forums.wesnoth.org/viewtopic.php?f=21&t=40702
"
18026042,[filter_vision] tag should return true if *any* viewer matches,cbeck88,2014-07-07 03:52:57+00:00,2014-07-12 15:14:10+00:00,{},"I wrote an email about this to the dev-list, please don't merge unless that is resolved.

This is intended as a bug fix for the [filter_vision] tags in standard unit and standard location filters.

See forum post for background: http://forums.wesnoth.org/viewtopic.php?f=21&t=40702
"
18017810,Fix :n debug command,aquileia,2014-07-06 12:14:00+00:00,2014-07-06 15:04:25+00:00,{},
18011256,"tiny VC update, typo fixes",aquileia,2014-07-05 15:57:01+00:00,2014-07-05 21:18:56+00:00,{},
17921901,fixup lines with two closers on a line in wml test directory,cbeck88,2014-07-03 01:30:05+00:00,2014-07-03 23:39:17+00:00,{},"Note: Please don't pull unless some of the other bugs in wmlindent have been fixed and
will give good output

wmlindent chokes on these

commit made with the following command:

find data/test/scenarios/ -type f -print0 | xargs -0 sed -i
""s|^([[:space:]]_[\/._])[[:space:]]_)}[[:space:]]_$|\1\n)}|""
"
17835605,Eastern Invasion: Polish translation update (master),pjackowski,2014-07-01 15:03:49+00:00,2014-07-02 15:54:27+00:00,{},"Minor corrections.
"
17835303,Eastern Invasion: Polish translation update (1.12),pjackowski,2014-07-01 14:58:59+00:00,2014-07-02 15:54:25+00:00,{},"Changes:
- backported major, Polish translation update from master
- fixed typos
"
17748882,refactor Game variables,gfgtdf,2014-06-29 17:29:06+00:00,2014-07-05 01:37:27+00:00,{},"we try to resolve dependedcies game_data/game_varibles
we now use c++ const correctness to ensure not to write the game variables if we juts want to read them
we improve the performance of wesnoth.set/get_variable, espacialy for explicit indexes.
in order to do that we rewrite variable_info class.
"
17748008,Polish translation update,aquileia,2014-06-29 15:41:39+00:00,2014-07-02 14:51:29+00:00,{},"Backport some commits from master that fatality hopes to see in the next release.
"
17743538,add adv. preference for number of menu items displayed at once,cbeck88,2014-06-29 02:20:39+00:00,2014-07-07 18:09:46+00:00,{},"Not completely sure if this is necessary, but various people have expressed varying opinions about how this should work, what is most comfortable for machines with large screens vs small screens etc.

The purpose is that, we are making an effort to support having lots of add-ons active simultaneously, and then the number of wml item slots becomes a scarce resource, so we want to mitigate that and make it not a concern.

See earlier commit: f24f6adee142c088595647d5506737c48892bf38

Forum discussion: http://forums.wesnoth.org/viewtopic.php?f=6&t=40668
"
17719093,Fix the linking error found in the last commit.,Aishiko,2014-06-27 18:46:48+00:00,2014-06-27 18:47:11+00:00,{},"The error was caused by forgetting to add the new file to the
CMakeList.txt file.  It was then found that the new file did not
compile because of non matching variable names, those were changed
so they match.  Lastly a comment asking for reveiw/help finding the
issue was removed from unit_types.cpp as it is no longer an issue.
"
17708808,Spritesheet,Aishiko,2014-06-27 15:25:10+00:00,2014-06-27 15:26:32+00:00,{},"Add WML parsing of the unit's spritesheet similar to the portraits at unit load time.
"
17706173,"add operators == (attribute_value, std::string)",gfgtdf,2014-06-27 14:39:36+00:00,2014-06-27 20:33:42+00:00,{},"previously comparisions like c[""a""] = ""b"" were evaluated by 
inline bool operator==(const std::string &a, const t_string &b) 

by casting atribute_value to std::string, and const char \* to t_string

we fix this by adding explicit equality operator for these cases.

Not creating t_string also results in significant preformance improvements in some cases.
"
17661777,Fix memory leak in wesnothd,AI0867,2014-06-26 17:39:53+00:00,2014-07-01 01:49:47+00:00,{},"Another possible part of [bug #21267](https://gna.org/bugs/?21267).
"
17657799,Fix a memory leak in forum_user_handler,AI0867,2014-06-26 16:18:59+00:00,2014-07-01 01:51:08+00:00,{},"I don't have the setup to actually test this, but I suspect it will fix (part of) [bug #21267](https://gna.org/bugs/?21267).
"
17568827,don't ignore [advancement] on unit construction.,gfgtdf,2014-06-25 02:18:45+00:00,2014-06-25 13:55:36+00:00,{},
17539105,*DONT MERGE* Factor out the unit_pod from unit_map,cbeck88,2014-06-24 15:37:33+00:00,2015-09-30 20:15:49+00:00,{},"This commit attempts to cleanup and simplify the unit_map
further. After this commit, unit_pods are removed and 
instead the unit_map is based on the ""universal"" reference
counted pointer (UnitPtr).

However this also changes the guarantee of iterators and
when they are invalidated. Formerly, iterators _never_
invalidate. After this commit, they never invalidate for
_dereference_ but they may invalidate for increment
if the unit they refer to is extracted from the map. Thus
code along the following lines:

BOOST_FOREACH( unit & u , *resources::units ) {
    if (...) {
        resources::units->extract(u.get_location());
        ...
    }
}

will likely segfault, because it does not ""preincrement"" the iterator before deleting the object.

The unit_pod system effectively prevented any deletions from occurring in the unit_map
internal data structures until there are no iterators pointing at the relevant node. Some kind
of reference counting is probably necessary for this behavior, so the approach here should
perhaps be reconsidered.
"
17512321,Fix openMP build,aquileia,2014-06-24 04:14:36+00:00,2014-06-24 07:43:11+00:00,{},"Tested to compile on VC12 with openMP activated.
"
17452968,delete the whiteboard,cbeck88,2014-06-22 23:23:13+00:00,2014-06-29 20:05:32+00:00,{},"This commit deletes the whiteboard source code, then fixes up
the various references and project files. This is simpler than
deleting references piecemeal, because it turns out that the
whiteboard code was used sublty in many different places and
could be activated or triggered by hotkeys in several different
ways.

I'm proposing this is because of
- bug reports about assertion failures
- performance problems -- I tested both master and 1.12 branch and 1.11 series dating back to January 2014, and whiteboard moves no longer work fully, which was the most important part of the feature. It seems that the ""future_map"" which is supposed to control alternations of the gamestate from with planned moves / without planned moves is no longer working, so units with planned moves cannot be selected or moved properly.
- graphical glitches -- the ""ghosted"" unit standing animations are corrupted and twitch continuously while units with such animations have planned moves

https://gna.org/bugs/index.php?22231
https://gna.org/bugs/?func=detailitem&item_id=21302

I suggest that we might look towards restoring the whiteboard in version 1.14, if we can reimplement it in a more robust / maintainable manner, and with sufficient unit tests to help prevent it from breaking in the future

Note: This replaces PR #219
"
17451691,disable activation of the whiteboard,cbeck88,2014-06-22 20:39:16+00:00,2014-06-22 23:24:36+00:00,{},"I'm proposing this is because of
- bug reports about assertion failures
- performance problems -- I tested both master and 1.12 branch and 1.11 series dating back to January 2014, and whiteboard moves no longer work fully, which was the most important part of the feature. It seems that the ""future_map"" which is supposed to control alternations of the gamestate from with planned moves / without planned moves is no longer working, so units with planned moves cannot be selected or moved properly. 
- graphical glitches -- the ""ghosted"" unit standing animations are corrupted and twitch continuously while units with such animations have planned moves

https://gna.org/bugs/index.php?22231
https://gna.org/bugs/?func=detailitem&item_id=21302

I suggest that we might look towards restoring the whiteboard in version 1.14, if we can reimplement it in a more robust / maintainable manner, and with sufficient unit tests to help prevent it from breaking in the future
"
17450770,*DO NOT MERGE* Added 'faction_lock' and 'leader_lock' for MultiplayerWML.,andrius-sil,2014-06-22 18:46:18+00:00,2014-06-26 20:46:43+00:00,{},"These attributes work similarly as all other lock attributes such as
'gold_lock': 'faction_lock' locks faction selection, while 'leader_lock' locks
both leader and its gender selections.

These attributes were added to fix #21978.
"
17449797,Grammar: missing preposition in tutorial 1 victory,AlainODea,2014-06-22 16:38:15+00:00,2014-06-23 01:37:04+00:00,{},
17444041,"Add define functionality to scenarios, eras, and mods",Rift-Walker,2014-06-21 23:49:58+00:00,2014-06-25 07:20:39+00:00,{},"This pull request extends the define= system, currently used in campaigns, to multiplayer scenarios, eras, and mods. The system is intended to defer loading sections of config until they are required (when a level is selected). As a result, less config is loaded at mp_create, and less unnecessary config is floating around, taking up memory and namespace in multiplayer.
Note that if defines change: that is, if a level is loaded which has a non-empty define attribute, all config will be reloaded, including any level-specific config inside of #ifdef statements. If none of the levels, eras, or mods being loaded use defines, config will not be reloaded. This system should be implemented by UMC devs on a case-by-case basis dependent on the size of the level, whether it is having namespace conflicts with another level, etc.

EDIT: New mergeable branch 6/21
"
17443318,Hotkey scopes,gfgtdf,2014-06-21 21:55:10+00:00,2014-06-23 16:01:47+00:00,{},"the first ""add_const"" commit was accidentyl added here, you can ignore it.

WIP
"
17438739,Update VC project,aquileia,2014-06-21 11:50:54+00:00,2014-06-21 11:59:39+00:00,{},
17421963,Map overlays for mainline campaigns,aquileia,2014-06-20 18:56:31+00:00,2014-06-25 06:11:20+00:00,{},"Delete the unused localized map overlays for the old style maps, leaving only the titlescreen (as it is in core, UMC might use it). This saves about 5 MB on the mainline campaigns.

Move those currently without replacement to wesnoth/resources so that translators have a reference.

Add a full set of German overlays for the new bigmaps.
"
17415278,"Sample ""include-what-you-use"" results",cbeck88,2014-06-20 16:37:53+00:00,2014-07-07 18:01:46+00:00,{},"This shows example output of the ""include-what-you-use"" tool on the wesnoth project.

The tool removes unnecessary headers, and ensures that each file actually includes / forward declares what it needs.

I stopped it after it ran through most of the ""a"" files, so about 70 files.
After I had to fixup some things in AI, I made a 3 line script that does this, after the iwyu tool runs.
"
17368418,Spritesheet Initial commit,Aishiko,2014-06-19 18:43:16+00:00,2014-06-19 18:45:47+00:00,{},
17328998,change fake_unit class to fake_unit_ptr,cbeck88,2014-06-19 01:08:43+00:00,2014-06-23 15:22:23+00:00,{},"WIP
"
17310808,use UnitPtr (intrusive_ptr) in unit_animations,cbeck88,2014-06-18 18:33:02+00:00,2014-06-18 20:04:17+00:00,{},"In this commit the unit \* in unit_animation is changed to a smart
pointer. This is to prevent the unit_map or some other object
from destroying the unit and creating a dangling pointer
(reported to cause segfaults).

In this commit, we also change the fake_unit class to make sure to
increment the refcounter when the fake_unit is constructed. The
reason is that the fake_unit holder is supposed to own that unit
and let it expire when it goes out of scope. No smart pointer is
supposed to delete it.

This mechanism should possibly be revisited, for example the
fake units could also be held in a reference counted pointer.
With the current system it is still possible that the fake_unit
will go out of scope and be destoryed while the animation is still
alive, this change only prevents smart pointers from destroying it
before it goes out of scope.

I also comment out the reentry_preventer class uses in
unit_animation.cpp, to prevent assertions from happening when I
test for example with the ""double debug kill"" version of the bug.
The reentry_preventer seems to be unnecessary now.

This addresses bug #18921 and maybe others.
"
17305591,add recall list manager,cbeck88,2014-06-18 16:55:02+00:00,2014-06-18 17:54:29+00:00,{},"This commit adds a dedicated recall list manager class.

The purpose of this is to
- Simplify the code that interacts with the recall list. Prior to
  the commit most such code was based on iteration with explicit
  iterators, and called global helper functions implemented in
  unit.cpp to wrap the code that finds a unit in a vector. It turns
  out that interacting with the recall list was the _only_ use of
  that code, so we make it a member function of the recall list
  manager and take it out of unit.cpp.

Most of the code that touches the recall list was previously
7 or 8 lines with a for loop, now it tends to be 1 or 2 lines,
although further refactor may be possible.
- Improve encapsulation. This makes it possible to track how
  other classes are interacting with the recall list, and may
  make it easier to debug recall list problems by adding debugging
  output to the class.
"
17272242,Fix VC and OpenMP build,aquileia,2014-06-18 02:09:50+00:00,2014-06-20 09:38:22+00:00,{},"Original commits were rebased and force pushed
"
17156207,Reference count units TEST,cbeck88,2014-06-15 21:03:36+00:00,2014-06-25 07:21:57+00:00,{},"This is a test to see if, after deleting the last commit, this branch ( #205 ) also causes gcc 4.6 to segfault
"
17154528,Reference count units,cbeck88,2014-06-15 17:41:32+00:00,2014-06-15 19:06:18+00:00,{},"In this branch we aim to refactor all of the engine modules that hold pointers to units, to hold reference counted pointers (boost::intrusive_ptr) instead, and refactor the animation module to use this, so that it will not segfault when a unit is destroyed.
"
17145641,Merge all remaining .gitignore files,aquileia,2014-06-14 18:13:18+00:00,2014-06-15 18:29:46+00:00,{},
17140981,"Add define functionality to scenarios, eras, and mods",Rift-Walker,2014-06-14 07:08:15+00:00,2014-06-21 23:50:21+00:00,{},"This pull request extends the define= system, currently used in campaigns, to multiplayer scenarios, eras, and mods. The system is intended to defer loading sections of config until they are required (when a level is selected). As a result, less config is loaded at mp_create, and less unnecessary config is floating around, taking up memory and namespace in multiplayer.
Note that if defines change: that is, if a level is loaded which has a non-empty define attribute, all config will be reloaded, including any level-specific config inside of #ifdef statements. If none of the levels, eras, or mods being loaded use defines, config will not be reloaded. This system should be implemented by UMC devs on a case-by-case basis dependent on the size of the level, whether it is having namespace conflicts with another level, etc.
"
17028317,Update VC project,aquileia,2014-06-11 22:32:59+00:00,2014-06-12 02:57:15+00:00,{},
17005871,change saved_game & savefile format,gfgtdf,2014-06-11 15:45:44+00:00,2014-06-15 16:13:06+00:00,{},"The main intentions of this patch are:
1) To remove redundant information in savefiles
2) To fix mp/sp bugs: ""modification [event]s wont be reaplied if one advances from a mp game (also if it was reloaded from sp that was reloaded in sp)""
3) To fix ""start-of-scenario mp saves are broken""
4) Clear up playcampaign.cpp s code

This patch changes the wesnothd server protocoll causing incompability with oder version regarding networked mutiplayer 

Also between some commits in this pr some mp related things will not work.
"
16957957,move next_underlying_unit_id + game_state refactor,gfgtdf,2014-06-10 18:51:03+00:00,2014-06-10 21:13:30+00:00,{},"from savefiles toplevel to savefiles [snapshot]/[replay_start]/[carryover_sides_start]
previously this was handled specialy at scenario toplevel sometimes and in those tags at some other times.

accoringly to that change we now set n_unit::id_manager at play_controller s constructor.
"
16867854,Restructure and merge .gitignore files,aquileia,2014-06-08 23:18:08+00:00,2014-06-13 14:27:01+00:00,{},"Remove about 125 .gitignore files and 25 remove-potcdate.sin scripts from the repo.

The main reason for this PR though is that the gitignore-rules were split between these files for no obvious reason. There are still quite a few left under src/, but the bulk of them is merged with the root one.
"
16865532,Windows WML Tests: Add total duration to output,aquileia,2014-06-08 18:52:06+00:00,2014-06-08 23:59:12+00:00,{},"It might be nice to keep track of the duration of the WML test suite on Windows (currently on my system it takes 8 minutes).
"
16856957,Update VC project,aquileia,2014-06-07 19:37:45+00:00,2014-06-07 20:08:02+00:00,{},
16856855,CodeBlocks project update.,sigurdfdragon,2014-06-07 19:24:11+00:00,2014-06-07 20:08:11+00:00,{},"Adjustments for 294379a157767cdab4dad348332c392411411d9c.
"
16856803,Update 1.12 VC project,aquileia,2014-06-07 19:17:11+00:00,2014-06-07 20:08:45+00:00,{},"Several fixes for the Visual Studio project files are backported from master to 1.12 and a unique commit (deleting YAMG) is adressed as well.
"
16844515,"main catches and handles ""std::exception"" and ""..."", returning 1",cbeck88,2014-06-06 21:45:21+00:00,2014-06-08 12:06:51+00:00,{},"Note: I added this after reading a blog post:

http://akrzemi1.wordpress.com/2011/10/05/using-stdterminate/

""C++ allows compilers or runtimes not to call destructors in such cases in order for them to be able to provide more efficient implementations of exception handling mechanism. Therefore, programmers are often encouraged to wrap function main with exception handlers that catch every possible exception:

int main() 
try {
    // do what you want
}
catch( std::exception & exc ) {
    // use exc.what()
}
catch( ... ) {
    // ensure destuctors of auto objects are called
}
Not to (or, not only to) prevent calling std::terminate, but to make sure all destructors of automatic objects have been called.""

I'm not sure if this is accurate info, but after reading it this commit
seemed like a good idea, and I don't see that it could be harmful.
Seemed like a good idea to make a PR anyways though.

The purpose of this is so that even when we request the program
to be terminated with ""throw 42"", the exception will be guaranteed
to propogate back to main and all destructors will be called along
the way. This way, if the program requested a socket for example,
the socket will still be released when we terminate unexpectedly,
and not need to be timed out by the OS, so it would be more 
convenient after a crash or after testing, for example.
"
16800135,Gamestate refactor part2,gfgtdf,2014-06-06 00:55:58+00:00,2014-06-06 01:36:13+00:00,{},
16794647,Polish translation update,pjackowski,2014-06-05 22:07:39+00:00,2014-06-25 09:07:36+00:00,{},"Polish translation update

Updated following campaigns:
Dead Water 
Heir To The Throne
Eastern Invasion

Translation provided by Wesbane.
"
16743892,Fixup exceptions in playcontroller,cbeck88,2014-06-05 01:06:32+00:00,2014-06-08 01:51:54+00:00,{},"This sequence of commits attempts to refactor the engine so that at least the play controller does not use ""end_level_exception"" and ""end_turn_exception"" for normal flow control. This helps us to simplify the normal working of the engine and make it less opaque, and might help us to safely use RAII objects for networking at least for normal purposes.

The first step is to introduce an appropriate type ""possible_end_play_signal"",
which covers both end_level_exception and end_turn_exception. This is intended
to become the return value of void member functions of play_controller which
previously would throw these exceptions up the call stack.

The first commit also introduces macros which make it easy to catch the exceptions,
convert them to the signal type, and return, and also to propogate the returned
signal to the caller.

The subsequent commits work from the root, at play_controller::play_scenario,
wrapping possible exception sources and handling the signal type instead. We
work incrementally, testing at each step to avoid breaking anything. Once
a function has been converted, we can work to convert the functions it calls,
and then switch calls to those functions from being wrapped in the ""HANDLE""
macro to being wrapped in the ""PROPOGATE"" macro which is much cheaper
than an exception throw and doesn't carry the dangers of crashing the program
if a destructor somewhere throws an exception. 

I suppose that if we continue this way, we could push all the throws into the 
event handler and the replay module. Perhaps could continue from there, 
but likely at some point the exceptions might be the simpler solution esp. 
for breaking recursion in WML / lua or things like this.
"
16733121,Code blocks update 2014 06 04,sigurdfdragon,2014-06-04 20:45:40+00:00,2014-06-04 20:48:53+00:00,{},
16687077,attempt to fixup unicode lowercase,cbeck88,2014-06-04 01:05:43+00:00,2014-06-04 09:28:08+00:00,{},"This change was suggested by gfgtdf on irc, it seems to fix at
least one test case that is broken currently on master and 1.12
branch.
"
16680182,"use pImpl idiom for gamemap in game_board, avoiding map.h include",cbeck88,2014-06-03 21:46:04+00:00,2014-06-11 23:35:36+00:00,{},"**\* WIP, this seems to work in -debug build but not release build... ***

unit_map is modified in many places that don't normally include
map.hpp. If changes must go through game_board, then the 
game_board header is always needed, currently including
gamemap and all its supporting stuff in places where it wasn't
before. 

so to avoid doing harm by adding game_board, I am making
it hold a scoped pointer to the gamemap instead of an actual
gamemap. This results in very few changes.
- The implementation of game_board has to use the pointer.
- game_board must use copy and swap idiom
- lua get terrain function must pass strings to the game_board,
  not enums, and we parse them as std::strings in game_board
  instead of as c strings in lua api (which was a bit gross anyhow)
"
16657540,Fixup statue orbs 1.12,cbeck88,2014-06-03 14:55:52+00:00,2014-06-03 17:44:30+00:00,{},"Backports PR #186
"
16656545,no movement orbs for enemy statues,cbeck88,2014-06-03 14:40:02+00:00,2014-06-03 17:44:21+00:00,{},"Putting a movement orb on an enemy petrified unit is rather
redundant, so this commit prevents that behavior. Statues owned
by the viewing team will still have orbs, which seems acceptable.
"
16656055,fix bug 21723,cbeck88,2014-06-03 14:31:46+00:00,2014-07-07 17:30:58+00:00,{},"**\* WIP untested, I'm just making a PR so I don't forget to come back to this. ***

https://gna.org/bugs/index.php?21723

I think most likely the ""parse_team_overlays"" function in
display.cpp needs to change as well.
"
16637511,Minor SCons enhancements,techtonik,2014-06-03 06:50:32+00:00,2014-06-09 15:48:28+00:00,{},
16617543,Update VC project,aquileia,2014-06-02 19:29:10+00:00,2014-06-02 23:11:12+00:00,{},
16580436,Update CB project file.,sigurdfdragon,2014-06-01 23:35:39+00:00,2014-06-02 00:05:16+00:00,{},"Adds new file from 6a8827a071845594cc8e0ed2da298c3060e531fb.
"
16579632,game_state refactor,gfgtdf,2014-06-01 21:49:38+00:00,2014-06-01 22:56:33+00:00,{},
16577335,Add game_board class,cbeck88,2014-06-01 16:58:35+00:00,2014-06-01 17:42:11+00:00,{},"This is a refactor to introduce an object encapsulating the unit map, the game map, and the list of teams. Introducing this object permits us to move a substantial amount of code out of the play_controller object, and also to give a home to some helper functions in unit.?pp that previously sat in the global namespace. It also allows us to simplify the construction of some of the clients of play_controller.

This refactor is an ongoing WIP, this is just the beginning. The main goal is to 

(1) better organize the architecture of the engine, to make saving and reloading easier.
(2) Facilitate the introduction of an improved pathfinding mechanism, which will need to sit between most of the other engine modules and the unit map / game map.
(3) Refactoring clarifies what the existing code is doing, therefore it may help us to find bugs in the current system, which may be fixed independently of the refactor in 1.12.

Every commit in this PR builds and passes all unit tests, many were also playtested briefly.
"
16572596,Update CB project file.,sigurdfdragon,2014-06-01 03:27:43+00:00,2014-06-01 04:01:41+00:00,{},"Adds file from 6deda4ca7f67ca1e711be0c15c7f9e692e6b1492.
"
16570502,1.12+bugfix backports ii,cbeck88,2014-05-31 21:24:37+00:00,2014-06-01 01:41:31+00:00,{},"This contains the bugfixes from last week (and a bit before) which we tested on master.

List of cherry-picked commits: http://hastebin.com/vududegidu.hs
"
16568117,"remove ""difficulty_"" from game_data and carryover",gfgtdf,2014-05-31 16:37:38+00:00,2014-06-01 16:36:16+00:00,{},"we already have this data in the classification.
same will happen to random_mode
"
16563102,go to next scenario if there is at least one human,gfgtdf,2014-05-31 03:00:24+00:00,2014-05-31 16:38:27+00:00,{},"defeated sides in mp now also advance to the next scenario if there is
at least one networked human side that got a victory.
"
16519696,"Revert ""call maybe_do_init_side when the engine starts a sides turn""",cbeck88,2014-05-30 06:57:49+00:00,2014-05-31 00:09:30+00:00,{},"This reverts commit 77ead906927bec69d9136d349d637458f7a553f0.

After the refactor which removed unnecessary arguments of functions,
and clarified that the value ""save"" is actually ""do_autosaves_""...
this addition looks more obviously like an error. For one thing,
it is passing the do_autosaves_ bool parameter to maybe_do_init_sides,
which expects that the first parameter indicated whether we are
coming from the replay code path or not (!). So if this was working,
it was probably lucky.

Conflicts:
    src/playsingle_controller.cpp
"
16490029,fixup end of scenario saves,cbeck88,2014-05-29 16:39:47+00:00,2014-05-30 23:32:57+00:00,{},"<iceiceice_> does anyone know why we have this line?
<iceiceice_> https://github.com/wesnoth/wesnoth/blob/master/src/play_controller.cpp#L752
<iceiceice_> it causes end of scenario saves to be stripped of all units
<iceiceice_> my theory is that it was some kind of hack for some point in time before carryover was implemented properly
<iceiceice_> i propose to remove it in 1.12 and master
"
16461307,Wml test,aquileia,2014-05-29 00:57:22+00:00,2014-05-29 05:31:37+00:00,{},"Port the WML unit test framework to Windows.

Integrated into VC project for maximum comfort.
"
16446001,sync random_start time the normal way,gfgtdf,2014-05-28 19:07:56+00:00,2014-05-31 16:44:00+00:00,{},"we now use the deterministic rng which we also use for start unit unit
traits.
"
16396202,add error reporting when [if] is evaluated with no actions,cbeck88,2014-05-27 21:05:12+00:00,2014-06-05 23:56:00+00:00,{},"I frequently make the mistake of using {IF_VAR} but forgetting to
use [then] with it. One solution is to use my own macro, but the
better solution is to add proper error reporting to if. If the
engine parses an [if] tag with no [then], [else], or [elseif], it
should flag an error... otherwise these mistakes are generally
silent and very difficult to find.

One possible criticism is that this will slow things down slightly, since we would have to keep a local variable when evaluting ifs.

Possible resolutions:
1. Who cares.
2. Drop support for having multiple [then], or multiple [else], children of [if], since this makes no syntactic sense anyways... This would speed up the current implementation by requesting only one child instead of a list of children, and require no local variables to detect the miss.
3. Patch the preprocessor to automatically merge any multiple [then] and multiple [else] subchildren of [if]. If someone is using insert tag syntax... too bad, they can just insert into the previous [then] or [else] instead.
"
16314988,Fixup init side done alternate,cbeck88,2014-05-25 15:21:50+00:00,2014-06-25 16:13:15+00:00,{},"A more aggressive attempt to fix https://gna.org/bugs/?21397

In this version, playsingle_controller playside calls maybe_do_init_side in every iteration of the loop after dropped sides may occur.

This is a minor variation on PR https://github.com/wesnoth/wesnoth/pull/169
"
16314434,Fixup init side done,cbeck88,2014-05-25 14:07:18+00:00,2014-05-25 16:23:58+00:00,{},"This is an attempt to fix bug #21397 wherein mp games could be corrupted when saved, by not storing the init_side_done value, which caused the ""upkeep"" (or ""refresh"") event to be skipped for the turn of the side that disconnect. This was very annoying as it means that players would not get gold for that turn, their units would not heal or get full moves for the turn.

See bug report: https://gna.org/bugs/?21397
"
16310103,Added [portrait] info to hakim.cfg,ancestral,2014-05-24 23:59:14+00:00,2014-05-25 00:06:01+00:00,{},"Hakim has a portrait, but his config file is missing it.
(This is useful in game, to see unit portraits.)
"
16197867,Fix CB project file.,sigurdfdragon,2014-05-22 01:33:18+00:00,2014-05-22 03:15:53+00:00,{},
16079267,"add ""to_chat"" parameter to wml_message",gfgtdf,2014-05-19 22:05:05+00:00,2014-05-20 18:07:01+00:00,{},"""to_chat"" lets the wmldev specify to where the message should be
written. Defaults to the previous behaviour.

The intention is for example that one might want to give a summary  as a
chat message and a very detailed information in the stderr file.
"
16065911, replace fight_on_without_leader with defeat_condition,gfgtdf,2014-05-19 17:26:06+00:00,2014-05-19 17:58:55+00:00,{},"i'll merge as soon a the travis passes
"
15723423,European Portuguese translation,trewe,2014-05-09 21:32:29+00:00,2014-05-12 11:33:28+00:00,{},"Pre-beta translation update
"
15467842,fixup check_victory,cbeck88,2014-05-04 01:34:07+00:00,2014-05-20 08:00:43+00:00,{},"**\* Experimental branch ***

It seems like common sense that the check victory function should be basically symmetric with regards to host and client, as far as _when_ the level is ended, and the current implementation definitely isn't, because it checks is_observer when making this decision. This change is a ""common sense fix"", but not necessitated by any known bugs, afaik. I believe this version would in all common cases be essentially the same.

However I don't have much appetite to test this change right now, nor do I think it would be a good idea to merge it to 1.12 without a good reason. So I'm just putting it up as a PR so that it may perhaps be revisited later.

Edit: A scenario where things could possibly go awry in the current version, where they wouldn't with this commit, is if one player in an mp game only has control over AI sides, victory_when_enemies_defeated = true, and no existing sides are enemies of one another (so presumably this is a cutscene in an mp campaign.) I believe such a player would be defeated immediately, while the others would continue. But like I said I haven't tested any of this.
"
15431185,scons: Explain out-of-tree build and Repository,techtonik,2014-05-02 13:31:47+00:00,2014-05-02 13:59:28+00:00,{},
15416193,scons: Format output for readability,techtonik,2014-05-02 01:22:33+00:00,2014-05-02 13:12:44+00:00,{},"Add separators between configure and build phases, prepend
failed prerequisite checks with ERROR: suffix and reformat
code a little.
"
15324558,Boost rng,cbeck88,2014-04-30 03:45:18+00:00,2014-11-03 23:30:26+00:00,{},"**\* WIP, Please don't merge. This is being actively discussed on mailing list. ***

This is still experimental, I'm just posting as a PR to solicit feedback.

The idea is to use boost::mt19937 as our rng engine rather than the linear congruential generator implemented in simple_rng which we were using. This was discussed on IRC: http://www.wesnoth.org/irclogs/2014/04/%23wesnoth-dev.2014-04-29.log

Feel free to criticize, pull this branch and tweak it, merge yours instead of mine, ask me to pull your changes, or ignore this branch completely and do something completely different with the rng. Note: I may still rebase without warning, until I remove this sentence.

Changelog:
- Abandon std::rand based implementation in favor of boost::mt19937 mersenne twister algorithm.
- Random seeds for unseeded generators come from /dev/random or platform equivalent, which boost::random_device is a proxy for, and use system time where nothing like this is available. This applies to the mp server as well as wesnoth clients. (boost v1.43.0 adds support for boost::random_device on Windows via a microsoft api)
- A random seed is always unambiguously a 32 bit integer, represented at all times as a uint32_t, or a std::string. Parts of the engine not immediately related to the rng are more or less required to treat random seeds as strings.
- Raw randomness is converted to random small ints in a way that will not vary by platform, and unit tests will verify this.
- Add a series of unit tests verify the integrity of the rng, the integrity of saving and reloading it, and the integrity of the functions which handle random seeds in the engine and send them over the network.

TODO: 
- In cases when we don't have a seed, ~~currently I'm using stdlib rand(), just like we were before~~ I'm using boost::random_device... The specification states ""Class random_device models a non-deterministic random number generator . It uses one or more implementation-defined stochastic processes to generate a sequence of uniformly distributed non-deterministic random numbers. For those environments where a non-deterministic random number generator is not available, class random_device must not be implemented."" Does this class exist on every one of our target platforms including pandora? If not I guess will use systime on those? Note: I added a compiler flag for this. http://www.boost.org/doc/libs/1_51_0/doc/html/boost/random/random_device.html
- Is there a standard cross platform version of ""boost distributions"", to replace the implementation in get_random_int? (See source code comments)
- Better unit tests?

Problems: 
- ~~I ran 3 AI vs AI test cases on this branch (networked and local), they all had +25% damage dealt and taken throughout the game... so that certainly looks like a problem. Is it casting uint32_t to int? Is it the seeding?~~ Note: ~~This was several revisions ago~~, this was at the third or fourth revision which has been rebased and no longer exists, before using boost::random_device... It seems to be working well now.

Minor issues:
- Was I not supposed to use the rand_rng namespace for this?
- I selected 1.40.0 as the boost requirement for random. It would be preferable to have 1.43.0. Here's a summary of boost random changelog:

boost random 1.43.0:

Put the implementation of random_device in a compiled lib, and added Windows support.

boost random 1.40.0:

Made the constructors of all the generators call the copy constructor when passed a non-const reference.
Changed seeding functions to accept any arithmetic type. As a side-effect, the exact signature of seed changed for some classes.
Major bug fixes in uniform_int.
"
15207046,enable msvc wanring 4800,gfgtdf,2014-04-26 22:49:52+00:00,2014-04-27 18:15:00+00:00,{},"unlike the title suggests, this pr contains more then 'enable msvc wanring 4800'. this pr contains the following unrelated things:
1) Enable msvc wanring 4800: after i recenty made a bug that broke move+attack (28ebde5741055) i believe this is a useful wanring, also there were some other bugs that wanring uncovered (but maybe in unused code?). This is done in commit 'enable msvc bool conversion check' (2a2c469).
2) We add a commandlaine option for precise timestamps (0a86c5c) maybe someone who knows better english then me could check the sentences?
3) some improvements in replay.cpp.

EDIT: the name of the branch is also unrelated to the things in this pr.
"
15196167,Insert lua_unit's contained pointer directly,AI0867,2014-04-25 23:39:31+00:00,2014-05-01 19:27:34+00:00,{},"Not copying the unit improves the speed of wesnoth.put_unit by two orders
of magnitude from lua's perspective.

To do this, we have to take ownership of any owned pointer from lua_unit.
We do this by not running lua_unit's destructor, but just overwriting the memory it's in.
"
15103195,Fix CB project file.,sigurdfdragon,2014-04-24 05:33:19+00:00,2014-04-24 21:50:57+00:00,{},"These are the same changes that anonymissimus applied in 4de900f9437f7b92daf682cf3aaca6bb6cfb5cef on master.
"
14956212,Fix bug 21939,cbeck88,2014-04-21 01:13:15+00:00,2014-06-26 05:06:40+00:00,{},"*\* DO NOT MERGE **

This is an experiment to try to fix linger mode not working in networked mp. Please read commit messages for detail.
"
14943733,Change SDL resource loading to use our filesystem functions,AI0867,2014-04-19 12:42:42+00:00,2014-10-19 01:26:50+00:00,{},"**\* This should not be merged until the mailinglist discussion is resolved ***

SDL 1.2's own filesystem functions have very limited unicode support,
so provide an SDL_RWops struct to let them use ours.
This also bumps the minimum required SDL_mixer version to 1.2.12
"
14930973,Project file fixes,aquileia,2014-04-18 19:41:37+00:00,2014-04-18 20:58:56+00:00,{},
14922760,Move team._info.lost update to check_end_level(),CIB,2014-04-18 15:46:20+00:00,2014-04-18 17:06:22+00:00,{},"Without this, we can get inconsistent behavior, where if you manage to end the scenario on turn 1 with [endlevel], the unit carryover information may be outdated(units are carried over despite there being no leader).
"
14836472,Add missed files to and remove obsolete files from CodeBlocks-SCons and C...,Kevin-Xi,2014-04-16 17:48:48+00:00,2014-04-16 18:09:54+00:00,{},"Add missed files to and remove obsolete files from CodeBlocks-SCons and CodeBlocks project files
"
14821304,Fix resolution selection dialog,aquileia,2014-04-16 13:03:15+00:00,2014-04-16 15:10:17+00:00,{},"No changelog entry as the causing commit for bug #21915 wasn't included in a release yet.
"
14808000,Fixup server replays2,cbeck88,2014-04-16 06:24:23+00:00,2014-04-16 20:26:11+00:00,{},"**\* Experimental ***

This branch appears to fix server-generated replays at least for ""vanilla"" 1v1 replays.

Issues: 
- I originally tried to fix this by writing to the history the same way that I write ""record_change_controller"" to history. It appears that that is not appearing in the replays, although the clients do receive these messages (!). What's going on there? What has to be done for those to show up?
- Shouldn't wesnoth fail more gracefully, i.e. with a ""mandatory WML child missing"" rather than ""assert failure"" when missing the [start] tag in replays?
- Is there some way to make the ""load game"" dialog in multiplayer detect replays and make them load?
- What other kinds of replays are still broken. Presumably reloaded games are, but this at least might get us back to the baseline of 1.10 performance.
"
14804088,Minor fixes to the VC project & the tutorial,aquileia,2014-04-16 02:45:25+00:00,2014-04-16 10:37:29+00:00,{},
14723170,Fixup ready block,cbeck88,2014-04-14 15:12:07+00:00,2014-04-18 17:18:49+00:00,{},"**\* Experimental ***

gfgtdf reports a bug, where when a reloaded game is hosted, if a reserved side is replaced manually with a network player, the ready button blocks ""waiting for faction..."" even though no one is choosing a faction. 

This is relevant to my earlier commit: https://github.com/wesnoth/wesnoth/commit/186e66cec6519606bca5e07209c9a557c78b5e71

I believe that I tested this and it worked at an earlier version, nevertheless after reviewing the code I decided that I should try to make _exactly_ the same test on the host as is used by the client when deciding whether to show the faction selection dialog, instead of what I was using which now seems to me as a hack. Specifically that means I should test whether ""allow_changes = true"".

Here's where the plot thickens. That doesn't fix the issue, and indeed debugging output inserted in the subsequent commits here shows that the host and clients don't actually agree about the value of ""allow_changes"" for the joining player! I have also made server-side debugging output to show exactly what the game config being passed to the clients is. It looks that it might be an issue that one side is perhaps reading from ""snapshot"" and the other from replay_start or some such thing? Anyways if anyone has an idea why they might be out of sync regarding ""allow_changes"" it would be helpful, I'm going to put this aside for a few days and perhaps come back to it.

Also: possibly relevant to https://github.com/wesnoth/wesnoth/commit/fa5b916bf1240c20d3faccb4f3be59c00003433b
"
14700277,fix host reassignes side during choice,gfgtdf,2014-04-14 01:31:16+00:00,2014-04-14 03:03:23+00:00,{},"we currently get an OOS when one player leaves while ha had to do a choice and the host reassigns it to a third side (note that we dont get OOS when the host assigns theside to himself or to 'idle')

Assume the following situation:
2 Players in the game (A (side 1), B (side 2)), and one Observer (C).
it's A's turn.
A has to do a decision (for example unit advanement), A leaves the game
and B decides to assign side 1 to C.
On Client B: When returning from process_network_data side 1 is now controlled by B,
and then gets then reassigned with the next call of
process_network_data, but that's too late becasue handle_generaic_event
already returned and B does the advancement decision for side 1.
Players C gets the the first [change_controller](A -> B) and then gets
the second change cntroller (B -> C) before getting B's answer to the
user choice. So when C gets the second [change_controller] he does the
decision himself becasue its C's decision an it has not been received
yet. -> the same decision has been made twice -> OOS.
this fixes this problem, by making the host wait for the servers change
controller in this case
"
14694879,fixup party full bell,cbeck88,2014-04-13 14:56:34+00:00,2014-04-14 17:55:25+00:00,{},"**\* this is not actually ready to pull, I still have to test it. I'm just putting it up so others can look at it. ***

the party full bell code is moved back to the engine, and is
based on checking whether processing the most recent message
has made it now possible to start the game.

this also addresses bug #21910.
"
14691380,New cost_calculator and ai.find_path_with_avoid() function.,vorobeez,2014-04-13 04:40:13+00:00,2014-05-04 04:25:13+00:00,{},"Done the task from http://wiki.wesnoth.org/EasyCoding#Improvements_to_AI. ""Add a cost function to the C++ path finding code that takes avoided hexes into account"".

Added new cost_calculator - shortest_path_calculator_obey_avoid and find_path_obey_avoid functions for ai-context Lua API.

For more details see descriptions of commits.
"
14597932,fix bugs and add comments on simple_move_and_targeting_phase,Kevin-Xi,2014-04-10 11:05:27+00:00,2014-04-10 13:58:45+00:00,{},
14583975,fix minor bug in get_healing_phase ,Kevin-Xi,2014-04-10 01:44:08+00:00,2014-04-10 09:13:07+00:00,{},"We want to calculate the power_projection of the village, so the first argument should be the location of the village, that is, 'it.first->second', or 'dst'
"
14480425,Fixup check_victory (for mattsc),cbeck88,2014-04-08 02:06:02+00:00,2014-04-09 02:12:05+00:00,{},"**\* Please don't merge this, this is in a testing and review stage. ***

This branch is intended to address concerns raised by mattsc on irc. See http://www.wesnoth.org/irclogs/2014/03/%23wesnoth-dev.2014-03-26.log
and the day before for discussion.

The proposed solution is to introduce a field of [side] ""fight_on_without_leader"",
and refactor check_victory so that any side with this field true and a unit alive
is not considered ""defeated"". We use this instead of no_leader in places where
that was being used (erroneously?)
"
14476513,fixes bugs intrduced in pr 121 and more,gfgtdf,2014-04-07 23:24:53+00:00,2014-04-11 21:53:27+00:00,{},"this pr fixes bugs. Especialy 2 bugs introduced in pr 121.
we also disable get_user_choice during prestart events becasue we shouldn't use dialogs during prestart events.
this pr also contains a fix for 21905 which was no introduced in 121.
"
14432870,add functionality for define= in [scenario] tag,Rift-Walker,2014-04-07 04:51:15+00:00,2014-06-12 21:21:05+00:00,{},"Added a new public data member, scenario_define, to class game_classification (alongside campaign_define). Added a new public method, prepare_for_scenario, to multiplayer create_engine. This method is called from process_event in multiplayer_create similarly to the existing prepare_for_campaign method. The prepare_for_scenario method reads a define attribute from a scenario tag into classification.scenario_define, which is then processed by load_game_config_for_game. The effect of this change is that, if all scenarios use define= to isolate sections of their code, much less config data will be loaded initially. Config data is reloaded upon scenario selection, with isolated content for the selected scenario included.
"
14419677,Update project files,aquileia,2014-04-05 23:01:04+00:00,2014-04-09 06:17:30+00:00,{},"This fix adds the new files introduced by gfgtdf to the VC project and
updates the README file.
"
14418206,Fixup side drop mechanism,cbeck88,2014-04-05 19:59:42+00:00,2014-04-16 19:01:41+00:00,{},"**\* EXPERIMENTAL! This branch has been tested and partially merged and now contains some commits which I'm not sure are necessary. ***
This branch was aimed at fixing bug 21459. https://gna.org/bugs/index.php?21459
This bug is now believed to be fixed.

The changes which were not merged.
- Maybe_do_initside checks if the side we are resetting matches the current player when considering whether to init.
"
14373652,Elseif branch,Elvish-Hunter,2014-04-04 09:09:50+00:00,2014-04-04 09:47:15+00:00,{},"Request to merge my branch to master. I'll handle it.
"
14162608,Added cumulative density function to damage calculations,sachith500,2014-03-31 06:59:29+00:00,2014-04-03 14:54:33+00:00,{},"The damage calculations window (for battles) now additionally shows the cumulative probability for the different levels of HP possible after a battle. (basically Probability of ending the battle with x HP or more).
"
14149934,WML Unit Tests,cbeck88,2014-03-30 07:03:29+00:00,2014-05-02 13:48:14+00:00,{},"This pull request introduces a framework for WML Unit Tests.

The main idea is to create a new command line option to wesnoth, --unit, or -u, which is similar to --test except that it causes the test scenario to run as a unit test. This means:
- The scenario runs headlessly.
- Wesnoth exits on scenario finish.
- The exit code of wesnoth is 0 (success) in case of LEVEL_RESULT VICTORY or LEVEL_RESULT NONE. It returns 1 (failure) otherwise.
- When using the additional option --timeout, the exit code is 2 (timeout) after [arg] milliseconds. 
- _Unless using the additional option --noreplaycheck_, wesnoth will also try to save a replay of a successful unit test and play it to completion. If it can't load the replay, exit code is 3 (invalid replay). If there is a WML error while playing it back, exit code is 4 (errored replay).

The timer starts _before_ configs are cached and loaded, which might be unfortunate. When using a script with --validcache options on all unit tests but the first, the first should probably have an extended timeout period.

In data/test/, we add macros and example unit test scenarios.

WML Macros:
- The macro RETURN ends the level, resulting in victory or failure depending on a {VARIABLE_CONDITIONAL} block passed to it.
- The macro ASSERT tests a condition, and ends the level in failure if the condition fails.
- The macro GENERIC_UNIT_TEST describes a minimalist test scenario with two human sides, and takes as arguments an id string and ""contents"" which appear as the body of the test scenario.

WML Unit Tests:
- empty_unit_test is a GENERIC_UNIT_TEST with no body. It should be loaded with ""./wesnoth -t empty_unit_test"", not -u as it does not return.
- unit_test_1 asserts that 2+2=4.
- fail_test_1 asserts that 2+2=5.
- unit_test_2 tests the FIFO property of events.
- unit_test_3 tests that units spawned at occupied locations go to the nearest available hex.

Script:
The wml_unit_tests script is an example script showing how to take the AND of many such unit tests conveniently and efficiently in a unix environment.
"
14031610,Dugi/addon reviews,Dugy,2014-03-26 21:48:11+00:00,2015-07-26 23:11:03+00:00,{},"This adds a system to allow players to find add-ons they seek more easily.

It allows the players to review the add-ons or give them numerical rating (0-10). The reviews can be 'liked' and those liked by the most people are shown the first. A numerical rating based on the frequency of downloads, users' ratings and time players spent playing it is shown instead of the downloads count on the list of add-ons and it is sorted by this number.
"
14023028,Fix check_victory (for mattsc),cbeck88,2014-03-26 18:57:54+00:00,2014-04-08 02:03:31+00:00,{},"**\* Please don't merge this, this is in a testing and review stage. ***

This branch is intended to address concerns raised by mattsc on irc. See http://www.wesnoth.org/irclogs/2014/03/%23wesnoth-dev.2014-03-26.log
and the day before for discussion.

The proposed solution is to introduce a field of [side] ""fight_on_without_leader"",
and refactor check_victory so that any side with this field true and a unit alive
is not considered ""defeated"". We use this instead of no_leader in places where
that was being used (erroneously?)
"
13964464,Added cumulative density function to damage calculations,sachith500,2014-03-25 17:15:00+00:00,2014-03-26 07:06:00+00:00,{},"The damage calculations window (for battles) now additionally shows the cumulative probability for the different levels of HP possible after a battle. (basically Probability of ending the battle with x HP or more).
"
13941799,Added cumulative probability to damage calculations,sachith500,2014-03-25 08:54:57+00:00,2014-03-25 09:11:33+00:00,{},"The damage calculations window (for battles) now additionally shows the cumulative probability for the different levels of HP possible after a battle. (basically Probability of ending the battle with x HP or more)
"
13884403,Correct gold check comparision in recall dialog,Aishiko,2014-03-24 02:16:05+00:00,2014-03-24 02:22:02+00:00,{},"By correcting the assignment of the cost of the unit it now correctly
says whether or not the play actually has the gold to recall a unit, as
after this check it is assumed they do by the program which creates
the possibility of recalling when you have no gold, or negative gold.

Added comments so that the magic number is explained.
"
13882781,Fix being able to recall when you don't have the gold to recall.,Aishiko,2014-03-23 23:39:07+00:00,2014-03-24 02:02:36+00:00,{},"Correct comparison that allowed for recalling when there is not enough gold to do so and added a comment to explain the magic number used in the comparison.
"
13878173,Improved UTF-8 parsing,aquileia,2014-03-23 14:58:10+00:00,2014-04-01 02:39:54+00:00,{},
13869775,Fix bug #21759 (second try),Duthlet,2014-03-22 16:46:22+00:00,2014-03-30 17:35:01+00:00,{},"I hope making a second pull request is the way to go
"
13868689,Improve UTF-8 handling,aquileia,2014-03-22 14:46:01+00:00,2014-03-23 00:10:14+00:00,{},
13831959,Fix bug #21759,Duthlet,2014-03-21 11:41:50+00:00,2014-03-22 20:15:32+00:00,{},
13823693,Add `bit_width` functions,8573,2014-03-21 05:04:44+00:00,2014-03-21 19:10:39+00:00,{},"Add the following functions in `src/util.hpp`:

```
template<typename T> inline std::size_t bit_width();
template<typename T> inline std::size_t bit_width(T x);
```

These functions compute the size, in bits, of a type or value, providing
a convenient and self-documenting name for the underlying expression,
`sizeof(…) * std::numeric_limits<unsigned char>::digits`.

This commit adds two additional header `#include` directives in
`src/util.hpp`. The newly included headers are as follows:
- `<cstddef>`, for `std::size_t`; and
- `<limits>`, for `std::numeric_limits`.

At first, I obtained the bit width of a byte using the C preprocessor
macro `CHAR_BIT`, defined in the C standard library header `<climits>`,
rather than using `std::numeric_limits<unsigned char>::digits`, but I
subsequently switched to using `std::numeric_limits` per Soliton’s
recommendation at 2014-03-17 21:36Z in the `#wesnoth-dev` IRC channel on
the freenode IRC network (irc://chat.freenode.net/%23wesnoth-dev).
"
13775659,Server controller tweaks,cbeck88,2014-03-20 07:33:09+00:00,2014-04-03 21:19:40+00:00,{},"Refactor server so that controllers are not updated in level_ config as the game proceeds. Instead, level_ reflects the appropriate level to send to any observer at the start of game, and controller changes are recorded in the history. Client now recognizes such records in the replay data.

Refactor server and clients so that all ""controller tweaks"" at start of game, originally performed in playcampaign.cpp, are instead performed by the server just as [start_game] is received from host and before relaying the signal to other clients.
"
13771755,Config edits,Rift-Walker,2014-03-20 03:48:20+00:00,2014-03-21 09:46:05+00:00,{},"- Change std::copy to std::insert where applicable.
- Change config assignment operator to copy-and-swap
- Clean up some code for readability.
"
13746582,"sync, attack events, start/prestart and more",gfgtdf,2014-03-19 16:52:41+00:00,2014-04-02 22:38:45+00:00,{},"the main intention of that patch is to fix gna.org/bugs/?20871, gna.org/bugs/?21697, some OOS erros related to use of multiple [get_global_variable] with different sides in one event.
To remove the deterministic random for traits and similar as discusssed here http://forums.wesnoth.org/viewtopic.php?f=6&t=39611. And to sync start end prestart events.

this patch also introduces the optional deterministic mode for SP, where you'll get the same random (attack results, recuits...) results when you relaod a savegame.

finaly this pr also contains a commit that gives a third argument to wesnoth.synchronize_choice that allows to specify on which side the function is evaluated.

previously and afterwards there can be 2 ways an action(attack, rectuit, move...) can be executed: the first way is that the action runs on the local client, and the action is sended over the network as soon as it is completed, this happend in recruits, moves, recall, and some more. The second way is that the action is sended over the network first and is then executed on all clients simultaniously, this happends in attck events, and similar happends in prestart/start events. This is also why mp_sync didn't work in this actions before: side 2 noticed that it needs data from side 1 but side 1 did send the execeution of the action before it generated the  user_input data. That's why side 2 doesn't have the user input data at this point and gives OOS. Previously there was one special and very bugged case when the code waited for remote input before calling get_user_choice to not get an OOS: [get_global_variable]. The most important part of this patch is about moving the ""waiting"" into get_user_choice so that the caller of get_user_choice don't have to worry about it. With this we can also use get_user_choice if we already sended data over the network. And we can enable the mp_sync in attack related events and prestart events.

Previously there were 2 different random generators, one for attacks, and one for other things, since this patch fixed the problems with the ""sending data over teh network first"" this patch tries to throw the old rng for non attack things out. So that attacks and other tings use the same rng.

We use a new random generator which is automaticly synced during the execution of scned_context::run_in_scned_context, and otherwise not. So we cannot cause oos anymore by using rand= from an unsnced command like ""select""
Alternativeley we can also set the new random synced by using the new RAII object set_sconext_sycned, this happens for example during prestart events.
Unlike the old random generator, the new random generator is not determinstic by default because it asks the server (or itself in a SP game) for a new seed, at every side command (attack, move, recruit ...) that requires random, similar to how the previous rand for attacks worked (it doesn't ask at the beginning, just the first time it is needed unlinke how attacks worked before). That way we can also use the same rng for attacks and for other random choices.

The pr also moves code from do_replay_handle to synced_commands.cpp. The main intention was just to make do_replay_handle.cpp smaller, but this also allows us to call run_in_scned_context from non-replay in most cases. to ensure teh same actuion is executed in replay and non-replay (especialy, before for attacks there was a code for 'advancements after attacks' implemented trice for human turn ai turn and replay.).
But in some cases this function isn't used. because for example in case of ai attacks we want to pass ai_advancement_aspects to attacks, or incase of Moves some functions use move_unit's return value. 

we replace the rng... get/set_random_results by synced_checkup.

unfortunately using rand= or [get_global_variable] during a [filter]lua_function=[/filter] still causes OOS when it's a filter for a ability and you hover the mouse over that unit with the ability while a unit moves.
(note that this want supported before too.)

I did some rebasing and it's quite unlikeley that ALL of the commits still compile on their own, becasue i might have seen overseen some dependencies.

this patch breaks all replays form older versions.
this patch might create some unused code, that shall be cleared, especialy i want to remove random.hpp/cpp, rng.hpp/cpp
"
13716790,"Purge ""human_ai"" controller type",cbeck88,2014-03-19 01:06:24+00:00,2014-03-19 21:22:01+00:00,{},"This is a fixup of bugfix #18829 (which was commit
736ceaa6c7e81882c9c5b2e932307b1f1ecb3bfd)
"
13666202,Add unit instance recall costs,Aishiko,2014-03-18 01:56:54+00:00,2014-03-21 04:16:53+00:00,{},"This should (barring I didn't miss something) correctly implement unit instance recall costs for the player.
"
13656055,minor fixes,aquileia,2014-03-17 20:53:22+00:00,2014-03-17 21:29:14+00:00,{},"f3bfa19  was reviewed by lipkab
bb6bfdc was accepted by Ivanovic
"
13595796,Add num_box widget for numerical input,aquileia,2014-03-14 22:40:26+00:00,2015-01-05 06:26:30+00:00,{},
13453968,adding customizable unit recall costs,Aishiko,2014-03-12 02:59:57+00:00,2014-03-18 02:19:16+00:00,{},"Adds a recall_cost Variable to units and unit types
adds recall costs to the gui dialog as well putting the proper costs
on recalled units in the whiteboard
it also correctly gives back gold if undone.
"
13116814,Update lobby_data.cpp,Aishiko,2014-03-03 15:06:13+00:00,2014-03-04 03:11:17+00:00,{},"Concatenated a string to allow for proper translation.
"
13090301,Update 02_Blackwater_Port.cfg,Aishiko,2014-03-02 07:54:40+00:00,2014-03-02 08:23:34+00:00,{},"Removed the image of Delfador while Kaylan is speaking so the right image is shown.
"
13078021,Blindfold minimap,cbeck88,2014-03-01 01:21:17+00:00,2014-03-01 01:22:05+00:00,{},"correctly shroud the minimap when blindfold is applied
"
12991646,SConstruct: small typo,techtonik,2014-02-27 07:56:11+00:00,2014-02-27 08:31:19+00:00,{},
12839837,Blindfold ii,cbeck88,2014-02-24 03:32:22+00:00,2014-02-24 03:32:49+00:00,{},"a better implementation of the blindfold feature. now applies to display instead of video, and uses a locker object to control application / removal. it now works essentially by shrouding all hexes.
"
12833134,PL translation for campain of two brothers,klapi85,2014-02-23 16:22:35+00:00,2014-03-04 10:17:48+00:00,{},"Some Polish translation.
"
12820991,Blindfold replays,cbeck88,2014-02-22 07:43:39+00:00,2014-02-22 08:19:15+00:00,{},"implementation of ""blindfolded replays"" discussed on irc and here: https://gna.org/bugs/index.php?21405
"
12820088,Game start bell,cbeck88,2014-02-22 04:50:53+00:00,2014-02-22 05:40:04+00:00,{},
12819598,help file and release notes update relevant to idle_controller,cbeck88,2014-02-22 03:29:15+00:00,2014-02-22 04:51:36+00:00,{},
12817432,Idle controller,cbeck88,2014-02-22 00:44:43+00:00,2014-02-22 02:49:57+00:00,{},"this PR allows ""controller = idle"" to be a valid local controller value, which the host may assign to a disconnected side. i have tried to make sure that other control commands like :control, :droid, and :give_control all work correctly after this happens. the server and other clients never learn about it.

it also adds :idle and :controller commands. The first toggles between the idle state and human controlled state, and the second queries the current controller state of a side of a given number.

possible areas for improvement might be making the idle message go to all networked players so that they understand what is going on

see this feature request / bug report: https://gna.org/bugs/?21405
"
12808555,Save and abort,cbeck88,2014-02-21 20:26:38+00:00,2014-02-21 21:08:38+00:00,{},"https://gna.org/bugs/index.php?21405#comment9
"
12806872,khalifate graphics update,aquileia,2014-02-21 19:46:13+00:00,2014-02-22 03:17:15+00:00,{},"new baseframes for
jundi, muharib, batal, qatif-al-nar, mudafi, rasikh

a gift from sleepwalker to happygrue
"
12802813,warning message fixup,cbeck88,2014-02-21 18:05:53+00:00,2014-02-21 18:06:06+00:00,{},"Instead of an error message with caption Error which begins ""Warning: ..."", the caption is simply ""Warning"".
"
12780757,AnimationWML update for UtBS and the Elvish Ranger,aquileia,2014-02-21 05:59:40+00:00,2014-02-22 00:48:53+00:00,{},"- conversion to the new animation syntax
- small simplifications and fixes to the actual animations
  Central Body animation WML refactored
  melee attack of the small mudcrawler improved
- [base_unit] used for Weakened Core and Desert Star
- #wmllint: usage magic comments deleted
- Elvish Ranger converted
"
12774249,Add warning for mp scenario started from title screen load button,cbeck88,2014-02-21 00:30:19+00:00,2014-02-21 00:52:52+00:00,{},
12731895,get list of all era ids and allow request for config of era by id,cbeck88,2014-02-20 04:19:16+00:00,2014-02-20 19:36:41+00:00,{},"For SigurdFD:

Not extensively tested, but it is a niche feature so I hope SigurdFD will let us know if something is bugged here.

The eras list, wesnoth.game_config.eras, seems to work perfectly.
The wesnoth.get_era function is not extensively tested, as this would be somewhat hard, but here is some sample output, from booting any scenario with --debug, and typing
"":lua wesnoth.message(wesnoth.game_config.eras)""
"":lua wesnoth.message(wesnoth.debug(wesnoth.get_era(""WC_era"")))""

http://i.imgur.com/EAKan4p.png
"
12731056,graphics update for the shadow mage line,aquileia,2014-02-20 03:29:07+00:00,2014-02-20 14:20:14+00:00,{},"New baseframes, standing animations an ranged animations for rogue mage,
shadow mage and shadow lord.

This commit replaces the older work of Blarumyrran with new versions by
him. Animations are partly by aquileia.
"
12706872,feature: [endlevel] may specify carryover WML merged/appended into next scenario,cbeck88,2014-02-19 16:56:49+00:00,2014-02-19 20:18:42+00:00,{},"[endlevel] now has two optional subtags [next_scenario_settings], [next_scenario_append].

Both of these are parsed at scenario end and stored as carryover data. At the start of the next scenario,
[next_scenario_settings] is merged with the scenario wml (""level"" variable in playcampaign.cpp), 
and [next_scenario_append] has its children appended. This happens just before the carryover sides are transferred, so it is possible to use this to reconfigure the next scenario, reconfigure the sides, change their saveid's etc., and also to append events into the next scenario. Some simple illustration scenarios are included here: https://gna.org/bugs/?21670

I have tested this with extensive debugging output and also playing a bit of mainline sp and mp campaigns to make sure I didn't break anything. However I want to give others a chance to review and respond if they like before committing, I never got a hold of anyone who had previously worked on the campaign / carryover code.
"
12627288,fix logic error in location_set:empty,cbeck88,2014-02-17 20:54:15+00:00,2014-02-18 03:26:15+00:00,{},"See here. https://gna.org/bugs/?21659

From a quick grep in /data, it seems that this function is not being used in any mainline lua right now.
"
12587132,add mp-only lua proxy for the current era,cbeck88,2014-02-15 22:29:20+00:00,2014-02-16 04:01:30+00:00,{},"Very small patch, 1 header include and one active line of C++, which makes the current era, with factions table, available to lua in a scenario. See test suite and attached screenshots at gna feature request: https://gna.org/bugs/index.php?21578

The technique I use is to make a lua proxy table corresponding to the config object for the current era, this is very closely related to previously accepted pull request: https://github.com/wesnoth/wesnoth-old/pull/87
"
12581355,Fixed bug#21358: Dead links in help for unit variations,sachith500,2014-02-15 06:30:11+00:00,2014-02-16 04:06:49+00:00,{},"The "".."" in the unit reference for new soulless/walking corpses was not being added by the code in help.cpp.

https://gna.org/bugs/index.php?21358
"
12544600,Fixed bug #21486: Team label clears a non-team label,sachith500,2014-02-14 07:13:52+00:00,2014-02-25 03:42:40+00:00,{},"Editing a non-team label to be a team label no longer removes the old label (ie, everyone not in that team can still see it).

https://gna.org/bugs/index.php?21486

Signed-off-by: Sachith Hasaranga Seneviratne sachith500@gmail.com
"
12247760,Update to RoTD along with a changelog note.,Velensk,2014-02-05 23:44:51+00:00,2014-02-06 00:29:58+00:00,{},"The subject really says it all. Ruins of Terra-Dwelve got some tweaks.
"
12108729,Updated the Galician (gl) translation,Gallaecio,2014-02-01 18:34:59+00:00,2014-02-02 09:21:43+00:00,{},"I also fixed a typo that I noticed while translating.
"
11944158,"gd Map overlays for AOI, TSG",gunchleoc,2014-01-28 12:40:37+00:00,2014-02-17 20:35:16+00:00,{},"New localised campaign map overlays for 1.11.x
"
11255714,update of european portuguese translation files,trewe,2014-01-06 16:54:50+00:00,2014-01-07 05:34:47+00:00,{},"changed strings & images
"
10592830,Updated the Galician (gl) translation,Gallaecio,2013-12-06 13:35:01+00:00,2013-12-06 13:38:01+00:00,{},
10572225,fix possible oversight in mp_game_settings serialization code,cbeck88,2013-12-05 21:41:13+00:00,2014-06-25 14:21:59+00:00,{},"in mp_game_settings::set_from_config, read share_view and share_maps
in mp_game_settings::to_config(), write share_view and share_maps
this will cause these attributes to be saved and loaded
"
10541504,"New lua proxy table ""wesnoth.game_config.mp_settings"".",cbeck88,2013-12-05 04:01:38+00:00,2013-12-21 04:59:07+00:00,{},"Old title: New lua proxy table ""wesnoth.mp_settings"".

Hoping to fill a feature request which I made here: 

https://gna.org/bugs/?21208 

I introduce a lua proxy table to access all the fields that occur in ""multiplayer"" tag in save game files.

The lua expression ""wesnoth.mp_settings.[field]"" accesses any field of resources::state_of_game->mp_settings(), if the current game type is multiplayer. The name ""field"" is chosen according to mp_game_settings::to_config(), so that the field name matches exactly what occurs in save games files. The access should be read only, the same as wesnoth.current.

I don't currently handle vector objects like ""active_mods"", or the std::map ""side_users""... active_mods could be a very useful thing to have access to, if someone could provide a suggestion how best to pass this to lua that would be great.

Side Remark: I noticed when doing this that in mp_game_settings.hpp, .cpp, the fields ""share_map"" and ""share_view"" are defined and I assume match those features in game, but they are not written by to_config() and hence not saved in the save file... is this a bug or is it actually intentional? If these are indeed used and should be going to the save file then I will indeed want to add lua hooks to them as well for consistency.
"
10531464,(Duplicate) Party full bell,cbeck88,2013-12-04 21:33:22+00:00,2013-12-04 21:36:07+00:00,{},"I should not have opened a second copy... my mistake.
"
10529039,Party full bell,cbeck88,2013-12-04 20:27:18+00:00,2013-12-12 00:30:52+00:00,{},"I decided to do a little coding to fulfill a feature request made originally on forums, later posted to bugs.w.o here: 

https://gna.org/bugs/?21211

The change is very simple, in multiplayer_connect.cpp I add 3 lines to function connect::update_player_list. This function already may call ui::set_user_list which can produce sounds when players are added or leave. After that event I add a check, if the engine says there are no slots available and the silent flag is off, then ask ui to play the ""turn bell"" sound, which alerts host that game is ready to start. I also must include sound.hpp in multiplayer_connect.cpp.

I think this is the appropriate place to add this code, as ui::set_user_list does not have the engine in its scope. It might be a bit annoying if in some circumstance, update_player_list is called again and again and the bell plays many times -- as far as I know there is no circumstance where this happens, limited testing suggests good performance.

~iceiceice~
"
10064797,Fix straight apostrophes in player-visible text.,8573,2013-11-18 20:46:57+00:00,2013-11-18 21:34:01+00:00,{},"Fix four instances — one in The Rise of Wesnoth’s dialog, two in the
ogre race description, and one in the “LAN server” “motd” — of the
straight apostrophe (U+0027 ' APOSTROPHE) being used in player-visible
text, where the typographic apostrophe (U+2019 ’ RIGHT SINGLE QUOTATION
MARK) ought to be used instead.
"
10064730,Fix two textual errors in data/lan_server.cfg.,8573,2013-11-18 20:44:54+00:00,2013-11-18 21:18:44+00:00,{},"Fix two minor textual errors in the value of the `motd` attribute in
data/lan_server.cfg:
- “Wesnoth” was not capitalized when it ought to have been capitalized.
- “shutdown” was used as a verb. “shutdown” is a noun; the verb is “shut
  down”.
"
9823963,put functions declared int lua_api.hpp in a new file lua_api.cpp,gfgtdf,2013-11-09 22:14:24+00:00,2013-11-09 22:55:13+00:00,{},"i also added some declarations of functions from lua.cpp to lua_api.hpp

plus i added the file lua_types.hpp because i didnt like all the static_cast<void *>(const_cast<char *>(x)) casts
"
9302592,Changes to the movetypes of some undead units,Asheviere,2013-10-22 17:55:13+00:00,2013-11-10 01:00:36+00:00,{},"I changed the Death Squire and Death Knight to have the 'regular' Skeleton resistances. Also, I changed the Chocobone so it now uses the mounted movetype, which the regular undeadfoot resistances, like the Skeleton Rider in both Liberty and UtBS does.
"
9235726,Add new replay-safe Lua AI action ai.synced_command(),mattsc,2013-10-20 02:09:38+00:00,2013-12-04 15:37:47+00:00,{},"This enables the execution of Lua commands from within the AI.  The
commands are synced to be in the replay file as well, using a new
[command][lua_ai] tag.  Function call:
ai.synced_command(command, x1, y1), where command is a string
containing the lua code and x1,y1 is an optional map location that is
the only allowed external variable used in the code string.
"
9056613,adding a \n at the end of compresses config files to prevent creating corrupted files.,gfgtdf,2013-10-13 22:47:11+00:00,2013-11-01 19:21:32+00:00,{},"https://svn.boost.org/trac/boost/ticket/5237

the patch effects all platforms. The only reason why it is from the ""msvc-fixes"" branch is that i forgot to make a new branch for it.
"
8893024,Updated HttT animations,Asheviere,2013-10-07 18:52:47+00:00,2013-10-12 17:38:30+00:00,{},"I updated the HttT animations to the 1.11 syntax. I also changed the behavior of the leading anims. Please tell me if you think this looks better/worse, so I can change it.
"
8725912,some msvc fixes,gfgtdf,2013-10-01 01:17:03+00:00,2013-10-04 23:02:32+00:00,{},"renaming HELP_INDEX because it is already a define in a windows header.

fixing a bug that causes wesnoth to crash sometimes if compiled with visual studio 2010.

read_compressd is called by save_index_class::data and config_cache::read_cache (among others maybe).
save_index_class::data  expects a gzip_error to be thown, i added a catch for gzip_error in config_cache::read_cache to prevent msvc compiled versions to crash on corruptes cachefiles.

fixing: http://connect.microsoft.com/VisualStudio/feedback/details/520043/
"
8248078,Updated the Dragonguard halos to the new syntax,Asheviere,2013-09-11 15:41:42+00:00,2013-09-12 15:16:22+00:00,{},
8247088,Fixed a small bug that caused THoT to crash,Asheviere,2013-09-11 15:16:16+00:00,2013-09-11 15:20:39+00:00,{},
8194256,Update it.po,piumato,2013-09-09 22:24:48+00:00,2014-02-23 21:56:35+00:00,{},"I start to translate it, i hope I do it correctly, please give me a feedback to my e-mail.
Thank you in advance.
"
8111287,Updated AnimationWML for the Saurian Skirmisher and Dwarvish Thunderer lines,Asheviere,2013-09-05 16:37:32+00:00,2013-09-11 14:56:54+00:00,{},"Followup to PR #64. I fixed the bug with the Skirmisher line, as well as improving the timings, and also converted the new thunderer line anims to the 1.11 syntax. I also fixed some issues with Feeding and SOUND:POISON.
"
7829909,Speed up AI turns 5-10% by deferring tod creation,yieldthought,2013-08-23 19:28:48+00:00,2013-08-25 23:17:41+00:00,{},"Profiling --no-gui runs (I used a commercial tool) showed a surprising
amount of time is spent inside terrain_filter::match_internal. This
appears to mostly be as a result of checking every single terrain tile
to determine where the leader location is, which seems ripe for
optimization itself.

However, within this function 5-10% of the time is spent creating a
time_of_day that is rarely used by these AI matches:

One sample run:
![terrain_filter_run1](https://f.cloud.github.com/assets/946653/1018472/fc8bdcc6-0c29-11e3-98b1-87654d7a46f5.png)

A second sample run (there's a lot of variability as I'm not forcing the PRNG seed here; the AI is playing different matches each time):
![terrain_filter_run2](https://f.cloud.github.com/assets/946653/1018474/0f841000-0c2a-11e3-9120-50b7a1f6cc26.png)

Simply reordering the lines to defer its creation until inside the if 
block that checks whether tod is a factor eliminates this part of the
overhead.

This patch speeds AI turns up by 5-10% on my test machine (an 8-core
Linode 2048).
"
7787019,updated translation for pt_PT,trewe,2013-08-22 11:39:29+00:00,2013-08-27 14:32:07+00:00,{},
7684749,Updated the Galician translation of the “Descent Into Darkness” map.,Gallaecio,2013-08-18 22:06:43+00:00,2013-08-27 14:19:02+00:00,{},
7681809,Updated the Galician translation,Gallaecio,2013-08-18 10:27:30+00:00,2013-08-18 11:29:46+00:00,{},
7681695,Removed double spaces from a couple of internationalized strings.,Gallaecio,2013-08-18 09:50:13+00:00,2013-08-27 14:34:37+00:00,{},
7679389,[Galician Translation] Added an image that had been left behind because of .gitignore’s ‘wesnoth*’ entry.,Gallaecio,2013-08-17 20:59:17+00:00,2013-08-17 23:14:42+00:00,{},
7673058,[Galician Translation] Update,Gallaecio,2013-08-16 22:39:21+00:00,2013-08-17 05:29:10+00:00,{},
7673048,[Galician Translation] Update,Gallaecio,2013-08-16 22:38:59+00:00,2013-08-17 05:28:54+00:00,{},
7626826,Added a hit sound to the Saurian Skirmisher line ranged anims and improved SOUND:POISON so it doesn't play the sound when the unit is unpoisonable,Asheviere,2013-08-15 09:44:16+00:00,2013-09-05 17:40:56+00:00,{},
7606192,Allowed [modify_side] to modify the scroll_to_leader key,Vultraz,2013-08-14 16:07:26+00:00,2013-08-15 09:27:03+00:00,{},"Allowed [modify_side] to modify the scroll_to_leader key.
"
7601904,Added a notification when toggling accelerated speed,Asheviere,2013-08-14 13:58:44+00:00,2013-08-14 19:06:35+00:00,{},"Added an on-screen notification when toggling accelerated speed (with the hotkey).
"
7553196,"[Galician Translation] Review of the tutorial, affecting other modules as well.",Gallaecio,2013-08-12 20:53:59+00:00,2013-08-12 23:37:16+00:00,{},
7552908,"[Galician Translation] Review of the tutorial, affecting other modules a...",Gallaecio,2013-08-12 20:45:30+00:00,2013-08-12 23:36:54+00:00,{},"...s well.
"
7551841,Removed a trailing parenthesis at the end of a string that made no sense...,Gallaecio,2013-08-12 20:10:56+00:00,2013-08-12 23:35:40+00:00,{},"... there.
"
7551366,add hotkeys for wml menu items and some changed to compile it with msvc2...,gfgtdf,2013-08-12 19:54:15+00:00,2013-09-30 15:06:26+00:00,{},"added hotkeys for wml menu items, by adding a vector for hotkey_commands so i can add them dynamicly, and chaning the (can)execute_command interface to ""const hotkey_command& command, int index""

removed msvc 2010 comile error fixes as requested.

EDIT: i updated my master brachn and copied the old branch to the ""adsf"" branch

EDIT: i had a summary of what was changed in wich file:

src/controller_base.cpp
src/editor/editor_controller.cpp
src/editor/editor_controller.hpp
src/help.cpp
src/help.hpp
src/playmp_controller.cpp
src/playmp_controller.hpp
src/playsingle_controller.hpp
src/replay_controller.cpp
src/replay_controller.hpp
src/show_dialog.cpp
changing the interface of (can_)execute_command(HOTKEY)

src/hotkey_preferences_display.cpp
changing to fit the changes in hotkey.hpp

src/playsingle_controller.cpp
allow HOTKEY_WML in can_execute_command
and changing the interface of (can_)execute_command(HOTKEY)

src/hotkeys.cpp
src/hotkeys.hpp
using boost::ptr_vector instead of C-array for hotkey_commands
adding functions hotkey::add_wml_hotkey, hotkey::delete_all_wml_hotkeys for wml_menu hotkeys.
changing the hotkey_command to use t_string instead of char*, and using a hotkey_command_temp for the hotkrey_list_ to prevent initialisation errors related to t_string.
and changing the interface of (can_)execute_command(HOTKEY)

src/play_controller.cpp
execute the wml menu hotkeys in execute_command
and changing the interface of (can_)execute_command(HOTKEY)

src/play_controller.hpp
adding wml_menu_hotkey_prefix and the helper function fire_wml_menu_item_event to use in execute_command
and changing the interface of (can_)execute_command(HOTKEY)

src/gamestatus.hpp
src/gamestatus.cpp
adding information about hotkeys in the wml_menu_item structure

src/game_events.cpp
calling hotkey::add_wml_hotkey, hotkey::delete_all_wml_hotkeys, adding posibility to add infomration about hotkeys in set_menu_item
"
7536815,Wesnoth yamg,Pyrophorus,2013-08-12 10:33:41+00:00,2013-08-12 11:10:26+00:00,{},"Third attempt...
"
7532431,[Galician Translation] Updated map localization of “An Orcish Incursion”...,Gallaecio,2013-08-12 05:25:42+00:00,2013-08-12 11:46:43+00:00,{},"....
"
7528926,[Galician Translation] Manually backported changes in master.,Gallaecio,2013-08-11 18:50:32+00:00,2013-08-11 21:09:16+00:00,{},
7528921,[Galician Translation] Manually reviewed all strings brought up by posie...,Gallaecio,2013-08-11 18:49:52+00:00,2013-08-11 21:08:18+00:00,{},"...ve’s spell checker.
"
7527248,Backported updated to the Galician translation.,Gallaecio,2013-08-11 11:30:50+00:00,2013-08-11 16:58:18+00:00,{},
7527179,Galician translation update,Gallaecio,2013-08-11 11:07:35+00:00,2013-08-11 16:57:45+00:00,{},"• Added Galician to the list of updated translations in the ChangeLog files.
• Finished translating the wesnoth-ai module into Galician.
• Reviewed all files for some consistency fixes, standard fixes, and general review.
"
7523803,[Galician translation] Translated images and minor text changes,Gallaecio,2013-08-10 17:25:54+00:00,2013-08-11 06:46:21+00:00,{},
7522760,[Galician translation] Translated images and minor text changes,Gallaecio,2013-08-10 12:25:44+00:00,2013-08-11 06:46:14+00:00,{},
7497511,[Galician translation] Finished translating Under the Burning Suns.,Gallaecio,2013-08-09 06:22:36+00:00,2013-08-09 11:12:40+00:00,{},
7497445,[Galician translation] Finished translating Under the Burning Suns.,Gallaecio,2013-08-09 06:18:32+00:00,2013-08-09 11:09:26+00:00,{},
7458691,1.10 gl,Gallaecio,2013-08-07 20:32:34+00:00,2013-08-07 22:41:56+00:00,{},"Con isto #45 pode seguir adiante :)
"
7458448,[Galician translation] Further progress with ‘Under the Burning Suns’.,Gallaecio,2013-08-07 20:25:27+00:00,2013-08-07 22:41:35+00:00,{},
7456971,“But if if this battle…” → “But if this battle…”,Gallaecio,2013-08-07 19:39:24+00:00,2013-08-09 19:04:03+00:00,{},"I suggest that you let translators know about this if you accept it, as this will result in a fuzzy string for all languages as you regenerate the PO files. Hmm… Please, don’t regenerate them for a couple of hours, I would like to submit a translation update first :)
"
7456854,“But if if this battle…” → “But if this battle…”,Gallaecio,2013-08-07 19:35:10+00:00,2013-08-07 22:39:23+00:00,{},
7426959,[Galician translation] Finished translating the 10th scenario of “Under the Burning Suns”.,Gallaecio,2013-08-06 20:11:14+00:00,2013-08-06 22:41:35+00:00,{},
7426944,[Galician translation] Finished translating the 10th scenario of “Under the Burning Suns” (backported from master).,Gallaecio,2013-08-06 20:10:39+00:00,2013-08-06 22:41:30+00:00,{},
7385278,Wesnoth yamg,Pyrophorus,2013-08-05 12:24:04+00:00,2013-08-12 09:19:00+00:00,{},
7369254,	Backported Galician translations from master,Gallaecio,2013-08-03 10:05:11+00:00,2013-08-03 10:55:28+00:00,{},
7352160,Some corrections and and minor changes:,Pyrophorus,2013-08-02 14:02:12+00:00,2013-08-03 09:37:46+00:00,{},"- add 'endpoints_' initialization in resetMap (bug in makeRoads), and enable road creation again.
- fix boundaries check in neighbors methods (signed/unsigned mismatches).
- fix generator configurations names.
- delete some unused code.
- fix a typo (error) in clear_heap method.
"
7218328,Galician translation update,Gallaecio,2013-07-28 10:35:44+00:00,2013-07-28 12:17:39+00:00,{},"Updated wesnoth, wesnoth-editor, wesnoth-httt, wesnoth-lib.
Continued progress on wesnoth-utbs.
"
7065732,Speed up AI turns by around 25%,yieldthought,2013-07-21 19:14:01+00:00,2013-08-24 09:06:38+00:00,{},"This is my first patch to Wesnoth; it's a small set of pretty trivial changes that speed AI turns up by 25-40% on my machine, measured by running --no-gui a hundred times and comparing the mean of the internal turn timers. It does this by reordering a few tests (semantic no-ops) and caching the vconfig has_attribute results within a terrain_filter.

The long version: While running thousands of times with --no-gui to gather AI statistics, I became interested in the performance of the default AI and ran it through a profiler.

I found that a surprising amount of AI turn-time is spent inside a couple of terrain_filter functions, a side effect of being called to find the leader as part of find villages, I think.

Anyway, to cut a long story shot per-line profiling showed that there were a bunch of relatively expensive operations that could be trivially avoided most of the time by reordering tests and caching a small number of cfg_.has_attribute calls, which looks semantically valid.

Longer term it might be interesting to look at the performance of vconfig more directly and decide whether to cache inside that class instead, or indeed to decide whether there's a more efficient way to find leaders and villages than loop through every tile on the map.

This, however, is a very small, localized change that has a pretty decent (~25% on my system) speedup. I guess it will apply to all AI types too, as I think find villages is likely to be called by e.g. various LUA functions too.
"
7047487,added information about single hits in simulate_combat,gfgtdf,2013-07-19 17:16:50+00:00,2013-07-19 22:57:46+00:00,{},"as in this forum thread http://forums.wesnoth.org/viewtopic.php?f=21&t=39110#p557179
"
6767930,[Galician (gl) Translation] Progress on wesnoth-utbs continues.,Gallaecio,2013-07-08 00:03:14+00:00,2013-07-08 01:14:22+00:00,{},
6498676,summarize wmllint changes and add myself to credits,groggyd88,2013-06-24 09:05:49+00:00,2013-06-24 11:33:17+00:00,{},
6491675,[Mispell] have lead → have led,Gallaecio,2013-06-23 15:11:23+00:00,2013-06-23 15:38:15+00:00,{},"I have to say I only noticed thanks to translation memories, because there is a similar string which says «have led» (the correct spelling) instead.
"
6491657,[Galician Translation] Further progress in Under the Burning Suns,Gallaecio,2013-06-23 15:07:36+00:00,2013-06-23 20:50:41+00:00,{},
6490740,god → goddess,Gallaecio,2013-06-23 10:18:51+00:00,2013-06-23 20:25:57+00:00,{},"I’ve tried to be careful to only change it to “goddess” there where it specifically refers to Eloh.
"
6486895,New WEAPON_SPECIAL_DRAIN_VALUE Macro,SilverNexus,2013-06-22 13:13:08+00:00,2013-06-22 14:39:31+00:00,{},"This is a macro that allows for any unit to have a drain percentage of any value, and can be used directly in unit definitions. It provides easy support for the new 'value' attribute in the drains WML.

Even the {VALUE} notation in the description works correctly based on my tests, so the hover description for this macro gives the correct percentage for each unit.
"
6486656,Coffee recruitment facing direction,Coffee--,2013-06-22 11:49:03+00:00,2014-05-27 15:31:42+00:00,{},"For Fabi, et al.

This pull request adds an initial recruitment facing direction, instead of the old random direction. It works like so:

If an enemy unit is visible, the one with the shortest distance - unit level is chosen and the direction of the new recruit faces this visible enemy unit. Otherwise, the newly recruited unit faces towards the centre, but with increasing randomness as the map coordinates approach the centre, where it may face in any direction.
"
6461181,upgrade old UMC paths from data/campaigns/ to data/add-ons/,groggyd88,2013-06-21 01:50:03+00:00,2013-06-23 00:44:08+00:00,{},"wmllint had held back from updating these paths, to prevent mainline paths from being changed too. However, these commits allow wmllint to distinguish between UMC and mainline paths.

To do this, one commit creates a list of mainline campaigns. Since this is only going to be used for this function, it would also work inside hack_syntax, but I consulted with shadowmaster, who advised leaving it as a global.

Then the main commit uses finditer to turn up and replace all the UMC paths. This code is more streamlined than my original code, which used a while loop.
"
6407659,[Galician Translation] More progress on wesnoth-utbs,Gallaecio,2013-06-19 06:44:32+00:00,2013-06-19 15:20:39+00:00,{},
6342152,[Changelogs] The Galician (gl) translation has been updated.,Gallaecio,2013-06-15 09:57:23+00:00,2013-06-15 12:06:51+00:00,{},"Updated the Galician translation of desktop integration files.
Some work on the Galician translation of wesnoth-utbs, and review of some related strings.
"
6334950,Updated the Galician (gl) translation.,Gallaecio,2013-06-14 19:41:38+00:00,2013-06-14 20:13:52+00:00,{},
6193205,fixed bug #20870 Typo in NAMED_LOYAL_UNIT macro documentation,spixi,2013-06-07 18:03:08+00:00,2013-06-10 21:03:34+00:00,{},
6178067,append pango code to message about color spec requiring manual fix,groggyd88,2013-06-07 02:50:32+00:00,2013-06-08 15:06:13+00:00,{},"The commit message has the relevant details.

I consider this commit to be something of a stopgap. In the long term, there are a lot of improvements to be made to pangoize, such as:
- It only works on a message= key, inside a [message] tag. There are other places where markup is used; at the least, pangoize should probably check all translatables.
- It does not work when there is more than one markup symbol, for example for both large text and bold.
- Other stuff.

For now, this is a modest improvement; let's not make perfect the enemy of better.
"
6176783,Drake animation file name extension was missing,fluffbeast,2013-06-07 00:42:14+00:00,2013-06-08 13:26:55+00:00,{},"Some of the drake .cfg files were missing a file name extension for part of the animation sequence.
"
6126231,auto-recognize characters in {NAMED_*UNIT} macros (and update 1.4's {LOYAL_UNIT} macro),groggyd88,2013-06-05 08:30:15+00:00,2013-12-17 10:02:13+00:00,{},"The first commit transitions 1.4's {LOYAL_UNIT} to {NAMED_LOYAL_UNIT}, using a regex to carefully distinguish it from the current {LOYAL_UNIT}.

The second auto-recognizes people in {NAMED_*UNIT} macros, saving designers from the hassle of adding ""wmllint: recognize"" magic comments"" or suffering high false positive ""unknown 'XXX' referred to by id"" messages.

The long delay since I first introduced these ideas has given me plenty of time to test and hone both these regexes. Both thoroughly capture their intended targets, without scooping up false positives.
"
6069514,"convert a couple of Windows-isms (backslashes, 'userdata/') to be more x-platform friendly",groggyd88,2013-06-03 04:59:51+00:00,2013-06-10 21:09:53+00:00,{},"First off, while looking at the conventions of hack_syntax, I noticed that many operations pass on lines that start with ""#"". Given that many comments are indented, I inserted .lstrip() into them.

As for the other commits:

Why did I place them at the top of hack_syntax instead of at the bottom? First, typically new operations are added to hack_syntax due to changes in WML, but these commits fix problems that transcend any particular Wesnoth version. Second, they would have to go before my code for updating old UMC paths to 'data/add-ons', since the regexes there assume forward slashes.

My log message about ""userdata/"" includes an ALL CAPS admonition. Perhaps it's too strong, but given how UNIX-centric the dev team is, I'm sure you at least sympathize. (Originally, my log message about backslashes also included caps, but I decided on a more polite approach.) Windows devs can't see the problem because it doesn't affect them, and we have Windows users switching to installing in the program directory, and regarding the problem as ""fixed"".
"
6063581,bring back the usage class check and introduce a magic comment for non-standard usage classes,groggyd88,2013-06-02 02:43:14+00:00,2013-07-31 01:14:34+00:00,{},"I believe that this check was genuinely helpful, and I want to bring it back. To deal with the deliberate employment of custom usage types, there is a new magic comment. I believe that this should satisfy the concerns that led to the check's removal, and I don't expect its return to be controversial.

Although I personally would put the magic comment in the _main.cfg, I put the code for recognizing the magic comment before the code for the check, so that the magic comment can also be put in the scenario where the usage type is first employed.
"
6063523,assorted basic and hopefully uncontroversial changes,groggyd88,2013-06-02 02:18:53+00:00,2013-06-22 23:43:07+00:00,{},"The first commit is simply spelling corrections.

The second doesn't really involve coding, just deciding whether my wording actually makes the error message clearer.

The last commit should also be straightforward, unless a fan of grunt-4 wants to start a debate about which images to use. (However, if Ivanovic suddenly puts out 1.11.5, a reference will have to be changed to ""after 1.11.5"" or ""before 1.11.6""!)
"
5943018,"Fixed incorrect behaviour of ""Shuffle sides"" in MP.",andrius-sil,2013-05-27 10:26:25+00:00,2013-05-30 09:47:45+00:00,{},"The incorrect shuffling was caused because not only sides were shuffled, but some of their children as well.
"
5933599,remove files on Windows so --revert and second conversions can proceed,groggyd88,2013-05-26 01:22:10+00:00,2013-06-01 21:07:06+00:00,{},"Windows won't allow a rename to overwrite an existing file (Error 183, file already exists).
"
5930243,[wmlunits] Fix error logging. ,elias-pschernig,2013-05-25 09:18:13+00:00,2013-05-25 09:54:38+00:00,{},"I guess on github a pull request makes more sense than asking for commit access again...
"
5802692,Added copyright notice,nurupo,2013-05-20 03:35:00+00:00,2013-05-20 09:17:36+00:00,{},
5787048,Implementation of notifications for Windows OS.,nurupo,2013-05-17 19:51:41+00:00,2013-05-18 20:01:44+00:00,{},"Basically, you can now show notifications on Windows.
There is a limit on notification title and message lengths; if title and message don't fit in WinApi limitations, they get truncated in order to fit.
Also, when users click on the notification, they get switched to the Wesnoth game window.

The notifications should work for Windows XP and higher. If support of Windows 98 and higher is desired, it can be done with few changes.

Note that this pull request introduces two new files that should be compiled on Windows platform only, which means that project files should be changed accordingly. I hope that someone who knows project files' markup will volunteer and modify them.
"
5762150,Rewrote location_set.of_pairs().,jleldridge,2013-05-16 19:44:12+00:00,2013-05-17 14:19:31+00:00,{},"Rewrote location_set.of_pairs() to follow formatting conventions.
"
5731731,Rewrote location_set.of_pairs().,jleldridge,2013-05-15 16:55:23+00:00,2013-05-16 04:25:34+00:00,{},"Rewrote location_set.of_pairs() to support coordinate pair inputs in the form of ""x= y="" as well as still supproting ""[1]: [2]:"". Also, if there is any additional data stored in either table form, then that extra data will be stored as the data in the key/data pair of the location_set, instead of simply storing ""true"".

Also changed the healer support mai to use the new of_pairs() method to create the avoid_map.
"
5705140,Allowed healer support mai to use avoid aspect to avoid tiles.,jleldridge,2013-05-14 16:41:07+00:00,2013-05-14 20:16:58+00:00,{},"Read the locations to avoid into the avoid_map location set and then checked to make sure whatever locations were being considered for the AI to move to were not in avoid_map.
"
5663269,Fixed 'end turn' button's state in MP and title2 issues,andrius-sil,2013-05-12 15:08:28+00:00,2013-05-12 20:21:25+00:00,{},"The 'end turn' button no longer stays disabled on linger in MP and title stash for action buttons were added to keep previous titles after display.redraw_everything().
"
5573280,Move 'allow_player_' back to initializer list.,andrius-sil,2013-05-07 16:05:33+00:00,2013-05-09 17:16:46+00:00,{},"Minor fix of my previous pull request which is already merged into trunk.
"
5565701,Default value for 'allow_player' attribute.,andrius-sil,2013-05-07 10:21:50+00:00,2013-05-07 11:03:28+00:00,{},"To remove some redundancy from SideWML, I've added a default value 'no' for 'allow_player' attribute when the controller is ai.

Wiki will be updated if pull request is accepted.
"
5561599,Healer Support MAI: added [filter_second] option to choose healees.,jleldridge,2013-05-07 05:08:27+00:00,2013-05-09 20:18:46+00:00,{},"Added a [filter_second] option to the Healer Support MAI at the request of mattsc.
"
5538332,Using scoped_ptr in unit class (refactor),vinipsmaker,2013-05-06 01:14:34+00:00,2013-05-26 19:35:35+00:00,{},"This change aims to simplify the code, making the intents more explicit.
There wasn't a memory leak in the previous version, but it could easily be
introduced in the future.

Also, RAII is part of the coding standards of Wesnoth, as noted in the wiki.

There are other raw pointers in the unit class, but unit don't own them, then
I leave them unchanged.
"
5512122,Added timestamps in Chatlog,nurupo,2013-05-03 09:32:42+00:00,2013-05-13 21:22:55+00:00,{},"It was a little odd that timestamps checkbox in Preferences affected only chat messages, but not the chatlog, so I decided to add timestamps into the chatlog.

![chat_log_timestamps](https://f.cloud.github.com/assets/1855294/458366/28683262-b3d4-11e2-804a-dc3a0a683eb7.png)
"
5484818,Fixes bug #20765,vinipsmaker,2013-05-02 03:06:34+00:00,2013-05-02 07:24:27+00:00,{},"The change is small, but it took some time to hunt this bug down.

....

A call to unit::redraw_unit would check if the unit contains any animation. If
no animation is found, then it would call set_standing to put a new animation.

States are usually changed through unit::start_animation. unit::set_standing
uses this approach also. If unit::start_animation is unable to change the unit
to the animation passed as argument, it would try to animate the object calling
unit::set_standing (infinite recursion).

unit::start_animation had a check (maybe to prevent the infinite recursion), but
this check was buggy (if the intent was to prevent the infinite recursion).

The solution add a instruction to successfully set the unit to the state
STATE_STANDING and fixes the check that was using the wrong logical operator.
"
5469263,Fix 'end turn' button's state issue.,andrius-sil,2013-05-01 12:02:47+00:00,2013-05-01 12:08:19+00:00,{},"The issue: the 'end turn' button remains disabled after the first turn unless its state is set by triggered action of recruit, recall etc.

My solution is to call 'set_button_state()' inside 'before_human_turn()' function in order to make sure that 'end turn' button's state is correct.
"
5415044,Added optional reason to the ignore feature,fbastani,2013-04-28 20:54:17+00:00,2013-05-17 18:36:23+00:00,{},"In multiplayer, this supports players to associate a reason with ignored users that is displayed with the ignored username. Resolves http://wiki.wesnoth.org/EasyCoding#Add_possibility_to_give_reason_for_.22ignore.22.
"
